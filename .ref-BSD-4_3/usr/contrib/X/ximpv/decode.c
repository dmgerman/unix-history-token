begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1985 University of Alberta *  *  * This file contains two fuctions for parameter decoding;  * "inicodes" is an initialization function and must be called once,  * before "decode" can be used; "decode" is the actual parameter  * decoding function;  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_decode_c
init|=
literal|"$Header: decode.c,v 10.2 86/02/01 15:59:43 tony Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"imPdefs.h"
end_include

begin_include
include|#
directive|include
file|"imPcodes.h"
end_include

begin_define
define|#
directive|define
name|CMDPLEN
parameter_list|(
name|code
parameter_list|)
value|(017&cmdpars[code&0177])
end_define

begin_define
define|#
directive|define
name|CMDPMIX
parameter_list|(
name|code
parameter_list|)
value|(017&(cmdpars[code&0177]>>4))
end_define

begin_decl_stmt
name|char
name|cmdpars
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|NOPMSK
value|(15<<4)
end_define

begin_define
define|#
directive|define
name|B
value|(0<<4)
end_define

begin_define
define|#
directive|define
name|BA
value|(0<<4)
end_define

begin_define
define|#
directive|define
name|W
value|(1<<4)
end_define

begin_define
define|#
directive|define
name|BB
value|(2<<4)
end_define

begin_define
define|#
directive|define
name|BBB
value|(3<<4)
end_define

begin_define
define|#
directive|define
name|WWW
value|(4<<4)
end_define

begin_define
define|#
directive|define
name|BBA
value|(5<<4)
end_define

begin_define
define|#
directive|define
name|WBBBBBA
value|(6<<4)
end_define

begin_define
define|#
directive|define
name|WWWWWWA
value|(7<<4)
end_define

begin_define
define|#
directive|define
name|BWA
value|(8<<4)
end_define

begin_define
define|#
directive|define
name|BBBA
value|(9<<4)
end_define

begin_define
define|#
directive|define
name|WA
value|(10<<4)
end_define

begin_define
define|#
directive|define
name|NOPARS
value|NOPMSK+0
end_define

begin_decl_stmt
name|char
modifier|*
name|cmdpmsk
index|[
literal|16
index|]
init|=
block|{
literal|"B"
block|,
literal|"W"
block|,
literal|"BB"
block|,
literal|"BBB"
block|,
literal|"WWW"
block|,
literal|"BBA"
block|,
literal|"WBBBBBA"
block|,
literal|"WWWWWWA"
block|,
literal|"BWA"
block|,
literal|"BBBA"
block|,
literal|"WA"
block|,
literal|""
block|,
literal|""
block|,
literal|""
block|,
literal|""
block|,
literal|""
block|}
decl_stmt|;
end_decl_stmt

begin_macro
name|inicodes
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|128
condition|;
name|i
operator|++
control|)
name|cmdpars
index|[
name|i
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASP0
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASP1
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASRULE
operator|&
literal|0177
index|]
operator|=
name|BBB
operator|+
literal|3
expr_stmt|;
name|cmdpars
index|[
name|ABRULE
operator|&
literal|0177
index|]
operator|=
name|WWW
operator|+
literal|6
expr_stmt|;
name|cmdpars
index|[
name|AM
operator|&
literal|0177
index|]
operator|=
name|BB
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AMP
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|AMM
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|AH
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AV
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AN
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASGLY
operator|&
literal|0177
index|]
operator|=
name|WBBBBBA
operator|+
literal|7
expr_stmt|;
name|cmdpars
index|[
name|ABGLY
operator|&
literal|0177
index|]
operator|=
name|WWWWWWA
operator|+
literal|12
expr_stmt|;
name|cmdpars
index|[
name|ADELG
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ADELC
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ADELF
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|AFONT
operator|&
literal|0177
index|]
operator|=
name|BA
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|APAGOR
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|AROTMS
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|AF
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|ABSKIP
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AMARGIN
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASETSP
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|APUSH
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|APOP
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|APAGE
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|AEND
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|AEOF
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ANOP
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASET_HV_SYS
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|ASET_ABS_H
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASET_ABS_V
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASET_REL_H
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASET_REL_V
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AMMOVE
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASMOVE
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ACREATE_MAP
operator|&
literal|0177
index|]
operator|=
name|BB
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ACREATE_FAMILY
operator|&
literal|0177
index|]
operator|=
name|BB
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|AFORCE_GLY_DELETE
operator|&
literal|0177
index|]
operator|=
name|NOPARS
expr_stmt|;
name|cmdpars
index|[
name|ASET_PATH
operator|&
literal|0177
index|]
operator|=
name|WA
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASET_TEXTURE
operator|&
literal|0177
index|]
operator|=
name|BB
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ASET_PEN
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|ADRAW_PATH
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|AFILL_PATH
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|ABIT_MAP
operator|&
literal|0177
index|]
operator|=
name|BBBA
operator|+
literal|3
expr_stmt|;
name|cmdpars
index|[
name|ASET_MAGNIFICATION
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
name|cmdpars
index|[
name|ASET_PUSH_MASK
operator|&
literal|0177
index|]
operator|=
name|W
operator|+
literal|2
expr_stmt|;
name|cmdpars
index|[
name|ADEFINE_MACRO
operator|&
literal|0177
index|]
operator|=
name|BWA
operator|+
literal|3
expr_stmt|;
name|cmdpars
index|[
name|AEXECUTE_MACRO
operator|&
literal|0177
index|]
operator|=
name|B
operator|+
literal|1
expr_stmt|;
block|}
end_block

begin_macro
name|decode
argument_list|(
argument|ccode
argument_list|)
end_macro

begin_decl_stmt
name|char
name|ccode
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|parva
modifier|*
name|parap
decl_stmt|;
specifier|register
name|char
modifier|*
name|sp
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|char
modifier|*
name|Cinpcurr
decl_stmt|;
name|char
name|inp
index|[
literal|20
index|]
decl_stmt|;
name|Cinpcurr
operator|=
name|inp
expr_stmt|;
for|for
control|(
name|i
operator|=
name|CMDPLEN
argument_list|(
name|ccode
argument_list|)
init|;
name|i
condition|;
name|i
operator|--
control|)
operator|*
name|Cinpcurr
operator|++
operator|=
name|gc
argument_list|()
expr_stmt|;
name|Cinpcurr
operator|=
name|inp
expr_stmt|;
name|parap
operator|=
name|param
operator|+
literal|1
expr_stmt|;
name|sp
operator|=
name|cmdpmsk
index|[
name|CMDPMIX
argument_list|(
name|ccode
argument_list|)
index|]
expr_stmt|;
while|while
condition|(
operator|*
name|sp
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|sp
operator|==
literal|'B'
condition|)
block|{
name|parap
operator|->
name|pval2
operator|.
name|hival
operator|=
literal|0
expr_stmt|;
name|parap
operator|->
name|pval2
operator|.
name|loval
operator|=
operator|*
name|Cinpcurr
expr_stmt|;
name|Cinpcurr
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|sp
operator|==
literal|'W'
condition|)
block|{
name|parap
operator|->
name|pval
operator|=
operator|(
operator|(
operator|*
name|Cinpcurr
operator|&
literal|0377
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|Cinpcurr
index|[
literal|1
index|]
operator|&
literal|0377
operator|)
expr_stmt|;
name|Cinpcurr
operator|+=
literal|2
expr_stmt|;
block|}
else|else
name|parap
operator|->
name|pptr
operator|=
name|Cinpcurr
expr_stmt|;
name|sp
operator|++
expr_stmt|;
name|parap
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|getint
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|parva
modifier|*
name|parap
decl_stmt|;
specifier|register
name|int
name|c
init|=
name|gc
argument_list|()
decl_stmt|;
name|parap
operator|=
name|param
operator|+
literal|1
expr_stmt|;
name|parap
operator|->
name|pval
operator|=
operator|(
operator|(
name|c
operator|&
literal|0377
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|gc
argument_list|()
operator|&
literal|0377
operator|)
expr_stmt|;
return|return
operator|(
name|V
argument_list|(
literal|1
argument_list|)
operator|)
return|;
block|}
end_block

end_unit

