begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* $Header: XMenuCreate.c,v 10.9 86/02/01 16:14:36 tony Rel $ */
end_comment

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1985	*/
end_comment

begin_comment
comment|/*  * XMenu:	MIT Project Athena, X Window system menu package  *  * 	XMenuCreate -	Creates an X window system menu object.  *  *	Author:		Tony Della Fera, DEC  *			January 23, 1986  *  */
end_comment

begin_include
include|#
directive|include
file|"XMenuInternal.h"
end_include

begin_include
include|#
directive|include
file|"../bitmaps/dimple1.bitmap"
end_include

begin_include
include|#
directive|include
file|"../bitmaps/dimple3.bitmap"
end_include

begin_include
include|#
directive|include
file|"../bitmaps/gray1.bitmap"
end_include

begin_include
include|#
directive|include
file|"../bitmaps/gray3.bitmap"
end_include

begin_include
include|#
directive|include
file|"../bitmaps/cross_weave.bitmap"
end_include

begin_include
include|#
directive|include
file|"../cursors/left_ptr.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/left_ptr_mask.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/right_ptr.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/right_ptr_mask.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/center_ptr.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/center_ptr_mask.cursor"
end_include

begin_define
define|#
directive|define
name|DEF_FREEZE
value|0
end_define

begin_define
define|#
directive|define
name|DEF_MENU_STYLE
value|RIGHT
end_define

begin_define
define|#
directive|define
name|DEF_MENU_MODE
value|INVERT
end_define

begin_define
define|#
directive|define
name|DEF_INACT_PNUM
value|3
end_define

begin_define
define|#
directive|define
name|MAX_INACT_PNUM
value|4
end_define

begin_define
define|#
directive|define
name|DEF_P_STYLE
value|CENTER
end_define

begin_define
define|#
directive|define
name|DEF_P_EVENTS
value|(EnterWindow | ExposeWindow)
end_define

begin_define
define|#
directive|define
name|DEF_P_FNT_NAME
value|"8x13"
end_define

begin_define
define|#
directive|define
name|DEF_P_SPREAD
value|0.5
end_define

begin_define
define|#
directive|define
name|DEF_P_BDR_WIDTH
value|2
end_define

begin_define
define|#
directive|define
name|DEF_S_STYLE
value|LEFT
end_define

begin_define
define|#
directive|define
name|DEF_S_EVENTS
value|(EnterWindow | LeaveWindow)
end_define

begin_define
define|#
directive|define
name|DEF_S_FNT_NAME
value|"6x10"
end_define

begin_define
define|#
directive|define
name|DEF_S_SPREAD
value|0.10
end_define

begin_define
define|#
directive|define
name|DEF_S_BDR_WIDTH
value|1
end_define

begin_define
define|#
directive|define
name|DEF_P_BDR_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_S_BDR_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_P_FRG_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_S_FRG_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_BKGND_COLOR
value|WhitePixel
end_define

begin_define
define|#
directive|define
name|DEF_MOUSE_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|XASSOC_TABLE_SIZE
value|64
end_define

begin_define
define|#
directive|define
name|TILE_BUF_SIZE
value|5
end_define

begin_function_decl
name|int
name|atoi
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|double
name|atof
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|XMenu
modifier|*
name|XMenuCreate
parameter_list|(
name|parent
parameter_list|,
name|def_env
parameter_list|)
name|Window
name|parent
decl_stmt|;
comment|/* Window ID of the menu's parent window. */
specifier|register
name|char
modifier|*
name|def_env
decl_stmt|;
comment|/* X Defaults program environment name. */
block|{
specifier|register
name|int
name|i
decl_stmt|;
comment|/* Loop counter. */
specifier|register
name|int
name|j
decl_stmt|;
comment|/* Loop counter. */
specifier|register
name|char
modifier|*
name|def_val
decl_stmt|;
comment|/* X Default value temp variable. */
specifier|register
name|XMenu
modifier|*
name|menu
decl_stmt|;
comment|/* Pointer to the new menu. */
name|XMStyle
name|menu_style
decl_stmt|;
comment|/* Menu display style. */
name|XMMode
name|menu_mode
decl_stmt|;
comment|/* Menu display mode. */
name|XMPane
modifier|*
name|pane
decl_stmt|;
comment|/* Pane list header. */
name|XAssocTable
modifier|*
name|assoc_tab
decl_stmt|;
comment|/* XAssocTable pointer. */
name|Cursor
name|mouse_cursor
decl_stmt|;
comment|/* Mouse cursor. */
name|int
name|freeze
decl_stmt|;
comment|/* Freeze server mode. */
name|int
name|tile_count
decl_stmt|;
comment|/* Number of tiles created by XMakeTiles. */
name|XMStyle
name|p_style
decl_stmt|;
comment|/* Pane display style. */
name|char
modifier|*
name|p_fnt_name
decl_stmt|;
comment|/* Flag font name. */
name|FontInfo
modifier|*
name|p_fnt_info
decl_stmt|;
comment|/* Flag font information. */
name|int
name|p_fnt_pad
decl_stmt|;
comment|/* Flag font padding in pixels. */
name|double
name|p_spread
decl_stmt|;
comment|/* Pane spread in flag height fractions. */
name|int
name|p_bdr_width
decl_stmt|;
comment|/* Pane border width. */
name|int
name|flag_height
decl_stmt|;
comment|/* Flag window height. */
name|int
name|p_height
decl_stmt|;
comment|/* Pane window height. */
name|int
name|p_x_off
decl_stmt|;
comment|/* Pane X offset. */
name|int
name|p_y_off
decl_stmt|;
comment|/* Pane Y offset. */
name|XMStyle
name|s_style
decl_stmt|;
comment|/* Selection display style. */
name|char
modifier|*
name|s_fnt_name
decl_stmt|;
comment|/* Selection font name. */
name|FontInfo
modifier|*
name|s_fnt_info
decl_stmt|;
comment|/* Selection font information. */
name|int
name|s_fnt_pad
decl_stmt|;
comment|/* Selection font padding in pixels. */
name|double
name|s_spread
decl_stmt|;
comment|/* Select spread in line height fractions. */
name|int
name|s_bdr_width
decl_stmt|;
comment|/* Highlight border width. */
name|int
name|s_height
decl_stmt|;
comment|/* Selection window height. */
name|int
name|s_x_off
decl_stmt|;
comment|/* Selection window X offset. */
name|int
name|s_y_off
decl_stmt|;
comment|/* Selection window Y offset. */
name|Color
name|color_def
decl_stmt|;
comment|/* Color definition holder. */
name|int
name|p_bdr_color
decl_stmt|;
comment|/* Color of border pixmap. */
name|int
name|s_bdr_color
decl_stmt|;
comment|/* Color of highlight pixmap. */
name|int
name|p_frg_color
decl_stmt|;
comment|/* Color of pane foreground pixmap. */
name|int
name|s_frg_color
decl_stmt|;
comment|/* Color of selection foreground pixmap. */
name|int
name|bkgnd_color
decl_stmt|;
comment|/* Color of background pixmap. */
name|int
name|mouse_color
decl_stmt|;
comment|/* Color of mouse cursor. */
name|Bitmap
name|inact_bitmap
decl_stmt|;
comment|/* Inactive background pattern bitmap. */
name|int
name|inact_pnum
decl_stmt|;
comment|/* Inactive background pattern number. */
name|Pixmap
name|p_bdr_pixmap
decl_stmt|;
comment|/* Pane border pixmap. */
name|Pixmap
name|s_bdr_pixmap
decl_stmt|;
comment|/* Selection border pixmap. */
name|Pixmap
name|p_frg_pixmap
decl_stmt|;
comment|/* Pane forground pixmap. */
name|Pixmap
name|s_frg_pixmap
decl_stmt|;
comment|/* Selection forground pixmap. */
name|Pixmap
name|bkgnd_pixmap
decl_stmt|;
comment|/* Menu background pixmap. */
name|Pixmap
name|inact_pixmap
decl_stmt|;
comment|/* Menu inactive pixmap. */
name|TileFrame
name|tile_buf
index|[
name|TILE_BUF_SIZE
index|]
decl_stmt|;
comment|/* XMakeTiles buffer. */
comment|/*      * Calloc the XMenu structure and the initial pane.      */
name|menu
operator|=
operator|(
name|XMenu
operator|*
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|XMenu
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|menu
operator|==
name|NULL
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_CALLOC
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|pane
operator|=
operator|(
name|XMPane
operator|*
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|XMPane
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pane
operator|==
name|NULL
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_CALLOC
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Create the XAssocTable.      */
name|assoc_tab
operator|=
operator|(
name|XAssocTable
operator|*
operator|)
name|XCreateAssocTable
argument_list|(
name|XASSOC_TABLE_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|assoc_tab
operator|==
name|NULL
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_CREATE_ASSOC
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Set up the default environment name.      */
if|if
condition|(
name|def_env
operator|==
name|NULL
operator|||
operator|*
name|def_env
operator|==
literal|'\0'
condition|)
name|def_env
operator|=
literal|"XMenu"
expr_stmt|;
comment|/*      * Set up internal fail-safe defaults.      */
name|freeze
operator|=
name|DEF_FREEZE
expr_stmt|;
name|menu_style
operator|=
name|DEF_MENU_STYLE
expr_stmt|;
name|menu_mode
operator|=
name|DEF_MENU_MODE
expr_stmt|;
name|inact_pnum
operator|=
name|DEF_INACT_PNUM
expr_stmt|;
name|p_style
operator|=
name|DEF_P_STYLE
expr_stmt|;
name|p_spread
operator|=
name|DEF_P_SPREAD
expr_stmt|;
name|p_fnt_name
operator|=
name|DEF_P_FNT_NAME
expr_stmt|;
name|p_bdr_width
operator|=
name|DEF_P_BDR_WIDTH
expr_stmt|;
name|s_style
operator|=
name|DEF_S_STYLE
expr_stmt|;
name|s_spread
operator|=
name|DEF_S_SPREAD
expr_stmt|;
name|s_fnt_name
operator|=
name|DEF_S_FNT_NAME
expr_stmt|;
name|s_bdr_width
operator|=
name|DEF_S_BDR_WIDTH
expr_stmt|;
name|p_bdr_color
operator|=
name|DEF_P_BDR_COLOR
expr_stmt|;
name|s_bdr_color
operator|=
name|DEF_S_BDR_COLOR
expr_stmt|;
name|p_frg_color
operator|=
name|DEF_P_FRG_COLOR
expr_stmt|;
name|s_frg_color
operator|=
name|DEF_S_FRG_COLOR
expr_stmt|;
name|bkgnd_color
operator|=
name|DEF_BKGND_COLOR
expr_stmt|;
name|mouse_color
operator|=
name|DEF_MOUSE_COLOR
expr_stmt|;
comment|/*      * Get default values from X.      */
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuFreeze"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|freeze
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
name|freeze
operator|=
literal|0
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuStyle"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"right_hand"
argument_list|)
operator|==
literal|0
condition|)
name|menu_style
operator|=
name|RIGHT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"left_hand"
argument_list|)
operator|==
literal|0
condition|)
name|menu_style
operator|=
name|LEFT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"center"
argument_list|)
operator|==
literal|0
condition|)
name|menu_style
operator|=
name|CENTER
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuMode"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"box"
argument_list|)
operator|==
literal|0
condition|)
name|menu_mode
operator|=
name|BOX
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"invert"
argument_list|)
operator|==
literal|0
condition|)
name|menu_mode
operator|=
name|INVERT
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuMouse"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|mouse_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|mouse_color
operator|=
name|DEF_S_BDR_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|mouse_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|mouse_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuBackground"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|bkgnd_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|bkgnd_color
operator|=
name|DEF_BKGND_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|bkgnd_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|bkgnd_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"MenuInactivePattern"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"dimple1"
argument_list|)
operator|==
literal|0
condition|)
name|inact_pnum
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"dimple3"
argument_list|)
operator|==
literal|0
condition|)
name|inact_pnum
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"gray1"
argument_list|)
operator|==
literal|0
condition|)
name|inact_pnum
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"gray3"
argument_list|)
operator|==
literal|0
condition|)
name|inact_pnum
operator|=
literal|3
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"cross_weave"
argument_list|)
operator|==
literal|0
condition|)
name|inact_pnum
operator|=
literal|4
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneStyle"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"flush_left"
argument_list|)
operator|==
literal|0
condition|)
name|p_style
operator|=
name|LEFT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"flush_right"
argument_list|)
operator|==
literal|0
condition|)
name|p_style
operator|=
name|RIGHT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"center"
argument_list|)
operator|==
literal|0
condition|)
name|p_style
operator|=
name|CENTER
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneFont"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|p_fnt_name
operator|=
name|def_val
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneForeground"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|p_frg_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|p_frg_color
operator|=
name|DEF_P_FRG_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|p_frg_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|p_frg_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneBorder"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|p_bdr_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|p_bdr_color
operator|=
name|DEF_P_BDR_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|p_bdr_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|p_bdr_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneBorderWidth"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|p_bdr_width
operator|=
name|atoi
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"PaneSpread"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|p_spread
operator|=
name|atof
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionStyle"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"flush_left"
argument_list|)
operator|==
literal|0
condition|)
name|s_style
operator|=
name|LEFT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"flush_right"
argument_list|)
operator|==
literal|0
condition|)
name|s_style
operator|=
name|RIGHT
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"center"
argument_list|)
operator|==
literal|0
condition|)
name|s_style
operator|=
name|CENTER
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionFont"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|s_fnt_name
operator|=
name|def_val
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionForeground"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|s_frg_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|s_frg_color
operator|=
name|DEF_S_FRG_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|s_frg_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|s_frg_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionBorder"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|def_val
argument_list|,
operator|&
name|color_def
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|color_def
argument_list|)
condition|)
name|s_bdr_color
operator|=
name|color_def
operator|.
name|pixel
expr_stmt|;
else|else
name|s_bdr_color
operator|=
name|DEF_S_BDR_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|s_bdr_color
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|s_bdr_color
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionBorderWidth"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|s_bdr_width
operator|=
name|atoi
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|def_env
argument_list|,
literal|"SelectionSpread"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|s_spread
operator|=
name|atof
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
comment|/*      * Create and store the inactive pattern pixmap.      */
switch|switch
condition|(
name|inact_pnum
condition|)
block|{
case|case
literal|0
case|:
name|inact_bitmap
operator|=
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|dimple1_bits
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|inact_bitmap
operator|=
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|dimple3_bits
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|inact_bitmap
operator|=
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|gray1_bits
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|inact_bitmap
operator|=
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|gray3_bits
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|inact_bitmap
operator|=
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|cross_weave_bits
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|inact_bitmap
operator|==
name|_X_FAILURE
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_STORE_BITMAP
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Generate the pixmaps from the background and forground colors.      */
name|tile_buf
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|p_bdr_color
expr_stmt|;
name|tile_buf
index|[
literal|1
index|]
operator|.
name|pixel
operator|=
name|s_bdr_color
expr_stmt|;
name|tile_buf
index|[
literal|2
index|]
operator|.
name|pixel
operator|=
name|p_frg_color
expr_stmt|;
name|tile_buf
index|[
literal|3
index|]
operator|.
name|pixel
operator|=
name|s_frg_color
expr_stmt|;
name|tile_buf
index|[
literal|4
index|]
operator|.
name|pixel
operator|=
name|bkgnd_color
expr_stmt|;
name|tile_count
operator|=
name|XMakeTiles
argument_list|(
name|tile_buf
argument_list|,
name|TILE_BUF_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|tile_count
operator|!=
name|TILE_BUF_SIZE
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_MAKE_TILES
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|p_bdr_pixmap
operator|=
name|tile_buf
index|[
literal|0
index|]
operator|.
name|pixmap
expr_stmt|;
name|s_bdr_pixmap
operator|=
name|tile_buf
index|[
literal|1
index|]
operator|.
name|pixmap
expr_stmt|;
name|p_frg_pixmap
operator|=
name|tile_buf
index|[
literal|2
index|]
operator|.
name|pixmap
expr_stmt|;
name|s_frg_pixmap
operator|=
name|tile_buf
index|[
literal|3
index|]
operator|.
name|pixmap
expr_stmt|;
name|bkgnd_pixmap
operator|=
name|tile_buf
index|[
literal|4
index|]
operator|.
name|pixmap
expr_stmt|;
comment|/*      * Generate the inactive pixmap.      */
name|inact_pixmap
operator|=
name|XMakePixmap
argument_list|(
name|inact_bitmap
argument_list|,
name|p_frg_color
argument_list|,
name|bkgnd_color
argument_list|)
expr_stmt|;
if|if
condition|(
name|inact_pixmap
operator|==
name|_X_FAILURE
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_MAKE_PIXMAP
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Free the inactive pattern bitmap since we no longer need it.      */
name|XFreeBitmap
argument_list|(
name|inact_bitmap
argument_list|)
expr_stmt|;
comment|/*      * Load the mouse cursor.      */
switch|switch
condition|(
name|menu_style
condition|)
block|{
case|case
name|LEFT
case|:
name|mouse_cursor
operator|=
name|XCreateCursor
argument_list|(
name|right_ptr_width
argument_list|,
name|right_ptr_height
argument_list|,
name|right_ptr_bits
argument_list|,
name|right_ptr_mask_bits
argument_list|,
name|right_ptr_x_hot
argument_list|,
name|right_ptr_y_hot
argument_list|,
name|mouse_color
argument_list|,
name|bkgnd_color
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
break|break;
case|case
name|RIGHT
case|:
name|mouse_cursor
operator|=
name|XCreateCursor
argument_list|(
name|left_ptr_width
argument_list|,
name|left_ptr_height
argument_list|,
name|left_ptr_bits
argument_list|,
name|left_ptr_mask_bits
argument_list|,
name|left_ptr_x_hot
argument_list|,
name|left_ptr_y_hot
argument_list|,
name|mouse_color
argument_list|,
name|bkgnd_color
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
break|break;
case|case
name|CENTER
case|:
name|mouse_cursor
operator|=
name|XCreateCursor
argument_list|(
name|center_ptr_width
argument_list|,
name|center_ptr_height
argument_list|,
name|center_ptr_bits
argument_list|,
name|center_ptr_mask_bits
argument_list|,
name|center_ptr_x_hot
argument_list|,
name|center_ptr_y_hot
argument_list|,
name|mouse_color
argument_list|,
name|bkgnd_color
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Error! Invalid style parameter. */
name|_XMErrorCode
operator|=
name|XME_STYLE_PARAM
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|mouse_cursor
operator|==
name|_X_FAILURE
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_CREATE_CURSOR
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Open the pane and selection fonts.      */
name|p_fnt_info
operator|=
name|XOpenFont
argument_list|(
name|p_fnt_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_fnt_info
operator|==
name|NULL
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_OPEN_FONT
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|s_fnt_info
operator|=
name|XOpenFont
argument_list|(
name|s_fnt_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|s_fnt_info
operator|==
name|NULL
condition|)
block|{
name|_XMErrorCode
operator|=
name|XME_OPEN_FONT
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*      * Calculate the fixed padding value in pixels for each font.      */
name|p_fnt_pad
operator|=
name|s_spread
operator|*
name|p_fnt_info
operator|->
name|height
expr_stmt|;
name|s_fnt_pad
operator|=
name|s_spread
operator|*
name|s_fnt_info
operator|->
name|height
expr_stmt|;
comment|/*      * Calculate fixed height and offset requirements.      */
name|flag_height
operator|=
name|p_fnt_info
operator|->
name|height
operator|+
operator|(
name|p_fnt_pad
operator|<<
literal|1
operator|)
expr_stmt|;
name|p_height
operator|=
literal|0
expr_stmt|;
name|p_y_off
operator|=
name|flag_height
operator|+
name|p_bdr_width
expr_stmt|;
name|p_x_off
operator|=
name|p_y_off
operator|*
name|p_spread
expr_stmt|;
name|s_height
operator|=
name|s_fnt_info
operator|->
name|height
operator|+
operator|(
name|s_fnt_pad
operator|<<
literal|1
operator|)
operator|+
operator|(
name|s_bdr_width
operator|<<
literal|1
operator|)
expr_stmt|;
name|s_y_off
operator|=
name|s_height
expr_stmt|;
name|s_x_off
operator|=
name|p_x_off
expr_stmt|;
comment|/*      * Set up the pane list header.      */
name|pane
operator|->
name|next
operator|=
name|pane
expr_stmt|;
name|pane
operator|->
name|prev
operator|=
name|pane
expr_stmt|;
name|pane
operator|->
name|type
operator|=
name|PL_HEADER
expr_stmt|;
name|pane
operator|->
name|serial
operator|=
operator|-
literal|1
expr_stmt|;
comment|/*      * Initialize the internal pane and selection creation queues.      */
name|_XMWinQueInit
argument_list|()
expr_stmt|;
comment|/*      * Construct the XMenu object.      */
comment|/* -------------------- Menu data -------------------- */
name|menu
operator|->
name|menu_style
operator|=
name|menu_style
expr_stmt|;
name|menu
operator|->
name|menu_mode
operator|=
name|menu_mode
expr_stmt|;
name|menu
operator|->
name|freeze
operator|=
name|freeze
expr_stmt|;
name|menu
operator|->
name|recompute
operator|=
literal|1
expr_stmt|;
name|menu
operator|->
name|parent
operator|=
name|parent
expr_stmt|;
name|menu
operator|->
name|height
operator|=
literal|0
expr_stmt|;
name|menu
operator|->
name|width
operator|=
literal|0
expr_stmt|;
name|menu
operator|->
name|mouse_cursor
operator|=
name|mouse_cursor
expr_stmt|;
name|menu
operator|->
name|assoc_tab
operator|=
name|assoc_tab
expr_stmt|;
name|menu
operator|->
name|p_list
operator|=
name|pane
expr_stmt|;
comment|/* -------------------- Pane window data -------------------- */
name|menu
operator|->
name|p_style
operator|=
name|p_style
expr_stmt|;
name|menu
operator|->
name|p_events
operator|=
name|DEF_P_EVENTS
expr_stmt|;
name|menu
operator|->
name|p_fnt_info
operator|=
name|p_fnt_info
expr_stmt|;
name|menu
operator|->
name|p_fnt_pad
operator|=
name|p_fnt_pad
expr_stmt|;
name|menu
operator|->
name|p_spread
operator|=
name|p_spread
expr_stmt|;
name|menu
operator|->
name|p_bdr_width
operator|=
name|p_bdr_width
expr_stmt|;
name|menu
operator|->
name|flag_height
operator|=
name|flag_height
expr_stmt|;
name|menu
operator|->
name|p_width
operator|=
literal|0
expr_stmt|;
name|menu
operator|->
name|p_height
operator|=
name|p_height
expr_stmt|;
name|menu
operator|->
name|p_x_off
operator|=
name|p_x_off
expr_stmt|;
name|menu
operator|->
name|p_y_off
operator|=
name|p_y_off
expr_stmt|;
name|menu
operator|->
name|p_count
operator|=
literal|0
expr_stmt|;
comment|/* -------------------- Selection window data -------------------- */
name|menu
operator|->
name|s_style
operator|=
name|s_style
expr_stmt|;
name|menu
operator|->
name|s_events
operator|=
name|DEF_S_EVENTS
expr_stmt|;
name|menu
operator|->
name|s_fnt_info
operator|=
name|s_fnt_info
expr_stmt|;
name|menu
operator|->
name|s_fnt_pad
operator|=
name|s_fnt_pad
expr_stmt|;
name|menu
operator|->
name|s_spread
operator|=
name|s_spread
expr_stmt|;
name|menu
operator|->
name|s_bdr_width
operator|=
name|s_bdr_width
expr_stmt|;
name|menu
operator|->
name|s_width
operator|=
literal|0
expr_stmt|;
name|menu
operator|->
name|s_height
operator|=
name|s_height
expr_stmt|;
name|menu
operator|->
name|s_x_off
operator|=
name|s_x_off
expr_stmt|;
name|menu
operator|->
name|s_y_off
operator|=
name|s_y_off
expr_stmt|;
name|menu
operator|->
name|s_count
operator|=
literal|0
expr_stmt|;
comment|/* -------------------- Color data -------------------- */
name|menu
operator|->
name|p_bdr_color
operator|=
name|p_bdr_color
expr_stmt|;
name|menu
operator|->
name|s_bdr_color
operator|=
name|s_bdr_color
expr_stmt|;
name|menu
operator|->
name|p_frg_color
operator|=
name|p_frg_color
expr_stmt|;
name|menu
operator|->
name|s_frg_color
operator|=
name|s_frg_color
expr_stmt|;
name|menu
operator|->
name|bkgnd_color
operator|=
name|bkgnd_color
expr_stmt|;
comment|/* -------------------- Pixmap data -------------------- */
name|menu
operator|->
name|p_bdr_pixmap
operator|=
name|p_bdr_pixmap
expr_stmt|;
name|menu
operator|->
name|s_bdr_pixmap
operator|=
name|s_bdr_pixmap
expr_stmt|;
name|menu
operator|->
name|p_frg_pixmap
operator|=
name|p_frg_pixmap
expr_stmt|;
name|menu
operator|->
name|s_frg_pixmap
operator|=
name|s_frg_pixmap
expr_stmt|;
name|menu
operator|->
name|bkgnd_pixmap
operator|=
name|bkgnd_pixmap
expr_stmt|;
name|menu
operator|->
name|inact_pixmap
operator|=
name|inact_pixmap
expr_stmt|;
comment|/*      * Return the completed XMenu.      */
name|_XMErrorCode
operator|=
name|XME_NO_ERROR
expr_stmt|;
return|return
operator|(
name|menu
operator|)
return|;
block|}
end_function

end_unit

