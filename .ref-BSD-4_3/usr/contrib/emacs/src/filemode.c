begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Examine the result of  stat  and make a string describing file modes.    Copyright (C) 1985 Richard M. Stallman.  This file is part of GNU Emacs.  GNU Emacs is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the GNU Emacs General Public License for full details.  Everyone is granted permission to copy, modify and redistribute GNU Emacs, but only under the conditions described in the GNU Emacs General Public License.   A copy of this license is supposed to have been given to you along with GNU Emacs so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_comment
comment|/* filemodestring - set file attribute data   *** WARNING!  FILE STRUCTURE DEPENDENT ***     Filemodestring converts the data in the st_mode field of file status block `s' to a 10 character attribute string, which it stores in the block that `a' points to. This attribute string is modelled after the string produced by the Berkeley ls.  As usual under Unix, the elements of the string are numbered from 0.  Their meanings are:     0	File type.  'd' for directory, 'c' for character 	special, 'b' for block special, 'm' for multiplex, '-' 	for any other file type     1	'r' if the owner may read, '-' otherwise.     2	'w' if the owner may write, '-' otherwise.     3	'x' if the owner may execute, 's' if the file is 	set-user-id, '-' otherwise.     4	'r' if group members may read, '-' otherwise.     5	'w' if group members may write, '-' otherwise.     6	'x' if group members may execute, 's' if the file is 	set-group-id, '-' otherwise.     7	'r' if any user may read, '-' otherwise.     8	'w' if any user may write, '-' otherwise.     9	'x' if any user may execute, 't' if the file is "sticky" 	(will be retained in swap space after execution), '-' 	otherwise.   */
end_comment

begin_define
define|#
directive|define
name|TEXT
value|char
end_define

begin_define
define|#
directive|define
name|VOID
value|void
end_define

begin_function_decl
specifier|static
name|TEXT
name|ftypelet
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|VOID
name|rwx
argument_list|()
decl_stmt|,
name|setst
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
name|VOID
name|filemodestring
parameter_list|(
name|s
parameter_list|,
name|a
parameter_list|)
name|struct
name|stat
modifier|*
name|s
decl_stmt|;
name|TEXT
modifier|*
name|a
decl_stmt|;
block|{
name|a
index|[
literal|0
index|]
operator|=
name|ftypelet
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|rwx
argument_list|(
operator|(
name|s
operator|->
name|st_mode
operator|&
literal|0700
operator|)
operator|<<
literal|0
argument_list|,
operator|&
operator|(
name|a
index|[
literal|1
index|]
operator|)
argument_list|)
expr_stmt|;
name|rwx
argument_list|(
operator|(
name|s
operator|->
name|st_mode
operator|&
literal|0070
operator|)
operator|<<
literal|3
argument_list|,
operator|&
operator|(
name|a
index|[
literal|4
index|]
operator|)
argument_list|)
expr_stmt|;
name|rwx
argument_list|(
operator|(
name|s
operator|->
name|st_mode
operator|&
literal|0007
operator|)
operator|<<
literal|6
argument_list|,
operator|&
operator|(
name|a
index|[
literal|7
index|]
operator|)
argument_list|)
expr_stmt|;
name|setst
argument_list|(
name|s
operator|->
name|st_mode
argument_list|,
name|a
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ftypelet - file type letter  *** WARNING!  FILE STRUCTURE DEPENDENT ***     Ftypelet accepts a file status block and returns a character code describing the type of the file.  'd' is returned for directories, 'b' for block special files, 'c' for character special files, 'm' for multiplexor files, and '-' for regular files.   */
end_comment

begin_function
specifier|static
name|TEXT
name|ftypelet
parameter_list|(
name|s
parameter_list|)
name|struct
name|stat
modifier|*
name|s
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|s
operator|->
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|==
name|S_IFDIR
condition|)
return|return
literal|'d'
return|;
elseif|else
if|if
condition|(
operator|(
name|s
operator|->
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|==
name|S_IFCHR
condition|)
return|return
literal|'c'
return|;
elseif|else
if|if
condition|(
operator|(
name|s
operator|->
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|==
name|S_IFBLK
condition|)
return|return
literal|'b'
return|;
comment|/* These do not seem to exist */
comment|/*   else if ((s->st_mode&S_IFMT)==S_IFMPC || 	    (s->st_mode&S_IFMT)==S_IFMPB)       return 'm';  */
else|else
return|return
literal|'-'
return|;
block|}
end_function

begin_comment
comment|/* rwx - look at read, write, and execute bits and set character flags accordingly  *** WARNING!  FILE STRUCTURE DEPENDENT ***   */
end_comment

begin_function
specifier|static
name|VOID
name|rwx
parameter_list|(
name|bits
parameter_list|,
name|chars
parameter_list|)
name|unsigned
name|short
name|bits
decl_stmt|;
name|TEXT
name|chars
index|[]
decl_stmt|;
block|{
name|chars
index|[
literal|0
index|]
operator|=
name|chars
index|[
literal|1
index|]
operator|=
name|chars
index|[
literal|2
index|]
operator|=
literal|'-'
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|S_IREAD
condition|)
name|chars
index|[
literal|0
index|]
operator|=
literal|'r'
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|S_IWRITE
condition|)
name|chars
index|[
literal|1
index|]
operator|=
literal|'w'
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|S_IEXEC
condition|)
name|chars
index|[
literal|2
index|]
operator|=
literal|'x'
expr_stmt|;
block|}
end_function

begin_comment
comment|/* setst - set s& t flags in a file attributes string */
end_comment

begin_comment
comment|/* *** WARNING!  FILE STRUCTURE DEPENDENT *** */
end_comment

begin_function
specifier|static
name|VOID
name|setst
parameter_list|(
name|bits
parameter_list|,
name|chars
parameter_list|)
name|unsigned
name|short
name|bits
decl_stmt|;
name|TEXT
name|chars
index|[]
decl_stmt|;
block|{
if|if
condition|(
name|bits
operator|&
name|S_ISUID
condition|)
name|chars
index|[
literal|3
index|]
operator|=
literal|'s'
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|S_ISGID
condition|)
name|chars
index|[
literal|6
index|]
operator|=
literal|'s'
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|S_ISVTX
condition|)
name|chars
index|[
literal|9
index|]
operator|=
literal|'t'
expr_stmt|;
block|}
end_function

end_unit

