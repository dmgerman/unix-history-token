begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Functions for the X window system.    Copyright (C) 1985 Free Software Foundation.  This file is part of GNU Emacs.  GNU Emacs is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the GNU Emacs General Public License for full details.  Everyone is granted permission to copy, modify and redistribute GNU Emacs, but only under the conditions described in the GNU Emacs General Public License.   A copy of this license is supposed to have been given to you along with GNU Emacs so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* Written by Yakim Martillo; rearranged by Richard Stallman.  */
end_comment

begin_comment
comment|/* Color added by Robert Krawitz*/
end_comment

begin_comment
comment|/*#include<stdio.h>*/
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"lisp.h"
end_include

begin_include
include|#
directive|include
file|"window.h"
end_include

begin_include
include|#
directive|include
file|"xterm.h"
end_include

begin_include
include|#
directive|include
file|"dispextern.h"
end_include

begin_include
include|#
directive|include
file|"termchar.h"
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|"sink.h"
end_include

begin_include
include|#
directive|include
file|"sinkmask.h"
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<setjmp.h>
end_include

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|x
parameter_list|)
value|((x< 0) ? ((x)) : (x))
end_define

begin_define
define|#
directive|define
name|sgn
parameter_list|(
name|x
parameter_list|)
value|((x< 0) ? (-1) : (1))
end_define

begin_define
define|#
directive|define
name|CROSS_WIDTH
value|16
end_define

begin_define
define|#
directive|define
name|CROSS_HEIGHT
value|16
end_define

begin_decl_stmt
specifier|static
name|short
name|cross_bits
index|[]
init|=
block|{
literal|0x0000
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x7ffe
block|,
literal|0x7ffe
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0180
block|,
literal|0x0000
block|,   }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|short
name|gray_bits
index|[]
init|=
block|{
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|,
literal|0xaaaa
block|,
literal|0x5555
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|CROSS_MASK_WIDTH
value|16
end_define

begin_define
define|#
directive|define
name|CROSS_MASK_HEIGHT
value|16
end_define

begin_decl_stmt
specifier|static
name|short
name|cross_mask_bits
index|[]
init|=
block|{
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,
literal|0x03c0
block|,   }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|XREPBUFFER
name|Xxrepbuffer
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Non-nil if Emacs is running with an X window for display.    Nil if Emacs is run on an ordinary terminal.  */
end_comment

begin_decl_stmt
name|Lisp_Object
name|Vxterm
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Lisp_Object
name|Vx_mouse_pos
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|Lisp_Vector
modifier|*
name|MouseMap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|fore_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|back_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|brdr_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|mous_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|curs_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|fore
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|back
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|brdr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|mous
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|curs
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Nonzero if x-set-window-edges has been called    or x-rubber-band has been called.    If it is zero when x-pop-up-window is called,    x-rubber-band is called at that point.  */
end_comment

begin_decl_stmt
name|int
name|x_edges_specified
decl_stmt|;
end_decl_stmt

begin_macro
name|check_xterm
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|NULL
argument_list|(
name|Vxterm
argument_list|)
condition|)
name|error
argument_list|(
literal|"Terminal does not understand X protocol."
argument_list|)
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_macro
name|DEFUN
argument_list|(
literal|"x-pop-up-window"
argument_list|,
argument|Fx_pop_up_window
argument_list|,
argument|Sx_pop_up_window
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Make the X window appear on the screen."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|check_xterm
argument_list|()
block|;
name|XPopUpWindow
argument_list|()
block|;
return|return
name|Qnil
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-bell"
argument_list|,
argument|Fx_set_bell
argument_list|,
argument|Sx_set_bell
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"P"
argument_list|,
literal|"For X window system, set audible vs visible bell.\n\ With non-nil argument (prefix arg), use visible bell; otherwise, audible bell."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|check_xterm
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|NULL
argument_list|(
name|arg
argument_list|)
condition|)
name|XSetFlash
argument_list|()
expr_stmt|;
else|else
name|XSetFeep
argument_list|()
expr_stmt|;
return|return
name|arg
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-flip-color"
argument_list|,
argument|Fx_flip_color
argument_list|,
argument|Sx_flip_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Toggle the background and foreground colors (currently only black \n\ and white -- by default background is white -- Only effective at init"
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|check_xterm
argument_list|()
block|;
name|XFlipColor
argument_list|()
block|;
return|return
name|Qt
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-foreground-color"
argument_list|,
argument|Fx_set_foreground_color
argument_list|,
argument|Sx_set_foreground_color
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSet foregroud color:  "
argument_list|,
literal|"Set foreground (text) color to COLOR."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
specifier|extern
name|int
name|PendingExposure
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
specifier|extern
name|FontInfo
modifier|*
name|fontinfo
decl_stmt|;
name|char
modifier|*
name|save_color
decl_stmt|;
name|save_color
operator|=
name|fore_color
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|fore_color
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|fore_color
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|fore_color
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
name|XParseColor
argument_list|(
name|fore_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
name|fore
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|fore_color
operator|&&
name|strcmp
argument_list|(
name|fore_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fore
operator|=
name|BlackPixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|fore_color
operator|&&
name|strcmp
argument_list|(
name|fore_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fore
operator|=
name|WhitePixel
expr_stmt|;
block|}
else|else
block|{
name|fore_color
operator|=
name|save_color
expr_stmt|;
block|}
comment|/*    XPixFill (XXwindow, 0, 0, screen_width * fontinfo->width, 	      screen_height * fontinfo->height, back, ClipModeClipped, 	      GXcopy, AllPlanes);*/
name|Fredraw_display
argument_list|()
expr_stmt|;
comment|/*    dumprectangle(0, 0, screen_height * fontinfo->height, 		  screen_width * fontinfo -> width);*/
comment|/*    PendingExposure = 1;       xfixscreen ();*/
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-background-color"
argument_list|,
argument|Fx_set_background_color
argument_list|,
argument|Sx_set_background_color
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSet background color:  "
argument_list|,
literal|"Set background color to COLOR."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
specifier|extern
name|int
name|PendingExposure
decl_stmt|;
name|Pixmap
name|temp
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
name|char
modifier|*
name|save_color
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|back_color
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|back_color
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
if|if
condition|(
name|back_color
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
name|XParseColor
argument_list|(
name|back_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
name|back
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|back_color
operator|&&
name|strcmp
argument_list|(
name|back_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|back
operator|=
name|WhitePixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|back_color
operator|&&
name|strcmp
argument_list|(
name|back_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|back
operator|=
name|BlackPixel
expr_stmt|;
block|}
else|else
block|{
name|back_color
operator|=
name|save_color
expr_stmt|;
block|}
name|temp
operator|=
name|XMakeTile
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|XChangeBackground
argument_list|(
name|XXwindow
argument_list|,
name|temp
argument_list|)
expr_stmt|;
comment|/*    XPixFill (XXwindow, 0, 0, screen_width * fontinfo->width, 	      screen_height * fontinfo->height, back, ClipModeClipped, 	      GXcopy, AllPlanes);*/
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
name|Fredraw_display
argument_list|()
expr_stmt|;
comment|/*    dumprectangle(0, 0, screen_height * fontinfo->height, 		  screen_width * fontinfo -> width);*/
comment|/*    PendingExposure = 1;       xfixscreen ();*/
name|XFlush
argument_list|()
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp
argument_list|)
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-border-color"
argument_list|,
argument|Fx_set_border_color
argument_list|,
argument|Sx_set_border_color
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSet border color:  "
argument_list|,
literal|"Set border color to COLOR."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
name|Pixmap
name|temp
decl_stmt|;
specifier|extern
name|int
name|XXborder
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|brdr_color
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|brdr_color
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
if|if
condition|(
name|brdr_color
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
name|XParseColor
argument_list|(
name|brdr_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
name|temp
operator|=
name|XMakeTile
argument_list|(
name|cdef
operator|.
name|pixel
argument_list|)
expr_stmt|;
name|brdr
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|brdr_color
operator|&&
name|strcmp
argument_list|(
name|brdr_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|temp
operator|=
name|BlackPixmap
expr_stmt|;
name|brdr
operator|=
name|BlackPixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|brdr_color
operator|&&
name|strcmp
argument_list|(
name|brdr_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|temp
operator|=
name|WhitePixmap
expr_stmt|;
name|brdr
operator|=
name|WhitePixel
expr_stmt|;
block|}
else|else
block|{
name|temp
operator|=
name|XMakePixmap
argument_list|(
operator|(
name|Bitmap
operator|)
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|gray_bits
argument_list|)
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|)
expr_stmt|;
name|brdr
operator|=
name|BlackPixel
expr_stmt|;
name|brdr_color
operator|=
literal|"gray"
expr_stmt|;
block|}
if|if
condition|(
name|XXborder
condition|)
name|XChangeBorder
argument_list|(
name|XXwindow
argument_list|,
name|temp
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp
argument_list|)
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-cursor-color"
argument_list|,
argument|Fx_set_cursor_color
argument_list|,
argument|Sx_set_cursor_color
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSet text cursor color:  "
argument_list|,
literal|"Set text cursor color to COLOR."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
name|char
modifier|*
name|save_color
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|curs_color
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|curs_color
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|curs_color
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
name|XParseColor
argument_list|(
name|curs_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
name|curs
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curs_color
operator|&&
name|strcmp
argument_list|(
name|curs_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|curs
operator|=
name|BlackPixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curs_color
operator|&&
name|strcmp
argument_list|(
name|curs_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|curs
operator|=
name|WhitePixel
expr_stmt|;
block|}
else|else
block|{
name|curs_color
operator|=
name|save_color
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
name|CursorToggle
argument_list|()
expr_stmt|;
name|CursorToggle
argument_list|()
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-mouse-color"
argument_list|,
argument|Fx_set_mouse_color
argument_list|,
argument|Sx_set_mouse_color
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSet mouse cursor color:  "
argument_list|,
literal|"Set mouse cursor color to COLOR."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|extern
name|Cursor
name|EmacsCursor
decl_stmt|;
specifier|extern
name|char
name|MouseCursor
index|[]
decl_stmt|,
name|MouseMask
index|[]
decl_stmt|;
name|Cursor
name|temp
decl_stmt|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
name|Color
name|cdef
decl_stmt|;
name|char
modifier|*
name|save_color
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|mous_color
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|mous_color
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|mous_color
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
name|XParseColor
argument_list|(
name|mous_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
name|mous
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mous_color
operator|&&
name|strcmp
argument_list|(
name|mous_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mous
operator|=
name|BlackPixel
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mous_color
operator|&&
name|strcmp
argument_list|(
name|mous_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|mous
operator|=
name|WhitePixel
expr_stmt|;
block|}
else|else
block|{
name|mous_color
operator|=
name|save_color
expr_stmt|;
block|}
name|temp
operator|=
name|XCreateCursor
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|MouseCursor
argument_list|,
name|MouseMask
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|mous
argument_list|,
name|back
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|XXwindow
argument_list|,
name|temp
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|EmacsCursor
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|&
name|temp
argument_list|,
operator|&
name|EmacsCursor
argument_list|,
sizeof|sizeof
argument_list|(
name|Cursor
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-color-p"
argument_list|,
argument|Fx_color_p
argument_list|,
argument|Sx_color_p
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns t if the display is a color X terminal."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|check_xterm
argument_list|()
block|;
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
return|return
name|Qt
return|;
else|else
return|return
name|Qnil
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-foreground-color"
argument_list|,
argument|Fx_get_foreground_color
argument_list|,
argument|Sx_get_foreground_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns the color of the foreground, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|Lisp_Object
name|string
block|;
name|string
operator|=
name|make_string
argument_list|(
name|fore_color
argument_list|,
name|strlen
argument_list|(
name|fore_color
argument_list|)
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-background-color"
argument_list|,
argument|Fx_get_background_color
argument_list|,
argument|Sx_get_background_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns the color of the background, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|Lisp_Object
name|string
block|;
name|string
operator|=
name|make_string
argument_list|(
name|back_color
argument_list|,
name|strlen
argument_list|(
name|back_color
argument_list|)
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-border-color"
argument_list|,
argument|Fx_get_border_color
argument_list|,
argument|Sx_get_border_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns the color of the border, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|Lisp_Object
name|string
block|;
name|string
operator|=
name|make_string
argument_list|(
name|brdr_color
argument_list|,
name|strlen
argument_list|(
name|brdr_color
argument_list|)
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-cursor-color"
argument_list|,
argument|Fx_get_cursor_color
argument_list|,
argument|Sx_get_cursor_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns the color of the cursor, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|Lisp_Object
name|string
block|;
name|string
operator|=
name|make_string
argument_list|(
name|curs_color
argument_list|,
name|strlen
argument_list|(
name|curs_color
argument_list|)
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-mouse-color"
argument_list|,
argument|Fx_get_mouse_color
argument_list|,
argument|Sx_get_mouse_color
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|"Returns the color of the mouse cursor, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|Lisp_Object
name|string
block|;
name|string
operator|=
name|make_string
argument_list|(
name|mous_color
argument_list|,
name|strlen
argument_list|(
name|mous_color
argument_list|)
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-default"
argument_list|,
argument|Fx_get_default
argument_list|,
argument|Sx_get_default
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sGet X default name:  "
argument_list|,
literal|"Get X default ATTRIBUTE from the system.  Returns nil if\n\ attribute does not exist."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|char
modifier|*
name|default_name
decl_stmt|,
modifier|*
name|value
decl_stmt|;
name|Lisp_Object
name|return_string
decl_stmt|;
specifier|extern
name|char
modifier|*
name|malloc
argument_list|()
decl_stmt|,
name|strcpy
argument_list|()
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|default_name
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|default_name
operator|==
literal|0
condition|)
block|{
return|return
name|Qnil
return|;
block|}
else|else
block|{
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|default_name
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|value
operator|=
name|XGetDefault
argument_list|(
literal|"emacs"
argument_list|,
name|default_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
name|value
operator|=
name|XGetDefault
argument_list|(
literal|""
argument_list|,
name|default_name
argument_list|)
expr_stmt|;
return|return
name|make_string
argument_list|(
name|value
argument_list|,
name|value
condition|?
name|strlen
argument_list|(
name|value
argument_list|)
else|:
literal|0
argument_list|)
return|;
block|}
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-icon"
argument_list|,
argument|Fx_set_icon
argument_list|,
argument|Sx_set_icon
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"P"
argument_list|,
literal|"Set type of icon used by X for Emacs's window.\n\ ARG non-nil means use kitchen-sink icon;\n\ nil means use generic window manager icon."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|check_xterm
argument_list|()
expr_stmt|;
if|if
condition|(
name|NULL
argument_list|(
name|arg
argument_list|)
condition|)
name|XTextIcon
argument_list|()
expr_stmt|;
else|else
name|XBitmapIcon
argument_list|()
expr_stmt|;
return|return
name|arg
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-font"
argument_list|,
argument|Fx_set_font
argument_list|,
argument|Sx_set_font
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sFont Name: "
argument_list|,
literal|"At initialization sets the font to be used for the X window."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|newfontname
decl_stmt|;
specifier|extern
name|char
modifier|*
name|XXcurrentfont
decl_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|newfontname
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|newfontname
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XNewFont
argument_list|(
name|newfontname
argument_list|)
condition|)
block|{
name|free
argument_list|(
name|XXcurrentfont
argument_list|)
expr_stmt|;
name|XXcurrentfont
operator|=
name|newfontname
expr_stmt|;
return|return
name|Qt
return|;
block|}
else|else
block|{
name|error
argument_list|(
literal|"Font %s is not defined"
argument_list|,
name|newfontname
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|newfontname
argument_list|)
expr_stmt|;
block|}
return|return
name|Qnil
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-window-edges"
argument_list|,
argument|Fx_set_window_edges
argument_list|,
argument|Sx_set_window_edges
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|,
literal|"nNumber of Columns: \nnNumber of Rows: \nnX Offset in Pixels: \n\ nY Offset in Pixels: "
argument_list|,
literal|"Sets X window size/position: size COLS by ROWS, positions XOFF and YOFF.\n\ To get \"minus zero\" for XOFF or YOFF, supply -1."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|cols
operator|,
name|rows
operator|,
name|xoffset
operator|,
name|yoffset
operator|)
name|Lisp_Object
name|rows
operator|,
name|cols
operator|,
name|xoffset
operator|,
name|yoffset
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|CHECK_NUMBER
argument_list|(
name|rows
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|CHECK_NUMBER
argument_list|(
name|cols
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|CHECK_NUMBER
argument_list|(
name|xoffset
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|CHECK_NUMBER
argument_list|(
name|yoffset
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|x_edges_specified
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|XINT
argument_list|(
name|rows
argument_list|)
operator|!=
name|screen_width
operator|||
name|XINT
argument_list|(
name|cols
argument_list|)
operator|!=
name|screen_height
condition|)
block|{
name|XSetWindowSize
argument_list|(
name|XINT
argument_list|(
name|rows
argument_list|)
argument_list|,
name|XINT
argument_list|(
name|cols
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|XSetOffset
argument_list|(
name|XINT
argument_list|(
name|xoffset
argument_list|)
argument_list|,
name|XINT
argument_list|(
name|yoffset
argument_list|)
argument_list|)
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_expr_stmt
name|DEFUN
argument_list|(
literal|"coordinates-in-window-p"
argument_list|,
name|Fcoordinates_in_window_p
argument_list|,
name|Scoordinates_in_window_p
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|"xSpecify coordinate pair: \nXExpression which evals to window: "
argument_list|,
literal|"Return non-nil if POSITIONS (a list, (SCREEN-X SCREEN-Y)) is in WINDOW.\n\ Returned value is list of positions expressed\n\ relative to window upper left corner."
argument_list|)
argument_list|(
name|coordinate
argument_list|,
name|window
argument_list|)
specifier|register
name|Lisp_Object
name|coordinate
operator|,
name|window
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|Lisp_Object
name|xcoord
decl_stmt|,
name|ycoord
decl_stmt|;
if|if
condition|(
operator|!
name|LISTP
argument_list|(
name|coordinate
argument_list|)
condition|)
name|wrong_type_argument
argument_list|(
name|Qlistp
argument_list|,
name|coordinate
argument_list|)
expr_stmt|;
name|CHECK_WINDOW
argument_list|(
name|window
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|xcoord
operator|=
name|Fcar
argument_list|(
name|coordinate
argument_list|)
expr_stmt|;
name|ycoord
operator|=
name|Fcar
argument_list|(
name|Fcdr
argument_list|(
name|coordinate
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_NUMBER
argument_list|(
name|xcoord
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|CHECK_NUMBER
argument_list|(
name|ycoord
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|XINT
argument_list|(
name|xcoord
argument_list|)
operator|<
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|left
argument_list|)
operator|)
operator|||
operator|(
name|XINT
argument_list|(
name|xcoord
argument_list|)
operator|>=
operator|(
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|left
argument_list|)
operator|+
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|width
argument_list|)
operator|)
operator|)
condition|)
block|{
return|return
name|Qnil
return|;
block|}
name|XFASTINT
argument_list|(
name|xcoord
argument_list|)
operator|-=
name|XFASTINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|XINT
argument_list|(
name|ycoord
argument_list|)
operator|==
operator|(
name|screen_height
operator|-
literal|1
operator|)
condition|)
return|return
name|Qnil
return|;
if|if
condition|(
operator|(
name|XINT
argument_list|(
name|ycoord
argument_list|)
operator|<
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|top
argument_list|)
operator|)
operator|||
operator|(
name|XINT
argument_list|(
name|ycoord
argument_list|)
operator|>=
operator|(
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|top
argument_list|)
operator|+
name|XINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|height
argument_list|)
operator|)
operator|-
literal|1
operator|)
condition|)
block|{
return|return
name|Qnil
return|;
block|}
name|XFASTINT
argument_list|(
name|ycoord
argument_list|)
operator|-=
name|XFASTINT
argument_list|(
name|XWINDOW
argument_list|(
name|window
argument_list|)
operator|->
name|top
argument_list|)
expr_stmt|;
return|return
operator|(
name|Fcons
argument_list|(
name|xcoord
argument_list|,
name|Fcons
argument_list|(
name|ycoord
argument_list|,
name|Qnil
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-mouse-events"
argument_list|,
argument|Fx_mouse_events
argument_list|,
argument|Sx_mouse_events
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Return number of pending mouse events from X window system."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
specifier|register
name|Lisp_Object
name|tem
block|;
specifier|register
name|int
name|windex
block|,
name|rindex
block|,
name|mindex
block|;
name|check_xterm
argument_list|()
block|;
name|windex
operator|=
name|Xxrepbuffer
operator|.
name|windex
block|;
name|rindex
operator|=
name|Xxrepbuffer
operator|.
name|rindex
block|;
name|mindex
operator|=
name|Xxrepbuffer
operator|.
name|mindex
block|;
if|if
condition|(
name|windex
operator|>=
name|rindex
condition|)
block|{
name|XSET
argument_list|(
name|tem
argument_list|,
name|Lisp_Int
argument_list|,
name|windex
operator|-
name|rindex
argument_list|)
expr_stmt|;
block|}
end_expr_stmt

begin_else
else|else
block|{
name|XSET
argument_list|(
name|tem
argument_list|,
name|Lisp_Int
argument_list|,
name|mindex
operator|+
literal|1
operator|-
operator|(
name|rindex
operator|-
name|windex
operator|)
argument_list|)
expr_stmt|;
block|}
end_else

begin_return
return|return
name|tem
return|;
end_return

begin_expr_stmt
unit|}  DEFUN
operator|(
literal|"x-proc-mouse-event"
operator|,
name|Fx_proc_mouse_event
operator|,
name|Sx_proc_mouse_event
operator|,
literal|0
operator|,
literal|0
operator|,
literal|0
operator|,
literal|"Pulls a mouse event out of the mouse event buffer and dispatches\n\ the appropriate function to act upon this event."
operator|)
operator|(
operator|)
block|{
name|XButtonEvent
name|xrep
block|;
specifier|extern
name|FontInfo
operator|*
name|fontinfo
block|;
specifier|register
name|Lisp_Object
name|Mouse_Cmd
block|;
specifier|register
name|char
name|com_letter
block|;
specifier|register
name|char
name|key_mask
block|;
specifier|register
name|Lisp_Object
name|tempx
block|;
specifier|register
name|Lisp_Object
name|tempy
block|;
specifier|extern
name|Lisp_Object
name|get_keyelt
argument_list|()
block|;
name|check_xterm
argument_list|()
block|;
if|if
condition|(
name|unloadxrepbuffer
argument_list|(
operator|&
name|xrep
argument_list|,
operator|&
name|Xxrepbuffer
argument_list|)
operator|==
literal|0
condition|)
block|{
name|com_letter
operator|=
name|xrep
operator|.
name|detail
operator|&
literal|3
expr_stmt|;
name|key_mask
operator|=
operator|(
name|xrep
operator|.
name|detail
operator|>>
literal|8
operator|)
operator|&
literal|0xf0
expr_stmt|;
name|com_letter
operator||=
name|key_mask
expr_stmt|;
name|XSET
argument_list|(
name|tempx
argument_list|,
name|Lisp_Int
argument_list|,
name|xrep
operator|.
name|x
operator|/
name|fontinfo
operator|->
name|width
argument_list|)
expr_stmt|;
name|XSET
argument_list|(
name|tempy
argument_list|,
name|Lisp_Int
argument_list|,
name|xrep
operator|.
name|y
operator|/
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
name|Vx_mouse_pos
operator|=
name|Fcons
argument_list|(
name|tempx
argument_list|,
name|Fcons
argument_list|(
name|tempy
argument_list|,
name|Qnil
argument_list|)
argument_list|)
expr_stmt|;
name|Mouse_Cmd
operator|=
name|get_keyelt
argument_list|(
name|access_keymap
argument_list|(
name|MouseMap
argument_list|,
name|com_letter
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
argument_list|(
name|Mouse_Cmd
argument_list|)
condition|)
block|{
name|Ding
argument_list|()
expr_stmt|;
name|Vx_mouse_pos
operator|=
name|Qnil
expr_stmt|;
block|}
end_expr_stmt

begin_else
else|else
block|{
return|return
operator|(
name|call1
argument_list|(
name|Mouse_Cmd
argument_list|,
name|Vx_mouse_pos
argument_list|)
operator|)
return|;
block|}
end_else

begin_expr_stmt
unit|}   return
name|Qnil
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|}  DEFUN
operator|(
literal|"x-get-mouse-event"
operator|,
name|Fx_get_mouse_event
operator|,
name|Sx_get_mouse_event
operator|,
literal|1
operator|,
literal|1
operator|,
literal|0
operator|,
literal|"Get next mouse event out of mouse event buffer (com-letter (x y)).\n\ ARG non-nil means return nil immediately if no pending event;\n\ otherwise, wait for an event."
operator|)
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|XButtonEvent
name|xrep
decl_stmt|;
specifier|extern
name|FontInfo
modifier|*
name|fontinfo
decl_stmt|;
specifier|register
name|Lisp_Object
name|Mouse_Cmd
decl_stmt|;
specifier|register
name|char
name|com_letter
decl_stmt|;
specifier|register
name|char
name|key_mask
decl_stmt|;
specifier|register
name|Lisp_Object
name|tempx
decl_stmt|;
specifier|register
name|Lisp_Object
name|tempy
decl_stmt|;
specifier|extern
name|Lisp_Object
name|get_keyelt
parameter_list|()
function_decl|;
name|check_xterm
argument_list|()
expr_stmt|;
if|if
condition|(
name|NULL
argument_list|(
name|arg
argument_list|)
condition|)
while|while
condition|(
name|Xxrepbuffer
operator|.
name|windex
operator|==
name|Xxrepbuffer
operator|.
name|rindex
condition|)
empty_stmt|;
comment|/*** ??? Surely you don't mean to busy wait??? */
if|if
condition|(
name|unloadxrepbuffer
argument_list|(
operator|&
name|xrep
argument_list|,
operator|&
name|Xxrepbuffer
argument_list|)
operator|==
literal|0
condition|)
block|{
name|com_letter
operator|=
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|xrep
operator|.
name|detail
operator|)
expr_stmt|;
name|com_letter
operator|&=
literal|3
expr_stmt|;
name|key_mask
operator|=
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|xrep
operator|.
name|detail
operator|+
literal|1
operator|)
expr_stmt|;
name|key_mask
operator|&=
literal|0xf0
expr_stmt|;
name|com_letter
operator||=
name|key_mask
expr_stmt|;
name|XSET
argument_list|(
name|tempx
argument_list|,
name|Lisp_Int
argument_list|,
name|xrep
operator|.
name|x
operator|/
name|fontinfo
operator|->
name|width
argument_list|)
expr_stmt|;
name|XSET
argument_list|(
name|tempy
argument_list|,
name|Lisp_Int
argument_list|,
name|xrep
operator|.
name|y
operator|/
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
name|Vx_mouse_pos
operator|=
name|Fcons
argument_list|(
name|tempx
argument_list|,
name|Fcons
argument_list|(
name|tempy
argument_list|,
name|Qnil
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|Fcons
argument_list|(
name|com_letter
argument_list|,
name|Fcons
argument_list|(
name|Vx_mouse_pos
argument_list|,
name|Qnil
argument_list|)
argument_list|)
operator|)
return|;
block|}
return|return
name|Qnil
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-keyboard-enable"
argument_list|,
argument|Fx_set_keyboard_enable
argument_list|,
argument|Sx_set_keyboard_enable
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"In the X window system, set the flag that permite keyboard input.\n\ Permit input if ARG is non-nil."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|ExposeWindow
operator||
name|ButtonPressed
operator||
name|ExposeRegion
operator||
name|ExposeCopy
operator||
operator|(
operator|!
name|NULL
argument_list|(
name|arg
argument_list|)
condition|?
name|KeyPressed
else|:
literal|0
operator|)
argument_list|)
expr_stmt|;
return|return
name|arg
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-set-mouse-inform-flag"
argument_list|,
argument|Fx_set_mouse_inform_flag
argument_list|,
argument|Sx_set_mouse_inform_flag
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"Set inform-of-mouse-events flag in X window system on if ARG is non-nil."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|extern
name|int
name|informflag
decl_stmt|;
name|informflag
operator|=
operator|!
name|NULL
argument_list|(
name|arg
argument_list|)
expr_stmt|;
return|return
name|arg
return|;
block|}
end_block

begin_expr_stmt
name|DEFUN
argument_list|(
literal|"x-store-cut-buffer"
argument_list|,
name|Fx_store_cut_buffer
argument_list|,
name|Sx_store_cut_buffer
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sSend string to X:"
argument_list|,
literal|"Store contents of STRING into the cut buffer of the X window system."
argument_list|)
argument_list|(
name|string
argument_list|)
specifier|register
name|Lisp_Object
name|string
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|CHECK_STRING
argument_list|(
name|string
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|XStoreBytes
argument_list|(
name|XSTRING
argument_list|(
name|string
argument_list|)
operator|->
name|data
argument_list|,
name|XSTRING
argument_list|(
name|string
argument_list|)
operator|->
name|size
argument_list|)
expr_stmt|;
return|return
name|Qnil
return|;
block|}
end_block

begin_macro
name|DEFUN
argument_list|(
literal|"x-get-cut-buffer"
argument_list|,
argument|Fx_get_cut_buffer
argument_list|,
argument|Sx_get_cut_buffer
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Return contents of cut buffer of the X window system, as a string."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|int
name|len
block|;
specifier|register
name|Lisp_Object
name|string
block|;
specifier|register
name|int
argument_list|(
operator|*
name|func
argument_list|)
argument_list|()
block|;
specifier|register
name|char
operator|*
name|d
block|;
name|func
operator|=
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
operator|(
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
operator|)
block|;
name|d
operator|=
name|XFetchBytes
argument_list|(
operator|&
name|len
argument_list|)
block|;
name|string
operator|=
name|make_string
argument_list|(
name|d
argument_list|,
name|len
argument_list|)
block|;
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
block|;
return|return
name|string
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-rubber-band"
argument_list|,
argument|Fx_rubber_band
argument_list|,
argument|Sx_rubber_band
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Ask user to specify Emacs window position and size with mouse.\n\ This is done automatically if the data has not been specified\n\ when Emacs needs the window to be displayed."
argument_list|)
end_macro

begin_expr_stmt
operator|(
operator|)
block|{
name|int
name|x
block|,
name|y
block|,
name|width
block|,
name|height
block|;
specifier|extern
name|int
name|XXborder
block|;
specifier|extern
name|int
name|PendingExposure
block|;
specifier|extern
name|char
operator|*
name|default_window
block|;
specifier|register
name|int
argument_list|(
operator|*
name|handle
argument_list|)
argument_list|()
block|;
name|x_edges_specified
operator|=
literal|1
block|;
name|check_xterm
argument_list|()
block|;
name|handle
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
block|;
name|window_fetch
argument_list|(
name|fontinfo
operator|->
name|id
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
literal|""
argument_list|,
name|default_window
argument_list|,
name|XXborder
argument_list|,
literal|"Gnuemacs"
argument_list|)
block|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|handle
argument_list|)
block|;
name|XSetWindowSize
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
block|;
name|XSetOffset
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
block|;
name|XFlush
argument_list|()
block|;
return|return
name|Qnil
return|;
block|}
end_expr_stmt

begin_macro
name|DEFUN
argument_list|(
literal|"x-create-x-window"
argument_list|,
argument|Fx_create_x_window
argument_list|,
argument|Sx_create_x_window
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"Create window for gnuemacs from a valid GEOMETRY specification."
argument_list|)
end_macro

begin_expr_stmt
operator|(
name|arg
operator|)
name|Lisp_Object
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|;
specifier|extern
name|int
name|XXborder
decl_stmt|;
specifier|extern
name|int
name|PendingExposure
decl_stmt|;
name|char
modifier|*
name|geometry
decl_stmt|;
specifier|register
name|int
function_decl|(
modifier|*
name|handle
function_decl|)
parameter_list|()
function_decl|;
name|x_edges_specified
operator|=
literal|1
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
name|CHECK_STRING
argument_list|(
name|arg
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|geometry
operator|=
operator|(
name|char
operator|*
operator|)
name|xmalloc
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|data
argument_list|,
name|geometry
argument_list|,
name|XSTRING
argument_list|(
name|arg
argument_list|)
operator|->
name|size
operator|+
literal|1
argument_list|)
expr_stmt|;
name|handle
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|window_fetch
argument_list|(
name|fontinfo
operator|->
name|id
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
name|geometry
argument_list|,
name|default_window
argument_list|,
name|XXborder
argument_list|,
literal|"Gnuemacs"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|handle
argument_list|)
expr_stmt|;
name|XSetWindowSize
argument_list|(
name|height
argument_list|,
name|width
argument_list|)
expr_stmt|;
comment|/*  XSetWindowSize ((height - (2 * XXborder))/fontinfo -> height,     (width - (2 * XXborder))/fontinfo -> width);*/
name|XSetOffset
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
return|return
name|Qnil
return|;
block|}
end_block

begin_expr_stmt
name|DEFUN
argument_list|(
literal|"x-set-border-width"
argument_list|,
name|Fx_set_border_width
argument_list|,
name|Sx_set_border_width
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"Set width of border to WIDTH, in the X window system.\n\ Works only before the window has been mapped."
argument_list|)
argument_list|(
name|borderwidth
argument_list|)
specifier|register
name|Lisp_Object
name|borderwidth
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|extern
name|int
name|WindowMapped
decl_stmt|;
specifier|extern
name|int
name|XXborder
decl_stmt|;
name|WindowInfo
name|WinInfo
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
specifier|extern
name|FontInfo
modifier|*
name|fontinfo
decl_stmt|;
specifier|extern
name|Cursor
name|EmacsCursor
decl_stmt|;
specifier|extern
name|char
name|iconidentity
index|[]
decl_stmt|;
specifier|register
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
specifier|extern
name|int
name|CurHL
decl_stmt|;
name|Window
name|tempwindow
decl_stmt|;
specifier|extern
name|int
name|pixelwidth
decl_stmt|,
name|pixelheight
decl_stmt|;
specifier|register
name|int
name|temppixelwidth
decl_stmt|;
specifier|register
name|int
name|temppixelheight
decl_stmt|;
specifier|register
name|int
name|tempx
decl_stmt|;
specifier|register
name|int
name|tempy
decl_stmt|;
specifier|extern
name|int
name|XXxoffset
decl_stmt|,
name|XXyoffset
decl_stmt|;
specifier|extern
name|int
name|XXpid
decl_stmt|;
name|Pixmap
name|temp_brdr
decl_stmt|,
name|temp_back
decl_stmt|;
name|CHECK_NUMBER
argument_list|(
name|borderwidth
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
if|if
condition|(
name|XINT
argument_list|(
name|borderwidth
argument_list|)
operator|<
literal|0
condition|)
name|XSETINT
argument_list|(
name|borderwidth
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|temppixelwidth
operator|=
name|screen_width
operator|*
name|fontinfo
operator|->
name|width
expr_stmt|;
name|temppixelheight
operator|=
name|screen_height
operator|*
name|fontinfo
operator|->
name|height
expr_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|XQueryWindow
argument_list|(
name|XXwindow
argument_list|,
operator|&
name|WinInfo
argument_list|)
expr_stmt|;
name|tempx
operator|=
name|WinInfo
operator|.
name|x
expr_stmt|;
name|tempy
operator|=
name|WinInfo
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|brdr_color
argument_list|,
literal|"gray"
argument_list|)
operator|==
literal|0
condition|)
name|temp_brdr
operator|=
name|XMakePixmap
argument_list|(
operator|(
name|Bitmap
operator|)
name|XStoreBitmap
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|gray_bits
argument_list|)
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|)
expr_stmt|;
else|else
name|temp_brdr
operator|=
name|XMakeTile
argument_list|(
name|brdr
argument_list|)
expr_stmt|;
name|temp_back
operator|=
name|XMakeTile
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|tempwindow
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|tempx
comment|/* Absolute horizontal offset */
argument_list|,
name|tempy
comment|/* Absolute Vertical offset */
argument_list|,
name|temppixelwidth
argument_list|,
name|temppixelheight
argument_list|,
name|XINT
argument_list|(
name|borderwidth
argument_list|)
argument_list|,
name|temp_brdr
argument_list|,
name|temp_back
argument_list|)
expr_stmt|;
if|if
condition|(
name|tempwindow
condition|)
block|{
name|XDestroyWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
name|XXwindow
operator|=
name|tempwindow
expr_stmt|;
name|pixelwidth
operator|=
name|temppixelwidth
expr_stmt|;
name|pixelheight
operator|=
name|temppixelheight
expr_stmt|;
name|XXborder
operator|=
name|XINT
argument_list|(
name|borderwidth
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|NoEvent
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|XXwindow
argument_list|,
name|fontinfo
operator|->
name|width
operator|*
literal|10
argument_list|,
name|fontinfo
operator|->
name|height
operator|*
literal|5
argument_list|,
name|fontinfo
operator|->
name|width
argument_list|,
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
name|XStoreName
argument_list|(
name|XXwindow
argument_list|,
operator|&
name|iconidentity
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|XXwindow
argument_list|,
name|EmacsCursor
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp_brdr
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp_back
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|WindowMapped
condition|)
block|{
name|XMapWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|KeyPressed
operator||
name|ExposeWindow
operator||
name|ButtonPressed
operator||
name|ExposeRegion
operator||
name|ExposeCopy
argument_list|)
expr_stmt|;
operator|++
name|screen_garbaged
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
block|}
return|return
name|Qt
return|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
name|message
argument_list|(
literal|"Could not recreate window."
argument_list|)
expr_stmt|;
return|return
name|Qnil
return|;
block|}
block|}
end_block

begin_decl_stmt
name|jmp_buf
name|dispenv
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Display
modifier|*
name|OldDisplay
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|FontInfo
modifier|*
name|OldFontInfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|OldWindow
decl_stmt|;
end_decl_stmt

begin_macro
name|XRestoreDisplay
argument_list|()
end_macro

begin_block
block|{
name|longjmp
argument_list|(
name|dispenv
argument_list|,
literal|"Unable to access display (probably)"
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|DEFUN
argument_list|(
literal|"x-change-display"
argument_list|,
name|Fx_change_display
argument_list|,
name|Sx_change_display
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|"sNew display name: "
argument_list|,
literal|"This function takes one argument, the display where you wish to\n\ continue your editing session.  Your current window will be unmapped and\n\ the current display will be closed.  The new X display will be opened and\n\ the rubber-band outline of the new window will appear on the new X display.\n\ This function does not look at your .Xdefaults file, so you should use the\n\ function x-new-display instead."
argument_list|)
argument_list|(
name|new_display
argument_list|)
specifier|register
name|Lisp_Object
name|new_display
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|extern
name|Cursor
name|EmacsCursor
decl_stmt|;
name|Cursor
name|OldEmacsCursor
decl_stmt|;
specifier|register
name|int
argument_list|(
operator|*
name|sigfunc
argument_list|)
argument_list|()
decl_stmt|,
argument_list|(
operator|*
name|pipefunc
argument_list|)
argument_list|()
decl_stmt|;
specifier|register
name|char
modifier|*
name|newdisplayname
init|=
literal|0
decl_stmt|;
specifier|extern
name|char
name|iconidentity
index|[]
decl_stmt|;
specifier|extern
name|Display
modifier|*
name|XXdisplay
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
specifier|extern
name|Window
name|XXIconWindow
decl_stmt|;
specifier|extern
name|int
name|IconWindow
decl_stmt|;
specifier|extern
name|Bitmap
name|XXIconMask
decl_stmt|;
specifier|extern
name|int
name|pixelwidth
decl_stmt|,
name|pixelheight
decl_stmt|,
name|XXborder
decl_stmt|,
name|CurHL
decl_stmt|;
specifier|extern
name|FontInfo
modifier|*
name|fontinfo
decl_stmt|;
specifier|extern
name|int
name|bitblt
decl_stmt|,
name|CursorExists
decl_stmt|,
name|VisibleX
decl_stmt|,
name|VisibleY
decl_stmt|;
specifier|extern
name|WindowInfo
name|rootwindowinfo
decl_stmt|;
specifier|extern
name|char
name|MouseCursor
index|[]
decl_stmt|,
name|MouseMask
index|[]
decl_stmt|;
name|int
name|old_fcntl_flags
decl_stmt|,
name|old_fcntl_owner
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|;
name|int
name|temp_icon
decl_stmt|;
name|Pixmap
name|temp_brdr
decl_stmt|,
name|temp_back
decl_stmt|;
specifier|register
name|char
modifier|*
name|XXerrorcode
decl_stmt|;
specifier|extern
name|int
name|XXxoffset
decl_stmt|,
name|XXyoffset
decl_stmt|;
name|CHECK_STRING
argument_list|(
name|new_display
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|check_xterm
argument_list|()
expr_stmt|;
comment|/*  newdisplayname = xmalloc (XSTRING (new_display)->size + 1); */
comment|/*  bcopy (XSTRING (new_display)->data, newdisplayname, */
comment|/*	 XSTRING (new_display)->size + 1);  */
comment|/* Since this was freed at the end, why not just use the original? */
name|newdisplayname
operator|=
operator|(
name|char
operator|*
operator|)
name|XSTRING
argument_list|(
name|new_display
argument_list|)
operator|->
name|data
expr_stmt|;
name|sigfunc
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|XIOErrorHandler
argument_list|(
name|XRestoreDisplay
argument_list|)
expr_stmt|;
if|if
condition|(
name|XXerrorcode
operator|=
operator|(
name|char
operator|*
operator|)
name|setjmp
argument_list|(
name|dispenv
argument_list|)
condition|)
block|{
comment|/*       free (&newdisplayname[0]); */
if|if
condition|(
name|fontinfo
condition|)
name|XCloseFont
argument_list|(
name|fontinfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|XXwindow
condition|)
name|XDestroyWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
if|if
condition|(
name|XXdisplay
condition|)
name|XCloseDisplay
argument_list|(
name|XXdisplay
argument_list|)
expr_stmt|;
name|XXdisplay
operator|=
name|OldDisplay
expr_stmt|;
name|fontinfo
operator|=
name|OldFontInfo
expr_stmt|;
name|XXwindow
operator|=
name|OldWindow
expr_stmt|;
name|EmacsCursor
operator|=
name|OldEmacsCursor
expr_stmt|;
name|XIOErrorHandler
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|XSetDisplay
argument_list|(
name|XXdisplay
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|sigfunc
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
name|error
argument_list|(
literal|"Display change problem: %s"
argument_list|,
name|XXerrorcode
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OldEmacsCursor
operator|=
name|EmacsCursor
expr_stmt|;
name|OldDisplay
operator|=
name|XXdisplay
expr_stmt|;
name|OldFontInfo
operator|=
name|fontinfo
expr_stmt|;
name|OldWindow
operator|=
name|XXwindow
expr_stmt|;
name|XXwindow
operator|=
literal|0
expr_stmt|;
name|fontinfo
operator|=
literal|0
expr_stmt|;
name|XXdisplay
operator|=
literal|0
expr_stmt|;
block|}
name|XXdisplay
operator|=
name|XOpenDisplay
argument_list|(
name|newdisplayname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XXdisplay
condition|)
block|{
name|longjmp
argument_list|(
name|dispenv
argument_list|,
literal|"Probably nonexistant display"
argument_list|)
expr_stmt|;
block|}
name|XQueryWindow
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|rootwindowinfo
argument_list|)
expr_stmt|;
name|fontinfo
operator|=
name|XOpenFont
argument_list|(
name|XXcurrentfont
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fontinfo
condition|)
block|{
name|longjmp
argument_list|(
name|dispenv
argument_list|,
literal|"Bad font"
argument_list|)
expr_stmt|;
block|}
comment|/* pixelwidth and pixelheight are correct*/
name|XXwindow
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|XXxoffset
argument_list|,
name|XXyoffset
argument_list|,
name|pixelwidth
argument_list|,
name|pixelheight
argument_list|,
name|XXborder
argument_list|,
name|BlackPixmap
argument_list|,
name|WhitePixmap
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XXwindow
condition|)
block|{
name|longjmp
argument_list|(
name|dispenv
argument_list|,
literal|"Could not create window"
argument_list|)
expr_stmt|;
block|}
name|fore
operator|=
name|BlackPixel
expr_stmt|;
name|back
operator|=
name|WhitePixel
expr_stmt|;
name|brdr
operator|=
name|BlackPixel
expr_stmt|;
name|mous
operator|=
name|BlackPixel
expr_stmt|;
name|curs
operator|=
name|BlackPixel
expr_stmt|;
name|fore_color
operator|=
literal|"black"
expr_stmt|;
name|back_color
operator|=
literal|"white"
expr_stmt|;
name|brdr_color
operator|=
literal|"black"
expr_stmt|;
name|mous_color
operator|=
literal|"black"
expr_stmt|;
name|curs_color
operator|=
literal|"black"
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|NoEvent
argument_list|)
expr_stmt|;
name|EmacsCursor
operator|=
name|XCreateCursor
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|,
name|MouseCursor
argument_list|,
name|MouseMask
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|mous
argument_list|,
name|back
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|XXwindow
argument_list|,
name|EmacsCursor
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|XXwindow
argument_list|,
name|fontinfo
operator|->
name|width
operator|*
literal|10
argument_list|,
name|fontinfo
operator|->
name|height
operator|*
literal|5
argument_list|,
name|fontinfo
operator|->
name|width
argument_list|,
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
name|XStoreName
argument_list|(
name|XXwindow
argument_list|,
name|iconidentity
argument_list|)
expr_stmt|;
comment|/*  WindowMapped = 0;*/
name|x_edges_specified
operator|=
literal|0
expr_stmt|;
name|bitblt
operator|=
literal|0
expr_stmt|;
name|CursorExists
operator|=
literal|0
expr_stmt|;
name|VisibleX
operator|=
literal|0
expr_stmt|;
name|VisibleY
operator|=
literal|0
expr_stmt|;
name|XSetDisplay
argument_list|(
name|XXdisplay
argument_list|)
expr_stmt|;
comment|/*  XQueryWindow (RootWindow,&rootwindowinfo);*/
comment|/*  if (WindowMapped)     {*/
name|WindowMapped
operator|=
literal|0
expr_stmt|;
name|XPopUpWindow
argument_list|()
expr_stmt|;
comment|/*  }*/
name|WindowMapped
operator|=
literal|1
expr_stmt|;
name|XXIconWindow
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|sink_width
argument_list|,
name|sink_height
argument_list|,
literal|2
argument_list|,
name|WhitePixmap
argument_list|,
name|BlackPixmap
argument_list|)
expr_stmt|;
name|XXIconMask
operator|=
name|XStoreBitmap
argument_list|(
name|sink_mask_width
argument_list|,
name|sink_mask_height
argument_list|,
name|sink_mask_bits
argument_list|)
expr_stmt|;
name|XSetDisplay
argument_list|(
name|OldDisplay
argument_list|)
expr_stmt|;
name|XCloseFont
argument_list|(
name|OldFontInfo
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|OldEmacsCursor
argument_list|)
expr_stmt|;
name|XDestroyWindow
argument_list|(
name|OldWindow
argument_list|)
expr_stmt|;
name|XSetDisplay
argument_list|(
name|XXdisplay
argument_list|)
expr_stmt|;
name|XCloseDisplay
argument_list|(
name|OldDisplay
argument_list|)
expr_stmt|;
name|temp_icon
operator|=
name|IconWindow
expr_stmt|;
name|XBitmapIcon
expr_stmt|;
name|XTextIcon
expr_stmt|;
if|if
condition|(
name|temp_icon
condition|)
block|{
name|IconWindow
operator|=
literal|0
expr_stmt|;
name|XBitmapIcon
expr_stmt|;
block|}
name|XErrorHandler
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|dup2
argument_list|(
name|dpyno
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|dpyno
argument_list|()
argument_list|)
expr_stmt|;
name|dpyno
argument_list|()
operator|=
literal|0
expr_stmt|;
comment|/* Looks a little strange? */
comment|/* check the def of the */
comment|/* macro, it is a genuine */
comment|/* lvalue */
name|old_fcntl_flags
operator|=
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_GETFL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_SETFL
argument_list|,
name|old_fcntl_flags
operator||
name|FASYNC
argument_list|)
expr_stmt|;
name|old_fcntl_owner
operator|=
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_GETOWN
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_SETOWN
argument_list|,
name|getpid
argument_list|()
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|sigfunc
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
comment|/*  free (newdisplayname); */
comment|/*  x_edges_specified = 0;*/
operator|++
name|screen_garbaged
expr_stmt|;
name|Fredraw_display
argument_list|()
expr_stmt|;
return|return
name|Qt
return|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/*    Grabs mouse, outlines a window, etc.    if left button pressed, sizes a wd x hd window (in characters)    if right button pressed, sizes wd x what will fit window (in characters)    if middle button pressed, allows user to size window in font increments    	(+ border * 2 for inner border);    While sizing, dimensions of window are displayed in upper left of root.    str is also displayed there.    In all cases, x and y are the desired coordinates for the upper lefthand    	corner, *width = width desired, *height = height desired 	(min for both is 1 font char).  	*/
end_comment

begin_comment
comment|/*   This routine is a total crock.  It makes a window using XCreateTerm   purely for return value, destroying the temporary window created in   the process.  If XCreateTerm were broken into smaller, more easily   digestible pieces, it would be useful.  As such, the constraints of   time, emacs, and X conventions force me into this crock. --rlk   */
end_comment

begin_macro
name|window_fetch
argument_list|(
argument|font
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|geo
argument_list|,
argument|deflt
argument_list|,
argument|border
argument_list|,
argument|str
argument_list|)
end_macro

begin_decl_stmt
name|Font
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|width
decl_stmt|,
modifier|*
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|geo
decl_stmt|,
modifier|*
name|deflt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|border
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|str
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|extern
name|int
name|WindowMapped
decl_stmt|;
specifier|extern
name|int
name|XXborder
decl_stmt|;
specifier|extern
name|Window
name|XXwindow
decl_stmt|;
specifier|extern
name|FontInfo
modifier|*
name|fontinfo
decl_stmt|;
specifier|extern
name|Cursor
name|EmacsCursor
decl_stmt|;
name|OpaqueFrame
name|frame
decl_stmt|;
specifier|extern
name|char
name|iconidentity
index|[]
decl_stmt|;
specifier|register
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|()
function_decl|;
name|Window
name|tempwindow
decl_stmt|;
name|WindowInfo
name|WinInfo
decl_stmt|;
specifier|extern
name|int
name|pixelwidth
decl_stmt|,
name|pixelheight
decl_stmt|;
specifier|register
name|int
name|temppixelwidth
decl_stmt|;
specifier|register
name|int
name|temppixelheight
decl_stmt|;
specifier|extern
name|int
name|XXxoffset
decl_stmt|,
name|XXyoffset
decl_stmt|;
specifier|extern
name|int
name|XXpid
decl_stmt|;
name|Pixmap
name|temp_brdr
decl_stmt|,
name|temp_back
decl_stmt|;
name|func
operator|=
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|temp_brdr
operator|=
name|XMakeTile
argument_list|(
name|brdr
argument_list|)
expr_stmt|;
name|temp_back
operator|=
name|XMakeTile
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|frame
operator|.
name|bdrwidth
operator|=
name|border
expr_stmt|;
name|frame
operator|.
name|border
operator|=
name|XMakeTile
argument_list|(
name|brdr
argument_list|)
expr_stmt|;
name|frame
operator|.
name|background
operator|=
name|XMakeTile
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|tempwindow
operator|=
name|XCreateTerm
argument_list|(
name|str
argument_list|,
literal|"emacs"
argument_list|,
name|geo
argument_list|,
name|deflt
argument_list|,
operator|&
name|frame
argument_list|,
literal|10
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|fontinfo
argument_list|,
name|fontinfo
operator|->
name|width
argument_list|,
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|tempwindow
condition|)
block|{
name|XDestroyWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
name|XXwindow
operator|=
name|tempwindow
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|NoEvent
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|XXwindow
argument_list|,
name|fontinfo
operator|->
name|width
operator|*
literal|10
argument_list|,
name|fontinfo
operator|->
name|height
operator|*
literal|5
argument_list|,
name|fontinfo
operator|->
name|width
argument_list|,
name|fontinfo
operator|->
name|height
argument_list|)
expr_stmt|;
name|XStoreName
argument_list|(
name|XXwindow
argument_list|,
operator|&
name|iconidentity
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|XXwindow
argument_list|,
name|EmacsCursor
argument_list|)
expr_stmt|;
name|XQueryWindow
argument_list|(
name|XXwindow
argument_list|,
operator|&
name|WinInfo
argument_list|)
expr_stmt|;
operator|*
name|x
operator|=
name|WinInfo
operator|.
name|x
expr_stmt|;
operator|*
name|y
operator|=
name|WinInfo
operator|.
name|y
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp_brdr
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|temp_back
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|WindowMapped
condition|)
block|{
name|XMapWindow
argument_list|(
name|XXwindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|XXwindow
argument_list|,
name|KeyPressed
operator||
name|ExposeWindow
operator||
name|ButtonPressed
operator||
name|ExposeRegion
operator||
name|ExposeCopy
argument_list|)
expr_stmt|;
operator|++
name|screen_garbaged
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
block|}
return|return
name|Qt
return|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|kill
argument_list|(
name|XXpid
argument_list|,
name|SIGIO
argument_list|)
expr_stmt|;
block|}
name|message
argument_list|(
literal|"Could not recreate window."
argument_list|)
expr_stmt|;
return|return
name|Qnil
return|;
block|}
block|}
end_block

begin_macro
name|setxterm
argument_list|()
end_macro

begin_block
block|{
name|Vxterm
operator|=
name|Qt
expr_stmt|;
block|}
end_block

begin_macro
name|XRedrawDisplay
argument_list|()
end_macro

begin_block
block|{
name|Fredraw_display
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|XAutoSave
argument_list|()
end_macro

begin_block
block|{
name|Fdo_auto_save
argument_list|()
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_macro
name|syms_of_xfns
argument_list|()
end_macro

begin_block
block|{
name|x_edges_specified
operator|=
literal|0
expr_stmt|;
name|DefLispVar
argument_list|(
literal|"xterm"
argument_list|,
operator|&
name|Vxterm
argument_list|,
literal|"True if using xterm, nil otherwise."
argument_list|)
expr_stmt|;
name|Vxterm
operator|=
name|Qnil
expr_stmt|;
name|DefLispVar
argument_list|(
literal|"x-mouse-pos"
argument_list|,
operator|&
name|Vx_mouse_pos
argument_list|,
literal|"Current x-y position of mouse by row, column as specified by font."
argument_list|)
expr_stmt|;
name|Vx_mouse_pos
operator|=
name|Qnil
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_pop_up_window
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_bell
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_flip_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_icon
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_font
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_window_edges
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Scoordinates_in_window_p
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_mouse_events
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_proc_mouse_event
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_mouse_event
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_keyboard_enable
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_mouse_inform_flag
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_store_cut_buffer
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_cut_buffer
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_rubber_band
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_create_x_window
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_border_width
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_change_display
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_foreground_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_background_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_border_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_cursor_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_set_mouse_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_foreground_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_background_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_border_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_cursor_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_mouse_color
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_color_p
argument_list|)
expr_stmt|;
name|defsubr
argument_list|(
operator|&
name|Sx_get_default
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

