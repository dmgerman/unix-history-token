begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"@(#)pl_4.c	1.1 83/07/20"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"player.h"
end_include

begin_macro
name|changesail
argument_list|()
end_macro

begin_block
block|{
name|int
name|rig
decl_stmt|,
name|full
decl_stmt|;
name|rig
operator|=
name|mc
operator|->
name|rig1
expr_stmt|;
name|full
operator|=
name|mf
operator|->
name|FS
expr_stmt|;
if|if
condition|(
name|windspeed
operator|==
literal|6
operator|||
name|windspeed
operator|==
literal|5
operator|&&
name|mc
operator|->
name|class
operator|>
literal|4
condition|)
name|rig
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|mc
operator|->
name|crew3
operator|&&
name|rig
condition|)
block|{
if|if
condition|(
operator|!
name|full
condition|)
block|{
name|Signal
argument_list|(
literal|"Increase to Full sails? "
argument_list|,
operator|(
expr|struct
name|ship
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sgetch
argument_list|(
literal|1
argument_list|)
operator|==
literal|'y'
condition|)
block|{
name|changed
operator|=
literal|1
expr_stmt|;
name|Write
argument_list|(
name|W_FS
argument_list|,
name|ms
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|Signal
argument_list|(
literal|"Reduce to Battle sails? "
argument_list|,
operator|(
expr|struct
name|ship
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sgetch
argument_list|(
literal|1
argument_list|)
operator|==
literal|'y'
condition|)
block|{
name|Write
argument_list|(
name|W_FS
argument_list|,
name|ms
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|changed
operator|=
literal|1
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|rig
condition|)
name|Signal
argument_list|(
literal|"Sails rent to pieces"
argument_list|,
operator|(
expr|struct
name|ship
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|signalflags
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|ship
modifier|*
name|sp
decl_stmt|;
name|foreachship
argument_list|(
argument|sp
argument_list|)
block|{
if|if
condition|(
operator|*
name|sp
operator|->
name|file
operator|->
name|signal
condition|)
block|{
operator|(
name|void
operator|)
name|putchar
argument_list|(
literal|'\7'
argument_list|)
expr_stmt|;
name|Signal
argument_list|(
literal|"%s (%c%c): %s"
argument_list|,
name|sp
argument_list|,
name|sp
operator|->
name|file
operator|->
name|signal
argument_list|)
expr_stmt|;
operator|*
name|sp
operator|->
name|file
operator|->
name|signal
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|acceptsignal
argument_list|()
end_macro

begin_block
block|{
name|char
name|buf
index|[
literal|60
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
init|=
name|buf
decl_stmt|;
name|Signal
argument_list|(
literal|"Message? "
argument_list|,
operator|(
expr|struct
name|ship
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
operator|*
name|p
operator|++
operator|=
literal|'"'
expr_stmt|;
name|sgetstr
argument_list|(
name|p
argument_list|,
sizeof|sizeof
name|buf
operator|-
literal|2
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|++
condition|)
empty_stmt|;
name|p
index|[
operator|-
literal|1
index|]
operator|=
literal|'"'
expr_stmt|;
name|Write
argument_list|(
name|W_SIGNAL
argument_list|,
name|ms
argument_list|,
literal|1
argument_list|,
operator|(
name|int
operator|)
name|buf
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*VARARGS2*/
end_comment

begin_macro
name|Signal
argument_list|(
argument|fmt
argument_list|,
argument|ship
argument_list|,
argument|a
argument_list|,
argument|b
argument_list|,
argument|c
argument_list|,
argument|d
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|fmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|struct
name|ship
modifier|*
name|ship
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Scroll
argument_list|()
expr_stmt|;
if|if
condition|(
name|ship
operator|==
literal|0
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|scroll_w
argument_list|,
name|fmt
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|scroll_w
argument_list|,
name|fmt
argument_list|,
name|ship
operator|->
name|shipname
argument_list|,
name|colours
argument_list|(
name|ship
argument_list|)
argument_list|,
name|sterncolour
argument_list|(
name|ship
argument_list|)
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
specifier|static
name|int
name|sline
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_macro
name|Scroll
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|sline
operator|++
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
if|if
condition|(
name|sline
operator|>=
name|SCROLL_Y
condition|)
name|sline
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_comment
comment|/* make sure we have two consecutive lines */
end_comment

begin_macro
name|Scroll2
argument_list|()
end_macro

begin_block
block|{
name|Scroll
argument_list|()
expr_stmt|;
if|if
condition|(
name|sline
operator|>
name|SCROLL_Y
operator|-
literal|2
condition|)
name|Scroll
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|lastline
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|SCROLL_Y
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|prompt
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|sline
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|addch
argument_list|(
literal|'~'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|sline
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|sgetch
argument_list|(
argument|flag
argument_list|)
end_macro

begin_decl_stmt
name|char
name|flag
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|c
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|wgetch
argument_list|(
name|scroll_w
argument_list|)
operator|)
operator|==
name|EOF
condition|)
empty_stmt|;
if|if
condition|(
name|flag
condition|)
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|scroll_w
argument_list|,
name|c
argument_list|)
expr_stmt|;
return|return
name|c
return|;
block|}
end_block

begin_macro
name|sgetstr
argument_list|(
argument|buf
argument_list|,
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|buf
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
init|=
name|buf
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
while|while
condition|(
operator|(
name|c
operator|=
name|wgetch
argument_list|(
name|scroll_w
argument_list|)
operator|)
operator|==
name|EOF
condition|)
empty_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\n'
case|:
case|case
literal|'\r'
case|:
operator|*
name|p
operator|=
literal|0
expr_stmt|;
return|return;
case|case
literal|'\b'
case|:
if|if
condition|(
name|p
operator|>
name|buf
condition|)
name|p
operator|--
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|p
operator|<
operator|&
name|buf
index|[
name|n
index|]
operator|-
literal|1
condition|)
block|{
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|scroll_w
argument_list|,
name|c
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|putchar
argument_list|(
name|CTRL
argument_list|(
name|g
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|newturn
argument_list|()
end_macro

begin_block
block|{
name|repaired
operator|=
name|loaded
operator|=
name|fired
operator|=
name|changed
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|alarm
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|readyL
operator|&
name|R_LOADING
condition|)
if|if
condition|(
name|mf
operator|->
name|readyL
operator|&
name|R_DOUBLE
condition|)
name|mf
operator|->
name|readyL
operator|=
name|R_LOADING
expr_stmt|;
else|else
name|mf
operator|->
name|readyL
operator|=
name|R_LOADED
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|readyR
operator|&
name|R_LOADING
condition|)
if|if
condition|(
name|mf
operator|->
name|readyR
operator|&
name|R_DOUBLE
condition|)
name|mf
operator|->
name|readyR
operator|=
name|R_LOADING
expr_stmt|;
else|else
name|mf
operator|->
name|readyR
operator|=
name|R_LOADED
expr_stmt|;
name|movebuf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|Sync
argument_list|()
expr_stmt|;
if|if
condition|(
name|turn
operator|%
literal|50
operator|==
literal|0
condition|)
comment|/* still playing */
name|Write
argument_list|(
name|W_TIME
argument_list|,
name|SHIP
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* XXX */
name|windspeed
operator|=
name|cc
operator|->
name|windspeed
expr_stmt|;
name|winddir
operator|=
name|cc
operator|->
name|winddir
expr_stmt|;
name|turn
operator|=
name|cc
operator|->
name|turn
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|FS
operator|==
literal|1
condition|)
name|Write
argument_list|(
name|W_FS
argument_list|,
name|ms
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|readpos
argument_list|()
expr_stmt|;
name|adjustview
argument_list|()
expr_stmt|;
name|screen
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGALRM
argument_list|,
name|newturn
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|alarm
argument_list|(
literal|7
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|screen
argument_list|()
end_macro

begin_block
block|{
name|draw_view
argument_list|()
expr_stmt|;
name|draw_turn
argument_list|()
expr_stmt|;
name|draw_stat
argument_list|()
expr_stmt|;
name|draw_slot
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_view
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|ship
modifier|*
name|sp
decl_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
name|foreachship
argument_list|(
argument|sp
argument_list|)
block|{
if|if
condition|(
name|sp
operator|->
name|file
operator|->
name|dir
operator|&&
name|sp
operator|->
name|file
operator|->
name|row
operator|>
name|viewrow
operator|&&
name|sp
operator|->
name|file
operator|->
name|row
operator|<
name|viewrow
operator|+
name|VIEW_Y
operator|&&
name|sp
operator|->
name|file
operator|->
name|col
operator|>
name|viewcol
operator|&&
name|sp
operator|->
name|file
operator|->
name|col
operator|<
name|viewcol
operator|+
name|VIEW_X
condition|)
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
name|sp
operator|->
name|file
operator|->
name|row
operator|-
name|viewrow
argument_list|,
name|sp
operator|->
name|file
operator|->
name|col
operator|-
name|viewcol
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|view_w
argument_list|,
name|colours
argument_list|(
name|sp
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
name|sternrow
argument_list|(
name|sp
argument_list|)
operator|-
name|viewrow
argument_list|,
name|sterncol
argument_list|(
name|sp
argument_list|)
operator|-
name|viewcol
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|view_w
argument_list|,
name|sterncolour
argument_list|(
name|sp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_turn
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|turn_w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|turn_w
argument_list|,
literal|"Turn %d"
argument_list|,
name|turn
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|turn_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_stat
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Points  %3d\n"
argument_list|,
name|mf
operator|->
name|points
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Fouls    %2d\n"
argument_list|,
name|fouled
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Grapples %2d\n"
argument_list|,
name|grappled
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"    0 %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|3
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|3
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|stat_w
argument_list|,
literal|"   \\|/\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"   -^-%c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|2
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|2
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|stat_w
argument_list|,
literal|"   /|\\\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"    | %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"   %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Load  %c%c %c%c\n"
argument_list|,
name|loadname
index|[
name|mf
operator|->
name|loadL
index|]
argument_list|,
name|readyname
argument_list|(
name|mf
operator|->
name|readyL
argument_list|)
argument_list|,
name|loadname
index|[
name|mf
operator|->
name|loadR
index|]
argument_list|,
name|readyname
argument_list|(
name|mf
operator|->
name|readyR
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Hull %2d\n"
argument_list|,
name|mc
operator|->
name|hull
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Crew %2d %2d %2d\n"
argument_list|,
name|mc
operator|->
name|crew1
argument_list|,
name|mc
operator|->
name|crew2
argument_list|,
name|mc
operator|->
name|crew3
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Guns %2d %2d\n"
argument_list|,
name|mc
operator|->
name|gunL
argument_list|,
name|mc
operator|->
name|gunR
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Carr %2d %2d\n"
argument_list|,
name|mc
operator|->
name|carR
argument_list|,
name|mc
operator|->
name|carL
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Rigg %d %d %d "
argument_list|,
name|mc
operator|->
name|rig1
argument_list|,
name|mc
operator|->
name|rig2
argument_list|,
name|mc
operator|->
name|rig3
argument_list|)
expr_stmt|;
if|if
condition|(
name|mc
operator|->
name|rig4
operator|<
literal|0
condition|)
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|stat_w
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"%d"
argument_list|,
name|mc
operator|->
name|rig4
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|stat_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_slot
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|boarding
argument_list|(
name|ms
argument_list|,
literal|0
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
block|}
else|else
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"OBP"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|boarding
argument_list|(
name|ms
argument_list|,
literal|1
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
block|}
else|else
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|"DBP"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RH
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRH"
argument_list|,
name|mf
operator|->
name|RH
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RG
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRG"
argument_list|,
name|mf
operator|->
name|RG
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RR
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRR"
argument_list|,
name|mf
operator|->
name|RR
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
define|#
directive|define
name|Y
value|(SLOT_Y/2)
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
literal|7
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%d"
argument_list|,
name|windspeed
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|1
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
name|dr
index|[
name|winddir
index|]
argument_list|,
literal|1
operator|-
name|dc
index|[
name|winddir
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|winddir
condition|)
block|{
case|case
literal|1
case|:
case|case
literal|5
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
case|case
literal|6
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|7
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
case|case
literal|8
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'\\'
argument_list|)
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
name|dr
index|[
name|winddir
index|]
argument_list|,
literal|1
operator|+
name|dc
index|[
name|winddir
index|]
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|slot_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|board
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
operator|(
name|void
operator|)
name|clear
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|slot_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|stat_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|turn_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|BOX_T
argument_list|,
name|BOX_L
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|BOX_X
condition|;
name|n
operator|++
control|)
operator|(
name|void
operator|)
name|addch
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|BOX_B
argument_list|,
name|BOX_L
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|BOX_X
condition|;
name|n
operator|++
control|)
operator|(
name|void
operator|)
name|addch
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
name|BOX_T
operator|+
literal|1
init|;
name|n
operator|<
name|BOX_B
condition|;
name|n
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|n
argument_list|,
name|BOX_L
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|n
argument_list|,
name|BOX_R
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_T
argument_list|,
name|BOX_L
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_T
argument_list|,
name|BOX_R
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_B
argument_list|,
name|BOX_L
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_B
argument_list|,
name|BOX_R
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|refresh
argument_list|()
expr_stmt|;
define|#
directive|define
name|WSaIM
value|"Wooden Ships& Iron Men"
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
literal|2
argument_list|,
operator|(
name|VIEW_X
operator|-
sizeof|sizeof
name|WSaIM
operator|-
literal|1
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|view_w
argument_list|,
name|WSaIM
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
literal|4
argument_list|,
operator|(
name|VIEW_X
operator|-
name|strlen
argument_list|(
name|cc
operator|->
name|name
argument_list|)
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|view_w
argument_list|,
name|cc
operator|->
name|name
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|LINE_T
argument_list|,
name|LINE_L
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printw
argument_list|(
literal|"Class %d %s (%d guns) '%s' (%c%c)"
argument_list|,
name|mc
operator|->
name|class
argument_list|,
name|classname
index|[
name|mc
operator|->
name|class
index|]
argument_list|,
name|mc
operator|->
name|guns
argument_list|,
name|ms
operator|->
name|shipname
argument_list|,
name|colours
argument_list|(
name|ms
argument_list|)
argument_list|,
name|sterncolour
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|initscreen
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|initscr
argument_list|()
expr_stmt|;
name|view_w
operator|=
name|newwin
argument_list|(
name|VIEW_Y
argument_list|,
name|VIEW_X
argument_list|,
name|VIEW_T
argument_list|,
name|VIEW_L
argument_list|)
expr_stmt|;
name|slot_w
operator|=
name|newwin
argument_list|(
name|SLOT_Y
argument_list|,
name|SLOT_X
argument_list|,
name|SLOT_T
argument_list|,
name|SLOT_L
argument_list|)
expr_stmt|;
name|scroll_w
operator|=
name|newwin
argument_list|(
name|SCROLL_Y
argument_list|,
name|SCROLL_X
argument_list|,
name|SCROLL_T
argument_list|,
name|SCROLL_L
argument_list|)
expr_stmt|;
name|stat_w
operator|=
name|newwin
argument_list|(
name|STAT_Y
argument_list|,
name|STAT_X
argument_list|,
name|STAT_T
argument_list|,
name|STAT_L
argument_list|)
expr_stmt|;
name|turn_w
operator|=
name|newwin
argument_list|(
name|TURN_Y
argument_list|,
name|TURN_X
argument_list|,
name|TURN_T
argument_list|,
name|TURN_L
argument_list|)
expr_stmt|;
name|done_curses
operator|++
expr_stmt|;
name|noecho
argument_list|()
expr_stmt|;
name|crmode
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|centerview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
name|VIEW_Y
operator|/
literal|2
expr_stmt|;
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
name|VIEW_X
operator|/
literal|2
expr_stmt|;
block|}
end_block

begin_macro
name|upview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|-=
name|VIEW_Y
operator|/
literal|3
expr_stmt|;
block|}
end_block

begin_macro
name|downview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|+=
name|VIEW_Y
operator|/
literal|3
expr_stmt|;
block|}
end_block

begin_macro
name|leftview
argument_list|()
end_macro

begin_block
block|{
name|viewcol
operator|-=
name|VIEW_X
operator|/
literal|5
expr_stmt|;
block|}
end_block

begin_macro
name|rightview
argument_list|()
end_macro

begin_block
block|{
name|viewcol
operator|+=
name|VIEW_X
operator|/
literal|5
expr_stmt|;
block|}
end_block

begin_macro
name|adjustview
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|dont_adjust
condition|)
return|return;
comment|/* don't adjust if out of sight */
if|if
condition|(
name|mf
operator|->
name|row
operator|<
name|viewrow
operator|+
name|VIEW_Y
operator|/
literal|4
condition|)
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
operator|(
name|VIEW_Y
operator|-
name|VIEW_Y
operator|/
literal|4
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mf
operator|->
name|row
operator|>
name|viewrow
operator|+
operator|(
name|VIEW_Y
operator|-
name|VIEW_Y
operator|/
literal|4
operator|)
condition|)
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
name|VIEW_Y
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|col
operator|<
name|viewcol
operator|+
name|VIEW_X
operator|/
literal|8
condition|)
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
operator|(
name|VIEW_X
operator|-
name|VIEW_X
operator|/
literal|8
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mf
operator|->
name|col
operator|>
name|viewcol
operator|+
operator|(
name|VIEW_X
operator|-
name|VIEW_X
operator|/
literal|8
operator|)
condition|)
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
name|VIEW_X
operator|/
literal|8
expr_stmt|;
block|}
end_block

end_unit

