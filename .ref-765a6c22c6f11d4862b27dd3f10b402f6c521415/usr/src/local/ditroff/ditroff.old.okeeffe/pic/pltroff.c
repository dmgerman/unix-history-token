begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* pltroff.c	(Berkeley)	1.4	83/08/15  *	This version has code generators to drive the old-style troff  *	that produces output for the Graphic Systems C/A/T.    *	Very few people actually have a C/A/T; they instead typically  *	use some other typesetter that simulates it.  This is slow and  *	rather silly, but compatibility with the past is important.  *	Or so they say.  Anyway ...   *	The code generator can be turned on to old-style troff by setting  *	the constant OLDTROFF with a #define statement;  this will also  *	have the effect of setting the default typesetter to the C/A/T  *	in a consistent manner.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|dbg
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* this is the place to define OLDTROFF if you're going to */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|OLDTROFF
end_ifdef

begin_define
define|#
directive|define
name|OLDSTYLE
value|1
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|OLDSTYLE
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|n
parameter_list|)
value|(n>= 0 ? n : -(n))
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|((x)>(y) ? (x) : (y))
end_define

begin_define
define|#
directive|define
name|PI
value|3.141592654
end_define

begin_define
define|#
directive|define
name|PI2
value|PI/2
end_define

begin_decl_stmt
specifier|extern
name|int
name|res
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|DX
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* step size in x */
end_comment

begin_decl_stmt
specifier|extern
name|int
name|DY
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* step size in y */
end_comment

begin_decl_stmt
name|int
name|minline
init|=
literal|245
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* draw lines shorter than this with dots on 202 */
end_comment

begin_comment
comment|/* ought to be point-size dependent, but what's that? */
end_comment

begin_comment
comment|/* this is big enough to handle 202 up to 36 points */
end_comment

begin_decl_stmt
name|int
name|drawdot
init|=
literal|'.'
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* character to use when drawing */
end_comment

begin_decl_stmt
name|int
name|useDline
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* if set, produce \D for all lines */
end_comment

begin_decl_stmt
specifier|extern
name|float
name|hshift
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* how much to move left by for text */
end_comment

begin_decl_stmt
specifier|extern
name|float
name|vshift
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* how much down */
end_comment

begin_comment
comment|/* scaling stuff, specific to typesetter */
end_comment

begin_comment
comment|/* defined by s command as X0,Y0 to X1,Y1 */
end_comment

begin_comment
comment|/* output dimensions set by -l,-w options to 0,0 to hmax, vmax */
end_comment

begin_comment
comment|/* default output is 6x6 inches */
end_comment

begin_decl_stmt
name|float
name|xscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|yscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|hpos
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current horizontal position in output coordinate system */
end_comment

begin_decl_stmt
name|int
name|vpos
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current vertical position; 0 is top of page */
end_comment

begin_decl_stmt
name|int
name|htrue
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* where we really are */
end_comment

begin_decl_stmt
name|int
name|vtrue
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|X0
decl_stmt|,
name|Y0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* left bottom of input */
end_comment

begin_decl_stmt
name|float
name|X1
decl_stmt|,
name|Y1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* right top of input */
end_comment

begin_decl_stmt
name|int
name|hmax
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* right end of output */
end_comment

begin_decl_stmt
name|int
name|vmax
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* top of output (down is positive) */
end_comment

begin_decl_stmt
specifier|extern
name|float
name|deltx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|delty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|xbound
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|ybound
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|xmin
decl_stmt|,
name|ymin
decl_stmt|,
name|xmax
decl_stmt|,
name|ymax
decl_stmt|,
name|sxmin
decl_stmt|,
name|symin
decl_stmt|,
name|sxmax
decl_stmt|,
name|symax
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|crop
decl_stmt|;
end_decl_stmt

begin_macro
name|openpl
argument_list|(
argument|s
argument_list|)
end_macro

begin_comment
comment|/* initialize device */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* residue of .PS invocation line */
end_comment

begin_block
block|{
name|float
name|maxdelt
decl_stmt|;
name|hpos
operator|=
name|vpos
operator|=
literal|0
expr_stmt|;
name|hmax
operator|=
name|vmax
operator|=
literal|6
operator|*
name|res
expr_stmt|;
comment|/* default = 6 x 6 */
if|if
condition|(
name|deltx
operator|>
name|xbound
condition|)
block|{
comment|/* default 8 inches */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pic: %g X %g picture shrunk to"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
name|deltx
operator|*=
name|xbound
operator|/
name|deltx
expr_stmt|;
name|delty
operator|*=
name|xbound
operator|/
name|deltx
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" %g X %g\n"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|delty
operator|>
name|ybound
condition|)
block|{
comment|/* default 10 inches */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pic: %g X %g picture shrunk to"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
name|deltx
operator|*=
name|ybound
operator|/
name|delty
expr_stmt|;
name|delty
operator|*=
name|ybound
operator|/
name|delty
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" %g X %g\n"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|deltx
operator|>
literal|0
operator|&&
name|delty
operator|>
literal|0
condition|)
block|{
comment|/* have to change default size */
name|hmax
operator|=
name|res
operator|*
name|deltx
expr_stmt|;
name|vmax
operator|=
name|res
operator|*
name|delty
expr_stmt|;
block|}
if|if
condition|(
name|crop
condition|)
block|{
if|if
condition|(
name|xmax
operator|==
name|xmin
condition|)
name|space
argument_list|(
name|xmin
argument_list|,
name|ymin
argument_list|,
name|xmin
operator|+
name|ymax
operator|-
name|ymin
argument_list|,
name|ymax
argument_list|)
expr_stmt|;
else|else
name|space
argument_list|(
name|xmin
argument_list|,
name|ymin
argument_list|,
name|xmax
argument_list|,
name|ymin
operator|+
name|xmax
operator|-
name|xmin
argument_list|)
expr_stmt|;
comment|/* assumes 1:1 aspect ratio */
block|}
else|else
name|space
argument_list|(
name|sxmin
argument_list|,
name|symin
argument_list|,
name|sxmax
argument_list|,
name|symax
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"... %g %g %g %g %g %g %g %g\n"
argument_list|,
name|xmin
argument_list|,
name|ymin
argument_list|,
name|xmax
argument_list|,
name|ymax
argument_list|,
name|sxmin
argument_list|,
name|symin
argument_list|,
name|sxmax
argument_list|,
name|symax
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"... %du %du %du %du %du %du %du %du\n"
argument_list|,
name|xconv
argument_list|(
name|xmin
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|xmax
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|ymax
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|sxmin
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|symin
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|sxmax
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|symax
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".PS %d %d %s"
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|xmax
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
comment|/* assumes \n comes as part of s */
if|if
condition|(
name|xconv
argument_list|(
name|xmax
argument_list|)
operator|>=
literal|8192
operator|||
name|yconv
argument_list|(
name|ymax
argument_list|)
operator|>=
literal|8192
condition|)
block|{
comment|/* internal troff limit: 13 bits for motion */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"picture too high or wide"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|".br\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|closepl
argument_list|(
argument|type
argument_list|)
end_macro

begin_comment
comment|/* clean up after finished */
end_comment

begin_block
block|{
name|movehv
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* get back to where we started */
if|if
condition|(
name|type
operator|==
literal|'F'
condition|)
name|printf
argument_list|(
literal|".PF\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|".sp 1+%du\n"
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".PE\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|move
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_comment
comment|/* go to position x, y in external coords */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hgoto
argument_list|(
name|xconv
argument_list|(
name|x
argument_list|)
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|yconv
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|movehv
argument_list|(
argument|h
argument_list|,
argument|v
argument_list|)
end_macro

begin_comment
comment|/* go to internal position h, v */
end_comment

begin_decl_stmt
name|int
name|h
decl_stmt|,
name|v
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hgoto
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|v
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|hmot
argument_list|(
argument|n
argument_list|)
end_macro

begin_comment
comment|/* generate n units of horizontal motion */
end_comment

begin_decl_stmt
name|int
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hpos
operator|+=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|vmot
argument_list|(
argument|n
argument_list|)
end_macro

begin_comment
comment|/* generate n units of vertical motion */
end_comment

begin_decl_stmt
name|int
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|vpos
operator|+=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|hgoto
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
name|hpos
operator|=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|vgoto
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
name|vpos
operator|=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|hvflush
argument_list|()
end_macro

begin_comment
comment|/* get to proper point for output */
end_comment

begin_block
block|{
if|if
condition|(
name|hpos
operator|!=
name|htrue
condition|)
block|{
name|printf
argument_list|(
literal|"\\h'%du'"
argument_list|,
name|hpos
operator|-
name|htrue
argument_list|)
expr_stmt|;
name|htrue
operator|=
name|hpos
expr_stmt|;
block|}
if|if
condition|(
name|vpos
operator|!=
name|vtrue
condition|)
block|{
name|printf
argument_list|(
literal|"\\v'%du'"
argument_list|,
name|vpos
operator|-
name|vtrue
argument_list|)
expr_stmt|;
name|vtrue
operator|=
name|vpos
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|flyback
argument_list|()
end_macro

begin_comment
comment|/* return to upper left corner (entry point) */
end_comment

begin_block
block|{
name|printf
argument_list|(
literal|".sp -1\n"
argument_list|)
expr_stmt|;
name|htrue
operator|=
name|vtrue
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|troff
argument_list|(
argument|s
argument_list|)
end_macro

begin_comment
comment|/* output troff right here */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|label
argument_list|(
argument|s
argument_list|,
argument|t
argument_list|,
argument|nh
argument_list|)
end_macro

begin_comment
comment|/* text s of type t nh half-lines up */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|t
decl_stmt|,
name|nh
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|q
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\h'-%.1fm'\\v'%.1fm'"
argument_list|,
name|hshift
argument_list|,
name|vshift
argument_list|)
expr_stmt|;
comment|/* shift down and left */
comment|/*  .3 .3 is best for PO in circuit diagrams */
if|if
condition|(
name|t
operator|==
literal|'A'
condition|)
name|nh
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|t
operator|==
literal|'B'
condition|)
name|nh
operator|--
expr_stmt|;
if|if
condition|(
name|nh
condition|)
name|printf
argument_list|(
literal|"\\v'%du*\\n(.vu/2u'"
argument_list|,
operator|-
name|nh
argument_list|)
expr_stmt|;
comment|/* just in case the text contains a quote: */
name|q
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|p
operator|=
name|s
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
if|if
condition|(
operator|*
name|p
operator|==
literal|'\''
condition|)
block|{
name|q
operator|=
literal|1
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|t
condition|)
block|{
case|case
literal|'L'
case|:
default|default:
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'C'
case|:
case|case
literal|'A'
case|:
case|case
literal|'B'
case|:
if|if
condition|(
name|q
condition|)
name|printf
argument_list|(
literal|"\\h\\(ts-\\w\\(ts%s\\(tsu/2u\\(ts%s\\h\\(ts-\\w\\(ts%s\\(tsu/2u\\(ts"
argument_list|,
name|s
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\h'-\\w'%s'u/2u'%s\\h'-\\w'%s'u/2u'"
argument_list|,
name|s
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'R'
case|:
if|if
condition|(
name|q
condition|)
name|printf
argument_list|(
literal|"\\h\\(ts-\\w\\(ts%s\\(tsu\\(ts%s"
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\h'-\\w'%s'u'%s"
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* don't need these if flyback called immediately */
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|line
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_comment
comment|/* draw line from x0,y0 to x1,y1 */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|arrow
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|,
argument|w
argument_list|,
argument|h
argument_list|)
end_macro

begin_comment
comment|/* draw arrow (without line), head wid w& len h */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|double
name|alpha
decl_stmt|,
name|rot
decl_stmt|,
name|hyp
decl_stmt|;
name|float
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|rot
operator|=
name|atan2
argument_list|(
name|w
operator|/
literal|2
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|hyp
operator|=
name|sqrt
argument_list|(
name|w
operator|/
literal|2
operator|*
name|w
operator|/
literal|2
operator|+
name|h
operator|*
name|h
argument_list|)
expr_stmt|;
name|alpha
operator|=
name|atan2
argument_list|(
name|y1
operator|-
name|y0
argument_list|,
name|x1
operator|-
name|x0
argument_list|)
expr_stmt|;
if|if
condition|(
name|dbg
condition|)
name|printf
argument_list|(
literal|"rot=%f, hyp=%f, alpha=%f\n"
argument_list|,
name|rot
argument_list|,
name|hyp
argument_list|,
name|alpha
argument_list|)
expr_stmt|;
name|dx
operator|=
name|hyp
operator|*
name|cos
argument_list|(
name|alpha
operator|+
name|PI
operator|+
name|rot
argument_list|)
expr_stmt|;
name|dy
operator|=
name|hyp
operator|*
name|sin
argument_list|(
name|alpha
operator|+
name|PI
operator|+
name|rot
argument_list|)
expr_stmt|;
if|if
condition|(
name|dbg
condition|)
name|printf
argument_list|(
literal|"dx,dy = %g,%g\n"
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|line
argument_list|(
name|x1
operator|+
name|dx
argument_list|,
name|y1
operator|+
name|dy
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|dx
operator|=
name|hyp
operator|*
name|cos
argument_list|(
name|alpha
operator|+
name|PI
operator|-
name|rot
argument_list|)
expr_stmt|;
name|dy
operator|=
name|hyp
operator|*
name|sin
argument_list|(
name|alpha
operator|+
name|PI
operator|-
name|rot
argument_list|)
expr_stmt|;
if|if
condition|(
name|dbg
condition|)
name|printf
argument_list|(
literal|"dx,dy = %g,%g\n"
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|line
argument_list|(
name|x1
operator|+
name|dx
argument_list|,
name|y1
operator|+
name|dy
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|box
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x0
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|cont
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_comment
comment|/* continue line from here to x,y */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|h1
decl_stmt|,
name|v1
decl_stmt|;
name|int
name|dh
decl_stmt|,
name|dv
decl_stmt|;
name|h1
operator|=
name|xconv
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|v1
operator|=
name|yconv
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|dh
operator|=
name|h1
operator|-
name|hpos
expr_stmt|;
name|dv
operator|=
name|v1
operator|-
name|vpos
expr_stmt|;
name|downsize
argument_list|()
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|useDline
operator|&&
name|dv
operator|==
literal|0
operator|&&
name|abs
argument_list|(
name|dh
argument_list|)
operator|>
name|minline
condition|)
comment|/* horizontal */
name|printf
argument_list|(
literal|"\\l'%du'\n"
argument_list|,
name|dh
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|useDline
operator|&&
name|dh
operator|==
literal|0
operator|&&
name|abs
argument_list|(
name|dv
argument_list|)
operator|>
name|minline
condition|)
block|{
comment|/* vertical */
name|printf
argument_list|(
literal|"\\v'-.25m'\\L'%du\\(br'\\v'.25m'\n"
argument_list|,
name|dv
argument_list|)
expr_stmt|;
comment|/* add -.25m correction if use \(br */
block|}
else|else
block|{
if|if
condition|(
name|OLDSTYLE
condition|)
name|drawline
argument_list|(
name|dh
argument_list|,
name|dv
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\D'l%du %du'\n"
argument_list|,
name|dh
argument_list|,
name|dv
argument_list|)
expr_stmt|;
block|}
name|upsize
argument_list|()
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
comment|/* expensive */
name|hpos
operator|=
name|h1
expr_stmt|;
name|vpos
operator|=
name|v1
expr_stmt|;
block|}
end_block

begin_macro
name|circle
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|r
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|r
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|d
decl_stmt|;
name|downsize
argument_list|()
expr_stmt|;
name|d
operator|=
name|xsc
argument_list|(
literal|2
operator|*
name|r
argument_list|)
expr_stmt|;
name|move
argument_list|(
name|x
operator|-
name|r
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
name|drawcircle
argument_list|(
name|d
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\D'c%du'\n"
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|upsize
argument_list|()
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|spline
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|n
argument_list|,
argument|p
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|char
name|temp
index|[
literal|1000
index|]
decl_stmt|;
name|downsize
argument_list|()
expr_stmt|;
name|move
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|temp
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
operator|*
name|n
condition|;
name|i
operator|+=
literal|2
control|)
block|{
name|dx
operator|=
name|xsc
argument_list|(
name|p
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|dy
operator|=
name|ysc
argument_list|(
name|p
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
operator|&
name|temp
index|[
name|strlen
argument_list|(
name|temp
argument_list|)
index|]
argument_list|,
literal|" %d %d"
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
block|}
name|drawspline
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\\D'~"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
operator|*
name|n
condition|;
name|i
operator|+=
literal|2
control|)
block|{
name|dx
operator|=
name|xsc
argument_list|(
name|p
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|dy
operator|=
name|ysc
argument_list|(
name|p
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %du %du"
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"'\n"
argument_list|)
expr_stmt|;
block|}
name|upsize
argument_list|()
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ellipse
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|r1
argument_list|,
argument|r2
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|r1
decl_stmt|,
name|r2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|ir1
decl_stmt|,
name|ir2
decl_stmt|;
name|downsize
argument_list|()
expr_stmt|;
name|move
argument_list|(
name|x
operator|-
name|r1
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|ir1
operator|=
name|xsc
argument_list|(
name|r1
argument_list|)
expr_stmt|;
name|ir2
operator|=
name|ysc
argument_list|(
name|r2
argument_list|)
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
name|drawellipse
argument_list|(
literal|2
operator|*
name|ir1
argument_list|,
literal|2
operator|*
name|abs
argument_list|(
name|ir2
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\D'e%du %du'\n"
argument_list|,
literal|2
operator|*
name|ir1
argument_list|,
literal|2
operator|*
name|abs
argument_list|(
name|ir2
argument_list|)
argument_list|)
expr_stmt|;
name|upsize
argument_list|()
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|arc
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|,
argument|r
argument_list|)
end_macro

begin_comment
comment|/* draw arc with center x,y */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|r
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|downsize
argument_list|()
expr_stmt|;
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|drawarc
argument_list|(
name|xsc
argument_list|(
name|x1
operator|-
name|x0
argument_list|)
argument_list|,
name|ysc
argument_list|(
name|y1
operator|-
name|y0
argument_list|)
argument_list|,
name|xsc
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\\D'a%du %du %du %du'\n"
argument_list|,
name|xsc
argument_list|(
name|x
operator|-
name|x0
argument_list|)
argument_list|,
name|ysc
argument_list|(
name|y
operator|-
name|y0
argument_list|)
argument_list|,
name|xsc
argument_list|(
name|x1
operator|-
name|x
argument_list|)
argument_list|,
name|ysc
argument_list|(
name|y1
operator|-
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|upsize
argument_list|()
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|erase
argument_list|()
end_macro

begin_comment
comment|/* get to bottom of frame */
end_comment

begin_block
block|{
return|return;
comment|/* for now, ignore them */
block|}
end_block

begin_macro
name|point
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_comment
comment|/* put point at x,y */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|char
modifier|*
name|temp
init|=
literal|"."
decl_stmt|;
name|move
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|label
argument_list|(
name|temp
argument_list|,
literal|'L'
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|space
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_comment
comment|/* set limits of page */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|x0
operator|==
name|x1
condition|)
name|x1
operator|=
name|x0
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|y0
operator|==
name|y1
condition|)
name|y1
operator|=
name|y0
operator|-
literal|1
expr_stmt|;
comment|/* kludge */
name|X0
operator|=
name|x0
expr_stmt|;
name|Y0
operator|=
name|y0
expr_stmt|;
name|X1
operator|=
name|x1
expr_stmt|;
name|Y1
operator|=
name|y1
expr_stmt|;
name|xscale
operator|=
name|hmax
operator|/
operator|(
name|X1
operator|-
name|X0
operator|)
expr_stmt|;
name|yscale
operator|=
name|vmax
operator|/
operator|(
name|Y0
operator|-
name|Y1
operator|)
expr_stmt|;
block|}
end_block

begin_macro
name|xconv
argument_list|(
argument|x
argument_list|)
end_macro

begin_comment
comment|/* convert x from external to internal form */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|v
decl_stmt|;
name|v
operator|=
operator|(
name|x
operator|-
name|X0
operator|)
operator|*
name|xscale
operator|+
literal|0.5
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|v
operator|=
operator|(
name|v
operator|+
name|DX
operator|-
literal|1
operator|)
operator|/
name|DX
expr_stmt|;
name|v
operator|*=
name|DX
expr_stmt|;
block|}
return|return
name|v
return|;
block|}
end_block

begin_macro
name|xsc
argument_list|(
argument|x
argument_list|)
end_macro

begin_comment
comment|/* convert x from external to internal form, scaling only */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|v
decl_stmt|;
name|v
operator|=
operator|(
name|x
operator|)
operator|*
name|xscale
operator|+
literal|0.5
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|v
operator|=
operator|(
name|v
operator|+
name|DX
operator|-
literal|1
operator|)
operator|/
name|DX
expr_stmt|;
name|v
operator|*=
name|DX
expr_stmt|;
block|}
return|return
name|v
return|;
block|}
end_block

begin_macro
name|yconv
argument_list|(
argument|y
argument_list|)
end_macro

begin_comment
comment|/* convert y from external to internal form */
end_comment

begin_decl_stmt
name|float
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|v
decl_stmt|;
name|y
operator|+=
name|Y1
operator|-
name|ymax
expr_stmt|;
name|v
operator|=
operator|(
name|y
operator|-
name|Y1
operator|)
operator|*
name|yscale
operator|+
literal|0.5
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|v
operator|=
operator|(
name|v
operator|+
name|DY
operator|-
literal|1
operator|)
operator|/
name|DY
expr_stmt|;
name|v
operator|*=
name|DY
expr_stmt|;
block|}
return|return
name|v
return|;
block|}
end_block

begin_macro
name|ysc
argument_list|(
argument|y
argument_list|)
end_macro

begin_comment
comment|/* convert y from external to internal form, scaling only */
end_comment

begin_decl_stmt
name|float
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|v
decl_stmt|;
name|v
operator|=
operator|(
name|y
operator|)
operator|*
name|yscale
operator|+
literal|0.5
expr_stmt|;
if|if
condition|(
name|OLDSTYLE
condition|)
block|{
name|v
operator|=
operator|(
name|v
operator|+
name|DY
operator|-
literal|1
operator|)
operator|/
name|DY
expr_stmt|;
name|v
operator|*=
name|DY
expr_stmt|;
block|}
return|return
name|v
return|;
block|}
end_block

begin_macro
name|linemod
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

begin_macro
name|dot
argument_list|()
end_macro

begin_block
block|{
name|hvflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\&.\n"
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_ifndef
ifndef|#
directive|ifndef
name|OLDTROFF
end_ifndef

begin_comment
comment|/* satisfy the loader... */
end_comment

begin_macro
name|drawline
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|drawcircle
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|drawspline
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|drawellipse
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|drawarc
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|upsize
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_macro
name|downsize
argument_list|()
end_macro

begin_block
block|{
empty_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|OLDTROFF
end_ifdef

begin_comment
comment|/* these are for real */
end_comment

begin_decl_stmt
name|int
name|drawsize
init|=
literal|2
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* shrink point size by this factor */
end_comment

begin_define
define|#
directive|define
name|sgn
parameter_list|(
name|n
parameter_list|)
value|((n> 0) ? 1 : ((n< 0) ? -1 : 0))
end_define

begin_define
define|#
directive|define
name|arcmove
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|{ hgoto(x); vmot(-vpos-(y)); }
end_define

begin_macro
name|put1
argument_list|(
argument|c
argument_list|)
end_macro

begin_comment
comment|/* output one character, usually a dot */
end_comment

begin_block
block|{
specifier|static
name|int
name|nput
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|nput
operator|++
operator|>
literal|100
condition|)
block|{
comment|/* crude approx: troff input buffer ~ 400 */
name|nput
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* someday this will give a spurious break */
name|flyback
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
block|}
name|hvflush
argument_list|()
expr_stmt|;
comment|/* crude! */
name|printf
argument_list|(
literal|"\\z%c"
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|downsize
argument_list|()
end_macro

begin_comment
comment|/* set size lower to make it lighter */
end_comment

begin_block
block|{
if|if
condition|(
name|drawsize
operator|!=
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|".nr .. \\n(.s/%d\n"
argument_list|,
name|drawsize
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".ps \\n(..\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|upsize
argument_list|()
end_macro

begin_comment
comment|/* undo downsize */
end_comment

begin_block
block|{
name|printf
argument_list|(
literal|".ps\n"
argument_list|)
expr_stmt|;
comment|/* God help anyone who fiddles .ps */
block|}
end_block

begin_macro
name|drawline
argument_list|(
argument|dx
argument_list|,
argument|dy
argument_list|)
end_macro

begin_comment
comment|/* draw line from here to dx, dy */
end_comment

begin_decl_stmt
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|xd
decl_stmt|,
name|yd
decl_stmt|;
name|float
name|val
decl_stmt|,
name|slope
decl_stmt|;
name|int
name|i
decl_stmt|,
name|numdots
decl_stmt|;
name|int
name|dirmot
decl_stmt|,
name|perp
decl_stmt|;
name|int
name|motincr
decl_stmt|,
name|perpincr
decl_stmt|;
name|int
name|ohpos
decl_stmt|,
name|ovpos
decl_stmt|,
name|osize
decl_stmt|;
name|float
name|incrway
decl_stmt|;
name|ohpos
operator|=
name|hpos
expr_stmt|;
name|ovpos
operator|=
name|vpos
expr_stmt|;
name|xd
operator|=
name|dx
operator|/
name|DX
expr_stmt|;
name|yd
operator|=
name|dy
operator|/
name|DX
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
if|if
condition|(
name|xd
operator|==
literal|0
condition|)
block|{
name|numdots
operator|=
name|abs
argument_list|(
name|yd
argument_list|)
expr_stmt|;
name|motincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|yd
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numdots
condition|;
name|i
operator|++
control|)
block|{
name|vmot
argument_list|(
name|motincr
argument_list|)
expr_stmt|;
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
block|}
name|vgoto
argument_list|(
name|ovpos
operator|+
name|dy
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|yd
operator|==
literal|0
condition|)
block|{
name|numdots
operator|=
name|abs
argument_list|(
name|xd
argument_list|)
expr_stmt|;
name|motincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|xd
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numdots
condition|;
name|i
operator|++
control|)
block|{
name|hmot
argument_list|(
name|motincr
argument_list|)
expr_stmt|;
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
block|}
name|hgoto
argument_list|(
name|ohpos
operator|+
name|dx
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|abs
argument_list|(
name|xd
argument_list|)
operator|>
name|abs
argument_list|(
name|yd
argument_list|)
condition|)
block|{
name|val
operator|=
name|slope
operator|=
operator|(
name|float
operator|)
name|xd
operator|/
name|yd
expr_stmt|;
name|numdots
operator|=
name|abs
argument_list|(
name|xd
argument_list|)
expr_stmt|;
name|dirmot
operator|=
literal|'h'
expr_stmt|;
name|perp
operator|=
literal|'v'
expr_stmt|;
name|motincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|xd
argument_list|)
expr_stmt|;
name|perpincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|yd
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val
operator|=
name|slope
operator|=
operator|(
name|float
operator|)
name|yd
operator|/
name|xd
expr_stmt|;
name|numdots
operator|=
name|abs
argument_list|(
name|yd
argument_list|)
expr_stmt|;
name|dirmot
operator|=
literal|'v'
expr_stmt|;
name|perp
operator|=
literal|'h'
expr_stmt|;
name|motincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|yd
argument_list|)
expr_stmt|;
name|perpincr
operator|=
name|DX
operator|*
name|sgn
argument_list|(
name|xd
argument_list|)
expr_stmt|;
block|}
name|incrway
operator|=
name|sgn
argument_list|(
operator|(
name|int
operator|)
name|slope
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numdots
condition|;
name|i
operator|++
control|)
block|{
name|val
operator|-=
name|incrway
expr_stmt|;
if|if
condition|(
name|dirmot
operator|==
literal|'h'
condition|)
name|hmot
argument_list|(
name|motincr
argument_list|)
expr_stmt|;
else|else
name|vmot
argument_list|(
name|motincr
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|*
name|slope
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|perp
operator|==
literal|'h'
condition|)
name|hmot
argument_list|(
name|perpincr
argument_list|)
expr_stmt|;
else|else
name|vmot
argument_list|(
name|perpincr
argument_list|)
expr_stmt|;
name|val
operator|+=
name|slope
expr_stmt|;
block|}
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
block|}
name|hgoto
argument_list|(
name|ohpos
operator|+
name|dx
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|ovpos
operator|+
name|dy
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|drawspline
argument_list|(
argument|s
argument_list|)
end_macro

begin_comment
comment|/* draw spline curve */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
index|[
literal|50
index|]
decl_stmt|,
name|y
index|[
literal|50
index|]
decl_stmt|,
name|xp
decl_stmt|,
name|yp
decl_stmt|,
name|pxp
decl_stmt|,
name|pyp
decl_stmt|;
name|float
name|t1
decl_stmt|,
name|t2
decl_stmt|,
name|t3
decl_stmt|,
name|w
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|steps
decl_stmt|,
name|N
decl_stmt|,
name|prevsteps
decl_stmt|;
name|N
operator|=
name|sscanf
argument_list|(
name|s
argument_list|,
literal|"%d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d  %d %d "
argument_list|,
operator|&
name|x
index|[
literal|2
index|]
argument_list|,
operator|&
name|y
index|[
literal|2
index|]
argument_list|,
operator|&
name|x
index|[
literal|3
index|]
argument_list|,
operator|&
name|y
index|[
literal|3
index|]
argument_list|,
operator|&
name|x
index|[
literal|4
index|]
argument_list|,
operator|&
name|y
index|[
literal|4
index|]
argument_list|,
operator|&
name|x
index|[
literal|5
index|]
argument_list|,
operator|&
name|y
index|[
literal|5
index|]
argument_list|,
operator|&
name|x
index|[
literal|6
index|]
argument_list|,
operator|&
name|y
index|[
literal|6
index|]
argument_list|,
operator|&
name|x
index|[
literal|7
index|]
argument_list|,
operator|&
name|y
index|[
literal|7
index|]
argument_list|,
operator|&
name|x
index|[
literal|8
index|]
argument_list|,
operator|&
name|y
index|[
literal|8
index|]
argument_list|,
operator|&
name|x
index|[
literal|9
index|]
argument_list|,
operator|&
name|y
index|[
literal|9
index|]
argument_list|,
operator|&
name|x
index|[
literal|10
index|]
argument_list|,
operator|&
name|y
index|[
literal|10
index|]
argument_list|,
operator|&
name|x
index|[
literal|11
index|]
argument_list|,
operator|&
name|y
index|[
literal|11
index|]
argument_list|,
operator|&
name|x
index|[
literal|12
index|]
argument_list|,
operator|&
name|y
index|[
literal|12
index|]
argument_list|,
operator|&
name|x
index|[
literal|13
index|]
argument_list|,
operator|&
name|y
index|[
literal|13
index|]
argument_list|,
operator|&
name|x
index|[
literal|14
index|]
argument_list|,
operator|&
name|y
index|[
literal|14
index|]
argument_list|,
operator|&
name|x
index|[
literal|15
index|]
argument_list|,
operator|&
name|y
index|[
literal|15
index|]
argument_list|,
operator|&
name|x
index|[
literal|16
index|]
argument_list|,
operator|&
name|y
index|[
literal|16
index|]
argument_list|,
operator|&
name|x
index|[
literal|17
index|]
argument_list|,
operator|&
name|y
index|[
literal|17
index|]
argument_list|,
operator|&
name|x
index|[
literal|18
index|]
argument_list|,
operator|&
name|y
index|[
literal|18
index|]
argument_list|,
operator|&
name|x
index|[
literal|19
index|]
argument_list|,
operator|&
name|y
index|[
literal|19
index|]
argument_list|,
operator|&
name|x
index|[
literal|20
index|]
argument_list|,
operator|&
name|y
index|[
literal|20
index|]
argument_list|,
operator|&
name|x
index|[
literal|21
index|]
argument_list|,
operator|&
name|y
index|[
literal|21
index|]
argument_list|,
operator|&
name|x
index|[
literal|22
index|]
argument_list|,
operator|&
name|y
index|[
literal|22
index|]
argument_list|,
operator|&
name|x
index|[
literal|23
index|]
argument_list|,
operator|&
name|y
index|[
literal|23
index|]
argument_list|,
operator|&
name|x
index|[
literal|24
index|]
argument_list|,
operator|&
name|y
index|[
literal|24
index|]
argument_list|,
operator|&
name|x
index|[
literal|25
index|]
argument_list|,
operator|&
name|y
index|[
literal|25
index|]
argument_list|,
operator|&
name|x
index|[
literal|26
index|]
argument_list|,
operator|&
name|y
index|[
literal|26
index|]
argument_list|,
operator|&
name|x
index|[
literal|27
index|]
argument_list|,
operator|&
name|y
index|[
literal|27
index|]
argument_list|,
operator|&
name|x
index|[
literal|28
index|]
argument_list|,
operator|&
name|y
index|[
literal|28
index|]
argument_list|,
operator|&
name|x
index|[
literal|29
index|]
argument_list|,
operator|&
name|y
index|[
literal|29
index|]
argument_list|,
operator|&
name|x
index|[
literal|30
index|]
argument_list|,
operator|&
name|y
index|[
literal|30
index|]
argument_list|,
operator|&
name|x
index|[
literal|31
index|]
argument_list|,
operator|&
name|y
index|[
literal|31
index|]
argument_list|,
operator|&
name|x
index|[
literal|32
index|]
argument_list|,
operator|&
name|y
index|[
literal|32
index|]
argument_list|,
operator|&
name|x
index|[
literal|33
index|]
argument_list|,
operator|&
name|y
index|[
literal|33
index|]
argument_list|,
operator|&
name|x
index|[
literal|34
index|]
argument_list|,
operator|&
name|y
index|[
literal|34
index|]
argument_list|,
operator|&
name|x
index|[
literal|35
index|]
argument_list|,
operator|&
name|y
index|[
literal|35
index|]
argument_list|,
operator|&
name|x
index|[
literal|36
index|]
argument_list|,
operator|&
name|y
index|[
literal|36
index|]
argument_list|,
operator|&
name|x
index|[
literal|37
index|]
argument_list|,
operator|&
name|y
index|[
literal|37
index|]
argument_list|)
expr_stmt|;
name|N
operator|=
name|N
operator|/
literal|2
operator|+
literal|2
expr_stmt|;
name|x
index|[
literal|0
index|]
operator|=
name|x
index|[
literal|1
index|]
operator|=
name|hpos
expr_stmt|;
name|y
index|[
literal|0
index|]
operator|=
name|y
index|[
literal|1
index|]
operator|=
name|vpos
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|N
condition|;
name|i
operator|++
control|)
block|{
name|x
index|[
name|i
operator|+
literal|1
index|]
operator|+=
name|x
index|[
name|i
index|]
expr_stmt|;
name|y
index|[
name|i
operator|+
literal|1
index|]
operator|+=
name|y
index|[
name|i
index|]
expr_stmt|;
block|}
name|x
index|[
name|N
index|]
operator|=
name|x
index|[
name|N
operator|-
literal|1
index|]
expr_stmt|;
name|y
index|[
name|N
index|]
operator|=
name|y
index|[
name|N
operator|-
literal|1
index|]
expr_stmt|;
name|prevsteps
operator|=
literal|0
expr_stmt|;
name|pxp
operator|=
name|pyp
operator|=
operator|-
literal|9999
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
comment|/* interval */
name|steps
operator|=
operator|(
name|dist
argument_list|(
name|x
index|[
name|i
index|]
argument_list|,
name|y
index|[
name|i
index|]
argument_list|,
name|x
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|y
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
operator|+
name|dist
argument_list|(
name|x
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|y
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|x
index|[
name|i
operator|+
literal|2
index|]
argument_list|,
name|y
index|[
name|i
operator|+
literal|2
index|]
argument_list|)
operator|)
operator|/
literal|2
expr_stmt|;
name|steps
operator|/=
name|DX
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|steps
condition|;
name|j
operator|++
control|)
block|{
comment|/* points within */
name|w
operator|=
operator|(
name|float
operator|)
name|j
operator|/
name|steps
expr_stmt|;
name|t1
operator|=
literal|0.5
operator|*
name|w
operator|*
name|w
expr_stmt|;
name|w
operator|=
name|w
operator|-
literal|0.5
expr_stmt|;
name|t2
operator|=
literal|0.75
operator|-
name|w
operator|*
name|w
expr_stmt|;
name|w
operator|=
name|w
operator|-
literal|0.5
expr_stmt|;
name|t3
operator|=
literal|0.5
operator|*
name|w
operator|*
name|w
expr_stmt|;
name|xp
operator|=
name|t1
operator|*
name|x
index|[
name|i
operator|+
literal|2
index|]
operator|+
name|t2
operator|*
name|x
index|[
name|i
operator|+
literal|1
index|]
operator|+
name|t3
operator|*
name|x
index|[
name|i
index|]
operator|+
literal|0.5
expr_stmt|;
name|yp
operator|=
name|t1
operator|*
name|y
index|[
name|i
operator|+
literal|2
index|]
operator|+
name|t2
operator|*
name|y
index|[
name|i
operator|+
literal|1
index|]
operator|+
name|t3
operator|*
name|y
index|[
name|i
index|]
operator|+
literal|0.5
expr_stmt|;
name|xp
operator|=
name|round
argument_list|(
name|xp
argument_list|,
name|DX
argument_list|)
expr_stmt|;
name|yp
operator|=
name|round
argument_list|(
name|yp
argument_list|,
name|DY
argument_list|)
expr_stmt|;
if|if
condition|(
name|xp
operator|!=
name|pxp
operator|||
name|yp
operator|!=
name|pyp
condition|)
block|{
name|hgoto
argument_list|(
name|xp
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|yp
argument_list|)
expr_stmt|;
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
name|pxp
operator|=
name|xp
expr_stmt|;
name|pyp
operator|=
name|yp
expr_stmt|;
block|}
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|drawcirc
argument_list|(
argument|d
argument_list|)
end_macro

begin_block
block|{
name|int
name|xc
decl_stmt|,
name|yc
decl_stmt|;
name|xc
operator|=
name|hpos
expr_stmt|;
name|yc
operator|=
name|vpos
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
name|conicarc
argument_list|(
name|hpos
operator|+
name|d
operator|/
literal|2
argument_list|,
operator|-
name|vpos
argument_list|,
name|hpos
argument_list|,
operator|-
name|vpos
argument_list|,
name|hpos
argument_list|,
operator|-
name|vpos
argument_list|,
name|d
operator|/
literal|2
argument_list|,
name|d
operator|/
literal|2
argument_list|)
expr_stmt|;
name|hgoto
argument_list|(
name|xc
operator|+
name|d
argument_list|)
expr_stmt|;
comment|/* circle goes to right side */
name|vgoto
argument_list|(
name|yc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dist
argument_list|(
argument|x1
argument_list|,
argument|y1
argument_list|,
argument|x2
argument_list|,
argument|y2
argument_list|)
end_macro

begin_comment
comment|/* integer distance from x1,y1 to x2,y2 */
end_comment

begin_block
block|{
name|float
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|dx
operator|=
name|x2
operator|-
name|x1
expr_stmt|;
name|dy
operator|=
name|y2
operator|-
name|y1
expr_stmt|;
return|return
name|sqrt
argument_list|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
argument_list|)
operator|+
literal|0.5
return|;
block|}
end_block

begin_macro
name|drawarc
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|r
argument_list|)
end_macro

begin_block
block|{
name|int
name|x0
decl_stmt|,
name|y0
decl_stmt|;
name|float
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|phi
decl_stmt|,
name|d
decl_stmt|,
name|ht
decl_stmt|,
name|ang
decl_stmt|;
if|if
condition|(
name|r
operator|==
literal|0
condition|)
name|r
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|r
operator|<
literal|0
condition|)
name|ang
operator|=
name|PI
operator|/
literal|2
expr_stmt|;
else|else
name|ang
operator|=
operator|-
operator|(
name|PI
operator|/
literal|2
operator|)
expr_stmt|;
name|dx
operator|=
name|x
operator|/
literal|2
expr_stmt|;
name|dy
operator|=
name|y
operator|/
literal|2
expr_stmt|;
name|phi
operator|=
name|atan2
argument_list|(
name|dy
argument_list|,
name|dx
argument_list|)
operator|+
name|ang
expr_stmt|;
while|while
condition|(
operator|(
name|d
operator|=
operator|(
name|float
operator|)
name|r
operator|*
name|r
operator|-
operator|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
operator|)
operator|)
operator|<
literal|0.0
condition|)
name|r
operator|*=
literal|2
expr_stmt|;
name|ht
operator|=
name|sqrt
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|x0
operator|=
name|hpos
operator|+
name|dx
operator|+
name|ht
operator|*
name|cos
argument_list|(
name|phi
argument_list|)
operator|+
literal|0.5
expr_stmt|;
name|y0
operator|=
name|vpos
operator|+
name|dy
operator|+
name|ht
operator|*
name|sin
argument_list|(
name|phi
argument_list|)
operator|+
literal|0.5
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
name|conicarc
argument_list|(
name|x0
argument_list|,
operator|-
name|y0
argument_list|,
name|hpos
argument_list|,
operator|-
name|vpos
argument_list|,
name|hpos
operator|+
name|x
argument_list|,
operator|-
name|vpos
operator|-
name|y
argument_list|,
name|r
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|drawellip
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_block
block|{
name|int
name|xc
decl_stmt|,
name|yc
decl_stmt|;
name|xc
operator|=
name|hpos
expr_stmt|;
name|yc
operator|=
name|vpos
expr_stmt|;
name|printf
argument_list|(
literal|"\\\&"
argument_list|)
expr_stmt|;
name|conicarc
argument_list|(
name|hpos
operator|+
name|a
operator|/
literal|2
argument_list|,
operator|-
name|vpos
argument_list|,
name|hpos
argument_list|,
operator|-
name|vpos
argument_list|,
name|hpos
argument_list|,
operator|-
name|vpos
argument_list|,
name|a
operator|/
literal|2
argument_list|,
name|b
operator|/
literal|2
argument_list|)
expr_stmt|;
name|hgoto
argument_list|(
name|xc
operator|+
name|a
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|yc
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|sqr
parameter_list|(
name|x
parameter_list|)
value|(long int)(x)*(x)
end_define

begin_macro
name|conicarc
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|,
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_block
block|{
comment|/* based on Bresenham, CACM, Feb 77, pp 102-3 */
comment|/* by Chris Van Wyk */
comment|/* capitalized vars are an internal reference frame */
name|long
name|dotcount
init|=
literal|0
decl_stmt|;
name|int
name|xs
decl_stmt|,
name|ys
decl_stmt|,
name|xt
decl_stmt|,
name|yt
decl_stmt|,
name|Xs
decl_stmt|,
name|Ys
decl_stmt|,
name|qs
decl_stmt|,
name|Xt
decl_stmt|,
name|Yt
decl_stmt|,
name|qt
decl_stmt|,
name|M1x
decl_stmt|,
name|M1y
decl_stmt|,
name|M2x
decl_stmt|,
name|M2y
decl_stmt|,
name|M3x
decl_stmt|,
name|M3y
decl_stmt|,
name|Q
decl_stmt|,
name|move
decl_stmt|,
name|Xc
decl_stmt|,
name|Yc
decl_stmt|;
name|int
name|delta
decl_stmt|;
name|float
name|xc
decl_stmt|,
name|yc
decl_stmt|;
name|float
name|radius
decl_stmt|,
name|slope
decl_stmt|;
name|float
name|xstep
decl_stmt|,
name|ystep
decl_stmt|;
if|if
condition|(
name|a
operator|!=
name|b
condition|)
comment|/* an arc of an ellipse; internally, will still think of circle */
if|if
condition|(
name|a
operator|>
name|b
condition|)
block|{
name|xstep
operator|=
operator|(
name|float
operator|)
name|a
operator|/
name|b
expr_stmt|;
name|ystep
operator|=
literal|1
expr_stmt|;
name|radius
operator|=
name|b
expr_stmt|;
block|}
else|else
block|{
name|xstep
operator|=
literal|1
expr_stmt|;
name|ystep
operator|=
operator|(
name|float
operator|)
name|b
operator|/
name|a
expr_stmt|;
name|radius
operator|=
name|a
expr_stmt|;
block|}
else|else
comment|/* a circular arc; radius is computed from center and first point */
block|{
name|xstep
operator|=
name|ystep
operator|=
literal|1
expr_stmt|;
name|radius
operator|=
name|sqrt
argument_list|(
call|(
name|float
call|)
argument_list|(
name|sqr
argument_list|(
name|x0
operator|-
name|x
argument_list|)
operator|+
name|sqr
argument_list|(
name|y0
operator|-
name|y
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|xc
operator|=
name|x0
expr_stmt|;
name|yc
operator|=
name|y0
expr_stmt|;
comment|/* now, use start and end point locations to figure out    the angle at which start and end happen; use these    angles with known radius to figure out where start    and end should be */
name|slope
operator|=
name|atan2
argument_list|(
call|(
name|double
call|)
argument_list|(
name|y0
operator|-
name|y
argument_list|)
argument_list|,
call|(
name|double
call|)
argument_list|(
name|x0
operator|-
name|x
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|slope
operator|==
literal|0.0
operator|)
operator|&&
operator|(
name|x0
operator|<
name|x
operator|)
condition|)
name|slope
operator|=
literal|3.14159265
expr_stmt|;
name|x0
operator|=
name|x
operator|+
name|radius
operator|*
name|cos
argument_list|(
name|slope
argument_list|)
operator|+
literal|0.5
expr_stmt|;
name|y0
operator|=
name|y
operator|+
name|radius
operator|*
name|sin
argument_list|(
name|slope
argument_list|)
operator|+
literal|0.5
expr_stmt|;
name|slope
operator|=
name|atan2
argument_list|(
call|(
name|double
call|)
argument_list|(
name|y1
operator|-
name|y
argument_list|)
argument_list|,
call|(
name|double
call|)
argument_list|(
name|x1
operator|-
name|x
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|slope
operator|==
literal|0.0
operator|)
operator|&&
operator|(
name|x1
operator|<
name|x
operator|)
condition|)
name|slope
operator|=
literal|3.14159265
expr_stmt|;
name|x1
operator|=
name|x
operator|+
name|radius
operator|*
name|cos
argument_list|(
name|slope
argument_list|)
operator|+
literal|0.5
expr_stmt|;
name|y1
operator|=
name|y
operator|+
name|radius
operator|*
name|sin
argument_list|(
name|slope
argument_list|)
operator|+
literal|0.5
expr_stmt|;
comment|/* step 2: translate to zero-centered circle */
name|xs
operator|=
name|x0
operator|-
name|x
expr_stmt|;
name|ys
operator|=
name|y0
operator|-
name|y
expr_stmt|;
name|xt
operator|=
name|x1
operator|-
name|x
expr_stmt|;
name|yt
operator|=
name|y1
operator|-
name|y
expr_stmt|;
comment|/* step 3: normalize to first quadrant */
if|if
condition|(
name|xs
operator|<
literal|0
condition|)
if|if
condition|(
name|ys
operator|<
literal|0
condition|)
block|{
name|Xs
operator|=
name|abs
argument_list|(
name|ys
argument_list|)
expr_stmt|;
name|Ys
operator|=
name|abs
argument_list|(
name|xs
argument_list|)
expr_stmt|;
name|qs
operator|=
literal|3
expr_stmt|;
name|M1x
operator|=
literal|0
expr_stmt|;
name|M1y
operator|=
operator|-
literal|1
expr_stmt|;
name|M2x
operator|=
literal|1
expr_stmt|;
name|M2y
operator|=
operator|-
literal|1
expr_stmt|;
name|M3x
operator|=
literal|1
expr_stmt|;
name|M3y
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Xs
operator|=
name|abs
argument_list|(
name|xs
argument_list|)
expr_stmt|;
name|Ys
operator|=
name|abs
argument_list|(
name|ys
argument_list|)
expr_stmt|;
name|qs
operator|=
literal|2
expr_stmt|;
name|M1x
operator|=
operator|-
literal|1
expr_stmt|;
name|M1y
operator|=
literal|0
expr_stmt|;
name|M2x
operator|=
operator|-
literal|1
expr_stmt|;
name|M2y
operator|=
operator|-
literal|1
expr_stmt|;
name|M3x
operator|=
literal|0
expr_stmt|;
name|M3y
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ys
operator|<
literal|0
condition|)
block|{
name|Xs
operator|=
name|abs
argument_list|(
name|xs
argument_list|)
expr_stmt|;
name|Ys
operator|=
name|abs
argument_list|(
name|ys
argument_list|)
expr_stmt|;
name|qs
operator|=
literal|0
expr_stmt|;
name|M1x
operator|=
literal|1
expr_stmt|;
name|M1y
operator|=
literal|0
expr_stmt|;
name|M2x
operator|=
literal|1
expr_stmt|;
name|M2y
operator|=
literal|1
expr_stmt|;
name|M3x
operator|=
literal|0
expr_stmt|;
name|M3y
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|Xs
operator|=
name|abs
argument_list|(
name|ys
argument_list|)
expr_stmt|;
name|Ys
operator|=
name|abs
argument_list|(
name|xs
argument_list|)
expr_stmt|;
name|qs
operator|=
literal|1
expr_stmt|;
name|M1x
operator|=
literal|0
expr_stmt|;
name|M1y
operator|=
literal|1
expr_stmt|;
name|M2x
operator|=
operator|-
literal|1
expr_stmt|;
name|M2y
operator|=
literal|1
expr_stmt|;
name|M3x
operator|=
operator|-
literal|1
expr_stmt|;
name|M3y
operator|=
literal|0
expr_stmt|;
block|}
name|Xc
operator|=
name|Xs
expr_stmt|;
name|Yc
operator|=
name|Ys
expr_stmt|;
if|if
condition|(
name|xt
operator|<
literal|0
condition|)
if|if
condition|(
name|yt
operator|<
literal|0
condition|)
block|{
name|Xt
operator|=
name|abs
argument_list|(
name|yt
argument_list|)
expr_stmt|;
name|Yt
operator|=
name|abs
argument_list|(
name|xt
argument_list|)
expr_stmt|;
name|qt
operator|=
literal|3
expr_stmt|;
block|}
else|else
block|{
name|Xt
operator|=
name|abs
argument_list|(
name|xt
argument_list|)
expr_stmt|;
name|Yt
operator|=
name|abs
argument_list|(
name|yt
argument_list|)
expr_stmt|;
name|qt
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|yt
operator|<
literal|0
condition|)
block|{
name|Xt
operator|=
name|abs
argument_list|(
name|xt
argument_list|)
expr_stmt|;
name|Yt
operator|=
name|abs
argument_list|(
name|yt
argument_list|)
expr_stmt|;
name|qt
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Xt
operator|=
name|abs
argument_list|(
name|yt
argument_list|)
expr_stmt|;
name|Yt
operator|=
name|abs
argument_list|(
name|xt
argument_list|)
expr_stmt|;
name|qt
operator|=
literal|1
expr_stmt|;
block|}
comment|/* step 4: calculate number of quadrant crossings */
if|if
condition|(
operator|(
operator|(
literal|4
operator|+
name|qt
operator|-
name|qs
operator|)
operator|%
literal|4
operator|==
literal|0
operator|)
operator|&&
operator|(
name|Xt
operator|<=
name|Xs
operator|)
operator|&&
operator|(
name|Yt
operator|>=
name|Ys
operator|)
condition|)
name|Q
operator|=
literal|3
expr_stmt|;
else|else
name|Q
operator|=
operator|(
literal|4
operator|+
name|qt
operator|-
name|qs
operator|)
operator|%
literal|4
operator|-
literal|1
expr_stmt|;
comment|/* step 5: calculate initial decision difference */
name|delta
operator|=
name|sqr
argument_list|(
name|Xs
operator|+
literal|1
argument_list|)
operator|+
name|sqr
argument_list|(
name|Ys
operator|-
literal|1
argument_list|)
operator|-
name|sqr
argument_list|(
name|xs
argument_list|)
operator|-
name|sqr
argument_list|(
name|ys
argument_list|)
expr_stmt|;
comment|/* here begins the work of drawing    we hope it ends here too */
while|while
condition|(
operator|(
name|Q
operator|>=
literal|0
operator|)
operator|||
operator|(
operator|(
name|Q
operator|>
operator|-
literal|2
operator|)
operator|&&
operator|(
operator|(
name|Xt
operator|>
name|Xc
operator|)
operator|||
operator|(
name|Yt
operator|<
name|Yc
operator|)
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|dotcount
operator|++
operator|%
name|DX
operator|==
literal|0
condition|)
name|putdot
argument_list|(
name|round
argument_list|(
operator|(
name|int
operator|)
name|xc
argument_list|,
name|DX
argument_list|)
argument_list|,
name|round
argument_list|(
operator|(
name|int
operator|)
name|yc
argument_list|,
name|DY
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|Yc
operator|<
literal|0.5
condition|)
block|{
comment|/* reinitialize */
name|Xs
operator|=
name|Xc
operator|=
literal|0
expr_stmt|;
name|Ys
operator|=
name|Yc
operator|=
name|sqrt
argument_list|(
call|(
name|float
call|)
argument_list|(
name|sqr
argument_list|(
name|xs
argument_list|)
operator|+
name|sqr
argument_list|(
name|ys
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|delta
operator|=
name|sqr
argument_list|(
name|Xs
operator|+
literal|1
argument_list|)
operator|+
name|sqr
argument_list|(
name|Ys
operator|-
literal|1
argument_list|)
operator|-
name|sqr
argument_list|(
name|xs
argument_list|)
operator|-
name|sqr
argument_list|(
name|ys
argument_list|)
expr_stmt|;
name|Q
operator|--
expr_stmt|;
name|M1x
operator|=
name|M3x
expr_stmt|;
name|M1y
operator|=
name|M3y
expr_stmt|;
block|{
name|int
name|T
decl_stmt|;
name|T
operator|=
name|M2y
expr_stmt|;
name|M2y
operator|=
name|M2x
expr_stmt|;
name|M2x
operator|=
operator|-
name|T
expr_stmt|;
name|T
operator|=
name|M3y
expr_stmt|;
name|M3y
operator|=
name|M3x
expr_stmt|;
name|M3x
operator|=
operator|-
name|T
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|delta
operator|<=
literal|0
condition|)
if|if
condition|(
literal|2
operator|*
name|delta
operator|+
literal|2
operator|*
name|Yc
operator|-
literal|1
operator|<=
literal|0
condition|)
name|move
operator|=
literal|1
expr_stmt|;
else|else
name|move
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
literal|2
operator|*
name|delta
operator|-
literal|2
operator|*
name|Xc
operator|-
literal|1
operator|<=
literal|0
condition|)
name|move
operator|=
literal|2
expr_stmt|;
else|else
name|move
operator|=
literal|3
expr_stmt|;
switch|switch
condition|(
name|move
condition|)
block|{
case|case
literal|1
case|:
name|Xc
operator|++
expr_stmt|;
name|delta
operator|+=
literal|2
operator|*
name|Xc
operator|+
literal|1
expr_stmt|;
name|xc
operator|+=
name|M1x
operator|*
name|xstep
expr_stmt|;
name|yc
operator|+=
name|M1y
operator|*
name|ystep
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|Xc
operator|++
expr_stmt|;
name|Yc
operator|--
expr_stmt|;
name|delta
operator|+=
literal|2
operator|*
name|Xc
operator|-
literal|2
operator|*
name|Yc
operator|+
literal|2
expr_stmt|;
name|xc
operator|+=
name|M2x
operator|*
name|xstep
expr_stmt|;
name|yc
operator|+=
name|M2y
operator|*
name|ystep
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|Yc
operator|--
expr_stmt|;
name|delta
operator|-=
literal|2
operator|*
name|Yc
operator|+
literal|1
expr_stmt|;
name|xc
operator|+=
name|M3x
operator|*
name|xstep
expr_stmt|;
name|yc
operator|+=
name|M3y
operator|*
name|ystep
expr_stmt|;
break|break;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|putdot
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_block
block|{
name|arcmove
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|put1
argument_list|(
name|drawdot
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|round
argument_list|(
argument|x
argument_list|,
argument|dx
argument_list|)
end_macro

begin_comment
comment|/* round x relative to dx */
end_comment

begin_block
block|{
name|x
operator|=
operator|(
name|x
operator|+
name|dx
operator|-
literal|1
operator|)
operator|/
name|dx
expr_stmt|;
return|return
name|x
operator|*
name|dx
return|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

