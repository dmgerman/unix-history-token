begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * packet.c  *  * dns packet implementation  *  * a Net::DNS like library for C  *  * (c) NLnet Labs, 2004-2006  *  * See the file LICENSE for the license  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<ldns/ldns.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_include
include|#
directive|include
file|<limits.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SSL
end_ifdef

begin_include
include|#
directive|include
file|<openssl/rand.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Access functions   * do this as functions to get type checking  */
end_comment

begin_define
define|#
directive|define
name|LDNS_EDNS_MASK_DO_BIT
value|0x8000
end_define

begin_comment
comment|/* TODO defines for 3600 */
end_comment

begin_comment
comment|/* convert to and from numerical flag values */
end_comment

begin_decl_stmt
name|ldns_lookup_table
name|ldns_edns_flags
index|[]
init|=
block|{
block|{
literal|3600
block|,
literal|"do"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* read */
end_comment

begin_function
name|uint16_t
name|ldns_pkt_id
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_id
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_qr
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_qr
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_aa
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_aa
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_tc
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_tc
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_rd
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_rd
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_cd
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_cd
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_ra
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_ra
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_ad
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_ad
return|;
block|}
end_function

begin_function
name|ldns_pkt_opcode
name|ldns_pkt_get_opcode
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_opcode
return|;
block|}
end_function

begin_function
name|ldns_pkt_rcode
name|ldns_pkt_get_rcode
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_rcode
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_qdcount
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_qdcount
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_ancount
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_ancount
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_nscount
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_nscount
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_arcount
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_header
operator|->
name|_arcount
return|;
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_question
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_question
return|;
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_answer
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_answer
return|;
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_authority
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_authority
return|;
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_additional
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_additional
return|;
block|}
end_function

begin_comment
comment|/* return ALL section concatenated */
end_comment

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_all
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|all
decl_stmt|,
modifier|*
name|prev_all
decl_stmt|;
name|all
operator|=
name|ldns_rr_list_cat_clone
argument_list|(
name|ldns_pkt_question
argument_list|(
name|packet
argument_list|)
argument_list|,
name|ldns_pkt_answer
argument_list|(
name|packet
argument_list|)
argument_list|)
expr_stmt|;
name|prev_all
operator|=
name|all
expr_stmt|;
name|all
operator|=
name|ldns_rr_list_cat_clone
argument_list|(
name|all
argument_list|,
name|ldns_pkt_authority
argument_list|(
name|packet
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|prev_all
argument_list|)
expr_stmt|;
name|prev_all
operator|=
name|all
expr_stmt|;
name|all
operator|=
name|ldns_rr_list_cat_clone
argument_list|(
name|all
argument_list|,
name|ldns_pkt_additional
argument_list|(
name|packet
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|prev_all
argument_list|)
expr_stmt|;
return|return
name|all
return|;
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_all_noquestion
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|all
decl_stmt|,
modifier|*
name|all2
decl_stmt|;
name|all
operator|=
name|ldns_rr_list_cat_clone
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|packet
argument_list|)
argument_list|,
name|ldns_pkt_authority
argument_list|(
name|packet
argument_list|)
argument_list|)
expr_stmt|;
name|all2
operator|=
name|ldns_rr_list_cat_clone
argument_list|(
name|all
argument_list|,
name|ldns_pkt_additional
argument_list|(
name|packet
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|all
argument_list|)
expr_stmt|;
return|return
name|all2
return|;
block|}
end_function

begin_function
name|size_t
name|ldns_pkt_size
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_size
return|;
block|}
end_function

begin_function
name|uint32_t
name|ldns_pkt_querytime
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_querytime
return|;
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_pkt_answerfrom
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_answerfrom
return|;
block|}
end_function

begin_function
name|struct
name|timeval
name|ldns_pkt_timestamp
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|timestamp
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_edns_udp_size
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_edns_udp_size
return|;
block|}
end_function

begin_function
name|uint8_t
name|ldns_pkt_edns_extended_rcode
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_edns_extended_rcode
return|;
block|}
end_function

begin_function
name|uint8_t
name|ldns_pkt_edns_version
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_edns_version
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_edns_z
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_edns_z
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_edns_do
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
operator|(
name|packet
operator|->
name|_edns_z
operator|&
name|LDNS_EDNS_MASK_DO_BIT
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_do
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|value
parameter_list|)
block|{
if|if
condition|(
name|value
condition|)
block|{
name|packet
operator|->
name|_edns_z
operator|=
name|packet
operator|->
name|_edns_z
operator||
name|LDNS_EDNS_MASK_DO_BIT
expr_stmt|;
block|}
else|else
block|{
name|packet
operator|->
name|_edns_z
operator|=
name|packet
operator|->
name|_edns_z
operator|&
operator|~
name|LDNS_EDNS_MASK_DO_BIT
expr_stmt|;
block|}
block|}
end_function

begin_function
name|ldns_rdf
modifier|*
name|ldns_pkt_edns_data
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
return|return
name|packet
operator|->
name|_edns_data
return|;
block|}
end_function

begin_comment
comment|/* return only those rr that share the ownername */
end_comment

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_rr_list_by_name
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_rdf
modifier|*
name|ownername
parameter_list|,
name|ldns_pkt_section
name|sec
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|rrs
decl_stmt|;
name|ldns_rr_list
modifier|*
name|ret
decl_stmt|;
name|uint16_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|rrs
operator|=
name|ldns_pkt_get_section_clone
argument_list|(
name|packet
argument_list|,
name|sec
argument_list|)
expr_stmt|;
name|ret
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|rrs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ldns_rdf_compare
argument_list|(
name|ldns_rr_owner
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|,
name|ownername
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* owner names match */
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
block|{
name|ret
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
block|}
name|ldns_rr_list_push_rr
argument_list|(
name|ret
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/* return only those rr that share a type */
end_comment

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_rr_list_by_type
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_rr_type
name|type
parameter_list|,
name|ldns_pkt_section
name|sec
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|rrs
decl_stmt|;
name|ldns_rr_list
modifier|*
name|new
decl_stmt|;
name|uint16_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|rrs
operator|=
name|ldns_pkt_get_section_clone
argument_list|(
name|packet
argument_list|,
name|sec
argument_list|)
expr_stmt|;
name|new
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|rrs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|type
operator|==
name|ldns_rr_get_type
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
condition|)
block|{
comment|/* types match */
name|ldns_rr_list_push_rr
argument_list|(
name|new
argument_list|,
name|ldns_rr_clone
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|ldns_rr_list_deep_free
argument_list|(
name|rrs
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_rr_list_rr_count
argument_list|(
name|new
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ldns_rr_list_free
argument_list|(
name|new
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
else|else
block|{
return|return
name|new
return|;
block|}
block|}
end_function

begin_comment
comment|/* return only those rrs that share name and type */
end_comment

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_rr_list_by_name_and_type
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
specifier|const
name|ldns_rdf
modifier|*
name|ownername
parameter_list|,
name|ldns_rr_type
name|type
parameter_list|,
name|ldns_pkt_section
name|sec
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|rrs
decl_stmt|;
name|ldns_rr_list
modifier|*
name|new
decl_stmt|;
name|ldns_rr_list
modifier|*
name|ret
decl_stmt|;
name|uint16_t
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|rrs
operator|=
name|ldns_pkt_get_section_clone
argument_list|(
name|packet
argument_list|,
name|sec
argument_list|)
expr_stmt|;
name|new
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
name|ret
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|rrs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|type
operator|==
name|ldns_rr_get_type
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
operator|&&
name|ldns_rdf_compare
argument_list|(
name|ldns_rr_owner
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|,
name|ownername
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* types match */
name|ldns_rr_list_push_rr
argument_list|(
name|new
argument_list|,
name|ldns_rr_clone
argument_list|(
name|ldns_rr_list_rr
argument_list|(
name|rrs
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ret
operator|=
name|new
expr_stmt|;
block|}
block|}
name|ldns_rr_list_deep_free
argument_list|(
name|rrs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
block|{
name|ldns_rr_list_free
argument_list|(
name|new
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_rr
parameter_list|(
name|ldns_pkt
modifier|*
name|pkt
parameter_list|,
name|ldns_pkt_section
name|sec
parameter_list|,
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|bool
name|result
init|=
name|false
decl_stmt|;
switch|switch
condition|(
name|sec
condition|)
block|{
case|case
name|LDNS_SECTION_QUESTION
case|:
return|return
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_question
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANSWER
case|:
return|return
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
return|;
case|case
name|LDNS_SECTION_AUTHORITY
case|:
return|return
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
return|;
case|case
name|LDNS_SECTION_ADDITIONAL
case|:
return|return
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANY
case|:
name|result
operator|=
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_question
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
expr_stmt|;
case|case
name|LDNS_SECTION_ANY_NOQUESTION
case|:
name|result
operator|=
name|result
operator|||
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
operator|||
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
operator|||
name|ldns_rr_list_contains_rr
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|pkt
argument_list|)
argument_list|,
name|rr
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function

begin_function
name|uint16_t
name|ldns_pkt_section_count
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_pkt_section
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|LDNS_SECTION_QUESTION
case|:
return|return
name|ldns_pkt_qdcount
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANSWER
case|:
return|return
name|ldns_pkt_ancount
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_AUTHORITY
case|:
return|return
name|ldns_pkt_nscount
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_ADDITIONAL
case|:
return|return
name|ldns_pkt_arcount
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANY
case|:
return|return
name|ldns_pkt_qdcount
argument_list|(
name|packet
argument_list|)
operator|+
name|ldns_pkt_ancount
argument_list|(
name|packet
argument_list|)
operator|+
name|ldns_pkt_nscount
argument_list|(
name|packet
argument_list|)
operator|+
name|ldns_pkt_arcount
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANY_NOQUESTION
case|:
return|return
name|ldns_pkt_ancount
argument_list|(
name|packet
argument_list|)
operator|+
name|ldns_pkt_nscount
argument_list|(
name|packet
argument_list|)
operator|+
name|ldns_pkt_arcount
argument_list|(
name|packet
argument_list|)
return|;
default|default:
return|return
literal|0
return|;
block|}
block|}
end_function

begin_function
name|bool
name|ldns_pkt_empty
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|)
block|{
if|if
condition|(
operator|!
name|p
condition|)
block|{
return|return
name|true
return|;
comment|/* NULL is empty? */
block|}
if|if
condition|(
name|ldns_pkt_section_count
argument_list|(
name|p
argument_list|,
name|LDNS_SECTION_ANY
argument_list|)
operator|>
literal|0
condition|)
block|{
return|return
name|false
return|;
block|}
else|else
block|{
return|return
name|true
return|;
block|}
block|}
end_function

begin_function
name|ldns_rr_list
modifier|*
name|ldns_pkt_get_section_clone
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_pkt_section
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|LDNS_SECTION_QUESTION
case|:
return|return
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_question
argument_list|(
name|packet
argument_list|)
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANSWER
case|:
return|return
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|packet
argument_list|)
argument_list|)
return|;
case|case
name|LDNS_SECTION_AUTHORITY
case|:
return|return
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|packet
argument_list|)
argument_list|)
return|;
case|case
name|LDNS_SECTION_ADDITIONAL
case|:
return|return
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|packet
argument_list|)
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANY
case|:
comment|/* these are already clones */
return|return
name|ldns_pkt_all
argument_list|(
name|packet
argument_list|)
return|;
case|case
name|LDNS_SECTION_ANY_NOQUESTION
case|:
return|return
name|ldns_pkt_all_noquestion
argument_list|(
name|packet
argument_list|)
return|;
default|default:
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_function
name|ldns_rr
modifier|*
name|ldns_pkt_tsig
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
return|return
name|pkt
operator|->
name|_tsig_rr
return|;
block|}
end_function

begin_comment
comment|/* write */
end_comment

begin_function
name|void
name|ldns_pkt_set_id
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|id
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_id
operator|=
name|id
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_random_id
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
name|uint16_t
name|rid
init|=
name|ldns_get_random
argument_list|()
decl_stmt|;
name|ldns_pkt_set_id
argument_list|(
name|packet
argument_list|,
name|rid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_qr
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|qr
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_qr
operator|=
name|qr
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_aa
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|aa
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_aa
operator|=
name|aa
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_tc
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|tc
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_tc
operator|=
name|tc
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_rd
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|rd
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_rd
operator|=
name|rd
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_additional
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_rr_list
modifier|*
name|rr
parameter_list|)
block|{
name|p
operator|->
name|_additional
operator|=
name|rr
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_question
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_rr_list
modifier|*
name|rr
parameter_list|)
block|{
name|p
operator|->
name|_question
operator|=
name|rr
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_answer
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_rr_list
modifier|*
name|rr
parameter_list|)
block|{
name|p
operator|->
name|_answer
operator|=
name|rr
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_authority
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_rr_list
modifier|*
name|rr
parameter_list|)
block|{
name|p
operator|->
name|_authority
operator|=
name|rr
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_cd
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|cd
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_cd
operator|=
name|cd
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_ra
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|ra
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_ra
operator|=
name|ra
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_ad
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|bool
name|ad
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_ad
operator|=
name|ad
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_opcode
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_pkt_opcode
name|opcode
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_opcode
operator|=
name|opcode
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_rcode
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint8_t
name|rcode
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_rcode
operator|=
name|rcode
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_qdcount
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|qdcount
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_qdcount
operator|=
name|qdcount
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_ancount
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|ancount
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_ancount
operator|=
name|ancount
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_nscount
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|nscount
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_nscount
operator|=
name|nscount
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_arcount
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|arcount
parameter_list|)
block|{
name|packet
operator|->
name|_header
operator|->
name|_arcount
operator|=
name|arcount
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_querytime
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint32_t
name|time
parameter_list|)
block|{
name|packet
operator|->
name|_querytime
operator|=
name|time
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_answerfrom
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_rdf
modifier|*
name|answerfrom
parameter_list|)
block|{
name|packet
operator|->
name|_answerfrom
operator|=
name|answerfrom
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_timestamp
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|struct
name|timeval
name|timeval
parameter_list|)
block|{
name|packet
operator|->
name|timestamp
operator|.
name|tv_sec
operator|=
name|timeval
operator|.
name|tv_sec
expr_stmt|;
name|packet
operator|->
name|timestamp
operator|.
name|tv_usec
operator|=
name|timeval
operator|.
name|tv_usec
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_size
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|size_t
name|s
parameter_list|)
block|{
name|packet
operator|->
name|_size
operator|=
name|s
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_udp_size
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|s
parameter_list|)
block|{
name|packet
operator|->
name|_edns_udp_size
operator|=
name|s
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_extended_rcode
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint8_t
name|c
parameter_list|)
block|{
name|packet
operator|->
name|_edns_extended_rcode
operator|=
name|c
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_version
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint8_t
name|v
parameter_list|)
block|{
name|packet
operator|->
name|_edns_version
operator|=
name|v
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_z
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|z
parameter_list|)
block|{
name|packet
operator|->
name|_edns_z
operator|=
name|z
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_edns_data
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_rdf
modifier|*
name|data
parameter_list|)
block|{
name|packet
operator|->
name|_edns_data
operator|=
name|data
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_section_count
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_pkt_section
name|s
parameter_list|,
name|uint16_t
name|count
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|LDNS_SECTION_QUESTION
case|:
name|ldns_pkt_set_qdcount
argument_list|(
name|packet
argument_list|,
name|count
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ANSWER
case|:
name|ldns_pkt_set_ancount
argument_list|(
name|packet
argument_list|,
name|count
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_AUTHORITY
case|:
name|ldns_pkt_set_nscount
argument_list|(
name|packet
argument_list|,
name|count
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ADDITIONAL
case|:
name|ldns_pkt_set_arcount
argument_list|(
name|packet
argument_list|,
name|count
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ANY
case|:
case|case
name|LDNS_SECTION_ANY_NOQUESTION
case|:
break|break;
block|}
block|}
end_function

begin_function
name|void
name|ldns_pkt_set_tsig
parameter_list|(
name|ldns_pkt
modifier|*
name|pkt
parameter_list|,
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
name|pkt
operator|->
name|_tsig_rr
operator|=
name|rr
expr_stmt|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_push_rr
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_pkt_section
name|section
parameter_list|,
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
switch|switch
condition|(
name|section
condition|)
block|{
case|case
name|LDNS_SECTION_QUESTION
case|:
if|if
condition|(
operator|!
name|ldns_rr_list_push_rr
argument_list|(
name|ldns_pkt_question
argument_list|(
name|packet
argument_list|)
argument_list|,
name|rr
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
name|ldns_pkt_set_qdcount
argument_list|(
name|packet
argument_list|,
name|ldns_pkt_qdcount
argument_list|(
name|packet
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ANSWER
case|:
if|if
condition|(
operator|!
name|ldns_rr_list_push_rr
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|packet
argument_list|)
argument_list|,
name|rr
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
name|ldns_pkt_set_ancount
argument_list|(
name|packet
argument_list|,
name|ldns_pkt_ancount
argument_list|(
name|packet
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_AUTHORITY
case|:
if|if
condition|(
operator|!
name|ldns_rr_list_push_rr
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|packet
argument_list|)
argument_list|,
name|rr
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
name|ldns_pkt_set_nscount
argument_list|(
name|packet
argument_list|,
name|ldns_pkt_nscount
argument_list|(
name|packet
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ADDITIONAL
case|:
if|if
condition|(
operator|!
name|ldns_rr_list_push_rr
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|packet
argument_list|)
argument_list|,
name|rr
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
name|ldns_pkt_set_arcount
argument_list|(
name|packet
argument_list|,
name|ldns_pkt_arcount
argument_list|(
name|packet
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LDNS_SECTION_ANY
case|:
case|case
name|LDNS_SECTION_ANY_NOQUESTION
case|:
comment|/* shouldn't this error? */
break|break;
block|}
return|return
name|true
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_safe_push_rr
parameter_list|(
name|ldns_pkt
modifier|*
name|pkt
parameter_list|,
name|ldns_pkt_section
name|sec
parameter_list|,
name|ldns_rr
modifier|*
name|rr
parameter_list|)
block|{
comment|/* check to see if its there */
if|if
condition|(
name|ldns_pkt_rr
argument_list|(
name|pkt
argument_list|,
name|sec
argument_list|,
name|rr
argument_list|)
condition|)
block|{
comment|/* already there */
return|return
name|false
return|;
block|}
return|return
name|ldns_pkt_push_rr
argument_list|(
name|pkt
argument_list|,
name|sec
argument_list|,
name|rr
argument_list|)
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_push_rr_list
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_pkt_section
name|s
parameter_list|,
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|list
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|ldns_pkt_push_rr
argument_list|(
name|p
argument_list|,
name|s
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|list
argument_list|,
name|i
argument_list|)
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
block|}
return|return
name|true
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_safe_push_rr_list
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|,
name|ldns_pkt_section
name|s
parameter_list|,
name|ldns_rr_list
modifier|*
name|list
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ldns_rr_list_rr_count
argument_list|(
name|list
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|ldns_pkt_safe_push_rr
argument_list|(
name|p
argument_list|,
name|s
argument_list|,
name|ldns_rr_list_rr
argument_list|(
name|list
argument_list|,
name|i
argument_list|)
argument_list|)
condition|)
block|{
return|return
name|false
return|;
block|}
block|}
return|return
name|true
return|;
block|}
end_function

begin_function
name|bool
name|ldns_pkt_edns
parameter_list|(
specifier|const
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
return|return
operator|(
name|ldns_pkt_edns_udp_size
argument_list|(
name|pkt
argument_list|)
operator|>
literal|0
operator|||
name|ldns_pkt_edns_extended_rcode
argument_list|(
name|pkt
argument_list|)
operator|>
literal|0
operator|||
name|ldns_pkt_edns_data
argument_list|(
name|pkt
argument_list|)
operator|||
name|ldns_pkt_edns_do
argument_list|(
name|pkt
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Create/destroy/convert functions  */
end_comment

begin_function
name|ldns_pkt
modifier|*
name|ldns_pkt_new
parameter_list|()
block|{
name|ldns_pkt
modifier|*
name|packet
decl_stmt|;
name|packet
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_pkt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|packet
operator|->
name|_header
operator|=
name|LDNS_MALLOC
argument_list|(
name|ldns_hdr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|packet
operator|->
name|_header
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|packet
operator|->
name|_question
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
name|packet
operator|->
name|_answer
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
name|packet
operator|->
name|_authority
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
name|packet
operator|->
name|_additional
operator|=
name|ldns_rr_list_new
argument_list|()
expr_stmt|;
comment|/* default everything to false */
name|ldns_pkt_set_qr
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_aa
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_tc
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_rd
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_ra
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_ad
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_cd
argument_list|(
name|packet
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|ldns_pkt_set_opcode
argument_list|(
name|packet
argument_list|,
name|LDNS_PACKET_QUERY
argument_list|)
expr_stmt|;
name|ldns_pkt_set_rcode
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_id
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_size
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_querytime
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|packet
operator|->
name|timestamp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|packet
operator|->
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_answerfrom
argument_list|(
name|packet
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ldns_pkt_set_section_count
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_QUESTION
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_section_count
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_ANSWER
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_section_count
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_AUTHORITY
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_section_count
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_ADDITIONAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_udp_size
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_extended_rcode
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_version
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_z
argument_list|(
name|packet
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_data
argument_list|(
name|packet
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ldns_pkt_set_tsig
argument_list|(
name|packet
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|packet
return|;
block|}
end_function

begin_function
name|void
name|ldns_pkt_free
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|)
block|{
if|if
condition|(
name|packet
condition|)
block|{
name|LDNS_FREE
argument_list|(
name|packet
operator|->
name|_header
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|packet
operator|->
name|_question
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|packet
operator|->
name|_answer
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|packet
operator|->
name|_authority
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|packet
operator|->
name|_additional
argument_list|)
expr_stmt|;
name|ldns_rr_free
argument_list|(
name|packet
operator|->
name|_tsig_rr
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|packet
operator|->
name|_edns_data
argument_list|)
expr_stmt|;
name|ldns_rdf_deep_free
argument_list|(
name|packet
operator|->
name|_answerfrom
argument_list|)
expr_stmt|;
name|LDNS_FREE
argument_list|(
name|packet
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|bool
name|ldns_pkt_set_flags
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|uint16_t
name|flags
parameter_list|)
block|{
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|false
return|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_QR
operator|)
operator|==
name|LDNS_QR
condition|)
block|{
name|ldns_pkt_set_qr
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_AA
operator|)
operator|==
name|LDNS_AA
condition|)
block|{
name|ldns_pkt_set_aa
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_RD
operator|)
operator|==
name|LDNS_RD
condition|)
block|{
name|ldns_pkt_set_rd
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_TC
operator|)
operator|==
name|LDNS_TC
condition|)
block|{
name|ldns_pkt_set_tc
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_CD
operator|)
operator|==
name|LDNS_CD
condition|)
block|{
name|ldns_pkt_set_cd
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_RA
operator|)
operator|==
name|LDNS_RA
condition|)
block|{
name|ldns_pkt_set_ra
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|LDNS_AD
operator|)
operator|==
name|LDNS_AD
condition|)
block|{
name|ldns_pkt_set_ad
argument_list|(
name|packet
argument_list|,
name|true
argument_list|)
expr_stmt|;
block|}
return|return
name|true
return|;
block|}
end_function

begin_function
specifier|static
name|ldns_status
name|ldns_pkt_add_authsoa
parameter_list|(
name|ldns_pkt
modifier|*
name|packet
parameter_list|,
name|ldns_rdf
modifier|*
name|rr_name
parameter_list|,
name|ldns_rr_class
name|rr_class
parameter_list|)
block|{
name|ldns_rr
modifier|*
name|soa_rr
init|=
name|ldns_rr_new
argument_list|()
decl_stmt|;
name|ldns_rdf
modifier|*
name|owner_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|mname_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|rname_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|serial_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|refresh_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|retry_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|expire_rdf
decl_stmt|;
name|ldns_rdf
modifier|*
name|minimum_rdf
decl_stmt|;
if|if
condition|(
operator|!
name|soa_rr
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|owner_rdf
operator|=
name|ldns_rdf_clone
argument_list|(
name|rr_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|owner_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
name|ldns_rr_set_owner
argument_list|(
name|soa_rr
argument_list|,
name|owner_rdf
argument_list|)
expr_stmt|;
name|ldns_rr_set_type
argument_list|(
name|soa_rr
argument_list|,
name|LDNS_RR_TYPE_SOA
argument_list|)
expr_stmt|;
name|ldns_rr_set_class
argument_list|(
name|soa_rr
argument_list|,
name|rr_class
argument_list|)
expr_stmt|;
name|ldns_rr_set_question
argument_list|(
name|soa_rr
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|mname_rdf
argument_list|,
literal|"."
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|mname_rdf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|rname_rdf
argument_list|,
literal|"."
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|rname_rdf
argument_list|)
expr_stmt|;
block|}
name|serial_rdf
operator|=
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|serial_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|serial_rdf
argument_list|)
expr_stmt|;
block|}
name|refresh_rdf
operator|=
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|refresh_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|refresh_rdf
argument_list|)
expr_stmt|;
block|}
name|retry_rdf
operator|=
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|retry_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|retry_rdf
argument_list|)
expr_stmt|;
block|}
name|expire_rdf
operator|=
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|expire_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|expire_rdf
argument_list|)
expr_stmt|;
block|}
name|minimum_rdf
operator|=
name|ldns_native2rdf_int32
argument_list|(
name|LDNS_RDF_TYPE_INT32
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|minimum_rdf
condition|)
block|{
name|ldns_rr_free
argument_list|(
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
else|else
block|{
name|ldns_rr_push_rdf
argument_list|(
name|soa_rr
argument_list|,
name|minimum_rdf
argument_list|)
expr_stmt|;
block|}
name|ldns_pkt_push_rr
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_AUTHORITY
argument_list|,
name|soa_rr
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
end_function

begin_function
name|ldns_status
name|ldns_pkt_query_new_frm_str
parameter_list|(
name|ldns_pkt
modifier|*
modifier|*
name|p
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|ldns_rr_type
name|rr_type
parameter_list|,
name|ldns_rr_class
name|rr_class
parameter_list|,
name|uint16_t
name|flags
parameter_list|)
block|{
name|ldns_pkt
modifier|*
name|packet
decl_stmt|;
name|ldns_rr
modifier|*
name|question_rr
decl_stmt|;
name|ldns_rdf
modifier|*
name|name_rdf
decl_stmt|;
name|packet
operator|=
name|ldns_pkt_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
if|if
condition|(
operator|!
name|ldns_pkt_set_flags
argument_list|(
name|packet
argument_list|,
name|flags
argument_list|)
condition|)
block|{
return|return
name|LDNS_STATUS_ERR
return|;
block|}
name|question_rr
operator|=
name|ldns_rr_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|question_rr
condition|)
block|{
return|return
name|LDNS_STATUS_MEM_ERR
return|;
block|}
if|if
condition|(
name|rr_type
operator|==
literal|0
condition|)
block|{
name|rr_type
operator|=
name|LDNS_RR_TYPE_A
expr_stmt|;
block|}
if|if
condition|(
name|rr_class
operator|==
literal|0
condition|)
block|{
name|rr_class
operator|=
name|LDNS_RR_CLASS_IN
expr_stmt|;
block|}
if|if
condition|(
name|ldns_str2rdf_dname
argument_list|(
operator|&
name|name_rdf
argument_list|,
name|name
argument_list|)
operator|==
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_rr_set_owner
argument_list|(
name|question_rr
argument_list|,
name|name_rdf
argument_list|)
expr_stmt|;
name|ldns_rr_set_type
argument_list|(
name|question_rr
argument_list|,
name|rr_type
argument_list|)
expr_stmt|;
name|ldns_rr_set_class
argument_list|(
name|question_rr
argument_list|,
name|rr_class
argument_list|)
expr_stmt|;
name|ldns_rr_set_question
argument_list|(
name|question_rr
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|ldns_pkt_push_rr
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_QUESTION
argument_list|,
name|question_rr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ldns_rr_free
argument_list|(
name|question_rr
argument_list|)
expr_stmt|;
name|ldns_pkt_free
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
comment|/** IXFR? */
if|if
condition|(
name|rr_type
operator|==
name|LDNS_RR_TYPE_IXFR
condition|)
block|{
if|if
condition|(
name|ldns_pkt_add_authsoa
argument_list|(
name|packet
argument_list|,
name|name_rdf
argument_list|,
name|rr_class
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_pkt_free
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_ERR
return|;
block|}
block|}
name|packet
operator|->
name|_tsig_rr
operator|=
name|NULL
expr_stmt|;
name|ldns_pkt_set_answerfrom
argument_list|(
name|packet
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
condition|)
block|{
operator|*
name|p
operator|=
name|packet
expr_stmt|;
return|return
name|LDNS_STATUS_OK
return|;
block|}
else|else
block|{
name|ldns_pkt_free
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|LDNS_STATUS_NULL
return|;
block|}
block|}
end_function

begin_function
name|ldns_pkt
modifier|*
name|ldns_pkt_query_new
parameter_list|(
name|ldns_rdf
modifier|*
name|rr_name
parameter_list|,
name|ldns_rr_type
name|rr_type
parameter_list|,
name|ldns_rr_class
name|rr_class
parameter_list|,
name|uint16_t
name|flags
parameter_list|)
block|{
name|ldns_pkt
modifier|*
name|packet
decl_stmt|;
name|ldns_rr
modifier|*
name|question_rr
decl_stmt|;
name|packet
operator|=
name|ldns_pkt_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|packet
condition|)
block|{
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
name|ldns_pkt_set_flags
argument_list|(
name|packet
argument_list|,
name|flags
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|question_rr
operator|=
name|ldns_rr_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|question_rr
condition|)
block|{
name|ldns_pkt_free
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|rr_type
operator|==
literal|0
condition|)
block|{
name|rr_type
operator|=
name|LDNS_RR_TYPE_A
expr_stmt|;
block|}
if|if
condition|(
name|rr_class
operator|==
literal|0
condition|)
block|{
name|rr_class
operator|=
name|LDNS_RR_CLASS_IN
expr_stmt|;
block|}
name|ldns_rr_set_owner
argument_list|(
name|question_rr
argument_list|,
name|rr_name
argument_list|)
expr_stmt|;
name|ldns_rr_set_type
argument_list|(
name|question_rr
argument_list|,
name|rr_type
argument_list|)
expr_stmt|;
name|ldns_rr_set_class
argument_list|(
name|question_rr
argument_list|,
name|rr_class
argument_list|)
expr_stmt|;
name|ldns_rr_set_question
argument_list|(
name|question_rr
argument_list|,
name|true
argument_list|)
expr_stmt|;
name|ldns_pkt_push_rr
argument_list|(
name|packet
argument_list|,
name|LDNS_SECTION_QUESTION
argument_list|,
name|question_rr
argument_list|)
expr_stmt|;
comment|/** IXFR? */
if|if
condition|(
name|rr_type
operator|==
name|LDNS_RR_TYPE_IXFR
condition|)
block|{
if|if
condition|(
name|ldns_pkt_add_authsoa
argument_list|(
name|packet
argument_list|,
name|rr_name
argument_list|,
name|rr_class
argument_list|)
operator|!=
name|LDNS_STATUS_OK
condition|)
block|{
name|ldns_pkt_free
argument_list|(
name|packet
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
name|packet
operator|->
name|_tsig_rr
operator|=
name|NULL
expr_stmt|;
return|return
name|packet
return|;
block|}
end_function

begin_function
name|ldns_pkt_type
name|ldns_pkt_reply_type
parameter_list|(
name|ldns_pkt
modifier|*
name|p
parameter_list|)
block|{
name|ldns_rr_list
modifier|*
name|tmp
decl_stmt|;
if|if
condition|(
operator|!
name|p
condition|)
block|{
return|return
name|LDNS_PACKET_UNKNOWN
return|;
block|}
if|if
condition|(
name|ldns_pkt_get_rcode
argument_list|(
name|p
argument_list|)
operator|==
name|LDNS_RCODE_NXDOMAIN
condition|)
block|{
return|return
name|LDNS_PACKET_NXDOMAIN
return|;
block|}
if|if
condition|(
name|ldns_pkt_ancount
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|&&
name|ldns_pkt_arcount
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|&&
name|ldns_pkt_nscount
argument_list|(
name|p
argument_list|)
operator|==
literal|1
condition|)
block|{
comment|/* check for SOA */
name|tmp
operator|=
name|ldns_pkt_rr_list_by_type
argument_list|(
name|p
argument_list|,
name|LDNS_RR_TYPE_SOA
argument_list|,
name|LDNS_SECTION_AUTHORITY
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
condition|)
block|{
name|ldns_rr_list_deep_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
return|return
name|LDNS_PACKET_NODATA
return|;
block|}
else|else
block|{
comment|/* I have no idea ... */
block|}
block|}
if|if
condition|(
name|ldns_pkt_ancount
argument_list|(
name|p
argument_list|)
operator|==
literal|0
operator|&&
name|ldns_pkt_nscount
argument_list|(
name|p
argument_list|)
operator|>
literal|0
condition|)
block|{
name|tmp
operator|=
name|ldns_pkt_rr_list_by_type
argument_list|(
name|p
argument_list|,
name|LDNS_RR_TYPE_NS
argument_list|,
name|LDNS_SECTION_AUTHORITY
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
condition|)
block|{
comment|/* there are nameservers here */
name|ldns_rr_list_deep_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
return|return
name|LDNS_PACKET_REFERRAL
return|;
block|}
else|else
block|{
comment|/* I have no idea */
block|}
name|ldns_rr_list_deep_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
comment|/* if we cannot determine the packet type, we say it's an  	 * answer... 	 */
return|return
name|LDNS_PACKET_ANSWER
return|;
block|}
end_function

begin_function
name|ldns_pkt
modifier|*
name|ldns_pkt_clone
parameter_list|(
name|ldns_pkt
modifier|*
name|pkt
parameter_list|)
block|{
name|ldns_pkt
modifier|*
name|new_pkt
decl_stmt|;
if|if
condition|(
operator|!
name|pkt
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|new_pkt
operator|=
name|ldns_pkt_new
argument_list|()
expr_stmt|;
name|ldns_pkt_set_id
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_id
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_qr
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_qr
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_aa
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_aa
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_tc
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_tc
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_rd
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_rd
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_cd
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_cd
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_ra
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_ra
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_ad
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_ad
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_opcode
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_get_opcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_rcode
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_get_rcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_qdcount
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_qdcount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_ancount
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_ancount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_nscount
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_nscount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_arcount
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_arcount
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_answerfrom
argument_list|(
name|pkt
argument_list|)
condition|)
name|ldns_pkt_set_answerfrom
argument_list|(
name|new_pkt
argument_list|,
name|ldns_rdf_clone
argument_list|(
name|ldns_pkt_answerfrom
argument_list|(
name|pkt
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_querytime
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_querytime
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_size
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_size
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_tsig
argument_list|(
name|new_pkt
argument_list|,
name|ldns_rr_clone
argument_list|(
name|ldns_pkt_tsig
argument_list|(
name|pkt
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_udp_size
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_edns_udp_size
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_extended_rcode
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_edns_extended_rcode
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_version
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_edns_version
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_z
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_edns_z
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ldns_pkt_edns_data
argument_list|(
name|pkt
argument_list|)
condition|)
name|ldns_pkt_set_edns_data
argument_list|(
name|new_pkt
argument_list|,
name|ldns_rdf_clone
argument_list|(
name|ldns_pkt_edns_data
argument_list|(
name|pkt
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_pkt_set_edns_do
argument_list|(
name|new_pkt
argument_list|,
name|ldns_pkt_edns_do
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|new_pkt
operator|->
name|_question
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|new_pkt
operator|->
name|_answer
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|new_pkt
operator|->
name|_authority
argument_list|)
expr_stmt|;
name|ldns_rr_list_deep_free
argument_list|(
name|new_pkt
operator|->
name|_additional
argument_list|)
expr_stmt|;
name|new_pkt
operator|->
name|_question
operator|=
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_question
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|new_pkt
operator|->
name|_answer
operator|=
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_answer
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|new_pkt
operator|->
name|_authority
operator|=
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_authority
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
name|new_pkt
operator|->
name|_additional
operator|=
name|ldns_rr_list_clone
argument_list|(
name|ldns_pkt_additional
argument_list|(
name|pkt
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|new_pkt
return|;
block|}
end_function

end_unit

