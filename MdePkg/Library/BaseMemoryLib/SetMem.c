begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Implementation of the EfiSetMem routine. This function is broken   out into its own source file so that it can be excluded from a   build for a particular platform easily if an optimized version   is desired.    Copyright (c) 2006 - 2010, Intel Corporation. All rights reserved.<BR>   Copyright (c) 2012 - 2013, ARM Ltd. All rights reserved.<BR>   Copyright (c) 2016, Linaro Ltd. All rights reserved.<BR>    This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"MemLibInternals.h"
end_include

begin_comment
comment|/**   Set Buffer to Value for Size bytes.    @param  Buffer   The memory to set.   @param  Length   The number of bytes to set.   @param  Value    The value of the set operation.    @return Buffer  **/
end_comment

begin_function
name|VOID
modifier|*
name|EFIAPI
name|InternalMemSetMem
parameter_list|(
name|OUT
name|VOID
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINTN
name|Length
parameter_list|,
name|IN
name|UINT8
name|Value
parameter_list|)
block|{
comment|//
comment|// Declare the local variables that actually move the data elements as
comment|// volatile to prevent the optimizer from replacing this function with
comment|// the intrinsic memset()
comment|//
specifier|volatile
name|UINT8
modifier|*
name|Pointer8
decl_stmt|;
specifier|volatile
name|UINT32
modifier|*
name|Pointer32
decl_stmt|;
specifier|volatile
name|UINT64
modifier|*
name|Pointer64
decl_stmt|;
name|UINT32
name|Value32
decl_stmt|;
name|UINT64
name|Value64
decl_stmt|;
if|if
condition|(
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|Buffer
operator|&
literal|0x7
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|Length
operator|>=
literal|8
operator|)
condition|)
block|{
comment|// Generate the 64bit value
name|Value32
operator|=
operator|(
name|Value
operator|<<
literal|24
operator|)
operator||
operator|(
name|Value
operator|<<
literal|16
operator|)
operator||
operator|(
name|Value
operator|<<
literal|8
operator|)
operator||
name|Value
expr_stmt|;
name|Value64
operator|=
name|LShiftU64
argument_list|(
name|Value32
argument_list|,
literal|32
argument_list|)
operator||
name|Value32
expr_stmt|;
name|Pointer64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|Buffer
expr_stmt|;
while|while
condition|(
name|Length
operator|>=
literal|8
condition|)
block|{
operator|*
operator|(
name|Pointer64
operator|++
operator|)
operator|=
name|Value64
expr_stmt|;
name|Length
operator|-=
literal|8
expr_stmt|;
block|}
comment|// Finish with bytes if needed
name|Pointer8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Pointer64
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|Buffer
operator|&
literal|0x3
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|Length
operator|>=
literal|4
operator|)
condition|)
block|{
comment|// Generate the 32bit value
name|Value32
operator|=
operator|(
name|Value
operator|<<
literal|24
operator|)
operator||
operator|(
name|Value
operator|<<
literal|16
operator|)
operator||
operator|(
name|Value
operator|<<
literal|8
operator|)
operator||
name|Value
expr_stmt|;
name|Pointer32
operator|=
operator|(
name|UINT32
operator|*
operator|)
name|Buffer
expr_stmt|;
while|while
condition|(
name|Length
operator|>=
literal|4
condition|)
block|{
operator|*
operator|(
name|Pointer32
operator|++
operator|)
operator|=
name|Value32
expr_stmt|;
name|Length
operator|-=
literal|4
expr_stmt|;
block|}
comment|// Finish with bytes if needed
name|Pointer8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Pointer32
expr_stmt|;
block|}
else|else
block|{
name|Pointer8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
expr_stmt|;
block|}
while|while
condition|(
name|Length
operator|--
operator|>
literal|0
condition|)
block|{
operator|*
operator|(
name|Pointer8
operator|++
operator|)
operator|=
name|Value
expr_stmt|;
block|}
return|return
name|Buffer
return|;
block|}
end_function

end_unit

