begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Implementation of the InternalMemCopyMem routine. This function is broken   out into its own source file so that it can be excluded from a build for a   particular platform easily if an optimized version is desired.    Copyright (c) 2006 - 2016, Intel Corporation. All rights reserved.<BR>   Copyright (c) 2012 - 2013, ARM Ltd. All rights reserved.<BR>   Copyright (c) 2016, Linaro Ltd. All rights reserved.<BR>    This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"MemLibInternals.h"
end_include

begin_comment
comment|/**   Copy Length bytes from Source to Destination.    @param  DestinationBuffer The target of the copy request.   @param  SourceBuffer      The place to copy from.   @param  Length            The number of bytes to copy.    @return Destination  **/
end_comment

begin_function
name|VOID
modifier|*
name|EFIAPI
name|InternalMemCopyMem
parameter_list|(
name|OUT
name|VOID
modifier|*
name|DestinationBuffer
parameter_list|,
name|IN
name|CONST
name|VOID
modifier|*
name|SourceBuffer
parameter_list|,
name|IN
name|UINTN
name|Length
parameter_list|)
block|{
comment|//
comment|// Declare the local variables that actually move the data elements as
comment|// volatile to prevent the optimizer from replacing this function with
comment|// the intrinsic memcpy()
comment|//
specifier|volatile
name|UINT8
modifier|*
name|Destination8
decl_stmt|;
name|CONST
name|UINT8
modifier|*
name|Source8
decl_stmt|;
specifier|volatile
name|UINT32
modifier|*
name|Destination32
decl_stmt|;
name|CONST
name|UINT32
modifier|*
name|Source32
decl_stmt|;
specifier|volatile
name|UINT64
modifier|*
name|Destination64
decl_stmt|;
name|CONST
name|UINT64
modifier|*
name|Source64
decl_stmt|;
name|UINTN
name|Alignment
decl_stmt|;
if|if
condition|(
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|DestinationBuffer
operator|&
literal|0x7
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|SourceBuffer
operator|&
literal|0x7
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|Length
operator|>=
literal|8
operator|)
condition|)
block|{
if|if
condition|(
name|SourceBuffer
operator|>
name|DestinationBuffer
condition|)
block|{
name|Destination64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|DestinationBuffer
expr_stmt|;
name|Source64
operator|=
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|SourceBuffer
expr_stmt|;
while|while
condition|(
name|Length
operator|>=
literal|8
condition|)
block|{
operator|*
operator|(
name|Destination64
operator|++
operator|)
operator|=
operator|*
operator|(
name|Source64
operator|++
operator|)
expr_stmt|;
name|Length
operator|-=
literal|8
expr_stmt|;
block|}
comment|// Finish if there are still some bytes to copy
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Destination64
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|Source64
expr_stmt|;
while|while
condition|(
name|Length
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|Destination8
operator|++
operator|)
operator|=
operator|*
operator|(
name|Source8
operator|++
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|SourceBuffer
operator|<
name|DestinationBuffer
condition|)
block|{
name|Destination64
operator|=
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|(
name|UINTN
operator|)
name|DestinationBuffer
operator|+
name|Length
operator|)
expr_stmt|;
name|Source64
operator|=
operator|(
name|CONST
name|UINT64
operator|*
operator|)
operator|(
operator|(
name|UINTN
operator|)
name|SourceBuffer
operator|+
name|Length
operator|)
expr_stmt|;
comment|// Destination64 and Source64 were aligned on a 64-bit boundary
comment|// but if length is not a multiple of 8 bytes then they won't be
comment|// anymore.
name|Alignment
operator|=
name|Length
operator|&
literal|0x7
expr_stmt|;
if|if
condition|(
name|Alignment
operator|!=
literal|0
condition|)
block|{
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Destination64
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|Source64
expr_stmt|;
while|while
condition|(
name|Alignment
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
operator|--
name|Destination8
operator|)
operator|=
operator|*
operator|(
operator|--
name|Source8
operator|)
expr_stmt|;
operator|--
name|Length
expr_stmt|;
block|}
name|Destination64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|Destination8
expr_stmt|;
name|Source64
operator|=
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Source8
expr_stmt|;
block|}
while|while
condition|(
name|Length
operator|>
literal|0
condition|)
block|{
operator|*
operator|(
operator|--
name|Destination64
operator|)
operator|=
operator|*
operator|(
operator|--
name|Source64
operator|)
expr_stmt|;
name|Length
operator|-=
literal|8
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|DestinationBuffer
operator|&
literal|0x3
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
operator|(
name|UINTN
operator|)
name|SourceBuffer
operator|&
literal|0x3
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|Length
operator|>=
literal|4
operator|)
condition|)
block|{
if|if
condition|(
name|SourceBuffer
operator|>
name|DestinationBuffer
condition|)
block|{
name|Destination32
operator|=
operator|(
name|UINT32
operator|*
operator|)
name|DestinationBuffer
expr_stmt|;
name|Source32
operator|=
operator|(
name|CONST
name|UINT32
operator|*
operator|)
name|SourceBuffer
expr_stmt|;
while|while
condition|(
name|Length
operator|>=
literal|4
condition|)
block|{
operator|*
operator|(
name|Destination32
operator|++
operator|)
operator|=
operator|*
operator|(
name|Source32
operator|++
operator|)
expr_stmt|;
name|Length
operator|-=
literal|4
expr_stmt|;
block|}
comment|// Finish if there are still some bytes to copy
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Destination32
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|Source32
expr_stmt|;
while|while
condition|(
name|Length
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|Destination8
operator|++
operator|)
operator|=
operator|*
operator|(
name|Source8
operator|++
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|SourceBuffer
operator|<
name|DestinationBuffer
condition|)
block|{
name|Destination32
operator|=
operator|(
name|UINT32
operator|*
operator|)
operator|(
operator|(
name|UINTN
operator|)
name|DestinationBuffer
operator|+
name|Length
operator|)
expr_stmt|;
name|Source32
operator|=
operator|(
name|CONST
name|UINT32
operator|*
operator|)
operator|(
operator|(
name|UINTN
operator|)
name|SourceBuffer
operator|+
name|Length
operator|)
expr_stmt|;
comment|// Destination32 and Source32 were aligned on a 32-bit boundary
comment|// but if length is not a multiple of 4 bytes then they won't be
comment|// anymore.
name|Alignment
operator|=
name|Length
operator|&
literal|0x3
expr_stmt|;
if|if
condition|(
name|Alignment
operator|!=
literal|0
condition|)
block|{
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|Destination32
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|Source32
expr_stmt|;
while|while
condition|(
name|Alignment
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
operator|--
name|Destination8
operator|)
operator|=
operator|*
operator|(
operator|--
name|Source8
operator|)
expr_stmt|;
operator|--
name|Length
expr_stmt|;
block|}
name|Destination32
operator|=
operator|(
name|UINT32
operator|*
operator|)
name|Destination8
expr_stmt|;
name|Source32
operator|=
operator|(
name|CONST
name|UINT32
operator|*
operator|)
name|Source8
expr_stmt|;
block|}
while|while
condition|(
name|Length
operator|>
literal|0
condition|)
block|{
operator|*
operator|(
operator|--
name|Destination32
operator|)
operator|=
operator|*
operator|(
operator|--
name|Source32
operator|)
expr_stmt|;
name|Length
operator|-=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|SourceBuffer
operator|>
name|DestinationBuffer
condition|)
block|{
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|DestinationBuffer
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|SourceBuffer
expr_stmt|;
while|while
condition|(
name|Length
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|Destination8
operator|++
operator|)
operator|=
operator|*
operator|(
name|Source8
operator|++
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|SourceBuffer
operator|<
name|DestinationBuffer
condition|)
block|{
name|Destination8
operator|=
operator|(
name|UINT8
operator|*
operator|)
name|DestinationBuffer
operator|+
operator|(
name|Length
operator|-
literal|1
operator|)
expr_stmt|;
name|Source8
operator|=
operator|(
name|CONST
name|UINT8
operator|*
operator|)
name|SourceBuffer
operator|+
operator|(
name|Length
operator|-
literal|1
operator|)
expr_stmt|;
while|while
condition|(
name|Length
operator|--
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|Destination8
operator|--
operator|)
operator|=
operator|*
operator|(
name|Source8
operator|--
operator|)
expr_stmt|;
block|}
block|}
block|}
return|return
name|DestinationBuffer
return|;
block|}
end_function

end_unit

