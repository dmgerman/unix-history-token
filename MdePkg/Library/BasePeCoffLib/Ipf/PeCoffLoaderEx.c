begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Fixes Intel Itanium(TM) specific relocation types.    Copyright (c) 2006 - 2008, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"BasePeCoffLibInternals.h"
end_include

begin_define
define|#
directive|define
name|EXT_IMM64
parameter_list|(
name|Value
parameter_list|,
name|Address
parameter_list|,
name|Size
parameter_list|,
name|InstPos
parameter_list|,
name|ValPos
parameter_list|)
define|\
value|Value |= (((UINT64)((*(Address)>> InstPos)& (((UINT64)1<< Size) - 1)))<< ValPos)
end_define

begin_define
define|#
directive|define
name|INS_IMM64
parameter_list|(
name|Value
parameter_list|,
name|Address
parameter_list|,
name|Size
parameter_list|,
name|InstPos
parameter_list|,
name|ValPos
parameter_list|)
define|\
value|*(UINT32*)Address = (*(UINT32*)Address& ~(((1<< Size) - 1)<< InstPos)) | \           ((UINT32)((((UINT64)Value>> ValPos)& (((UINT64)1<< Size) - 1)))<< InstPos)
end_define

begin_define
define|#
directive|define
name|IMM64_IMM7B_INST_WORD_X
value|3
end_define

begin_define
define|#
directive|define
name|IMM64_IMM7B_SIZE_X
value|7
end_define

begin_define
define|#
directive|define
name|IMM64_IMM7B_INST_WORD_POS_X
value|4
end_define

begin_define
define|#
directive|define
name|IMM64_IMM7B_VAL_POS_X
value|0
end_define

begin_define
define|#
directive|define
name|IMM64_IMM9D_INST_WORD_X
value|3
end_define

begin_define
define|#
directive|define
name|IMM64_IMM9D_SIZE_X
value|9
end_define

begin_define
define|#
directive|define
name|IMM64_IMM9D_INST_WORD_POS_X
value|18
end_define

begin_define
define|#
directive|define
name|IMM64_IMM9D_VAL_POS_X
value|7
end_define

begin_define
define|#
directive|define
name|IMM64_IMM5C_INST_WORD_X
value|3
end_define

begin_define
define|#
directive|define
name|IMM64_IMM5C_SIZE_X
value|5
end_define

begin_define
define|#
directive|define
name|IMM64_IMM5C_INST_WORD_POS_X
value|13
end_define

begin_define
define|#
directive|define
name|IMM64_IMM5C_VAL_POS_X
value|16
end_define

begin_define
define|#
directive|define
name|IMM64_IC_INST_WORD_X
value|3
end_define

begin_define
define|#
directive|define
name|IMM64_IC_SIZE_X
value|1
end_define

begin_define
define|#
directive|define
name|IMM64_IC_INST_WORD_POS_X
value|12
end_define

begin_define
define|#
directive|define
name|IMM64_IC_VAL_POS_X
value|21
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41A_INST_WORD_X
value|1
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41A_SIZE_X
value|10
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41A_INST_WORD_POS_X
value|14
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41A_VAL_POS_X
value|22
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41B_INST_WORD_X
value|1
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41B_SIZE_X
value|8
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41B_INST_WORD_POS_X
value|24
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41B_VAL_POS_X
value|32
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41C_INST_WORD_X
value|2
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41C_SIZE_X
value|23
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41C_INST_WORD_POS_X
value|0
end_define

begin_define
define|#
directive|define
name|IMM64_IMM41C_VAL_POS_X
value|40
end_define

begin_define
define|#
directive|define
name|IMM64_SIGN_INST_WORD_X
value|3
end_define

begin_define
define|#
directive|define
name|IMM64_SIGN_SIZE_X
value|1
end_define

begin_define
define|#
directive|define
name|IMM64_SIGN_INST_WORD_POS_X
value|27
end_define

begin_define
define|#
directive|define
name|IMM64_SIGN_VAL_POS_X
value|63
end_define

begin_comment
comment|/**   Performs an Itanium-based specific relocation fixup.    @param  Reloc       The pointer to the relocation record.   @param  Fixup       The pointer to the address to fix up.   @param  FixupData   The pointer to a buffer to log the fixups.   @param  Adjust      The offset to adjust the fixup.    @retval RETURN_SUCCESS Succeed to fix the relocation entry.   @retval RETURN_UNSUPPOTED Unrecoganized relocation entry.  **/
end_comment

begin_function
name|RETURN_STATUS
name|PeCoffLoaderRelocateImageEx
parameter_list|(
name|IN
name|UINT16
modifier|*
name|Reloc
parameter_list|,
name|IN
name|OUT
name|CHAR8
modifier|*
name|Fixup
parameter_list|,
name|IN
name|OUT
name|CHAR8
modifier|*
modifier|*
name|FixupData
parameter_list|,
name|IN
name|UINT64
name|Adjust
parameter_list|)
block|{
name|UINT64
modifier|*
name|Fixup64
decl_stmt|;
name|UINT64
name|FixupVal
decl_stmt|;
switch|switch
condition|(
operator|(
operator|*
name|Reloc
operator|)
operator|>>
literal|12
condition|)
block|{
case|case
name|EFI_IMAGE_REL_BASED_IA64_IMM64
case|:
comment|//
comment|// Align it to bundle address before fixing up the
comment|// 64-bit immediate value of the movl instruction.
comment|//
name|Fixup
operator|=
operator|(
name|CHAR8
operator|*
operator|)
operator|(
operator|(
name|UINTN
operator|)
name|Fixup
operator|&
operator|(
name|UINTN
operator|)
operator|~
operator|(
literal|15
operator|)
operator|)
expr_stmt|;
name|FixupVal
operator|=
operator|(
name|UINT64
operator|)
literal|0
expr_stmt|;
comment|//
comment|// Extract the lower 32 bits of IMM64 from bundle
comment|//
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM7B_INST_WORD_X
argument_list|,
name|IMM64_IMM7B_SIZE_X
argument_list|,
name|IMM64_IMM7B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM7B_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM9D_INST_WORD_X
argument_list|,
name|IMM64_IMM9D_SIZE_X
argument_list|,
name|IMM64_IMM9D_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM9D_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM5C_INST_WORD_X
argument_list|,
name|IMM64_IMM5C_SIZE_X
argument_list|,
name|IMM64_IMM5C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM5C_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IC_INST_WORD_X
argument_list|,
name|IMM64_IC_SIZE_X
argument_list|,
name|IMM64_IC_INST_WORD_POS_X
argument_list|,
name|IMM64_IC_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41A_INST_WORD_X
argument_list|,
name|IMM64_IMM41A_SIZE_X
argument_list|,
name|IMM64_IMM41A_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41A_VAL_POS_X
argument_list|)
expr_stmt|;
comment|//
comment|// Update 64-bit address
comment|//
name|FixupVal
operator|+=
name|Adjust
expr_stmt|;
comment|//
comment|// Insert IMM64 into bundle
comment|//
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM7B_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM7B_SIZE_X
argument_list|,
name|IMM64_IMM7B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM7B_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM9D_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM9D_SIZE_X
argument_list|,
name|IMM64_IMM9D_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM9D_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM5C_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM5C_SIZE_X
argument_list|,
name|IMM64_IMM5C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM5C_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IC_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IC_SIZE_X
argument_list|,
name|IMM64_IC_INST_WORD_POS_X
argument_list|,
name|IMM64_IC_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41A_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41A_SIZE_X
argument_list|,
name|IMM64_IMM41A_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41A_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41B_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41B_SIZE_X
argument_list|,
name|IMM64_IMM41B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41B_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41C_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41C_SIZE_X
argument_list|,
name|IMM64_IMM41C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41C_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_SIGN_INST_WORD_X
operator|)
argument_list|,
name|IMM64_SIGN_SIZE_X
argument_list|,
name|IMM64_SIGN_INST_WORD_POS_X
argument_list|,
name|IMM64_SIGN_VAL_POS_X
argument_list|)
expr_stmt|;
name|Fixup64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|Fixup
expr_stmt|;
if|if
condition|(
operator|*
name|FixupData
operator|!=
name|NULL
condition|)
block|{
operator|*
name|FixupData
operator|=
name|ALIGN_POINTER
argument_list|(
operator|*
name|FixupData
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|*
name|FixupData
operator|)
operator|=
operator|*
name|Fixup64
expr_stmt|;
operator|*
name|FixupData
operator|=
operator|*
name|FixupData
operator|+
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|RETURN_UNSUPPORTED
return|;
block|}
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**   Returns TRUE if the machine type of PE/COFF image is supported. Supported   does not mean the image can be executed it means the PE/COFF loader supports   loading and relocating of the image type. It's up to the caller to support   the entry point.       The itanium version PE/COFF loader/relocater supports itanium and EBC image.    @param  Machine   Machine type from the PE Header.    @return TRUE if this PE/COFF loader can load the image   @return FALSE unrecoganized machine type of image.  **/
end_comment

begin_function
name|BOOLEAN
name|PeCoffLoaderImageFormatSupported
parameter_list|(
name|IN
name|UINT16
name|Machine
parameter_list|)
block|{
if|if
condition|(
operator|(
name|Machine
operator|==
name|IMAGE_FILE_MACHINE_IA64
operator|)
operator|||
operator|(
name|Machine
operator|==
name|IMAGE_FILE_MACHINE_EBC
operator|)
condition|)
block|{
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**   ImageRead function that operates on a memory buffer whos base is passed into   FileHandle.    @param  Reloc             Ponter to baes of the input stream   @param  Fixup             Offset to the start of the buffer   @param  FixupData         The number of bytes to copy into the buffer   @param  Adjust            Location to place results of read    @retval RETURN_SUCCESS    Data is read from FileOffset from the Handle into                             the buffer.   @retval RETURN_UNSUPPORTED Un-recoganized relocation entry                              type. **/
end_comment

begin_function
name|RETURN_STATUS
name|PeHotRelocateImageEx
parameter_list|(
name|IN
name|UINT16
modifier|*
name|Reloc
parameter_list|,
name|IN
name|OUT
name|CHAR8
modifier|*
name|Fixup
parameter_list|,
name|IN
name|OUT
name|CHAR8
modifier|*
modifier|*
name|FixupData
parameter_list|,
name|IN
name|UINT64
name|Adjust
parameter_list|)
block|{
name|UINT64
modifier|*
name|Fixup64
decl_stmt|;
name|UINT64
name|FixupVal
decl_stmt|;
switch|switch
condition|(
operator|(
operator|*
name|Reloc
operator|)
operator|>>
literal|12
condition|)
block|{
case|case
name|EFI_IMAGE_REL_BASED_DIR64
case|:
name|Fixup64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|Fixup
expr_stmt|;
operator|*
name|FixupData
operator|=
name|ALIGN_POINTER
argument_list|(
operator|*
name|FixupData
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|*
name|FixupData
operator|)
operator|==
operator|*
name|Fixup64
condition|)
block|{
operator|*
name|Fixup64
operator|=
operator|*
name|Fixup64
operator|+
operator|(
name|UINT64
operator|)
name|Adjust
expr_stmt|;
block|}
operator|*
name|FixupData
operator|=
operator|*
name|FixupData
operator|+
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
break|break;
case|case
name|EFI_IMAGE_REL_BASED_IA64_IMM64
case|:
name|Fixup64
operator|=
operator|(
name|UINT64
operator|*
operator|)
name|Fixup
expr_stmt|;
operator|*
name|FixupData
operator|=
name|ALIGN_POINTER
argument_list|(
operator|*
name|FixupData
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|*
name|FixupData
operator|)
operator|==
operator|*
name|Fixup64
condition|)
block|{
comment|//
comment|// Align it to bundle address before fixing up the
comment|// 64-bit immediate value of the movl instruction.
comment|//
comment|//
name|Fixup
operator|=
operator|(
name|CHAR8
operator|*
operator|)
operator|(
operator|(
name|UINT64
operator|)
name|Fixup
operator|&
operator|(
name|UINT64
operator|)
operator|~
operator|(
literal|15
operator|)
operator|)
expr_stmt|;
name|FixupVal
operator|=
operator|(
name|UINT64
operator|)
literal|0
expr_stmt|;
comment|//
comment|// Extract the lower 32 bits of IMM64 from bundle
comment|//
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM7B_INST_WORD_X
argument_list|,
name|IMM64_IMM7B_SIZE_X
argument_list|,
name|IMM64_IMM7B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM7B_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM9D_INST_WORD_X
argument_list|,
name|IMM64_IMM9D_SIZE_X
argument_list|,
name|IMM64_IMM9D_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM9D_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM5C_INST_WORD_X
argument_list|,
name|IMM64_IMM5C_SIZE_X
argument_list|,
name|IMM64_IMM5C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM5C_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IC_INST_WORD_X
argument_list|,
name|IMM64_IC_SIZE_X
argument_list|,
name|IMM64_IC_INST_WORD_POS_X
argument_list|,
name|IMM64_IC_VAL_POS_X
argument_list|)
expr_stmt|;
name|EXT_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41A_INST_WORD_X
argument_list|,
name|IMM64_IMM41A_SIZE_X
argument_list|,
name|IMM64_IMM41A_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41A_VAL_POS_X
argument_list|)
expr_stmt|;
comment|//
comment|// Update 64-bit address
comment|//
name|FixupVal
operator|+=
name|Adjust
expr_stmt|;
comment|//
comment|// Insert IMM64 into bundle
comment|//
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM7B_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM7B_SIZE_X
argument_list|,
name|IMM64_IMM7B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM7B_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM9D_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM9D_SIZE_X
argument_list|,
name|IMM64_IMM9D_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM9D_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM5C_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM5C_SIZE_X
argument_list|,
name|IMM64_IMM5C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM5C_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IC_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IC_SIZE_X
argument_list|,
name|IMM64_IC_INST_WORD_POS_X
argument_list|,
name|IMM64_IC_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41A_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41A_SIZE_X
argument_list|,
name|IMM64_IMM41A_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41A_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41B_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41B_SIZE_X
argument_list|,
name|IMM64_IMM41B_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41B_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_IMM41C_INST_WORD_X
operator|)
argument_list|,
name|IMM64_IMM41C_SIZE_X
argument_list|,
name|IMM64_IMM41C_INST_WORD_POS_X
argument_list|,
name|IMM64_IMM41C_VAL_POS_X
argument_list|)
expr_stmt|;
name|INS_IMM64
argument_list|(
name|FixupVal
argument_list|,
operator|(
operator|(
name|UINT32
operator|*
operator|)
name|Fixup
operator|+
name|IMM64_SIGN_INST_WORD_X
operator|)
argument_list|,
name|IMM64_SIGN_SIZE_X
argument_list|,
name|IMM64_SIGN_INST_WORD_POS_X
argument_list|,
name|IMM64_SIGN_VAL_POS_X
argument_list|)
expr_stmt|;
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|*
name|FixupData
operator|)
operator|=
operator|*
name|Fixup64
expr_stmt|;
block|}
operator|*
name|FixupData
operator|=
operator|*
name|FixupData
operator|+
sizeof|sizeof
argument_list|(
name|UINT64
argument_list|)
expr_stmt|;
break|break;
default|default:
name|DEBUG
argument_list|(
operator|(
name|EFI_D_ERROR
operator|,
literal|"PeHotRelocateEx:unknown fixed type\n"
operator|)
argument_list|)
expr_stmt|;
return|return
name|RETURN_UNSUPPORTED
return|;
block|}
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

end_unit

