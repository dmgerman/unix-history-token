begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Implementation of GUID functions.    The following BaseMemoryLib instances contain the same copy of this file:        BaseMemoryLib     BaseMemoryLibMmx     BaseMemoryLibSse2     BaseMemoryLibRepStr     BaseMemoryLibOptDxe     BaseMemoryLibOptPei     PeiMemoryLib     UefiMemoryLib    Copyright (c) 2006 - 2016, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"MemLibInternals.h"
end_include

begin_comment
comment|/**   Copies a source GUID to a destination GUID.    This function copies the contents of the 128-bit GUID specified by SourceGuid to   DestinationGuid, and returns DestinationGuid.      If DestinationGuid is NULL, then ASSERT().   If SourceGuid is NULL, then ASSERT().    @param  DestinationGuid   The pointer to the destination GUID.   @param  SourceGuid        The pointer to the source GUID.    @return DestinationGuid.  **/
end_comment

begin_function
name|GUID
modifier|*
name|EFIAPI
name|CopyGuid
parameter_list|(
name|OUT
name|GUID
modifier|*
name|DestinationGuid
parameter_list|,
name|IN
name|CONST
name|GUID
modifier|*
name|SourceGuid
parameter_list|)
block|{
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
name|DestinationGuid
argument_list|,
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|SourceGuid
argument_list|)
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
name|DestinationGuid
operator|+
literal|1
argument_list|,
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|SourceGuid
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|DestinationGuid
return|;
block|}
end_function

begin_comment
comment|/**   Compares two GUIDs.    This function compares Guid1 to Guid2.  If the GUIDs are identical then TRUE is returned.   If there are any bit differences in the two GUIDs, then FALSE is returned.      If Guid1 is NULL, then ASSERT().   If Guid2 is NULL, then ASSERT().    @param  Guid1       A pointer to a 128 bit GUID.   @param  Guid2       A pointer to a 128 bit GUID.    @retval TRUE        Guid1 and Guid2 are identical.   @retval FALSE       Guid1 and Guid2 are not identical.  **/
end_comment

begin_function
name|BOOLEAN
name|EFIAPI
name|CompareGuid
parameter_list|(
name|IN
name|CONST
name|GUID
modifier|*
name|Guid1
parameter_list|,
name|IN
name|CONST
name|GUID
modifier|*
name|Guid2
parameter_list|)
block|{
name|UINT64
name|LowPartOfGuid1
decl_stmt|;
name|UINT64
name|LowPartOfGuid2
decl_stmt|;
name|UINT64
name|HighPartOfGuid1
decl_stmt|;
name|UINT64
name|HighPartOfGuid2
decl_stmt|;
name|LowPartOfGuid1
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid1
argument_list|)
expr_stmt|;
name|LowPartOfGuid2
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid2
argument_list|)
expr_stmt|;
name|HighPartOfGuid1
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid1
operator|+
literal|1
argument_list|)
expr_stmt|;
name|HighPartOfGuid2
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid2
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
call|(
name|BOOLEAN
call|)
argument_list|(
name|LowPartOfGuid1
operator|==
name|LowPartOfGuid2
operator|&&
name|HighPartOfGuid1
operator|==
name|HighPartOfGuid2
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Scans a target buffer for a GUID, and returns a pointer to the matching GUID   in the target buffer.    This function searches the target buffer specified by Buffer and Length from   the lowest address to the highest address at 128-bit increments for the 128-bit   GUID value that matches Guid.  If a match is found, then a pointer to the matching   GUID in the target buffer is returned.  If no match is found, then NULL is returned.   If Length is 0, then NULL is returned.      If Length> 0 and Buffer is NULL, then ASSERT().   If Buffer is not aligned on a 32-bit boundary, then ASSERT().   If Length is not aligned on a 128-bit boundary, then ASSERT().   If Length is greater than (MAX_ADDRESS - Buffer + 1), then ASSERT().    @param  Buffer  The pointer to the target buffer to scan.   @param  Length  The number of bytes in Buffer to scan.   @param  Guid    The value to search for in the target buffer.    @return A pointer to the matching Guid in the target buffer or NULL otherwise.  **/
end_comment

begin_function
name|VOID
modifier|*
name|EFIAPI
name|ScanGuid
parameter_list|(
name|IN
name|CONST
name|VOID
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINTN
name|Length
parameter_list|,
name|IN
name|CONST
name|GUID
modifier|*
name|Guid
parameter_list|)
block|{
name|CONST
name|GUID
modifier|*
name|GuidPtr
decl_stmt|;
name|ASSERT
argument_list|(
operator|(
operator|(
name|UINTN
operator|)
name|Buffer
operator|&
operator|(
sizeof|sizeof
argument_list|(
name|Guid
operator|->
name|Data1
argument_list|)
operator|-
literal|1
operator|)
operator|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Length
operator|<=
operator|(
name|MAX_ADDRESS
operator|-
operator|(
name|UINTN
operator|)
name|Buffer
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
operator|(
name|Length
operator|&
operator|(
sizeof|sizeof
argument_list|(
operator|*
name|GuidPtr
argument_list|)
operator|-
literal|1
operator|)
operator|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|GuidPtr
operator|=
operator|(
name|GUID
operator|*
operator|)
name|Buffer
expr_stmt|;
name|Buffer
operator|=
name|GuidPtr
operator|+
name|Length
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|GuidPtr
argument_list|)
expr_stmt|;
while|while
condition|(
name|GuidPtr
operator|<
operator|(
name|CONST
name|GUID
operator|*
operator|)
name|Buffer
condition|)
block|{
if|if
condition|(
name|CompareGuid
argument_list|(
name|GuidPtr
argument_list|,
name|Guid
argument_list|)
condition|)
block|{
return|return
operator|(
name|VOID
operator|*
operator|)
name|GuidPtr
return|;
block|}
name|GuidPtr
operator|++
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_comment
comment|/**   Checks if the given GUID is a zero GUID.    This function checks whether the given GUID is a zero GUID. If the GUID is   identical to a zero GUID then TRUE is returned. Otherwise, FALSE is returned.    If Guid is NULL, then ASSERT().    @param  Guid        The pointer to a 128 bit GUID.    @retval TRUE        Guid is a zero GUID.   @retval FALSE       Guid is not a zero GUID.  **/
end_comment

begin_function
name|BOOLEAN
name|EFIAPI
name|IsZeroGuid
parameter_list|(
name|IN
name|CONST
name|GUID
modifier|*
name|Guid
parameter_list|)
block|{
name|UINT64
name|LowPartOfGuid
decl_stmt|;
name|UINT64
name|HighPartOfGuid
decl_stmt|;
name|LowPartOfGuid
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid
argument_list|)
expr_stmt|;
name|HighPartOfGuid
operator|=
name|ReadUnaligned64
argument_list|(
operator|(
name|CONST
name|UINT64
operator|*
operator|)
name|Guid
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
call|(
name|BOOLEAN
call|)
argument_list|(
name|LowPartOfGuid
operator|==
literal|0
operator|&&
name|HighPartOfGuid
operator|==
literal|0
argument_list|)
return|;
block|}
end_function

end_unit

