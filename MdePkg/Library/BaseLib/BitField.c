begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Bit field functions of BaseLib.    Copyright (c) 2006 - 2013, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"BaseLibInternals.h"
end_include

begin_comment
comment|/**   Worker function that returns a bit field from Operand.    Returns the bitfield specified by the StartBit and the EndBit from Operand.    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.   @param  EndBit    The ordinal of the most significant bit in the bit field.    @return The bit field read.  **/
end_comment

begin_function
name|UINTN
name|EFIAPI
name|InternalBaseLibBitFieldReadUint
parameter_list|(
name|IN
name|UINTN
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
comment|//
comment|// ~((UINTN)-2<< EndBit) is a mask in which bit[0] thru bit[EndBit]
comment|// are 1's while bit[EndBit + 1] thru the most significant bit are 0's.
comment|//
return|return
operator|(
name|Operand
operator|&
operator|~
operator|(
operator|(
name|UINTN
operator|)
operator|-
literal|2
operator|<<
name|EndBit
operator|)
operator|)
operator|>>
name|StartBit
return|;
block|}
end_function

begin_comment
comment|/**   Worker function that reads a bit field from Operand, performs a bitwise OR,   and returns the result.    Performs a bitwise OR between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new value is returned.    If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.   @param  EndBit    The ordinal of the most significant bit in the bit field.   @param  OrData    The value to OR with the read value from the value.    @return The new value.  **/
end_comment

begin_function
name|UINTN
name|EFIAPI
name|InternalBaseLibBitFieldOrUint
parameter_list|(
name|IN
name|UINTN
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINTN
name|OrData
parameter_list|)
block|{
comment|//
comment|// Higher bits in OrData those are not used must be zero.
comment|//
comment|// EndBit - StartBit + 1 might be 32 while the result right shifting 32 on a 32bit integer is undefined,
comment|// So the logic is updated to right shift (EndBit - StartBit) bits and compare the last bit directly.
comment|//
name|ASSERT
argument_list|(
operator|(
name|OrData
operator|>>
operator|(
name|EndBit
operator|-
name|StartBit
operator|)
operator|)
operator|==
operator|(
operator|(
name|OrData
operator|>>
operator|(
name|EndBit
operator|-
name|StartBit
operator|)
operator|)
operator|&
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|//
comment|// ~((UINTN)-2<< EndBit) is a mask in which bit[0] thru bit[EndBit]
comment|// are 1's while bit[EndBit + 1] thru the most significant bit are 0's.
comment|//
return|return
name|Operand
operator||
operator|(
operator|(
name|OrData
operator|<<
name|StartBit
operator|)
operator|&
operator|~
operator|(
operator|(
name|UINTN
operator|)
operator|-
literal|2
operator|<<
name|EndBit
operator|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Worker function that reads a bit field from Operand, performs a bitwise AND,   and returns the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new value is returned.    If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.   @param  EndBit    The ordinal of the most significant bit in the bit field.   @param  AndData    The value to And with the read value from the value.    @return The new value.  **/
end_comment

begin_function
name|UINTN
name|EFIAPI
name|InternalBaseLibBitFieldAndUint
parameter_list|(
name|IN
name|UINTN
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINTN
name|AndData
parameter_list|)
block|{
comment|//
comment|// Higher bits in AndData those are not used must be zero.
comment|//
comment|// EndBit - StartBit + 1 might be 32 while the result right shifting 32 on a 32bit integer is undefined,
comment|// So the logic is updated to right shift (EndBit - StartBit) bits and compare the last bit directly.
comment|//
name|ASSERT
argument_list|(
operator|(
name|AndData
operator|>>
operator|(
name|EndBit
operator|-
name|StartBit
operator|)
operator|)
operator|==
operator|(
operator|(
name|AndData
operator|>>
operator|(
name|EndBit
operator|-
name|StartBit
operator|)
operator|)
operator|&
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|//
comment|// ~((UINTN)-2<< EndBit) is a mask in which bit[0] thru bit[EndBit]
comment|// are 1's while bit[EndBit + 1] thru the most significant bit are 0's.
comment|//
return|return
name|Operand
operator|&
operator|~
operator|(
operator|(
operator|~
name|AndData
operator|<<
name|StartBit
operator|)
operator|&
operator|~
operator|(
operator|(
name|UINTN
operator|)
operator|-
literal|2
operator|<<
name|EndBit
operator|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Returns a bit field from an 8-bit value.    Returns the bitfield specified by the StartBit and the EndBit from Operand.    If 8-bit operations are not supported, then ASSERT().   If StartBit is greater than 7, then ASSERT().   If EndBit is greater than 7, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..7.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..7.    @return The bit field read.  **/
end_comment

begin_function
name|UINT8
name|EFIAPI
name|BitFieldRead8
parameter_list|(
name|IN
name|UINT8
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT8
operator|)
name|InternalBaseLibBitFieldReadUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to an 8-bit value, and returns the result.    Writes Value to the bit field specified by the StartBit and the EndBit in   Operand. All other bits in Operand are preserved. The new 8-bit value is   returned.    If 8-bit operations are not supported, then ASSERT().   If StartBit is greater than 7, then ASSERT().   If EndBit is greater than 7, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..7.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..7.   @param  Value     The new value of the bit field.    @return The new 8-bit value.  **/
end_comment

begin_function
name|UINT8
name|EFIAPI
name|BitFieldWrite8
parameter_list|(
name|IN
name|UINT8
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT8
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldAndThenOr8
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
literal|0
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from an 8-bit value, performs a bitwise OR, and returns the   result.    Performs a bitwise OR between the bit field specified by StartBit   and EndBit in Operand and the value specified by OrData. All other bits in   Operand are preserved. The new 8-bit value is returned.    If 8-bit operations are not supported, then ASSERT().   If StartBit is greater than 7, then ASSERT().   If EndBit is greater than 7, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..7.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..7.   @param  OrData    The value to OR with the read value from the value.    @return The new 8-bit value.  **/
end_comment

begin_function
name|UINT8
name|EFIAPI
name|BitFieldOr8
parameter_list|(
name|IN
name|UINT8
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT8
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT8
operator|)
name|InternalBaseLibBitFieldOrUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from an 8-bit value, performs a bitwise AND, and returns   the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new 8-bit value is returned.    If 8-bit operations are not supported, then ASSERT().   If StartBit is greater than 7, then ASSERT().   If EndBit is greater than 7, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..7.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..7.   @param  AndData   The value to AND with the read value from the value.    @return The new 8-bit value.  **/
end_comment

begin_function
name|UINT8
name|EFIAPI
name|BitFieldAnd8
parameter_list|(
name|IN
name|UINT8
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT8
name|AndData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT8
operator|)
name|InternalBaseLibBitFieldAndUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from an 8-bit value, performs a bitwise AND followed by a   bitwise OR, and returns the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData, followed by a bitwise    OR with value specified by OrData. All other bits in Operand are   preserved. The new 8-bit value is returned.    If 8-bit operations are not supported, then ASSERT().   If StartBit is greater than 7, then ASSERT().   If EndBit is greater than 7, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..7.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..7.   @param  AndData   The value to AND with the read value from the value.   @param  OrData    The value to OR with the result of the AND operation.    @return The new 8-bit value.  **/
end_comment

begin_function
name|UINT8
name|EFIAPI
name|BitFieldAndThenOr8
parameter_list|(
name|IN
name|UINT8
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT8
name|AndData
parameter_list|,
name|IN
name|UINT8
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldOr8
argument_list|(
name|BitFieldAnd8
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Returns a bit field from a 16-bit value.    Returns the bitfield specified by the StartBit and the EndBit from Operand.    If 16-bit operations are not supported, then ASSERT().   If StartBit is greater than 15, then ASSERT().   If EndBit is greater than 15, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..15.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..15.    @return The bit field read.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|BitFieldRead16
parameter_list|(
name|IN
name|UINT16
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|16
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT16
operator|)
name|InternalBaseLibBitFieldReadUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to a 16-bit value, and returns the result.    Writes Value to the bit field specified by the StartBit and the EndBit in   Operand. All other bits in Operand are preserved. The new 16-bit value is   returned.    If 16-bit operations are not supported, then ASSERT().   If StartBit is greater than 15, then ASSERT().   If EndBit is greater than 15, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..15.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..15.   @param  Value     The new value of the bit field.    @return The new 16-bit value.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|BitFieldWrite16
parameter_list|(
name|IN
name|UINT16
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT16
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|16
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldAndThenOr16
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
literal|0
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 16-bit value, performs a bitwise OR, and returns the   result.    Performs a bitwise OR between the bit field specified by StartBit   and EndBit in Operand and the value specified by OrData. All other bits in   Operand are preserved. The new 16-bit value is returned.    If 16-bit operations are not supported, then ASSERT().   If StartBit is greater than 15, then ASSERT().   If EndBit is greater than 15, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..15.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..15.   @param  OrData    The value to OR with the read value from the value.    @return The new 16-bit value.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|BitFieldOr16
parameter_list|(
name|IN
name|UINT16
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT16
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|16
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT16
operator|)
name|InternalBaseLibBitFieldOrUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 16-bit value, performs a bitwise AND, and returns   the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new 16-bit value is returned.    If 16-bit operations are not supported, then ASSERT().   If StartBit is greater than 15, then ASSERT().   If EndBit is greater than 15, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..15.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..15.   @param  AndData   The value to AND with the read value from the value.    @return The new 16-bit value.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|BitFieldAnd16
parameter_list|(
name|IN
name|UINT16
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT16
name|AndData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|16
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT16
operator|)
name|InternalBaseLibBitFieldAndUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 16-bit value, performs a bitwise AND followed by a   bitwise OR, and returns the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData, followed by a bitwise    OR with value specified by OrData. All other bits in Operand are   preserved. The new 16-bit value is returned.    If 16-bit operations are not supported, then ASSERT().   If StartBit is greater than 15, then ASSERT().   If EndBit is greater than 15, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..15.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..15.   @param  AndData   The value to AND with the read value from the value.   @param  OrData    The value to OR with the result of the AND operation.    @return The new 16-bit value.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|BitFieldAndThenOr16
parameter_list|(
name|IN
name|UINT16
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT16
name|AndData
parameter_list|,
name|IN
name|UINT16
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|16
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldOr16
argument_list|(
name|BitFieldAnd16
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Returns a bit field from a 32-bit value.    Returns the bitfield specified by the StartBit and the EndBit from Operand.    If 32-bit operations are not supported, then ASSERT().   If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.    @return The bit field read.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|BitFieldRead32
parameter_list|(
name|IN
name|UINT32
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|32
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|InternalBaseLibBitFieldReadUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to a 32-bit value, and returns the result.    Writes Value to the bit field specified by the StartBit and the EndBit in   Operand. All other bits in Operand are preserved. The new 32-bit value is   returned.    If 32-bit operations are not supported, then ASSERT().   If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  Value     The new value of the bit field.    @return The new 32-bit value.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|BitFieldWrite32
parameter_list|(
name|IN
name|UINT32
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|32
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldAndThenOr32
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
literal|0
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 32-bit value, performs a bitwise OR, and returns the   result.    Performs a bitwise OR between the bit field specified by StartBit   and EndBit in Operand and the value specified by OrData. All other bits in   Operand are preserved. The new 32-bit value is returned.    If 32-bit operations are not supported, then ASSERT().   If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  OrData    The value to OR with the read value from the value.    @return The new 32-bit value.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|BitFieldOr32
parameter_list|(
name|IN
name|UINT32
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|32
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|InternalBaseLibBitFieldOrUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 32-bit value, performs a bitwise AND, and returns   the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new 32-bit value is returned.    If 32-bit operations are not supported, then ASSERT().   If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  AndData   The value to AND with the read value from the value.    @return The new 32-bit value.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|BitFieldAnd32
parameter_list|(
name|IN
name|UINT32
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|32
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|InternalBaseLibBitFieldAndUint
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 32-bit value, performs a bitwise AND followed by a   bitwise OR, and returns the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData, followed by a bitwise    OR with value specified by OrData. All other bits in Operand are   preserved. The new 32-bit value is returned.    If 32-bit operations are not supported, then ASSERT().   If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  AndData   The value to AND with the read value from the value.   @param  OrData    The value to OR with the result of the AND operation.    @return The new 32-bit value.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|BitFieldAndThenOr32
parameter_list|(
name|IN
name|UINT32
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|32
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldOr32
argument_list|(
name|BitFieldAnd32
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Returns a bit field from a 64-bit value.    Returns the bitfield specified by the StartBit and the EndBit from Operand.    If 64-bit operations are not supported, then ASSERT().   If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.    @return The bit field read.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|BitFieldRead64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|64
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|RShiftU64
argument_list|(
name|Operand
operator|&
operator|~
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
operator|-
literal|2
argument_list|,
name|EndBit
argument_list|)
argument_list|,
name|StartBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to a 64-bit value, and returns the result.    Writes Value to the bit field specified by the StartBit and the EndBit in   Operand. All other bits in Operand are preserved. The new 64-bit value is   returned.    If 64-bit operations are not supported, then ASSERT().   If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  Value     The new value of the bit field.    @return The new 64-bit value.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|BitFieldWrite64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|64
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldAndThenOr64
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
literal|0
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 64-bit value, performs a bitwise OR, and returns the   result.    Performs a bitwise OR between the bit field specified by StartBit   and EndBit in Operand and the value specified by OrData. All other bits in   Operand are preserved. The new 64-bit value is returned.    If 64-bit operations are not supported, then ASSERT().   If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  OrData    The value to OR with the read value from the value    @return The new 64-bit value.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|BitFieldOr64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
name|UINT64
name|Value1
decl_stmt|;
name|UINT64
name|Value2
decl_stmt|;
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|64
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
comment|//
comment|// Higher bits in OrData those are not used must be zero.
comment|//
comment|// EndBit - StartBit + 1 might be 64 while the result right shifting 64 on RShiftU64() API is invalid,
comment|// So the logic is updated to right shift (EndBit - StartBit) bits and compare the last bit directly.
comment|//
name|ASSERT
argument_list|(
name|RShiftU64
argument_list|(
name|OrData
argument_list|,
name|EndBit
operator|-
name|StartBit
argument_list|)
operator|==
operator|(
name|RShiftU64
argument_list|(
name|OrData
argument_list|,
name|EndBit
operator|-
name|StartBit
argument_list|)
operator|&
literal|1
operator|)
argument_list|)
expr_stmt|;
name|Value1
operator|=
name|LShiftU64
argument_list|(
name|OrData
argument_list|,
name|StartBit
argument_list|)
expr_stmt|;
name|Value2
operator|=
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
operator|-
literal|2
argument_list|,
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|Operand
operator||
operator|(
name|Value1
operator|&
operator|~
name|Value2
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 64-bit value, performs a bitwise AND, and returns   the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData. All other bits in Operand are   preserved. The new 64-bit value is returned.    If 64-bit operations are not supported, then ASSERT().   If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  AndData   The value to AND with the read value from the value.    @return The new 64-bit value.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|BitFieldAnd64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|)
block|{
name|UINT64
name|Value1
decl_stmt|;
name|UINT64
name|Value2
decl_stmt|;
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|64
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
comment|//
comment|// Higher bits in AndData those are not used must be zero.
comment|//
comment|// EndBit - StartBit + 1 might be 64 while the right shifting 64 on RShiftU64() API is invalid,
comment|// So the logic is updated to right shift (EndBit - StartBit) bits and compare the last bit directly.
comment|//
name|ASSERT
argument_list|(
name|RShiftU64
argument_list|(
name|AndData
argument_list|,
name|EndBit
operator|-
name|StartBit
argument_list|)
operator|==
operator|(
name|RShiftU64
argument_list|(
name|AndData
argument_list|,
name|EndBit
operator|-
name|StartBit
argument_list|)
operator|&
literal|1
operator|)
argument_list|)
expr_stmt|;
name|Value1
operator|=
name|LShiftU64
argument_list|(
operator|~
name|AndData
argument_list|,
name|StartBit
argument_list|)
expr_stmt|;
name|Value2
operator|=
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
operator|-
literal|2
argument_list|,
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|Operand
operator|&
operator|~
operator|(
name|Value1
operator|&
operator|~
name|Value2
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field from a 64-bit value, performs a bitwise AND followed by a   bitwise OR, and returns the result.    Performs a bitwise AND between the bit field specified by StartBit and EndBit   in Operand and the value specified by AndData, followed by a bitwise    OR with value specified by OrData. All other bits in Operand are   preserved. The new 64-bit value is returned.    If 64-bit operations are not supported, then ASSERT().   If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Operand   Operand on which to perform the bitfield operation.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  AndData   The value to AND with the read value from the value.   @param  OrData    The value to OR with the result of the AND operation.    @return The new 64-bit value.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|BitFieldAndThenOr64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
literal|64
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
name|BitFieldOr64
argument_list|(
name|BitFieldAnd64
argument_list|(
name|Operand
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

end_unit

