begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   AsmCpuidEx function.    Copyright (c) 2006 - 2010, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_comment
comment|/**   Retrieves CPUID information using an extended leaf identifier.    Executes the CPUID instruction with EAX set to the value specified by Index   and ECX set to the value specified by SubIndex. This function always returns   Index. This function is only available on IA-32 and x64.    If Eax is not NULL, then the value of EAX after CPUID is returned in Eax.   If Ebx is not NULL, then the value of EBX after CPUID is returned in Ebx.   If Ecx is not NULL, then the value of ECX after CPUID is returned in Ecx.   If Edx is not NULL, then the value of EDX after CPUID is returned in Edx.    @param  Index         The 32-bit value to load into EAX prior to invoking the                         CPUID instruction.   @param  SubIndex      The 32-bit value to load into ECX prior to invoking the                         CPUID instruction.   @param  RegisterEax   A pointer to the 32-bit EAX value returned by the CPUID                         instruction. This is an optional parameter that may be                         NULL.   @param  RegisterEbx   A pointer to the 32-bit EBX value returned by the CPUID                         instruction. This is an optional parameter that may be                         NULL.   @param  RegisterEcx   A pointer to the 32-bit ECX value returned by the CPUID                         instruction. This is an optional parameter that may be                         NULL.   @param  RegisterEdx   A pointer to the 32-bit EDX value returned by the CPUID                         instruction. This is an optional parameter that may be                         NULL.    @return Index.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmCpuidEx
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT32
name|SubIndex
parameter_list|,
name|OUT
name|UINT32
modifier|*
name|RegisterEax
parameter_list|,
name|OPTIONAL
name|OUT
name|UINT32
modifier|*
name|RegisterEbx
parameter_list|,
name|OPTIONAL
name|OUT
name|UINT32
modifier|*
name|RegisterEcx
parameter_list|,
name|OPTIONAL
name|OUT
name|UINT32
modifier|*
name|RegisterEdx
name|OPTIONAL
parameter_list|)
block|{
name|_asm
block|{
name|mov
name|eax
decl_stmt|,
name|Index
name|mov
name|ecx
decl_stmt|,
name|SubIndex
name|cpuid
name|push
name|ecx
name|mov
name|ecx
decl_stmt|,
name|RegisterEax
name|jecxz
name|SkipEax
name|mov
index|[
name|ecx
index|]
decl_stmt|,
name|eax
name|SkipEax
range|:
name|mov
name|ecx
decl_stmt|,
name|RegisterEbx
name|jecxz
name|SkipEbx
name|mov
index|[
name|ecx
index|]
decl_stmt|,
name|ebx
name|SkipEbx
range|:
name|pop
name|eax
name|mov
name|ecx
decl_stmt|,
name|RegisterEcx
name|jecxz
name|SkipEcx
name|mov
index|[
name|ecx
index|]
decl_stmt|,
name|eax
name|SkipEcx
range|:
name|mov
name|ecx
decl_stmt|,
name|RegisterEdx
name|jecxz
name|SkipEdx
name|mov
index|[
name|ecx
index|]
decl_stmt|,
name|edx
name|SkipEdx
range|:
name|mov
name|eax
decl_stmt|,
name|Index
block|}
block|}
end_function

end_unit

