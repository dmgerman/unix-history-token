begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   IA-32/x64 MSR functions.    Copyright (c) 2006 - 2012, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"BaseLibInternals.h"
end_include

begin_comment
comment|/**   Returns the lower 32-bits of a Machine Specific Register(MSR).    Reads and returns the lower 32-bits of the MSR specified by Index.   No parameter checking is performed on Index, and some Index values may cause   CPU exceptions. The caller must either guarantee that Index is valid, or the   caller must set up exception handlers to catch the exceptions. This function   is only available on IA-32 and x64.    @param  Index The 32-bit MSR index to read.    @return The lower 32 bits of the MSR identified by Index.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmReadMsr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|)
block|{
return|return
operator|(
name|UINT32
operator|)
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a 32-bit value to a Machine Specific Register(MSR), and returns the value.   The upper 32-bits of the MSR are set to zero.    Writes the 32-bit value specified by Value to the MSR specified by Index. The   upper 32-bits of the MSR write are set to zero. The 32-bit value written to   the MSR is returned. No parameter checking is performed on Index or Value,   and some of these may cause CPU exceptions. The caller must either guarantee   that Index and Value are valid, or the caller must establish proper exception   handlers. This function is only available on IA-32 and x64.    @param  Index The 32-bit MSR index to write.   @param  Value The 32-bit value to write to the MSR.    @return Value  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmWriteMsr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT32
name|Value
parameter_list|)
block|{
return|return
operator|(
name|UINT32
operator|)
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise OR on the lower 32-bits, and   writes the result back to the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise OR   between the lower 32-bits of the read result and the value specified by   OrData, and writes the result to the 64-bit MSR specified by Index. The lower   32-bits of the value written to the MSR is returned. No parameter checking is   performed on Index or OrData, and some of these may cause CPU exceptions. The   caller must either guarantee that Index and OrData are valid, or the caller   must establish proper exception handlers. This function is only available on   IA-32 and x64.    @param  Index   The 32-bit MSR index to write.   @param  OrData  The value to OR with the read value from the MSR.    @return The lower 32-bit value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrOr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrOr64
argument_list|(
name|Index
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise AND on the lower 32-bits, and writes   the result back to the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between the   lower 32-bits of the read result and the value specified by AndData, and   writes the result to the 64-bit MSR specified by Index. The lower 32-bits of   the value written to the MSR is returned. No parameter checking is performed   on Index or AndData, and some of these may cause CPU exceptions. The caller   must either guarantee that Index and AndData are valid, or the caller must   establish proper exception handlers. This function is only available on IA-32   and x64.    @param  Index   The 32-bit MSR index to write.   @param  AndData The value to AND with the read value from the MSR.    @return The lower 32-bit value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrAnd32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|)
block|{
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrAnd64
argument_list|(
name|Index
argument_list|,
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise AND followed by a bitwise OR   on the lower 32-bits, and writes the result back to the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between the   lower 32-bits of the read result and the value specified by AndData   preserving the upper 32-bits, performs a bitwise OR between the   result of the AND operation and the value specified by OrData, and writes the   result to the 64-bit MSR specified by Address. The lower 32-bits of the value   written to the MSR is returned. No parameter checking is performed on Index,   AndData, or OrData, and some of these may cause CPU exceptions. The caller   must either guarantee that Index, AndData, and OrData are valid, or the   caller must establish proper exception handlers. This function is only   available on IA-32 and x64.    @param  Index   The 32-bit MSR index to write.   @param  AndData The value to AND with the read value from the MSR.   @param  OrData  The value to OR with the result of the AND operation.    @return The lower 32-bit value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrAndThenOr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrAndThenOr64
argument_list|(
name|Index
argument_list|,
name|AndData
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field of an MSR.    Reads the bit field in the lower 32-bits of a 64-bit MSR. The bit field is   specified by the StartBit and the EndBit. The value of the bit field is   returned. The caller must either guarantee that Index is valid, or the caller   must set up exception handlers to catch the exceptions. This function is only   available on IA-32 and x64.    If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Index     The 32-bit MSR index to read.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.    @return The bit field read from the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrBitFieldRead32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
return|return
name|BitFieldRead32
argument_list|(
name|AsmReadMsr32
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to an MSR.    Writes Value to a bit field in the lower 32-bits of a 64-bit MSR. The bit   field is specified by the StartBit and the EndBit. All other bits in the   destination MSR are preserved. The lower 32-bits of the MSR written is   returned. The caller must either guarantee that Index and the data written    is valid, or the caller must set up exception handlers to catch the exceptions.    This function is only available on IA-32 and x64.    If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  Value     The new value of the bit field.    @return The lower 32-bit of the value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrBitFieldWrite32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
sizeof|sizeof
argument_list|(
name|Value
argument_list|)
operator|*
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrBitFieldWrite64
argument_list|(
name|Index
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|Value
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise OR, and writes the   result back to the bit field in the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise OR   between the read result and the value specified by OrData, and writes the   result to the 64-bit MSR specified by Index. The lower 32-bits of the value   written to the MSR are returned. Extra left bits in OrData are stripped. The   caller must either guarantee that Index and the data written is valid, or   the caller must set up exception handlers to catch the exceptions. This   function is only available on IA-32 and x64.    If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  OrData    The value to OR with the read value from the MSR.    @return The lower 32-bit of the value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrBitFieldOr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
sizeof|sizeof
argument_list|(
name|OrData
argument_list|)
operator|*
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrBitFieldOr64
argument_list|(
name|Index
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise AND, and writes the   result back to the bit field in the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between the   read result and the value specified by AndData, and writes the result to the   64-bit MSR specified by Index. The lower 32-bits of the value written to the   MSR are returned. Extra left bits in AndData are stripped. The caller must   either guarantee that Index and the data written is valid, or the caller must   set up exception handlers to catch the exceptions. This function is only   available on IA-32 and x64.    If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  AndData   The value to AND with the read value from the MSR.    @return The lower 32-bit of the value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrBitFieldAnd32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
sizeof|sizeof
argument_list|(
name|AndData
argument_list|)
operator|*
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrBitFieldAnd64
argument_list|(
name|Index
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise AND followed by a   bitwise OR, and writes the result back to the bit field in the   64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND followed by a   bitwise OR between the read result and the value specified by   AndData, and writes the result to the 64-bit MSR specified by Index. The   lower 32-bits of the value written to the MSR are returned. Extra left bits   in both AndData and OrData are stripped. The caller must either guarantee   that Index and the data written is valid, or the caller must set up exception   handlers to catch the exceptions. This function is only available on IA-32   and x64.    If StartBit is greater than 31, then ASSERT().   If EndBit is greater than 31, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..31.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..31.   @param  AndData   The value to AND with the read value from the MSR.   @param  OrData    The value to OR with the result of the AND operation.    @return The lower 32-bit of the value written to the MSR.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|AsmMsrBitFieldAndThenOr32
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT32
name|AndData
parameter_list|,
name|IN
name|UINT32
name|OrData
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|EndBit
operator|<
sizeof|sizeof
argument_list|(
name|AndData
argument_list|)
operator|*
literal|8
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartBit
operator|<=
name|EndBit
argument_list|)
expr_stmt|;
return|return
operator|(
name|UINT32
operator|)
name|AsmMsrBitFieldAndThenOr64
argument_list|(
name|Index
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|,
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise OR, and writes the result   back to the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise OR   between the read result and the value specified by OrData, and writes the   result to the 64-bit MSR specified by Index. The value written to the MSR is   returned. No parameter checking is performed on Index or OrData, and some of   these may cause CPU exceptions. The caller must either guarantee that Index   and OrData are valid, or the caller must establish proper exception handlers.   This function is only available on IA-32 and x64.    @param  Index   The 32-bit MSR index to write.   @param  OrData  The value to OR with the read value from the MSR.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrOr64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
operator||
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise AND, and writes the result back to the   64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between the   read result and the value specified by OrData, and writes the result to the   64-bit MSR specified by Index. The value written to the MSR is returned. No   parameter checking is performed on Index or OrData, and some of these may   cause CPU exceptions. The caller must either guarantee that Index and OrData   are valid, or the caller must establish proper exception handlers. This   function is only available on IA-32 and x64.    @param  Index   The 32-bit MSR index to write.   @param  AndData The value to AND with the read value from the MSR.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrAnd64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
operator|&
name|AndData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit MSR, performs a bitwise AND followed by a bitwise    OR, and writes the result back to the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between read   result and the value specified by AndData, performs a bitwise OR   between the result of the AND operation and the value specified by OrData,   and writes the result to the 64-bit MSR specified by Index. The value written   to the MSR is returned. No parameter checking is performed on Index, AndData,   or OrData, and some of these may cause CPU exceptions. The caller must either   guarantee that Index, AndData, and OrData are valid, or the caller must   establish proper exception handlers. This function is only available on IA-32   and x64.    @param  Index   The 32-bit MSR index to write.   @param  AndData The value to AND with the read value from the MSR.   @param  OrData  The value to OR with the result of the AND operation.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrAndThenOr64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
operator|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
operator|&
name|AndData
operator|)
operator||
name|OrData
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field of an MSR.    Reads the bit field in the 64-bit MSR. The bit field is specified by the   StartBit and the EndBit. The value of the bit field is returned. The caller   must either guarantee that Index is valid, or the caller must set up   exception handlers to catch the exceptions. This function is only available   on IA-32 and x64.    If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().    @param  Index     The 32-bit MSR index to read.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.    @return The value read from the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrBitFieldRead64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|)
block|{
return|return
name|BitFieldRead64
argument_list|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a bit field to an MSR.    Writes Value to a bit field in a 64-bit MSR. The bit field is specified by   the StartBit and the EndBit. All other bits in the destination MSR are   preserved. The MSR written is returned. The caller must either guarantee    that Index and the data written is valid, or the caller must set up exception    handlers to catch the exceptions. This function is only available on IA-32 and x64.    If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If Value is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  Value     The new value of the bit field.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrBitFieldWrite64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|Value
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|BitFieldWrite64
argument_list|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|Value
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise OR, and   writes the result back to the bit field in the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise OR   between the read result and the value specified by OrData, and writes the   result to the 64-bit MSR specified by Index. The value written to the MSR is   returned. Extra left bits in OrData are stripped. The caller must either   guarantee that Index and the data written is valid, or the caller must set up   exception handlers to catch the exceptions. This function is only available   on IA-32 and x64.    If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  OrData    The value to OR with the read value from the bit field.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrBitFieldOr64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|BitFieldOr64
argument_list|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|OrData
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise AND, and writes the   result back to the bit field in the 64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND between the   read result and the value specified by AndData, and writes the result to the   64-bit MSR specified by Index. The value written to the MSR is returned.   Extra left bits in AndData are stripped. The caller must either guarantee   that Index and the data written is valid, or the caller must set up exception   handlers to catch the exceptions. This function is only available on IA-32   and x64.    If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  AndData   The value to AND with the read value from the bit field.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrBitFieldAnd64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|BitFieldAnd64
argument_list|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Reads a bit field in a 64-bit MSR, performs a bitwise AND followed by a   bitwise OR, and writes the result back to the bit field in the   64-bit MSR.    Reads the 64-bit MSR specified by Index, performs a bitwise AND followed by   a bitwise OR between the read result and the value specified by   AndData, and writes the result to the 64-bit MSR specified by Index. The   value written to the MSR is returned. Extra left bits in both AndData and   OrData are stripped. The caller must either guarantee that Index and the data   written is valid, or the caller must set up exception handlers to catch the   exceptions. This function is only available on IA-32 and x64.    If StartBit is greater than 63, then ASSERT().   If EndBit is greater than 63, then ASSERT().   If EndBit is less than StartBit, then ASSERT().   If AndData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().   If OrData is larger than the bitmask value range specified by StartBit and EndBit, then ASSERT().    @param  Index     The 32-bit MSR index to write.   @param  StartBit  The ordinal of the least significant bit in the bit field.                     Range 0..63.   @param  EndBit    The ordinal of the most significant bit in the bit field.                     Range 0..63.   @param  AndData   The value to AND with the read value from the bit field.   @param  OrData    The value to OR with the result of the AND operation.    @return The value written back to the MSR.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|AsmMsrBitFieldAndThenOr64
parameter_list|(
name|IN
name|UINT32
name|Index
parameter_list|,
name|IN
name|UINTN
name|StartBit
parameter_list|,
name|IN
name|UINTN
name|EndBit
parameter_list|,
name|IN
name|UINT64
name|AndData
parameter_list|,
name|IN
name|UINT64
name|OrData
parameter_list|)
block|{
return|return
name|AsmWriteMsr64
argument_list|(
name|Index
argument_list|,
name|BitFieldAndThenOr64
argument_list|(
name|AsmReadMsr64
argument_list|(
name|Index
argument_list|)
argument_list|,
name|StartBit
argument_list|,
name|EndBit
argument_list|,
name|AndData
argument_list|,
name|OrData
argument_list|)
argument_list|)
return|;
block|}
end_function

end_unit

