begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Unaligned access functions of BaseLib for IPF.    Copyright (c) 2006 - 2010, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"BaseLibInternals.h"
end_include

begin_comment
comment|/**   Reads a 16-bit value from memory that may be unaligned.    This function returns the 16-bit value pointed to by Buffer. The function   guarantees that the read operation does not produce an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 16-bit value that may be unaligned.    @return The 16-bit value read from Buffer.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|ReadUnaligned16
parameter_list|(
name|IN
name|CONST
name|UINT16
modifier|*
name|Buffer
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
call|(
name|UINT16
call|)
argument_list|(
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
operator|)
index|[
literal|0
index|]
operator||
operator|(
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
operator|)
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a 16-bit value to memory that may be unaligned.    This function writes the 16-bit value specified by Value to Buffer. Value is   returned. The function guarantees that the write operation does not produce   an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 16-bit value that may be unaligned.   @param  Value   The 16-bit value to write to Buffer.    @return The 16-bit value to write to Buffer.  **/
end_comment

begin_function
name|UINT16
name|EFIAPI
name|WriteUnaligned16
parameter_list|(
name|OUT
name|UINT16
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINT16
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
operator|)
index|[
literal|0
index|]
operator|=
operator|(
name|UINT8
operator|)
name|Value
expr_stmt|;
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
operator|)
index|[
literal|1
index|]
operator|=
call|(
name|UINT8
call|)
argument_list|(
name|Value
operator|>>
literal|8
argument_list|)
expr_stmt|;
return|return
name|Value
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 24-bit value from memory that may be unaligned.    This function returns the 24-bit value pointed to by Buffer. The function   guarantees that the read operation does not produce an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 24-bit value that may be unaligned.    @return The 24-bit value read from Buffer.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|ReadUnaligned24
parameter_list|(
name|IN
name|CONST
name|UINT32
modifier|*
name|Buffer
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
call|(
name|UINT32
call|)
argument_list|(
name|ReadUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
argument_list|)
operator||
operator|(
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Buffer
operator|)
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a 24-bit value to memory that may be unaligned.    This function writes the 24-bit value specified by Value to Buffer. Value is   returned. The function guarantees that the write operation does not produce   an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 24-bit value that may be unaligned.   @param  Value   The 24-bit value to write to Buffer.    @return The 24-bit value to write to Buffer.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|WriteUnaligned24
parameter_list|(
name|OUT
name|UINT32
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINT32
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|WriteUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
argument_list|,
operator|(
name|UINT16
operator|)
name|Value
argument_list|)
expr_stmt|;
operator|*
operator|(
name|UINT8
operator|*
operator|)
operator|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
operator|+
literal|1
operator|)
operator|=
call|(
name|UINT8
call|)
argument_list|(
name|Value
operator|>>
literal|16
argument_list|)
expr_stmt|;
return|return
name|Value
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 32-bit value from memory that may be unaligned.    This function returns the 32-bit value pointed to by Buffer. The function   guarantees that the read operation does not produce an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 32-bit value that may be unaligned.    @return The 32-bit value read from Buffer.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|ReadUnaligned32
parameter_list|(
name|IN
name|CONST
name|UINT32
modifier|*
name|Buffer
parameter_list|)
block|{
name|UINT16
name|LowerBytes
decl_stmt|;
name|UINT16
name|HigherBytes
decl_stmt|;
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|LowerBytes
operator|=
name|ReadUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
argument_list|)
expr_stmt|;
name|HigherBytes
operator|=
name|ReadUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
call|(
name|UINT32
call|)
argument_list|(
name|LowerBytes
operator||
operator|(
name|HigherBytes
operator|<<
literal|16
operator|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a 32-bit value to memory that may be unaligned.    This function writes the 32-bit value specified by Value to Buffer. Value is   returned. The function guarantees that the write operation does not produce   an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 32-bit value that may be unaligned.   @param  Value   The 32-bit value to write to Buffer.    @return The 32-bit value to write to Buffer.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|WriteUnaligned32
parameter_list|(
name|OUT
name|UINT32
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINT32
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|WriteUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
argument_list|,
operator|(
name|UINT16
operator|)
name|Value
argument_list|)
expr_stmt|;
name|WriteUnaligned16
argument_list|(
operator|(
name|UINT16
operator|*
operator|)
name|Buffer
operator|+
literal|1
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
name|Value
operator|>>
literal|16
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Value
return|;
block|}
end_function

begin_comment
comment|/**   Reads a 64-bit value from memory that may be unaligned.    This function returns the 64-bit value pointed to by Buffer. The function   guarantees that the read operation does not produce an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 64-bit value that may be unaligned.    @return The 64-bit value read from Buffer.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|ReadUnaligned64
parameter_list|(
name|IN
name|CONST
name|UINT64
modifier|*
name|Buffer
parameter_list|)
block|{
name|UINT32
name|LowerBytes
decl_stmt|;
name|UINT32
name|HigherBytes
decl_stmt|;
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|LowerBytes
operator|=
name|ReadUnaligned32
argument_list|(
operator|(
name|UINT32
operator|*
operator|)
name|Buffer
argument_list|)
expr_stmt|;
name|HigherBytes
operator|=
name|ReadUnaligned32
argument_list|(
operator|(
name|UINT32
operator|*
operator|)
name|Buffer
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
call|(
name|UINT64
call|)
argument_list|(
name|LowerBytes
operator||
name|LShiftU64
argument_list|(
name|HigherBytes
argument_list|,
literal|32
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Writes a 64-bit value to memory that may be unaligned.    This function writes the 64-bit value specified by Value to Buffer. Value is   returned. The function guarantees that the write operation does not produce   an alignment fault.    If the Buffer is NULL, then ASSERT().    @param  Buffer  The pointer to a 64-bit value that may be unaligned.   @param  Value   The 64-bit value to write to Buffer.    @return The 64-bit value to write to Buffer.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|WriteUnaligned64
parameter_list|(
name|OUT
name|UINT64
modifier|*
name|Buffer
parameter_list|,
name|IN
name|UINT64
name|Value
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Buffer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|WriteUnaligned32
argument_list|(
operator|(
name|UINT32
operator|*
operator|)
name|Buffer
argument_list|,
operator|(
name|UINT32
operator|)
name|Value
argument_list|)
expr_stmt|;
name|WriteUnaligned32
argument_list|(
operator|(
name|UINT32
operator|*
operator|)
name|Buffer
operator|+
literal|1
argument_list|,
operator|(
name|UINT32
operator|)
name|RShiftU64
argument_list|(
name|Value
argument_list|,
literal|32
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Value
return|;
block|}
end_function

end_unit

