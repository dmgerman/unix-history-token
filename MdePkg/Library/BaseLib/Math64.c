begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Leaf math worker functions that require 64-bit arithmetic support from the   compiler.    Copyright (c) 2006 - 2010, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|"BaseLibInternals.h"
end_include

begin_comment
comment|/**   Shifts a 64-bit integer left between 0 and 63 bits. The low bits   are filled with zeros. The shifted value is returned.    This function shifts the 64-bit value Operand to the left by Count bits. The   low Count bits are set to zero. The shifted value is returned.    @param  Operand The 64-bit operand to shift left.   @param  Count   The number of bits to shift left.    @return Operand<< Count.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathLShiftU64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|Count
parameter_list|)
block|{
return|return
name|Operand
operator|<<
name|Count
return|;
block|}
end_function

begin_comment
comment|/**   Shifts a 64-bit integer right between 0 and 63 bits. This high bits   are filled with zeros. The shifted value is returned.    This function shifts the 64-bit value Operand to the right by Count bits. The   high Count bits are set to zero. The shifted value is returned.    @param  Operand The 64-bit operand to shift right.   @param  Count   The number of bits to shift right.    @return Operand>> Count.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathRShiftU64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|Count
parameter_list|)
block|{
return|return
name|Operand
operator|>>
name|Count
return|;
block|}
end_function

begin_comment
comment|/**   Shifts a 64-bit integer right between 0 and 63 bits. The high bits   are filled with original integer's bit 63. The shifted value is returned.    This function shifts the 64-bit value Operand to the right by Count bits. The   high Count bits are set to bit 63 of Operand.  The shifted value is returned.    @param  Operand The 64-bit operand to shift right.   @param  Count   The number of bits to shift right.    @return Operand arithmetically shifted right by Count.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathARShiftU64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|Count
parameter_list|)
block|{
name|INTN
name|TestValue
decl_stmt|;
comment|//
comment|// Test if this compiler supports arithmetic shift
comment|//
name|TestValue
operator|=
call|(
name|INTN
call|)
argument_list|(
call|(
name|INT64
call|)
argument_list|(
literal|1ULL
operator|<<
literal|63
argument_list|)
operator|>>
literal|63
argument_list|)
expr_stmt|;
if|if
condition|(
name|TestValue
operator|==
operator|-
literal|1
condition|)
block|{
comment|//
comment|// Arithmetic shift is supported
comment|//
return|return
call|(
name|UINT64
call|)
argument_list|(
operator|(
name|INT64
operator|)
name|Operand
operator|>>
name|Count
argument_list|)
return|;
block|}
comment|//
comment|// Arithmetic is not supported
comment|//
return|return
operator|(
name|Operand
operator|>>
name|Count
operator|)
operator||
operator|(
operator|(
name|INTN
operator|)
name|Operand
operator|<
literal|0
condition|?
operator|~
operator|(
operator|(
name|UINTN
operator|)
operator|-
literal|1
operator|>>
name|Count
operator|)
else|:
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Rotates a 64-bit integer left between 0 and 63 bits, filling   the low bits with the high bits that were rotated.    This function rotates the 64-bit value Operand to the left by Count bits. The   low Count bits are fill with the high Count bits of Operand. The rotated   value is returned.    @param  Operand The 64-bit operand to rotate left.   @param  Count   The number of bits to rotate left.    @return Operand<<< Count.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathLRotU64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|Count
parameter_list|)
block|{
return|return
operator|(
name|Operand
operator|<<
name|Count
operator|)
operator||
operator|(
name|Operand
operator|>>
operator|(
literal|64
operator|-
name|Count
operator|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Rotates a 64-bit integer right between 0 and 63 bits, filling   the high bits with the high low bits that were rotated.    This function rotates the 64-bit value Operand to the right by Count bits.   The high Count bits are fill with the low Count bits of Operand. The rotated   value is returned.    @param  Operand The 64-bit operand to rotate right.   @param  Count   The number of bits to rotate right.    @return Operand>>> Count.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathRRotU64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|,
name|IN
name|UINTN
name|Count
parameter_list|)
block|{
return|return
operator|(
name|Operand
operator|>>
name|Count
operator|)
operator||
operator|(
name|Operand
operator|<<
operator|(
literal|64
operator|-
name|Count
operator|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Switches the endianess of a 64-bit integer.    This function swaps the bytes in a 64-bit unsigned value to switch the value   from little endian to big endian or vice versa. The byte swapped value is   returned.    @param  Operand A 64-bit unsigned value.    @return The byte swapped Operand.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathSwapBytes64
parameter_list|(
name|IN
name|UINT64
name|Operand
parameter_list|)
block|{
name|UINT64
name|LowerBytes
decl_stmt|;
name|UINT64
name|HigherBytes
decl_stmt|;
name|LowerBytes
operator|=
operator|(
name|UINT64
operator|)
name|SwapBytes32
argument_list|(
operator|(
name|UINT32
operator|)
name|Operand
argument_list|)
expr_stmt|;
name|HigherBytes
operator|=
operator|(
name|UINT64
operator|)
name|SwapBytes32
argument_list|(
call|(
name|UINT32
call|)
argument_list|(
name|Operand
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|LowerBytes
operator|<<
literal|32
operator||
name|HigherBytes
operator|)
return|;
block|}
end_function

begin_comment
comment|/**   Multiplies a 64-bit unsigned integer by a 32-bit unsigned integer   and generates a 64-bit unsigned result.    This function multiplies the 64-bit unsigned value Multiplicand by the 32-bit   unsigned value Multiplier and generates a 64-bit unsigned result. This 64-   bit unsigned result is returned.    @param  Multiplicand  A 64-bit unsigned value.   @param  Multiplier    A 32-bit unsigned value.    @return Multiplicand * Multiplier  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathMultU64x32
parameter_list|(
name|IN
name|UINT64
name|Multiplicand
parameter_list|,
name|IN
name|UINT32
name|Multiplier
parameter_list|)
block|{
return|return
name|Multiplicand
operator|*
name|Multiplier
return|;
block|}
end_function

begin_comment
comment|/**   Multiplies a 64-bit unsigned integer by a 64-bit unsigned integer   and generates a 64-bit unsigned result.    This function multiplies the 64-bit unsigned value Multiplicand by the 64-bit   unsigned value Multiplier and generates a 64-bit unsigned result. This 64-   bit unsigned result is returned.    @param  Multiplicand  A 64-bit unsigned value.   @param  Multiplier    A 64-bit unsigned value.    @return Multiplicand * Multiplier.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathMultU64x64
parameter_list|(
name|IN
name|UINT64
name|Multiplicand
parameter_list|,
name|IN
name|UINT64
name|Multiplier
parameter_list|)
block|{
return|return
name|Multiplicand
operator|*
name|Multiplier
return|;
block|}
end_function

begin_comment
comment|/**   Divides a 64-bit unsigned integer by a 32-bit unsigned integer and   generates a 64-bit unsigned result.    This function divides the 64-bit unsigned value Dividend by the 32-bit   unsigned value Divisor and generates a 64-bit unsigned quotient. This   function returns the 64-bit unsigned quotient.    @param  Dividend  A 64-bit unsigned value.   @param  Divisor   A 32-bit unsigned value.    @return Dividend / Divisor.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathDivU64x32
parameter_list|(
name|IN
name|UINT64
name|Dividend
parameter_list|,
name|IN
name|UINT32
name|Divisor
parameter_list|)
block|{
return|return
name|Dividend
operator|/
name|Divisor
return|;
block|}
end_function

begin_comment
comment|/**   Divides a 64-bit unsigned integer by a 32-bit unsigned integer and   generates a 32-bit unsigned remainder.    This function divides the 64-bit unsigned value Dividend by the 32-bit   unsigned value Divisor and generates a 32-bit remainder. This function   returns the 32-bit unsigned remainder.    @param  Dividend  A 64-bit unsigned value.   @param  Divisor   A 32-bit unsigned value.    @return Dividend % Divisor.  **/
end_comment

begin_function
name|UINT32
name|EFIAPI
name|InternalMathModU64x32
parameter_list|(
name|IN
name|UINT64
name|Dividend
parameter_list|,
name|IN
name|UINT32
name|Divisor
parameter_list|)
block|{
return|return
call|(
name|UINT32
call|)
argument_list|(
name|Dividend
operator|%
name|Divisor
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Divides a 64-bit unsigned integer by a 32-bit unsigned integer and   generates a 64-bit unsigned result and an optional 32-bit unsigned remainder.    This function divides the 64-bit unsigned value Dividend by the 32-bit   unsigned value Divisor and generates a 64-bit unsigned quotient. If Remainder   is not NULL, then the 32-bit unsigned remainder is returned in Remainder.   This function returns the 64-bit unsigned quotient.    @param  Dividend  A 64-bit unsigned value.   @param  Divisor   A 32-bit unsigned value.   @param  Remainder A pointer to a 32-bit unsigned value. This parameter is                     optional and may be NULL.    @return Dividend / Divisor.  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathDivRemU64x32
parameter_list|(
name|IN
name|UINT64
name|Dividend
parameter_list|,
name|IN
name|UINT32
name|Divisor
parameter_list|,
name|OUT
name|UINT32
modifier|*
name|Remainder
name|OPTIONAL
parameter_list|)
block|{
if|if
condition|(
name|Remainder
operator|!=
name|NULL
condition|)
block|{
operator|*
name|Remainder
operator|=
call|(
name|UINT32
call|)
argument_list|(
name|Dividend
operator|%
name|Divisor
argument_list|)
expr_stmt|;
block|}
return|return
name|Dividend
operator|/
name|Divisor
return|;
block|}
end_function

begin_comment
comment|/**   Divides a 64-bit unsigned integer by a 64-bit unsigned integer and   generates a 64-bit unsigned result and an optional 64-bit unsigned remainder.    This function divides the 64-bit unsigned value Dividend by the 64-bit   unsigned value Divisor and generates a 64-bit unsigned quotient. If Remainder   is not NULL, then the 64-bit unsigned remainder is returned in Remainder.   This function returns the 64-bit unsigned quotient.    @param  Dividend  A 64-bit unsigned value.   @param  Divisor   A 64-bit unsigned value.   @param  Remainder A pointer to a 64-bit unsigned value. This parameter is                     optional and may be NULL.    @return Dividend / Divisor  **/
end_comment

begin_function
name|UINT64
name|EFIAPI
name|InternalMathDivRemU64x64
parameter_list|(
name|IN
name|UINT64
name|Dividend
parameter_list|,
name|IN
name|UINT64
name|Divisor
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|Remainder
name|OPTIONAL
parameter_list|)
block|{
if|if
condition|(
name|Remainder
operator|!=
name|NULL
condition|)
block|{
operator|*
name|Remainder
operator|=
name|Dividend
operator|%
name|Divisor
expr_stmt|;
block|}
return|return
name|Dividend
operator|/
name|Divisor
return|;
block|}
end_function

begin_comment
comment|/**   Divides a 64-bit signed integer by a 64-bit signed integer and   generates a 64-bit signed result and an optional 64-bit signed remainder.    This function divides the 64-bit signed value Dividend by the 64-bit   signed value Divisor and generates a 64-bit signed quotient. If Remainder   is not NULL, then the 64-bit signed remainder is returned in Remainder.   This function returns the 64-bit signed quotient.    @param  Dividend  A 64-bit signed value.   @param  Divisor   A 64-bit signed value.   @param  Remainder A pointer to a 64-bit signed value. This parameter is                     optional and may be NULL.    @return Dividend / Divisor.  **/
end_comment

begin_function
name|INT64
name|EFIAPI
name|InternalMathDivRemS64x64
parameter_list|(
name|IN
name|INT64
name|Dividend
parameter_list|,
name|IN
name|INT64
name|Divisor
parameter_list|,
name|OUT
name|INT64
modifier|*
name|Remainder
name|OPTIONAL
parameter_list|)
block|{
if|if
condition|(
name|Remainder
operator|!=
name|NULL
condition|)
block|{
operator|*
name|Remainder
operator|=
name|Dividend
operator|%
name|Divisor
expr_stmt|;
block|}
return|return
name|Dividend
operator|/
name|Divisor
return|;
block|}
end_function

end_unit

