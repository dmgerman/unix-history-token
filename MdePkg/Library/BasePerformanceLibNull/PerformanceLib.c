begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/** @file   Base Performance Library which provides no service.    Copyright (c) 2006 - 2012, Intel Corporation. All rights reserved.<BR>   This program and the accompanying materials   are licensed and made available under the terms and conditions of the BSD License   which accompanies this distribution.  The full text of the license may be found at   http://opensource.org/licenses/bsd-license.php.    THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS,   WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_include
include|#
directive|include
file|<Base.h>
end_include

begin_include
include|#
directive|include
file|<Library/PerformanceLib.h>
end_include

begin_include
include|#
directive|include
file|<Library/DebugLib.h>
end_include

begin_include
include|#
directive|include
file|<Library/PcdLib.h>
end_include

begin_comment
comment|/**   Creates a record for the beginning of a performance measurement.       Creates a record that contains the Handle, Token, and Module.   If TimeStamp is not zero, then TimeStamp is added to the record as the start time.   If TimeStamp is zero, then this function reads the current time stamp   and adds that time stamp value to the record as the start time.    @param  Handle                  The pointer to environment specific context used                                   to identify the component being measured.   @param  Token                   The pointer to a Null-terminated ASCII string                                   that identifies the component being measured.   @param  Module                  The pointer to a Null-terminated ASCII string                                   that identifies the module being measured.   @param  TimeStamp               64-bit time stamp.    @retval RETURN_SUCCESS          The start of the measurement was recorded.   @retval RETURN_OUT_OF_RESOURCES There are not enough resources to record the measurement.   @retval RETURN_DEVICE_ERROR     A device error reading the time stamp.  **/
end_comment

begin_function
name|RETURN_STATUS
name|EFIAPI
name|StartPerformanceMeasurement
parameter_list|(
name|IN
name|CONST
name|VOID
modifier|*
name|Handle
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Token
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Module
parameter_list|,
name|OPTIONAL
name|IN
name|UINT64
name|TimeStamp
parameter_list|)
block|{
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**   Fills in the end time of a performance measurement.       Looks up the record that matches Handle, Token, and Module.   If the record can not be found then return RETURN_NOT_FOUND.   If the record is found and TimeStamp is not zero,   then TimeStamp is added to the record as the end time.   If the record is found and TimeStamp is zero, then this function reads   the current time stamp and adds that time stamp value to the record as the end time.    @param  Handle                  The pointer to environment specific context used                                   to identify the component being measured.   @param  Token                   The pointer to a Null-terminated ASCII string                                   that identifies the component being measured.   @param  Module                  The pointer to a Null-terminated ASCII string                                   that identifies the module being measured.   @param  TimeStamp               64-bit time stamp.    @retval RETURN_SUCCESS          The end of the measurement was recorded.   @retval RETURN_NOT_FOUND        The specified measurement record could not be found.   @retval RETURN_DEVICE_ERROR     A device error reading the time stamp.  **/
end_comment

begin_function
name|RETURN_STATUS
name|EFIAPI
name|EndPerformanceMeasurement
parameter_list|(
name|IN
name|CONST
name|VOID
modifier|*
name|Handle
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Token
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Module
parameter_list|,
name|OPTIONAL
name|IN
name|UINT64
name|TimeStamp
parameter_list|)
block|{
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**   Attempts to retrieve a performance measurement log entry from the performance measurement log.    It can also retrieve the log created by StartPerformanceMeasurementEx and EndPerformanceMeasurementEx,   and then eliminate the Identifier.    Attempts to retrieve the performance log entry specified by LogEntryKey.  If LogEntryKey is   zero on entry, then an attempt is made to retrieve the first entry from the performance log,   and the key for the second entry in the log is returned.  If the performance log is empty,   then no entry is retrieved and zero is returned.  If LogEntryKey is not zero, then the performance   log entry associated with LogEntryKey is retrieved, and the key for the next entry in the log is   returned.  If LogEntryKey is the key for the last entry in the log, then the last log entry is   retrieved and an implementation specific non-zero key value that specifies the end of the performance   log is returned.  If LogEntryKey is equal this implementation specific non-zero key value, then no entry   is retrieved and zero is returned.  In the cases where a performance log entry can be returned,   the log entry is returned in Handle, Token, Module, StartTimeStamp, and EndTimeStamp.   If LogEntryKey is not a valid log entry key for the performance measurement log, then ASSERT().   If Handle is NULL, then ASSERT().   If Token is NULL, then ASSERT().   If Module is NULL, then ASSERT().   If StartTimeStamp is NULL, then ASSERT().   If EndTimeStamp is NULL, then ASSERT().    @param  LogEntryKey             On entry, the key of the performance measurement log entry to retrieve.                                   0, then the first performance measurement log entry is retrieved.                                   On exit, the key of the next performance lof entry entry.   @param  Handle                  The pointer to environment specific context used to identify the component                                   being measured.     @param  Token                   The pointer to a Null-terminated ASCII string that identifies the component                                   being measured.    @param  Module                  The pointer to a Null-terminated ASCII string that identifies the module                                   being measured.   @param  StartTimeStamp          The pointer to the 64-bit time stamp that was recorded when the measurement                                   was started.   @param  EndTimeStamp            The pointer to the 64-bit time stamp that was recorded when the measurement                                   was ended.    @return The key for the next performance log entry (in general case).  **/
end_comment

begin_function
name|UINTN
name|EFIAPI
name|GetPerformanceMeasurement
parameter_list|(
name|IN
name|UINTN
name|LogEntryKey
parameter_list|,
name|OUT
name|CONST
name|VOID
modifier|*
modifier|*
name|Handle
parameter_list|,
name|OUT
name|CONST
name|CHAR8
modifier|*
modifier|*
name|Token
parameter_list|,
name|OUT
name|CONST
name|CHAR8
modifier|*
modifier|*
name|Module
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|StartTimeStamp
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|EndTimeStamp
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Token
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Module
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartTimeStamp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|EndTimeStamp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**   Creates a record for the beginning of a performance measurement.    Creates a record that contains the Handle, Token, Module and Identifier.   If TimeStamp is not zero, then TimeStamp is added to the record as the start time.   If TimeStamp is zero, then this function reads the current time stamp   and adds that time stamp value to the record as the start time.    @param  Handle                  Pointer to environment specific context used                                   to identify the component being measured.   @param  Token                   Pointer to a Null-terminated ASCII string                                   that identifies the component being measured.   @param  Module                  Pointer to a Null-terminated ASCII string                                   that identifies the module being measured.   @param  TimeStamp               64-bit time stamp.   @param  Identifier              32-bit identifier. If the value is 0, the created record                                   is same as the one created by StartPerformanceMeasurement.    @retval RETURN_SUCCESS          The start of the measurement was recorded.   @retval RETURN_OUT_OF_RESOURCES There are not enough resources to record the measurement.   @retval RETURN_DEVICE_ERROR     A device error reading the time stamp.  **/
end_comment

begin_function
name|RETURN_STATUS
name|EFIAPI
name|StartPerformanceMeasurementEx
parameter_list|(
name|IN
name|CONST
name|VOID
modifier|*
name|Handle
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Token
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Module
parameter_list|,
name|OPTIONAL
name|IN
name|UINT64
name|TimeStamp
parameter_list|,
name|IN
name|UINT32
name|Identifier
parameter_list|)
block|{
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**   Fills in the end time of a performance measurement.    Looks up the record that matches Handle, Token, Module and Identifier.   If the record can not be found then return RETURN_NOT_FOUND.   If the record is found and TimeStamp is not zero,   then TimeStamp is added to the record as the end time.   If the record is found and TimeStamp is zero, then this function reads   the current time stamp and adds that time stamp value to the record as the end time.    @param  Handle                  Pointer to environment specific context used                                   to identify the component being measured.   @param  Token                   Pointer to a Null-terminated ASCII string                                   that identifies the component being measured.   @param  Module                  Pointer to a Null-terminated ASCII string                                   that identifies the module being measured.   @param  TimeStamp               64-bit time stamp.   @param  Identifier              32-bit identifier. If the value is 0, the found record                                   is same as the one found by EndPerformanceMeasurement.    @retval RETURN_SUCCESS          The end of  the measurement was recorded.   @retval RETURN_NOT_FOUND        The specified measurement record could not be found.   @retval RETURN_DEVICE_ERROR     A device error reading the time stamp.  **/
end_comment

begin_function
name|RETURN_STATUS
name|EFIAPI
name|EndPerformanceMeasurementEx
parameter_list|(
name|IN
name|CONST
name|VOID
modifier|*
name|Handle
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Token
parameter_list|,
name|OPTIONAL
name|IN
name|CONST
name|CHAR8
modifier|*
name|Module
parameter_list|,
name|OPTIONAL
name|IN
name|UINT64
name|TimeStamp
parameter_list|,
name|IN
name|UINT32
name|Identifier
parameter_list|)
block|{
return|return
name|RETURN_SUCCESS
return|;
block|}
end_function

begin_comment
comment|/**   Attempts to retrieve a performance measurement log entry from the performance measurement log.   It can also retrieve the log created by StartPerformanceMeasurement and EndPerformanceMeasurement,   and then assign the Identifier with 0.    Attempts to retrieve the performance log entry specified by LogEntryKey.  If LogEntryKey is   zero on entry, then an attempt is made to retrieve the first entry from the performance log,   and the key for the second entry in the log is returned.  If the performance log is empty,   then no entry is retrieved and zero is returned.  If LogEntryKey is not zero, then the performance   log entry associated with LogEntryKey is retrieved, and the key for the next entry in the log is   returned.  If LogEntryKey is the key for the last entry in the log, then the last log entry is   retrieved and an implementation specific non-zero key value that specifies the end of the performance   log is returned.  If LogEntryKey is equal this implementation specific non-zero key value, then no entry   is retrieved and zero is returned.  In the cases where a performance log entry can be returned,   the log entry is returned in Handle, Token, Module, StartTimeStamp, EndTimeStamp and Identifier.   If LogEntryKey is not a valid log entry key for the performance measurement log, then ASSERT().   If Handle is NULL, then ASSERT().   If Token is NULL, then ASSERT().   If Module is NULL, then ASSERT().   If StartTimeStamp is NULL, then ASSERT().   If EndTimeStamp is NULL, then ASSERT().   If Identifier is NULL, then ASSERT().    @param  LogEntryKey             On entry, the key of the performance measurement log entry to retrieve.                                   0, then the first performance measurement log entry is retrieved.                                   On exit, the key of the next performance lof entry entry.   @param  Handle                  Pointer to environment specific context used to identify the component                                   being measured.   @param  Token                   Pointer to a Null-terminated ASCII string that identifies the component                                   being measured.   @param  Module                  Pointer to a Null-terminated ASCII string that identifies the module                                   being measured.   @param  StartTimeStamp          Pointer to the 64-bit time stamp that was recorded when the measurement                                   was started.   @param  EndTimeStamp            Pointer to the 64-bit time stamp that was recorded when the measurement                                   was ended.   @param  Identifier              Pointer to the 32-bit identifier that was recorded.    @return The key for the next performance log entry (in general case).  **/
end_comment

begin_function
name|UINTN
name|EFIAPI
name|GetPerformanceMeasurementEx
parameter_list|(
name|IN
name|UINTN
name|LogEntryKey
parameter_list|,
name|OUT
name|CONST
name|VOID
modifier|*
modifier|*
name|Handle
parameter_list|,
name|OUT
name|CONST
name|CHAR8
modifier|*
modifier|*
name|Token
parameter_list|,
name|OUT
name|CONST
name|CHAR8
modifier|*
modifier|*
name|Module
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|StartTimeStamp
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|EndTimeStamp
parameter_list|,
name|OUT
name|UINT32
modifier|*
name|Identifier
parameter_list|)
block|{
name|ASSERT
argument_list|(
name|Handle
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Token
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Module
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|StartTimeStamp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|EndTimeStamp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Identifier
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/**   Returns TRUE if the performance measurement macros are enabled.       This function returns TRUE if the PERFORMANCE_LIBRARY_PROPERTY_MEASUREMENT_ENABLED bit of   PcdPerformanceLibraryPropertyMask is set.  Otherwise FALSE is returned.    @retval TRUE                    The PERFORMANCE_LIBRARY_PROPERTY_MEASUREMENT_ENABLED bit of                                   PcdPerformanceLibraryPropertyMask is set.   @retval FALSE                   The PERFORMANCE_LIBRARY_PROPERTY_MEASUREMENT_ENABLED bit of                                   PcdPerformanceLibraryPropertyMask is clear.  **/
end_comment

begin_function
name|BOOLEAN
name|EFIAPI
name|PerformanceMeasurementEnabled
parameter_list|(
name|VOID
parameter_list|)
block|{
return|return
call|(
name|BOOLEAN
call|)
argument_list|(
operator|(
name|PcdGet8
argument_list|(
name|PcdPerformanceLibraryPropertyMask
argument_list|)
operator|&
name|PERFORMANCE_LIBRARY_PROPERTY_MEASUREMENT_ENABLED
operator|)
operator|!=
literal|0
argument_list|)
return|;
block|}
end_function

end_unit

