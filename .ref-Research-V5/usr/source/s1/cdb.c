begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_comment
comment|/*  	C debugger  */
end_comment

begin_include
include|#
directive|include
file|"/usr/sys/param.h"
end_include

begin_include
include|#
directive|include
file|"/usr/sys/user.h"
end_include

begin_decl_stmt
name|int
name|fcore
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|fsym
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symoff
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|lp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|errflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symlen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symct
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|symbol
index|[
literal|8
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ssymbol
index|[
literal|8
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ssymflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ssymval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|line
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|regbuf
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|uregs
modifier|&
name|regbuf
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|rtsize
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|pc
operator|-
literal|2
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|int
name|r5
operator|-
literal|9
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|dot
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tdot
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|dotinc
literal|2
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|int
name|lastcom
literal|'/'
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|int
name|lastype
literal|'o'
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|char
operator|*
name|symfil
literal|"a.out"
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|char
operator|*
name|corfil
literal|"core"
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|callist
index|[
literal|50
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|callp
modifier|&
name|callist
index|[
literal|0
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|onintr
parameter_list|()
function_decl|;
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
name|symfil
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|2
condition|)
block|{
name|corfil
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
name|symfil
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|fcore
operator|=
name|open
argument_list|(
name|corfil
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"%s not found\n"
argument_list|,
name|corfil
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|fsym
operator|=
name|open
argument_list|(
name|symfil
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"%s not found\n"
argument_list|,
name|symfil
argument_list|)
expr_stmt|;
return|return;
block|}
name|read
argument_list|(
name|fsym
argument_list|,
name|regbuf
argument_list|,
literal|020
argument_list|)
expr_stmt|;
if|if
condition|(
name|regbuf
index|[
literal|0
index|]
operator|!=
literal|0410
operator|&&
name|regbuf
index|[
literal|0
index|]
operator|!=
literal|0407
condition|)
block|{
comment|/* magic */
name|printf
argument_list|(
literal|"Bad format: %s\n"
argument_list|,
name|symfil
argument_list|)
expr_stmt|;
return|return;
block|}
name|symoff
operator|=
name|regbuf
index|[
literal|1
index|]
operator|+
name|regbuf
index|[
literal|2
index|]
expr_stmt|;
name|symlen
operator|=
name|regbuf
index|[
literal|4
index|]
expr_stmt|;
if|if
condition|(
name|regbuf
index|[
literal|7
index|]
operator|!=
literal|1
condition|)
name|symoff
operator|=
operator|<<
literal|1
expr_stmt|;
name|symoff
operator|=
operator|+
literal|020
expr_stmt|;
name|read
argument_list|(
name|fcore
argument_list|,
name|regbuf
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
name|regbuf
operator|->
name|u_tsize
operator|=
operator|<<
literal|6
expr_stmt|;
name|regbuf
operator|->
name|u_dsize
operator|=
operator|<<
literal|6
expr_stmt|;
name|regbuf
operator|->
name|u_ssize
operator|=
operator|<<
literal|6
expr_stmt|;
name|rtsize
operator|=
operator|(
name|regbuf
operator|->
name|u_tsize
operator|+
literal|017777
operator|)
operator|&
operator|~
literal|017777
expr_stmt|;
name|setexit
argument_list|()
expr_stmt|;
name|signal
argument_list|(
literal|2
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
name|loop
label|:
if|if
condition|(
name|errflg
condition|)
block|{
name|printf
argument_list|(
literal|"?\n"
argument_list|)
expr_stmt|;
name|errflg
operator|=
literal|0
expr_stmt|;
block|}
name|lp
operator|=
name|line
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|lp
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
if|if
condition|(
operator|*
name|lp
operator|++
operator|==
literal|'\0'
condition|)
return|return;
name|lp
operator|=
name|line
expr_stmt|;
name|command
argument_list|()
expr_stmt|;
goto|goto
name|loop
goto|;
block|}
end_function

begin_macro
name|command
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|adrflg
operator|,
name|n
expr_stmt|;
name|adrflg
operator|=
name|expr
argument_list|()
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
return|return;
name|n
operator|=
name|getcnt
argument_list|()
expr_stmt|;
if|if
condition|(
name|lastcom
operator|==
literal|'$'
condition|)
name|lastcom
operator|=
literal|'/'
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|==
literal|'\n'
condition|)
block|{
if|if
condition|(
operator|!
name|adrflg
condition|)
name|dot
operator|=
operator|+
name|dotinc
expr_stmt|;
block|}
else|else
name|lastcom
operator|=
operator|*
name|lp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|!=
literal|'\n'
condition|)
name|lastype
operator|=
operator|*
name|lp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|!=
literal|'\n'
condition|)
block|{
name|errflg
operator|++
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|adrflg
condition|)
name|dot
operator|=
name|tdot
expr_stmt|;
while|while
condition|(
name|n
condition|)
block|{
name|scommand
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
return|return;
if|if
condition|(
operator|--
name|n
condition|)
name|dot
operator|=
operator|+
name|dotinc
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|scommand
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|w
operator|,
name|c
expr_stmt|;
name|double
name|fw
decl_stmt|;
struct|struct
block|{
name|int
name|i
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
switch|switch
condition|(
name|lastcom
condition|)
block|{
case|case
literal|'/'
case|:
name|w
operator|=
name|cget
argument_list|(
name|dot
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lastype
condition|)
block|{
case|case
literal|'o'
case|:
name|printf
argument_list|(
literal|"%.1o\n"
argument_list|,
name|w
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|2
expr_stmt|;
return|return;
case|case
literal|'i'
case|:
name|printf
argument_list|(
literal|"%d\n"
argument_list|,
name|w
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|2
expr_stmt|;
return|return;
case|case
literal|'f'
case|:
name|fw
operator|=
literal|0.0
expr_stmt|;
name|fw
operator|.
name|i
index|[
literal|0
index|]
operator|=
name|w
expr_stmt|;
name|fw
operator|.
name|i
index|[
literal|1
index|]
operator|=
name|cget
argument_list|(
name|dot
operator|+
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%e\n"
argument_list|,
name|fw
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|4
expr_stmt|;
return|return;
case|case
literal|'d'
case|:
name|fw
operator|.
name|i
index|[
literal|0
index|]
operator|=
name|w
expr_stmt|;
name|fw
operator|.
name|i
index|[
literal|1
index|]
operator|=
name|cget
argument_list|(
name|dot
operator|+
literal|2
argument_list|)
expr_stmt|;
name|fw
operator|.
name|i
index|[
literal|2
index|]
operator|=
name|cget
argument_list|(
name|dot
operator|+
literal|4
argument_list|)
expr_stmt|;
name|fw
operator|.
name|i
index|[
literal|3
index|]
operator|=
name|cget
argument_list|(
name|dot
operator|+
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%e\n"
argument_list|,
name|fw
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|8
expr_stmt|;
return|return;
block|}
name|errflg
operator|++
expr_stmt|;
return|return;
case|case
literal|'\\'
case|:
name|printf
argument_list|(
literal|"%.1o\n"
argument_list|,
name|cget
argument_list|(
name|dot
argument_list|)
operator|&
literal|0377
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|1
expr_stmt|;
return|return;
case|case
literal|'='
case|:
name|printf
argument_list|(
literal|"%.1o\n"
argument_list|,
name|dot
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'\''
case|:
name|printc
argument_list|(
name|cget
argument_list|(
name|dot
argument_list|)
operator|&
literal|0377
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|<=
literal|1
condition|)
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|dotinc
operator|=
literal|1
expr_stmt|;
return|return;
case|case
literal|'"'
case|:
name|w
operator|=
name|cget
argument_list|(
name|dot
argument_list|)
expr_stmt|;
while|while
condition|(
name|c
operator|=
name|cget
argument_list|(
name|w
operator|++
argument_list|)
operator|&
literal|0377
condition|)
name|printc
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'&'
case|:
name|vallook
argument_list|(
name|cget
argument_list|(
name|dot
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
name|reset
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"%.8s\n"
argument_list|,
name|ssymbol
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'$'
case|:
name|printtrace
argument_list|()
expr_stmt|;
return|return;
block|}
name|errflg
operator|++
expr_stmt|;
block|}
end_block

begin_macro
name|getcnt
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|t1
operator|,
name|t2
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|!=
literal|','
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|lp
operator|++
expr_stmt|;
name|t1
operator|=
name|tdot
expr_stmt|;
if|if
condition|(
name|expr
argument_list|()
operator|==
literal|0
condition|)
block|{
name|tdot
operator|=
name|t1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|t2
operator|=
name|tdot
expr_stmt|;
name|tdot
operator|=
name|t1
expr_stmt|;
return|return
operator|(
name|t2
operator|)
return|;
block|}
end_block

begin_macro
name|cget
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|w
expr_stmt|;
name|w
operator|=
name|get
argument_list|(
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
name|reset
argument_list|()
expr_stmt|;
return|return
operator|(
name|w
operator|)
return|;
block|}
end_block

begin_macro
name|printc
argument_list|(
argument|c
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|c
operator|<
literal|' '
operator|||
name|c
operator|>
literal|'}'
condition|)
name|printf
argument_list|(
literal|"\\%o"
argument_list|,
name|c
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|expr
argument_list|()
end_macro

begin_block
block|{
name|char
name|tsym
index|[
literal|10
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|t1
decl_stmt|,
name|t2
decl_stmt|,
name|donef
decl_stmt|,
name|adrflg
decl_stmt|,
name|lastop
decl_stmt|,
name|b
decl_stmt|;
name|tdot
operator|=
literal|0
expr_stmt|;
name|adrflg
operator|=
literal|0
expr_stmt|;
name|lastop
operator|=
literal|'+'
expr_stmt|;
name|ssymval
operator|=
literal|0
expr_stmt|;
name|donef
operator|=
literal|0
expr_stmt|;
name|loop
label|:
if|if
condition|(
operator|*
name|lp
operator|>=
literal|'a'
operator|&&
operator|*
name|lp
operator|<=
literal|'z'
operator|||
operator|*
name|lp
operator|==
literal|'_'
condition|)
block|{
name|i
operator|=
literal|0
expr_stmt|;
name|tsym
index|[
name|i
operator|++
index|]
operator|=
literal|'_'
expr_stmt|;
name|adrflg
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|>=
literal|'a'
operator|&&
operator|*
name|lp
operator|<=
literal|'z'
operator|||
operator|*
name|lp
operator|>=
literal|'0'
operator|&&
operator|*
name|lp
operator|<=
literal|'9'
operator|||
operator|*
name|lp
operator|==
literal|'_'
condition|)
block|{
if|if
condition|(
name|i
operator|<
literal|8
condition|)
name|tsym
index|[
name|i
operator|++
index|]
operator|=
operator|*
name|lp
expr_stmt|;
name|lp
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|i
operator|<
literal|8
condition|)
name|tsym
index|[
name|i
operator|++
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|symlook
argument_list|(
name|tsym
argument_list|)
operator|==
literal|0
condition|)
block|{
name|errflg
operator|++
expr_stmt|;
name|reset
argument_list|()
expr_stmt|;
block|}
goto|goto
name|loop
goto|;
block|}
if|if
condition|(
operator|*
name|lp
operator|>=
literal|'0'
operator|&&
operator|*
name|lp
operator|<=
literal|'9'
condition|)
block|{
name|adrflg
operator|++
expr_stmt|;
name|ssymval
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|==
literal|'0'
condition|)
name|b
operator|=
literal|8
expr_stmt|;
else|else
name|b
operator|=
literal|10
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|>=
literal|'0'
operator|&&
operator|*
name|lp
operator|<=
literal|'9'
condition|)
block|{
name|ssymval
operator|=
operator|*
name|b
expr_stmt|;
name|ssymval
operator|=
operator|+
operator|*
name|lp
operator|++
operator|-
literal|'0'
expr_stmt|;
block|}
goto|goto
name|loop
goto|;
block|}
switch|switch
condition|(
operator|*
name|lp
condition|)
block|{
default|default:
name|donef
operator|++
expr_stmt|;
case|case
literal|'+'
case|:
case|case
literal|'-'
case|:
switch|switch
condition|(
name|lastop
condition|)
block|{
case|case
literal|'+'
case|:
name|tdot
operator|=
operator|+
name|ssymval
expr_stmt|;
goto|goto
name|op
goto|;
case|case
literal|'-'
case|:
name|tdot
operator|=
operator|-
name|ssymval
expr_stmt|;
name|op
label|:
if|if
condition|(
name|donef
condition|)
return|return
operator|(
name|adrflg
operator|)
return|;
else|else
name|lastop
operator|=
operator|*
name|lp
operator|++
expr_stmt|;
block|}
goto|goto
name|loop
goto|;
case|case
literal|' '
case|:
case|case
literal|'\t'
case|:
name|lp
operator|++
expr_stmt|;
goto|goto
name|loop
goto|;
case|case
literal|'('
case|:
name|lp
operator|++
expr_stmt|;
name|adrflg
operator|++
expr_stmt|;
name|t1
operator|=
name|tdot
expr_stmt|;
name|ssymval
operator|=
name|getarg
argument_list|()
expr_stmt|;
name|tdot
operator|=
name|t1
expr_stmt|;
goto|goto
name|loop
goto|;
case|case
literal|'['
case|:
name|lp
operator|++
expr_stmt|;
name|t1
operator|=
name|ssymval
expr_stmt|;
name|t2
operator|=
name|tdot
expr_stmt|;
if|if
condition|(
name|expr
argument_list|()
operator|==
literal|0
condition|)
name|tdot
operator|=
literal|0
expr_stmt|;
name|ssymval
operator|=
name|get
argument_list|(
name|t1
operator|+
operator|(
name|tdot
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
name|reset
argument_list|()
expr_stmt|;
name|tdot
operator|=
name|t2
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|==
literal|']'
condition|)
name|lp
operator|++
expr_stmt|;
goto|goto
name|loop
goto|;
block|}
block|}
end_block

begin_macro
name|getarg
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|level
operator|,
name|arg
operator|,
name|t1
expr_stmt|;
name|t1
operator|=
name|tdot
expr_stmt|;
name|expr
argument_list|()
expr_stmt|;
name|level
operator|=
name|tdot
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|++
operator|!=
literal|','
condition|)
name|error
argument_list|()
expr_stmt|;
name|expr
argument_list|()
expr_stmt|;
name|arg
operator|=
name|tdot
expr_stmt|;
if|if
condition|(
operator|*
name|lp
operator|++
operator|!=
literal|')'
condition|)
name|error
argument_list|()
expr_stmt|;
if|if
condition|(
name|level
operator|>=
name|callp
operator|-
name|callist
condition|)
name|error
argument_list|()
expr_stmt|;
name|ssymval
operator|=
name|callist
index|[
name|level
index|]
operator|-
literal|8
operator|-
literal|2
operator|*
name|arg
expr_stmt|;
name|tdot
operator|=
name|t1
expr_stmt|;
block|}
end_block

begin_macro
name|error
argument_list|()
end_macro

begin_block
block|{
name|errflg
operator|++
expr_stmt|;
name|reset
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|printtrace
argument_list|()
end_macro

begin_block
block|{
name|int
name|tpc
decl_stmt|,
name|tr5
decl_stmt|,
name|narg
decl_stmt|,
name|argp
decl_stmt|,
name|i
decl_stmt|;
name|tpc
operator|=
name|uregs
index|[
name|pc
index|]
expr_stmt|;
name|tr5
operator|=
name|uregs
index|[
name|r5
index|]
expr_stmt|;
if|if
condition|(
name|symlook
argument_list|(
literal|"savr5"
argument_list|)
condition|)
if|if
condition|(
name|narg
operator|=
name|get
argument_list|(
name|ssymval
argument_list|)
condition|)
name|tr5
operator|=
name|narg
expr_stmt|;
name|callp
operator|=
operator|&
name|callist
index|[
literal|0
index|]
expr_stmt|;
while|while
condition|(
name|errflg
operator|==
literal|0
condition|)
block|{
name|narg
operator|=
name|findroutine
argument_list|(
name|tpc
argument_list|,
name|tr5
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%2d: %.8s("
argument_list|,
name|callp
operator|-
name|callist
argument_list|,
name|ssymbol
argument_list|)
expr_stmt|;
if|if
condition|(
operator|--
name|narg
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|"%.1o"
argument_list|,
name|get
argument_list|(
name|tr5
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|argp
operator|=
name|tr5
operator|+
literal|4
expr_stmt|;
while|while
condition|(
operator|--
name|narg
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|",%.1o"
argument_list|,
name|get
argument_list|(
name|argp
operator|=
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")\n"
argument_list|)
expr_stmt|;
name|tpc
operator|=
name|get
argument_list|(
name|tr5
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|callp
operator|<
operator|&
name|callist
index|[
literal|50
index|]
condition|)
operator|*
name|callp
operator|++
operator|=
name|tr5
expr_stmt|;
if|if
condition|(
operator|(
name|tr5
operator|=
name|get
argument_list|(
name|tr5
argument_list|)
operator|)
operator|==
literal|0
condition|)
break|break;
block|}
block|}
end_block

begin_macro
name|findroutine
argument_list|(
argument|rpc
argument_list|,
argument|rr5
argument_list|)
end_macro

begin_block
block|{
name|int
name|callpt
decl_stmt|,
name|inst
decl_stmt|,
name|narg
decl_stmt|;
name|callpt
operator|=
name|get
argument_list|(
name|rr5
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|inst
operator|=
name|get
argument_list|(
name|callpt
operator|-
literal|4
argument_list|)
operator|)
operator|==
literal|04737
condition|)
comment|/* jsr pc,*$... */
name|narg
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|inst
operator|&
operator|~
literal|077
operator|)
operator|==
literal|04700
condition|)
comment|/* jsr pc,... */
name|narg
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|errflg
operator|++
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|vallook
argument_list|(
operator|(
name|inst
operator|==
literal|04767
condition|?
name|callpt
else|:
literal|0
operator|)
operator|+
name|get
argument_list|(
name|callpt
operator|-
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|inst
operator|=
name|get
argument_list|(
name|callpt
argument_list|)
expr_stmt|;
if|if
condition|(
name|inst
operator|==
literal|05726
condition|)
comment|/* tst (sp)+ */
return|return
operator|(
name|narg
operator|+
literal|1
operator|)
return|;
if|if
condition|(
name|inst
operator|==
literal|022626
condition|)
comment|/* cmp (sp)+,(sp)+ */
return|return
operator|(
name|narg
operator|+
literal|2
operator|)
return|;
if|if
condition|(
name|inst
operator|==
literal|062706
condition|)
comment|/* add $n,sp */
return|return
operator|(
name|narg
operator|+
name|get
argument_list|(
name|callpt
operator|+
literal|2
argument_list|)
operator|/
literal|2
operator|)
return|;
return|return
operator|(
name|narg
operator|)
return|;
block|}
end_block

begin_macro
name|symlook
argument_list|(
argument|symstr
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|symstr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|symset
argument_list|()
expr_stmt|;
while|while
condition|(
name|symget
argument_list|()
condition|)
block|{
if|if
condition|(
name|eqstr
argument_list|(
name|symbol
argument_list|,
name|symstr
argument_list|)
condition|)
block|{
name|savsym
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|eqstr
argument_list|(
argument|as1
argument_list|,
argument|as2
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|as1
decl_stmt|,
modifier|*
name|as2
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
modifier|*
name|s1
decl_stmt|,
modifier|*
name|s2
decl_stmt|,
modifier|*
name|es1
decl_stmt|;
name|s1
operator|=
name|as1
expr_stmt|;
name|s2
operator|=
name|as2
expr_stmt|;
for|for
control|(
name|es1
operator|=
name|s1
operator|+
literal|4
init|;
name|s1
operator|<
name|es1
condition|;
control|)
if|if
condition|(
operator|*
name|s1
operator|++
operator|!=
operator|*
name|s2
operator|++
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|vallook
argument_list|(
argument|value
argument_list|)
end_macro

begin_block
block|{
name|symset
argument_list|()
expr_stmt|;
while|while
condition|(
name|symget
argument_list|()
condition|)
if|if
condition|(
name|symval
operator|==
name|value
operator|&&
operator|(
name|symflg
operator|&
literal|037
operator|)
operator|==
literal|2
condition|)
block|{
name|savsym
argument_list|(
literal|'_'
argument_list|)
expr_stmt|;
return|return;
block|}
name|errflg
operator|++
expr_stmt|;
block|}
end_block

begin_macro
name|get
argument_list|(
argument|aaddr
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|aaddr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|w
decl_stmt|;
specifier|register
name|char
modifier|*
name|addr
decl_stmt|;
name|addr
operator|=
name|aaddr
expr_stmt|;
name|w
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|addr
operator|<
name|regbuf
operator|->
name|u_tsize
condition|)
block|{
name|seek
argument_list|(
name|fsym
argument_list|,
name|addr
operator|+
literal|020
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|fsym
argument_list|,
operator|&
name|w
argument_list|,
literal|2
argument_list|)
operator|!=
literal|2
condition|)
name|errflg
operator|++
expr_stmt|;
return|return
operator|(
name|w
operator|)
return|;
block|}
if|if
condition|(
name|addr
operator|<
name|rtsize
operator|+
name|regbuf
operator|->
name|u_dsize
condition|)
name|addr
operator|=
operator|-
name|rtsize
expr_stmt|;
elseif|else
if|if
condition|(
operator|-
name|addr
operator|<
name|regbuf
operator|->
name|u_ssize
condition|)
name|addr
operator|=
operator|+
name|regbuf
operator|->
name|u_dsize
operator|+
name|regbuf
operator|->
name|u_ssize
expr_stmt|;
else|else
name|errflg
operator|++
expr_stmt|;
name|seek
argument_list|(
name|fcore
argument_list|,
name|addr
operator|+
literal|1024
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|fcore
argument_list|,
operator|&
name|w
argument_list|,
literal|2
argument_list|)
operator|<
literal|2
condition|)
name|errflg
operator|++
expr_stmt|;
return|return
operator|(
name|w
operator|)
return|;
block|}
end_block

begin_macro
name|symset
argument_list|()
end_macro

begin_block
block|{
name|symct
operator|=
name|symlen
expr_stmt|;
name|seek
argument_list|(
name|fsym
argument_list|,
name|symoff
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|symget
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|(
name|symct
operator|=
operator|-
literal|12
operator|)
operator|<
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
name|read
argument_list|(
name|fsym
argument_list|,
name|symbol
argument_list|,
literal|12
argument_list|)
operator|==
literal|12
operator|)
return|;
block|}
end_block

begin_macro
name|savsym
argument_list|(
argument|skip
argument_list|)
end_macro

begin_block
block|{
name|int
name|ch
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|p
operator|=
name|symbol
expr_stmt|;
name|q
operator|=
name|ssymbol
expr_stmt|;
while|while
condition|(
name|p
operator|<
name|symbol
operator|+
literal|8
operator|&&
operator|(
name|ch
operator|=
operator|*
name|p
operator|++
operator|)
condition|)
block|{
if|if
condition|(
name|ch
operator|==
name|skip
condition|)
continue|continue;
operator|*
name|q
operator|++
operator|=
name|ch
expr_stmt|;
block|}
while|while
condition|(
name|q
operator|<
name|ssymbol
operator|+
literal|8
condition|)
operator|*
name|q
operator|++
operator|=
literal|'\0'
expr_stmt|;
name|ssymflg
operator|=
name|symflg
expr_stmt|;
name|ssymval
operator|=
name|symval
expr_stmt|;
block|}
end_block

begin_macro
name|onintr
argument_list|()
end_macro

begin_block
block|{
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|errflg
operator|++
expr_stmt|;
name|reset
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

