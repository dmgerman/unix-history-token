begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  Print execution profile  */
end_comment

begin_struct
struct|struct
name|nl
block|{
name|char
name|name
index|[
literal|8
index|]
decl_stmt|;
name|int
name|value
decl_stmt|;
name|float
name|time
decl_stmt|;
name|int
name|ncall
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|nl
name|nl
index|[
literal|600
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|fnl
block|{
name|char
name|fname
index|[
literal|8
index|]
decl_stmt|;
name|int
name|flag
decl_stmt|;
name|int
name|fvalue
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|cnt
block|{
name|int
name|cvalue
decl_stmt|;
name|int
name|cncall
index|[
literal|2
index|]
decl_stmt|;
block|}
name|cbuf
index|[
literal|200
index|]
struct|;
end_struct

begin_struct
struct|struct
name|inode
block|{
name|int
name|idev
decl_stmt|;
name|int
name|inum
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|char
name|nlink
decl_stmt|;
name|char
name|uid
decl_stmt|;
name|char
name|gid
decl_stmt|;
name|char
name|size0
decl_stmt|;
name|int
name|size
decl_stmt|;
name|int
name|ptr
index|[
literal|8
index|]
decl_stmt|;
name|int
name|ctime
index|[
literal|2
index|]
decl_stmt|;
name|int
name|mtime
index|[
literal|2
index|]
decl_stmt|;
name|int
name|fill
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|int
name|ibuf
index|[
literal|259
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|obuf
index|[
literal|259
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|buf
index|[
literal|17
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|j
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|highpc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lowpc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ccnt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pcl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|bufs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|time
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|totime
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|maxtime
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|scale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|lastx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|lasty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|nl
modifier|*
name|np
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|nl
modifier|*
name|npe
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|aflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|vflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symoff
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|symsiz
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|vf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|etext
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ncount
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|char
modifier|*
name|namfil
decl_stmt|;
name|int
name|timcmp
argument_list|()
decl_stmt|,
name|valcmp
argument_list|()
decl_stmt|;
name|int
name|nf
decl_stmt|,
name|pf
decl_stmt|,
name|overlap
decl_stmt|;
name|double
name|fnc
decl_stmt|,
name|ltod
argument_list|()
decl_stmt|,
name|lastsx
decl_stmt|;
name|struct
name|cnt
modifier|*
name|cp
decl_stmt|;
name|obuf
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|argv
operator|++
expr_stmt|;
name|namfil
operator|=
literal|"a.out"
expr_stmt|;
while|while
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'-'
condition|)
block|{
if|if
condition|(
operator|*
operator|++
operator|*
name|argv
operator|==
literal|'l'
condition|)
name|lflg
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'a'
condition|)
name|aflg
operator|=
literal|040
expr_stmt|;
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'v'
condition|)
name|vflg
operator|++
expr_stmt|;
block|}
else|else
name|namfil
operator|=
operator|*
name|argv
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|argv
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|nf
operator|=
name|open
argument_list|(
name|namfil
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Can't find %s\n"
argument_list|,
name|namfil
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
name|read
argument_list|(
name|nf
argument_list|,
name|buf
argument_list|,
literal|020
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|!=
literal|0407
operator|&&
name|buf
index|[
literal|0
index|]
operator|!=
literal|0410
condition|)
block|{
comment|/* a.out magic */
name|printf
argument_list|(
literal|"Bad format: %s\n"
argument_list|,
name|namfil
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
name|symsiz
operator|=
name|buf
index|[
literal|4
index|]
expr_stmt|;
name|symoff
operator|=
name|buf
index|[
literal|1
index|]
operator|+
name|buf
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|7
index|]
operator|!=
literal|1
condition|)
name|symoff
operator|=
operator|<<
literal|1
expr_stmt|;
name|seek
argument_list|(
name|nf
argument_list|,
name|symoff
operator|+
literal|020
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|pf
operator|=
name|open
argument_list|(
literal|"mon.out"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"No mon.out\n"
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
name|fstat
argument_list|(
name|pf
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|pf
argument_list|,
operator|&
name|lowpc
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|pf
argument_list|,
operator|&
name|highpc
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|pf
argument_list|,
operator|&
name|ncount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|bufs
operator|=
name|buf
operator|->
name|size
operator|/
literal|2
operator|-
literal|3
operator|*
operator|(
name|ncount
operator|+
literal|1
operator|)
expr_stmt|;
name|read
argument_list|(
name|pf
argument_list|,
name|cbuf
argument_list|,
name|ncount
operator|*
literal|6
argument_list|)
expr_stmt|;
name|lowpc
operator|=
operator|(
name|lowpc
operator|>>
literal|1
operator|)
operator|&
literal|077777
expr_stmt|;
name|highpc
operator|=
operator|(
name|highpc
operator|>>
literal|1
operator|)
operator|&
literal|077777
expr_stmt|;
name|npe
operator|=
name|nl
expr_stmt|;
name|initf
argument_list|(
name|nf
argument_list|)
expr_stmt|;
for|for
control|(
name|nname
operator|=
literal|0
init|;
name|symsiz
operator|>
literal|0
condition|;
name|symsiz
operator|=
operator|-
literal|12
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|12
condition|;
name|i
operator|++
control|)
name|buf
operator|->
name|fname
index|[
name|i
index|]
operator|=
name|getc
argument_list|(
name|ibuf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|buf
operator|->
name|flag
operator||
name|aflg
operator|)
operator|!=
literal|042
condition|)
continue|continue;
name|buf
operator|->
name|fvalue
operator|=
operator|(
name|buf
operator|->
name|fvalue
operator|>>
literal|1
operator|)
operator|&
literal|077777
expr_stmt|;
name|npe
operator|->
name|value
operator|=
name|buf
operator|->
name|fvalue
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|npe
operator|->
name|name
index|[
name|i
index|]
operator|=
name|buf
operator|->
name|fname
index|[
name|i
index|]
expr_stmt|;
name|npe
operator|++
expr_stmt|;
name|nname
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|nname
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"No symbols: %s\n"
argument_list|,
name|namfil
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
name|npe
operator|->
name|value
operator|=
literal|077777
expr_stmt|;
name|npe
operator|++
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|cbuf
init|;
name|cp
operator|<
operator|&
name|cbuf
index|[
name|ncount
index|]
condition|;
name|cp
operator|++
control|)
for|for
control|(
name|np
operator|=
name|nl
init|;
name|np
operator|<
name|npe
condition|;
name|np
operator|++
control|)
if|if
condition|(
name|cp
operator|->
name|cvalue
operator|-
literal|6
operator|==
name|np
operator|->
name|value
operator|<<
literal|1
condition|)
block|{
name|np
operator|->
name|ncall
index|[
literal|0
index|]
operator|=
name|cp
operator|->
name|cncall
index|[
literal|0
index|]
expr_stmt|;
name|np
operator|->
name|ncall
index|[
literal|1
index|]
operator|=
name|cp
operator|->
name|cncall
index|[
literal|1
index|]
expr_stmt|;
break|break;
block|}
name|qsort
argument_list|(
name|nl
argument_list|,
name|nname
argument_list|,
literal|18
argument_list|,
operator|&
name|valcmp
argument_list|)
expr_stmt|;
name|scale
operator|=
operator|(
name|highpc
operator|-
name|lowpc
operator|)
operator|/
operator|(
name|bufs
operator|+
literal|0.0
operator|)
expr_stmt|;
name|initf
argument_list|(
name|pf
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
operator|-
literal|1
init|;
operator|(
name|j
operator|=
name|getc
argument_list|(
name|ibuf
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|ccnt
operator|.
name|fname
index|[
literal|0
index|]
operator|=
name|j
expr_stmt|;
name|ccnt
operator|.
name|fname
index|[
literal|1
index|]
operator|=
name|getc
argument_list|(
name|ibuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|ccnt
operator|==
literal|0
condition|)
continue|continue;
name|time
operator|=
name|ccnt
expr_stmt|;
if|if
condition|(
name|ccnt
operator|<
literal|0
condition|)
name|time
operator|=
operator|+
literal|65536.
expr_stmt|;
name|totime
operator|=
operator|+
name|time
expr_stmt|;
if|if
condition|(
name|time
operator|>
name|maxtime
condition|)
name|maxtime
operator|=
name|time
expr_stmt|;
name|pcl
operator|=
name|lowpc
operator|+
name|scale
operator|*
name|i
expr_stmt|;
name|pch
operator|=
name|lowpc
operator|+
name|scale
operator|*
operator|(
name|i
operator|+
literal|1
operator|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|nname
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|pch
operator|<
name|nl
index|[
name|j
index|]
operator|.
name|value
condition|)
break|break;
if|if
condition|(
name|pcl
operator|>=
name|nl
index|[
name|j
operator|+
literal|1
index|]
operator|.
name|value
condition|)
continue|continue;
name|overlap
operator|=
operator|(
name|min
argument_list|(
name|pch
argument_list|,
name|nl
index|[
name|j
operator|+
literal|1
index|]
operator|.
name|value
argument_list|)
operator|-
name|max
argument_list|(
name|pcl
argument_list|,
name|nl
index|[
name|j
index|]
operator|.
name|value
argument_list|)
operator|)
expr_stmt|;
name|nl
index|[
name|j
index|]
operator|.
name|time
operator|=
operator|+
name|overlap
operator|*
name|time
operator|/
name|scale
expr_stmt|;
block|}
block|}
if|if
condition|(
name|totime
operator|==
literal|0.0
condition|)
block|{
name|printf
argument_list|(
literal|"No time accumulated\n"
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|vflg
condition|)
goto|goto
name|print
goto|;
name|vf
operator|=
name|open
argument_list|(
literal|"/dev/vt0"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|vf
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Cannot open vt\n"
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
name|obuf
index|[
literal|0
index|]
operator|=
name|vf
expr_stmt|;
name|vtch
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
operator|-
literal|2048.
argument_list|,
operator|-
literal|2048.
argument_list|)
expr_stmt|;
name|point
argument_list|(
operator|-
literal|2048.
argument_list|,
literal|2048.
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
literal|0.
argument_list|,
operator|-
literal|2048.
argument_list|)
expr_stmt|;
name|point
argument_list|(
literal|0.
argument_list|,
literal|2048.
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|9
condition|;
name|j
operator|++
control|)
block|{
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
operator|-
literal|2048.
argument_list|,
literal|2048.
operator|-
name|j
operator|*
literal|512.
argument_list|)
expr_stmt|;
name|point
argument_list|(
literal|0.
argument_list|,
literal|2048.
operator|-
name|j
operator|*
literal|512.
argument_list|)
expr_stmt|;
block|}
name|lastx
operator|=
literal|0.
expr_stmt|;
name|lasty
operator|=
literal|2048.
expr_stmt|;
name|scale
operator|=
literal|4096.
operator|/
operator|(
name|i
operator|+
literal|2
operator|)
expr_stmt|;
name|seek
argument_list|(
name|pf
argument_list|,
literal|6
operator|*
operator|(
name|ncount
operator|+
literal|1
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|initf
argument_list|(
name|pf
argument_list|)
expr_stmt|;
name|lastsx
operator|=
literal|0.0
expr_stmt|;
while|while
condition|(
operator|(
name|j
operator|=
name|getc
argument_list|(
name|ibuf
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|ccnt
operator|.
name|fname
index|[
literal|0
index|]
operator|=
name|j
expr_stmt|;
name|ccnt
operator|.
name|fname
index|[
literal|1
index|]
operator|=
name|getc
argument_list|(
name|ibuf
argument_list|)
expr_stmt|;
name|time
operator|=
name|ccnt
expr_stmt|;
if|if
condition|(
name|ccnt
operator|<
literal|0
condition|)
name|time
operator|=
operator|+
literal|65536.
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
name|lastsx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|lastsx
operator|=
operator|-
literal|2000.
operator|*
name|time
operator|/
name|totime
expr_stmt|;
name|point
argument_list|(
name|lastsx
argument_list|,
name|lasty
operator|-
name|scale
argument_list|)
expr_stmt|;
if|if
condition|(
name|ccnt
operator|!=
literal|0
operator|||
name|lastx
operator|!=
literal|0.0
condition|)
block|{
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
name|lastx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|lastx
operator|=
operator|-
name|time
operator|*
literal|2000.
operator|/
name|maxtime
expr_stmt|;
name|point
argument_list|(
name|lastx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
block|}
name|lasty
operator|=
operator|-
name|scale
expr_stmt|;
block|}
name|scale
operator|=
literal|4096.
operator|/
operator|(
name|highpc
operator|-
name|lowpc
operator|)
expr_stmt|;
name|lastx
operator|=
literal|50.
expr_stmt|;
for|for
control|(
name|np
operator|=
name|nl
init|;
name|np
operator|<
name|npe
condition|;
name|np
operator|++
control|)
block|{
if|if
condition|(
name|np
operator|->
name|value
operator|<
name|lowpc
condition|)
continue|continue;
if|if
condition|(
name|np
operator|->
name|value
operator|>=
name|highpc
condition|)
continue|continue;
name|time
operator|=
name|np
operator|->
name|time
operator|/
name|totime
expr_stmt|;
name|lasty
operator|=
literal|2048.
operator|-
operator|(
name|np
operator|->
name|value
operator|-
name|lowpc
operator|)
operator|*
name|scale
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
literal|0.
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|point
argument_list|(
literal|50.
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|point
argument_list|(
name|lastx
operator|-
literal|50.
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|point
argument_list|(
name|lastx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|9
argument_list|)
expr_stmt|;
name|point
argument_list|(
name|lastx
operator|+
literal|10.
argument_list|,
name|lasty
operator|+
literal|60.
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|np
operator|->
name|name
index|[
name|j
index|]
operator|!=
literal|'_'
condition|)
name|vtch
argument_list|(
name|np
operator|->
name|name
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|lastx
operator|=
operator|+
literal|500.
expr_stmt|;
if|if
condition|(
name|lastx
operator|>
literal|2000.
condition|)
name|lastx
operator|=
literal|50.
expr_stmt|;
block|}
name|done
argument_list|()
expr_stmt|;
name|print
label|:
name|printf
argument_list|(
literal|"    name %%time #call  ms/call\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|lflg
condition|)
name|qsort
argument_list|(
name|nl
argument_list|,
name|nname
argument_list|,
literal|18
argument_list|,
operator|&
name|timcmp
argument_list|)
expr_stmt|;
for|for
control|(
name|np
operator|=
name|nl
init|;
name|np
operator|<
name|npe
operator|-
literal|1
condition|;
name|np
operator|++
control|)
block|{
name|time
operator|=
name|np
operator|->
name|time
operator|/
name|totime
expr_stmt|;
name|printf
argument_list|(
literal|"%8.8s%6.1f"
argument_list|,
name|np
operator|->
name|name
argument_list|,
literal|100
operator|*
name|time
argument_list|)
expr_stmt|;
name|fnc
operator|=
name|ltod
argument_list|(
name|np
operator|->
name|ncall
argument_list|)
expr_stmt|;
if|if
condition|(
name|fnc
operator|!=
literal|0.0
condition|)
block|{
name|printf
argument_list|(
literal|"%6s"
argument_list|,
name|locv
argument_list|(
name|np
operator|->
name|ncall
index|[
literal|0
index|]
argument_list|,
name|np
operator|->
name|ncall
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %7.2f\n"
argument_list|,
name|np
operator|->
name|time
operator|/
operator|(
name|fnc
operator|*
literal|.06
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|done
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|min
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|a
operator|<
name|b
condition|)
return|return
operator|(
name|a
operator|)
return|;
return|return
operator|(
name|b
operator|)
return|;
block|}
end_block

begin_macro
name|max
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|a
operator|>
name|b
condition|)
return|return
operator|(
name|a
operator|)
return|;
return|return
operator|(
name|b
operator|)
return|;
block|}
end_block

begin_macro
name|valcmp
argument_list|(
argument|p1
argument_list|,
argument|p2
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|nl
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
name|p1
operator|->
name|value
operator|-
name|p2
operator|->
name|value
operator|)
return|;
block|}
end_block

begin_macro
name|timcmp
argument_list|(
argument|p1
argument_list|,
argument|p2
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|nl
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|float
name|d
decl_stmt|;
name|d
operator|=
name|p2
operator|->
name|time
operator|-
name|p1
operator|->
name|time
expr_stmt|;
if|if
condition|(
name|d
operator|>
literal|0.0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
name|d
operator|<
literal|0.0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|vtch
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|int
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|putchar
argument_list|(
name|c
operator|&
literal|0377
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|point
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|point1
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|point1
argument_list|(
name|y
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|putchar
argument_list|(
argument|c
argument_list|)
end_macro

begin_block
block|{
name|putc
argument_list|(
name|c
argument_list|,
name|obuf
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|point1
argument_list|(
argument|xy
argument_list|)
end_macro

begin_decl_stmt
name|float
name|xy
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|ixy
decl_stmt|;
struct|struct
block|{
name|char
name|b1
decl_stmt|;
name|char
name|b2
decl_stmt|;
block|}
struct|;
if|if
condition|(
name|xy
operator|>
literal|2047.
condition|)
name|xy
operator|=
literal|2047.
expr_stmt|;
if|if
condition|(
name|xy
operator|<
operator|-
literal|2048.
condition|)
name|xy
operator|=
operator|-
literal|2048.
expr_stmt|;
name|ixy
operator|=
name|xy
expr_stmt|;
name|vtch
argument_list|(
name|ixy
operator|.
name|b1
argument_list|)
expr_stmt|;
name|vtch
argument_list|(
name|ixy
operator|.
name|b2
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|done
argument_list|()
end_macro

begin_block
block|{
name|fflush
argument_list|(
name|obuf
argument_list|)
expr_stmt|;
name|exit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|initf
argument_list|(
argument|f
argument_list|)
end_macro

begin_block
block|{
name|ibuf
index|[
literal|0
index|]
operator|=
name|f
expr_stmt|;
name|ibuf
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|ibuf
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|ibuf
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
block|}
end_block

end_unit

