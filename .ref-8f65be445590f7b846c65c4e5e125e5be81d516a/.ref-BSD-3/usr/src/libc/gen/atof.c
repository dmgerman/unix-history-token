begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_union
union|union
block|{
name|short
name|foo0
index|[
literal|4
index|]
decl_stmt|;
name|double
name|big
decl_stmt|;
block|}
name|bar0
comment|/* = {0x5c80,0,0,0} */
union|;
end_union

begin_comment
comment|/* 2**56 as double floating point */
end_comment

begin_union
union|union
block|{
name|short
name|foo1
index|[
literal|4
index|]
decl_stmt|;
name|double
name|huge
decl_stmt|;
block|}
name|bar1
comment|/* = {0x8000,0,0,0} */
union|;
end_union

begin_comment
comment|/* reserved operand */
end_comment

begin_function
name|double
name|atof
parameter_list|(
name|p
parameter_list|)
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
block|{
specifier|register
name|double
name|exp
decl_stmt|,
name|val
decl_stmt|;
specifier|register
name|char
name|c
decl_stmt|;
specifier|register
name|int
name|dpdig
decl_stmt|;
name|int
name|scale
decl_stmt|;
name|char
name|sign
decl_stmt|,
name|esign
decl_stmt|;
name|abort
argument_list|()
expr_stmt|;
comment|/* THE REAL ROUTINE IS atofo.s !!!!! */
while|while
condition|(
operator|(
name|c
operator|=
operator|*
name|p
operator|++
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
comment|/* skip leading spaces */
name|sign
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'-'
condition|)
operator|++
name|sign
expr_stmt|;
comment|/* mark negative */
elseif|else
if|if
condition|(
name|c
operator|==
literal|'+'
condition|)
empty_stmt|;
comment|/* ignore plus */
else|else
operator|--
name|p
expr_stmt|;
comment|/* get back on track */
name|val
operator|=
literal|0
expr_stmt|;
name|dpdig
operator|=
literal|0
expr_stmt|;
comment|/* true value is aproximately	((-1)**sign) * val * (10 ** dpdig) */
while|while
condition|(
operator|(
name|c
operator|=
operator|*
name|p
operator|++
operator|)
operator|<=
literal|'9'
operator|&&
name|c
operator|>=
literal|'0'
condition|)
if|if
condition|(
name|val
operator|<
name|bar0
operator|.
name|big
condition|)
block|{
name|val
operator|*=
literal|10
expr_stmt|;
name|val
operator|+=
name|c
operator|-
literal|'0'
expr_stmt|;
block|}
else|else
operator|++
name|dpdig
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'.'
condition|)
while|while
condition|(
operator|(
name|c
operator|=
operator|*
name|p
operator|++
operator|)
operator|<=
literal|'9'
operator|&&
name|c
operator|>=
literal|'0'
condition|)
if|if
condition|(
name|val
operator|<
name|bar0
operator|.
name|big
condition|)
block|{
operator|--
name|dpdig
expr_stmt|;
name|val
operator|*=
literal|10
expr_stmt|;
name|val
operator|+=
name|c
operator|-
literal|'0'
expr_stmt|;
block|}
if|if
condition|(
name|sign
condition|)
name|val
operator|=
operator|-
name|val
expr_stmt|;
comment|/* sign has been taken care of, if  val  in range */
name|scale
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'E'
operator|||
name|c
operator|==
literal|'e'
condition|)
block|{
comment|/* scale factor */
name|esign
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
operator|*
name|p
operator|++
operator|)
operator|==
literal|'-'
condition|)
operator|++
name|esign
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|==
literal|'+'
condition|)
empty_stmt|;
else|else
operator|--
name|p
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
operator|*
name|p
operator|++
operator|)
operator|<=
literal|'9'
operator|&&
name|c
operator|>=
literal|'0'
condition|)
block|{
name|scale
operator|*=
literal|10
expr_stmt|;
name|scale
operator|+=
name|c
operator|-
literal|'0'
expr_stmt|;
block|}
if|if
condition|(
name|esign
condition|)
name|scale
operator|=
operator|-
name|scale
expr_stmt|;
block|}
name|dpdig
operator|+=
name|scale
expr_stmt|;
if|if
condition|(
name|dpdig
operator|==
literal|0
condition|)
return|return
operator|(
name|val
operator|)
return|;
name|esign
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|dpdig
operator|<
literal|0
condition|)
block|{
operator|++
name|esign
expr_stmt|;
name|dpdig
operator|=
operator|-
name|dpdig
expr_stmt|;
block|}
if|if
condition|(
name|dpdig
operator|>
literal|38
condition|)
if|if
condition|(
name|esign
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
name|sign
condition|?
operator|-
name|bar1
operator|.
name|huge
else|:
name|bar1
operator|.
name|huge
operator|)
return|;
name|exp
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|dpdig
condition|)
block|{
if|if
condition|(
name|dpdig
operator|==
literal|21
condition|)
block|{
name|exp
operator|*=
literal|1.0e+21
expr_stmt|;
break|break;
block|}
name|exp
operator|*=
literal|10
expr_stmt|;
operator|--
name|dpdig
expr_stmt|;
block|}
if|if
condition|(
name|esign
condition|)
return|return
operator|(
name|val
operator|/
name|exp
operator|)
return|;
return|return
operator|(
name|val
operator|*
name|exp
operator|)
return|;
block|}
end_function

end_unit

