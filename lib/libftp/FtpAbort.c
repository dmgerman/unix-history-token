begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* 		      Library for ftpd clients.(libftp) 			Copyright by Oleg Orel 			 All rights reserved. 			 This  library is desined  for  free,  non-commercial  software  creation.  It is changeable and can be improved. The author would greatly appreciate  any  advises, new  components  and  patches  of  the  existing  programs. Commercial  usage is  also  possible  with  participation of it's author.    */
end_comment

begin_include
include|#
directive|include
file|"FtpLibrary.h"
end_include

begin_macro
name|FtpAbort
argument_list|(
argument|FTP *ftp
argument_list|)
end_macro

begin_block
block|{
name|fd_set
name|fds
decl_stmt|;
name|char
name|msgc
init|=
name|IAC
decl_stmt|;
name|String
name|msg
decl_stmt|;
name|FD_ZERO
argument_list|(
operator|&
name|fds
argument_list|)
expr_stmt|;
name|FD_SET
argument_list|(
name|fileno
argument_list|(
name|FTPCMD
argument_list|(
name|ftp
argument_list|)
argument_list|)
argument_list|,
operator|&
name|fds
argument_list|)
expr_stmt|;
name|FtpPutc
argument_list|(
name|ftp
argument_list|,
name|FTPCMD
argument_list|(
name|ftp
argument_list|)
argument_list|,
name|IAC
argument_list|)
expr_stmt|;
name|FtpPutc
argument_list|(
name|ftp
argument_list|,
name|FTPCMD
argument_list|(
name|ftp
argument_list|)
argument_list|,
name|IP
argument_list|)
expr_stmt|;
if|if
condition|(
name|send
argument_list|(
name|fileno
argument_list|(
name|FTPCMD
argument_list|(
name|ftp
argument_list|)
argument_list|)
argument_list|,
operator|&
name|msgc
argument_list|,
literal|1
argument_list|,
name|MSG_OOB
argument_list|)
operator|!=
literal|1
condition|)
return|return
name|EXIT
argument_list|(
name|ftp
argument_list|,
name|QUIT
argument_list|)
return|;
name|FtpPutc
argument_list|(
name|ftp
argument_list|,
name|FTPCMD
argument_list|(
name|ftp
argument_list|)
argument_list|,
name|DM
argument_list|)
expr_stmt|;
name|FtpSendMessage
argument_list|(
name|ftp
argument_list|,
literal|"ABOR"
argument_list|)
expr_stmt|;
while|while
condition|(
name|select
argument_list|(
name|getdtablesize
argument_list|()
argument_list|,
operator|&
name|fds
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
operator|(
name|ftp
operator|->
name|timeout
operator|)
argument_list|)
operator|>
literal|0
condition|)
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|FtpGetMessage
argument_list|(
name|ftp
argument_list|,
name|msg
argument_list|)
expr_stmt|;
if|if
condition|(
name|FtpGood
argument_list|(
name|FtpNumber
argument_list|(
name|msg
argument_list|)
argument_list|,
literal|225
argument_list|,
literal|226
argument_list|,
name|EOF
argument_list|)
condition|)
break|break;
block|}
block|}
end_block

end_unit

