begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* 		      Library for ftpd clients.(libftp) 			Copyright by Oleg Orel 			 All rights reserved. 			 This  library is desined  for  free,  non-commercial  software  creation.  It is changeable and can be improved. The author would greatly appreciate  any  advises, new  components  and  patches  of  the  existing  programs. Commercial  usage is  also  possible  with  participation of it's author.    */
end_comment

begin_include
include|#
directive|include
file|"FtpLibrary.h"
end_include

begin_include
include|#
directive|include
file|<varargs.h>
end_include

begin_function
name|STATUS
name|FtpCommand
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|FTP
modifier|*
name|con
decl_stmt|;
name|char
modifier|*
name|command
decl_stmt|,
modifier|*
name|param
decl_stmt|;
name|int
name|Answer
index|[
name|MAX_ANSWERS
index|]
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|String
name|S1
decl_stmt|;
name|int
name|i
decl_stmt|,
name|counter
init|=
literal|0
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|con
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|FTP
operator|*
argument_list|)
expr_stmt|;
name|command
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|param
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|counter
operator|==
name|MAX_ANSWERS
condition|)
return|return
name|EXIT
argument_list|(
name|con
argument_list|,
name|QUIT
argument_list|)
return|;
name|Answer
index|[
name|counter
index|]
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|int
argument_list|)
expr_stmt|;
if|if
condition|(
name|Answer
index|[
name|counter
index|]
operator|==
name|EOF
condition|)
break|break;
name|counter
operator|++
expr_stmt|;
block|}
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|S1
argument_list|,
name|command
argument_list|,
name|param
argument_list|)
expr_stmt|;
if|if
condition|(
name|FtpSendMessage
argument_list|(
name|con
argument_list|,
name|S1
argument_list|)
operator|==
name|QUIT
condition|)
return|return
name|EXIT
argument_list|(
name|con
argument_list|,
name|QUIT
argument_list|)
return|;
if|if
condition|(
operator|(
name|i
operator|=
name|FtpGetMessage
argument_list|(
name|con
argument_list|,
name|S1
argument_list|)
operator|)
operator|==
name|QUIT
condition|)
return|return
name|EXIT
argument_list|(
name|con
argument_list|,
name|QUIT
argument_list|)
return|;
if|if
condition|(
operator|!
name|FtpGood1
argument_list|(
name|i
argument_list|,
name|Answer
argument_list|)
condition|)
return|return
name|EXIT
argument_list|(
name|con
argument_list|,
operator|-
name|i
argument_list|)
return|;
return|return
name|EXIT
argument_list|(
name|con
argument_list|,
name|i
argument_list|)
return|;
block|}
end_function

end_unit

