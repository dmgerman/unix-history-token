begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"uftp.h"
end_include

begin_decl_stmt
name|String
name|tmp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|jmp_buf
name|connectstack
decl_stmt|;
end_decl_stmt

begin_macro
name|Ftp_connect_hook
argument_list|(
argument|FTP *ftp
argument_list|,
argument|int code
argument_list|,
argument|char *msg
argument_list|)
end_macro

begin_block
block|{
name|FtpLog
argument_list|(
name|ftp
operator|->
name|title
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|connectstack
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_connect
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|STATUS
argument_list|(
operator|*
name|func1
argument_list|)
argument_list|()
decl_stmt|,
argument_list|(
operator|*
name|func2
argument_list|)
argument_list|()
decl_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
name|w2
operator|=
name|readline
argument_list|(
literal|"Host:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|FtpGetHost
argument_list|(
name|w2
argument_list|)
operator|==
name|NULL
operator|&&
name|FtpInit
operator|.
name|IO
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
name|msg
decl_stmt|;
specifier|extern
name|int
name|h_errno
decl_stmt|;
switch|switch
condition|(
name|h_errno
condition|)
block|{
case|case
name|HOST_NOT_FOUND
case|:
name|msg
operator|=
literal|"Host unknown"
expr_stmt|;
break|break;
case|case
name|TRY_AGAIN
case|:
name|msg
operator|=
literal|"Hostname lookup failure"
expr_stmt|;
break|break;
default|default:
name|msg
operator|=
literal|"gethostbyname failure"
expr_stmt|;
block|}
return|return
call|(
modifier|*
name|FtpInit
operator|.
name|IO
call|)
argument_list|(
name|LINK
argument_list|,
name|QUIT
argument_list|,
name|msg
argument_list|)
return|;
block|}
name|newframe
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|func1
operator|=
name|FtpInit
operator|.
name|error
expr_stmt|;
name|func2
operator|=
name|FtpInit
operator|.
name|IO
expr_stmt|;
if|if
condition|(
name|trymode
condition|)
block|{
name|FtpSetErrorHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|Ftp_connect_hook
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|Ftp_connect_hook
argument_list|)
expr_stmt|;
name|setjmp
argument_list|(
name|connectstack
argument_list|)
expr_stmt|;
block|}
name|FtpConnect
argument_list|(
operator|&
name|LINK
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|,
name|FtpGetHost
argument_list|(
name|w2
argument_list|)
operator|->
name|h_name
argument_list|)
expr_stmt|;
name|FtpSetErrorHandler
argument_list|(
name|LINK
argument_list|,
name|func1
argument_list|)
expr_stmt|;
name|FtpSetErrorHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|func1
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
name|LINK
argument_list|,
name|func2
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|func2
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|Ftp_user
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"login (default %s):"
argument_list|,
name|defaultuser
argument_list|)
expr_stmt|;
name|w2
operator|=
name|readline
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
name|w2
operator|=
name|defaultuser
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|w3
argument_list|)
expr_stmt|;
if|if
condition|(
name|FtpUser
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|)
operator|==
literal|331
condition|)
name|Ftp_pass
argument_list|(
literal|""
argument_list|,
name|w3
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_pass
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
block|{
name|String
name|pass
decl_stmt|;
name|String
name|host
decl_stmt|;
name|gethostname
argument_list|(
name|host
argument_list|,
sizeof|sizeof
name|host
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|host
argument_list|,
name|FtpGetHost
argument_list|(
name|host
argument_list|)
operator|->
name|h_name
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|pass
argument_list|,
literal|"%s@%s"
argument_list|,
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
operator|->
name|pw_name
argument_list|,
name|host
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"Password (default %s):"
argument_list|,
name|pass
argument_list|)
expr_stmt|;
name|w2
operator|=
name|getpass
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
name|w2
operator|=
name|pass
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|FtpPassword
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|,
name|FtpPwd
argument_list|(
name|LINK
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_open
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|;
name|STATUS
function_decl|(
modifier|*
name|err
function_decl|)
parameter_list|()
function_decl|;
name|Ftp_connect
argument_list|(
literal|""
argument_list|,
name|w2
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|Ftp_user
argument_list|(
literal|""
argument_list|,
name|w3
argument_list|,
name|w4
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifalias
argument_list|(
literal|"autologin"
argument_list|)
condition|)
name|execute
argument_list|(
literal|"autologin"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w5
condition|)
name|Ftp_cd
argument_list|(
literal|"cd"
argument_list|,
name|w5
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_reopen
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|host
decl_stmt|,
name|user
decl_stmt|,
name|pass
decl_stmt|,
name|pwd
decl_stmt|;
name|strcpy
argument_list|(
name|host
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|user
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|pass
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|pwd
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|)
expr_stmt|;
name|Ftp_close
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|Ftp_open
argument_list|(
literal|""
argument_list|,
name|host
argument_list|,
name|user
argument_list|,
name|pass
argument_list|,
name|pwd
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_ftp
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|pass
decl_stmt|;
name|String
name|host
decl_stmt|;
name|gethostname
argument_list|(
name|host
argument_list|,
sizeof|sizeof
name|host
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|host
argument_list|,
name|FtpGetHost
argument_list|(
name|host
argument_list|)
operator|->
name|h_name
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|pass
argument_list|,
literal|"%s@%s"
argument_list|,
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
operator|->
name|pw_name
argument_list|,
name|host
argument_list|)
expr_stmt|;
name|Ftp_open
argument_list|(
literal|""
argument_list|,
name|w2
argument_list|,
literal|"anonymous"
argument_list|,
name|pass
argument_list|,
name|w3
argument_list|,
literal|""
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|Ftp_quit
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_mput_handler
argument_list|()
end_macro

begin_block
block|{
name|log
argument_list|(
literal|"File(s) or directory not found"
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|start
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_lcd
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|glob_t
name|gl
decl_stmt|;
name|bzero
argument_list|(
operator|&
name|gl
argument_list|,
sizeof|sizeof
name|gl
argument_list|)
expr_stmt|;
name|glob
argument_list|(
name|w2
argument_list|,
name|GLOB_BRACE
operator||
name|GLOB_TILDE
operator||
name|GLOB_QUOTE
argument_list|,
name|Ftp_mput_handler
argument_list|,
operator|&
name|gl
argument_list|)
expr_stmt|;
if|if
condition|(
name|gl
operator|.
name|gl_matchc
operator|<
literal|1
operator|||
name|chdir
argument_list|(
operator|*
name|gl
operator|.
name|gl_pathv
argument_list|)
condition|)
name|perror
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Local directory is \"%s\"\n"
argument_list|,
name|getwd
argument_list|(
name|tmp
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_dir
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|char
modifier|*
name|cmd1
decl_stmt|;
name|String
name|cmd
decl_stmt|;
name|char
name|mode
init|=
name|LINK
operator|->
name|mode
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|w1
argument_list|,
literal|"dir"
argument_list|)
condition|)
name|cmd1
operator|=
literal|"LIST"
expr_stmt|;
else|else
name|cmd1
operator|=
literal|"NLST"
expr_stmt|;
name|strcpy
argument_list|(
name|cmd
argument_list|,
name|makestr
argument_list|(
name|cmd1
argument_list|,
name|w2
argument_list|,
name|w3
argument_list|,
name|w4
argument_list|,
name|w5
argument_list|,
name|w6
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|->
name|mode
operator|!=
literal|'A'
condition|)
name|FtpAscii
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
name|FtpRetr
argument_list|(
name|LINK
argument_list|,
name|cmd
argument_list|,
literal|""
argument_list|,
literal|"-"
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|->
name|mode
operator|!=
name|mode
condition|)
name|FtpType
argument_list|(
name|LINK
argument_list|,
name|mode
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_close
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|w2
argument_list|)
condition|)
block|{
name|i
operator|=
name|atoi
argument_list|(
name|w2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i
operator|=
name|frame
expr_stmt|;
block|}
name|FtpQuickBye
argument_list|(
name|ftp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|iftp
index|[
name|i
index|]
operator|.
name|host
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|iftp
index|[
name|i
index|]
operator|.
name|pwd
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|ftp
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|newframe
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|INLINE
name|SetLogicalVar
parameter_list|(
name|char
name|arg
parameter_list|,
name|int
modifier|*
name|var
parameter_list|,
name|char
modifier|*
name|msg
parameter_list|)
block|{
switch|switch
condition|(
name|arg
condition|)
block|{
case|case
literal|'y'
case|:
operator|*
name|var
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
operator|*
name|var
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
operator|(
operator|*
name|var
operator|)
condition|?
operator|(
operator|*
name|var
operator|=
literal|0
operator|)
else|:
operator|(
operator|*
name|var
operator|=
literal|1
operator|)
expr_stmt|;
break|break;
block|}
return|return
name|printf
argument_list|(
literal|"%s %s\n"
argument_list|,
name|msg
argument_list|,
operator|(
operator|*
name|var
operator|)
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
return|;
block|}
end_function

begin_macro
name|Ftp_set
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"frame"
argument_list|,
name|w2
argument_list|)
condition|)
return|return
name|atoi
argument_list|(
name|w3
argument_list|)
operator|<
name|NFRAMES
condition|?
name|frame
operator|=
name|atoi
argument_list|(
name|w3
argument_list|)
else|:
literal|0
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"timeout"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
name|FtpSetTimeout
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|atoi
argument_list|(
name|w3
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|!=
literal|0
condition|)
name|FtpSetTimeout
argument_list|(
name|LINK
argument_list|,
name|atoi
argument_list|(
name|w3
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"sleep"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
name|sleeptime
operator|=
name|atoi
argument_list|(
name|w3
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"debug"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
operator|*
name|w3
operator|==
literal|'y'
operator|||
operator|*
name|w3
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|LINK
operator|!=
name|NULL
condition|)
name|FtpSetDebugHandler
argument_list|(
name|LINK
argument_list|,
name|FtpDebugDebug
argument_list|)
expr_stmt|;
name|FtpSetDebugHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|FtpDebugDebug
argument_list|)
expr_stmt|;
return|return
name|puts
argument_list|(
literal|"Debuging on for current and next session"
argument_list|)
return|;
block|}
if|if
condition|(
operator|*
name|w3
operator|==
literal|'n'
condition|)
block|{
if|if
condition|(
name|LINK
operator|!=
name|NULL
condition|)
name|FtpSetDebugHandler
argument_list|(
name|LINK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|FtpSetDebugHandler
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|puts
argument_list|(
literal|"Debuging off for current and next session"
argument_list|)
return|;
block|}
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"bin"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
operator|*
name|w3
operator|==
literal|'y'
operator|||
operator|*
name|w3
operator|==
literal|0
condition|)
block|{
name|FtpInit
operator|.
name|mode
operator|=
literal|'I'
expr_stmt|;
return|return
name|puts
argument_list|(
literal|"Binary mode enable"
argument_list|)
return|;
block|}
if|if
condition|(
operator|*
name|w3
operator|==
literal|'n'
condition|)
block|{
name|FtpInit
operator|.
name|mode
operator|=
literal|'A'
expr_stmt|;
return|return
name|puts
argument_list|(
literal|"Binary mode disable"
argument_list|)
return|;
block|}
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"try"
argument_list|,
name|w2
argument_list|)
condition|)
return|return
name|SetLogicalVar
argument_list|(
operator|*
name|w3
argument_list|,
operator|&
name|trymode
argument_list|,
literal|"Try mode"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"hash"
argument_list|,
name|w2
argument_list|)
condition|)
return|return
name|SetLogicalVar
argument_list|(
operator|*
name|w3
argument_list|,
operator|&
name|hashmode
argument_list|,
literal|"Hash mode"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"glass"
argument_list|,
name|w2
argument_list|)
condition|)
return|return
name|SetLogicalVar
argument_list|(
operator|*
name|w3
argument_list|,
operator|&
name|glassmode
argument_list|,
literal|"Glass mode"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"rest"
argument_list|,
name|w2
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|w2
argument_list|,
literal|"restore"
argument_list|)
condition|)
return|return
name|SetLogicalVar
argument_list|(
operator|*
name|w3
argument_list|,
operator|&
name|restmode
argument_list|,
literal|"Restore mode"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"prompt"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
name|strcpy
argument_list|(
name|prompt
argument_list|,
name|w3
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"port"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|w3
argument_list|)
condition|)
return|return
name|FtpSetPort
argument_list|(
operator|&
name|FtpInit
argument_list|,
name|atoi
argument_list|(
name|w3
argument_list|)
argument_list|)
return|;
name|puts
argument_list|(
literal|"Port must be number"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"noopinterval"
argument_list|,
name|w2
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
literal|"noop"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|w3
argument_list|)
condition|)
return|return
name|noopinterval
operator|=
operator|(
name|time_t
operator|)
name|atoi
argument_list|(
name|w3
argument_list|)
return|;
name|puts
argument_list|(
literal|"Time must be number"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"nooptimeout"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
name|isdigit
argument_list|(
operator|*
name|w3
argument_list|)
condition|)
return|return
name|nooptimeout
operator|=
operator|(
name|time_t
operator|)
name|atoi
argument_list|(
name|w3
argument_list|)
return|;
name|puts
argument_list|(
literal|"Time must be number"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"user"
argument_list|,
name|w2
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
literal|"login"
argument_list|,
name|w2
argument_list|)
condition|)
block|{
name|strcpy
argument_list|(
name|defaultuser
argument_list|,
name|w3
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|""
argument_list|,
name|w2
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"frime %d\n"
argument_list|,
name|frame
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"timeout %d secs\n"
argument_list|,
name|FtpInit
operator|.
name|timeout
operator|.
name|tv_sec
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"sleep time %d secs\n"
argument_list|,
name|sleeptime
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"debug %s\n"
argument_list|,
operator|(
name|FtpInit
operator|.
name|debug
operator|!=
name|NULL
operator|)
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"glass mode %s\n"
argument_list|,
name|glassmode
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"try mode %s\n"
argument_list|,
name|trymode
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"hash mode %s\n"
argument_list|,
name|hashmode
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"restore mode %s\n"
argument_list|,
name|restmode
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"automatic binary mode %s\n"
argument_list|,
operator|(
name|FtpInit
operator|.
name|mode
operator|==
literal|'I'
operator|)
condition|?
literal|"enable"
else|:
literal|"disable"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"prompt  \"%s\"\n"
argument_list|,
name|prompt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"port %d\n"
argument_list|,
name|FtpInit
operator|.
name|port
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"noop interval %d\n"
argument_list|,
name|noopinterval
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"noop timeout %d\n"
argument_list|,
name|nooptimeout
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Default login name \"%s\"\n"
argument_list|,
name|defaultuser
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return;
block|}
return|return
name|puts
argument_list|(
literal|"arg 2 unknown"
argument_list|)
return|;
block|}
end_block

begin_decl_stmt
name|jmp_buf
name|getstack
decl_stmt|;
end_decl_stmt

begin_macro
name|Ftp_get_hook
argument_list|(
argument|FTP *con
argument_list|,
argument|int code
argument_list|,
argument|char *msg
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|abs
argument_list|(
name|code
argument_list|)
operator|==
literal|550
operator|&&
name|FtpBadReply550
argument_list|(
name|msg
argument_list|)
condition|)
block|{
name|FtpLog
argument_list|(
name|con
operator|->
name|title
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|log
argument_list|(
literal|"Transfer cancel"
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|getstack
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|code
operator|==
name|LQUIT
condition|)
block|{
name|log
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|log
argument_list|(
literal|"Transfer leave after I/O error with local file"
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|getstack
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
name|FtpLog
argument_list|(
name|con
operator|->
name|title
argument_list|,
name|msg
argument_list|)
expr_stmt|;
name|FtpQuickBye
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
name|LINK
operator|=
name|NULL
expr_stmt|;
name|log
argument_list|(
literal|"sleeping......"
argument_list|)
expr_stmt|;
name|sleep
argument_list|(
name|sleeptime
argument_list|)
expr_stmt|;
name|log
argument_list|(
literal|"try again..."
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|getstack
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|void
name|Ftp_get_intr
parameter_list|(
name|int
name|sig
parameter_list|)
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|intr
argument_list|)
expr_stmt|;
name|log
argument_list|(
literal|"Transfer interupt"
argument_list|)
expr_stmt|;
name|Ftp_abort
argument_list|()
expr_stmt|;
name|longjmp
argument_list|(
name|getstack
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|Ftp_get
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FTP
name|OldInit
decl_stmt|;
name|int
name|back
init|=
literal|0
decl_stmt|;
name|int
name|code
decl_stmt|;
name|int
name|status
init|=
literal|0
decl_stmt|;
name|OldInit
operator|=
name|FtpInit
expr_stmt|;
if|if
condition|(
name|strstr
argument_list|(
name|w1
argument_list|,
literal|"put"
argument_list|)
operator|!=
name|NULL
condition|)
name|back
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|restmode
operator|||
operator|(
operator|(
operator|*
name|w1
operator|==
literal|'r'
operator|)
operator|&&
operator|(
operator|*
operator|(
name|w1
operator|+
literal|1
operator|)
operator|==
literal|'e'
operator|)
operator|)
condition|)
name|FtpSetFlag
argument_list|(
name|LINK
argument_list|,
name|FTP_REST
argument_list|)
expr_stmt|;
else|else
name|FtpClearFlag
argument_list|(
name|LINK
argument_list|,
name|FTP_REST
argument_list|)
expr_stmt|;
if|if
condition|(
name|trymode
condition|)
block|{
name|FtpSetErrorHandler
argument_list|(
name|LINK
argument_list|,
name|Ftp_get_hook
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
name|LINK
argument_list|,
name|Ftp_get_hook
argument_list|)
expr_stmt|;
name|FtpInit
operator|=
operator|*
name|LINK
expr_stmt|;
name|FTPCMD
argument_list|(
operator|&
name|FtpInit
argument_list|)
operator|=
name|FTPCMD
argument_list|(
operator|&
name|OldInit
argument_list|)
expr_stmt|;
name|FTPDATA
argument_list|(
operator|&
name|FtpInit
argument_list|)
operator|=
name|FTPDATA
argument_list|(
operator|&
name|OldInit
argument_list|)
expr_stmt|;
block|}
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|Ftp_get_intr
argument_list|)
expr_stmt|;
name|FtpSetHashHandler
argument_list|(
name|LINK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|=
name|setjmp
argument_list|(
name|getstack
argument_list|)
operator|)
operator|==
literal|2
operator|||
name|status
operator|==
literal|3
condition|)
goto|goto
name|done
goto|;
if|if
condition|(
operator|(
name|LINK
operator|==
name|NULL
operator|)
operator|||
operator|(
name|LINK
operator|->
name|sock
operator|==
name|FtpInit
operator|.
name|sock
operator|)
condition|)
block|{
name|FtpLogin
argument_list|(
operator|&
name|LINK
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|FtpChdir
argument_list|(
name|LINK
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hashmode
operator|&&
name|isatty
argument_list|(
name|fileno
argument_list|(
name|stdout
argument_list|)
argument_list|)
condition|)
name|FtpSetHashHandler
argument_list|(
name|LINK
argument_list|,
name|myhash
argument_list|)
expr_stmt|;
else|else
name|FtpSetHashHandler
argument_list|(
name|LINK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|myhash
argument_list|(
name|LINK
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|back
condition|)
name|FtpGet
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|,
name|makefilename
argument_list|(
name|w2
argument_list|,
name|w3
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|FtpPut
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|,
name|makefilename
argument_list|(
name|w2
argument_list|,
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|log
argument_list|(
literal|"Transfer compliete"
argument_list|)
expr_stmt|;
name|done
label|:
name|FtpSetHashHandler
argument_list|(
name|LINK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|FtpSetErrorHandler
argument_list|(
name|LINK
argument_list|,
name|my_error
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
name|LINK
argument_list|,
name|my_error
argument_list|)
expr_stmt|;
name|FtpClearFlag
argument_list|(
name|LINK
argument_list|,
name|FTP_REST
argument_list|)
expr_stmt|;
name|FtpInit
operator|=
name|OldInit
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_mget
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FILE
modifier|*
name|list
decl_stmt|;
name|char
name|mode
init|=
name|LINK
operator|->
name|mode
decl_stmt|;
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"/tmp/uftplist-%s.XXXXXX"
argument_list|,
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
operator|->
name|pw_name
argument_list|)
expr_stmt|;
name|mktemp
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|->
name|mode
operator|!=
literal|'A'
condition|)
name|FtpAscii
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
name|FtpRetr
argument_list|(
name|LINK
argument_list|,
literal|"NLST"
argument_list|,
literal|""
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
else|else
name|FtpRetr
argument_list|(
name|LINK
argument_list|,
literal|"NLST %s"
argument_list|,
name|w2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|->
name|mode
operator|!=
name|mode
condition|)
name|FtpType
argument_list|(
name|LINK
argument_list|,
name|mode
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|list
operator|=
name|fopen
argument_list|(
name|tmp
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|FtpLog
argument_list|(
name|tmp
argument_list|,
name|sys_errlist
index|[
name|errno
index|]
argument_list|)
return|;
while|while
condition|(
name|fgets
argument_list|(
name|tmp
argument_list|,
sizeof|sizeof
name|tmp
argument_list|,
name|list
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|tmp
index|[
name|strlen
argument_list|(
name|tmp
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|Ftp_get
argument_list|(
literal|"get"
argument_list|,
name|tmp
argument_list|,
name|w3
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_mput
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|glob_t
name|gl
decl_stmt|;
name|glob
argument_list|(
name|w2
argument_list|,
name|GLOB_BRACE
operator||
name|GLOB_TILDE
operator||
name|GLOB_QUOTE
argument_list|,
name|Ftp_mput_handler
argument_list|,
operator|&
name|gl
argument_list|)
expr_stmt|;
while|while
condition|(
name|gl
operator|.
name|gl_matchc
operator|--
condition|)
block|{
name|Ftp_get
argument_list|(
literal|"put"
argument_list|,
operator|*
name|gl
operator|.
name|gl_pathv
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|gl
operator|.
name|gl_pathv
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|Ftp_bget
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|fn
decl_stmt|,
name|lfn
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|newframe
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FtpFullSyntax
argument_list|(
name|w2
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|fn
argument_list|)
condition|)
return|return
name|puts
argument_list|(
literal|"Filename syntax error"
argument_list|)
return|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|strrchr
argument_list|(
name|fn
argument_list|,
literal|'/'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|strcpy
argument_list|(
name|lfn
argument_list|,
name|p
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|lfn
argument_list|,
name|fn
argument_list|)
expr_stmt|;
name|FtpQuickBye
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
name|LINK
operator|=
name|FtpCreateObject
argument_list|()
expr_stmt|;
name|LINK
operator|->
name|sock
operator|=
name|NULL
expr_stmt|;
name|Ftp_get
argument_list|(
literal|"get"
argument_list|,
name|fn
argument_list|,
operator|(
operator|*
name|w3
operator|==
literal|0
operator|)
condition|?
name|lfn
else|:
name|w3
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_bput
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|fn
decl_stmt|,
name|lfn
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|!
name|FtpFullSyntax
argument_list|(
operator|(
operator|*
name|w3
operator|==
literal|0
operator|)
condition|?
name|w2
else|:
name|w3
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|fn
argument_list|)
condition|)
return|return
name|puts
argument_list|(
literal|"Filename syntax error"
argument_list|)
return|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|strrchr
argument_list|(
name|fn
argument_list|,
literal|'/'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|strcpy
argument_list|(
name|lfn
argument_list|,
name|p
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|lfn
argument_list|,
name|fn
argument_list|)
expr_stmt|;
name|FtpQuickBye
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
name|LINK
operator|=
name|FtpCreateObject
argument_list|()
expr_stmt|;
name|LINK
operator|->
name|sock
operator|=
name|NULL
expr_stmt|;
name|Ftp_get
argument_list|(
literal|"put"
argument_list|,
operator|(
operator|*
name|w3
operator|==
literal|0
operator|)
condition|?
name|lfn
else|:
name|w2
argument_list|,
name|fn
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_copy
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|in
decl_stmt|,
name|out
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|w2
operator|||
operator|!
operator|*
name|w3
condition|)
return|return
name|puts
argument_list|(
literal|"Must pass two args"
argument_list|)
return|;
if|if
condition|(
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|w2
argument_list|,
literal|'!'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
name|in
operator|=
name|atoi
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|w2
operator|=
name|p
operator|+
literal|1
expr_stmt|;
block|}
else|else
name|in
operator|=
name|frame
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|w3
argument_list|,
literal|'!'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
name|out
operator|=
name|atoi
argument_list|(
name|w3
argument_list|)
expr_stmt|;
name|w3
operator|=
name|p
operator|+
literal|1
expr_stmt|;
block|}
else|else
name|in
operator|=
name|frame
expr_stmt|;
if|if
condition|(
name|in
operator|==
name|out
condition|)
return|return
name|puts
argument_list|(
literal|"Files must been from different frames"
argument_list|)
return|;
name|FtpCopy
argument_list|(
name|ftp
index|[
name|in
index|]
argument_list|,
name|ftp
index|[
name|out
index|]
argument_list|,
name|w2
argument_list|,
name|w3
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_ccopy
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|in
decl_stmt|,
name|out
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|w2
operator|||
operator|!
operator|*
name|w3
condition|)
return|return
name|puts
argument_list|(
literal|"Must pass two args"
argument_list|)
return|;
if|if
condition|(
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|w2
argument_list|,
literal|'!'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
name|in
operator|=
name|atoi
argument_list|(
name|w2
argument_list|)
expr_stmt|;
name|w2
operator|=
name|p
operator|+
literal|1
expr_stmt|;
block|}
else|else
name|in
operator|=
name|frame
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|w3
argument_list|,
literal|'!'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
name|out
operator|=
name|atoi
argument_list|(
name|w3
argument_list|)
expr_stmt|;
name|w3
operator|=
name|p
operator|+
literal|1
expr_stmt|;
block|}
else|else
name|in
operator|=
name|frame
expr_stmt|;
if|if
condition|(
name|in
operator|==
name|out
condition|)
return|return
name|puts
argument_list|(
literal|"Files must been from different frames"
argument_list|)
return|;
name|FtpPassiveTransfer
argument_list|(
name|ftp
index|[
name|in
index|]
argument_list|,
name|ftp
index|[
name|out
index|]
argument_list|,
name|w2
argument_list|,
name|w3
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_bin
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpBinary
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_ascii
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpAscii
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_cd
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpChdir
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|,
name|FtpPwd
argument_list|(
name|LINK
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifalias
argument_list|(
literal|"autocd"
argument_list|)
condition|)
name|execute
argument_list|(
literal|"autocd"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_dup
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|LINKINFO
name|oldinfo
decl_stmt|;
name|FTP
name|oldftp
decl_stmt|;
name|oldinfo
operator|=
name|iftp
index|[
name|frame
index|]
expr_stmt|;
name|oldftp
operator|=
operator|*
name|LINK
expr_stmt|;
name|newframe
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"Make alternative connection..."
argument_list|)
expr_stmt|;
name|Ftp_open
argument_list|(
literal|""
argument_list|,
name|oldinfo
operator|.
name|host
argument_list|,
name|oldinfo
operator|.
name|user
argument_list|,
name|oldinfo
operator|.
name|pass
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|oldinfo
operator|.
name|pwd
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|)
condition|)
name|Ftp_cd
argument_list|(
literal|""
argument_list|,
name|oldinfo
operator|.
name|pwd
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|->
name|mode
operator|!=
name|oldftp
operator|.
name|mode
condition|)
name|FtpType
argument_list|(
name|LINK
argument_list|,
name|oldftp
operator|.
name|mode
argument_list|)
expr_stmt|;
name|LINK
operator|->
name|timeout
operator|=
name|oldftp
operator|.
name|timeout
expr_stmt|;
name|LINK
operator|->
name|flags
operator|=
name|oldftp
operator|.
name|flags
expr_stmt|;
name|FtpSetDebugHandler
argument_list|(
name|LINK
argument_list|,
name|oldftp
operator|.
name|debug
argument_list|)
expr_stmt|;
name|FtpSetErrorHandler
argument_list|(
name|LINK
argument_list|,
name|oldftp
operator|.
name|error
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
name|LINK
argument_list|,
name|oldftp
operator|.
name|IO
argument_list|)
expr_stmt|;
name|FtpSetHashHandler
argument_list|(
name|LINK
argument_list|,
name|oldftp
operator|.
name|hash
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_bg
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|fork
argument_list|()
condition|)
block|{
name|log
argument_list|(
literal|"Backgrounding..."
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
block|{
name|int
name|i
init|=
name|frame
decl_stmt|;
name|lastcmd
operator|=
literal|1
expr_stmt|;
comment|/* Ignoring keypad */
name|alarm
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGALRM
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGURG
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGPIPE
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGTSTP
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGIO
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
comment|/* Droping output */
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"/tmp/uftp-%s.XXXXXX"
argument_list|,
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
operator|->
name|pw_name
argument_list|)
expr_stmt|;
name|mktemp
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|open
argument_list|(
name|tmp
argument_list|,
name|O_RDWR
operator||
name|O_TRUNC
operator||
name|O_CREAT
argument_list|,
literal|0600
argument_list|)
expr_stmt|;
name|dup
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|dup
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|LINK
operator|!=
name|NULL
condition|)
block|{
name|Ftp_dup
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ftp
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|ftp
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|executev
argument_list|(
name|w2
argument_list|,
name|w3
argument_list|,
name|w4
argument_list|,
name|w5
argument_list|,
name|w6
argument_list|,
literal|""
argument_list|)
return|;
block|}
block|}
end_block

begin_macro
name|Ftp_list
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
define|#
directive|define
name|_FMT
value|"%-5s %-15s %-10s %-25s %-7s %-4s\n"
define|#
directive|define
name|FMT
value|"%-5d %-15s %-10s %-25s %-7d %-4d\n"
name|printf
argument_list|(
name|_FMT
argument_list|,
literal|"Frame"
argument_list|,
literal|"Host name"
argument_list|,
literal|"User's name"
argument_list|,
literal|"Working directory"
argument_list|,
literal|"Timeout"
argument_list|,
literal|"Port"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NFRAMES
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ftp
index|[
name|i
index|]
operator|!=
name|NULL
condition|)
name|printf
argument_list|(
name|FMT
argument_list|,
name|i
argument_list|,
name|iftp
index|[
name|i
index|]
operator|.
name|host
argument_list|,
name|iftp
index|[
name|i
index|]
operator|.
name|user
argument_list|,
name|iftp
index|[
name|i
index|]
operator|.
name|pwd
argument_list|,
name|ftp
index|[
name|i
index|]
operator|->
name|timeout
operator|.
name|tv_sec
argument_list|,
name|ftp
index|[
name|i
index|]
operator|->
name|port
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_macro
name|Ftp_abort
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|time_t
name|save
decl_stmt|;
if|if
condition|(
name|LINK
operator|!=
name|NULL
condition|)
block|{
name|save
operator|=
name|LINK
operator|->
name|timeout
operator|.
name|tv_sec
expr_stmt|;
name|LINK
operator|->
name|timeout
operator|.
name|tv_sec
operator|=
name|nooptimeout
expr_stmt|;
name|FtpAbort
argument_list|(
name|LINK
argument_list|)
expr_stmt|;
name|LINK
operator|->
name|timeout
operator|.
name|tv_sec
operator|=
name|save
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|Ftp_type
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpGet
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|,
literal|"*STDOUT*"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_page
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|pager
decl_stmt|;
name|String
name|out
init|=
block|{
literal|'|'
block|,
literal|0
block|}
decl_stmt|;
if|if
condition|(
operator|(
name|pager
operator|=
operator|(
name|char
operator|*
operator|)
name|getenv
argument_list|(
literal|"PAGER"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|pager
operator|=
literal|"more"
expr_stmt|;
name|strcat
argument_list|(
name|out
argument_list|,
name|pager
argument_list|)
expr_stmt|;
name|FtpGet
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_mkdir
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpMkdir
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_rm
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FILE
modifier|*
name|list
decl_stmt|;
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"/tmp/uftplist-%s.XXXXXX"
argument_list|,
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
operator|->
name|pw_name
argument_list|)
expr_stmt|;
name|mktemp
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
literal|"Filename specification must present"
argument_list|)
expr_stmt|;
return|return;
block|}
name|FtpRetr
argument_list|(
name|LINK
argument_list|,
literal|"NLST %s"
argument_list|,
name|w2
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|list
operator|=
name|fopen
argument_list|(
name|tmp
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|FtpLog
argument_list|(
name|tmp
argument_list|,
name|sys_errlist
index|[
name|errno
index|]
argument_list|)
return|;
while|while
condition|(
name|fgets
argument_list|(
name|tmp
argument_list|,
sizeof|sizeof
name|tmp
argument_list|,
name|list
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|tmp
index|[
name|strlen
argument_list|(
name|tmp
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|FtpCommand
argument_list|(
name|LINK
argument_list|,
literal|"DELE %s"
argument_list|,
name|tmp
argument_list|,
literal|0
argument_list|,
name|EOF
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_move
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|FtpMove
argument_list|(
name|LINK
argument_list|,
name|w2
argument_list|,
name|w3
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_help
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|,
name|ii
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|w2
condition|)
block|{
name|puts
argument_list|(
literal|"Warrning!!!! \nPlease read general information using command \"help etc\"\n\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
literal|1
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|ii
operator|=
literal|0
init|;
name|ii
operator|<
literal|5
condition|;
name|ii
operator|++
control|)
block|{
if|if
condition|(
name|cmds
index|[
name|ii
operator|+
name|i
operator|*
literal|5
index|]
operator|.
name|cmd
operator|==
name|NULL
condition|)
return|return
name|putchar
argument_list|(
literal|'\n'
argument_list|)
return|;
name|printf
argument_list|(
literal|"%-16s"
argument_list|,
name|cmds
index|[
name|ii
operator|+
name|i
operator|*
literal|5
index|]
operator|.
name|cmd
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cmds
index|[
name|i
index|]
operator|.
name|cmd
operator|==
name|NULL
condition|)
return|return
name|puts
argument_list|(
literal|"Command not found"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|cmds
index|[
name|i
index|]
operator|.
name|cmd
argument_list|,
name|w2
argument_list|)
condition|)
break|break;
block|}
name|puts
argument_list|(
name|cmds
index|[
name|i
index|]
operator|.
name|help
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_quote
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|new
decl_stmt|;
name|new
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|*
name|w2
operator|!=
literal|0
condition|)
name|strcpy
argument_list|(
name|new
argument_list|,
name|w2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w3
operator|!=
literal|0
condition|)
name|strcat
argument_list|(
name|new
argument_list|,
literal|" "
argument_list|)
operator|,
name|strcat
argument_list|(
name|new
argument_list|,
name|w3
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w4
operator|!=
literal|0
condition|)
name|strcat
argument_list|(
name|new
argument_list|,
literal|" "
argument_list|)
operator|,
name|strcat
argument_list|(
name|new
argument_list|,
name|w4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w5
operator|!=
literal|0
condition|)
name|strcat
argument_list|(
name|new
argument_list|,
literal|" "
argument_list|)
operator|,
name|strcat
argument_list|(
name|new
argument_list|,
name|w5
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|w6
operator|!=
literal|0
condition|)
name|strcat
argument_list|(
name|new
argument_list|,
literal|" "
argument_list|)
operator|,
name|strcat
argument_list|(
name|new
argument_list|,
name|w6
argument_list|)
expr_stmt|;
name|FtpCommand
argument_list|(
name|LINK
argument_list|,
name|new
argument_list|,
literal|""
argument_list|,
literal|0
argument_list|,
name|EOF
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_alias
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|ALIAS
modifier|*
name|a
init|=
name|firstalias
decl_stmt|;
if|if
condition|(
operator|*
name|w2
operator|==
literal|0
condition|)
block|{
while|while
condition|(
name|a
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%s=%s\n"
argument_list|,
name|a
operator|->
name|name
argument_list|,
name|a
operator|->
name|str
argument_list|)
expr_stmt|;
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
block|}
return|return;
block|}
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|a
operator|==
name|NULL
condition|)
block|{
name|firstalias
operator|=
name|a
operator|=
operator|(
name|ALIAS
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ALIAS
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ALIAS
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|a
operator|->
name|name
argument_list|,
name|w2
argument_list|)
condition|)
break|break;
if|if
condition|(
name|a
operator|->
name|next
operator|==
name|NULL
condition|)
block|{
name|a
operator|->
name|next
operator|=
operator|(
name|ALIAS
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ALIAS
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
name|memset
argument_list|(
name|a
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ALIAS
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|a
operator|->
name|name
argument_list|,
name|w2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|a
operator|->
name|str
argument_list|,
name|makestr
argument_list|(
name|w3
argument_list|,
name|w4
argument_list|,
name|w5
argument_list|,
name|w6
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_mkalias
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|String
name|new
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|w2
condition|)
return|return
name|puts
argument_list|(
literal|"Arg must present\n"
argument_list|)
return|;
name|sprintf
argument_list|(
name|new
argument_list|,
literal|"open \"%s\" \"%s\" \"%s\" \"%s\""
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|host
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|user
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pass
argument_list|,
name|iftp
index|[
name|frame
index|]
operator|.
name|pwd
argument_list|)
expr_stmt|;
name|Ftp_alias
argument_list|(
literal|"alias"
argument_list|,
name|w2
argument_list|,
name|new
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Ftp_unalias
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|ALIAS
modifier|*
name|cur
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|cur
operator|=
name|prev
operator|=
name|firstalias
expr_stmt|;
while|while
condition|(
name|cur
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|cur
operator|->
name|name
argument_list|,
name|w2
argument_list|)
condition|)
block|{
if|if
condition|(
name|cur
operator|==
name|firstalias
condition|)
block|{
name|firstalias
operator|=
name|cur
operator|->
name|next
expr_stmt|;
name|free
argument_list|(
name|cur
argument_list|)
expr_stmt|;
return|return;
block|}
name|prev
operator|->
name|next
operator|=
name|cur
operator|->
name|next
expr_stmt|;
name|free
argument_list|(
name|cur
argument_list|)
expr_stmt|;
block|}
name|prev
operator|=
name|cur
expr_stmt|;
name|cur
operator|=
name|cur
operator|->
name|next
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|Ftp_save
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
name|ALIAS
modifier|*
name|a
init|=
name|firstalias
decl_stmt|;
name|String
name|fn
decl_stmt|;
name|FILE
modifier|*
name|out
decl_stmt|;
if|if
condition|(
operator|(
name|out
operator|=
name|fopen
argument_list|(
name|getaliasrcname
argument_list|()
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
name|getaliasrcname
argument_list|()
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|a
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|out
argument_list|,
literal|"alias %s '%s'\n"
argument_list|,
name|a
operator|->
name|name
argument_list|,
name|a
operator|->
name|str
argument_list|)
expr_stmt|;
name|a
operator|=
name|a
operator|->
name|next
expr_stmt|;
block|}
name|fclose
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|chmod
argument_list|(
name|getaliasrcname
argument_list|()
argument_list|,
literal|0600
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"Aliases saved"
argument_list|)
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|ARCHIE_MAX_TARGETS
value|20
end_define

begin_macro
name|Ftp_acd
argument_list|(
argument|ARGS
argument_list|)
end_macro

begin_block
block|{
specifier|static
name|int
name|targets
init|=
literal|0
decl_stmt|;
specifier|static
name|String
name|what
init|=
block|{
literal|0
block|}
decl_stmt|;
specifier|static
name|ARCHIE
name|result
index|[
name|ARCHIE_MAX_TARGETS
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|selected_target
decl_stmt|;
name|String
name|tmp
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|(
name|what
index|[
literal|0
index|]
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|w2
argument_list|,
name|what
argument_list|)
operator|!=
literal|0
operator|)
operator|&&
operator|*
name|w2
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|targets
operator|=
name|FtpArchie
argument_list|(
name|w2
argument_list|,
name|result
argument_list|,
name|ARCHIE_MAX_TARGETS
argument_list|)
operator|)
operator|<
literal|1
condition|)
return|return
name|puts
argument_list|(
literal|"Archie failure or target not found"
argument_list|)
return|;
name|strcpy
argument_list|(
name|what
argument_list|,
name|w2
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|targets
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%2d %s:%s\n"
argument_list|,
name|i
argument_list|,
name|result
index|[
name|i
index|]
operator|.
name|host
argument_list|,
name|result
index|[
name|i
index|]
operator|.
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|w1
argument_list|,
literal|"archie"
argument_list|)
operator|==
literal|0
condition|)
return|return;
name|p
operator|=
name|readline
argument_list|(
literal|"Your selection? "
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
return|return;
name|selected_target
operator|=
name|atoi
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
index|[
name|selected_target
index|]
operator|.
name|file
index|[
name|strlen
argument_list|(
name|result
index|[
name|selected_target
index|]
operator|.
name|file
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|'/'
condition|)
block|{
name|Ftp_ftp
argument_list|(
literal|"ftp"
argument_list|,
name|result
index|[
name|selected_target
index|]
operator|.
name|host
argument_list|,
name|result
index|[
name|selected_target
index|]
operator|.
name|file
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"%s:%s"
argument_list|,
name|result
index|[
name|selected_target
index|]
operator|.
name|host
argument_list|,
name|result
index|[
name|selected_target
index|]
operator|.
name|file
argument_list|)
expr_stmt|;
name|Ftp_bget
argument_list|(
literal|"bget"
argument_list|,
name|tmp
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_decl_stmt
name|CMDS
name|cmds
index|[]
init|=
block|{
literal|"connect"
block|,
name|Ftp_connect
block|,
literal|0
block|,
literal|"connect<hostname> - make new ftp connection"
block|,
literal|"open"
block|,
name|Ftp_open
block|,
literal|0
block|,
literal|"open<hostname><user><pass><directory> - login to server"
block|,
literal|"reopen"
block|,
name|Ftp_reopen
block|,
literal|1
block|,
literal|"Open again connection with existing frame information"
block|,
literal|"ftp"
block|,
name|Ftp_ftp
block|,
literal|0
block|,
literal|"ftp<hostname> - anonymously login to server"
block|,
literal|"close"
block|,
name|Ftp_close
block|,
literal|1
block|,
literal|"Close connection"
block|,
literal|"quit"
block|,
name|Ftp_quit
block|,
literal|0
block|,
literal|"Exit from uftp"
block|,
literal|"set"
block|,
name|Ftp_set
block|,
literal|0
block|,
literal|"Set variables: (Without args print current settings)\n\        frame<number>    - select another session(frame)\n\        timeout<secs>    - Set network timeout\n\        nooptimeout<secs>- Set network timeout with clearing timeout\n\        noop<secs>       - Set time interval for sending NOOP operator\n\                            to server for erased delay\n\        sleep<secs>      - Set pause beetween transfer attempt\n\        debug<y|n>       - Set debuging ftp's protocol (Default no)\n\        try<y|n>         - Set retransfer mode with broken network (Default yes)\n\        hash<y|n>        - Set hashing transfer (Default no)\n\        restore<y|n>     - Set retransfer mode (reget/reput) (Default yes!!!!)\n\        bin<y|n>         - Set automatic turn on binary mode (Default no) \n\        glass<y|n>       - Set glass mode (bad commands interprets as commands for FTPD)\n\        prompt<string>   - Set prompt (See help prompt)\n\        port<number>     - Set ftpd's port for next sessions\n\        user<name>       - Set default user name (default you name)"
block|,
literal|"prompt"
block|,
name|NULL
block|,
literal|0
block|,
literal|"\ prompt is a string, which may be contains %<char>  or ^<char> combitanion, which have next interprets:  %H, %h - full and short remote host names %M, %m - full and short local host names %u     - remote user's name %d     - remote current directory %D     - local current directory %f     - number of current frame %p     - the ftp's port number %t     - timeout  %T     - current time  %P     - uftp process id %%     - character % ^<char>- control character %^     - character ^ "
block|,
literal|"list"
block|,
name|Ftp_list
block|,
literal|0
block|,
literal|"List session's information"
block|,
literal|"user"
block|,
name|Ftp_user
block|,
literal|1
block|,
literal|"user<user> - send user's name"
block|,
literal|"pass"
block|,
name|Ftp_pass
block|,
literal|1
block|,
literal|"pass<pass> - send user's password"
block|,
literal|"bin"
block|,
name|Ftp_bin
block|,
literal|1
block|,
literal|"Set binary mode for current frame"
block|,
literal|"ascii"
block|,
name|Ftp_ascii
block|,
literal|1
block|,
literal|"Set ASCII mode for current frame"
block|,
literal|"cd"
block|,
name|Ftp_cd
block|,
literal|1
block|,
literal|"cd<directory> - change current remote directory "
block|,
literal|"acd"
block|,
name|Ftp_acd
block|,
literal|0
block|,
literal|"acd<file_or_directory> - search pointed directory using archie, and setup connection to it"
block|,
literal|"lcd"
block|,
name|Ftp_lcd
block|,
literal|0
block|,
literal|"Change local directory"
block|,
literal|"abort"
block|,
name|Ftp_abort
block|,
literal|1
block|,
literal|"abort last operation"
block|,
literal|"mkdir"
block|,
name|Ftp_mkdir
block|,
literal|1
block|,
literal|"mkdir<dirname> - create new directory"
block|,
literal|"rm"
block|,
name|Ftp_rm
block|,
literal|1
block|,
literal|"rm<filename_spec> - remove file(s)"
block|,
literal|"mv"
block|,
name|Ftp_move
block|,
literal|1
block|,
literal|"mv<old><new> - rename file"
block|,
literal|"dir"
block|,
name|Ftp_dir
block|,
literal|1
block|,
literal|"dir<argslist> ... - print list of files"
block|,
literal|"ls"
block|,
name|Ftp_dir
block|,
literal|1
block|,
literal|"ls<arglist> ... - print short list of files"
block|,
literal|"get"
block|,
name|Ftp_get
block|,
literal|1
block|,
literal|"get<remote_file> [<local_file>] - receive file from server"
block|,
literal|"mget"
block|,
name|Ftp_mget
block|,
literal|1
block|,
literal|"mget<remote_file(s)> [<local_directory>] - receive file(s) from server"
block|,
literal|"reget"
block|,
name|Ftp_get
block|,
literal|1
block|,
literal|"reget<remote_file><local_file> - receive file restarting at end of local file"
block|,
literal|"aget"
block|,
name|Ftp_acd
block|,
literal|0
block|,
literal|"aget<file> - search pointed file using archie, and retrive it"
block|,
literal|"put"
block|,
name|Ftp_get
block|,
literal|1
block|,
literal|"put<local_file> [<remote_file>] - send server to file"
block|,
literal|"mput"
block|,
name|Ftp_mput
block|,
literal|1
block|,
literal|"mput<local_file(s)>  - send file(s) from server"
block|,
literal|"reput"
block|,
name|Ftp_get
block|,
literal|1
block|,
literal|"reput<local_file> [<remote_file>] - send file restarting at end of remote file"
block|,
literal|"bget"
block|,
name|Ftp_bget
block|,
literal|0
block|,
literal|"bget<libftp_file> [<localfile>] - full session procedure (See \"help etc\")"
block|,
literal|"bput"
block|,
name|Ftp_bput
block|,
literal|0
block|,
literal|"bput [<localfile>]<libftp_file> - full session procedure (See \"help etc\")"
block|,
literal|"copy"
block|,
name|Ftp_copy
block|,
literal|1
block|,
literal|"copy [<frame>!]file [<frame>!]file - copy file via client cache"
block|,
literal|"ccopy"
block|,
name|Ftp_ccopy
block|,
literal|1
block|,
literal|"ccopy [<frame>!]file [<frame>!]file - copy file directly beetween servers"
block|,
literal|"cat"
block|,
name|Ftp_type
block|,
literal|1
block|,
literal|"cat<file> - print body of remote file to screen"
block|,
literal|"page"
block|,
name|Ftp_page
block|,
literal|1
block|,
literal|"page<file> - print body of remote file to screen via pager"
block|,
literal|"bg"
block|,
name|Ftp_bg
block|,
literal|0
block|,
literal|"bg<any_command> - run command(s) backgroundly (output redirect to file),\n\ You can also add&-char to back of line without \"bg\""
block|,
literal|"archie"
block|,
name|Ftp_acd
block|,
literal|0
block|,
literal|"Find file using archie service and display to screen"
block|,
literal|"dup"
block|,
name|Ftp_dup
block|,
literal|1
block|,
literal|"Make new analogous frame"
block|,
literal|"quote"
block|,
name|Ftp_quote
block|,
literal|1
block|,
literal|"quote<some_string> - send command directly to server"
block|,
literal|"help"
block|,
name|Ftp_help
block|,
literal|0
block|,
literal|"help<command> - print list of commands or command description"
block|,
literal|"alias"
block|,
name|Ftp_alias
block|,
literal|0
block|,
literal|"\ alias aliasname<list> .... - make new alias, use $X for taking \n\                   X's argument from command string, and $* for taking\n\                   all arguments. If $<anything> on alias not present,\n\                   the arguments appending to end of command string"
block|,
literal|"unalias"
block|,
name|Ftp_unalias
block|,
literal|0
block|,
literal|"unalias<aliasname> - remove alias"
block|,
literal|"mkalias"
block|,
name|Ftp_mkalias
block|,
literal|0
block|,
literal|"make alias for create this frame, use savealias for saving it to file"
block|,
literal|"savealias"
block|,
name|Ftp_save
block|,
literal|0
block|,
literal|"Save aliases to file"
block|,
literal|"etc"
block|,
name|NULL
block|,
literal|0
block|,
literal|"\ 1. In any command you may use constructions<file and>file for\n\    redirect input output.\n\ \n\ 2. All local files files interprets as libftp file(s), \n\    this support next specification:\n\ \n\    |string - interprets string as shell command, which must be\n\    execute and input or output take from/to it.\n\    \n\    hostname:filename - interprets as file, witch must be take \n\    using ftp protocol with anonymously access\n\   \n\    user@hostname:filename - interprets as file accesses via ftp\n\    with password yourname@your_host.your_domain\n\ \n\    user/pass@hostname:filename - also ftp file.\n\ \n\    *STDIN*, *STDOUT*, *STDERR* - opened streams.\n\ \n\    anything - local file name.\n\ \n\ 3. Command started with '!' passed to shell.\n \n\ 4. If string beetween two \" or \', its interprets as one word.\n\ \n\ 5. Any string may be devide to few commands using ';'."
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

end_unit

