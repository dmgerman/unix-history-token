begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* 		      Library for ftpd clients.(libftp) 			Copyright by Oleg Orel 			 All rights reserved. 			 This  library is desined  for  free,  non-commercial  software  creation.  It is changeable and can be improved. The author would greatly appreciate  any  advises, new  components  and  patches  of  the  existing  programs. Commercial  usage is  also  possible  with  participation of it's author.    */
end_comment

begin_include
include|#
directive|include
file|"FtpLibrary.h"
end_include

begin_function
name|void
name|FtpDebug
parameter_list|(
name|FTP
modifier|*
name|ftp
parameter_list|)
block|{
name|STATUS
name|FtpDebugDebug
argument_list|()
decl_stmt|,
name|FtpDebugError
argument_list|()
decl_stmt|,
name|FtpDebugIO
argument_list|()
decl_stmt|;
name|FtpSetDebugHandler
argument_list|(
name|ftp
argument_list|,
name|FtpDebugDebug
argument_list|)
expr_stmt|;
name|FtpSetErrorHandler
argument_list|(
name|ftp
argument_list|,
name|FtpDebugError
argument_list|)
expr_stmt|;
name|FtpSetIOHandler
argument_list|(
name|ftp
argument_list|,
name|FtpDebugIO
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|STATUS
name|FtpDebugDebug
parameter_list|(
name|FTP
modifier|*
name|ftp
parameter_list|,
name|int
name|n
parameter_list|,
name|char
modifier|*
name|Message
parameter_list|)
block|{
name|String
name|tmp
decl_stmt|;
name|strcpy
argument_list|(
name|tmp
argument_list|,
name|Message
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|tmp
argument_list|,
literal|"PASS "
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|p
init|=
name|tmp
operator|+
literal|5
decl_stmt|;
while|while
condition|(
operator|*
name|p
operator|!=
literal|'\0'
condition|)
operator|*
name|p
operator|++
operator|=
literal|'*'
expr_stmt|;
block|}
empty_stmt|;
name|FtpLog
argument_list|(
name|ftp
operator|->
name|title
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|STATUS
name|FtpDebugError
parameter_list|(
name|FTP
modifier|*
name|ftp
parameter_list|,
name|int
name|n
parameter_list|,
name|char
modifier|*
name|Message
parameter_list|)
block|{
name|FtpLog
argument_list|(
literal|"FtpDebugError"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|FtpLog
argument_list|(
name|ftp
operator|->
name|title
argument_list|,
name|Message
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FtpTestFlag
argument_list|(
name|ftp
argument_list|,
name|FTP_NOEXIT
argument_list|)
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|STATUS
name|FtpDebugIO
parameter_list|(
name|FTP
modifier|*
name|ftp
parameter_list|,
name|int
name|n
parameter_list|,
name|char
modifier|*
name|Message
parameter_list|)
block|{
name|FtpLog
argument_list|(
literal|"FtpDebugIO"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|FtpLog
argument_list|(
name|ftp
operator|->
name|title
argument_list|,
name|Message
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|FtpTestFlag
argument_list|(
name|ftp
argument_list|,
name|FTP_NOEXIT
argument_list|)
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|STATUS
name|FtpLog
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|str
parameter_list|)
block|{
name|time_t
name|t
init|=
name|time
argument_list|(
operator|(
name|time_t
operator|*
operator|)
literal|0
argument_list|)
decl_stmt|;
name|struct
name|tm
modifier|*
name|lt
init|=
name|localtime
argument_list|(
operator|&
name|t
argument_list|)
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%02d:%02d:%02d %s %s\n"
argument_list|,
name|lt
operator|->
name|tm_hour
argument_list|,
name|lt
operator|->
name|tm_min
argument_list|,
name|lt
operator|->
name|tm_sec
argument_list|,
name|name
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|FtpHash
argument_list|(
argument|FTP *ftp
argument_list|,
argument|unsigned long chars
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|chars
operator|==
literal|0
condition|)
return|return
name|ftp
operator|->
name|counter
operator|=
literal|0
return|;
name|ftp
operator|->
name|counter
operator|+=
name|chars
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%10u bytes transfered\r"
argument_list|,
name|ftp
operator|->
name|counter
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
return|return
name|ftp
operator|->
name|counter
return|;
block|}
end_block

begin_function
name|STATUS
name|FtpBadReply550
parameter_list|(
name|char
modifier|*
name|s
parameter_list|)
block|{
if|if
condition|(
operator|(
name|strstr
argument_list|(
name|s
argument_list|,
literal|"unreachable"
argument_list|)
operator|!=
name|NULL
operator|)
operator|||
operator|(
name|strstr
argument_list|(
name|s
argument_list|,
literal|"Broken pipe"
argument_list|)
operator|!=
name|NULL
operator|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

end_unit

