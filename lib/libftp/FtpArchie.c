begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* 		      Library for ftpd clients.(libftp) 			Copyright by Oleg Orel 			 All rights reserved. 			 This  library is desined  for  free,  non-commercial  software  creation.  It is changeable and can be improved. The author would greatly appreciate  any  advises, new  components  and  patches  of  the  existing  programs. Commercial  usage is  also  possible  with  participation of it's author.    */
end_comment

begin_include
include|#
directive|include
file|"FtpLibrary.h"
end_include

begin_define
define|#
directive|define
name|C2I
parameter_list|(
name|n
parameter_list|)
value|((int)((n)-'0'))
end_define

begin_function
name|int
name|FtpArchie
parameter_list|(
name|char
modifier|*
name|what
parameter_list|,
name|ARCHIE
modifier|*
name|result
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|FILE
modifier|*
name|archie
decl_stmt|;
name|String
name|cmd
decl_stmt|,
name|tmp
decl_stmt|;
name|int
name|i
decl_stmt|;
name|bzero
argument_list|(
name|result
argument_list|,
sizeof|sizeof
argument_list|(
name|result
index|[
literal|0
index|]
argument_list|)
operator|*
name|len
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|cmd
argument_list|,
literal|"archie -l -m %d %s"
argument_list|,
name|len
argument_list|,
name|what
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|archie
operator|=
name|popen
argument_list|(
name|cmd
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|pp
decl_stmt|;
if|if
condition|(
name|fgets
argument_list|(
name|tmp
argument_list|,
sizeof|sizeof
argument_list|(
name|tmp
argument_list|)
argument_list|,
name|archie
argument_list|)
operator|==
name|NULL
condition|)
break|break;
name|result
index|[
name|i
index|]
operator|.
name|createtime
operator|.
name|tm_year
operator|=
name|C2I
argument_list|(
name|tmp
index|[
literal|2
index|]
argument_list|)
operator|*
literal|10
operator|-
literal|70
operator|+
name|C2I
argument_list|(
name|tmp
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|result
index|[
name|i
index|]
operator|.
name|createtime
operator|.
name|tm_mday
operator|=
name|C2I
argument_list|(
name|tmp
index|[
literal|4
index|]
argument_list|)
operator|*
literal|10
operator|+
name|C2I
argument_list|(
name|tmp
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|result
index|[
name|i
index|]
operator|.
name|createtime
operator|.
name|tm_hour
operator|=
name|C2I
argument_list|(
name|tmp
index|[
literal|6
index|]
argument_list|)
operator|*
literal|10
operator|+
name|C2I
argument_list|(
name|tmp
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|result
index|[
name|i
index|]
operator|.
name|createtime
operator|.
name|tm_min
operator|=
name|C2I
argument_list|(
name|tmp
index|[
literal|8
index|]
argument_list|)
operator|*
literal|10
operator|+
name|C2I
argument_list|(
name|tmp
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
name|result
index|[
name|i
index|]
operator|.
name|createtime
operator|.
name|tm_sec
operator|=
name|C2I
argument_list|(
name|tmp
index|[
literal|10
index|]
argument_list|)
operator|*
literal|10
operator|+
name|C2I
argument_list|(
name|tmp
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|tmp
init|;
operator|*
name|p
operator|!=
literal|' '
condition|;
name|p
operator|++
control|)
empty_stmt|;
for|for
control|(
init|;
operator|*
name|p
operator|==
literal|' '
condition|;
name|p
operator|++
control|)
empty_stmt|;
name|result
index|[
name|i
index|]
operator|.
name|size
operator|=
name|atoi
argument_list|(
name|p
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|*
name|p
operator|!=
literal|' '
condition|;
name|p
operator|++
control|)
empty_stmt|;
for|for
control|(
init|;
operator|*
name|p
operator|==
literal|' '
condition|;
name|p
operator|++
control|)
empty_stmt|;
for|for
control|(
name|pp
operator|=
name|result
index|[
name|i
index|]
operator|.
name|host
init|;
operator|*
name|p
operator|!=
literal|' '
condition|;
name|p
operator|++
operator|,
name|pp
operator|++
control|)
operator|*
name|pp
operator|=
operator|*
name|p
expr_stmt|;
operator|*
name|pp
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
operator|*
name|p
operator|==
literal|' '
condition|;
name|p
operator|++
control|)
empty_stmt|;
for|for
control|(
name|pp
operator|=
name|result
index|[
name|i
index|]
operator|.
name|file
init|;
operator|*
name|p
operator|!=
literal|'\n'
condition|;
name|p
operator|++
operator|,
name|pp
operator|++
control|)
operator|*
name|pp
operator|=
operator|*
name|p
expr_stmt|;
operator|*
name|pp
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

end_unit

