begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2003-2007 Tim Kientzle  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR(S) ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR(S) BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"test.h"
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_comment
comment|/*  * Most of these tests are system-independent, though a few depend on  * features of the local system.  Such tests are conditionalized on  * the platform name.  On unsupported platforms, only the  * system-independent features will be tested.  *  * No, I don't want to use config.h in the test files because I want  * the tests to also serve as a check on the correctness of config.h.  * A mis-configured library build should cause tests to fail.  */
end_comment

begin_macro
name|DEFINE_TEST
argument_list|(
argument|test_entry
argument_list|)
end_macro

begin_block
block|{
name|char
name|buff
index|[
literal|128
index|]
decl_stmt|;
name|wchar_t
name|wbuff
index|[
literal|128
index|]
decl_stmt|;
name|struct
name|stat
name|st
decl_stmt|;
name|struct
name|archive_entry
modifier|*
name|e
decl_stmt|,
modifier|*
name|e2
decl_stmt|;
specifier|const
name|struct
name|stat
modifier|*
name|pst
decl_stmt|;
name|unsigned
name|long
name|set
decl_stmt|,
name|clear
decl_stmt|;
comment|/* For fflag testing. */
name|int
name|type
decl_stmt|,
name|permset
decl_stmt|,
name|tag
decl_stmt|,
name|qual
decl_stmt|;
comment|/* For ACL testing. */
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
comment|/* For ACL testing. */
specifier|const
name|char
modifier|*
name|xname
decl_stmt|;
comment|/* For xattr tests. */
specifier|const
name|void
modifier|*
name|xval
decl_stmt|;
comment|/* For xattr tests. */
name|size_t
name|xsize
decl_stmt|;
comment|/* For xattr tests. */
name|int
name|c
decl_stmt|;
name|assert
argument_list|(
operator|(
name|e
operator|=
name|archive_entry_new
argument_list|()
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* 	 * Basic set/read tests for all fields. 	 * We should be able to set any field and read 	 * back the same value. 	 * 	 * For methods that "copy" a string, we should be able 	 * to overwrite the original passed-in string without 	 * changing the value in the entry. 	 * 	 * The following tests are ordered alphabetically by the 	 * name of the field. 	 */
comment|/* atime */
name|archive_entry_set_atime
argument_list|(
name|e
argument_list|,
literal|13579
argument_list|,
literal|24680
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|13579
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|24680
argument_list|)
expr_stmt|;
comment|/* ctime */
name|archive_entry_set_ctime
argument_list|(
name|e
argument_list|,
literal|13580
argument_list|,
literal|24681
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|13580
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|24681
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
comment|/* dev */
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|235
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|235
argument_list|)
expr_stmt|;
else|#
directive|else
name|skipping
argument_list|(
literal|"archive_entry_dev()"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* devmajor/devminor are tested specially below. */
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
comment|/* filetype */
name|archive_entry_set_filetype
argument_list|(
name|e
argument_list|,
name|AE_IFREG
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_filetype
argument_list|(
name|e
argument_list|)
argument_list|,
name|AE_IFREG
argument_list|)
expr_stmt|;
else|#
directive|else
name|skipping
argument_list|(
literal|"archive_entry_filetype()"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* fflags are tested specially below */
comment|/* gid */
name|archive_entry_set_gid
argument_list|(
name|e
argument_list|,
literal|204
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_gid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|204
argument_list|)
expr_stmt|;
comment|/* gname */
name|archive_entry_set_gname
argument_list|(
name|e
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_gname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
name|wcscpy
argument_list|(
name|wbuff
argument_list|,
literal|L"wgroup"
argument_list|)
expr_stmt|;
name|archive_entry_copy_gname_w
argument_list|(
name|e
argument_list|,
name|wbuff
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_gname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wgroup"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|wbuff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wbuff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_gname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wgroup"
argument_list|)
expr_stmt|;
comment|/* hardlink */
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buff
argument_list|,
literal|"hardlinkname2"
argument_list|)
expr_stmt|;
name|archive_entry_copy_hardlink
argument_list|(
name|e
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"hardlinkname2"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"hardlinkname2"
argument_list|)
expr_stmt|;
name|wcscpy
argument_list|(
name|wbuff
argument_list|,
literal|L"whardlink"
argument_list|)
expr_stmt|;
name|archive_entry_copy_hardlink_w
argument_list|(
name|e
argument_list|,
name|wbuff
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_hardlink_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"whardlink"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|wbuff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wbuff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_hardlink_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"whardlink"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
comment|/* ino */
name|archive_entry_set_ino
argument_list|(
name|e
argument_list|,
literal|8593
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ino
argument_list|(
name|e
argument_list|)
argument_list|,
literal|8593
argument_list|)
expr_stmt|;
else|#
directive|else
name|skipping
argument_list|(
literal|"archive_entry_ino()"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* link */
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|archive_entry_set_link
argument_list|(
name|e
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|archive_entry_copy_link
argument_list|(
name|e
argument_list|,
literal|"link2"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link2"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|archive_entry_copy_link_w
argument_list|(
name|e
argument_list|,
literal|L"link3"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link3"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
literal|"symlink"
argument_list|)
expr_stmt|;
name|archive_entry_set_link
argument_list|(
name|e
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|archive_entry_copy_link
argument_list|(
name|e
argument_list|,
literal|"link2"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link2"
argument_list|)
expr_stmt|;
name|archive_entry_copy_link_w
argument_list|(
name|e
argument_list|,
literal|L"link3"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link3"
argument_list|)
expr_stmt|;
comment|/* Arbitrarily override hardlink if both hardlink and symlink set. */
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
literal|"hardlink"
argument_list|)
expr_stmt|;
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
literal|"symlink"
argument_list|)
expr_stmt|;
name|archive_entry_set_link
argument_list|(
name|e
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"hardlink"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"link"
argument_list|)
expr_stmt|;
comment|/* mode */
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|0123456
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mode
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0123456
argument_list|)
expr_stmt|;
comment|/* mtime */
name|archive_entry_set_mtime
argument_list|(
name|e
argument_list|,
literal|13581
argument_list|,
literal|24682
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|13581
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|24682
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
comment|/* nlink */
name|archive_entry_set_nlink
argument_list|(
name|e
argument_list|,
literal|736
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_nlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|736
argument_list|)
expr_stmt|;
else|#
directive|else
name|skipping
argument_list|(
literal|"archive_entry_nlink()"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* pathname */
name|archive_entry_set_pathname
argument_list|(
name|e
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
name|archive_entry_set_pathname
argument_list|(
name|e
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buff
argument_list|,
literal|"path2"
argument_list|)
expr_stmt|;
name|archive_entry_copy_pathname
argument_list|(
name|e
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"path2"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"path2"
argument_list|)
expr_stmt|;
name|wcscpy
argument_list|(
name|wbuff
argument_list|,
literal|L"wpath"
argument_list|)
expr_stmt|;
name|archive_entry_copy_pathname_w
argument_list|(
name|e
argument_list|,
name|wbuff
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_pathname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wpath"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|wbuff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wbuff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_pathname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wpath"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
comment|/* rdev */
name|archive_entry_set_rdev
argument_list|(
name|e
argument_list|,
literal|532
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|532
argument_list|)
expr_stmt|;
else|#
directive|else
name|skipping
argument_list|(
literal|"archive_entry_rdev()"
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* rdevmajor/rdevminor are tested specially below. */
comment|/* size */
name|archive_entry_set_size
argument_list|(
name|e
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_size
argument_list|(
name|e
argument_list|)
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
comment|/* symlink */
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
literal|"symlinkname"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"symlinkname"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|strcpy
argument_list|(
name|buff
argument_list|,
literal|"symlinkname2"
argument_list|)
expr_stmt|;
name|archive_entry_copy_symlink
argument_list|(
name|e
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"symlinkname2"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"symlinkname2"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_copy_symlink_w
argument_list|(
name|e
argument_list|,
literal|L"wsymlink"
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_symlink_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wsymlink"
argument_list|)
expr_stmt|;
comment|/* uid */
name|archive_entry_set_uid
argument_list|(
name|e
argument_list|,
literal|83
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_uid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|83
argument_list|)
expr_stmt|;
comment|/* uname */
name|archive_entry_set_uname
argument_list|(
name|e
argument_list|,
literal|"user"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_uname
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"user"
argument_list|)
expr_stmt|;
name|wcscpy
argument_list|(
name|wbuff
argument_list|,
literal|L"wuser"
argument_list|)
expr_stmt|;
name|archive_entry_copy_gname_w
argument_list|(
name|e
argument_list|,
name|wbuff
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_gname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wuser"
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|wbuff
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wbuff
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualWString
argument_list|(
name|archive_entry_gname_w
argument_list|(
name|e
argument_list|)
argument_list|,
literal|L"wuser"
argument_list|)
expr_stmt|;
comment|/* Test fflags interface. */
name|archive_entry_set_fflags
argument_list|(
name|e
argument_list|,
literal|0x55
argument_list|,
literal|0xAA
argument_list|)
expr_stmt|;
name|archive_entry_fflags
argument_list|(
name|e
argument_list|,
operator|&
name|set
argument_list|,
operator|&
name|clear
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Testing set/get of fflags data."
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|set
argument_list|,
literal|0x55
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Testing set/get of fflags data."
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|clear
argument_list|,
literal|0xAA
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|__FreeBSD__
comment|/* Converting fflags bitmap to string is currently system-dependent. */
comment|/* TODO: Make this system-independent. */
name|assertEqualString
argument_list|(
name|archive_entry_fflags_text
argument_list|(
name|e
argument_list|)
argument_list|,
literal|"uappnd,nouchg,nodump,noopaque,uunlnk"
argument_list|)
expr_stmt|;
comment|/* TODO: Test archive_entry_copy_fflags_text_w() */
endif|#
directive|endif
comment|/* See test_acl_basic.c for tests of ACL set/get consistency. */
comment|/* Test xattrs set/get consistency. */
name|archive_entry_xattr_add_entry
argument_list|(
name|e
argument_list|,
literal|"xattr1"
argument_list|,
literal|"xattrvalue1"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_entry_xattr_reset
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
literal|"xattr1"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
literal|"xattrvalue1"
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_entry_xattr_count
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_WARN
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|archive_entry_xattr_clear
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_xattr_reset
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_WARN
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|archive_entry_xattr_add_entry
argument_list|(
name|e
argument_list|,
literal|"xattr1"
argument_list|,
literal|"xattrvalue1"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_entry_xattr_reset
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|archive_entry_xattr_add_entry
argument_list|(
name|e
argument_list|,
literal|"xattr2"
argument_list|,
literal|"xattrvalue2"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|2
argument_list|,
name|archive_entry_xattr_reset
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_WARN
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* 	 * Test clone() implementation. 	 */
comment|/* Set values in 'e' */
name|archive_entry_clear
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|archive_entry_set_atime
argument_list|(
name|e
argument_list|,
literal|13579
argument_list|,
literal|24680
argument_list|)
expr_stmt|;
name|archive_entry_set_ctime
argument_list|(
name|e
argument_list|,
literal|13580
argument_list|,
literal|24681
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|235
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_fflags
argument_list|(
name|e
argument_list|,
literal|0x55
argument_list|,
literal|0xAA
argument_list|)
expr_stmt|;
name|archive_entry_set_gid
argument_list|(
name|e
argument_list|,
literal|204
argument_list|)
expr_stmt|;
name|archive_entry_set_gname
argument_list|(
name|e
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_ino
argument_list|(
name|e
argument_list|,
literal|8593
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|0123456
argument_list|)
expr_stmt|;
name|archive_entry_set_mtime
argument_list|(
name|e
argument_list|,
literal|13581
argument_list|,
literal|24682
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_nlink
argument_list|(
name|e
argument_list|,
literal|736
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_pathname
argument_list|(
name|e
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_rdev
argument_list|(
name|e
argument_list|,
literal|532
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_size
argument_list|(
name|e
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
literal|"symlinkname"
argument_list|)
expr_stmt|;
name|archive_entry_set_uid
argument_list|(
name|e
argument_list|,
literal|83
argument_list|)
expr_stmt|;
name|archive_entry_set_uname
argument_list|(
name|e
argument_list|,
literal|"user"
argument_list|)
expr_stmt|;
comment|/* Add an ACL entry. */
name|archive_entry_acl_add_entry
argument_list|(
name|e
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
name|ARCHIVE_ENTRY_ACL_READ
argument_list|,
name|ARCHIVE_ENTRY_ACL_USER
argument_list|,
literal|77
argument_list|,
literal|"user77"
argument_list|)
expr_stmt|;
comment|/* Add an extended attribute. */
name|archive_entry_xattr_add_entry
argument_list|(
name|e
argument_list|,
literal|"xattr1"
argument_list|,
literal|"xattrvalue"
argument_list|,
literal|11
argument_list|)
expr_stmt|;
comment|/* Make a clone. */
name|e2
operator|=
name|archive_entry_clone
argument_list|(
name|e
argument_list|)
expr_stmt|;
comment|/* Clone should have same contents. */
name|assertEqualInt
argument_list|(
name|archive_entry_atime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13579
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24680
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13580
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24681
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|235
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_fflags
argument_list|(
name|e
argument_list|,
operator|&
name|set
argument_list|,
operator|&
name|clear
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|clear
argument_list|,
literal|0xAA
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|set
argument_list|,
literal|0x55
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_gid
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|204
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_gname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_ino
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|8593
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_mode
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|0123456
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13581
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24682
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_nlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|736
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|532
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_size
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"symlinkname"
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_uid
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|83
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_uname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"user"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|<
literal|1009000
name|skipping
argument_list|(
literal|"ACL preserved by archive_entry_clone()"
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* Verify ACL was copied. */
name|assertEqualInt
argument_list|(
literal|4
argument_list|,
name|c
operator|=
name|archive_entry_acl_reset
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First three are standard permission bits. */
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_USER_OBJ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_GROUP_OBJ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_OTHER
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Fourth is custom one. */
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
name|ARCHIVE_ENTRY_ACL_READ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_USER
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
literal|77
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
literal|"user77"
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|<
literal|1009000
name|skipping
argument_list|(
literal|"xattr data preserved by archive_entry_clone"
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* Verify xattr was copied. */
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|c
operator|=
name|archive_entry_xattr_reset
argument_list|(
name|e2
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e2
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
literal|"xattr1"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
literal|"xattrvalue"
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|ARCHIVE_WARN
argument_list|,
name|archive_entry_xattr_next
argument_list|(
name|e2
argument_list|,
operator|&
name|xname
argument_list|,
operator|&
name|xval
argument_list|,
operator|&
name|xsize
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xname
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|xval
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|xsize
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Change the original */
name|archive_entry_set_atime
argument_list|(
name|e
argument_list|,
literal|13580
argument_list|,
literal|24690
argument_list|)
expr_stmt|;
name|archive_entry_set_ctime
argument_list|(
name|e
argument_list|,
literal|13590
argument_list|,
literal|24691
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|245
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_fflags
argument_list|(
name|e
argument_list|,
literal|0x85
argument_list|,
literal|0xDA
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_filetype
argument_list|(
name|e
argument_list|,
name|AE_IFLNK
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_gid
argument_list|(
name|e
argument_list|,
literal|214
argument_list|)
expr_stmt|;
name|archive_entry_set_gname
argument_list|(
name|e
argument_list|,
literal|"grouper"
argument_list|)
expr_stmt|;
name|archive_entry_set_hardlink
argument_list|(
name|e
argument_list|,
literal|"hardlinkpath"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_ino
argument_list|(
name|e
argument_list|,
literal|8763
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|0123654
argument_list|)
expr_stmt|;
name|archive_entry_set_mtime
argument_list|(
name|e
argument_list|,
literal|18351
argument_list|,
literal|28642
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_nlink
argument_list|(
name|e
argument_list|,
literal|73
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_pathname
argument_list|(
name|e
argument_list|,
literal|"pathest"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_rdev
argument_list|(
name|e
argument_list|,
literal|132
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_size
argument_list|(
name|e
argument_list|,
literal|987456321
argument_list|)
expr_stmt|;
name|archive_entry_set_symlink
argument_list|(
name|e
argument_list|,
literal|"symlinkpath"
argument_list|)
expr_stmt|;
name|archive_entry_set_uid
argument_list|(
name|e
argument_list|,
literal|93
argument_list|)
expr_stmt|;
name|archive_entry_set_uname
argument_list|(
name|e
argument_list|,
literal|"username"
argument_list|)
expr_stmt|;
name|archive_entry_acl_clear
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|archive_entry_xattr_clear
argument_list|(
name|e
argument_list|)
expr_stmt|;
comment|/* Clone should still have same contents. */
name|assertEqualInt
argument_list|(
name|archive_entry_atime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13579
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24680
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13580
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24681
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|235
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_fflags
argument_list|(
name|e2
argument_list|,
operator|&
name|set
argument_list|,
operator|&
name|clear
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|clear
argument_list|,
literal|0xAA
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|set
argument_list|,
literal|0x55
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_gid
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|204
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_gname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"hardlinkname"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_ino
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|8593
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_mode
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|0123456
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|13581
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime_nsec
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|24682
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_nlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|736
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"path"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|532
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_size
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"symlinkname"
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_uid
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|83
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_uname
argument_list|(
name|e2
argument_list|)
argument_list|,
literal|"user"
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|<
literal|1009000
name|skipping
argument_list|(
literal|"ACL held by clone of archive_entry"
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* Verify ACL was unchanged. */
name|assertEqualInt
argument_list|(
literal|4
argument_list|,
name|c
operator|=
name|archive_entry_acl_reset
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
argument_list|)
expr_stmt|;
comment|/* First three are standard permission bits. */
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_USER_OBJ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_GROUP_OBJ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_OTHER
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Fourth is custom one. */
name|assertEqualInt
argument_list|(
literal|0
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
name|ARCHIVE_ENTRY_ACL_READ
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
name|ARCHIVE_ENTRY_ACL_USER
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
literal|77
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
literal|"user77"
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_entry_acl_next
argument_list|(
name|e2
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|permset
argument_list|,
operator|&
name|tag
argument_list|,
operator|&
name|qual
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|type
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|permset
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|tag
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|qual
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|<
literal|1009000
name|skipping
argument_list|(
literal|"xattr preserved in archive_entry copy"
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* Verify xattr was unchanged. */
name|assertEqualInt
argument_list|(
literal|1
argument_list|,
name|archive_entry_xattr_reset
argument_list|(
name|e2
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Release clone. */
name|archive_entry_free
argument_list|(
name|e2
argument_list|)
expr_stmt|;
comment|/* 	 * Test clear() implementation. 	 */
name|archive_entry_clear
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_atime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|archive_entry_fflags
argument_list|(
name|e
argument_list|,
operator|&
name|set
argument_list|,
operator|&
name|clear
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|clear
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|set
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_filetype
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_gid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_gname
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_hardlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ino
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mode
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_nlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualString
argument_list|(
name|archive_entry_pathname
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_size
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_symlink
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_uid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualString
argument_list|(
name|archive_entry_uname
argument_list|(
name|e
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* ACLs should be cleared. */
name|assertEqualInt
argument_list|(
name|archive_entry_acl_count
argument_list|(
name|e
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_ACCESS
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_acl_count
argument_list|(
name|e
argument_list|,
name|ARCHIVE_ENTRY_ACL_TYPE_DEFAULT
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Extended attributes should be cleared. */
name|assertEqualInt
argument_list|(
name|archive_entry_xattr_count
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* 	 * Test archive_entry_copy_stat(). 	 */
name|memset
argument_list|(
operator|&
name|st
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Set all of the standard 'struct stat' fields. */
name|st
operator|.
name|st_atime
operator|=
literal|456789
expr_stmt|;
name|st
operator|.
name|st_ctime
operator|=
literal|345678
expr_stmt|;
name|st
operator|.
name|st_dev
operator|=
literal|123
expr_stmt|;
name|st
operator|.
name|st_gid
operator|=
literal|34
expr_stmt|;
name|st
operator|.
name|st_ino
operator|=
literal|234
expr_stmt|;
name|st
operator|.
name|st_mode
operator|=
literal|077777
expr_stmt|;
name|st
operator|.
name|st_mtime
operator|=
literal|234567
expr_stmt|;
name|st
operator|.
name|st_nlink
operator|=
literal|345
expr_stmt|;
name|st
operator|.
name|st_size
operator|=
literal|123456789
expr_stmt|;
name|st
operator|.
name|st_uid
operator|=
literal|23
expr_stmt|;
ifdef|#
directive|ifdef
name|__FreeBSD__
comment|/* On FreeBSD, high-res timestamp data should come through. */
name|st
operator|.
name|st_atimespec
operator|.
name|tv_nsec
operator|=
literal|6543210
expr_stmt|;
name|st
operator|.
name|st_ctimespec
operator|.
name|tv_nsec
operator|=
literal|5432109
expr_stmt|;
name|st
operator|.
name|st_mtimespec
operator|.
name|tv_nsec
operator|=
literal|3210987
expr_stmt|;
endif|#
directive|endif
comment|/* Copy them into the entry. */
name|archive_entry_copy_stat
argument_list|(
name|e
argument_list|,
operator|&
name|st
argument_list|)
expr_stmt|;
comment|/* Read each one back separately and compare. */
name|assertEqualInt
argument_list|(
name|archive_entry_atime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|456789
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|345678
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|123
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_gid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|34
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ino
argument_list|(
name|e
argument_list|)
argument_list|,
literal|234
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mode
argument_list|(
name|e
argument_list|)
argument_list|,
literal|077777
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime
argument_list|(
name|e
argument_list|)
argument_list|,
literal|234567
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|archive_entry_nlink
argument_list|(
name|e
argument_list|)
argument_list|,
literal|345
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|archive_entry_size
argument_list|(
name|e
argument_list|)
argument_list|,
literal|123456789
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_uid
argument_list|(
name|e
argument_list|)
argument_list|,
literal|23
argument_list|)
expr_stmt|;
if|#
directive|if
name|__FreeBSD__
comment|/* On FreeBSD, high-res timestamp data should come through. */
name|assertEqualInt
argument_list|(
name|archive_entry_atime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|6543210
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_ctime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|5432109
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_mtime_nsec
argument_list|(
name|e
argument_list|)
argument_list|,
literal|3210987
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* 	 * Test archive_entry_stat(). 	 */
comment|/* First, clear out any existing stat data. */
name|memset
argument_list|(
operator|&
name|st
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
expr_stmt|;
name|archive_entry_copy_stat
argument_list|(
name|e
argument_list|,
operator|&
name|st
argument_list|)
expr_stmt|;
comment|/* Set a bunch of fields individually. */
name|archive_entry_set_atime
argument_list|(
name|e
argument_list|,
literal|456789
argument_list|,
literal|321
argument_list|)
expr_stmt|;
name|archive_entry_set_ctime
argument_list|(
name|e
argument_list|,
literal|345678
argument_list|,
literal|432
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|123
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_gid
argument_list|(
name|e
argument_list|,
literal|34
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_ino
argument_list|(
name|e
argument_list|,
literal|234
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|012345
argument_list|)
expr_stmt|;
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|012345
argument_list|)
expr_stmt|;
name|archive_entry_set_mtime
argument_list|(
name|e
argument_list|,
literal|234567
argument_list|,
literal|543
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_nlink
argument_list|(
name|e
argument_list|,
literal|345
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_size
argument_list|(
name|e
argument_list|,
literal|123456789
argument_list|)
expr_stmt|;
name|archive_entry_set_uid
argument_list|(
name|e
argument_list|,
literal|23
argument_list|)
expr_stmt|;
comment|/* Retrieve a stat structure. */
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Check that the values match. */
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_atime
argument_list|,
literal|456789
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_ctime
argument_list|,
literal|345678
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_dev
argument_list|,
literal|123
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_gid
argument_list|,
literal|34
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_ino
argument_list|,
literal|234
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_mode
argument_list|,
literal|012345
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_mtime
argument_list|,
literal|234567
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_nlink
argument_list|,
literal|345
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_size
argument_list|,
literal|123456789
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_uid
argument_list|,
literal|23
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|__FreeBSD__
comment|/* On FreeBSD, high-res timestamp data should come through. */
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_atimespec
operator|.
name|tv_nsec
argument_list|,
literal|321
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_ctimespec
operator|.
name|tv_nsec
argument_list|,
literal|432
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_mtimespec
operator|.
name|tv_nsec
argument_list|,
literal|543
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Changing any one value should update struct stat. */
name|archive_entry_set_atime
argument_list|(
name|e
argument_list|,
literal|456788
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_atime
argument_list|,
literal|456788
argument_list|)
expr_stmt|;
name|archive_entry_set_ctime
argument_list|(
name|e
argument_list|,
literal|345677
argument_list|,
literal|431
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_ctime
argument_list|,
literal|345677
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|122
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_dev
argument_list|,
literal|122
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_gid
argument_list|(
name|e
argument_list|,
literal|33
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_gid
argument_list|,
literal|33
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_ino
argument_list|(
name|e
argument_list|,
literal|233
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_ino
argument_list|,
literal|233
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_mode
argument_list|(
name|e
argument_list|,
literal|012344
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_mode
argument_list|,
literal|012344
argument_list|)
expr_stmt|;
name|archive_entry_set_mtime
argument_list|(
name|e
argument_list|,
literal|234566
argument_list|,
literal|542
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_mtime
argument_list|,
literal|234566
argument_list|)
expr_stmt|;
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_nlink
argument_list|(
name|e
argument_list|,
literal|344
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_nlink
argument_list|,
literal|344
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|archive_entry_set_size
argument_list|(
name|e
argument_list|,
literal|123456788
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_size
argument_list|,
literal|123456788
argument_list|)
expr_stmt|;
name|archive_entry_set_uid
argument_list|(
name|e
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|assert
argument_list|(
operator|(
name|pst
operator|=
name|archive_entry_stat
argument_list|(
name|e
argument_list|)
operator|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|pst
operator|->
name|st_uid
argument_list|,
literal|22
argument_list|)
expr_stmt|;
comment|/* We don't need to check high-res fields here. */
comment|/* 	 * Test dev/major/minor interfaces.  Setting 'dev' or 'rdev' 	 * should change the corresponding major/minor values, and 	 * vice versa. 	 * 	 * The test here is system-specific because it assumes that 	 * makedev(), major(), and minor() are defined in sys/stat.h. 	 * I'm not too worried about it, though, because the code is 	 * simple.  If it works on FreeBSD, it's unlikely to be broken 	 * anywhere else.  Note: The functionality is present on every 	 * platform even if these tests only run some places; 	 * libarchive's more extensive configuration logic should find 	 * the necessary definitions on every platform. 	 */
if|#
directive|if
name|__FreeBSD__
if|#
directive|if
name|ARCHIVE_VERSION_STAMP
operator|>=
literal|1009000
name|archive_entry_set_dev
argument_list|(
name|e
argument_list|,
literal|0x12345678
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_devmajor
argument_list|(
name|e
argument_list|)
argument_list|,
name|major
argument_list|(
literal|0x12345678
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_devminor
argument_list|(
name|e
argument_list|)
argument_list|,
name|minor
argument_list|(
literal|0x12345678
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0x12345678
argument_list|)
expr_stmt|;
name|archive_entry_set_devmajor
argument_list|(
name|e
argument_list|,
literal|0xfe
argument_list|)
expr_stmt|;
name|archive_entry_set_devminor
argument_list|(
name|e
argument_list|,
literal|0xdcba98
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_devmajor
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0xfe
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_devminor
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0xdcba98
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_dev
argument_list|(
name|e
argument_list|)
argument_list|,
name|makedev
argument_list|(
literal|0xfe
argument_list|,
literal|0xdcba98
argument_list|)
argument_list|)
expr_stmt|;
name|archive_entry_set_rdev
argument_list|(
name|e
argument_list|,
literal|0x12345678
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdevmajor
argument_list|(
name|e
argument_list|)
argument_list|,
name|major
argument_list|(
literal|0x12345678
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdevminor
argument_list|(
name|e
argument_list|)
argument_list|,
name|minor
argument_list|(
literal|0x12345678
argument_list|)
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0x12345678
argument_list|)
expr_stmt|;
name|archive_entry_set_rdevmajor
argument_list|(
name|e
argument_list|,
literal|0xfe
argument_list|)
expr_stmt|;
name|archive_entry_set_rdevminor
argument_list|(
name|e
argument_list|,
literal|0xdcba98
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdevmajor
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0xfe
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdevminor
argument_list|(
name|e
argument_list|)
argument_list|,
literal|0xdcba98
argument_list|)
expr_stmt|;
name|assertEqualInt
argument_list|(
name|archive_entry_rdev
argument_list|(
name|e
argument_list|)
argument_list|,
name|makedev
argument_list|(
literal|0xfe
argument_list|,
literal|0xdcba98
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
comment|/* 	 * Exercise the character-conversion logic, if we can. 	 */
name|failure
argument_list|(
literal|"Can't exercise charset-conversion logic."
argument_list|)
expr_stmt|;
if|if
condition|(
name|assert
argument_list|(
name|NULL
operator|!=
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|"de_DE.UTF-8"
argument_list|)
argument_list|)
condition|)
block|{
comment|/* A filename that cannot be converted to wide characters. */
name|archive_entry_copy_pathname
argument_list|(
name|e
argument_list|,
literal|"abc\314\214mno\374xyz"
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Converting invalid chars to Unicode should fail."
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|NULL
operator|==
name|archive_entry_pathname_w
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
comment|//failure("Converting invalid chars to UTF-8 should fail.");
comment|//assert(NULL == archive_entry_pathname_utf8(e));
comment|/* A group name that cannot be converted. */
name|archive_entry_copy_gname
argument_list|(
name|e
argument_list|,
literal|"abc\314\214mno\374xyz"
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Converting invalid chars to Unicode should fail."
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|NULL
operator|==
name|archive_entry_gname_w
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
comment|/* A user name that cannot be converted. */
name|archive_entry_copy_uname
argument_list|(
name|e
argument_list|,
literal|"abc\314\214mno\374xyz"
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Converting invalid chars to Unicode should fail."
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|NULL
operator|==
name|archive_entry_uname_w
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
comment|/* A hardlink target that cannot be converted. */
name|archive_entry_copy_hardlink
argument_list|(
name|e
argument_list|,
literal|"abc\314\214mno\374xyz"
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Converting invalid chars to Unicode should fail."
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|NULL
operator|==
name|archive_entry_hardlink_w
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
comment|/* A symlink target that cannot be converted. */
name|archive_entry_copy_symlink
argument_list|(
name|e
argument_list|,
literal|"abc\314\214mno\374xyz"
argument_list|)
expr_stmt|;
name|failure
argument_list|(
literal|"Converting invalid chars to Unicode should fail."
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|NULL
operator|==
name|archive_entry_symlink_w
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Release the experimental entry. */
name|archive_entry_free
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

