begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*   * battle.c - original author: Bruce Holloway  *		mods by: Chuck A DeGaul  */
end_comment

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<ncurses.h>
end_include

begin_define
define|#
directive|define
name|OTHER
value|1-turn
end_define

begin_decl_stmt
name|char
name|numbers
index|[]
init|=
literal|"   0  1  2  3  4  5  6  7  8  9"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|carrier
index|[]
init|=
literal|"Aircraft Carrier"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|battle
index|[]
init|=
literal|"Battleship"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|sub
index|[]
init|=
literal|"Submarine"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|destroy
index|[]
init|=
literal|"Destroyer"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ptboat
index|[]
init|=
literal|"PT Boat"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|name
index|[
literal|40
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|dftname
index|[]
init|=
literal|"Stranger"
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|_ships
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|char
name|symbol
decl_stmt|;
name|char
name|length
decl_stmt|;
name|char
name|start
decl_stmt|;
comment|/* Coordinates - 0,0=0; 10,10=100. */
name|char
name|dir
decl_stmt|;
comment|/* Direction - 0 = right; 1 = down. */
name|char
name|hits
decl_stmt|;
comment|/* How many times has this ship been hit? (-1==sunk) */
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|_ships
name|plyship
index|[]
init|=
block|{
block|{
name|carrier
block|,
literal|'A'
block|,
literal|5
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|battle
block|,
literal|'B'
block|,
literal|4
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|destroy
block|,
literal|'D'
block|,
literal|3
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|sub
block|,
literal|'S'
block|,
literal|3
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|ptboat
block|,
literal|'P'
block|,
literal|2
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|_ships
name|cpuship
index|[]
init|=
block|{
block|{
name|carrier
block|,
literal|'A'
block|,
literal|5
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|battle
block|,
literal|'B'
block|,
literal|4
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|destroy
block|,
literal|'D'
block|,
literal|3
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|sub
block|,
literal|'S'
block|,
literal|3
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|ptboat
block|,
literal|'P'
block|,
literal|2
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|hits
index|[
literal|2
index|]
index|[
literal|100
index|]
decl_stmt|,
name|board
index|[
literal|2
index|]
index|[
literal|100
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* "Hits" board, and main board. */
end_comment

begin_decl_stmt
name|int
name|srchstep
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|cpuhits
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|cstart
decl_stmt|,
name|cdir
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|plywon
init|=
literal|0
decl_stmt|,
name|cpuwon
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* How many games has each won? */
end_comment

begin_decl_stmt
name|int
name|turn
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0=player, 1=computer */
end_comment

begin_decl_stmt
name|int
name|huntoffs
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Offset on search strategy */
end_comment

begin_decl_stmt
name|int
name|salvo
decl_stmt|,
name|blitz
decl_stmt|,
name|ask
decl_stmt|,
name|seemiss
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* options */
end_comment

begin_function_decl
name|void
name|intro
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|initgame
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|rnd
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|plyplace
parameter_list|(
name|struct
name|_ships
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|getdir
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|placeship
parameter_list|(
name|struct
name|_ships
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|checkplace
parameter_list|(
name|struct
name|_ships
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|error
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|prompt
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
name|getcoord
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|cpuplace
parameter_list|(
name|struct
name|_ships
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|awinna
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|plyturn
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|hitship
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|cputurn
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|playagain
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|uninitgame
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|int
name|sgetc
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|do_options
parameter_list|(
name|int
parameter_list|,
name|char
modifier|*
index|[]
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|scount
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|do_options
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
name|intro
argument_list|()
expr_stmt|;
do|do
block|{
name|initgame
argument_list|()
expr_stmt|;
while|while
condition|(
name|awinna
argument_list|()
operator|==
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|blitz
condition|)
block|{
if|if
condition|(
operator|!
name|salvo
condition|)
block|{
if|if
condition|(
name|turn
condition|)
name|cputurn
argument_list|()
expr_stmt|;
else|else
name|plyturn
argument_list|()
expr_stmt|;
block|}
else|else
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|i
operator|=
name|scount
argument_list|(
name|turn
argument_list|)
expr_stmt|;
while|while
condition|(
name|i
operator|--
condition|)
block|{
if|if
condition|(
name|turn
condition|)
if|if
condition|(
name|cputurn
argument_list|()
condition|)
if|if
condition|(
name|awinna
argument_list|()
operator|!=
operator|-
literal|1
condition|)
name|i
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|plyturn
argument_list|()
condition|)
if|if
condition|(
name|awinna
argument_list|()
operator|!=
operator|-
literal|1
condition|)
name|i
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
while|while
condition|(
operator|(
name|turn
operator|)
condition|?
name|cputurn
argument_list|()
else|:
name|plyturn
argument_list|()
condition|)
empty_stmt|;
block|}
name|turn
operator|=
name|OTHER
expr_stmt|;
block|}
block|}
do|while
condition|(
name|playagain
argument_list|()
condition|)
do|;
name|uninitgame
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|PR
value|addstr
end_define

begin_function
name|void
name|intro
parameter_list|()
block|{
name|char
modifier|*
name|tmpname
decl_stmt|;
name|srand
argument_list|(
name|time
argument_list|(
literal|0L
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Kick the random number generator */
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|uninitgame
argument_list|)
expr_stmt|;
if|if
condition|(
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
operator|!=
name|SIG_IGN
condition|)
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|uninitgame
argument_list|)
expr_stmt|;
if|#
directive|if
literal|1
comment|/* for some bizzare reason, getlogin or cuserid cause havoc with the terminal */
if|if
condition|(
operator|(
name|tmpname
operator|=
name|getlogin
argument_list|()
operator|)
operator|!=
name|NULL
condition|)
block|{
name|strcpy
argument_list|(
name|name
argument_list|,
name|tmpname
argument_list|)
expr_stmt|;
block|}
else|else
endif|#
directive|endif
name|strcpy
argument_list|(
name|name
argument_list|,
name|dftname
argument_list|)
expr_stmt|;
name|name
index|[
literal|0
index|]
operator|=
name|toupper
argument_list|(
name|name
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|initscr
argument_list|()
expr_stmt|;
name|savetty
argument_list|()
expr_stmt|;
name|nonl
argument_list|()
expr_stmt|;
name|cbreak
argument_list|()
expr_stmt|;
name|noecho
argument_list|()
expr_stmt|;
name|clear
argument_list|()
expr_stmt|;
name|mvaddstr
argument_list|(
literal|4
argument_list|,
literal|29
argument_list|,
literal|"Welcome to Battleship!"
argument_list|)
expr_stmt|;
name|move
argument_list|(
literal|8
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                                                  \\\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                           \\                     \\ \\\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                          \\ \\                   \\ \\ \\_____________\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                         \\ \\ \\_____________      \\ \\/            |\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                          \\ \\/             \\      \\/             |\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"                           \\/               \\_____/              |__\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"           ________________/                                       |\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"           \\  S.S. Penguin                                         |\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"            \\                                                     /\n"
argument_list|)
expr_stmt|;
name|PR
argument_list|(
literal|"             \\___________________________________________________/\n"
argument_list|)
expr_stmt|;
name|mvaddstr
argument_list|(
literal|20
argument_list|,
literal|27
argument_list|,
literal|"Hit any key to continue..."
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
name|getch
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|initgame
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
name|clear
argument_list|()
expr_stmt|;
name|mvaddstr
argument_list|(
literal|0
argument_list|,
literal|35
argument_list|,
literal|"BATTLESHIP"
argument_list|)
expr_stmt|;
name|mvaddstr
argument_list|(
literal|4
argument_list|,
literal|12
argument_list|,
literal|"Main Board"
argument_list|)
expr_stmt|;
name|mvaddstr
argument_list|(
literal|6
argument_list|,
literal|0
argument_list|,
name|numbers
argument_list|)
expr_stmt|;
name|move
argument_list|(
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|printw
argument_list|(
literal|"%c  .  .  .  .  .  .  .  .  .  .  %c\n"
argument_list|,
name|i
operator|+
literal|'A'
argument_list|,
name|i
operator|+
literal|'A'
argument_list|)
expr_stmt|;
block|}
name|mvaddstr
argument_list|(
literal|17
argument_list|,
literal|0
argument_list|,
name|numbers
argument_list|)
expr_stmt|;
name|mvaddstr
argument_list|(
literal|4
argument_list|,
literal|55
argument_list|,
literal|"Hit/Miss Board"
argument_list|)
expr_stmt|;
name|mvaddstr
argument_list|(
literal|6
argument_list|,
literal|45
argument_list|,
name|numbers
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|mvprintw
argument_list|(
literal|7
operator|+
name|i
argument_list|,
literal|45
argument_list|,
literal|"%c  .  .  .  .  .  .  .  .  .  .  %c"
argument_list|,
name|i
operator|+
literal|'A'
argument_list|,
name|i
operator|+
literal|'A'
argument_list|)
expr_stmt|;
block|}
name|mvaddstr
argument_list|(
literal|17
argument_list|,
literal|45
argument_list|,
name|numbers
argument_list|)
expr_stmt|;
for|for
control|(
name|turn
operator|=
literal|0
init|;
name|turn
operator|<
literal|2
condition|;
operator|++
name|turn
control|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|hits
index|[
name|turn
index|]
index|[
name|i
index|]
operator|=
name|board
index|[
name|turn
index|]
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
for|for
control|(
name|turn
operator|=
literal|0
init|;
name|turn
operator|<
literal|2
condition|;
operator|++
name|turn
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
if|if
condition|(
operator|!
name|turn
condition|)
name|plyplace
argument_list|(
operator|&
name|plyship
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|cpuplace
argument_list|(
operator|&
name|cpuship
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|turn
operator|=
name|rnd
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cstart
operator|=
name|cdir
operator|=
operator|-
literal|1
expr_stmt|;
name|cpuhits
operator|=
literal|0
expr_stmt|;
name|srchstep
operator|=
literal|3
expr_stmt|;
name|huntoffs
operator|=
name|rnd
argument_list|(
name|srchstep
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|rnd
parameter_list|(
name|int
name|n
parameter_list|)
block|{
return|return
operator|(
operator|(
operator|(
name|rand
argument_list|()
operator|&
literal|0x7FFF
operator|)
operator|%
name|n
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|void
name|plyplace
parameter_list|(
name|ss
parameter_list|)
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
block|{
name|int
name|c
decl_stmt|,
name|d
decl_stmt|;
do|do
block|{
name|prompt
argument_list|()
expr_stmt|;
name|printw
argument_list|(
literal|"Place your %s (ex.%c%d) ? "
argument_list|,
name|ss
operator|->
name|name
argument_list|,
name|rnd
argument_list|(
literal|10
argument_list|)
operator|+
literal|'A'
argument_list|,
name|rnd
argument_list|(
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|c
operator|=
name|getcoord
argument_list|()
expr_stmt|;
name|d
operator|=
name|getdir
argument_list|()
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|checkplace
argument_list|(
name|ss
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
condition|)
do|;
name|placeship
argument_list|(
name|ss
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|getdir
parameter_list|()
block|{
name|prompt
argument_list|()
expr_stmt|;
name|addstr
argument_list|(
literal|"What direction (0=right, 1=down) ? "
argument_list|)
expr_stmt|;
return|return
operator|(
name|sgetc
argument_list|(
literal|"01"
argument_list|)
operator|-
literal|'0'
operator|)
return|;
block|}
end_function

begin_function
name|void
name|placeship
parameter_list|(
name|ss
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
name|int
name|c
decl_stmt|,
name|d
decl_stmt|;
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|l
decl_stmt|,
name|i
decl_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|ss
operator|->
name|length
condition|;
operator|++
name|l
control|)
block|{
name|i
operator|=
name|c
operator|+
name|l
operator|*
operator|(
operator|(
name|d
operator|)
condition|?
literal|10
else|:
literal|1
operator|)
expr_stmt|;
name|board
index|[
name|turn
index|]
index|[
name|i
index|]
operator|=
name|ss
operator|->
name|symbol
expr_stmt|;
name|x
operator|=
operator|(
name|i
operator|%
literal|10
operator|)
operator|*
literal|3
operator|+
literal|3
expr_stmt|;
name|y
operator|=
operator|(
name|i
operator|/
literal|10
operator|)
operator|+
literal|7
expr_stmt|;
if|if
condition|(
operator|!
name|turn
condition|)
name|mvaddch
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
name|ss
operator|->
name|symbol
argument_list|)
expr_stmt|;
block|}
name|ss
operator|->
name|start
operator|=
name|c
expr_stmt|;
name|ss
operator|->
name|dir
operator|=
name|d
expr_stmt|;
name|ss
operator|->
name|hits
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|int
name|checkplace
parameter_list|(
name|ss
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|)
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
name|int
name|c
decl_stmt|,
name|d
decl_stmt|;
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|l
decl_stmt|;
name|x
operator|=
name|c
operator|%
literal|10
expr_stmt|;
name|y
operator|=
name|c
operator|/
literal|10
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|x
operator|+
name|ss
operator|->
name|length
operator|)
operator|>
literal|10
operator|&&
operator|!
name|d
operator|)
operator|||
operator|(
operator|(
name|y
operator|+
name|ss
operator|->
name|length
operator|)
operator|>
literal|10
operator|&&
name|d
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|turn
condition|)
switch|switch
condition|(
name|rnd
argument_list|(
literal|3
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|error
argument_list|(
literal|"Ship is hanging from the edge of the world"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|error
argument_list|(
literal|"Try fitting it on the board"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|error
argument_list|(
literal|"Figure I won't find it if you put it there?"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|ss
operator|->
name|length
condition|;
operator|++
name|l
control|)
block|{
name|x
operator|=
name|c
operator|+
name|l
operator|*
operator|(
operator|(
name|d
operator|)
condition|?
literal|10
else|:
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|board
index|[
name|turn
index|]
index|[
name|x
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|turn
condition|)
switch|switch
condition|(
name|rnd
argument_list|(
literal|3
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|error
argument_list|(
literal|"There's already a ship there"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|error
argument_list|(
literal|"Collision alert! Aaaaaagh!"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|error
argument_list|(
literal|"Er, Admiral, what about the other ship?"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|error
parameter_list|(
name|s
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|prompt
argument_list|()
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|printw
argument_list|(
literal|"%s -- hit any key to continue --"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
name|getch
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|prompt
parameter_list|()
block|{
name|move
argument_list|(
literal|22
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|clrtoeol
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|char
name|getcoord
parameter_list|()
block|{
name|int
name|ch
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
name|redo
label|:
name|y
operator|=
name|sgetc
argument_list|(
literal|"ABCDEFGHIJ"
argument_list|)
expr_stmt|;
do|do
block|{
name|ch
operator|=
name|getch
argument_list|()
expr_stmt|;
if|if
condition|(
name|ch
operator|==
literal|0x7F
operator|||
name|ch
operator|==
literal|8
condition|)
block|{
name|addstr
argument_list|(
literal|"\b \b"
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
goto|goto
name|redo
goto|;
block|}
block|}
do|while
condition|(
name|ch
operator|<
literal|'0'
operator|||
name|ch
operator|>
literal|'9'
condition|)
do|;
name|addch
argument_list|(
name|x
operator|=
name|ch
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
return|return
operator|(
operator|(
name|y
operator|-
literal|'A'
operator|)
operator|*
literal|10
operator|+
name|x
operator|-
literal|'0'
operator|)
return|;
block|}
end_function

begin_function
name|void
name|cpuplace
parameter_list|(
name|ss
parameter_list|)
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
block|{
name|int
name|c
decl_stmt|,
name|d
decl_stmt|;
do|do
block|{
name|c
operator|=
name|rnd
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|d
operator|=
name|rnd
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|checkplace
argument_list|(
name|ss
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
condition|)
do|;
name|placeship
argument_list|(
name|ss
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|awinna
parameter_list|()
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|ss
operator|=
operator|(
name|i
operator|)
condition|?
name|cpuship
else|:
name|plyship
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|5
condition|;
operator|++
name|j
operator|,
operator|++
name|ss
control|)
if|if
condition|(
name|ss
operator|->
name|length
operator|!=
name|ss
operator|->
name|hits
condition|)
break|break;
if|if
condition|(
name|j
operator|==
literal|5
condition|)
return|return
operator|(
name|OTHER
operator|)
return|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|int
name|plyturn
parameter_list|()
block|{
name|int
name|c
decl_stmt|,
name|res
decl_stmt|;
name|char
modifier|*
name|m
decl_stmt|;
name|prompt
argument_list|()
expr_stmt|;
name|addstr
argument_list|(
literal|"Where do you want to shoot? "
argument_list|)
expr_stmt|;
name|c
operator|=
name|getcoord
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|res
operator|=
name|hits
index|[
name|turn
index|]
index|[
name|c
index|]
operator|)
condition|)
block|{
name|hits
index|[
name|turn
index|]
index|[
name|c
index|]
operator|=
name|res
operator|=
operator|(
name|board
index|[
name|OTHER
index|]
index|[
name|c
index|]
operator|)
condition|?
literal|'H'
else|:
literal|'M'
expr_stmt|;
name|mvaddch
argument_list|(
literal|7
operator|+
name|c
operator|/
literal|10
argument_list|,
literal|48
operator|+
literal|3
operator|*
operator|(
name|c
operator|%
literal|10
operator|)
argument_list|,
operator|(
name|res
operator|==
literal|'H'
operator|)
condition|?
literal|'H'
else|:
literal|'o'
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|=
name|hitship
argument_list|(
name|c
argument_list|)
condition|)
block|{
name|prompt
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|rnd
argument_list|(
literal|3
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|m
operator|=
literal|"You sank my %s!"
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|m
operator|=
literal|"I have this sinking feeling about my %s...."
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|m
operator|=
literal|"Have some mercy for my %s!"
expr_stmt|;
break|break;
block|}
name|move
argument_list|(
literal|23
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|clrtoeol
argument_list|()
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|printw
argument_list|(
name|m
argument_list|,
name|cpuship
index|[
name|c
operator|-
literal|1
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
return|return
operator|(
name|awinna
argument_list|()
operator|==
operator|-
literal|1
operator|)
return|;
block|}
block|}
name|prompt
argument_list|()
expr_stmt|;
name|move
argument_list|(
literal|23
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|clrtoeol
argument_list|()
expr_stmt|;
name|printw
argument_list|(
literal|"You %s."
argument_list|,
operator|(
name|res
operator|==
literal|'M'
operator|)
condition|?
literal|"missed"
else|:
literal|"scored a hit"
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
return|return
operator|(
name|res
operator|==
literal|'H'
operator|)
return|;
block|}
end_function

begin_function
name|int
name|hitship
parameter_list|(
name|c
parameter_list|)
name|int
name|c
decl_stmt|;
block|{
name|struct
name|_ships
modifier|*
name|ss
decl_stmt|;
name|int
name|sym
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|;
name|ss
operator|=
operator|(
name|turn
operator|)
condition|?
name|plyship
else|:
name|cpuship
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|sym
operator|=
name|board
index|[
name|OTHER
index|]
index|[
name|c
index|]
operator|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
operator|,
operator|++
name|ss
control|)
if|if
condition|(
name|ss
operator|->
name|symbol
operator|==
name|sym
condition|)
block|{
name|j
operator|=
name|ss
operator|->
name|hits
expr_stmt|;
operator|++
name|j
expr_stmt|;
name|ss
operator|->
name|hits
operator|=
name|j
expr_stmt|;
if|if
condition|(
name|j
operator|==
name|ss
operator|->
name|length
condition|)
return|return
operator|(
name|i
operator|+
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
end_function

begin_function
name|int
name|cputurn
parameter_list|()
block|{
name|int
name|c
decl_stmt|,
name|res
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|,
name|i
decl_stmt|,
name|d
decl_stmt|;
name|redo
label|:
if|if
condition|(
name|cstart
operator|==
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|cpuhits
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|c
operator|=
name|rnd
argument_list|(
literal|100
argument_list|)
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
operator|,
name|c
operator|=
operator|(
name|c
operator|+
literal|1
operator|)
operator|%
literal|100
control|)
if|if
condition|(
name|hits
index|[
name|turn
index|]
index|[
name|c
index|]
operator|==
literal|'H'
condition|)
break|break;
if|if
condition|(
name|i
operator|!=
literal|100
condition|)
block|{
name|cstart
operator|=
name|c
expr_stmt|;
name|cdir
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|fndir
goto|;
block|}
block|}
do|do
block|{
name|i
operator|=
literal|0
expr_stmt|;
do|do
block|{
while|while
condition|(
name|hits
index|[
name|turn
index|]
index|[
name|c
operator|=
name|rnd
argument_list|(
literal|100
argument_list|)
index|]
condition|)
empty_stmt|;
name|x
operator|=
name|c
operator|%
literal|10
expr_stmt|;
name|y
operator|=
name|c
operator|/
literal|10
expr_stmt|;
if|if
condition|(
operator|++
name|i
operator|==
literal|1000
condition|)
break|break;
block|}
do|while
condition|(
operator|(
operator|(
name|x
operator|+
name|huntoffs
operator|)
operator|%
name|srchstep
operator|)
operator|!=
operator|(
name|y
operator|%
name|srchstep
operator|)
condition|)
do|;
if|if
condition|(
name|i
operator|==
literal|1000
condition|)
operator|--
name|srchstep
expr_stmt|;
block|}
do|while
condition|(
name|i
operator|==
literal|1000
condition|)
do|;
block|}
elseif|else
if|if
condition|(
name|cdir
operator|==
operator|-
literal|1
condition|)
block|{
name|fndir
label|:
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|d
operator|=
name|rnd
argument_list|(
literal|4
argument_list|)
init|;
name|i
operator|++
operator|<
literal|4
condition|;
name|d
operator|=
operator|(
name|d
operator|+
literal|1
operator|)
operator|%
literal|4
control|)
block|{
name|x
operator|=
name|cstart
operator|%
literal|10
expr_stmt|;
name|y
operator|=
name|cstart
operator|/
literal|10
expr_stmt|;
switch|switch
condition|(
name|d
condition|)
block|{
case|case
literal|0
case|:
operator|++
name|x
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|++
name|y
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|--
name|x
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|--
name|y
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>
literal|9
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>
literal|9
condition|)
continue|continue;
if|if
condition|(
name|hits
index|[
name|turn
index|]
index|[
name|c
operator|=
name|y
operator|*
literal|10
operator|+
name|x
index|]
condition|)
continue|continue;
name|cdir
operator|=
operator|-
literal|2
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|i
operator|==
literal|4
condition|)
block|{
name|cstart
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|redo
goto|;
block|}
block|}
else|else
block|{
name|x
operator|=
name|cstart
operator|%
literal|10
expr_stmt|;
name|y
operator|=
name|cstart
operator|/
literal|10
expr_stmt|;
switch|switch
condition|(
name|cdir
condition|)
block|{
case|case
literal|0
case|:
operator|++
name|x
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|++
name|y
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|--
name|x
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|--
name|y
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>
literal|9
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>
literal|9
operator|||
name|hits
index|[
name|turn
index|]
index|[
name|y
operator|*
literal|10
operator|+
name|x
index|]
condition|)
block|{
name|cdir
operator|=
operator|(
name|cdir
operator|+
literal|2
operator|)
operator|%
literal|4
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
switch|switch
condition|(
name|cdir
condition|)
block|{
case|case
literal|0
case|:
operator|++
name|x
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|++
name|y
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|--
name|x
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|--
name|y
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>
literal|9
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>
literal|9
condition|)
block|{
name|cstart
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|redo
goto|;
block|}
if|if
condition|(
operator|!
name|hits
index|[
name|turn
index|]
index|[
name|y
operator|*
literal|10
operator|+
name|x
index|]
condition|)
break|break;
block|}
block|}
name|c
operator|=
name|y
operator|*
literal|10
operator|+
name|x
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ask
condition|)
block|{
name|res
operator|=
operator|(
name|board
index|[
name|OTHER
index|]
index|[
name|c
index|]
operator|)
condition|?
literal|'H'
else|:
literal|'M'
expr_stmt|;
name|move
argument_list|(
literal|21
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|clrtoeol
argument_list|()
expr_stmt|;
name|printw
argument_list|(
literal|"I shoot at %c%d. I %s!"
argument_list|,
name|c
operator|/
literal|10
operator|+
literal|'A'
argument_list|,
name|c
operator|%
literal|10
argument_list|,
operator|(
name|res
operator|==
literal|'H'
operator|)
condition|?
literal|"hit"
else|:
literal|"miss"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
init|;
condition|;
control|)
block|{
name|prompt
argument_list|()
expr_stmt|;
name|printw
argument_list|(
literal|"I shoot at %c%d. Do I (H)it or (M)iss? "
argument_list|,
name|c
operator|/
literal|10
operator|+
literal|'A'
argument_list|,
name|c
operator|%
literal|10
argument_list|)
expr_stmt|;
name|res
operator|=
name|sgetc
argument_list|(
literal|"HM"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|res
operator|==
literal|'H'
operator|&&
operator|!
name|board
index|[
name|OTHER
index|]
index|[
name|c
index|]
operator|)
operator|||
operator|(
name|res
operator|==
literal|'M'
operator|&&
name|board
index|[
name|OTHER
index|]
index|[
name|c
index|]
operator|)
condition|)
block|{
name|error
argument_list|(
literal|"You lie!"
argument_list|)
expr_stmt|;
continue|continue;
block|}
break|break;
block|}
name|addch
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
name|hits
index|[
name|turn
index|]
index|[
name|c
index|]
operator|=
name|res
expr_stmt|;
if|if
condition|(
name|res
operator|==
literal|'H'
condition|)
block|{
operator|++
name|cpuhits
expr_stmt|;
if|if
condition|(
name|cstart
operator|==
operator|-
literal|1
condition|)
name|cdir
operator|=
operator|-
literal|1
expr_stmt|;
name|cstart
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|cdir
operator|==
operator|-
literal|2
condition|)
name|cdir
operator|=
name|d
expr_stmt|;
name|mvaddch
argument_list|(
literal|7
operator|+
operator|(
name|c
operator|/
literal|10
operator|)
argument_list|,
literal|3
operator|+
literal|3
operator|*
operator|(
name|c
operator|%
literal|10
operator|)
argument_list|,
literal|'*'
argument_list|)
expr_stmt|;
if|if
condition|(
name|blitz
operator|&&
operator|!
name|ask
condition|)
block|{
name|refresh
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|seemiss
condition|)
block|{
name|mvaddch
argument_list|(
literal|7
operator|+
operator|(
name|c
operator|/
literal|10
operator|)
argument_list|,
literal|3
operator|+
literal|3
operator|*
operator|(
name|c
operator|%
literal|10
operator|)
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|cdir
operator|==
operator|-
literal|2
condition|)
name|cdir
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|c
operator|=
name|hitship
argument_list|(
name|c
argument_list|)
condition|)
block|{
name|cstart
operator|=
operator|-
literal|1
expr_stmt|;
name|cpuhits
operator|-=
name|plyship
index|[
name|c
operator|-
literal|1
index|]
operator|.
name|length
expr_stmt|;
name|x
operator|=
name|plyship
index|[
name|c
operator|-
literal|1
index|]
operator|.
name|start
expr_stmt|;
name|d
operator|=
name|plyship
index|[
name|c
operator|-
literal|1
index|]
operator|.
name|dir
expr_stmt|;
name|y
operator|=
name|plyship
index|[
name|c
operator|-
literal|1
index|]
operator|.
name|length
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|y
condition|;
operator|++
name|i
control|)
block|{
name|hits
index|[
name|turn
index|]
index|[
name|x
index|]
operator|=
literal|'*'
expr_stmt|;
name|x
operator|+=
operator|(
name|d
operator|)
condition|?
literal|10
else|:
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|salvo
operator|&&
operator|!
name|ask
condition|)
block|{
name|refresh
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|awinna
argument_list|()
operator|!=
operator|-
literal|1
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
name|res
operator|==
literal|'H'
operator|)
return|;
block|}
end_function

begin_function
name|int
name|playagain
parameter_list|()
block|{
name|int
name|i
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
block|{
name|x
operator|=
name|cpuship
index|[
name|i
index|]
operator|.
name|start
expr_stmt|;
name|y
operator|=
name|x
operator|/
literal|10
operator|+
literal|7
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|%
literal|10
operator|)
operator|*
literal|3
operator|+
literal|48
expr_stmt|;
name|dx
operator|=
operator|(
name|cpuship
index|[
name|i
index|]
operator|.
name|dir
operator|)
condition|?
literal|0
else|:
literal|3
expr_stmt|;
name|dy
operator|=
operator|(
name|cpuship
index|[
name|i
index|]
operator|.
name|dir
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|cpuship
index|[
name|i
index|]
operator|.
name|length
condition|;
operator|++
name|j
control|)
block|{
name|mvaddch
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
name|cpuship
index|[
name|i
index|]
operator|.
name|symbol
argument_list|)
expr_stmt|;
name|x
operator|+=
name|dx
expr_stmt|;
name|y
operator|+=
name|dy
expr_stmt|;
block|}
block|}
if|if
condition|(
name|awinna
argument_list|()
condition|)
operator|++
name|cpuwon
expr_stmt|;
else|else
operator|++
name|plywon
expr_stmt|;
name|i
operator|=
literal|18
operator|+
name|strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|plywon
operator|>=
literal|10
condition|)
operator|++
name|i
expr_stmt|;
if|if
condition|(
name|cpuwon
operator|>=
literal|10
condition|)
operator|++
name|i
expr_stmt|;
name|mvprintw
argument_list|(
literal|2
argument_list|,
operator|(
literal|80
operator|-
name|i
operator|)
operator|/
literal|2
argument_list|,
literal|"%s: %d     Computer: %d"
argument_list|,
name|name
argument_list|,
name|plywon
argument_list|,
name|cpuwon
argument_list|)
expr_stmt|;
name|prompt
argument_list|()
expr_stmt|;
name|printw
argument_list|(
operator|(
name|awinna
argument_list|()
operator|)
condition|?
literal|"Want to be humiliated again, %s? "
else|:
literal|"Going to give me a chance for revenge, %s? "
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
operator|(
name|sgetc
argument_list|(
literal|"YN"
argument_list|)
operator|==
literal|'Y'
operator|)
return|;
block|}
end_function

begin_function
name|void
name|uninitgame
parameter_list|(
name|int
name|sig
parameter_list|)
block|{
name|refresh
argument_list|()
expr_stmt|;
name|endwin
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|sgetc
parameter_list|(
name|s
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|char
modifier|*
name|s1
decl_stmt|;
name|int
name|ch
decl_stmt|;
name|refresh
argument_list|()
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|ch
operator|=
name|toupper
argument_list|(
name|getch
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|s1
operator|=
name|s
init|;
operator|*
name|s1
operator|&&
name|ch
operator|!=
operator|*
name|s1
condition|;
operator|++
name|s1
control|)
empty_stmt|;
if|if
condition|(
operator|*
name|s1
condition|)
block|{
name|addch
argument_list|(
name|ch
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
return|return
operator|(
name|ch
operator|)
return|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*   * I should use getopts() from libc.a, but I'm leary that other UNIX  * systems might not have it, although I'd love to use it.  */
end_comment

begin_function
name|int
name|do_options
parameter_list|(
name|c
parameter_list|,
name|op
parameter_list|)
name|int
name|c
decl_stmt|;
name|char
modifier|*
name|op
index|[]
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|c
operator|>
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|c
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|op
index|[
name|i
index|]
index|[
literal|0
index|]
condition|)
block|{
default|default:
case|case
literal|'?'
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: battle [ -s | -b ] [ -a ] [ -m ]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\tWhere the options are:\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-s : play a salvo game (mutex with -b)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-b : play a blitz game (mutex with -s)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-a : computer asks you for hit/miss\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-m : computer misses are displayed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'-'
case|:
switch|switch
condition|(
name|op
index|[
name|i
index|]
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'b'
case|:
name|blitz
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|salvo
operator|==
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Bad Arg: -b and -s are mutually exclusive\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'s'
case|:
name|salvo
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|blitz
operator|==
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Bad Arg: -s and -b are mutually exclusive\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'a'
case|:
name|ask
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|seemiss
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Bad Arg: type \"%s ?\" for usage message\n"
argument_list|,
name|op
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Playing optional game ("
argument_list|)
expr_stmt|;
if|if
condition|(
name|salvo
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"salvo, noblitz, "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|blitz
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"blitz, nosalvo, "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"noblitz, nosalvo, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ask
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ask, "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"noask, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|seemiss
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"seemiss)\n"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"noseemiss)\n"
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Playing standard game (no blitz, no slavo, no ask, no seemiss)\n"
argument_list|)
expr_stmt|;
name|sleep
argument_list|(
literal|2
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|scount
parameter_list|(
name|who
parameter_list|)
name|int
name|who
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|shots
decl_stmt|;
name|struct
name|_ships
modifier|*
name|sp
decl_stmt|;
if|if
condition|(
name|who
condition|)
block|{
comment|/* count cpu shots */
name|sp
operator|=
name|cpuship
expr_stmt|;
block|}
else|else
block|{
comment|/* count player shots */
name|sp
operator|=
name|plyship
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|shots
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
operator|,
name|sp
operator|++
control|)
block|{
comment|/* extra test for machines with unsigned chars! */
if|if
condition|(
name|sp
operator|->
name|hits
operator|==
operator|(
name|char
operator|)
operator|-
literal|1
operator|||
name|sp
operator|->
name|hits
operator|>=
name|sp
operator|->
name|length
condition|)
block|{
continue|continue;
comment|/* dead ship */
block|}
else|else
block|{
name|shots
operator|++
expr_stmt|;
block|}
block|}
return|return
operator|(
name|shots
operator|)
return|;
block|}
end_function

end_unit

