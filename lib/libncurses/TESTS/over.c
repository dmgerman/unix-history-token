begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*********************************************************************  * [program]   overwrite() - Play with overwrite() function to       *  *             attempt pop-up windows.                               *  * ----------------------------------------------------------------- *  * [written]   1-Feb-1993 by Neal Ensor (ensor@cs.utk.edu)           *  * ----------------------------------------------------------------- *  * [notes]     Originally written on SVR4 UNIX, then recompiled on   *  *             Linux (Slackware 1.1.1, ncurses 1.8.1)                *  * ----------------------------------------------------------------- *  * [problem]   On ncurses, the overwrite() function doesn't seem to  *  *             overwrite.  Maybe I'm missing something, but this     *  *             program in SVR4 displays three windows, waits for a   *  *             keypress, then removes the top window.  With ncurses, *  *             nothing changes on the display.                       *  *********************************************************************/
end_comment

begin_include
include|#
directive|include
file|<ncurses.h>
end_include

begin_comment
comment|/* ncurses include lives here */
end_comment

begin_function
name|main
parameter_list|()
block|{
comment|/****************************************************************      * Declare three little window pointers...                      *      ****************************************************************/
name|WINDOW
modifier|*
name|win
decl_stmt|,
modifier|*
name|win1
decl_stmt|,
modifier|*
name|win2
decl_stmt|;
comment|/****************************************************************      * Set up the screen...                                         *      ****************************************************************/
name|initscr
argument_list|()
expr_stmt|;
comment|/* traceon(); */
name|noecho
argument_list|()
expr_stmt|;
name|nonl
argument_list|()
expr_stmt|;
name|cbreak
argument_list|()
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
comment|/****************************************************************      * Draw three overlapping windows.                              *      ****************************************************************/
name|win
operator|=
name|newwin
argument_list|(
literal|6
argument_list|,
literal|45
argument_list|,
literal|6
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|win1
operator|=
name|newwin
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|win2
operator|=
name|newwin
argument_list|(
literal|10
argument_list|,
literal|30
argument_list|,
literal|7
argument_list|,
literal|7
argument_list|)
expr_stmt|;
comment|/****************************************************************      * Box them, and print a hidden message...                      *      ****************************************************************/
name|box
argument_list|(
name|win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|box
argument_list|(
name|win1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|box
argument_list|(
name|win2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mvwprintw
argument_list|(
name|win1
argument_list|,
literal|6
argument_list|,
literal|6
argument_list|,
literal|"Hey!"
argument_list|)
expr_stmt|;
name|mvwaddch
argument_list|(
name|win
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
name|mvwaddch
argument_list|(
name|win1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|'1'
argument_list|)
expr_stmt|;
name|mvwaddch
argument_list|(
name|win2
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|'2'
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|doupdate
argument_list|()
expr_stmt|;
comment|/****************************************************************      * Await a keypress to show what we've done so far.             *      ****************************************************************/
name|getch
argument_list|()
expr_stmt|;
comment|/****************************************************************      * Now, overwrite win2 with contents of all lower windows IN    *      * ORDER from the stdscr up...                                  *      ****************************************************************/
if|if
condition|(
name|overwrite
argument_list|(
name|stdscr
argument_list|,
name|win2
argument_list|)
operator|==
name|ERR
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"overwrite(stdscr, win2) failed!\n"
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|doupdate
argument_list|()
expr_stmt|;
name|getch
argument_list|()
expr_stmt|;
if|if
condition|(
name|overwrite
argument_list|(
name|win
argument_list|,
name|win2
argument_list|)
operator|==
name|ERR
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"overwrite(win, win2) failed!\n"
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|doupdate
argument_list|()
expr_stmt|;
name|getch
argument_list|()
expr_stmt|;
if|if
condition|(
name|overwrite
argument_list|(
name|win1
argument_list|,
name|win2
argument_list|)
operator|==
name|ERR
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"overwrite(win1, win2) failed!\n"
argument_list|)
expr_stmt|;
comment|/****************************************************************      * Perform touches, and hidden refreshes on each window.        *      * ------------------------------------------------------------ *      * NOTE:  If you replace the wnoutrefresh() call with wrefresh()*      * you can see all windows being redrawn untouched.             *      ****************************************************************/
name|touchwin
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win1
argument_list|)
expr_stmt|;
name|touchwin
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|win2
argument_list|)
expr_stmt|;
name|doupdate
argument_list|()
expr_stmt|;
comment|/****************************************************************      * At this point, win2 should be "destroyed"; having all other  *      * window contents overwritten onto it.  The doupdate() should  *      * effectively remove it from the screen, leaving the others    *      * untouched.  On SVR4, this happens, but not with ncurses.     *      * I'd suspect something in overwrite() causes this, as nothing *      * appears to be overwritten after the calls, with no errors    *      * being reported.  This was compiled on my Linux from Slackware*      * 1.1.1, with ncurses1.8.1 recompiled on it, using the console *      * entry from the "new" terminfo from ncurses1.8.1.             *      ****************************************************************/
name|getch
argument_list|()
expr_stmt|;
comment|/****************************************************************      * Clean up our act and exit.                                   *      ****************************************************************/
name|endwin
argument_list|()
expr_stmt|;
block|}
end_function

end_unit

