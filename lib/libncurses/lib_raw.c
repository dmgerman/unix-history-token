begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* This work is copyrighted. See COPYRIGHT.OLD& COPYRIGHT.NEW for   * *  details. If they are missing then this copy is in violation of    * *  the copyright conditions.                                        */
end_comment

begin_comment
comment|/*  *	raw.c  *  *	Routines:  *		raw()  *		echo()  *		nl()  *		cbreak()  *		noraw()  *		noecho()  *		nonl()  *		nocbreak()  *  */
end_comment

begin_include
include|#
directive|include
file|"curses.priv.h"
end_include

begin_include
include|#
directive|include
file|"terminfo.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|TERMIOS
end_ifdef

begin_decl_stmt
specifier|static
name|tcflag_t
name|iexten
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|raw
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"raw() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_raw
operator|=
name|TRUE
expr_stmt|;
name|SP
operator|->
name|_cbreak
operator|=
name|TRUE
expr_stmt|;
name|SP
operator|->
name|_nlmapping
operator|=
name|TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
if|if
condition|(
name|iexten
operator|==
literal|0
condition|)
name|iexten
operator|=
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator|&
name|IEXTEN
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator|&=
operator|~
operator|(
name|ICANON
operator||
name|ISIG
operator||
name|iexten
operator|)
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_iflag
operator|&=
operator|~
operator|(
name|INPCK
operator||
name|ISTRIP
operator||
name|IXON
operator|)
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_oflag
operator|&=
operator|~
operator|(
name|OPOST
operator|)
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_cc
index|[
name|VMIN
index|]
operator|=
literal|1
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_cc
index|[
name|VTIME
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator||=
name|RAW
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|cbreak
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"cbreak() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_cbreak
operator|=
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator|&=
operator|~
name|ICANON
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator||=
name|ISIG
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_cc
index|[
name|VMIN
index|]
operator|=
literal|1
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_cc
index|[
name|VTIME
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator||=
name|CBREAK
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|echo
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"echo() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_echo
operator|=
name|TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator||=
name|ECHO
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator||=
name|ECHO
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|nl
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"nl() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_nl
operator|=
name|TRUE
expr_stmt|;
name|SP
operator|->
name|_nlmapping
operator|=
operator|!
name|SP
operator|->
name|_raw
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_iflag
operator||=
name|IXON
operator||
name|ICRNL
operator||
name|IXOFF
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_oflag
operator||=
name|OPOST
operator||
name|ONLCR
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator||=
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|noraw
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"noraw() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_raw
operator|=
name|FALSE
expr_stmt|;
name|SP
operator|->
name|_cbreak
operator|=
name|FALSE
expr_stmt|;
name|SP
operator|->
name|_nlmapping
operator|=
name|SP
operator|->
name|_nl
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator||=
name|ISIG
operator||
name|ICANON
operator||
name|iexten
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_iflag
operator||=
name|IXON
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_oflag
operator||=
name|OPOST
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|RAW
operator||
name|CBREAK
operator|)
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|nocbreak
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"nocbreak() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_cbreak
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator||=
name|ICANON
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator|&=
operator|~
name|CBREAK
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|noecho
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"noecho() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_echo
operator|=
name|FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_lflag
operator|&=
operator|~
operator|(
name|ECHO
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator|&=
operator|~
name|ECHO
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

begin_function
name|int
name|nonl
parameter_list|()
block|{
name|T
argument_list|(
operator|(
literal|"nonl() called"
operator|)
argument_list|)
expr_stmt|;
name|SP
operator|->
name|_nl
operator|=
name|SP
operator|->
name|_nlmapping
operator|=
name|FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|TERMIOS
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_iflag
operator|&=
operator|~
name|ICRNL
expr_stmt|;
name|cur_term
operator|->
name|Nttyb
operator|.
name|c_oflag
operator|&=
operator|~
name|ONLCR
expr_stmt|;
if|if
condition|(
operator|(
name|tcsetattr
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
name|TCSANOW
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
return|return
name|ERR
return|;
else|else
return|return
name|OK
return|;
else|#
directive|else
name|cur_term
operator|->
name|Nttyb
operator|.
name|sg_flags
operator|&=
operator|~
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
name|cur_term
operator|->
name|Filedes
argument_list|,
operator|&
name|cur_term
operator|->
name|Nttyb
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
endif|#
directive|endif
block|}
end_function

end_unit

