begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* s_erff.c -- float version of s_erf.c.  * Conversion to float by Ian Lance Taylor, Cygnus Support, ian@cygnus.com.  */
end_comment

begin_comment
comment|/*  * ====================================================  * Copyright (C) 1993 by Sun Microsystems, Inc. All rights reserved.  *  * Developed at SunPro, a Sun Microsystems, Inc. business.  * Permission to use, copy, modify, and distribute this  * software is freely granted, provided that this notice  * is preserved.  * ====================================================  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"math.h"
end_include

begin_include
include|#
directive|include
file|"math_private.h"
end_include

begin_comment
comment|/* XXX Prevent compilers from erroneously constant folding: */
end_comment

begin_decl_stmt
specifier|static
specifier|const
specifier|volatile
name|float
name|tiny
init|=
literal|1e-30
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|float
name|half
init|=
literal|0.5
decl_stmt|,
name|one
init|=
literal|1
decl_stmt|,
name|two
init|=
literal|2
decl_stmt|,
name|erx
init|=
literal|8.42697144e-01
decl_stmt|,
comment|/* 0x3f57bb00 */
comment|/*  * In the domain [0, 2**-14], only the first term in the power series  * expansion of erf(x) is used.  The magnitude of the first neglected  * terms is less than 2**-42.  */
name|efx
init|=
literal|1.2837916613e-01
decl_stmt|,
comment|/* 0x3e0375d4 */
name|efx8
init|=
literal|1.0270333290e+00
decl_stmt|,
comment|/* 0x3f8375d4 */
comment|/*  *  Domain [0, 0.84375], range ~[-5.4446e-10,5.5197e-10]:  *  |(erf(x) - x)/x - p(x)/q(x)|< 2**-31.  */
name|pp0
init|=
literal|1.28379166e-01F
decl_stmt|,
comment|/*  0x1.06eba8p-3 */
name|pp1
init|=
operator|-
literal|3.36030394e-01F
decl_stmt|,
comment|/* -0x1.58185ap-2 */
name|pp2
init|=
operator|-
literal|1.86260219e-03F
decl_stmt|,
comment|/* -0x1.e8451ep-10 */
name|qq1
init|=
literal|3.12324286e-01F
decl_stmt|,
comment|/*  0x1.3fd1f0p-2 */
name|qq2
init|=
literal|2.16070302e-02F
decl_stmt|,
comment|/*  0x1.620274p-6 */
name|qq3
init|=
operator|-
literal|1.98859419e-03F
decl_stmt|,
comment|/* -0x1.04a626p-9 */
comment|/*  * Domain [0.84375, 1.25], range ~[-1.953e-11,1.940e-11]:  * |(erf(x) - erx) - p(x)/q(x)|< 2**-36.  */
name|pa0
init|=
literal|3.64939137e-06F
decl_stmt|,
comment|/*  0x1.e9d022p-19 */
name|pa1
init|=
literal|4.15109694e-01F
decl_stmt|,
comment|/*  0x1.a91284p-2 */
name|pa2
init|=
operator|-
literal|1.65179938e-01F
decl_stmt|,
comment|/* -0x1.5249dcp-3 */
name|pa3
init|=
literal|1.10914491e-01F
decl_stmt|,
comment|/*  0x1.c64e46p-4 */
name|qa1
init|=
literal|6.02074385e-01F
decl_stmt|,
comment|/*  0x1.344318p-1 */
name|qa2
init|=
literal|5.35934687e-01F
decl_stmt|,
comment|/*  0x1.126608p-1 */
name|qa3
init|=
literal|1.68576106e-01F
decl_stmt|,
comment|/*  0x1.593e6ep-3 */
name|qa4
init|=
literal|5.62181212e-02F
decl_stmt|,
comment|/*  0x1.cc89f2p-5 */
comment|/*  * Domain [1.25,1/0.35], range ~[-7.043e-10,7.457e-10]:  * |log(x*erfc(x)) + x**2 + 0.5625 - r(x)/s(x)|< 2**-30  */
name|ra0
init|=
operator|-
literal|9.87132732e-03F
decl_stmt|,
comment|/* -0x1.4376b2p-7 */
name|ra1
init|=
operator|-
literal|5.53605914e-01F
decl_stmt|,
comment|/* -0x1.1b723cp-1 */
name|ra2
init|=
operator|-
literal|2.17589188e+00F
decl_stmt|,
comment|/* -0x1.1683a0p+1 */
name|ra3
init|=
operator|-
literal|1.43268085e+00F
decl_stmt|,
comment|/* -0x1.6ec42cp+0 */
name|sa1
init|=
literal|5.45995426e+00F
decl_stmt|,
comment|/*  0x1.5d6fe4p+2 */
name|sa2
init|=
literal|6.69798088e+00F
decl_stmt|,
comment|/*  0x1.acabb8p+2 */
name|sa3
init|=
literal|1.43113089e+00F
decl_stmt|,
comment|/*  0x1.6e5e98p+0 */
name|sa4
init|=
operator|-
literal|5.77397496e-02F
decl_stmt|,
comment|/* -0x1.d90108p-5 */
comment|/*  * Domain [1/0.35, 11], range ~[-2.264e-13,2.336e-13]:  * |log(x*erfc(x)) + x**2 + 0.5625 - r(x)/s(x)|< 2**-42  */
name|rb0
init|=
operator|-
literal|9.86494310e-03F
decl_stmt|,
comment|/* -0x1.434124p-7 */
name|rb1
init|=
operator|-
literal|6.25171244e-01F
decl_stmt|,
comment|/* -0x1.401672p-1 */
name|rb2
init|=
operator|-
literal|6.16498327e+00F
decl_stmt|,
comment|/* -0x1.8a8f16p+2 */
name|rb3
init|=
operator|-
literal|1.66696873e+01F
decl_stmt|,
comment|/* -0x1.0ab70ap+4 */
name|rb4
init|=
operator|-
literal|9.53764343e+00F
decl_stmt|,
comment|/* -0x1.313460p+3 */
name|sb1
init|=
literal|1.26884899e+01F
decl_stmt|,
comment|/*  0x1.96081cp+3 */
name|sb2
init|=
literal|4.51839523e+01F
decl_stmt|,
comment|/*  0x1.6978bcp+5 */
name|sb3
init|=
literal|4.72810211e+01F
decl_stmt|,
comment|/*  0x1.7a3f88p+5 */
name|sb4
init|=
literal|8.93033314e+00F
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  0x1.1dc54ap+3 */
end_comment

begin_function
name|float
name|erff
parameter_list|(
name|float
name|x
parameter_list|)
block|{
name|int32_t
name|hx
decl_stmt|,
name|ix
decl_stmt|,
name|i
decl_stmt|;
name|float
name|R
decl_stmt|,
name|S
decl_stmt|,
name|P
decl_stmt|,
name|Q
decl_stmt|,
name|s
decl_stmt|,
name|y
decl_stmt|,
name|z
decl_stmt|,
name|r
decl_stmt|;
name|GET_FLOAT_WORD
argument_list|(
name|hx
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|ix
operator|=
name|hx
operator|&
literal|0x7fffffff
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0x7f800000
condition|)
block|{
comment|/* erf(nan)=nan */
name|i
operator|=
operator|(
operator|(
name|u_int32_t
operator|)
name|hx
operator|>>
literal|31
operator|)
operator|<<
literal|1
expr_stmt|;
return|return
call|(
name|float
call|)
argument_list|(
literal|1
operator|-
name|i
argument_list|)
operator|+
name|one
operator|/
name|x
return|;
comment|/* erf(+-inf)=+-1 */
block|}
if|if
condition|(
name|ix
operator|<
literal|0x3f580000
condition|)
block|{
comment|/* |x|<0.84375 */
if|if
condition|(
name|ix
operator|<
literal|0x38800000
condition|)
block|{
comment|/* |x|<2**-14 */
if|if
condition|(
name|ix
operator|<
literal|0x04000000
condition|)
comment|/* |x|<0x1p-119 */
return|return
operator|(
literal|8
operator|*
name|x
operator|+
name|efx8
operator|*
name|x
operator|)
operator|/
literal|8
return|;
comment|/* avoid spurious underflow */
return|return
name|x
operator|+
name|efx
operator|*
name|x
return|;
block|}
name|z
operator|=
name|x
operator|*
name|x
expr_stmt|;
name|r
operator|=
name|pp0
operator|+
name|z
operator|*
operator|(
name|pp1
operator|+
name|z
operator|*
name|pp2
operator|)
expr_stmt|;
name|s
operator|=
name|one
operator|+
name|z
operator|*
operator|(
name|qq1
operator|+
name|z
operator|*
operator|(
name|qq2
operator|+
name|z
operator|*
name|qq3
operator|)
operator|)
expr_stmt|;
name|y
operator|=
name|r
operator|/
name|s
expr_stmt|;
return|return
name|x
operator|+
name|x
operator|*
name|y
return|;
block|}
if|if
condition|(
name|ix
operator|<
literal|0x3fa00000
condition|)
block|{
comment|/* 0.84375<= |x|< 1.25 */
name|s
operator|=
name|fabsf
argument_list|(
name|x
argument_list|)
operator|-
name|one
expr_stmt|;
name|P
operator|=
name|pa0
operator|+
name|s
operator|*
operator|(
name|pa1
operator|+
name|s
operator|*
operator|(
name|pa2
operator|+
name|s
operator|*
name|pa3
operator|)
operator|)
expr_stmt|;
name|Q
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|qa1
operator|+
name|s
operator|*
operator|(
name|qa2
operator|+
name|s
operator|*
operator|(
name|qa3
operator|+
name|s
operator|*
name|qa4
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|hx
operator|>=
literal|0
condition|)
return|return
name|erx
operator|+
name|P
operator|/
name|Q
return|;
else|else
return|return
operator|-
name|erx
operator|-
name|P
operator|/
name|Q
return|;
block|}
if|if
condition|(
name|ix
operator|>=
literal|0x40800000
condition|)
block|{
comment|/* inf>|x|>=4 */
if|if
condition|(
name|hx
operator|>=
literal|0
condition|)
return|return
name|one
operator|-
name|tiny
return|;
else|else
return|return
name|tiny
operator|-
name|one
return|;
block|}
name|x
operator|=
name|fabsf
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|s
operator|=
name|one
operator|/
operator|(
name|x
operator|*
name|x
operator|)
expr_stmt|;
if|if
condition|(
name|ix
operator|<
literal|0x4036DB6E
condition|)
block|{
comment|/* |x|< 1/0.35 */
name|R
operator|=
name|ra0
operator|+
name|s
operator|*
operator|(
name|ra1
operator|+
name|s
operator|*
operator|(
name|ra2
operator|+
name|s
operator|*
name|ra3
operator|)
operator|)
expr_stmt|;
name|S
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|sa1
operator|+
name|s
operator|*
operator|(
name|sa2
operator|+
name|s
operator|*
operator|(
name|sa3
operator|+
name|s
operator|*
name|sa4
operator|)
operator|)
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* |x|>= 1/0.35 */
name|R
operator|=
name|rb0
operator|+
name|s
operator|*
operator|(
name|rb1
operator|+
name|s
operator|*
operator|(
name|rb2
operator|+
name|s
operator|*
operator|(
name|rb3
operator|+
name|s
operator|*
name|rb4
operator|)
operator|)
operator|)
expr_stmt|;
name|S
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|sb1
operator|+
name|s
operator|*
operator|(
name|sb2
operator|+
name|s
operator|*
operator|(
name|sb3
operator|+
name|s
operator|*
name|sb4
operator|)
operator|)
operator|)
expr_stmt|;
block|}
name|SET_FLOAT_WORD
argument_list|(
name|z
argument_list|,
name|hx
operator|&
literal|0xffffe000
argument_list|)
expr_stmt|;
name|r
operator|=
name|expf
argument_list|(
operator|-
name|z
operator|*
name|z
operator|-
literal|0.5625F
argument_list|)
operator|*
name|expf
argument_list|(
operator|(
name|z
operator|-
name|x
operator|)
operator|*
operator|(
name|z
operator|+
name|x
operator|)
operator|+
name|R
operator|/
name|S
argument_list|)
expr_stmt|;
if|if
condition|(
name|hx
operator|>=
literal|0
condition|)
return|return
name|one
operator|-
name|r
operator|/
name|x
return|;
else|else
return|return
name|r
operator|/
name|x
operator|-
name|one
return|;
block|}
end_function

begin_function
name|float
name|erfcf
parameter_list|(
name|float
name|x
parameter_list|)
block|{
name|int32_t
name|hx
decl_stmt|,
name|ix
decl_stmt|;
name|float
name|R
decl_stmt|,
name|S
decl_stmt|,
name|P
decl_stmt|,
name|Q
decl_stmt|,
name|s
decl_stmt|,
name|y
decl_stmt|,
name|z
decl_stmt|,
name|r
decl_stmt|;
name|GET_FLOAT_WORD
argument_list|(
name|hx
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|ix
operator|=
name|hx
operator|&
literal|0x7fffffff
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0x7f800000
condition|)
block|{
comment|/* erfc(nan)=nan */
comment|/* erfc(+-inf)=0,2 */
return|return
call|(
name|float
call|)
argument_list|(
operator|(
operator|(
name|u_int32_t
operator|)
name|hx
operator|>>
literal|31
operator|)
operator|<<
literal|1
argument_list|)
operator|+
name|one
operator|/
name|x
return|;
block|}
if|if
condition|(
name|ix
operator|<
literal|0x3f580000
condition|)
block|{
comment|/* |x|<0.84375 */
if|if
condition|(
name|ix
operator|<
literal|0x33800000
condition|)
comment|/* |x|<2**-24 */
return|return
name|one
operator|-
name|x
return|;
name|z
operator|=
name|x
operator|*
name|x
expr_stmt|;
name|r
operator|=
name|pp0
operator|+
name|z
operator|*
operator|(
name|pp1
operator|+
name|z
operator|*
name|pp2
operator|)
expr_stmt|;
name|s
operator|=
name|one
operator|+
name|z
operator|*
operator|(
name|qq1
operator|+
name|z
operator|*
operator|(
name|qq2
operator|+
name|z
operator|*
name|qq3
operator|)
operator|)
expr_stmt|;
name|y
operator|=
name|r
operator|/
name|s
expr_stmt|;
if|if
condition|(
name|hx
operator|<
literal|0x3e800000
condition|)
block|{
comment|/* x<1/4 */
return|return
name|one
operator|-
operator|(
name|x
operator|+
name|x
operator|*
name|y
operator|)
return|;
block|}
else|else
block|{
name|r
operator|=
name|x
operator|*
name|y
expr_stmt|;
name|r
operator|+=
operator|(
name|x
operator|-
name|half
operator|)
expr_stmt|;
return|return
name|half
operator|-
name|r
return|;
block|}
block|}
if|if
condition|(
name|ix
operator|<
literal|0x3fa00000
condition|)
block|{
comment|/* 0.84375<= |x|< 1.25 */
name|s
operator|=
name|fabsf
argument_list|(
name|x
argument_list|)
operator|-
name|one
expr_stmt|;
name|P
operator|=
name|pa0
operator|+
name|s
operator|*
operator|(
name|pa1
operator|+
name|s
operator|*
operator|(
name|pa2
operator|+
name|s
operator|*
name|pa3
operator|)
operator|)
expr_stmt|;
name|Q
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|qa1
operator|+
name|s
operator|*
operator|(
name|qa2
operator|+
name|s
operator|*
operator|(
name|qa3
operator|+
name|s
operator|*
name|qa4
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|hx
operator|>=
literal|0
condition|)
block|{
name|z
operator|=
name|one
operator|-
name|erx
expr_stmt|;
return|return
name|z
operator|-
name|P
operator|/
name|Q
return|;
block|}
else|else
block|{
name|z
operator|=
name|erx
operator|+
name|P
operator|/
name|Q
expr_stmt|;
return|return
name|one
operator|+
name|z
return|;
block|}
block|}
if|if
condition|(
name|ix
operator|<
literal|0x41300000
condition|)
block|{
comment|/* |x|<11 */
name|x
operator|=
name|fabsf
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|s
operator|=
name|one
operator|/
operator|(
name|x
operator|*
name|x
operator|)
expr_stmt|;
if|if
condition|(
name|ix
operator|<
literal|0x4036DB6D
condition|)
block|{
comment|/* |x|< 1/.35 ~ 2.857143*/
name|R
operator|=
name|ra0
operator|+
name|s
operator|*
operator|(
name|ra1
operator|+
name|s
operator|*
operator|(
name|ra2
operator|+
name|s
operator|*
name|ra3
operator|)
operator|)
expr_stmt|;
name|S
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|sa1
operator|+
name|s
operator|*
operator|(
name|sa2
operator|+
name|s
operator|*
operator|(
name|sa3
operator|+
name|s
operator|*
name|sa4
operator|)
operator|)
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* |x|>= 1/.35 ~ 2.857143 */
if|if
condition|(
name|hx
operator|<
literal|0
operator|&&
name|ix
operator|>=
literal|0x40a00000
condition|)
return|return
name|two
operator|-
name|tiny
return|;
comment|/* x< -5 */
name|R
operator|=
name|rb0
operator|+
name|s
operator|*
operator|(
name|rb1
operator|+
name|s
operator|*
operator|(
name|rb2
operator|+
name|s
operator|*
operator|(
name|rb3
operator|+
name|s
operator|*
name|rb4
operator|)
operator|)
operator|)
expr_stmt|;
name|S
operator|=
name|one
operator|+
name|s
operator|*
operator|(
name|sb1
operator|+
name|s
operator|*
operator|(
name|sb2
operator|+
name|s
operator|*
operator|(
name|sb3
operator|+
name|s
operator|*
name|sb4
operator|)
operator|)
operator|)
expr_stmt|;
block|}
name|SET_FLOAT_WORD
argument_list|(
name|z
argument_list|,
name|hx
operator|&
literal|0xffffe000
argument_list|)
expr_stmt|;
name|r
operator|=
name|expf
argument_list|(
operator|-
name|z
operator|*
name|z
operator|-
literal|0.5625F
argument_list|)
operator|*
name|expf
argument_list|(
operator|(
name|z
operator|-
name|x
operator|)
operator|*
operator|(
name|z
operator|+
name|x
operator|)
operator|+
name|R
operator|/
name|S
argument_list|)
expr_stmt|;
if|if
condition|(
name|hx
operator|>
literal|0
condition|)
return|return
name|r
operator|/
name|x
return|;
else|else
return|return
name|two
operator|-
name|r
operator|/
name|x
return|;
block|}
else|else
block|{
if|if
condition|(
name|hx
operator|>
literal|0
condition|)
return|return
name|tiny
operator|*
name|tiny
return|;
else|else
return|return
name|two
operator|-
name|tiny
return|;
block|}
block|}
end_function

end_unit

