begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* e_lgammaf_r.c -- float version of e_lgamma_r.c.  * Conversion to float by Ian Lance Taylor, Cygnus Support, ian@cygnus.com.  * Conversion to float fixed By Steven G. Kargl.  */
end_comment

begin_comment
comment|/*  * ====================================================  * Copyright (C) 1993 by Sun Microsystems, Inc. All rights reserved.  *  * Developed at SunPro, a Sun Microsystems, Inc. business.  * Permission to use, copy, modify, and distribute this  * software is freely granted, provided that this notice  * is preserved.  * ====================================================  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|"math.h"
end_include

begin_include
include|#
directive|include
file|"math_private.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
specifier|volatile
name|float
name|vzero
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|float
name|zero
init|=
literal|0
decl_stmt|,
name|half
init|=
literal|0.5
decl_stmt|,
name|one
init|=
literal|1
decl_stmt|,
name|pi
init|=
literal|3.1415927410e+00
decl_stmt|,
comment|/* 0x40490fdb */
comment|/*  * Domain y in [0x1p-27, 0.27], range ~[-3.4599e-10, 3.4590e-10]:  * |(lgamma(2 - y) + 0.5 * y) / y - a(y)|< 2**-31.4  */
name|a0
init|=
literal|7.72156641e-02
decl_stmt|,
comment|/* 0x3d9e233f */
name|a1
init|=
literal|3.22467119e-01
decl_stmt|,
comment|/* 0x3ea51a69 */
name|a2
init|=
literal|6.73484802e-02
decl_stmt|,
comment|/* 0x3d89ee00 */
name|a3
init|=
literal|2.06395667e-02
decl_stmt|,
comment|/* 0x3ca9144f */
name|a4
init|=
literal|6.98275631e-03
decl_stmt|,
comment|/* 0x3be4cf9b */
name|a5
init|=
literal|4.11768444e-03
decl_stmt|,
comment|/* 0x3b86eda4 */
comment|/*  * Domain x in [tc-0.24, tc+0.28], range ~[-5.6577e-10, 5.5677e-10]:  * |(lgamma(x) - tf) - t(x - tc)|< 2**-30.8.  */
name|tc
init|=
literal|1.46163213e+00
decl_stmt|,
comment|/* 0x3fbb16c3 */
name|tf
init|=
operator|-
literal|1.21486291e-01
decl_stmt|,
comment|/* 0xbdf8cdce */
name|t0
init|=
operator|-
literal|2.94064460e-11
decl_stmt|,
comment|/* 0xae0154b7 */
name|t1
init|=
operator|-
literal|2.35939837e-08
decl_stmt|,
comment|/* 0xb2caabb8 */
name|t2
init|=
literal|4.83836412e-01
decl_stmt|,
comment|/* 0x3ef7b968 */
name|t3
init|=
operator|-
literal|1.47586212e-01
decl_stmt|,
comment|/* 0xbe1720d7 */
name|t4
init|=
literal|6.46013096e-02
decl_stmt|,
comment|/* 0x3d844db1 */
name|t5
init|=
operator|-
literal|3.28450352e-02
decl_stmt|,
comment|/* 0xbd068884 */
name|t6
init|=
literal|1.86483748e-02
decl_stmt|,
comment|/* 0x3c98c47a */
name|t7
init|=
operator|-
literal|9.89206228e-03
decl_stmt|,
comment|/* 0xbc221251 */
comment|/*  * Domain y in [-0.1, 0.232], range ~[-8.4931e-10, 8.7794e-10]:  * |(lgamma(1 + y) + 0.5 * y) / y - u(y) / v(y)|< 2**-31.2  */
name|u0
init|=
operator|-
literal|7.72156641e-02
decl_stmt|,
comment|/* 0xbd9e233f */
name|u1
init|=
literal|7.36789703e-01
decl_stmt|,
comment|/* 0x3f3c9e40 */
name|u2
init|=
literal|4.95649040e-01
decl_stmt|,
comment|/* 0x3efdc5b6 */
name|v1
init|=
literal|1.10958421e+00
decl_stmt|,
comment|/* 0x3f8e06db */
name|v2
init|=
literal|2.10598111e-01
decl_stmt|,
comment|/* 0x3e57a708 */
name|v3
init|=
operator|-
literal|1.02995494e-02
decl_stmt|,
comment|/* 0xbc28bf71 */
comment|/*  * Domain x in (2, 3], range ~[-5.5189e-11, 5.2317e-11]:  * |(lgamma(y+2) - 0.5 * y) / y - s(y)/r(y)|< 2**-35.0  * with y = x - 2.  */
name|s0
init|=
operator|-
literal|7.72156641e-02
decl_stmt|,
comment|/* 0xbd9e233f */
name|s1
init|=
literal|2.69987404e-01
decl_stmt|,
comment|/* 0x3e8a3bca */
name|s2
init|=
literal|1.42851010e-01
decl_stmt|,
comment|/* 0x3e124789 */
name|s3
init|=
literal|1.19389519e-02
decl_stmt|,
comment|/* 0x3c439b98 */
name|r1
init|=
literal|6.79650068e-01
decl_stmt|,
comment|/* 0x3f2dfd8c */
name|r2
init|=
literal|1.16058730e-01
decl_stmt|,
comment|/* 0x3dedb033 */
name|r3
init|=
literal|3.75673687e-03
decl_stmt|,
comment|/* 0x3b763396 */
comment|/*  * Domain z in [8, 0x1p24], range ~[-1.2640e-09, 1.2640e-09]:  * |lgamma(x) - (x - 0.5) * (log(x) - 1) - w(1/x)|< 2**-29.6.  */
name|w0
init|=
literal|4.18938547e-01
decl_stmt|,
comment|/* 0x3ed67f1d */
name|w1
init|=
literal|8.33332464e-02
decl_stmt|,
comment|/* 0x3daaaa9f */
name|w2
init|=
operator|-
literal|2.76129087e-03
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0xbb34f6c6 */
end_comment

begin_function
specifier|static
name|float
name|sin_pif
parameter_list|(
name|float
name|x
parameter_list|)
block|{
specifier|volatile
name|float
name|vz
decl_stmt|;
name|float
name|y
decl_stmt|,
name|z
decl_stmt|;
name|int
name|n
decl_stmt|;
name|y
operator|=
operator|-
name|x
expr_stmt|;
name|vz
operator|=
name|y
operator|+
literal|0x1p23F
expr_stmt|;
comment|/* depend on 0<= y< 0x1p23 */
name|z
operator|=
name|vz
operator|-
literal|0x1p23F
expr_stmt|;
comment|/* rintf(y) for the above range */
if|if
condition|(
name|z
operator|==
name|y
condition|)
return|return
name|zero
return|;
name|vz
operator|=
name|y
operator|+
literal|0x1p21F
expr_stmt|;
name|GET_FLOAT_WORD
argument_list|(
name|n
argument_list|,
name|vz
argument_list|)
expr_stmt|;
comment|/* bits for rounded y (units 0.25) */
name|z
operator|=
name|vz
operator|-
literal|0x1p21F
expr_stmt|;
comment|/* y rounded to a multiple of 0.25 */
if|if
condition|(
name|z
operator|>
name|y
condition|)
block|{
name|z
operator|-=
literal|0.25F
expr_stmt|;
comment|/* adjust to round down */
name|n
operator|--
expr_stmt|;
block|}
name|n
operator|&=
literal|7
expr_stmt|;
comment|/* octant of y mod 2 */
name|y
operator|=
name|y
operator|-
name|z
operator|+
name|n
operator|*
literal|0.25F
expr_stmt|;
comment|/* y mod 2 */
switch|switch
condition|(
name|n
condition|)
block|{
case|case
literal|0
case|:
name|y
operator|=
name|__kernel_sindf
argument_list|(
name|pi
operator|*
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
case|case
literal|2
case|:
name|y
operator|=
name|__kernel_cosdf
argument_list|(
name|pi
operator|*
operator|(
operator|(
name|float
operator|)
literal|0.5
operator|-
name|y
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|4
case|:
name|y
operator|=
name|__kernel_sindf
argument_list|(
name|pi
operator|*
operator|(
name|one
operator|-
name|y
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
case|case
literal|6
case|:
name|y
operator|=
operator|-
name|__kernel_cosdf
argument_list|(
name|pi
operator|*
operator|(
name|y
operator|-
operator|(
name|float
operator|)
literal|1.5
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|y
operator|=
name|__kernel_sindf
argument_list|(
name|pi
operator|*
operator|(
name|y
operator|-
operator|(
name|float
operator|)
literal|2.0
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|-
name|y
return|;
block|}
end_function

begin_function
name|float
name|__ieee754_lgammaf_r
parameter_list|(
name|float
name|x
parameter_list|,
name|int
modifier|*
name|signgamp
parameter_list|)
block|{
name|float
name|t
decl_stmt|,
name|y
decl_stmt|,
name|z
decl_stmt|,
name|nadj
decl_stmt|,
name|p
decl_stmt|,
name|p1
decl_stmt|,
name|p2
decl_stmt|,
name|p3
decl_stmt|,
name|q
decl_stmt|,
name|r
decl_stmt|,
name|w
decl_stmt|;
name|int32_t
name|hx
decl_stmt|;
name|int
name|i
decl_stmt|,
name|ix
decl_stmt|;
name|GET_FLOAT_WORD
argument_list|(
name|hx
argument_list|,
name|x
argument_list|)
expr_stmt|;
comment|/* purge off +-inf, NaN, +-0, tiny and negative arguments */
operator|*
name|signgamp
operator|=
literal|1
expr_stmt|;
name|ix
operator|=
name|hx
operator|&
literal|0x7fffffff
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0x7f800000
condition|)
return|return
name|x
operator|*
name|x
return|;
if|if
condition|(
name|ix
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|hx
operator|<
literal|0
condition|)
operator|*
name|signgamp
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|one
operator|/
name|vzero
return|;
block|}
if|if
condition|(
name|ix
operator|<
literal|0x35000000
condition|)
block|{
comment|/* |x|<2**-21, return -log(|x|) */
if|if
condition|(
name|hx
operator|<
literal|0
condition|)
block|{
operator|*
name|signgamp
operator|=
operator|-
literal|1
expr_stmt|;
return|return
operator|-
name|__ieee754_logf
argument_list|(
operator|-
name|x
argument_list|)
return|;
block|}
else|else
return|return
operator|-
name|__ieee754_logf
argument_list|(
name|x
argument_list|)
return|;
block|}
if|if
condition|(
name|hx
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|ix
operator|>=
literal|0x4b000000
condition|)
comment|/* |x|>=2**23, must be -integer */
return|return
name|one
operator|/
name|vzero
return|;
name|t
operator|=
name|sin_pif
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|==
name|zero
condition|)
return|return
name|one
operator|/
name|vzero
return|;
comment|/* -integer */
name|nadj
operator|=
name|__ieee754_logf
argument_list|(
name|pi
operator|/
name|fabsf
argument_list|(
name|t
operator|*
name|x
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|<
name|zero
condition|)
operator|*
name|signgamp
operator|=
operator|-
literal|1
expr_stmt|;
name|x
operator|=
operator|-
name|x
expr_stmt|;
block|}
comment|/* purge off 1 and 2 */
if|if
condition|(
name|ix
operator|==
literal|0x3f800000
operator|||
name|ix
operator|==
literal|0x40000000
condition|)
name|r
operator|=
literal|0
expr_stmt|;
comment|/* for x< 2.0 */
elseif|else
if|if
condition|(
name|ix
operator|<
literal|0x40000000
condition|)
block|{
if|if
condition|(
name|ix
operator|<=
literal|0x3f666666
condition|)
block|{
comment|/* lgamma(x) = lgamma(x+1)-log(x) */
name|r
operator|=
operator|-
name|__ieee754_logf
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0x3f3b4a20
condition|)
block|{
name|y
operator|=
name|one
operator|-
name|x
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ix
operator|>=
literal|0x3e6d3308
condition|)
block|{
name|y
operator|=
name|x
operator|-
operator|(
name|tc
operator|-
name|one
operator|)
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|y
operator|=
name|x
expr_stmt|;
name|i
operator|=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
name|r
operator|=
name|zero
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0x3fdda618
condition|)
block|{
name|y
operator|=
literal|2
operator|-
name|x
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
block|}
comment|/* [1.7316,2] */
elseif|else
if|if
condition|(
name|ix
operator|>=
literal|0x3F9da620
condition|)
block|{
name|y
operator|=
name|x
operator|-
name|tc
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
comment|/* [1.23,1.73] */
else|else
block|{
name|y
operator|=
name|x
operator|-
name|one
expr_stmt|;
name|i
operator|=
literal|2
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|z
operator|=
name|y
operator|*
name|y
expr_stmt|;
name|p1
operator|=
name|a0
operator|+
name|z
operator|*
operator|(
name|a2
operator|+
name|z
operator|*
name|a4
operator|)
expr_stmt|;
name|p2
operator|=
name|z
operator|*
operator|(
name|a1
operator|+
name|z
operator|*
operator|(
name|a3
operator|+
name|z
operator|*
name|a5
operator|)
operator|)
expr_stmt|;
name|p
operator|=
name|y
operator|*
name|p1
operator|+
name|p2
expr_stmt|;
name|r
operator|+=
operator|(
name|p
operator|-
name|y
operator|/
literal|2
operator|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|p
operator|=
name|t0
operator|+
name|y
operator|*
name|t1
operator|+
name|y
operator|*
name|y
operator|*
operator|(
name|t2
operator|+
name|y
operator|*
operator|(
name|t3
operator|+
name|y
operator|*
operator|(
name|t4
operator|+
name|y
operator|*
operator|(
name|t5
operator|+
name|y
operator|*
operator|(
name|t6
operator|+
name|y
operator|*
name|t7
operator|)
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
name|r
operator|+=
operator|(
name|tf
operator|+
name|p
operator|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|p1
operator|=
name|y
operator|*
operator|(
name|u0
operator|+
name|y
operator|*
operator|(
name|u1
operator|+
name|y
operator|*
name|u2
operator|)
operator|)
expr_stmt|;
name|p2
operator|=
name|one
operator|+
name|y
operator|*
operator|(
name|v1
operator|+
name|y
operator|*
operator|(
name|v2
operator|+
name|y
operator|*
name|v3
operator|)
operator|)
expr_stmt|;
name|r
operator|+=
operator|(
name|p1
operator|/
name|p2
operator|-
name|y
operator|/
literal|2
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ix
operator|<
literal|0x41000000
condition|)
block|{
comment|/* x< 8.0 */
name|i
operator|=
name|x
expr_stmt|;
name|y
operator|=
name|x
operator|-
name|i
expr_stmt|;
name|p
operator|=
name|y
operator|*
operator|(
name|s0
operator|+
name|y
operator|*
operator|(
name|s1
operator|+
name|y
operator|*
operator|(
name|s2
operator|+
name|y
operator|*
name|s3
operator|)
operator|)
operator|)
expr_stmt|;
name|q
operator|=
name|one
operator|+
name|y
operator|*
operator|(
name|r1
operator|+
name|y
operator|*
operator|(
name|r2
operator|+
name|y
operator|*
name|r3
operator|)
operator|)
expr_stmt|;
name|r
operator|=
name|y
operator|/
literal|2
operator|+
name|p
operator|/
name|q
expr_stmt|;
name|z
operator|=
name|one
expr_stmt|;
comment|/* lgamma(1+s) = log(s) + lgamma(s) */
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|7
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|6
operator|)
expr_stmt|;
comment|/* FALLTHRU */
case|case
literal|6
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|5
operator|)
expr_stmt|;
comment|/* FALLTHRU */
case|case
literal|5
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|4
operator|)
expr_stmt|;
comment|/* FALLTHRU */
case|case
literal|4
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* FALLTHRU */
case|case
literal|3
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* FALLTHRU */
name|r
operator|+=
name|__ieee754_logf
argument_list|(
name|z
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* 8.0<= x< 2**24 */
block|}
elseif|else
if|if
condition|(
name|ix
operator|<
literal|0x4b800000
condition|)
block|{
name|t
operator|=
name|__ieee754_logf
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|z
operator|=
name|one
operator|/
name|x
expr_stmt|;
name|y
operator|=
name|z
operator|*
name|z
expr_stmt|;
name|w
operator|=
name|w0
operator|+
name|z
operator|*
operator|(
name|w1
operator|+
name|y
operator|*
name|w2
operator|)
expr_stmt|;
name|r
operator|=
operator|(
name|x
operator|-
name|half
operator|)
operator|*
operator|(
name|t
operator|-
name|one
operator|)
operator|+
name|w
expr_stmt|;
block|}
else|else
comment|/* 2**24<= x<= inf */
name|r
operator|=
name|x
operator|*
operator|(
name|__ieee754_logf
argument_list|(
name|x
argument_list|)
operator|-
name|one
operator|)
expr_stmt|;
if|if
condition|(
name|hx
operator|<
literal|0
condition|)
name|r
operator|=
name|nadj
operator|-
name|r
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

end_unit

