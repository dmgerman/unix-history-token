begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* uncompr.c -- decompress a memory buffer  * Copyright (C) 1995-2002 Jean-loup Gailly.  * For conditions of distribution and use, see copyright notice in zlib.h   */
end_comment

begin_comment
comment|/* @(#) $Id$ */
end_comment

begin_include
include|#
directive|include
file|"zlib.h"
end_include

begin_comment
comment|/* ===========================================================================      Decompresses the source buffer into the destination buffer.  sourceLen is    the byte length of the source buffer. Upon entry, destLen is the total    size of the destination buffer, which must be large enough to hold the    entire uncompressed data. (The size of the uncompressed data must have    been saved previously by the compressor and transmitted to the decompressor    by some mechanism outside the scope of this compression library.)    Upon exit, destLen is the actual size of the compressed buffer.      This function can be used to decompress a whole file at once if the    input file is mmap'ed.       uncompress returns Z_OK if success, Z_MEM_ERROR if there was not    enough memory, Z_BUF_ERROR if there was not enough room in the output    buffer, or Z_DATA_ERROR if the input data was corrupted. */
end_comment

begin_function
name|int
name|ZEXPORT
name|uncompress
parameter_list|(
name|dest
parameter_list|,
name|destLen
parameter_list|,
name|source
parameter_list|,
name|sourceLen
parameter_list|)
name|Bytef
modifier|*
name|dest
decl_stmt|;
name|uLongf
modifier|*
name|destLen
decl_stmt|;
specifier|const
name|Bytef
modifier|*
name|source
decl_stmt|;
name|uLong
name|sourceLen
decl_stmt|;
block|{
name|z_stream
name|stream
decl_stmt|;
name|int
name|err
decl_stmt|;
name|stream
operator|.
name|next_in
operator|=
operator|(
name|Bytef
operator|*
operator|)
name|source
expr_stmt|;
name|stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|sourceLen
expr_stmt|;
comment|/* Check for source> 64K on 16-bit machine: */
if|if
condition|(
operator|(
name|uLong
operator|)
name|stream
operator|.
name|avail_in
operator|!=
name|sourceLen
condition|)
return|return
name|Z_BUF_ERROR
return|;
name|stream
operator|.
name|next_out
operator|=
name|dest
expr_stmt|;
name|stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
operator|*
name|destLen
expr_stmt|;
if|if
condition|(
operator|(
name|uLong
operator|)
name|stream
operator|.
name|avail_out
operator|!=
operator|*
name|destLen
condition|)
return|return
name|Z_BUF_ERROR
return|;
name|stream
operator|.
name|zalloc
operator|=
operator|(
name|alloc_func
operator|)
literal|0
expr_stmt|;
name|stream
operator|.
name|zfree
operator|=
operator|(
name|free_func
operator|)
literal|0
expr_stmt|;
name|err
operator|=
name|inflateInit
argument_list|(
operator|&
name|stream
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_OK
condition|)
return|return
name|err
return|;
name|err
operator|=
name|inflate
argument_list|(
operator|&
name|stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_STREAM_END
condition|)
block|{
name|inflateEnd
argument_list|(
operator|&
name|stream
argument_list|)
expr_stmt|;
return|return
name|err
operator|==
name|Z_OK
condition|?
name|Z_BUF_ERROR
else|:
name|err
return|;
block|}
operator|*
name|destLen
operator|=
name|stream
operator|.
name|total_out
expr_stmt|;
name|err
operator|=
name|inflateEnd
argument_list|(
operator|&
name|stream
argument_list|)
expr_stmt|;
return|return
name|err
return|;
block|}
end_function

end_unit

