begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2017 Netflix, Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer  *    in this position and unchanged.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * Routines to format EFI_DEVICE_PATHs from the UEFI standard. Much of  * this file is taken from EDK2 and rototilled.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<efivar.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"efi-osdep.h"
end_include

begin_include
include|#
directive|include
file|"efivar-dp.h"
end_include

begin_include
include|#
directive|include
file|"uefi-dplib.h"
end_include

begin_comment
comment|/*  * This is a lie, but since we have converted everything  * from wide to narrow, it's the right lie now.  */
end_comment

begin_define
define|#
directive|define
name|UnicodeSPrint
value|snprintf
end_define

begin_comment
comment|/*  * Taken from MdePkg/Library/UefiDevicePathLib/DevicePathToText.c  * hash a11928f3310518ab1c6fd34e8d0fdbb72de9602c 2017-Mar-01  * heavily modified:  *	wide strings converted to narrow  *	Low level printing code redone for narrow strings  *	Routines made static  *	%s -> %S in spots (where it is still UCS-2)  *	%a (ascii) -> %s  *	%g -> %36s hack to print guid (see above for caveat)  *	some tidying up of const and deconsting. It's evil, but const  *	  poisoning the whole file was too much.  */
end_comment

begin_comment
comment|/** @file   DevicePathToText protocol as defined in the UEFI 2.0 specification.    (C) Copyright 2015 Hewlett-Packard Development Company, L.P.<BR> Copyright (c) 2013 - 2015, Intel Corporation. All rights reserved.<BR> This program and the accompanying materials are licensed and made available under the terms and conditions of the BSD License which accompanies this distribution.  The full text of the license may be found at http://opensource.org/licenses/bsd-license.php  THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_comment
comment|// #include "UefiDevicePathLib.h"
end_comment

begin_comment
comment|/**   Concatenates a formatted unicode string to allocated pool. The caller must   free the resulting buffer.    @param Str             Tracks the allocated pool, size in use, and                          amount of pool allocated.   @param Fmt             The format string   @param ...             Variable arguments based on the format string.    @return Allocated buffer with the formatted string printed in it.           The caller must free the allocated buffer. The buffer           allocation is not packed.  **/
end_comment

begin_function
specifier|static
name|char
modifier|*
name|EFIAPI
name|UefiDevicePathLibCatPrint
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
specifier|const
name|char
modifier|*
name|Fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|UINTN
name|Count
decl_stmt|;
name|VA_LIST
name|Args
decl_stmt|;
name|VA_START
argument_list|(
name|Args
argument_list|,
name|Fmt
argument_list|)
expr_stmt|;
name|Count
operator|=
name|vsnprintf
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|,
name|Fmt
argument_list|,
name|Args
argument_list|)
expr_stmt|;
name|VA_END
argument_list|(
name|Args
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|Str
operator|->
name|Count
operator|+
operator|(
name|Count
operator|+
literal|1
operator|)
operator|)
operator|>
name|Str
operator|->
name|Capacity
condition|)
block|{
name|Str
operator|->
name|Capacity
operator|=
operator|(
name|Str
operator|->
name|Count
operator|+
operator|(
name|Count
operator|+
literal|1
operator|)
operator|*
literal|2
operator|)
expr_stmt|;
name|Str
operator|->
name|Str
operator|=
name|reallocf
argument_list|(
name|Str
operator|->
name|Str
argument_list|,
name|Str
operator|->
name|Capacity
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Str
operator|->
name|Str
operator|!=
name|NULL
argument_list|)
expr_stmt|;
block|}
name|VA_START
argument_list|(
name|Args
argument_list|,
name|Fmt
argument_list|)
expr_stmt|;
name|vsnprintf
argument_list|(
name|Str
operator|->
name|Str
operator|+
name|Str
operator|->
name|Count
argument_list|,
name|Str
operator|->
name|Capacity
operator|-
name|Str
operator|->
name|Count
argument_list|,
name|Fmt
argument_list|,
name|Args
argument_list|)
expr_stmt|;
name|Str
operator|->
name|Count
operator|+=
name|Count
expr_stmt|;
name|VA_END
argument_list|(
name|Args
argument_list|)
expr_stmt|;
return|return
name|Str
operator|->
name|Str
return|;
block|}
end_function

begin_comment
comment|/**   Converts a PCI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextPci
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|PCI_DEVICE_PATH
modifier|*
name|Pci
decl_stmt|;
name|Pci
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Pci(0x%x,0x%x)"
argument_list|,
name|Pci
operator|->
name|Device
argument_list|,
name|Pci
operator|->
name|Function
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a PC Card device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextPccard
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|PCCARD_DEVICE_PATH
modifier|*
name|Pccard
decl_stmt|;
name|Pccard
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"PcCard(0x%x)"
argument_list|,
name|Pccard
operator|->
name|FunctionNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Memory Map device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextMemMap
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEMMAP_DEVICE_PATH
modifier|*
name|MemMap
decl_stmt|;
name|MemMap
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"MemoryMapped(0x%x,0x%lx,0x%lx)"
argument_list|,
name|MemMap
operator|->
name|MemoryType
argument_list|,
name|MemMap
operator|->
name|StartingAddress
argument_list|,
name|MemMap
operator|->
name|EndingAddress
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Vendor device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextVendor
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
specifier|const
name|char
modifier|*
name|Type
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|UINTN
name|DataLength
decl_stmt|;
name|UINT32
name|FlowControlMap
decl_stmt|;
name|UINT16
name|Info
decl_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|DevPath
expr_stmt|;
switch|switch
condition|(
name|DevicePathType
argument_list|(
operator|&
name|Vendor
operator|->
name|Header
argument_list|)
condition|)
block|{
case|case
name|HARDWARE_DEVICE_PATH
case|:
name|Type
operator|=
literal|"Hw"
expr_stmt|;
break|break;
case|case
name|MESSAGING_DEVICE_PATH
case|:
name|Type
operator|=
literal|"Msg"
expr_stmt|;
if|if
condition|(
name|AllowShortcuts
condition|)
block|{
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiPcAnsiGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VenPcAnsi()"
argument_list|)
expr_stmt|;
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVT100Guid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VenVt100()"
argument_list|)
expr_stmt|;
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVT100PlusGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VenVt100Plus()"
argument_list|)
expr_stmt|;
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVTUTF8Guid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VenUft8()"
argument_list|)
expr_stmt|;
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiUartDevicePathGuid
argument_list|)
condition|)
block|{
name|FlowControlMap
operator|=
operator|(
operator|(
operator|(
name|UART_FLOW_CONTROL_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|FlowControlMap
operator|)
expr_stmt|;
switch|switch
condition|(
name|FlowControlMap
operator|&
literal|0x00000003
condition|)
block|{
case|case
literal|0
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UartFlowCtrl(%s)"
argument_list|,
literal|"None"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UartFlowCtrl(%s)"
argument_list|,
literal|"Hardware"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UartFlowCtrl(%s)"
argument_list|,
literal|"XonXoff"
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiSasDevicePathGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"SAS(0x%lx,0x%lx,0x%x,"
argument_list|,
operator|(
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|SasAddress
argument_list|,
operator|(
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|Lun
argument_list|,
operator|(
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|RelativeTargetPort
argument_list|)
expr_stmt|;
name|Info
operator|=
operator|(
operator|(
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|DeviceTopology
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|Info
operator|&
literal|0x0f
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|Info
operator|&
name|BIT7
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"NoTopology,0,0,0,"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
name|Info
operator|&
literal|0x0f
operator|)
operator|<=
literal|2
operator|)
operator|&&
operator|(
operator|(
name|Info
operator|&
name|BIT7
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,%s,%s,"
argument_list|,
operator|(
operator|(
name|Info
operator|&
name|BIT4
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"SATA"
else|:
literal|"SAS"
argument_list|,
operator|(
operator|(
name|Info
operator|&
name|BIT5
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|,
operator|(
operator|(
name|Info
operator|&
name|BIT6
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"Expanded"
else|:
literal|"Direct"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|Info
operator|&
literal|0x0f
operator|)
operator|==
literal|1
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0,"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|//
comment|// Value 0x0 thru 0xFF -> Drive 1 thru Drive 256
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x,"
argument_list|,
operator|(
operator|(
name|Info
operator|>>
literal|8
operator|)
operator|&
literal|0xff
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x,0,0,0,"
argument_list|,
name|Info
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x)"
argument_list|,
operator|(
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|Reserved
argument_list|)
expr_stmt|;
return|return ;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiDebugPortProtocolGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"DebugPort()"
argument_list|)
expr_stmt|;
return|return ;
block|}
block|}
break|break;
case|case
name|MEDIA_DEVICE_PATH
case|:
name|Type
operator|=
literal|"Media"
expr_stmt|;
break|break;
default|default:
name|Type
operator|=
literal|"?"
expr_stmt|;
break|break;
block|}
name|DataLength
operator|=
name|DevicePathNodeLength
argument_list|(
operator|&
name|Vendor
operator|->
name|Header
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Ven%s(%36s"
argument_list|,
name|Type
argument_list|,
name|G
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|DataLength
operator|!=
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
name|DataLength
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
operator|(
operator|(
name|VENDOR_DEVICE_PATH_WITH_DATA
operator|*
operator|)
name|Vendor
operator|)
operator|->
name|VendorDefinedData
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Controller device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextController
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|CONTROLLER_DEVICE_PATH
modifier|*
name|Controller
decl_stmt|;
name|Controller
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Ctrl(0x%x)"
argument_list|,
name|Controller
operator|->
name|ControllerNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a BMC device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextBmc
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|BMC_DEVICE_PATH
modifier|*
name|Bmc
decl_stmt|;
name|Bmc
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"BMC(0x%x,0x%lx)"
argument_list|,
name|Bmc
operator|->
name|InterfaceType
argument_list|,
name|ReadUnaligned64
argument_list|(
operator|(
operator|&
name|Bmc
operator|->
name|BaseAddress
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a ACPI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextAcpi
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|ACPI_HID_DEVICE_PATH
modifier|*
name|Acpi
decl_stmt|;
name|Acpi
operator|=
name|DevPath
expr_stmt|;
if|if
condition|(
operator|(
name|Acpi
operator|->
name|HID
operator|&
name|PNP_EISA_ID_MASK
operator|)
operator|==
name|PNP_EISA_ID_CONST
condition|)
block|{
switch|switch
condition|(
name|EISA_ID_TO_NUM
argument_list|(
name|Acpi
operator|->
name|HID
argument_list|)
condition|)
block|{
case|case
literal|0x0a03
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"PciRoot(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0a08
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"PcieRoot(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0604
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Floppy(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0301
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Keyboard(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0501
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Serial(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x0401
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"ParallelPort(0x%x)"
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
default|default:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Acpi(PNP%04x,0x%x)"
argument_list|,
name|EISA_ID_TO_NUM
argument_list|(
name|Acpi
operator|->
name|HID
argument_list|)
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Acpi(0x%08x,0x%x)"
argument_list|,
name|Acpi
operator|->
name|HID
argument_list|,
name|Acpi
operator|->
name|UID
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**   Converts a ACPI extended HID device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextAcpiEx
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|ACPI_EXTENDED_HID_DEVICE_PATH
modifier|*
name|AcpiEx
decl_stmt|;
name|CHAR8
modifier|*
name|HIDStr
decl_stmt|;
name|CHAR8
modifier|*
name|UIDStr
decl_stmt|;
name|CHAR8
modifier|*
name|CIDStr
decl_stmt|;
name|char
name|HIDText
index|[
literal|11
index|]
decl_stmt|;
name|char
name|CIDText
index|[
literal|11
index|]
decl_stmt|;
name|AcpiEx
operator|=
name|DevPath
expr_stmt|;
name|HIDStr
operator|=
operator|(
name|CHAR8
operator|*
operator|)
operator|(
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|AcpiEx
operator|)
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
argument_list|)
operator|)
expr_stmt|;
name|UIDStr
operator|=
name|HIDStr
operator|+
name|AsciiStrLen
argument_list|(
name|HIDStr
argument_list|)
operator|+
literal|1
expr_stmt|;
name|CIDStr
operator|=
name|UIDStr
operator|+
name|AsciiStrLen
argument_list|(
name|UIDStr
argument_list|)
operator|+
literal|1
expr_stmt|;
comment|//
comment|// Converts EISA identification to string.
comment|//
name|UnicodeSPrint
argument_list|(
name|HIDText
argument_list|,
sizeof|sizeof
argument_list|(
name|HIDText
argument_list|)
argument_list|,
literal|"%c%c%c%04X"
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|HID
operator|>>
literal|10
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|HID
operator|>>
literal|5
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|HID
operator|>>
literal|0
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
name|AcpiEx
operator|->
name|HID
operator|>>
literal|16
operator|)
operator|&
literal|0xFFFF
argument_list|)
expr_stmt|;
name|UnicodeSPrint
argument_list|(
name|CIDText
argument_list|,
sizeof|sizeof
argument_list|(
name|CIDText
argument_list|)
argument_list|,
literal|"%c%c%c%04X"
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|CID
operator|>>
literal|10
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|CID
operator|>>
literal|5
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
operator|(
name|AcpiEx
operator|->
name|CID
operator|>>
literal|0
operator|)
operator|&
literal|0x1f
operator|)
operator|+
literal|'A'
operator|-
literal|1
argument_list|,
operator|(
name|AcpiEx
operator|->
name|CID
operator|>>
literal|16
operator|)
operator|&
literal|0xFFFF
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|HIDStr
operator|==
literal|'\0'
operator|)
operator|&&
operator|(
operator|*
name|CIDStr
operator|==
literal|'\0'
operator|)
operator|&&
operator|(
name|AcpiEx
operator|->
name|UID
operator|==
literal|0
operator|)
condition|)
block|{
comment|//
comment|// use AcpiExp()
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"AcpiExp(%s,%s,%s)"
argument_list|,
name|HIDText
argument_list|,
name|CIDText
argument_list|,
name|UIDStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|AllowShortcuts
condition|)
block|{
comment|//
comment|// display only
comment|//
if|if
condition|(
name|AcpiEx
operator|->
name|HID
operator|==
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"AcpiEx(%s,"
argument_list|,
name|HIDStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"AcpiEx(%s,"
argument_list|,
name|HIDText
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|AcpiEx
operator|->
name|UID
operator|==
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
name|UIDStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x,"
argument_list|,
name|AcpiEx
operator|->
name|UID
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|AcpiEx
operator|->
name|CID
operator|==
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s)"
argument_list|,
name|CIDStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s)"
argument_list|,
name|CIDText
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"AcpiEx(%s,%s,0x%x,%s,%s,%s)"
argument_list|,
name|HIDText
argument_list|,
name|CIDText
argument_list|,
name|AcpiEx
operator|->
name|UID
argument_list|,
name|HIDStr
argument_list|,
name|CIDStr
argument_list|,
name|UIDStr
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/**   Converts a ACPI address device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextAcpiAdr
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|ACPI_ADR_DEVICE_PATH
modifier|*
name|AcpiAdr
decl_stmt|;
name|UINT32
modifier|*
name|Addr
decl_stmt|;
name|UINT16
name|Index
decl_stmt|;
name|UINT16
name|Length
decl_stmt|;
name|UINT16
name|AdditionalAdrCount
decl_stmt|;
name|AcpiAdr
operator|=
name|DevPath
expr_stmt|;
name|Length
operator|=
operator|(
name|UINT16
operator|)
name|DevicePathNodeLength
argument_list|(
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AcpiAdr
argument_list|)
expr_stmt|;
name|AdditionalAdrCount
operator|=
call|(
name|UINT16
call|)
argument_list|(
operator|(
name|Length
operator|-
literal|8
operator|)
operator|/
literal|4
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"AcpiAdr(0x%x"
argument_list|,
name|AcpiAdr
operator|->
name|ADR
argument_list|)
expr_stmt|;
name|Addr
operator|=
operator|&
name|AcpiAdr
operator|->
name|ADR
operator|+
literal|1
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
name|AdditionalAdrCount
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x%x"
argument_list|,
name|Addr
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a ATAPI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextAtapi
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|ATAPI_DEVICE_PATH
modifier|*
name|Atapi
decl_stmt|;
name|Atapi
operator|=
name|DevPath
expr_stmt|;
if|if
condition|(
name|DisplayOnly
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Ata(0x%x)"
argument_list|,
name|Atapi
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Ata(%s,%s,0x%x)"
argument_list|,
operator|(
name|Atapi
operator|->
name|PrimarySecondary
operator|==
literal|1
operator|)
condition|?
literal|"Secondary"
else|:
literal|"Primary"
argument_list|,
operator|(
name|Atapi
operator|->
name|SlaveMaster
operator|==
literal|1
operator|)
condition|?
literal|"Slave"
else|:
literal|"Master"
argument_list|,
name|Atapi
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**   Converts a SCSI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextScsi
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|SCSI_DEVICE_PATH
modifier|*
name|Scsi
decl_stmt|;
name|Scsi
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Scsi(0x%x,0x%x)"
argument_list|,
name|Scsi
operator|->
name|Pun
argument_list|,
name|Scsi
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Fibre device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextFibre
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|FIBRECHANNEL_DEVICE_PATH
modifier|*
name|Fibre
decl_stmt|;
name|Fibre
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Fibre(0x%lx,0x%lx)"
argument_list|,
name|Fibre
operator|->
name|WWN
argument_list|,
name|Fibre
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a FibreEx device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextFibreEx
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|FIBRECHANNELEX_DEVICE_PATH
modifier|*
name|FibreEx
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|FibreEx
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"FibreEx(0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
sizeof|sizeof
argument_list|(
name|FibreEx
operator|->
name|WWN
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|FibreEx
operator|->
name|WWN
index|[
literal|0
index|]
argument_list|)
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
name|FibreEx
operator|->
name|WWN
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
sizeof|sizeof
argument_list|(
name|FibreEx
operator|->
name|Lun
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|FibreEx
operator|->
name|Lun
index|[
literal|0
index|]
argument_list|)
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
name|FibreEx
operator|->
name|Lun
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Sas Ex device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextSasEx
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|SASEX_DEVICE_PATH
modifier|*
name|SasEx
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|SasEx
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"SasEx(0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
sizeof|sizeof
argument_list|(
name|SasEx
operator|->
name|SasAddress
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|SasEx
operator|->
name|SasAddress
index|[
literal|0
index|]
argument_list|)
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
name|SasEx
operator|->
name|SasAddress
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x"
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
sizeof|sizeof
argument_list|(
name|SasEx
operator|->
name|Lun
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|SasEx
operator|->
name|Lun
index|[
literal|0
index|]
argument_list|)
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
name|SasEx
operator|->
name|Lun
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x%x,"
argument_list|,
name|SasEx
operator|->
name|RelativeTargetPort
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
literal|0x0f
operator|)
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
name|BIT7
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"NoTopology,0,0,0"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
literal|0x0f
operator|)
operator|<=
literal|2
operator|)
operator|&&
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
name|BIT7
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,%s,%s,"
argument_list|,
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
name|BIT4
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"SATA"
else|:
literal|"SAS"
argument_list|,
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
name|BIT5
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"External"
else|:
literal|"Internal"
argument_list|,
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
name|BIT6
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"Expanded"
else|:
literal|"Direct"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|&
literal|0x0f
operator|)
operator|==
literal|1
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|//
comment|// Value 0x0 thru 0xFF -> Drive 1 thru Drive 256
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x"
argument_list|,
operator|(
operator|(
name|SasEx
operator|->
name|DeviceTopology
operator|>>
literal|8
operator|)
operator|&
literal|0xff
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x,0,0,0"
argument_list|,
name|SasEx
operator|->
name|DeviceTopology
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return ;
block|}
end_function

begin_comment
comment|/**   Converts a NVM Express Namespace device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextNVMe
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|NVME_NAMESPACE_DEVICE_PATH
modifier|*
name|Nvme
decl_stmt|;
name|UINT8
modifier|*
name|Uuid
decl_stmt|;
name|Nvme
operator|=
name|DevPath
expr_stmt|;
name|Uuid
operator|=
operator|(
name|UINT8
operator|*
operator|)
operator|&
name|Nvme
operator|->
name|NamespaceUuid
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"NVMe(0x%x,%02x-%02x-%02x-%02x-%02x-%02x-%02x-%02x)"
argument_list|,
name|Nvme
operator|->
name|NamespaceId
argument_list|,
name|Uuid
index|[
literal|7
index|]
argument_list|,
name|Uuid
index|[
literal|6
index|]
argument_list|,
name|Uuid
index|[
literal|5
index|]
argument_list|,
name|Uuid
index|[
literal|4
index|]
argument_list|,
name|Uuid
index|[
literal|3
index|]
argument_list|,
name|Uuid
index|[
literal|2
index|]
argument_list|,
name|Uuid
index|[
literal|1
index|]
argument_list|,
name|Uuid
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a UFS device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUfs
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|UFS_DEVICE_PATH
modifier|*
name|Ufs
decl_stmt|;
name|Ufs
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UFS(0x%x,0x%x)"
argument_list|,
name|Ufs
operator|->
name|Pun
argument_list|,
name|Ufs
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a SD (Secure Digital) device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextSd
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|SD_DEVICE_PATH
modifier|*
name|Sd
decl_stmt|;
name|Sd
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"SD(0x%x)"
argument_list|,
name|Sd
operator|->
name|SlotNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a EMMC (Embedded MMC) device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextEmmc
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|EMMC_DEVICE_PATH
modifier|*
name|Emmc
decl_stmt|;
name|Emmc
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"eMMC(0x%x)"
argument_list|,
name|Emmc
operator|->
name|SlotNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a 1394 device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToText1394
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|F1394_DEVICE_PATH
modifier|*
name|F1394DevPath
decl_stmt|;
name|F1394DevPath
operator|=
name|DevPath
expr_stmt|;
comment|//
comment|// Guid has format of IEEE-EUI64
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"I1394(%016lx)"
argument_list|,
name|F1394DevPath
operator|->
name|Guid
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a USB device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUsb
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|USB_DEVICE_PATH
modifier|*
name|Usb
decl_stmt|;
name|Usb
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"USB(0x%x,0x%x)"
argument_list|,
name|Usb
operator|->
name|ParentPortNumber
argument_list|,
name|Usb
operator|->
name|InterfaceNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a USB WWID device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUsbWWID
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|USB_WWID_DEVICE_PATH
modifier|*
name|UsbWWId
decl_stmt|;
name|CHAR16
modifier|*
name|SerialNumberStr
decl_stmt|;
name|CHAR16
modifier|*
name|NewStr
decl_stmt|;
name|UINT16
name|Length
decl_stmt|;
name|UsbWWId
operator|=
name|DevPath
expr_stmt|;
name|SerialNumberStr
operator|=
operator|(
name|CHAR16
operator|*
operator|)
operator|(
operator|&
name|UsbWWId
operator|+
literal|1
operator|)
expr_stmt|;
name|Length
operator|=
call|(
name|UINT16
call|)
argument_list|(
operator|(
name|DevicePathNodeLength
argument_list|(
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|UsbWWId
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|USB_WWID_DEVICE_PATH
argument_list|)
operator|)
operator|/
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|SerialNumberStr
index|[
name|Length
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
block|{
comment|//
comment|// In case no NULL terminator in SerialNumber, create a new one with NULL terminator
comment|//
name|NewStr
operator|=
name|AllocateCopyPool
argument_list|(
operator|(
name|Length
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|,
name|SerialNumberStr
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|NewStr
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|NewStr
index|[
name|Length
index|]
operator|=
literal|0
expr_stmt|;
name|SerialNumberStr
operator|=
name|NewStr
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbWwid(0x%x,0x%x,0x%x,\"%S\")"
argument_list|,
name|UsbWWId
operator|->
name|VendorId
argument_list|,
name|UsbWWId
operator|->
name|ProductId
argument_list|,
name|UsbWWId
operator|->
name|InterfaceNumber
argument_list|,
name|SerialNumberStr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Logic Unit device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextLogicalUnit
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|DEVICE_LOGICAL_UNIT_DEVICE_PATH
modifier|*
name|LogicalUnit
decl_stmt|;
name|LogicalUnit
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Unit(0x%x)"
argument_list|,
name|LogicalUnit
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a USB class device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUsbClass
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|USB_CLASS_DEVICE_PATH
modifier|*
name|UsbClass
decl_stmt|;
name|BOOLEAN
name|IsKnownSubClass
decl_stmt|;
name|UsbClass
operator|=
name|DevPath
expr_stmt|;
name|IsKnownSubClass
operator|=
name|TRUE
expr_stmt|;
switch|switch
condition|(
name|UsbClass
operator|->
name|DeviceClass
condition|)
block|{
case|case
name|USB_CLASS_AUDIO
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbAudio"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_CDCCONTROL
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbCDCControl"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_HID
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbHID"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_IMAGE
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbImage"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_PRINTER
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbPrinter"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_MASS_STORAGE
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbMassStorage"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_HUB
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbHub"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_CDCDATA
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbCDCData"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_SMART_CARD
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbSmartCard"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_VIDEO
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbVideo"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_DIAGNOSTIC
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbDiagnostic"
argument_list|)
expr_stmt|;
break|break;
case|case
name|USB_CLASS_WIRELESS
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbWireless"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|IsKnownSubClass
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|IsKnownSubClass
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"(0x%x,0x%x,0x%x,0x%x)"
argument_list|,
name|UsbClass
operator|->
name|VendorId
argument_list|,
name|UsbClass
operator|->
name|ProductId
argument_list|,
name|UsbClass
operator|->
name|DeviceSubClass
argument_list|,
name|UsbClass
operator|->
name|DeviceProtocol
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|UsbClass
operator|->
name|DeviceClass
operator|==
name|USB_CLASS_RESERVE
condition|)
block|{
if|if
condition|(
name|UsbClass
operator|->
name|DeviceSubClass
operator|==
name|USB_SUBCLASS_FW_UPDATE
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbDeviceFirmwareUpdate(0x%x,0x%x,0x%x)"
argument_list|,
name|UsbClass
operator|->
name|VendorId
argument_list|,
name|UsbClass
operator|->
name|ProductId
argument_list|,
name|UsbClass
operator|->
name|DeviceProtocol
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|UsbClass
operator|->
name|DeviceSubClass
operator|==
name|USB_SUBCLASS_IRDA_BRIDGE
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbIrdaBridge(0x%x,0x%x,0x%x)"
argument_list|,
name|UsbClass
operator|->
name|VendorId
argument_list|,
name|UsbClass
operator|->
name|ProductId
argument_list|,
name|UsbClass
operator|->
name|DeviceProtocol
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|UsbClass
operator|->
name|DeviceSubClass
operator|==
name|USB_SUBCLASS_TEST
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbTestAndMeasurement(0x%x,0x%x,0x%x)"
argument_list|,
name|UsbClass
operator|->
name|VendorId
argument_list|,
name|UsbClass
operator|->
name|ProductId
argument_list|,
name|UsbClass
operator|->
name|DeviceProtocol
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UsbClass(0x%x,0x%x,0x%x,0x%x,0x%x)"
argument_list|,
name|UsbClass
operator|->
name|VendorId
argument_list|,
name|UsbClass
operator|->
name|ProductId
argument_list|,
name|UsbClass
operator|->
name|DeviceClass
argument_list|,
name|UsbClass
operator|->
name|DeviceSubClass
argument_list|,
name|UsbClass
operator|->
name|DeviceProtocol
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a SATA device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextSata
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|SATA_DEVICE_PATH
modifier|*
name|Sata
decl_stmt|;
name|Sata
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Sata(0x%x,0x%x,0x%x)"
argument_list|,
name|Sata
operator|->
name|HBAPortNumber
argument_list|,
name|Sata
operator|->
name|PortMultiplierPortNumber
argument_list|,
name|Sata
operator|->
name|Lun
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a I20 device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextI2O
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|I2O_DEVICE_PATH
modifier|*
name|I2ODevPath
decl_stmt|;
name|I2ODevPath
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"I2O(0x%x)"
argument_list|,
name|I2ODevPath
operator|->
name|Tid
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a MAC address device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextMacAddr
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MAC_ADDR_DEVICE_PATH
modifier|*
name|MacDevPath
decl_stmt|;
name|UINTN
name|HwAddressSize
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|MacDevPath
operator|=
name|DevPath
expr_stmt|;
name|HwAddressSize
operator|=
sizeof|sizeof
argument_list|(
name|EFI_MAC_ADDRESS
argument_list|)
expr_stmt|;
if|if
condition|(
name|MacDevPath
operator|->
name|IfType
operator|==
literal|0x01
operator|||
name|MacDevPath
operator|->
name|IfType
operator|==
literal|0x00
condition|)
block|{
name|HwAddressSize
operator|=
literal|6
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"MAC("
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|Index
operator|<
name|HwAddressSize
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
name|MacDevPath
operator|->
name|MacAddress
operator|.
name|Addr
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x%x)"
argument_list|,
name|MacDevPath
operator|->
name|IfType
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts network protocol string to its text representation.    @param Str             The string representative of input device.   @param Protocol        The network protocol ID.  **/
end_comment

begin_function
specifier|static
name|VOID
name|CatNetworkProtocol
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|UINT16
name|Protocol
parameter_list|)
block|{
if|if
condition|(
name|Protocol
operator|==
name|RFC_1700_TCP_PROTOCOL
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"TCP"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|Protocol
operator|==
name|RFC_1700_UDP_PROTOCOL
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"UDP"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%x"
argument_list|,
name|Protocol
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**   Converts IP v4 address to its text representation.    @param Str             The string representative of input device.   @param Address         The IP v4 address. **/
end_comment

begin_function
specifier|static
name|VOID
name|CatIPv4Address
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|EFI_IPv4_ADDRESS
modifier|*
name|Address
parameter_list|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%d.%d.%d.%d"
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|0
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|1
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|2
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts IP v6 address to its text representation.    @param Str             The string representative of input device.   @param Address         The IP v6 address. **/
end_comment

begin_function
specifier|static
name|VOID
name|CatIPv6Address
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|EFI_IPv6_ADDRESS
modifier|*
name|Address
parameter_list|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x"
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|0
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|1
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|2
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|3
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|4
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|5
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|6
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|7
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|8
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|9
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|10
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|11
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|12
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|13
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|14
index|]
argument_list|,
name|Address
operator|->
name|Addr
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a IPv4 device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextIPv4
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|IPv4_DEVICE_PATH
modifier|*
name|IPDevPath
decl_stmt|;
name|IPDevPath
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"IPv4("
argument_list|)
expr_stmt|;
name|CatIPv4Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|RemoteIpAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|DisplayOnly
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return ;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
name|CatNetworkProtocol
argument_list|(
name|Str
argument_list|,
name|IPDevPath
operator|->
name|Protocol
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",%s,"
argument_list|,
name|IPDevPath
operator|->
name|StaticIpAddress
condition|?
literal|"Static"
else|:
literal|"DHCP"
argument_list|)
expr_stmt|;
name|CatIPv4Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|LocalIpAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|DevicePathNodeLength
argument_list|(
name|IPDevPath
argument_list|)
operator|==
sizeof|sizeof
argument_list|(
name|IPv4_DEVICE_PATH
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
name|CatIPv4Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|GatewayIpAddress
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
name|CatIPv4Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|SubnetMask
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a IPv6 device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextIPv6
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|IPv6_DEVICE_PATH
modifier|*
name|IPDevPath
decl_stmt|;
name|IPDevPath
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"IPv6("
argument_list|)
expr_stmt|;
name|CatIPv6Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|RemoteIpAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|DisplayOnly
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return ;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
name|CatNetworkProtocol
argument_list|(
name|Str
argument_list|,
name|IPDevPath
operator|->
name|Protocol
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|IPDevPath
operator|->
name|IpAddressOrigin
condition|)
block|{
case|case
literal|0
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",Static,"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",StatelessAutoConfigure,"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",StatefulAutoConfigure,"
argument_list|)
expr_stmt|;
break|break;
block|}
name|CatIPv6Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|LocalIpAddress
argument_list|)
expr_stmt|;
if|if
condition|(
name|DevicePathNodeLength
argument_list|(
name|IPDevPath
argument_list|)
operator|==
sizeof|sizeof
argument_list|(
name|IPv6_DEVICE_PATH
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x%x,"
argument_list|,
name|IPDevPath
operator|->
name|PrefixLength
argument_list|)
expr_stmt|;
name|CatIPv6Address
argument_list|(
name|Str
argument_list|,
operator|&
name|IPDevPath
operator|->
name|GatewayIpAddress
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts an Infini Band device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextInfiniBand
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|INFINIBAND_DEVICE_PATH
modifier|*
name|InfiniBand
decl_stmt|;
name|InfiniBand
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Infiniband(0x%x,%36s,0x%lx,0x%lx,0x%lx)"
argument_list|,
name|InfiniBand
operator|->
name|ResourceFlags
argument_list|,
name|G
argument_list|(
name|InfiniBand
operator|->
name|PortGid
argument_list|)
argument_list|,
name|InfiniBand
operator|->
name|ServiceId
argument_list|,
name|InfiniBand
operator|->
name|TargetPortId
argument_list|,
name|InfiniBand
operator|->
name|DeviceId
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a UART device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUart
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|UART_DEVICE_PATH
modifier|*
name|Uart
decl_stmt|;
name|CHAR8
name|Parity
decl_stmt|;
name|Uart
operator|=
name|DevPath
expr_stmt|;
switch|switch
condition|(
name|Uart
operator|->
name|Parity
condition|)
block|{
case|case
literal|0
case|:
name|Parity
operator|=
literal|'D'
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|Parity
operator|=
literal|'N'
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|Parity
operator|=
literal|'E'
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|Parity
operator|=
literal|'O'
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|Parity
operator|=
literal|'M'
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|Parity
operator|=
literal|'S'
expr_stmt|;
break|break;
default|default:
name|Parity
operator|=
literal|'x'
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|Uart
operator|->
name|BaudRate
operator|==
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Uart(DEFAULT,"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Uart(%ld,"
argument_list|,
name|Uart
operator|->
name|BaudRate
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Uart
operator|->
name|DataBits
operator|==
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"DEFAULT,"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%d,"
argument_list|,
name|Uart
operator|->
name|DataBits
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%c,"
argument_list|,
name|Parity
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|Uart
operator|->
name|StopBits
condition|)
block|{
case|case
literal|0
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"D)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"1)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"1.5)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"2)"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"x)"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/**   Converts an iSCSI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextiSCSI
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|ISCSI_DEVICE_PATH_WITH_NAME
modifier|*
name|ISCSIDevPath
decl_stmt|;
name|UINT16
name|Options
decl_stmt|;
name|ISCSIDevPath
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"iSCSI(%s,0x%x,0x%lx,"
argument_list|,
name|ISCSIDevPath
operator|->
name|TargetName
argument_list|,
name|ISCSIDevPath
operator|->
name|TargetPortalGroupTag
argument_list|,
name|ISCSIDevPath
operator|->
name|Lun
argument_list|)
expr_stmt|;
name|Options
operator|=
name|ISCSIDevPath
operator|->
name|LoginOption
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
operator|(
operator|(
operator|(
name|Options
operator|>>
literal|1
operator|)
operator|&
literal|0x0001
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"CRC32C"
else|:
literal|"None"
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
operator|(
operator|(
operator|(
name|Options
operator|>>
literal|3
operator|)
operator|&
literal|0x0001
operator|)
operator|!=
literal|0
operator|)
condition|?
literal|"CRC32C"
else|:
literal|"None"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|Options
operator|>>
literal|11
operator|)
operator|&
literal|0x0001
operator|)
operator|!=
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
literal|"None"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
name|Options
operator|>>
literal|12
operator|)
operator|&
literal|0x0001
operator|)
operator|!=
literal|0
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
literal|"CHAP_UNI"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s,"
argument_list|,
literal|"CHAP_BI"
argument_list|)
expr_stmt|;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s)"
argument_list|,
operator|(
name|ISCSIDevPath
operator|->
name|NetworkProtocol
operator|==
literal|0
operator|)
condition|?
literal|"TCP"
else|:
literal|"reserved"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a VLAN device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextVlan
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|VLAN_DEVICE_PATH
modifier|*
name|Vlan
decl_stmt|;
name|Vlan
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Vlan(%d)"
argument_list|,
name|Vlan
operator|->
name|VlanId
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Bluetooth device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextBluetooth
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|BLUETOOTH_DEVICE_PATH
modifier|*
name|Bluetooth
decl_stmt|;
name|Bluetooth
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Bluetooth(%02x%02x%02x%02x%02x%02x)"
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|5
index|]
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|4
index|]
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|3
index|]
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|2
index|]
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|1
index|]
argument_list|,
name|Bluetooth
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Wi-Fi device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextWiFi
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|WIFI_DEVICE_PATH
modifier|*
name|WiFi
decl_stmt|;
name|UINT8
name|SSId
index|[
literal|33
index|]
decl_stmt|;
name|WiFi
operator|=
name|DevPath
expr_stmt|;
name|SSId
index|[
literal|32
index|]
operator|=
literal|'\0'
expr_stmt|;
name|CopyMem
argument_list|(
name|SSId
argument_list|,
name|WiFi
operator|->
name|SSId
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Wi-Fi(%s)"
argument_list|,
name|SSId
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a URI device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextUri
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|URI_DEVICE_PATH
modifier|*
name|Uri
decl_stmt|;
name|UINTN
name|UriLength
decl_stmt|;
name|CHAR8
modifier|*
name|UriStr
decl_stmt|;
comment|//
comment|// Uri in the device path may not be null terminated.
comment|//
name|Uri
operator|=
name|DevPath
expr_stmt|;
name|UriLength
operator|=
name|DevicePathNodeLength
argument_list|(
name|Uri
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
name|URI_DEVICE_PATH
argument_list|)
expr_stmt|;
name|UriStr
operator|=
name|AllocatePool
argument_list|(
name|UriLength
operator|+
literal|1
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|UriStr
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|CopyMem
argument_list|(
name|UriStr
argument_list|,
name|Uri
operator|->
name|Uri
argument_list|,
name|UriLength
argument_list|)
expr_stmt|;
name|UriStr
index|[
name|UriLength
index|]
operator|=
literal|'\0'
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Uri(%s)"
argument_list|,
name|UriStr
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|UriStr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Hard drive device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextHardDrive
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|HARDDRIVE_DEVICE_PATH
modifier|*
name|Hd
decl_stmt|;
name|Hd
operator|=
name|DevPath
expr_stmt|;
switch|switch
condition|(
name|Hd
operator|->
name|SignatureType
condition|)
block|{
case|case
name|SIGNATURE_TYPE_MBR
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"HD(%d,%s,0x%08x,"
argument_list|,
name|Hd
operator|->
name|PartitionNumber
argument_list|,
literal|"MBR"
argument_list|,
comment|//      *((UINT32 *) (&(Hd->Signature[0])))
name|le32dec
argument_list|(
operator|&
operator|(
name|Hd
operator|->
name|Signature
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SIGNATURE_TYPE_GUID
case|:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"HD(%d,%s,%36s,"
argument_list|,
name|Hd
operator|->
name|PartitionNumber
argument_list|,
literal|"GPT"
argument_list|,
name|G
argument_list|(
operator|&
operator|(
name|Hd
operator|->
name|Signature
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"HD(%d,%d,0,"
argument_list|,
name|Hd
operator|->
name|PartitionNumber
argument_list|,
name|Hd
operator|->
name|SignatureType
argument_list|)
expr_stmt|;
break|break;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"0x%lx,0x%lx)"
argument_list|,
name|Hd
operator|->
name|PartitionStart
argument_list|,
name|Hd
operator|->
name|PartitionSize
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a CDROM device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextCDROM
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|CDROM_DEVICE_PATH
modifier|*
name|Cd
decl_stmt|;
name|Cd
operator|=
name|DevPath
expr_stmt|;
if|if
condition|(
name|DisplayOnly
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"CDROM(0x%x)"
argument_list|,
name|Cd
operator|->
name|BootEntry
argument_list|)
expr_stmt|;
return|return ;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"CDROM(0x%x,0x%lx,0x%lx)"
argument_list|,
name|Cd
operator|->
name|BootEntry
argument_list|,
name|Cd
operator|->
name|PartitionStart
argument_list|,
name|Cd
operator|->
name|PartitionSize
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a File device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextFilePath
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|FILEPATH_DEVICE_PATH
modifier|*
name|Fp
decl_stmt|;
name|Fp
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s"
argument_list|,
name|Fp
operator|->
name|PathName
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Media protocol device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextMediaProtocol
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEDIA_PROTOCOL_DEVICE_PATH
modifier|*
name|MediaProt
decl_stmt|;
name|MediaProt
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Media(%36s)"
argument_list|,
name|G
argument_list|(
operator|&
name|MediaProt
operator|->
name|Protocol
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Firmware Volume device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextFv
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEDIA_FW_VOL_DEVICE_PATH
modifier|*
name|Fv
decl_stmt|;
name|Fv
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Fv(%36s)"
argument_list|,
name|G
argument_list|(
operator|&
name|Fv
operator|->
name|FvName
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Firmware Volume File device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextFvFile
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEDIA_FW_VOL_FILEPATH_DEVICE_PATH
modifier|*
name|FvFile
decl_stmt|;
name|FvFile
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"FvFile(%36s)"
argument_list|,
name|G
argument_list|(
operator|&
name|FvFile
operator|->
name|FvFileName
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Relative Offset device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathRelativeOffsetRange
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEDIA_RELATIVE_OFFSET_RANGE_DEVICE_PATH
modifier|*
name|Offset
decl_stmt|;
name|Offset
operator|=
name|DevPath
expr_stmt|;
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Offset(0x%lx,0x%lx)"
argument_list|,
name|Offset
operator|->
name|StartingOffset
argument_list|,
name|Offset
operator|->
name|EndingOffset
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a Ram Disk device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextRamDisk
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|RamDisk
operator|=
name|DevPath
expr_stmt|;
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiVirtualDiskGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VirtualDisk(0x%lx,0x%lx,%d)"
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
argument_list|,
name|RamDisk
operator|->
name|Instance
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiVirtualCdGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"VirtualCD(0x%lx,0x%lx,%d)"
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
argument_list|,
name|RamDisk
operator|->
name|Instance
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiPersistentVirtualDiskGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"PersistentVirtualDisk(0x%lx,0x%lx,%d)"
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
argument_list|,
name|RamDisk
operator|->
name|Instance
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|CompareGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiPersistentVirtualCdGuid
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"PersistentVirtualCD(0x%lx,0x%lx,%d)"
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
argument_list|,
name|RamDisk
operator|->
name|Instance
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"RamDisk(0x%lx,0x%lx,%d,%36s)"
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
argument_list|,
name|LShiftU64
argument_list|(
operator|(
name|UINT64
operator|)
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|1
index|]
argument_list|,
literal|32
argument_list|)
operator||
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
argument_list|,
name|RamDisk
operator|->
name|Instance
argument_list|,
name|G
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**   Converts a BIOS Boot Specification device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextBBS
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|BBS_BBS_DEVICE_PATH
modifier|*
name|Bbs
decl_stmt|;
specifier|const
name|char
modifier|*
name|Type
decl_stmt|;
name|Bbs
operator|=
name|DevPath
expr_stmt|;
switch|switch
condition|(
name|Bbs
operator|->
name|DeviceType
condition|)
block|{
case|case
name|BBS_TYPE_FLOPPY
case|:
name|Type
operator|=
literal|"Floppy"
expr_stmt|;
break|break;
case|case
name|BBS_TYPE_HARDDRIVE
case|:
name|Type
operator|=
literal|"HD"
expr_stmt|;
break|break;
case|case
name|BBS_TYPE_CDROM
case|:
name|Type
operator|=
literal|"CDROM"
expr_stmt|;
break|break;
case|case
name|BBS_TYPE_PCMCIA
case|:
name|Type
operator|=
literal|"PCMCIA"
expr_stmt|;
break|break;
case|case
name|BBS_TYPE_USB
case|:
name|Type
operator|=
literal|"USB"
expr_stmt|;
break|break;
case|case
name|BBS_TYPE_EMBEDDED_NETWORK
case|:
name|Type
operator|=
literal|"Network"
expr_stmt|;
break|break;
default|default:
name|Type
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|Type
operator|!=
name|NULL
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"BBS(%s,%s"
argument_list|,
name|Type
argument_list|,
name|Bbs
operator|->
name|String
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"BBS(0x%x,%s"
argument_list|,
name|Bbs
operator|->
name|DeviceType
argument_list|,
name|Bbs
operator|->
name|String
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|DisplayOnly
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
return|return ;
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|",0x%x)"
argument_list|,
name|Bbs
operator|->
name|StatusFlag
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts an End-of-Device-Path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextEndInstance
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|GLOBAL_REMOVE_IF_UNREFERENCED
specifier|const
name|DEVICE_PATH_TO_TEXT_GENERIC_TABLE
name|mUefiDevicePathLibToTextTableGeneric
index|[]
init|=
block|{
block|{
name|HARDWARE_DEVICE_PATH
block|,
literal|"HardwarePath"
block|}
block|,
block|{
name|ACPI_DEVICE_PATH
block|,
literal|"AcpiPath"
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
literal|"Msg"
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
literal|"MediaPath"
block|}
block|,
block|{
name|BBS_DEVICE_PATH
block|,
literal|"BbsPath"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**   Converts an unknown device path structure to its string representative.    @param Str             The string representative of input device.   @param DevPath         The input device path structure.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.  **/
end_comment

begin_function
specifier|static
name|VOID
name|DevPathToTextNodeGeneric
parameter_list|(
name|IN
name|OUT
name|POOL_PRINT
modifier|*
name|Str
parameter_list|,
name|IN
name|VOID
modifier|*
name|DevPath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|Node
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|Node
operator|=
name|DevPath
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|mUefiDevicePathLibToTextTableGeneric
index|[
name|Index
index|]
operator|.
name|Text
operator|!=
name|NULL
condition|;
name|Index
operator|++
control|)
block|{
if|if
condition|(
name|DevicePathType
argument_list|(
name|Node
argument_list|)
operator|==
name|mUefiDevicePathLibToTextTableGeneric
index|[
name|Index
index|]
operator|.
name|Type
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|mUefiDevicePathLibToTextTableGeneric
index|[
name|Index
index|]
operator|.
name|Text
operator|==
name|NULL
condition|)
block|{
comment|//
comment|// It's a node whose type cannot be recognized
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"Path(%d,%d"
argument_list|,
name|DevicePathType
argument_list|(
name|Node
argument_list|)
argument_list|,
name|DevicePathSubType
argument_list|(
name|Node
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|//
comment|// It's a node whose type can be recognized
comment|//
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%s(%d"
argument_list|,
name|mUefiDevicePathLibToTextTableGeneric
index|[
name|Index
index|]
operator|.
name|Text
argument_list|,
name|DevicePathSubType
argument_list|(
name|Node
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|Index
operator|=
sizeof|sizeof
argument_list|(
name|EFI_DEVICE_PATH_PROTOCOL
argument_list|)
expr_stmt|;
if|if
condition|(
name|Index
operator|<
name|DevicePathNodeLength
argument_list|(
name|Node
argument_list|)
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|","
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|Index
operator|<
name|DevicePathNodeLength
argument_list|(
name|Node
argument_list|)
condition|;
name|Index
operator|++
control|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|"%02x"
argument_list|,
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|Node
operator|)
index|[
name|Index
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|UefiDevicePathLibCatPrint
argument_list|(
name|Str
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|DEVICE_PATH_TO_TEXT_TABLE
name|mUefiDevicePathLibToTextTable
index|[]
init|=
block|{
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_PCI_DP
block|,
name|DevPathToTextPci
block|}
block|,
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_PCCARD_DP
block|,
name|DevPathToTextPccard
block|}
block|,
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_MEMMAP_DP
block|,
name|DevPathToTextMemMap
block|}
block|,
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_VENDOR_DP
block|,
name|DevPathToTextVendor
block|}
block|,
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_CONTROLLER_DP
block|,
name|DevPathToTextController
block|}
block|,
block|{
name|HARDWARE_DEVICE_PATH
block|,
name|HW_BMC_DP
block|,
name|DevPathToTextBmc
block|}
block|,
block|{
name|ACPI_DEVICE_PATH
block|,
name|ACPI_DP
block|,
name|DevPathToTextAcpi
block|}
block|,
block|{
name|ACPI_DEVICE_PATH
block|,
name|ACPI_EXTENDED_DP
block|,
name|DevPathToTextAcpiEx
block|}
block|,
block|{
name|ACPI_DEVICE_PATH
block|,
name|ACPI_ADR_DP
block|,
name|DevPathToTextAcpiAdr
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_ATAPI_DP
block|,
name|DevPathToTextAtapi
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_SCSI_DP
block|,
name|DevPathToTextScsi
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_FIBRECHANNEL_DP
block|,
name|DevPathToTextFibre
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_FIBRECHANNELEX_DP
block|,
name|DevPathToTextFibreEx
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_SASEX_DP
block|,
name|DevPathToTextSasEx
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_NVME_NAMESPACE_DP
block|,
name|DevPathToTextNVMe
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_UFS_DP
block|,
name|DevPathToTextUfs
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_SD_DP
block|,
name|DevPathToTextSd
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_EMMC_DP
block|,
name|DevPathToTextEmmc
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_1394_DP
block|,
name|DevPathToText1394
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_USB_DP
block|,
name|DevPathToTextUsb
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_USB_WWID_DP
block|,
name|DevPathToTextUsbWWID
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_DEVICE_LOGICAL_UNIT_DP
block|,
name|DevPathToTextLogicalUnit
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_USB_CLASS_DP
block|,
name|DevPathToTextUsbClass
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_SATA_DP
block|,
name|DevPathToTextSata
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_I2O_DP
block|,
name|DevPathToTextI2O
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_MAC_ADDR_DP
block|,
name|DevPathToTextMacAddr
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_IPv4_DP
block|,
name|DevPathToTextIPv4
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_IPv6_DP
block|,
name|DevPathToTextIPv6
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_INFINIBAND_DP
block|,
name|DevPathToTextInfiniBand
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_UART_DP
block|,
name|DevPathToTextUart
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_VENDOR_DP
block|,
name|DevPathToTextVendor
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_ISCSI_DP
block|,
name|DevPathToTextiSCSI
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_VLAN_DP
block|,
name|DevPathToTextVlan
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_URI_DP
block|,
name|DevPathToTextUri
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_BLUETOOTH_DP
block|,
name|DevPathToTextBluetooth
block|}
block|,
block|{
name|MESSAGING_DEVICE_PATH
block|,
name|MSG_WIFI_DP
block|,
name|DevPathToTextWiFi
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_HARDDRIVE_DP
block|,
name|DevPathToTextHardDrive
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_CDROM_DP
block|,
name|DevPathToTextCDROM
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_VENDOR_DP
block|,
name|DevPathToTextVendor
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_PROTOCOL_DP
block|,
name|DevPathToTextMediaProtocol
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_FILEPATH_DP
block|,
name|DevPathToTextFilePath
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_PIWG_FW_VOL_DP
block|,
name|DevPathToTextFv
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_PIWG_FW_FILE_DP
block|,
name|DevPathToTextFvFile
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_RELATIVE_OFFSET_RANGE_DP
block|,
name|DevPathRelativeOffsetRange
block|}
block|,
block|{
name|MEDIA_DEVICE_PATH
block|,
name|MEDIA_RAM_DISK_DP
block|,
name|DevPathToTextRamDisk
block|}
block|,
block|{
name|BBS_DEVICE_PATH
block|,
name|BBS_BBS_DP
block|,
name|DevPathToTextBBS
block|}
block|,
block|{
name|END_DEVICE_PATH_TYPE
block|,
name|END_INSTANCE_DEVICE_PATH_SUBTYPE
block|,
name|DevPathToTextEndInstance
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|__FreeBSD__
end_ifndef

begin_comment
comment|/**   Converts a device node to its string representation.    @param DeviceNode        A Pointer to the device node to be converted.   @param DisplayOnly       If DisplayOnly is TRUE, then the shorter text representation                            of the display node is used, where applicable. If DisplayOnly                            is FALSE, then the longer text representation of the display node                            is used.   @param AllowShortcuts    If AllowShortcuts is TRUE, then the shortcut forms of text                            representation for a device node can be used, where applicable.    @return A pointer to the allocated text representation of the device node or NULL if DeviceNode           is NULL or there was insufficient memory.  **/
end_comment

begin_function
name|CHAR16
modifier|*
name|EFIAPI
name|UefiDevicePathLibConvertDeviceNodeToText
parameter_list|(
name|IN
name|CONST
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DeviceNode
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|POOL_PRINT
name|Str
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|DEVICE_PATH_TO_TEXT
name|ToText
decl_stmt|;
if|if
condition|(
name|DeviceNode
operator|==
name|NULL
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ZeroMem
argument_list|(
operator|&
name|Str
argument_list|,
sizeof|sizeof
argument_list|(
name|Str
argument_list|)
argument_list|)
expr_stmt|;
comment|//
comment|// Process the device path node
comment|// If not found, use a generic function
comment|//
name|ToText
operator|=
name|DevPathToTextNodeGeneric
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Function
operator|!=
name|NULL
condition|;
name|Index
operator|++
control|)
block|{
if|if
condition|(
name|DevicePathType
argument_list|(
name|DeviceNode
argument_list|)
operator|==
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Type
operator|&&
name|DevicePathSubType
argument_list|(
name|DeviceNode
argument_list|)
operator|==
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|SubType
condition|)
block|{
name|ToText
operator|=
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Function
expr_stmt|;
break|break;
block|}
block|}
comment|//
comment|// Print this node
comment|//
name|ToText
argument_list|(
operator|&
name|Str
argument_list|,
operator|(
name|VOID
operator|*
operator|)
name|DeviceNode
argument_list|,
name|DisplayOnly
argument_list|,
name|AllowShortcuts
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|Str
operator|.
name|Str
operator|!=
name|NULL
argument_list|)
expr_stmt|;
return|return
name|Str
operator|.
name|Str
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**   Converts a device path to its text representation.    @param DevicePath      A Pointer to the device to be converted.   @param DisplayOnly     If DisplayOnly is TRUE, then the shorter text representation                          of the display node is used, where applicable. If DisplayOnly                          is FALSE, then the longer text representation of the display node                          is used.   @param AllowShortcuts  If AllowShortcuts is TRUE, then the shortcut forms of text                          representation for a device node can be used, where applicable.    @return A pointer to the allocated text representation of the device path or           NULL if DeviceNode is NULL or there was insufficient memory.  **/
end_comment

begin_function
specifier|static
name|char
modifier|*
name|EFIAPI
name|UefiDevicePathLibConvertDevicePathToText
parameter_list|(
name|IN
name|CONST
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevicePath
parameter_list|,
name|IN
name|BOOLEAN
name|DisplayOnly
parameter_list|,
name|IN
name|BOOLEAN
name|AllowShortcuts
parameter_list|)
block|{
name|POOL_PRINT
name|Str
decl_stmt|;
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|Node
decl_stmt|;
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|AlignedNode
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|DEVICE_PATH_TO_TEXT
name|ToText
decl_stmt|;
if|if
condition|(
name|DevicePath
operator|==
name|NULL
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ZeroMem
argument_list|(
operator|&
name|Str
argument_list|,
sizeof|sizeof
argument_list|(
name|Str
argument_list|)
argument_list|)
expr_stmt|;
comment|//
comment|// Process each device path node
comment|//
name|Node
operator|=
name|__DECONST
argument_list|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
argument_list|,
name|DevicePath
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|IsDevicePathEnd
argument_list|(
name|Node
argument_list|)
condition|)
block|{
comment|//
comment|// Find the handler to dump this device path node
comment|// If not found, use a generic function
comment|//
name|ToText
operator|=
name|DevPathToTextNodeGeneric
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Function
operator|!=
name|NULL
condition|;
name|Index
operator|+=
literal|1
control|)
block|{
if|if
condition|(
name|DevicePathType
argument_list|(
name|Node
argument_list|)
operator|==
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Type
operator|&&
name|DevicePathSubType
argument_list|(
name|Node
argument_list|)
operator|==
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|SubType
condition|)
block|{
name|ToText
operator|=
name|mUefiDevicePathLibToTextTable
index|[
name|Index
index|]
operator|.
name|Function
expr_stmt|;
break|break;
block|}
block|}
comment|//
comment|//  Put a path separator in if needed
comment|//
if|if
condition|(
operator|(
name|Str
operator|.
name|Count
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|ToText
operator|!=
name|DevPathToTextEndInstance
operator|)
condition|)
block|{
if|if
condition|(
name|Str
operator|.
name|Str
index|[
name|Str
operator|.
name|Count
index|]
operator|!=
literal|','
condition|)
block|{
name|UefiDevicePathLibCatPrint
argument_list|(
operator|&
name|Str
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
block|}
block|}
name|AlignedNode
operator|=
name|AllocateCopyPool
argument_list|(
name|DevicePathNodeLength
argument_list|(
name|Node
argument_list|)
argument_list|,
name|Node
argument_list|)
expr_stmt|;
comment|//
comment|// Print this node of the device path
comment|//
name|ToText
argument_list|(
operator|&
name|Str
argument_list|,
name|AlignedNode
argument_list|,
name|DisplayOnly
argument_list|,
name|AllowShortcuts
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|AlignedNode
argument_list|)
expr_stmt|;
comment|//
comment|// Next device path node
comment|//
name|Node
operator|=
name|NextDevicePathNode
argument_list|(
name|Node
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Str
operator|.
name|Str
operator|==
name|NULL
condition|)
block|{
return|return
name|AllocateZeroPool
argument_list|(
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|Str
operator|.
name|Str
return|;
block|}
block|}
end_function

begin_function
name|ssize_t
name|efidp_format_device_path
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|len
parameter_list|,
name|const_efidp
name|dp
parameter_list|,
name|ssize_t
name|max
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|ssize_t
name|retval
decl_stmt|;
name|str
operator|=
name|UefiDevicePathLibConvertDevicePathToText
argument_list|(
name|__DECONST
argument_list|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
argument_list|,
name|dp
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|str
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|strlcpy
argument_list|(
name|buf
argument_list|,
name|str
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|retval
operator|=
name|strlen
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|str
argument_list|)
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

end_unit

