begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2017 Netflix, Inc.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer  *    in this position and unchanged.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * Routines to format EFI_DEVICE_PATHs from the UEFI standard. Much of  * this file is taken from EDK2 and rototilled.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<efivar.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<wchar.h>
end_include

begin_include
include|#
directive|include
file|"efi-osdep.h"
end_include

begin_include
include|#
directive|include
file|"efivar-dp.h"
end_include

begin_include
include|#
directive|include
file|"uefi-dplib.h"
end_include

begin_comment
comment|/* XXX STUBS -- this stuff doesn't work yet */
end_comment

begin_define
define|#
directive|define
name|StrToIpv4Address
parameter_list|(
name|str
parameter_list|,
name|unk
parameter_list|,
name|ipv4ptr
parameter_list|,
name|unk2
parameter_list|)
end_define

begin_define
define|#
directive|define
name|StrToIpv6Address
parameter_list|(
name|str
parameter_list|,
name|unk
parameter_list|,
name|ipv6ptr
parameter_list|,
name|unk2
parameter_list|)
end_define

begin_comment
comment|/*  * OK. Now this is evil. Can't typedef it again. Sure beats changing them all.  * Since we're doing it all as narrow characters since wchar_t can't be used on  * FreeBSD and CHAR16 strings generally aren't a good fit. Since this parsing  * doesn't need Unicode for anything, this works out well.  */
end_comment

begin_define
define|#
directive|define
name|CHAR16
value|char
end_define

begin_comment
comment|/*  * Taken from MdePkg/Library/UefiDevicePathLib/DevicePathFromText.c  * hash a11928f3310518ab1c6fd34e8d0fdbb72de9602c 2017-Mar-01  */
end_comment

begin_comment
comment|/** @file   DevicePathFromText protocol as defined in the UEFI 2.0 specification.  Copyright (c) 2013 - 2017, Intel Corporation. All rights reserved.<BR> This program and the accompanying materials are licensed and made available under the terms and conditions of the BSD License which accompanies this distribution.  The full text of the license may be found at http://opensource.org/licenses/bsd-license.php  THE PROGRAM IS DISTRIBUTED UNDER THE BSD LICENSE ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.  **/
end_comment

begin_comment
comment|// #include "UefiDevicePathLib.h"
end_comment

begin_comment
comment|/**    Duplicates a string.    @param  Src  Source string.    @return The duplicated string.  **/
end_comment

begin_function
specifier|static
name|CHAR16
modifier|*
name|UefiDevicePathLibStrDuplicate
parameter_list|(
name|IN
name|CONST
name|CHAR16
modifier|*
name|Src
parameter_list|)
block|{
return|return
name|AllocateCopyPool
argument_list|(
name|StrSize
argument_list|(
name|Src
argument_list|)
argument_list|,
name|Src
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    Get parameter in a pair of parentheses follow the given node name.   For example, given the "Pci(0,1)" and NodeName "Pci", it returns "0,1".    @param  Str      Device Path Text.   @param  NodeName Name of the node.    @return Parameter text for the node.  **/
end_comment

begin_function
specifier|static
name|CHAR16
modifier|*
name|GetParamByNodeName
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Str
parameter_list|,
name|IN
specifier|const
name|CHAR16
modifier|*
name|NodeName
parameter_list|)
block|{
name|CHAR16
modifier|*
name|ParamStr
decl_stmt|;
name|CHAR16
modifier|*
name|StrPointer
decl_stmt|;
name|UINTN
name|NodeNameLength
decl_stmt|;
name|UINTN
name|ParameterLength
decl_stmt|;
comment|//
comment|// Check whether the node name matchs
comment|//
name|NodeNameLength
operator|=
name|StrLen
argument_list|(
name|NodeName
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrnCmp
argument_list|(
name|Str
argument_list|,
name|NodeName
argument_list|,
name|NodeNameLength
argument_list|)
operator|!=
literal|0
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ParamStr
operator|=
name|Str
operator|+
name|NodeNameLength
expr_stmt|;
if|if
condition|(
operator|!
name|IS_LEFT_PARENTH
argument_list|(
operator|*
name|ParamStr
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|//
comment|// Skip the found '(' and find first occurrence of ')'
comment|//
name|ParamStr
operator|++
expr_stmt|;
name|ParameterLength
operator|=
literal|0
expr_stmt|;
name|StrPointer
operator|=
name|ParamStr
expr_stmt|;
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|StrPointer
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_RIGHT_PARENTH
argument_list|(
operator|*
name|StrPointer
argument_list|)
condition|)
block|{
break|break;
block|}
name|StrPointer
operator|++
expr_stmt|;
name|ParameterLength
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|IS_NULL
argument_list|(
operator|*
name|StrPointer
argument_list|)
condition|)
block|{
comment|//
comment|// ')' not found
comment|//
return|return
name|NULL
return|;
block|}
name|ParamStr
operator|=
name|AllocateCopyPool
argument_list|(
operator|(
name|ParameterLength
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|,
name|ParamStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|ParamStr
operator|==
name|NULL
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|//
comment|// Terminate the parameter string
comment|//
name|ParamStr
index|[
name|ParameterLength
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
name|ParamStr
return|;
block|}
end_function

begin_comment
comment|/**   Gets current sub-string from a string list, before return   the list header is moved to next sub-string. The sub-string is separated   by the specified character. For example, the separator is ',', the string   list is "2,0,3", it returns "2", the remain list move to "0,3"    @param  List        A string list separated by the specified separator   @param  Separator   The separator character    @return A pointer to the current sub-string  **/
end_comment

begin_function
specifier|static
name|CHAR16
modifier|*
name|SplitStr
parameter_list|(
name|IN
name|OUT
name|CHAR16
modifier|*
modifier|*
name|List
parameter_list|,
name|IN
name|CHAR16
name|Separator
parameter_list|)
block|{
name|CHAR16
modifier|*
name|Str
decl_stmt|;
name|CHAR16
modifier|*
name|ReturnStr
decl_stmt|;
name|Str
operator|=
operator|*
name|List
expr_stmt|;
name|ReturnStr
operator|=
name|Str
expr_stmt|;
if|if
condition|(
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
return|return
name|ReturnStr
return|;
block|}
comment|//
comment|// Find first occurrence of the separator
comment|//
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
if|if
condition|(
operator|*
name|Str
operator|==
name|Separator
condition|)
block|{
break|break;
block|}
name|Str
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|Str
operator|==
name|Separator
condition|)
block|{
comment|//
comment|// Find a sub-string, terminate it
comment|//
operator|*
name|Str
operator|=
literal|'\0'
expr_stmt|;
name|Str
operator|++
expr_stmt|;
block|}
comment|//
comment|// Move to next sub-string
comment|//
operator|*
name|List
operator|=
name|Str
expr_stmt|;
return|return
name|ReturnStr
return|;
block|}
end_function

begin_comment
comment|/**   Gets the next parameter string from the list.    @param List            A string list separated by the specified separator    @return A pointer to the current sub-string  **/
end_comment

begin_function
specifier|static
name|CHAR16
modifier|*
name|GetNextParamStr
parameter_list|(
name|IN
name|OUT
name|CHAR16
modifier|*
modifier|*
name|List
parameter_list|)
block|{
comment|//
comment|// The separator is comma
comment|//
return|return
name|SplitStr
argument_list|(
name|List
argument_list|,
literal|','
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Get one device node from entire device path text.    @param DevicePath      On input, the current Device Path node; on output, the next device path node   @param IsInstanceEnd   This node is the end of a device path instance    @return A device node text or NULL if no more device node available  **/
end_comment

begin_function
specifier|static
name|CHAR16
modifier|*
name|GetNextDeviceNodeStr
parameter_list|(
name|IN
name|OUT
name|CHAR16
modifier|*
modifier|*
name|DevicePath
parameter_list|,
name|OUT
name|BOOLEAN
modifier|*
name|IsInstanceEnd
parameter_list|)
block|{
name|CHAR16
modifier|*
name|Str
decl_stmt|;
name|CHAR16
modifier|*
name|ReturnStr
decl_stmt|;
name|UINTN
name|ParenthesesStack
decl_stmt|;
name|Str
operator|=
operator|*
name|DevicePath
expr_stmt|;
if|if
condition|(
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|//
comment|// Skip the leading '/', '(', ')' and ','
comment|//
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|IS_SLASH
argument_list|(
operator|*
name|Str
argument_list|)
operator|&&
operator|!
name|IS_COMMA
argument_list|(
operator|*
name|Str
argument_list|)
operator|&&
operator|!
name|IS_LEFT_PARENTH
argument_list|(
operator|*
name|Str
argument_list|)
operator|&&
operator|!
name|IS_RIGHT_PARENTH
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
break|break;
block|}
name|Str
operator|++
expr_stmt|;
block|}
name|ReturnStr
operator|=
name|Str
expr_stmt|;
comment|//
comment|// Scan for the separator of this device node, '/' or ','
comment|//
name|ParenthesesStack
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|IS_COMMA
argument_list|(
operator|*
name|Str
argument_list|)
operator|||
name|IS_SLASH
argument_list|(
operator|*
name|Str
argument_list|)
operator|)
operator|&&
operator|(
name|ParenthesesStack
operator|==
literal|0
operator|)
condition|)
block|{
break|break;
block|}
if|if
condition|(
name|IS_LEFT_PARENTH
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
name|ParenthesesStack
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_RIGHT_PARENTH
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
name|ParenthesesStack
operator|--
expr_stmt|;
block|}
name|Str
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|ParenthesesStack
operator|!=
literal|0
condition|)
block|{
comment|//
comment|// The '(' doesn't pair with ')', invalid device path text
comment|//
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|IS_COMMA
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
operator|*
name|IsInstanceEnd
operator|=
name|TRUE
expr_stmt|;
operator|*
name|Str
operator|=
literal|'\0'
expr_stmt|;
name|Str
operator|++
expr_stmt|;
block|}
else|else
block|{
operator|*
name|IsInstanceEnd
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
operator|*
name|Str
operator|=
literal|'\0'
expr_stmt|;
name|Str
operator|++
expr_stmt|;
block|}
block|}
operator|*
name|DevicePath
operator|=
name|Str
expr_stmt|;
return|return
name|ReturnStr
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|__FreeBSD__
end_ifndef

begin_comment
comment|/**   Return whether the integer string is a hex string.    @param Str             The integer string    @retval TRUE   Hex string   @retval FALSE  Decimal string  **/
end_comment

begin_function
specifier|static
name|BOOLEAN
name|IsHexStr
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Str
parameter_list|)
block|{
comment|//
comment|// skip preceeding white space
comment|//
while|while
condition|(
operator|(
operator|*
name|Str
operator|!=
literal|0
operator|)
operator|&&
operator|*
name|Str
operator|==
literal|' '
condition|)
block|{
name|Str
operator|++
expr_stmt|;
block|}
comment|//
comment|// skip preceeding zeros
comment|//
while|while
condition|(
operator|(
operator|*
name|Str
operator|!=
literal|0
operator|)
operator|&&
operator|*
name|Str
operator|==
literal|'0'
condition|)
block|{
name|Str
operator|++
expr_stmt|;
block|}
return|return
call|(
name|BOOLEAN
call|)
argument_list|(
operator|*
name|Str
operator|==
literal|'x'
operator|||
operator|*
name|Str
operator|==
literal|'X'
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    Convert integer string to uint.    @param Str             The integer string. If leading with "0x" or "0X", it's hexadecimal.    @return A UINTN value represented by Str  **/
end_comment

begin_function
specifier|static
name|UINTN
name|Strtoi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Str
parameter_list|)
block|{
if|if
condition|(
name|IsHexStr
argument_list|(
name|Str
argument_list|)
condition|)
block|{
return|return
name|StrHexToUintn
argument_list|(
name|Str
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|StrDecimalToUintn
argument_list|(
name|Str
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/**    Convert integer string to 64 bit data.    @param Str             The integer string. If leading with "0x" or "0X", it's hexadecimal.   @param Data            A pointer to the UINT64 value represented by Str  **/
end_comment

begin_function
specifier|static
name|VOID
name|Strtoi64
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Str
parameter_list|,
name|OUT
name|UINT64
modifier|*
name|Data
parameter_list|)
block|{
if|if
condition|(
name|IsHexStr
argument_list|(
name|Str
argument_list|)
condition|)
block|{
operator|*
name|Data
operator|=
name|StrHexToUint64
argument_list|(
name|Str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|Data
operator|=
name|StrDecimalToUint64
argument_list|(
name|Str
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**   Converts a Unicode string to ASCII string.    @param Str             The equivalent Unicode string   @param AsciiStr        On input, it points to destination ASCII string buffer; on output, it points                          to the next ASCII string next to it  **/
end_comment

begin_function
specifier|static
name|VOID
name|StrToAscii
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Str
parameter_list|,
name|IN
name|OUT
name|CHAR8
modifier|*
modifier|*
name|AsciiStr
parameter_list|)
block|{
name|CHAR8
modifier|*
name|Dest
decl_stmt|;
name|Dest
operator|=
operator|*
name|AsciiStr
expr_stmt|;
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Str
argument_list|)
condition|)
block|{
operator|*
operator|(
name|Dest
operator|++
operator|)
operator|=
operator|(
name|CHAR8
operator|)
operator|*
operator|(
name|Str
operator|++
operator|)
expr_stmt|;
block|}
operator|*
name|Dest
operator|=
literal|0
expr_stmt|;
comment|//
comment|// Return the string next to it
comment|//
operator|*
name|AsciiStr
operator|=
name|Dest
operator|+
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   Converts a generic text device path node to device path structure.    @param Type            The type of the device path node.   @param TextDeviceNode  The input text device path node.    @return A pointer to device path structure. **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextGenericPath
parameter_list|(
name|IN
name|UINT8
name|Type
parameter_list|,
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|Node
decl_stmt|;
name|CHAR16
modifier|*
name|SubtypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|DataStr
decl_stmt|;
name|UINTN
name|DataLength
decl_stmt|;
name|SubtypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DataStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|DataStr
operator|==
name|NULL
condition|)
block|{
name|DataLength
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|DataLength
operator|=
name|StrLen
argument_list|(
name|DataStr
argument_list|)
operator|/
literal|2
expr_stmt|;
block|}
name|Node
operator|=
name|CreateDeviceNode
argument_list|(
name|Type
argument_list|,
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|SubtypeStr
argument_list|)
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|EFI_DEVICE_PATH_PROTOCOL
argument_list|)
operator|+
name|DataLength
argument_list|)
argument_list|)
expr_stmt|;
name|StrHexToBytes
argument_list|(
name|DataStr
argument_list|,
name|DataLength
operator|*
literal|2
argument_list|,
operator|(
name|UINT8
operator|*
operator|)
operator|(
name|Node
operator|+
literal|1
operator|)
argument_list|,
name|DataLength
argument_list|)
expr_stmt|;
return|return
name|Node
return|;
block|}
end_function

begin_comment
comment|/**   Converts a generic text device path node to device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|TypeStr
decl_stmt|;
name|TypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
return|return
name|DevPathFromTextGenericPath
argument_list|(
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|TypeStr
argument_list|)
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a generic hardware text device path node to Hardware device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to Hardware device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextHardwarePath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|DevPathFromTextGenericPath
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Hardware PCI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to Hardware PCI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPci
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|FunctionStr
decl_stmt|;
name|CHAR16
modifier|*
name|DeviceStr
decl_stmt|;
name|PCI_DEVICE_PATH
modifier|*
name|Pci
decl_stmt|;
name|DeviceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|FunctionStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Pci
operator|=
operator|(
name|PCI_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_PCI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|PCI_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Pci
operator|->
name|Function
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|FunctionStr
argument_list|)
expr_stmt|;
name|Pci
operator|->
name|Device
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|DeviceStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Pci
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Hardware PC card device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to Hardware PC card device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPcCard
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|FunctionNumberStr
decl_stmt|;
name|PCCARD_DEVICE_PATH
modifier|*
name|Pccard
decl_stmt|;
name|FunctionNumberStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Pccard
operator|=
operator|(
name|PCCARD_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_PCCARD_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|PCCARD_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Pccard
operator|->
name|FunctionNumber
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|FunctionNumberStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Pccard
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Hardware memory map device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to Hardware memory map device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextMemoryMapped
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|MemoryTypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|StartingAddressStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddressStr
decl_stmt|;
name|MEMMAP_DEVICE_PATH
modifier|*
name|MemMap
decl_stmt|;
name|MemoryTypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|StartingAddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|MemMap
operator|=
operator|(
name|MEMMAP_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_MEMMAP_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEMMAP_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|MemMap
operator|->
name|MemoryType
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|MemoryTypeStr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddressStr
argument_list|,
operator|&
name|MemMap
operator|->
name|StartingAddress
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddressStr
argument_list|,
operator|&
name|MemMap
operator|->
name|EndingAddress
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|MemMap
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor device path structure based on the input Type   and SubType.    @param TextDeviceNode  The input Text device path node.   @param Type            The type of device path node.   @param SubType         The subtype of device path node.    @return A pointer to the newly-created Vendor device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|ConvertFromTextVendor
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|,
name|IN
name|UINT8
name|Type
parameter_list|,
name|IN
name|UINT8
name|SubType
parameter_list|)
block|{
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|CHAR16
modifier|*
name|DataStr
decl_stmt|;
name|UINTN
name|Length
decl_stmt|;
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DataStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Length
operator|=
name|StrLen
argument_list|(
name|DataStr
argument_list|)
expr_stmt|;
comment|//
comment|// Two hex characters make up 1 buffer byte
comment|//
name|Length
operator|=
operator|(
name|Length
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|Type
argument_list|,
name|SubType
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
operator|+
name|Length
argument_list|)
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|GuidStr
argument_list|,
operator|&
name|Vendor
operator|->
name|Guid
argument_list|)
expr_stmt|;
name|StrHexToBytes
argument_list|(
name|DataStr
argument_list|,
name|Length
operator|*
literal|2
argument_list|,
operator|(
name|UINT8
operator|*
operator|)
operator|(
name|Vendor
operator|+
literal|1
operator|)
argument_list|,
name|Length
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vendor
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor Hardware device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor Hardware device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenHw
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextVendor
argument_list|(
name|TextDeviceNode
argument_list|,
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_VENDOR_DP
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Hardware Controller device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Hardware Controller device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextCtrl
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|ControllerStr
decl_stmt|;
name|CONTROLLER_DEVICE_PATH
modifier|*
name|Controller
decl_stmt|;
name|ControllerStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Controller
operator|=
operator|(
name|CONTROLLER_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_CONTROLLER_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|CONTROLLER_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Controller
operator|->
name|ControllerNumber
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|ControllerStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Controller
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to BMC device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created BMC device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextBmc
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|InterfaceTypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|BaseAddressStr
decl_stmt|;
name|BMC_DEVICE_PATH
modifier|*
name|BmcDp
decl_stmt|;
name|InterfaceTypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|BaseAddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|BmcDp
operator|=
operator|(
name|BMC_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|HARDWARE_DEVICE_PATH
argument_list|,
name|HW_BMC_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|BMC_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|BmcDp
operator|->
name|InterfaceType
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|InterfaceTypeStr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|BmcDp
operator|->
name|BaseAddress
operator|)
argument_list|,
name|StrHexToUint64
argument_list|(
name|BaseAddressStr
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|BmcDp
return|;
block|}
end_function

begin_comment
comment|/**   Converts a generic ACPI text device path node to ACPI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to ACPI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAcpiPath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|DevPathFromTextGenericPath
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a string to EisaId.    @param Text   The input string.    @return UINT32 EISA ID. **/
end_comment

begin_function
specifier|static
name|UINT32
name|EisaIdFromText
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Text
parameter_list|)
block|{
return|return
operator|(
operator|(
operator|(
name|Text
index|[
literal|0
index|]
operator|-
literal|'A'
operator|+
literal|1
operator|)
operator|&
literal|0x1f
operator|)
operator|<<
literal|10
operator|)
operator|+
operator|(
operator|(
operator|(
name|Text
index|[
literal|1
index|]
operator|-
literal|'A'
operator|+
literal|1
operator|)
operator|&
literal|0x1f
operator|)
operator|<<
literal|5
operator|)
operator|+
operator|(
operator|(
operator|(
name|Text
index|[
literal|2
index|]
operator|-
literal|'A'
operator|+
literal|1
operator|)
operator|&
literal|0x1f
operator|)
operator|<<
literal|0
operator|)
operator|+
call|(
name|UINT32
call|)
argument_list|(
name|StrHexToUintn
argument_list|(
operator|&
name|Text
index|[
literal|3
index|]
argument_list|)
operator|<<
literal|16
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to ACPI HID device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created ACPI HID device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAcpi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|HIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|UIDStr
decl_stmt|;
name|ACPI_HID_DEVICE_PATH
modifier|*
name|Acpi
decl_stmt|;
name|HIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Acpi
operator|=
operator|(
name|ACPI_HID_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|ACPI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|ACPI_HID_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Acpi
operator|->
name|HID
operator|=
name|EisaIdFromText
argument_list|(
name|HIDStr
argument_list|)
expr_stmt|;
name|Acpi
operator|->
name|UID
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|UIDStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Acpi
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to ACPI HID device path structure.    @param TextDeviceNode  The input Text device path node.   @param PnPId           The input plug and play identification.    @return A pointer to the newly-created ACPI HID device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|ConvertFromTextAcpi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|,
name|IN
name|UINT32
name|PnPId
parameter_list|)
block|{
name|CHAR16
modifier|*
name|UIDStr
decl_stmt|;
name|ACPI_HID_DEVICE_PATH
modifier|*
name|Acpi
decl_stmt|;
name|UIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Acpi
operator|=
operator|(
name|ACPI_HID_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|ACPI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|ACPI_HID_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Acpi
operator|->
name|HID
operator|=
name|EFI_PNP_ID
argument_list|(
name|PnPId
argument_list|)
expr_stmt|;
name|Acpi
operator|->
name|UID
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|UIDStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Acpi
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to PCI root device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created PCI root device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPciRoot
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0a03
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to PCIE root device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created PCIE root device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPcieRoot
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0a08
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Floppy device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Floppy device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFloppy
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0604
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Keyboard device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created  Keyboard device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextKeyboard
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0301
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Serial device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Serial device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextSerial
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0501
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Parallel Port device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Parallel Port device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextParallelPort
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextAcpi
argument_list|(
name|TextDeviceNode
argument_list|,
literal|0x0401
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to ACPI extension device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created ACPI extension device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAcpiEx
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|HIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|CIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|UIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|HIDSTRStr
decl_stmt|;
name|CHAR16
modifier|*
name|CIDSTRStr
decl_stmt|;
name|CHAR16
modifier|*
name|UIDSTRStr
decl_stmt|;
name|CHAR8
modifier|*
name|AsciiStr
decl_stmt|;
name|UINT16
name|Length
decl_stmt|;
name|ACPI_EXTENDED_HID_DEVICE_PATH
modifier|*
name|AcpiEx
decl_stmt|;
name|HIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|CIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|HIDSTRStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|CIDSTRStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UIDSTRStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Length
operator|=
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
argument_list|)
operator|+
name|StrLen
argument_list|(
name|HIDSTRStr
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|Length
operator|=
call|(
name|UINT16
call|)
argument_list|(
name|Length
operator|+
name|StrLen
argument_list|(
name|UIDSTRStr
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|Length
operator|=
call|(
name|UINT16
call|)
argument_list|(
name|Length
operator|+
name|StrLen
argument_list|(
name|CIDSTRStr
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|AcpiEx
operator|=
operator|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|ACPI_EXTENDED_DP
argument_list|,
name|Length
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|HID
operator|=
name|EisaIdFromText
argument_list|(
name|HIDStr
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|CID
operator|=
name|EisaIdFromText
argument_list|(
name|CIDStr
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|UID
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|UIDStr
argument_list|)
expr_stmt|;
name|AsciiStr
operator|=
operator|(
name|CHAR8
operator|*
operator|)
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|AcpiEx
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
argument_list|)
operator|)
expr_stmt|;
name|StrToAscii
argument_list|(
name|HIDSTRStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
name|StrToAscii
argument_list|(
name|UIDSTRStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
name|StrToAscii
argument_list|(
name|CIDSTRStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AcpiEx
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to ACPI extension device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created ACPI extension device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAcpiExp
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|HIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|CIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|UIDSTRStr
decl_stmt|;
name|CHAR8
modifier|*
name|AsciiStr
decl_stmt|;
name|UINT16
name|Length
decl_stmt|;
name|ACPI_EXTENDED_HID_DEVICE_PATH
modifier|*
name|AcpiEx
decl_stmt|;
name|HIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|CIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UIDSTRStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Length
operator|=
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
argument_list|)
operator|+
name|StrLen
argument_list|(
name|UIDSTRStr
argument_list|)
operator|+
literal|3
argument_list|)
expr_stmt|;
name|AcpiEx
operator|=
operator|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|ACPI_EXTENDED_DP
argument_list|,
name|Length
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|HID
operator|=
name|EisaIdFromText
argument_list|(
name|HIDStr
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|CID
operator|=
name|EisaIdFromText
argument_list|(
name|CIDStr
argument_list|)
expr_stmt|;
name|AcpiEx
operator|->
name|UID
operator|=
literal|0
expr_stmt|;
name|AsciiStr
operator|=
operator|(
name|CHAR8
operator|*
operator|)
operator|(
operator|(
name|UINT8
operator|*
operator|)
name|AcpiEx
operator|+
sizeof|sizeof
argument_list|(
name|ACPI_EXTENDED_HID_DEVICE_PATH
argument_list|)
operator|)
expr_stmt|;
comment|//
comment|// HID string is NULL
comment|//
operator|*
name|AsciiStr
operator|=
literal|'\0'
expr_stmt|;
comment|//
comment|// Convert UID string
comment|//
name|AsciiStr
operator|++
expr_stmt|;
name|StrToAscii
argument_list|(
name|UIDSTRStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
comment|//
comment|// CID string is NULL
comment|//
operator|*
name|AsciiStr
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AcpiEx
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to ACPI _ADR device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created ACPI _ADR device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAcpiAdr
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|DisplayDeviceStr
decl_stmt|;
name|ACPI_ADR_DEVICE_PATH
modifier|*
name|AcpiAdr
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|UINTN
name|Length
decl_stmt|;
name|AcpiAdr
operator|=
operator|(
name|ACPI_ADR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|ACPI_DEVICE_PATH
argument_list|,
name|ACPI_ADR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|ACPI_ADR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|AcpiAdr
operator|!=
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
condition|;
name|Index
operator|++
control|)
block|{
name|DisplayDeviceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|IS_NULL
argument_list|(
operator|*
name|DisplayDeviceStr
argument_list|)
condition|)
block|{
break|break;
block|}
if|if
condition|(
name|Index
operator|>
literal|0
condition|)
block|{
name|Length
operator|=
name|DevicePathNodeLength
argument_list|(
name|AcpiAdr
argument_list|)
expr_stmt|;
name|AcpiAdr
operator|=
name|ReallocatePool
argument_list|(
name|Length
argument_list|,
name|Length
operator|+
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
argument_list|,
name|AcpiAdr
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|AcpiAdr
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|SetDevicePathNodeLength
argument_list|(
name|AcpiAdr
argument_list|,
name|Length
operator|+
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
argument_list|)
expr_stmt|;
block|}
operator|(
operator|&
name|AcpiAdr
operator|->
name|ADR
operator|)
index|[
name|Index
index|]
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|DisplayDeviceStr
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AcpiAdr
return|;
block|}
end_function

begin_comment
comment|/**   Converts a generic messaging text device path node to messaging device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to messaging device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextMsg
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|DevPathFromTextGenericPath
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Parallel Port device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Parallel Port device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextAta
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|PrimarySecondaryStr
decl_stmt|;
name|CHAR16
modifier|*
name|SlaveMasterStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|ATAPI_DEVICE_PATH
modifier|*
name|Atapi
decl_stmt|;
name|Atapi
operator|=
operator|(
name|ATAPI_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_ATAPI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|ATAPI_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|PrimarySecondaryStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SlaveMasterStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|PrimarySecondaryStr
argument_list|,
literal|"Primary"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Atapi
operator|->
name|PrimarySecondary
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|PrimarySecondaryStr
argument_list|,
literal|"Secondary"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Atapi
operator|->
name|PrimarySecondary
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|Atapi
operator|->
name|PrimarySecondary
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|PrimarySecondaryStr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|SlaveMasterStr
argument_list|,
literal|"Master"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Atapi
operator|->
name|SlaveMaster
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|SlaveMasterStr
argument_list|,
literal|"Slave"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Atapi
operator|->
name|SlaveMaster
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|Atapi
operator|->
name|SlaveMaster
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|SlaveMasterStr
argument_list|)
expr_stmt|;
block|}
name|Atapi
operator|->
name|Lun
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|LunStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Atapi
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to SCSI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created SCSI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextScsi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|PunStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|SCSI_DEVICE_PATH
modifier|*
name|Scsi
decl_stmt|;
name|PunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Scsi
operator|=
operator|(
name|SCSI_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_SCSI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|SCSI_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Scsi
operator|->
name|Pun
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|PunStr
argument_list|)
expr_stmt|;
name|Scsi
operator|->
name|Lun
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|LunStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Scsi
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Fibre device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Fibre device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFibre
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|WWNStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|FIBRECHANNEL_DEVICE_PATH
modifier|*
name|Fibre
decl_stmt|;
name|WWNStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Fibre
operator|=
operator|(
name|FIBRECHANNEL_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_FIBRECHANNEL_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|FIBRECHANNEL_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Fibre
operator|->
name|Reserved
operator|=
literal|0
expr_stmt|;
name|Strtoi64
argument_list|(
name|WWNStr
argument_list|,
operator|&
name|Fibre
operator|->
name|WWN
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|LunStr
argument_list|,
operator|&
name|Fibre
operator|->
name|Lun
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Fibre
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to FibreEx device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created FibreEx device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFibreEx
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|WWNStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|FIBRECHANNELEX_DEVICE_PATH
modifier|*
name|FibreEx
decl_stmt|;
name|WWNStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|FibreEx
operator|=
operator|(
name|FIBRECHANNELEX_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_FIBRECHANNELEX_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|FIBRECHANNELEX_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|FibreEx
operator|->
name|Reserved
operator|=
literal|0
expr_stmt|;
name|Strtoi64
argument_list|(
name|WWNStr
argument_list|,
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|WWN
operator|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|LunStr
argument_list|,
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|Lun
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|WWN
operator|)
operator|=
name|SwapBytes64
argument_list|(
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|WWN
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|Lun
operator|)
operator|=
name|SwapBytes64
argument_list|(
operator|*
operator|(
name|UINT64
operator|*
operator|)
operator|(
operator|&
name|FibreEx
operator|->
name|Lun
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|FibreEx
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to 1394 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created 1394 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromText1394
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|F1394_DEVICE_PATH
modifier|*
name|F1394DevPath
decl_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|F1394DevPath
operator|=
operator|(
name|F1394_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_1394_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|F1394_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|F1394DevPath
operator|->
name|Reserved
operator|=
literal|0
expr_stmt|;
name|F1394DevPath
operator|->
name|Guid
operator|=
name|StrHexToUint64
argument_list|(
name|GuidStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|F1394DevPath
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsb
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|PortStr
decl_stmt|;
name|CHAR16
modifier|*
name|InterfaceStr
decl_stmt|;
name|USB_DEVICE_PATH
modifier|*
name|Usb
decl_stmt|;
name|PortStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InterfaceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Usb
operator|=
operator|(
name|USB_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_USB_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|USB_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Usb
operator|->
name|ParentPortNumber
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|PortStr
argument_list|)
expr_stmt|;
name|Usb
operator|->
name|InterfaceNumber
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|InterfaceStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Usb
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to I20 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created I20 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextI2O
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|TIDStr
decl_stmt|;
name|I2O_DEVICE_PATH
modifier|*
name|I2ODevPath
decl_stmt|;
name|TIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|I2ODevPath
operator|=
operator|(
name|I2O_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_I2O_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|I2O_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|I2ODevPath
operator|->
name|Tid
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|TIDStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|I2ODevPath
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Infini Band device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Infini Band device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextInfiniband
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|FlagsStr
decl_stmt|;
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|CHAR16
modifier|*
name|SidStr
decl_stmt|;
name|CHAR16
modifier|*
name|TidStr
decl_stmt|;
name|CHAR16
modifier|*
name|DidStr
decl_stmt|;
name|INFINIBAND_DEVICE_PATH
modifier|*
name|InfiniBand
decl_stmt|;
name|FlagsStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|TidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InfiniBand
operator|=
operator|(
name|INFINIBAND_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_INFINIBAND_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|INFINIBAND_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|InfiniBand
operator|->
name|ResourceFlags
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|FlagsStr
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|GuidStr
argument_list|,
operator|(
name|EFI_GUID
operator|*
operator|)
name|InfiniBand
operator|->
name|PortGid
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|SidStr
argument_list|,
operator|&
name|InfiniBand
operator|->
name|ServiceId
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|TidStr
argument_list|,
operator|&
name|InfiniBand
operator|->
name|TargetPortId
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|DidStr
argument_list|,
operator|&
name|InfiniBand
operator|->
name|DeviceId
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|InfiniBand
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor-Defined Messaging device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor-Defined Messaging device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenMsg
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextVendor
argument_list|(
name|TextDeviceNode
argument_list|,
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor defined PC-ANSI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor defined PC-ANSI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenPcAnsi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiPcAnsiGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vendor
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor defined VT100 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor defined VT100 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenVt100
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVT100Guid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vendor
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor defined VT100 Plus device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor defined VT100 Plus device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenVt100Plus
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVT100PlusGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vendor
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor defined UTF8 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor defined UTF8 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenUtf8
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|VENDOR_DEVICE_PATH
modifier|*
name|Vendor
decl_stmt|;
name|Vendor
operator|=
operator|(
name|VENDOR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VENDOR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Vendor
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiVTUTF8Guid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vendor
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to UART Flow Control device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created UART Flow Control device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUartFlowCtrl
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|ValueStr
decl_stmt|;
name|UART_FLOW_CONTROL_DEVICE_PATH
modifier|*
name|UartFlowControl
decl_stmt|;
name|ValueStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UartFlowControl
operator|=
operator|(
name|UART_FLOW_CONTROL_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|UART_FLOW_CONTROL_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|UartFlowControl
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiUartDevicePathGuid
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|ValueStr
argument_list|,
literal|"XonXoff"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|UartFlowControl
operator|->
name|FlowControlMap
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|ValueStr
argument_list|,
literal|"Hardware"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|UartFlowControl
operator|->
name|FlowControlMap
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|UartFlowControl
operator|->
name|FlowControlMap
operator|=
literal|0
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|UartFlowControl
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Serial Attached SCSI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Serial Attached SCSI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextSAS
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|AddressStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|CHAR16
modifier|*
name|RTPStr
decl_stmt|;
name|CHAR16
modifier|*
name|SASSATAStr
decl_stmt|;
name|CHAR16
modifier|*
name|LocationStr
decl_stmt|;
name|CHAR16
modifier|*
name|ConnectStr
decl_stmt|;
name|CHAR16
modifier|*
name|DriveBayStr
decl_stmt|;
name|CHAR16
modifier|*
name|ReservedStr
decl_stmt|;
name|UINT16
name|Info
decl_stmt|;
name|UINT16
name|Uint16
decl_stmt|;
name|SAS_DEVICE_PATH
modifier|*
name|Sas
decl_stmt|;
name|AddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RTPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SASSATAStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LocationStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ConnectStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DriveBayStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ReservedStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Sas
operator|=
operator|(
name|SAS_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|SAS_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Sas
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiSasDevicePathGuid
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|AddressStr
argument_list|,
operator|&
name|Sas
operator|->
name|SasAddress
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|LunStr
argument_list|,
operator|&
name|Sas
operator|->
name|Lun
argument_list|)
expr_stmt|;
name|Sas
operator|->
name|RelativeTargetPort
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|RTPStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"NoTopology"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Info
operator|=
literal|0x0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SATA"
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SAS"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|Uint16
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|DriveBayStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|Uint16
operator|==
literal|0
condition|)
block|{
name|Info
operator|=
literal|0x1
expr_stmt|;
block|}
else|else
block|{
name|Info
operator|=
call|(
name|UINT16
call|)
argument_list|(
literal|0x2
operator||
operator|(
operator|(
name|Uint16
operator|-
literal|1
operator|)
operator|<<
literal|8
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SATA"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Info
operator||=
name|BIT4
expr_stmt|;
block|}
comment|//
comment|// Location is an integer between 0 and 1 or else
comment|// the keyword Internal (0) or External (1).
comment|//
if|if
condition|(
name|StrCmp
argument_list|(
name|LocationStr
argument_list|,
literal|"External"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|LocationStr
argument_list|,
literal|"Internal"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Uint16
operator|=
operator|(
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|LocationStr
argument_list|)
operator|&
name|BIT0
operator|)
expr_stmt|;
block|}
name|Info
operator||=
operator|(
name|Uint16
operator|<<
literal|5
operator|)
expr_stmt|;
comment|//
comment|// Connect is an integer between 0 and 3 or else
comment|// the keyword Direct (0) or Expanded (1).
comment|//
if|if
condition|(
name|StrCmp
argument_list|(
name|ConnectStr
argument_list|,
literal|"Expanded"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|ConnectStr
argument_list|,
literal|"Direct"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Uint16
operator|=
operator|(
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|ConnectStr
argument_list|)
operator|&
operator|(
name|BIT0
operator||
name|BIT1
operator|)
operator|)
expr_stmt|;
block|}
name|Info
operator||=
operator|(
name|Uint16
operator|<<
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
name|Info
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|SASSATAStr
argument_list|)
expr_stmt|;
block|}
name|Sas
operator|->
name|DeviceTopology
operator|=
name|Info
expr_stmt|;
name|Sas
operator|->
name|Reserved
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|ReservedStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Sas
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Serial Attached SCSI Ex device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Serial Attached SCSI Ex device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextSasEx
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|AddressStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|CHAR16
modifier|*
name|RTPStr
decl_stmt|;
name|CHAR16
modifier|*
name|SASSATAStr
decl_stmt|;
name|CHAR16
modifier|*
name|LocationStr
decl_stmt|;
name|CHAR16
modifier|*
name|ConnectStr
decl_stmt|;
name|CHAR16
modifier|*
name|DriveBayStr
decl_stmt|;
name|UINT16
name|Info
decl_stmt|;
name|UINT16
name|Uint16
decl_stmt|;
name|UINT64
name|SasAddress
decl_stmt|;
name|UINT64
name|Lun
decl_stmt|;
name|SASEX_DEVICE_PATH
modifier|*
name|SasEx
decl_stmt|;
name|AddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RTPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SASSATAStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LocationStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ConnectStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DriveBayStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SasEx
operator|=
operator|(
name|SASEX_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_SASEX_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|SASEX_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|AddressStr
argument_list|,
operator|&
name|SasAddress
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|LunStr
argument_list|,
operator|&
name|Lun
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
name|SasEx
operator|->
name|SasAddress
argument_list|,
name|SwapBytes64
argument_list|(
name|SasAddress
argument_list|)
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
name|SasEx
operator|->
name|Lun
argument_list|,
name|SwapBytes64
argument_list|(
name|Lun
argument_list|)
argument_list|)
expr_stmt|;
name|SasEx
operator|->
name|RelativeTargetPort
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|RTPStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"NoTopology"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Info
operator|=
literal|0x0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SATA"
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SAS"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|Uint16
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|DriveBayStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|Uint16
operator|==
literal|0
condition|)
block|{
name|Info
operator|=
literal|0x1
expr_stmt|;
block|}
else|else
block|{
name|Info
operator|=
call|(
name|UINT16
call|)
argument_list|(
literal|0x2
operator||
operator|(
operator|(
name|Uint16
operator|-
literal|1
operator|)
operator|<<
literal|8
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|SASSATAStr
argument_list|,
literal|"SATA"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Info
operator||=
name|BIT4
expr_stmt|;
block|}
comment|//
comment|// Location is an integer between 0 and 1 or else
comment|// the keyword Internal (0) or External (1).
comment|//
if|if
condition|(
name|StrCmp
argument_list|(
name|LocationStr
argument_list|,
literal|"External"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|LocationStr
argument_list|,
literal|"Internal"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Uint16
operator|=
operator|(
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|LocationStr
argument_list|)
operator|&
name|BIT0
operator|)
expr_stmt|;
block|}
name|Info
operator||=
operator|(
name|Uint16
operator|<<
literal|5
operator|)
expr_stmt|;
comment|//
comment|// Connect is an integer between 0 and 3 or else
comment|// the keyword Direct (0) or Expanded (1).
comment|//
if|if
condition|(
name|StrCmp
argument_list|(
name|ConnectStr
argument_list|,
literal|"Expanded"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|ConnectStr
argument_list|,
literal|"Direct"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uint16
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|Uint16
operator|=
operator|(
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|ConnectStr
argument_list|)
operator|&
operator|(
name|BIT0
operator||
name|BIT1
operator|)
operator|)
expr_stmt|;
block|}
name|Info
operator||=
operator|(
name|Uint16
operator|<<
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
name|Info
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|SASSATAStr
argument_list|)
expr_stmt|;
block|}
name|SasEx
operator|->
name|DeviceTopology
operator|=
name|Info
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|SasEx
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to NVM Express Namespace device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created NVM Express Namespace device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextNVMe
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|NamespaceIdStr
decl_stmt|;
name|CHAR16
modifier|*
name|NamespaceUuidStr
decl_stmt|;
name|NVME_NAMESPACE_DEVICE_PATH
modifier|*
name|Nvme
decl_stmt|;
name|UINT8
modifier|*
name|Uuid
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
name|NamespaceIdStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|NamespaceUuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Nvme
operator|=
operator|(
name|NVME_NAMESPACE_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_NVME_NAMESPACE_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|NVME_NAMESPACE_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Nvme
operator|->
name|NamespaceId
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|NamespaceIdStr
argument_list|)
expr_stmt|;
name|Uuid
operator|=
operator|(
name|UINT8
operator|*
operator|)
operator|&
name|Nvme
operator|->
name|NamespaceUuid
expr_stmt|;
name|Index
operator|=
sizeof|sizeof
argument_list|(
name|Nvme
operator|->
name|NamespaceUuid
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|UINT8
argument_list|)
expr_stmt|;
while|while
condition|(
name|Index
operator|--
operator|!=
literal|0
condition|)
block|{
name|Uuid
index|[
name|Index
index|]
operator|=
operator|(
name|UINT8
operator|)
name|StrHexToUintn
argument_list|(
name|SplitStr
argument_list|(
operator|&
name|NamespaceUuidStr
argument_list|,
literal|'-'
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Nvme
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to UFS device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created UFS device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUfs
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|PunStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|UFS_DEVICE_PATH
modifier|*
name|Ufs
decl_stmt|;
name|PunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Ufs
operator|=
operator|(
name|UFS_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_UFS_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|UFS_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Ufs
operator|->
name|Pun
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|PunStr
argument_list|)
expr_stmt|;
name|Ufs
operator|->
name|Lun
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|LunStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Ufs
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to SD (Secure Digital) device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created SD device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextSd
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|SlotNumberStr
decl_stmt|;
name|SD_DEVICE_PATH
modifier|*
name|Sd
decl_stmt|;
name|SlotNumberStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Sd
operator|=
operator|(
name|SD_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_SD_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|SD_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Sd
operator|->
name|SlotNumber
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|SlotNumberStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Sd
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to EMMC (Embedded MMC) device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created EMMC device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextEmmc
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|SlotNumberStr
decl_stmt|;
name|EMMC_DEVICE_PATH
modifier|*
name|Emmc
decl_stmt|;
name|SlotNumberStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Emmc
operator|=
operator|(
name|EMMC_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_EMMC_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|EMMC_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Emmc
operator|->
name|SlotNumber
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|SlotNumberStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Emmc
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Debug Port device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Debug Port device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextDebugPort
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|VENDOR_DEFINED_MESSAGING_DEVICE_PATH
modifier|*
name|Vend
decl_stmt|;
name|Vend
operator|=
operator|(
name|VENDOR_DEFINED_MESSAGING_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VENDOR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VENDOR_DEFINED_MESSAGING_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|Vend
operator|->
name|Guid
argument_list|,
operator|&
name|gEfiDebugPortProtocolGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vend
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to MAC device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created MAC device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextMAC
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|AddressStr
decl_stmt|;
name|CHAR16
modifier|*
name|IfTypeStr
decl_stmt|;
name|UINTN
name|Length
decl_stmt|;
name|MAC_ADDR_DEVICE_PATH
modifier|*
name|MACDevPath
decl_stmt|;
name|AddressStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|IfTypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|MACDevPath
operator|=
operator|(
name|MAC_ADDR_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_MAC_ADDR_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MAC_ADDR_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|MACDevPath
operator|->
name|IfType
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|IfTypeStr
argument_list|)
expr_stmt|;
name|Length
operator|=
sizeof|sizeof
argument_list|(
name|EFI_MAC_ADDRESS
argument_list|)
expr_stmt|;
name|StrHexToBytes
argument_list|(
name|AddressStr
argument_list|,
name|Length
operator|*
literal|2
argument_list|,
name|MACDevPath
operator|->
name|MacAddress
operator|.
name|Addr
argument_list|,
name|Length
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|MACDevPath
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text format to the network protocol ID.    @param Text  String of protocol field.    @return Network protocol ID .  **/
end_comment

begin_function
specifier|static
name|UINTN
name|NetworkProtocolFromText
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|Text
parameter_list|)
block|{
if|if
condition|(
name|StrCmp
argument_list|(
name|Text
argument_list|,
literal|"UDP"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
name|RFC_1700_UDP_PROTOCOL
return|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|Text
argument_list|,
literal|"TCP"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
name|RFC_1700_TCP_PROTOCOL
return|;
block|}
return|return
name|Strtoi
argument_list|(
name|Text
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to IPV4 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created IPV4 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextIPv4
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|RemoteIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|ProtocolStr
decl_stmt|;
name|CHAR16
modifier|*
name|TypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|LocalIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|GatewayIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|SubnetMaskStr
decl_stmt|;
name|IPv4_DEVICE_PATH
modifier|*
name|IPv4
decl_stmt|;
name|RemoteIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ProtocolStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|TypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LocalIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|GatewayIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SubnetMaskStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|IPv4
operator|=
operator|(
name|IPv4_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_IPv4_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|IPv4_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|StrToIpv4Address
argument_list|(
name|RemoteIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv4
operator|->
name|RemoteIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|IPv4
operator|->
name|Protocol
operator|=
operator|(
name|UINT16
operator|)
name|NetworkProtocolFromText
argument_list|(
name|ProtocolStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"Static"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|IPv4
operator|->
name|StaticIpAddress
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|IPv4
operator|->
name|StaticIpAddress
operator|=
name|FALSE
expr_stmt|;
block|}
name|StrToIpv4Address
argument_list|(
name|LocalIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv4
operator|->
name|LocalIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|GatewayIPStr
argument_list|)
operator|&&
operator|!
name|IS_NULL
argument_list|(
operator|*
name|SubnetMaskStr
argument_list|)
condition|)
block|{
name|StrToIpv4Address
argument_list|(
name|GatewayIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv4
operator|->
name|GatewayIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|StrToIpv4Address
argument_list|(
name|SubnetMaskStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv4
operator|->
name|SubnetMask
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ZeroMem
argument_list|(
operator|&
name|IPv4
operator|->
name|GatewayIpAddress
argument_list|,
sizeof|sizeof
argument_list|(
name|IPv4
operator|->
name|GatewayIpAddress
argument_list|)
argument_list|)
expr_stmt|;
name|ZeroMem
argument_list|(
operator|&
name|IPv4
operator|->
name|SubnetMask
argument_list|,
sizeof|sizeof
argument_list|(
name|IPv4
operator|->
name|SubnetMask
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|IPv4
operator|->
name|LocalPort
operator|=
literal|0
expr_stmt|;
name|IPv4
operator|->
name|RemotePort
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|IPv4
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to IPV6 device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created IPV6 device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextIPv6
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|RemoteIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|ProtocolStr
decl_stmt|;
name|CHAR16
modifier|*
name|TypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|LocalIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|GatewayIPStr
decl_stmt|;
name|CHAR16
modifier|*
name|PrefixLengthStr
decl_stmt|;
name|IPv6_DEVICE_PATH
modifier|*
name|IPv6
decl_stmt|;
name|RemoteIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ProtocolStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|TypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LocalIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|PrefixLengthStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|GatewayIPStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|IPv6
operator|=
operator|(
name|IPv6_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_IPv6_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|IPv6_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|StrToIpv6Address
argument_list|(
name|RemoteIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv6
operator|->
name|RemoteIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|IPv6
operator|->
name|Protocol
operator|=
operator|(
name|UINT16
operator|)
name|NetworkProtocolFromText
argument_list|(
name|ProtocolStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"Static"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|IPv6
operator|->
name|IpAddressOrigin
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"StatelessAutoConfigure"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|IPv6
operator|->
name|IpAddressOrigin
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|IPv6
operator|->
name|IpAddressOrigin
operator|=
literal|2
expr_stmt|;
block|}
name|StrToIpv6Address
argument_list|(
name|LocalIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv6
operator|->
name|LocalIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|GatewayIPStr
argument_list|)
operator|&&
operator|!
name|IS_NULL
argument_list|(
operator|*
name|PrefixLengthStr
argument_list|)
condition|)
block|{
name|StrToIpv6Address
argument_list|(
name|GatewayIPStr
argument_list|,
name|NULL
argument_list|,
operator|&
name|IPv6
operator|->
name|GatewayIpAddress
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|IPv6
operator|->
name|PrefixLength
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|PrefixLengthStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ZeroMem
argument_list|(
operator|&
name|IPv6
operator|->
name|GatewayIpAddress
argument_list|,
sizeof|sizeof
argument_list|(
name|IPv6
operator|->
name|GatewayIpAddress
argument_list|)
argument_list|)
expr_stmt|;
name|IPv6
operator|->
name|PrefixLength
operator|=
literal|0
expr_stmt|;
block|}
name|IPv6
operator|->
name|LocalPort
operator|=
literal|0
expr_stmt|;
name|IPv6
operator|->
name|RemotePort
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|IPv6
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to UART device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created UART device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUart
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|BaudStr
decl_stmt|;
name|CHAR16
modifier|*
name|DataBitsStr
decl_stmt|;
name|CHAR16
modifier|*
name|ParityStr
decl_stmt|;
name|CHAR16
modifier|*
name|StopBitsStr
decl_stmt|;
name|UART_DEVICE_PATH
modifier|*
name|Uart
decl_stmt|;
name|BaudStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DataBitsStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ParityStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|StopBitsStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Uart
operator|=
operator|(
name|UART_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_UART_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|UART_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|BaudStr
argument_list|,
literal|"DEFAULT"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uart
operator|->
name|BaudRate
operator|=
literal|115200
expr_stmt|;
block|}
else|else
block|{
name|Strtoi64
argument_list|(
name|BaudStr
argument_list|,
operator|&
name|Uart
operator|->
name|BaudRate
argument_list|)
expr_stmt|;
block|}
name|Uart
operator|->
name|DataBits
operator|=
call|(
name|UINT8
call|)
argument_list|(
operator|(
name|StrCmp
argument_list|(
name|DataBitsStr
argument_list|,
literal|"DEFAULT"
argument_list|)
operator|==
literal|0
operator|)
condition|?
literal|8
else|:
name|Strtoi
argument_list|(
name|DataBitsStr
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|*
name|ParityStr
condition|)
block|{
case|case
literal|'D'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'N'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'E'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|'O'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|3
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|4
expr_stmt|;
break|break;
case|case
literal|'S'
case|:
name|Uart
operator|->
name|Parity
operator|=
literal|5
expr_stmt|;
break|break;
default|default:
name|Uart
operator|->
name|Parity
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|ParityStr
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|StopBitsStr
argument_list|,
literal|"D"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uart
operator|->
name|StopBits
operator|=
operator|(
name|UINT8
operator|)
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|StopBitsStr
argument_list|,
literal|"1"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uart
operator|->
name|StopBits
operator|=
operator|(
name|UINT8
operator|)
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|StopBitsStr
argument_list|,
literal|"1.5"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uart
operator|->
name|StopBits
operator|=
operator|(
name|UINT8
operator|)
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|StopBitsStr
argument_list|,
literal|"2"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Uart
operator|->
name|StopBits
operator|=
operator|(
name|UINT8
operator|)
literal|3
expr_stmt|;
block|}
else|else
block|{
name|Uart
operator|->
name|StopBits
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|StopBitsStr
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Uart
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB class device path structure.    @param TextDeviceNode  The input Text device path node.   @param UsbClassText    A pointer to USB_CLASS_TEXT structure to be integrated to USB Class Text.    @return A pointer to the newly-created USB class device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|ConvertFromTextUsbClass
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|,
name|IN
name|USB_CLASS_TEXT
modifier|*
name|UsbClassText
parameter_list|)
block|{
name|CHAR16
modifier|*
name|VIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|PIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|ClassStr
decl_stmt|;
name|CHAR16
modifier|*
name|SubClassStr
decl_stmt|;
name|CHAR16
modifier|*
name|ProtocolStr
decl_stmt|;
name|USB_CLASS_DEVICE_PATH
modifier|*
name|UsbClass
decl_stmt|;
name|UsbClass
operator|=
operator|(
name|USB_CLASS_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_USB_CLASS_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|USB_CLASS_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|VIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|PIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
if|if
condition|(
name|UsbClassText
operator|->
name|ClassExist
condition|)
block|{
name|ClassStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UsbClass
operator|->
name|DeviceClass
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|ClassStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UsbClass
operator|->
name|DeviceClass
operator|=
name|UsbClassText
operator|->
name|Class
expr_stmt|;
block|}
if|if
condition|(
name|UsbClassText
operator|->
name|SubClassExist
condition|)
block|{
name|SubClassStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UsbClass
operator|->
name|DeviceSubClass
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|SubClassStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|UsbClass
operator|->
name|DeviceSubClass
operator|=
name|UsbClassText
operator|->
name|SubClass
expr_stmt|;
block|}
name|ProtocolStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UsbClass
operator|->
name|VendorId
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|VIDStr
argument_list|)
expr_stmt|;
name|UsbClass
operator|->
name|ProductId
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|PIDStr
argument_list|)
expr_stmt|;
name|UsbClass
operator|->
name|DeviceProtocol
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|ProtocolStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|UsbClass
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB class device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB class device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbClass
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|TRUE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB audio device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB audio device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbAudio
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_AUDIO
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB CDC Control device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB CDC Control device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbCDCControl
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_CDCCONTROL
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB HID device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB HID device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbHID
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_HID
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB Image device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB Image device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbImage
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_IMAGE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB Print device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB Print device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbPrinter
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_PRINTER
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB mass storage device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB mass storage device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbMassStorage
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_MASS_STORAGE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB HUB device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB HUB device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbHub
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_HUB
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB CDC data device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB CDC data device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbCDCData
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_CDCDATA
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB smart card device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB smart card device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbSmartCard
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_SMART_CARD
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB video device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB video device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbVideo
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_VIDEO
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB diagnostic device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB diagnostic device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbDiagnostic
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_DIAGNOSTIC
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB wireless device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB wireless device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbWireless
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_WIRELESS
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|TRUE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB device firmware update device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB device firmware update device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbDeviceFirmwareUpdate
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_RESERVE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClass
operator|=
name|USB_SUBCLASS_FW_UPDATE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB IRDA bridge device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB IRDA bridge device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbIrdaBridge
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_RESERVE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClass
operator|=
name|USB_SUBCLASS_IRDA_BRIDGE
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB text and measurement device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB text and measurement device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbTestAndMeasurement
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|USB_CLASS_TEXT
name|UsbClassText
decl_stmt|;
name|UsbClassText
operator|.
name|ClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|Class
operator|=
name|USB_CLASS_RESERVE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClassExist
operator|=
name|FALSE
expr_stmt|;
name|UsbClassText
operator|.
name|SubClass
operator|=
name|USB_SUBCLASS_TEST
expr_stmt|;
return|return
name|ConvertFromTextUsbClass
argument_list|(
name|TextDeviceNode
argument_list|,
operator|&
name|UsbClassText
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to USB WWID device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created USB WWID device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUsbWwid
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|VIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|PIDStr
decl_stmt|;
name|CHAR16
modifier|*
name|InterfaceNumStr
decl_stmt|;
name|CHAR16
modifier|*
name|SerialNumberStr
decl_stmt|;
name|USB_WWID_DEVICE_PATH
modifier|*
name|UsbWwid
decl_stmt|;
name|UINTN
name|SerialNumberStrLen
decl_stmt|;
name|VIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|PIDStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InterfaceNumStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SerialNumberStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SerialNumberStrLen
operator|=
name|StrLen
argument_list|(
name|SerialNumberStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|SerialNumberStrLen
operator|>=
literal|2
operator|&&
name|SerialNumberStr
index|[
literal|0
index|]
operator|==
literal|'\"'
operator|&&
name|SerialNumberStr
index|[
name|SerialNumberStrLen
operator|-
literal|1
index|]
operator|==
literal|'\"'
condition|)
block|{
name|SerialNumberStr
index|[
name|SerialNumberStrLen
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|SerialNumberStr
operator|++
expr_stmt|;
name|SerialNumberStrLen
operator|-=
literal|2
expr_stmt|;
block|}
name|UsbWwid
operator|=
operator|(
name|USB_WWID_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_USB_WWID_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|USB_WWID_DEVICE_PATH
argument_list|)
operator|+
name|SerialNumberStrLen
operator|*
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|UsbWwid
operator|->
name|VendorId
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|VIDStr
argument_list|)
expr_stmt|;
name|UsbWwid
operator|->
name|ProductId
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|PIDStr
argument_list|)
expr_stmt|;
name|UsbWwid
operator|->
name|InterfaceNumber
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InterfaceNumStr
argument_list|)
expr_stmt|;
comment|//
comment|// There is no memory allocated in UsbWwid for the '\0' in SerialNumberStr.
comment|// Therefore, the '\0' will not be copied.
comment|//
name|CopyMem
argument_list|(
operator|(
name|UINT8
operator|*
operator|)
name|UsbWwid
operator|+
sizeof|sizeof
argument_list|(
name|USB_WWID_DEVICE_PATH
argument_list|)
argument_list|,
name|SerialNumberStr
argument_list|,
name|SerialNumberStrLen
operator|*
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|UsbWwid
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Logic Unit device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Logic Unit device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUnit
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|DEVICE_LOGICAL_UNIT_DEVICE_PATH
modifier|*
name|LogicalUnit
decl_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LogicalUnit
operator|=
operator|(
name|DEVICE_LOGICAL_UNIT_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_DEVICE_LOGICAL_UNIT_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|DEVICE_LOGICAL_UNIT_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|LogicalUnit
operator|->
name|Lun
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|LunStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|LogicalUnit
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to iSCSI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created iSCSI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextiSCSI
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|UINT16
name|Options
decl_stmt|;
name|CHAR16
modifier|*
name|NameStr
decl_stmt|;
name|CHAR16
modifier|*
name|PortalGroupStr
decl_stmt|;
name|CHAR16
modifier|*
name|LunStr
decl_stmt|;
name|CHAR16
modifier|*
name|HeaderDigestStr
decl_stmt|;
name|CHAR16
modifier|*
name|DataDigestStr
decl_stmt|;
name|CHAR16
modifier|*
name|AuthenticationStr
decl_stmt|;
name|CHAR16
modifier|*
name|ProtocolStr
decl_stmt|;
name|CHAR8
modifier|*
name|AsciiStr
decl_stmt|;
name|ISCSI_DEVICE_PATH_WITH_NAME
modifier|*
name|ISCSIDevPath
decl_stmt|;
name|NameStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|PortalGroupStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|LunStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|HeaderDigestStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|DataDigestStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|AuthenticationStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ProtocolStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ISCSIDevPath
operator|=
operator|(
name|ISCSI_DEVICE_PATH_WITH_NAME
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_ISCSI_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|ISCSI_DEVICE_PATH_WITH_NAME
argument_list|)
operator|+
name|StrLen
argument_list|(
name|NameStr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AsciiStr
operator|=
name|ISCSIDevPath
operator|->
name|TargetName
expr_stmt|;
name|StrToAscii
argument_list|(
name|NameStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
name|ISCSIDevPath
operator|->
name|TargetPortalGroupTag
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|PortalGroupStr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|LunStr
argument_list|,
operator|&
name|ISCSIDevPath
operator|->
name|Lun
argument_list|)
expr_stmt|;
name|Options
operator|=
literal|0x0000
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|HeaderDigestStr
argument_list|,
literal|"CRC32C"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Options
operator||=
literal|0x0002
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|DataDigestStr
argument_list|,
literal|"CRC32C"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Options
operator||=
literal|0x0008
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|AuthenticationStr
argument_list|,
literal|"None"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Options
operator||=
literal|0x0800
expr_stmt|;
block|}
if|if
condition|(
name|StrCmp
argument_list|(
name|AuthenticationStr
argument_list|,
literal|"CHAP_UNI"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Options
operator||=
literal|0x1000
expr_stmt|;
block|}
name|ISCSIDevPath
operator|->
name|LoginOption
operator|=
operator|(
name|UINT16
operator|)
name|Options
expr_stmt|;
name|ISCSIDevPath
operator|->
name|NetworkProtocol
operator|=
operator|(
name|UINT16
operator|)
name|StrCmp
argument_list|(
name|ProtocolStr
argument_list|,
literal|"TCP"
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|ISCSIDevPath
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to VLAN device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created VLAN device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVlan
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|VlanStr
decl_stmt|;
name|VLAN_DEVICE_PATH
modifier|*
name|Vlan
decl_stmt|;
name|VlanStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Vlan
operator|=
operator|(
name|VLAN_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_VLAN_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|VLAN_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Vlan
operator|->
name|VlanId
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|VlanStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Vlan
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Bluetooth device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Bluetooth device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextBluetooth
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|BluetoothStr
decl_stmt|;
name|CHAR16
modifier|*
name|Walker
decl_stmt|;
name|CHAR16
modifier|*
name|TempNumBuffer
decl_stmt|;
name|UINTN
name|TempBufferSize
decl_stmt|;
name|INT32
name|Index
decl_stmt|;
name|BLUETOOTH_DEVICE_PATH
modifier|*
name|BluetoothDp
decl_stmt|;
name|BluetoothStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|BluetoothDp
operator|=
operator|(
name|BLUETOOTH_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_BLUETOOTH_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|BLUETOOTH_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Index
operator|=
sizeof|sizeof
argument_list|(
name|BLUETOOTH_ADDRESS
argument_list|)
operator|-
literal|1
expr_stmt|;
name|Walker
operator|=
name|BluetoothStr
expr_stmt|;
while|while
condition|(
operator|!
name|IS_NULL
argument_list|(
operator|*
name|Walker
argument_list|)
operator|&&
name|Index
operator|>=
literal|0
condition|)
block|{
name|TempBufferSize
operator|=
literal|2
operator|*
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
operator|+
name|StrSize
argument_list|(
literal|"0x"
argument_list|)
expr_stmt|;
name|TempNumBuffer
operator|=
name|AllocateZeroPool
argument_list|(
name|TempBufferSize
argument_list|)
expr_stmt|;
if|if
condition|(
name|TempNumBuffer
operator|==
name|NULL
condition|)
block|{
break|break;
block|}
name|StrCpyS
argument_list|(
name|TempNumBuffer
argument_list|,
name|TempBufferSize
operator|/
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|,
literal|"0x"
argument_list|)
expr_stmt|;
name|StrnCatS
argument_list|(
name|TempNumBuffer
argument_list|,
name|TempBufferSize
operator|/
sizeof|sizeof
argument_list|(
name|CHAR16
argument_list|)
argument_list|,
name|Walker
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|BluetoothDp
operator|->
name|BD_ADDR
operator|.
name|Address
index|[
name|Index
index|]
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|TempNumBuffer
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|TempNumBuffer
argument_list|)
expr_stmt|;
name|Walker
operator|+=
literal|2
expr_stmt|;
name|Index
operator|--
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|BluetoothDp
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Wi-Fi device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Wi-Fi device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextWiFi
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|SSIdStr
decl_stmt|;
name|CHAR8
name|AsciiStr
index|[
literal|33
index|]
decl_stmt|;
name|UINTN
name|DataLen
decl_stmt|;
name|WIFI_DEVICE_PATH
modifier|*
name|WiFiDp
decl_stmt|;
name|SSIdStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|WiFiDp
operator|=
operator|(
name|WIFI_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_WIFI_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|WIFI_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|!=
name|SSIdStr
condition|)
block|{
name|DataLen
operator|=
name|StrLen
argument_list|(
name|SSIdStr
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrLen
argument_list|(
name|SSIdStr
argument_list|)
operator|>
literal|32
condition|)
block|{
name|SSIdStr
index|[
literal|32
index|]
operator|=
literal|'\0'
expr_stmt|;
name|DataLen
operator|=
literal|32
expr_stmt|;
block|}
name|UnicodeStrToAsciiStrS
argument_list|(
name|SSIdStr
argument_list|,
name|AsciiStr
argument_list|,
sizeof|sizeof
argument_list|(
name|AsciiStr
argument_list|)
argument_list|)
expr_stmt|;
name|CopyMem
argument_list|(
name|WiFiDp
operator|->
name|SSId
argument_list|,
name|AsciiStr
argument_list|,
name|DataLen
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|WiFiDp
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to URI device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created URI device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextUri
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|UriStr
decl_stmt|;
name|UINTN
name|UriLength
decl_stmt|;
name|URI_DEVICE_PATH
modifier|*
name|Uri
decl_stmt|;
name|UriStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|UriLength
operator|=
name|StrnLenS
argument_list|(
name|UriStr
argument_list|,
name|MAX_UINT16
operator|-
sizeof|sizeof
argument_list|(
name|URI_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Uri
operator|=
operator|(
name|URI_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_URI_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|URI_DEVICE_PATH
argument_list|)
operator|+
name|UriLength
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|UriLength
operator|--
operator|!=
literal|0
condition|)
block|{
name|Uri
operator|->
name|Uri
index|[
name|UriLength
index|]
operator|=
operator|(
name|CHAR8
operator|)
name|UriStr
index|[
name|UriLength
index|]
expr_stmt|;
block|}
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Uri
return|;
block|}
end_function

begin_comment
comment|/**   Converts a media text device path node to media device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to media device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextMediaPath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|DevPathFromTextGenericPath
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to HD device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created HD device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextHD
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|PartitionStr
decl_stmt|;
name|CHAR16
modifier|*
name|TypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|SignatureStr
decl_stmt|;
name|CHAR16
modifier|*
name|StartStr
decl_stmt|;
name|CHAR16
modifier|*
name|SizeStr
decl_stmt|;
name|UINT32
name|Signature32
decl_stmt|;
name|HARDDRIVE_DEVICE_PATH
modifier|*
name|Hd
decl_stmt|;
name|PartitionStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|TypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SignatureStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|StartStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SizeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Hd
operator|=
operator|(
name|HARDDRIVE_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_HARDDRIVE_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|HARDDRIVE_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Hd
operator|->
name|PartitionNumber
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|PartitionStr
argument_list|)
expr_stmt|;
name|ZeroMem
argument_list|(
name|Hd
operator|->
name|Signature
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|Hd
operator|->
name|MBRType
operator|=
operator|(
name|UINT8
operator|)
literal|0
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"MBR"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Hd
operator|->
name|SignatureType
operator|=
name|SIGNATURE_TYPE_MBR
expr_stmt|;
name|Hd
operator|->
name|MBRType
operator|=
literal|0x01
expr_stmt|;
name|Signature32
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|SignatureStr
argument_list|)
expr_stmt|;
name|CopyMem
argument_list|(
name|Hd
operator|->
name|Signature
argument_list|,
operator|&
name|Signature32
argument_list|,
sizeof|sizeof
argument_list|(
name|UINT32
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"GPT"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Hd
operator|->
name|SignatureType
operator|=
name|SIGNATURE_TYPE_GUID
expr_stmt|;
name|Hd
operator|->
name|MBRType
operator|=
literal|0x02
expr_stmt|;
name|StrToGuid
argument_list|(
name|SignatureStr
argument_list|,
operator|(
name|EFI_GUID
operator|*
operator|)
name|Hd
operator|->
name|Signature
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Hd
operator|->
name|SignatureType
operator|=
operator|(
name|UINT8
operator|)
name|Strtoi
argument_list|(
name|TypeStr
argument_list|)
expr_stmt|;
block|}
name|Strtoi64
argument_list|(
name|StartStr
argument_list|,
operator|&
name|Hd
operator|->
name|PartitionStart
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|SizeStr
argument_list|,
operator|&
name|Hd
operator|->
name|PartitionSize
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Hd
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to CDROM device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created CDROM device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextCDROM
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|EntryStr
decl_stmt|;
name|CHAR16
modifier|*
name|StartStr
decl_stmt|;
name|CHAR16
modifier|*
name|SizeStr
decl_stmt|;
name|CDROM_DEVICE_PATH
modifier|*
name|CDROMDevPath
decl_stmt|;
name|EntryStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|StartStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|SizeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|CDROMDevPath
operator|=
operator|(
name|CDROM_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_CDROM_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|CDROM_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|CDROMDevPath
operator|->
name|BootEntry
operator|=
operator|(
name|UINT32
operator|)
name|Strtoi
argument_list|(
name|EntryStr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartStr
argument_list|,
operator|&
name|CDROMDevPath
operator|->
name|PartitionStart
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|SizeStr
argument_list|,
operator|&
name|CDROMDevPath
operator|->
name|PartitionSize
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|CDROMDevPath
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Vendor-defined media device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Vendor-defined media device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVenMedia
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|ConvertFromTextVendor
argument_list|(
name|TextDeviceNode
argument_list|,
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_VENDOR_DP
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to File device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created File device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFilePath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|FILEPATH_DEVICE_PATH
modifier|*
name|File
decl_stmt|;
ifndef|#
directive|ifndef
name|__FreeBSD__
name|File
operator|=
operator|(
name|FILEPATH_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_FILEPATH_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|FILEPATH_DEVICE_PATH
argument_list|)
operator|+
name|StrLen
argument_list|(
name|TextDeviceNode
argument_list|)
operator|*
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|StrCpyS
argument_list|(
name|File
operator|->
name|PathName
argument_list|,
name|StrLen
argument_list|(
name|TextDeviceNode
argument_list|)
operator|+
literal|1
argument_list|,
name|TextDeviceNode
argument_list|)
expr_stmt|;
else|#
directive|else
name|File
operator|=
operator|(
name|FILEPATH_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_FILEPATH_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|FILEPATH_DEVICE_PATH
argument_list|)
operator|+
name|StrLen
argument_list|(
name|TextDeviceNode
argument_list|)
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
comment|/*     * Note: We'd have to change the Tianocore header files to fix this    * to not need a cast.  Instead we just cast it here. The Interface    * to the user may have issues since this won't be a UCS-2    * string. Also note that in the original code, a NUL wasn't    * allocated for the end of the string, but we copy that below. This    * has been corrected.    */
name|StrCpyS
argument_list|(
operator|(
name|char
operator|*
operator|)
name|File
operator|->
name|PathName
argument_list|,
name|StrLen
argument_list|(
name|TextDeviceNode
argument_list|)
operator|+
literal|1
argument_list|,
name|TextDeviceNode
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|File
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to Media protocol device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Media protocol device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextMedia
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|MEDIA_PROTOCOL_DEVICE_PATH
modifier|*
name|Media
decl_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Media
operator|=
operator|(
name|MEDIA_PROTOCOL_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_PROTOCOL_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_PROTOCOL_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|GuidStr
argument_list|,
operator|&
name|Media
operator|->
name|Protocol
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Media
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to firmware volume device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created firmware volume device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFv
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|MEDIA_FW_VOL_DEVICE_PATH
modifier|*
name|Fv
decl_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Fv
operator|=
operator|(
name|MEDIA_FW_VOL_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_PIWG_FW_VOL_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_FW_VOL_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|GuidStr
argument_list|,
operator|&
name|Fv
operator|->
name|FvName
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Fv
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to firmware file device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created firmware file device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextFvFile
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|GuidStr
decl_stmt|;
name|MEDIA_FW_VOL_FILEPATH_DEVICE_PATH
modifier|*
name|FvFile
decl_stmt|;
name|GuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|FvFile
operator|=
operator|(
name|MEDIA_FW_VOL_FILEPATH_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_PIWG_FW_FILE_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_FW_VOL_FILEPATH_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|GuidStr
argument_list|,
operator|&
name|FvFile
operator|->
name|FvFileName
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|FvFile
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text relative offset device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextRelativeOffsetRange
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingOffsetStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingOffsetStr
decl_stmt|;
name|MEDIA_RELATIVE_OFFSET_RANGE_DEVICE_PATH
modifier|*
name|Offset
decl_stmt|;
name|StartingOffsetStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingOffsetStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Offset
operator|=
operator|(
name|MEDIA_RELATIVE_OFFSET_RANGE_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RELATIVE_OFFSET_RANGE_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RELATIVE_OFFSET_RANGE_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingOffsetStr
argument_list|,
operator|&
name|Offset
operator|->
name|StartingOffset
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingOffsetStr
argument_list|,
operator|&
name|Offset
operator|->
name|EndingOffset
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Offset
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text ram disk device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextRamDisk
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|TypeGuidStr
decl_stmt|;
name|CHAR16
modifier|*
name|InstanceStr
decl_stmt|;
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|UINT64
name|StartingAddr
decl_stmt|;
name|UINT64
name|EndingAddr
decl_stmt|;
name|StartingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InstanceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|TypeGuidStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RamDisk
operator|=
operator|(
name|MEDIA_RAM_DISK_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RAM_DISK_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RAM_DISK_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddrStr
argument_list|,
operator|&
name|StartingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|StartingAddr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddrStr
argument_list|,
operator|&
name|EndingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|EndingAddr
argument_list|)
expr_stmt|;
name|RamDisk
operator|->
name|Instance
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InstanceStr
argument_list|)
expr_stmt|;
name|StrToGuid
argument_list|(
name|TypeGuidStr
argument_list|,
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|RamDisk
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text virtual disk device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVirtualDisk
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|InstanceStr
decl_stmt|;
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|UINT64
name|StartingAddr
decl_stmt|;
name|UINT64
name|EndingAddr
decl_stmt|;
name|StartingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InstanceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RamDisk
operator|=
operator|(
name|MEDIA_RAM_DISK_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RAM_DISK_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RAM_DISK_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddrStr
argument_list|,
operator|&
name|StartingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|StartingAddr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddrStr
argument_list|,
operator|&
name|EndingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|EndingAddr
argument_list|)
expr_stmt|;
name|RamDisk
operator|->
name|Instance
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InstanceStr
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiVirtualDiskGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|RamDisk
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text virtual cd device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextVirtualCd
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|InstanceStr
decl_stmt|;
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|UINT64
name|StartingAddr
decl_stmt|;
name|UINT64
name|EndingAddr
decl_stmt|;
name|StartingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InstanceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RamDisk
operator|=
operator|(
name|MEDIA_RAM_DISK_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RAM_DISK_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RAM_DISK_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddrStr
argument_list|,
operator|&
name|StartingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|StartingAddr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddrStr
argument_list|,
operator|&
name|EndingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|EndingAddr
argument_list|)
expr_stmt|;
name|RamDisk
operator|->
name|Instance
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InstanceStr
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiVirtualCdGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|RamDisk
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text persistent virtual disk device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPersistentVirtualDisk
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|InstanceStr
decl_stmt|;
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|UINT64
name|StartingAddr
decl_stmt|;
name|UINT64
name|EndingAddr
decl_stmt|;
name|StartingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InstanceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RamDisk
operator|=
operator|(
name|MEDIA_RAM_DISK_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RAM_DISK_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RAM_DISK_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddrStr
argument_list|,
operator|&
name|StartingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|StartingAddr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddrStr
argument_list|,
operator|&
name|EndingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|EndingAddr
argument_list|)
expr_stmt|;
name|RamDisk
operator|->
name|Instance
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InstanceStr
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiPersistentVirtualDiskGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|RamDisk
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to text persistent virtual cd device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created Text device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextPersistentVirtualCd
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|StartingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|EndingAddrStr
decl_stmt|;
name|CHAR16
modifier|*
name|InstanceStr
decl_stmt|;
name|MEDIA_RAM_DISK_DEVICE_PATH
modifier|*
name|RamDisk
decl_stmt|;
name|UINT64
name|StartingAddr
decl_stmt|;
name|UINT64
name|EndingAddr
decl_stmt|;
name|StartingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|EndingAddrStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|InstanceStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|RamDisk
operator|=
operator|(
name|MEDIA_RAM_DISK_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MEDIA_DEVICE_PATH
argument_list|,
name|MEDIA_RAM_DISK_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|MEDIA_RAM_DISK_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|StartingAddrStr
argument_list|,
operator|&
name|StartingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|StartingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|StartingAddr
argument_list|)
expr_stmt|;
name|Strtoi64
argument_list|(
name|EndingAddrStr
argument_list|,
operator|&
name|EndingAddr
argument_list|)
expr_stmt|;
name|WriteUnaligned64
argument_list|(
operator|(
name|UINT64
operator|*
operator|)
operator|&
operator|(
name|RamDisk
operator|->
name|EndingAddr
index|[
literal|0
index|]
operator|)
argument_list|,
name|EndingAddr
argument_list|)
expr_stmt|;
name|RamDisk
operator|->
name|Instance
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|InstanceStr
argument_list|)
expr_stmt|;
name|CopyGuid
argument_list|(
operator|&
name|RamDisk
operator|->
name|TypeGuid
argument_list|,
operator|&
name|gEfiPersistentVirtualCdGuid
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|RamDisk
return|;
block|}
end_function

begin_comment
comment|/**   Converts a BBS text device path node to BBS device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to BBS device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextBbsPath
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
return|return
name|DevPathFromTextGenericPath
argument_list|(
name|BBS_DEVICE_PATH
argument_list|,
name|TextDeviceNode
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to BIOS Boot Specification device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created BIOS Boot Specification device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextBBS
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|CHAR16
modifier|*
name|TypeStr
decl_stmt|;
name|CHAR16
modifier|*
name|IdStr
decl_stmt|;
name|CHAR16
modifier|*
name|FlagsStr
decl_stmt|;
name|CHAR8
modifier|*
name|AsciiStr
decl_stmt|;
name|BBS_BBS_DEVICE_PATH
modifier|*
name|Bbs
decl_stmt|;
name|TypeStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|IdStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|FlagsStr
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Bbs
operator|=
operator|(
name|BBS_BBS_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|BBS_DEVICE_PATH
argument_list|,
name|BBS_BBS_DP
argument_list|,
call|(
name|UINT16
call|)
argument_list|(
sizeof|sizeof
argument_list|(
name|BBS_BBS_DEVICE_PATH
argument_list|)
operator|+
name|StrLen
argument_list|(
name|IdStr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"Floppy"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_FLOPPY
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"HD"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_HARDDRIVE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"CDROM"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_CDROM
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"PCMCIA"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_PCMCIA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"USB"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_USB
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|StrCmp
argument_list|(
name|TypeStr
argument_list|,
literal|"Network"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
name|BBS_TYPE_EMBEDDED_NETWORK
expr_stmt|;
block|}
else|else
block|{
name|Bbs
operator|->
name|DeviceType
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|TypeStr
argument_list|)
expr_stmt|;
block|}
name|AsciiStr
operator|=
name|Bbs
operator|->
name|String
expr_stmt|;
name|StrToAscii
argument_list|(
name|IdStr
argument_list|,
operator|&
name|AsciiStr
argument_list|)
expr_stmt|;
name|Bbs
operator|->
name|StatusFlag
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|FlagsStr
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Bbs
return|;
block|}
end_function

begin_comment
comment|/**   Converts a text device path node to SATA device path structure.    @param TextDeviceNode  The input Text device path node.    @return A pointer to the newly-created SATA device path structure.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevPathFromTextSata
parameter_list|(
name|IN
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|SATA_DEVICE_PATH
modifier|*
name|Sata
decl_stmt|;
name|CHAR16
modifier|*
name|Param1
decl_stmt|;
name|CHAR16
modifier|*
name|Param2
decl_stmt|;
name|CHAR16
modifier|*
name|Param3
decl_stmt|;
name|Param1
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Param2
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Param3
operator|=
name|GetNextParamStr
argument_list|(
operator|&
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|Sata
operator|=
operator|(
name|SATA_DEVICE_PATH
operator|*
operator|)
name|CreateDeviceNode
argument_list|(
name|MESSAGING_DEVICE_PATH
argument_list|,
name|MSG_SATA_DP
argument_list|,
operator|(
name|UINT16
operator|)
sizeof|sizeof
argument_list|(
name|SATA_DEVICE_PATH
argument_list|)
argument_list|)
expr_stmt|;
name|Sata
operator|->
name|HBAPortNumber
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|Param1
argument_list|)
expr_stmt|;
name|Sata
operator|->
name|PortMultiplierPortNumber
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|Param2
argument_list|)
expr_stmt|;
name|Sata
operator|->
name|Lun
operator|=
operator|(
name|UINT16
operator|)
name|Strtoi
argument_list|(
name|Param3
argument_list|)
expr_stmt|;
return|return
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|Sata
return|;
block|}
end_function

begin_decl_stmt
name|GLOBAL_REMOVE_IF_UNREFERENCED
name|DEVICE_PATH_FROM_TEXT_TABLE
name|mUefiDevicePathLibDevPathFromTextTable
index|[]
init|=
block|{
block|{
literal|"Path"
block|,
name|DevPathFromTextPath
block|}
block|,
block|{
literal|"HardwarePath"
block|,
name|DevPathFromTextHardwarePath
block|}
block|,
block|{
literal|"Pci"
block|,
name|DevPathFromTextPci
block|}
block|,
block|{
literal|"PcCard"
block|,
name|DevPathFromTextPcCard
block|}
block|,
block|{
literal|"MemoryMapped"
block|,
name|DevPathFromTextMemoryMapped
block|}
block|,
block|{
literal|"VenHw"
block|,
name|DevPathFromTextVenHw
block|}
block|,
block|{
literal|"Ctrl"
block|,
name|DevPathFromTextCtrl
block|}
block|,
block|{
literal|"BMC"
block|,
name|DevPathFromTextBmc
block|}
block|,
block|{
literal|"AcpiPath"
block|,
name|DevPathFromTextAcpiPath
block|}
block|,
block|{
literal|"Acpi"
block|,
name|DevPathFromTextAcpi
block|}
block|,
block|{
literal|"PciRoot"
block|,
name|DevPathFromTextPciRoot
block|}
block|,
block|{
literal|"PcieRoot"
block|,
name|DevPathFromTextPcieRoot
block|}
block|,
block|{
literal|"Floppy"
block|,
name|DevPathFromTextFloppy
block|}
block|,
block|{
literal|"Keyboard"
block|,
name|DevPathFromTextKeyboard
block|}
block|,
block|{
literal|"Serial"
block|,
name|DevPathFromTextSerial
block|}
block|,
block|{
literal|"ParallelPort"
block|,
name|DevPathFromTextParallelPort
block|}
block|,
block|{
literal|"AcpiEx"
block|,
name|DevPathFromTextAcpiEx
block|}
block|,
block|{
literal|"AcpiExp"
block|,
name|DevPathFromTextAcpiExp
block|}
block|,
block|{
literal|"AcpiAdr"
block|,
name|DevPathFromTextAcpiAdr
block|}
block|,
block|{
literal|"Msg"
block|,
name|DevPathFromTextMsg
block|}
block|,
block|{
literal|"Ata"
block|,
name|DevPathFromTextAta
block|}
block|,
block|{
literal|"Scsi"
block|,
name|DevPathFromTextScsi
block|}
block|,
block|{
literal|"Fibre"
block|,
name|DevPathFromTextFibre
block|}
block|,
block|{
literal|"FibreEx"
block|,
name|DevPathFromTextFibreEx
block|}
block|,
block|{
literal|"I1394"
block|,
name|DevPathFromText1394
block|}
block|,
block|{
literal|"USB"
block|,
name|DevPathFromTextUsb
block|}
block|,
block|{
literal|"I2O"
block|,
name|DevPathFromTextI2O
block|}
block|,
block|{
literal|"Infiniband"
block|,
name|DevPathFromTextInfiniband
block|}
block|,
block|{
literal|"VenMsg"
block|,
name|DevPathFromTextVenMsg
block|}
block|,
block|{
literal|"VenPcAnsi"
block|,
name|DevPathFromTextVenPcAnsi
block|}
block|,
block|{
literal|"VenVt100"
block|,
name|DevPathFromTextVenVt100
block|}
block|,
block|{
literal|"VenVt100Plus"
block|,
name|DevPathFromTextVenVt100Plus
block|}
block|,
block|{
literal|"VenUtf8"
block|,
name|DevPathFromTextVenUtf8
block|}
block|,
block|{
literal|"UartFlowCtrl"
block|,
name|DevPathFromTextUartFlowCtrl
block|}
block|,
block|{
literal|"SAS"
block|,
name|DevPathFromTextSAS
block|}
block|,
block|{
literal|"SasEx"
block|,
name|DevPathFromTextSasEx
block|}
block|,
block|{
literal|"NVMe"
block|,
name|DevPathFromTextNVMe
block|}
block|,
block|{
literal|"UFS"
block|,
name|DevPathFromTextUfs
block|}
block|,
block|{
literal|"SD"
block|,
name|DevPathFromTextSd
block|}
block|,
block|{
literal|"eMMC"
block|,
name|DevPathFromTextEmmc
block|}
block|,
block|{
literal|"DebugPort"
block|,
name|DevPathFromTextDebugPort
block|}
block|,
block|{
literal|"MAC"
block|,
name|DevPathFromTextMAC
block|}
block|,
block|{
literal|"IPv4"
block|,
name|DevPathFromTextIPv4
block|}
block|,
block|{
literal|"IPv6"
block|,
name|DevPathFromTextIPv6
block|}
block|,
block|{
literal|"Uart"
block|,
name|DevPathFromTextUart
block|}
block|,
block|{
literal|"UsbClass"
block|,
name|DevPathFromTextUsbClass
block|}
block|,
block|{
literal|"UsbAudio"
block|,
name|DevPathFromTextUsbAudio
block|}
block|,
block|{
literal|"UsbCDCControl"
block|,
name|DevPathFromTextUsbCDCControl
block|}
block|,
block|{
literal|"UsbHID"
block|,
name|DevPathFromTextUsbHID
block|}
block|,
block|{
literal|"UsbImage"
block|,
name|DevPathFromTextUsbImage
block|}
block|,
block|{
literal|"UsbPrinter"
block|,
name|DevPathFromTextUsbPrinter
block|}
block|,
block|{
literal|"UsbMassStorage"
block|,
name|DevPathFromTextUsbMassStorage
block|}
block|,
block|{
literal|"UsbHub"
block|,
name|DevPathFromTextUsbHub
block|}
block|,
block|{
literal|"UsbCDCData"
block|,
name|DevPathFromTextUsbCDCData
block|}
block|,
block|{
literal|"UsbSmartCard"
block|,
name|DevPathFromTextUsbSmartCard
block|}
block|,
block|{
literal|"UsbVideo"
block|,
name|DevPathFromTextUsbVideo
block|}
block|,
block|{
literal|"UsbDiagnostic"
block|,
name|DevPathFromTextUsbDiagnostic
block|}
block|,
block|{
literal|"UsbWireless"
block|,
name|DevPathFromTextUsbWireless
block|}
block|,
block|{
literal|"UsbDeviceFirmwareUpdate"
block|,
name|DevPathFromTextUsbDeviceFirmwareUpdate
block|}
block|,
block|{
literal|"UsbIrdaBridge"
block|,
name|DevPathFromTextUsbIrdaBridge
block|}
block|,
block|{
literal|"UsbTestAndMeasurement"
block|,
name|DevPathFromTextUsbTestAndMeasurement
block|}
block|,
block|{
literal|"UsbWwid"
block|,
name|DevPathFromTextUsbWwid
block|}
block|,
block|{
literal|"Unit"
block|,
name|DevPathFromTextUnit
block|}
block|,
block|{
literal|"iSCSI"
block|,
name|DevPathFromTextiSCSI
block|}
block|,
block|{
literal|"Vlan"
block|,
name|DevPathFromTextVlan
block|}
block|,
block|{
literal|"Uri"
block|,
name|DevPathFromTextUri
block|}
block|,
block|{
literal|"Bluetooth"
block|,
name|DevPathFromTextBluetooth
block|}
block|,
block|{
literal|"Wi-Fi"
block|,
name|DevPathFromTextWiFi
block|}
block|,
block|{
literal|"MediaPath"
block|,
name|DevPathFromTextMediaPath
block|}
block|,
block|{
literal|"HD"
block|,
name|DevPathFromTextHD
block|}
block|,
block|{
literal|"CDROM"
block|,
name|DevPathFromTextCDROM
block|}
block|,
block|{
literal|"VenMedia"
block|,
name|DevPathFromTextVenMedia
block|}
block|,
block|{
literal|"Media"
block|,
name|DevPathFromTextMedia
block|}
block|,
block|{
literal|"Fv"
block|,
name|DevPathFromTextFv
block|}
block|,
block|{
literal|"FvFile"
block|,
name|DevPathFromTextFvFile
block|}
block|,
block|{
literal|"Offset"
block|,
name|DevPathFromTextRelativeOffsetRange
block|}
block|,
block|{
literal|"RamDisk"
block|,
name|DevPathFromTextRamDisk
block|}
block|,
block|{
literal|"VirtualDisk"
block|,
name|DevPathFromTextVirtualDisk
block|}
block|,
block|{
literal|"VirtualCD"
block|,
name|DevPathFromTextVirtualCd
block|}
block|,
block|{
literal|"PersistentVirtualDisk"
block|,
name|DevPathFromTextPersistentVirtualDisk
block|}
block|,
block|{
literal|"PersistentVirtualCD"
block|,
name|DevPathFromTextPersistentVirtualCd
block|}
block|,
block|{
literal|"BbsPath"
block|,
name|DevPathFromTextBbsPath
block|}
block|,
block|{
literal|"BBS"
block|,
name|DevPathFromTextBBS
block|}
block|,
block|{
literal|"Sata"
block|,
name|DevPathFromTextSata
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**   Convert text to the binary representation of a device node.    @param TextDeviceNode  TextDeviceNode points to the text representation of a device                          node. Conversion starts with the first character and continues                          until the first non-device node character.    @return A pointer to the EFI device node or NULL if TextDeviceNode is NULL or there was           insufficient memory or text unsupported.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|EFIAPI
name|UefiDevicePathLibConvertTextToDeviceNode
parameter_list|(
name|IN
name|CONST
name|CHAR16
modifier|*
name|TextDeviceNode
parameter_list|)
block|{
name|DEVICE_PATH_FROM_TEXT
name|FromText
decl_stmt|;
name|CHAR16
modifier|*
name|ParamStr
decl_stmt|;
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DeviceNode
decl_stmt|;
name|CHAR16
modifier|*
name|DeviceNodeStr
decl_stmt|;
name|UINTN
name|Index
decl_stmt|;
if|if
condition|(
operator|(
name|TextDeviceNode
operator|==
name|NULL
operator|)
operator|||
operator|(
name|IS_NULL
argument_list|(
operator|*
name|TextDeviceNode
argument_list|)
operator|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|ParamStr
operator|=
name|NULL
expr_stmt|;
name|FromText
operator|=
name|NULL
expr_stmt|;
name|DeviceNodeStr
operator|=
name|UefiDevicePathLibStrDuplicate
argument_list|(
name|TextDeviceNode
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|DeviceNodeStr
operator|!=
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|Index
operator|=
literal|0
init|;
name|mUefiDevicePathLibDevPathFromTextTable
index|[
name|Index
index|]
operator|.
name|Function
operator|!=
name|NULL
condition|;
name|Index
operator|++
control|)
block|{
name|ParamStr
operator|=
name|GetParamByNodeName
argument_list|(
name|DeviceNodeStr
argument_list|,
name|mUefiDevicePathLibDevPathFromTextTable
index|[
name|Index
index|]
operator|.
name|DevicePathNodeText
argument_list|)
expr_stmt|;
if|if
condition|(
name|ParamStr
operator|!=
name|NULL
condition|)
block|{
name|FromText
operator|=
name|mUefiDevicePathLibDevPathFromTextTable
index|[
name|Index
index|]
operator|.
name|Function
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|FromText
operator|==
name|NULL
condition|)
block|{
comment|//
comment|// A file path
comment|//
name|FromText
operator|=
name|DevPathFromTextFilePath
expr_stmt|;
name|DeviceNode
operator|=
name|FromText
argument_list|(
name|DeviceNodeStr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DeviceNode
operator|=
name|FromText
argument_list|(
name|ParamStr
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|ParamStr
argument_list|)
expr_stmt|;
block|}
name|FreePool
argument_list|(
name|DeviceNodeStr
argument_list|)
expr_stmt|;
return|return
name|DeviceNode
return|;
block|}
end_function

begin_comment
comment|/**   Convert text to the binary representation of a device path.     @param TextDevicePath  TextDevicePath points to the text representation of a device                          path. Conversion starts with the first character and continues                          until the first non-device node character.    @return A pointer to the allocated device path or NULL if TextDeviceNode is NULL or           there was insufficient memory.  **/
end_comment

begin_function
specifier|static
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|EFIAPI
name|UefiDevicePathLibConvertTextToDevicePath
parameter_list|(
name|IN
name|CONST
name|CHAR16
modifier|*
name|TextDevicePath
parameter_list|)
block|{
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DeviceNode
decl_stmt|;
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|NewDevicePath
decl_stmt|;
name|CHAR16
modifier|*
name|DevicePathStr
decl_stmt|;
name|CHAR16
modifier|*
name|Str
decl_stmt|;
name|CHAR16
modifier|*
name|DeviceNodeStr
decl_stmt|;
name|BOOLEAN
name|IsInstanceEnd
decl_stmt|;
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|DevicePath
decl_stmt|;
if|if
condition|(
operator|(
name|TextDevicePath
operator|==
name|NULL
operator|)
operator|||
operator|(
name|IS_NULL
argument_list|(
operator|*
name|TextDevicePath
argument_list|)
operator|)
condition|)
block|{
return|return
name|NULL
return|;
block|}
name|DevicePath
operator|=
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AllocatePool
argument_list|(
name|END_DEVICE_PATH_LENGTH
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|DevicePath
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|SetDevicePathEndNode
argument_list|(
name|DevicePath
argument_list|)
expr_stmt|;
name|DevicePathStr
operator|=
name|UefiDevicePathLibStrDuplicate
argument_list|(
name|TextDevicePath
argument_list|)
expr_stmt|;
name|Str
operator|=
name|DevicePathStr
expr_stmt|;
while|while
condition|(
operator|(
name|DeviceNodeStr
operator|=
name|GetNextDeviceNodeStr
argument_list|(
operator|&
name|Str
argument_list|,
operator|&
name|IsInstanceEnd
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|DeviceNode
operator|=
name|UefiDevicePathLibConvertTextToDeviceNode
argument_list|(
name|DeviceNodeStr
argument_list|)
expr_stmt|;
name|NewDevicePath
operator|=
name|AppendDevicePathNode
argument_list|(
name|DevicePath
argument_list|,
name|DeviceNode
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|DevicePath
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|DeviceNode
argument_list|)
expr_stmt|;
name|DevicePath
operator|=
name|NewDevicePath
expr_stmt|;
if|if
condition|(
name|IsInstanceEnd
condition|)
block|{
name|DeviceNode
operator|=
operator|(
name|EFI_DEVICE_PATH_PROTOCOL
operator|*
operator|)
name|AllocatePool
argument_list|(
name|END_DEVICE_PATH_LENGTH
argument_list|)
expr_stmt|;
name|ASSERT
argument_list|(
name|DeviceNode
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|SetDevicePathEndNode
argument_list|(
name|DeviceNode
argument_list|)
expr_stmt|;
comment|// Fix from https://bugzilla.tianocore.org/show_bug.cgi?id=419
name|DeviceNode
operator|->
name|SubType
operator|=
name|END_INSTANCE_DEVICE_PATH_SUBTYPE
expr_stmt|;
name|NewDevicePath
operator|=
name|AppendDevicePathNode
argument_list|(
name|DevicePath
argument_list|,
name|DeviceNode
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|DevicePath
argument_list|)
expr_stmt|;
name|FreePool
argument_list|(
name|DeviceNode
argument_list|)
expr_stmt|;
name|DevicePath
operator|=
name|NewDevicePath
expr_stmt|;
block|}
block|}
name|FreePool
argument_list|(
name|DevicePathStr
argument_list|)
expr_stmt|;
return|return
name|DevicePath
return|;
block|}
end_function

begin_function
name|ssize_t
name|efidp_parse_device_path
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|efidp
name|out
parameter_list|,
name|size_t
name|max
parameter_list|)
block|{
name|EFI_DEVICE_PATH_PROTOCOL
modifier|*
name|dp
decl_stmt|;
name|UINTN
name|len
decl_stmt|;
name|dp
operator|=
name|UefiDevicePathLibConvertTextToDevicePath
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|len
operator|=
name|GetDevicePathSize
argument_list|(
name|dp
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|max
condition|)
block|{
name|free
argument_list|(
name|dp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|memcpy
argument_list|(
name|out
argument_list|,
name|dp
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|dp
argument_list|)
expr_stmt|;
return|return
name|len
return|;
block|}
end_function

end_unit

