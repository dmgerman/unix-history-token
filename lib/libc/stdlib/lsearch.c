begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Initial implementation:  * Copyright (c) 2002 Robert Drehmel  * All rights reserved.  *  * As long as the above copyright statement and this notice remain  * unchanged, you can do what ever you want with this file.   */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_define
define|#
directive|define
name|_SEARCH_PRIVATE
end_define

begin_include
include|#
directive|include
file|<search.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_comment
comment|/* for uint8_t */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_comment
comment|/* for NULL */
end_comment

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_comment
comment|/* for memcpy() prototype */
end_comment

begin_function_decl
specifier|static
name|void
modifier|*
name|lwork
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|,
name|size_t
modifier|*
parameter_list|,
name|size_t
parameter_list|,
name|int
function_decl|(
modifier|*
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
modifier|*
name|lsearch
parameter_list|(
specifier|const
name|void
modifier|*
name|key
parameter_list|,
name|void
modifier|*
name|base
parameter_list|,
name|size_t
modifier|*
name|nelp
parameter_list|,
name|size_t
name|width
parameter_list|,
name|int
function_decl|(
modifier|*
name|compar
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
parameter_list|)
block|{
return|return
operator|(
name|lwork
argument_list|(
name|key
argument_list|,
name|base
argument_list|,
name|nelp
argument_list|,
name|width
argument_list|,
name|compar
argument_list|,
literal|1
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|lfind
parameter_list|(
specifier|const
name|void
modifier|*
name|key
parameter_list|,
specifier|const
name|void
modifier|*
name|base
parameter_list|,
name|size_t
modifier|*
name|nelp
parameter_list|,
name|size_t
name|width
parameter_list|,
name|int
function_decl|(
modifier|*
name|compar
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
parameter_list|)
block|{
return|return
operator|(
name|lwork
argument_list|(
name|key
argument_list|,
name|base
argument_list|,
name|nelp
argument_list|,
name|width
argument_list|,
name|compar
argument_list|,
literal|0
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
modifier|*
name|lwork
parameter_list|(
specifier|const
name|void
modifier|*
name|key
parameter_list|,
specifier|const
name|void
modifier|*
name|base
parameter_list|,
name|size_t
modifier|*
name|nelp
parameter_list|,
name|size_t
name|width
parameter_list|,
name|int
function_decl|(
modifier|*
name|compar
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
parameter_list|,
name|int
name|addelem
parameter_list|)
block|{
name|uint8_t
modifier|*
name|ep
decl_stmt|,
modifier|*
name|endp
decl_stmt|;
comment|/* 	 * Cast to an integer value first to avoid the warning for removing 	 * 'const' via a cast. 	 */
name|ep
operator|=
operator|(
name|uint8_t
operator|*
operator|)
operator|(
name|uintptr_t
operator|)
name|base
expr_stmt|;
for|for
control|(
name|endp
operator|=
operator|(
name|uint8_t
operator|*
operator|)
operator|(
name|ep
operator|+
name|width
operator|*
operator|*
name|nelp
operator|)
init|;
name|ep
operator|<
name|endp
condition|;
name|ep
operator|+=
name|width
control|)
block|{
if|if
condition|(
name|compar
argument_list|(
name|key
argument_list|,
name|ep
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|ep
operator|)
return|;
block|}
comment|/* lfind() shall return when the key was not found. */
if|if
condition|(
operator|!
name|addelem
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 	 * lsearch() adds the key to the end of the table and increments 	 * the number of elements. 	 */
name|memcpy
argument_list|(
name|endp
argument_list|,
name|key
argument_list|,
name|width
argument_list|)
expr_stmt|;
operator|++
operator|*
name|nelp
expr_stmt|;
return|return
operator|(
name|endp
operator|)
return|;
block|}
end_function

end_unit

