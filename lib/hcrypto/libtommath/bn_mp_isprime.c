begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* TomsFastMath, a fast ISO C bignum library.  *  * This project is meant to fill in where LibTomMath  * falls short.  That is speed ;-)  *  * This project is public domain and free for all purposes.  *  * Tom St Denis, tomstdenis@gmail.com  */
end_comment

begin_include
include|#
directive|include
file|<tommath.h>
end_include

begin_comment
comment|/* a few primes */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|mp_digit
name|primes
index|[
literal|256
index|]
init|=
block|{
literal|0x0002
block|,
literal|0x0003
block|,
literal|0x0005
block|,
literal|0x0007
block|,
literal|0x000B
block|,
literal|0x000D
block|,
literal|0x0011
block|,
literal|0x0013
block|,
literal|0x0017
block|,
literal|0x001D
block|,
literal|0x001F
block|,
literal|0x0025
block|,
literal|0x0029
block|,
literal|0x002B
block|,
literal|0x002F
block|,
literal|0x0035
block|,
literal|0x003B
block|,
literal|0x003D
block|,
literal|0x0043
block|,
literal|0x0047
block|,
literal|0x0049
block|,
literal|0x004F
block|,
literal|0x0053
block|,
literal|0x0059
block|,
literal|0x0061
block|,
literal|0x0065
block|,
literal|0x0067
block|,
literal|0x006B
block|,
literal|0x006D
block|,
literal|0x0071
block|,
literal|0x007F
block|,
literal|0x0083
block|,
literal|0x0089
block|,
literal|0x008B
block|,
literal|0x0095
block|,
literal|0x0097
block|,
literal|0x009D
block|,
literal|0x00A3
block|,
literal|0x00A7
block|,
literal|0x00AD
block|,
literal|0x00B3
block|,
literal|0x00B5
block|,
literal|0x00BF
block|,
literal|0x00C1
block|,
literal|0x00C5
block|,
literal|0x00C7
block|,
literal|0x00D3
block|,
literal|0x00DF
block|,
literal|0x00E3
block|,
literal|0x00E5
block|,
literal|0x00E9
block|,
literal|0x00EF
block|,
literal|0x00F1
block|,
literal|0x00FB
block|,
literal|0x0101
block|,
literal|0x0107
block|,
literal|0x010D
block|,
literal|0x010F
block|,
literal|0x0115
block|,
literal|0x0119
block|,
literal|0x011B
block|,
literal|0x0125
block|,
literal|0x0133
block|,
literal|0x0137
block|,
literal|0x0139
block|,
literal|0x013D
block|,
literal|0x014B
block|,
literal|0x0151
block|,
literal|0x015B
block|,
literal|0x015D
block|,
literal|0x0161
block|,
literal|0x0167
block|,
literal|0x016F
block|,
literal|0x0175
block|,
literal|0x017B
block|,
literal|0x017F
block|,
literal|0x0185
block|,
literal|0x018D
block|,
literal|0x0191
block|,
literal|0x0199
block|,
literal|0x01A3
block|,
literal|0x01A5
block|,
literal|0x01AF
block|,
literal|0x01B1
block|,
literal|0x01B7
block|,
literal|0x01BB
block|,
literal|0x01C1
block|,
literal|0x01C9
block|,
literal|0x01CD
block|,
literal|0x01CF
block|,
literal|0x01D3
block|,
literal|0x01DF
block|,
literal|0x01E7
block|,
literal|0x01EB
block|,
literal|0x01F3
block|,
literal|0x01F7
block|,
literal|0x01FD
block|,
literal|0x0209
block|,
literal|0x020B
block|,
literal|0x021D
block|,
literal|0x0223
block|,
literal|0x022D
block|,
literal|0x0233
block|,
literal|0x0239
block|,
literal|0x023B
block|,
literal|0x0241
block|,
literal|0x024B
block|,
literal|0x0251
block|,
literal|0x0257
block|,
literal|0x0259
block|,
literal|0x025F
block|,
literal|0x0265
block|,
literal|0x0269
block|,
literal|0x026B
block|,
literal|0x0277
block|,
literal|0x0281
block|,
literal|0x0283
block|,
literal|0x0287
block|,
literal|0x028D
block|,
literal|0x0293
block|,
literal|0x0295
block|,
literal|0x02A1
block|,
literal|0x02A5
block|,
literal|0x02AB
block|,
literal|0x02B3
block|,
literal|0x02BD
block|,
literal|0x02C5
block|,
literal|0x02CF
block|,
literal|0x02D7
block|,
literal|0x02DD
block|,
literal|0x02E3
block|,
literal|0x02E7
block|,
literal|0x02EF
block|,
literal|0x02F5
block|,
literal|0x02F9
block|,
literal|0x0301
block|,
literal|0x0305
block|,
literal|0x0313
block|,
literal|0x031D
block|,
literal|0x0329
block|,
literal|0x032B
block|,
literal|0x0335
block|,
literal|0x0337
block|,
literal|0x033B
block|,
literal|0x033D
block|,
literal|0x0347
block|,
literal|0x0355
block|,
literal|0x0359
block|,
literal|0x035B
block|,
literal|0x035F
block|,
literal|0x036D
block|,
literal|0x0371
block|,
literal|0x0373
block|,
literal|0x0377
block|,
literal|0x038B
block|,
literal|0x038F
block|,
literal|0x0397
block|,
literal|0x03A1
block|,
literal|0x03A9
block|,
literal|0x03AD
block|,
literal|0x03B3
block|,
literal|0x03B9
block|,
literal|0x03C7
block|,
literal|0x03CB
block|,
literal|0x03D1
block|,
literal|0x03D7
block|,
literal|0x03DF
block|,
literal|0x03E5
block|,
literal|0x03F1
block|,
literal|0x03F5
block|,
literal|0x03FB
block|,
literal|0x03FD
block|,
literal|0x0407
block|,
literal|0x0409
block|,
literal|0x040F
block|,
literal|0x0419
block|,
literal|0x041B
block|,
literal|0x0425
block|,
literal|0x0427
block|,
literal|0x042D
block|,
literal|0x043F
block|,
literal|0x0443
block|,
literal|0x0445
block|,
literal|0x0449
block|,
literal|0x044F
block|,
literal|0x0455
block|,
literal|0x045D
block|,
literal|0x0463
block|,
literal|0x0469
block|,
literal|0x047F
block|,
literal|0x0481
block|,
literal|0x048B
block|,
literal|0x0493
block|,
literal|0x049D
block|,
literal|0x04A3
block|,
literal|0x04A9
block|,
literal|0x04B1
block|,
literal|0x04BD
block|,
literal|0x04C1
block|,
literal|0x04C7
block|,
literal|0x04CD
block|,
literal|0x04CF
block|,
literal|0x04D5
block|,
literal|0x04E1
block|,
literal|0x04EB
block|,
literal|0x04FD
block|,
literal|0x04FF
block|,
literal|0x0503
block|,
literal|0x0509
block|,
literal|0x050B
block|,
literal|0x0511
block|,
literal|0x0515
block|,
literal|0x0517
block|,
literal|0x051B
block|,
literal|0x0527
block|,
literal|0x0529
block|,
literal|0x052F
block|,
literal|0x0551
block|,
literal|0x0557
block|,
literal|0x055D
block|,
literal|0x0565
block|,
literal|0x0577
block|,
literal|0x0581
block|,
literal|0x058F
block|,
literal|0x0593
block|,
literal|0x0595
block|,
literal|0x0599
block|,
literal|0x059F
block|,
literal|0x05A7
block|,
literal|0x05AB
block|,
literal|0x05AD
block|,
literal|0x05B3
block|,
literal|0x05BF
block|,
literal|0x05C9
block|,
literal|0x05CB
block|,
literal|0x05CF
block|,
literal|0x05D1
block|,
literal|0x05D5
block|,
literal|0x05DB
block|,
literal|0x05E7
block|,
literal|0x05F3
block|,
literal|0x05FB
block|,
literal|0x0607
block|,
literal|0x060D
block|,
literal|0x0611
block|,
literal|0x0617
block|,
literal|0x061F
block|,
literal|0x0623
block|,
literal|0x062B
block|,
literal|0x062F
block|,
literal|0x063D
block|,
literal|0x0641
block|,
literal|0x0647
block|,
literal|0x0649
block|,
literal|0x064D
block|,
literal|0x0653
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|mp_isprime
parameter_list|(
name|mp_int
modifier|*
name|a
parameter_list|)
block|{
name|mp_int
name|b
decl_stmt|;
name|mp_digit
name|d
decl_stmt|;
name|int
name|r
decl_stmt|,
name|res
decl_stmt|;
comment|/* do trial division */
for|for
control|(
name|r
operator|=
literal|0
init|;
name|r
operator|<
literal|256
condition|;
name|r
operator|++
control|)
block|{
name|mp_mod_d
argument_list|(
name|a
argument_list|,
name|primes
index|[
name|r
index|]
argument_list|,
operator|&
name|d
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|==
literal|0
condition|)
block|{
return|return
name|MP_NO
return|;
block|}
block|}
comment|/* now do 8 miller rabins */
name|mp_init
argument_list|(
operator|&
name|b
argument_list|)
expr_stmt|;
for|for
control|(
name|r
operator|=
literal|0
init|;
name|r
operator|<
literal|128
condition|;
name|r
operator|++
control|)
block|{
name|mp_set
argument_list|(
operator|&
name|b
argument_list|,
name|primes
index|[
name|r
index|]
argument_list|)
expr_stmt|;
name|mp_prime_miller_rabin
argument_list|(
name|a
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|==
name|MP_NO
condition|)
block|{
return|return
name|MP_NO
return|;
block|}
block|}
return|return
name|MP_YES
return|;
block|}
end_function

end_unit

