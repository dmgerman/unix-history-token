begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2008 Kungliga Tekniska HÃ¶gskolan  * (Royal Institute of Technology, Stockholm, Sweden).  * All rights reserved.  *  * Portions Copyright (c) 2009 Apple Inc. All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * 3. Neither the name of the Institute nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/* CommonCrypto provider */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__APPLE__
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
end_ifdef

begin_include
include|#
directive|include
file|<CommonCrypto/CommonDigest.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_include
include|#
directive|include
file|<CommonCrypto/CommonCryptor.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<evp.h>
end_include

begin_include
include|#
directive|include
file|<evp-cc.h>
end_include

begin_comment
comment|/*  *  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_struct
struct|struct
name|cc_key
block|{
name|CCCryptorRef
name|href
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|int
name|cc_do_cipher
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|out
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|in
parameter_list|,
name|unsigned
name|int
name|size
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
name|CCCryptorStatus
name|ret
decl_stmt|;
name|size_t
name|moved
decl_stmt|;
name|memcpy
argument_list|(
name|out
argument_list|,
name|in
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|ret
operator|=
name|CCCryptorUpdate
argument_list|(
name|cc
operator|->
name|href
argument_list|,
name|in
argument_list|,
name|size
argument_list|,
name|out
argument_list|,
name|size
argument_list|,
operator|&
name|moved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|moved
operator|!=
name|size
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|cc_do_cfb8_cipher
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|char
modifier|*
name|out
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|in
parameter_list|,
name|unsigned
name|int
name|size
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
name|CCCryptorStatus
name|ret
decl_stmt|;
name|size_t
name|moved
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
name|unsigned
name|char
name|oiv
index|[
name|EVP_MAX_IV_LENGTH
operator|+
literal|1
index|]
decl_stmt|;
name|assert
argument_list|(
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
operator|+
literal|1
operator|<=
sizeof|sizeof
argument_list|(
name|oiv
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|oiv
argument_list|,
name|ctx
operator|->
name|iv
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|CCCryptorUpdate
argument_list|(
name|cc
operator|->
name|href
argument_list|,
name|ctx
operator|->
name|iv
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
argument_list|,
name|ctx
operator|->
name|iv
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
argument_list|,
operator|&
name|moved
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|moved
operator|!=
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ctx
operator|->
name|encrypt
condition|)
name|oiv
index|[
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
index|]
operator|=
name|in
index|[
name|i
index|]
expr_stmt|;
name|out
index|[
name|i
index|]
operator|=
name|in
index|[
name|i
index|]
operator|^
name|ctx
operator|->
name|iv
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|encrypt
condition|)
name|oiv
index|[
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
index|]
operator|=
name|out
index|[
name|i
index|]
expr_stmt|;
name|memcpy
argument_list|(
name|ctx
operator|->
name|iv
argument_list|,
operator|&
name|oiv
index|[
literal|1
index|]
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|cc_cleanup
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
if|if
condition|(
name|cc
operator|->
name|href
condition|)
name|CCCryptorRelease
argument_list|(
name|cc
operator|->
name|href
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|init_cc_key
parameter_list|(
name|int
name|encp
parameter_list|,
name|CCAlgorithm
name|alg
parameter_list|,
name|CCOptions
name|opts
parameter_list|,
specifier|const
name|void
modifier|*
name|key
parameter_list|,
name|size_t
name|keylen
parameter_list|,
specifier|const
name|void
modifier|*
name|iv
parameter_list|,
name|CCCryptorRef
modifier|*
name|ref
parameter_list|)
block|{
name|CCOperation
name|op
init|=
name|encp
condition|?
name|kCCEncrypt
else|:
name|kCCDecrypt
decl_stmt|;
name|CCCryptorStatus
name|ret
decl_stmt|;
if|if
condition|(
operator|*
name|ref
condition|)
block|{
if|if
condition|(
name|key
operator|==
name|NULL
operator|&&
name|iv
condition|)
block|{
name|CCCryptorReset
argument_list|(
operator|*
name|ref
argument_list|,
name|iv
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|CCCryptorRelease
argument_list|(
operator|*
name|ref
argument_list|)
expr_stmt|;
block|}
name|ret
operator|=
name|CCCryptorCreate
argument_list|(
name|op
argument_list|,
name|alg
argument_list|,
name|opts
argument_list|,
name|key
argument_list|,
name|keylen
argument_list|,
name|iv
argument_list|,
name|ref
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|cc_des_ede3_cbc_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
return|return
name|init_cc_key
argument_list|(
name|encp
argument_list|,
name|kCCAlgorithm3DES
argument_list|,
literal|0
argument_list|,
name|key
argument_list|,
name|kCCKeySize3DES
argument_list|,
name|iv
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_COMMONCRYPTO_COMMONCRYPTOR_H */
end_comment

begin_comment
comment|/**  * The tripple DES cipher type (Apple CommonCrypto provider)  *  * @return the DES-EDE3-CBC EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_des_ede3_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|des_ede3_cbc
init|=
block|{
literal|0
block|,
literal|8
block|,
literal|24
block|,
literal|8
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_des_ede3_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|des_ede3_cbc
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_comment
comment|/*  *  */
end_comment

begin_function
specifier|static
name|int
name|cc_des_cbc_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
return|return
name|init_cc_key
argument_list|(
name|encp
argument_list|,
name|kCCAlgorithmDES
argument_list|,
literal|0
argument_list|,
name|key
argument_list|,
name|kCCBlockSizeDES
argument_list|,
name|iv
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**  * The DES cipher type (Apple CommonCrypto provider)  *  * @return the DES-CBC EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_des_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|des_ede3_cbc
init|=
block|{
literal|0
block|,
name|kCCBlockSizeDES
block|,
name|kCCBlockSizeDES
block|,
name|kCCBlockSizeDES
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_des_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|des_ede3_cbc
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_comment
comment|/*  *  */
end_comment

begin_function
specifier|static
name|int
name|cc_aes_cbc_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
return|return
name|init_cc_key
argument_list|(
name|encp
argument_list|,
name|kCCAlgorithmAES128
argument_list|,
literal|0
argument_list|,
name|key
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|key_len
argument_list|,
name|iv
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**  * The AES-128 cipher type (Apple CommonCrypto provider)  *  * @return the AES-128-CBC EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_128_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
name|kCCBlockSizeAES128
block|,
name|kCCKeySizeAES128
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The AES-192 cipher type (Apple CommonCrypto provider)  *  * @return the AES-192-CBC EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_192_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
name|kCCBlockSizeAES128
block|,
name|kCCKeySizeAES192
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The AES-256 cipher type (Apple CommonCrypto provider)  *  * @return the AES-256-CBC EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_256_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
name|kCCBlockSizeAES128
block|,
name|kCCKeySizeAES256
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_comment
comment|/*  *  */
end_comment

begin_function
specifier|static
name|int
name|cc_aes_cfb8_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
name|memcpy
argument_list|(
name|ctx
operator|->
name|iv
argument_list|,
name|iv
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|iv_len
argument_list|)
expr_stmt|;
return|return
name|init_cc_key
argument_list|(
literal|1
argument_list|,
name|kCCAlgorithmAES128
argument_list|,
name|kCCOptionECBMode
argument_list|,
name|key
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|key_len
argument_list|,
name|NULL
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**  * The AES-128 CFB8 cipher type (Apple CommonCrypto provider)  *  * @return the AES-128-CFB8 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_128_cfb8
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
literal|1
block|,
name|kCCKeySizeAES128
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CFB8_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cfb8_init
block|,
name|cc_do_cfb8_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The AES-192 CFB8 cipher type (Apple CommonCrypto provider)  *  * @return the AES-192-CFB8 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_192_cfb8
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
literal|1
block|,
name|kCCKeySizeAES192
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CFB8_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cfb8_init
block|,
name|cc_do_cfb8_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The AES-256 CFB8 cipher type (Apple CommonCrypto provider)  *  * @return the AES-256-CFB8 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_aes_256_cfb8
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|c
init|=
block|{
literal|0
block|,
name|kCCBlockSizeAES128
block|,
name|kCCKeySizeAES256
block|,
name|kCCBlockSizeAES128
block|,
name|EVP_CIPH_CFB8_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_aes_cfb8_init
block|,
name|cc_do_cfb8_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|c
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*  *  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|COMMONCRYPTO_SUPPORTS_RC2
end_ifdef

begin_function
specifier|static
name|int
name|cc_rc2_cbc_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
return|return
name|init_cc_key
argument_list|(
name|encp
argument_list|,
name|kCCAlgorithmRC2
argument_list|,
literal|0
argument_list|,
name|key
argument_list|,
name|ctx
operator|->
name|cipher
operator|->
name|key_len
argument_list|,
name|iv
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**  * The RC2 cipher type - common crypto  *  * @return the RC2 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_rc2_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|COMMONCRYPTO_SUPPORTS_RC2
specifier|static
specifier|const
name|EVP_CIPHER
name|rc2_cbc
init|=
block|{
literal|0
block|,
name|kCCBlockSizeRC2
block|,
literal|16
block|,
name|kCCBlockSizeRC2
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_rc2_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|rc2_cbc
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The RC2-40 cipher type - common crypto  *  * @return the RC2-40 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_rc2_40_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|COMMONCRYPTO_SUPPORTS_RC2
specifier|static
specifier|const
name|EVP_CIPHER
name|rc2_40_cbc
init|=
block|{
literal|0
block|,
name|kCCBlockSizeRC2
block|,
literal|5
block|,
name|kCCBlockSizeRC2
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_rc2_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|rc2_40_cbc
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The RC2-64 cipher type - common crypto  *  * @return the RC2-64 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_rc2_64_cbc
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|COMMONCRYPTO_SUPPORTS_RC2
specifier|static
specifier|const
name|EVP_CIPHER
name|rc2_64_cbc
init|=
block|{
literal|0
block|,
name|kCCBlockSizeRC2
block|,
literal|8
block|,
name|kCCBlockSizeRC2
block|,
name|EVP_CIPH_CBC_MODE
operator||
name|EVP_CIPH_ALWAYS_CALL_INIT
block|,
name|cc_rc2_cbc_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|rc2_64_cbc
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The CommonCrypto md2 provider  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_MD
modifier|*
name|EVP_cc_md2
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
specifier|static
specifier|const
name|struct
name|hc_evp_md
name|md2
init|=
block|{
name|CC_MD2_DIGEST_LENGTH
block|,
name|CC_MD2_BLOCK_BYTES
block|,
sizeof|sizeof
argument_list|(
name|CC_MD2_CTX
argument_list|)
block|,
operator|(
name|hc_evp_md_init
operator|)
name|CC_MD2_Init
block|,
operator|(
name|hc_evp_md_update
operator|)
name|CC_MD2_Update
block|,
operator|(
name|hc_evp_md_final
operator|)
name|CC_MD2_Final
block|,
operator|(
name|hc_evp_md_cleanup
operator|)
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|md2
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The CommonCrypto md4 provider  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_MD
modifier|*
name|EVP_cc_md4
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
specifier|static
specifier|const
name|struct
name|hc_evp_md
name|md4
init|=
block|{
name|CC_MD4_DIGEST_LENGTH
block|,
name|CC_MD4_BLOCK_BYTES
block|,
sizeof|sizeof
argument_list|(
name|CC_MD4_CTX
argument_list|)
block|,
operator|(
name|hc_evp_md_init
operator|)
name|CC_MD4_Init
block|,
operator|(
name|hc_evp_md_update
operator|)
name|CC_MD4_Update
block|,
operator|(
name|hc_evp_md_final
operator|)
name|CC_MD4_Final
block|,
operator|(
name|hc_evp_md_cleanup
operator|)
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|md4
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The CommonCrypto md5 provider  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_MD
modifier|*
name|EVP_cc_md5
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
specifier|static
specifier|const
name|struct
name|hc_evp_md
name|md5
init|=
block|{
name|CC_MD5_DIGEST_LENGTH
block|,
name|CC_MD5_BLOCK_BYTES
block|,
sizeof|sizeof
argument_list|(
name|CC_MD5_CTX
argument_list|)
block|,
operator|(
name|hc_evp_md_init
operator|)
name|CC_MD5_Init
block|,
operator|(
name|hc_evp_md_update
operator|)
name|CC_MD5_Update
block|,
operator|(
name|hc_evp_md_final
operator|)
name|CC_MD5_Final
block|,
operator|(
name|hc_evp_md_cleanup
operator|)
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|md5
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The CommonCrypto sha1 provider  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_MD
modifier|*
name|EVP_cc_sha1
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
specifier|static
specifier|const
name|struct
name|hc_evp_md
name|sha1
init|=
block|{
name|CC_SHA1_DIGEST_LENGTH
block|,
name|CC_SHA1_BLOCK_BYTES
block|,
sizeof|sizeof
argument_list|(
name|CC_SHA1_CTX
argument_list|)
block|,
operator|(
name|hc_evp_md_init
operator|)
name|CC_SHA1_Init
block|,
operator|(
name|hc_evp_md_update
operator|)
name|CC_SHA1_Update
block|,
operator|(
name|hc_evp_md_final
operator|)
name|CC_SHA1_Final
block|,
operator|(
name|hc_evp_md_cleanup
operator|)
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|sha1
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The CommonCrypto sha256 provider  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_MD
modifier|*
name|EVP_cc_sha256
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONDIGEST_H
specifier|static
specifier|const
name|struct
name|hc_evp_md
name|sha256
init|=
block|{
name|CC_SHA256_DIGEST_LENGTH
block|,
name|CC_SHA256_BLOCK_BYTES
block|,
sizeof|sizeof
argument_list|(
name|CC_SHA256_CTX
argument_list|)
block|,
operator|(
name|hc_evp_md_init
operator|)
name|CC_SHA256_Init
block|,
operator|(
name|hc_evp_md_update
operator|)
name|CC_SHA256_Update
block|,
operator|(
name|hc_evp_md_final
operator|)
name|CC_SHA256_Final
block|,
operator|(
name|hc_evp_md_cleanup
operator|)
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|sha256
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The Camellia-128 cipher type - CommonCrypto  *  * @return the Camellia-128 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_camellia_128_cbc
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|NULL
return|;
block|}
end_function

begin_comment
comment|/**  * The Camellia-198 cipher type - CommonCrypto  *  * @return the Camellia-198 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_camellia_192_cbc
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|NULL
return|;
block|}
end_function

begin_comment
comment|/**  * The Camellia-256 cipher type - CommonCrypto  *  * @return the Camellia-256 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_camellia_256_cbc
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|NULL
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
end_ifdef

begin_comment
comment|/*  *  */
end_comment

begin_function
specifier|static
name|int
name|cc_rc4_init
parameter_list|(
name|EVP_CIPHER_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|key
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|iv
parameter_list|,
name|int
name|encp
parameter_list|)
block|{
name|struct
name|cc_key
modifier|*
name|cc
init|=
name|ctx
operator|->
name|cipher_data
decl_stmt|;
return|return
name|init_cc_key
argument_list|(
name|encp
argument_list|,
name|kCCAlgorithmRC4
argument_list|,
literal|0
argument_list|,
name|key
argument_list|,
name|ctx
operator|->
name|key_len
argument_list|,
name|iv
argument_list|,
operator|&
name|cc
operator|->
name|href
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/**   * The RC4 cipher type (Apple CommonCrypto provider)  *  * @return the RC4 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_rc4
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|rc4
init|=
block|{
literal|0
block|,
literal|1
block|,
literal|16
block|,
literal|0
block|,
name|EVP_CIPH_STREAM_CIPHER
operator||
name|EVP_CIPH_VARIABLE_LENGTH
block|,
name|cc_rc4_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|rc4
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/**  * The RC4-40 cipher type (Apple CommonCrypto provider)  *  * @return the RC4 EVP_CIPHER pointer.  *  * @ingroup hcrypto_evp  */
end_comment

begin_function
specifier|const
name|EVP_CIPHER
modifier|*
name|EVP_cc_rc4_40
parameter_list|(
name|void
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_COMMONCRYPTO_COMMONCRYPTOR_H
specifier|static
specifier|const
name|EVP_CIPHER
name|rc4_40
init|=
block|{
literal|0
block|,
literal|1
block|,
literal|5
block|,
literal|0
block|,
name|EVP_CIPH_STREAM_CIPHER
operator||
name|EVP_CIPH_VARIABLE_LENGTH
block|,
name|cc_rc4_init
block|,
name|cc_do_cipher
block|,
name|cc_cleanup
block|,
sizeof|sizeof
argument_list|(
expr|struct
name|cc_key
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
return|return
operator|&
name|rc4_40
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __APPLE__ */
end_comment

end_unit

