begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1997, 1998 Kenneth D. Merry.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote products  *    derived from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|_DEVSTAT_H
end_ifndef

begin_define
define|#
directive|define
name|_DEVSTAT_H
end_define

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_include
include|#
directive|include
file|<sys/devicestat.h>
end_include

begin_include
include|#
directive|include
file|<kvm.h>
end_include

begin_define
define|#
directive|define
name|DEVSTAT_ERRBUF_SIZE
value|2048
end_define

begin_comment
comment|/* size of the devstat library error string */
end_comment

begin_decl_stmt
specifier|extern
name|char
name|devstat_errbuf
index|[]
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
enum|enum
block|{
name|DEVSTAT_MATCH_NONE
init|=
literal|0x00
block|,
name|DEVSTAT_MATCH_TYPE
init|=
literal|0x01
block|,
name|DEVSTAT_MATCH_IF
init|=
literal|0x02
block|,
name|DEVSTAT_MATCH_PASS
init|=
literal|0x04
block|}
name|devstat_match_flags
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
block|{
name|DSM_NONE
block|,
name|DSM_TOTAL_BYTES
block|,
name|DSM_TOTAL_BYTES_READ
block|,
name|DSM_TOTAL_BYTES_WRITE
block|,
name|DSM_TOTAL_TRANSFERS
block|,
name|DSM_TOTAL_TRANSFERS_READ
block|,
name|DSM_TOTAL_TRANSFERS_WRITE
block|,
name|DSM_TOTAL_TRANSFERS_OTHER
block|,
name|DSM_TOTAL_BLOCKS
block|,
name|DSM_TOTAL_BLOCKS_READ
block|,
name|DSM_TOTAL_BLOCKS_WRITE
block|,
name|DSM_KB_PER_TRANSFER
block|,
name|DSM_KB_PER_TRANSFER_READ
block|,
name|DSM_KB_PER_TRANSFER_WRITE
block|,
name|DSM_TRANSFERS_PER_SECOND
block|,
name|DSM_TRANSFERS_PER_SECOND_READ
block|,
name|DSM_TRANSFERS_PER_SECOND_WRITE
block|,
name|DSM_TRANSFERS_PER_SECOND_OTHER
block|,
name|DSM_MB_PER_SECOND
block|,
name|DSM_MB_PER_SECOND_READ
block|,
name|DSM_MB_PER_SECOND_WRITE
block|,
name|DSM_BLOCKS_PER_SECOND
block|,
name|DSM_BLOCKS_PER_SECOND_READ
block|,
name|DSM_BLOCKS_PER_SECOND_WRITE
block|,
name|DSM_MS_PER_TRANSACTION
block|,
name|DSM_MS_PER_TRANSACTION_READ
block|,
name|DSM_MS_PER_TRANSACTION_WRITE
block|,
name|DSM_MAX
block|}
name|devstat_metric
typedef|;
end_typedef

begin_struct
struct|struct
name|devstat_match
block|{
name|devstat_match_flags
name|match_fields
decl_stmt|;
name|devstat_type_flags
name|device_type
decl_stmt|;
name|int
name|num_match_categories
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|devstat_match_table
block|{
name|char
modifier|*
name|match_str
decl_stmt|;
name|devstat_type_flags
name|type
decl_stmt|;
name|devstat_match_flags
name|match_field
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|device_selection
block|{
name|u_int32_t
name|device_number
decl_stmt|;
name|char
name|device_name
index|[
name|DEVSTAT_NAME_LEN
index|]
decl_stmt|;
name|int
name|unit_number
decl_stmt|;
name|int
name|selected
decl_stmt|;
name|u_int64_t
name|bytes
decl_stmt|;
name|int
name|position
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|devinfo
block|{
name|struct
name|devstat
modifier|*
name|devices
decl_stmt|;
name|u_int8_t
modifier|*
name|mem_ptr
decl_stmt|;
name|long
name|generation
decl_stmt|;
name|int
name|numdevs
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|statinfo
block|{
name|long
name|cp_time
index|[
name|CPUSTATES
index|]
decl_stmt|;
name|long
name|tk_nin
decl_stmt|;
name|long
name|tk_nout
decl_stmt|;
name|struct
name|devinfo
modifier|*
name|dinfo
decl_stmt|;
name|struct
name|timeval
name|busy_time
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
enum|enum
block|{
name|DS_SELECT_ADD
block|,
name|DS_SELECT_ONLY
block|,
name|DS_SELECT_REMOVE
block|,
name|DS_SELECT_ADDONLY
block|}
name|devstat_select_mode
typedef|;
end_typedef

begin_function_decl
name|__BEGIN_DECLS
comment|/* Legacy interfaces. */
name|int
name|getnumdevs
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|long
name|getgeneration
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|getversion
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|checkversion
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|getdevs
parameter_list|(
name|struct
name|statinfo
modifier|*
name|stats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|selectdevs
parameter_list|(
name|struct
name|device_selection
modifier|*
modifier|*
name|dev_select
parameter_list|,
name|int
modifier|*
name|num_selected
parameter_list|,
name|int
modifier|*
name|num_selections
parameter_list|,
name|long
modifier|*
name|select_generation
parameter_list|,
name|long
name|current_generation
parameter_list|,
name|struct
name|devstat
modifier|*
name|devices
parameter_list|,
name|int
name|numdevs
parameter_list|,
name|struct
name|devstat_match
modifier|*
name|matches
parameter_list|,
name|int
name|num_matches
parameter_list|,
name|char
modifier|*
modifier|*
name|dev_selections
parameter_list|,
name|int
name|num_dev_selections
parameter_list|,
name|devstat_select_mode
name|select_mode
parameter_list|,
name|int
name|maxshowdevs
parameter_list|,
name|int
name|perf_select
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|buildmatch
parameter_list|(
name|char
modifier|*
name|match_str
parameter_list|,
name|struct
name|devstat_match
modifier|*
modifier|*
name|matches
parameter_list|,
name|int
modifier|*
name|num_matches
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|compute_stats
parameter_list|(
name|struct
name|devstat
modifier|*
name|current
parameter_list|,
name|struct
name|devstat
modifier|*
name|previous
parameter_list|,
name|long
name|double
name|etime
parameter_list|,
name|u_int64_t
modifier|*
name|total_bytes
parameter_list|,
name|u_int64_t
modifier|*
name|total_transfers
parameter_list|,
name|u_int64_t
modifier|*
name|total_blocks
parameter_list|,
name|long
name|double
modifier|*
name|kb_per_transfer
parameter_list|,
name|long
name|double
modifier|*
name|transfers_per_second
parameter_list|,
name|long
name|double
modifier|*
name|mb_per_second
parameter_list|,
name|long
name|double
modifier|*
name|blocks_per_second
parameter_list|,
name|long
name|double
modifier|*
name|ms_per_transaction
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|long
name|double
name|compute_etime
parameter_list|(
name|struct
name|timeval
name|cur_time
parameter_list|,
name|struct
name|timeval
name|prev_time
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* New interfaces. */
end_comment

begin_function_decl
name|int
name|devstat_getnumdevs
parameter_list|(
name|kvm_t
modifier|*
name|kd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|long
name|devstat_getgeneration
parameter_list|(
name|kvm_t
modifier|*
name|kd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_getversion
parameter_list|(
name|kvm_t
modifier|*
name|kd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_checkversion
parameter_list|(
name|kvm_t
modifier|*
name|kd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_getdevs
parameter_list|(
name|kvm_t
modifier|*
name|kd
parameter_list|,
name|struct
name|statinfo
modifier|*
name|stats
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_selectdevs
parameter_list|(
name|struct
name|device_selection
modifier|*
modifier|*
name|dev_select
parameter_list|,
name|int
modifier|*
name|num_selected
parameter_list|,
name|int
modifier|*
name|num_selections
parameter_list|,
name|long
modifier|*
name|select_generation
parameter_list|,
name|long
name|current_generation
parameter_list|,
name|struct
name|devstat
modifier|*
name|devices
parameter_list|,
name|int
name|numdevs
parameter_list|,
name|struct
name|devstat_match
modifier|*
name|matches
parameter_list|,
name|int
name|num_matches
parameter_list|,
name|char
modifier|*
modifier|*
name|dev_selections
parameter_list|,
name|int
name|num_dev_selections
parameter_list|,
name|devstat_select_mode
name|select_mode
parameter_list|,
name|int
name|maxshowdevs
parameter_list|,
name|int
name|perf_select
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_buildmatch
parameter_list|(
name|char
modifier|*
name|match_str
parameter_list|,
name|struct
name|devstat_match
modifier|*
modifier|*
name|matches
parameter_list|,
name|int
modifier|*
name|num_matches
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|devstat_compute_statistics
parameter_list|(
name|struct
name|devstat
modifier|*
name|current
parameter_list|,
name|struct
name|devstat
modifier|*
name|previous
parameter_list|,
name|long
name|double
name|etime
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|long
name|double
name|devstat_compute_etime
parameter_list|(
name|struct
name|timeval
name|cur_time
parameter_list|,
name|struct
name|timeval
name|prev_time
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|__END_DECLS
end_macro

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _DEVSTAT_H  */
end_comment

end_unit

