begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"hx_locl.h"
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_struct
struct|struct
name|foo
block|{
name|int
name|val
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
block|}
name|foo
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"FALSE"
block|}
block|,
block|{
literal|1
block|,
literal|"TRUE"
block|}
block|,
block|{
literal|0
block|,
literal|"!TRUE"
block|}
block|,
block|{
literal|0
block|,
literal|"! TRUE"
block|}
block|,
block|{
literal|0
block|,
literal|"!\tTRUE"
block|}
block|,
block|{
literal|0
block|,
literal|"( FALSE AND FALSE )"
block|}
block|,
block|{
literal|0
block|,
literal|"( TRUE AND FALSE )"
block|}
block|,
block|{
literal|1
block|,
literal|"( TRUE AND TRUE )"
block|}
block|,
block|{
literal|1
block|,
literal|"( TRUE OR TRUE )"
block|}
block|,
block|{
literal|1
block|,
literal|"( TRUE OR FALSE )"
block|}
block|,
block|{
literal|0
block|,
literal|"( FALSE OR FALSE )"
block|}
block|,
block|{
literal|1
block|,
literal|"! ( FALSE OR FALSE )"
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" TAILMATCH \"foo\""
block|}
block|,
block|{
literal|1
block|,
literal|"\"foobar\" TAILMATCH \"bar\""
block|}
block|,
block|{
literal|0
block|,
literal|"\"foobar\" TAILMATCH \"foo\""
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" == \"foo\""
block|}
block|,
block|{
literal|0
block|,
literal|"\"foo\" == \"bar\""
block|}
block|,
block|{
literal|0
block|,
literal|"\"foo\" != \"foo\""
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" != \"bar\""
block|}
block|,
block|{
literal|1
block|,
literal|"%{variable} == \"foo\""
block|}
block|,
block|{
literal|0
block|,
literal|"%{variable} == \"bar\""
block|}
block|,
block|{
literal|1
block|,
literal|"%{context.variable} == \"foo\""
block|}
block|,
block|{
literal|0
block|,
literal|"%{context.variable} == \"bar\""
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" IN ( \"bar\", \"foo\")"
block|}
block|,
block|{
literal|0
block|,
literal|"\"foo\" IN ( \"bar\", \"baz\")"
block|}
block|,
block|{
literal|0
block|,
literal|"\"bar\" IN %{context}"
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" IN %{context}"
block|}
block|,
block|{
literal|1
block|,
literal|"\"variable\" IN %{context}"
block|}
block|,
block|{
literal|1
block|,
literal|"\"foo\" IN %{context} AND %{context.variable} == \"foo\""
block|}
block|}
struct|;
end_struct

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|struct
name|hx_expr
modifier|*
name|expr
decl_stmt|;
name|hx509_context
name|context
decl_stmt|;
name|hx509_env
name|env
init|=
name|NULL
decl_stmt|,
name|env2
init|=
name|NULL
decl_stmt|;
name|int
name|val
decl_stmt|,
name|i
decl_stmt|,
name|ret
decl_stmt|;
if|#
directive|if
literal|0
block|extern int yydebug;     yydebug = 1;
endif|#
directive|endif
name|ret
operator|=
name|hx509_context_init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"hx509_context_init failed with %d"
argument_list|,
name|ret
argument_list|)
expr_stmt|;
name|hx509_env_add
argument_list|(
name|context
argument_list|,
operator|&
name|env
argument_list|,
literal|"variable"
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
name|hx509_env_add
argument_list|(
name|context
argument_list|,
operator|&
name|env2
argument_list|,
literal|"variable"
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
name|hx509_env_add_binding
argument_list|(
name|context
argument_list|,
operator|&
name|env
argument_list|,
literal|"context"
argument_list|,
name|env2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|foo
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|foo
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|expr
operator|=
name|_hx509_expr_parse
argument_list|(
name|foo
index|[
name|i
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
name|expr
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"_hx509_expr_parse failed for %d: %s"
argument_list|,
name|i
argument_list|,
name|foo
index|[
name|i
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
name|val
operator|=
name|_hx509_expr_eval
argument_list|(
name|context
argument_list|,
name|env
argument_list|,
name|expr
argument_list|)
expr_stmt|;
if|if
condition|(
name|foo
index|[
name|i
index|]
operator|.
name|val
condition|)
block|{
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"_hx509_expr_eval not true when it should: %d: %s"
argument_list|,
name|i
argument_list|,
name|foo
index|[
name|i
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|val
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"_hx509_expr_eval true when it should not: %d: %s"
argument_list|,
name|i
argument_list|,
name|foo
index|[
name|i
index|]
operator|.
name|str
argument_list|)
expr_stmt|;
block|}
name|_hx509_expr_free
argument_list|(
name|expr
argument_list|)
expr_stmt|;
block|}
name|hx509_env_free
argument_list|(
operator|&
name|env
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

