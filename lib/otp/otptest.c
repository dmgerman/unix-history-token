begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1995, 1996, 1997 Kungliga Tekniska HÃ¶gskolan  * (Royal Institute of Technology, Stockholm, Sweden).  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * 3. Neither the name of the Institute nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<otp.h>
end_include

begin_function
specifier|static
name|int
name|test_one
parameter_list|(
name|OtpKey
name|key1
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|val
parameter_list|,
name|void
function_decl|(
modifier|*
name|print
function_decl|)
parameter_list|(
name|OtpKey
parameter_list|,
name|char
modifier|*
parameter_list|,
name|size_t
parameter_list|)
parameter_list|,
name|OtpAlgorithm
modifier|*
name|alg
parameter_list|)
block|{
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|OtpKey
name|key2
decl_stmt|;
call|(
modifier|*
name|print
call|)
argument_list|(
name|key1
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s: %s, "
argument_list|,
name|name
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
name|val
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"failed(*%s* != *%s*)\n"
argument_list|,
name|buf
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|otp_parse
argument_list|(
name|key2
argument_list|,
name|buf
argument_list|,
name|alg
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"parse of %s failed\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|memcmp
argument_list|(
name|key1
argument_list|,
name|key2
argument_list|,
name|OTPKEYSIZE
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"key1 != key2, "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"success\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|test
parameter_list|(
name|void
parameter_list|)
block|{
struct|struct
name|test
block|{
name|char
modifier|*
name|alg
decl_stmt|;
name|char
modifier|*
name|passphrase
decl_stmt|;
name|char
modifier|*
name|seed
decl_stmt|;
name|int
name|count
decl_stmt|;
name|char
modifier|*
name|hex
decl_stmt|;
name|char
modifier|*
name|word
decl_stmt|;
block|}
name|tests
index|[]
init|=
block|{
comment|/* md4 */
block|{
literal|"md4"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|0
block|,
literal|"d1854218ebbb0b51"
block|,
literal|"ROME MUG FRED SCAN LIVE LACE"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|1
block|,
literal|"63473ef01cd0b444"
block|,
literal|"CARD SAD MINI RYE COL KIN"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|99
block|,
literal|"c5e612776e6c237a"
block|,
literal|"NOTE OUT IBIS SINK NAVE MODE"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|0
block|,
literal|"50076f47eb1ade4e"
block|,
literal|"AWAY SEN ROOK SALT LICE MAP"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|1
block|,
literal|"65d20d1949b5f7ab"
block|,
literal|"CHEW GRIM WU HANG BUCK SAID"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|99
block|,
literal|"d150c82cce6f62d1"
block|,
literal|"ROIL FREE COG HUNK WAIT COCA"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|0
block|,
literal|"849c79d4f6f55388"
block|,
literal|"FOOL STEM DONE TOOL BECK NILE"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|1
block|,
literal|"8c0992fb250847b1"
block|,
literal|"GIST AMOS MOOT AIDS FOOD SEEM"
block|}
block|,
block|{
literal|"md4"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|99
block|,
literal|"3f3bf4b4145fd74b"
block|,
literal|"TAG SLOW NOV MIN WOOL KENO"
block|}
block|,
comment|/* md5 */
block|{
literal|"md5"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|0
block|,
literal|"9e876134d90499dd"
block|,
literal|"INCH SEA ANNE LONG AHEM TOUR"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|1
block|,
literal|"7965e05436f5029f"
block|,
literal|"EASE OIL FUM CURE AWRY AVIS"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|99
block|,
literal|"50fe1962c4965880"
block|,
literal|"BAIL TUFT BITS GANG CHEF THY"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|0
block|,
literal|"87066dd9644bf206"
block|,
literal|"FULL PEW DOWN ONCE MORT ARC"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|1
block|,
literal|"7cd34c1040add14b"
block|,
literal|"FACT HOOF AT FIST SITE KENT"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|99
block|,
literal|"5aa37a81f212146c"
block|,
literal|"BODE HOP JAKE STOW JUT RAP"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|0
block|,
literal|"f205753943de4cf9"
block|,
literal|"ULAN NEW ARMY FUSE SUIT EYED"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|1
block|,
literal|"ddcdac956f234937"
block|,
literal|"SKIM CULT LOB SLAM POE HOWL"
block|}
block|,
block|{
literal|"md5"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|99
block|,
literal|"b203e28fa525be47"
block|,
literal|"LONG IVY JULY AJAR BOND LEE"
block|}
block|,
comment|/* sha */
block|{
literal|"sha"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|0
block|,
literal|"bb9e6ae1979d8ff4"
block|,
literal|"MILT VARY MAST OK SEES WENT"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|1
block|,
literal|"63d936639734385b"
block|,
literal|"CART OTTO HIVE ODE VAT NUT"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"This is a test."
block|,
literal|"TeSt"
block|,
literal|99
block|,
literal|"87fec7768b73ccf9"
block|,
literal|"GAFF WAIT SKID GIG SKY EYED"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|0
block|,
literal|"ad85f658ebe383c9"
block|,
literal|"LEST OR HEEL SCOT ROB SUIT"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|1
block|,
literal|"d07ce229b5cf119b"
block|,
literal|"RITE TAKE GELD COST TUNE RECK"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"AbCdEfGhIjK"
block|,
literal|"alpha1"
block|,
literal|99
block|,
literal|"27bc71035aaf3dc6"
block|,
literal|"MAY STAR TIN LYON VEDA STAN"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|0
block|,
literal|"d51f3e99bf8e6f0b"
block|,
literal|"RUST WELT KICK FELL TAIL FRAU"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|1
block|,
literal|"82aeb52d943774e4"
block|,
literal|"FLIT DOSE ALSO MEW DRUM DEFY"
block|}
block|,
block|{
literal|"sha"
block|,
literal|"OTP's are good"
block|,
literal|"correct"
block|,
literal|99
block|,
literal|"4f296a74fe1567ec"
block|,
literal|"AURA ALOE HURL WING BERG WAIT"
block|}
block|,
block|{
name|NULL
block|}
block|}
struct|;
name|struct
name|test
modifier|*
name|t
decl_stmt|;
name|int
name|sum
init|=
literal|0
decl_stmt|;
for|for
control|(
name|t
operator|=
name|tests
init|;
name|t
operator|->
name|alg
condition|;
operator|++
name|t
control|)
block|{
name|int
name|i
decl_stmt|;
name|OtpAlgorithm
modifier|*
name|alg
init|=
name|otp_find_alg
argument_list|(
name|t
operator|->
name|alg
argument_list|)
decl_stmt|;
name|OtpKey
name|key
decl_stmt|;
if|if
condition|(
name|alg
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Could not find alg %s\n"
argument_list|,
name|t
operator|->
name|alg
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|alg
operator|->
name|init
argument_list|(
name|key
argument_list|,
name|t
operator|->
name|passphrase
argument_list|,
name|t
operator|->
name|seed
argument_list|)
condition|)
return|return
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|t
operator|->
name|count
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|alg
operator|->
name|next
argument_list|(
name|key
argument_list|)
condition|)
return|return
literal|1
return|;
block|}
name|sum
operator|+=
name|test_one
argument_list|(
name|key
argument_list|,
literal|"hexadecimal"
argument_list|,
name|t
operator|->
name|hex
argument_list|,
name|otp_print_hex
argument_list|,
name|alg
argument_list|)
operator|+
name|test_one
argument_list|(
name|key
argument_list|,
literal|"standard_word"
argument_list|,
name|t
operator|->
name|word
argument_list|,
name|otp_print_stddict
argument_list|,
name|alg
argument_list|)
expr_stmt|;
block|}
return|return
name|sum
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|test
argument_list|()
return|;
block|}
end_function

end_unit

