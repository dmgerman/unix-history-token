begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"simul.c	(CWI)	1.1	85/03/01"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"ideal.h"
end_include

begin_function
name|DEPPTR
name|depadd
parameter_list|(
name|dlistone
parameter_list|,
name|coeffone
parameter_list|,
name|dlisttwo
parameter_list|,
name|coefftwo
parameter_list|)
name|DEPPTR
name|dlistone
decl_stmt|;
name|float
name|coeffone
decl_stmt|;
name|DEPPTR
name|dlisttwo
decl_stmt|;
name|float
name|coefftwo
decl_stmt|;
block|{
comment|/* produce a dependency list = coeffone*dlistone + coefftwo*dlisttwo */
specifier|register
name|DEPPTR
name|onewalk
decl_stmt|,
name|twowalk
decl_stmt|,
name|newhead
decl_stmt|,
name|newwalk
decl_stmt|,
name|prevnew
decl_stmt|;
name|DEPNODE
name|nuhead
decl_stmt|;
name|prevnew
operator|=
operator|&
name|nuhead
expr_stmt|;
name|prevnew
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|onewalk
operator|=
name|dlistone
expr_stmt|;
name|twowalk
operator|=
name|dlisttwo
expr_stmt|;
while|while
condition|(
operator|(
name|onewalk
operator|!=
name|NULL
operator|)
operator|||
operator|(
name|twowalk
operator|!=
name|NULL
operator|)
condition|)
block|{
if|if
condition|(
name|onewalk
operator|!=
name|NULL
condition|)
if|if
condition|(
name|twowalk
operator|!=
name|NULL
condition|)
if|if
condition|(
name|onewalk
operator|->
name|var
operator|>
name|twowalk
operator|->
name|var
condition|)
block|{
name|newwalk
operator|=
name|depgen
argument_list|(
name|onewalk
operator|->
name|var
argument_list|,
name|coeffone
operator|*
name|onewalk
operator|->
name|coeff
argument_list|)
expr_stmt|;
name|onewalk
operator|=
name|onewalk
operator|->
name|next
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|onewalk
operator|->
name|var
operator|==
name|twowalk
operator|->
name|var
condition|)
block|{
name|newwalk
operator|=
name|depgen
argument_list|(
name|onewalk
operator|->
name|var
argument_list|,
name|coeffone
operator|*
name|onewalk
operator|->
name|coeff
operator|+
name|coefftwo
operator|*
name|twowalk
operator|->
name|coeff
argument_list|)
expr_stmt|;
name|onewalk
operator|=
name|onewalk
operator|->
name|next
expr_stmt|;
name|twowalk
operator|=
name|twowalk
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|newwalk
operator|=
name|depgen
argument_list|(
name|twowalk
operator|->
name|var
argument_list|,
name|coefftwo
operator|*
name|twowalk
operator|->
name|coeff
argument_list|)
expr_stmt|;
name|twowalk
operator|=
name|twowalk
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|newwalk
operator|=
name|depgen
argument_list|(
name|onewalk
operator|->
name|var
argument_list|,
name|coeffone
operator|*
name|onewalk
operator|->
name|coeff
argument_list|)
expr_stmt|;
name|onewalk
operator|=
name|onewalk
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|newwalk
operator|=
name|depgen
argument_list|(
name|twowalk
operator|->
name|var
argument_list|,
name|coefftwo
operator|*
name|twowalk
operator|->
name|coeff
argument_list|)
expr_stmt|;
name|twowalk
operator|=
name|twowalk
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
name|fabs
argument_list|(
name|newwalk
operator|->
name|coeff
argument_list|)
operator|>
name|EPSILON
condition|)
block|{
name|prevnew
operator|->
name|next
operator|=
name|newwalk
expr_stmt|;
name|prevnew
operator|=
name|newwalk
expr_stmt|;
block|}
else|else
name|depfree
argument_list|(
name|newwalk
argument_list|)
expr_stmt|;
block|}
name|newhead
operator|=
name|nuhead
operator|.
name|next
expr_stmt|;
if|if
condition|(
name|newhead
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|dbg
condition|)
block|{
name|depprint
argument_list|(
name|newhead
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|newhead
operator|)
return|;
block|}
else|else
block|{
name|dprintf
literal|"empty dep rep\n"
block|)
empty_stmt|;
return|return
operator|(
name|depgen
argument_list|(
operator|(
name|VARPTR
operator|)
name|NULL
argument_list|,
literal|0.0
argument_list|)
operator|)
return|;
block|}
end_function

begin_macro
unit|}  DEPPTR
name|depsubst
argument_list|(
argument|depinto
argument_list|,
argument|depfrom
argument_list|,
argument|depwho
argument_list|)
end_macro

begin_comment
comment|/* substitutes depfrom for depwho in depinto 	/* WARNING:  if depinto actually contains depfrom, 	/* depinto is replaced */
end_comment

begin_decl_stmt
name|DEPPTR
name|depinto
decl_stmt|,
name|depfrom
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|VARPTR
name|depwho
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|DEPPTR
name|intowalker
decl_stmt|,
name|intoparent
decl_stmt|,
name|temp
decl_stmt|;
for|for
control|(
name|intowalker
operator|=
name|depinto
init|;
name|intowalker
operator|!=
name|NULL
condition|;
name|intowalker
operator|=
name|intowalker
operator|->
name|next
control|)
if|if
condition|(
name|intowalker
operator|->
name|var
operator|==
name|depwho
condition|)
break|break;
else|else
name|intoparent
operator|=
name|intowalker
expr_stmt|;
if|if
condition|(
name|intowalker
operator|==
name|NULL
condition|)
return|return
operator|(
name|depinto
operator|)
return|;
if|if
condition|(
name|intowalker
operator|==
name|depinto
condition|)
name|depinto
operator|=
name|depinto
operator|->
name|next
expr_stmt|;
else|else
name|intoparent
operator|->
name|next
operator|=
name|intowalker
operator|->
name|next
expr_stmt|;
name|dprintf
literal|"Variable substitution proceeding\n"
block|)
end_block

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_expr_stmt
name|temp
operator|=
name|depadd
argument_list|(
name|depinto
argument_list|,
literal|1.0
argument_list|,
name|depfrom
argument_list|,
name|intowalker
operator|->
name|coeff
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|depfree
argument_list|(
name|depinto
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|tryfree
argument_list|(
name|intowalker
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|depinto
operator|=
name|temp
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|temp
operator|)
return|;
end_return

unit|}
end_unit

