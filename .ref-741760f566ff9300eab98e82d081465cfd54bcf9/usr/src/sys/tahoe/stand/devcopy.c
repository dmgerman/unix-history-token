begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	devcopy.c	1.1	86/01/12	*/
end_comment

begin_comment
comment|/*	devcopy.c */
end_comment

begin_define
define|#
directive|define
name|BSIZE
value|1024
end_define

begin_decl_stmt
name|char
name|dev
index|[
literal|50
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|disk
index|[
literal|50
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|blocks
index|[
literal|50
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|fsi
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|fso
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|buffer
index|[
name|BSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|()
block|{
name|int
name|j
decl_stmt|,
name|c
decl_stmt|,
name|i
decl_stmt|,
name|n
decl_stmt|;
name|char
name|buf
index|[
literal|50
index|]
decl_stmt|;
name|int
name|input
decl_stmt|,
name|output
decl_stmt|;
do|do
block|{
name|printf
argument_list|(
literal|"Source device : "
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|dev
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Copy to device : "
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|disk
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Number of blocks : "
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|blocks
argument_list|)
expr_stmt|;
name|j
operator|=
name|number
argument_list|(
name|blocks
argument_list|)
expr_stmt|;
name|input
operator|=
name|open
argument_list|(
name|dev
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|input
operator|<=
literal|0
condition|)
name|printf
argument_list|(
literal|"Cannot open %s\n"
argument_list|,
name|dev
argument_list|)
expr_stmt|;
name|output
operator|=
name|open
argument_list|(
name|disk
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|output
operator|<=
literal|0
condition|)
name|printf
argument_list|(
literal|"Cannot open output\n"
argument_list|,
name|disk
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|input
operator|<=
literal|0
operator|||
name|output
operator|<=
literal|0
condition|)
do|;
name|i
operator|=
literal|0
expr_stmt|;
comment|/* Block number */
name|n
operator|=
name|BSIZE
expr_stmt|;
while|while
condition|(
name|n
operator|==
name|BSIZE
operator|&&
name|i
operator|<
name|j
condition|)
block|{
if|if
condition|(
name|i
operator|>
literal|0
operator|&&
operator|(
name|i
operator|%
literal|500
operator|==
literal|0
operator|)
condition|)
name|printf
argument_list|(
literal|"%d blocks\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|input
argument_list|,
name|i
operator|*
name|BSIZE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|n
operator|=
name|read
argument_list|(
name|input
argument_list|,
name|buffer
argument_list|,
name|BSIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|BSIZE
condition|)
block|{
name|lseek
argument_list|(
name|output
argument_list|,
name|i
operator|*
name|BSIZE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|n
operator|=
name|write
argument_list|(
name|output
argument_list|,
name|buffer
argument_list|,
name|BSIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|!=
name|BSIZE
condition|)
name|printf
argument_list|(
literal|"Short write, block %d, %d bytes only\n"
argument_list|,
name|i
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"Short read, block %d, %d bytes only\n"
argument_list|,
name|i
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Total of %d blocks copied\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|number
parameter_list|(
name|response
parameter_list|)
name|char
modifier|*
name|response
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
comment|/* Total */
while|while
condition|(
operator|*
name|response
operator|==
literal|' '
operator|||
operator|*
name|response
operator|==
literal|'\t'
condition|)
name|response
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|response
operator|>=
literal|'0'
operator|&&
operator|*
name|response
operator|<=
literal|'9'
condition|)
block|{
name|j
operator|=
name|j
operator|*
literal|10
operator|+
operator|*
name|response
operator|-
literal|'0'
expr_stmt|;
name|response
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|j
operator|)
return|;
block|}
end_function

end_unit

