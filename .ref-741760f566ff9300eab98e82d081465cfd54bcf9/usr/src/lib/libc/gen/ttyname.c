begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_if
if|#
directive|if
name|defined
argument_list|(
name|LIBC_SCCS
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|lint
argument_list|)
end_if

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)ttyname.c	5.2 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|LIBC_SCCS and not lint
end_endif

begin_comment
comment|/*  * ttyname(f): return "/dev/ttyXX" which the the name of the  * tty belonging to file f.  *  NULL if it is not a tty  */
end_comment

begin_define
define|#
directive|define
name|NULL
value|0
end_define

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/dir.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_decl_stmt
specifier|static
name|char
name|dev
index|[]
init|=
literal|"/dev/"
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|strcpy
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|strcat
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|char
modifier|*
name|ttyname
parameter_list|(
name|f
parameter_list|)
block|{
name|struct
name|stat
name|fsb
decl_stmt|;
name|struct
name|stat
name|tsb
decl_stmt|;
specifier|register
name|struct
name|direct
modifier|*
name|db
decl_stmt|;
specifier|register
name|DIR
modifier|*
name|df
decl_stmt|;
specifier|static
name|char
name|rbuf
index|[
literal|32
index|]
decl_stmt|;
if|if
condition|(
name|isatty
argument_list|(
name|f
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|fstat
argument_list|(
name|f
argument_list|,
operator|&
name|fsb
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|fsb
operator|.
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|!=
name|S_IFCHR
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|df
operator|=
name|opendir
argument_list|(
name|dev
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
while|while
condition|(
operator|(
name|db
operator|=
name|readdir
argument_list|(
name|df
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|db
operator|->
name|d_ino
operator|!=
name|fsb
operator|.
name|st_ino
condition|)
continue|continue;
name|strcpy
argument_list|(
name|rbuf
argument_list|,
name|dev
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|rbuf
argument_list|,
name|db
operator|->
name|d_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|rbuf
argument_list|,
operator|&
name|tsb
argument_list|)
operator|<
literal|0
condition|)
continue|continue;
if|if
condition|(
name|tsb
operator|.
name|st_dev
operator|==
name|fsb
operator|.
name|st_dev
operator|&&
name|tsb
operator|.
name|st_ino
operator|==
name|fsb
operator|.
name|st_ino
condition|)
block|{
name|closedir
argument_list|(
name|df
argument_list|)
expr_stmt|;
return|return
operator|(
name|rbuf
operator|)
return|;
block|}
block|}
name|closedir
argument_list|(
name|df
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

end_unit

