begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2007 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*  * mwl statistics class.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|"../../sys/net80211/ieee80211_ioctl.h"
end_include

begin_include
include|#
directive|include
file|"../../sys/net80211/ieee80211_radiotap.h"
end_include

begin_comment
comment|/*  * Get Hardware Statistics.  */
end_comment

begin_struct
struct|struct
name|mwl_hal_hwstats
block|{
name|uint32_t
name|TxRetrySuccesses
decl_stmt|;
name|uint32_t
name|TxMultipleRetrySuccesses
decl_stmt|;
name|uint32_t
name|TxFailures
decl_stmt|;
name|uint32_t
name|RTSSuccesses
decl_stmt|;
name|uint32_t
name|RTSFailures
decl_stmt|;
name|uint32_t
name|AckFailures
decl_stmt|;
name|uint32_t
name|RxDuplicateFrames
decl_stmt|;
name|uint32_t
name|FCSErrorCount
decl_stmt|;
name|uint32_t
name|TxWatchDogTimeouts
decl_stmt|;
name|uint32_t
name|RxOverflows
decl_stmt|;
name|uint32_t
name|RxFragErrors
decl_stmt|;
name|uint32_t
name|RxMemErrors
decl_stmt|;
name|uint32_t
name|PointerErrors
decl_stmt|;
name|uint32_t
name|TxUnderflows
decl_stmt|;
name|uint32_t
name|TxDone
decl_stmt|;
name|uint32_t
name|TxDoneBufTryPut
decl_stmt|;
name|uint32_t
name|TxDoneBufPut
decl_stmt|;
name|uint32_t
name|Wait4TxBuf
decl_stmt|;
name|uint32_t
name|TxAttempts
decl_stmt|;
name|uint32_t
name|TxSuccesses
decl_stmt|;
name|uint32_t
name|TxFragments
decl_stmt|;
name|uint32_t
name|TxMulticasts
decl_stmt|;
name|uint32_t
name|RxNonCtlPkts
decl_stmt|;
name|uint32_t
name|RxMulticasts
decl_stmt|;
name|uint32_t
name|RxUndecryptableFrames
decl_stmt|;
name|uint32_t
name|RxICVErrors
decl_stmt|;
name|uint32_t
name|RxExcludedFrames
decl_stmt|;
block|}
struct|;
end_struct

begin_include
include|#
directive|include
file|"../../../../sys/dev/mwl/if_mwlioctl.h"
end_include

begin_include
include|#
directive|include
file|"mwlstats.h"
end_include

begin_define
define|#
directive|define
name|AFTER
parameter_list|(
name|prev
parameter_list|)
value|((prev)+1)
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|fmt
name|mwlstats
index|[]
init|=
block|{
define|#
directive|define
name|S_INPUT
value|0
block|{
literal|8
block|,
literal|"input"
block|,
literal|"input"
block|,
literal|"total frames received"
block|}
block|,
define|#
directive|define
name|S_RX_MCAST
value|AFTER(S_INPUT)
block|{
literal|7
block|,
literal|"rxmcast"
block|,
literal|"rxmcast"
block|,
literal|"rx multicast frames"
block|}
block|,
define|#
directive|define
name|S_RX_NONCTL
value|AFTER(S_RX_MCAST)
block|{
literal|8
block|,
literal|"rxnonctl"
block|,
literal|"rxnonctl"
literal|"rx non control frames"
block|}
block|,
define|#
directive|define
name|S_RX_MGT
value|AFTER(S_RX_NONCTL)
block|{
literal|5
block|,
literal|"rxmgt"
block|,
literal|"rxmgt"
block|,
literal|"rx management frames"
block|}
block|,
define|#
directive|define
name|S_RX_CTL
value|AFTER(S_RX_MGT)
block|{
literal|5
block|,
literal|"rxctl"
block|,
literal|"rxctl"
block|,
literal|"rx control frames"
block|}
block|,
define|#
directive|define
name|S_OUTPUT
value|AFTER(S_RX_CTL)
block|{
literal|8
block|,
literal|"output"
block|,
literal|"output"
block|,
literal|"total frames transmit"
block|}
block|,
define|#
directive|define
name|S_TX_MCAST
value|AFTER(S_OUTPUT)
block|{
literal|7
block|,
literal|"txmcast"
block|,
literal|"txmcast"
block|,
literal|"tx multicast frames"
block|}
block|,
define|#
directive|define
name|S_TX_MGMT
value|AFTER(S_TX_MCAST)
block|{
literal|5
block|,
literal|"txmgt"
block|,
literal|"txmgt"
block|,
literal|"tx management frames"
block|}
block|,
define|#
directive|define
name|S_TX_RETRY
value|AFTER(S_TX_MGMT)
block|{
literal|7
block|,
literal|"txretry"
block|,
literal|"txretry"
block|,
literal|"tx success with 1 retry"
block|}
block|,
define|#
directive|define
name|S_TX_MRETRY
value|AFTER(S_TX_RETRY)
block|{
literal|8
block|,
literal|"txmretry"
block|,
literal|"txmretry"
block|,
literal|"tx success with>1 retry"
block|}
block|,
define|#
directive|define
name|S_TX_RTSGOOD
value|AFTER(S_TX_MRETRY)
block|{
literal|7
block|,
literal|"rtsgood"
block|,
literal|"rtsgood"
block|,
literal|"RTS tx success"
block|}
block|,
define|#
directive|define
name|S_TX_RTSBAD
value|AFTER(S_TX_RTSGOOD)
block|{
literal|6
block|,
literal|"rtsbad"
block|,
literal|"rtsbad"
block|,
literal|"RTS tx failed"
block|}
block|,
define|#
directive|define
name|S_TX_NOACK
value|AFTER(S_TX_RTSBAD)
block|{
literal|5
block|,
literal|"noack"
block|,
literal|"noack"
block|,
literal|"tx failed because no ACK was received"
block|}
block|,
define|#
directive|define
name|S_RX_DUPLICATE
value|AFTER(S_TX_NOACK)
block|{
literal|5
block|,
literal|"rxdup"
block|,
literal|"rxdup"
block|,
literal|"rx discarded by f/w as dup"
block|}
block|,
define|#
directive|define
name|S_RX_FCS
value|AFTER(S_RX_DUPLICATE)
block|{
literal|5
block|,
literal|"rxfcs"
block|,
literal|"rxfcs"
block|,
literal|"rx discarded by f/w for bad FCS"
block|}
block|,
define|#
directive|define
name|S_TX_WATCHDOG
value|AFTER(S_RX_FCS)
block|{
literal|7
block|,
literal|"txwatch"
block|,
literal|"txwatch"
block|,
literal|"MAC tx hang (f/w recovery)"
block|}
block|,
define|#
directive|define
name|S_RX_OVERFLOW
value|AFTER(S_TX_WATCHDOG)
block|{
literal|6
block|,
literal|"rxover"
block|,
literal|"rxover"
block|,
literal|"no f/w buffer for rx"
block|}
block|,
define|#
directive|define
name|S_RX_FRAGERROR
value|AFTER(S_RX_OVERFLOW)
block|{
literal|6
block|,
literal|"rxfrag"
block|,
literal|"rxfrag"
block|,
literal|"rx failed in f/w due to defrag"
block|}
block|,
define|#
directive|define
name|S_RX_MEMERROR
value|AFTER(S_RX_FRAGERROR)
block|{
literal|5
block|,
literal|"rxmem"
block|,
literal|"rxmem"
block|,
literal|"rx failed in f/w 'cuz out of of memory"
block|}
block|,
define|#
directive|define
name|S_PTRERROR
value|AFTER(S_RX_MEMERROR)
block|{
literal|6
block|,
literal|"badptr"
block|,
literal|"badptr"
block|,
literal|"MAC internal pointer problem"
block|}
block|,
define|#
directive|define
name|S_TX_UNDERFLOW
value|AFTER(S_PTRERROR)
block|{
literal|7
block|,
literal|"txunder"
block|,
literal|"txunder"
block|,
literal|"tx failed in f/w 'cuz of underflow"
block|}
block|,
define|#
directive|define
name|S_TX_DONE
value|AFTER(S_TX_UNDERFLOW)
block|{
literal|6
block|,
literal|"txdone"
block|,
literal|"txdone"
block|,
literal|"MAC tx ops completed"
block|}
block|,
define|#
directive|define
name|S_TX_DONEBUFPUT
value|AFTER(S_TX_DONE)
block|{
literal|9
block|,
literal|"txdoneput"
block|,
literal|"txdoneput"
block|,
literal|"tx buffers returned by f/w to host"
block|}
block|,
define|#
directive|define
name|S_TX_WAIT4BUF
value|AFTER(S_TX_DONEBUFPUT)
block|{
literal|6
block|,
literal|"txwait"
block|,
literal|"txwait"
block|,
literal|"no f/w buffers available when supplied a tx descriptor"
block|}
block|,
define|#
directive|define
name|S_TX_ATTEMPTS
value|AFTER(S_TX_WAIT4BUF)
block|{
literal|5
block|,
literal|"txtry"
block|,
literal|"txtry"
block|,
literal|"tx descriptors processed by f/w"
block|}
block|,
define|#
directive|define
name|S_TX_SUCCESS
value|AFTER(S_TX_ATTEMPTS)
block|{
literal|4
block|,
literal|"txok"
block|,
literal|"txok"
block|,
literal|"tx attempts successful"
block|}
block|,
define|#
directive|define
name|S_TX_FRAGS
value|AFTER(S_TX_SUCCESS)
block|{
literal|6
block|,
literal|"txfrag"
block|,
literal|"txfrag"
block|,
literal|"tx attempts with fragmentation"
block|}
block|,
define|#
directive|define
name|S_RX_UNDECRYPT
value|AFTER(S_TX_FRAGS)
block|{
literal|7
block|,
literal|"rxcrypt"
block|,
literal|"rxcrypt"
block|,
literal|"rx failed in f/w 'cuz decrypt failed"
block|}
block|,
define|#
directive|define
name|S_RX_ICVERROR
value|AFTER(S_RX_UNDECRYPT)
block|{
literal|5
block|,
literal|"rxicv"
block|,
literal|"rxicv"
block|,
literal|"rx failed in f/w 'cuz ICV check"
block|}
block|,
define|#
directive|define
name|S_RX_EXCLUDE
value|AFTER(S_RX_ICVERROR)
block|{
literal|8
block|,
literal|"rxfilter"
block|,
literal|"rxfilter"
block|,
literal|"rx frames filtered in f/w"
block|}
block|,
define|#
directive|define
name|S_TX_LINEAR
value|AFTER(S_RX_EXCLUDE)
block|{
literal|5
block|,
literal|"txlinear"
block|,
literal|"txlinear"
block|,
literal|"tx linearized to cluster"
block|}
block|,
define|#
directive|define
name|S_TX_DISCARD
value|AFTER(S_TX_LINEAR)
block|{
literal|5
block|,
literal|"txdisc"
block|,
literal|"txdisc"
block|,
literal|"tx frames discarded prior to association"
block|}
block|,
define|#
directive|define
name|S_TX_QSTOP
value|AFTER(S_TX_DISCARD)
block|{
literal|5
block|,
literal|"qstop"
block|,
literal|"qstop"
block|,
literal|"tx stopped 'cuz no xmit buffer"
block|}
block|,
define|#
directive|define
name|S_TX_ENCAP
value|AFTER(S_TX_QSTOP)
block|{
literal|5
block|,
literal|"txencode"
block|,
literal|"txencode"
block|,
literal|"tx encapsulation failed"
block|}
block|,
define|#
directive|define
name|S_TX_NOMBUF
value|AFTER(S_TX_ENCAP)
block|{
literal|5
block|,
literal|"txnombuf"
block|,
literal|"txnombuf"
block|,
literal|"tx failed 'cuz mbuf allocation failed"
block|}
block|,
define|#
directive|define
name|S_TX_SHORTPRE
value|AFTER(S_TX_NOMBUF)
block|{
literal|5
block|,
literal|"shpre"
block|,
literal|"shpre"
block|,
literal|"tx frames with short preamble"
block|}
block|,
define|#
directive|define
name|S_TX_NOHEADROOM
value|AFTER(S_TX_SHORTPRE)
block|{
literal|5
block|,
literal|"nohead"
block|,
literal|"nohead"
block|,
literal|"tx frames discarded for lack of headroom"
block|}
block|,
define|#
directive|define
name|S_TX_BADFRAMETYPE
value|AFTER(S_TX_NOHEADROOM)
block|{
literal|5
block|,
literal|"badtxtype"
block|,
literal|"badtxtype"
block|,
literal|"tx frames discarded for invalid/unknown 802.11 frame type"
block|}
block|,
define|#
directive|define
name|S_RX_CRYPTO_ERR
value|AFTER(S_TX_BADFRAMETYPE)
block|{
literal|5
block|,
literal|"crypt"
block|,
literal|"crypt"
block|,
literal|"rx failed 'cuz decryption"
block|}
block|,
define|#
directive|define
name|S_RX_NOMBUF
value|AFTER(S_RX_CRYPTO_ERR)
block|{
literal|5
block|,
literal|"rxnombuf"
block|,
literal|"rxnombuf"
block|,
literal|"rx setup failed 'cuz no mbuf"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPMIC
value|AFTER(S_RX_NOMBUF)
block|{
literal|5
block|,
literal|"rxtkipmic"
block|,
literal|"rxtkipmic"
block|,
literal|"rx failed 'cuz TKIP MIC error"
block|}
block|,
define|#
directive|define
name|S_RX_NODMABUF
value|AFTER(S_RX_TKIPMIC)
block|{
literal|5
block|,
literal|"rxnodmabuf"
block|,
literal|"rxnodmabuf"
block|,
literal|"rx failed 'cuz no DMA buffer available"
block|}
block|,
define|#
directive|define
name|S_RX_DMABUFMISSING
value|AFTER(S_RX_NODMABUF)
block|{
literal|5
block|,
literal|"rxdmabufmissing"
block|,
literal|"rxdmabufmissing"
block|,
literal|"rx descriptor with no DMA buffer attached"
block|}
block|,
define|#
directive|define
name|S_TX_NODATA
value|AFTER(S_RX_DMABUFMISSING)
block|{
literal|5
block|,
literal|"txnodata"
block|,
literal|"txnodata"
block|,
literal|"tx discarded empty frame"
block|}
block|,
define|#
directive|define
name|S_TX_BUSDMA
value|AFTER(S_TX_NODATA)
block|{
literal|5
block|,
literal|"txbusdma"
block|,
literal|"txbusdma"
block|,
literal|"tx failed for dma resources"
block|}
block|,
define|#
directive|define
name|S_RX_BUSDMA
value|AFTER(S_TX_BUSDMA)
block|{
literal|5
block|,
literal|"rxbusdma"
block|,
literal|"rxbusdma"
block|,
literal|"rx setup failed for dma resources"
block|}
block|,
define|#
directive|define
name|S_AMPDU_NOSTREAM
value|AFTER(S_RX_BUSDMA)
block|{
literal|5
block|,
literal|"ampdu_nostream"
block|,
literal|"ampdu_nostream"
block|,
literal|"ADDBA request failed 'cuz all BA streams in use"
block|}
block|,
define|#
directive|define
name|S_AMPDU_REJECT
value|AFTER(S_AMPDU_NOSTREAM)
block|{
literal|5
block|,
literal|"ampdu_reject"
block|,
literal|"ampdu_reject"
block|,
literal|"ADDBA request failed 'cuz station already has one BA stream"
block|}
block|,
define|#
directive|define
name|S_ADDBA_NOSTREAM
value|AFTER(S_AMPDU_REJECT)
block|{
literal|5
block|,
literal|"addba_nostream"
block|,
literal|"addba_nostream"
block|,
literal|"ADDBA response processed but no BA stream present"
block|}
block|,
define|#
directive|define
name|S_TX_TSO
value|AFTER(S_ADDBA_NOSTREAM)
block|{
literal|8
block|,
literal|"txtso"
block|,
literal|"tso"
block|,
literal|"tx frames using TSO"
block|}
block|,
define|#
directive|define
name|S_TSO_BADETH
value|AFTER(S_TX_TSO)
block|{
literal|5
block|,
literal|"tsoeth"
block|,
literal|"tsoeth"
block|,
literal|"TSO failed 'cuz ether header type not IPv4"
block|}
block|,
define|#
directive|define
name|S_TSO_NOHDR
value|AFTER(S_TSO_BADETH)
block|{
literal|5
block|,
literal|"tsonohdr"
block|,
literal|"tsonohdr"
block|,
literal|"TSO failed 'cuz header not in first mbuf"
block|}
block|,
define|#
directive|define
name|S_TSO_BADSPLIT
value|AFTER(S_TSO_NOHDR)
block|{
literal|5
block|,
literal|"tsobadsplit"
block|,
literal|"tsobadsplit"
block|,
literal|"TSO failed 'cuz payload split failed"
block|}
block|,
define|#
directive|define
name|S_BAWATCHDOG
value|AFTER(S_TSO_BADSPLIT)
block|{
literal|5
block|,
literal|"bawatchdog"
block|,
literal|"bawatchdog"
block|,
literal|"BA watchdog interrupts"
block|}
block|,
define|#
directive|define
name|S_BAWATCHDOG_NOTFOUND
value|AFTER(S_BAWATCHDOG)
block|{
literal|5
block|,
literal|"bawatchdog_notfound"
block|,
literal|"bawatchdog_notfound"
block|,
literal|"BA watchdog for unknown stream"
block|}
block|,
define|#
directive|define
name|S_BAWATCHDOG_EMPTY
value|AFTER(S_BAWATCHDOG_NOTFOUND)
block|{
literal|5
block|,
literal|"bawatchdog_empty"
block|,
literal|"bawatchdog_empty"
block|,
literal|"BA watchdog on all streams but none found"
block|}
block|,
define|#
directive|define
name|S_BAWATCHDOG_FAILED
value|AFTER(S_BAWATCHDOG_EMPTY)
block|{
literal|5
block|,
literal|"bawatchdog_failed"
block|,
literal|"bawatchdog_failed"
block|,
literal|"BA watchdog processing failed to get bitmap from f/w"
block|}
block|,
define|#
directive|define
name|S_RADARDETECT
value|AFTER(S_BAWATCHDOG_FAILED)
block|{
literal|5
block|,
literal|"radardetect"
block|,
literal|"radardetect"
block|,
literal|"radar detect interrupts"
block|}
block|,
define|#
directive|define
name|S_RATE
value|AFTER(S_RADARDETECT)
block|{
literal|4
block|,
literal|"rate"
block|,
literal|"rate"
block|,
literal|"rate of last transmit"
block|}
block|,
define|#
directive|define
name|S_TX_RSSI
value|AFTER(S_RATE)
block|{
literal|4
block|,
literal|"arssi"
block|,
literal|"arssi"
block|,
literal|"rssi of last ack"
block|}
block|,
define|#
directive|define
name|S_RX_RSSI
value|AFTER(S_TX_RSSI)
block|{
literal|4
block|,
literal|"rssi"
block|,
literal|"rssi"
block|,
literal|"avg recv rssi"
block|}
block|,
define|#
directive|define
name|S_RX_NOISE
value|AFTER(S_RX_RSSI)
block|{
literal|5
block|,
literal|"noise"
block|,
literal|"noise"
block|,
literal|"rx noise floor"
block|}
block|,
define|#
directive|define
name|S_TX_SIGNAL
value|AFTER(S_RX_NOISE)
block|{
literal|4
block|,
literal|"asignal"
block|,
literal|"asig"
block|,
literal|"signal of last ack (dBm)"
block|}
block|,
define|#
directive|define
name|S_RX_SIGNAL
value|AFTER(S_TX_SIGNAL)
block|{
literal|4
block|,
literal|"signal"
block|,
literal|"sig"
block|,
literal|"avg recv signal (dBm)"
block|}
block|,
define|#
directive|define
name|S_ANT_TX0
value|AFTER(S_RX_SIGNAL)
block|{
literal|8
block|,
literal|"tx0"
block|,
literal|"ant0(tx)"
block|,
literal|"frames tx on antenna 0"
block|}
block|,
define|#
directive|define
name|S_ANT_TX1
value|(S_RX_SIGNAL+2)
block|{
literal|8
block|,
literal|"tx1"
block|,
literal|"ant1(tx)"
block|,
literal|"frames tx on antenna 1"
block|}
block|,
define|#
directive|define
name|S_ANT_TX2
value|(S_RX_SIGNAL+3)
block|{
literal|8
block|,
literal|"tx2"
block|,
literal|"ant2(tx)"
block|,
literal|"frames tx on antenna 2"
block|}
block|,
define|#
directive|define
name|S_ANT_TX3
value|(S_RX_SIGNAL+4)
block|{
literal|8
block|,
literal|"tx3"
block|,
literal|"ant3(tx)"
block|,
literal|"frames tx on antenna 3"
block|}
block|,
define|#
directive|define
name|S_ANT_RX0
value|AFTER(S_ANT_TX3)
block|{
literal|8
block|,
literal|"rx0"
block|,
literal|"ant0(rx)"
block|,
literal|"frames rx on antenna 0"
block|}
block|,
define|#
directive|define
name|S_ANT_RX1
value|(S_ANT_TX3+2)
block|{
literal|8
block|,
literal|"rx1"
block|,
literal|"ant1(rx)"
block|,
literal|"frames rx on antenna 1"
block|}
block|,
define|#
directive|define
name|S_ANT_RX2
value|(S_ANT_TX3+3)
block|{
literal|8
block|,
literal|"rx2"
block|,
literal|"ant2(rx)"
block|,
literal|"frames rx on antenna 2"
block|}
block|,
define|#
directive|define
name|S_ANT_RX3
value|(S_ANT_TX3+4)
block|{
literal|8
block|,
literal|"rx3"
block|,
literal|"ant3(rx)"
block|,
literal|"frames rx on antenna 3"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* NB: this intentionally avoids per-antenna stats */
end_comment

begin_define
define|#
directive|define
name|S_LAST
value|(S_RX_SIGNAL+1)
end_define

begin_struct
struct|struct
name|mwlstatfoo_p
block|{
name|struct
name|mwlstatfoo
name|base
decl_stmt|;
name|int
name|s
decl_stmt|;
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|mwl_stats
name|cur
decl_stmt|;
name|struct
name|mwl_stats
name|total
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|mwl_setifname
parameter_list|(
name|struct
name|mwlstatfoo
modifier|*
name|wf0
parameter_list|,
specifier|const
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
name|strncpy
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mwl_collect
parameter_list|(
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
parameter_list|,
name|struct
name|mwl_stats
modifier|*
name|stats
parameter_list|)
block|{
name|wf
operator|->
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
name|stats
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCGMVSTATS
argument_list|,
operator|&
name|wf
operator|->
name|ifr
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mwl_collect_cur
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|mwl_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|cur
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mwl_collect_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|mwl_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|total
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|mwl_update_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wf
operator|->
name|total
operator|=
name|wf
operator|->
name|cur
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|setrate
parameter_list|(
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|,
name|uint8_t
name|rate
parameter_list|)
block|{
if|if
condition|(
name|rate
operator|&
name|IEEE80211_RATE_MCS
condition|)
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"MCS%u"
argument_list|,
name|rate
operator|&
name|IEEE80211_RATE_VAL
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|rate
operator|&
literal|1
condition|)
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%u.5M"
argument_list|,
name|rate
operator|/
literal|2
argument_list|)
expr_stmt|;
else|else
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%uM"
argument_list|,
name|rate
operator|/
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|mwl_get_curstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.mst_##x - wf->total.mst_##x); return 1
define|#
directive|define
name|HWSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.hw_stats.x - wf->total.hw_stats.x); return 1
define|#
directive|define
name|RXANT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.mst_ant_rx[x] - wf->total.mst_ant_rx[x]); return 1
define|#
directive|define
name|TXANT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.mst_ant_tx[x] - wf->total.mst_ant_tx[x]); return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_INPUT
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%lu"
argument_list|,
call|(
name|u_long
call|)
argument_list|(
operator|(
name|wf
operator|->
name|cur
operator|.
name|mst_rx_packets
operator|-
name|wf
operator|->
name|total
operator|.
name|mst_rx_packets
operator|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_OUTPUT
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%lu"
argument_list|,
call|(
name|u_long
call|)
argument_list|(
name|wf
operator|->
name|cur
operator|.
name|mst_tx_packets
operator|-
name|wf
operator|->
name|total
operator|.
name|mst_tx_packets
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RATE
case|:
name|setrate
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|mst_tx_rate
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_TX_RETRY
case|:
name|HWSTAT
argument_list|(
name|TxRetrySuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_MRETRY
case|:
name|HWSTAT
argument_list|(
name|TxMultipleRetrySuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_RTSGOOD
case|:
name|HWSTAT
argument_list|(
name|RTSSuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_RTSBAD
case|:
name|HWSTAT
argument_list|(
name|RTSFailures
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOACK
case|:
name|HWSTAT
argument_list|(
name|AckFailures
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUPLICATE
case|:
name|HWSTAT
argument_list|(
name|RxDuplicateFrames
argument_list|)
expr_stmt|;
case|case
name|S_RX_FCS
case|:
name|HWSTAT
argument_list|(
name|FCSErrorCount
argument_list|)
expr_stmt|;
case|case
name|S_TX_WATCHDOG
case|:
name|HWSTAT
argument_list|(
name|TxWatchDogTimeouts
argument_list|)
expr_stmt|;
case|case
name|S_RX_OVERFLOW
case|:
name|HWSTAT
argument_list|(
name|RxOverflows
argument_list|)
expr_stmt|;
case|case
name|S_RX_FRAGERROR
case|:
name|HWSTAT
argument_list|(
name|RxFragErrors
argument_list|)
expr_stmt|;
case|case
name|S_RX_MEMERROR
case|:
name|HWSTAT
argument_list|(
name|RxMemErrors
argument_list|)
expr_stmt|;
case|case
name|S_PTRERROR
case|:
name|HWSTAT
argument_list|(
name|PointerErrors
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNDERFLOW
case|:
name|HWSTAT
argument_list|(
name|TxUnderflows
argument_list|)
expr_stmt|;
case|case
name|S_TX_DONE
case|:
name|HWSTAT
argument_list|(
name|TxDone
argument_list|)
expr_stmt|;
case|case
name|S_TX_DONEBUFPUT
case|:
name|HWSTAT
argument_list|(
name|TxDoneBufPut
argument_list|)
expr_stmt|;
case|case
name|S_TX_WAIT4BUF
case|:
name|HWSTAT
argument_list|(
name|Wait4TxBuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_ATTEMPTS
case|:
name|HWSTAT
argument_list|(
name|TxAttempts
argument_list|)
expr_stmt|;
case|case
name|S_TX_SUCCESS
case|:
name|HWSTAT
argument_list|(
name|TxSuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|HWSTAT
argument_list|(
name|TxFragments
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|HWSTAT
argument_list|(
name|TxMulticasts
argument_list|)
expr_stmt|;
case|case
name|S_RX_NONCTL
case|:
name|HWSTAT
argument_list|(
name|RxNonCtlPkts
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|HWSTAT
argument_list|(
name|RxMulticasts
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNDECRYPT
case|:
name|HWSTAT
argument_list|(
name|RxUndecryptableFrames
argument_list|)
expr_stmt|;
case|case
name|S_RX_ICVERROR
case|:
name|HWSTAT
argument_list|(
name|RxICVErrors
argument_list|)
expr_stmt|;
case|case
name|S_RX_EXCLUDE
case|:
name|HWSTAT
argument_list|(
name|RxExcludedFrames
argument_list|)
expr_stmt|;
case|case
name|S_TX_MGMT
case|:
name|STAT
argument_list|(
name|tx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_TX_DISCARD
case|:
name|STAT
argument_list|(
name|tx_discard
argument_list|)
expr_stmt|;
case|case
name|S_TX_QSTOP
case|:
name|STAT
argument_list|(
name|tx_qstop
argument_list|)
expr_stmt|;
case|case
name|S_TX_ENCAP
case|:
name|STAT
argument_list|(
name|tx_encap
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOMBUF
case|:
name|STAT
argument_list|(
name|tx_nombuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_LINEAR
case|:
name|STAT
argument_list|(
name|tx_linear
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODATA
case|:
name|STAT
argument_list|(
name|tx_nodata
argument_list|)
expr_stmt|;
case|case
name|S_TX_BUSDMA
case|:
name|STAT
argument_list|(
name|tx_busdma
argument_list|)
expr_stmt|;
case|case
name|S_TX_SHORTPRE
case|:
name|STAT
argument_list|(
name|tx_shortpre
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADFRAMETYPE
case|:
name|STAT
argument_list|(
name|tx_badframetype
argument_list|)
expr_stmt|;
case|case
name|S_RX_CRYPTO_ERR
case|:
name|STAT
argument_list|(
name|rx_crypto
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODMABUF
case|:
name|STAT
argument_list|(
name|rx_nodmabuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DMABUFMISSING
case|:
name|STAT
argument_list|(
name|rx_dmabufmissing
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOMBUF
case|:
name|STAT
argument_list|(
name|rx_nombuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_BUSDMA
case|:
name|STAT
argument_list|(
name|rx_busdma
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_NOSTREAM
case|:
name|STAT
argument_list|(
name|ampdu_nostream
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_REJECT
case|:
name|STAT
argument_list|(
name|ampdu_reject
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_NOSTREAM
case|:
name|STAT
argument_list|(
name|addba_nostream
argument_list|)
expr_stmt|;
case|case
name|S_TX_TSO
case|:
name|STAT
argument_list|(
name|tx_tso
argument_list|)
expr_stmt|;
case|case
name|S_TSO_BADETH
case|:
name|STAT
argument_list|(
name|tso_badeth
argument_list|)
expr_stmt|;
case|case
name|S_TSO_NOHDR
case|:
name|STAT
argument_list|(
name|tso_nohdr
argument_list|)
expr_stmt|;
case|case
name|S_TSO_BADSPLIT
case|:
name|STAT
argument_list|(
name|tso_badsplit
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG
case|:
name|STAT
argument_list|(
name|bawatchdog
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_NOTFOUND
case|:
name|STAT
argument_list|(
name|bawatchdog_notfound
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_EMPTY
case|:
name|STAT
argument_list|(
name|bawatchdog_empty
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_FAILED
case|:
name|STAT
argument_list|(
name|bawatchdog_failed
argument_list|)
expr_stmt|;
case|case
name|S_RADARDETECT
case|:
name|STAT
argument_list|(
name|radardetect
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSSI
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|mst_rx_rssi
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_ANT_TX0
case|:
name|TXANT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX1
case|:
name|TXANT
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX2
case|:
name|TXANT
argument_list|(
literal|2
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX3
case|:
name|TXANT
argument_list|(
literal|3
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX0
case|:
name|RXANT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX1
case|:
name|RXANT
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX2
case|:
name|RXANT
argument_list|(
literal|2
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX3
case|:
name|RXANT
argument_list|(
literal|3
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOISE
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|mst_rx_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RX_SIGNAL
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|mst_rx_rssi
operator|+
name|wf
operator|->
name|cur
operator|.
name|mst_rx_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|b
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
undef|#
directive|undef
name|RXANT
undef|#
directive|undef
name|TXANT
undef|#
directive|undef
name|HWSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_function
specifier|static
name|int
name|mwl_get_totstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.mst_##x); return 1
define|#
directive|define
name|HWSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.hw_stats.x); return 1
define|#
directive|define
name|TXANT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.mst_ant_tx[x]); return 1
define|#
directive|define
name|RXANT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.mst_ant_rx[x]); return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_INPUT
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|u_long
operator|)
name|wf
operator|->
name|total
operator|.
name|mst_rx_packets
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_OUTPUT
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|u_long
operator|)
name|wf
operator|->
name|total
operator|.
name|mst_tx_packets
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RATE
case|:
name|setrate
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_tx_rate
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_TX_RETRY
case|:
name|HWSTAT
argument_list|(
name|TxRetrySuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_MRETRY
case|:
name|HWSTAT
argument_list|(
name|TxMultipleRetrySuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_RTSGOOD
case|:
name|HWSTAT
argument_list|(
name|RTSSuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_RTSBAD
case|:
name|HWSTAT
argument_list|(
name|RTSFailures
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOACK
case|:
name|HWSTAT
argument_list|(
name|AckFailures
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUPLICATE
case|:
name|HWSTAT
argument_list|(
name|RxDuplicateFrames
argument_list|)
expr_stmt|;
case|case
name|S_RX_FCS
case|:
name|HWSTAT
argument_list|(
name|FCSErrorCount
argument_list|)
expr_stmt|;
case|case
name|S_TX_WATCHDOG
case|:
name|HWSTAT
argument_list|(
name|TxWatchDogTimeouts
argument_list|)
expr_stmt|;
case|case
name|S_RX_OVERFLOW
case|:
name|HWSTAT
argument_list|(
name|RxOverflows
argument_list|)
expr_stmt|;
case|case
name|S_RX_FRAGERROR
case|:
name|HWSTAT
argument_list|(
name|RxFragErrors
argument_list|)
expr_stmt|;
case|case
name|S_RX_MEMERROR
case|:
name|HWSTAT
argument_list|(
name|RxMemErrors
argument_list|)
expr_stmt|;
case|case
name|S_PTRERROR
case|:
name|HWSTAT
argument_list|(
name|PointerErrors
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNDERFLOW
case|:
name|HWSTAT
argument_list|(
name|TxUnderflows
argument_list|)
expr_stmt|;
case|case
name|S_TX_DONE
case|:
name|HWSTAT
argument_list|(
name|TxDone
argument_list|)
expr_stmt|;
case|case
name|S_TX_DONEBUFPUT
case|:
name|HWSTAT
argument_list|(
name|TxDoneBufPut
argument_list|)
expr_stmt|;
case|case
name|S_TX_WAIT4BUF
case|:
name|HWSTAT
argument_list|(
name|Wait4TxBuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_ATTEMPTS
case|:
name|HWSTAT
argument_list|(
name|TxAttempts
argument_list|)
expr_stmt|;
case|case
name|S_TX_SUCCESS
case|:
name|HWSTAT
argument_list|(
name|TxSuccesses
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|HWSTAT
argument_list|(
name|TxFragments
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|HWSTAT
argument_list|(
name|TxMulticasts
argument_list|)
expr_stmt|;
case|case
name|S_RX_NONCTL
case|:
name|HWSTAT
argument_list|(
name|RxNonCtlPkts
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|HWSTAT
argument_list|(
name|RxMulticasts
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNDECRYPT
case|:
name|HWSTAT
argument_list|(
name|RxUndecryptableFrames
argument_list|)
expr_stmt|;
case|case
name|S_RX_ICVERROR
case|:
name|HWSTAT
argument_list|(
name|RxICVErrors
argument_list|)
expr_stmt|;
case|case
name|S_RX_EXCLUDE
case|:
name|HWSTAT
argument_list|(
name|RxExcludedFrames
argument_list|)
expr_stmt|;
case|case
name|S_TX_MGMT
case|:
name|STAT
argument_list|(
name|tx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_TX_DISCARD
case|:
name|STAT
argument_list|(
name|tx_discard
argument_list|)
expr_stmt|;
case|case
name|S_TX_QSTOP
case|:
name|STAT
argument_list|(
name|tx_qstop
argument_list|)
expr_stmt|;
case|case
name|S_TX_ENCAP
case|:
name|STAT
argument_list|(
name|tx_encap
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOMBUF
case|:
name|STAT
argument_list|(
name|tx_nombuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_LINEAR
case|:
name|STAT
argument_list|(
name|tx_linear
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODATA
case|:
name|STAT
argument_list|(
name|tx_nodata
argument_list|)
expr_stmt|;
case|case
name|S_TX_BUSDMA
case|:
name|STAT
argument_list|(
name|tx_busdma
argument_list|)
expr_stmt|;
case|case
name|S_TX_SHORTPRE
case|:
name|STAT
argument_list|(
name|tx_shortpre
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADFRAMETYPE
case|:
name|STAT
argument_list|(
name|tx_badframetype
argument_list|)
expr_stmt|;
case|case
name|S_RX_CRYPTO_ERR
case|:
name|STAT
argument_list|(
name|rx_crypto
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODMABUF
case|:
name|STAT
argument_list|(
name|rx_nodmabuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DMABUFMISSING
case|:
name|STAT
argument_list|(
name|rx_dmabufmissing
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOMBUF
case|:
name|STAT
argument_list|(
name|rx_nombuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_BUSDMA
case|:
name|STAT
argument_list|(
name|rx_busdma
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_NOSTREAM
case|:
name|STAT
argument_list|(
name|ampdu_nostream
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_REJECT
case|:
name|STAT
argument_list|(
name|ampdu_reject
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_NOSTREAM
case|:
name|STAT
argument_list|(
name|addba_nostream
argument_list|)
expr_stmt|;
case|case
name|S_TX_TSO
case|:
name|STAT
argument_list|(
name|tx_tso
argument_list|)
expr_stmt|;
case|case
name|S_TSO_BADETH
case|:
name|STAT
argument_list|(
name|tso_badeth
argument_list|)
expr_stmt|;
case|case
name|S_TSO_NOHDR
case|:
name|STAT
argument_list|(
name|tso_nohdr
argument_list|)
expr_stmt|;
case|case
name|S_TSO_BADSPLIT
case|:
name|STAT
argument_list|(
name|tso_badsplit
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG
case|:
name|STAT
argument_list|(
name|bawatchdog
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_NOTFOUND
case|:
name|STAT
argument_list|(
name|bawatchdog_notfound
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_EMPTY
case|:
name|STAT
argument_list|(
name|bawatchdog_empty
argument_list|)
expr_stmt|;
case|case
name|S_BAWATCHDOG_FAILED
case|:
name|STAT
argument_list|(
name|bawatchdog_failed
argument_list|)
expr_stmt|;
case|case
name|S_RADARDETECT
case|:
name|STAT
argument_list|(
name|radardetect
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSSI
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_rx_rssi
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_ANT_TX0
case|:
name|TXANT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX1
case|:
name|TXANT
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX2
case|:
name|TXANT
argument_list|(
literal|2
argument_list|)
expr_stmt|;
case|case
name|S_ANT_TX3
case|:
name|TXANT
argument_list|(
literal|3
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX0
case|:
name|RXANT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX1
case|:
name|RXANT
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX2
case|:
name|RXANT
argument_list|(
literal|2
argument_list|)
expr_stmt|;
case|case
name|S_ANT_RX3
case|:
name|RXANT
argument_list|(
literal|3
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOISE
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_rx_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RX_SIGNAL
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_rx_rssi
operator|+
name|wf
operator|->
name|total
operator|.
name|mst_rx_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|b
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
undef|#
directive|undef
name|RXANT
undef|#
directive|undef
name|TXANT
undef|#
directive|undef
name|HWSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_function
specifier|static
name|void
name|mwl_print_verbose
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|)
block|{
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|mwlstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
specifier|const
name|struct
name|fmt
modifier|*
name|f
decl_stmt|;
name|char
name|s
index|[
literal|32
index|]
decl_stmt|;
specifier|const
name|char
modifier|*
name|indent
decl_stmt|;
name|int
name|i
decl_stmt|,
name|width
decl_stmt|;
name|width
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|S_LAST
condition|;
name|i
operator|++
control|)
block|{
name|f
operator|=
operator|&
name|sf
operator|->
name|stats
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|f
operator|->
name|width
operator|>
name|width
condition|)
name|width
operator|=
name|f
operator|->
name|width
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|S_LAST
condition|;
name|i
operator|++
control|)
block|{
name|f
operator|=
operator|&
name|sf
operator|->
name|stats
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|mwl_get_totstat
argument_list|(
name|sf
argument_list|,
name|i
argument_list|,
name|s
argument_list|,
sizeof|sizeof
argument_list|(
name|s
argument_list|)
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"0"
argument_list|)
condition|)
block|{
name|indent
operator|=
literal|""
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s%-*s %s\n"
argument_list|,
name|indent
argument_list|,
name|width
argument_list|,
name|s
argument_list|,
name|f
operator|->
name|desc
argument_list|)
expr_stmt|;
block|}
block|}
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"Antenna profile:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|wf
operator|->
name|total
operator|.
name|mst_ant_rx
index|[
name|i
index|]
operator|||
name|wf
operator|->
name|total
operator|.
name|mst_ant_tx
index|[
name|i
index|]
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"[%u] tx %8u rx %8u\n"
argument_list|,
name|i
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_ant_tx
index|[
name|i
index|]
argument_list|,
name|wf
operator|->
name|total
operator|.
name|mst_ant_rx
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|STATFOO_DEFINE_BOUNCE
argument_list|(
argument|mwlstatfoo
argument_list|)
end_macro

begin_function
name|struct
name|mwlstatfoo
modifier|*
name|mwlstats_new
parameter_list|(
specifier|const
name|char
modifier|*
name|ifname
parameter_list|,
specifier|const
name|char
modifier|*
name|fmtstring
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a) / sizeof(a[0]))
name|struct
name|mwlstatfoo_p
modifier|*
name|wf
decl_stmt|;
name|wf
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|mwlstatfoo_p
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|!=
name|NULL
condition|)
block|{
name|statfoo_init
argument_list|(
operator|&
name|wf
operator|->
name|base
operator|.
name|base
argument_list|,
literal|"mwlstats"
argument_list|,
name|mwlstats
argument_list|,
name|N
argument_list|(
name|mwlstats
argument_list|)
argument_list|)
expr_stmt|;
comment|/* override base methods */
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_cur
operator|=
name|mwl_collect_cur
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_tot
operator|=
name|mwl_collect_tot
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_curstat
operator|=
name|mwl_get_curstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_totstat
operator|=
name|mwl_get_totstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|update_tot
operator|=
name|mwl_update_tot
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|print_verbose
operator|=
name|mwl_print_verbose
expr_stmt|;
comment|/* setup bounce functions for public methods */
name|STATFOO_BOUNCE
argument_list|(
name|wf
argument_list|,
name|mwlstatfoo
argument_list|)
expr_stmt|;
comment|/* setup our public methods */
name|wf
operator|->
name|base
operator|.
name|setifname
operator|=
name|mwl_setifname
expr_stmt|;
if|#
directive|if
literal|0
block|wf->base.setstamac = wlan_setstamac;
endif|#
directive|endif
name|wf
operator|->
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|->
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
name|mwl_setifname
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|setfmt
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|fmtstring
argument_list|)
expr_stmt|;
block|}
return|return
operator|&
name|wf
operator|->
name|base
return|;
undef|#
directive|undef
name|N
block|}
end_function

end_unit

