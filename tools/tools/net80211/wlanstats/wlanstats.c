begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002-2006 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  * 3. Neither the names of the above-listed copyright holders nor the names  *    of any contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * Alternatively, this software may be distributed under the terms of the  * GNU General Public License ("GPL") version 2 as published by the Free  * Software Foundation.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*  * net80211 statistics class.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<ifaddrs.h>
end_include

begin_include
include|#
directive|include
file|"../../../../sys/net80211/ieee80211_ioctl.h"
end_include

begin_include
include|#
directive|include
file|"wlanstats.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|IEEE80211_ADDR_COPY
end_ifndef

begin_define
define|#
directive|define
name|IEEE80211_ADDR_COPY
parameter_list|(
name|dst
parameter_list|,
name|src
parameter_list|)
value|memcpy(dst, src, IEEE80211_ADDR_LEN)
end_define

begin_define
define|#
directive|define
name|IEEE80211_ADDR_EQ
parameter_list|(
name|a1
parameter_list|,
name|a2
parameter_list|)
value|(memcmp(a1,a2,IEEE80211_ADDR_LEN) == 0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|fmt
name|wlanstats
index|[]
init|=
block|{
define|#
directive|define
name|S_RX_BADVERSION
value|0
block|{
literal|5
block|,
literal|"rx_badversion"
block|,
literal|"badversion"
block|,
literal|"rx frame with bad version"
block|}
block|,
define|#
directive|define
name|S_RX_TOOSHORT
value|1
block|{
literal|5
block|,
literal|"rx_tooshort"
block|,
literal|"tooshort"
block|,
literal|"rx frame too short"
block|}
block|,
define|#
directive|define
name|S_RX_WRONGBSS
value|2
block|{
literal|5
block|,
literal|"rx_wrongbss"
block|,
literal|"wrongbss"
block|,
literal|"rx from wrong bssid"
block|}
block|,
define|#
directive|define
name|S_RX_DUP
value|3
block|{
literal|5
block|,
literal|"rx_dup"
block|,
literal|"rx_dup"
block|,
literal|"rx discard 'cuz dup"
block|}
block|,
define|#
directive|define
name|S_RX_WRONGDIR
value|4
block|{
literal|5
block|,
literal|"rx_wrongdir"
block|,
literal|"wrongdir"
block|,
literal|"rx w/ wrong direction"
block|}
block|,
define|#
directive|define
name|S_RX_MCASTECHO
value|5
block|{
literal|5
block|,
literal|"rx_mcastecho"
block|,
literal|"mcastecho"
block|,
literal|"rx discard 'cuz mcast echo"
block|}
block|,
define|#
directive|define
name|S_RX_NOTASSOC
value|6
block|{
literal|5
block|,
literal|"rx_notassoc"
block|,
literal|"notassoc"
block|,
literal|"rx discard 'cuz sta !assoc"
block|}
block|,
define|#
directive|define
name|S_RX_NOPRIVACY
value|7
block|{
literal|5
block|,
literal|"rx_noprivacy"
block|,
literal|"noprivacy"
block|,
literal|"rx w/ wep but privacy off"
block|}
block|,
define|#
directive|define
name|S_RX_UNENCRYPTED
value|8
block|{
literal|5
block|,
literal|"rx_unencrypted"
block|,
literal|"unencrypted"
block|,
literal|"rx w/o wep and privacy on"
block|}
block|,
define|#
directive|define
name|S_RX_WEPFAIL
value|9
block|{
literal|5
block|,
literal|"rx_wepfail"
block|,
literal|"wepfail"
block|,
literal|"rx wep processing failed"
block|}
block|,
define|#
directive|define
name|S_RX_DECAP
value|10
block|{
literal|5
block|,
literal|"rx_decap"
block|,
literal|"decap"
block|,
literal|"rx decapsulation failed"
block|}
block|,
define|#
directive|define
name|S_RX_MGTDISCARD
value|11
block|{
literal|5
block|,
literal|"rx_mgtdiscard"
block|,
literal|"mgtdiscard"
block|,
literal|"rx discard mgt frames"
block|}
block|,
define|#
directive|define
name|S_RX_CTL
value|12
block|{
literal|5
block|,
literal|"rx_ctl"
block|,
literal|"ctl"
block|,
literal|"rx ctrl frames"
block|}
block|,
define|#
directive|define
name|S_RX_BEACON
value|13
block|{
literal|5
block|,
literal|"rx_beacon"
block|,
literal|"beacon"
block|,
literal|"rx beacon frames"
block|}
block|,
define|#
directive|define
name|S_RX_RSTOOBIG
value|14
block|{
literal|5
block|,
literal|"rx_rstoobig"
block|,
literal|"rstoobig"
block|,
literal|"rx rate set truncated"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_MISSING
value|15
block|{
literal|5
block|,
literal|"rx_elem_missing"
block|,
literal|"elem_missing"
block|,
literal|"rx required element missing"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_TOOBIG
value|16
block|{
literal|5
block|,
literal|"rx_elem_toobig"
block|,
literal|"elem_toobig"
block|,
literal|"rx element too big"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_TOOSMALL
value|17
block|{
literal|5
block|,
literal|"rx_elem_toosmall"
block|,
literal|"elem_toosmall"
block|,
literal|"rx element too small"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_UNKNOWN
value|18
block|{
literal|5
block|,
literal|"rx_elem_unknown"
block|,
literal|"elem_unknown"
block|,
literal|"rx element unknown"
block|}
block|,
define|#
directive|define
name|S_RX_BADCHAN
value|19
block|{
literal|5
block|,
literal|"rx_badchan"
block|,
literal|"badchan"
block|,
literal|"rx frame w/ invalid chan"
block|}
block|,
define|#
directive|define
name|S_RX_CHANMISMATCH
value|20
block|{
literal|5
block|,
literal|"rx_chanmismatch"
block|,
literal|"chanmismatch"
block|,
literal|"rx frame chan mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_NODEALLOC
value|21
block|{
literal|5
block|,
literal|"rx_nodealloc"
block|,
literal|"nodealloc"
block|,
literal|"nodes allocated (rx)"
block|}
block|,
define|#
directive|define
name|S_RX_SSIDMISMATCH
value|22
block|{
literal|5
block|,
literal|"rx_ssidmismatch"
block|,
literal|"ssidmismatch"
block|,
literal|"rx frame ssid mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_UNSUPPORTED
value|23
block|{
literal|5
block|,
literal|"rx_auth_unsupported"
block|,
literal|"auth_unsupported"
block|,
literal|"rx w/ unsupported auth alg"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_FAIL
value|24
block|{
literal|5
block|,
literal|"rx_auth_fail"
block|,
literal|"auth_fail"
block|,
literal|"rx sta auth failure"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_COUNTERMEASURES
value|25
block|{
literal|5
block|,
literal|"rx_auth_countermeasures"
block|,
literal|"auth_countermeasures"
block|,
literal|"rx sta auth failure 'cuz of TKIP countermeasures"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_BSS
value|26
block|{
literal|5
block|,
literal|"rx_assoc_bss"
block|,
literal|"assoc_bss"
block|,
literal|"rx assoc from wrong bssid"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_NOTAUTH
value|27
block|{
literal|5
block|,
literal|"rx_assoc_notauth"
block|,
literal|"assoc_notauth"
block|,
literal|"rx assoc w/o auth"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_CAPMISMATCH
value|28
block|{
literal|5
block|,
literal|"rx_assoc_capmismatch"
block|,
literal|"assoc_capmismatch"
block|,
literal|"rx assoc w/ cap mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_NORATE
value|29
block|{
literal|5
block|,
literal|"rx_assoc_norate"
block|,
literal|"assoc_norate"
block|,
literal|"rx assoc w/ no rate match"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_BADWPAIE
value|30
block|{
literal|5
block|,
literal|"rx_assoc_badwpaie"
block|,
literal|"assoc_badwpaie"
block|,
literal|"rx assoc w/ bad WPA IE"
block|}
block|,
define|#
directive|define
name|S_RX_DEAUTH
value|31
block|{
literal|5
block|,
literal|"rx_deauth"
block|,
literal|"deauth"
block|,
literal|"rx deauthentication"
block|}
block|,
define|#
directive|define
name|S_RX_DISASSOC
value|32
block|{
literal|5
block|,
literal|"rx_disassoc"
block|,
literal|"disassoc"
block|,
literal|"rx disassociation"
block|}
block|,
define|#
directive|define
name|S_RX_BADSUBTYPE
value|33
block|{
literal|5
block|,
literal|"rx_badsubtype"
block|,
literal|"badsubtype"
block|,
literal|"rx frame w/ unknown subtype"
block|}
block|,
define|#
directive|define
name|S_RX_NOBUF
value|34
block|{
literal|5
block|,
literal|"rx_nobuf"
block|,
literal|"nobuf"
block|,
literal|"rx failed for lack of mbuf"
block|}
block|,
define|#
directive|define
name|S_RX_DECRYPTCRC
value|35
block|{
literal|5
block|,
literal|"rx_decryptcrc"
block|,
literal|"decryptcrc"
block|,
literal|"rx decrypt failed on crc"
block|}
block|,
define|#
directive|define
name|S_RX_AHDEMO_MGT
value|36
block|{
literal|5
block|,
literal|"rx_ahdemo_mgt"
block|,
literal|"ahdemo_mgt"
block|,
literal|"rx discard mgmt frame received in ahdoc demo mode"
block|}
block|,
define|#
directive|define
name|S_RX_BAD_AUTH
value|37
block|{
literal|5
block|,
literal|"rx_bad_auth"
block|,
literal|"bad_auth"
block|,
literal|"rx bad authentication request"
block|}
block|,
define|#
directive|define
name|S_RX_UNAUTH
value|38
block|{
literal|5
block|,
literal|"rx_unauth"
block|,
literal|"unauth"
block|,
literal|"rx discard 'cuz port unauthorized"
block|}
block|,
define|#
directive|define
name|S_RX_BADKEYID
value|39
block|{
literal|5
block|,
literal|"rx_badkeyid"
block|,
literal|"badkeyid"
block|,
literal|"rx w/ incorrect keyid"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPREPLAY
value|40
block|{
literal|5
block|,
literal|"rx_ccmpreplay"
block|,
literal|"ccmpreplay"
block|,
literal|"rx seq# violation (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPFORMAT
value|41
block|{
literal|5
block|,
literal|"rx_ccmpformat"
block|,
literal|"ccmpformat"
block|,
literal|"rx format bad (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPMIC
value|42
block|{
literal|5
block|,
literal|"rx_ccmpmic"
block|,
literal|"ccmpmic"
block|,
literal|"rx MIC check failed (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPREPLAY
value|43
block|{
literal|5
block|,
literal|"rx_tkipreplay"
block|,
literal|"tkipreplay"
block|,
literal|"rx seq# violation (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPFORMAT
value|44
block|{
literal|5
block|,
literal|"rx_tkipformat"
block|,
literal|"tkipformat"
block|,
literal|"rx format bad (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPMIC
value|45
block|{
literal|5
block|,
literal|"rx_tkipmic"
block|,
literal|"tkipmic"
block|,
literal|"rx MIC check failed (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPICV
value|46
block|{
literal|5
block|,
literal|"rx_tkipicv"
block|,
literal|"tkipicv"
block|,
literal|"rx ICV check failed (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_BADCIPHER
value|47
block|{
literal|5
block|,
literal|"rx_badcipher"
block|,
literal|"badcipher"
block|,
literal|"rx failed 'cuz bad cipher/key type"
block|}
block|,
define|#
directive|define
name|S_RX_NOCIPHERCTX
value|48
block|{
literal|5
block|,
literal|"rx_nocipherctx"
block|,
literal|"nocipherctx"
block|,
literal|"rx failed 'cuz key/cipher ctx not setup"
block|}
block|,
define|#
directive|define
name|S_RX_ACL
value|49
block|{
literal|5
block|,
literal|"rx_acl"
block|,
literal|"acl"
block|,
literal|"rx discard 'cuz acl policy"
block|}
block|,
define|#
directive|define
name|S_TX_NOBUF
value|50
block|{
literal|5
block|,
literal|"tx_nobuf"
block|,
literal|"nobuf"
block|,
literal|"tx failed for lack of mbuf"
block|}
block|,
define|#
directive|define
name|S_TX_NONODE
value|51
block|{
literal|5
block|,
literal|"tx_nonode"
block|,
literal|"nonode"
block|,
literal|"tx failed for no node"
block|}
block|,
define|#
directive|define
name|S_TX_UNKNOWNMGT
value|52
block|{
literal|5
block|,
literal|"tx_unknownmgt"
block|,
literal|"unknownmgt"
block|,
literal|"tx of unknown mgt frame"
block|}
block|,
define|#
directive|define
name|S_TX_BADCIPHER
value|53
block|{
literal|5
block|,
literal|"tx_badcipher"
block|,
literal|"badcipher"
block|,
literal|"tx failed 'cuz bad ciper/key type"
block|}
block|,
define|#
directive|define
name|S_TX_NODEFKEY
value|54
block|{
literal|5
block|,
literal|"tx_nodefkey"
block|,
literal|"nodefkey"
block|,
literal|"tx failed 'cuz no defkey"
block|}
block|,
define|#
directive|define
name|S_TX_NOHEADROOM
value|55
block|{
literal|5
block|,
literal|"tx_noheadroom"
block|,
literal|"noheadroom"
block|,
literal|"tx failed 'cuz no space for crypto hdrs"
block|}
block|,
define|#
directive|define
name|S_TX_FRAGFRAMES
value|56
block|{
literal|5
block|,
literal|"tx_fragframes"
block|,
literal|"fragframes"
block|,
literal|"tx frames fragmented"
block|}
block|,
define|#
directive|define
name|S_TX_FRAGS
value|57
block|{
literal|5
block|,
literal|"tx_frags"
block|,
literal|"frags"
block|,
literal|"tx frags generated"
block|}
block|,
define|#
directive|define
name|S_SCAN_ACTIVE
value|58
block|{
literal|5
block|,
literal|"scan_active"
block|,
literal|"scan_active"
block|,
literal|"active scans started"
block|}
block|,
define|#
directive|define
name|S_SCAN_PASSIVE
value|59
block|{
literal|5
block|,
literal|"scan_passive"
block|,
literal|"scan_passive"
block|,
literal|"passive scans started"
block|}
block|,
define|#
directive|define
name|S_NODE_TIMEOUT
value|60
block|{
literal|5
block|,
literal|"node_timeout"
block|,
literal|"node_timeout"
block|,
literal|"nodes timed out inactivity"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_NOMEM
value|61
block|{
literal|5
block|,
literal|"crypto_nomem"
block|,
literal|"crypto_nomem"
block|,
literal|"cipher context malloc failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIP
value|62
block|{
literal|5
block|,
literal|"crypto_tkip"
block|,
literal|"crypto_tkip"
block|,
literal|"tkip crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPENMIC
value|63
block|{
literal|5
block|,
literal|"crypto_tkipenmic"
block|,
literal|"crypto_tkipenmic"
block|,
literal|"tkip tx MIC done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPDEMIC
value|64
block|{
literal|5
block|,
literal|"crypto_tkipdemic"
block|,
literal|"crypto_tkipdemic"
block|,
literal|"tkip rx MIC done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPCM
value|65
block|{
literal|5
block|,
literal|"crypto_tkipcm"
block|,
literal|"crypto_tkipcm"
block|,
literal|"tkip dropped frames 'cuz of countermeasures"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_CCMP
value|66
block|{
literal|5
block|,
literal|"crypto_ccmp"
block|,
literal|"crypto_ccmp"
block|,
literal|"ccmp crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_WEP
value|67
block|{
literal|5
block|,
literal|"crypto_wep"
block|,
literal|"crypto_wep"
block|,
literal|"wep crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SETKEY_CIPHER
value|68
block|{
literal|5
block|,
literal|"crypto_setkey_cipher"
block|,
literal|"crypto_setkey_cipher"
block|,
literal|"setkey failed 'cuz cipher rejected data"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SETKEY_NOKEY
value|69
block|{
literal|5
block|,
literal|"crypto_setkey_nokey"
block|,
literal|"crypto_setkey_nokey"
block|,
literal|"setkey failed 'cuz no key index"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_DELKEY
value|70
block|{
literal|5
block|,
literal|"crypto_delkey"
block|,
literal|"crypto_delkey"
block|,
literal|"driver key delete failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_BADCIPHER
value|71
block|{
literal|5
block|,
literal|"crypto_badcipher"
block|,
literal|"crypto_badcipher"
block|,
literal|"setkey failed 'cuz unknown cipher"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_NOCIPHER
value|72
block|{
literal|5
block|,
literal|"crypto_nocipher"
block|,
literal|"crypto_nocipher"
block|,
literal|"setkey failed 'cuz cipher module unavailable"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_ATTACHFAIL
value|73
block|{
literal|5
block|,
literal|"crypto_attachfail"
block|,
literal|"crypto_attachfail"
block|,
literal|"setkey failed 'cuz cipher attach failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SWFALLBACK
value|74
block|{
literal|5
block|,
literal|"crypto_swfallback"
block|,
literal|"crypto_swfallback"
block|,
literal|"crypto fell back to s/w implementation"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_KEYFAIL
value|75
block|{
literal|5
block|,
literal|"crypto_keyfail"
block|,
literal|"crypto_keyfail"
block|,
literal|"setkey failed 'cuz driver key alloc failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_ENMICFAIL
value|76
block|{
literal|5
block|,
literal|"crypto_enmicfail"
block|,
literal|"crypto_enmicfail"
block|,
literal|"enmic failed (may be mbuf exhaustion)"
block|}
block|,
define|#
directive|define
name|S_IBSS_CAPMISMATCH
value|77
block|{
literal|5
block|,
literal|"ibss_capmismatch"
block|,
literal|"ibss_capmismatch"
block|,
literal|"ibss merge faied 'cuz capabilities mismatch"
block|}
block|,
define|#
directive|define
name|S_IBSS_NORATE
value|78
block|{
literal|5
block|,
literal|"ibss_norate"
block|,
literal|"ibss_norate"
block|,
literal|"ibss merge faied 'cuz rate set mismatch"
block|}
block|,
define|#
directive|define
name|S_PS_UNASSOC
value|79
block|{
literal|5
block|,
literal|"ps_unassoc"
block|,
literal|"ps_unassoc"
block|,
literal|"ps-poll received for unassociated station"
block|}
block|,
define|#
directive|define
name|S_PS_BADAID
value|80
block|{
literal|5
block|,
literal|"ps_badaid"
block|,
literal|"ps_badaid"
block|,
literal|"ps-poll received with invalid association id"
block|}
block|,
define|#
directive|define
name|S_PS_QEMPTY
value|81
block|{
literal|5
block|,
literal|"ps_qempty"
block|,
literal|"ps_qempty"
block|,
literal|"ps-poll received with nothing to send"
block|}
block|,
define|#
directive|define
name|S_FF_BADHDR
value|82
block|{
literal|5
block|,
literal|"ff_badhdr"
block|,
literal|"ff_badhdr"
block|,
literal|"fast frame rx'd w/ bad hdr"
block|}
block|,
define|#
directive|define
name|S_FF_TOOSHORT
value|83
block|{
literal|5
block|,
literal|"ff_tooshort"
block|,
literal|"ff_tooshort"
block|,
literal|"fast frame rx decap error"
block|}
block|,
define|#
directive|define
name|S_FF_SPLIT
value|84
block|{
literal|5
block|,
literal|"ff_split"
block|,
literal|"ff_split"
block|,
literal|"fast frame rx split error"
block|}
block|,
define|#
directive|define
name|S_FF_DECAP
value|85
block|{
literal|5
block|,
literal|"ff_decap"
block|,
literal|"ff_decap"
block|,
literal|"fast frames decap'd"
block|}
block|,
define|#
directive|define
name|S_FF_ENCAP
value|86
block|{
literal|5
block|,
literal|"ff_encap"
block|,
literal|"ff_encap"
block|,
literal|"fast frames encap'd for tx"
block|}
block|,
define|#
directive|define
name|S_FF_ENCAPFAIL
value|87
block|{
literal|5
block|,
literal|"ff_encapfail"
block|,
literal|"ff_encapfail"
block|,
literal|"fast frames encap failed"
block|}
block|,
define|#
directive|define
name|S_RX_BADBINTVAL
value|88
block|{
literal|5
block|,
literal|"rx_badbintval"
block|,
literal|"rx_badbintval"
block|,
literal|"rx frame with bogus beacon interval"
block|}
block|,
define|#
directive|define
name|S_RX_MGMT
value|89
block|{
literal|5
block|,
literal|"rx_mgmt"
block|,
literal|"rx_mgmt"
block|,
literal|"rx management frames"
block|}
block|,
define|#
directive|define
name|S_RX_DEMICFAIL
value|90
block|{
literal|5
block|,
literal|"rx_demicfail"
block|,
literal|"rx_demicfail"
block|,
literal|"rx demic failed"
block|}
block|,
define|#
directive|define
name|S_RX_DEFRAG
value|91
block|{
literal|5
block|,
literal|"rx_defrag"
block|,
literal|"rx_defrag"
block|,
literal|"rx defragmentation failed"
block|}
block|,
define|#
directive|define
name|S_RX_ACTION
value|92
block|{
literal|5
block|,
literal|"rx_action"
block|,
literal|"rx_action"
block|,
literal|"rx action frames"
block|}
block|,
define|#
directive|define
name|S_AMSDU_TOOSHORT
value|93
block|{
literal|8
block|,
literal|"amsdu_tooshort"
block|,
literal|"amsdu_tooshort"
block|,
literal|"A-MSDU rx decap error"
block|}
block|,
define|#
directive|define
name|S_AMSDU_SPLIT
value|94
block|{
literal|8
block|,
literal|"amsdu_split"
block|,
literal|"amsdu_split"
block|,
literal|"A-MSDU rx failed on frame split"
block|}
block|,
define|#
directive|define
name|S_AMSDU_DECAP
value|95
block|{
literal|8
block|,
literal|"amsdu_decap"
block|,
literal|"amsdu_decap"
block|,
literal|"A-MSDU frames received"
block|}
block|,
define|#
directive|define
name|S_AMSDU_ENCAP
value|96
block|{
literal|8
block|,
literal|"amsdu_encap"
block|,
literal|"amsdu_encap"
block|,
literal|"A-MSDU frames transmitted"
block|}
block|,
define|#
directive|define
name|S_AMPDU_FLUSH
value|97
block|{
literal|8
block|,
literal|"ampdu_flush"
block|,
literal|"ampdu_flush"
block|,
literal|"A-MPDU frames flushed"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BARBAD
value|98
block|{
literal|8
block|,
literal|"ampdu_barbad"
block|,
literal|"ampdu_barbad"
block|,
literal|"A-MPDU BAR rx before ADDBA exchange"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BAROOW
value|99
block|{
literal|8
block|,
literal|"ampdu_baroow"
block|,
literal|"ampdu_baroow"
block|,
literal|"A-MPDU BAR rx out of BA window"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BAR
value|100
block|{
literal|8
block|,
literal|"ampdu_bar"
block|,
literal|"ampdu_bar"
block|,
literal|"A-MPDU BAR rx successful"
block|}
block|,
define|#
directive|define
name|S_AMPDU_OOR
value|101
block|{
literal|8
block|,
literal|"ampdu_oor"
block|,
literal|"ampdu_oor"
block|,
literal|"A-MPDU frames received out-of-order"
block|}
block|,
define|#
directive|define
name|S_AMPDU_COPY
value|102
block|{
literal|8
block|,
literal|"ampdu_copy"
block|,
literal|"ampdu_copy"
block|,
literal|"A-MPDU rx window slots copied"
block|}
block|,
define|#
directive|define
name|S_INPUT
value|103
block|{
literal|8
block|,
literal|"input"
block|,
literal|"input"
block|,
literal|"data frames received"
block|}
block|,
define|#
directive|define
name|S_OUTPUT
value|104
block|{
literal|8
block|,
literal|"output"
block|,
literal|"output"
block|,
literal|"data frames transmit"
block|}
block|,
define|#
directive|define
name|S_RATE
value|105
block|{
literal|4
block|,
literal|"rate"
block|,
literal|"rate"
block|,
literal|"current transmit rate"
block|}
block|,
define|#
directive|define
name|S_RSSI
value|106
block|{
literal|4
block|,
literal|"rssi"
block|,
literal|"rssi"
block|,
literal|"current rssi"
block|}
block|,
define|#
directive|define
name|S_NOISE
value|107
block|{
literal|4
block|,
literal|"noise"
block|,
literal|"noise"
block|,
literal|"current noise floor (dBm)"
block|}
block|,
define|#
directive|define
name|S_RX_UCAST
value|108
block|{
literal|8
block|,
literal|"rx_ucast"
block|,
literal|"rx_ucast"
block|,
literal|"unicast data frames received"
block|}
block|,
define|#
directive|define
name|S_RX_MCAST
value|109
block|{
literal|8
block|,
literal|"rx_mcast"
block|,
literal|"rx_mcast"
block|,
literal|"multicast data frames received"
block|}
block|,
define|#
directive|define
name|S_TX_UCAST
value|110
block|{
literal|8
block|,
literal|"tx_ucast"
block|,
literal|"tx_ucast"
block|,
literal|"unicast data frames sent"
block|}
block|,
define|#
directive|define
name|S_TX_MCAST
value|111
block|{
literal|8
block|,
literal|"tx_mcast"
block|,
literal|"tx_mcast"
block|,
literal|"multicast data frames sent"
block|}
block|,
define|#
directive|define
name|S_SIGNAL
value|112
block|{
literal|4
block|,
literal|"signal"
block|,
literal|"sig"
block|,
literal|"current signal (dBm)"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|wlanstatfoo_p
block|{
name|struct
name|wlanstatfoo
name|base
decl_stmt|;
name|int
name|s
decl_stmt|;
name|int
name|opmode
decl_stmt|;
name|uint8_t
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|ieee80211_stats
name|cur
decl_stmt|;
name|struct
name|ieee80211_stats
name|total
decl_stmt|;
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
union|union
block|{
name|struct
name|ieee80211req_sta_req
name|info
decl_stmt|;
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
block|}
name|u_info
union|;
name|struct
name|ieee80211req_sta_stats
name|ncur
decl_stmt|;
name|struct
name|ieee80211req_sta_stats
name|ntotal
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|wlan_setifname
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|,
specifier|const
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
name|strncpy
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|wlan_getifname
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
return|return
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_getopmode
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
if|if
condition|(
name|wf
operator|->
name|opmode
operator|==
operator|-
literal|1
condition|)
block|{
name|struct
name|ifmediareq
name|ifmr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCGIFMEDIA
argument_list|,
operator|&
name|ifmr
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (SIOCGIFMEDIA)"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_ADHOC
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_IBSS
expr_stmt|;
comment|/* XXX ahdemo */
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_HOSTAP
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_HOSTAP
expr_stmt|;
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_MONITOR
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_MONITOR
expr_stmt|;
else|else
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_STA
expr_stmt|;
block|}
return|return
name|wf
operator|->
name|opmode
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|getlladdr
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|)
block|{
specifier|const
name|struct
name|sockaddr_dl
modifier|*
name|sdl
decl_stmt|;
name|struct
name|ifaddrs
modifier|*
name|ifp
decl_stmt|,
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|getifaddrs
argument_list|(
operator|&
name|ifp
argument_list|)
operator|!=
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"getifaddrs"
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|ifp
init|;
name|p
operator|!=
name|NULL
condition|;
name|p
operator|=
name|p
operator|->
name|ifa_next
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|p
operator|->
name|ifa_name
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
operator|==
literal|0
operator|&&
name|p
operator|->
name|ifa_addr
operator|->
name|sa_family
operator|==
name|AF_LINK
condition|)
break|break;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"did not find link layer address for interface %s"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
name|sdl
operator|=
operator|(
specifier|const
expr|struct
name|sockaddr_dl
operator|*
operator|)
name|p
operator|->
name|ifa_addr
expr_stmt|;
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|mac
argument_list|,
name|LLADDR
argument_list|(
name|sdl
argument_list|)
argument_list|)
expr_stmt|;
name|freeifaddrs
argument_list|(
name|ifp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_setstamac
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
if|if
condition|(
name|mac
operator|==
name|NULL
condition|)
block|{
switch|switch
condition|(
name|wlan_getopmode
argument_list|(
name|wf0
argument_list|)
condition|)
block|{
case|case
name|IEEE80211_M_HOSTAP
case|:
case|case
name|IEEE80211_M_MONITOR
case|:
case|case
name|IEEE80211_M_IBSS
case|:
case|case
name|IEEE80211_M_AHDEMO
case|:
name|getlladdr
argument_list|(
name|wf
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_M_STA
case|:
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_BSSID
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
name|wf
operator|->
name|mac
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
name|IEEE80211_ADDR_LEN
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (IEEE80211_IOC_BSSID)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|mac
argument_list|,
name|mac
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* XXX only fetch what's needed to do reports */
end_comment

begin_function
specifier|static
name|void
name|wlan_collect
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|,
name|struct
name|ieee80211_stats
modifier|*
name|stats
parameter_list|,
name|struct
name|ieee80211req_sta_stats
modifier|*
name|nstats
parameter_list|)
block|{
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|u_info
operator|.
name|info
operator|.
name|is_u
operator|.
name|macaddr
argument_list|,
name|wf
operator|->
name|mac
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_STA_INFO
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|wf
operator|->
name|u_info
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|u_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (IEEE80211_IOC_STA_INFO)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
expr_stmt|;
name|IEEE80211_ADDR_COPY
argument_list|(
name|nstats
operator|->
name|is_u
operator|.
name|macaddr
argument_list|,
name|wf
operator|->
name|mac
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_STA_STATS
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
operator|(
name|caddr_t
operator|)
name|nstats
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
sizeof|sizeof
argument_list|(
operator|*
name|nstats
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (IEEE80211_IOC_STA_STATS)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
name|stats
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211STATS
argument_list|,
operator|&
name|wf
operator|->
name|ifr
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (SIOCG80211STATS)"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_collect_cur
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wlan_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|cur
argument_list|,
operator|&
name|wf
operator|->
name|ncur
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_collect_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wlan_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|total
argument_list|,
operator|&
name|wf
operator|->
name|ntotal
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_update_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wf
operator|->
name|total
operator|=
name|wf
operator|->
name|cur
expr_stmt|;
name|wf
operator|->
name|ntotal
operator|=
name|wf
operator|->
name|ncur
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_getinfo
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
init|=
operator|&
name|wf
operator|->
name|u_info
operator|.
name|info
operator|.
name|info
index|[
literal|0
index|]
decl_stmt|;
name|uint8_t
name|r
decl_stmt|;
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RATE
case|:
name|r
operator|=
name|si
operator|->
name|isi_rates
index|[
name|si
operator|->
name|isi_txrate
index|]
expr_stmt|;
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%uM"
argument_list|,
operator|(
name|r
operator|&
operator|~
literal|0x80
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RSSI
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_rssi
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_NOISE
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_SIGNAL
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_rssi
operator|+
name|si
operator|->
name|isi_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|b
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_get_curstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.is_##x - wf->total.is_##x); return 1
define|#
directive|define
name|NSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", \ 	    wf->ncur.is_stats.ns_##x - wf->ntotal.is_stats.ns_##x); \ 	    return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RX_BADVERSION
case|:
name|STAT
argument_list|(
name|rx_badversion
argument_list|)
expr_stmt|;
case|case
name|S_RX_TOOSHORT
case|:
name|STAT
argument_list|(
name|rx_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGBSS
case|:
name|STAT
argument_list|(
name|rx_wrongbss
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUP
case|:
name|STAT
argument_list|(
name|rx_dup
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGDIR
case|:
name|STAT
argument_list|(
name|rx_wrongdir
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCASTECHO
case|:
name|STAT
argument_list|(
name|rx_mcastecho
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOTASSOC
case|:
name|STAT
argument_list|(
name|rx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOPRIVACY
case|:
name|STAT
argument_list|(
name|rx_noprivacy
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNENCRYPTED
case|:
name|STAT
argument_list|(
name|rx_unencrypted
argument_list|)
expr_stmt|;
case|case
name|S_RX_WEPFAIL
case|:
name|STAT
argument_list|(
name|rx_wepfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECAP
case|:
name|STAT
argument_list|(
name|rx_decap
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGTDISCARD
case|:
name|STAT
argument_list|(
name|rx_mgtdiscard
argument_list|)
expr_stmt|;
case|case
name|S_RX_CTL
case|:
name|STAT
argument_list|(
name|rx_ctl
argument_list|)
expr_stmt|;
case|case
name|S_RX_BEACON
case|:
name|STAT
argument_list|(
name|rx_beacon
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSTOOBIG
case|:
name|STAT
argument_list|(
name|rx_rstoobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_MISSING
case|:
name|STAT
argument_list|(
name|rx_elem_missing
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOBIG
case|:
name|STAT
argument_list|(
name|rx_elem_toobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOSMALL
case|:
name|STAT
argument_list|(
name|rx_elem_toosmall
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_UNKNOWN
case|:
name|STAT
argument_list|(
name|rx_elem_unknown
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCHAN
case|:
name|STAT
argument_list|(
name|rx_badchan
argument_list|)
expr_stmt|;
case|case
name|S_RX_CHANMISMATCH
case|:
name|STAT
argument_list|(
name|rx_chanmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODEALLOC
case|:
name|STAT
argument_list|(
name|rx_nodealloc
argument_list|)
expr_stmt|;
case|case
name|S_RX_SSIDMISMATCH
case|:
name|STAT
argument_list|(
name|rx_ssidmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_UNSUPPORTED
case|:
name|STAT
argument_list|(
name|rx_auth_unsupported
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_FAIL
case|:
name|STAT
argument_list|(
name|rx_auth_fail
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_COUNTERMEASURES
case|:
name|STAT
argument_list|(
name|rx_auth_countermeasures
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BSS
case|:
name|STAT
argument_list|(
name|rx_assoc_bss
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NOTAUTH
case|:
name|STAT
argument_list|(
name|rx_assoc_notauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|rx_assoc_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|rx_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BADWPAIE
case|:
name|STAT
argument_list|(
name|rx_assoc_badwpaie
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEAUTH
case|:
name|STAT
argument_list|(
name|rx_deauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_DISASSOC
case|:
name|STAT
argument_list|(
name|rx_disassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADSUBTYPE
case|:
name|STAT
argument_list|(
name|rx_badsubtype
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOBUF
case|:
name|STAT
argument_list|(
name|rx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECRYPTCRC
case|:
name|STAT
argument_list|(
name|rx_decryptcrc
argument_list|)
expr_stmt|;
case|case
name|S_RX_AHDEMO_MGT
case|:
name|STAT
argument_list|(
name|rx_ahdemo_mgt
argument_list|)
expr_stmt|;
case|case
name|S_RX_BAD_AUTH
case|:
name|STAT
argument_list|(
name|rx_bad_auth
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNAUTH
case|:
name|STAT
argument_list|(
name|rx_unauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADKEYID
case|:
name|STAT
argument_list|(
name|rx_badkeyid
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPREPLAY
case|:
name|STAT
argument_list|(
name|rx_ccmpreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPFORMAT
case|:
name|STAT
argument_list|(
name|rx_ccmpformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPMIC
case|:
name|STAT
argument_list|(
name|rx_ccmpmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPREPLAY
case|:
name|STAT
argument_list|(
name|rx_tkipreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPFORMAT
case|:
name|STAT
argument_list|(
name|rx_tkipformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPICV
case|:
name|STAT
argument_list|(
name|rx_tkipicv
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCIPHER
case|:
name|STAT
argument_list|(
name|rx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOCIPHERCTX
case|:
name|STAT
argument_list|(
name|rx_nocipherctx
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACL
case|:
name|STAT
argument_list|(
name|rx_acl
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOBUF
case|:
name|STAT
argument_list|(
name|tx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_NONODE
case|:
name|STAT
argument_list|(
name|tx_nonode
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNKNOWNMGT
case|:
name|STAT
argument_list|(
name|tx_unknownmgt
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADCIPHER
case|:
name|STAT
argument_list|(
name|tx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODEFKEY
case|:
name|STAT
argument_list|(
name|tx_nodefkey
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGFRAMES
case|:
name|STAT
argument_list|(
name|tx_fragframes
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|STAT
argument_list|(
name|tx_frags
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_ACTIVE
case|:
name|STAT
argument_list|(
name|scan_active
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_PASSIVE
case|:
name|STAT
argument_list|(
name|scan_passive
argument_list|)
expr_stmt|;
case|case
name|S_NODE_TIMEOUT
case|:
name|STAT
argument_list|(
name|node_timeout
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOMEM
case|:
name|STAT
argument_list|(
name|crypto_nomem
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIP
case|:
name|STAT
argument_list|(
name|crypto_tkip
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPENMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipenmic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPDEMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipdemic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPCM
case|:
name|STAT
argument_list|(
name|crypto_tkipcm
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_CCMP
case|:
name|STAT
argument_list|(
name|crypto_ccmp
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_WEP
case|:
name|STAT
argument_list|(
name|crypto_wep
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_CIPHER
case|:
name|STAT
argument_list|(
name|crypto_setkey_cipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_NOKEY
case|:
name|STAT
argument_list|(
name|crypto_setkey_nokey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_DELKEY
case|:
name|STAT
argument_list|(
name|crypto_delkey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_BADCIPHER
case|:
name|STAT
argument_list|(
name|crypto_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOCIPHER
case|:
name|STAT
argument_list|(
name|crypto_nocipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ATTACHFAIL
case|:
name|STAT
argument_list|(
name|crypto_attachfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SWFALLBACK
case|:
name|STAT
argument_list|(
name|crypto_swfallback
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_KEYFAIL
case|:
name|STAT
argument_list|(
name|crypto_keyfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ENMICFAIL
case|:
name|STAT
argument_list|(
name|crypto_enmicfail
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|ibss_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_NORATE
case|:
name|STAT
argument_list|(
name|ibss_norate
argument_list|)
expr_stmt|;
case|case
name|S_PS_UNASSOC
case|:
name|STAT
argument_list|(
name|ps_unassoc
argument_list|)
expr_stmt|;
case|case
name|S_PS_BADAID
case|:
name|STAT
argument_list|(
name|ps_badaid
argument_list|)
expr_stmt|;
case|case
name|S_PS_QEMPTY
case|:
name|STAT
argument_list|(
name|ps_qempty
argument_list|)
expr_stmt|;
case|case
name|S_FF_BADHDR
case|:
name|STAT
argument_list|(
name|ff_badhdr
argument_list|)
expr_stmt|;
case|case
name|S_FF_TOOSHORT
case|:
name|STAT
argument_list|(
name|ff_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_FF_SPLIT
case|:
name|STAT
argument_list|(
name|ff_split
argument_list|)
expr_stmt|;
case|case
name|S_FF_DECAP
case|:
name|STAT
argument_list|(
name|ff_decap
argument_list|)
expr_stmt|;
case|case
name|S_FF_ENCAP
case|:
name|STAT
argument_list|(
name|ff_encap
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADBINTVAL
case|:
name|STAT
argument_list|(
name|rx_badbintval
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGMT
case|:
name|STAT
argument_list|(
name|rx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEMICFAIL
case|:
name|STAT
argument_list|(
name|rx_demicfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEFRAG
case|:
name|STAT
argument_list|(
name|rx_defrag
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACTION
case|:
name|STAT
argument_list|(
name|rx_action
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_TOOSHORT
case|:
name|STAT
argument_list|(
name|amsdu_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_SPLIT
case|:
name|STAT
argument_list|(
name|amsdu_split
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_DECAP
case|:
name|STAT
argument_list|(
name|amsdu_decap
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_ENCAP
case|:
name|STAT
argument_list|(
name|amsdu_encap
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_FLUSH
case|:
name|STAT
argument_list|(
name|ampdu_rx_flush
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARBAD
case|:
name|STAT
argument_list|(
name|ampdu_bar_bad
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAROOW
case|:
name|STAT
argument_list|(
name|ampdu_bar_oow
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAR
case|:
name|STAT
argument_list|(
name|ampdu_bar_rx
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_OOR
case|:
name|STAT
argument_list|(
name|ampdu_rx_oor
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_COPY
case|:
name|STAT
argument_list|(
name|ampdu_rx_copy
argument_list|)
expr_stmt|;
case|case
name|S_INPUT
case|:
name|NSTAT
argument_list|(
name|rx_data
argument_list|)
expr_stmt|;
case|case
name|S_OUTPUT
case|:
name|NSTAT
argument_list|(
name|tx_data
argument_list|)
expr_stmt|;
case|case
name|S_RX_UCAST
case|:
name|NSTAT
argument_list|(
name|rx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|NSTAT
argument_list|(
name|rx_mcast
argument_list|)
expr_stmt|;
case|case
name|S_TX_UCAST
case|:
name|NSTAT
argument_list|(
name|tx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|NSTAT
argument_list|(
name|tx_mcast
argument_list|)
expr_stmt|;
block|}
return|return
name|wlan_getinfo
argument_list|(
name|wf
argument_list|,
name|s
argument_list|,
name|b
argument_list|,
name|bs
argument_list|)
return|;
undef|#
directive|undef
name|NSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_get_totstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.is_##x); return 1
define|#
directive|define
name|NSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->ntotal.is_stats.ns_##x); return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RX_BADVERSION
case|:
name|STAT
argument_list|(
name|rx_badversion
argument_list|)
expr_stmt|;
case|case
name|S_RX_TOOSHORT
case|:
name|STAT
argument_list|(
name|rx_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGBSS
case|:
name|STAT
argument_list|(
name|rx_wrongbss
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUP
case|:
name|STAT
argument_list|(
name|rx_dup
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGDIR
case|:
name|STAT
argument_list|(
name|rx_wrongdir
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCASTECHO
case|:
name|STAT
argument_list|(
name|rx_mcastecho
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOTASSOC
case|:
name|STAT
argument_list|(
name|rx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOPRIVACY
case|:
name|STAT
argument_list|(
name|rx_noprivacy
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNENCRYPTED
case|:
name|STAT
argument_list|(
name|rx_unencrypted
argument_list|)
expr_stmt|;
case|case
name|S_RX_WEPFAIL
case|:
name|STAT
argument_list|(
name|rx_wepfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECAP
case|:
name|STAT
argument_list|(
name|rx_decap
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGTDISCARD
case|:
name|STAT
argument_list|(
name|rx_mgtdiscard
argument_list|)
expr_stmt|;
case|case
name|S_RX_CTL
case|:
name|STAT
argument_list|(
name|rx_ctl
argument_list|)
expr_stmt|;
case|case
name|S_RX_BEACON
case|:
name|STAT
argument_list|(
name|rx_beacon
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSTOOBIG
case|:
name|STAT
argument_list|(
name|rx_rstoobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_MISSING
case|:
name|STAT
argument_list|(
name|rx_elem_missing
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOBIG
case|:
name|STAT
argument_list|(
name|rx_elem_toobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOSMALL
case|:
name|STAT
argument_list|(
name|rx_elem_toosmall
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_UNKNOWN
case|:
name|STAT
argument_list|(
name|rx_elem_unknown
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCHAN
case|:
name|STAT
argument_list|(
name|rx_badchan
argument_list|)
expr_stmt|;
case|case
name|S_RX_CHANMISMATCH
case|:
name|STAT
argument_list|(
name|rx_chanmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODEALLOC
case|:
name|STAT
argument_list|(
name|rx_nodealloc
argument_list|)
expr_stmt|;
case|case
name|S_RX_SSIDMISMATCH
case|:
name|STAT
argument_list|(
name|rx_ssidmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_UNSUPPORTED
case|:
name|STAT
argument_list|(
name|rx_auth_unsupported
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_FAIL
case|:
name|STAT
argument_list|(
name|rx_auth_fail
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_COUNTERMEASURES
case|:
name|STAT
argument_list|(
name|rx_auth_countermeasures
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BSS
case|:
name|STAT
argument_list|(
name|rx_assoc_bss
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NOTAUTH
case|:
name|STAT
argument_list|(
name|rx_assoc_notauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|rx_assoc_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|rx_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BADWPAIE
case|:
name|STAT
argument_list|(
name|rx_assoc_badwpaie
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEAUTH
case|:
name|STAT
argument_list|(
name|rx_deauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_DISASSOC
case|:
name|STAT
argument_list|(
name|rx_disassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADSUBTYPE
case|:
name|STAT
argument_list|(
name|rx_badsubtype
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOBUF
case|:
name|STAT
argument_list|(
name|rx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECRYPTCRC
case|:
name|STAT
argument_list|(
name|rx_decryptcrc
argument_list|)
expr_stmt|;
case|case
name|S_RX_AHDEMO_MGT
case|:
name|STAT
argument_list|(
name|rx_ahdemo_mgt
argument_list|)
expr_stmt|;
case|case
name|S_RX_BAD_AUTH
case|:
name|STAT
argument_list|(
name|rx_bad_auth
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNAUTH
case|:
name|STAT
argument_list|(
name|rx_unauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADKEYID
case|:
name|STAT
argument_list|(
name|rx_badkeyid
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPREPLAY
case|:
name|STAT
argument_list|(
name|rx_ccmpreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPFORMAT
case|:
name|STAT
argument_list|(
name|rx_ccmpformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPMIC
case|:
name|STAT
argument_list|(
name|rx_ccmpmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPREPLAY
case|:
name|STAT
argument_list|(
name|rx_tkipreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPFORMAT
case|:
name|STAT
argument_list|(
name|rx_tkipformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPICV
case|:
name|STAT
argument_list|(
name|rx_tkipicv
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCIPHER
case|:
name|STAT
argument_list|(
name|rx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOCIPHERCTX
case|:
name|STAT
argument_list|(
name|rx_nocipherctx
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACL
case|:
name|STAT
argument_list|(
name|rx_acl
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOBUF
case|:
name|STAT
argument_list|(
name|tx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_NONODE
case|:
name|STAT
argument_list|(
name|tx_nonode
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNKNOWNMGT
case|:
name|STAT
argument_list|(
name|tx_unknownmgt
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADCIPHER
case|:
name|STAT
argument_list|(
name|tx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODEFKEY
case|:
name|STAT
argument_list|(
name|tx_nodefkey
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGFRAMES
case|:
name|STAT
argument_list|(
name|tx_fragframes
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|STAT
argument_list|(
name|tx_frags
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_ACTIVE
case|:
name|STAT
argument_list|(
name|scan_active
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_PASSIVE
case|:
name|STAT
argument_list|(
name|scan_passive
argument_list|)
expr_stmt|;
case|case
name|S_NODE_TIMEOUT
case|:
name|STAT
argument_list|(
name|node_timeout
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOMEM
case|:
name|STAT
argument_list|(
name|crypto_nomem
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIP
case|:
name|STAT
argument_list|(
name|crypto_tkip
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPENMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipenmic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPDEMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipdemic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPCM
case|:
name|STAT
argument_list|(
name|crypto_tkipcm
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_CCMP
case|:
name|STAT
argument_list|(
name|crypto_ccmp
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_WEP
case|:
name|STAT
argument_list|(
name|crypto_wep
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_CIPHER
case|:
name|STAT
argument_list|(
name|crypto_setkey_cipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_NOKEY
case|:
name|STAT
argument_list|(
name|crypto_setkey_nokey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_DELKEY
case|:
name|STAT
argument_list|(
name|crypto_delkey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_BADCIPHER
case|:
name|STAT
argument_list|(
name|crypto_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOCIPHER
case|:
name|STAT
argument_list|(
name|crypto_nocipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ATTACHFAIL
case|:
name|STAT
argument_list|(
name|crypto_attachfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SWFALLBACK
case|:
name|STAT
argument_list|(
name|crypto_swfallback
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_KEYFAIL
case|:
name|STAT
argument_list|(
name|crypto_keyfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ENMICFAIL
case|:
name|STAT
argument_list|(
name|crypto_enmicfail
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|ibss_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_NORATE
case|:
name|STAT
argument_list|(
name|ibss_norate
argument_list|)
expr_stmt|;
case|case
name|S_PS_UNASSOC
case|:
name|STAT
argument_list|(
name|ps_unassoc
argument_list|)
expr_stmt|;
case|case
name|S_PS_BADAID
case|:
name|STAT
argument_list|(
name|ps_badaid
argument_list|)
expr_stmt|;
case|case
name|S_PS_QEMPTY
case|:
name|STAT
argument_list|(
name|ps_qempty
argument_list|)
expr_stmt|;
case|case
name|S_FF_BADHDR
case|:
name|STAT
argument_list|(
name|ff_badhdr
argument_list|)
expr_stmt|;
case|case
name|S_FF_TOOSHORT
case|:
name|STAT
argument_list|(
name|ff_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_FF_SPLIT
case|:
name|STAT
argument_list|(
name|ff_split
argument_list|)
expr_stmt|;
case|case
name|S_FF_DECAP
case|:
name|STAT
argument_list|(
name|ff_decap
argument_list|)
expr_stmt|;
case|case
name|S_FF_ENCAP
case|:
name|STAT
argument_list|(
name|ff_encap
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADBINTVAL
case|:
name|STAT
argument_list|(
name|rx_badbintval
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGMT
case|:
name|STAT
argument_list|(
name|rx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEMICFAIL
case|:
name|STAT
argument_list|(
name|rx_demicfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEFRAG
case|:
name|STAT
argument_list|(
name|rx_defrag
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACTION
case|:
name|STAT
argument_list|(
name|rx_action
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_TOOSHORT
case|:
name|STAT
argument_list|(
name|amsdu_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_SPLIT
case|:
name|STAT
argument_list|(
name|amsdu_split
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_DECAP
case|:
name|STAT
argument_list|(
name|amsdu_decap
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_ENCAP
case|:
name|STAT
argument_list|(
name|amsdu_encap
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_FLUSH
case|:
name|STAT
argument_list|(
name|ampdu_rx_flush
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARBAD
case|:
name|STAT
argument_list|(
name|ampdu_bar_bad
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAROOW
case|:
name|STAT
argument_list|(
name|ampdu_bar_oow
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAR
case|:
name|STAT
argument_list|(
name|ampdu_bar_rx
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_OOR
case|:
name|STAT
argument_list|(
name|ampdu_rx_oor
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_COPY
case|:
name|STAT
argument_list|(
name|ampdu_rx_copy
argument_list|)
expr_stmt|;
case|case
name|S_INPUT
case|:
name|NSTAT
argument_list|(
name|rx_data
argument_list|)
expr_stmt|;
case|case
name|S_OUTPUT
case|:
name|NSTAT
argument_list|(
name|tx_data
argument_list|)
expr_stmt|;
case|case
name|S_RX_UCAST
case|:
name|NSTAT
argument_list|(
name|rx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|NSTAT
argument_list|(
name|rx_mcast
argument_list|)
expr_stmt|;
case|case
name|S_TX_UCAST
case|:
name|NSTAT
argument_list|(
name|tx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|NSTAT
argument_list|(
name|tx_mcast
argument_list|)
expr_stmt|;
block|}
return|return
name|wlan_getinfo
argument_list|(
name|wf
argument_list|,
name|s
argument_list|,
name|b
argument_list|,
name|bs
argument_list|)
return|;
undef|#
directive|undef
name|NSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_macro
name|STATFOO_DEFINE_BOUNCE
argument_list|(
argument|wlanstatfoo
argument_list|)
end_macro

begin_function
name|struct
name|wlanstatfoo
modifier|*
name|wlanstats_new
parameter_list|(
specifier|const
name|char
modifier|*
name|ifname
parameter_list|,
specifier|const
name|char
modifier|*
name|fmtstring
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a) / sizeof(a[0]))
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
decl_stmt|;
name|wf
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wlanstatfoo_p
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|!=
name|NULL
condition|)
block|{
name|statfoo_init
argument_list|(
operator|&
name|wf
operator|->
name|base
operator|.
name|base
argument_list|,
literal|"wlanstats"
argument_list|,
name|wlanstats
argument_list|,
name|N
argument_list|(
name|wlanstats
argument_list|)
argument_list|)
expr_stmt|;
comment|/* override base methods */
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_cur
operator|=
name|wlan_collect_cur
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_tot
operator|=
name|wlan_collect_tot
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_curstat
operator|=
name|wlan_get_curstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_totstat
operator|=
name|wlan_get_totstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|update_tot
operator|=
name|wlan_update_tot
expr_stmt|;
comment|/* setup bounce functions for public methods */
name|STATFOO_BOUNCE
argument_list|(
name|wf
argument_list|,
name|wlanstatfoo
argument_list|)
expr_stmt|;
comment|/* setup our public methods */
name|wf
operator|->
name|base
operator|.
name|setifname
operator|=
name|wlan_setifname
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|getifname
operator|=
name|wlan_getifname
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|getopmode
operator|=
name|wlan_getopmode
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|setstamac
operator|=
name|wlan_setstamac
expr_stmt|;
name|wf
operator|->
name|opmode
operator|=
operator|-
literal|1
expr_stmt|;
name|wf
operator|->
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|->
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
name|wlan_setifname
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|setfmt
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|fmtstring
argument_list|)
expr_stmt|;
block|}
return|return
operator|&
name|wf
operator|->
name|base
return|;
undef|#
directive|undef
name|N
block|}
end_function

end_unit

