begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002-2007 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*  * net80211 statistics class.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<ifaddrs.h>
end_include

begin_include
include|#
directive|include
file|"../../../../sys/net80211/ieee80211_ioctl.h"
end_include

begin_include
include|#
directive|include
file|"wlanstats.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|IEEE80211_ADDR_COPY
end_ifndef

begin_define
define|#
directive|define
name|IEEE80211_ADDR_COPY
parameter_list|(
name|dst
parameter_list|,
name|src
parameter_list|)
value|memcpy(dst, src, IEEE80211_ADDR_LEN)
end_define

begin_define
define|#
directive|define
name|IEEE80211_ADDR_EQ
parameter_list|(
name|a1
parameter_list|,
name|a2
parameter_list|)
value|(memcmp(a1,a2,IEEE80211_ADDR_LEN) == 0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|AFTER
parameter_list|(
name|prev
parameter_list|)
value|((prev)+1)
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|fmt
name|wlanstats
index|[]
init|=
block|{
define|#
directive|define
name|S_RX_BADVERSION
value|0
block|{
literal|5
block|,
literal|"rx_badversion"
block|,
literal|"bvers"
block|,
literal|"rx frame with bad version"
block|}
block|,
define|#
directive|define
name|S_RX_TOOSHORT
value|AFTER(S_RX_BADVERSION)
block|{
literal|5
block|,
literal|"rx_tooshort"
block|,
literal|"2short"
block|,
literal|"rx frame too short"
block|}
block|,
define|#
directive|define
name|S_RX_WRONGBSS
value|AFTER(S_RX_TOOSHORT)
block|{
literal|5
block|,
literal|"rx_wrongbss"
block|,
literal|"wrbss"
block|,
literal|"rx from wrong bssid"
block|}
block|,
define|#
directive|define
name|S_RX_DUP
value|AFTER(S_RX_WRONGBSS)
block|{
literal|5
block|,
literal|"rx_dup"
block|,
literal|"rxdup"
block|,
literal|"rx discard 'cuz dup"
block|}
block|,
define|#
directive|define
name|S_RX_WRONGDIR
value|AFTER(S_RX_DUP)
block|{
literal|5
block|,
literal|"rx_wrongdir"
block|,
literal|"wrdir"
block|,
literal|"rx w/ wrong direction"
block|}
block|,
define|#
directive|define
name|S_RX_MCASTECHO
value|AFTER(S_RX_WRONGDIR)
block|{
literal|5
block|,
literal|"rx_mcastecho"
block|,
literal|"mecho"
block|,
literal|"rx discard 'cuz mcast echo"
block|}
block|,
define|#
directive|define
name|S_RX_NOTASSOC
value|AFTER(S_RX_MCASTECHO)
block|{
literal|6
block|,
literal|"rx_notassoc"
block|,
literal|"!assoc"
block|,
literal|"rx discard 'cuz sta !assoc"
block|}
block|,
define|#
directive|define
name|S_RX_NOPRIVACY
value|AFTER(S_RX_NOTASSOC)
block|{
literal|6
block|,
literal|"rx_noprivacy"
block|,
literal|"nopriv"
block|,
literal|"rx w/ wep but privacy off"
block|}
block|,
define|#
directive|define
name|S_RX_UNENCRYPTED
value|AFTER(S_RX_NOPRIVACY)
block|{
literal|6
block|,
literal|"rx_unencrypted"
block|,
literal|"unencr"
block|,
literal|"rx w/o wep and privacy on"
block|}
block|,
define|#
directive|define
name|S_RX_WEPFAIL
value|AFTER(S_RX_UNENCRYPTED)
block|{
literal|7
block|,
literal|"rx_wepfail"
block|,
literal|"wepfail"
block|,
literal|"rx wep processing failed"
block|}
block|,
define|#
directive|define
name|S_RX_DECAP
value|AFTER(S_RX_WEPFAIL)
block|{
literal|5
block|,
literal|"rx_decap"
block|,
literal|"decap"
block|,
literal|"rx decapsulation failed"
block|}
block|,
define|#
directive|define
name|S_RX_MGTDISCARD
value|AFTER(S_RX_DECAP)
block|{
literal|8
block|,
literal|"rx_mgtdiscard"
block|,
literal|"mgtdiscard"
block|,
literal|"rx discard mgt frames"
block|}
block|,
define|#
directive|define
name|S_RX_CTL
value|AFTER(S_RX_MGTDISCARD)
block|{
literal|5
block|,
literal|"rx_ctl"
block|,
literal|"ctl"
block|,
literal|"rx ctrl frames"
block|}
block|,
define|#
directive|define
name|S_RX_BEACON
value|AFTER(S_RX_CTL)
block|{
literal|6
block|,
literal|"rx_beacon"
block|,
literal|"beacon"
block|,
literal|"rx beacon frames"
block|}
block|,
define|#
directive|define
name|S_RX_RSTOOBIG
value|AFTER(S_RX_BEACON)
block|{
literal|6
block|,
literal|"rx_rstoobig"
block|,
literal|"rs2big"
block|,
literal|"rx rate set truncated"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_MISSING
value|AFTER(S_RX_RSTOOBIG)
block|{
literal|6
block|,
literal|"rx_elem_missing"
block|,
literal|"iemiss"
block|,
literal|"rx required element missing"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_TOOBIG
value|AFTER(S_RX_ELEM_MISSING)
block|{
literal|6
block|,
literal|"rx_elem_toobig"
block|,
literal|"ie2big"
block|,
literal|"rx element too big"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_TOOSMALL
value|AFTER(S_RX_ELEM_TOOBIG)
block|{
literal|7
block|,
literal|"rx_elem_toosmall"
block|,
literal|"ie2small"
block|,
literal|"rx element too small"
block|}
block|,
define|#
directive|define
name|S_RX_ELEM_UNKNOWN
value|AFTER(S_RX_ELEM_TOOSMALL)
block|{
literal|5
block|,
literal|"rx_elem_unknown"
block|,
literal|"ieunk"
block|,
literal|"rx element unknown"
block|}
block|,
define|#
directive|define
name|S_RX_BADCHAN
value|AFTER(S_RX_ELEM_UNKNOWN)
block|{
literal|6
block|,
literal|"rx_badchan"
block|,
literal|"badchan"
block|,
literal|"rx frame w/ invalid chan"
block|}
block|,
define|#
directive|define
name|S_RX_CHANMISMATCH
value|AFTER(S_RX_BADCHAN)
block|{
literal|5
block|,
literal|"rx_chanmismatch"
block|,
literal|"chanmismatch"
block|,
literal|"rx frame chan mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_NODEALLOC
value|AFTER(S_RX_CHANMISMATCH)
block|{
literal|5
block|,
literal|"rx_nodealloc"
block|,
literal|"nodealloc"
block|,
literal|"nodes allocated (rx)"
block|}
block|,
define|#
directive|define
name|S_RX_SSIDMISMATCH
value|AFTER(S_RX_NODEALLOC)
block|{
literal|5
block|,
literal|"rx_ssidmismatch"
block|,
literal|"ssidmismatch"
block|,
literal|"rx frame ssid mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_UNSUPPORTED
value|AFTER(S_RX_SSIDMISMATCH)
block|{
literal|5
block|,
literal|"rx_auth_unsupported"
block|,
literal|"auth_unsupported"
block|,
literal|"rx w/ unsupported auth alg"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_FAIL
value|AFTER(S_RX_AUTH_UNSUPPORTED)
block|{
literal|5
block|,
literal|"rx_auth_fail"
block|,
literal|"auth_fail"
block|,
literal|"rx sta auth failure"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_FAIL_CODE
value|AFTER(S_RX_AUTH_FAIL)
block|{
literal|5
block|,
literal|"rx_auth_fail_code"
block|,
literal|"auth_fail_code"
block|,
literal|"last rx auth failure reason"
block|}
block|,
define|#
directive|define
name|S_RX_AUTH_COUNTERMEASURES
value|AFTER(S_RX_AUTH_FAIL_CODE)
block|{
literal|5
block|,
literal|"rx_auth_countermeasures"
block|,
literal|"auth_countermeasures"
block|,
literal|"rx sta auth failure 'cuz of TKIP countermeasures"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_BSS
value|AFTER(S_RX_AUTH_COUNTERMEASURES)
block|{
literal|5
block|,
literal|"rx_assoc_bss"
block|,
literal|"assoc_bss"
block|,
literal|"rx assoc from wrong bssid"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_NOTAUTH
value|AFTER(S_RX_ASSOC_BSS)
block|{
literal|5
block|,
literal|"rx_assoc_notauth"
block|,
literal|"assoc_notauth"
block|,
literal|"rx assoc w/o auth"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_CAPMISMATCH
value|AFTER(S_RX_ASSOC_NOTAUTH)
block|{
literal|5
block|,
literal|"rx_assoc_capmismatch"
block|,
literal|"assoc_capmismatch"
block|,
literal|"rx assoc w/ cap mismatch"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_NORATE
value|AFTER(S_RX_ASSOC_CAPMISMATCH)
block|{
literal|5
block|,
literal|"rx_assoc_norate"
block|,
literal|"assoc_norate"
block|,
literal|"rx assoc w/ no rate match"
block|}
block|,
define|#
directive|define
name|S_RX_ASSOC_BADWPAIE
value|AFTER(S_RX_ASSOC_NORATE)
block|{
literal|5
block|,
literal|"rx_assoc_badwpaie"
block|,
literal|"assoc_badwpaie"
block|,
literal|"rx assoc w/ bad WPA IE"
block|}
block|,
define|#
directive|define
name|S_RX_DEAUTH
value|AFTER(S_RX_ASSOC_BADWPAIE)
block|{
literal|5
block|,
literal|"rx_deauth"
block|,
literal|"deauth"
block|,
literal|"rx deauthentication"
block|}
block|,
define|#
directive|define
name|S_RX_DEAUTH_CODE
value|AFTER(S_RX_DEAUTH)
block|{
literal|5
block|,
literal|"rx_deauth_code"
block|,
literal|"deauth_code"
block|,
literal|"last rx deauth reason"
block|}
block|,
define|#
directive|define
name|S_RX_DISASSOC
value|AFTER(S_RX_DEAUTH_CODE)
block|{
literal|5
block|,
literal|"rx_disassoc"
block|,
literal|"disassoc"
block|,
literal|"rx disassociation"
block|}
block|,
define|#
directive|define
name|S_RX_DISASSOC_CODE
value|AFTER(S_RX_DISASSOC)
block|{
literal|5
block|,
literal|"rx_disassoc_code"
block|,
literal|"disassoc_code"
block|,
literal|"last rx disassoc reason"
block|}
block|,
define|#
directive|define
name|S_BMISS
value|AFTER(S_RX_DISASSOC_CODE)
block|{
literal|5
block|,
literal|"bmiss"
block|,
literal|"bmiss"
block|,
literal|"beacon miss events handled"
block|}
block|,
define|#
directive|define
name|S_RX_BADSUBTYPE
value|AFTER(S_BMISS)
block|{
literal|5
block|,
literal|"rx_badsubtype"
block|,
literal|"badsubtype"
block|,
literal|"rx frame w/ unknown subtype"
block|}
block|,
define|#
directive|define
name|S_RX_NOBUF
value|AFTER(S_RX_BADSUBTYPE)
block|{
literal|5
block|,
literal|"rx_nobuf"
block|,
literal|"nobuf"
block|,
literal|"rx failed for lack of mbuf"
block|}
block|,
define|#
directive|define
name|S_RX_DECRYPTCRC
value|AFTER(S_RX_NOBUF)
block|{
literal|5
block|,
literal|"rx_decryptcrc"
block|,
literal|"decryptcrc"
block|,
literal|"rx decrypt failed on crc"
block|}
block|,
define|#
directive|define
name|S_RX_AHDEMO_MGT
value|AFTER(S_RX_DECRYPTCRC)
block|{
literal|5
block|,
literal|"rx_ahdemo_mgt"
block|,
literal|"ahdemo_mgt"
block|,
literal|"rx discard mgmt frame received in ahdoc demo mode"
block|}
block|,
define|#
directive|define
name|S_RX_BAD_AUTH
value|AFTER(S_RX_AHDEMO_MGT)
block|{
literal|5
block|,
literal|"rx_bad_auth"
block|,
literal|"bad_auth"
block|,
literal|"rx bad authentication request"
block|}
block|,
define|#
directive|define
name|S_RX_UNAUTH
value|AFTER(S_RX_BAD_AUTH)
block|{
literal|5
block|,
literal|"rx_unauth"
block|,
literal|"unauth"
block|,
literal|"rx discard 'cuz port unauthorized"
block|}
block|,
define|#
directive|define
name|S_RX_BADKEYID
value|AFTER(S_RX_UNAUTH)
block|{
literal|5
block|,
literal|"rx_badkeyid"
block|,
literal|"rxkid"
block|,
literal|"rx w/ incorrect keyid"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPREPLAY
value|AFTER(S_RX_BADKEYID)
block|{
literal|5
block|,
literal|"rx_ccmpreplay"
block|,
literal|"ccmpreplay"
block|,
literal|"rx seq# violation (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPFORMAT
value|AFTER(S_RX_CCMPREPLAY)
block|{
literal|5
block|,
literal|"rx_ccmpformat"
block|,
literal|"ccmpformat"
block|,
literal|"rx format bad (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_CCMPMIC
value|AFTER(S_RX_CCMPFORMAT)
block|{
literal|5
block|,
literal|"rx_ccmpmic"
block|,
literal|"ccmpmic"
block|,
literal|"rx MIC check failed (CCMP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPREPLAY
value|AFTER(S_RX_CCMPMIC)
block|{
literal|5
block|,
literal|"rx_tkipreplay"
block|,
literal|"tkipreplay"
block|,
literal|"rx seq# violation (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPFORMAT
value|AFTER(S_RX_TKIPREPLAY)
block|{
literal|5
block|,
literal|"rx_tkipformat"
block|,
literal|"tkipformat"
block|,
literal|"rx format bad (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPMIC
value|AFTER(S_RX_TKIPFORMAT)
block|{
literal|5
block|,
literal|"rx_tkipmic"
block|,
literal|"tkipmic"
block|,
literal|"rx MIC check failed (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_TKIPICV
value|AFTER(S_RX_TKIPMIC)
block|{
literal|5
block|,
literal|"rx_tkipicv"
block|,
literal|"tkipicv"
block|,
literal|"rx ICV check failed (TKIP)"
block|}
block|,
define|#
directive|define
name|S_RX_BADCIPHER
value|AFTER(S_RX_TKIPICV)
block|{
literal|5
block|,
literal|"rx_badcipher"
block|,
literal|"badcipher"
block|,
literal|"rx failed 'cuz bad cipher/key type"
block|}
block|,
define|#
directive|define
name|S_RX_NOCIPHERCTX
value|AFTER(S_RX_BADCIPHER)
block|{
literal|5
block|,
literal|"rx_nocipherctx"
block|,
literal|"nocipherctx"
block|,
literal|"rx failed 'cuz key/cipher ctx not setup"
block|}
block|,
define|#
directive|define
name|S_RX_ACL
value|AFTER(S_RX_NOCIPHERCTX)
block|{
literal|5
block|,
literal|"rx_acl"
block|,
literal|"acl"
block|,
literal|"rx discard 'cuz acl policy"
block|}
block|,
define|#
directive|define
name|S_TX_NOBUF
value|AFTER(S_RX_ACL)
block|{
literal|5
block|,
literal|"tx_nobuf"
block|,
literal|"nobuf"
block|,
literal|"tx failed for lack of mbuf"
block|}
block|,
define|#
directive|define
name|S_TX_NONODE
value|AFTER(S_TX_NOBUF)
block|{
literal|5
block|,
literal|"tx_nonode"
block|,
literal|"nonode"
block|,
literal|"tx failed for no node"
block|}
block|,
define|#
directive|define
name|S_TX_UNKNOWNMGT
value|AFTER(S_TX_NONODE)
block|{
literal|5
block|,
literal|"tx_unknownmgt"
block|,
literal|"unknownmgt"
block|,
literal|"tx of unknown mgt frame"
block|}
block|,
define|#
directive|define
name|S_TX_BADCIPHER
value|AFTER(S_TX_UNKNOWNMGT)
block|{
literal|5
block|,
literal|"tx_badcipher"
block|,
literal|"badcipher"
block|,
literal|"tx failed 'cuz bad ciper/key type"
block|}
block|,
define|#
directive|define
name|S_TX_NODEFKEY
value|AFTER(S_TX_BADCIPHER)
block|{
literal|5
block|,
literal|"tx_nodefkey"
block|,
literal|"nodefkey"
block|,
literal|"tx failed 'cuz no defkey"
block|}
block|,
define|#
directive|define
name|S_TX_NOHEADROOM
value|AFTER(S_TX_NODEFKEY)
block|{
literal|5
block|,
literal|"tx_noheadroom"
block|,
literal|"noheadroom"
block|,
literal|"tx failed 'cuz no space for crypto hdrs"
block|}
block|,
define|#
directive|define
name|S_TX_FRAGFRAMES
value|AFTER(S_TX_NOHEADROOM)
block|{
literal|5
block|,
literal|"tx_fragframes"
block|,
literal|"fragframes"
block|,
literal|"tx frames fragmented"
block|}
block|,
define|#
directive|define
name|S_TX_FRAGS
value|AFTER(S_TX_FRAGFRAMES)
block|{
literal|5
block|,
literal|"tx_frags"
block|,
literal|"frags"
block|,
literal|"tx frags generated"
block|}
block|,
define|#
directive|define
name|S_SCAN_ACTIVE
value|AFTER(S_TX_FRAGS)
block|{
literal|5
block|,
literal|"scan_active"
block|,
literal|"ascan"
block|,
literal|"active scans started"
block|}
block|,
define|#
directive|define
name|S_SCAN_PASSIVE
value|AFTER(S_SCAN_ACTIVE)
block|{
literal|5
block|,
literal|"scan_passive"
block|,
literal|"pscan"
block|,
literal|"passive scans started"
block|}
block|,
define|#
directive|define
name|S_SCAN_BG
value|AFTER(S_SCAN_PASSIVE)
block|{
literal|5
block|,
literal|"scan_bg"
block|,
literal|"bgscn"
block|,
literal|"background scans started"
block|}
block|,
define|#
directive|define
name|S_NODE_TIMEOUT
value|AFTER(S_SCAN_BG)
block|{
literal|5
block|,
literal|"node_timeout"
block|,
literal|"node_timeout"
block|,
literal|"nodes timed out for inactivity"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_NOMEM
value|AFTER(S_NODE_TIMEOUT)
block|{
literal|5
block|,
literal|"crypto_nomem"
block|,
literal|"crypto_nomem"
block|,
literal|"cipher context malloc failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIP
value|AFTER(S_CRYPTO_NOMEM)
block|{
literal|5
block|,
literal|"crypto_tkip"
block|,
literal|"crypto_tkip"
block|,
literal|"tkip crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPENMIC
value|AFTER(S_CRYPTO_TKIP)
block|{
literal|5
block|,
literal|"crypto_tkipenmic"
block|,
literal|"crypto_tkipenmic"
block|,
literal|"tkip tx MIC done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPDEMIC
value|AFTER(S_CRYPTO_TKIPENMIC)
block|{
literal|5
block|,
literal|"crypto_tkipdemic"
block|,
literal|"crypto_tkipdemic"
block|,
literal|"tkip rx MIC done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_TKIPCM
value|AFTER(S_CRYPTO_TKIPDEMIC)
block|{
literal|5
block|,
literal|"crypto_tkipcm"
block|,
literal|"crypto_tkipcm"
block|,
literal|"tkip dropped frames 'cuz of countermeasures"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_CCMP
value|AFTER(S_CRYPTO_TKIPCM)
block|{
literal|5
block|,
literal|"crypto_ccmp"
block|,
literal|"crypto_ccmp"
block|,
literal|"ccmp crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_WEP
value|AFTER(S_CRYPTO_CCMP)
block|{
literal|5
block|,
literal|"crypto_wep"
block|,
literal|"crypto_wep"
block|,
literal|"wep crypto done in s/w"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SETKEY_CIPHER
value|AFTER(S_CRYPTO_WEP)
block|{
literal|5
block|,
literal|"crypto_setkey_cipher"
block|,
literal|"crypto_setkey_cipher"
block|,
literal|"setkey failed 'cuz cipher rejected data"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SETKEY_NOKEY
value|AFTER(S_CRYPTO_SETKEY_CIPHER)
block|{
literal|5
block|,
literal|"crypto_setkey_nokey"
block|,
literal|"crypto_setkey_nokey"
block|,
literal|"setkey failed 'cuz no key index"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_DELKEY
value|AFTER(S_CRYPTO_SETKEY_NOKEY)
block|{
literal|5
block|,
literal|"crypto_delkey"
block|,
literal|"crypto_delkey"
block|,
literal|"driver key delete failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_BADCIPHER
value|AFTER(S_CRYPTO_DELKEY)
block|{
literal|5
block|,
literal|"crypto_badcipher"
block|,
literal|"crypto_badcipher"
block|,
literal|"setkey failed 'cuz unknown cipher"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_NOCIPHER
value|AFTER(S_CRYPTO_BADCIPHER)
block|{
literal|5
block|,
literal|"crypto_nocipher"
block|,
literal|"crypto_nocipher"
block|,
literal|"setkey failed 'cuz cipher module unavailable"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_ATTACHFAIL
value|AFTER(S_CRYPTO_NOCIPHER)
block|{
literal|5
block|,
literal|"crypto_attachfail"
block|,
literal|"crypto_attachfail"
block|,
literal|"setkey failed 'cuz cipher attach failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_SWFALLBACK
value|AFTER(S_CRYPTO_ATTACHFAIL)
block|{
literal|5
block|,
literal|"crypto_swfallback"
block|,
literal|"crypto_swfallback"
block|,
literal|"crypto fell back to s/w implementation"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_KEYFAIL
value|AFTER(S_CRYPTO_SWFALLBACK)
block|{
literal|5
block|,
literal|"crypto_keyfail"
block|,
literal|"crypto_keyfail"
block|,
literal|"setkey failed 'cuz driver key alloc failed"
block|}
block|,
define|#
directive|define
name|S_CRYPTO_ENMICFAIL
value|AFTER(S_CRYPTO_KEYFAIL)
block|{
literal|5
block|,
literal|"crypto_enmicfail"
block|,
literal|"crypto_enmicfail"
block|,
literal|"enmic failed (may be mbuf exhaustion)"
block|}
block|,
define|#
directive|define
name|S_IBSS_CAPMISMATCH
value|AFTER(S_CRYPTO_ENMICFAIL)
block|{
literal|5
block|,
literal|"ibss_capmismatch"
block|,
literal|"ibss_capmismatch"
block|,
literal|"ibss merge faied 'cuz capabilities mismatch"
block|}
block|,
define|#
directive|define
name|S_IBSS_NORATE
value|AFTER(S_IBSS_CAPMISMATCH)
block|{
literal|5
block|,
literal|"ibss_norate"
block|,
literal|"ibss_norate"
block|,
literal|"ibss merge faied 'cuz rate set mismatch"
block|}
block|,
define|#
directive|define
name|S_PS_UNASSOC
value|AFTER(S_IBSS_NORATE)
block|{
literal|5
block|,
literal|"ps_unassoc"
block|,
literal|"ps_unassoc"
block|,
literal|"ps-poll received for unassociated station"
block|}
block|,
define|#
directive|define
name|S_PS_BADAID
value|AFTER(S_PS_UNASSOC)
block|{
literal|5
block|,
literal|"ps_badaid"
block|,
literal|"ps_badaid"
block|,
literal|"ps-poll received with invalid association id"
block|}
block|,
define|#
directive|define
name|S_PS_QEMPTY
value|AFTER(S_PS_BADAID)
block|{
literal|5
block|,
literal|"ps_qempty"
block|,
literal|"ps_qempty"
block|,
literal|"ps-poll received with nothing to send"
block|}
block|,
define|#
directive|define
name|S_FF_BADHDR
value|AFTER(S_PS_QEMPTY)
block|{
literal|5
block|,
literal|"ff_badhdr"
block|,
literal|"ff_badhdr"
block|,
literal|"fast frame rx'd w/ bad hdr"
block|}
block|,
define|#
directive|define
name|S_FF_TOOSHORT
value|AFTER(S_FF_BADHDR)
block|{
literal|5
block|,
literal|"ff_tooshort"
block|,
literal|"ff_tooshort"
block|,
literal|"fast frame rx decap error"
block|}
block|,
define|#
directive|define
name|S_FF_SPLIT
value|AFTER(S_FF_TOOSHORT)
block|{
literal|5
block|,
literal|"ff_split"
block|,
literal|"ff_split"
block|,
literal|"fast frame rx split error"
block|}
block|,
define|#
directive|define
name|S_FF_DECAP
value|AFTER(S_FF_SPLIT)
block|{
literal|5
block|,
literal|"ff_decap"
block|,
literal|"ff_decap"
block|,
literal|"fast frames decap'd"
block|}
block|,
define|#
directive|define
name|S_FF_ENCAP
value|AFTER(S_FF_DECAP)
block|{
literal|5
block|,
literal|"ff_encap"
block|,
literal|"ff_encap"
block|,
literal|"fast frames encap'd for tx"
block|}
block|,
define|#
directive|define
name|S_FF_ENCAPFAIL
value|AFTER(S_FF_ENCAP)
block|{
literal|5
block|,
literal|"ff_encapfail"
block|,
literal|"ff_encapfail"
block|,
literal|"fast frames encap failed"
block|}
block|,
define|#
directive|define
name|S_RX_BADBINTVAL
value|AFTER(S_FF_ENCAPFAIL)
block|{
literal|5
block|,
literal|"rx_badbintval"
block|,
literal|"rx_badbintval"
block|,
literal|"rx frame with bogus beacon interval"
block|}
block|,
define|#
directive|define
name|S_RX_MGMT
value|AFTER(S_RX_BADBINTVAL)
block|{
literal|8
block|,
literal|"rx_mgmt"
block|,
literal|"mgmt"
block|,
literal|"rx management frames"
block|}
block|,
define|#
directive|define
name|S_RX_DEMICFAIL
value|AFTER(S_RX_MGMT)
block|{
literal|5
block|,
literal|"rx_demicfail"
block|,
literal|"rx_demicfail"
block|,
literal|"rx demic failed"
block|}
block|,
define|#
directive|define
name|S_RX_DEFRAG
value|AFTER(S_RX_DEMICFAIL)
block|{
literal|5
block|,
literal|"rx_defrag"
block|,
literal|"rx_defrag"
block|,
literal|"rx defragmentation failed"
block|}
block|,
define|#
directive|define
name|S_RX_ACTION
value|AFTER(S_RX_DEFRAG)
block|{
literal|5
block|,
literal|"rx_action"
block|,
literal|"rx_action"
block|,
literal|"rx action frames"
block|}
block|,
define|#
directive|define
name|S_AMSDU_TOOSHORT
value|AFTER(S_RX_ACTION)
block|{
literal|8
block|,
literal|"amsdu_tooshort"
block|,
literal|"tooshort"
block|,
literal|"A-MSDU rx decap error"
block|}
block|,
define|#
directive|define
name|S_AMSDU_SPLIT
value|AFTER(S_AMSDU_TOOSHORT)
block|{
literal|8
block|,
literal|"amsdu_split"
block|,
literal|"split"
block|,
literal|"A-MSDU rx failed on frame split"
block|}
block|,
define|#
directive|define
name|S_AMSDU_DECAP
value|AFTER(S_AMSDU_SPLIT)
block|{
literal|8
block|,
literal|"amsdu_decap"
block|,
literal|"decap"
block|,
literal|"A-MSDU frames received"
block|}
block|,
define|#
directive|define
name|S_AMSDU_ENCAP
value|AFTER(S_AMSDU_DECAP)
block|{
literal|8
block|,
literal|"amsdu_encap"
block|,
literal|"encap"
block|,
literal|"A-MSDU frames transmitted"
block|}
block|,
define|#
directive|define
name|S_AMPDU_REORDER
value|AFTER(S_AMSDU_ENCAP)
block|{
literal|8
block|,
literal|"ampdu_reorder"
block|,
literal|"reorder"
block|,
literal|"A-MPDU frames held in reorder q"
block|}
block|,
define|#
directive|define
name|S_AMPDU_FLUSH
value|AFTER(S_AMPDU_REORDER)
block|{
literal|8
block|,
literal|"ampdu_flush"
block|,
literal|"flush"
block|,
literal|"A-MPDU frames sent up from reorder q"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BARBAD
value|AFTER(S_AMPDU_FLUSH)
block|{
literal|6
block|,
literal|"ampdu_barbad"
block|,
literal|"barbad"
block|,
literal|"A-MPDU BAR rx before ADDBA exchange (or disabled with net.link.ieee80211)"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BAROOW
value|AFTER(S_AMPDU_BARBAD)
block|{
literal|6
block|,
literal|"ampdu_baroow"
block|,
literal|"baroow"
block|,
literal|"A-MPDU BAR rx out of BA window"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BARMOVE
value|AFTER(S_AMPDU_BAROOW)
block|{
literal|8
block|,
literal|"ampdu_barmove"
block|,
literal|"barmove"
block|,
literal|"A-MPDU BAR rx moved BA window"
block|}
block|,
define|#
directive|define
name|S_AMPDU_BAR
value|AFTER(S_AMPDU_BARMOVE)
block|{
literal|8
block|,
literal|"ampdu_bar"
block|,
literal|"rxbar"
block|,
literal|"A-MPDU BAR rx successful"
block|}
block|,
define|#
directive|define
name|S_AMPDU_MOVE
value|AFTER(S_AMPDU_BAR)
block|{
literal|5
block|,
literal|"ampdu_move"
block|,
literal|"move"
block|,
literal|"A-MPDU frame moved BA window"
block|}
block|,
define|#
directive|define
name|S_AMPDU_OOR
value|AFTER(S_AMPDU_MOVE)
block|{
literal|8
block|,
literal|"ampdu_oor"
block|,
literal|"oorx"
block|,
literal|"A-MPDU frames rx out-of-order"
block|}
block|,
define|#
directive|define
name|S_AMPDU_COPY
value|AFTER(S_AMPDU_OOR)
block|{
literal|8
block|,
literal|"ampdu_copy"
block|,
literal|"copy"
block|,
literal|"A-MPDU rx window slots copied"
block|}
block|,
define|#
directive|define
name|S_AMPDU_DROP
value|AFTER(S_AMPDU_COPY)
block|{
literal|5
block|,
literal|"ampdu_drop"
block|,
literal|"drop"
block|,
literal|"A-MPDU frames discarded for out of range seqno"
block|}
block|,
define|#
directive|define
name|S_AMPDU_AGE
value|AFTER(S_AMPDU_DROP)
block|{
literal|5
block|,
literal|"ampdu_age"
block|,
literal|"age"
block|,
literal|"A-MPDU frames sent up due to old age"
block|}
block|,
define|#
directive|define
name|S_AMPDU_STOP
value|AFTER(S_AMPDU_AGE)
block|{
literal|5
block|,
literal|"ampdu_stop"
block|,
literal|"stop"
block|,
literal|"A-MPDU streams stopped"
block|}
block|,
define|#
directive|define
name|S_AMPDU_STOP_FAILED
value|AFTER(S_AMPDU_STOP)
block|{
literal|5
block|,
literal|"ampdu_stop_failed"
block|,
literal|"!stop"
block|,
literal|"A-MPDU stop requests failed 'cuz stream not running"
block|}
block|,
define|#
directive|define
name|S_ADDBA_REJECT
value|AFTER(S_AMPDU_STOP_FAILED)
block|{
literal|5
block|,
literal|"addba_reject"
block|,
literal|"reject"
block|,
literal|"ADDBA requests rejected 'cuz A-MPDU rx is disabled"
block|}
block|,
define|#
directive|define
name|S_ADDBA_NOREQUEST
value|AFTER(S_ADDBA_REJECT)
block|{
literal|5
block|,
literal|"addba_norequest"
block|,
literal|"norequest"
block|,
literal|"ADDBA response frames discarded because no ADDBA request was pending"
block|}
block|,
define|#
directive|define
name|S_ADDBA_BADTOKEN
value|AFTER(S_ADDBA_NOREQUEST)
block|{
literal|5
block|,
literal|"addba_badtoken"
block|,
literal|"badtoken"
block|,
literal|"ADDBA response frames discarded 'cuz rx'd dialog token is wrong"
block|}
block|,
define|#
directive|define
name|S_TX_BADSTATE
value|AFTER(S_ADDBA_BADTOKEN)
block|{
literal|4
block|,
literal|"tx_badstate"
block|,
literal|"badstate"
block|,
literal|"tx failed 'cuz vap not in RUN state"
block|}
block|,
define|#
directive|define
name|S_TX_NOTASSOC
value|AFTER(S_TX_BADSTATE)
block|{
literal|4
block|,
literal|"tx_notassoc"
block|,
literal|"notassoc"
block|,
literal|"tx failed 'cuz dest sta not associated"
block|}
block|,
define|#
directive|define
name|S_TX_CLASSIFY
value|AFTER(S_TX_NOTASSOC)
block|{
literal|4
block|,
literal|"tx_classify"
block|,
literal|"classify"
block|,
literal|"tx packet classification failed"
block|}
block|,
define|#
directive|define
name|S_DWDS_MCAST
value|AFTER(S_TX_CLASSIFY)
block|{
literal|8
block|,
literal|"dwds_mcast"
block|,
literal|"dwds_mcast"
block|,
literal|"mcast frame transmitted on dwds vap discarded"
block|}
block|,
define|#
directive|define
name|S_DWDS_QDROP
value|AFTER(S_DWDS_MCAST)
block|{
literal|8
block|,
literal|"dwds_qdrop"
block|,
literal|"dwds_qdrop"
block|,
literal|"4-address frame discarded because dwds pending queue is full"
block|}
block|,
define|#
directive|define
name|S_HT_ASSOC_NOHTCAP
value|AFTER(S_DWDS_QDROP)
block|{
literal|4
block|,
literal|"ht_nohtcap"
block|,
literal|"ht_nohtcap"
block|,
literal|"non-HT station rejected in HT-only BSS"
block|}
block|,
define|#
directive|define
name|S_HT_ASSOC_DOWNGRADE
value|AFTER(S_HT_ASSOC_NOHTCAP)
block|{
literal|4
block|,
literal|"ht_downgrade"
block|,
literal|"ht_downgrade"
block|,
literal|"HT station downgraded to legacy operation"
block|}
block|,
define|#
directive|define
name|S_HT_ASSOC_NORATE
value|AFTER(S_HT_ASSOC_DOWNGRADE)
block|{
literal|4
block|,
literal|"ht_norate"
block|,
literal|"ht_norate"
block|,
literal|"HT station rejected because of HT rate set"
block|}
block|,
define|#
directive|define
name|S_INPUT
value|AFTER(S_HT_ASSOC_NORATE)
block|{
literal|8
block|,
literal|"input"
block|,
literal|"input"
block|,
literal|"total data frames received"
block|}
block|,
define|#
directive|define
name|S_RX_UCAST
value|AFTER(S_INPUT)
block|{
literal|8
block|,
literal|"rx_ucast"
block|,
literal|"rx_ucast"
block|,
literal|"unicast data frames received"
block|}
block|,
define|#
directive|define
name|S_RX_MCAST
value|AFTER(S_RX_UCAST)
block|{
literal|8
block|,
literal|"rx_mcast"
block|,
literal|"rx_mcast"
block|,
literal|"multicast data frames received"
block|}
block|,
define|#
directive|define
name|S_OUTPUT
value|AFTER(S_RX_MCAST)
block|{
literal|8
block|,
literal|"output"
block|,
literal|"output"
block|,
literal|"total data frames transmit"
block|}
block|,
define|#
directive|define
name|S_TX_UCAST
value|AFTER(S_OUTPUT)
block|{
literal|8
block|,
literal|"tx_ucast"
block|,
literal|"tx_ucast"
block|,
literal|"unicast data frames sent"
block|}
block|,
define|#
directive|define
name|S_TX_MCAST
value|AFTER(S_TX_UCAST)
block|{
literal|8
block|,
literal|"tx_mcast"
block|,
literal|"tx_mcast"
block|,
literal|"multicast data frames sent"
block|}
block|,
define|#
directive|define
name|S_RATE
value|AFTER(S_TX_MCAST)
block|{
literal|5
block|,
literal|"rate"
block|,
literal|"rate"
block|,
literal|"current transmit rate"
block|}
block|,
define|#
directive|define
name|S_RSSI
value|AFTER(S_RATE)
block|{
literal|5
block|,
literal|"rssi"
block|,
literal|"rssi"
block|,
literal|"current rssi"
block|}
block|,
define|#
directive|define
name|S_NOISE
value|AFTER(S_RSSI)
block|{
literal|5
block|,
literal|"noise"
block|,
literal|"noise"
block|,
literal|"current noise floor (dBm)"
block|}
block|,
define|#
directive|define
name|S_SIGNAL
value|AFTER(S_NOISE)
block|{
literal|5
block|,
literal|"signal"
block|,
literal|"sig"
block|,
literal|"current signal (dBm)"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|wlanstatfoo_p
block|{
name|struct
name|wlanstatfoo
name|base
decl_stmt|;
name|int
name|s
decl_stmt|;
name|int
name|opmode
decl_stmt|;
name|uint8_t
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|ieee80211_stats
name|cur
decl_stmt|;
name|struct
name|ieee80211_stats
name|total
decl_stmt|;
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
union|union
block|{
name|struct
name|ieee80211req_sta_req
name|info
decl_stmt|;
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
block|}
name|u_info
union|;
name|struct
name|ieee80211req_sta_stats
name|ncur
decl_stmt|;
name|struct
name|ieee80211req_sta_stats
name|ntotal
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|wlan_setifname
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|,
specifier|const
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
name|strncpy
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|wlan_getifname
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
return|return
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_getopmode
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
if|if
condition|(
name|wf
operator|->
name|opmode
operator|==
operator|-
literal|1
condition|)
block|{
name|struct
name|ifmediareq
name|ifmr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCGIFMEDIA
argument_list|,
operator|&
name|ifmr
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (SIOCGIFMEDIA)"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_ADHOC
condition|)
block|{
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_FLAG0
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_AHDEMO
expr_stmt|;
else|else
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_IBSS
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_HOSTAP
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_HOSTAP
expr_stmt|;
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_MONITOR
condition|)
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_MONITOR
expr_stmt|;
else|else
name|wf
operator|->
name|opmode
operator|=
name|IEEE80211_M_STA
expr_stmt|;
block|}
return|return
name|wf
operator|->
name|opmode
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|getlladdr
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|)
block|{
specifier|const
name|struct
name|sockaddr_dl
modifier|*
name|sdl
decl_stmt|;
name|struct
name|ifaddrs
modifier|*
name|ifp
decl_stmt|,
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|getifaddrs
argument_list|(
operator|&
name|ifp
argument_list|)
operator|!=
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"getifaddrs"
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|ifp
init|;
name|p
operator|!=
name|NULL
condition|;
name|p
operator|=
name|p
operator|->
name|ifa_next
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|p
operator|->
name|ifa_name
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
operator|==
literal|0
operator|&&
name|p
operator|->
name|ifa_addr
operator|->
name|sa_family
operator|==
name|AF_LINK
condition|)
break|break;
if|if
condition|(
name|p
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"did not find link layer address for interface %s"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
name|sdl
operator|=
operator|(
specifier|const
expr|struct
name|sockaddr_dl
operator|*
operator|)
name|p
operator|->
name|ifa_addr
expr_stmt|;
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|mac
argument_list|,
name|LLADDR
argument_list|(
name|sdl
argument_list|)
argument_list|)
expr_stmt|;
name|freeifaddrs
argument_list|(
name|ifp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|getbssid
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|)
block|{
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_BSSID
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
name|wf
operator|->
name|mac
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
name|IEEE80211_ADDR_LEN
expr_stmt|;
return|return
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_setstamac
parameter_list|(
name|struct
name|wlanstatfoo
modifier|*
name|wf0
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|wf0
decl_stmt|;
if|if
condition|(
name|mac
operator|==
name|NULL
condition|)
block|{
switch|switch
condition|(
name|wlan_getopmode
argument_list|(
name|wf0
argument_list|)
condition|)
block|{
case|case
name|IEEE80211_M_HOSTAP
case|:
case|case
name|IEEE80211_M_MONITOR
case|:
case|case
name|IEEE80211_M_IBSS
case|:
case|case
name|IEEE80211_M_AHDEMO
case|:
name|getlladdr
argument_list|(
name|wf
argument_list|)
expr_stmt|;
break|break;
case|case
name|IEEE80211_M_STA
case|:
if|if
condition|(
name|getbssid
argument_list|(
name|wf
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (IEEE80211_IOC_BSSID)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|mac
argument_list|,
name|mac
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* XXX only fetch what's needed to do reports */
end_comment

begin_function
specifier|static
name|void
name|wlan_collect
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|,
name|struct
name|ieee80211_stats
modifier|*
name|stats
parameter_list|,
name|struct
name|ieee80211req_sta_stats
modifier|*
name|nstats
parameter_list|)
block|{
name|IEEE80211_ADDR_COPY
argument_list|(
name|wf
operator|->
name|u_info
operator|.
name|info
operator|.
name|is_u
operator|.
name|macaddr
argument_list|,
name|wf
operator|->
name|mac
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_STA_INFO
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|wf
operator|->
name|u_info
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
sizeof|sizeof
argument_list|(
name|wf
operator|->
name|u_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
name|warn
argument_list|(
literal|"%s:%s (IEEE80211_IOC_STA_INFO)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
specifier|const
expr|struct
name|ether_addr
operator|*
operator|)
name|wf
operator|->
name|mac
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|IEEE80211_ADDR_COPY
argument_list|(
name|nstats
operator|->
name|is_u
operator|.
name|macaddr
argument_list|,
name|wf
operator|->
name|mac
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_STA_STATS
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_data
operator|=
operator|(
name|caddr_t
operator|)
name|nstats
expr_stmt|;
name|wf
operator|->
name|ireq
operator|.
name|i_len
operator|=
sizeof|sizeof
argument_list|(
operator|*
name|nstats
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|wf
operator|->
name|ireq
argument_list|)
operator|<
literal|0
condition|)
name|warn
argument_list|(
literal|"%s:%s (IEEE80211_IOC_STA_STATS)"
argument_list|,
name|wf
operator|->
name|ireq
operator|.
name|i_name
argument_list|,
name|ether_ntoa
argument_list|(
operator|(
specifier|const
expr|struct
name|ether_addr
operator|*
operator|)
name|wf
operator|->
name|mac
argument_list|)
argument_list|)
expr_stmt|;
name|wf
operator|->
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
name|stats
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|wf
operator|->
name|s
argument_list|,
name|SIOCG80211STATS
argument_list|,
operator|&
name|wf
operator|->
name|ifr
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"%s (SIOCG80211STATS)"
argument_list|,
name|wf
operator|->
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_collect_cur
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wlan_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|cur
argument_list|,
operator|&
name|wf
operator|->
name|ncur
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_collect_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wlan_collect
argument_list|(
name|wf
argument_list|,
operator|&
name|wf
operator|->
name|total
argument_list|,
operator|&
name|wf
operator|->
name|ntotal
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_update_tot
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
name|wf
operator|->
name|total
operator|=
name|wf
operator|->
name|cur
expr_stmt|;
name|wf
operator|->
name|ntotal
operator|=
name|wf
operator|->
name|ncur
expr_stmt|;
block|}
end_function

begin_function
name|void
name|setreason
parameter_list|(
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|,
name|int
name|v
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
specifier|static
specifier|const
name|char
modifier|*
name|reasons
index|[]
init|=
block|{
index|[
name|IEEE80211_REASON_UNSPECIFIED
index|]
operator|=
literal|"unspecified"
block|,
index|[
name|IEEE80211_REASON_AUTH_EXPIRE
index|]
operator|=
literal|"auth expire"
block|,
index|[
name|IEEE80211_REASON_AUTH_LEAVE
index|]
operator|=
literal|"auth leave"
block|,
index|[
name|IEEE80211_REASON_ASSOC_EXPIRE
index|]
operator|=
literal|"assoc expire"
block|,
index|[
name|IEEE80211_REASON_ASSOC_TOOMANY
index|]
operator|=
literal|"assoc toomany"
block|,
index|[
name|IEEE80211_REASON_NOT_AUTHED
index|]
operator|=
literal|"not authed"
block|,
index|[
name|IEEE80211_REASON_NOT_ASSOCED
index|]
operator|=
literal|"not assoced"
block|,
index|[
name|IEEE80211_REASON_ASSOC_LEAVE
index|]
operator|=
literal|"assoc leave"
block|,
index|[
name|IEEE80211_REASON_ASSOC_NOT_AUTHED
index|]
operator|=
literal|"assoc not authed"
block|,
index|[
name|IEEE80211_REASON_DISASSOC_PWRCAP_BAD
index|]
operator|=
literal|"disassoc pwrcap bad"
block|,
index|[
name|IEEE80211_REASON_DISASSOC_SUPCHAN_BAD
index|]
operator|=
literal|"disassoc supchan bad"
block|,
index|[
name|IEEE80211_REASON_IE_INVALID
index|]
operator|=
literal|"ie invalid"
block|,
index|[
name|IEEE80211_REASON_MIC_FAILURE
index|]
operator|=
literal|"mic failure"
block|,
index|[
name|IEEE80211_REASON_4WAY_HANDSHAKE_TIMEOUT
index|]
operator|=
literal|"4-way handshake timeout"
block|,
index|[
name|IEEE80211_REASON_GROUP_KEY_UPDATE_TIMEOUT
index|]
operator|=
literal|"group key update timeout"
block|,
index|[
name|IEEE80211_REASON_IE_IN_4WAY_DIFFERS
index|]
operator|=
literal|"ie in 4-way differs"
block|,
index|[
name|IEEE80211_REASON_GROUP_CIPHER_INVALID
index|]
operator|=
literal|"group cipher invalid"
block|,
index|[
name|IEEE80211_REASON_PAIRWISE_CIPHER_INVALID
index|]
operator|=
literal|"pairwise cipher invalid"
block|,
index|[
name|IEEE80211_REASON_AKMP_INVALID
index|]
operator|=
literal|"akmp invalid"
block|,
index|[
name|IEEE80211_REASON_UNSUPP_RSN_IE_VERSION
index|]
operator|=
literal|"unsupported rsn ie version"
block|,
index|[
name|IEEE80211_REASON_INVALID_RSN_IE_CAP
index|]
operator|=
literal|"invalid rsn ie cap"
block|,
index|[
name|IEEE80211_REASON_802_1X_AUTH_FAILED
index|]
operator|=
literal|"802.1x auth failed"
block|,
index|[
name|IEEE80211_REASON_CIPHER_SUITE_REJECTED
index|]
operator|=
literal|"cipher suite rejected"
block|,     }
decl_stmt|;
if|if
condition|(
name|v
operator|<
name|N
argument_list|(
name|reasons
argument_list|)
operator|&&
name|reasons
index|[
name|v
index|]
operator|!=
name|NULL
condition|)
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%s (%u)"
argument_list|,
name|reasons
index|[
name|v
index|]
argument_list|,
name|v
argument_list|)
expr_stmt|;
else|else
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%u"
argument_list|,
name|v
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
name|void
name|setstatus
parameter_list|(
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|,
name|int
name|v
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
specifier|static
specifier|const
name|char
modifier|*
name|status
index|[]
init|=
block|{
index|[
name|IEEE80211_STATUS_SUCCESS
index|]
operator|=
literal|"success"
block|,
index|[
name|IEEE80211_STATUS_UNSPECIFIED
index|]
operator|=
literal|"unspecified"
block|,
index|[
name|IEEE80211_STATUS_CAPINFO
index|]
operator|=
literal|"capinfo"
block|,
index|[
name|IEEE80211_STATUS_NOT_ASSOCED
index|]
operator|=
literal|"not assoced"
block|,
index|[
name|IEEE80211_STATUS_OTHER
index|]
operator|=
literal|"other"
block|,
index|[
name|IEEE80211_STATUS_ALG
index|]
operator|=
literal|"algorithm"
block|,
index|[
name|IEEE80211_STATUS_SEQUENCE
index|]
operator|=
literal|"sequence"
block|,
index|[
name|IEEE80211_STATUS_CHALLENGE
index|]
operator|=
literal|"challenge"
block|,
index|[
name|IEEE80211_STATUS_TIMEOUT
index|]
operator|=
literal|"timeout"
block|,
index|[
name|IEEE80211_STATUS_TOOMANY
index|]
operator|=
literal|"toomany"
block|,
index|[
name|IEEE80211_STATUS_BASIC_RATE
index|]
operator|=
literal|"basic rate"
block|,
index|[
name|IEEE80211_STATUS_SP_REQUIRED
index|]
operator|=
literal|"sp required"
block|,
index|[
name|IEEE80211_STATUS_PBCC_REQUIRED
index|]
operator|=
literal|"pbcc required"
block|,
index|[
name|IEEE80211_STATUS_CA_REQUIRED
index|]
operator|=
literal|"ca required"
block|,
index|[
name|IEEE80211_STATUS_SPECMGMT_REQUIRED
index|]
operator|=
literal|"specmgmt required"
block|,
index|[
name|IEEE80211_STATUS_PWRCAP_REQUIRED
index|]
operator|=
literal|"pwrcap required"
block|,
index|[
name|IEEE80211_STATUS_SUPCHAN_REQUIRED
index|]
operator|=
literal|"supchan required"
block|,
index|[
name|IEEE80211_STATUS_SHORTSLOT_REQUIRED
index|]
operator|=
literal|"shortslot required"
block|,
index|[
name|IEEE80211_STATUS_DSSSOFDM_REQUIRED
index|]
operator|=
literal|"dsssofdm required"
block|,
index|[
name|IEEE80211_STATUS_INVALID_IE
index|]
operator|=
literal|"invalid ie"
block|,
index|[
name|IEEE80211_STATUS_GROUP_CIPHER_INVALID
index|]
operator|=
literal|"group cipher invalid"
block|,
index|[
name|IEEE80211_STATUS_PAIRWISE_CIPHER_INVALID
index|]
operator|=
literal|"pairwise cipher invalid"
block|,
index|[
name|IEEE80211_STATUS_AKMP_INVALID
index|]
operator|=
literal|"akmp invalid"
block|,
index|[
name|IEEE80211_STATUS_UNSUPP_RSN_IE_VERSION
index|]
operator|=
literal|"unsupported rsn ie version"
block|,
index|[
name|IEEE80211_STATUS_INVALID_RSN_IE_CAP
index|]
operator|=
literal|"invalid rsn ie cap"
block|,
index|[
name|IEEE80211_STATUS_CIPHER_SUITE_REJECTED
index|]
operator|=
literal|"cipher suite rejected"
block|,     }
decl_stmt|;
if|if
condition|(
name|v
operator|<
name|N
argument_list|(
name|status
argument_list|)
operator|&&
name|status
index|[
name|v
index|]
operator|!=
name|NULL
condition|)
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%s (%u)"
argument_list|,
name|status
index|[
name|v
index|]
argument_list|,
name|v
argument_list|)
expr_stmt|;
else|else
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%u"
argument_list|,
name|v
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_getinfo
parameter_list|(
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
init|=
operator|&
name|wf
operator|->
name|u_info
operator|.
name|info
operator|.
name|info
index|[
literal|0
index|]
decl_stmt|;
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RATE
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%uM"
argument_list|,
name|si
operator|->
name|isi_txmbps
operator|/
literal|2
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RSSI
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_rssi
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_NOISE
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_SIGNAL
case|:
name|snprintf
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
literal|"%d"
argument_list|,
name|si
operator|->
name|isi_rssi
operator|+
name|si
operator|->
name|isi_noise
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RX_AUTH_FAIL_CODE
case|:
if|if
condition|(
name|wf
operator|->
name|cur
operator|.
name|is_rx_authfail_code
operator|==
literal|0
condition|)
break|break;
name|setstatus
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|is_rx_authfail_code
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RX_DEAUTH_CODE
case|:
if|if
condition|(
name|wf
operator|->
name|cur
operator|.
name|is_rx_deauth_code
operator|==
literal|0
condition|)
break|break;
name|setreason
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|is_rx_deauth_code
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|S_RX_DISASSOC_CODE
case|:
if|if
condition|(
name|wf
operator|->
name|cur
operator|.
name|is_rx_disassoc_code
operator|==
literal|0
condition|)
break|break;
name|setreason
argument_list|(
name|b
argument_list|,
name|bs
argument_list|,
name|wf
operator|->
name|cur
operator|.
name|is_rx_disassoc_code
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|b
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_get_curstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->cur.is_##x - wf->total.is_##x); return 1
define|#
directive|define
name|NSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", \ 	    wf->ncur.is_stats.ns_##x - wf->ntotal.is_stats.ns_##x); \ 	    return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RX_BADVERSION
case|:
name|STAT
argument_list|(
name|rx_badversion
argument_list|)
expr_stmt|;
case|case
name|S_RX_TOOSHORT
case|:
name|STAT
argument_list|(
name|rx_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGBSS
case|:
name|STAT
argument_list|(
name|rx_wrongbss
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUP
case|:
name|STAT
argument_list|(
name|rx_dup
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGDIR
case|:
name|STAT
argument_list|(
name|rx_wrongdir
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCASTECHO
case|:
name|STAT
argument_list|(
name|rx_mcastecho
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOTASSOC
case|:
name|STAT
argument_list|(
name|rx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOPRIVACY
case|:
name|STAT
argument_list|(
name|rx_noprivacy
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNENCRYPTED
case|:
name|STAT
argument_list|(
name|rx_unencrypted
argument_list|)
expr_stmt|;
case|case
name|S_RX_WEPFAIL
case|:
name|STAT
argument_list|(
name|rx_wepfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECAP
case|:
name|STAT
argument_list|(
name|rx_decap
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGTDISCARD
case|:
name|STAT
argument_list|(
name|rx_mgtdiscard
argument_list|)
expr_stmt|;
case|case
name|S_RX_CTL
case|:
name|STAT
argument_list|(
name|rx_ctl
argument_list|)
expr_stmt|;
case|case
name|S_RX_BEACON
case|:
name|STAT
argument_list|(
name|rx_beacon
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSTOOBIG
case|:
name|STAT
argument_list|(
name|rx_rstoobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_MISSING
case|:
name|STAT
argument_list|(
name|rx_elem_missing
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOBIG
case|:
name|STAT
argument_list|(
name|rx_elem_toobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOSMALL
case|:
name|STAT
argument_list|(
name|rx_elem_toosmall
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_UNKNOWN
case|:
name|STAT
argument_list|(
name|rx_elem_unknown
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCHAN
case|:
name|STAT
argument_list|(
name|rx_badchan
argument_list|)
expr_stmt|;
case|case
name|S_RX_CHANMISMATCH
case|:
name|STAT
argument_list|(
name|rx_chanmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODEALLOC
case|:
name|STAT
argument_list|(
name|rx_nodealloc
argument_list|)
expr_stmt|;
case|case
name|S_RX_SSIDMISMATCH
case|:
name|STAT
argument_list|(
name|rx_ssidmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_UNSUPPORTED
case|:
name|STAT
argument_list|(
name|rx_auth_unsupported
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_FAIL
case|:
name|STAT
argument_list|(
name|rx_auth_fail
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_COUNTERMEASURES
case|:
name|STAT
argument_list|(
name|rx_auth_countermeasures
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BSS
case|:
name|STAT
argument_list|(
name|rx_assoc_bss
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NOTAUTH
case|:
name|STAT
argument_list|(
name|rx_assoc_notauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|rx_assoc_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|rx_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BADWPAIE
case|:
name|STAT
argument_list|(
name|rx_assoc_badwpaie
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEAUTH
case|:
name|STAT
argument_list|(
name|rx_deauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_DISASSOC
case|:
name|STAT
argument_list|(
name|rx_disassoc
argument_list|)
expr_stmt|;
case|case
name|S_BMISS
case|:
name|STAT
argument_list|(
name|beacon_miss
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADSUBTYPE
case|:
name|STAT
argument_list|(
name|rx_badsubtype
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOBUF
case|:
name|STAT
argument_list|(
name|rx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECRYPTCRC
case|:
name|STAT
argument_list|(
name|rx_decryptcrc
argument_list|)
expr_stmt|;
case|case
name|S_RX_AHDEMO_MGT
case|:
name|STAT
argument_list|(
name|rx_ahdemo_mgt
argument_list|)
expr_stmt|;
case|case
name|S_RX_BAD_AUTH
case|:
name|STAT
argument_list|(
name|rx_bad_auth
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNAUTH
case|:
name|STAT
argument_list|(
name|rx_unauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADKEYID
case|:
name|STAT
argument_list|(
name|rx_badkeyid
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPREPLAY
case|:
name|STAT
argument_list|(
name|rx_ccmpreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPFORMAT
case|:
name|STAT
argument_list|(
name|rx_ccmpformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPMIC
case|:
name|STAT
argument_list|(
name|rx_ccmpmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPREPLAY
case|:
name|STAT
argument_list|(
name|rx_tkipreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPFORMAT
case|:
name|STAT
argument_list|(
name|rx_tkipformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPICV
case|:
name|STAT
argument_list|(
name|rx_tkipicv
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCIPHER
case|:
name|STAT
argument_list|(
name|rx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOCIPHERCTX
case|:
name|STAT
argument_list|(
name|rx_nocipherctx
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACL
case|:
name|STAT
argument_list|(
name|rx_acl
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOBUF
case|:
name|STAT
argument_list|(
name|tx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_NONODE
case|:
name|STAT
argument_list|(
name|tx_nonode
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNKNOWNMGT
case|:
name|STAT
argument_list|(
name|tx_unknownmgt
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADCIPHER
case|:
name|STAT
argument_list|(
name|tx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODEFKEY
case|:
name|STAT
argument_list|(
name|tx_nodefkey
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGFRAMES
case|:
name|STAT
argument_list|(
name|tx_fragframes
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|STAT
argument_list|(
name|tx_frags
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_ACTIVE
case|:
name|STAT
argument_list|(
name|scan_active
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_PASSIVE
case|:
name|STAT
argument_list|(
name|scan_passive
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_BG
case|:
name|STAT
argument_list|(
name|scan_bg
argument_list|)
expr_stmt|;
case|case
name|S_NODE_TIMEOUT
case|:
name|STAT
argument_list|(
name|node_timeout
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOMEM
case|:
name|STAT
argument_list|(
name|crypto_nomem
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIP
case|:
name|STAT
argument_list|(
name|crypto_tkip
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPENMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipenmic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPDEMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipdemic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPCM
case|:
name|STAT
argument_list|(
name|crypto_tkipcm
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_CCMP
case|:
name|STAT
argument_list|(
name|crypto_ccmp
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_WEP
case|:
name|STAT
argument_list|(
name|crypto_wep
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_CIPHER
case|:
name|STAT
argument_list|(
name|crypto_setkey_cipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_NOKEY
case|:
name|STAT
argument_list|(
name|crypto_setkey_nokey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_DELKEY
case|:
name|STAT
argument_list|(
name|crypto_delkey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_BADCIPHER
case|:
name|STAT
argument_list|(
name|crypto_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOCIPHER
case|:
name|STAT
argument_list|(
name|crypto_nocipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ATTACHFAIL
case|:
name|STAT
argument_list|(
name|crypto_attachfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SWFALLBACK
case|:
name|STAT
argument_list|(
name|crypto_swfallback
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_KEYFAIL
case|:
name|STAT
argument_list|(
name|crypto_keyfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ENMICFAIL
case|:
name|STAT
argument_list|(
name|crypto_enmicfail
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|ibss_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_NORATE
case|:
name|STAT
argument_list|(
name|ibss_norate
argument_list|)
expr_stmt|;
case|case
name|S_PS_UNASSOC
case|:
name|STAT
argument_list|(
name|ps_unassoc
argument_list|)
expr_stmt|;
case|case
name|S_PS_BADAID
case|:
name|STAT
argument_list|(
name|ps_badaid
argument_list|)
expr_stmt|;
case|case
name|S_PS_QEMPTY
case|:
name|STAT
argument_list|(
name|ps_qempty
argument_list|)
expr_stmt|;
case|case
name|S_FF_BADHDR
case|:
name|STAT
argument_list|(
name|ff_badhdr
argument_list|)
expr_stmt|;
case|case
name|S_FF_TOOSHORT
case|:
name|STAT
argument_list|(
name|ff_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_FF_SPLIT
case|:
name|STAT
argument_list|(
name|ff_split
argument_list|)
expr_stmt|;
case|case
name|S_FF_DECAP
case|:
name|STAT
argument_list|(
name|ff_decap
argument_list|)
expr_stmt|;
case|case
name|S_FF_ENCAP
case|:
name|STAT
argument_list|(
name|ff_encap
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADBINTVAL
case|:
name|STAT
argument_list|(
name|rx_badbintval
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGMT
case|:
name|STAT
argument_list|(
name|rx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEMICFAIL
case|:
name|STAT
argument_list|(
name|rx_demicfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEFRAG
case|:
name|STAT
argument_list|(
name|rx_defrag
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACTION
case|:
name|STAT
argument_list|(
name|rx_action
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_TOOSHORT
case|:
name|STAT
argument_list|(
name|amsdu_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_SPLIT
case|:
name|STAT
argument_list|(
name|amsdu_split
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_DECAP
case|:
name|STAT
argument_list|(
name|amsdu_decap
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_ENCAP
case|:
name|STAT
argument_list|(
name|amsdu_encap
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_REORDER
case|:
name|STAT
argument_list|(
name|ampdu_rx_reorder
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_FLUSH
case|:
name|STAT
argument_list|(
name|ampdu_rx_flush
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARBAD
case|:
name|STAT
argument_list|(
name|ampdu_bar_bad
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAROOW
case|:
name|STAT
argument_list|(
name|ampdu_bar_oow
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARMOVE
case|:
name|STAT
argument_list|(
name|ampdu_bar_move
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAR
case|:
name|STAT
argument_list|(
name|ampdu_bar_rx
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_MOVE
case|:
name|STAT
argument_list|(
name|ampdu_rx_move
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_OOR
case|:
name|STAT
argument_list|(
name|ampdu_rx_oor
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_COPY
case|:
name|STAT
argument_list|(
name|ampdu_rx_copy
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_DROP
case|:
name|STAT
argument_list|(
name|ampdu_rx_drop
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_AGE
case|:
name|STAT
argument_list|(
name|ampdu_rx_age
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_STOP
case|:
name|STAT
argument_list|(
name|ampdu_stop
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_STOP_FAILED
case|:
name|STAT
argument_list|(
name|ampdu_stop_failed
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_REJECT
case|:
name|STAT
argument_list|(
name|addba_reject
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_NOREQUEST
case|:
name|STAT
argument_list|(
name|addba_norequest
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_BADTOKEN
case|:
name|STAT
argument_list|(
name|addba_badtoken
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADSTATE
case|:
name|STAT
argument_list|(
name|tx_badstate
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOTASSOC
case|:
name|STAT
argument_list|(
name|tx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_TX_CLASSIFY
case|:
name|STAT
argument_list|(
name|tx_classify
argument_list|)
expr_stmt|;
case|case
name|S_DWDS_MCAST
case|:
name|STAT
argument_list|(
name|dwds_mcast
argument_list|)
expr_stmt|;
case|case
name|S_DWDS_QDROP
case|:
name|STAT
argument_list|(
name|dwds_qdrop
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_NOHTCAP
case|:
name|STAT
argument_list|(
name|ht_assoc_nohtcap
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_DOWNGRADE
case|:
name|STAT
argument_list|(
name|ht_assoc_downgrade
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|ht_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_INPUT
case|:
name|NSTAT
argument_list|(
name|rx_data
argument_list|)
expr_stmt|;
case|case
name|S_OUTPUT
case|:
name|NSTAT
argument_list|(
name|tx_data
argument_list|)
expr_stmt|;
case|case
name|S_RX_UCAST
case|:
name|NSTAT
argument_list|(
name|rx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|NSTAT
argument_list|(
name|rx_mcast
argument_list|)
expr_stmt|;
case|case
name|S_TX_UCAST
case|:
name|NSTAT
argument_list|(
name|tx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|NSTAT
argument_list|(
name|tx_mcast
argument_list|)
expr_stmt|;
block|}
return|return
name|wlan_getinfo
argument_list|(
name|wf
argument_list|,
name|s
argument_list|,
name|b
argument_list|,
name|bs
argument_list|)
return|;
undef|#
directive|undef
name|NSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_get_totstat
parameter_list|(
name|struct
name|statfoo
modifier|*
name|sf
parameter_list|,
name|int
name|s
parameter_list|,
name|char
name|b
index|[]
parameter_list|,
name|size_t
name|bs
parameter_list|)
block|{
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
init|=
operator|(
expr|struct
name|wlanstatfoo_p
operator|*
operator|)
name|sf
decl_stmt|;
define|#
directive|define
name|STAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->total.is_##x); return 1
define|#
directive|define
name|NSTAT
parameter_list|(
name|x
parameter_list|)
define|\
value|snprintf(b, bs, "%u", wf->ntotal.is_stats.ns_##x); return 1
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|S_RX_BADVERSION
case|:
name|STAT
argument_list|(
name|rx_badversion
argument_list|)
expr_stmt|;
case|case
name|S_RX_TOOSHORT
case|:
name|STAT
argument_list|(
name|rx_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGBSS
case|:
name|STAT
argument_list|(
name|rx_wrongbss
argument_list|)
expr_stmt|;
case|case
name|S_RX_DUP
case|:
name|STAT
argument_list|(
name|rx_dup
argument_list|)
expr_stmt|;
case|case
name|S_RX_WRONGDIR
case|:
name|STAT
argument_list|(
name|rx_wrongdir
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCASTECHO
case|:
name|STAT
argument_list|(
name|rx_mcastecho
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOTASSOC
case|:
name|STAT
argument_list|(
name|rx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOPRIVACY
case|:
name|STAT
argument_list|(
name|rx_noprivacy
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNENCRYPTED
case|:
name|STAT
argument_list|(
name|rx_unencrypted
argument_list|)
expr_stmt|;
case|case
name|S_RX_WEPFAIL
case|:
name|STAT
argument_list|(
name|rx_wepfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECAP
case|:
name|STAT
argument_list|(
name|rx_decap
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGTDISCARD
case|:
name|STAT
argument_list|(
name|rx_mgtdiscard
argument_list|)
expr_stmt|;
case|case
name|S_RX_CTL
case|:
name|STAT
argument_list|(
name|rx_ctl
argument_list|)
expr_stmt|;
case|case
name|S_RX_BEACON
case|:
name|STAT
argument_list|(
name|rx_beacon
argument_list|)
expr_stmt|;
case|case
name|S_RX_RSTOOBIG
case|:
name|STAT
argument_list|(
name|rx_rstoobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_MISSING
case|:
name|STAT
argument_list|(
name|rx_elem_missing
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOBIG
case|:
name|STAT
argument_list|(
name|rx_elem_toobig
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_TOOSMALL
case|:
name|STAT
argument_list|(
name|rx_elem_toosmall
argument_list|)
expr_stmt|;
case|case
name|S_RX_ELEM_UNKNOWN
case|:
name|STAT
argument_list|(
name|rx_elem_unknown
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCHAN
case|:
name|STAT
argument_list|(
name|rx_badchan
argument_list|)
expr_stmt|;
case|case
name|S_RX_CHANMISMATCH
case|:
name|STAT
argument_list|(
name|rx_chanmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_NODEALLOC
case|:
name|STAT
argument_list|(
name|rx_nodealloc
argument_list|)
expr_stmt|;
case|case
name|S_RX_SSIDMISMATCH
case|:
name|STAT
argument_list|(
name|rx_ssidmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_UNSUPPORTED
case|:
name|STAT
argument_list|(
name|rx_auth_unsupported
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_FAIL
case|:
name|STAT
argument_list|(
name|rx_auth_fail
argument_list|)
expr_stmt|;
case|case
name|S_RX_AUTH_COUNTERMEASURES
case|:
name|STAT
argument_list|(
name|rx_auth_countermeasures
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BSS
case|:
name|STAT
argument_list|(
name|rx_assoc_bss
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NOTAUTH
case|:
name|STAT
argument_list|(
name|rx_assoc_notauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|rx_assoc_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|rx_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_RX_ASSOC_BADWPAIE
case|:
name|STAT
argument_list|(
name|rx_assoc_badwpaie
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEAUTH
case|:
name|STAT
argument_list|(
name|rx_deauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_DISASSOC
case|:
name|STAT
argument_list|(
name|rx_disassoc
argument_list|)
expr_stmt|;
case|case
name|S_BMISS
case|:
name|STAT
argument_list|(
name|beacon_miss
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADSUBTYPE
case|:
name|STAT
argument_list|(
name|rx_badsubtype
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOBUF
case|:
name|STAT
argument_list|(
name|rx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_RX_DECRYPTCRC
case|:
name|STAT
argument_list|(
name|rx_decryptcrc
argument_list|)
expr_stmt|;
case|case
name|S_RX_AHDEMO_MGT
case|:
name|STAT
argument_list|(
name|rx_ahdemo_mgt
argument_list|)
expr_stmt|;
case|case
name|S_RX_BAD_AUTH
case|:
name|STAT
argument_list|(
name|rx_bad_auth
argument_list|)
expr_stmt|;
case|case
name|S_RX_UNAUTH
case|:
name|STAT
argument_list|(
name|rx_unauth
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADKEYID
case|:
name|STAT
argument_list|(
name|rx_badkeyid
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPREPLAY
case|:
name|STAT
argument_list|(
name|rx_ccmpreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPFORMAT
case|:
name|STAT
argument_list|(
name|rx_ccmpformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_CCMPMIC
case|:
name|STAT
argument_list|(
name|rx_ccmpmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPREPLAY
case|:
name|STAT
argument_list|(
name|rx_tkipreplay
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPFORMAT
case|:
name|STAT
argument_list|(
name|rx_tkipformat
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPMIC
case|:
name|STAT
argument_list|(
name|rx_tkipmic
argument_list|)
expr_stmt|;
case|case
name|S_RX_TKIPICV
case|:
name|STAT
argument_list|(
name|rx_tkipicv
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADCIPHER
case|:
name|STAT
argument_list|(
name|rx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_RX_NOCIPHERCTX
case|:
name|STAT
argument_list|(
name|rx_nocipherctx
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACL
case|:
name|STAT
argument_list|(
name|rx_acl
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOBUF
case|:
name|STAT
argument_list|(
name|tx_nobuf
argument_list|)
expr_stmt|;
case|case
name|S_TX_NONODE
case|:
name|STAT
argument_list|(
name|tx_nonode
argument_list|)
expr_stmt|;
case|case
name|S_TX_UNKNOWNMGT
case|:
name|STAT
argument_list|(
name|tx_unknownmgt
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADCIPHER
case|:
name|STAT
argument_list|(
name|tx_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_TX_NODEFKEY
case|:
name|STAT
argument_list|(
name|tx_nodefkey
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOHEADROOM
case|:
name|STAT
argument_list|(
name|tx_noheadroom
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGFRAMES
case|:
name|STAT
argument_list|(
name|tx_fragframes
argument_list|)
expr_stmt|;
case|case
name|S_TX_FRAGS
case|:
name|STAT
argument_list|(
name|tx_frags
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_ACTIVE
case|:
name|STAT
argument_list|(
name|scan_active
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_PASSIVE
case|:
name|STAT
argument_list|(
name|scan_passive
argument_list|)
expr_stmt|;
case|case
name|S_SCAN_BG
case|:
name|STAT
argument_list|(
name|scan_bg
argument_list|)
expr_stmt|;
case|case
name|S_NODE_TIMEOUT
case|:
name|STAT
argument_list|(
name|node_timeout
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOMEM
case|:
name|STAT
argument_list|(
name|crypto_nomem
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIP
case|:
name|STAT
argument_list|(
name|crypto_tkip
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPENMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipenmic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPDEMIC
case|:
name|STAT
argument_list|(
name|crypto_tkipdemic
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_TKIPCM
case|:
name|STAT
argument_list|(
name|crypto_tkipcm
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_CCMP
case|:
name|STAT
argument_list|(
name|crypto_ccmp
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_WEP
case|:
name|STAT
argument_list|(
name|crypto_wep
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_CIPHER
case|:
name|STAT
argument_list|(
name|crypto_setkey_cipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SETKEY_NOKEY
case|:
name|STAT
argument_list|(
name|crypto_setkey_nokey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_DELKEY
case|:
name|STAT
argument_list|(
name|crypto_delkey
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_BADCIPHER
case|:
name|STAT
argument_list|(
name|crypto_badcipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_NOCIPHER
case|:
name|STAT
argument_list|(
name|crypto_nocipher
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ATTACHFAIL
case|:
name|STAT
argument_list|(
name|crypto_attachfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_SWFALLBACK
case|:
name|STAT
argument_list|(
name|crypto_swfallback
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_KEYFAIL
case|:
name|STAT
argument_list|(
name|crypto_keyfail
argument_list|)
expr_stmt|;
case|case
name|S_CRYPTO_ENMICFAIL
case|:
name|STAT
argument_list|(
name|crypto_enmicfail
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_CAPMISMATCH
case|:
name|STAT
argument_list|(
name|ibss_capmismatch
argument_list|)
expr_stmt|;
case|case
name|S_IBSS_NORATE
case|:
name|STAT
argument_list|(
name|ibss_norate
argument_list|)
expr_stmt|;
case|case
name|S_PS_UNASSOC
case|:
name|STAT
argument_list|(
name|ps_unassoc
argument_list|)
expr_stmt|;
case|case
name|S_PS_BADAID
case|:
name|STAT
argument_list|(
name|ps_badaid
argument_list|)
expr_stmt|;
case|case
name|S_PS_QEMPTY
case|:
name|STAT
argument_list|(
name|ps_qempty
argument_list|)
expr_stmt|;
case|case
name|S_FF_BADHDR
case|:
name|STAT
argument_list|(
name|ff_badhdr
argument_list|)
expr_stmt|;
case|case
name|S_FF_TOOSHORT
case|:
name|STAT
argument_list|(
name|ff_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_FF_SPLIT
case|:
name|STAT
argument_list|(
name|ff_split
argument_list|)
expr_stmt|;
case|case
name|S_FF_DECAP
case|:
name|STAT
argument_list|(
name|ff_decap
argument_list|)
expr_stmt|;
case|case
name|S_FF_ENCAP
case|:
name|STAT
argument_list|(
name|ff_encap
argument_list|)
expr_stmt|;
case|case
name|S_RX_BADBINTVAL
case|:
name|STAT
argument_list|(
name|rx_badbintval
argument_list|)
expr_stmt|;
case|case
name|S_RX_MGMT
case|:
name|STAT
argument_list|(
name|rx_mgmt
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEMICFAIL
case|:
name|STAT
argument_list|(
name|rx_demicfail
argument_list|)
expr_stmt|;
case|case
name|S_RX_DEFRAG
case|:
name|STAT
argument_list|(
name|rx_defrag
argument_list|)
expr_stmt|;
case|case
name|S_RX_ACTION
case|:
name|STAT
argument_list|(
name|rx_action
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_TOOSHORT
case|:
name|STAT
argument_list|(
name|amsdu_tooshort
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_SPLIT
case|:
name|STAT
argument_list|(
name|amsdu_split
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_DECAP
case|:
name|STAT
argument_list|(
name|amsdu_decap
argument_list|)
expr_stmt|;
case|case
name|S_AMSDU_ENCAP
case|:
name|STAT
argument_list|(
name|amsdu_encap
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_REORDER
case|:
name|STAT
argument_list|(
name|ampdu_rx_reorder
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_FLUSH
case|:
name|STAT
argument_list|(
name|ampdu_rx_flush
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARBAD
case|:
name|STAT
argument_list|(
name|ampdu_bar_bad
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAROOW
case|:
name|STAT
argument_list|(
name|ampdu_bar_oow
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BARMOVE
case|:
name|STAT
argument_list|(
name|ampdu_bar_move
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_BAR
case|:
name|STAT
argument_list|(
name|ampdu_bar_rx
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_MOVE
case|:
name|STAT
argument_list|(
name|ampdu_rx_move
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_OOR
case|:
name|STAT
argument_list|(
name|ampdu_rx_oor
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_COPY
case|:
name|STAT
argument_list|(
name|ampdu_rx_copy
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_DROP
case|:
name|STAT
argument_list|(
name|ampdu_rx_drop
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_AGE
case|:
name|STAT
argument_list|(
name|ampdu_rx_age
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_STOP
case|:
name|STAT
argument_list|(
name|ampdu_stop
argument_list|)
expr_stmt|;
case|case
name|S_AMPDU_STOP_FAILED
case|:
name|STAT
argument_list|(
name|ampdu_stop_failed
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_REJECT
case|:
name|STAT
argument_list|(
name|addba_reject
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_NOREQUEST
case|:
name|STAT
argument_list|(
name|addba_norequest
argument_list|)
expr_stmt|;
case|case
name|S_ADDBA_BADTOKEN
case|:
name|STAT
argument_list|(
name|addba_badtoken
argument_list|)
expr_stmt|;
case|case
name|S_TX_BADSTATE
case|:
name|STAT
argument_list|(
name|tx_badstate
argument_list|)
expr_stmt|;
case|case
name|S_TX_NOTASSOC
case|:
name|STAT
argument_list|(
name|tx_notassoc
argument_list|)
expr_stmt|;
case|case
name|S_TX_CLASSIFY
case|:
name|STAT
argument_list|(
name|tx_classify
argument_list|)
expr_stmt|;
case|case
name|S_DWDS_MCAST
case|:
name|STAT
argument_list|(
name|dwds_mcast
argument_list|)
expr_stmt|;
case|case
name|S_DWDS_QDROP
case|:
name|STAT
argument_list|(
name|dwds_qdrop
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_NOHTCAP
case|:
name|STAT
argument_list|(
name|ht_assoc_nohtcap
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_DOWNGRADE
case|:
name|STAT
argument_list|(
name|ht_assoc_downgrade
argument_list|)
expr_stmt|;
case|case
name|S_HT_ASSOC_NORATE
case|:
name|STAT
argument_list|(
name|ht_assoc_norate
argument_list|)
expr_stmt|;
case|case
name|S_INPUT
case|:
name|NSTAT
argument_list|(
name|rx_data
argument_list|)
expr_stmt|;
case|case
name|S_OUTPUT
case|:
name|NSTAT
argument_list|(
name|tx_data
argument_list|)
expr_stmt|;
case|case
name|S_RX_UCAST
case|:
name|NSTAT
argument_list|(
name|rx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_RX_MCAST
case|:
name|NSTAT
argument_list|(
name|rx_mcast
argument_list|)
expr_stmt|;
case|case
name|S_TX_UCAST
case|:
name|NSTAT
argument_list|(
name|tx_ucast
argument_list|)
expr_stmt|;
case|case
name|S_TX_MCAST
case|:
name|NSTAT
argument_list|(
name|tx_mcast
argument_list|)
expr_stmt|;
block|}
return|return
name|wlan_getinfo
argument_list|(
name|wf
argument_list|,
name|s
argument_list|,
name|b
argument_list|,
name|bs
argument_list|)
return|;
undef|#
directive|undef
name|NSTAT
undef|#
directive|undef
name|STAT
block|}
end_function

begin_macro
name|STATFOO_DEFINE_BOUNCE
argument_list|(
argument|wlanstatfoo
argument_list|)
end_macro

begin_function
name|struct
name|wlanstatfoo
modifier|*
name|wlanstats_new
parameter_list|(
specifier|const
name|char
modifier|*
name|ifname
parameter_list|,
specifier|const
name|char
modifier|*
name|fmtstring
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a) / sizeof(a[0]))
name|struct
name|wlanstatfoo_p
modifier|*
name|wf
decl_stmt|;
name|wf
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wlanstatfoo_p
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|!=
name|NULL
condition|)
block|{
name|statfoo_init
argument_list|(
operator|&
name|wf
operator|->
name|base
operator|.
name|base
argument_list|,
literal|"wlanstats"
argument_list|,
name|wlanstats
argument_list|,
name|N
argument_list|(
name|wlanstats
argument_list|)
argument_list|)
expr_stmt|;
comment|/* override base methods */
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_cur
operator|=
name|wlan_collect_cur
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|collect_tot
operator|=
name|wlan_collect_tot
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_curstat
operator|=
name|wlan_get_curstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|get_totstat
operator|=
name|wlan_get_totstat
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|base
operator|.
name|update_tot
operator|=
name|wlan_update_tot
expr_stmt|;
comment|/* setup bounce functions for public methods */
name|STATFOO_BOUNCE
argument_list|(
name|wf
argument_list|,
name|wlanstatfoo
argument_list|)
expr_stmt|;
comment|/* setup our public methods */
name|wf
operator|->
name|base
operator|.
name|setifname
operator|=
name|wlan_setifname
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|getifname
operator|=
name|wlan_getifname
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|getopmode
operator|=
name|wlan_getopmode
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|setstamac
operator|=
name|wlan_setstamac
expr_stmt|;
name|wf
operator|->
name|opmode
operator|=
operator|-
literal|1
expr_stmt|;
name|wf
operator|->
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|wf
operator|->
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
name|wlan_setifname
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|wf
operator|->
name|base
operator|.
name|setfmt
argument_list|(
operator|&
name|wf
operator|->
name|base
argument_list|,
name|fmtstring
argument_list|)
expr_stmt|;
block|}
return|return
operator|&
name|wf
operator|->
name|base
return|;
undef|#
directive|undef
name|N
block|}
end_function

end_unit

