begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2012 Adrian Chadd<adrian@FreeBSD.org>  * All Rights Reserved.  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/alq.h>
end_include

begin_include
include|#
directive|include
file|<sys/endian.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_alq.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/ath_hal/ar5416/ar5416desc.h>
end_include

begin_include
include|#
directive|include
file|"ar5416_ds.h"
end_include

begin_define
define|#
directive|define
name|MS
parameter_list|(
name|_v
parameter_list|,
name|_f
parameter_list|)
value|( ((_v)& (_f))>> _f##_S )
end_define

begin_define
define|#
directive|define
name|MF
parameter_list|(
name|_v
parameter_list|,
name|_f
parameter_list|)
value|( !! ((_v)& (_f)))
end_define

begin_function
specifier|static
name|void
name|ar5416_decode_txstatus
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar5416_desc
name|txs
decl_stmt|;
comment|/* XXX assumes txs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|txs
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar5416_desc
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] TXSTATUS: TxDone=%d, FrmOk=%d, filt=%d, TS=0x%08x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_TxDone
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_FrmXmitOK
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_Filtered
argument_list|)
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
comment|/* ds_txstatus0 */
name|printf
argument_list|(
literal|"    RX RSSI 0 [%d %d %d]"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|0
index|]
argument_list|,
name|AR_TxRSSIAnt00
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|0
index|]
argument_list|,
name|AR_TxRSSIAnt01
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|0
index|]
argument_list|,
name|AR_TxRSSIAnt02
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_txstatus5 */
name|printf
argument_list|(
literal|" RX RSSI 1 [%d %d %d] Comb=%d\n"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|5
index|]
argument_list|,
name|AR_TxRSSIAnt10
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|5
index|]
argument_list|,
name|AR_TxRSSIAnt11
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|5
index|]
argument_list|,
name|AR_TxRSSIAnt12
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|5
index|]
argument_list|,
name|AR_TxRSSICombined
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_txstatus0 */
name|printf
argument_list|(
literal|"    BA Valid=%d"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|0
index|]
argument_list|,
name|AR_TxBaStatus
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_txstatus1 */
name|printf
argument_list|(
literal|", Frmok=%d, xretries=%d, fifounderrun=%d, filt=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_FrmXmitOK
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_ExcessiveRetries
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_FIFOUnderrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_Filtered
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    DelimUnderrun=%d, DataUnderun=%d, DescCfgErr=%d,"
literal|" TxTimerExceeded=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_TxDelimUnderrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_TxDataUnderrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_DescCfgErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_TxTimerExpired
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    RTScnt=%d, FailCnt=%d, VRetryCnt=%d\n"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_RTSFailCnt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_DataFailCnt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|1
index|]
argument_list|,
name|AR_VirtRetryCnt
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_txstatus2 */
name|printf
argument_list|(
literal|"    TxTimestamp=0x%08x"
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
comment|/* ds_txstatus3 */
comment|/* ds_txstatus4 */
name|printf
argument_list|(
literal|", BALow=0x%08x"
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", BAHigh=0x%08x\n"
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
comment|/* ds_txstatus6 */
comment|/* ds_txstatus7 */
comment|/* ds_txstatus8 */
name|printf
argument_list|(
literal|"    TxEVM[0]=0x%08x, TxEVM[1]=0x%08x, TxEVM[2]=0x%08x\n"
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|6
index|]
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|7
index|]
argument_list|,
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
comment|/* ds_txstatus9 */
name|printf
argument_list|(
literal|"    TxDone=%d, SeqNum=0x%04x, TxOpExceeded=%d, FinalTsIdx=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_TxDone
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_SeqNum
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_TxOpExceeded
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_FinalTxIdx
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    PowerMgmt=%d, TxTid=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_PowerMgmt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|u
operator|.
name|tx
operator|.
name|status
index|[
literal|9
index|]
argument_list|,
name|AR_TxTid
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n ------\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ar5416_decode_txdesc
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar5416_desc
name|txc
decl_stmt|;
comment|/* XXX assumes txs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|txc
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar5416_desc
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] TXD\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  link=0x%08x, data=0x%08x\n"
argument_list|,
name|txc
operator|.
name|ds_link
argument_list|,
name|txc
operator|.
name|ds_data
argument_list|)
expr_stmt|;
comment|/* ds_ctl0 */
name|printf
argument_list|(
literal|"    Frame Len=%d, VMF=%d\n"
argument_list|,
name|txc
operator|.
name|ds_ctl0
operator|&
name|AR_FrameLen
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_VirtMoreFrag
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TX power0=%d, RtsEna=%d, Veol=%d, ClrDstMask=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_XmitPower
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_RTSEnable
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_VEOL
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_ClrDestMask
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TxIntrReq=%d, DestIdxValid=%d, CtsEnable=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_TxIntrReq
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_DestIdxValid
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl0
argument_list|,
name|AR_CTSEnable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl1 */
name|printf
argument_list|(
literal|"    BufLen=%d, TxMore=%d, DestIdx=%d,"
literal|" FrType=0x%x\n"
argument_list|,
name|txc
operator|.
name|ds_ctl1
operator|&
name|AR_BufLen
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_TxMore
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_DestIdx
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_FrameType
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    NoAck=%d, InsertTs=%d, CorruptFcs=%d, ExtOnly=%d,"
literal|" ExtAndCtl=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_NoAck
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_InsertTS
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_CorruptFCS
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_ExtOnly
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_ExtAndCtl
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    MoreAggr=%d, IsAggr=%d, MoreRifs=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_MoreAggr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_IsAggr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl1
argument_list|,
name|AR_MoreRifs
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl2 */
name|printf
argument_list|(
literal|"    DurUpEna=%d, Burstdur=0x%04x\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_DurUpdateEn
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_BurstDur
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    Try0=%d, Try1=%d, Try2=%d, Try3=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_XmitDataTries0
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_XmitDataTries1
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_XmitDataTries2
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl2
argument_list|,
name|AR_XmitDataTries3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl3, 4 */
name|printf
argument_list|(
literal|"    try 0: Rate=0x%02x, PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl3
argument_list|,
name|AR_XmitRate0
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl4
argument_list|,
name|AR_PacketDur0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl4
argument_list|,
name|AR_RTSCTSQual0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 1: Rate=0x%02x, PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl3
argument_list|,
name|AR_XmitRate1
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl4
argument_list|,
name|AR_PacketDur1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl4
argument_list|,
name|AR_RTSCTSQual1
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl3, 5 */
name|printf
argument_list|(
literal|"    try 2: Rate=0x%02x, PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl3
argument_list|,
name|AR_XmitRate2
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl5
argument_list|,
name|AR_PacketDur2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl5
argument_list|,
name|AR_RTSCTSQual2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 3: Rate=0x%02x, PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl3
argument_list|,
name|AR_XmitRate3
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl5
argument_list|,
name|AR_PacketDur3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl5
argument_list|,
name|AR_RTSCTSQual3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl6 */
name|printf
argument_list|(
literal|"    AggrLen=%d, PadDelim=%d, EncrType=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl6
argument_list|,
name|AR_AggrLen
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl6
argument_list|,
name|AR_PadDelim
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl6
argument_list|,
name|AR_EncrType
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl7 */
name|printf
argument_list|(
literal|"    try 0: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_ChainSel0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_GI0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_2040_0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_STBC0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 1: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_ChainSel1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_GI1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_2040_1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_STBC1
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 2: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_ChainSel2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_GI2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_2040_2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_STBC2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 3: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_ChainSel3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_GI3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_2040_3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_STBC3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ds_ctl8 */
name|printf
argument_list|(
literal|"    try 0: ant=0x%08x\n"
argument_list|,
name|txc
operator|.
name|ds_ctl8
operator|&
name|AR_AntCtl0
argument_list|)
expr_stmt|;
comment|/* ds_ctl9 */
name|printf
argument_list|(
literal|"    try 1: TxPower=%d, ant=0x%08x\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl9
argument_list|,
name|AR_XmitPower1
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl9
operator|&
name|AR_AntCtl1
argument_list|)
expr_stmt|;
comment|/* ds_ctl10 */
name|printf
argument_list|(
literal|"    try 2: TxPower=%d, ant=0x%08x\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl10
argument_list|,
name|AR_XmitPower2
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl10
operator|&
name|AR_AntCtl2
argument_list|)
expr_stmt|;
comment|/* ds_ctl11 */
name|printf
argument_list|(
literal|"    try 3: TxPower=%d, ant=0x%08x\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_XmitPower3
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl11
operator|&
name|AR_AntCtl3
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n ------ \n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ar5416_decode_rxstatus
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar5416_desc
name|rxs
decl_stmt|;
comment|/* XXX assumes rxs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|rxs
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar5416_desc
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] RXSTATUS: RxDone=%d, RxRate=0x%02x, TS=0x%08x\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxDone
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus0
argument_list|,
name|AR_RxRate
argument_list|)
argument_list|,
name|rxs
operator|.
name|ds_rxstatus2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  link=0x%08x, data=0x%08x, ctl0=0x%08x, ctl2=0x%08x\n"
argument_list|,
name|rxs
operator|.
name|ds_link
argument_list|,
name|rxs
operator|.
name|ds_data
argument_list|,
name|rxs
operator|.
name|ds_ctl0
argument_list|,
name|rxs
operator|.
name|ds_ctl1
argument_list|)
expr_stmt|;
comment|/* status0 */
comment|/* 	 * XXX TODO: For AR9285, the chain 1 and chain 2 RSSI values 	 * acutally contain the RX mixer configuration 	 */
name|printf
argument_list|(
literal|"  RSSICtl[0]=%d, RSSICtl[1]=%d, RSSICtl[2]=%d\n"
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus0
argument_list|,
name|AR_RxRSSIAnt00
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus0
argument_list|,
name|AR_RxRSSIAnt01
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus0
argument_list|,
name|AR_RxRSSIAnt02
argument_list|)
argument_list|)
expr_stmt|;
comment|/* status4 */
name|printf
argument_list|(
literal|"  RSSIExt[0]=%d, RSSIExt[1]=%d, RSSIExt[2]=%d, RSSIComb=%d\n"
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus4
argument_list|,
name|AR_RxRSSIAnt10
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus4
argument_list|,
name|AR_RxRSSIAnt11
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus4
argument_list|,
name|AR_RxRSSIAnt12
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus4
argument_list|,
name|AR_RxRSSICombined
argument_list|)
argument_list|)
expr_stmt|;
comment|/* status2 */
name|printf
argument_list|(
literal|"  RxTimestamp=0x%08x,"
argument_list|,
name|rxs
operator|.
name|ds_rxstatus2
argument_list|)
expr_stmt|;
comment|/* status1 */
name|printf
argument_list|(
literal|" DataLen=%d, RxMore=%d, NumDelim=%d\n"
argument_list|,
name|rxs
operator|.
name|ds_rxstatus1
operator|&
name|AR_DataLen
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus1
argument_list|,
name|AR_RxMore
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus1
argument_list|,
name|AR_NumDelim
argument_list|)
argument_list|)
expr_stmt|;
comment|/* status3 - RxRate however is for Owl 2.0 */
name|printf
argument_list|(
literal|"  GI=%d, 2040=%d, RxRate=0x%02x, DupFrame=%d, RxAnt=0x%08x\n"
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus3
argument_list|,
name|AR_GI
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus3
argument_list|,
name|AR_2040
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus0
argument_list|,
name|AR_RxRate
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus3
argument_list|,
name|AR_DupFrame
argument_list|)
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus3
argument_list|,
name|AR_RxAntenna
argument_list|)
argument_list|)
expr_stmt|;
comment|/* status5 */
comment|/* status6 */
comment|/* status7 */
name|printf
argument_list|(
literal|"  RxEvm0=0x%08x, RxEvm1=0x%08x, RxEvm2=0x%08x\n"
argument_list|,
name|rxs
operator|.
name|ds_rxstatus5
argument_list|,
name|rxs
operator|.
name|ds_rxstatus6
argument_list|,
name|rxs
operator|.
name|ds_rxstatus7
argument_list|)
expr_stmt|;
comment|/* status8 */
name|printf
argument_list|(
literal|"  RxDone=%d, RxFrameOk=%d, CrcErr=%d, DecryptCrcErr=%d\n"
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxDone
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxFrameOK
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_CRCErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_DecryptCRCErr
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  PhyErr=%d, MichaelErr=%d, PreDelimCRCErr=%d, KeyIdxValid=%d\n"
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_PHYErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_MichaelErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_PreDelimCRCErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxKeyIdxValid
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  RxMoreAggr=%d, RxAggr=%d, PostDelimCRCErr=%d, HiRxChain=%d\n"
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxMoreAggr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_RxAggr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_PostDelimCRCErr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_HiRxChain
argument_list|)
argument_list|)
expr_stmt|;
comment|/* If PHY error, print that out. Otherwise, the key index */
if|if
condition|(
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_PHYErr
argument_list|)
condition|)
name|printf
argument_list|(
literal|"  PhyErrCode=0x%02x"
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_PHYErrCode
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"  KeyIdx=0x%02x"
argument_list|,
name|MS
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_KeyIdx
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", KeyMiss=%d\n"
argument_list|,
name|MF
argument_list|(
name|rxs
operator|.
name|ds_rxstatus8
argument_list|,
name|AR_KeyMiss
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n ------\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar5416_alq_payload
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
switch|switch
condition|(
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|op
argument_list|)
condition|)
block|{
case|case
name|ATH_ALQ_EDMA_TXSTATUS
case|:
comment|/* TXSTATUS */
name|ar5416_decode_txstatus
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|ATH_ALQ_EDMA_RXSTATUS
case|:
comment|/* RXSTATUS */
name|ar5416_decode_rxstatus
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|ATH_ALQ_EDMA_TXDESC
case|:
comment|/* TXDESC */
name|ar5416_decode_txdesc
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"[%d.%06d] [%lld] op: %d; len %d\n"
argument_list|,
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|,
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|op
argument_list|)
argument_list|,
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|len
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

