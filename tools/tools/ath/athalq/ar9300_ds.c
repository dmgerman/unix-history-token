begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2012 Adrian Chadd<adrian@FreeBSD.org>  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES  * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR  * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES  * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/alq.h>
end_include

begin_include
include|#
directive|include
file|<sys/endian.h>
end_include

begin_include
include|#
directive|include
file|<dev/ath/if_ath_alq.h>
end_include

begin_include
include|#
directive|include
file|<ar9300/ar9300desc.h>
end_include

begin_include
include|#
directive|include
file|"ar9300_ds.h"
end_include

begin_comment
comment|/* XXX should break this out into if_athvar.h */
end_comment

begin_define
define|#
directive|define
name|MS
parameter_list|(
name|_v
parameter_list|,
name|_f
parameter_list|)
value|( ((_v)& (_f))>> _f##_S )
end_define

begin_define
define|#
directive|define
name|MF
parameter_list|(
name|_v
parameter_list|,
name|_f
parameter_list|)
value|( !! ((_v)& (_f)))
end_define

begin_function
specifier|static
name|void
name|ar9300_decode_txstatus
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar9300_txs
name|txs
decl_stmt|;
comment|/* XXX assumes txs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|txs
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txs
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] TXSTATUS\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    DescId=0x%08x\n"
argument_list|,
name|txs
operator|.
name|status1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    DescLen=%d, TxQcuNum=%d, CtrlStat=%d, DescId=0x%04x\n"
argument_list|,
name|txs
operator|.
name|ds_info
operator|&
literal|0xff
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|ds_info
argument_list|,
name|AR_tx_qcu_num
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|ds_info
argument_list|,
name|AR_ctrl_stat
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|ds_info
argument_list|,
name|AR_desc_id
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TxTimestamp=0x%08x\n"
argument_list|,
name|txs
operator|.
name|status4
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TxDone=%d, SeqNo=%d, TxOpExceed=%d, TXBFStatus=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_done
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_seq_num
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_op_exceeded
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_TXBFStatus
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TXBfMismatch=%d, BFStreamMiss=%d, FinalTxIdx=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_bf_bw_mismatch
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_bf_stream_miss
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_final_tx_idx
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TxBfDestMiss=%d, TxBfExpired=%d, PwrMgmt=%d, Tid=%d,"
literal|" FastTsBit=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_bf_dest_miss
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_bf_expired
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_power_mgmt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_tid
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status8
argument_list|,
name|AR_tx_fast_ts
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    Frmok=%d, xretries=%d, fifounderrun=%d, filt=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_frm_xmit_ok
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_excessive_retries
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_fifounderrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_filtered
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    DelimUnderrun=%d, DataUnderun=%d, DescCfgErr=%d,"
literal|" TxTimerExceeded=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_tx_delim_underrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_tx_data_underrun
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_desc_cfg_err
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_tx_timer_expired
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    RTScnt=%d, FailCnt=%d, VRetryCnt=%d\n"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_rts_fail_cnt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_data_fail_cnt
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status3
argument_list|,
name|AR_virt_retry_cnt
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    RX RSSI 0 [%d %d %d]\n"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status2
argument_list|,
name|AR_tx_rssi_ant00
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status2
argument_list|,
name|AR_tx_rssi_ant01
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status2
argument_list|,
name|AR_tx_rssi_ant02
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    RX RSSI 1 [%d %d %d] Comb=%d\n"
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status7
argument_list|,
name|AR_tx_rssi_ant10
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status7
argument_list|,
name|AR_tx_rssi_ant11
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status7
argument_list|,
name|AR_tx_rssi_ant12
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txs
operator|.
name|status7
argument_list|,
name|AR_tx_rssi_combined
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    BA Valid=%d\n"
argument_list|,
name|MF
argument_list|(
name|txs
operator|.
name|status2
argument_list|,
name|AR_tx_ba_status
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    BALow=0x%08x\n"
argument_list|,
name|txs
operator|.
name|status5
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    BAHigh=0x%08x\n"
argument_list|,
name|txs
operator|.
name|status6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n ------ \n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Note - these are rounded up to 128 bytes; but we  * only use 96 bytes from it.  */
end_comment

begin_function
specifier|static
name|void
name|ar9300_decode_txdesc
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar9300_txc
name|txc
decl_stmt|;
comment|/* XXX assumes txs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|txc
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
literal|96
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] TXD\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  DescLen=%d, TxQcuNum=%d, CtrlStat=%d, DescId=0x%04x\n"
argument_list|,
name|txc
operator|.
name|ds_info
operator|&
literal|0xff
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_info
argument_list|,
name|AR_tx_qcu_num
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_info
argument_list|,
name|AR_ctrl_stat
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_info
argument_list|,
name|AR_desc_id
argument_list|)
argument_list|)
expr_stmt|;
comment|/* link */
name|printf
argument_list|(
literal|"    Link 0x%08x\n"
argument_list|,
name|txc
operator|.
name|ds_link
argument_list|)
expr_stmt|;
comment|/* data0 */
name|printf
argument_list|(
literal|"    Data0 0x%08x Len %d\n"
argument_list|,
name|txc
operator|.
name|ds_data0
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl3
argument_list|,
name|AR_buf_len
argument_list|)
argument_list|)
expr_stmt|;
comment|/* data1 */
name|printf
argument_list|(
literal|"    Data1 0x%08x Len %d\n"
argument_list|,
name|txc
operator|.
name|ds_data1
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl5
argument_list|,
name|AR_buf_len
argument_list|)
argument_list|)
expr_stmt|;
comment|/* data2 */
name|printf
argument_list|(
literal|"    Data2 0x%08x Len %d\n"
argument_list|,
name|txc
operator|.
name|ds_data2
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl7
argument_list|,
name|AR_buf_len
argument_list|)
argument_list|)
expr_stmt|;
comment|/* data3 */
name|printf
argument_list|(
literal|"    Data3 0x%08x Len %d\n"
argument_list|,
name|txc
operator|.
name|ds_data3
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl9
argument_list|,
name|AR_buf_len
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl10 */
name|printf
argument_list|(
literal|"    Desc ID=0x%04x, Chksum=0x%04x (ctl10=0x%08x)\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl10
argument_list|,
name|AR_tx_desc_id
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl10
operator|&
name|AR_tx_ptr_chk_sum
argument_list|,
name|txc
operator|.
name|ds_ctl10
argument_list|)
expr_stmt|;
comment|/* ctl11 */
name|printf
argument_list|(
literal|"    Frame Len=%d, VMF=%d, LowRxChain=%d, TxClrRetry=%d\n"
argument_list|,
name|txc
operator|.
name|ds_ctl11
operator|&
name|AR_frame_len
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_virt_more_frag
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_low_rx_chain
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_tx_clear_retry
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TX power 0 = %d, RtsEna=%d, Veol=%d, ClrDstMask=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_xmit_power0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_rts_enable
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_veol
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_clr_dest_mask
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    TxIntrReq=%d, DestIdxValid=%d, CtsEnable=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_tx_intr_req
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_dest_idx_valid
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl11
argument_list|,
name|AR_cts_enable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl12 */
name|printf
argument_list|(
literal|"    Paprd Chain Mask=0x%x, TxMore=%d, DestIdx=%d,"
literal|" FrType=0x%x\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_paprd_chain_mask
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_tx_more
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_dest_idx
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_frame_type
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    NoAck=%d, InsertTs=%d, CorruptFcs=%d, ExtOnly=%d,"
literal|" ExtAndCtl=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_no_ack
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_insert_ts
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_corrupt_fcs
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_ext_only
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_ext_and_ctl
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    IsAggr=%d, MoreRifs=%d, LocMode=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_is_aggr
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_more_rifs
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl12
argument_list|,
name|AR_loc_mode
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl13 */
name|printf
argument_list|(
literal|"    DurUpEna=%d, Burstdur=0x%04x\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_dur_update_ena
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_burst_dur
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    Try0=%d, Try1=%d, Try2=%d, Try3=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries0
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries1
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries2
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl13
argument_list|,
name|AR_xmit_data_tries3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl14 */
name|printf
argument_list|(
literal|"    rate0=0x%02x, rate1=0x%02x, rate2=0x%02x, rate3=0x%02x\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl14
argument_list|,
name|AR_xmit_rate0
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl14
argument_list|,
name|AR_xmit_rate1
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl14
argument_list|,
name|AR_xmit_rate2
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl14
argument_list|,
name|AR_xmit_rate3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl15 */
name|printf
argument_list|(
literal|"    try 0: PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl15
argument_list|,
name|AR_packet_dur0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl15
argument_list|,
name|AR_rts_cts_qual0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 1: PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl15
argument_list|,
name|AR_packet_dur1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl15
argument_list|,
name|AR_rts_cts_qual1
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl16 */
name|printf
argument_list|(
literal|"    try 2: PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl16
argument_list|,
name|AR_packet_dur2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl16
argument_list|,
name|AR_rts_cts_qual2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 3: PktDur=%d, RTS/CTS ena=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl16
argument_list|,
name|AR_packet_dur3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl16
argument_list|,
name|AR_rts_cts_qual3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl17 */
name|printf
argument_list|(
literal|"    AggrLen=%d, PadDelim=%d, EncrType=%d, TxDcApStaSel=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_aggr_len
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_pad_delim
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_encr_type
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_tx_dc_ap_sta_sel
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    Calib=%d LDPC=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_calibrating
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl17
argument_list|,
name|AR_ldpc
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl18 */
name|printf
argument_list|(
literal|"    try 0: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_chain_sel0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_gi0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_2040_0
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_stbc0
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 1: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_chain_sel1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_gi1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_2040_1
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_stbc1
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 2: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_chain_sel2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_gi2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_2040_2
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_stbc2
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 3: chainMask=0x%x, GI=%d, 2040=%d, STBC=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_chain_sel3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_gi3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_2040_3
argument_list|)
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl18
argument_list|,
name|AR_stbc3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl19 */
name|printf
argument_list|(
literal|"    NotSounding=%d\n"
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl19
argument_list|,
name|AR_not_sounding
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"    try 0: ant=0x%08x, antsel=%d, ness=%d\n"
argument_list|,
name|txc
operator|.
name|ds_ctl19
operator|&
name|AR_tx_ant0
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl19
argument_list|,
name|AR_tx_ant_sel0
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl19
argument_list|,
name|AR_ness
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl20 */
name|printf
argument_list|(
literal|"    try 1: TxPower=%d, ant=0x%08x, antsel=%d, ness=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl20
argument_list|,
name|AR_xmit_power1
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl20
operator|&
name|AR_tx_ant1
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl20
argument_list|,
name|AR_tx_ant_sel1
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl20
argument_list|,
name|AR_ness1
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl21 */
name|printf
argument_list|(
literal|"    try 2: TxPower=%d, ant=0x%08x, antsel=%d, ness=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl21
argument_list|,
name|AR_xmit_power2
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl21
operator|&
name|AR_tx_ant2
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl21
argument_list|,
name|AR_tx_ant_sel2
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl21
argument_list|,
name|AR_ness2
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ctl22 */
name|printf
argument_list|(
literal|"    try 3: TxPower=%d, ant=0x%08x, antsel=%d, ness=%d\n"
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl22
argument_list|,
name|AR_xmit_power3
argument_list|)
argument_list|,
name|txc
operator|.
name|ds_ctl22
operator|&
name|AR_tx_ant3
argument_list|,
name|MF
argument_list|(
name|txc
operator|.
name|ds_ctl22
argument_list|,
name|AR_tx_ant_sel3
argument_list|)
argument_list|,
name|MS
argument_list|(
name|txc
operator|.
name|ds_ctl22
argument_list|,
name|AR_ness3
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n ------ \n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ar9300_decode_rxstatus
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
name|struct
name|ar9300_rxs
name|rxs
decl_stmt|;
comment|/* XXX assumes rxs is smaller than PAYLOAD_LEN! */
name|memcpy
argument_list|(
operator|&
name|rxs
argument_list|,
operator|&
name|a
operator|->
name|payload
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_rxs
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%u.%06u] [%llu] RXSTATUS\n"
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ar9300_alq_payload
parameter_list|(
name|struct
name|if_ath_alq_payload
modifier|*
name|a
parameter_list|)
block|{
switch|switch
condition|(
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|op
argument_list|)
condition|)
block|{
case|case
name|ATH_ALQ_EDMA_TXSTATUS
case|:
comment|/* TXSTATUS */
name|ar9300_decode_txstatus
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|ATH_ALQ_EDMA_RXSTATUS
case|:
comment|/* RXSTATUS */
name|ar9300_decode_rxstatus
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|ATH_ALQ_EDMA_TXDESC
case|:
comment|/* TXDESC */
name|ar9300_decode_txdesc
argument_list|(
name|a
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"[%d.%06d] [%lld] op: %d; len %d\n"
argument_list|,
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_sec
argument_list|)
argument_list|,
name|be32toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|tstamp_usec
argument_list|)
argument_list|,
name|be64toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|threadid
argument_list|)
argument_list|,
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|op
argument_list|)
argument_list|,
name|be16toh
argument_list|(
name|a
operator|->
name|hdr
operator|.
name|len
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

