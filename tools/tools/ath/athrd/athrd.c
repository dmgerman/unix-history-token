begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002-2009 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"opt_ah.h"
end_include

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_include
include|#
directive|include
file|<net80211/_ieee80211.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_regdomain.h>
end_include

begin_include
include|#
directive|include
file|"ah_internal.h"
end_include

begin_include
include|#
directive|include
file|"ah_eeprom_v3.h"
end_include

begin_comment
comment|/* XXX */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_decl_stmt
name|int
name|ath_hal_debug
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_CTRY_CODE
name|cc
init|=
name|CTRY_DEFAULT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_REG_DOMAIN
name|rd
init|=
literal|169
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* FCC */
end_comment

begin_decl_stmt
name|HAL_BOOL
name|Amode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|Bmode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|Gmode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|HT20mode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|HT40mode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|turbo5Disable
init|=
name|AH_FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|HAL_BOOL
name|turbo2Disable
init|=
name|AH_FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_int16_t
name|_numCtls
init|=
literal|8
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_int16_t
name|_ctl
index|[
literal|32
index|]
init|=
block|{
literal|0x10
block|,
literal|0x13
block|,
literal|0x40
block|,
literal|0x30
block|,
literal|0x11
block|,
literal|0x31
block|,
literal|0x12
block|,
literal|0x32
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|RD_EDGES_POWER
name|_rdEdgesPower
index|[
name|NUM_EDGES
operator|*
name|NUM_CTLS
index|]
init|=
block|{
block|{
literal|5180
block|,
literal|28
block|,
literal|0
block|}
block|,
comment|/* 0x10 */
block|{
literal|5240
block|,
literal|60
block|,
literal|0
block|}
block|,
block|{
literal|5260
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5320
block|,
literal|27
block|,
literal|0
block|}
block|,
block|{
literal|5745
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5765
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5805
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5825
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5210
block|,
literal|28
block|,
literal|0
block|}
block|,
comment|/* 0x13 */
block|{
literal|5250
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|5290
block|,
literal|30
block|,
literal|0
block|}
block|,
block|{
literal|5760
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|5800
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|5170
block|,
literal|60
block|,
literal|0
block|}
block|,
comment|/* 0x40 */
block|{
literal|5230
block|,
literal|60
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|5180
block|,
literal|33
block|,
literal|0
block|}
block|,
comment|/* 0x30 */
block|{
literal|5320
block|,
literal|33
block|,
literal|0
block|}
block|,
block|{
literal|5500
block|,
literal|34
block|,
literal|0
block|}
block|,
block|{
literal|5700
block|,
literal|34
block|,
literal|0
block|}
block|,
block|{
literal|5745
block|,
literal|35
block|,
literal|0
block|}
block|,
block|{
literal|5765
block|,
literal|35
block|,
literal|0
block|}
block|,
block|{
literal|5785
block|,
literal|35
block|,
literal|0
block|}
block|,
block|{
literal|5825
block|,
literal|35
block|,
literal|0
block|}
block|,
block|{
literal|2412
block|,
literal|36
block|,
literal|0
block|}
block|,
comment|/* 0x11 */
block|{
literal|2417
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2422
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2432
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2442
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2457
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2467
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2472
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2412
block|,
literal|36
block|,
literal|0
block|}
block|,
comment|/* 0x31 */
block|{
literal|2417
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2422
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2432
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2442
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2457
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2467
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2472
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2412
block|,
literal|36
block|,
literal|0
block|}
block|,
comment|/* 0x12 */
block|{
literal|2417
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2422
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2432
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2442
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2457
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2467
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2472
block|,
literal|36
block|,
literal|0
block|}
block|,
block|{
literal|2412
block|,
literal|28
block|,
literal|0
block|}
block|,
comment|/* 0x32 */
block|{
literal|2417
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2422
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2432
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2442
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2457
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2467
block|,
literal|28
block|,
literal|0
block|}
block|,
block|{
literal|2472
block|,
literal|28
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_int16_t
name|turbo2WMaxPower5
init|=
literal|32
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_int16_t
name|turbo2WMaxPower2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int8_t
name|antennaGainMax
index|[
literal|2
index|]
init|=
block|{
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* XXX */
end_comment

begin_decl_stmt
name|int
name|eeversion
init|=
name|AR_EEPROM_VER3_1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|TRGT_POWER_ALL_MODES
name|tpow
init|=
block|{
literal|8
block|,
block|{
block|{
literal|22
block|,
literal|24
block|,
literal|28
block|,
literal|32
block|,
literal|5180
block|}
block|,
block|{
literal|22
block|,
literal|24
block|,
literal|28
block|,
literal|32
block|,
literal|5200
block|}
block|,
block|{
literal|22
block|,
literal|24
block|,
literal|28
block|,
literal|32
block|,
literal|5320
block|}
block|,
block|{
literal|26
block|,
literal|30
block|,
literal|34
block|,
literal|34
block|,
literal|5500
block|}
block|,
block|{
literal|26
block|,
literal|30
block|,
literal|34
block|,
literal|34
block|,
literal|5700
block|}
block|,
block|{
literal|20
block|,
literal|30
block|,
literal|34
block|,
literal|36
block|,
literal|5745
block|}
block|,
block|{
literal|20
block|,
literal|30
block|,
literal|34
block|,
literal|36
block|,
literal|5825
block|}
block|,
block|{
literal|20
block|,
literal|30
block|,
literal|34
block|,
literal|36
block|,
literal|5850
block|}
block|, 	}
block|,
literal|2
block|,
block|{
block|{
literal|23
block|,
literal|27
block|,
literal|31
block|,
literal|34
block|,
literal|2412
block|}
block|,
block|{
literal|23
block|,
literal|27
block|,
literal|31
block|,
literal|34
block|,
literal|2447
block|}
block|, 	}
block|,
literal|2
block|,
block|{
block|{
literal|36
block|,
literal|36
block|,
literal|36
block|,
literal|36
block|,
literal|2412
block|}
block|,
block|{
literal|36
block|,
literal|36
block|,
literal|36
block|,
literal|36
block|,
literal|2484
block|}
block|, 	}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|numTargetPwr_11a
value|tpow.numTargetPwr_11a
end_define

begin_define
define|#
directive|define
name|trgtPwr_11a
value|tpow.trgtPwr_11a
end_define

begin_define
define|#
directive|define
name|numTargetPwr_11g
value|tpow.numTargetPwr_11g
end_define

begin_define
define|#
directive|define
name|trgtPwr_11g
value|tpow.trgtPwr_11g
end_define

begin_define
define|#
directive|define
name|numTargetPwr_11b
value|tpow.numTargetPwr_11b
end_define

begin_define
define|#
directive|define
name|trgtPwr_11b
value|tpow.trgtPwr_11b
end_define

begin_function
specifier|static
name|HAL_BOOL
name|getChannelEdges
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int16_t
name|flags
parameter_list|,
name|u_int16_t
modifier|*
name|low
parameter_list|,
name|u_int16_t
modifier|*
name|high
parameter_list|)
block|{
name|struct
name|ath_hal_private
modifier|*
name|ahp
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|HAL_CAPABILITIES
modifier|*
name|pCap
init|=
operator|&
name|ahp
operator|->
name|ah_caps
decl_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_5GHZ
condition|)
block|{
operator|*
name|low
operator|=
name|pCap
operator|->
name|halLow5GhzChan
expr_stmt|;
operator|*
name|high
operator|=
name|pCap
operator|->
name|halHigh5GhzChan
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_2GHZ
condition|)
block|{
operator|*
name|low
operator|=
name|pCap
operator|->
name|halLow2GhzChan
expr_stmt|;
operator|*
name|high
operator|=
name|pCap
operator|->
name|halHigh2GhzChan
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
return|return
name|AH_FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|u_int
name|getWirelessModes
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|u_int
name|mode
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|Amode
condition|)
block|{
name|mode
operator|=
name|HAL_MODE_11A
expr_stmt|;
if|if
condition|(
operator|!
name|turbo5Disable
condition|)
name|mode
operator||=
name|HAL_MODE_TURBO
expr_stmt|;
block|}
if|if
condition|(
name|Bmode
condition|)
name|mode
operator||=
name|HAL_MODE_11B
expr_stmt|;
if|if
condition|(
name|Gmode
condition|)
block|{
name|mode
operator||=
name|HAL_MODE_11G
expr_stmt|;
if|if
condition|(
operator|!
name|turbo2Disable
condition|)
name|mode
operator||=
name|HAL_MODE_108G
expr_stmt|;
block|}
if|if
condition|(
name|HT20mode
condition|)
name|mode
operator||=
name|HAL_MODE_11NG_HT20
operator||
name|HAL_MODE_11NA_HT20
expr_stmt|;
if|if
condition|(
name|HT40mode
condition|)
name|mode
operator||=
name|HAL_MODE_11NG_HT40PLUS
operator||
name|HAL_MODE_11NA_HT40PLUS
operator||
name|HAL_MODE_11NG_HT40MINUS
operator||
name|HAL_MODE_11NA_HT40MINUS
expr_stmt|;
return|return
name|mode
return|;
block|}
end_function

begin_comment
comment|/* Enumerated Regulatory Domain Information 8 bit values indicate that  * the regdomain is really a pair of unitary regdomains.  12 bit values  * are the real unitary regdomains and are the only ones which have the  * frequency bitmasks and flags set.  */
end_comment

begin_enum
enum|enum
name|EnumRd
block|{
comment|/* 	 * The following regulatory domain definitions are 	 * found in the EEPROM. Each regulatory domain 	 * can operate in either a 5GHz or 2.4GHz wireless mode or 	 * both 5GHz and 2.4GHz wireless modes. 	 * In general, the value holds no special 	 * meaning and is used to decode into either specific 	 * 2.4GHz or 5GHz wireless mode for that particular 	 * regulatory domain. 	 */
name|NO_ENUMRD
init|=
literal|0x00
block|,
name|NULL1_WORLD
init|=
literal|0x03
block|,
comment|/* For 11b-only countries (no 11a allowed) */
name|NULL1_ETSIB
init|=
literal|0x07
block|,
comment|/* Israel */
name|NULL1_ETSIC
init|=
literal|0x08
block|,
name|FCC1_FCCA
init|=
literal|0x10
block|,
comment|/* USA */
name|FCC1_WORLD
init|=
literal|0x11
block|,
comment|/* Hong Kong */
name|FCC4_FCCA
init|=
literal|0x12
block|,
comment|/* USA - Public Safety */
name|FCC2_FCCA
init|=
literal|0x20
block|,
comment|/* Canada */
name|FCC2_WORLD
init|=
literal|0x21
block|,
comment|/* Australia& HK */
name|FCC2_ETSIC
init|=
literal|0x22
block|,
name|FRANCE_RES
init|=
literal|0x31
block|,
comment|/* Legacy France for OEM */
name|FCC3_FCCA
init|=
literal|0x3A
block|,
comment|/* USA& Canada w/5470 band, 11h, DFS enabled */
name|FCC3_WORLD
init|=
literal|0x3B
block|,
comment|/* USA& Canada w/5470 band, 11h, DFS enabled */
name|ETSI1_WORLD
init|=
literal|0x37
block|,
name|ETSI3_ETSIA
init|=
literal|0x32
block|,
comment|/* France (optional) */
name|ETSI2_WORLD
init|=
literal|0x35
block|,
comment|/* Hungary& others */
name|ETSI3_WORLD
init|=
literal|0x36
block|,
comment|/* France& others */
name|ETSI4_WORLD
init|=
literal|0x30
block|,
name|ETSI4_ETSIC
init|=
literal|0x38
block|,
name|ETSI5_WORLD
init|=
literal|0x39
block|,
name|ETSI6_WORLD
init|=
literal|0x34
block|,
comment|/* Bulgaria */
name|ETSI_RESERVED
init|=
literal|0x33
block|,
comment|/* Reserved (Do not used) */
name|MKK1_MKKA
init|=
literal|0x40
block|,
comment|/* Japan (JP1) */
name|MKK1_MKKB
init|=
literal|0x41
block|,
comment|/* Japan (JP0) */
name|APL4_WORLD
init|=
literal|0x42
block|,
comment|/* Singapore */
name|MKK2_MKKA
init|=
literal|0x43
block|,
comment|/* Japan with 4.9G channels */
name|APL_RESERVED
init|=
literal|0x44
block|,
comment|/* Reserved (Do not used)  */
name|APL2_WORLD
init|=
literal|0x45
block|,
comment|/* Korea */
name|APL2_APLC
init|=
literal|0x46
block|,
name|APL3_WORLD
init|=
literal|0x47
block|,
name|MKK1_FCCA
init|=
literal|0x48
block|,
comment|/* Japan (JP1-1) */
name|APL2_APLD
init|=
literal|0x49
block|,
comment|/* Korea with 2.3G channels */
name|MKK1_MKKA1
init|=
literal|0x4A
block|,
comment|/* Japan (JE1) */
name|MKK1_MKKA2
init|=
literal|0x4B
block|,
comment|/* Japan (JE2) */
name|MKK1_MKKC
init|=
literal|0x4C
block|,
comment|/* Japan (MKK1_MKKA,except Ch14) */
name|APL3_FCCA
init|=
literal|0x50
block|,
name|APL1_WORLD
init|=
literal|0x52
block|,
comment|/* Latin America */
name|APL1_FCCA
init|=
literal|0x53
block|,
name|APL1_APLA
init|=
literal|0x54
block|,
name|APL1_ETSIC
init|=
literal|0x55
block|,
name|APL2_ETSIC
init|=
literal|0x56
block|,
comment|/* Venezuela */
name|APL5_WORLD
init|=
literal|0x58
block|,
comment|/* Chile */
name|APL6_WORLD
init|=
literal|0x5B
block|,
comment|/* Singapore */
name|APL7_FCCA
init|=
literal|0x5C
block|,
comment|/* Taiwan 5.47 Band */
name|APL8_WORLD
init|=
literal|0x5D
block|,
comment|/* Malaysia 5GHz */
name|APL9_WORLD
init|=
literal|0x5E
block|,
comment|/* Korea 5GHz */
comment|/* 	 * World mode SKUs 	 */
name|WOR0_WORLD
init|=
literal|0x60
block|,
comment|/* World0 (WO0 SKU) */
name|WOR1_WORLD
init|=
literal|0x61
block|,
comment|/* World1 (WO1 SKU) */
name|WOR2_WORLD
init|=
literal|0x62
block|,
comment|/* World2 (WO2 SKU) */
name|WOR3_WORLD
init|=
literal|0x63
block|,
comment|/* World3 (WO3 SKU) */
name|WOR4_WORLD
init|=
literal|0x64
block|,
comment|/* World4 (WO4 SKU) */
name|WOR5_ETSIC
init|=
literal|0x65
block|,
comment|/* World5 (WO5 SKU) */
name|WOR01_WORLD
init|=
literal|0x66
block|,
comment|/* World0-1 (WW0-1 SKU) */
name|WOR02_WORLD
init|=
literal|0x67
block|,
comment|/* World0-2 (WW0-2 SKU) */
name|EU1_WORLD
init|=
literal|0x68
block|,
comment|/* Same as World0-2 (WW0-2 SKU), except active scan ch1-13. No ch14 */
name|WOR9_WORLD
init|=
literal|0x69
block|,
comment|/* World9 (WO9 SKU) */
name|WORA_WORLD
init|=
literal|0x6A
block|,
comment|/* WorldA (WOA SKU) */
name|MKK3_MKKB
init|=
literal|0x80
block|,
comment|/* Japan UNI-1 even + MKKB */
name|MKK3_MKKA2
init|=
literal|0x81
block|,
comment|/* Japan UNI-1 even + MKKA2 */
name|MKK3_MKKC
init|=
literal|0x82
block|,
comment|/* Japan UNI-1 even + MKKC */
name|MKK4_MKKB
init|=
literal|0x83
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKB */
name|MKK4_MKKA2
init|=
literal|0x84
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA2 */
name|MKK4_MKKC
init|=
literal|0x85
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKC */
name|MKK5_MKKB
init|=
literal|0x86
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKB */
name|MKK5_MKKA2
init|=
literal|0x87
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKA2 */
name|MKK5_MKKC
init|=
literal|0x88
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKC */
name|MKK6_MKKB
init|=
literal|0x89
block|,
comment|/* Japan UNI-1 even + UNI-1 odd MKKB */
name|MKK6_MKKA2
init|=
literal|0x8A
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + MKKA2 */
name|MKK6_MKKC
init|=
literal|0x8B
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + MKKC */
name|MKK7_MKKB
init|=
literal|0x8C
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKB */
name|MKK7_MKKA2
init|=
literal|0x8D
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKA2 */
name|MKK7_MKKC
init|=
literal|0x8E
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKC */
name|MKK8_MKKB
init|=
literal|0x8F
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKB */
name|MKK8_MKKA2
init|=
literal|0x90
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKA2 */
name|MKK8_MKKC
init|=
literal|0x91
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKC */
comment|/* Following definitions are used only by s/w to map old  	 * Japan SKUs. 	 */
name|MKK3_MKKA
init|=
literal|0xF0
block|,
comment|/* Japan UNI-1 even + MKKA */
name|MKK3_MKKA1
init|=
literal|0xF1
block|,
comment|/* Japan UNI-1 even + MKKA1 */
name|MKK3_FCCA
init|=
literal|0xF2
block|,
comment|/* Japan UNI-1 even + FCCA */
name|MKK4_MKKA
init|=
literal|0xF3
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA */
name|MKK4_MKKA1
init|=
literal|0xF4
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA1 */
name|MKK4_FCCA
init|=
literal|0xF5
block|,
comment|/* Japan UNI-1 even + UNI-2 + FCCA */
name|MKK9_MKKA
init|=
literal|0xF6
block|,
comment|/* Japan UNI-1 even + 4.9GHz */
name|MKK10_MKKA
init|=
literal|0xF7
block|,
comment|/* Japan UNI-1 even + UNI-2 + 4.9GHz */
comment|/* 	 * Regulator domains ending in a number (e.g. APL1, 	 * MK1, ETSI4, etc) apply to 5GHz channel and power 	 * information.  Regulator domains ending in a letter 	 * (e.g. APLA, FCCA, etc) apply to 2.4GHz channel and 	 * power information. 	 */
name|APL1
init|=
literal|0x0150
block|,
comment|/* LAT& Asia */
name|APL2
init|=
literal|0x0250
block|,
comment|/* LAT& Asia */
name|APL3
init|=
literal|0x0350
block|,
comment|/* Taiwan */
name|APL4
init|=
literal|0x0450
block|,
comment|/* Jordan */
name|APL5
init|=
literal|0x0550
block|,
comment|/* Chile */
name|APL6
init|=
literal|0x0650
block|,
comment|/* Singapore */
name|APL8
init|=
literal|0x0850
block|,
comment|/* Malaysia */
name|APL9
init|=
literal|0x0950
block|,
comment|/* Korea (South) ROC 3 */
name|ETSI1
init|=
literal|0x0130
block|,
comment|/* Europe& others */
name|ETSI2
init|=
literal|0x0230
block|,
comment|/* Europe& others */
name|ETSI3
init|=
literal|0x0330
block|,
comment|/* Europe& others */
name|ETSI4
init|=
literal|0x0430
block|,
comment|/* Europe& others */
name|ETSI5
init|=
literal|0x0530
block|,
comment|/* Europe& others */
name|ETSI6
init|=
literal|0x0630
block|,
comment|/* Europe& others */
name|ETSIA
init|=
literal|0x0A30
block|,
comment|/* France */
name|ETSIB
init|=
literal|0x0B30
block|,
comment|/* Israel */
name|ETSIC
init|=
literal|0x0C30
block|,
comment|/* Latin America */
name|FCC1
init|=
literal|0x0110
block|,
comment|/* US& others */
name|FCC2
init|=
literal|0x0120
block|,
comment|/* Canada, Australia& New Zealand */
name|FCC3
init|=
literal|0x0160
block|,
comment|/* US w/new middle band& DFS */
name|FCC4
init|=
literal|0x0165
block|,
comment|/* US Public Safety */
name|FCCA
init|=
literal|0x0A10
block|,
name|APLD
init|=
literal|0x0D50
block|,
comment|/* South Korea */
name|MKK1
init|=
literal|0x0140
block|,
comment|/* Japan (UNI-1 odd)*/
name|MKK2
init|=
literal|0x0240
block|,
comment|/* Japan (4.9 GHz + UNI-1 odd) */
name|MKK3
init|=
literal|0x0340
block|,
comment|/* Japan (UNI-1 even) */
name|MKK4
init|=
literal|0x0440
block|,
comment|/* Japan (UNI-1 even + UNI-2) */
name|MKK5
init|=
literal|0x0540
block|,
comment|/* Japan (UNI-1 even + UNI-2 + mid-band) */
name|MKK6
init|=
literal|0x0640
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even) */
name|MKK7
init|=
literal|0x0740
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even + UNI-2 */
name|MKK8
init|=
literal|0x0840
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even + UNI-2 + mid-band) */
name|MKK9
init|=
literal|0x0940
block|,
comment|/* Japan (UNI-1 even + 4.9 GHZ) */
name|MKK10
init|=
literal|0x0B40
block|,
comment|/* Japan (UNI-1 even + UNI-2 + 4.9 GHZ) */
name|MKKA
init|=
literal|0x0A40
block|,
comment|/* Japan */
name|MKKC
init|=
literal|0x0A50
block|,
name|NULL1
init|=
literal|0x0198
block|,
name|WORLD
init|=
literal|0x0199
block|,
name|DEBUG_REG_DMN
init|=
literal|0x01ff
block|, }
enum|;
end_enum

begin_define
define|#
directive|define
name|DEF_REGDMN
value|FCC1_FCCA
end_define

begin_struct
specifier|static
struct|struct
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|HAL_REG_DOMAIN
name|rd
decl_stmt|;
block|}
name|domains
index|[]
init|=
block|{
define|#
directive|define
name|D
parameter_list|(
name|_x
parameter_list|)
value|{ #_x, _x }
name|D
argument_list|(
name|NO_ENUMRD
argument_list|)
block|,
name|D
argument_list|(
name|NULL1_WORLD
argument_list|)
block|,
comment|/* For 11b-only countries (no 11a allowed) */
name|D
argument_list|(
name|NULL1_ETSIB
argument_list|)
block|,
comment|/* Israel */
name|D
argument_list|(
name|NULL1_ETSIC
argument_list|)
block|,
name|D
argument_list|(
name|FCC1_FCCA
argument_list|)
block|,
comment|/* USA */
name|D
argument_list|(
name|FCC1_WORLD
argument_list|)
block|,
comment|/* Hong Kong */
name|D
argument_list|(
name|FCC4_FCCA
argument_list|)
block|,
comment|/* USA - Public Safety */
name|D
argument_list|(
name|FCC2_FCCA
argument_list|)
block|,
comment|/* Canada */
name|D
argument_list|(
name|FCC2_WORLD
argument_list|)
block|,
comment|/* Australia& HK */
name|D
argument_list|(
name|FCC2_ETSIC
argument_list|)
block|,
name|D
argument_list|(
name|FRANCE_RES
argument_list|)
block|,
comment|/* Legacy France for OEM */
name|D
argument_list|(
name|FCC3_FCCA
argument_list|)
block|,
name|D
argument_list|(
name|FCC3_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|ETSI1_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|ETSI3_ETSIA
argument_list|)
block|,
comment|/* France (optional) */
name|D
argument_list|(
name|ETSI2_WORLD
argument_list|)
block|,
comment|/* Hungary& others */
name|D
argument_list|(
name|ETSI3_WORLD
argument_list|)
block|,
comment|/* France& others */
name|D
argument_list|(
name|ETSI4_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|ETSI4_ETSIC
argument_list|)
block|,
name|D
argument_list|(
name|ETSI5_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|ETSI6_WORLD
argument_list|)
block|,
comment|/* Bulgaria */
name|D
argument_list|(
name|ETSI_RESERVED
argument_list|)
block|,
comment|/* Reserved (Do not used) */
name|D
argument_list|(
name|MKK1_MKKA
argument_list|)
block|,
comment|/* Japan (JP1) */
name|D
argument_list|(
name|MKK1_MKKB
argument_list|)
block|,
comment|/* Japan (JP0) */
name|D
argument_list|(
name|APL4_WORLD
argument_list|)
block|,
comment|/* Singapore */
name|D
argument_list|(
name|MKK2_MKKA
argument_list|)
block|,
comment|/* Japan with 4.9G channels */
name|D
argument_list|(
name|APL_RESERVED
argument_list|)
block|,
comment|/* Reserved (Do not used)  */
name|D
argument_list|(
name|APL2_WORLD
argument_list|)
block|,
comment|/* Korea */
name|D
argument_list|(
name|APL2_APLC
argument_list|)
block|,
name|D
argument_list|(
name|APL3_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|MKK1_FCCA
argument_list|)
block|,
comment|/* Japan (JP1-1) */
name|D
argument_list|(
name|APL2_APLD
argument_list|)
block|,
comment|/* Korea with 2.3G channels */
name|D
argument_list|(
name|MKK1_MKKA1
argument_list|)
block|,
comment|/* Japan (JE1) */
name|D
argument_list|(
name|MKK1_MKKA2
argument_list|)
block|,
comment|/* Japan (JE2) */
name|D
argument_list|(
name|MKK1_MKKC
argument_list|)
block|,
name|D
argument_list|(
name|APL3_FCCA
argument_list|)
block|,
name|D
argument_list|(
name|APL1_WORLD
argument_list|)
block|,
comment|/* Latin America */
name|D
argument_list|(
name|APL1_FCCA
argument_list|)
block|,
name|D
argument_list|(
name|APL1_APLA
argument_list|)
block|,
name|D
argument_list|(
name|APL1_ETSIC
argument_list|)
block|,
name|D
argument_list|(
name|APL2_ETSIC
argument_list|)
block|,
comment|/* Venezuela */
name|D
argument_list|(
name|APL5_WORLD
argument_list|)
block|,
comment|/* Chile */
name|D
argument_list|(
name|APL6_WORLD
argument_list|)
block|,
comment|/* Singapore */
name|D
argument_list|(
name|APL7_FCCA
argument_list|)
block|,
comment|/* Taiwan 5.47 Band */
name|D
argument_list|(
name|APL8_WORLD
argument_list|)
block|,
comment|/* Malaysia 5GHz */
name|D
argument_list|(
name|APL9_WORLD
argument_list|)
block|,
comment|/* Korea 5GHz */
name|D
argument_list|(
name|WOR0_WORLD
argument_list|)
block|,
comment|/* World0 (WO0 SKU) */
name|D
argument_list|(
name|WOR1_WORLD
argument_list|)
block|,
comment|/* World1 (WO1 SKU) */
name|D
argument_list|(
name|WOR2_WORLD
argument_list|)
block|,
comment|/* World2 (WO2 SKU) */
name|D
argument_list|(
name|WOR3_WORLD
argument_list|)
block|,
comment|/* World3 (WO3 SKU) */
name|D
argument_list|(
name|WOR4_WORLD
argument_list|)
block|,
comment|/* World4 (WO4 SKU) */
name|D
argument_list|(
name|WOR5_ETSIC
argument_list|)
block|,
comment|/* World5 (WO5 SKU) */
name|D
argument_list|(
name|WOR01_WORLD
argument_list|)
block|,
comment|/* World0-1 (WW0-1 SKU) */
name|D
argument_list|(
name|WOR02_WORLD
argument_list|)
block|,
comment|/* World0-2 (WW0-2 SKU) */
name|D
argument_list|(
name|EU1_WORLD
argument_list|)
block|,
name|D
argument_list|(
name|WOR9_WORLD
argument_list|)
block|,
comment|/* World9 (WO9 SKU) */
name|D
argument_list|(
name|WORA_WORLD
argument_list|)
block|,
comment|/* WorldA (WOA SKU) */
name|D
argument_list|(
name|MKK3_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + MKKB */
name|D
argument_list|(
name|MKK3_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + MKKA2 */
name|D
argument_list|(
name|MKK3_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + MKKC */
name|D
argument_list|(
name|MKK4_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKB */
name|D
argument_list|(
name|MKK4_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA2 */
name|D
argument_list|(
name|MKK4_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKC */
name|D
argument_list|(
name|MKK5_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKB */
name|D
argument_list|(
name|MKK5_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKA2 */
name|D
argument_list|(
name|MKK5_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + mid-band + MKKC */
name|D
argument_list|(
name|MKK6_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd MKKB */
name|D
argument_list|(
name|MKK6_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + MKKA2 */
name|D
argument_list|(
name|MKK6_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + MKKC */
name|D
argument_list|(
name|MKK7_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKB */
name|D
argument_list|(
name|MKK7_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKA2 */
name|D
argument_list|(
name|MKK7_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + MKKC */
name|D
argument_list|(
name|MKK8_MKKB
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKB */
name|D
argument_list|(
name|MKK8_MKKA2
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKA2 */
name|D
argument_list|(
name|MKK8_MKKC
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-1 odd + UNI-2 + mid-band + MKKC */
name|D
argument_list|(
name|MKK3_MKKA
argument_list|)
block|,
comment|/* Japan UNI-1 even + MKKA */
name|D
argument_list|(
name|MKK3_MKKA1
argument_list|)
block|,
comment|/* Japan UNI-1 even + MKKA1 */
name|D
argument_list|(
name|MKK3_FCCA
argument_list|)
block|,
comment|/* Japan UNI-1 even + FCCA */
name|D
argument_list|(
name|MKK4_MKKA
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA */
name|D
argument_list|(
name|MKK4_MKKA1
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + MKKA1 */
name|D
argument_list|(
name|MKK4_FCCA
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + FCCA */
name|D
argument_list|(
name|MKK9_MKKA
argument_list|)
block|,
comment|/* Japan UNI-1 even + 4.9GHz */
name|D
argument_list|(
name|MKK10_MKKA
argument_list|)
block|,
comment|/* Japan UNI-1 even + UNI-2 + 4.9GHz */
name|D
argument_list|(
name|APL1
argument_list|)
block|,
comment|/* LAT& Asia */
name|D
argument_list|(
name|APL2
argument_list|)
block|,
comment|/* LAT& Asia */
name|D
argument_list|(
name|APL3
argument_list|)
block|,
comment|/* Taiwan */
name|D
argument_list|(
name|APL4
argument_list|)
block|,
comment|/* Jordan */
name|D
argument_list|(
name|APL5
argument_list|)
block|,
comment|/* Chile */
name|D
argument_list|(
name|APL6
argument_list|)
block|,
comment|/* Singapore */
name|D
argument_list|(
name|APL8
argument_list|)
block|,
comment|/* Malaysia */
name|D
argument_list|(
name|APL9
argument_list|)
block|,
comment|/* Korea (South) ROC 3 */
name|D
argument_list|(
name|ETSI1
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSI2
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSI3
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSI4
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSI5
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSI6
argument_list|)
block|,
comment|/* Europe& others */
name|D
argument_list|(
name|ETSIA
argument_list|)
block|,
comment|/* France */
name|D
argument_list|(
name|ETSIB
argument_list|)
block|,
comment|/* Israel */
name|D
argument_list|(
name|ETSIC
argument_list|)
block|,
comment|/* Latin America */
name|D
argument_list|(
name|FCC1
argument_list|)
block|,
comment|/* US& others */
name|D
argument_list|(
name|FCC2
argument_list|)
block|,
name|D
argument_list|(
name|FCC3
argument_list|)
block|,
comment|/* US w/new middle band& DFS */
name|D
argument_list|(
name|FCC4
argument_list|)
block|,
comment|/* US Public Safety */
name|D
argument_list|(
name|FCCA
argument_list|)
block|,
name|D
argument_list|(
name|APLD
argument_list|)
block|,
comment|/* South Korea */
name|D
argument_list|(
name|MKK1
argument_list|)
block|,
comment|/* Japan (UNI-1 odd)*/
name|D
argument_list|(
name|MKK2
argument_list|)
block|,
comment|/* Japan (4.9 GHz + UNI-1 odd) */
name|D
argument_list|(
name|MKK3
argument_list|)
block|,
comment|/* Japan (UNI-1 even) */
name|D
argument_list|(
name|MKK4
argument_list|)
block|,
comment|/* Japan (UNI-1 even + UNI-2) */
name|D
argument_list|(
name|MKK5
argument_list|)
block|,
comment|/* Japan (UNI-1 even + UNI-2 + mid-band) */
name|D
argument_list|(
name|MKK6
argument_list|)
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even) */
name|D
argument_list|(
name|MKK7
argument_list|)
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even + UNI-2 */
name|D
argument_list|(
name|MKK8
argument_list|)
block|,
comment|/* Japan (UNI-1 odd + UNI-1 even + UNI-2 + mid-band) */
name|D
argument_list|(
name|MKK9
argument_list|)
block|,
comment|/* Japan (UNI-1 even + 4.9 GHZ) */
name|D
argument_list|(
name|MKK10
argument_list|)
block|,
comment|/* Japan (UNI-1 even + UNI-2 + 4.9 GHZ) */
name|D
argument_list|(
name|MKKA
argument_list|)
block|,
comment|/* Japan */
name|D
argument_list|(
name|MKKC
argument_list|)
block|,
name|D
argument_list|(
name|NULL1
argument_list|)
block|,
name|D
argument_list|(
name|WORLD
argument_list|)
block|,
name|D
argument_list|(
name|DEBUG_REG_DMN
argument_list|)
block|,
undef|#
directive|undef
name|D
block|}
struct|;
end_struct

begin_function
specifier|static
name|HAL_BOOL
name|rdlookup
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|HAL_REG_DOMAIN
modifier|*
name|rd
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|domains
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcasecmp
argument_list|(
name|domains
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|rd
operator|=
name|domains
index|[
name|i
index|]
operator|.
name|rd
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
return|return
name|AH_FALSE
return|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|getrdname
parameter_list|(
name|HAL_REG_DOMAIN
name|rd
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|domains
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|domains
index|[
name|i
index|]
operator|.
name|rd
operator|==
name|rd
condition|)
return|return
name|domains
index|[
name|i
index|]
operator|.
name|name
return|;
return|return
name|NULL
return|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
name|void
name|rdlist
parameter_list|()
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"\nRegulatory domains:\n\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|domains
argument_list|)
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%-15s%s"
argument_list|,
name|domains
index|[
name|i
index|]
operator|.
name|name
argument_list|,
operator|(
operator|(
name|i
operator|+
literal|1
operator|)
operator|%
literal|5
operator|)
operator|==
literal|0
condition|?
literal|"\n"
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|N
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
block|{
name|HAL_CTRY_CODE
name|countryCode
decl_stmt|;
name|HAL_REG_DOMAIN
name|regDmnEnum
decl_stmt|;
specifier|const
name|char
modifier|*
name|isoName
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
block|}
name|COUNTRY_CODE_TO_ENUM_RD
typedef|;
end_typedef

begin_comment
comment|/*  * Country Code Table to Enumerated RD  */
end_comment

begin_decl_stmt
specifier|static
name|COUNTRY_CODE_TO_ENUM_RD
name|allCountries
index|[]
init|=
block|{
block|{
name|CTRY_DEBUG
block|,
name|NO_ENUMRD
block|,
literal|"DB"
block|,
literal|"DEBUG"
block|}
block|,
block|{
name|CTRY_DEFAULT
block|,
name|DEF_REGDMN
block|,
literal|"NA"
block|,
literal|"NO_COUNTRY_SET"
block|}
block|,
block|{
name|CTRY_ALBANIA
block|,
name|NULL1_WORLD
block|,
literal|"AL"
block|,
literal|"ALBANIA"
block|}
block|,
block|{
name|CTRY_ALGERIA
block|,
name|NULL1_WORLD
block|,
literal|"DZ"
block|,
literal|"ALGERIA"
block|}
block|,
block|{
name|CTRY_ARGENTINA
block|,
name|APL3_WORLD
block|,
literal|"AR"
block|,
literal|"ARGENTINA"
block|}
block|,
block|{
name|CTRY_ARMENIA
block|,
name|ETSI4_WORLD
block|,
literal|"AM"
block|,
literal|"ARMENIA"
block|}
block|,
block|{
name|CTRY_AUSTRALIA
block|,
name|FCC2_WORLD
block|,
literal|"AU"
block|,
literal|"AUSTRALIA"
block|}
block|,
block|{
name|CTRY_AUSTRIA
block|,
name|ETSI1_WORLD
block|,
literal|"AT"
block|,
literal|"AUSTRIA"
block|}
block|,
block|{
name|CTRY_AZERBAIJAN
block|,
name|ETSI4_WORLD
block|,
literal|"AZ"
block|,
literal|"AZERBAIJAN"
block|}
block|,
block|{
name|CTRY_BAHRAIN
block|,
name|APL6_WORLD
block|,
literal|"BH"
block|,
literal|"BAHRAIN"
block|}
block|,
block|{
name|CTRY_BELARUS
block|,
name|NULL1_WORLD
block|,
literal|"BY"
block|,
literal|"BELARUS"
block|}
block|,
block|{
name|CTRY_BELGIUM
block|,
name|ETSI1_WORLD
block|,
literal|"BE"
block|,
literal|"BELGIUM"
block|}
block|,
block|{
name|CTRY_BELIZE
block|,
name|APL1_ETSIC
block|,
literal|"BZ"
block|,
literal|"BELIZE"
block|}
block|,
block|{
name|CTRY_BOLIVIA
block|,
name|APL1_ETSIC
block|,
literal|"BO"
block|,
literal|"BOLVIA"
block|}
block|,
block|{
name|CTRY_BRAZIL
block|,
name|FCC3_WORLD
block|,
literal|"BR"
block|,
literal|"BRAZIL"
block|}
block|,
block|{
name|CTRY_BRUNEI_DARUSSALAM
block|,
name|APL1_WORLD
block|,
literal|"BN"
block|,
literal|"BRUNEI DARUSSALAM"
block|}
block|,
block|{
name|CTRY_BULGARIA
block|,
name|ETSI6_WORLD
block|,
literal|"BG"
block|,
literal|"BULGARIA"
block|}
block|,
block|{
name|CTRY_CANADA
block|,
name|FCC2_FCCA
block|,
literal|"CA"
block|,
literal|"CANADA"
block|}
block|,
block|{
name|CTRY_CHILE
block|,
name|APL6_WORLD
block|,
literal|"CL"
block|,
literal|"CHILE"
block|}
block|,
block|{
name|CTRY_CHINA
block|,
name|APL1_WORLD
block|,
literal|"CN"
block|,
literal|"CHINA"
block|}
block|,
block|{
name|CTRY_COLOMBIA
block|,
name|FCC1_FCCA
block|,
literal|"CO"
block|,
literal|"COLOMBIA"
block|}
block|,
block|{
name|CTRY_COSTA_RICA
block|,
name|NULL1_WORLD
block|,
literal|"CR"
block|,
literal|"COSTA RICA"
block|}
block|,
block|{
name|CTRY_CROATIA
block|,
name|ETSI3_WORLD
block|,
literal|"HR"
block|,
literal|"CROATIA"
block|}
block|,
block|{
name|CTRY_CYPRUS
block|,
name|ETSI1_WORLD
block|,
literal|"CY"
block|,
literal|"CYPRUS"
block|}
block|,
block|{
name|CTRY_CZECH
block|,
name|ETSI3_WORLD
block|,
literal|"CZ"
block|,
literal|"CZECH REPUBLIC"
block|}
block|,
block|{
name|CTRY_DENMARK
block|,
name|ETSI1_WORLD
block|,
literal|"DK"
block|,
literal|"DENMARK"
block|}
block|,
block|{
name|CTRY_DOMINICAN_REPUBLIC
block|,
name|FCC1_FCCA
block|,
literal|"DO"
block|,
literal|"DOMINICAN REPUBLIC"
block|}
block|,
block|{
name|CTRY_ECUADOR
block|,
name|NULL1_WORLD
block|,
literal|"EC"
block|,
literal|"ECUADOR"
block|}
block|,
block|{
name|CTRY_EGYPT
block|,
name|ETSI3_WORLD
block|,
literal|"EG"
block|,
literal|"EGYPT"
block|}
block|,
block|{
name|CTRY_EL_SALVADOR
block|,
name|NULL1_WORLD
block|,
literal|"SV"
block|,
literal|"EL SALVADOR"
block|}
block|,
block|{
name|CTRY_ESTONIA
block|,
name|ETSI1_WORLD
block|,
literal|"EE"
block|,
literal|"ESTONIA"
block|}
block|,
block|{
name|CTRY_FINLAND
block|,
name|ETSI1_WORLD
block|,
literal|"FI"
block|,
literal|"FINLAND"
block|}
block|,
block|{
name|CTRY_FRANCE
block|,
name|ETSI3_WORLD
block|,
literal|"FR"
block|,
literal|"FRANCE"
block|}
block|,
block|{
name|CTRY_FRANCE2
block|,
name|ETSI3_WORLD
block|,
literal|"F2"
block|,
literal|"FRANCE_RES"
block|}
block|,
block|{
name|CTRY_GEORGIA
block|,
name|ETSI4_WORLD
block|,
literal|"GE"
block|,
literal|"GEORGIA"
block|}
block|,
block|{
name|CTRY_GERMANY
block|,
name|ETSI1_WORLD
block|,
literal|"DE"
block|,
literal|"GERMANY"
block|}
block|,
block|{
name|CTRY_GREECE
block|,
name|ETSI1_WORLD
block|,
literal|"GR"
block|,
literal|"GREECE"
block|}
block|,
block|{
name|CTRY_GUATEMALA
block|,
name|FCC1_FCCA
block|,
literal|"GT"
block|,
literal|"GUATEMALA"
block|}
block|,
block|{
name|CTRY_HONDURAS
block|,
name|NULL1_WORLD
block|,
literal|"HN"
block|,
literal|"HONDURAS"
block|}
block|,
block|{
name|CTRY_HONG_KONG
block|,
name|FCC2_WORLD
block|,
literal|"HK"
block|,
literal|"HONG KONG"
block|}
block|,
block|{
name|CTRY_HUNGARY
block|,
name|ETSI1_WORLD
block|,
literal|"HU"
block|,
literal|"HUNGARY"
block|}
block|,
block|{
name|CTRY_ICELAND
block|,
name|ETSI1_WORLD
block|,
literal|"IS"
block|,
literal|"ICELAND"
block|}
block|,
block|{
name|CTRY_INDIA
block|,
name|APL6_WORLD
block|,
literal|"IN"
block|,
literal|"INDIA"
block|}
block|,
block|{
name|CTRY_INDONESIA
block|,
name|APL1_WORLD
block|,
literal|"ID"
block|,
literal|"INDONESIA"
block|}
block|,
block|{
name|CTRY_IRAN
block|,
name|APL1_WORLD
block|,
literal|"IR"
block|,
literal|"IRAN"
block|}
block|,
block|{
name|CTRY_IRELAND
block|,
name|ETSI1_WORLD
block|,
literal|"IE"
block|,
literal|"IRELAND"
block|}
block|,
block|{
name|CTRY_ISRAEL
block|,
name|NULL1_WORLD
block|,
literal|"IL"
block|,
literal|"ISRAEL"
block|}
block|,
block|{
name|CTRY_ITALY
block|,
name|ETSI1_WORLD
block|,
literal|"IT"
block|,
literal|"ITALY"
block|}
block|,
block|{
name|CTRY_JAPAN
block|,
name|MKK1_MKKA
block|,
literal|"JP"
block|,
literal|"JAPAN"
block|}
block|,
block|{
name|CTRY_JAPAN1
block|,
name|MKK1_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN1"
block|}
block|,
block|{
name|CTRY_JAPAN2
block|,
name|MKK1_FCCA
block|,
literal|"JP"
block|,
literal|"JAPAN2"
block|}
block|,
block|{
name|CTRY_JAPAN3
block|,
name|MKK2_MKKA
block|,
literal|"JP"
block|,
literal|"JAPAN3"
block|}
block|,
block|{
name|CTRY_JAPAN4
block|,
name|MKK1_MKKA1
block|,
literal|"JP"
block|,
literal|"JAPAN4"
block|}
block|,
block|{
name|CTRY_JAPAN5
block|,
name|MKK1_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN5"
block|}
block|,
block|{
name|CTRY_JAPAN6
block|,
name|MKK1_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN6"
block|}
block|,
block|{
name|CTRY_JAPAN7
block|,
name|MKK3_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN7"
block|}
block|,
block|{
name|CTRY_JAPAN8
block|,
name|MKK3_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN8"
block|}
block|,
block|{
name|CTRY_JAPAN9
block|,
name|MKK3_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN9"
block|}
block|,
block|{
name|CTRY_JAPAN10
block|,
name|MKK4_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN10"
block|}
block|,
block|{
name|CTRY_JAPAN11
block|,
name|MKK4_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN11"
block|}
block|,
block|{
name|CTRY_JAPAN12
block|,
name|MKK4_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN12"
block|}
block|,
block|{
name|CTRY_JAPAN13
block|,
name|MKK5_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN13"
block|}
block|,
block|{
name|CTRY_JAPAN14
block|,
name|MKK5_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN14"
block|}
block|,
block|{
name|CTRY_JAPAN15
block|,
name|MKK5_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN15"
block|}
block|,
block|{
name|CTRY_JAPAN16
block|,
name|MKK6_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN16"
block|}
block|,
block|{
name|CTRY_JAPAN17
block|,
name|MKK6_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN17"
block|}
block|,
block|{
name|CTRY_JAPAN18
block|,
name|MKK6_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN18"
block|}
block|,
block|{
name|CTRY_JAPAN19
block|,
name|MKK7_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN19"
block|}
block|,
block|{
name|CTRY_JAPAN20
block|,
name|MKK7_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN20"
block|}
block|,
block|{
name|CTRY_JAPAN21
block|,
name|MKK7_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN21"
block|}
block|,
block|{
name|CTRY_JAPAN22
block|,
name|MKK8_MKKB
block|,
literal|"JP"
block|,
literal|"JAPAN22"
block|}
block|,
block|{
name|CTRY_JAPAN23
block|,
name|MKK8_MKKA2
block|,
literal|"JP"
block|,
literal|"JAPAN23"
block|}
block|,
block|{
name|CTRY_JAPAN24
block|,
name|MKK8_MKKC
block|,
literal|"JP"
block|,
literal|"JAPAN24"
block|}
block|,
block|{
name|CTRY_JORDAN
block|,
name|APL4_WORLD
block|,
literal|"JO"
block|,
literal|"JORDAN"
block|}
block|,
block|{
name|CTRY_KAZAKHSTAN
block|,
name|NULL1_WORLD
block|,
literal|"KZ"
block|,
literal|"KAZAKHSTAN"
block|}
block|,
block|{
name|CTRY_KOREA_NORTH
block|,
name|APL2_WORLD
block|,
literal|"KP"
block|,
literal|"NORTH KOREA"
block|}
block|,
block|{
name|CTRY_KOREA_ROC
block|,
name|APL2_WORLD
block|,
literal|"KR"
block|,
literal|"KOREA REPUBLIC"
block|}
block|,
block|{
name|CTRY_KOREA_ROC2
block|,
name|APL2_WORLD
block|,
literal|"K2"
block|,
literal|"KOREA REPUBLIC2"
block|}
block|,
block|{
name|CTRY_KOREA_ROC3
block|,
name|APL9_WORLD
block|,
literal|"K3"
block|,
literal|"KOREA REPUBLIC3"
block|}
block|,
block|{
name|CTRY_KUWAIT
block|,
name|NULL1_WORLD
block|,
literal|"KW"
block|,
literal|"KUWAIT"
block|}
block|,
block|{
name|CTRY_LATVIA
block|,
name|ETSI1_WORLD
block|,
literal|"LV"
block|,
literal|"LATVIA"
block|}
block|,
block|{
name|CTRY_LEBANON
block|,
name|NULL1_WORLD
block|,
literal|"LB"
block|,
literal|"LEBANON"
block|}
block|,
block|{
name|CTRY_LIECHTENSTEIN
block|,
name|ETSI1_WORLD
block|,
literal|"LI"
block|,
literal|"LIECHTENSTEIN"
block|}
block|,
block|{
name|CTRY_LITHUANIA
block|,
name|ETSI1_WORLD
block|,
literal|"LT"
block|,
literal|"LITHUANIA"
block|}
block|,
block|{
name|CTRY_LUXEMBOURG
block|,
name|ETSI1_WORLD
block|,
literal|"LU"
block|,
literal|"LUXEMBOURG"
block|}
block|,
block|{
name|CTRY_MACAU
block|,
name|FCC2_WORLD
block|,
literal|"MO"
block|,
literal|"MACAU"
block|}
block|,
block|{
name|CTRY_MACEDONIA
block|,
name|NULL1_WORLD
block|,
literal|"MK"
block|,
literal|"MACEDONIA"
block|}
block|,
block|{
name|CTRY_MALAYSIA
block|,
name|APL8_WORLD
block|,
literal|"MY"
block|,
literal|"MALAYSIA"
block|}
block|,
block|{
name|CTRY_MALTA
block|,
name|ETSI1_WORLD
block|,
literal|"MT"
block|,
literal|"MALTA"
block|}
block|,
block|{
name|CTRY_MEXICO
block|,
name|FCC1_FCCA
block|,
literal|"MX"
block|,
literal|"MEXICO"
block|}
block|,
block|{
name|CTRY_MONACO
block|,
name|ETSI4_WORLD
block|,
literal|"MC"
block|,
literal|"MONACO"
block|}
block|,
block|{
name|CTRY_MOROCCO
block|,
name|NULL1_WORLD
block|,
literal|"MA"
block|,
literal|"MOROCCO"
block|}
block|,
block|{
name|CTRY_NETHERLANDS
block|,
name|ETSI1_WORLD
block|,
literal|"NL"
block|,
literal|"NETHERLANDS"
block|}
block|,
block|{
name|CTRY_NEW_ZEALAND
block|,
name|FCC2_ETSIC
block|,
literal|"NZ"
block|,
literal|"NEW ZEALAND"
block|}
block|,
block|{
name|CTRY_NORWAY
block|,
name|ETSI1_WORLD
block|,
literal|"NO"
block|,
literal|"NORWAY"
block|}
block|,
block|{
name|CTRY_OMAN
block|,
name|APL6_WORLD
block|,
literal|"OM"
block|,
literal|"OMAN"
block|}
block|,
block|{
name|CTRY_PAKISTAN
block|,
name|NULL1_WORLD
block|,
literal|"PK"
block|,
literal|"PAKISTAN"
block|}
block|,
block|{
name|CTRY_PANAMA
block|,
name|FCC1_FCCA
block|,
literal|"PA"
block|,
literal|"PANAMA"
block|}
block|,
block|{
name|CTRY_PERU
block|,
name|APL1_WORLD
block|,
literal|"PE"
block|,
literal|"PERU"
block|}
block|,
block|{
name|CTRY_PHILIPPINES
block|,
name|APL1_WORLD
block|,
literal|"PH"
block|,
literal|"PHILIPPINES"
block|}
block|,
block|{
name|CTRY_POLAND
block|,
name|ETSI1_WORLD
block|,
literal|"PL"
block|,
literal|"POLAND"
block|}
block|,
block|{
name|CTRY_PORTUGAL
block|,
name|ETSI1_WORLD
block|,
literal|"PT"
block|,
literal|"PORTUGAL"
block|}
block|,
block|{
name|CTRY_PUERTO_RICO
block|,
name|FCC1_FCCA
block|,
literal|"PR"
block|,
literal|"PUERTO RICO"
block|}
block|,
block|{
name|CTRY_QATAR
block|,
name|NULL1_WORLD
block|,
literal|"QA"
block|,
literal|"QATAR"
block|}
block|,
block|{
name|CTRY_ROMANIA
block|,
name|NULL1_WORLD
block|,
literal|"RO"
block|,
literal|"ROMANIA"
block|}
block|,
block|{
name|CTRY_RUSSIA
block|,
name|NULL1_WORLD
block|,
literal|"RU"
block|,
literal|"RUSSIA"
block|}
block|,
block|{
name|CTRY_SAUDI_ARABIA
block|,
name|NULL1_WORLD
block|,
literal|"SA"
block|,
literal|"SAUDI ARABIA"
block|}
block|,
block|{
name|CTRY_SINGAPORE
block|,
name|APL6_WORLD
block|,
literal|"SG"
block|,
literal|"SINGAPORE"
block|}
block|,
block|{
name|CTRY_SLOVAKIA
block|,
name|ETSI1_WORLD
block|,
literal|"SK"
block|,
literal|"SLOVAK REPUBLIC"
block|}
block|,
block|{
name|CTRY_SLOVENIA
block|,
name|ETSI1_WORLD
block|,
literal|"SI"
block|,
literal|"SLOVENIA"
block|}
block|,
block|{
name|CTRY_SOUTH_AFRICA
block|,
name|FCC3_WORLD
block|,
literal|"ZA"
block|,
literal|"SOUTH AFRICA"
block|}
block|,
block|{
name|CTRY_SPAIN
block|,
name|ETSI1_WORLD
block|,
literal|"ES"
block|,
literal|"SPAIN"
block|}
block|,
block|{
name|CTRY_SWEDEN
block|,
name|ETSI1_WORLD
block|,
literal|"SE"
block|,
literal|"SWEDEN"
block|}
block|,
block|{
name|CTRY_SWITZERLAND
block|,
name|ETSI1_WORLD
block|,
literal|"CH"
block|,
literal|"SWITZERLAND"
block|}
block|,
block|{
name|CTRY_SYRIA
block|,
name|NULL1_WORLD
block|,
literal|"SY"
block|,
literal|"SYRIA"
block|}
block|,
block|{
name|CTRY_TAIWAN
block|,
name|APL3_FCCA
block|,
literal|"TW"
block|,
literal|"TAIWAN"
block|}
block|,
block|{
name|CTRY_THAILAND
block|,
name|NULL1_WORLD
block|,
literal|"TH"
block|,
literal|"THAILAND"
block|}
block|,
block|{
name|CTRY_TRINIDAD_Y_TOBAGO
block|,
name|ETSI4_WORLD
block|,
literal|"TT"
block|,
literal|"TRINIDAD& TOBAGO"
block|}
block|,
block|{
name|CTRY_TUNISIA
block|,
name|ETSI3_WORLD
block|,
literal|"TN"
block|,
literal|"TUNISIA"
block|}
block|,
block|{
name|CTRY_TURKEY
block|,
name|ETSI3_WORLD
block|,
literal|"TR"
block|,
literal|"TURKEY"
block|}
block|,
block|{
name|CTRY_UKRAINE
block|,
name|NULL1_WORLD
block|,
literal|"UA"
block|,
literal|"UKRAINE"
block|}
block|,
block|{
name|CTRY_UAE
block|,
name|NULL1_WORLD
block|,
literal|"AE"
block|,
literal|"UNITED ARAB EMIRATES"
block|}
block|,
block|{
name|CTRY_UNITED_KINGDOM
block|,
name|ETSI1_WORLD
block|,
literal|"GB"
block|,
literal|"UNITED KINGDOM"
block|}
block|,
block|{
name|CTRY_UNITED_STATES
block|,
name|FCC1_FCCA
block|,
literal|"US"
block|,
literal|"UNITED STATES"
block|}
block|,
block|{
name|CTRY_UNITED_STATES_FCC49
block|,
name|FCC4_FCCA
block|,
literal|"PS"
block|,
literal|"UNITED STATES (PUBLIC SAFETY)"
block|}
block|,
block|{
name|CTRY_URUGUAY
block|,
name|APL2_WORLD
block|,
literal|"UY"
block|,
literal|"URUGUAY"
block|}
block|,
block|{
name|CTRY_UZBEKISTAN
block|,
name|FCC3_FCCA
block|,
literal|"UZ"
block|,
literal|"UZBEKISTAN"
block|}
block|,
block|{
name|CTRY_VENEZUELA
block|,
name|APL2_ETSIC
block|,
literal|"VE"
block|,
literal|"VENEZUELA"
block|}
block|,
block|{
name|CTRY_VIET_NAM
block|,
name|NULL1_WORLD
block|,
literal|"VN"
block|,
literal|"VIET NAM"
block|}
block|,
block|{
name|CTRY_YEMEN
block|,
name|NULL1_WORLD
block|,
literal|"YE"
block|,
literal|"YEMEN"
block|}
block|,
block|{
name|CTRY_ZIMBABWE
block|,
name|NULL1_WORLD
block|,
literal|"ZW"
block|,
literal|"ZIMBABWE"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|HAL_BOOL
name|cclookup
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|HAL_REG_DOMAIN
modifier|*
name|rd
parameter_list|,
name|HAL_CTRY_CODE
modifier|*
name|cc
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|allCountries
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcasecmp
argument_list|(
name|allCountries
index|[
name|i
index|]
operator|.
name|isoName
argument_list|,
name|name
argument_list|)
operator|==
literal|0
operator|||
name|strcasecmp
argument_list|(
name|allCountries
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|rd
operator|=
name|allCountries
index|[
name|i
index|]
operator|.
name|regDmnEnum
expr_stmt|;
operator|*
name|cc
operator|=
name|allCountries
index|[
name|i
index|]
operator|.
name|countryCode
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
return|return
name|AH_FALSE
return|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|getccname
parameter_list|(
name|HAL_CTRY_CODE
name|cc
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|allCountries
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|allCountries
index|[
name|i
index|]
operator|.
name|countryCode
operator|==
name|cc
condition|)
return|return
name|allCountries
index|[
name|i
index|]
operator|.
name|name
return|;
return|return
name|NULL
return|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|getccisoname
parameter_list|(
name|HAL_CTRY_CODE
name|cc
parameter_list|)
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|allCountries
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|allCountries
index|[
name|i
index|]
operator|.
name|countryCode
operator|==
name|cc
condition|)
return|return
name|allCountries
index|[
name|i
index|]
operator|.
name|isoName
return|;
return|return
name|NULL
return|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function
specifier|static
name|void
name|cclist
parameter_list|()
block|{
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|)
value|(sizeof(a)/sizeof(a[0]))
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"\nCountry codes:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|N
argument_list|(
name|allCountries
argument_list|)
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%2s %-15.15s%s"
argument_list|,
name|allCountries
index|[
name|i
index|]
operator|.
name|isoName
argument_list|,
name|allCountries
index|[
name|i
index|]
operator|.
name|name
argument_list|,
operator|(
operator|(
name|i
operator|+
literal|1
operator|)
operator|%
literal|4
operator|)
operator|==
literal|0
condition|?
literal|"\n"
else|:
literal|" "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|N
block|}
end_function

begin_function_decl
specifier|static
name|HAL_BOOL
name|setRateTable
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|,
name|int16_t
name|tpcScaleReduction
parameter_list|,
name|int16_t
name|powerLimit
parameter_list|,
name|int16_t
modifier|*
name|pMinPower
parameter_list|,
name|int16_t
modifier|*
name|pMaxPower
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|calctxpower
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|nchan
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chans
parameter_list|,
name|int16_t
name|tpcScaleReduction
parameter_list|,
name|int16_t
name|powerLimit
parameter_list|,
name|int16_t
modifier|*
name|txpow
parameter_list|)
block|{
name|int16_t
name|minpow
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nchan
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|setRateTable
argument_list|(
name|ah
argument_list|,
operator|&
name|chans
index|[
name|i
index|]
argument_list|,
name|tpcScaleReduction
argument_list|,
name|powerLimit
argument_list|,
operator|&
name|minpow
argument_list|,
operator|&
name|txpow
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"unable to set rate table\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
name|int
name|n
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|char
modifier|*
name|sep
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|dopassive
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|showchannels
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|isdfs
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|is4ms
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|anychan
parameter_list|(
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chans
parameter_list|,
name|int
name|nc
parameter_list|,
name|int
name|flag
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nc
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|(
name|chans
index|[
name|i
index|]
operator|.
name|ic_flags
operator|&
name|flag
operator|)
operator|!=
literal|0
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|int
name|mapgsm
parameter_list|(
name|u_int
name|freq
parameter_list|,
name|u_int
name|flags
parameter_list|)
block|{
name|freq
operator|*=
literal|10
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_QUARTER
condition|)
name|freq
operator|+=
literal|5
expr_stmt|;
elseif|else
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_HALF
condition|)
name|freq
operator|+=
literal|10
expr_stmt|;
else|else
name|freq
operator|+=
literal|20
expr_stmt|;
return|return
operator|(
name|freq
operator|-
literal|24220
operator|)
operator|/
literal|5
return|;
block|}
end_function

begin_function
specifier|static
name|__inline
name|int
name|mappsb
parameter_list|(
name|u_int
name|freq
parameter_list|,
name|u_int
name|flags
parameter_list|)
block|{
return|return
operator|(
operator|(
name|freq
operator|*
literal|10
operator|)
operator|+
operator|(
operator|(
operator|(
name|freq
operator|%
literal|5
operator|)
operator|==
literal|2
operator|)
condition|?
literal|5
else|:
literal|0
operator|)
operator|-
literal|49400
operator|)
operator|/
literal|5
return|;
block|}
end_function

begin_comment
comment|/*  * Convert GHz frequency to IEEE channel number.  */
end_comment

begin_function
name|int
name|ath_hal_mhz2ieee
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int
name|freq
parameter_list|,
name|u_int
name|flags
parameter_list|)
block|{
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_2GHZ
condition|)
block|{
comment|/* 2GHz band */
if|if
condition|(
name|freq
operator|==
literal|2484
condition|)
return|return
literal|14
return|;
if|if
condition|(
name|freq
operator|<
literal|2484
condition|)
return|return
operator|(
operator|(
name|int
operator|)
name|freq
operator|-
literal|2407
operator|)
operator|/
literal|5
return|;
else|else
return|return
literal|15
operator|+
operator|(
operator|(
name|freq
operator|-
literal|2512
operator|)
operator|/
literal|20
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|flags
operator|&
name|IEEE80211_CHAN_5GHZ
condition|)
block|{
comment|/* 5Ghz band */
if|if
condition|(
name|IS_CHAN_IN_PUBLIC_SAFETY_BAND
argument_list|(
name|freq
argument_list|)
condition|)
return|return
name|mappsb
argument_list|(
name|freq
argument_list|,
name|flags
argument_list|)
return|;
elseif|else
if|if
condition|(
operator|(
name|flags
operator|&
name|IEEE80211_CHAN_A
operator|)
operator|&&
operator|(
name|freq
operator|<=
literal|5000
operator|)
condition|)
return|return
operator|(
name|freq
operator|-
literal|4000
operator|)
operator|/
literal|5
return|;
else|else
return|return
operator|(
name|freq
operator|-
literal|5000
operator|)
operator|/
literal|5
return|;
block|}
else|else
block|{
comment|/* either, guess */
if|if
condition|(
name|freq
operator|==
literal|2484
condition|)
return|return
literal|14
return|;
if|if
condition|(
name|freq
operator|<
literal|2484
condition|)
return|return
operator|(
operator|(
name|int
operator|)
name|freq
operator|-
literal|2407
operator|)
operator|/
literal|5
return|;
if|if
condition|(
name|freq
operator|<
literal|5000
condition|)
block|{
if|if
condition|(
name|IS_CHAN_IN_PUBLIC_SAFETY_BAND
argument_list|(
name|freq
argument_list|)
condition|)
return|return
name|mappsb
argument_list|(
name|freq
argument_list|,
name|flags
argument_list|)
return|;
elseif|else
if|if
condition|(
name|freq
operator|>
literal|4900
condition|)
return|return
operator|(
name|freq
operator|-
literal|4000
operator|)
operator|/
literal|5
return|;
else|else
return|return
literal|15
operator|+
operator|(
operator|(
name|freq
operator|-
literal|2512
operator|)
operator|/
literal|20
operator|)
return|;
block|}
return|return
operator|(
name|freq
operator|-
literal|5000
operator|)
operator|/
literal|5
return|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|IEEE80211_IS_CHAN_4MS
parameter_list|(
name|_c
parameter_list|)
define|\
value|(((_c)->ic_flags& IEEE80211_CHAN_4MSXMIT) != 0)
end_define

begin_function
specifier|static
name|void
name|dumpchannels
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|nc
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chans
parameter_list|,
name|int16_t
modifier|*
name|txpow
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nc
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
init|=
operator|&
name|chans
index|[
name|i
index|]
decl_stmt|;
name|int
name|type
decl_stmt|;
if|if
condition|(
name|showchannels
condition|)
name|printf
argument_list|(
literal|"%s%3d"
argument_list|,
name|sep
argument_list|,
name|ath_hal_mhz2ieee
argument_list|(
name|ah
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|,
name|c
operator|->
name|ic_flags
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%s%u"
argument_list|,
name|sep
argument_list|,
name|c
operator|->
name|ic_freq
argument_list|)
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_HALF
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'H'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_QUARTER
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'Q'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_TURBO
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'T'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_HT
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'N'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_A
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'A'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_108G
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'T'
expr_stmt|;
elseif|else
if|if
condition|(
name|IEEE80211_IS_CHAN_G
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
literal|'G'
expr_stmt|;
else|else
name|type
operator|=
literal|'B'
expr_stmt|;
if|if
condition|(
name|dopassive
operator|&&
name|IEEE80211_IS_CHAN_PASSIVE
argument_list|(
name|c
argument_list|)
condition|)
name|type
operator|=
name|tolower
argument_list|(
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
name|isdfs
operator|&&
name|is4ms
condition|)
name|printf
argument_list|(
literal|"%c%c%c %d.%d"
argument_list|,
name|type
argument_list|,
name|IEEE80211_IS_CHAN_DFS
argument_list|(
name|c
argument_list|)
condition|?
literal|'*'
else|:
literal|' '
argument_list|,
name|IEEE80211_IS_CHAN_4MS
argument_list|(
name|c
argument_list|)
condition|?
literal|'4'
else|:
literal|' '
argument_list|,
name|txpow
index|[
name|i
index|]
operator|/
literal|2
argument_list|,
operator|(
name|txpow
index|[
name|i
index|]
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|isdfs
condition|)
name|printf
argument_list|(
literal|"%c%c %d.%d"
argument_list|,
name|type
argument_list|,
name|IEEE80211_IS_CHAN_DFS
argument_list|(
name|c
argument_list|)
condition|?
literal|'*'
else|:
literal|' '
argument_list|,
name|txpow
index|[
name|i
index|]
operator|/
literal|2
argument_list|,
operator|(
name|txpow
index|[
name|i
index|]
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|is4ms
condition|)
name|printf
argument_list|(
literal|"%c%c %d.%d"
argument_list|,
name|type
argument_list|,
name|IEEE80211_IS_CHAN_4MS
argument_list|(
name|c
argument_list|)
condition|?
literal|'4'
else|:
literal|' '
argument_list|,
name|txpow
index|[
name|i
index|]
operator|/
literal|2
argument_list|,
operator|(
name|txpow
index|[
name|i
index|]
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%c %d.%d"
argument_list|,
name|type
argument_list|,
name|txpow
index|[
name|i
index|]
operator|/
literal|2
argument_list|,
operator|(
name|txpow
index|[
name|i
index|]
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|++
operator|%
operator|(
name|showchannels
condition|?
literal|7
else|:
literal|6
operator|)
operator|)
operator|==
literal|0
condition|)
name|sep
operator|=
literal|"\n"
expr_stmt|;
else|else
name|sep
operator|=
literal|" "
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|intersect
parameter_list|(
name|struct
name|ieee80211_channel
modifier|*
name|dst
parameter_list|,
name|int16_t
modifier|*
name|dtxpow
parameter_list|,
name|int
modifier|*
name|nd
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|src
parameter_list|,
name|int16_t
modifier|*
name|stxpow
parameter_list|,
name|int
name|ns
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|,
name|l
decl_stmt|;
while|while
condition|(
name|i
operator|<
operator|*
name|nd
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|ns
operator|&&
name|dst
index|[
name|i
index|]
operator|.
name|ic_freq
operator|!=
name|src
index|[
name|j
index|]
operator|.
name|ic_freq
condition|;
name|j
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|j
operator|<
name|ns
operator|&&
name|dtxpow
index|[
name|i
index|]
operator|==
name|stxpow
index|[
name|j
index|]
condition|)
block|{
for|for
control|(
name|k
operator|=
name|i
operator|+
literal|1
operator|,
name|l
operator|=
name|i
init|;
name|k
operator|<
operator|*
name|nd
condition|;
name|k
operator|++
operator|,
name|l
operator|++
control|)
name|dst
index|[
name|l
index|]
operator|=
name|dst
index|[
name|k
index|]
expr_stmt|;
operator|(
operator|*
name|nd
operator|)
operator|--
expr_stmt|;
block|}
else|else
name|i
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|usage
parameter_list|(
specifier|const
name|char
modifier|*
name|progname
parameter_list|)
block|{
name|printf
argument_list|(
literal|"usage: %s [-acdefoilpr4ABGT] [-m opmode] [cc | rd]\n"
argument_list|,
name|progname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|HAL_BOOL
name|getChipPowerLimits
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|HAL_BOOL
name|eepromRead
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int
name|off
parameter_list|,
name|u_int16_t
modifier|*
name|data
parameter_list|)
block|{
comment|/* emulate enough stuff to handle japan channel shift */
switch|switch
condition|(
name|off
condition|)
block|{
case|case
name|AR_EEPROM_VERSION
case|:
operator|*
name|data
operator|=
name|eeversion
expr_stmt|;
return|return
name|AH_TRUE
return|;
case|case
name|AR_EEPROM_REG_CAPABILITIES_OFFSET
case|:
operator|*
name|data
operator|=
name|AR_EEPROM_EEREGCAP_EN_KK_NEW_11A
expr_stmt|;
return|return
name|AH_TRUE
return|;
case|case
name|AR_EEPROM_REG_CAPABILITIES_OFFSET_PRE4_0
case|:
operator|*
name|data
operator|=
name|AR_EEPROM_EEREGCAP_EN_KK_NEW_11A_PRE4_0
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
return|return
name|AH_FALSE
return|;
block|}
end_function

begin_function
name|HAL_STATUS
name|getCapability
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_CAPABILITY_TYPE
name|type
parameter_list|,
name|uint32_t
name|capability
parameter_list|,
name|uint32_t
modifier|*
name|result
parameter_list|)
block|{
specifier|const
name|HAL_CAPABILITIES
modifier|*
name|pCap
init|=
operator|&
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_caps
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|HAL_CAP_REG_DMN
case|:
comment|/* regulatory domain */
operator|*
name|result
operator|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_currentRD
expr_stmt|;
return|return
name|HAL_OK
return|;
default|default:
return|return
name|HAL_EINVAL
return|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|HAL_MODE_HT20
define|\
value|(HAL_MODE_11NG_HT20 |  HAL_MODE_11NA_HT20)
end_define

begin_define
define|#
directive|define
name|HAL_MODE_HT40
define|\
value|(HAL_MODE_11NG_HT40PLUS | HAL_MODE_11NG_HT40MINUS | \ 	 HAL_MODE_11NA_HT40PLUS | HAL_MODE_11NA_HT40MINUS)
end_define

begin_define
define|#
directive|define
name|HAL_MODE_HT
value|(HAL_MODE_HT20 | HAL_MODE_HT40)
end_define

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
specifier|static
specifier|const
name|u_int16_t
name|tpcScaleReductionTable
index|[
literal|5
index|]
init|=
block|{
literal|0
block|,
literal|3
block|,
literal|6
block|,
literal|9
block|,
name|MAX_RATE_POWER
block|}
decl_stmt|;
name|struct
name|ath_hal_private
name|ahp
decl_stmt|;
name|struct
name|ieee80211_channel
name|achans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|atxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
name|bchans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|btxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
name|gchans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|gtxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
name|tchans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|ttxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
name|tgchans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|tgtxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|struct
name|ieee80211_channel
name|nchans
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int16_t
name|ntxpow
index|[
name|IEEE80211_CHAN_MAX
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|na
decl_stmt|,
name|nb
decl_stmt|,
name|ng
decl_stmt|,
name|nt
decl_stmt|,
name|ntg
decl_stmt|,
name|nn
decl_stmt|;
name|HAL_BOOL
name|showall
init|=
name|AH_FALSE
decl_stmt|;
name|HAL_BOOL
name|extendedChanMode
init|=
name|AH_TRUE
decl_stmt|;
name|int
name|modes
init|=
literal|0
decl_stmt|;
name|int16_t
name|tpcReduction
decl_stmt|,
name|powerLimit
decl_stmt|;
name|int
name|showdfs
init|=
literal|0
decl_stmt|;
name|int
name|show4ms
init|=
literal|0
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ahp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ahp
argument_list|)
argument_list|)
expr_stmt|;
name|ahp
operator|.
name|ah_getChannelEdges
operator|=
name|getChannelEdges
expr_stmt|;
name|ahp
operator|.
name|ah_getWirelessModes
operator|=
name|getWirelessModes
expr_stmt|;
name|ahp
operator|.
name|ah_eepromRead
operator|=
name|eepromRead
expr_stmt|;
name|ahp
operator|.
name|ah_getChipPowerLimits
operator|=
name|getChipPowerLimits
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halWirelessModes
operator|=
name|HAL_MODE_ALL
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halLow5GhzChan
operator|=
literal|4920
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halHigh5GhzChan
operator|=
literal|6100
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halLow2GhzChan
operator|=
literal|2312
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halHigh2GhzChan
operator|=
literal|2732
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halChanHalfRate
operator|=
name|AH_TRUE
expr_stmt|;
name|ahp
operator|.
name|ah_caps
operator|.
name|halChanQuarterRate
operator|=
name|AH_TRUE
expr_stmt|;
name|ahp
operator|.
name|h
operator|.
name|ah_getCapability
operator|=
name|getCapability
expr_stmt|;
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_STA
expr_stmt|;
name|tpcReduction
operator|=
name|tpcScaleReductionTable
index|[
literal|0
index|]
expr_stmt|;
name|powerLimit
operator|=
name|MAX_RATE_POWER
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"acdeflm:pr4ABGhHNT"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|'a'
case|:
name|showall
operator|=
name|AH_TRUE
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|showchannels
operator|=
name|AH_TRUE
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
name|ath_hal_debug
operator|=
name|HAL_DEBUG_ANY
expr_stmt|;
break|break;
case|case
literal|'e'
case|:
name|extendedChanMode
operator|=
name|AH_FALSE
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
name|showchannels
operator|=
name|AH_FALSE
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|cclist
argument_list|()
expr_stmt|;
name|rdlist
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
literal|'m'
case|:
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"sta"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_STA
expr_stmt|;
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"ibss"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_IBSS
expr_stmt|;
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"adhoc"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_IBSS
expr_stmt|;
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"ap"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_HOSTAP
expr_stmt|;
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"hostap"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_HOSTAP
expr_stmt|;
elseif|else
if|if
condition|(
name|strncasecmp
argument_list|(
name|optarg
argument_list|,
literal|"monitor"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|ahp
operator|.
name|ah_opmode
operator|=
name|HAL_M_MONITOR
expr_stmt|;
else|else
name|usage
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|dopassive
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'A'
case|:
name|modes
operator||=
name|HAL_MODE_11A
expr_stmt|;
break|break;
case|case
literal|'B'
case|:
name|modes
operator||=
name|HAL_MODE_11B
expr_stmt|;
break|break;
case|case
literal|'G'
case|:
name|modes
operator||=
name|HAL_MODE_11G
expr_stmt|;
break|break;
case|case
literal|'h'
case|:
name|modes
operator||=
name|HAL_MODE_HT20
expr_stmt|;
break|break;
case|case
literal|'H'
case|:
name|modes
operator||=
name|HAL_MODE_HT40
expr_stmt|;
break|break;
case|case
literal|'N'
case|:
name|modes
operator||=
name|HAL_MODE_HT
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|modes
operator||=
name|HAL_MODE_TURBO
operator||
name|HAL_MODE_108G
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|showdfs
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'4'
case|:
name|show4ms
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|usage
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|argc
operator|-
name|optind
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
operator|!
name|cclookup
argument_list|(
literal|"US"
argument_list|,
operator|&
name|rd
argument_list|,
operator|&
name|cc
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%s: unknown country code\n"
argument_list|,
literal|"US"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|1
case|:
comment|/* cc/regdomain */
if|if
condition|(
operator|!
name|cclookup
argument_list|(
name|argv
index|[
name|optind
index|]
argument_list|,
operator|&
name|rd
argument_list|,
operator|&
name|cc
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|rdlookup
argument_list|(
name|argv
index|[
name|optind
index|]
argument_list|,
operator|&
name|rd
argument_list|)
condition|)
block|{
specifier|const
name|char
modifier|*
name|rdname
decl_stmt|;
name|rd
operator|=
name|strtoul
argument_list|(
name|argv
index|[
name|optind
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rdname
operator|=
name|getrdname
argument_list|(
name|rd
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdname
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%s: unknown country/regulatory "
literal|"domain code\n"
argument_list|,
name|argv
index|[
name|optind
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
name|cc
operator|=
name|CTRY_DEFAULT
expr_stmt|;
block|}
break|break;
default|default:
comment|/* regdomain cc */
if|if
condition|(
operator|!
name|rdlookup
argument_list|(
name|argv
index|[
name|optind
index|]
argument_list|,
operator|&
name|rd
argument_list|)
condition|)
block|{
specifier|const
name|char
modifier|*
name|rdname
decl_stmt|;
name|rd
operator|=
name|strtoul
argument_list|(
name|argv
index|[
name|optind
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rdname
operator|=
name|getrdname
argument_list|(
name|rd
argument_list|)
expr_stmt|;
if|if
condition|(
name|rdname
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%s: unknown country/regulatory "
literal|"domain code\n"
argument_list|,
name|argv
index|[
name|optind
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|cclookup
argument_list|(
name|argv
index|[
name|optind
operator|+
literal|1
index|]
argument_list|,
operator|&
name|rd
argument_list|,
operator|&
name|cc
argument_list|)
condition|)
name|cc
operator|=
name|strtoul
argument_list|(
name|argv
index|[
name|optind
operator|+
literal|1
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|cc
operator|!=
name|CTRY_DEFAULT
condition|)
name|printf
argument_list|(
literal|"\n%s (%s, 0x%x, %u) %s (0x%x, %u)\n"
argument_list|,
name|getccname
argument_list|(
name|cc
argument_list|)
argument_list|,
name|getccisoname
argument_list|(
name|cc
argument_list|)
argument_list|,
name|cc
argument_list|,
name|cc
argument_list|,
name|getrdname
argument_list|(
name|rd
argument_list|)
argument_list|,
name|rd
argument_list|,
name|rd
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\n%s (0x%x, %u)\n"
argument_list|,
name|getrdname
argument_list|(
name|rd
argument_list|)
argument_list|,
name|rd
argument_list|,
name|rd
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|==
literal|0
condition|)
block|{
comment|/* NB: no HAL_MODE_HT */
name|modes
operator|=
name|HAL_MODE_11A
operator||
name|HAL_MODE_11B
operator||
name|HAL_MODE_11G
operator||
name|HAL_MODE_TURBO
operator||
name|HAL_MODE_108G
expr_stmt|;
block|}
name|na
operator|=
name|nb
operator|=
name|ng
operator|=
name|nt
operator|=
name|ntg
operator|=
name|nn
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11G
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|gchans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|ng
argument_list|,
name|HAL_MODE_11G
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|ng
argument_list|,
name|gchans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|gtxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|gchans
argument_list|,
name|ng
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|gchans
argument_list|,
name|ng
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11B
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|bchans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|nb
argument_list|,
name|HAL_MODE_11B
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nb
argument_list|,
name|bchans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|btxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|bchans
argument_list|,
name|nb
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|bchans
argument_list|,
name|nb
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11A
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|achans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|na
argument_list|,
name|HAL_MODE_11A
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|na
argument_list|,
name|achans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|atxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|achans
argument_list|,
name|na
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|achans
argument_list|,
name|na
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_TURBO
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|tchans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|nt
argument_list|,
name|HAL_MODE_TURBO
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nt
argument_list|,
name|tchans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|ttxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|tchans
argument_list|,
name|nt
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|tchans
argument_list|,
name|nt
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_108G
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|tgchans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|ntg
argument_list|,
name|HAL_MODE_108G
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|ntg
argument_list|,
name|tgchans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|tgtxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|tgchans
argument_list|,
name|ntg
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|tgchans
argument_list|,
name|ntg
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_HT
condition|)
block|{
name|ahp
operator|.
name|ah_currentRD
operator|=
name|rd
expr_stmt|;
if|if
condition|(
name|ath_hal_getchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nchans
argument_list|,
name|IEEE80211_CHAN_MAX
argument_list|,
operator|&
name|nn
argument_list|,
name|modes
operator|&
name|HAL_MODE_HT
argument_list|,
name|cc
argument_list|,
name|rd
argument_list|,
name|extendedChanMode
argument_list|)
operator|==
name|HAL_OK
condition|)
block|{
name|calctxpower
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nn
argument_list|,
name|nchans
argument_list|,
name|tpcReduction
argument_list|,
name|powerLimit
argument_list|,
name|ntxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|showdfs
condition|)
name|isdfs
operator||=
name|anychan
argument_list|(
name|nchans
argument_list|,
name|nn
argument_list|,
name|IEEE80211_CHAN_DFS
argument_list|)
expr_stmt|;
if|if
condition|(
name|show4ms
condition|)
name|is4ms
operator||=
name|anychan
argument_list|(
name|nchans
argument_list|,
name|nn
argument_list|,
name|IEEE80211_CHAN_4MSXMIT
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|showall
condition|)
block|{
define|#
directive|define
name|CHECKMODES
parameter_list|(
name|_modes
parameter_list|,
name|_m
parameter_list|)
value|((_modes& (_m)) == (_m))
if|if
condition|(
name|CHECKMODES
argument_list|(
name|modes
argument_list|,
name|HAL_MODE_11B
operator||
name|HAL_MODE_11G
argument_list|)
condition|)
block|{
comment|/* b ^= g */
name|intersect
argument_list|(
name|bchans
argument_list|,
name|btxpow
argument_list|,
operator|&
name|nb
argument_list|,
name|gchans
argument_list|,
name|gtxpow
argument_list|,
name|ng
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|CHECKMODES
argument_list|(
name|modes
argument_list|,
name|HAL_MODE_11A
operator||
name|HAL_MODE_TURBO
argument_list|)
condition|)
block|{
comment|/* t ^= a */
name|intersect
argument_list|(
name|tchans
argument_list|,
name|ttxpow
argument_list|,
operator|&
name|nt
argument_list|,
name|achans
argument_list|,
name|atxpow
argument_list|,
name|na
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|CHECKMODES
argument_list|(
name|modes
argument_list|,
name|HAL_MODE_11G
operator||
name|HAL_MODE_108G
argument_list|)
condition|)
block|{
comment|/* tg ^= g */
name|intersect
argument_list|(
name|tgchans
argument_list|,
name|tgtxpow
argument_list|,
operator|&
name|ntg
argument_list|,
name|gchans
argument_list|,
name|gtxpow
argument_list|,
name|ng
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|CHECKMODES
argument_list|(
name|modes
argument_list|,
name|HAL_MODE_11G
operator||
name|HAL_MODE_HT
argument_list|)
condition|)
block|{
comment|/* g ^= n */
name|intersect
argument_list|(
name|gchans
argument_list|,
name|gtxpow
argument_list|,
operator|&
name|ng
argument_list|,
name|nchans
argument_list|,
name|ntxpow
argument_list|,
name|nn
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|CHECKMODES
argument_list|(
name|modes
argument_list|,
name|HAL_MODE_11A
operator||
name|HAL_MODE_HT
argument_list|)
condition|)
block|{
comment|/* a ^= n */
name|intersect
argument_list|(
name|achans
argument_list|,
name|atxpow
argument_list|,
operator|&
name|na
argument_list|,
name|nchans
argument_list|,
name|ntxpow
argument_list|,
name|nn
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|CHECKMODES
block|}
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11G
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|ng
argument_list|,
name|gchans
argument_list|,
name|gtxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11B
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nb
argument_list|,
name|bchans
argument_list|,
name|btxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_11A
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|na
argument_list|,
name|achans
argument_list|,
name|atxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_108G
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|ntg
argument_list|,
name|tgchans
argument_list|,
name|tgtxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_TURBO
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nt
argument_list|,
name|tchans
argument_list|,
name|ttxpow
argument_list|)
expr_stmt|;
if|if
condition|(
name|modes
operator|&
name|HAL_MODE_HT
condition|)
name|dumpchannels
argument_list|(
operator|&
name|ahp
operator|.
name|h
argument_list|,
name|nn
argument_list|,
name|nchans
argument_list|,
name|ntxpow
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Search a list for a specified value v that is within  * EEP_DELTA of the search values.  Return the closest  * values in the list above and below the desired value.  * EEP_DELTA is a factional value; everything is scaled  * so only integer arithmetic is used.  *  * NB: the input list is assumed to be sorted in ascending order  */
end_comment

begin_function
specifier|static
name|void
name|ar5212GetLowerUpperValues
parameter_list|(
name|u_int16_t
name|v
parameter_list|,
name|u_int16_t
modifier|*
name|lp
parameter_list|,
name|u_int16_t
name|listSize
parameter_list|,
name|u_int16_t
modifier|*
name|vlo
parameter_list|,
name|u_int16_t
modifier|*
name|vhi
parameter_list|)
block|{
name|u_int32_t
name|target
init|=
name|v
operator|*
name|EEP_SCALE
decl_stmt|;
name|u_int16_t
modifier|*
name|ep
init|=
name|lp
operator|+
name|listSize
decl_stmt|;
comment|/* 	 * Check first and last elements for out-of-bounds conditions. 	 */
if|if
condition|(
name|target
operator|<
call|(
name|u_int32_t
call|)
argument_list|(
name|lp
index|[
literal|0
index|]
operator|*
name|EEP_SCALE
operator|-
name|EEP_DELTA
argument_list|)
condition|)
block|{
operator|*
name|vlo
operator|=
operator|*
name|vhi
operator|=
name|lp
index|[
literal|0
index|]
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|target
operator|>
call|(
name|u_int32_t
call|)
argument_list|(
name|ep
index|[
operator|-
literal|1
index|]
operator|*
name|EEP_SCALE
operator|+
name|EEP_DELTA
argument_list|)
condition|)
block|{
operator|*
name|vlo
operator|=
operator|*
name|vhi
operator|=
name|ep
index|[
operator|-
literal|1
index|]
expr_stmt|;
return|return;
block|}
comment|/* look for value being near or between 2 values in list */
for|for
control|(
init|;
name|lp
operator|<
name|ep
condition|;
name|lp
operator|++
control|)
block|{
comment|/* 		 * If value is close to the current value of the list 		 * then target is not between values, it is one of the values 		 */
if|if
condition|(
name|abs
argument_list|(
name|lp
index|[
literal|0
index|]
operator|*
name|EEP_SCALE
operator|-
name|target
argument_list|)
operator|<
name|EEP_DELTA
condition|)
block|{
operator|*
name|vlo
operator|=
operator|*
name|vhi
operator|=
name|lp
index|[
literal|0
index|]
expr_stmt|;
return|return;
block|}
comment|/* 		 * Look for value being between current value and next value 		 * if so return these 2 values 		 */
if|if
condition|(
name|target
operator|<
call|(
name|u_int32_t
call|)
argument_list|(
name|lp
index|[
literal|1
index|]
operator|*
name|EEP_SCALE
operator|-
name|EEP_DELTA
argument_list|)
condition|)
block|{
operator|*
name|vlo
operator|=
name|lp
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|vhi
operator|=
name|lp
index|[
literal|1
index|]
expr_stmt|;
return|return;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Find the maximum conformance test limit for the given channel and CTL info  */
end_comment

begin_function
specifier|static
name|u_int16_t
name|ar5212GetMaxEdgePower
parameter_list|(
name|u_int16_t
name|channel
parameter_list|,
name|RD_EDGES_POWER
modifier|*
name|pRdEdgesPower
parameter_list|)
block|{
comment|/* temp array for holding edge channels */
name|u_int16_t
name|tempChannelList
index|[
name|NUM_EDGES
index|]
decl_stmt|;
name|u_int16_t
name|clo
decl_stmt|,
name|chi
decl_stmt|,
name|twiceMaxEdgePower
decl_stmt|;
name|int
name|i
decl_stmt|,
name|numEdges
decl_stmt|;
comment|/* Get the edge power */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_EDGES
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|pRdEdgesPower
index|[
name|i
index|]
operator|.
name|rdEdge
operator|==
literal|0
condition|)
break|break;
name|tempChannelList
index|[
name|i
index|]
operator|=
name|pRdEdgesPower
index|[
name|i
index|]
operator|.
name|rdEdge
expr_stmt|;
block|}
name|numEdges
operator|=
name|i
expr_stmt|;
name|ar5212GetLowerUpperValues
argument_list|(
name|channel
argument_list|,
name|tempChannelList
argument_list|,
name|numEdges
argument_list|,
operator|&
name|clo
argument_list|,
operator|&
name|chi
argument_list|)
expr_stmt|;
comment|/* Get the index for the lower channel */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numEdges
operator|&&
name|clo
operator|!=
name|tempChannelList
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
empty_stmt|;
comment|/* Is lower channel ever outside the rdEdge? */
name|HALASSERT
argument_list|(
name|i
operator|!=
name|numEdges
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|clo
operator|==
name|chi
operator|&&
name|clo
operator|==
name|channel
operator|)
operator|||
operator|(
name|pRdEdgesPower
index|[
name|i
index|]
operator|.
name|flag
operator|)
condition|)
block|{
comment|/*  		 * If there's an exact channel match or an inband flag set 		 * on the lower channel use the given rdEdgePower  		 */
name|twiceMaxEdgePower
operator|=
name|pRdEdgesPower
index|[
name|i
index|]
operator|.
name|twice_rdEdgePower
expr_stmt|;
name|HALASSERT
argument_list|(
name|twiceMaxEdgePower
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
name|twiceMaxEdgePower
operator|=
name|MAX_RATE_POWER
expr_stmt|;
return|return
name|twiceMaxEdgePower
return|;
block|}
end_function

begin_comment
comment|/*  * Returns interpolated or the scaled up interpolated value  */
end_comment

begin_function
specifier|static
name|u_int16_t
name|interpolate
parameter_list|(
name|u_int16_t
name|target
parameter_list|,
name|u_int16_t
name|srcLeft
parameter_list|,
name|u_int16_t
name|srcRight
parameter_list|,
name|u_int16_t
name|targetLeft
parameter_list|,
name|u_int16_t
name|targetRight
parameter_list|)
block|{
name|u_int16_t
name|rv
decl_stmt|;
name|int16_t
name|lRatio
decl_stmt|;
comment|/* to get an accurate ratio, always scale, if want to scale, then don't scale back down */
if|if
condition|(
operator|(
name|targetLeft
operator|*
name|targetRight
operator|)
operator|==
literal|0
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|srcRight
operator|!=
name|srcLeft
condition|)
block|{
comment|/* 		 * Note the ratio always need to be scaled, 		 * since it will be a fraction. 		 */
name|lRatio
operator|=
operator|(
name|target
operator|-
name|srcLeft
operator|)
operator|*
name|EEP_SCALE
operator|/
operator|(
name|srcRight
operator|-
name|srcLeft
operator|)
expr_stmt|;
if|if
condition|(
name|lRatio
operator|<
literal|0
condition|)
block|{
comment|/* Return as Left target if value would be negative */
name|rv
operator|=
name|targetLeft
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|lRatio
operator|>
name|EEP_SCALE
condition|)
block|{
comment|/* Return as Right target if Ratio is greater than 100% (SCALE) */
name|rv
operator|=
name|targetRight
expr_stmt|;
block|}
else|else
block|{
name|rv
operator|=
operator|(
name|lRatio
operator|*
name|targetRight
operator|+
operator|(
name|EEP_SCALE
operator|-
name|lRatio
operator|)
operator|*
name|targetLeft
operator|)
operator|/
name|EEP_SCALE
expr_stmt|;
block|}
block|}
else|else
block|{
name|rv
operator|=
name|targetLeft
expr_stmt|;
block|}
return|return
name|rv
return|;
block|}
end_function

begin_comment
comment|/*  * Return the four rates of target power for the given target power table   * channel, and number of channels  */
end_comment

begin_function
specifier|static
name|void
name|ar5212GetTargetPowers
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|,
name|TRGT_POWER_INFO
modifier|*
name|powInfo
parameter_list|,
name|u_int16_t
name|numChannels
parameter_list|,
name|TRGT_POWER_INFO
modifier|*
name|pNewPower
parameter_list|)
block|{
comment|/* temp array for holding target power channels */
name|u_int16_t
name|tempChannelList
index|[
name|NUM_TEST_FREQUENCIES
index|]
decl_stmt|;
name|u_int16_t
name|clo
decl_stmt|,
name|chi
decl_stmt|,
name|ixlo
decl_stmt|,
name|ixhi
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* Copy the target powers into the temp channel list */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numChannels
condition|;
name|i
operator|++
control|)
name|tempChannelList
index|[
name|i
index|]
operator|=
name|powInfo
index|[
name|i
index|]
operator|.
name|testChannel
expr_stmt|;
name|ar5212GetLowerUpperValues
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|tempChannelList
argument_list|,
name|numChannels
argument_list|,
operator|&
name|clo
argument_list|,
operator|&
name|chi
argument_list|)
expr_stmt|;
comment|/* Get the indices for the channel */
name|ixlo
operator|=
name|ixhi
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numChannels
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|clo
operator|==
name|tempChannelList
index|[
name|i
index|]
condition|)
block|{
name|ixlo
operator|=
name|i
expr_stmt|;
block|}
if|if
condition|(
name|chi
operator|==
name|tempChannelList
index|[
name|i
index|]
condition|)
block|{
name|ixhi
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
comment|/* 	 * Get the lower and upper channels, target powers, 	 * and interpolate between them. 	 */
name|pNewPower
operator|->
name|twicePwr6_24
operator|=
name|interpolate
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|clo
argument_list|,
name|chi
argument_list|,
name|powInfo
index|[
name|ixlo
index|]
operator|.
name|twicePwr6_24
argument_list|,
name|powInfo
index|[
name|ixhi
index|]
operator|.
name|twicePwr6_24
argument_list|)
expr_stmt|;
name|pNewPower
operator|->
name|twicePwr36
operator|=
name|interpolate
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|clo
argument_list|,
name|chi
argument_list|,
name|powInfo
index|[
name|ixlo
index|]
operator|.
name|twicePwr36
argument_list|,
name|powInfo
index|[
name|ixhi
index|]
operator|.
name|twicePwr36
argument_list|)
expr_stmt|;
name|pNewPower
operator|->
name|twicePwr48
operator|=
name|interpolate
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|clo
argument_list|,
name|chi
argument_list|,
name|powInfo
index|[
name|ixlo
index|]
operator|.
name|twicePwr48
argument_list|,
name|powInfo
index|[
name|ixhi
index|]
operator|.
name|twicePwr48
argument_list|)
expr_stmt|;
name|pNewPower
operator|->
name|twicePwr54
operator|=
name|interpolate
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|clo
argument_list|,
name|chi
argument_list|,
name|powInfo
index|[
name|ixlo
index|]
operator|.
name|twicePwr54
argument_list|,
name|powInfo
index|[
name|ixhi
index|]
operator|.
name|twicePwr54
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|RD_EDGES_POWER
modifier|*
name|findEdgePower
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int
name|ctl
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|_numCtls
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|_ctl
index|[
name|i
index|]
operator|==
name|ctl
condition|)
return|return
operator|&
name|_rdEdgesPower
index|[
name|i
operator|*
name|NUM_EDGES
index|]
return|;
return|return
name|AH_NULL
return|;
block|}
end_function

begin_comment
comment|/*  * Sets the transmit power in the baseband for the given  * operating channel and mode.  */
end_comment

begin_function
specifier|static
name|HAL_BOOL
name|setRateTable
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|chan
parameter_list|,
name|int16_t
name|tpcScaleReduction
parameter_list|,
name|int16_t
name|powerLimit
parameter_list|,
name|int16_t
modifier|*
name|pMinPower
parameter_list|,
name|int16_t
modifier|*
name|pMaxPower
parameter_list|)
block|{
name|u_int16_t
name|ratesArray
index|[
literal|16
index|]
decl_stmt|;
name|u_int16_t
modifier|*
name|rpow
init|=
name|ratesArray
decl_stmt|;
name|u_int16_t
name|twiceMaxRDPower
decl_stmt|,
name|twiceMaxEdgePower
decl_stmt|,
name|twiceMaxEdgePowerCck
decl_stmt|;
name|int8_t
name|twiceAntennaGain
decl_stmt|,
name|twiceAntennaReduction
decl_stmt|;
name|TRGT_POWER_INFO
name|targetPowerOfdm
decl_stmt|,
name|targetPowerCck
decl_stmt|;
name|RD_EDGES_POWER
modifier|*
name|rep
decl_stmt|;
name|int16_t
name|scaledPower
decl_stmt|;
name|u_int8_t
name|cfgCtl
decl_stmt|;
name|twiceMaxRDPower
operator|=
name|chan
operator|->
name|ic_maxregpower
operator|*
literal|2
expr_stmt|;
operator|*
name|pMaxPower
operator|=
operator|-
name|MAX_RATE_POWER
expr_stmt|;
operator|*
name|pMinPower
operator|=
name|MAX_RATE_POWER
expr_stmt|;
comment|/* Get conformance test limit maximum for this channel */
name|cfgCtl
operator|=
name|ath_hal_getctl
argument_list|(
name|ah
argument_list|,
name|chan
argument_list|)
expr_stmt|;
name|rep
operator|=
name|findEdgePower
argument_list|(
name|ah
argument_list|,
name|cfgCtl
argument_list|)
expr_stmt|;
if|if
condition|(
name|rep
operator|!=
name|AH_NULL
condition|)
name|twiceMaxEdgePower
operator|=
name|ar5212GetMaxEdgePower
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|rep
argument_list|)
expr_stmt|;
else|else
name|twiceMaxEdgePower
operator|=
name|MAX_RATE_POWER
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_G
argument_list|(
name|chan
argument_list|)
condition|)
block|{
comment|/* Check for a CCK CTL for 11G CCK powers */
name|cfgCtl
operator|=
operator|(
name|cfgCtl
operator|&
literal|0xFC
operator|)
operator||
literal|0x01
expr_stmt|;
name|rep
operator|=
name|findEdgePower
argument_list|(
name|ah
argument_list|,
name|cfgCtl
argument_list|)
expr_stmt|;
if|if
condition|(
name|rep
operator|!=
name|AH_NULL
condition|)
name|twiceMaxEdgePowerCck
operator|=
name|ar5212GetMaxEdgePower
argument_list|(
name|chan
operator|->
name|ic_freq
argument_list|,
name|rep
argument_list|)
expr_stmt|;
else|else
name|twiceMaxEdgePowerCck
operator|=
name|MAX_RATE_POWER
expr_stmt|;
block|}
else|else
block|{
comment|/* Set the 11B cck edge power to the one found before */
name|twiceMaxEdgePowerCck
operator|=
name|twiceMaxEdgePower
expr_stmt|;
block|}
comment|/* Get Antenna Gain reduction */
if|if
condition|(
name|IEEE80211_IS_CHAN_5GHZ
argument_list|(
name|chan
argument_list|)
condition|)
block|{
name|twiceAntennaGain
operator|=
name|antennaGainMax
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|twiceAntennaGain
operator|=
name|antennaGainMax
index|[
literal|1
index|]
expr_stmt|;
block|}
name|twiceAntennaReduction
operator|=
name|ath_hal_getantennareduction
argument_list|(
name|ah
argument_list|,
name|chan
argument_list|,
name|twiceAntennaGain
argument_list|)
expr_stmt|;
if|if
condition|(
name|IEEE80211_IS_CHAN_OFDM
argument_list|(
name|chan
argument_list|)
condition|)
block|{
comment|/* Get final OFDM target powers */
if|if
condition|(
name|IEEE80211_IS_CHAN_G
argument_list|(
name|chan
argument_list|)
condition|)
block|{
comment|/* TODO - add Turbo 2.4 to this mode check */
name|ar5212GetTargetPowers
argument_list|(
name|ah
argument_list|,
name|chan
argument_list|,
name|trgtPwr_11g
argument_list|,
name|numTargetPwr_11g
argument_list|,
operator|&
name|targetPowerOfdm
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ar5212GetTargetPowers
argument_list|(
name|ah
argument_list|,
name|chan
argument_list|,
name|trgtPwr_11a
argument_list|,
name|numTargetPwr_11a
argument_list|,
operator|&
name|targetPowerOfdm
argument_list|)
expr_stmt|;
block|}
comment|/* Get Maximum OFDM power */
comment|/* Minimum of target and edge powers */
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|twiceMaxEdgePower
argument_list|,
name|twiceMaxRDPower
operator|-
name|twiceAntennaReduction
argument_list|)
expr_stmt|;
comment|/* 		 * If turbo is set, reduce power to keep power 		 * consumption under 2 Watts.  Note that we always do 		 * this unless specially configured.  Then we limit 		 * power only for non-AP operation. 		 */
if|if
condition|(
name|IEEE80211_IS_CHAN_TURBO
argument_list|(
name|chan
argument_list|)
ifdef|#
directive|ifdef
name|AH_ENABLE_AP_SUPPORT
operator|&&
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_opmode
operator|!=
name|HAL_M_HOSTAP
endif|#
directive|endif
condition|)
block|{
comment|/* 			 * If turbo is set, reduce power to keep power 			 * consumption under 2 Watts 			 */
if|if
condition|(
name|eeversion
operator|>=
name|AR_EEPROM_VER3_1
condition|)
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|turbo2WMaxPower5
argument_list|)
expr_stmt|;
comment|/* 			 * EEPROM version 4.0 added an additional 			 * constraint on 2.4GHz channels. 			 */
if|if
condition|(
name|eeversion
operator|>=
name|AR_EEPROM_VER4_0
operator|&&
name|IEEE80211_IS_CHAN_2GHZ
argument_list|(
name|chan
argument_list|)
condition|)
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|turbo2WMaxPower2
argument_list|)
expr_stmt|;
block|}
comment|/* Reduce power by max regulatory domain allowed restrictions */
name|scaledPower
operator|-=
operator|(
name|tpcScaleReduction
operator|*
literal|2
operator|)
expr_stmt|;
name|scaledPower
operator|=
operator|(
name|scaledPower
operator|<
literal|0
operator|)
condition|?
literal|0
else|:
name|scaledPower
expr_stmt|;
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|powerLimit
argument_list|)
expr_stmt|;
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|targetPowerOfdm
operator|.
name|twicePwr6_24
argument_list|)
expr_stmt|;
comment|/* Set OFDM rates 9, 12, 18, 24, 36, 48, 54, XR */
name|rpow
index|[
literal|0
index|]
operator|=
name|rpow
index|[
literal|1
index|]
operator|=
name|rpow
index|[
literal|2
index|]
operator|=
name|rpow
index|[
literal|3
index|]
operator|=
name|rpow
index|[
literal|4
index|]
operator|=
name|scaledPower
expr_stmt|;
name|rpow
index|[
literal|5
index|]
operator|=
name|AH_MIN
argument_list|(
name|rpow
index|[
literal|0
index|]
argument_list|,
name|targetPowerOfdm
operator|.
name|twicePwr36
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|6
index|]
operator|=
name|AH_MIN
argument_list|(
name|rpow
index|[
literal|0
index|]
argument_list|,
name|targetPowerOfdm
operator|.
name|twicePwr48
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|7
index|]
operator|=
name|AH_MIN
argument_list|(
name|rpow
index|[
literal|0
index|]
argument_list|,
name|targetPowerOfdm
operator|.
name|twicePwr54
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notyet
if|if
condition|(
name|eeversion
operator|>=
name|AR_EEPROM_VER4_0
condition|)
block|{
comment|/* Setup XR target power from EEPROM */
name|rpow
index|[
literal|15
index|]
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|IS_CHAN_2GHZ
argument_list|(
name|chan
argument_list|)
condition|?
name|xrTargetPower2
else|:
name|xrTargetPower5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* XR uses 6mb power */
name|rpow
index|[
literal|15
index|]
operator|=
name|rpow
index|[
literal|0
index|]
expr_stmt|;
block|}
else|#
directive|else
name|rpow
index|[
literal|15
index|]
operator|=
name|rpow
index|[
literal|0
index|]
expr_stmt|;
endif|#
directive|endif
operator|*
name|pMinPower
operator|=
name|rpow
index|[
literal|7
index|]
expr_stmt|;
operator|*
name|pMaxPower
operator|=
name|rpow
index|[
literal|0
index|]
expr_stmt|;
if|#
directive|if
literal|0
block|ahp->ah_ofdmTxPower = rpow[0];
endif|#
directive|endif
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_ANY
argument_list|,
literal|"%s: MaxRD: %d TurboMax: %d MaxCTL: %d "
literal|"TPC_Reduction %d\n"
argument_list|,
name|__func__
argument_list|,
name|twiceMaxRDPower
argument_list|,
name|turbo2WMaxPower5
argument_list|,
name|twiceMaxEdgePower
argument_list|,
name|tpcScaleReduction
operator|*
literal|2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|IEEE80211_IS_CHAN_CCK
argument_list|(
name|chan
argument_list|)
condition|)
block|{
comment|/* Get final CCK target powers */
name|ar5212GetTargetPowers
argument_list|(
name|ah
argument_list|,
name|chan
argument_list|,
name|trgtPwr_11b
argument_list|,
name|numTargetPwr_11b
argument_list|,
operator|&
name|targetPowerCck
argument_list|)
expr_stmt|;
comment|/* Reduce power by max regulatory domain allowed restrictions */
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|twiceMaxEdgePowerCck
argument_list|,
name|twiceMaxRDPower
operator|-
name|twiceAntennaReduction
argument_list|)
expr_stmt|;
name|scaledPower
operator|-=
operator|(
name|tpcScaleReduction
operator|*
literal|2
operator|)
expr_stmt|;
name|scaledPower
operator|=
operator|(
name|scaledPower
operator|<
literal|0
operator|)
condition|?
literal|0
else|:
name|scaledPower
expr_stmt|;
name|scaledPower
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|powerLimit
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|8
index|]
operator|=
operator|(
name|scaledPower
operator|<
literal|1
operator|)
condition|?
literal|1
else|:
name|scaledPower
expr_stmt|;
comment|/* Set CCK rates 2L, 2S, 5.5L, 5.5S, 11L, 11S */
name|rpow
index|[
literal|8
index|]
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|targetPowerCck
operator|.
name|twicePwr6_24
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|9
index|]
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|targetPowerCck
operator|.
name|twicePwr36
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|10
index|]
operator|=
name|rpow
index|[
literal|9
index|]
expr_stmt|;
name|rpow
index|[
literal|11
index|]
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|targetPowerCck
operator|.
name|twicePwr48
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|12
index|]
operator|=
name|rpow
index|[
literal|11
index|]
expr_stmt|;
name|rpow
index|[
literal|13
index|]
operator|=
name|AH_MIN
argument_list|(
name|scaledPower
argument_list|,
name|targetPowerCck
operator|.
name|twicePwr54
argument_list|)
expr_stmt|;
name|rpow
index|[
literal|14
index|]
operator|=
name|rpow
index|[
literal|13
index|]
expr_stmt|;
comment|/* Set min/max power based off OFDM values or initialization */
if|if
condition|(
name|rpow
index|[
literal|13
index|]
operator|<
operator|*
name|pMinPower
condition|)
operator|*
name|pMinPower
operator|=
name|rpow
index|[
literal|13
index|]
expr_stmt|;
if|if
condition|(
name|rpow
index|[
literal|9
index|]
operator|>
operator|*
name|pMaxPower
condition|)
operator|*
name|pMaxPower
operator|=
name|rpow
index|[
literal|9
index|]
expr_stmt|;
block|}
if|#
directive|if
literal|0
block|ahp->ah_tx6PowerInHalfDbm = *pMaxPower;
endif|#
directive|endif
return|return
name|AH_TRUE
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|ath_hal_malloc
parameter_list|(
name|size_t
name|size
parameter_list|)
block|{
return|return
name|calloc
argument_list|(
literal|1
argument_list|,
name|size
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|ath_hal_free
parameter_list|(
name|void
modifier|*
name|p
parameter_list|)
block|{
return|return
name|free
argument_list|(
name|p
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|ath_hal_vprintf
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
name|vprintf
argument_list|(
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ath_hal_printf
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|ath_hal_vprintf
argument_list|(
name|ah
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|DO_HALDEBUG
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int
name|mask
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|__va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|ath_hal_vprintf
argument_list|(
name|ah
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

