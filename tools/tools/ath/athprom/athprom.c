begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2008 Sam Leffler, Errno Consulting  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    similar to the "NO WARRANTY" disclaimer below ("Disclaimer") and any  *    redistribution must be conditioned upon including a substantially  *    similar Disclaimer requirement for further binary redistribution.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF NONINFRINGEMENT, MERCHANTIBILITY  * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL  * THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY,  * OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER  * IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGES.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"diag.h"
end_include

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_include
include|#
directive|include
file|"ah_internal.h"
end_include

begin_include
include|#
directive|include
file|"ah_eeprom_v1.h"
end_include

begin_include
include|#
directive|include
file|"ah_eeprom_v3.h"
end_include

begin_include
include|#
directive|include
file|"ah_eeprom_v14.h"
end_include

begin_define
define|#
directive|define
name|IS_VERS
parameter_list|(
name|op
parameter_list|,
name|v
parameter_list|)
value|(eeprom.ee_version op (v))
end_define

begin_include
include|#
directive|include
file|<getopt.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|DIR_TEMPLATE
end_ifndef

begin_define
define|#
directive|define
name|DIR_TEMPLATE
value|"/usr/local/libdata/athprom"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|struct
name|ath_diag
name|atd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|s
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|char
modifier|*
name|progname
decl_stmt|;
end_decl_stmt

begin_union
union|union
block|{
name|HAL_EEPROM
name|legacy
decl_stmt|;
comment|/* format v3.x ... v5.x */
name|struct
name|ar5416eeprom
name|v14
decl_stmt|;
comment|/* 11n format v14.x ... */
block|}
name|eep
union|;
end_union

begin_define
define|#
directive|define
name|eeprom
value|eep.legacy
end_define

begin_define
define|#
directive|define
name|eepromN
value|eep.v14
end_define

begin_function_decl
specifier|static
name|void
name|parseTemplate
parameter_list|(
name|FILE
modifier|*
name|ftemplate
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint16_t
name|eeread
parameter_list|(
name|uint16_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|eewrite
parameter_list|(
name|uint16_t
parameter_list|,
name|uint16_t
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
name|usage
parameter_list|()
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: %s [-i ifname] [-t pathname] [offset | offset=value]\n"
argument_list|,
name|progname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|FILE
modifier|*
name|opentemplate
parameter_list|(
specifier|const
name|char
modifier|*
name|dir
parameter_list|)
block|{
name|char
name|filename
index|[
name|PATH_MAX
index|]
decl_stmt|;
name|FILE
modifier|*
name|fd
decl_stmt|;
comment|/* find the template using the eeprom version */
name|snprintf
argument_list|(
name|filename
argument_list|,
sizeof|sizeof
argument_list|(
name|filename
argument_list|)
argument_list|,
literal|"%s/eeprom-%d.%d"
argument_list|,
name|dir
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|>>
literal|12
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
name|fd
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|==
name|NULL
operator|&&
name|errno
operator|==
name|ENOENT
condition|)
block|{
comment|/* retry with just the major version */
name|snprintf
argument_list|(
name|filename
argument_list|,
sizeof|sizeof
argument_list|(
name|filename
argument_list|)
argument_list|,
literal|"%s/eeprom-%d"
argument_list|,
name|dir
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|>>
literal|12
argument_list|)
expr_stmt|;
name|fd
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|!=
name|NULL
condition|)
comment|/* XXX verbose */
name|warnx
argument_list|(
literal|"Using template file %s"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
return|return
name|fd
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|FILE
modifier|*
name|fd
init|=
name|NULL
decl_stmt|;
specifier|const
name|char
modifier|*
name|ifname
decl_stmt|;
name|int
name|c
decl_stmt|;
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
name|ifname
operator|=
name|getenv
argument_list|(
literal|"ATH"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ifname
condition|)
name|ifname
operator|=
name|ATH_DEFAULT
expr_stmt|;
name|progname
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"i:t:"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'i'
case|:
name|ifname
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|fd
operator|=
name|fopen
argument_list|(
name|optarg
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|==
name|NULL
condition|)
name|err
argument_list|(
operator|-
literal|1
argument_list|,
literal|"Cannot open %s"
argument_list|,
name|optarg
argument_list|)
expr_stmt|;
break|break;
default|default:
name|usage
argument_list|()
expr_stmt|;
comment|/*NOTREACHED*/
block|}
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
name|strncpy
argument_list|(
name|atd
operator|.
name|ad_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|atd
operator|.
name|ad_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|0
condition|)
block|{
for|for
control|(
init|;
name|argc
operator|>
literal|0
condition|;
name|argc
operator|--
operator|,
name|argv
operator|++
control|)
block|{
name|uint16_t
name|off
decl_stmt|,
name|val
decl_stmt|,
name|oval
decl_stmt|;
name|char
name|line
index|[
literal|256
index|]
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|;
name|cp
operator|=
name|strchr
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
operator|!=
name|NULL
condition|)
operator|*
name|cp
operator|=
literal|'\0'
expr_stmt|;
name|off
operator|=
operator|(
name|uint16_t
operator|)
name|strtoul
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
operator|&&
name|errno
operator|==
name|EINVAL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"%s: invalid eeprom offset %s"
argument_list|,
name|progname
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"%04x: %04x\n"
argument_list|,
name|off
argument_list|,
name|eeread
argument_list|(
name|off
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|val
operator|=
operator|(
name|uint16_t
operator|)
name|strtoul
argument_list|(
name|cp
operator|+
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|==
literal|0
operator|&&
name|errno
operator|==
name|EINVAL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"%s: invalid eeprom value %s"
argument_list|,
name|progname
argument_list|,
name|cp
operator|+
literal|1
argument_list|)
expr_stmt|;
name|oval
operator|=
name|eeread
argument_list|(
name|off
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Write %04x: %04x = %04x? "
argument_list|,
name|off
argument_list|,
name|oval
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|fgets
argument_list|(
name|line
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
argument_list|,
name|stdin
argument_list|)
operator|!=
name|NULL
operator|&&
name|line
index|[
literal|0
index|]
operator|==
literal|'y'
condition|)
name|eewrite
argument_list|(
name|off
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|atd
operator|.
name|ad_id
operator|=
name|HAL_DIAG_EEPROM
expr_stmt|;
name|atd
operator|.
name|ad_out_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|eep
expr_stmt|;
name|atd
operator|.
name|ad_out_size
operator|=
sizeof|sizeof
argument_list|(
name|eep
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGATHDIAG
argument_list|,
operator|&
name|atd
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"ioctl: %s"
argument_list|,
name|atd
operator|.
name|ad_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|==
name|NULL
condition|)
block|{
name|fd
operator|=
name|opentemplate
argument_list|(
name|DIR_TEMPLATE
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|==
name|NULL
condition|)
name|fd
operator|=
name|opentemplate
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|==
name|NULL
condition|)
name|errx
argument_list|(
operator|-
literal|1
argument_list|,
literal|"Cannot locate template file for "
literal|"v%d.%d EEPROM"
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|>>
literal|12
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
block|}
name|parseTemplate
argument_list|(
name|fd
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|u_int16_t
name|eeread
parameter_list|(
name|u_int16_t
name|off
parameter_list|)
block|{
name|u_int16_t
name|eedata
decl_stmt|;
name|atd
operator|.
name|ad_id
operator|=
name|HAL_DIAG_EEREAD
operator||
name|ATH_DIAG_IN
operator||
name|ATH_DIAG_DYN
expr_stmt|;
name|atd
operator|.
name|ad_in_size
operator|=
sizeof|sizeof
argument_list|(
name|off
argument_list|)
expr_stmt|;
name|atd
operator|.
name|ad_in_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|off
expr_stmt|;
name|atd
operator|.
name|ad_out_size
operator|=
sizeof|sizeof
argument_list|(
name|eedata
argument_list|)
expr_stmt|;
name|atd
operator|.
name|ad_out_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|eedata
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGATHDIAG
argument_list|,
operator|&
name|atd
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"ioctl: %s"
argument_list|,
name|atd
operator|.
name|ad_name
argument_list|)
expr_stmt|;
return|return
name|eedata
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|eewrite
parameter_list|(
name|uint16_t
name|off
parameter_list|,
name|uint16_t
name|value
parameter_list|)
block|{
name|HAL_DIAG_EEVAL
name|eeval
decl_stmt|;
name|eeval
operator|.
name|ee_off
operator|=
name|off
expr_stmt|;
name|eeval
operator|.
name|ee_data
operator|=
name|value
expr_stmt|;
name|atd
operator|.
name|ad_id
operator|=
name|HAL_DIAG_EEWRITE
operator||
name|ATH_DIAG_IN
expr_stmt|;
name|atd
operator|.
name|ad_in_size
operator|=
sizeof|sizeof
argument_list|(
name|eeval
argument_list|)
expr_stmt|;
name|atd
operator|.
name|ad_in_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|eeval
expr_stmt|;
name|atd
operator|.
name|ad_out_size
operator|=
literal|0
expr_stmt|;
name|atd
operator|.
name|ad_out_data
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGATHDIAG
argument_list|,
operator|&
name|atd
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"ioctl: %s"
argument_list|,
name|atd
operator|.
name|ad_name
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|MAXID
value|128
end_define

begin_decl_stmt
name|int
name|lineno
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|bol
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|curmode
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|curchan
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|curpdgain
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* raw pdgain index */
end_comment

begin_decl_stmt
name|int
name|curlpdgain
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* logical pdgain index */
end_comment

begin_decl_stmt
name|int
name|curpcdac
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|curctl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|numChannels
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|RAW_DATA_STRUCT_2413
modifier|*
name|pRaw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|TRGT_POWER_INFO
modifier|*
name|pPowerInfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|DATA_PER_CHANNEL
modifier|*
name|pDataPerChannel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|EEPROM_POWER_EXPN_5112
modifier|*
name|pExpnPower
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|singleXpd
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|token
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|char
name|id
index|[]
parameter_list|,
name|int
name|maxid
parameter_list|,
specifier|const
name|char
modifier|*
name|what
parameter_list|)
block|{
name|int
name|c
decl_stmt|,
name|i
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
return|return
name|EOF
return|;
if|if
condition|(
operator|!
name|isalnum
argument_list|(
name|c
argument_list|)
operator|&&
name|c
operator|!=
literal|'_'
condition|)
block|{
name|ungetc
argument_list|(
name|c
argument_list|,
name|fd
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|i
operator|==
name|maxid
operator|-
literal|1
condition|)
block|{
name|warnx
argument_list|(
literal|"line %d, %s too long"
argument_list|,
name|lineno
argument_list|,
name|what
argument_list|)
expr_stmt|;
break|break;
block|}
name|id
index|[
name|i
operator|++
index|]
operator|=
name|c
expr_stmt|;
block|}
name|id
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|bol
operator|=
literal|0
expr_stmt|;
return|return
name|i
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|skipto
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
specifier|const
name|char
modifier|*
name|what
parameter_list|)
block|{
name|char
name|id
index|[
name|MAXID
index|]
decl_stmt|;
name|int
name|c
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
goto|goto
name|bad
goto|;
if|if
condition|(
name|c
operator|==
literal|'.'
operator|&&
name|bol
condition|)
block|{
comment|/* .directive */
if|if
condition|(
name|token
argument_list|(
name|fd
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|".directive"
argument_list|)
operator|==
name|EOF
condition|)
goto|goto
name|bad
goto|;
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
name|what
argument_list|)
operator|==
literal|0
condition|)
break|break;
continue|continue;
block|}
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
block|{
comment|/* escape next character */
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
goto|goto
name|bad
goto|;
block|}
name|bol
operator|=
operator|(
name|c
operator|==
literal|'\n'
operator|)
expr_stmt|;
if|if
condition|(
name|bol
condition|)
name|lineno
operator|++
expr_stmt|;
block|}
return|return
literal|0
return|;
name|bad
label|:
name|warnx
argument_list|(
literal|"EOF with no matching .%s"
argument_list|,
name|what
argument_list|)
expr_stmt|;
return|return
name|EOF
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|skipws
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|)
block|{
name|int
name|c
decl_stmt|,
name|i
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
operator|)
operator|!=
name|EOF
operator|&&
name|isblank
argument_list|(
name|c
argument_list|)
condition|)
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|!=
name|EOF
condition|)
name|ungetc
argument_list|(
name|c
argument_list|,
name|fd
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|0
condition|)
name|bol
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|setmode
parameter_list|(
name|int
name|mode
parameter_list|)
block|{
name|EEPROM_POWER_EXPN_5112
modifier|*
name|exp
decl_stmt|;
name|curmode
operator|=
name|mode
expr_stmt|;
name|curchan
operator|=
operator|-
literal|1
expr_stmt|;
name|curctl
operator|=
operator|-
literal|1
expr_stmt|;
name|curpdgain
operator|=
operator|-
literal|1
expr_stmt|;
name|curlpdgain
operator|=
operator|-
literal|1
expr_stmt|;
name|curpcdac
operator|=
operator|-
literal|1
expr_stmt|;
switch|switch
condition|(
name|curmode
condition|)
block|{
case|case
name|headerInfo11A
case|:
name|pPowerInfo
operator|=
name|eeprom
operator|.
name|ee_trgtPwr_11a
expr_stmt|;
name|pDataPerChannel
operator|=
name|eeprom
operator|.
name|ee_dataPerChannel11a
expr_stmt|;
break|break;
case|case
name|headerInfo11B
case|:
name|pPowerInfo
operator|=
name|eeprom
operator|.
name|ee_trgtPwr_11b
expr_stmt|;
name|pDataPerChannel
operator|=
name|eeprom
operator|.
name|ee_dataPerChannel11b
expr_stmt|;
break|break;
case|case
name|headerInfo11G
case|:
name|pPowerInfo
operator|=
name|eeprom
operator|.
name|ee_trgtPwr_11g
expr_stmt|;
name|pDataPerChannel
operator|=
name|eeprom
operator|.
name|ee_dataPerChannel11g
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER4_0
argument_list|)
condition|)
comment|/* nothing to do */
return|return;
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
block|{
name|exp
operator|=
operator|&
name|eeprom
operator|.
name|ee_modePowerArray5112
index|[
name|curmode
index|]
expr_stmt|;
comment|/* fetch indirect data*/
name|atd
operator|.
name|ad_id
operator|=
name|HAL_DIAG_EEPROM_EXP_11A
operator|+
name|curmode
expr_stmt|;
name|atd
operator|.
name|ad_out_size
operator|=
name|roundup
argument_list|(
sizeof|sizeof
argument_list|(
name|u_int16_t
argument_list|)
operator|*
name|exp
operator|->
name|numChannels
argument_list|,
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|EXPN_DATA_PER_CHANNEL_5112
argument_list|)
operator|*
name|exp
operator|->
name|numChannels
expr_stmt|;
name|atd
operator|.
name|ad_out_data
operator|=
operator|(
name|caddr_t
operator|)
name|malloc
argument_list|(
name|atd
operator|.
name|ad_out_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGATHDIAG
argument_list|,
operator|&
name|atd
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"ioctl: %s"
argument_list|,
name|atd
operator|.
name|ad_name
argument_list|)
expr_stmt|;
name|exp
operator|->
name|pChannels
operator|=
operator|(
name|void
operator|*
operator|)
name|atd
operator|.
name|ad_out_data
expr_stmt|;
name|exp
operator|->
name|pDataPerChannel
operator|=
operator|(
name|void
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|atd
operator|.
name|ad_out_data
operator|+
name|roundup
argument_list|(
sizeof|sizeof
argument_list|(
name|u_int16_t
argument_list|)
operator|*
name|exp
operator|->
name|numChannels
argument_list|,
sizeof|sizeof
argument_list|(
name|u_int32_t
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|pExpnPower
operator|=
name|exp
expr_stmt|;
name|numChannels
operator|=
name|pExpnPower
operator|->
name|numChannels
expr_stmt|;
if|if
condition|(
name|exp
operator|->
name|xpdMask
operator|!=
literal|0x9
condition|)
block|{
for|for
control|(
name|singleXpd
operator|=
literal|0
init|;
name|singleXpd
operator|<
name|NUM_XPD_PER_CHANNEL
condition|;
name|singleXpd
operator|++
control|)
if|if
condition|(
name|exp
operator|->
name|xpdMask
operator|==
operator|(
literal|1
operator|<<
name|singleXpd
operator|)
condition|)
break|break;
block|}
else|else
name|singleXpd
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
name|pRaw
operator|=
operator|&
name|eeprom
operator|.
name|ee_rawDataset2413
index|[
name|curmode
index|]
expr_stmt|;
name|numChannels
operator|=
name|pRaw
operator|->
name|numChannels
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|nextctl
parameter_list|(
name|int
name|start
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|eeprom
operator|.
name|ee_numCtls
operator|&&
name|eeprom
operator|.
name|ee_ctl
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|eeprom
operator|.
name|ee_ctl
index|[
name|i
index|]
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|3
case|:
if|if
condition|(
name|curmode
operator|!=
name|headerInfo11A
condition|)
continue|continue;
break|break;
case|case
literal|1
case|:
if|if
condition|(
name|curmode
operator|!=
name|headerInfo11B
condition|)
continue|continue;
break|break;
case|case
literal|2
case|:
if|if
condition|(
name|curmode
operator|!=
name|headerInfo11G
condition|)
continue|continue;
break|break;
block|}
return|return
name|i
return|;
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|printAntennaControl
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|ant
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02X"
argument_list|,
name|eeprom
operator|.
name|ee_antennaControl
index|[
name|ant
index|]
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printEdge
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|edge
parameter_list|)
block|{
specifier|const
name|RD_EDGES_POWER
modifier|*
name|pRdEdgePwrInfo
init|=
operator|&
name|eeprom
operator|.
name|ee_rdEdgesPower
index|[
name|curctl
operator|*
name|NUM_EDGES
index|]
decl_stmt|;
if|if
condition|(
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|rdEdge
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" -- "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%04d"
argument_list|,
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|rdEdge
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printEdgePower
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|edge
parameter_list|)
block|{
specifier|const
name|RD_EDGES_POWER
modifier|*
name|pRdEdgePwrInfo
init|=
operator|&
name|eeprom
operator|.
name|ee_rdEdgesPower
index|[
name|curctl
operator|*
name|NUM_EDGES
index|]
decl_stmt|;
if|if
condition|(
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|rdEdge
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" -- "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d.%d"
argument_list|,
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|twice_rdEdgePower
operator|/
literal|2
argument_list|,
operator|(
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|twice_rdEdgePower
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printEdgeFlag
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|edge
parameter_list|)
block|{
specifier|const
name|RD_EDGES_POWER
modifier|*
name|pRdEdgePwrInfo
init|=
operator|&
name|eeprom
operator|.
name|ee_rdEdgesPower
index|[
name|curctl
operator|*
name|NUM_EDGES
index|]
decl_stmt|;
if|if
condition|(
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|rdEdge
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"--"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" %1d"
argument_list|,
name|pRdEdgePwrInfo
index|[
name|edge
index|]
operator|.
name|flag
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int16_t
name|getMaxPowerV5
parameter_list|(
specifier|const
name|RAW_DATA_PER_CHANNEL_2413
modifier|*
name|data
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|uint16_t
name|numVpd
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_NUM_PDGAINS_PER_CHANNEL
condition|;
name|i
operator|++
control|)
block|{
name|numVpd
operator|=
name|data
operator|->
name|pDataPerPDGain
index|[
name|i
index|]
operator|.
name|numVpd
expr_stmt|;
if|if
condition|(
name|numVpd
operator|>
literal|0
condition|)
return|return
name|data
operator|->
name|pDataPerPDGain
index|[
name|i
index|]
operator|.
name|pwr_t4
index|[
name|numVpd
operator|-
literal|1
index|]
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|printQuarterDbmPower
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int16_t
name|power25dBm
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d.%02d"
argument_list|,
name|power25dBm
operator|/
literal|4
argument_list|,
operator|(
name|power25dBm
operator|%
literal|4
operator|)
operator|*
literal|25
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printHalfDbmPower
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int16_t
name|power5dBm
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d.%d"
argument_list|,
name|power5dBm
operator|/
literal|2
argument_list|,
operator|(
name|power5dBm
operator|%
literal|2
operator|)
operator|*
literal|5
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printVpd
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|vpd
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"[%3d]"
argument_list|,
name|vpd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|printPcdacValue
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|int
name|v
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d.%02d"
argument_list|,
name|v
operator|/
name|EEP_SCALE
argument_list|,
name|v
operator|%
name|EEP_SCALE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|undef
parameter_list|(
specifier|const
name|char
modifier|*
name|what
parameter_list|)
block|{
name|warnx
argument_list|(
literal|"%s undefined for version %d.%d format EEPROM"
argument_list|,
name|what
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|>>
literal|12
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|pdgain
parameter_list|(
name|int
name|lpdgain
parameter_list|)
block|{
name|uint32_t
name|mask
decl_stmt|;
name|int
name|i
decl_stmt|,
name|l
init|=
name|lpdgain
decl_stmt|;
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
name|mask
operator|=
name|pExpnPower
operator|->
name|xpdMask
expr_stmt|;
else|else
name|mask
operator|=
name|pRaw
operator|->
name|xpd_mask
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|mask
operator|!=
literal|0
condition|;
name|mask
operator|>>=
literal|1
operator|,
name|i
operator|++
control|)
if|if
condition|(
operator|(
name|mask
operator|&
literal|1
operator|)
operator|&&
name|l
operator|--
operator|==
literal|0
condition|)
return|return
name|i
return|;
name|warnx
argument_list|(
literal|"can't find logical pdgain %d"
argument_list|,
name|lpdgain
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_define
define|#
directive|define
name|COUNTRY_ERD_FLAG
value|0x8000
end_define

begin_define
define|#
directive|define
name|WORLDWIDE_ROAMING_FLAG
value|0x4000
end_define

begin_function
name|void
name|eevar
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
specifier|const
name|char
modifier|*
name|var
parameter_list|)
block|{
define|#
directive|define
name|streq
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(strcasecmp(a,b) == 0)
define|#
directive|define
name|strneq
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|n
parameter_list|)
value|(strncasecmp(a,b,n) == 0)
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"mode"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s"
argument_list|,
name|curmode
operator|==
name|headerInfo11A
condition|?
literal|"11a"
else|:
name|curmode
operator|==
name|headerInfo11B
condition|?
literal|"11b"
else|:
name|curmode
operator|==
name|headerInfo11G
condition|?
literal|"11g"
else|:
literal|"???"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"version"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%04x"
argument_list|,
name|eeprom
operator|.
name|ee_version
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"V_major"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|>>
literal|12
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"V_minor"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_version
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"earStart"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%03x"
argument_list|,
name|eeprom
operator|.
name|ee_earStart
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"tpStart"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%03x"
argument_list|,
name|eeprom
operator|.
name|ee_targetPowersStart
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"eepMap"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eeprom
operator|.
name|ee_eepMap
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"exist32KHzCrystal"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eeprom
operator|.
name|ee_exist32kHzCrystal
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"eepMap2PowerCalStart"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eeprom
operator|.
name|ee_eepMap2PowerCalStart
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"Amode"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_Amode
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"Bmode"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_Bmode
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"Gmode"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_Gmode
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"regdomain"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|eeprom
operator|.
name|ee_regdomain
operator|&
name|COUNTRY_ERD_FLAG
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%03X "
argument_list|,
name|eeprom
operator|.
name|ee_regdomain
operator|>>
literal|15
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%-3dC"
argument_list|,
name|eeprom
operator|.
name|ee_regdomain
operator|&
literal|0xfff
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"turbo2Disable"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_turbo2Disable
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"turbo5Disable"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_turbo5Disable
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"rfKill"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_rfKill
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"disableXr5"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_disableXr5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"disableXr2"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_disableXr2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"turbo2WMaxPower5"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_turbo2WMaxPower5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"cckOfdmDelta"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_cckOfdmPwrDelta
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"gainI"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_gainI
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"WWR"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1x"
argument_list|,
operator|(
name|eeprom
operator|.
name|ee_regdomain
operator|&
name|WORLDWIDE_ROAMING_FLAG
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"falseDetectBackoff"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_falseDetectBackoff
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"deviceType"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1x"
argument_list|,
name|eeprom
operator|.
name|ee_deviceType
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"switchSettling"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_switchSettling
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|switchSettling
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"adcDesiredSize"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_adcDesiredSize
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|adcDesiredSize
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xlnaGain"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_xlnaGain
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txEndToXLNAOn"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_txEndToXLNAOn
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"thresh62"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_thresh62
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|thresh62
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txEndToRxOn"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txEndToRxOn
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txEndToXPAOff"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_txEndToXPAOff
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txEndToXpaOff
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txFrameToXPAOn"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_txFrameToXPAOn
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txEndToRxOn
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pgaDesiredSize"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_pgaDesiredSize
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|pgaDesiredSize
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"noiseFloorThresh"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eeprom
operator|.
name|ee_noiseFloorThresh
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"noiseFloorThreshCh"
argument_list|,
literal|18
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|noiseFloorThreshCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|18
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"xlnaGainCh"
argument_list|,
literal|10
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|xlnaGainCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|10
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xgain"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_xgain
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xpd"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_xpd
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|xpd
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txrxAtten"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_txrxAtten
index|[
name|curmode
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"capField"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eeprom
operator|.
name|ee_capField
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txrxAttenTurbo"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_txrxAtten
index|[
name|curmode
operator|!=
name|headerInfo11A
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"switchSettlingTurbo"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02X"
argument_list|,
name|eeprom
operator|.
name|ee_switchSettlingTurbo
index|[
name|curmode
operator|!=
name|headerInfo11A
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"adcDesiredSizeTurbo"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_adcDesiredSizeTurbo
index|[
name|curmode
operator|!=
name|headerInfo11A
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pgaDesiredSizeTurbo"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|eeprom
operator|.
name|ee_pgaDesiredSizeTurbo
index|[
name|curmode
operator|!=
name|headerInfo11A
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"rxtxMarginTurbo"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|eeprom
operator|.
name|ee_rxtxMarginTurbo
index|[
name|curmode
operator|!=
name|headerInfo11A
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"antennaControl"
argument_list|,
literal|14
argument_list|)
condition|)
block|{
name|printAntennaControl
argument_list|(
name|fd
argument_list|,
name|atoi
argument_list|(
name|var
operator|+
literal|14
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"antCtrlChain"
argument_list|,
literal|12
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%08X"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|antCtrlChain
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|12
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"antGainCh"
argument_list|,
literal|9
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|antennaGainCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|9
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"txRxAttenCh"
argument_list|,
literal|11
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txRxAttenCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|11
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"rxTxMarginCh"
argument_list|,
literal|12
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|rxTxMarginCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|12
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xpdGain"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|xpdGain
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"iqCalICh"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|iqCalICh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"iqCalQCh"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|iqCalQCh
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pdGainOverlap"
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|pdGainOverlap
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob1"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob2"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob3"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob3
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob4"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob4
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db1"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db2"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db3"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db3
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db4"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db4
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"obFor24"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_obFor24
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob2GHz0"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob2GHz
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"dbFor24"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_dbFor24
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db2GHz0"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db2GHz
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"obFor24g"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_obFor24g
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob2GHz1"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_ob2GHz
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"dbFor24g"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_dbFor24g
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db2GHz1"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%1d"
argument_list|,
name|eeprom
operator|.
name|ee_db2GHz
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ob"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|ob
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"db"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|db
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xpaBiasLvl"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|xpaBiasLvl
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pwrDecreaseFor2Chain"
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|pwrDecreaseFor2Chain
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pwrDecreaseFor3Chain"
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|pwrDecreaseFor3Chain
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txFrameToDataStart"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txFrameToDataStart
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txFrameToPaOn"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|txFrameToPaOn
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ht40PowerIncForPdadc"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
name|eepromN
operator|.
name|modalHeader
index|[
name|curmode
index|]
operator|.
name|ht40PowerIncForPdadc
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"checksum"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|checksum
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"length"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"regDmn0"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|regDmn
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"regDmn1"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|regDmn
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"txMask"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|txMask
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"rxMask"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|rxMask
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"rfSilent"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|rfSilent
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"btOptions"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|blueToothOptions
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"deviceCap"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%04X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|deviceCap
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"macaddr"
argument_list|,
literal|7
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%02X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|macAddr
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|7
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"opCapFlags"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|opCapFlags
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"eepMisc"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02X"
argument_list|,
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|eepMisc
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"binBuildNumber"
argument_list|,
literal|14
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%3d"
argument_list|,
operator|(
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|binBuildNumber
operator|>>
operator|(
literal|8
operator|*
name|atoi
argument_list|(
name|var
operator|+
literal|14
argument_list|)
operator|)
operator|)
operator|&
literal|0xff
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"custData"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2.2X"
argument_list|,
name|eepromN
operator|.
name|custData
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"xpd_mask"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|pExpnPower
operator|->
name|xpdMask
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%02x"
argument_list|,
name|pRaw
operator|->
name|xpd_mask
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"numChannels"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|pExpnPower
operator|->
name|numChannels
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|pRaw
operator|->
name|numChannels
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"freq"
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%4d"
argument_list|,
name|pExpnPower
operator|->
name|pChannels
index|[
name|curchan
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%4d"
argument_list|,
name|pRaw
operator|->
name|pChannels
index|[
name|curchan
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"maxpow"
argument_list|)
condition|)
block|{
name|int16_t
name|maxPower_t4
decl_stmt|;
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
block|{
name|maxPower_t4
operator|=
name|pExpnPower
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|maxPower_t4
expr_stmt|;
block|}
else|else
block|{
name|maxPower_t4
operator|=
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|maxPower_t4
expr_stmt|;
if|if
condition|(
name|maxPower_t4
operator|==
literal|0
condition|)
name|maxPower_t4
operator|=
name|getMaxPowerV5
argument_list|(
operator|&
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
argument_list|)
expr_stmt|;
block|}
name|printQuarterDbmPower
argument_list|(
name|fd
argument_list|,
name|maxPower_t4
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"pd_gain"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%4d"
argument_list|,
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerPDGain
index|[
name|curpdgain
index|]
operator|.
name|pd_gain
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"maxpwr"
argument_list|,
literal|6
argument_list|)
condition|)
block|{
name|int
name|vpd
init|=
name|atoi
argument_list|(
name|var
operator|+
literal|6
argument_list|)
decl_stmt|;
if|if
condition|(
name|vpd
operator|<
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerPDGain
index|[
name|curpdgain
index|]
operator|.
name|numVpd
condition|)
name|printQuarterDbmPower
argument_list|(
name|fd
argument_list|,
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerPDGain
index|[
name|curpdgain
index|]
operator|.
name|pwr_t4
index|[
name|vpd
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"     "
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwr_t4_"
argument_list|,
literal|7
argument_list|)
condition|)
block|{
name|printQuarterDbmPower
argument_list|(
name|fd
argument_list|,
name|pExpnPower
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerXPD
index|[
name|singleXpd
index|]
operator|.
name|pwr_t4
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|7
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"Vpd"
argument_list|,
literal|3
argument_list|)
condition|)
block|{
name|int
name|vpd
init|=
name|atoi
argument_list|(
name|var
operator|+
literal|3
argument_list|)
decl_stmt|;
if|if
condition|(
name|vpd
operator|<
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerPDGain
index|[
name|curpdgain
index|]
operator|.
name|numVpd
condition|)
name|printVpd
argument_list|(
name|fd
argument_list|,
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerPDGain
index|[
name|curpdgain
index|]
operator|.
name|Vpd
index|[
name|vpd
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"     "
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"CTL"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%2x"
argument_list|,
name|eeprom
operator|.
name|ee_ctl
index|[
name|curctl
index|]
operator|&
literal|0xff
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ctlType"
argument_list|)
condition|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|ctlType
index|[
literal|16
index|]
init|=
block|{
literal|"11a base"
block|,
literal|"11b"
block|,
literal|"11g"
block|,
literal|"11a TURBO"
block|,
literal|"108g"
block|,
literal|"2GHT20"
block|,
literal|"5GHT20"
block|,
literal|"2GHT40"
block|,
literal|"5GHT40"
block|,
literal|"0x9"
block|,
literal|"0xa"
block|,
literal|"0xb"
block|,
literal|"0xc"
block|,
literal|"0xd"
block|,
literal|"0xe"
block|,
literal|"0xf"
block|, 		}
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%8s"
argument_list|,
name|ctlType
index|[
name|eeprom
operator|.
name|ee_ctl
index|[
name|curctl
index|]
operator|&
name|CTL_MODE_M
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"ctlRD"
argument_list|)
condition|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|ctlRD
index|[
literal|8
index|]
init|=
block|{
literal|"0x00"
block|,
literal|" FCC"
block|,
literal|"0x20"
block|,
literal|"ETSI"
block|,
literal|" MKK"
block|,
literal|"0x50"
block|,
literal|"0x60"
block|,
literal|"0x70"
block|}
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s"
argument_list|,
name|ctlRD
index|[
operator|(
name|eeprom
operator|.
name|ee_ctl
index|[
name|curctl
index|]
operator|>>
literal|4
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"rdEdgePower"
argument_list|,
literal|11
argument_list|)
condition|)
block|{
name|printEdgePower
argument_list|(
name|fd
argument_list|,
name|atoi
argument_list|(
name|var
operator|+
literal|11
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"rdEdgeFlag"
argument_list|,
literal|10
argument_list|)
condition|)
block|{
name|printEdgeFlag
argument_list|(
name|fd
argument_list|,
name|atoi
argument_list|(
name|var
operator|+
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"rdEdge"
argument_list|,
literal|6
argument_list|)
condition|)
block|{
name|printEdge
argument_list|(
name|fd
argument_list|,
name|atoi
argument_list|(
name|var
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"testChannel"
argument_list|,
literal|11
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%4d"
argument_list|,
name|pPowerInfo
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|11
argument_list|)
index|]
operator|.
name|testChannel
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwr6_24_"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|pPowerInfo
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
operator|.
name|twicePwr6_24
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwr36_"
argument_list|,
literal|6
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|pPowerInfo
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|6
argument_list|)
index|]
operator|.
name|twicePwr36
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwr48_"
argument_list|,
literal|6
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|pPowerInfo
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|6
argument_list|)
index|]
operator|.
name|twicePwr48
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwr54_"
argument_list|,
literal|6
argument_list|)
condition|)
block|{
name|printHalfDbmPower
argument_list|(
name|fd
argument_list|,
name|pPowerInfo
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|6
argument_list|)
index|]
operator|.
name|twicePwr54
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"channelValue"
argument_list|,
literal|12
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%4d"
argument_list|,
name|pDataPerChannel
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|12
argument_list|)
index|]
operator|.
name|channelValue
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pcdacMin"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%02d"
argument_list|,
name|pDataPerChannel
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
operator|.
name|pcdacMin
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pcdacMax"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%02d"
argument_list|,
name|pDataPerChannel
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
operator|.
name|pcdacMax
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pcdac"
argument_list|,
literal|5
argument_list|)
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER4_0
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%02d"
argument_list|,
name|pDataPerChannel
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|5
argument_list|)
index|]
operator|.
name|PcdacValues
index|[
name|curpcdac
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER5_0
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%02d"
argument_list|,
name|pExpnPower
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|pDataPerXPD
index|[
name|singleXpd
index|]
operator|.
name|pcdac
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|5
argument_list|)
index|]
argument_list|)
expr_stmt|;
block|}
else|else
name|undef
argument_list|(
literal|"pcdac"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strneq
argument_list|(
name|var
argument_list|,
literal|"pwrValue"
argument_list|,
literal|8
argument_list|)
condition|)
block|{
name|printPcdacValue
argument_list|(
name|fd
argument_list|,
name|pDataPerChannel
index|[
name|atoi
argument_list|(
name|var
operator|+
literal|8
argument_list|)
index|]
operator|.
name|PwrValues
index|[
name|curpcdac
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|streq
argument_list|(
name|var
argument_list|,
literal|"singleXpd"
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%2d"
argument_list|,
name|singleXpd
argument_list|)
expr_stmt|;
block|}
else|else
name|warnx
argument_list|(
literal|"line %u, unknown EEPROM variable \"%s\""
argument_list|,
name|lineno
argument_list|,
name|var
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|strneq
undef|#
directive|undef
name|streq
block|}
end_function

begin_function
specifier|static
name|void
name|ifmode
parameter_list|(
name|FILE
modifier|*
name|ftemplate
parameter_list|,
specifier|const
name|char
modifier|*
name|mode
parameter_list|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|mode
argument_list|,
literal|"11a"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
if|if
condition|(
name|eeprom
operator|.
name|ee_Amode
condition|)
name|setmode
argument_list|(
name|headerInfo11A
argument_list|)
expr_stmt|;
else|else
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|IS_VERS
argument_list|(
operator|>=
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
if|if
condition|(
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|opCapFlags
operator|&
name|AR5416_OPFLAGS_11A
condition|)
name|setmode
argument_list|(
name|headerInfo11A
argument_list|)
expr_stmt|;
else|else
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|mode
argument_list|,
literal|"11g"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
if|if
condition|(
name|eeprom
operator|.
name|ee_Gmode
condition|)
name|setmode
argument_list|(
name|headerInfo11G
argument_list|)
expr_stmt|;
else|else
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|IS_VERS
argument_list|(
operator|>=
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
if|if
condition|(
name|eepromN
operator|.
name|baseEepHeader
operator|.
name|opCapFlags
operator|&
name|AR5416_OPFLAGS_11G
condition|)
name|setmode
argument_list|(
name|headerInfo11B
argument_list|)
expr_stmt|;
comment|/* NB: 2.4GHz */
else|else
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|mode
argument_list|,
literal|"11b"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|IS_VERS
argument_list|(
operator|<
argument_list|,
name|AR_EEPROM_VER14_2
argument_list|)
condition|)
block|{
if|if
condition|(
name|eeprom
operator|.
name|ee_Bmode
condition|)
name|setmode
argument_list|(
name|headerInfo11B
argument_list|)
expr_stmt|;
else|else
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|warnx
argument_list|(
literal|"line %d, unknown/unexpected mode \"%s\" ignored"
argument_list|,
name|lineno
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endmode"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|parseTemplate
parameter_list|(
name|FILE
modifier|*
name|ftemplate
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|)
block|{
name|int
name|c
decl_stmt|,
name|i
decl_stmt|;
name|char
name|id
index|[
name|MAXID
index|]
decl_stmt|;
name|long
name|forchan
decl_stmt|,
name|forpdgain
decl_stmt|,
name|forctl
decl_stmt|,
name|forpcdac
decl_stmt|;
name|lineno
operator|=
literal|1
expr_stmt|;
name|bol
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getc
argument_list|(
name|ftemplate
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'#'
condition|)
block|{
comment|/* comment */
name|skiptoeol
label|:
while|while
condition|(
operator|(
name|c
operator|=
name|getc
argument_list|(
name|ftemplate
argument_list|)
operator|)
operator|!=
name|EOF
operator|&&
name|c
operator|!=
literal|'\n'
condition|)
empty_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
return|return;
name|lineno
operator|++
expr_stmt|;
name|bol
operator|=
literal|1
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|c
operator|==
literal|'.'
operator|&&
name|bol
condition|)
block|{
comment|/* .directive */
if|if
condition|(
name|token
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|".directive"
argument_list|)
operator|==
name|EOF
condition|)
return|return;
comment|/* process directive */
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"ifmode"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|skipws
argument_list|(
name|ftemplate
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|"id"
argument_list|)
operator|==
name|EOF
condition|)
return|return;
name|ifmode
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endmode"
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* XXX free malloc'd indirect data */
name|curmode
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* NB: undefined */
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"forchan"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|forchan
operator|=
name|ftell
argument_list|(
name|ftemplate
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
literal|"forchan"
argument_list|)
expr_stmt|;
if|if
condition|(
name|curchan
operator|==
operator|-
literal|1
condition|)
name|curchan
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endforchan"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|curchan
operator|<
name|numChannels
condition|)
name|fseek
argument_list|(
name|ftemplate
argument_list|,
name|forchan
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
else|else
name|curchan
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"ifpdgain"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|skipws
argument_list|(
name|ftemplate
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|"pdgain"
argument_list|)
operator|==
name|EOF
condition|)
return|return;
name|curlpdgain
operator|=
name|strtoul
argument_list|(
name|id
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|curlpdgain
operator|>=
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|numPdGains
condition|)
block|{
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endpdgain"
argument_list|)
expr_stmt|;
name|curlpdgain
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
name|curpdgain
operator|=
name|pdgain
argument_list|(
name|curlpdgain
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endpdgain"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|curlpdgain
operator|=
name|curpdgain
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"forpdgain"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|forpdgain
operator|=
name|ftell
argument_list|(
name|ftemplate
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
literal|"forpdgain"
argument_list|)
expr_stmt|;
if|if
condition|(
name|curlpdgain
operator|==
operator|-
literal|1
condition|)
block|{
name|skipws
argument_list|(
name|ftemplate
argument_list|)
expr_stmt|;
if|if
condition|(
name|token
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|"pdgain"
argument_list|)
operator|==
name|EOF
condition|)
return|return;
name|curlpdgain
operator|=
name|strtoul
argument_list|(
name|id
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|curlpdgain
operator|>=
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|numPdGains
condition|)
block|{
name|skipto
argument_list|(
name|ftemplate
argument_list|,
literal|"endforpdgain"
argument_list|)
expr_stmt|;
name|curlpdgain
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
name|curpdgain
operator|=
name|pdgain
argument_list|(
name|curlpdgain
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endforpdgain"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|curpdgain
operator|<
name|pRaw
operator|->
name|pDataPerChannel
index|[
name|curchan
index|]
operator|.
name|numPdGains
condition|)
name|fseek
argument_list|(
name|ftemplate
argument_list|,
name|forpdgain
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
else|else
name|curpdgain
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"forpcdac"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|forpcdac
operator|=
name|ftell
argument_list|(
name|ftemplate
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
literal|"forpcdac"
argument_list|)
expr_stmt|;
if|if
condition|(
name|curpcdac
operator|==
operator|-
literal|1
condition|)
name|curpcdac
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endforpcdac"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|curpcdac
operator|<
name|pDataPerChannel
index|[
literal|0
index|]
operator|.
name|numPcdacValues
condition|)
name|fseek
argument_list|(
name|ftemplate
argument_list|,
name|forpcdac
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
else|else
name|curpcdac
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"forctl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|forctl
operator|=
name|ftell
argument_list|(
name|ftemplate
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
literal|"forchan"
argument_list|)
expr_stmt|;
if|if
condition|(
name|curctl
operator|==
operator|-
literal|1
condition|)
name|curctl
operator|=
name|nextctl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|id
argument_list|,
literal|"endforctl"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|curctl
operator|=
name|nextctl
argument_list|(
name|curctl
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|curctl
operator|!=
operator|-
literal|1
condition|)
name|fseek
argument_list|(
name|ftemplate
argument_list|,
name|forctl
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|warnx
argument_list|(
literal|"line %d, unknown directive %s ignored"
argument_list|,
name|lineno
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
goto|goto
name|skiptoeol
goto|;
block|}
if|if
condition|(
name|c
operator|==
literal|'$'
condition|)
block|{
comment|/* $variable reference */
if|if
condition|(
name|token
argument_list|(
name|ftemplate
argument_list|,
name|id
argument_list|,
name|MAXID
argument_list|,
literal|"$var"
argument_list|)
operator|==
name|EOF
condition|)
return|return;
comment|/* XXX not valid if variable depends on curmode */
name|eevar
argument_list|(
name|fd
argument_list|,
name|id
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
block|{
comment|/* escape next character */
name|c
operator|=
name|getc
argument_list|(
name|ftemplate
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
return|return;
block|}
name|fputc
argument_list|(
name|c
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|bol
operator|=
operator|(
name|c
operator|==
literal|'\n'
operator|)
expr_stmt|;
if|if
condition|(
name|bol
condition|)
name|lineno
operator|++
expr_stmt|;
block|}
block|}
end_function

end_unit

