begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*===-- main.c - tool for testing libLLVM and llvm-c API ------------------===*\ |*                                                                            *| |*                     The LLVM Compiler Infrastructure                       *| |*                                                                            *| |* This file is distributed under the University of Illinois Open Source      *| |* License. See LICENSE.TXT for details.                                      *| |*                                                                            *| |*===----------------------------------------------------------------------===*| |*                                                                            *| |* Main file for llvm-c-tests. "Parses" arguments and dispatches.             *| |*                                                                            *| \*===----------------------------------------------------------------------===*/
end_comment

begin_include
include|#
directive|include
file|"llvm-c-test.h"
end_include

begin_include
include|#
directive|include
file|"llvm-c/BitReader.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_function
specifier|static
name|void
name|print_usage
parameter_list|(
name|void
parameter_list|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"llvm-c-test command\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" Commands:\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --module-dump\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode from stdin - print disassembly\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --lazy-module-dump\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Lazily read bitcode from stdin - print disassembly\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --new-module-dump\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode from stdin - print disassembly\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --lazy-new-module-dump\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Lazily read bitcode from stdin - print disassembly\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --module-list-functions\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode from stdin - list summary of functions\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --module-list-globals\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode from stdin - list summary of globals\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --targets-list\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    List available targets\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --object-list-sections\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read object file form stdin - list sections\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --object-list-symbols\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read object file form stdin - list symbols (like nm)\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --disassemble\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read lines of triple, hex ascii machine code from stdin "
literal|"- print disassembly\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --calc\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read lines of name, rpn from stdin - print generated module\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --echo\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode file form stdin - print it back out\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"  * --test-diagnostic-handler\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"    Read bitcode file form stdin with a diagnostic handler set\n\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|LLVMPassRegistryRef
name|pr
init|=
name|LLVMGetGlobalPassRegistry
argument_list|()
decl_stmt|;
name|LLVMInitializeCore
argument_list|(
name|pr
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--lazy-new-module-dump"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_dump
argument_list|(
name|true
argument_list|,
name|true
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--new-module-dump"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_dump
argument_list|(
name|false
argument_list|,
name|true
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--lazy-module-dump"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_dump
argument_list|(
name|true
argument_list|,
name|false
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--module-dump"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_dump
argument_list|(
name|false
argument_list|,
name|false
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--module-list-functions"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_list_functions
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--module-list-globals"
argument_list|)
condition|)
block|{
return|return
name|llvm_module_list_globals
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--targets-list"
argument_list|)
condition|)
block|{
return|return
name|llvm_targets_list
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--object-list-sections"
argument_list|)
condition|)
block|{
return|return
name|llvm_object_list_sections
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--object-list-symbols"
argument_list|)
condition|)
block|{
return|return
name|llvm_object_list_symbols
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--disassemble"
argument_list|)
condition|)
block|{
return|return
name|llvm_disassemble
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--calc"
argument_list|)
condition|)
block|{
return|return
name|llvm_calc
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--add-named-metadata-operand"
argument_list|)
condition|)
block|{
return|return
name|llvm_add_named_metadata_operand
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--set-metadata"
argument_list|)
condition|)
block|{
return|return
name|llvm_set_metadata
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--echo"
argument_list|)
condition|)
block|{
return|return
name|llvm_echo
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--test-diagnostic-handler"
argument_list|)
condition|)
block|{
return|return
name|llvm_test_diagnostic_handler
argument_list|()
return|;
block|}
else|else
block|{
name|print_usage
argument_list|()
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

end_unit

