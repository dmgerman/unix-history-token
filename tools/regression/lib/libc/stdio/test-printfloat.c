begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002 David Schultz<das@FreeBSD.org>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_comment
comment|/*  * Test for printf() floating point formats.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<float.h>
end_include

begin_include
include|#
directive|include
file|<ieeefp.h>
end_include

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_define
define|#
directive|define
name|testfmt
parameter_list|(
name|result
parameter_list|,
name|fmt
parameter_list|,
modifier|...
parameter_list|)
define|\
value|_testfmt((result), __LINE__, #__VA_ARGS__, fmt, __VA_ARGS__)
end_define

begin_function_decl
name|void
name|_testfmt
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|smash_stack
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|assert
argument_list|(
name|setlocale
argument_list|(
name|LC_NUMERIC
argument_list|,
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 1.000000E+00"
argument_list|,
literal|"%13E"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"     1.000000"
argument_list|,
literal|"%13f"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"            1"
argument_list|,
literal|"%13G"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 1.000000E+00"
argument_list|,
literal|"%13LE"
argument_list|,
literal|1.0L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"     1.000000"
argument_list|,
literal|"%13Lf"
argument_list|,
literal|1.0L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"            1"
argument_list|,
literal|"%13LG"
argument_list|,
literal|1.0L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"2.718282"
argument_list|,
literal|"%.*f"
argument_list|,
operator|-
literal|2
argument_list|,
literal|2.7182818
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.234568e+06"
argument_list|,
literal|"%e"
argument_list|,
literal|1234567.8
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1234567.800000"
argument_list|,
literal|"%f"
argument_list|,
literal|1234567.8
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.23457E+06"
argument_list|,
literal|"%G"
argument_list|,
literal|1234567.8
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.234568e+06"
argument_list|,
literal|"%Le"
argument_list|,
literal|1234567.8L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1234567.800000"
argument_list|,
literal|"%Lf"
argument_list|,
literal|1234567.8L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.23457E+06"
argument_list|,
literal|"%LG"
argument_list|,
literal|1234567.8L
argument_list|)
expr_stmt|;
if|#
directive|if
operator|(
name|LDBL_MANT_DIG
operator|>
name|DBL_MANT_DIG
operator|)
operator|&&
operator|!
name|defined
argument_list|(
name|__i386__
argument_list|)
name|testfmt
argument_list|(
literal|"123456789.864210"
argument_list|,
literal|"%Lf"
argument_list|,
literal|123456789.8642097531L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-1.23457E+08"
argument_list|,
literal|"%LG"
argument_list|,
operator|-
literal|123456789.8642097531L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"123456789.8642097531"
argument_list|,
literal|"%.10Lf"
argument_list|,
literal|123456789.8642097531L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 3.141592653589793238e-4000"
argument_list|,
literal|"%L27.18Le"
argument_list|,
literal|3.14159265358979323846e-4000L
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|testfmt
argument_list|(
literal|"nan"
argument_list|,
literal|"%e"
argument_list|,
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"NAN"
argument_list|,
literal|"%F"
argument_list|,
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"nan"
argument_list|,
literal|"%g"
argument_list|,
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"NAN"
argument_list|,
literal|"%LE"
argument_list|,
operator|(
name|long
name|double
operator|)
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"INF"
argument_list|,
literal|"%E"
argument_list|,
name|HUGE_VAL
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-inf"
argument_list|,
literal|"%f"
argument_list|,
operator|-
name|HUGE_VAL
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"+inf"
argument_list|,
literal|"%+g"
argument_list|,
name|HUGE_VAL
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" inf"
argument_list|,
literal|"%4.2Le"
argument_list|,
name|HUGE_VALL
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-inf"
argument_list|,
literal|"%Lf"
argument_list|,
operator|-
name|HUGE_VALL
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.000000e+00"
argument_list|,
literal|"%e"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.000000"
argument_list|,
literal|"%F"
argument_list|,
operator|(
name|double
operator|)
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0"
argument_list|,
literal|"%G"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"  0"
argument_list|,
literal|"%3.0Lg"
argument_list|,
literal|0.0L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"    0"
argument_list|,
literal|"%5.0f"
argument_list|,
literal|0.001
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.0123e+00"
argument_list|,
literal|"%.4e"
argument_list|,
literal|1.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.0123"
argument_list|,
literal|"%.4f"
argument_list|,
literal|1.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.012"
argument_list|,
literal|"%.4g"
argument_list|,
literal|1.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.2346e-02"
argument_list|,
literal|"%.4e"
argument_list|,
literal|0.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.0123"
argument_list|,
literal|"%.4f"
argument_list|,
literal|0.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.01235"
argument_list|,
literal|"%.4g"
argument_list|,
literal|0.0123456789
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"12345678.0625"
argument_list|,
literal|"%'.04f"
argument_list|,
literal|12345678.0625
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0012345678.0625"
argument_list|,
literal|"%'015.4F"
argument_list|,
literal|12345678.0625
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|setlocale
argument_list|(
name|LC_NUMERIC
argument_list|,
literal|"hi_IN.ISCII-DEV"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* grouping == 2;3 */
name|testfmt
argument_list|(
literal|"123,456,78.0625"
argument_list|,
literal|"%'.4f"
argument_list|,
literal|12345678.0625
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"00123,456,78.0625"
argument_list|,
literal|"%'017.4F"
argument_list|,
literal|12345678.0625
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 90,00"
argument_list|,
literal|"%'6.0f"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"90,00.0"
argument_list|,
literal|"%'.1f"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|setlocale
argument_list|(
name|LC_NUMERIC
argument_list|,
literal|"ru_RU.ISO8859-5"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* decimalpoint==, */
name|testfmt
argument_list|(
literal|"3,1415"
argument_list|,
literal|"%g"
argument_list|,
literal|3.1415
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|setlocale
argument_list|(
name|LC_NUMERIC
argument_list|,
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"12345678.062500"
argument_list|,
literal|"%'f"
argument_list|,
literal|12345678.0625
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"9000.000000"
argument_list|,
literal|"%'f"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"+2.500000e-01"
argument_list|,
literal|"%+e"
argument_list|,
literal|0.25
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"+0.000000"
argument_list|,
literal|"%+F"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-1"
argument_list|,
literal|"%+g"
argument_list|,
operator|-
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-1.000000e+00"
argument_list|,
literal|"% e"
argument_list|,
operator|-
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"+1.000000"
argument_list|,
literal|"% +f"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 1"
argument_list|,
literal|"% g"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0"
argument_list|,
literal|"% g"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1.250e+00"
argument_list|,
literal|"%#.3e"
argument_list|,
literal|1.25
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"123.000000"
argument_list|,
literal|"%#f"
argument_list|,
literal|123.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 12345."
argument_list|,
literal|"%#7.5g"
argument_list|,
literal|12345.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 1.00000"
argument_list|,
literal|"%#8g"
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.0"
argument_list|,
literal|"%#.2g"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"03.2E+00"
argument_list|,
literal|"%08.1E"
argument_list|,
literal|3.25
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"003.25"
argument_list|,
literal|"%06.2F"
argument_list|,
literal|3.25
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0003.25"
argument_list|,
literal|"%07.4G"
argument_list|,
literal|3.25
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"3.14159e-05"
argument_list|,
literal|"%g"
argument_list|,
literal|3.14159e-5
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0.000314159"
argument_list|,
literal|"%g"
argument_list|,
literal|3.14159e-4
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"3.14159e+06"
argument_list|,
literal|"%g"
argument_list|,
literal|3.14159e6
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"314159"
argument_list|,
literal|"%g"
argument_list|,
literal|3.14159e5
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"314159."
argument_list|,
literal|"%#g"
argument_list|,
literal|3.14159e5
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9.000000e+03"
argument_list|,
literal|"%13e"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9000.000000"
argument_list|,
literal|"%12f"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9000"
argument_list|,
literal|"%5g"
argument_list|,
literal|9000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 900000."
argument_list|,
literal|"%#8g"
argument_list|,
literal|900000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9e+06"
argument_list|,
literal|"%6g"
argument_list|,
literal|9000000.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9.000000e-04"
argument_list|,
literal|"%13e"
argument_list|,
literal|0.0009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0.000900"
argument_list|,
literal|"%9f"
argument_list|,
literal|0.0009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0.0009"
argument_list|,
literal|"%7g"
argument_list|,
literal|0.0009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9e-05"
argument_list|,
literal|"%6g"
argument_list|,
literal|0.00009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9.00000e-05"
argument_list|,
literal|"%#12g"
argument_list|,
literal|0.00009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 9.e-05"
argument_list|,
literal|"%#7.1g"
argument_list|,
literal|0.00009
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0.0"
argument_list|,
literal|"%4.1f"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"90.0"
argument_list|,
literal|"%4.1f"
argument_list|,
literal|90.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 100"
argument_list|,
literal|"%4.0f"
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"9.0e+01"
argument_list|,
literal|"%4.1e"
argument_list|,
literal|90.0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"1e+02"
argument_list|,
literal|"%4.0e"
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
comment|/* 	 * Hexadecimal floating point (%a, %A) tests.  Some of these 	 * are only valid if the implementation converts to hex digits 	 * on nibble boundaries. 	 */
name|testfmt
argument_list|(
literal|"0x0p+0"
argument_list|,
literal|"%a"
argument_list|,
literal|0x0
literal|.0p0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0X0.P+0"
argument_list|,
literal|"%#LA"
argument_list|,
literal|0x0
literal|.0p0L
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"inf"
argument_list|,
literal|"%La"
argument_list|,
operator|(
name|long
name|double
operator|)
name|INFINITY
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"+INF"
argument_list|,
literal|"%+A"
argument_list|,
name|INFINITY
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"nan"
argument_list|,
literal|"%La"
argument_list|,
operator|(
name|long
name|double
operator|)
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"NAN"
argument_list|,
literal|"%A"
argument_list|,
name|NAN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0x1.23p+0"
argument_list|,
literal|"%10a"
argument_list|,
literal|0x1
literal|.23p0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0x1.23p-500"
argument_list|,
literal|"%12a"
argument_list|,
literal|0x1
literal|.23p
operator|-
literal|500
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0x1.2p+40"
argument_list|,
literal|"%10.1a"
argument_list|,
literal|0x1
literal|.23p40
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|" 0X1.230000000000000000000000P-4"
argument_list|,
literal|"%32.24A"
argument_list|,
literal|0x1
literal|.23p
operator|-
literal|4
argument_list|)
expr_stmt|;
if|#
directive|if
operator|(
name|LDBL_MANT_DIG
operator|==
literal|64
operator|)
operator|&&
operator|!
name|defined
argument_list|(
name|__i386__
argument_list|)
name|testfmt
argument_list|(
literal|"0xc.90fdaa22168c234p-2"
argument_list|,
literal|"%La"
argument_list|,
literal|0x3
literal|.243f6a8885a308dp0L
argument_list|)
expr_stmt|;
elif|#
directive|elif
operator|(
name|LDBL_MANT_DIG
operator|==
literal|113
operator|)
name|testfmt
argument_list|(
literal|"0x1.921fb54442d18469898cc51701b8p+1"
argument_list|,
literal|"%La"
argument_list|,
literal|0x3
literal|.243f6a8885a308d313198a2e037p0L
argument_list|)
expr_stmt|;
else|#
directive|else
name|testfmt
argument_list|(
literal|"0xc.90fdaa22168cp-2"
argument_list|,
literal|"%La"
argument_list|,
literal|0x3
literal|.243f6a8885a31p0L
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|fpsetround
argument_list|(
name|FP_RN
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0x1.23456789abcdep+4"
argument_list|,
literal|"%a"
argument_list|,
literal|0x1
literal|.23456789abcdep4
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0X1.23456789ABDP+0"
argument_list|,
literal|"%.11A"
argument_list|,
literal|0x1
literal|.23456789abcdep0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-0x1.23456p+0"
argument_list|,
literal|"%.5a"
argument_list|,
operator|-
literal|0x1
literal|.23456789abcdep0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0x1.234568p+0"
argument_list|,
literal|"%.6a"
argument_list|,
literal|0x1
literal|.23456789abcdep0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"-0x1.234566p+0"
argument_list|,
literal|"%.6a"
argument_list|,
operator|-
literal|0x1
literal|.23456689abcdep0
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0x2.00p-1030"
argument_list|,
literal|"%.2a"
argument_list|,
literal|0x1
operator|.
name|fffp
operator|-
literal|1030
argument_list|)
expr_stmt|;
name|testfmt
argument_list|(
literal|"0x1.00p-1026"
argument_list|,
literal|"%.2a"
argument_list|,
literal|0xf
operator|.
name|fffp
operator|-
literal|1030
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PASS printfloat\n"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|smash_stack
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|uint32_t
name|junk
init|=
literal|0xdeadbeef
decl_stmt|;
name|uint32_t
name|buf
index|[
literal|512
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|buf
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
name|buf
index|[
name|i
index|]
operator|=
name|junk
expr_stmt|;
block|}
end_function

begin_function
name|void
name|_testfmt
parameter_list|(
specifier|const
name|char
modifier|*
name|result
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|argstr
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|char
name|s
index|[
literal|100
index|]
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
name|smash_stack
argument_list|()
expr_stmt|;
name|vsnprintf
argument_list|(
name|s
argument_list|,
sizeof|sizeof
argument_list|(
name|s
argument_list|)
argument_list|,
name|fmt
argument_list|,
name|ap
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|result
argument_list|,
name|s
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%d: printf(\"%s\", %s) ==> [%s], expected [%s]\n"
argument_list|,
name|line
argument_list|,
name|fmt
argument_list|,
name|argstr
argument_list|,
name|s
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

end_unit

