begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2013 The FreeBSD Foundation  * All rights reserved.  *  * This software was developed by Pawel Jakub Dawidek under sponsorship from  * the FreeBSD Foundation.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHORS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/capsicum.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<libcapsicum.h>
end_include

begin_include
include|#
directive|include
file|<libcapsicum_pwd.h>
end_include

begin_include
include|#
directive|include
file|<libcapsicum_service.h>
end_include

begin_decl_stmt
specifier|static
name|int
name|ntest
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|CHECK
parameter_list|(
name|expr
parameter_list|)
value|do {						\ 	if ((expr))							\ 		printf("ok %d %s:%u\n", ntest, __FILE__, __LINE__);	\ 	else								\ 		printf("not ok %d %s:%u\n", ntest, __FILE__, __LINE__);\ 	ntest++;							\ } while (0)
end_define

begin_define
define|#
directive|define
name|CHECKX
parameter_list|(
name|expr
parameter_list|)
value|do {						\ 	if ((expr)) {							\ 		printf("ok %d %s:%u\n", ntest, __FILE__, __LINE__);	\ 	} else {							\ 		printf("not ok %d %s:%u\n", ntest, __FILE__, __LINE__);\ 		exit(1);						\ 	}								\ 	ntest++;							\ } while (0)
end_define

begin_define
define|#
directive|define
name|UID_ROOT
value|0
end_define

begin_define
define|#
directive|define
name|UID_OPERATOR
value|2
end_define

begin_define
define|#
directive|define
name|GETPWENT0
value|0x0001
end_define

begin_define
define|#
directive|define
name|GETPWENT1
value|0x0002
end_define

begin_define
define|#
directive|define
name|GETPWENT2
value|0x0004
end_define

begin_define
define|#
directive|define
name|GETPWENT
value|(GETPWENT0 | GETPWENT1 | GETPWENT2)
end_define

begin_define
define|#
directive|define
name|GETPWENT_R0
value|0x0008
end_define

begin_define
define|#
directive|define
name|GETPWENT_R1
value|0x0010
end_define

begin_define
define|#
directive|define
name|GETPWENT_R2
value|0x0020
end_define

begin_define
define|#
directive|define
name|GETPWENT_R
value|(GETPWENT_R0 | GETPWENT_R1 | GETPWENT_R2)
end_define

begin_define
define|#
directive|define
name|GETPWNAM
value|0x0040
end_define

begin_define
define|#
directive|define
name|GETPWNAM_R
value|0x0080
end_define

begin_define
define|#
directive|define
name|GETPWUID
value|0x0100
end_define

begin_define
define|#
directive|define
name|GETPWUID_R
value|0x0200
end_define

begin_function
specifier|static
name|bool
name|passwd_compare
parameter_list|(
specifier|const
name|struct
name|passwd
modifier|*
name|pwd0
parameter_list|,
specifier|const
name|struct
name|passwd
modifier|*
name|pwd1
parameter_list|)
block|{
if|if
condition|(
name|pwd0
operator|==
name|NULL
operator|&&
name|pwd1
operator|==
name|NULL
condition|)
return|return
operator|(
name|true
operator|)
return|;
if|if
condition|(
name|pwd0
operator|==
name|NULL
operator|||
name|pwd1
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_name
argument_list|,
name|pwd1
operator|->
name|pw_name
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|pwd0
operator|->
name|pw_passwd
operator|!=
name|NULL
operator|||
name|pwd1
operator|->
name|pw_passwd
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|pwd0
operator|->
name|pw_passwd
operator|==
name|NULL
operator|||
name|pwd1
operator|->
name|pw_passwd
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_passwd
argument_list|,
name|pwd1
operator|->
name|pw_passwd
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|pwd0
operator|->
name|pw_uid
operator|!=
name|pwd1
operator|->
name|pw_uid
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|pwd0
operator|->
name|pw_gid
operator|!=
name|pwd1
operator|->
name|pw_gid
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|pwd0
operator|->
name|pw_change
operator|!=
name|pwd1
operator|->
name|pw_change
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|pwd0
operator|->
name|pw_class
operator|!=
name|NULL
operator|||
name|pwd1
operator|->
name|pw_class
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|pwd0
operator|->
name|pw_class
operator|==
name|NULL
operator|||
name|pwd1
operator|->
name|pw_class
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_class
argument_list|,
name|pwd1
operator|->
name|pw_class
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|pwd0
operator|->
name|pw_gecos
operator|!=
name|NULL
operator|||
name|pwd1
operator|->
name|pw_gecos
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|pwd0
operator|->
name|pw_gecos
operator|==
name|NULL
operator|||
name|pwd1
operator|->
name|pw_gecos
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_gecos
argument_list|,
name|pwd1
operator|->
name|pw_gecos
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|pwd0
operator|->
name|pw_dir
operator|!=
name|NULL
operator|||
name|pwd1
operator|->
name|pw_dir
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|pwd0
operator|->
name|pw_dir
operator|==
name|NULL
operator|||
name|pwd1
operator|->
name|pw_dir
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_dir
argument_list|,
name|pwd1
operator|->
name|pw_dir
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|pwd0
operator|->
name|pw_shell
operator|!=
name|NULL
operator|||
name|pwd1
operator|->
name|pw_shell
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|pwd0
operator|->
name|pw_shell
operator|==
name|NULL
operator|||
name|pwd1
operator|->
name|pw_shell
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|pwd0
operator|->
name|pw_shell
argument_list|,
name|pwd1
operator|->
name|pw_shell
argument_list|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|pwd0
operator|->
name|pw_expire
operator|!=
name|pwd1
operator|->
name|pw_expire
condition|)
return|return
operator|(
name|false
operator|)
return|;
if|if
condition|(
name|pwd0
operator|->
name|pw_fields
operator|!=
name|pwd1
operator|->
name|pw_fields
condition|)
return|return
operator|(
name|false
operator|)
return|;
return|return
operator|(
name|true
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|unsigned
name|int
name|runtest_cmds
parameter_list|(
name|cap_channel_t
modifier|*
name|cappwd
parameter_list|)
block|{
name|char
name|bufs
index|[
literal|1024
index|]
decl_stmt|,
name|bufc
index|[
literal|1024
index|]
decl_stmt|;
name|unsigned
name|int
name|result
decl_stmt|;
name|struct
name|passwd
modifier|*
name|pwds
decl_stmt|,
modifier|*
name|pwdc
decl_stmt|;
name|struct
name|passwd
name|sts
decl_stmt|,
name|stc
decl_stmt|;
name|result
operator|=
literal|0
expr_stmt|;
name|setpwent
argument_list|()
expr_stmt|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|pwds
operator|=
name|getpwent
argument_list|()
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|result
operator||=
name|GETPWENT0
expr_stmt|;
name|pwds
operator|=
name|getpwent
argument_list|()
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWENT1
expr_stmt|;
block|}
name|getpwent_r
argument_list|(
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwent_r
argument_list|(
name|cappwd
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|result
operator||=
name|GETPWENT_R0
expr_stmt|;
name|getpwent_r
argument_list|(
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwent_r
argument_list|(
name|cappwd
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWENT_R1
expr_stmt|;
block|}
name|setpwent
argument_list|()
expr_stmt|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|getpwent_r
argument_list|(
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwent_r
argument_list|(
name|cappwd
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWENT_R2
expr_stmt|;
name|pwds
operator|=
name|getpwent
argument_list|()
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWENT2
expr_stmt|;
name|pwds
operator|=
name|getpwnam
argument_list|(
literal|"root"
argument_list|)
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwnam
argument_list|(
name|cappwd
argument_list|,
literal|"root"
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|pwds
operator|=
name|getpwnam
argument_list|(
literal|"operator"
argument_list|)
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwnam
argument_list|(
name|cappwd
argument_list|,
literal|"operator"
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWNAM
expr_stmt|;
block|}
name|getpwnam_r
argument_list|(
literal|"root"
argument_list|,
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwnam_r
argument_list|(
name|cappwd
argument_list|,
literal|"root"
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|getpwnam_r
argument_list|(
literal|"operator"
argument_list|,
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwnam_r
argument_list|(
name|cappwd
argument_list|,
literal|"operator"
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWNAM_R
expr_stmt|;
block|}
name|pwds
operator|=
name|getpwuid
argument_list|(
name|UID_ROOT
argument_list|)
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwuid
argument_list|(
name|cappwd
argument_list|,
name|UID_ROOT
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|pwds
operator|=
name|getpwuid
argument_list|(
name|UID_OPERATOR
argument_list|)
expr_stmt|;
name|pwdc
operator|=
name|cap_getpwuid
argument_list|(
name|cappwd
argument_list|,
name|UID_OPERATOR
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWUID
expr_stmt|;
block|}
name|getpwuid_r
argument_list|(
name|UID_ROOT
argument_list|,
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwuid_r
argument_list|(
name|cappwd
argument_list|,
name|UID_ROOT
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
block|{
name|getpwuid_r
argument_list|(
name|UID_OPERATOR
argument_list|,
operator|&
name|sts
argument_list|,
name|bufs
argument_list|,
sizeof|sizeof
argument_list|(
name|bufs
argument_list|)
argument_list|,
operator|&
name|pwds
argument_list|)
expr_stmt|;
name|cap_getpwuid_r
argument_list|(
name|cappwd
argument_list|,
name|UID_OPERATOR
argument_list|,
operator|&
name|stc
argument_list|,
name|bufc
argument_list|,
sizeof|sizeof
argument_list|(
name|bufc
argument_list|)
argument_list|,
operator|&
name|pwdc
argument_list|)
expr_stmt|;
if|if
condition|(
name|passwd_compare
argument_list|(
name|pwds
argument_list|,
name|pwdc
argument_list|)
condition|)
name|result
operator||=
name|GETPWUID_R
expr_stmt|;
block|}
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_cmds
parameter_list|(
name|cap_channel_t
modifier|*
name|origcappwd
parameter_list|)
block|{
name|cap_channel_t
modifier|*
name|cappwd
decl_stmt|;
specifier|const
name|char
modifier|*
name|cmds
index|[
literal|7
index|]
decl_stmt|,
modifier|*
name|fields
index|[
literal|10
index|]
decl_stmt|,
modifier|*
name|names
index|[
literal|6
index|]
decl_stmt|;
name|uid_t
name|uids
index|[
literal|5
index|]
decl_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_name"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_passwd"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_gid"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|fields
index|[
literal|6
index|]
operator|=
literal|"pw_gecos"
expr_stmt|;
name|fields
index|[
literal|7
index|]
operator|=
literal|"pw_dir"
expr_stmt|;
name|fields
index|[
literal|8
index|]
operator|=
literal|"pw_shell"
expr_stmt|;
name|fields
index|[
literal|9
index|]
operator|=
literal|"pw_expire"
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"root"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"toor"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|3
index|]
operator|=
literal|"operator"
expr_stmt|;
name|names
index|[
literal|4
index|]
operator|=
literal|"bin"
expr_stmt|;
name|names
index|[
literal|5
index|]
operator|=
literal|"kmem"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|2
expr_stmt|;
name|uids
index|[
literal|3
index|]
operator|=
literal|3
expr_stmt|;
name|uids
index|[
literal|4
index|]
operator|=
literal|5
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: setpwent 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT0
operator||
name|GETPWENT1
operator||
name|GETPWENT_R0
operator||
name|GETPWENT_R1
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: setpwent 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT0
operator||
name|GETPWENT1
operator||
name|GETPWENT_R0
operator||
name|GETPWENT_R1
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwent 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT_R2
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwent 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT_R2
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwent_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT0
operator||
name|GETPWENT1
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwnam, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwent_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT0
operator||
name|GETPWENT1
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwnam 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam_r, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwnam 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwnam_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, 	 *       getpwuid, getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwnam_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid_r 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwuid 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid_r 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwuid 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid 	 * users: 	 *     names: root, toor, daemon, operator, bin, kmem 	 *     uids: 	 * Disallow: 	 * cmds: getpwuid_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * cmds: setpwent, getpwent, getpwent_r, getpwnam, getpwnam_r, 	 *       getpwuid 	 * users: 	 *     names: 	 *     uids: 0, 1, 2, 3, 5 	 * Disallow: 	 * cmds: getpwuid_r 	 * users: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|6
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"setpwent"
expr_stmt|;
name|cmds
index|[
literal|1
index|]
operator|=
literal|"getpwent"
expr_stmt|;
name|cmds
index|[
literal|2
index|]
operator|=
literal|"getpwent_r"
expr_stmt|;
name|cmds
index|[
literal|3
index|]
operator|=
literal|"getpwnam"
expr_stmt|;
name|cmds
index|[
literal|4
index|]
operator|=
literal|"getpwnam_r"
expr_stmt|;
name|cmds
index|[
literal|5
index|]
operator|=
literal|"getpwuid"
expr_stmt|;
name|cmds
index|[
literal|6
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|7
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|cmds
index|[
literal|0
index|]
operator|=
literal|"getpwuid_r"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_cmds
argument_list|(
name|cappwd
argument_list|,
name|cmds
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|PW_NAME
value|_PWF_NAME
end_define

begin_define
define|#
directive|define
name|PW_PASSWD
value|_PWF_PASSWD
end_define

begin_define
define|#
directive|define
name|PW_UID
value|_PWF_UID
end_define

begin_define
define|#
directive|define
name|PW_GID
value|_PWF_GID
end_define

begin_define
define|#
directive|define
name|PW_CHANGE
value|_PWF_CHANGE
end_define

begin_define
define|#
directive|define
name|PW_CLASS
value|_PWF_CLASS
end_define

begin_define
define|#
directive|define
name|PW_GECOS
value|_PWF_GECOS
end_define

begin_define
define|#
directive|define
name|PW_DIR
value|_PWF_DIR
end_define

begin_define
define|#
directive|define
name|PW_SHELL
value|_PWF_SHELL
end_define

begin_define
define|#
directive|define
name|PW_EXPIRE
value|_PWF_EXPIRE
end_define

begin_function
specifier|static
name|unsigned
name|int
name|passwd_fields
parameter_list|(
specifier|const
name|struct
name|passwd
modifier|*
name|pwd
parameter_list|)
block|{
name|unsigned
name|int
name|result
decl_stmt|;
name|result
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pwd
operator|->
name|pw_name
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_name
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_NAME
expr_stmt|;
comment|//	else
comment|//		printf("No pw_name\n");
if|if
condition|(
name|pwd
operator|->
name|pw_passwd
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_passwd
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_PASSWD
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_PASSWD
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_PASSWD
expr_stmt|;
comment|//	else
comment|//		printf("No pw_passwd\n");
if|if
condition|(
name|pwd
operator|->
name|pw_uid
operator|!=
operator|(
name|uid_t
operator|)
operator|-
literal|1
condition|)
name|result
operator||=
name|PW_UID
expr_stmt|;
comment|//	else
comment|//		printf("No pw_uid\n");
if|if
condition|(
name|pwd
operator|->
name|pw_gid
operator|!=
operator|(
name|gid_t
operator|)
operator|-
literal|1
condition|)
name|result
operator||=
name|PW_GID
expr_stmt|;
comment|//	else
comment|//		printf("No pw_gid\n");
if|if
condition|(
name|pwd
operator|->
name|pw_change
operator|!=
literal|0
operator|||
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_CHANGE
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_CHANGE
expr_stmt|;
comment|//	else
comment|//		printf("No pw_change\n");
if|if
condition|(
name|pwd
operator|->
name|pw_class
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_class
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_CLASS
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_CLASS
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_CLASS
expr_stmt|;
comment|//	else
comment|//		printf("No pw_class\n");
if|if
condition|(
name|pwd
operator|->
name|pw_gecos
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_gecos
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_GECOS
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_GECOS
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_GECOS
expr_stmt|;
comment|//	else
comment|//		printf("No pw_gecos\n");
if|if
condition|(
name|pwd
operator|->
name|pw_dir
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_dir
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_DIR
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_DIR
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_DIR
expr_stmt|;
comment|//	else
comment|//		printf("No pw_dir\n");
if|if
condition|(
name|pwd
operator|->
name|pw_shell
operator|!=
name|NULL
operator|&&
name|pwd
operator|->
name|pw_shell
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|result
operator||=
name|PW_SHELL
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_SHELL
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_SHELL
expr_stmt|;
comment|//	else
comment|//		printf("No pw_shell\n");
if|if
condition|(
name|pwd
operator|->
name|pw_expire
operator|!=
literal|0
operator|||
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|_PWF_EXPIRE
operator|)
operator|!=
literal|0
condition|)
name|result
operator||=
name|PW_EXPIRE
expr_stmt|;
comment|//	else
comment|//		printf("No pw_expire\n");
if|if
condition|(
name|false
operator|&&
name|pwd
operator|->
name|pw_fields
operator|!=
operator|(
name|int
operator|)
name|result
condition|)
block|{
name|printf
argument_list|(
literal|"fields=0x%x != result=0x%x\n"
argument_list|,
operator|(
specifier|const
name|unsigned
name|int
operator|)
name|pwd
operator|->
name|pw_fields
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"           fields result\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_NAME    %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_NAME
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_NAME
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_PASSWD  %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_PASSWD
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_PASSWD
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_UID     %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_UID
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_UID
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_GID     %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_GID
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_GID
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_CHANGE  %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_CHANGE
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_CHANGE
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_CLASS   %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_CLASS
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_CLASS
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_GECOS   %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_GECOS
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_GECOS
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_DIR     %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_DIR
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_DIR
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_SHELL   %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_SHELL
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_SHELL
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"PW_EXPIRE  %d      %d\n"
argument_list|,
operator|(
name|pwd
operator|->
name|pw_fields
operator|&
name|PW_EXPIRE
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|result
operator|&
name|PW_EXPIRE
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
block|}
comment|//printf("result=0x%x\n", result);
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|bool
name|runtest_fields
parameter_list|(
name|cap_channel_t
modifier|*
name|cappwd
parameter_list|,
name|unsigned
name|int
name|expected
parameter_list|)
block|{
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|struct
name|passwd
modifier|*
name|pwd
decl_stmt|;
name|struct
name|passwd
name|st
decl_stmt|;
comment|//printf("expected=0x%x\n", expected);
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|pwd
operator|=
name|cap_getpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|cap_getpwent_r
argument_list|(
name|cappwd
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|pwd
operator|=
name|cap_getpwnam
argument_list|(
name|cappwd
argument_list|,
literal|"root"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|cap_getpwnam_r
argument_list|(
name|cappwd
argument_list|,
literal|"root"
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|pwd
operator|=
name|cap_getpwuid
argument_list|(
name|cappwd
argument_list|,
name|UID_ROOT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|cap_getpwuid_r
argument_list|(
name|cappwd
argument_list|,
name|UID_ROOT
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|passwd_fields
argument_list|(
name|pwd
argument_list|)
operator|&
operator|~
name|expected
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|false
operator|)
return|;
return|return
operator|(
name|true
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_fields
parameter_list|(
name|cap_channel_t
modifier|*
name|origcappwd
parameter_list|)
block|{
name|cap_channel_t
modifier|*
name|cappwd
decl_stmt|;
specifier|const
name|char
modifier|*
name|fields
index|[
literal|10
index|]
decl_stmt|;
comment|/* No limits. */
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|origcappwd
argument_list|,
name|PW_NAME
operator||
name|PW_PASSWD
operator||
name|PW_UID
operator||
name|PW_GID
operator||
name|PW_CHANGE
operator||
name|PW_CLASS
operator||
name|PW_GECOS
operator||
name|PW_DIR
operator||
name|PW_SHELL
operator||
name|PW_EXPIRE
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_name, pw_passwd, pw_uid, pw_gid, pw_change, pw_class, 	 *         pw_gecos, pw_dir, pw_shell, pw_expire 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_name"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_passwd"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_gid"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|fields
index|[
literal|6
index|]
operator|=
literal|"pw_gecos"
expr_stmt|;
name|fields
index|[
literal|7
index|]
operator|=
literal|"pw_dir"
expr_stmt|;
name|fields
index|[
literal|8
index|]
operator|=
literal|"pw_shell"
expr_stmt|;
name|fields
index|[
literal|9
index|]
operator|=
literal|"pw_expire"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|10
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|origcappwd
argument_list|,
name|PW_NAME
operator||
name|PW_PASSWD
operator||
name|PW_UID
operator||
name|PW_GID
operator||
name|PW_CHANGE
operator||
name|PW_CLASS
operator||
name|PW_GECOS
operator||
name|PW_DIR
operator||
name|PW_SHELL
operator||
name|PW_EXPIRE
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_name, pw_passwd, pw_uid, pw_gid, pw_change 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_name"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_passwd"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_gid"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|6
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_NAME
operator||
name|PW_PASSWD
operator||
name|PW_UID
operator||
name|PW_GID
operator||
name|PW_CHANGE
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_class, pw_gecos, pw_dir, pw_shell, pw_expire 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_gecos"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_dir"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_shell"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_expire"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|6
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_CLASS
operator||
name|PW_GECOS
operator||
name|PW_DIR
operator||
name|PW_SHELL
operator||
name|PW_EXPIRE
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_name, pw_uid, pw_change, pw_gecos, pw_shell 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_name"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_gecos"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_shell"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|6
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_NAME
operator||
name|PW_UID
operator||
name|PW_CHANGE
operator||
name|PW_GECOS
operator||
name|PW_SHELL
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_passwd, pw_gid, pw_class, pw_dir, pw_expire 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_passwd"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_gid"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_dir"
expr_stmt|;
name|fields
index|[
literal|4
index|]
operator|=
literal|"pw_expire"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|5
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|6
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_PASSWD
operator||
name|PW_GID
operator||
name|PW_CLASS
operator||
name|PW_DIR
operator||
name|PW_EXPIRE
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_uid, pw_class, pw_shell 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_class"
expr_stmt|;
name|fields
index|[
literal|2
index|]
operator|=
literal|"pw_shell"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|3
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|4
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_UID
operator||
name|PW_CLASS
operator||
name|PW_SHELL
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * fields: pw_change 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_change"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|fields
index|[
literal|1
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|2
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|fields
index|[
literal|0
index|]
operator|=
literal|"pw_uid"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_fields
argument_list|(
name|cappwd
argument_list|,
name|fields
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_fields
argument_list|(
name|cappwd
argument_list|,
name|PW_CHANGE
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bool
name|runtest_users
parameter_list|(
name|cap_channel_t
modifier|*
name|cappwd
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|names
parameter_list|,
specifier|const
name|uid_t
modifier|*
name|uids
parameter_list|,
name|size_t
name|nusers
parameter_list|)
block|{
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|struct
name|passwd
modifier|*
name|pwd
decl_stmt|;
name|struct
name|passwd
name|st
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|,
name|got
decl_stmt|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|got
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|pwd
operator|=
name|cap_getpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
break|break;
name|got
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|names
index|[
name|i
index|]
argument_list|,
name|pwd
operator|->
name|pw_name
argument_list|)
operator|==
literal|0
operator|&&
name|uids
index|[
name|i
index|]
operator|==
name|pwd
operator|->
name|pw_uid
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
name|nusers
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|got
operator|!=
name|nusers
condition|)
return|return
operator|(
name|false
operator|)
return|;
name|cap_setpwent
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|got
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|cap_getpwent_r
argument_list|(
name|cappwd
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
break|break;
name|got
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|names
index|[
name|i
index|]
argument_list|,
name|pwd
operator|->
name|pw_name
argument_list|)
operator|==
literal|0
operator|&&
name|uids
index|[
name|i
index|]
operator|==
name|pwd
operator|->
name|pw_uid
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
name|nusers
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
if|if
condition|(
name|got
operator|!=
name|nusers
condition|)
return|return
operator|(
name|false
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
name|pwd
operator|=
name|cap_getpwnam
argument_list|(
name|cappwd
argument_list|,
name|names
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
name|cap_getpwnam_r
argument_list|(
name|cappwd
argument_list|,
name|names
index|[
name|i
index|]
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
name|pwd
operator|=
name|cap_getpwuid
argument_list|(
name|cappwd
argument_list|,
name|uids
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nusers
condition|;
name|i
operator|++
control|)
block|{
name|cap_getpwuid_r
argument_list|(
name|cappwd
argument_list|,
name|uids
index|[
name|i
index|]
argument_list|,
operator|&
name|st
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
operator|&
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
name|NULL
condition|)
return|return
operator|(
name|false
operator|)
return|;
block|}
return|return
operator|(
name|true
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|test_users
parameter_list|(
name|cap_channel_t
modifier|*
name|origcappwd
parameter_list|)
block|{
name|cap_channel_t
modifier|*
name|cappwd
decl_stmt|;
specifier|const
name|char
modifier|*
name|names
index|[
literal|6
index|]
decl_stmt|;
name|uid_t
name|uids
index|[
literal|6
index|]
decl_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: root, toor, daemon, operator, bin, tty 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"root"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"toor"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|3
index|]
operator|=
literal|"operator"
expr_stmt|;
name|names
index|[
literal|4
index|]
operator|=
literal|"bin"
expr_stmt|;
name|names
index|[
literal|5
index|]
operator|=
literal|"tty"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|6
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|3
index|]
operator|=
literal|2
expr_stmt|;
name|uids
index|[
literal|4
index|]
operator|=
literal|3
expr_stmt|;
name|uids
index|[
literal|5
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: daemon, operator, bin 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"operator"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"bin"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|names
index|[
literal|3
index|]
operator|=
literal|"tty"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|4
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"tty"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: daemon, bin, tty 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"bin"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"tty"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|names
index|[
literal|3
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|4
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|3
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: 	 *     uids: 1, 2, 3 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"operator"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"bin"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|uids
index|[
literal|3
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|4
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: 	 *     uids: 1, 3, 4 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"bin"
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"tty"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|3
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|uids
index|[
literal|3
index|]
operator|=
literal|5
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|4
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|5
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: bin 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"bin"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|2
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"bin"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: daemon, tty 	 *     uids: 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"tty"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|2
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|names
index|[
literal|2
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"operator"
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: 	 *     uids: 3 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"bin"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|2
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
comment|/* 	 * Allow: 	 * users: 	 *     names: 	 *     uids: 1, 4 	 */
name|cappwd
operator|=
name|cap_clone
argument_list|(
name|origcappwd
argument_list|)
expr_stmt|;
name|CHECK
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|names
index|[
literal|0
index|]
operator|=
literal|"daemon"
expr_stmt|;
name|names
index|[
literal|1
index|]
operator|=
literal|"tty"
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|uids
index|[
literal|1
index|]
operator|=
literal|4
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|uids
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|3
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|3
expr_stmt|;
name|CHECK
argument_list|(
name|cap_pwd_limit_users
argument_list|(
name|cappwd
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|uids
argument_list|,
literal|1
argument_list|)
operator|==
operator|-
literal|1
operator|&&
name|errno
operator|==
name|ENOTCAPABLE
argument_list|)
expr_stmt|;
name|uids
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|CHECK
argument_list|(
name|runtest_users
argument_list|(
name|cappwd
argument_list|,
name|names
argument_list|,
name|uids
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|void
parameter_list|)
block|{
name|cap_channel_t
modifier|*
name|capcas
decl_stmt|,
modifier|*
name|cappwd
decl_stmt|;
name|printf
argument_list|(
literal|"1..188\n"
argument_list|)
expr_stmt|;
name|capcas
operator|=
name|cap_init
argument_list|()
expr_stmt|;
name|CHECKX
argument_list|(
name|capcas
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cappwd
operator|=
name|cap_service_open
argument_list|(
name|capcas
argument_list|,
literal|"system.pwd"
argument_list|)
expr_stmt|;
name|CHECKX
argument_list|(
name|cappwd
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|capcas
argument_list|)
expr_stmt|;
comment|/* No limits. */
name|CHECK
argument_list|(
name|runtest_cmds
argument_list|(
name|cappwd
argument_list|)
operator|==
operator|(
name|GETPWENT
operator||
name|GETPWENT_R
operator||
name|GETPWNAM
operator||
name|GETPWNAM_R
operator||
name|GETPWUID
operator||
name|GETPWUID_R
operator|)
argument_list|)
expr_stmt|;
name|test_cmds
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|test_fields
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|test_users
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|cap_close
argument_list|(
name|cappwd
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

