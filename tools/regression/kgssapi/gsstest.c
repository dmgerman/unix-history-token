begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2008 Isilon Inc http://www.isilon.com/  * Authors: Doug Rabson<dfr@rabson.org>  * Developed with Red Inc: Alfred Perlstein<alfred@freebsd.org>  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/syscall.h>
end_include

begin_include
include|#
directive|include
file|<sys/module.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<krb5.h>
end_include

begin_include
include|#
directive|include
file|<gssapi/gssapi.h>
end_include

begin_include
include|#
directive|include
file|<gssapi/gssapi_krb5.h>
end_include

begin_struct
struct|struct
name|gsstest_2_args
block|{
name|int
name|step
decl_stmt|;
comment|/* test step number */
name|gss_buffer_desc
name|input_token
decl_stmt|;
comment|/* token from userland */
name|gss_buffer_desc
name|output_token
decl_stmt|;
comment|/* buffer to receive reply token */
block|}
struct|;
end_struct

begin_struct
struct|struct
name|gsstest_2_res
block|{
name|OM_uint32
name|maj_stat
decl_stmt|;
comment|/* maj_stat from kernel */
name|OM_uint32
name|min_stat
decl_stmt|;
comment|/* min_stat from kernel */
name|gss_buffer_desc
name|output_token
decl_stmt|;
comment|/* reply token (using space from gsstest_2_args.output) */
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|report_error
parameter_list|(
name|gss_OID
name|mech
parameter_list|,
name|OM_uint32
name|maj
parameter_list|,
name|OM_uint32
name|min
parameter_list|)
block|{
name|OM_uint32
name|maj_stat
decl_stmt|,
name|min_stat
decl_stmt|;
name|OM_uint32
name|message_context
decl_stmt|;
name|gss_buffer_desc
name|buf
decl_stmt|;
name|printf
argument_list|(
literal|"major_stat=%d, minor_stat=%d\n"
argument_list|,
name|maj
argument_list|,
name|min
argument_list|)
expr_stmt|;
name|message_context
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|maj_stat
operator|=
name|gss_display_status
argument_list|(
operator|&
name|min_stat
argument_list|,
name|maj
argument_list|,
name|GSS_C_GSS_CODE
argument_list|,
name|GSS_C_NO_OID
argument_list|,
operator|&
name|message_context
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%.*s\n"
argument_list|,
operator|(
name|int
operator|)
name|buf
operator|.
name|length
argument_list|,
operator|(
name|char
operator|*
operator|)
name|buf
operator|.
name|value
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|message_context
condition|)
do|;
if|if
condition|(
name|mech
condition|)
block|{
name|message_context
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|maj_stat
operator|=
name|gss_display_status
argument_list|(
operator|&
name|min_stat
argument_list|,
name|min
argument_list|,
name|GSS_C_MECH_CODE
argument_list|,
name|mech
argument_list|,
operator|&
name|message_context
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%.*s\n"
argument_list|,
operator|(
name|int
operator|)
name|buf
operator|.
name|length
argument_list|,
operator|(
name|char
operator|*
operator|)
name|buf
operator|.
name|value
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|message_context
condition|)
do|;
block|}
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|struct
name|module_stat
name|stat
decl_stmt|;
name|int
name|mod
decl_stmt|;
name|int
name|syscall_num
decl_stmt|;
name|stat
operator|.
name|version
operator|=
sizeof|sizeof
argument_list|(
name|stat
argument_list|)
expr_stmt|;
name|mod
operator|=
name|modfind
argument_list|(
literal|"gsstest_syscall"
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: kernel support not present\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|modstat
argument_list|(
name|mod
argument_list|,
operator|&
name|stat
argument_list|)
expr_stmt|;
name|syscall_num
operator|=
name|stat
operator|.
name|data
operator|.
name|intval
expr_stmt|;
switch|switch
condition|(
name|atoi
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|)
condition|)
block|{
case|case
literal|1
case|:
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
block|{
name|struct
name|gsstest_2_args
name|args
decl_stmt|;
name|struct
name|gsstest_2_res
name|res
decl_stmt|;
name|char
name|hostname
index|[
literal|512
index|]
decl_stmt|;
name|char
name|token_buffer
index|[
literal|8192
index|]
decl_stmt|;
name|OM_uint32
name|maj_stat
decl_stmt|,
name|min_stat
decl_stmt|;
name|gss_ctx_id_t
name|client_context
init|=
name|GSS_C_NO_CONTEXT
decl_stmt|;
name|gss_cred_id_t
name|client_cred
decl_stmt|;
name|gss_OID
name|mech_type
init|=
name|GSS_C_NO_OID
decl_stmt|;
name|gss_buffer_desc
name|name_buf
decl_stmt|,
name|message_buf
decl_stmt|;
name|gss_name_t
name|name
decl_stmt|;
name|int32_t
name|enctypes
index|[]
init|=
block|{
name|ETYPE_DES_CBC_CRC
block|,
name|ETYPE_ARCFOUR_HMAC_MD5
block|,
name|ETYPE_ARCFOUR_HMAC_MD5_56
block|,
name|ETYPE_AES256_CTS_HMAC_SHA1_96
block|,
name|ETYPE_AES128_CTS_HMAC_SHA1_96
block|,
name|ETYPE_DES3_CBC_SHA1
block|, 		}
decl_stmt|;
name|int
name|num_enctypes
init|=
sizeof|sizeof
argument_list|(
name|enctypes
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|enctypes
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
name|int
name|established
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_enctypes
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"testing etype %d\n"
argument_list|,
name|enctypes
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|args
operator|.
name|output_token
operator|.
name|length
operator|=
sizeof|sizeof
argument_list|(
name|token_buffer
argument_list|)
expr_stmt|;
name|args
operator|.
name|output_token
operator|.
name|value
operator|=
name|token_buffer
expr_stmt|;
name|gethostname
argument_list|(
name|hostname
argument_list|,
sizeof|sizeof
argument_list|(
name|hostname
argument_list|)
argument_list|)
expr_stmt|;
name|snprintf
argument_list|(
name|token_buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|token_buffer
argument_list|)
argument_list|,
literal|"nfs@%s"
argument_list|,
name|hostname
argument_list|)
expr_stmt|;
name|name_buf
operator|.
name|length
operator|=
name|strlen
argument_list|(
name|token_buffer
argument_list|)
expr_stmt|;
name|name_buf
operator|.
name|value
operator|=
name|token_buffer
expr_stmt|;
name|maj_stat
operator|=
name|gss_import_name
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|name_buf
argument_list|,
name|GSS_C_NT_HOSTBASED_SERVICE
argument_list|,
operator|&
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_import_name failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_acquire_cred
argument_list|(
operator|&
name|min_stat
argument_list|,
name|GSS_C_NO_NAME
argument_list|,
literal|0
argument_list|,
name|GSS_C_NO_OID_SET
argument_list|,
name|GSS_C_INITIATE
argument_list|,
operator|&
name|client_cred
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_acquire_cred (client) failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_krb5_set_allowable_enctypes
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_cred
argument_list|,
literal|1
argument_list|,
operator|&
name|enctypes
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_krb5_set_allowable_enctypes failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|res
operator|.
name|output_token
operator|.
name|length
operator|=
literal|0
expr_stmt|;
name|res
operator|.
name|output_token
operator|.
name|value
operator|=
literal|0
expr_stmt|;
name|established
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|established
condition|)
block|{
name|maj_stat
operator|=
name|gss_init_sec_context
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_cred
argument_list|,
operator|&
name|client_context
argument_list|,
name|name
argument_list|,
name|GSS_C_NO_OID
argument_list|,
operator|(
name|GSS_C_MUTUAL_FLAG
operator||
name|GSS_C_CONF_FLAG
operator||
name|GSS_C_INTEG_FLAG
operator||
name|GSS_C_SEQUENCE_FLAG
operator||
name|GSS_C_REPLAY_FLAG
operator|)
argument_list|,
literal|0
argument_list|,
name|GSS_C_NO_CHANNEL_BINDINGS
argument_list|,
operator|&
name|res
operator|.
name|output_token
argument_list|,
operator|&
name|mech_type
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_init_sec_context failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|args
operator|.
name|input_token
operator|.
name|length
condition|)
block|{
name|args
operator|.
name|step
operator|=
literal|1
expr_stmt|;
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|2
argument_list|,
operator|&
name|args
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|.
name|maj_stat
operator|!=
name|GSS_S_COMPLETE
operator|&&
name|res
operator|.
name|maj_stat
operator|!=
name|GSS_S_CONTINUE_NEEDED
condition|)
block|{
name|printf
argument_list|(
literal|"gss_accept_sec_context (kernel) failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|res
operator|.
name|maj_stat
argument_list|,
name|res
operator|.
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
if|if
condition|(
name|maj_stat
operator|==
name|GSS_S_COMPLETE
condition|)
name|established
operator|=
literal|1
expr_stmt|;
block|}
name|message_buf
operator|.
name|value
operator|=
literal|"Hello world"
expr_stmt|;
name|message_buf
operator|.
name|length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|message_buf
operator|.
name|value
argument_list|)
expr_stmt|;
name|maj_stat
operator|=
name|gss_get_mic
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
name|GSS_C_QOP_DEFAULT
argument_list|,
operator|&
name|message_buf
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_get_mic failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|args
operator|.
name|step
operator|=
literal|2
expr_stmt|;
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|2
argument_list|,
operator|&
name|args
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|res
operator|.
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"kernel gss_verify_mic failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|res
operator|.
name|maj_stat
argument_list|,
name|res
operator|.
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_verify_mic
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
operator|&
name|message_buf
argument_list|,
operator|&
name|res
operator|.
name|output_token
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_verify_mic failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_wrap
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
name|TRUE
argument_list|,
name|GSS_C_QOP_DEFAULT
argument_list|,
operator|&
name|message_buf
argument_list|,
name|NULL
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_wrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|args
operator|.
name|step
operator|=
literal|3
expr_stmt|;
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|2
argument_list|,
operator|&
name|args
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|res
operator|.
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"kernel gss_unwrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|res
operator|.
name|maj_stat
argument_list|,
name|res
operator|.
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_unwrap
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
operator|&
name|res
operator|.
name|output_token
argument_list|,
operator|&
name|message_buf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_unwrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|message_buf
argument_list|)
expr_stmt|;
name|maj_stat
operator|=
name|gss_wrap
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
name|FALSE
argument_list|,
name|GSS_C_QOP_DEFAULT
argument_list|,
operator|&
name|message_buf
argument_list|,
name|NULL
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_wrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|args
operator|.
name|step
operator|=
literal|4
expr_stmt|;
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|2
argument_list|,
operator|&
name|args
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|args
operator|.
name|input_token
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|res
operator|.
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"kernel gss_unwrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|res
operator|.
name|maj_stat
argument_list|,
name|res
operator|.
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|maj_stat
operator|=
name|gss_unwrap
argument_list|(
operator|&
name|min_stat
argument_list|,
name|client_context
argument_list|,
operator|&
name|res
operator|.
name|output_token
argument_list|,
operator|&
name|message_buf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|GSS_ERROR
argument_list|(
name|maj_stat
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"gss_unwrap failed\n"
argument_list|)
expr_stmt|;
name|report_error
argument_list|(
name|mech_type
argument_list|,
name|maj_stat
argument_list|,
name|min_stat
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|gss_release_buffer
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|message_buf
argument_list|)
expr_stmt|;
name|args
operator|.
name|step
operator|=
literal|5
expr_stmt|;
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|2
argument_list|,
operator|&
name|args
argument_list|,
operator|&
name|res
argument_list|)
expr_stmt|;
name|gss_release_name
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|name
argument_list|)
expr_stmt|;
name|gss_release_cred
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|client_cred
argument_list|)
expr_stmt|;
name|gss_delete_sec_context
argument_list|(
operator|&
name|min_stat
argument_list|,
operator|&
name|client_context
argument_list|,
name|GSS_C_NO_BUFFER
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
literal|3
case|:
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|syscall
argument_list|(
name|syscall_num
argument_list|,
literal|4
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
name|out
label|:
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

end_unit

