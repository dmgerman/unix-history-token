begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $FreeBSD$ */
end_comment

begin_include
include|#
directive|include
file|<setjmp.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|"dhcpd.h"
end_include

begin_decl_stmt
name|jmp_buf
name|env
decl_stmt|;
end_decl_stmt

begin_function_decl
name|void
name|expand_domain_search
parameter_list|(
name|struct
name|packet
modifier|*
name|packet
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|no_option_present
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|option_data
name|option
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|option
operator|.
name|data
operator|=
name|NULL
expr_stmt|;
name|option
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
operator|=
name|option
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
operator|.
name|len
operator|!=
literal|0
operator|||
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
operator|.
name|data
operator|!=
name|NULL
condition|)
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|one_domain_valid
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0"
decl_stmt|;
name|char
modifier|*
name|expected
init|=
literal|"example.org."
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|13
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|->
name|len
operator|!=
name|strlen
argument_list|(
name|expected
argument_list|)
operator|||
name|strcmp
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|expected
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|one_domain_truncated1
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|12
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|one_domain_truncated2
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007ex"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|3
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_valid
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\007example\003com\0"
decl_stmt|;
name|char
modifier|*
name|expected
init|=
literal|"example.org. example.com."
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|26
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|->
name|len
operator|!=
name|strlen
argument_list|(
name|expected
argument_list|)
operator|||
name|strcmp
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|expected
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_truncated1
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\007example\003com"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|25
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_truncated2
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\007ex"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|16
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_compressed
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\006foobar\xc0\x08"
decl_stmt|;
name|char
modifier|*
name|expected
init|=
literal|"example.org. foobar.org."
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|22
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|->
name|len
operator|!=
name|strlen
argument_list|(
name|expected
argument_list|)
operator|||
name|strcmp
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|expected
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_infloop
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\006foobar\xc0\x0d"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|22
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_forwardptr
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\xc0\x0d\006foobar\0"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|22
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|two_domains_truncatedptr
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\006foobar\xc0"
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|21
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|1
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|multiple_domains_valid
parameter_list|()
block|{
name|int
name|ret
decl_stmt|;
name|struct
name|packet
name|p
decl_stmt|;
name|struct
name|option_data
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|data
init|=
literal|"\007example\003org\0\002cl\006foobar\003com\0\002fr\xc0\x10"
decl_stmt|;
name|char
modifier|*
name|expected
init|=
literal|"example.org. cl.foobar.com. fr.foobar.com."
decl_stmt|;
name|option
operator|=
operator|&
name|p
operator|.
name|options
index|[
name|DHO_DOMAIN_SEARCH
index|]
expr_stmt|;
name|option
operator|->
name|len
operator|=
literal|33
expr_stmt|;
name|option
operator|->
name|data
operator|=
name|malloc
argument_list|(
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|data
argument_list|,
name|option
operator|->
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|setjmp
argument_list|(
name|env
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
literal|0
condition|)
name|expand_domain_search
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|->
name|len
operator|!=
name|strlen
argument_list|(
name|expected
argument_list|)
operator|||
name|strcmp
argument_list|(
name|option
operator|->
name|data
argument_list|,
name|expected
argument_list|)
operator|!=
literal|0
condition|)
name|abort
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|no_option_present
argument_list|()
expr_stmt|;
name|one_domain_valid
argument_list|()
expr_stmt|;
name|one_domain_truncated1
argument_list|()
expr_stmt|;
name|one_domain_truncated2
argument_list|()
expr_stmt|;
name|two_domains_valid
argument_list|()
expr_stmt|;
name|two_domains_truncated1
argument_list|()
expr_stmt|;
name|two_domains_truncated2
argument_list|()
expr_stmt|;
name|two_domains_compressed
argument_list|()
expr_stmt|;
name|two_domains_infloop
argument_list|()
expr_stmt|;
name|two_domains_forwardptr
argument_list|()
expr_stmt|;
name|two_domains_truncatedptr
argument_list|()
expr_stmt|;
name|multiple_domains_valid
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

