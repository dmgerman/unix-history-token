begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ===============================================================================  This C source file is part of TestFloat, Release 2a, a package of programs for testing the correctness of floating-point arithmetic complying to the IEC/IEEE Standard for Floating-Point.  Written by John R. Hauser.  More information is available through the Web page `http://HTTP.CS.Berkeley.EDU/~jhauser/arithmetic/TestFloat.html'.  THIS SOFTWARE IS DISTRIBUTED AS IS, FOR FREE.  Although reasonable effort has been made to avoid it, THIS SOFTWARE MAY CONTAIN FAULTS THAT WILL AT TIMES RESULT IN INCORRECT BEHAVIOR.  USE OF THIS SOFTWARE IS RESTRICTED TO PERSONS AND ORGANIZATIONS WHO CAN AND WILL TAKE FULL RESPONSIBILITY FOR ANY AND ALL LOSSES, COSTS, OR OTHER PROBLEMS ARISING FROM ITS USE.  Derivative works are acceptable, even for commercial purposes, so long as (1) they include prominent notice that the work is derivative, and (2) they include prominent notice akin to these four paragraphs for those parts of this code that are retained.  =============================================================================== */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"milieu.h"
end_include

begin_include
include|#
directive|include
file|"softfloat.h"
end_include

begin_include
include|#
directive|include
file|"writeHex.h"
end_include

begin_function
name|void
name|writeHex_flag
parameter_list|(
name|flag
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|fputc
argument_list|(
name|a
condition|?
literal|'1'
else|:
literal|'0'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|writeHex_bits8
parameter_list|(
name|bits8
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|int
name|digit
decl_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|4
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
name|a
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|writeHex_bits12
parameter_list|(
name|int16
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|int
name|digit
decl_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|8
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|4
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
name|a
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|writeHex_bits16
parameter_list|(
name|bits16
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|int
name|digit
decl_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|12
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|8
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
operator|(
name|a
operator|>>
literal|4
operator|)
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|digit
operator|=
name|a
operator|&
literal|0xF
expr_stmt|;
if|if
condition|(
literal|9
operator|<
name|digit
condition|)
name|digit
operator|+=
literal|'A'
operator|-
operator|(
literal|'0'
operator|+
literal|10
operator|)
expr_stmt|;
name|fputc
argument_list|(
literal|'0'
operator|+
name|digit
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|writeHex_bits32
parameter_list|(
name|bits32
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits16
argument_list|(
name|a
operator|>>
literal|16
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits16
argument_list|(
name|a
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|BITS64
end_ifdef

begin_function
name|void
name|writeHex_bits64
parameter_list|(
name|bits64
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits32
argument_list|(
name|a
operator|>>
literal|32
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits32
argument_list|(
name|a
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|writeHex_float32
parameter_list|(
name|float32
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|fputc
argument_list|(
operator|(
operator|(
operator|(
name|sbits32
operator|)
name|a
operator|)
operator|<
literal|0
operator|)
condition|?
literal|'8'
else|:
literal|'0'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits8
argument_list|(
name|a
operator|>>
literal|23
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits8
argument_list|(
operator|(
name|a
operator|>>
literal|16
operator|)
operator|&
literal|0x7F
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits16
argument_list|(
name|a
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|BITS64
end_ifdef

begin_function
name|void
name|writeHex_float64
parameter_list|(
name|float64
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits12
argument_list|(
name|a
operator|>>
literal|52
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits12
argument_list|(
name|a
operator|>>
literal|40
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits8
argument_list|(
name|a
operator|>>
literal|32
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits32
argument_list|(
name|a
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_function
name|void
name|writeHex_float64
parameter_list|(
name|float64
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits12
argument_list|(
name|a
operator|.
name|high
operator|>>
literal|20
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits12
argument_list|(
name|a
operator|.
name|high
operator|>>
literal|8
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits8
argument_list|(
name|a
operator|.
name|high
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits32
argument_list|(
name|a
operator|.
name|low
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|FLOATX80
end_ifdef

begin_function
name|void
name|writeHex_floatx80
parameter_list|(
name|floatx80
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits16
argument_list|(
name|a
operator|.
name|high
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits64
argument_list|(
name|a
operator|.
name|low
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|FLOAT128
end_ifdef

begin_function
name|void
name|writeHex_float128
parameter_list|(
name|float128
name|a
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|writeHex_bits16
argument_list|(
name|a
operator|.
name|high
operator|>>
literal|48
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits16
argument_list|(
name|a
operator|.
name|high
operator|>>
literal|32
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits32
argument_list|(
name|a
operator|.
name|high
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|writeHex_bits64
argument_list|(
name|a
operator|.
name|low
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|writeHex_float_flags
parameter_list|(
name|uint8
name|flags
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|)
block|{
name|fputc
argument_list|(
name|flags
operator|&
name|float_flag_invalid
condition|?
literal|'v'
else|:
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
name|flags
operator|&
name|float_flag_divbyzero
condition|?
literal|'z'
else|:
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
name|flags
operator|&
name|float_flag_overflow
condition|?
literal|'o'
else|:
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
name|flags
operator|&
name|float_flag_underflow
condition|?
literal|'u'
else|:
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
name|flags
operator|&
name|float_flag_inexact
condition|?
literal|'x'
else|:
literal|'.'
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

