begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* example.c -- usage example of the zlib compression library  */
end_comment

begin_comment
comment|/*  Copyright (c) 1995-2006, 2011 Jean-loup Gailly  This software is provided 'as-is', without any express or implied warranty. In no event will the authors be held liable for any damages arising from the use of this software.  Permission is granted to anyone to use this software for any purpose, including commercial applications, and to alter it and redistribute it freely, subject to the following restrictions:  1. The origin of this software must not be misrepresented; you must not    claim that you wrote the original software. If you use this software    in a product, an acknowledgement in the product documentation would be    appreciated but is not required. 2. Altered source versions must be plainly marked as such, and must not be    misrepresented as being the original software. 3. This notice may not be removed or altered from any source distribution. */
end_comment

begin_comment
comment|/* @(#) $Id$ */
end_comment

begin_include
include|#
directive|include
file|"zlib.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|STDC
end_ifdef

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|VMS
argument_list|)
operator|||
name|defined
argument_list|(
name|RISCOS
argument_list|)
end_if

begin_define
define|#
directive|define
name|TESTFILE
value|"foo-gz"
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|TESTFILE
value|"foo.gz"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|CHECK_ERR
parameter_list|(
name|err
parameter_list|,
name|msg
parameter_list|)
value|{ \     if (err != Z_OK) { \         fprintf(stderr, "%s error: %d\n", msg, err); \         exit(1); \     } \ }
end_define

begin_decl_stmt
name|z_const
name|char
name|hello
index|[]
init|=
literal|"hello, hello!"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* "hello world" would be more standard, but the repeated "hello"  * stresses the compression code better, sorry...  */
end_comment

begin_decl_stmt
specifier|const
name|char
name|dictionary
index|[]
init|=
literal|"hello"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|uLong
name|dictId
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Adler32 value of the dictionary */
end_comment

begin_decl_stmt
name|void
name|test_deflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_inflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_large_deflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_large_inflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_flush
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
operator|*
name|comprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_sync
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_dict_deflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_dict_inflate
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
decl|main
name|OF
argument_list|(
operator|(
name|int
name|argc
operator|,
name|char
operator|*
name|argv
index|[]
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|Z_SOLO
end_ifdef

begin_decl_stmt
name|void
modifier|*
name|myalloc
name|OF
argument_list|(
operator|(
name|void
operator|*
operator|,
name|unsigned
operator|,
name|unsigned
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|myfree
name|OF
argument_list|(
operator|(
name|void
operator|*
operator|,
name|void
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
name|void
modifier|*
name|myalloc
parameter_list|(
name|q
parameter_list|,
name|n
parameter_list|,
name|m
parameter_list|)
name|void
modifier|*
name|q
decl_stmt|;
name|unsigned
name|n
decl_stmt|,
name|m
decl_stmt|;
block|{
name|q
operator|=
name|Z_NULL
expr_stmt|;
return|return
name|calloc
argument_list|(
name|n
argument_list|,
name|m
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|myfree
parameter_list|(
name|void
modifier|*
name|q
parameter_list|,
name|void
modifier|*
name|p
parameter_list|)
block|{
name|q
operator|=
name|Z_NULL
expr_stmt|;
name|free
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|alloc_func
name|zalloc
init|=
name|myalloc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|free_func
name|zfree
init|=
name|myfree
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !Z_SOLO */
end_comment

begin_decl_stmt
specifier|static
name|alloc_func
name|zalloc
init|=
operator|(
name|alloc_func
operator|)
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|free_func
name|zfree
init|=
operator|(
name|free_func
operator|)
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_compress
name|OF
argument_list|(
operator|(
name|Byte
operator|*
name|compr
operator|,
name|uLong
name|comprLen
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|test_gzio
name|OF
argument_list|(
operator|(
specifier|const
name|char
operator|*
name|fname
operator|,
name|Byte
operator|*
name|uncompr
operator|,
name|uLong
name|uncomprLen
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ===========================================================================  * Test compress() and uncompress()  */
end_comment

begin_function
name|void
name|test_compress
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|err
decl_stmt|;
name|uLong
name|len
init|=
operator|(
name|uLong
operator|)
name|strlen
argument_list|(
name|hello
argument_list|)
operator|+
literal|1
decl_stmt|;
name|err
operator|=
name|compress
argument_list|(
name|compr
argument_list|,
operator|&
name|comprLen
argument_list|,
operator|(
specifier|const
name|Bytef
operator|*
operator|)
name|hello
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"compress"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
name|err
operator|=
name|uncompress
argument_list|(
name|uncompr
argument_list|,
operator|&
name|uncomprLen
argument_list|,
name|compr
argument_list|,
name|comprLen
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"uncompress"
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
name|hello
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad uncompress\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"uncompress(): %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Test read/write of .gz files  */
end_comment

begin_function
name|void
name|test_gzio
parameter_list|(
name|fname
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
specifier|const
name|char
modifier|*
name|fname
decl_stmt|;
comment|/* compressed file name */
name|Byte
modifier|*
name|uncompr
decl_stmt|;
name|uLong
name|uncomprLen
decl_stmt|;
block|{
ifdef|#
directive|ifdef
name|NO_GZCOMPRESS
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"NO_GZCOMPRESS -- gz* functions cannot compress\n"
argument_list|)
expr_stmt|;
else|#
directive|else
name|int
name|err
decl_stmt|;
name|int
name|len
init|=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|hello
argument_list|)
operator|+
literal|1
decl_stmt|;
name|gzFile
name|file
decl_stmt|;
name|z_off_t
name|pos
decl_stmt|;
name|file
operator|=
name|gzopen
argument_list|(
name|fname
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
name|file
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzopen error\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|gzputc
argument_list|(
name|file
argument_list|,
literal|'h'
argument_list|)
expr_stmt|;
if|if
condition|(
name|gzputs
argument_list|(
name|file
argument_list|,
literal|"ello"
argument_list|)
operator|!=
literal|4
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzputs err: %s\n"
argument_list|,
name|gzerror
argument_list|(
name|file
argument_list|,
operator|&
name|err
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gzprintf
argument_list|(
name|file
argument_list|,
literal|", %s!"
argument_list|,
literal|"hello"
argument_list|)
operator|!=
literal|8
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzprintf err: %s\n"
argument_list|,
name|gzerror
argument_list|(
name|file
argument_list|,
operator|&
name|err
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|gzseek
argument_list|(
name|file
argument_list|,
literal|1L
argument_list|,
name|SEEK_CUR
argument_list|)
expr_stmt|;
comment|/* add one zero byte */
name|gzclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|file
operator|=
name|gzopen
argument_list|(
name|fname
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
name|file
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzopen error\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
if|if
condition|(
name|gzread
argument_list|(
name|file
argument_list|,
name|uncompr
argument_list|,
operator|(
name|unsigned
operator|)
name|uncomprLen
argument_list|)
operator|!=
name|len
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzread err: %s\n"
argument_list|,
name|gzerror
argument_list|(
name|file
argument_list|,
operator|&
name|err
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
name|hello
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad gzread: %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"gzread(): %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
name|pos
operator|=
name|gzseek
argument_list|(
name|file
argument_list|,
operator|-
literal|8L
argument_list|,
name|SEEK_CUR
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|!=
literal|6
operator|||
name|gztell
argument_list|(
name|file
argument_list|)
operator|!=
name|pos
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzseek error, pos=%ld, gztell=%ld\n"
argument_list|,
operator|(
name|long
operator|)
name|pos
argument_list|,
operator|(
name|long
operator|)
name|gztell
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gzgetc
argument_list|(
name|file
argument_list|)
operator|!=
literal|' '
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzgetc error\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gzungetc
argument_list|(
literal|' '
argument_list|,
name|file
argument_list|)
operator|!=
literal|' '
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzungetc error\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|gzgets
argument_list|(
name|file
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
operator|(
name|int
operator|)
name|uncomprLen
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
operator|!=
literal|7
condition|)
block|{
comment|/* " hello!" */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"gzgets err after gzseek: %s\n"
argument_list|,
name|gzerror
argument_list|(
name|file
argument_list|,
operator|&
name|err
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
name|hello
operator|+
literal|6
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad gzgets after gzseek\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"gzgets() after gzseek: %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
name|gzclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Z_SOLO */
end_comment

begin_comment
comment|/* ===========================================================================  * Test deflate() with small buffers  */
end_comment

begin_function
name|void
name|test_deflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|;
name|uLong
name|comprLen
decl_stmt|;
block|{
name|z_stream
name|c_stream
decl_stmt|;
comment|/* compression stream */
name|int
name|err
decl_stmt|;
name|uLong
name|len
init|=
operator|(
name|uLong
operator|)
name|strlen
argument_list|(
name|hello
argument_list|)
operator|+
literal|1
decl_stmt|;
name|c_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|c_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|c_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|err
operator|=
name|deflateInit
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_DEFAULT_COMPRESSION
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateInit"
argument_list|)
expr_stmt|;
name|c_stream
operator|.
name|next_in
operator|=
operator|(
name|z_const
name|unsigned
name|char
operator|*
operator|)
name|hello
expr_stmt|;
name|c_stream
operator|.
name|next_out
operator|=
name|compr
expr_stmt|;
while|while
condition|(
name|c_stream
operator|.
name|total_in
operator|!=
name|len
operator|&&
name|c_stream
operator|.
name|total_out
operator|<
name|comprLen
condition|)
block|{
name|c_stream
operator|.
name|avail_in
operator|=
name|c_stream
operator|.
name|avail_out
operator|=
literal|1
expr_stmt|;
comment|/* force small buffers */
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
block|}
comment|/* Finish the stream, still forcing small buffers: */
for|for
control|(
init|;
condition|;
control|)
block|{
name|c_stream
operator|.
name|avail_out
operator|=
literal|1
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|Z_STREAM_END
condition|)
break|break;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|deflateEnd
argument_list|(
operator|&
name|c_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateEnd"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ===========================================================================  * Test inflate() with small buffers  */
end_comment

begin_function
name|void
name|test_inflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|err
decl_stmt|;
name|z_stream
name|d_stream
decl_stmt|;
comment|/* decompression stream */
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|d_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|d_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|d_stream
operator|.
name|next_in
operator|=
name|compr
expr_stmt|;
name|d_stream
operator|.
name|avail_in
operator|=
literal|0
expr_stmt|;
name|d_stream
operator|.
name|next_out
operator|=
name|uncompr
expr_stmt|;
name|err
operator|=
name|inflateInit
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateInit"
argument_list|)
expr_stmt|;
while|while
condition|(
name|d_stream
operator|.
name|total_out
operator|<
name|uncomprLen
operator|&&
name|d_stream
operator|.
name|total_in
operator|<
name|comprLen
condition|)
block|{
name|d_stream
operator|.
name|avail_in
operator|=
name|d_stream
operator|.
name|avail_out
operator|=
literal|1
expr_stmt|;
comment|/* force small buffers */
name|err
operator|=
name|inflate
argument_list|(
operator|&
name|d_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|Z_STREAM_END
condition|)
break|break;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflate"
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|inflateEnd
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateEnd"
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
name|hello
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad inflate\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"inflate(): %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Test deflate() with large buffers and dynamic change of compression level  */
end_comment

begin_function
name|void
name|test_large_deflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|z_stream
name|c_stream
decl_stmt|;
comment|/* compression stream */
name|int
name|err
decl_stmt|;
name|c_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|c_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|c_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|err
operator|=
name|deflateInit
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_BEST_SPEED
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateInit"
argument_list|)
expr_stmt|;
name|c_stream
operator|.
name|next_out
operator|=
name|compr
expr_stmt|;
name|c_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
name|comprLen
expr_stmt|;
comment|/* At this point, uncompr is still mostly zeroes, so it should compress      * very well:      */
name|c_stream
operator|.
name|next_in
operator|=
name|uncompr
expr_stmt|;
name|c_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|uncomprLen
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
if|if
condition|(
name|c_stream
operator|.
name|avail_in
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"deflate not greedy\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* Feed in already compressed data and switch to no compression: */
name|deflateParams
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_NO_COMPRESSION
argument_list|,
name|Z_DEFAULT_STRATEGY
argument_list|)
expr_stmt|;
name|c_stream
operator|.
name|next_in
operator|=
name|compr
expr_stmt|;
name|c_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|comprLen
operator|/
literal|2
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
comment|/* Switch back to compressing mode: */
name|deflateParams
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_BEST_COMPRESSION
argument_list|,
name|Z_FILTERED
argument_list|)
expr_stmt|;
name|c_stream
operator|.
name|next_in
operator|=
name|uncompr
expr_stmt|;
name|c_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|uncomprLen
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_STREAM_END
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"deflate should report Z_STREAM_END\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|deflateEnd
argument_list|(
operator|&
name|c_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateEnd"
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Test inflate() with large buffers  */
end_comment

begin_function
name|void
name|test_large_inflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|err
decl_stmt|;
name|z_stream
name|d_stream
decl_stmt|;
comment|/* decompression stream */
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|d_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|d_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|d_stream
operator|.
name|next_in
operator|=
name|compr
expr_stmt|;
name|d_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|comprLen
expr_stmt|;
name|err
operator|=
name|inflateInit
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateInit"
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|d_stream
operator|.
name|next_out
operator|=
name|uncompr
expr_stmt|;
comment|/* discard the output */
name|d_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
name|uncomprLen
expr_stmt|;
name|err
operator|=
name|inflate
argument_list|(
operator|&
name|d_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|Z_STREAM_END
condition|)
break|break;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"large inflate"
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|inflateEnd
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateEnd"
argument_list|)
expr_stmt|;
if|if
condition|(
name|d_stream
operator|.
name|total_out
operator|!=
literal|2
operator|*
name|uncomprLen
operator|+
name|comprLen
operator|/
literal|2
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad large inflate: %ld\n"
argument_list|,
name|d_stream
operator|.
name|total_out
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"large_inflate(): OK\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Test deflate() with full flush  */
end_comment

begin_function
name|void
name|test_flush
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|;
name|uLong
modifier|*
name|comprLen
decl_stmt|;
block|{
name|z_stream
name|c_stream
decl_stmt|;
comment|/* compression stream */
name|int
name|err
decl_stmt|;
name|uInt
name|len
init|=
operator|(
name|uInt
operator|)
name|strlen
argument_list|(
name|hello
argument_list|)
operator|+
literal|1
decl_stmt|;
name|c_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|c_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|c_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|err
operator|=
name|deflateInit
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_DEFAULT_COMPRESSION
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateInit"
argument_list|)
expr_stmt|;
name|c_stream
operator|.
name|next_in
operator|=
operator|(
name|z_const
name|unsigned
name|char
operator|*
operator|)
name|hello
expr_stmt|;
name|c_stream
operator|.
name|next_out
operator|=
name|compr
expr_stmt|;
name|c_stream
operator|.
name|avail_in
operator|=
literal|3
expr_stmt|;
name|c_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
operator|*
name|comprLen
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_FULL_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
name|compr
index|[
literal|3
index|]
operator|++
expr_stmt|;
comment|/* force an error in first compressed block */
name|c_stream
operator|.
name|avail_in
operator|=
name|len
operator|-
literal|3
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_STREAM_END
condition|)
block|{
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflate"
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|deflateEnd
argument_list|(
operator|&
name|c_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateEnd"
argument_list|)
expr_stmt|;
operator|*
name|comprLen
operator|=
name|c_stream
operator|.
name|total_out
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ===========================================================================  * Test inflateSync()  */
end_comment

begin_function
name|void
name|test_sync
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|err
decl_stmt|;
name|z_stream
name|d_stream
decl_stmt|;
comment|/* decompression stream */
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|d_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|d_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|d_stream
operator|.
name|next_in
operator|=
name|compr
expr_stmt|;
name|d_stream
operator|.
name|avail_in
operator|=
literal|2
expr_stmt|;
comment|/* just read the zlib header */
name|err
operator|=
name|inflateInit
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateInit"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|next_out
operator|=
name|uncompr
expr_stmt|;
name|d_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
name|uncomprLen
expr_stmt|;
name|inflate
argument_list|(
operator|&
name|d_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflate"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|comprLen
operator|-
literal|2
expr_stmt|;
comment|/* read all compressed data */
name|err
operator|=
name|inflateSync
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
comment|/* but skip the damaged part */
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateSync"
argument_list|)
expr_stmt|;
name|err
operator|=
name|inflate
argument_list|(
operator|&
name|d_stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_DATA_ERROR
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"inflate should report DATA_ERROR\n"
argument_list|)
expr_stmt|;
comment|/* Because of incorrect adler32 */
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|inflateEnd
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateEnd"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"after inflateSync(): hel%s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Test deflate() with preset dictionary  */
end_comment

begin_function
name|void
name|test_dict_deflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|;
name|uLong
name|comprLen
decl_stmt|;
block|{
name|z_stream
name|c_stream
decl_stmt|;
comment|/* compression stream */
name|int
name|err
decl_stmt|;
name|c_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|c_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|c_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|err
operator|=
name|deflateInit
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_BEST_COMPRESSION
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateInit"
argument_list|)
expr_stmt|;
name|err
operator|=
name|deflateSetDictionary
argument_list|(
operator|&
name|c_stream
argument_list|,
operator|(
specifier|const
name|Bytef
operator|*
operator|)
name|dictionary
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|dictionary
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateSetDictionary"
argument_list|)
expr_stmt|;
name|dictId
operator|=
name|c_stream
operator|.
name|adler
expr_stmt|;
name|c_stream
operator|.
name|next_out
operator|=
name|compr
expr_stmt|;
name|c_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
name|comprLen
expr_stmt|;
name|c_stream
operator|.
name|next_in
operator|=
operator|(
name|z_const
name|unsigned
name|char
operator|*
operator|)
name|hello
expr_stmt|;
name|c_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|strlen
argument_list|(
name|hello
argument_list|)
operator|+
literal|1
expr_stmt|;
name|err
operator|=
name|deflate
argument_list|(
operator|&
name|c_stream
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|!=
name|Z_STREAM_END
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"deflate should report Z_STREAM_END\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|deflateEnd
argument_list|(
operator|&
name|c_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"deflateEnd"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ===========================================================================  * Test inflate() with a preset dictionary  */
end_comment

begin_function
name|void
name|test_dict_inflate
parameter_list|(
name|compr
parameter_list|,
name|comprLen
parameter_list|,
name|uncompr
parameter_list|,
name|uncomprLen
parameter_list|)
name|Byte
modifier|*
name|compr
decl_stmt|,
decl|*
name|uncompr
decl_stmt|;
end_function

begin_decl_stmt
name|uLong
name|comprLen
decl_stmt|,
name|uncomprLen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|err
decl_stmt|;
name|z_stream
name|d_stream
decl_stmt|;
comment|/* decompression stream */
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
literal|"garbage"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|zalloc
operator|=
name|zalloc
expr_stmt|;
name|d_stream
operator|.
name|zfree
operator|=
name|zfree
expr_stmt|;
name|d_stream
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
literal|0
expr_stmt|;
name|d_stream
operator|.
name|next_in
operator|=
name|compr
expr_stmt|;
name|d_stream
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|comprLen
expr_stmt|;
name|err
operator|=
name|inflateInit
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateInit"
argument_list|)
expr_stmt|;
name|d_stream
operator|.
name|next_out
operator|=
name|uncompr
expr_stmt|;
name|d_stream
operator|.
name|avail_out
operator|=
operator|(
name|uInt
operator|)
name|uncomprLen
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|err
operator|=
name|inflate
argument_list|(
operator|&
name|d_stream
argument_list|,
name|Z_NO_FLUSH
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|==
name|Z_STREAM_END
condition|)
break|break;
if|if
condition|(
name|err
operator|==
name|Z_NEED_DICT
condition|)
block|{
if|if
condition|(
name|d_stream
operator|.
name|adler
operator|!=
name|dictId
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unexpected dictionary"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|inflateSetDictionary
argument_list|(
operator|&
name|d_stream
argument_list|,
operator|(
specifier|const
name|Bytef
operator|*
operator|)
name|dictionary
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|dictionary
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflate with dict"
argument_list|)
expr_stmt|;
block|}
name|err
operator|=
name|inflateEnd
argument_list|(
operator|&
name|d_stream
argument_list|)
expr_stmt|;
name|CHECK_ERR
argument_list|(
name|err
argument_list|,
literal|"inflateEnd"
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|,
name|hello
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad inflate with dict\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"inflate with dictionary: %s\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|uncompr
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* ===========================================================================  * Usage:  example [output.gz  [input.gz]]  */
end_comment

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|Byte
modifier|*
name|compr
decl_stmt|,
modifier|*
name|uncompr
decl_stmt|;
name|uLong
name|comprLen
init|=
literal|10000
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
decl_stmt|;
comment|/* don't overflow on MSDOS */
name|uLong
name|uncomprLen
init|=
name|comprLen
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|myVersion
init|=
name|ZLIB_VERSION
decl_stmt|;
if|if
condition|(
name|zlibVersion
argument_list|()
index|[
literal|0
index|]
operator|!=
name|myVersion
index|[
literal|0
index|]
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"incompatible zlib version\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|zlibVersion
argument_list|()
argument_list|,
name|ZLIB_VERSION
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"warning: different zlib version\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"zlib version %s = 0x%04x, compile flags = 0x%lx\n"
argument_list|,
name|ZLIB_VERSION
argument_list|,
name|ZLIB_VERNUM
argument_list|,
name|zlibCompileFlags
argument_list|()
argument_list|)
expr_stmt|;
name|compr
operator|=
operator|(
name|Byte
operator|*
operator|)
name|calloc
argument_list|(
operator|(
name|uInt
operator|)
name|comprLen
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|uncompr
operator|=
operator|(
name|Byte
operator|*
operator|)
name|calloc
argument_list|(
operator|(
name|uInt
operator|)
name|uncomprLen
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* compr and uncompr are cleared to avoid reading uninitialized      * data and to ensure that uncompr compresses well.      */
if|if
condition|(
name|compr
operator|==
name|Z_NULL
operator|||
name|uncompr
operator|==
name|Z_NULL
condition|)
block|{
name|printf
argument_list|(
literal|"out of memory\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|Z_SOLO
name|argc
operator|=
name|strlen
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
name|test_compress
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|test_gzio
argument_list|(
operator|(
name|argc
operator|>
literal|1
condition|?
name|argv
index|[
literal|1
index|]
else|:
name|TESTFILE
operator|)
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|test_deflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|)
expr_stmt|;
name|test_inflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|test_large_deflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|test_large_inflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|test_flush
argument_list|(
name|compr
argument_list|,
operator|&
name|comprLen
argument_list|)
expr_stmt|;
name|test_sync
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|comprLen
operator|=
name|uncomprLen
expr_stmt|;
name|test_dict_deflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|)
expr_stmt|;
name|test_dict_inflate
argument_list|(
name|compr
argument_list|,
name|comprLen
argument_list|,
name|uncompr
argument_list|,
name|uncomprLen
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|compr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|uncompr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

