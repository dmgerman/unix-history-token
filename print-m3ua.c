begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) 2013, The TCPDUMP project  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions are met:  *  * 1. Redistributions of source code must retain the above copyright notice, this  *    list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright notice,  *    this list of conditions and the following disclaimer in the documentation  *    and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_comment
comment|/* \summary: Message Transfer Part 3 (MTP3) User Adaptation Layer (M3UA) printer */
end_comment

begin_comment
comment|/* RFC 4666 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netdissect-stdinc.h>
end_include

begin_include
include|#
directive|include
file|"netdissect.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_decl_stmt
specifier|static
specifier|const
name|char
name|tstr
index|[]
init|=
literal|" [|m3ua]"
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|M3UA_REL_1_0
value|1
end_define

begin_struct
struct|struct
name|m3ua_common_header
block|{
name|uint8_t
name|v
decl_stmt|;
name|uint8_t
name|reserved
decl_stmt|;
name|uint8_t
name|msg_class
decl_stmt|;
name|uint8_t
name|msg_type
decl_stmt|;
name|uint32_t
name|len
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|m3ua_param_header
block|{
name|uint16_t
name|tag
decl_stmt|;
name|uint16_t
name|len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* message classes */
end_comment

begin_define
define|#
directive|define
name|M3UA_MSGC_MGMT
value|0
end_define

begin_define
define|#
directive|define
name|M3UA_MSGC_TRANSFER
value|1
end_define

begin_define
define|#
directive|define
name|M3UA_MSGC_SSNM
value|2
end_define

begin_define
define|#
directive|define
name|M3UA_MSGC_ASPSM
value|3
end_define

begin_define
define|#
directive|define
name|M3UA_MSGC_ASPTM
value|4
end_define

begin_comment
comment|/* reserved values */
end_comment

begin_define
define|#
directive|define
name|M3UA_MSGC_RKM
value|9
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|MessageClasses
index|[]
init|=
block|{
block|{
name|M3UA_MSGC_MGMT
block|,
literal|"Management"
block|}
block|,
block|{
name|M3UA_MSGC_TRANSFER
block|,
literal|"Transfer"
block|}
block|,
block|{
name|M3UA_MSGC_SSNM
block|,
literal|"SS7"
block|}
block|,
block|{
name|M3UA_MSGC_ASPSM
block|,
literal|"ASP"
block|}
block|,
block|{
name|M3UA_MSGC_ASPTM
block|,
literal|"ASP"
block|}
block|,
block|{
name|M3UA_MSGC_RKM
block|,
literal|"Routing Key Managment"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* management messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_MGMT_ERROR
value|0
end_define

begin_define
define|#
directive|define
name|M3UA_MGMT_NOTIFY
value|1
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|MgmtMessages
index|[]
init|=
block|{
block|{
name|M3UA_MGMT_ERROR
block|,
literal|"Error"
block|}
block|,
block|{
name|M3UA_MGMT_NOTIFY
block|,
literal|"Notify"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* transfer messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_TRANSFER_DATA
value|1
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|TransferMessages
index|[]
init|=
block|{
block|{
name|M3UA_TRANSFER_DATA
block|,
literal|"Data"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* SS7 Signaling Network Management messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_SSNM_DUNA
value|1
end_define

begin_define
define|#
directive|define
name|M3UA_SSNM_DAVA
value|2
end_define

begin_define
define|#
directive|define
name|M3UA_SSNM_DAUD
value|3
end_define

begin_define
define|#
directive|define
name|M3UA_SSNM_SCON
value|4
end_define

begin_define
define|#
directive|define
name|M3UA_SSNM_DUPU
value|5
end_define

begin_define
define|#
directive|define
name|M3UA_SSNM_DRST
value|6
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|SS7Messages
index|[]
init|=
block|{
block|{
name|M3UA_SSNM_DUNA
block|,
literal|"Destination Unavailable"
block|}
block|,
block|{
name|M3UA_SSNM_DAVA
block|,
literal|"Destination Available"
block|}
block|,
block|{
name|M3UA_SSNM_DAUD
block|,
literal|"Destination State Audit"
block|}
block|,
block|{
name|M3UA_SSNM_SCON
block|,
literal|"Signalling Congestion"
block|}
block|,
block|{
name|M3UA_SSNM_DUPU
block|,
literal|"Destination User Part Unavailable"
block|}
block|,
block|{
name|M3UA_SSNM_DRST
block|,
literal|"Destination Restricted"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ASP State Maintenance messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_ASP_UP
value|1
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_DN
value|2
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_BEAT
value|3
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_UP_ACK
value|4
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_DN_ACK
value|5
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_BEAT_ACK
value|6
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|ASPStateMessages
index|[]
init|=
block|{
block|{
name|M3UA_ASP_UP
block|,
literal|"Up"
block|}
block|,
block|{
name|M3UA_ASP_DN
block|,
literal|"Down"
block|}
block|,
block|{
name|M3UA_ASP_BEAT
block|,
literal|"Heartbeat"
block|}
block|,
block|{
name|M3UA_ASP_UP_ACK
block|,
literal|"Up Acknowledgement"
block|}
block|,
block|{
name|M3UA_ASP_DN_ACK
block|,
literal|"Down Acknowledgement"
block|}
block|,
block|{
name|M3UA_ASP_BEAT_ACK
block|,
literal|"Heartbeat Acknowledgement"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ASP Traffic Maintenance messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_ASP_AC
value|1
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_IA
value|2
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_AC_ACK
value|3
end_define

begin_define
define|#
directive|define
name|M3UA_ASP_IA_ACK
value|4
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|ASPTrafficMessages
index|[]
init|=
block|{
block|{
name|M3UA_ASP_AC
block|,
literal|"Active"
block|}
block|,
block|{
name|M3UA_ASP_IA
block|,
literal|"Inactive"
block|}
block|,
block|{
name|M3UA_ASP_AC_ACK
block|,
literal|"Active Acknowledgement"
block|}
block|,
block|{
name|M3UA_ASP_IA_ACK
block|,
literal|"Inactive Acknowledgement"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Routing Key Management messages */
end_comment

begin_define
define|#
directive|define
name|M3UA_RKM_REQ
value|1
end_define

begin_define
define|#
directive|define
name|M3UA_RKM_RSP
value|2
end_define

begin_define
define|#
directive|define
name|M3UA_RKM_DEREQ
value|3
end_define

begin_define
define|#
directive|define
name|M3UA_RKM_DERSP
value|4
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|RoutingKeyMgmtMessages
index|[]
init|=
block|{
block|{
name|M3UA_RKM_REQ
block|,
literal|"Registration Request"
block|}
block|,
block|{
name|M3UA_RKM_RSP
block|,
literal|"Registration Response"
block|}
block|,
block|{
name|M3UA_RKM_DEREQ
block|,
literal|"Deregistration Request"
block|}
block|,
block|{
name|M3UA_RKM_DERSP
block|,
literal|"Deregistration Response"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* M3UA Parameters */
end_comment

begin_define
define|#
directive|define
name|M3UA_PARAM_INFO
value|0x0004
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_ROUTING_CTX
value|0x0006
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_DIAGNOSTIC
value|0x0007
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_HB_DATA
value|0x0009
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_TRAFFIC_MODE_TYPE
value|0x000b
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_ERROR_CODE
value|0x000c
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_STATUS
value|0x000d
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_ASP_ID
value|0x0011
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_AFFECTED_POINT_CODE
value|0x0012
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_CORR_ID
value|0x0013
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_NETWORK_APPEARANCE
value|0x0200
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_USER
value|0x0204
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_CONGESTION_INDICATION
value|0x0205
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_CONCERNED_DST
value|0x0206
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_ROUTING_KEY
value|0x0207
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_REG_RESULT
value|0x0208
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_DEREG_RESULT
value|0x0209
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_LOCAL_ROUTING_KEY_ID
value|0x020a
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_DST_POINT_CODE
value|0x020b
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_SI
value|0x020c
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_ORIGIN_POINT_CODE_LIST
value|0x020e
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_PROTO_DATA
value|0x0210
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_REG_STATUS
value|0x0212
end_define

begin_define
define|#
directive|define
name|M3UA_PARAM_DEREG_STATUS
value|0x0213
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|ParamName
index|[]
init|=
block|{
block|{
name|M3UA_PARAM_INFO
block|,
literal|"INFO String"
block|}
block|,
block|{
name|M3UA_PARAM_ROUTING_CTX
block|,
literal|"Routing Context"
block|}
block|,
block|{
name|M3UA_PARAM_DIAGNOSTIC
block|,
literal|"Diagnostic Info"
block|}
block|,
block|{
name|M3UA_PARAM_HB_DATA
block|,
literal|"Heartbeat Data"
block|}
block|,
block|{
name|M3UA_PARAM_TRAFFIC_MODE_TYPE
block|,
literal|"Traffic Mode Type"
block|}
block|,
block|{
name|M3UA_PARAM_ERROR_CODE
block|,
literal|"Error Code"
block|}
block|,
block|{
name|M3UA_PARAM_STATUS
block|,
literal|"Status"
block|}
block|,
block|{
name|M3UA_PARAM_ASP_ID
block|,
literal|"ASP Identifier"
block|}
block|,
block|{
name|M3UA_PARAM_AFFECTED_POINT_CODE
block|,
literal|"Affected Point Code"
block|}
block|,
block|{
name|M3UA_PARAM_CORR_ID
block|,
literal|"Correlation ID"
block|}
block|,
block|{
name|M3UA_PARAM_NETWORK_APPEARANCE
block|,
literal|"Network Appearance"
block|}
block|,
block|{
name|M3UA_PARAM_USER
block|,
literal|"User/Cause"
block|}
block|,
block|{
name|M3UA_PARAM_CONGESTION_INDICATION
block|,
literal|"Congestion Indications"
block|}
block|,
block|{
name|M3UA_PARAM_CONCERNED_DST
block|,
literal|"Concerned Destination"
block|}
block|,
block|{
name|M3UA_PARAM_ROUTING_KEY
block|,
literal|"Routing Key"
block|}
block|,
block|{
name|M3UA_PARAM_REG_RESULT
block|,
literal|"Registration Result"
block|}
block|,
block|{
name|M3UA_PARAM_DEREG_RESULT
block|,
literal|"Deregistration Result"
block|}
block|,
block|{
name|M3UA_PARAM_LOCAL_ROUTING_KEY_ID
block|,
literal|"Local Routing Key Identifier"
block|}
block|,
block|{
name|M3UA_PARAM_DST_POINT_CODE
block|,
literal|"Destination Point Code"
block|}
block|,
block|{
name|M3UA_PARAM_SI
block|,
literal|"Service Indicators"
block|}
block|,
block|{
name|M3UA_PARAM_ORIGIN_POINT_CODE_LIST
block|,
literal|"Originating Point Code List"
block|}
block|,
block|{
name|M3UA_PARAM_PROTO_DATA
block|,
literal|"Protocol Data"
block|}
block|,
block|{
name|M3UA_PARAM_REG_STATUS
block|,
literal|"Registration Status"
block|}
block|,
block|{
name|M3UA_PARAM_DEREG_STATUS
block|,
literal|"Deregistration Status"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|tag_value_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|buf
parameter_list|,
specifier|const
name|uint16_t
name|tag
parameter_list|,
specifier|const
name|uint16_t
name|size
parameter_list|)
block|{
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
name|M3UA_PARAM_NETWORK_APPEARANCE
case|:
case|case
name|M3UA_PARAM_ROUTING_CTX
case|:
case|case
name|M3UA_PARAM_CORR_ID
case|:
comment|/* buf and size don't include the header */
if|if
condition|(
name|size
operator|<
literal|4
condition|)
goto|goto
name|invalid
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|buf
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"0x%08x"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|buf
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
comment|/* ... */
default|default:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"(length %u)"
operator|,
name|size
operator|+
operator|(
name|u_int
operator|)
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_param_header
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|buf
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
return|return;
name|invalid
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|istr
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|buf
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *     0                   1                   2                   3  *     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *    |          Parameter Tag        |       Parameter Length        |  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *    \                                                               \  *    /                       Parameter Value                         /  *    \                                                               \  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_function
specifier|static
name|void
name|m3ua_tags_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|buf
parameter_list|,
specifier|const
name|u_int
name|size
parameter_list|)
block|{
specifier|const
name|u_char
modifier|*
name|p
init|=
name|buf
decl_stmt|;
name|int
name|align
decl_stmt|;
name|uint16_t
name|hdr_tag
decl_stmt|;
name|uint16_t
name|hdr_len
decl_stmt|;
while|while
condition|(
name|p
operator|<
name|buf
operator|+
name|size
condition|)
block|{
if|if
condition|(
name|p
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_param_header
argument_list|)
operator|>
name|buf
operator|+
name|size
condition|)
goto|goto
name|invalid
goto|;
name|ND_TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_param_header
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Parameter Tag */
name|hdr_tag
operator|=
name|EXTRACT_16BITS
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t\t%s: "
operator|,
name|tok2str
argument_list|(
name|ParamName
argument_list|,
literal|"Unknown Parameter (0x%04x)"
argument_list|,
name|hdr_tag
argument_list|)
operator|)
argument_list|)
expr_stmt|;
comment|/* Parameter Length */
name|hdr_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|p
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|hdr_len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_param_header
argument_list|)
condition|)
goto|goto
name|invalid
goto|;
comment|/* Parameter Value */
name|align
operator|=
operator|(
name|p
operator|+
name|hdr_len
operator|-
name|buf
operator|)
operator|%
literal|4
expr_stmt|;
name|align
operator|=
name|align
condition|?
literal|4
operator|-
name|align
else|:
literal|0
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|p
argument_list|,
name|hdr_len
operator|+
name|align
argument_list|)
expr_stmt|;
name|tag_value_print
argument_list|(
name|ndo
argument_list|,
name|p
argument_list|,
name|hdr_tag
argument_list|,
name|hdr_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_param_header
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|+=
name|hdr_len
operator|+
name|align
expr_stmt|;
block|}
return|return;
name|invalid
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|istr
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|buf
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *     0                   1                   2                   3  *     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *    |    Version    |   Reserved    | Message Class | Message Type  |  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *    |                        Message Length                         |  *    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *    \                                                               \  *    /                                                               /  */
end_comment

begin_function
name|void
name|m3ua_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|const
name|u_char
modifier|*
name|buf
parameter_list|,
specifier|const
name|u_int
name|size
parameter_list|)
block|{
specifier|const
name|struct
name|m3ua_common_header
modifier|*
name|hdr
init|=
operator|(
specifier|const
expr|struct
name|m3ua_common_header
operator|*
operator|)
name|buf
decl_stmt|;
specifier|const
name|struct
name|tok
modifier|*
name|dict
decl_stmt|;
comment|/* size includes the header */
if|if
condition|(
name|size
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_common_header
argument_list|)
condition|)
goto|goto
name|invalid
goto|;
name|ND_TCHECK
argument_list|(
operator|*
name|hdr
argument_list|)
expr_stmt|;
if|if
condition|(
name|hdr
operator|->
name|v
operator|!=
name|M3UA_REL_1_0
condition|)
return|return;
name|dict
operator|=
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_MGMT
condition|?
name|MgmtMessages
else|:
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_TRANSFER
condition|?
name|TransferMessages
else|:
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_SSNM
condition|?
name|SS7Messages
else|:
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_ASPSM
condition|?
name|ASPStateMessages
else|:
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_ASPTM
condition|?
name|ASPTrafficMessages
else|:
name|hdr
operator|->
name|msg_class
operator|==
name|M3UA_MSGC_RKM
condition|?
name|RoutingKeyMgmtMessages
else|:
name|NULL
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t%s"
operator|,
name|tok2str
argument_list|(
name|MessageClasses
argument_list|,
literal|"Unknown message class %i"
argument_list|,
name|hdr
operator|->
name|msg_class
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dict
operator|!=
name|NULL
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|" %s Message"
operator|,
name|tok2str
argument_list|(
name|dict
argument_list|,
literal|"Unknown (0x%02x)"
argument_list|,
name|hdr
operator|->
name|msg_type
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|!=
name|EXTRACT_32BITS
argument_list|(
operator|&
name|hdr
operator|->
name|len
argument_list|)
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t\t@@@@@@ Corrupted length %u of message @@@@@@"
operator|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|hdr
operator|->
name|len
argument_list|)
operator|)
argument_list|)
expr_stmt|;
else|else
name|m3ua_tags_print
argument_list|(
name|ndo
argument_list|,
name|buf
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_common_header
argument_list|)
argument_list|,
name|EXTRACT_32BITS
argument_list|(
operator|&
name|hdr
operator|->
name|len
argument_list|)
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|m3ua_common_header
argument_list|)
argument_list|)
expr_stmt|;
return|return;
name|invalid
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|istr
operator|)
argument_list|)
expr_stmt|;
name|ND_TCHECK2
argument_list|(
operator|*
name|buf
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"%s"
operator|,
name|tstr
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

