begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_empty
empty|#
end_empty

begin_comment
comment|/*  * Ttyn - a fast version of ttyn which hashes major minor device numbers  *  * Bill Joy UCB August 17, 1977  *  * This routine can be called instead of calling 'ttyn' and stats  * the specified unit, then looking in a table to determine  * the unit number.  If the given unit is not in the table the standard  * 'ttyn' is called to get the answer.  *  * Generated:	Fri Nov  4 15:08:27 1977  * No. ttys:	79  */
end_comment

begin_struct
specifier|static
struct|struct
name|T
block|{
name|char
name|Tmajor
decl_stmt|;
name|char
name|Tfirst
decl_stmt|;
name|char
modifier|*
name|Tttys
decl_stmt|;
name|char
name|Tlast
decl_stmt|;
block|}
name|Tttyinfo
index|[]
block|{
literal|0
operator|,
literal|0
operator|,
literal|"845=x_%!#0123679."
operator|,
literal|16
operator|,
literal|14
operator|,
literal|0
operator|,
literal|"ABCDEFGHIJKLxNOPQRSTUVWXYZ\024\025\026\027\030\031abcdefghijklmnopqrstuvwyz+-,\001\002\003\005"
operator|,
literal|63
operator|,
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|NMAJDEV
value|2
end_define

begin_struct
struct|struct
name|Stat
block|{
name|char
name|xminor
decl_stmt|,
name|xmajor
decl_stmt|;
name|int
name|inumber
decl_stmt|,
name|flags
decl_stmt|;
name|char
name|nlinks
decl_stmt|,
name|uid
decl_stmt|,
name|gid
decl_stmt|,
name|size0
decl_stmt|;
name|int
name|size1
decl_stmt|;
name|char
name|dminor
decl_stmt|,
name|dmajor
decl_stmt|;
name|int
name|addr1
index|[
literal|7
index|]
decl_stmt|;
name|long
name|actime
decl_stmt|,
name|modtime
decl_stmt|;
block|}
struct|;
end_struct

begin_macro
name|Ttyn
argument_list|(
argument|unit
argument_list|)
end_macro

begin_decl_stmt
name|int
name|unit
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|T
modifier|*
name|tp
decl_stmt|;
name|struct
name|Stat
name|stbuf
decl_stmt|;
if|if
condition|(
name|fstat
argument_list|(
name|unit
argument_list|,
operator|&
name|stbuf
argument_list|)
condition|)
return|return
operator|(
literal|'x'
operator|)
return|;
for|for
control|(
name|tp
operator|=
operator|&
name|Tttyinfo
init|;
name|tp
operator|<
operator|&
name|Tttyinfo
index|[
name|NMAJDEV
index|]
condition|;
name|tp
operator|++
control|)
if|if
condition|(
name|stbuf
operator|.
name|dmajor
operator|==
name|tp
operator|->
name|Tmajor
operator|&&
name|stbuf
operator|.
name|dminor
operator|>=
name|tp
operator|->
name|Tfirst
operator|&&
name|stbuf
operator|.
name|dminor
operator|<=
name|tp
operator|->
name|Tlast
condition|)
return|return
operator|(
name|tp
operator|->
name|Tttys
index|[
name|stbuf
operator|.
name|dminor
operator|-
name|tp
operator|->
name|Tfirst
index|]
operator|)
return|;
return|return
operator|(
name|ttyn
argument_list|(
name|unit
argument_list|)
operator|)
return|;
block|}
end_block

end_unit

