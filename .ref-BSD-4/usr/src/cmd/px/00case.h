begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_empty
empty|# Copyright (c) 1979 Regents of the University of California
end_empty

begin_empty
empty|#
end_empty

begin_empty
empty|# char sccsid[] = "@(#)00case.h 4.1 10/10/80";
end_empty

begin_empty
empty|#
end_empty

begin_empty
empty|# Berkeley Pascal Assembler Kernel
end_empty

begin_empty
empty|#
end_empty

begin_expr_stmt
operator|.
name|globl
name|_interpret
operator|#
name|normal
name|interpreter
name|entry
name|point
empty|#
empty|# register definitions
empty|#
empty|# registers R0 - R6 are for scratch use
empty|#
operator|.
name|set
name|lino
operator|,
name|r11
operator|.
name|set
name|lc
operator|,
name|r10
operator|.
name|set
name|dp
operator|,
name|r9
operator|.
name|set
name|loop
operator|,
name|r8
operator|.
name|set
name|buf
operator|,
name|r7
empty|#
empty|# Global constants
empty|#
operator|.
name|set
name|R2
operator|,
literal|0x004
operator|#
specifier|register
name|fields
name|in
name|call
name|mask
operator|.
name|set
name|R3
operator|,
literal|0x008
operator|.
name|set
name|R4
operator|,
literal|0x010
operator|.
name|set
name|R5
operator|,
literal|0x020
operator|.
name|set
name|R6
operator|,
literal|0x040
operator|.
name|set
name|R7
operator|,
literal|0x080
operator|.
name|set
name|R8
operator|,
literal|0x100
operator|.
name|set
name|R9
operator|,
literal|0x200
operator|.
name|set
name|R10
operator|,
literal|0x400
operator|.
name|set
name|R11
operator|,
literal|0x800
operator|.
name|set
name|SIGINT
operator|,
literal|2
operator|#
name|interrupt
name|signal
operator|.
name|set
name|SIGFPE
operator|,
literal|8
operator|#
name|arithmetic
name|exception
name|signal
operator|.
name|set
name|SIGSEGV
operator|,
literal|11
operator|#
name|segmentation
name|violation
operator|.
name|set
name|MASK
operator|,
literal|6
operator|#
name|offset
name|of
name|save
name|mask
name|in
name|call
name|stack
operator|.
name|set
name|FP
operator|,
literal|12
operator|#
name|offset
name|of
literal|"fp"
name|in
name|call
name|stack
operator|.
name|set
name|PC
operator|,
literal|16
operator|#
name|offset
name|of
literal|"pc"
name|in
name|call
name|stack
operator|.
name|set
name|REGS
operator|,
literal|20
operator|#
name|beginning
name|of
name|saved
name|registers
name|in
name|call
name|stack
operator|.
name|set
name|O_DATE
operator|,
literal|0345
operator|#
name|DATE
name|opcode
name|number
operator|.
name|set
name|O_TIME
operator|,
literal|0346
operator|#
name|TIME
name|opcode
name|number
operator|.
name|set
name|tempsize
operator|,
operator|-
literal|1024
operator|#
name|maximum
name|required
name|temporary
name|stack
name|space
empty|#
empty|# program variables
empty|#
operator|.
name|globl
name|_display
operator|#
name|runtime
name|display
operator|.
name|globl
name|_file
operator|#
name|current
name|file
name|name
operator|.
name|globl
name|_fchain
operator|#
name|head
name|of
name|active
name|file
name|chain
operator|.
name|globl
name|_llimit
operator|#
name|max
name|number
name|of
name|output
name|lines
operator|.
name|globl
name|_stcnt
operator|#
name|number
name|of
name|stmts
name|executed
operator|.
name|globl
name|_stlim
operator|#
name|max
name|number
name|of
name|stmts
name|to
name|exec
operator|.
name|globl
name|_nodump
operator|#
literal|1
operator|=
operator|>
name|no
name|postmortum
name|dump
operator|.
name|globl
name|_perrno
operator|#
name|interpreter
name|error
name|number
operator|.
name|globl
name|_profcnts
operator|#
name|PX
name|profile
name|execution
name|counts
operator|.
name|globl
name|_pxpbuf
operator|#
name|ptr
name|to
name|pxp
name|buffer
operator|.
name|globl
name|_pxpsize
operator|#
name|size
name|of
name|pxp
name|buffer
operator|.
name|globl
name|_argc
operator|#
name|number
name|of
name|passed
name|args
operator|.
name|globl
name|_argv
operator|#
name|values
name|of
name|passed
name|args
operator|.
name|globl
name|__iob
operator|#
name|base
name|of
name|I
operator|/
name|O
name|buffer
name|block
operator|.
name|globl
name|__sobuf
operator|#
name|standard
name|output
name|buffer
empty|#
empty|# system subroutines
empty|#
operator|.
name|globl
name|_signal
operator|.
name|globl
name|_time
operator|.
name|globl
name|_times
empty|#
empty|# system math routines
empty|#
operator|.
name|globl
name|_atan
operator|.
name|globl
name|_cos
operator|.
name|globl
name|_exp
operator|.
name|globl
name|_log
operator|.
name|globl
name|_sin
operator|.
name|globl
name|_sqrt
operator|.
name|globl
name|_srand
operator|.
name|globl
name|_rand
empty|#
empty|# pascal specific subroutines
empty|#
operator|.
name|globl
name|_error
operator|#
name|error
name|message
name|routine
operator|.
name|globl
name|_palloc
operator|#
name|heap
name|allocator
operator|.
name|globl
name|_pfree
operator|.
name|globl
name|_cttot
operator|#
name|set
name|constructor
operator|.
name|globl
name|_inct
operator|#
name|set
name|inclusion
operator|.
name|globl
name|_pdattim
operator|#
name|getting
name|date
operator|,
name|time
name|info
operator|.
name|globl
name|_perror
operator|#
name|process
name|pxp
name|errors
empty|#
empty|# initializing the interpreter
empty|#
name|_interpret
operator|:
operator|.
name|word
literal|0xffc
operator|#
specifier|register
name|save
name|mask
name|moval
name|iloop
operator|,
name|r8
name|tstl
literal|8
operator|(
name|ap
operator|)
operator|#
name|check
end_expr_stmt

begin_for
for|for profiling 	beql	l0050 	moval	ploop
operator|,
name|r8
operator|#
name|set
name|profiling
name|request
name|l0050
operator|:
name|callg
operator|*
literal|4
operator|(
name|ap
operator|)
operator|,
name|l0051
operator|#
name|set
name|ap
name|to
name|base
name|of
name|program
name|ret
name|l0051
operator|:
operator|.
name|word
literal|0
name|bispsw
name|$0xe0
operator|#
name|enable
name|overflow
name|traps
name|movl
name|ap
operator|,
name|r10
operator|#
name|program
name|start
name|address
name|moval
name|_display
operator|,
name|r9
name|moval
operator|-
literal|4
operator|(
name|sp
operator|)
operator|,
operator|(
name|r9
operator|)
name|pushal
name|stderr
operator|#
name|set
name|up
name|global
name|file
name|variables
name|movl
name|sp
operator|,
name|stderr
operator|+
name|FLEV
name|movl
name|_llimit
operator|,
name|stderr
operator|+
name|LLIMIT
name|calls
name|$0
operator|,
name|_unit
operator|#
name|init
name|active
name|file
name|pushal
name|stdout
name|movl
name|sp
operator|,
name|stdout
operator|+
name|FLEV
name|movl
name|_llimit
operator|,
name|stdout
operator|+
name|LLIMIT
name|pushal
name|stdin
name|movl
name|sp
operator|,
name|stdin
operator|+
name|FLEV
name|moval
name|stdin
operator|,
name|_fchain
name|jmp
argument_list|(
name|r8
argument_list|)
operator|#
name|begin
name|interpreter
empty|#
empty|# main interpreter loop
empty|# the instruction 'jmp	(loop)'
empty|# transfers here
empty|#
name|ploop
operator|:
name|movzbl
argument_list|(
name|r10
argument_list|)
operator|,
name|r0
name|incl
name|_profcnts
index|[
name|r0
index|]
name|iloop
operator|:
name|caseb
argument_list|(
name|r10
argument_list|)
operator|+
operator|,
name|$0
operator|,
name|$255
name|optab
operator|:
end_for

end_unit

