begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************************************* *                                                                  * *    File: CIFPLOT/edgepath.c                                      * *    Written by Dan Fitzpatrick                                    * *    copyright 1980 -- Regents of the University of California     * *                                                                  * ********************************************************************/
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"globals.h"
end_include

begin_include
include|#
directive|include
file|"parser_defs.h"
end_include

begin_include
include|#
directive|include
file|"structs.h"
end_include

begin_include
include|#
directive|include
file|"out_structs.h"
end_include

begin_include
include|#
directive|include
file|"alloc.h"
end_include

begin_decl_stmt
specifier|static
name|int
name|xstart
decl_stmt|,
name|ystart
decl_stmt|,
name|xlast
decl_stmt|,
name|ylast
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|PolyDesc
modifier|*
name|poly
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|transform
modifier|*
name|trans
decl_stmt|;
end_decl_stmt

begin_macro
name|StartEdgePath
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|itrans
argument_list|,
argument|ipoly
argument_list|)
end_macro

begin_decl_stmt
name|real
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|transform
modifier|*
name|itrans
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|PolyDesc
modifier|*
name|ipoly
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|poly
operator|=
name|ipoly
expr_stmt|;
name|trans
operator|=
name|itrans
expr_stmt|;
name|Trans
argument_list|(
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|trans
argument_list|)
expr_stmt|;
name|xstart
operator|=
name|xlast
operator|=
name|CONVERT
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|ystart
operator|=
name|ylast
operator|=
name|CONVERT
argument_list|(
name|y
argument_list|)
expr_stmt|;
return|return;
block|}
end_block

begin_function
name|iedge
modifier|*
name|NextEdgePath
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
name|real
name|x
decl_stmt|,
name|y
decl_stmt|;
block|{
name|iedge
modifier|*
name|e
decl_stmt|;
name|int
name|t
decl_stmt|;
name|int
name|ix1
decl_stmt|,
name|ix2
decl_stmt|,
name|iy1
decl_stmt|,
name|iy2
decl_stmt|;
name|Trans
argument_list|(
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|trans
argument_list|)
expr_stmt|;
name|ix1
operator|=
name|ix2
operator|=
name|CONVERT
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|iy1
operator|=
name|iy2
operator|=
name|CONVERT
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|e
operator|=
name|GetIEdge
argument_list|()
expr_stmt|;
name|e
operator|->
name|type
operator|=
name|EDGE
expr_stmt|;
name|e
operator|->
name|poly
operator|=
name|poly
expr_stmt|;
operator|(
name|poly
operator|->
name|refs
operator|)
operator|++
expr_stmt|;
if|if
condition|(
name|xlast
operator|<=
name|ix1
condition|)
name|e
operator|->
name|dir
operator|=
literal|1
expr_stmt|;
else|else
block|{
name|e
operator|->
name|dir
operator|=
operator|-
literal|1
expr_stmt|;
name|SWAP
argument_list|(
name|xlast
argument_list|,
name|ix1
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|ylast
argument_list|,
name|iy1
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
comment|/* xlast<= x */
name|e
operator|->
name|min
operator|=
name|e
operator|->
name|x1
operator|=
name|xlast
expr_stmt|;
name|e
operator|->
name|y1
operator|=
name|ylast
expr_stmt|;
name|e
operator|->
name|x2
operator|=
name|ix1
expr_stmt|;
name|e
operator|->
name|y2
operator|=
name|iy1
expr_stmt|;
name|xlast
operator|=
name|ix2
expr_stmt|;
name|ylast
operator|=
name|iy2
expr_stmt|;
return|return
operator|(
name|e
operator|)
return|;
block|}
end_function

begin_function
name|iedge
modifier|*
name|EndEdgePath
parameter_list|()
block|{
name|iedge
modifier|*
name|e
decl_stmt|;
name|int
name|t
decl_stmt|;
name|e
operator|=
name|GetIEdge
argument_list|()
expr_stmt|;
name|e
operator|->
name|type
operator|=
name|EDGE
expr_stmt|;
name|e
operator|->
name|poly
operator|=
name|poly
expr_stmt|;
operator|(
name|poly
operator|->
name|refs
operator|)
operator|++
expr_stmt|;
if|if
condition|(
name|xlast
operator|<=
name|xstart
condition|)
name|e
operator|->
name|dir
operator|=
literal|1
expr_stmt|;
else|else
block|{
name|e
operator|->
name|dir
operator|=
operator|-
literal|1
expr_stmt|;
name|SWAP
argument_list|(
name|xlast
argument_list|,
name|xstart
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|ylast
argument_list|,
name|ystart
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
name|e
operator|->
name|min
operator|=
name|e
operator|->
name|x1
operator|=
name|xlast
expr_stmt|;
name|e
operator|->
name|y1
operator|=
name|ylast
expr_stmt|;
name|e
operator|->
name|x2
operator|=
name|xstart
expr_stmt|;
name|e
operator|->
name|y2
operator|=
name|ystart
expr_stmt|;
return|return
operator|(
name|e
operator|)
return|;
block|}
end_function

end_unit

