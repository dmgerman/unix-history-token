begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2011,2012 Kai Wang  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|"ld.h"
end_include

begin_include
include|#
directive|include
file|"ld_arch.h"
end_include

begin_include
include|#
directive|include
file|"ld_script.h"
end_include

begin_include
include|#
directive|include
file|"ld_exp.h"
end_include

begin_include
include|#
directive|include
file|"ld_layout.h"
end_include

begin_expr_stmt
name|ELFTC_VCSID
argument_list|(
literal|"$Id: ld_exp.c 3278 2015-12-11 21:39:13Z kaiwang27 $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*  * Support routines for ldscript expression.  */
end_comment

begin_function_decl
specifier|static
name|struct
name|ld_exp
modifier|*
name|_alloc_exp
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_assignment
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_addr
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_align
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_alignof
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_data_segment_align
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_data_segment_end
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_data_segment_relro_end
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_defined
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_length
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_loadaddr
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_max
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_min
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_next
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_origin
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_segment_start
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_sizeof
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_func_sizeof_headers
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_symbol_val
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|char
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int64_t
name|_symbolic_constant
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|_EXP_EVAL
parameter_list|(
name|x
parameter_list|)
value|ld_exp_eval(ld, (x))
end_define

begin_define
define|#
directive|define
name|_EXP_DUMP
parameter_list|(
name|x
parameter_list|)
value|ld_exp_dump(ld, (x))
end_define

begin_function
name|void
name|ld_exp_free
parameter_list|(
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
if|if
condition|(
name|le
operator|==
name|NULL
condition|)
return|return;
name|ld_exp_free
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|ld_exp_free
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|ld_exp_free
argument_list|(
name|le
operator|->
name|le_e3
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_assign
operator|!=
name|NULL
condition|)
name|ld_script_assign_free
argument_list|(
name|le
operator|->
name|le_assign
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_name
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|le
operator|->
name|le_name
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|le
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_unary
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|enum
name|ld_exp_op
name|op
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e1
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|op
expr_stmt|;
name|le
operator|->
name|le_e1
operator|=
name|e1
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_binary
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|enum
name|ld_exp_op
name|op
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e1
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e2
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|op
expr_stmt|;
name|le
operator|->
name|le_e1
operator|=
name|e1
expr_stmt|;
name|le
operator|->
name|le_e2
operator|=
name|e2
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_trinary
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e1
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e2
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|e3
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_TRINARY
expr_stmt|;
name|le
operator|->
name|le_e1
operator|=
name|e1
expr_stmt|;
name|le
operator|->
name|le_e2
operator|=
name|e2
expr_stmt|;
name|le
operator|->
name|le_e3
operator|=
name|e3
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_sizeof_headers
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_SIZEOF_HEADERS
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_constant
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|int64_t
name|val
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_CONSTANT
expr_stmt|;
name|le
operator|->
name|le_val
operator|=
name|val
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_symbolic_constant
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_SYMBOLIC_CONSTANT
expr_stmt|;
name|le
operator|->
name|le_name
operator|=
name|strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_name
operator|==
name|NULL
condition|)
name|ld_fatal_std
argument_list|(
name|ld
argument_list|,
literal|"calloc"
argument_list|)
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_symbol
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_SYMBOL
expr_stmt|;
name|le
operator|->
name|le_name
operator|=
name|strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_name
operator|==
name|NULL
condition|)
name|ld_fatal_std
argument_list|(
name|ld
argument_list|,
literal|"calloc"
argument_list|)
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_name
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_SECTION_NAME
expr_stmt|;
name|le
operator|->
name|le_name
operator|=
name|strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_name
operator|==
name|NULL
condition|)
name|ld_fatal_std
argument_list|(
name|ld
argument_list|,
literal|"calloc"
argument_list|)
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|ld_exp
modifier|*
name|ld_exp_assign
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_script_assign
modifier|*
name|assign
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
name|le
operator|=
name|_alloc_exp
argument_list|(
name|ld
argument_list|)
expr_stmt|;
name|le
operator|->
name|le_op
operator|=
name|LEOP_ASSIGN
expr_stmt|;
name|le
operator|->
name|le_assign
operator|=
name|assign
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
name|int64_t
name|ld_exp_eval
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|assert
argument_list|(
name|le
operator|!=
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|le
operator|->
name|le_op
condition|)
block|{
case|case
name|LEOP_ABS
case|:
return|return
operator|(
name|llabs
argument_list|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEOP_ADD
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|+
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_ADDR
case|:
return|return
operator|(
name|_func_addr
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_ALIGN
case|:
case|case
name|LEOP_BLOCK
case|:
return|return
operator|(
name|_func_align
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_ALIGNOF
case|:
return|return
operator|(
name|_func_alignof
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_AND
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|&
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_ASSIGN
case|:
return|return
operator|(
name|_assignment
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_CONSTANT
case|:
return|return
operator|(
name|le
operator|->
name|le_val
operator|)
return|;
case|case
name|LEOP_DIV
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|/
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_DSA
case|:
return|return
operator|(
name|_func_data_segment_align
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_DSE
case|:
return|return
operator|(
name|_func_data_segment_end
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_DSRE
case|:
return|return
operator|(
name|_func_data_segment_relro_end
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_DEFINED
case|:
return|return
operator|(
name|_func_defined
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_EQUAL
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|==
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_GE
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|>=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_GREATER
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|>
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_LENGTH
case|:
return|return
operator|(
name|_func_length
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_LOADADDR
case|:
return|return
operator|(
name|_func_loadaddr
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_LOGICAL_AND
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|&&
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_LOGICAL_OR
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|||
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_LSHIFT
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|<<
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_MAX
case|:
return|return
operator|(
name|_func_max
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_MIN
case|:
return|return
operator|(
name|_func_min
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_MINUS
case|:
return|return
operator|(
operator|-
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|)
operator|)
return|;
case|case
name|LEOP_MOD
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|%
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_MUL
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|*
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_NE
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|!=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_NEGATION
case|:
return|return
operator|(
operator|~
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|)
operator|)
return|;
case|case
name|LEOP_NEXT
case|:
return|return
operator|(
name|_func_next
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_NOT
case|:
return|return
operator|(
operator|!
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|)
operator|)
return|;
case|case
name|LEOP_OR
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator||
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_ORIGIN
case|:
return|return
operator|(
name|_func_origin
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_RSHIFT
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|>>
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_SEGMENT_START
case|:
return|return
operator|(
name|_func_segment_start
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_SIZEOF
case|:
return|return
operator|(
name|_func_sizeof
argument_list|(
name|ld
argument_list|,
name|le
argument_list|)
operator|)
return|;
case|case
name|LEOP_SIZEOF_HEADERS
case|:
return|return
operator|(
name|_func_sizeof_headers
argument_list|(
name|ld
argument_list|)
operator|)
return|;
case|case
name|LEOP_SUBSTRACT
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|-
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
operator|)
return|;
case|case
name|LEOP_SYMBOL
case|:
return|return
operator|(
name|_symbol_val
argument_list|(
name|ld
argument_list|,
name|le
operator|->
name|le_name
argument_list|)
operator|)
return|;
case|case
name|LEOP_SYMBOLIC_CONSTANT
case|:
return|return
operator|(
name|_symbolic_constant
argument_list|(
name|ld
argument_list|,
name|le
operator|->
name|le_name
argument_list|)
operator|)
return|;
case|case
name|LEOP_TRINARY
case|:
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
condition|?
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
else|:
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e3
argument_list|)
operator|)
return|;
default|default:
name|ld_fatal
argument_list|(
name|ld
argument_list|,
literal|"internal: unknown ldscript expression op"
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|ld_exp_dump
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|assert
argument_list|(
name|le
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_par
condition|)
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|le
operator|->
name|le_op
condition|)
block|{
case|case
name|LEOP_ABS
case|:
name|printf
argument_list|(
literal|"ABS("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ADD
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" + "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ADDR
case|:
name|printf
argument_list|(
literal|"ADDR("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ALIGN
case|:
case|case
name|LEOP_BLOCK
case|:
name|printf
argument_list|(
literal|"ALIGN("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_e2
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ALIGNOF
case|:
name|printf
argument_list|(
literal|"ALIGNOF("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_AND
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"& "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ASSIGN
case|:
name|printf
argument_list|(
literal|"0x%jx"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|le
operator|->
name|le_assign
operator|->
name|lda_res
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_CONSTANT
case|:
name|printf
argument_list|(
literal|"0x%jx"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|le
operator|->
name|le_val
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_DIV
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" / "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_DSA
case|:
name|printf
argument_list|(
literal|"DATA_SEGMENT_ALIGN("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_DSE
case|:
name|printf
argument_list|(
literal|"DATA_SEGMENT_END("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_DSRE
case|:
name|printf
argument_list|(
literal|"DATA_SEGMENT_RELRO_END("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_DEFINED
case|:
name|printf
argument_list|(
literal|"DEFINED("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_EQUAL
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" == "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_GE
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">= "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_GREATER
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"> "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_LENGTH
case|:
name|printf
argument_list|(
literal|"LENGTH("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_LOADADDR
case|:
name|printf
argument_list|(
literal|"LOADADDR("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_LOGICAL_AND
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"&& "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_LOGICAL_OR
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" || "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_LSHIFT
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<< "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_MAX
case|:
name|printf
argument_list|(
literal|"MAX("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_MIN
case|:
name|printf
argument_list|(
literal|"MIN("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_MINUS
case|:
name|printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_MOD
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %% "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_MUL
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" * "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_NE
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" != "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_NEGATION
case|:
name|printf
argument_list|(
literal|"~"
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_NEXT
case|:
name|printf
argument_list|(
literal|"NEXT("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_NOT
case|:
name|printf
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_OR
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" | "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_ORIGIN
case|:
name|printf
argument_list|(
literal|"ORIGIN("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_RSHIFT
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|">> "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SEGMENT_START
case|:
name|printf
argument_list|(
literal|"SEGMENT_START("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SIZEOF
case|:
name|printf
argument_list|(
literal|"SIZEOF("
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SIZEOF_HEADERS
case|:
name|printf
argument_list|(
literal|"SIZEOF_HEADERS"
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SUBSTRACT
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" - "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SYMBOL
case|:
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|le
operator|->
name|le_name
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_SYMBOLIC_CONSTANT
case|:
name|printf
argument_list|(
literal|"0x%jx"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|_symbolic_constant
argument_list|(
name|ld
argument_list|,
name|le
operator|->
name|le_name
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEOP_TRINARY
case|:
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ? "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" : "
argument_list|)
expr_stmt|;
name|_EXP_DUMP
argument_list|(
name|le
operator|->
name|le_e3
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ld_fatal
argument_list|(
name|ld
argument_list|,
literal|"internal: unknown ldscript expression op"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|le
operator|->
name|le_par
condition|)
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ld_exp
modifier|*
name|_alloc_exp
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|le
decl_stmt|;
if|if
condition|(
operator|(
name|le
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|le
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|ld_fatal_std
argument_list|(
name|ld
argument_list|,
literal|"calloc"
argument_list|)
expr_stmt|;
return|return
operator|(
name|le
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_assignment
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|struct
name|ld_exp
modifier|*
name|var
decl_stmt|;
name|assert
argument_list|(
name|le
operator|->
name|le_assign
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ld_script_process_assign
argument_list|(
name|ld
argument_list|,
name|le
operator|->
name|le_assign
argument_list|)
expr_stmt|;
name|var
operator|=
name|le
operator|->
name|le_assign
operator|->
name|lda_var
expr_stmt|;
return|return
operator|(
name|ld_script_variable_value
argument_list|(
name|ld
argument_list|,
name|var
operator|->
name|le_name
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_addr
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_align
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|struct
name|ld_state
modifier|*
name|ls
decl_stmt|;
name|ls
operator|=
operator|&
name|ld
operator|->
name|ld_state
expr_stmt|;
if|if
condition|(
name|le
operator|->
name|le_e2
operator|!=
name|NULL
condition|)
return|return
operator|(
name|roundup
argument_list|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
argument_list|,
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
argument_list|)
operator|)
return|;
else|else
return|return
operator|(
name|roundup
argument_list|(
name|ls
operator|->
name|ls_loc_counter
argument_list|,
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_alignof
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_data_segment_align
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|struct
name|ld_state
modifier|*
name|ls
decl_stmt|;
name|uint64_t
name|maxpagesize
decl_stmt|;
comment|/* uint64_t commonpagesize; */
comment|/* 	 * TODO: test if align to common page size use less number 	 * of pages. 	 */
name|ls
operator|=
operator|&
name|ld
operator|->
name|ld_state
expr_stmt|;
name|maxpagesize
operator|=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
comment|/* commonpagesize = _EXP_EVAL(le->le_e2); */
return|return
operator|(
name|roundup
argument_list|(
name|ls
operator|->
name|ls_loc_counter
argument_list|,
name|maxpagesize
argument_list|)
operator|+
operator|(
name|ls
operator|->
name|ls_loc_counter
operator|&
operator|(
name|maxpagesize
operator|-
literal|1
operator|)
operator|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_data_segment_end
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
return|return
operator|(
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_data_segment_relro_end
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_defined
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_length
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_loadaddr
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_max
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|uint64_t
name|val1
decl_stmt|,
name|val2
decl_stmt|;
name|val1
operator|=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|val2
operator|=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
return|return
operator|(
name|val1
operator|>
name|val2
condition|?
name|val1
else|:
name|val2
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_min
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
name|uint64_t
name|val1
decl_stmt|,
name|val2
decl_stmt|;
name|val1
operator|=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e1
argument_list|)
expr_stmt|;
name|val2
operator|=
name|_EXP_EVAL
argument_list|(
name|le
operator|->
name|le_e2
argument_list|)
expr_stmt|;
return|return
operator|(
name|val1
operator|>
name|val2
condition|?
name|val2
else|:
name|val1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_next
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_origin
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_segment_start
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_sizeof
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|struct
name|ld_exp
modifier|*
name|le
parameter_list|)
block|{
comment|/* TODO */
operator|(
name|void
operator|)
name|ld
expr_stmt|;
operator|(
name|void
operator|)
name|le
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_func_sizeof_headers
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|)
block|{
return|return
operator|(
name|ld_layout_calc_header_size
argument_list|(
name|ld
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_symbol_val
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
name|char
modifier|*
name|name
parameter_list|)
block|{
return|return
operator|(
name|ld_script_variable_value
argument_list|(
name|ld
argument_list|,
name|name
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int64_t
name|_symbolic_constant
parameter_list|(
name|struct
name|ld
modifier|*
name|ld
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
if|if
condition|(
name|ld
operator|->
name|ld_arch
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"COMMONPAGESIZE"
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|ld
operator|->
name|ld_arch
operator|->
name|get_common_page_size
argument_list|(
name|ld
argument_list|)
operator|)
return|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"MAXPAGESIZE"
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|ld
operator|->
name|ld_arch
operator|->
name|get_max_page_size
argument_list|(
name|ld
argument_list|)
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

