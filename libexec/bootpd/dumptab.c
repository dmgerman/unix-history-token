begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * dumptab.c - handles dumping the database  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_comment
comment|/* inet_ntoa */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|USE_BFUNCS
end_ifndef

begin_include
include|#
directive|include
file|<memory.h>
end_include

begin_comment
comment|/* Yes, memcpy is OK here (no overlapped copies). */
end_comment

begin_define
define|#
directive|define
name|bcopy
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|memcpy(b,a,c)
end_define

begin_define
define|#
directive|define
name|bzero
parameter_list|(
name|p
parameter_list|,
name|l
parameter_list|)
value|memset(p,0,l)
end_define

begin_define
define|#
directive|define
name|bcmp
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|memcmp(a,b,c)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"bootp.h"
end_include

begin_include
include|#
directive|include
file|"hash.h"
end_include

begin_include
include|#
directive|include
file|"hwaddr.h"
end_include

begin_include
include|#
directive|include
file|"report.h"
end_include

begin_include
include|#
directive|include
file|"patchlevel.h"
end_include

begin_include
include|#
directive|include
file|"bootpd.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__STDC__
end_ifdef

begin_define
define|#
directive|define
name|P
parameter_list|(
name|args
parameter_list|)
value|args
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|P
parameter_list|(
name|args
parameter_list|)
value|()
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|void
name|dump_generic
name|P
argument_list|(
operator|(
name|FILE
operator|*
operator|,
expr|struct
name|shared_bindata
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|dump_host
name|P
argument_list|(
operator|(
name|FILE
operator|*
operator|,
expr|struct
name|host
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|list_ipaddresses
name|P
argument_list|(
operator|(
name|FILE
operator|*
operator|,
expr|struct
name|in_addr_list
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|P
end_undef

begin_ifndef
ifndef|#
directive|ifndef
name|DEBUG
end_ifndef

begin_function
name|void
name|dumptab
parameter_list|(
name|filename
parameter_list|)
name|char
modifier|*
name|filename
decl_stmt|;
block|{
name|report
argument_list|(
name|LOG_INFO
argument_list|,
literal|"No dumptab support!"
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* DEBUG */
end_comment

begin_comment
comment|/*  * Dump the internal memory database to bootpd_dump.  */
end_comment

begin_function
name|void
name|dumptab
parameter_list|(
name|filename
parameter_list|)
name|char
modifier|*
name|filename
decl_stmt|;
block|{
name|int
name|n
decl_stmt|;
name|struct
name|host
modifier|*
name|hp
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|time_t
name|t
decl_stmt|;
comment|/* Print symbols in alphabetical order for reader's convenience. */
specifier|static
name|char
name|legend
index|[]
init|=
literal|"#\n# Legend:\t(see bootptab.5)\n\ #\tfirst field -- hostname (not indented)\n\ #\tbf -- bootfile\n\ #\tbs -- bootfile size in 512-octet blocks\n\ #\tcs -- cookie servers\n\ #\tdf -- dump file name\n\ #\tdn -- domain name\n\ #\tds -- domain name servers\n\ #\tef -- extension file\n\ #\tex -- exec file (YORK_EX_OPTION)\n\ #\tgw -- gateways\n\ #\tha -- hardware address\n\ #\thd -- home directory for bootfiles\n\ #\thn -- host name set for client\n\ #\tht -- hardware type\n\ #\tim -- impress servers\n\ #\tip -- host IP address\n\ #\tlg -- log servers\n\ #\tlp -- LPR servers\n\ #\tms -- message size\n\ #\tmw -- min wait (secs)\n\ #\tns -- IEN-116 name servers\n\ #\tnt -- NTP servers (RFC 1129)\n\ #\tra -- reply address override\n\ #\trl -- resource location protocol servers\n\ #\trp -- root path\n\ #\tsa -- boot server address\n\ #\tsm -- subnet mask\n\ #\tsw -- swap server\n\ #\ttc -- template host (points to similar host entry)\n\ #\ttd -- TFTP directory\n\ #\tto -- time offset (seconds)\n\ #\tts -- time servers\n\ #\tvm -- vendor magic number\n\ #\tyd -- YP (NIS) domain\n\ #\tys -- YP (NIS) servers\n\ #\tTn -- generic option tag n\n\ \n"
decl_stmt|;
comment|/* 	 * Open bootpd.dump file. 	 */
if|if
condition|(
operator|(
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|report
argument_list|(
name|LOG_ERR
argument_list|,
literal|"error opening \"%s\": %s"
argument_list|,
name|filename
argument_list|,
name|get_errmsg
argument_list|()
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|t
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n# %s %s.%d\n"
argument_list|,
name|progname
argument_list|,
name|VERSION
argument_list|,
name|PATCHLEVEL
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"# %s: dump of bootp server database.\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"# Dump taken %s"
argument_list|,
name|ctime
argument_list|(
operator|&
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|fwrite
argument_list|(
name|legend
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|legend
argument_list|)
operator|-
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|hp
operator|=
operator|(
expr|struct
name|host
operator|*
operator|)
name|hash_FirstEntry
argument_list|(
name|nmhashtable
argument_list|)
init|;
name|hp
operator|!=
name|NULL
condition|;
name|hp
operator|=
operator|(
expr|struct
name|host
operator|*
operator|)
name|hash_NextEntry
argument_list|(
name|nmhashtable
argument_list|)
control|)
block|{
name|dump_host
argument_list|(
name|fp
argument_list|,
name|hp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|report
argument_list|(
name|LOG_INFO
argument_list|,
literal|"dumped %d entries to \"%s\"."
argument_list|,
name|n
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/*  * Dump all the available information on the host pointed to by "hp".  * The output is sent to the file pointed to by "fp".  */
end_comment

begin_function
specifier|static
name|void
name|dump_host
parameter_list|(
name|fp
parameter_list|,
name|hp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|struct
name|host
modifier|*
name|hp
decl_stmt|;
block|{
comment|/* Print symbols in alphabetical order for reader's convenience. */
if|if
condition|(
name|hp
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s:"
argument_list|,
operator|(
name|hp
operator|->
name|hostname
condition|?
name|hp
operator|->
name|hostname
operator|->
name|string
else|:
literal|"?"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|bootfile
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:bf=%s:"
argument_list|,
name|hp
operator|->
name|bootfile
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|bootsize
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:bs="
argument_list|)
expr_stmt|;
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|bootsize_auto
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"auto:"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%lu:"
argument_list|,
operator|(
name|u_long
operator|)
name|hp
operator|->
name|bootsize
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|cookie_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:cs="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|cookie_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|dump_file
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:df=%s:"
argument_list|,
name|hp
operator|->
name|dump_file
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|domain_name
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:dn=%s:"
argument_list|,
name|hp
operator|->
name|domain_name
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|domain_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ds="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|domain_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|exten_file
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ef=%s:"
argument_list|,
name|hp
operator|->
name|exten_file
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|exec_file
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ex=%s:"
argument_list|,
name|hp
operator|->
name|exec_file
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|gateway
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:gw="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|gateway
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
comment|/* FdC: swap_server (see below) */
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|homedir
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:hd=%s:"
argument_list|,
name|hp
operator|->
name|homedir
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
comment|/* FdC: dump_file (see above) */
comment|/* FdC: domain_name (see above) */
comment|/* FdC: root_path (see below) */
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|name_switch
operator|&&
name|hp
operator|->
name|flags
operator|.
name|send_name
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:hn:"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|htype
condition|)
block|{
name|int
name|hlen
init|=
name|haddrlength
argument_list|(
name|hp
operator|->
name|htype
argument_list|)
decl_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ht=%u:"
argument_list|,
operator|(
name|unsigned
operator|)
name|hp
operator|->
name|htype
argument_list|)
expr_stmt|;
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|haddr
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"ha=\"%s\":"
argument_list|,
name|haddrtoa
argument_list|(
name|hp
operator|->
name|haddr
argument_list|,
name|hlen
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|impress_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:im="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|impress_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
comment|/* NetBSD: swap_server (see below) */
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|iaddr
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ip=%s:"
argument_list|,
name|inet_ntoa
argument_list|(
name|hp
operator|->
name|iaddr
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|log_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:lg="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|log_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|lpr_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:lp="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|lpr_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|msg_size
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ms=%lu:"
argument_list|,
operator|(
name|u_long
operator|)
name|hp
operator|->
name|msg_size
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|min_wait
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:mw=%lu:"
argument_list|,
operator|(
name|u_long
operator|)
name|hp
operator|->
name|min_wait
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|name_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ns="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|name_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|ntp_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:nt="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|ntp_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|reply_addr
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ra=%s:"
argument_list|,
name|inet_ntoa
argument_list|(
name|hp
operator|->
name|reply_addr
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|rlp_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:rl="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|rlp_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|root_path
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:rp=%s:"
argument_list|,
name|hp
operator|->
name|root_path
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|bootserver
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:sa=%s:"
argument_list|,
name|inet_ntoa
argument_list|(
name|hp
operator|->
name|bootserver
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|subnet_mask
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:sm=%s:"
argument_list|,
name|inet_ntoa
argument_list|(
name|hp
operator|->
name|subnet_mask
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|swap_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:sw=%s:"
argument_list|,
name|inet_ntoa
argument_list|(
name|hp
operator|->
name|subnet_mask
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|tftpdir
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:td=%s:"
argument_list|,
name|hp
operator|->
name|tftpdir
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
comment|/* NetBSD: rootpath (see above) */
comment|/* NetBSD: domainname (see above) */
comment|/* NetBSD: dumpfile (see above) */
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|time_offset
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:to=%ld:"
argument_list|,
name|hp
operator|->
name|time_offset
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|time_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ts="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|time_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|vm_cookie
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:vm="
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bcmp
argument_list|(
name|hp
operator|->
name|vm_cookie
argument_list|,
name|vm_rfc1048
argument_list|,
literal|4
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"rfc1048:"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|bcmp
argument_list|(
name|hp
operator|->
name|vm_cookie
argument_list|,
name|vm_cmu
argument_list|,
literal|4
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"cmu:"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d.%d.%d.%d:"
argument_list|,
call|(
name|int
call|)
argument_list|(
operator|(
name|hp
operator|->
name|vm_cookie
operator|)
index|[
literal|0
index|]
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
operator|(
name|hp
operator|->
name|vm_cookie
operator|)
index|[
literal|1
index|]
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
operator|(
name|hp
operator|->
name|vm_cookie
operator|)
index|[
literal|2
index|]
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
operator|(
name|hp
operator|->
name|vm_cookie
operator|)
index|[
literal|3
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|nis_domain
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:yd=%s:"
argument_list|,
name|hp
operator|->
name|nis_domain
operator|->
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|nis_server
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:ys="
argument_list|)
expr_stmt|;
name|list_ipaddresses
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|nis_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
comment|/* 		 * XXX - Add new tags here (or above, 		 * so they print in alphabetical order). 		 */
if|if
condition|(
name|hp
operator|->
name|flags
operator|.
name|generic
condition|)
block|{
name|dump_generic
argument_list|(
name|fp
argument_list|,
name|hp
operator|->
name|generic
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_escape
end_escape

begin_function
specifier|static
name|void
name|dump_generic
parameter_list|(
name|fp
parameter_list|,
name|generic
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|struct
name|shared_bindata
modifier|*
name|generic
decl_stmt|;
block|{
name|u_char
modifier|*
name|bp
init|=
name|generic
operator|->
name|data
decl_stmt|;
name|u_char
modifier|*
name|ep
init|=
name|bp
operator|+
name|generic
operator|->
name|length
decl_stmt|;
name|u_char
name|tag
decl_stmt|;
name|int
name|len
decl_stmt|;
while|while
condition|(
name|bp
operator|<
name|ep
condition|)
block|{
name|tag
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
if|if
condition|(
name|tag
operator|==
name|TAG_PAD
condition|)
continue|continue;
if|if
condition|(
name|tag
operator|==
name|TAG_END
condition|)
return|return;
name|len
operator|=
operator|*
name|bp
operator|++
expr_stmt|;
if|if
condition|(
name|bp
operator|+
name|len
operator|>
name|ep
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|" #junk in generic! :"
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\\\n\t:T%d="
argument_list|,
name|tag
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%02X"
argument_list|,
operator|*
name|bp
argument_list|)
expr_stmt|;
name|bp
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
if|if
condition|(
name|len
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/*  * Dump an entire struct in_addr_list of IP addresses to the indicated file.  *  * The addresses are printed in standard ASCII "dot" notation and separated  * from one another by a single space.  A single leading space is also  * printed before the first adddress.  *  * Null lists produce no output (and no error).  */
end_comment

begin_function
specifier|static
name|void
name|list_ipaddresses
parameter_list|(
name|fp
parameter_list|,
name|ipptr
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|struct
name|in_addr_list
modifier|*
name|ipptr
decl_stmt|;
block|{
name|unsigned
name|count
decl_stmt|;
name|struct
name|in_addr
modifier|*
name|addrptr
decl_stmt|;
if|if
condition|(
name|ipptr
condition|)
block|{
name|count
operator|=
name|ipptr
operator|->
name|addrcount
expr_stmt|;
name|addrptr
operator|=
name|ipptr
operator|->
name|addr
expr_stmt|;
while|while
condition|(
name|count
operator|>
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|inet_ntoa
argument_list|(
operator|*
name|addrptr
operator|++
argument_list|)
argument_list|)
expr_stmt|;
name|count
operator|--
expr_stmt|;
if|if
condition|(
name|count
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG */
end_comment

begin_comment
comment|/*  * Local Variables:  * tab-width: 4  * c-indent-level: 4  * c-argdecl-indent: 4  * c-continued-statement-offset: 4  * c-continued-brace-offset: -4  * c-label-offset: -4  * c-brace-offset: 0  * End:  */
end_comment

end_unit

