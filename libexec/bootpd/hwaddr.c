begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * hwaddr.c - routines that deal with hardware addresses.  * (i.e. Ethernet)  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|SUNOS
argument_list|)
operator|||
name|defined
argument_list|(
name|SVR4
argument_list|)
end_if

begin_include
include|#
directive|include
file|<sys/sockio.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|SVR4
end_ifdef

begin_include
include|#
directive|include
file|<sys/stream.h>
end_include

begin_include
include|#
directive|include
file|<stropts.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|_AIX32
end_ifdef

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_comment
comment|/* for struct timeval in net/if.h */
end_comment

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_comment
comment|/* for struct ifnet in net/if_arp.h */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<net/if_arp.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|WIN_TCP
end_ifdef

begin_include
include|#
directive|include
file|<netinet/if_ether.h>
end_include

begin_include
include|#
directive|include
file|<sys/dlpi.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|NO_UNISTD
end_ifndef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|USE_BFUNCS
end_ifndef

begin_comment
comment|/* Yes, memcpy is OK here (no overlapped copies). */
end_comment

begin_include
include|#
directive|include
file|<memory.h>
end_include

begin_define
define|#
directive|define
name|bcopy
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|memcpy(b,a,c)
end_define

begin_define
define|#
directive|define
name|bzero
parameter_list|(
name|p
parameter_list|,
name|l
parameter_list|)
value|memset(p,0,l)
end_define

begin_define
define|#
directive|define
name|bcmp
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|)
value|memcmp(a,b,c)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ATF_INUSE
end_ifndef

begin_comment
comment|/* Not defined on some systems (i.e. Linux) */
end_comment

begin_define
define|#
directive|define
name|ATF_INUSE
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"bptypes.h"
end_include

begin_include
include|#
directive|include
file|"hwaddr.h"
end_include

begin_include
include|#
directive|include
file|"report.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|debug
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Hardware address lengths (in bytes) and network name based on hardware  * type code.  List in order specified by Assigned Numbers RFC; Array index  * is hardware type code.  Entries marked as zero are unknown to the author  * at this time.  .  .  .  */
end_comment

begin_decl_stmt
name|struct
name|hwinfo
name|hwinfolist
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Reserved"
block|}
block|,
comment|/* Type 0:  Reserved (don't use this)   */
block|{
literal|6
block|,
literal|"Ethernet"
block|}
block|,
comment|/* Type 1:  10Mb Ethernet (48 bits)	*/
block|{
literal|1
block|,
literal|"3Mb Ethernet"
block|}
block|,
comment|/* Type 2:   3Mb Ethernet (8 bits)	*/
block|{
literal|0
block|,
literal|"AX.25"
block|}
block|,
comment|/* Type 3:  Amateur Radio AX.25		*/
block|{
literal|1
block|,
literal|"ProNET"
block|}
block|,
comment|/* Type 4:  Proteon ProNET Token Ring   */
block|{
literal|0
block|,
literal|"Chaos"
block|}
block|,
comment|/* Type 5:  Chaos			*/
block|{
literal|6
block|,
literal|"IEEE 802"
block|}
block|,
comment|/* Type 6:  IEEE 802 Networks		*/
block|{
literal|0
block|,
literal|"ARCNET"
block|}
comment|/* Type 7:  ARCNET			*/
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|hwinfocnt
init|=
sizeof|sizeof
argument_list|(
name|hwinfolist
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|hwinfolist
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Setup the arp cache so that IP address 'ia' will be temporarily  * bound to hardware address 'ha' of length 'len'.  */
end_comment

begin_function
name|void
name|setarp
parameter_list|(
name|s
parameter_list|,
name|ia
parameter_list|,
name|hafamily
parameter_list|,
name|haddr
parameter_list|,
name|halen
parameter_list|)
name|int
name|s
decl_stmt|;
comment|/* socket fd */
name|struct
name|in_addr
modifier|*
name|ia
decl_stmt|;
comment|/* protocol address */
name|int
name|hafamily
decl_stmt|;
comment|/* HW address family */
name|u_char
modifier|*
name|haddr
decl_stmt|;
comment|/* HW address data */
name|int
name|halen
decl_stmt|;
block|{
ifdef|#
directive|ifdef
name|SIOCSARP
ifdef|#
directive|ifdef
name|WIN_TCP
comment|/* This is an SVR4 with different networking code from 	 * Wollongong WIN-TCP.  Not quite like the Lachman code. 	 * Code from: drew@drewsun.FEITH.COM (Andrew B. Sudell) 	 */
undef|#
directive|undef
name|SIOCSARP
define|#
directive|define
name|SIOCSARP
value|ARP_ADD
name|struct
name|arptab
name|arpreq
decl_stmt|;
comment|/* Arp table entry */
name|bzero
argument_list|(
operator|(
name|caddr_t
operator|)
operator|&
name|arpreq
argument_list|,
sizeof|sizeof
argument_list|(
name|arpreq
argument_list|)
argument_list|)
expr_stmt|;
name|arpreq
operator|.
name|at_flags
operator|=
name|ATF_COM
expr_stmt|;
comment|/* Set up IP address */
name|arpreq
operator|.
name|at_in
operator|=
name|ia
operator|->
name|s_addr
expr_stmt|;
comment|/* Set up Hardware Address */
name|bcopy
argument_list|(
name|haddr
argument_list|,
name|arpreq
operator|.
name|at_enaddr
argument_list|,
name|halen
argument_list|)
expr_stmt|;
comment|/* Set the Date Link type. */
comment|/* XXX - Translate (hafamily) to dltype somehow? */
name|arpreq
operator|.
name|at_dltype
operator|=
name|DL_ETHER
expr_stmt|;
else|#
directive|else
comment|/* WIN_TCP */
comment|/* Good old Berkeley way. */
name|struct
name|arpreq
name|arpreq
decl_stmt|;
comment|/* Arp request ioctl block */
name|struct
name|sockaddr_in
modifier|*
name|si
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|caddr_t
operator|)
operator|&
name|arpreq
argument_list|,
sizeof|sizeof
argument_list|(
name|arpreq
argument_list|)
argument_list|)
expr_stmt|;
name|arpreq
operator|.
name|arp_flags
operator|=
name|ATF_INUSE
operator||
name|ATF_COM
expr_stmt|;
comment|/* Set up the protocol address. */
name|arpreq
operator|.
name|arp_pa
operator|.
name|sa_family
operator|=
name|AF_INET
expr_stmt|;
name|si
operator|=
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|arpreq
operator|.
name|arp_pa
expr_stmt|;
name|si
operator|->
name|sin_addr
operator|=
operator|*
name|ia
expr_stmt|;
comment|/* Set up the hardware address. */
ifdef|#
directive|ifdef
name|__linux__
comment|/* XXX - Do others need this? -gwr */
comment|/* 	 * Linux requires the sa_family field set. 	 * longyear@netcom.com (Al Longyear) 	 */
name|arpreq
operator|.
name|arp_ha
operator|.
name|sa_family
operator|=
name|hafamily
expr_stmt|;
endif|#
directive|endif
comment|/* linux */
comment|/* This variable is just to help catch type mismatches. */
name|p
operator|=
name|arpreq
operator|.
name|arp_ha
operator|.
name|sa_data
expr_stmt|;
name|bcopy
argument_list|(
name|haddr
argument_list|,
name|p
argument_list|,
name|halen
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* WIN_TCP */
ifdef|#
directive|ifdef
name|SVR4
comment|/* 	 * And now the stuff for System V Rel 4.x which does not 	 * appear to allow SIOCxxx ioctls on a socket descriptor. 	 * Thanks to several people: (all sent the same fix) 	 *   Barney Wolff<barney@databus.com>, 	 *   bear@upsys.se (Bj|rn Sj|holm), 	 *   Michael Kuschke<Michael.Kuschke@Materna.DE>, 	 */
block|{
name|int
name|fd
decl_stmt|;
name|struct
name|strioctl
name|iocb
decl_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
literal|"/dev/arp"
argument_list|,
name|O_RDWR
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|report
argument_list|(
name|LOG_ERR
argument_list|,
literal|"open /dev/arp: %s\n"
argument_list|,
name|get_errmsg
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|iocb
operator|.
name|ic_cmd
operator|=
name|SIOCSARP
expr_stmt|;
name|iocb
operator|.
name|ic_timout
operator|=
literal|0
expr_stmt|;
name|iocb
operator|.
name|ic_dp
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|arpreq
expr_stmt|;
name|iocb
operator|.
name|ic_len
operator|=
sizeof|sizeof
argument_list|(
name|arpreq
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|I_STR
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|iocb
argument_list|)
operator|<
literal|0
condition|)
block|{
name|report
argument_list|(
name|LOG_ERR
argument_list|,
literal|"ioctl I_STR: %s\n"
argument_list|,
name|get_errmsg
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
comment|/* SVR4 */
comment|/* 	 * On SunOS, the ioctl sometimes returns ENXIO, and it 	 * appears to happen when the ARP cache entry you tried 	 * to add is already in the cache.  (Sigh...) 	 * XXX - Should this error simply be ignored? -gwr 	 */
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCSARP
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|arpreq
argument_list|)
operator|<
literal|0
condition|)
block|{
name|report
argument_list|(
name|LOG_ERR
argument_list|,
literal|"ioctl SIOCSARP: %s"
argument_list|,
name|get_errmsg
argument_list|()
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SVR4 */
else|#
directive|else
comment|/* SIOCSARP */
comment|/* 	 * Oh well, SIOCSARP is not defined.  Just run arp(8). 	 * Need to delete partial entry first on some systems. 	 * XXX - Gag! 	 */
name|int
name|status
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|char
modifier|*
name|a
decl_stmt|;
specifier|extern
name|char
modifier|*
name|inet_ntoa
parameter_list|()
function_decl|;
name|a
operator|=
name|inet_ntoa
argument_list|(
operator|*
name|ia
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"arp -d %s; arp -s %s %s temp"
argument_list|,
name|a
argument_list|,
name|a
argument_list|,
name|haddrtoa
argument_list|(
name|haddr
argument_list|,
name|halen
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|>
literal|2
condition|)
name|report
argument_list|(
name|LOG_INFO
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|status
operator|=
name|system
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
condition|)
name|report
argument_list|(
name|LOG_ERR
argument_list|,
literal|"arp failed, exit code=0x%x"
argument_list|,
name|status
argument_list|)
expr_stmt|;
return|return;
endif|#
directive|endif
comment|/* SIOCSARP */
block|}
end_function

begin_comment
comment|/*  * Convert a hardware address to an ASCII string.  */
end_comment

begin_function
name|char
modifier|*
name|haddrtoa
parameter_list|(
name|haddr
parameter_list|,
name|hlen
parameter_list|)
name|u_char
modifier|*
name|haddr
decl_stmt|;
name|int
name|hlen
decl_stmt|;
block|{
specifier|static
name|char
name|haddrbuf
index|[
literal|3
operator|*
name|MAXHADDRLEN
operator|+
literal|1
index|]
decl_stmt|;
name|char
modifier|*
name|bufptr
decl_stmt|;
if|if
condition|(
name|hlen
operator|>
name|MAXHADDRLEN
condition|)
name|hlen
operator|=
name|MAXHADDRLEN
expr_stmt|;
name|bufptr
operator|=
name|haddrbuf
expr_stmt|;
while|while
condition|(
name|hlen
operator|>
literal|0
condition|)
block|{
name|sprintf
argument_list|(
name|bufptr
argument_list|,
literal|"%02X:"
argument_list|,
call|(
name|unsigned
call|)
argument_list|(
operator|*
name|haddr
operator|++
operator|&
literal|0xFF
argument_list|)
argument_list|)
expr_stmt|;
name|bufptr
operator|+=
literal|3
expr_stmt|;
name|hlen
operator|--
expr_stmt|;
block|}
name|bufptr
index|[
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|haddrbuf
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * haddr_conv802()  * --------------  *  * Converts a backwards address to a canonical address and a canonical address  * to a backwards address.  *  * INPUTS:  *  adr_in - pointer to six byte string to convert (unsigned char *)  *  addr_len - how many bytes to convert  *  * OUTPUTS:  *  addr_out - The string is updated to contain the converted address.  *  * CALLER:  *  many  *  * DATA:  *  Uses conv802table to bit-reverse the address bytes.  */
end_comment

begin_decl_stmt
specifier|static
name|u_char
name|conv802table
index|[
literal|256
index|]
init|=
block|{
comment|/* 0x00 */
literal|0x00
block|,
literal|0x80
block|,
literal|0x40
block|,
literal|0xC0
block|,
literal|0x20
block|,
literal|0xA0
block|,
literal|0x60
block|,
literal|0xE0
block|,
comment|/* 0x08 */
literal|0x10
block|,
literal|0x90
block|,
literal|0x50
block|,
literal|0xD0
block|,
literal|0x30
block|,
literal|0xB0
block|,
literal|0x70
block|,
literal|0xF0
block|,
comment|/* 0x10 */
literal|0x08
block|,
literal|0x88
block|,
literal|0x48
block|,
literal|0xC8
block|,
literal|0x28
block|,
literal|0xA8
block|,
literal|0x68
block|,
literal|0xE8
block|,
comment|/* 0x18 */
literal|0x18
block|,
literal|0x98
block|,
literal|0x58
block|,
literal|0xD8
block|,
literal|0x38
block|,
literal|0xB8
block|,
literal|0x78
block|,
literal|0xF8
block|,
comment|/* 0x20 */
literal|0x04
block|,
literal|0x84
block|,
literal|0x44
block|,
literal|0xC4
block|,
literal|0x24
block|,
literal|0xA4
block|,
literal|0x64
block|,
literal|0xE4
block|,
comment|/* 0x28 */
literal|0x14
block|,
literal|0x94
block|,
literal|0x54
block|,
literal|0xD4
block|,
literal|0x34
block|,
literal|0xB4
block|,
literal|0x74
block|,
literal|0xF4
block|,
comment|/* 0x30 */
literal|0x0C
block|,
literal|0x8C
block|,
literal|0x4C
block|,
literal|0xCC
block|,
literal|0x2C
block|,
literal|0xAC
block|,
literal|0x6C
block|,
literal|0xEC
block|,
comment|/* 0x38 */
literal|0x1C
block|,
literal|0x9C
block|,
literal|0x5C
block|,
literal|0xDC
block|,
literal|0x3C
block|,
literal|0xBC
block|,
literal|0x7C
block|,
literal|0xFC
block|,
comment|/* 0x40 */
literal|0x02
block|,
literal|0x82
block|,
literal|0x42
block|,
literal|0xC2
block|,
literal|0x22
block|,
literal|0xA2
block|,
literal|0x62
block|,
literal|0xE2
block|,
comment|/* 0x48 */
literal|0x12
block|,
literal|0x92
block|,
literal|0x52
block|,
literal|0xD2
block|,
literal|0x32
block|,
literal|0xB2
block|,
literal|0x72
block|,
literal|0xF2
block|,
comment|/* 0x50 */
literal|0x0A
block|,
literal|0x8A
block|,
literal|0x4A
block|,
literal|0xCA
block|,
literal|0x2A
block|,
literal|0xAA
block|,
literal|0x6A
block|,
literal|0xEA
block|,
comment|/* 0x58 */
literal|0x1A
block|,
literal|0x9A
block|,
literal|0x5A
block|,
literal|0xDA
block|,
literal|0x3A
block|,
literal|0xBA
block|,
literal|0x7A
block|,
literal|0xFA
block|,
comment|/* 0x60 */
literal|0x06
block|,
literal|0x86
block|,
literal|0x46
block|,
literal|0xC6
block|,
literal|0x26
block|,
literal|0xA6
block|,
literal|0x66
block|,
literal|0xE6
block|,
comment|/* 0x68 */
literal|0x16
block|,
literal|0x96
block|,
literal|0x56
block|,
literal|0xD6
block|,
literal|0x36
block|,
literal|0xB6
block|,
literal|0x76
block|,
literal|0xF6
block|,
comment|/* 0x70 */
literal|0x0E
block|,
literal|0x8E
block|,
literal|0x4E
block|,
literal|0xCE
block|,
literal|0x2E
block|,
literal|0xAE
block|,
literal|0x6E
block|,
literal|0xEE
block|,
comment|/* 0x78 */
literal|0x1E
block|,
literal|0x9E
block|,
literal|0x5E
block|,
literal|0xDE
block|,
literal|0x3E
block|,
literal|0xBE
block|,
literal|0x7E
block|,
literal|0xFE
block|,
comment|/* 0x80 */
literal|0x01
block|,
literal|0x81
block|,
literal|0x41
block|,
literal|0xC1
block|,
literal|0x21
block|,
literal|0xA1
block|,
literal|0x61
block|,
literal|0xE1
block|,
comment|/* 0x88 */
literal|0x11
block|,
literal|0x91
block|,
literal|0x51
block|,
literal|0xD1
block|,
literal|0x31
block|,
literal|0xB1
block|,
literal|0x71
block|,
literal|0xF1
block|,
comment|/* 0x90 */
literal|0x09
block|,
literal|0x89
block|,
literal|0x49
block|,
literal|0xC9
block|,
literal|0x29
block|,
literal|0xA9
block|,
literal|0x69
block|,
literal|0xE9
block|,
comment|/* 0x98 */
literal|0x19
block|,
literal|0x99
block|,
literal|0x59
block|,
literal|0xD9
block|,
literal|0x39
block|,
literal|0xB9
block|,
literal|0x79
block|,
literal|0xF9
block|,
comment|/* 0xA0 */
literal|0x05
block|,
literal|0x85
block|,
literal|0x45
block|,
literal|0xC5
block|,
literal|0x25
block|,
literal|0xA5
block|,
literal|0x65
block|,
literal|0xE5
block|,
comment|/* 0xA8 */
literal|0x15
block|,
literal|0x95
block|,
literal|0x55
block|,
literal|0xD5
block|,
literal|0x35
block|,
literal|0xB5
block|,
literal|0x75
block|,
literal|0xF5
block|,
comment|/* 0xB0 */
literal|0x0D
block|,
literal|0x8D
block|,
literal|0x4D
block|,
literal|0xCD
block|,
literal|0x2D
block|,
literal|0xAD
block|,
literal|0x6D
block|,
literal|0xED
block|,
comment|/* 0xB8 */
literal|0x1D
block|,
literal|0x9D
block|,
literal|0x5D
block|,
literal|0xDD
block|,
literal|0x3D
block|,
literal|0xBD
block|,
literal|0x7D
block|,
literal|0xFD
block|,
comment|/* 0xC0 */
literal|0x03
block|,
literal|0x83
block|,
literal|0x43
block|,
literal|0xC3
block|,
literal|0x23
block|,
literal|0xA3
block|,
literal|0x63
block|,
literal|0xE3
block|,
comment|/* 0xC8 */
literal|0x13
block|,
literal|0x93
block|,
literal|0x53
block|,
literal|0xD3
block|,
literal|0x33
block|,
literal|0xB3
block|,
literal|0x73
block|,
literal|0xF3
block|,
comment|/* 0xD0 */
literal|0x0B
block|,
literal|0x8B
block|,
literal|0x4B
block|,
literal|0xCB
block|,
literal|0x2B
block|,
literal|0xAB
block|,
literal|0x6B
block|,
literal|0xEB
block|,
comment|/* 0xD8 */
literal|0x1B
block|,
literal|0x9B
block|,
literal|0x5B
block|,
literal|0xDB
block|,
literal|0x3B
block|,
literal|0xBB
block|,
literal|0x7B
block|,
literal|0xFB
block|,
comment|/* 0xE0 */
literal|0x07
block|,
literal|0x87
block|,
literal|0x47
block|,
literal|0xC7
block|,
literal|0x27
block|,
literal|0xA7
block|,
literal|0x67
block|,
literal|0xE7
block|,
comment|/* 0xE8 */
literal|0x17
block|,
literal|0x97
block|,
literal|0x57
block|,
literal|0xD7
block|,
literal|0x37
block|,
literal|0xB7
block|,
literal|0x77
block|,
literal|0xF7
block|,
comment|/* 0xF0 */
literal|0x0F
block|,
literal|0x8F
block|,
literal|0x4F
block|,
literal|0xCF
block|,
literal|0x2F
block|,
literal|0xAF
block|,
literal|0x6F
block|,
literal|0xEF
block|,
comment|/* 0xF8 */
literal|0x1F
block|,
literal|0x9F
block|,
literal|0x5F
block|,
literal|0xDF
block|,
literal|0x3F
block|,
literal|0xBF
block|,
literal|0x7F
block|,
literal|0xFF
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|haddr_conv802
parameter_list|(
name|addr_in
parameter_list|,
name|addr_out
parameter_list|,
name|len
parameter_list|)
specifier|register
name|u_char
modifier|*
name|addr_in
decl_stmt|,
decl|*
name|addr_out
decl_stmt|;
end_function

begin_decl_stmt
name|int
name|len
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
modifier|*
name|lim
decl_stmt|;
name|lim
operator|=
name|addr_out
operator|+
name|len
expr_stmt|;
while|while
condition|(
name|addr_out
operator|<
name|lim
condition|)
operator|*
name|addr_out
operator|++
operator|=
name|conv802table
index|[
operator|*
name|addr_in
operator|++
index|]
expr_stmt|;
block|}
end_block

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|/*  * For the record, here is a program to generate the  * bit-reverse table above.  */
end_comment

begin_endif
unit|static int bitrev(n) 	int n; { 	int i, r;  	r = 0; 	for (i = 0; i< 8; i++) { 		r<<= 1; 		r |= (n& 1); 		n>>= 1; 	} 	return r; }  main() { 	int i; 	for (i = 0; i<= 0xFF; i++) { 		if ((i& 7) == 0) 			printf("/* 0x%02X */", i); 		printf(" 0x%02X,", bitrev(i)); 		if ((i& 7) == 7) 			printf("\n"); 	} }
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Local Variables:  * tab-width: 4  * c-indent-level: 4  * c-argdecl-indent: 4  * c-continued-statement-offset: 4  * c-continued-brace-offset: -4  * c-label-offset: -4  * c-brace-offset: 0  * End:  */
end_comment

end_unit

