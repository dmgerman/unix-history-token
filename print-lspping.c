begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * Original code by Hannes Gredler (hannes@juniper.net)  */
end_comment

begin_comment
comment|/* \summary: MPLS LSP PING printer */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netdissect-stdinc.h>
end_include

begin_include
include|#
directive|include
file|"netdissect.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"l2vpn.h"
end_include

begin_include
include|#
directive|include
file|"oui.h"
end_include

begin_comment
comment|/* RFC 4349 */
end_comment

begin_comment
comment|/*  * LSPPING common header  *  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |         Version Number        |         Must Be Zero          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Message Type |   Reply mode  |  Return Code  | Return Subcode|  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                        Sender's Handle                        |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                        Sequence Number                        |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                    TimeStamp Sent (seconds)                   |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                  TimeStamp Sent (microseconds)                |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                  TimeStamp Received (seconds)                 |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                TimeStamp Received (microseconds)              |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                            TLVs ...                           |  * .                                                               .  * .                                                               .  * .                                                               .  */
end_comment

begin_struct
struct|struct
name|lspping_common_header
block|{
name|uint8_t
name|version
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|global_flags
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|msg_type
decl_stmt|;
name|uint8_t
name|reply_mode
decl_stmt|;
name|uint8_t
name|return_code
decl_stmt|;
name|uint8_t
name|return_subcode
decl_stmt|;
name|uint8_t
name|sender_handle
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|seq_number
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|ts_sent_sec
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|ts_sent_usec
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|ts_rcvd_sec
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|ts_rcvd_usec
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|LSPPING_VERSION
value|1
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_msg_type_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"MPLS Echo Request"
block|}
block|,
block|{
literal|2
block|,
literal|"MPLS Echo Reply"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_reply_mode_values
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"Do not reply"
block|}
block|,
block|{
literal|2
block|,
literal|"Reply via an IPv4/IPv6 UDP packet"
block|}
block|,
block|{
literal|3
block|,
literal|"Reply via an IPv4/IPv6 UDP packet with Router Alert"
block|}
block|,
block|{
literal|4
block|,
literal|"Reply via application level control channel"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_return_code_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"No return code or return code contained in the Error Code TLV"
block|}
block|,
block|{
literal|1
block|,
literal|"Malformed echo request received"
block|}
block|,
block|{
literal|2
block|,
literal|"One or more of the TLVs was not understood"
block|}
block|,
block|{
literal|3
block|,
literal|"Replying router is an egress for the FEC at stack depth"
block|}
block|,
block|{
literal|4
block|,
literal|"Replying router has no mapping for the FEC at stack depth"
block|}
block|,
block|{
literal|5
block|,
literal|"Reserved"
block|}
block|,
block|{
literal|6
block|,
literal|"Reserved"
block|}
block|,
block|{
literal|7
block|,
literal|"Reserved"
block|}
block|,
block|{
literal|8
block|,
literal|"Label switched at stack-depth"
block|}
block|,
block|{
literal|9
block|,
literal|"Label switched but no MPLS forwarding at stack-depth"
block|}
block|,
block|{
literal|10
block|,
literal|"Mapping for this FEC is not the given label at stack depth"
block|}
block|,
block|{
literal|11
block|,
literal|"No label entry at stack-depth"
block|}
block|,
block|{
literal|12
block|,
literal|"Protocol not associated with interface at FEC stack depth"
block|}
block|,
block|{
literal|13
block|,
literal|"Premature termination of ping due to label stack shrinking to a single label"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * LSPPING TLV header  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |             Type              |            Length             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                             Value                             |  * .                                                               .  * .                                                               .  * .                                                               .  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_header
block|{
name|uint8_t
name|type
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|length
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGET_FEC_STACK
value|1
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_DOWNSTREAM_MAPPING
value|2
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_PAD
value|3
end_define

begin_comment
comment|/* not assigned                           4 */
end_comment

begin_define
define|#
directive|define
name|LSPPING_TLV_VENDOR_ENTERPRISE
value|5
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_VENDOR_ENTERPRISE_LEN
value|4
end_define

begin_comment
comment|/* not assigned                           6 */
end_comment

begin_define
define|#
directive|define
name|LSPPING_TLV_INTERFACE_LABEL_STACK
value|7
end_define

begin_comment
comment|/* not assigned                           8 */
end_comment

begin_define
define|#
directive|define
name|LSPPING_TLV_ERROR_CODE
value|9
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_REPLY_TOS_BYTE
value|10
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_BFD_DISCRIMINATOR
value|15
end_define

begin_comment
comment|/* draft-ietf-bfd-mpls-02 */
end_comment

begin_define
define|#
directive|define
name|LSPPING_TLV_BFD_DISCRIMINATOR_LEN
value|4
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_VENDOR_PRIVATE
value|0xfc00
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_tlv_values
index|[]
init|=
block|{
block|{
name|LSPPING_TLV_TARGET_FEC_STACK
block|,
literal|"Target FEC Stack"
block|}
block|,
block|{
name|LSPPING_TLV_DOWNSTREAM_MAPPING
block|,
literal|"Downstream Mapping"
block|}
block|,
block|{
name|LSPPING_TLV_PAD
block|,
literal|"Pad"
block|}
block|,
block|{
name|LSPPING_TLV_ERROR_CODE
block|,
literal|"Error Code"
block|}
block|,
block|{
name|LSPPING_TLV_VENDOR_ENTERPRISE
block|,
literal|"Vendor Enterprise Code"
block|}
block|,
block|{
name|LSPPING_TLV_INTERFACE_LABEL_STACK
block|,
literal|"Interface Label Stack"
block|}
block|,
block|{
name|LSPPING_TLV_REPLY_TOS_BYTE
block|,
literal|"Reply TOS Byte"
block|}
block|,
block|{
name|LSPPING_TLV_BFD_DISCRIMINATOR
block|,
literal|"BFD Discriminator"
block|}
block|,
block|{
name|LSPPING_TLV_VENDOR_PRIVATE
block|,
literal|"Vendor Private Code"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV4
value|1
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV6
value|2
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV4
value|3
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV6
value|4
end_define

begin_comment
comment|/* not assigned                                     5 */
end_comment

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV4
value|6
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV6
value|7
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_L2VPN_ENDPT
value|8
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW_OLD
value|9
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW
value|10
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_129_PW
value|11
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV4
value|12
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV6
value|13
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_GENERIC_IPV4
value|14
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_GENERIC_IPV6
value|15
end_define

begin_define
define|#
directive|define
name|LSPPING_TLV_TARGETFEC_SUBTLV_NIL_FEC
value|16
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_tlvtargetfec_subtlv_values
index|[]
init|=
block|{
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV4
block|,
literal|"LDP IPv4 prefix"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV6
block|,
literal|"LDP IPv6 prefix"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV4
block|,
literal|"RSVP IPv4 Session Query"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV6
block|,
literal|"RSVP IPv6 Session Query"
block|}
block|,
block|{
literal|5
block|,
literal|"Reserved"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV4
block|,
literal|"VPN IPv4 prefix"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV6
block|,
literal|"VPN IPv6 prefix"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_L2VPN_ENDPT
block|,
literal|"L2 VPN endpoint"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW_OLD
block|,
literal|"FEC 128 pseudowire (old)"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW
block|,
literal|"FEC 128 pseudowire"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV4
block|,
literal|"BGP labeled IPv4 prefix"
block|}
block|,
block|{
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV6
block|,
literal|"BGP labeled IPv6 prefix"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                          IPv4 prefix                          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |         Must Be Zero                          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv4_t
block|{
name|uint8_t
name|prefix
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                          IPv6 prefix                          |  * |                          (16 octets)                          |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |         Must Be Zero                          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv6_t
block|{
name|uint8_t
name|prefix
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                 IPv4 tunnel end point address                 |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |          Must Be Zero         |     Tunnel ID                 |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                       Extended Tunnel ID                      |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                   IPv4 tunnel sender address                  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |          Must Be Zero         |            LSP ID             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4_t
block|{
name|uint8_t
name|tunnel_endpoint
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|tunnel_id
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|extended_tunnel_id
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|tunnel_sender
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|res2
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|lsp_id
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                 IPv6 tunnel end point address                 |  * |                                                               |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |          Must Be Zero         |          Tunnel ID            |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                       Extended Tunnel ID                      |  * |                                                               |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                   IPv6 tunnel sender address                  |  * |                                                               |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |          Must Be Zero         |            LSP ID             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6_t
block|{
name|uint8_t
name|tunnel_endpoint
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|tunnel_id
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|extended_tunnel_id
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|tunnel_sender
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|res2
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|lsp_id
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Route Distinguisher                      |  * |                          (8 octets)                           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                         IPv4 prefix                           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |                 Must Be Zero                  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4_t
block|{
name|uint8_t
name|rd
index|[
literal|8
index|]
decl_stmt|;
name|uint8_t
name|prefix
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Route Distinguisher                      |  * |                          (8 octets)                           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                          IPv6 prefix                          |  * |                          (16 octets)                          |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |                 Must Be Zero                  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6_t
block|{
name|uint8_t
name|rd
index|[
literal|8
index|]
decl_stmt|;
name|uint8_t
name|prefix
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Route Distinguisher                      |  * |                          (8 octets)                           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |         Sender's VE ID        |       Receiver's VE ID        |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |      Encapsulation Type       |         Must Be Zero          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  *  0                   1                   2                   3  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt_t
block|{
name|uint8_t
name|rd
index|[
literal|8
index|]
decl_stmt|;
name|uint8_t
name|sender_ve_id
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|receiver_ve_id
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|encapsulation
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Remote PE Address                        |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                             PW ID                             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |            PW Type            |          Must Be Zero         |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw_old
block|{
name|uint8_t
name|remote_pe_address
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|pw_id
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|pw_type
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                     Sender's PE Address                       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Remote PE Address                        |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                             PW ID                             |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |            PW Type            |          Must Be Zero         |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw
block|{
name|uint8_t
name|sender_pe_address
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|remote_pe_address
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|pw_id
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|pw_type
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                         IPv4 prefix                           |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |                 Must Be Zero                  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv4_t
block|{
name|uint8_t
name|prefix
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                          IPv6 prefix                          |  * |                          (16 octets)                          |  * |                                                               |  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Prefix Length |                 Must Be Zero                  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_struct
struct|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv6_t
block|{
name|uint8_t
name|prefix
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|prefix_len
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |               MTU             | Address Type  |  Resvd (SBZ)  |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |             Downstream IP Address (4 or 16 octets)            |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |         Downstream Interface Address (4 or 16 octets)         |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * | Multipath Type| Depth Limit   |        Multipath Length       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * .                                                               .  * .                     (Multipath Information)                   .  * .                                                               .  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |               Downstream Label                |    Protocol   |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * .                                                               .  * .                                                               .  * .                                                               .  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |               Downstream Label                |    Protocol   |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  */
end_comment

begin_comment
comment|/* Enough to get the address type */
end_comment

begin_struct
struct|struct
name|lspping_tlv_downstream_map_t
block|{
name|uint8_t
name|mtu
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint8_t
name|ds_flags
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|lspping_tlv_downstream_map_ipv4_t
block|{
name|uint8_t
name|mtu
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint8_t
name|ds_flags
decl_stmt|;
name|uint8_t
name|downstream_ip
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|downstream_interface
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
block|{
name|uint8_t
name|mtu
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint8_t
name|ds_flags
decl_stmt|;
name|uint8_t
name|downstream_ip
index|[
literal|4
index|]
decl_stmt|;
name|uint8_t
name|downstream_interface
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|lspping_tlv_downstream_map_ipv6_t
block|{
name|uint8_t
name|mtu
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint8_t
name|ds_flags
decl_stmt|;
name|uint8_t
name|downstream_ip
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|downstream_interface
index|[
literal|16
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
block|{
name|uint8_t
name|mtu
index|[
literal|2
index|]
decl_stmt|;
name|uint8_t
name|address_type
decl_stmt|;
name|uint8_t
name|ds_flags
decl_stmt|;
name|uint8_t
name|downstream_ip
index|[
literal|16
index|]
decl_stmt|;
name|uint8_t
name|downstream_interface
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|lspping_tlv_downstream_map_info_t
block|{
name|uint8_t
name|multipath_type
decl_stmt|;
name|uint8_t
name|depth_limit
decl_stmt|;
name|uint8_t
name|multipath_length
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|LSPPING_AFI_IPV4
value|1
end_define

begin_define
define|#
directive|define
name|LSPPING_AFI_IPV4_UNMB
value|2
end_define

begin_define
define|#
directive|define
name|LSPPING_AFI_IPV6
value|3
end_define

begin_define
define|#
directive|define
name|LSPPING_AFI_IPV6_UNMB
value|4
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|tok
name|lspping_tlv_downstream_addr_values
index|[]
init|=
block|{
block|{
name|LSPPING_AFI_IPV4
block|,
literal|"IPv4"
block|}
block|,
block|{
name|LSPPING_AFI_IPV4_UNMB
block|,
literal|"Unnumbered IPv4"
block|}
block|,
block|{
name|LSPPING_AFI_IPV6
block|,
literal|"IPv6"
block|}
block|,
block|{
name|LSPPING_AFI_IPV6_UNMB
block|,
literal|"IPv6"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|lspping_print
parameter_list|(
name|netdissect_options
modifier|*
name|ndo
parameter_list|,
specifier|register
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
specifier|register
name|u_int
name|len
parameter_list|)
block|{
specifier|const
name|struct
name|lspping_common_header
modifier|*
name|lspping_com_header
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_header
modifier|*
name|lspping_tlv_header
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_header
modifier|*
name|lspping_subtlv_header
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|,
modifier|*
name|tlv_tptr
decl_stmt|,
modifier|*
name|subtlv_tptr
decl_stmt|;
name|u_int
name|tlen
decl_stmt|,
name|lspping_tlv_len
decl_stmt|,
name|lspping_tlv_type
decl_stmt|,
name|tlv_tlen
decl_stmt|;
name|int
name|tlv_hexdump
decl_stmt|,
name|subtlv_hexdump
decl_stmt|;
name|u_int
name|lspping_subtlv_len
decl_stmt|,
name|lspping_subtlv_type
decl_stmt|;
name|struct
name|timeval
name|timestamp
decl_stmt|;
union|union
block|{
specifier|const
name|struct
name|lspping_tlv_downstream_map_t
modifier|*
name|lspping_tlv_downstream_map
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_downstream_map_ipv4_t
modifier|*
name|lspping_tlv_downstream_map_ipv4
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
modifier|*
name|lspping_tlv_downstream_map_ipv4_unmb
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_downstream_map_ipv6_t
modifier|*
name|lspping_tlv_downstream_map_ipv6
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
modifier|*
name|lspping_tlv_downstream_map_ipv6_unmb
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_downstream_map_info_t
modifier|*
name|lspping_tlv_downstream_map_info
decl_stmt|;
block|}
name|tlv_ptr
union|;
union|union
block|{
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv4_t
modifier|*
name|lspping_tlv_targetfec_subtlv_ldp_ipv4
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv6_t
modifier|*
name|lspping_tlv_targetfec_subtlv_ldp_ipv6
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4_t
modifier|*
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6_t
modifier|*
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4_t
modifier|*
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6_t
modifier|*
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt_t
modifier|*
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw_old
modifier|*
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw
modifier|*
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv4_t
modifier|*
name|lspping_tlv_targetfec_subtlv_bgp_ipv4
decl_stmt|;
specifier|const
name|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv6_t
modifier|*
name|lspping_tlv_targetfec_subtlv_bgp_ipv6
decl_stmt|;
block|}
name|subtlv_ptr
union|;
name|tptr
operator|=
name|pptr
expr_stmt|;
name|lspping_com_header
operator|=
operator|(
specifier|const
expr|struct
name|lspping_common_header
operator|*
operator|)
name|pptr
expr_stmt|;
if|if
condition|(
name|len
operator|<
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|lspping_common_header
argument_list|)
condition|)
goto|goto
name|tooshort
goto|;
name|ND_TCHECK
argument_list|(
operator|*
name|lspping_com_header
argument_list|)
expr_stmt|;
comment|/*      * Sanity checking of the header.      */
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
operator|&
name|lspping_com_header
operator|->
name|version
index|[
literal|0
index|]
argument_list|)
operator|!=
name|LSPPING_VERSION
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"LSP-PING version %u packet not supported"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|lspping_com_header
operator|->
name|version
index|[
literal|0
index|]
argument_list|)
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* in non-verbose mode just lets print the basic Message Type*/
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<
literal|1
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"LSP-PINGv%u, %s, seq %u, length: %u"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|lspping_com_header
operator|->
name|version
index|[
literal|0
index|]
argument_list|)
operator|,
name|tok2str
argument_list|(
name|lspping_msg_type_values
argument_list|,
literal|"unknown (%u)"
argument_list|,
name|lspping_com_header
operator|->
name|msg_type
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|seq_number
argument_list|)
operator|,
name|len
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* ok they seem to want to know everything - lets fully decode it */
name|tlen
operator|=
name|len
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\tLSP-PINGv%u, msg-type: %s (%u), length: %u\n\t  reply-mode: %s (%u)"
operator|,
name|EXTRACT_16BITS
argument_list|(
operator|&
name|lspping_com_header
operator|->
name|version
index|[
literal|0
index|]
argument_list|)
operator|,
name|tok2str
argument_list|(
name|lspping_msg_type_values
argument_list|,
literal|"unknown"
argument_list|,
name|lspping_com_header
operator|->
name|msg_type
argument_list|)
operator|,
name|lspping_com_header
operator|->
name|msg_type
operator|,
name|len
operator|,
name|tok2str
argument_list|(
name|lspping_reply_mode_values
argument_list|,
literal|"unknown"
argument_list|,
name|lspping_com_header
operator|->
name|reply_mode
argument_list|)
operator|,
name|lspping_com_header
operator|->
name|reply_mode
operator|)
argument_list|)
expr_stmt|;
comment|/*      *  the following return codes require that the subcode is attached      *  at the end of the translated token output      */
if|if
condition|(
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|3
operator|||
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|4
operator|||
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|8
operator|||
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|10
operator|||
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|11
operator|||
name|lspping_com_header
operator|->
name|return_code
operator|==
literal|12
condition|)
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Return Code: %s %u (%u)\n\t  Return Subcode: (%u)"
operator|,
name|tok2str
argument_list|(
name|lspping_return_code_values
argument_list|,
literal|"unknown"
argument_list|,
name|lspping_com_header
operator|->
name|return_code
argument_list|)
operator|,
name|lspping_com_header
operator|->
name|return_subcode
operator|,
name|lspping_com_header
operator|->
name|return_code
operator|,
name|lspping_com_header
operator|->
name|return_subcode
operator|)
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Return Code: %s (%u)\n\t  Return Subcode: (%u)"
operator|,
name|tok2str
argument_list|(
name|lspping_return_code_values
argument_list|,
literal|"unknown"
argument_list|,
name|lspping_com_header
operator|->
name|return_code
argument_list|)
operator|,
name|lspping_com_header
operator|->
name|return_code
operator|,
name|lspping_com_header
operator|->
name|return_subcode
operator|)
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Sender Handle: 0x%08x, Sequence: %u"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|sender_handle
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|seq_number
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|timestamp
operator|.
name|tv_sec
operator|=
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|ts_sent_sec
argument_list|)
expr_stmt|;
name|timestamp
operator|.
name|tv_usec
operator|=
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|ts_sent_usec
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  Sender Timestamp: "
operator|)
argument_list|)
expr_stmt|;
name|ts_print
argument_list|(
name|ndo
argument_list|,
operator|&
name|timestamp
argument_list|)
expr_stmt|;
name|timestamp
operator|.
name|tv_sec
operator|=
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|ts_rcvd_sec
argument_list|)
expr_stmt|;
name|timestamp
operator|.
name|tv_usec
operator|=
name|EXTRACT_32BITS
argument_list|(
name|lspping_com_header
operator|->
name|ts_rcvd_usec
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"Receiver Timestamp: "
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|timestamp
operator|.
name|tv_sec
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|timestamp
operator|.
name|tv_usec
operator|!=
literal|0
operator|)
condition|)
name|ts_print
argument_list|(
name|ndo
argument_list|,
operator|&
name|timestamp
argument_list|)
expr_stmt|;
else|else
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"no timestamp"
operator|)
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|lspping_common_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
specifier|const
expr|struct
name|lspping_common_header
argument_list|)
expr_stmt|;
while|while
condition|(
name|tlen
operator|!=
literal|0
condition|)
block|{
comment|/* Does the TLV go past the end of the packet? */
if|if
condition|(
name|tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
goto|goto
name|tooshort
goto|;
comment|/* did we capture enough for fully decoding the tlv header ? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
argument_list|)
expr_stmt|;
name|lspping_tlv_header
operator|=
operator|(
specifier|const
expr|struct
name|lspping_tlv_header
operator|*
operator|)
name|tptr
expr_stmt|;
name|lspping_tlv_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lspping_tlv_header
operator|->
name|type
argument_list|)
expr_stmt|;
name|lspping_tlv_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lspping_tlv_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t  %s TLV (%u), length: %u"
operator|,
name|tok2str
argument_list|(
name|lspping_tlv_values
argument_list|,
literal|"Unknown"
argument_list|,
name|lspping_tlv_type
argument_list|)
operator|,
name|lspping_tlv_type
operator|,
name|lspping_tlv_len
operator|)
argument_list|)
expr_stmt|;
comment|/* some little sanity checking */
if|if
condition|(
name|lspping_tlv_len
operator|==
literal|0
condition|)
block|{
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
continue|continue;
comment|/* no value to dissect */
block|}
name|tlv_tptr
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|=
name|lspping_tlv_len
expr_stmt|;
comment|/* header not included -> no adjustment */
comment|/* Does the TLV go past the end of the packet? */
if|if
condition|(
name|tlen
operator|<
name|lspping_tlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
goto|goto
name|tooshort
goto|;
comment|/* did we capture enough for fully decoding the tlv ? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
name|lspping_tlv_len
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|lspping_tlv_type
condition|)
block|{
case|case
name|LSPPING_TLV_TARGET_FEC_STACK
case|:
while|while
condition|(
name|tlv_tlen
operator|!=
literal|0
condition|)
block|{
comment|/* Does the subTLV header go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* did we capture enough for fully decoding the subtlv header ? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|FALSE
expr_stmt|;
name|lspping_subtlv_header
operator|=
operator|(
specifier|const
expr|struct
name|lspping_tlv_header
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
name|lspping_subtlv_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lspping_subtlv_header
operator|->
name|type
argument_list|)
expr_stmt|;
name|lspping_subtlv_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|lspping_subtlv_header
operator|->
name|length
argument_list|)
expr_stmt|;
name|subtlv_tptr
operator|=
name|tlv_tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
comment|/* Does the subTLV go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
name|lspping_subtlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for fully decoding the subTLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|subtlv_tptr
argument_list|,
name|lspping_subtlv_len
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    %s subTLV (%u), length: %u"
operator|,
name|tok2str
argument_list|(
name|lspping_tlvtargetfec_subtlv_values
argument_list|,
literal|"Unknown"
argument_list|,
name|lspping_subtlv_type
argument_list|)
operator|,
name|lspping_subtlv_type
operator|,
name|lspping_subtlv_len
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lspping_subtlv_type
condition|)
block|{
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV4
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|5
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 5"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv4
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv4_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      %s/%u"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv4
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv4
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_LDP_IPV6
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|17
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 17"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv6
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_ldp_ipv6_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      %s/%u"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv6
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_ldp_ipv6
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV4
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|5
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 5"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv4
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv4_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      %s/%u"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv4
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv4
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_BGP_IPV6
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|17
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 17"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv6
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_bgp_ipv6_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      %s/%u"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv6
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_bgp_ipv6
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV4
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|20
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 20"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      tunnel end-point %s, tunnel sender %s, lsp-id 0x%04x"
expr|\
literal|"\n\t      tunnel-id 0x%04x, extended tunnel-id %s"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|->
name|tunnel_endpoint
argument_list|)
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|->
name|tunnel_sender
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|->
name|lsp_id
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|->
name|tunnel_id
argument_list|)
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv4
operator|->
name|extended_tunnel_id
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_RSVP_IPV6
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|56
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 56"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      tunnel end-point %s, tunnel sender %s, lsp-id 0x%04x"
expr|\
literal|"\n\t      tunnel-id 0x%04x, extended tunnel-id %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|->
name|tunnel_endpoint
argument_list|)
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|->
name|tunnel_sender
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|->
name|lsp_id
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|->
name|tunnel_id
argument_list|)
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_rsvp_ipv6
operator|->
name|extended_tunnel_id
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV4
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|13
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 13"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      RD: %s, %s/%u"
operator|,
name|bgp_vpn_rd_print
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4
operator|->
name|rd
argument_list|)
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv4
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_L3VPN_IPV6
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|25
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 25"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      RD: %s, %s/%u"
operator|,
name|bgp_vpn_rd_print
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6
operator|->
name|rd
argument_list|)
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6
operator|->
name|prefix
argument_list|)
operator|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l3vpn_ipv6
operator|->
name|prefix_len
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_L2VPN_ENDPT
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|14
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 14"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt_t
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      RD: %s, Sender VE ID: %u, Receiver VE ID: %u"
expr|\
literal|"\n\t      Encapsulation Type: %s (%u)"
operator|,
name|bgp_vpn_rd_print
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|->
name|rd
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|->
name|sender_ve_id
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|->
name|receiver_ve_id
argument_list|)
operator|,
name|tok2str
argument_list|(
name|mpls_pw_types_values
argument_list|,
literal|"unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|->
name|encapsulation
argument_list|)
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_endpt
operator|->
name|encapsulation
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* the old L2VPN VCID subTLV does not have support for the sender field */
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW_OLD
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|10
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 10"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw_old
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      Remote PE: %s"
expr|\
literal|"\n\t      PW ID: 0x%08x, PW Type: %s (%u)"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
operator|->
name|remote_pe_address
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
operator|->
name|pw_id
argument_list|)
operator|,
name|tok2str
argument_list|(
name|mpls_pw_types_values
argument_list|,
literal|"unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
operator|->
name|pw_type
argument_list|)
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid_old
operator|->
name|pw_type
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_TARGETFEC_SUBTLV_FEC_128_PW
case|:
comment|/* Is the subTLV length correct? */
if|if
condition|(
name|lspping_subtlv_len
operator|!=
literal|14
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      invalid subTLV length, should be 14"
operator|)
argument_list|)
expr_stmt|;
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
block|}
else|else
block|{
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_targetfec_subtlv_fec_128_pw
operator|*
operator|)
name|subtlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      Sender PE: %s, Remote PE: %s"
expr|\
literal|"\n\t      PW ID: 0x%08x, PW Type: %s (%u)"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|->
name|sender_pe_address
argument_list|)
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|->
name|remote_pe_address
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|->
name|pw_id
argument_list|)
operator|,
name|tok2str
argument_list|(
name|mpls_pw_types_values
argument_list|,
literal|"unknown"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|->
name|pw_type
argument_list|)
argument_list|)
operator|,
name|EXTRACT_16BITS
argument_list|(
name|subtlv_ptr
operator|.
name|lspping_tlv_targetfec_subtlv_l2vpn_vcid
operator|->
name|pw_type
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|subtlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* unknown subTLV just hexdump it */
break|break;
block|}
comment|/* do we want to see an additionally subtlv hexdump ? */
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
operator|||
name|subtlv_hexdump
operator|==
name|TRUE
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|tlv_tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
argument_list|, \
literal|"\n\t      "
argument_list|,
name|lspping_subtlv_len
argument_list|)
expr_stmt|;
comment|/* All subTLVs are aligned to four octet boundary */
if|if
condition|(
name|lspping_subtlv_len
operator|%
literal|4
condition|)
block|{
name|lspping_subtlv_len
operator|+=
literal|4
operator|-
operator|(
name|lspping_subtlv_len
operator|%
literal|4
operator|)
expr_stmt|;
comment|/* Does the subTLV, including padding, go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
name|lspping_subtlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t TLV is too short"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|tlv_tptr
operator|+=
name|lspping_subtlv_len
expr_stmt|;
name|tlv_tlen
operator|-=
name|lspping_subtlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_DOWNSTREAM_MAPPING
case|:
comment|/* Does the header go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough to get the address family? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
comment|/* that strange thing with the downstream map TLV is that until now              * we do not know if its IPv4 or IPv6 or is unnumbered; after              * we find the address-type, we recast the tlv_tptr and move on. */
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    MTU: %u, Address-Type: %s (%u)"
operator|,
name|EXTRACT_16BITS
argument_list|(
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map
operator|->
name|mtu
argument_list|)
operator|,
name|tok2str
argument_list|(
name|lspping_tlv_downstream_addr_values
argument_list|,
literal|"unknown"
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map
operator|->
name|address_type
argument_list|)
operator|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map
operator|->
name|address_type
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map
operator|->
name|address_type
condition|)
block|{
case|case
name|LSPPING_AFI_IPV4
case|:
comment|/* Does the data go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for this part of the TLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_ipv4_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Downstream IP: %s"
expr|\
literal|"\n\t    Downstream Interface IP: %s"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4
operator|->
name|downstream_ip
argument_list|)
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4
operator|->
name|downstream_interface
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|tlv_tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_t
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_t
argument_list|)
expr_stmt|;
break|break;
case|case
name|LSPPING_AFI_IPV4_UNMB
case|:
comment|/* Does the data go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for this part of the TLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4_unmb
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Downstream IP: %s"
expr|\
literal|"\n\t    Downstream Interface Index: 0x%08x"
operator|,
name|ipaddr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4_unmb
operator|->
name|downstream_ip
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv4_unmb
operator|->
name|downstream_interface
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|tlv_tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv4_unmb_t
argument_list|)
expr_stmt|;
break|break;
case|case
name|LSPPING_AFI_IPV6
case|:
comment|/* Does the data go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for this part of the TLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_ipv6_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Downstream IP: %s"
expr|\
literal|"\n\t    Downstream Interface IP: %s"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6
operator|->
name|downstream_ip
argument_list|)
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6
operator|->
name|downstream_interface
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|tlv_tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_t
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_t
argument_list|)
expr_stmt|;
break|break;
case|case
name|LSPPING_AFI_IPV6_UNMB
case|:
comment|/* Does the data go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for this part of the TLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6_unmb
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Downstream IP: %s"
expr|\
literal|"\n\t    Downstream Interface Index: 0x%08x"
operator|,
name|ip6addr_string
argument_list|(
name|ndo
argument_list|,
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6_unmb
operator|->
name|downstream_ip
argument_list|)
operator|,
name|EXTRACT_32BITS
argument_list|(
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_ipv6_unmb
operator|->
name|downstream_interface
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|tlv_tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_ipv6_unmb_t
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* should not happen ! - no error message - tok2str() has barked already */
break|break;
block|}
comment|/* Does the data go past the end of the TLV? */
if|if
condition|(
name|tlv_tlen
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_info_t
argument_list|)
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
comment|/* Did we capture enough for this part of the TLV? */
name|ND_TCHECK2
argument_list|(
operator|*
name|tlv_tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_info_t
argument_list|)
argument_list|)
expr_stmt|;
name|tlv_ptr
operator|.
name|lspping_tlv_downstream_map_info
operator|=
expr|\
operator|(
specifier|const
expr|struct
name|lspping_tlv_downstream_map_info_t
operator|*
operator|)
name|tlv_tptr
expr_stmt|;
comment|/* FIXME add hash-key type, depth limit, multipath processing */
name|tlv_tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_info_t
argument_list|)
expr_stmt|;
name|tlv_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_downstream_map_info_t
argument_list|)
expr_stmt|;
comment|/* FIXME print downstream labels */
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
comment|/* dump the TLV until code complete */
break|break;
case|case
name|LSPPING_TLV_BFD_DISCRIMINATOR
case|:
if|if
condition|(
name|tlv_tlen
operator|<
name|LSPPING_TLV_BFD_DISCRIMINATOR_LEN
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
else|else
block|{
name|ND_TCHECK2
argument_list|(
operator|*
name|tptr
argument_list|,
name|LSPPING_TLV_BFD_DISCRIMINATOR_LEN
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    BFD Discriminator 0x%08x"
operator|,
name|EXTRACT_32BITS
argument_list|(
name|tptr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|LSPPING_TLV_VENDOR_ENTERPRISE
case|:
block|{
name|uint32_t
name|vendor_id
decl_stmt|;
if|if
condition|(
name|tlv_tlen
operator|<
name|LSPPING_TLV_VENDOR_ENTERPRISE_LEN
condition|)
block|{
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t      TLV is too short"
operator|)
argument_list|)
expr_stmt|;
name|tlv_hexdump
operator|=
name|TRUE
expr_stmt|;
goto|goto
name|tlv_tooshort
goto|;
block|}
else|else
block|{
name|ND_TCHECK2
argument_list|(
operator|*
name|tptr
argument_list|,
name|LSPPING_TLV_VENDOR_ENTERPRISE_LEN
argument_list|)
expr_stmt|;
name|vendor_id
operator|=
name|EXTRACT_32BITS
argument_list|(
name|tlv_tptr
argument_list|)
expr_stmt|;
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t    Vendor: %s (0x%04x)"
operator|,
name|tok2str
argument_list|(
name|smi_values
argument_list|,
literal|"Unknown"
argument_list|,
name|vendor_id
argument_list|)
operator|,
name|vendor_id
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
comment|/*              *  FIXME those are the defined TLVs that lack a decoder              *  you are welcome to contribute code ;-)              */
case|case
name|LSPPING_TLV_PAD
case|:
case|case
name|LSPPING_TLV_ERROR_CODE
case|:
case|case
name|LSPPING_TLV_VENDOR_PRIVATE
case|:
default|default:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|<=
literal|1
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|tlv_tptr
argument_list|,
literal|"\n\t    "
argument_list|,
name|tlv_tlen
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* do we want to see an additionally tlv hexdump ? */
name|tlv_tooshort
label|:
if|if
condition|(
name|ndo
operator|->
name|ndo_vflag
operator|>
literal|1
operator|||
name|tlv_hexdump
operator|==
name|TRUE
condition|)
name|print_unknown_data
argument_list|(
name|ndo
argument_list|,
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
argument_list|,
literal|"\n\t    "
argument_list|,
name|lspping_tlv_len
argument_list|)
expr_stmt|;
comment|/* All TLVs are aligned to four octet boundary */
if|if
condition|(
name|lspping_tlv_len
operator|%
literal|4
condition|)
block|{
name|lspping_tlv_len
operator|+=
operator|(
literal|4
operator|-
name|lspping_tlv_len
operator|%
literal|4
operator|)
expr_stmt|;
comment|/* Does the TLV, including padding, go past the end of the packet? */
if|if
condition|(
name|tlen
operator|<
name|lspping_tlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
condition|)
goto|goto
name|tooshort
goto|;
block|}
name|tptr
operator|+=
name|lspping_tlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
name|tlen
operator|-=
name|lspping_tlv_len
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|lspping_tlv_header
argument_list|)
expr_stmt|;
block|}
return|return;
name|tooshort
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t packet is too short"
operator|)
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|ND_PRINT
argument_list|(
operator|(
name|ndo
operator|,
literal|"\n\t\t packet exceeded snapshot"
operator|)
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * c-style: whitesmith  * c-basic-offset: 8  * End:  */
end_comment

end_unit

