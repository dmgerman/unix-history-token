begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1991, 1993, 1994, 1995, 1996, 1997  *      The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code distributions  * retain the above copyright notice and this paragraph in its entirety, (2)  * distributions including binary code include the above copyright notice and  * this paragraph in its entirety in the documentation or other materials  * provided with the distribution, and (3) all advertising materials mentioning  * features or use of this software display the following acknowledgement:  * ``This product includes software developed by the University of California,  * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of  * the University nor the names of its contributors may be used to endorse  * or promote products derived from this software without specific prior  * written permission.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED  * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF  * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  *  * L2TP support contributed by Motonori Shindo (mshindo@mshindo.net)  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
name|_U_
init|=
literal|"@(#) $Header: /tcpdump/master/tcpdump/print-l2tp.c,v 1.17.2.2 2005/04/20 21:50:16 guy Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"l2tp.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_decl_stmt
specifier|static
name|char
name|tstr
index|[]
init|=
literal|" [|l2tp]"
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|TRUE
end_ifndef

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|FALSE
end_ifndef

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_SCCRQ
value|1
end_define

begin_comment
comment|/* Start-Control-Connection-Request */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_SCCRP
value|2
end_define

begin_comment
comment|/* Start-Control-Connection-Reply */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_SCCCN
value|3
end_define

begin_comment
comment|/* Start-Control-Connection-Connected */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_STOPCCN
value|4
end_define

begin_comment
comment|/* Stop-Control-Connection-Notification */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_HELLO
value|6
end_define

begin_comment
comment|/* Hello */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_OCRQ
value|7
end_define

begin_comment
comment|/* Outgoing-Call-Request */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_OCRP
value|8
end_define

begin_comment
comment|/* Outgoing-Call-Reply */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_OCCN
value|9
end_define

begin_comment
comment|/* Outgoing-Call-Connected */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_ICRQ
value|10
end_define

begin_comment
comment|/* Incoming-Call-Request */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_ICRP
value|11
end_define

begin_comment
comment|/* Incoming-Call-Reply */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_ICCN
value|12
end_define

begin_comment
comment|/* Incoming-Call-Connected */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_CDN
value|14
end_define

begin_comment
comment|/* Call-Disconnect-Notify */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_WEN
value|15
end_define

begin_comment
comment|/* WAN-Error-Notify */
end_comment

begin_define
define|#
directive|define
name|L2TP_MSGTYPE_SLI
value|16
end_define

begin_comment
comment|/* Set-Link-Info */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tok
name|l2tp_msgtype2str
index|[]
init|=
block|{
block|{
name|L2TP_MSGTYPE_SCCRQ
block|,
literal|"SCCRQ"
block|}
block|,
block|{
name|L2TP_MSGTYPE_SCCRP
block|,
literal|"SCCRP"
block|}
block|,
block|{
name|L2TP_MSGTYPE_SCCCN
block|,
literal|"SCCCN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_STOPCCN
block|,
literal|"StopCCN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_HELLO
block|,
literal|"HELLO"
block|}
block|,
block|{
name|L2TP_MSGTYPE_OCRQ
block|,
literal|"OCRQ"
block|}
block|,
block|{
name|L2TP_MSGTYPE_OCRP
block|,
literal|"OCRP"
block|}
block|,
block|{
name|L2TP_MSGTYPE_OCCN
block|,
literal|"OCCN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_ICRQ
block|,
literal|"ICRQ"
block|}
block|,
block|{
name|L2TP_MSGTYPE_ICRP
block|,
literal|"ICRP"
block|}
block|,
block|{
name|L2TP_MSGTYPE_ICCN
block|,
literal|"ICCN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_CDN
block|,
literal|"CDN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_WEN
block|,
literal|"WEN"
block|}
block|,
block|{
name|L2TP_MSGTYPE_SLI
block|,
literal|"SLI"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|L2TP_AVP_MSGTYPE
value|0
end_define

begin_comment
comment|/* Message Type */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_RESULT_CODE
value|1
end_define

begin_comment
comment|/* Result Code */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROTO_VER
value|2
end_define

begin_comment
comment|/* Protocol Version */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_FRAMING_CAP
value|3
end_define

begin_comment
comment|/* Framing Capabilities */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_BEARER_CAP
value|4
end_define

begin_comment
comment|/* Bearer Capabilities */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_TIE_BREAKER
value|5
end_define

begin_comment
comment|/* Tie Breaker */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_FIRM_VER
value|6
end_define

begin_comment
comment|/* Firmware Revision */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_HOST_NAME
value|7
end_define

begin_comment
comment|/* Host Name */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_VENDOR_NAME
value|8
end_define

begin_comment
comment|/* Vendor Name */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_ASSND_TUN_ID
value|9
end_define

begin_comment
comment|/* Assigned Tunnel ID */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_RECV_WIN_SIZE
value|10
end_define

begin_comment
comment|/* Receive Window Size */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CHALLENGE
value|11
end_define

begin_comment
comment|/* Challenge */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_Q931_CC
value|12
end_define

begin_comment
comment|/* Q.931 Cause Code */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CHALLENGE_RESP
value|13
end_define

begin_comment
comment|/* Challenge Response */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_ASSND_SESS_ID
value|14
end_define

begin_comment
comment|/* Assigned Session ID */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CALL_SER_NUM
value|15
end_define

begin_comment
comment|/* Call Serial Number */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_MINIMUM_BPS
value|16
end_define

begin_comment
comment|/* Minimum BPS */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_MAXIMUM_BPS
value|17
end_define

begin_comment
comment|/* Maximum BPS */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_BEARER_TYPE
value|18
end_define

begin_comment
comment|/* Bearer Type */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_FRAMING_TYPE
value|19
end_define

begin_comment
comment|/* Framing Type */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PACKET_PROC_DELAY
value|20
end_define

begin_comment
comment|/* Packet Processing Delay (OBSOLETE) */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CALLED_NUMBER
value|21
end_define

begin_comment
comment|/* Called Number */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CALLING_NUMBER
value|22
end_define

begin_comment
comment|/* Calling Number */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_SUB_ADDRESS
value|23
end_define

begin_comment
comment|/* Sub-Address */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_TX_CONN_SPEED
value|24
end_define

begin_comment
comment|/* (Tx) Connect Speed */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PHY_CHANNEL_ID
value|25
end_define

begin_comment
comment|/* Physical Channel ID */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_INI_RECV_LCP
value|26
end_define

begin_comment
comment|/* Initial Received LCP CONFREQ */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_LAST_SENT_LCP
value|27
end_define

begin_comment
comment|/* Last Sent LCP CONFREQ */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_LAST_RECV_LCP
value|28
end_define

begin_comment
comment|/* Last Received LCP CONFREQ */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROXY_AUTH_TYPE
value|29
end_define

begin_comment
comment|/* Proxy Authen Type */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROXY_AUTH_NAME
value|30
end_define

begin_comment
comment|/* Proxy Authen Name */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROXY_AUTH_CHAL
value|31
end_define

begin_comment
comment|/* Proxy Authen Challenge */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROXY_AUTH_ID
value|32
end_define

begin_comment
comment|/* Proxy Authen ID */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PROXY_AUTH_RESP
value|33
end_define

begin_comment
comment|/* Proxy Authen Response */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_CALL_ERRORS
value|34
end_define

begin_comment
comment|/* Call Errors */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_ACCM
value|35
end_define

begin_comment
comment|/* ACCM */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_RANDOM_VECTOR
value|36
end_define

begin_comment
comment|/* Random Vector */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PRIVATE_GRP_ID
value|37
end_define

begin_comment
comment|/* Private Group ID */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_RX_CONN_SPEED
value|38
end_define

begin_comment
comment|/* (Rx) Connect Speed */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_SEQ_REQUIRED
value|39
end_define

begin_comment
comment|/* Sequencing Required */
end_comment

begin_define
define|#
directive|define
name|L2TP_AVP_PPP_DISCON_CC
value|46
end_define

begin_comment
comment|/* PPP Disconnect Cause Code */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tok
name|l2tp_avp2str
index|[]
init|=
block|{
block|{
name|L2TP_AVP_MSGTYPE
block|,
literal|"MSGTYPE"
block|}
block|,
block|{
name|L2TP_AVP_RESULT_CODE
block|,
literal|"RESULT_CODE"
block|}
block|,
block|{
name|L2TP_AVP_PROTO_VER
block|,
literal|"PROTO_VER"
block|}
block|,
block|{
name|L2TP_AVP_FRAMING_CAP
block|,
literal|"FRAMING_CAP"
block|}
block|,
block|{
name|L2TP_AVP_BEARER_CAP
block|,
literal|"BEARER_CAP"
block|}
block|,
block|{
name|L2TP_AVP_TIE_BREAKER
block|,
literal|"TIE_BREAKER"
block|}
block|,
block|{
name|L2TP_AVP_FIRM_VER
block|,
literal|"FIRM_VER"
block|}
block|,
block|{
name|L2TP_AVP_HOST_NAME
block|,
literal|"HOST_NAME"
block|}
block|,
block|{
name|L2TP_AVP_VENDOR_NAME
block|,
literal|"VENDOR_NAME"
block|}
block|,
block|{
name|L2TP_AVP_ASSND_TUN_ID
block|,
literal|"ASSND_TUN_ID"
block|}
block|,
block|{
name|L2TP_AVP_RECV_WIN_SIZE
block|,
literal|"RECV_WIN_SIZE"
block|}
block|,
block|{
name|L2TP_AVP_CHALLENGE
block|,
literal|"CHALLENGE"
block|}
block|,
block|{
name|L2TP_AVP_Q931_CC
block|,
literal|"Q931_CC"
block|, }
block|,
block|{
name|L2TP_AVP_CHALLENGE_RESP
block|,
literal|"CHALLENGE_RESP"
block|}
block|,
block|{
name|L2TP_AVP_ASSND_SESS_ID
block|,
literal|"ASSND_SESS_ID"
block|}
block|,
block|{
name|L2TP_AVP_CALL_SER_NUM
block|,
literal|"CALL_SER_NUM"
block|}
block|,
block|{
name|L2TP_AVP_MINIMUM_BPS
block|,
literal|"MINIMUM_BPS"
block|}
block|,
block|{
name|L2TP_AVP_MAXIMUM_BPS
block|,
literal|"MAXIMUM_BPS"
block|}
block|,
block|{
name|L2TP_AVP_BEARER_TYPE
block|,
literal|"BEARER_TYPE"
block|}
block|,
block|{
name|L2TP_AVP_FRAMING_TYPE
block|,
literal|"FRAMING_TYPE"
block|}
block|,
block|{
name|L2TP_AVP_PACKET_PROC_DELAY
block|,
literal|"PACKET_PROC_DELAY"
block|}
block|,
block|{
name|L2TP_AVP_CALLED_NUMBER
block|,
literal|"CALLED_NUMBER"
block|}
block|,
block|{
name|L2TP_AVP_CALLING_NUMBER
block|,
literal|"CALLING_NUMBER"
block|}
block|,
block|{
name|L2TP_AVP_SUB_ADDRESS
block|,
literal|"SUB_ADDRESS"
block|}
block|,
block|{
name|L2TP_AVP_TX_CONN_SPEED
block|,
literal|"TX_CONN_SPEED"
block|}
block|,
block|{
name|L2TP_AVP_PHY_CHANNEL_ID
block|,
literal|"PHY_CHANNEL_ID"
block|}
block|,
block|{
name|L2TP_AVP_INI_RECV_LCP
block|,
literal|"INI_RECV_LCP"
block|}
block|,
block|{
name|L2TP_AVP_LAST_SENT_LCP
block|,
literal|"LAST_SENT_LCP"
block|}
block|,
block|{
name|L2TP_AVP_LAST_RECV_LCP
block|,
literal|"LAST_RECV_LCP"
block|}
block|,
block|{
name|L2TP_AVP_PROXY_AUTH_TYPE
block|,
literal|"PROXY_AUTH_TYPE"
block|}
block|,
block|{
name|L2TP_AVP_PROXY_AUTH_NAME
block|,
literal|"PROXY_AUTH_NAME"
block|}
block|,
block|{
name|L2TP_AVP_PROXY_AUTH_CHAL
block|,
literal|"PROXY_AUTH_CHAL"
block|}
block|,
block|{
name|L2TP_AVP_PROXY_AUTH_ID
block|,
literal|"PROXY_AUTH_ID"
block|}
block|,
block|{
name|L2TP_AVP_PROXY_AUTH_RESP
block|,
literal|"PROXY_AUTH_RESP"
block|}
block|,
block|{
name|L2TP_AVP_CALL_ERRORS
block|,
literal|"CALL_ERRORS"
block|}
block|,
block|{
name|L2TP_AVP_ACCM
block|,
literal|"ACCM"
block|}
block|,
block|{
name|L2TP_AVP_RANDOM_VECTOR
block|,
literal|"RANDOM_VECTOR"
block|}
block|,
block|{
name|L2TP_AVP_PRIVATE_GRP_ID
block|,
literal|"PRIVATE_GRP_ID"
block|}
block|,
block|{
name|L2TP_AVP_RX_CONN_SPEED
block|,
literal|"RX_CONN_SPEED"
block|}
block|,
block|{
name|L2TP_AVP_SEQ_REQUIRED
block|,
literal|"SEQ_REQUIRED"
block|}
block|,
block|{
name|L2TP_AVP_PPP_DISCON_CC
block|,
literal|"PPP_DISCON_CC"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|l2tp_authentype2str
index|[]
init|=
block|{
block|{
name|L2TP_AUTHEN_TYPE_RESERVED
block|,
literal|"Reserved"
block|}
block|,
block|{
name|L2TP_AUTHEN_TYPE_TEXTUAL
block|,
literal|"Textual"
block|}
block|,
block|{
name|L2TP_AUTHEN_TYPE_CHAP
block|,
literal|"CHAP"
block|}
block|,
block|{
name|L2TP_AUTHEN_TYPE_PAP
block|,
literal|"PAP"
block|}
block|,
block|{
name|L2TP_AUTHEN_TYPE_NO_AUTH
block|,
literal|"No Auth"
block|}
block|,
block|{
name|L2TP_AUTHEN_TYPE_MSCHAPv1
block|,
literal|"MS-CHAPv1"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|L2TP_PPP_DISCON_CC_DIRECTION_GLOBAL
value|0
end_define

begin_define
define|#
directive|define
name|L2TP_PPP_DISCON_CC_DIRECTION_AT_PEER
value|1
end_define

begin_define
define|#
directive|define
name|L2TP_PPP_DISCON_CC_DIRECTION_AT_LOCAL
value|2
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|l2tp_cc_direction2str
index|[]
init|=
block|{
block|{
name|L2TP_PPP_DISCON_CC_DIRECTION_GLOBAL
block|,
literal|"global error"
block|}
block|,
block|{
name|L2TP_PPP_DISCON_CC_DIRECTION_AT_PEER
block|,
literal|"at peer"
block|}
block|,
block|{
name|L2TP_PPP_DISCON_CC_DIRECTION_AT_LOCAL
block|,
literal|"at local"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_result_code_StopCCN[] = {          "Reserved",          "General request to clear control connection",          "General error--Error Code indicates the problem",          "Control channel already exists",          "Requester is not authorized to establish a control channel",          "The protocol version of the requester is not supported",          "Requester is being shut down",          "Finite State Machine error"
define|#
directive|define
name|L2TP_MAX_RESULT_CODE_STOPCC_INDEX
value|8
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_result_code_CDN[] = { 	"Reserved", 	"Call disconnected due to loss of carrier", 	"Call disconnected for the reason indicated in error code", 	"Call disconnected for administrative reasons", 	"Call failed due to lack of appropriate facilities being " \ 	"available (temporary condition)", 	"Call failed due to lack of appropriate facilities being " \ 	"available (permanent condition)", 	"Invalid destination", 	"Call failed due to no carrier detected", 	"Call failed due to detection of a busy signal", 	"Call failed due to lack of a dial tone", 	"Call was not established within time allotted by LAC", 	"Call was connected but no appropriate framing was detected"
define|#
directive|define
name|L2TP_MAX_RESULT_CODE_CDN_INDEX
value|12
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
literal|0
end_if

begin_define
unit|static char *l2tp_error_code_general[] = { 	"No general error", 	"No control connection exists yet for this LAC-LNS pair", 	"Length is wrong", 	"One of the field values was out of range or " \ 	"reserved field was non-zero" 	"Insufficient resources to handle this operation now", 	"The Session ID is invalid in this context", 	"A generic vendor-specific error occurred in the LAC", 	"Try another"
define|#
directive|define
name|L2TP_MAX_ERROR_CODE_GENERAL_INDEX
value|8
end_define

begin_endif
unit|};
endif|#
directive|endif
end_endif

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* generic print out routines */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
specifier|static
name|void
name|print_string
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
operator|*
name|dat
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_octets
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%02x"
argument_list|,
operator|*
name|dat
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_16bits_val
parameter_list|(
specifier|const
name|u_int16_t
modifier|*
name|dat
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|dat
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_32bits_val
parameter_list|(
specifier|const
name|u_int32_t
modifier|*
name|dat
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%lu"
argument_list|,
operator|(
name|u_long
operator|)
name|EXTRACT_32BITS
argument_list|(
name|dat
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/* AVP-specific print out routines */
end_comment

begin_comment
comment|/***********************************/
end_comment

begin_function
specifier|static
name|void
name|l2tp_msgtype_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tok2str
argument_list|(
name|l2tp_msgtype2str
argument_list|,
literal|"MSGTYPE-#%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_result_code_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
comment|/* Result Code */
if|if
condition|(
name|length
operator|>
literal|2
condition|)
block|{
comment|/* Error Code (opt) */
name|printf
argument_list|(
literal|"/%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|length
operator|>
literal|4
condition|)
block|{
comment|/* Error Message (opt) */
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
literal|4
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proto_ver_print
parameter_list|(
specifier|const
name|u_int16_t
modifier|*
name|dat
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%u.%u"
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|dat
argument_list|)
operator|>>
literal|8
operator|)
argument_list|,
operator|(
name|EXTRACT_16BITS
argument_list|(
name|dat
argument_list|)
operator|&
literal|0xff
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_framing_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int32_t
modifier|*
name|ptr
init|=
operator|(
name|u_int32_t
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_CAP_ASYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_CAP_SYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_bearer_cap_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int32_t
modifier|*
name|ptr
init|=
operator|(
name|u_int32_t
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_CAP_ANALOG_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_CAP_DIGITAL_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_q931_cc_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|print_16bits_val
argument_list|(
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", %02x"
argument_list|,
name|dat
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
literal|3
condition|)
block|{
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
name|dat
operator|+
literal|3
argument_list|,
name|length
operator|-
literal|3
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_bearer_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int32_t
modifier|*
name|ptr
init|=
operator|(
name|u_int32_t
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_TYPE_ANALOG_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_BEARER_TYPE_DIGITAL_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_framing_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int32_t
modifier|*
name|ptr
init|=
operator|(
name|u_int32_t
operator|*
operator|)
name|dat
decl_stmt|;
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_TYPE_ASYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FRAMING_TYPE_SYNC_MASK
condition|)
block|{
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_packet_proc_delay_print
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"obsolete"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_type_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tok2str
argument_list|(
name|l2tp_authentype2str
argument_list|,
literal|"AuthType-#%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_proxy_auth_id_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_PROXY_AUTH_ID_MASK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_call_errors_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|u_int16_t
name|val_h
decl_stmt|,
name|val_l
decl_stmt|;
name|ptr
operator|++
expr_stmt|;
comment|/* skip "Reserved" */
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"CRCErr=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"FrameErr=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"HardOver=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"BufOver=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"Timeout=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"AlignErr=%u "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_accm_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|u_int16_t
name|val_h
decl_stmt|,
name|val_l
decl_stmt|;
name|ptr
operator|++
expr_stmt|;
comment|/* skip "Reserved" */
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"send=%08x "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
name|val_h
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|val_l
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"recv=%08x "
argument_list|,
operator|(
name|val_h
operator|<<
literal|16
operator|)
operator|+
name|val_l
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_ppp_discon_cc_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|printf
argument_list|(
literal|"%04x, "
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
comment|/* Disconnect Code */
name|printf
argument_list|(
literal|"%04x "
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
comment|/* Control Protocol Number */
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tok2str
argument_list|(
name|l2tp_cc_direction2str
argument_list|,
literal|"Direction-#%u"
argument_list|,
operator|*
operator|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
operator|++
operator|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
literal|5
condition|)
block|{
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|print_string
argument_list|(
operator|(
specifier|const
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
literal|5
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|l2tp_avp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|int
name|length
parameter_list|)
block|{
name|u_int
name|len
decl_stmt|;
specifier|const
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|u_int16_t
name|attr_type
decl_stmt|;
name|int
name|hidden
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|length
operator|<=
literal|0
condition|)
block|{
return|return;
block|}
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Flags& Length */
name|len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_LEN_MASK
expr_stmt|;
comment|/* If it is not long enough to contain the header, we'll give up. */
if|if
condition|(
name|len
operator|<
literal|6
condition|)
goto|goto
name|trunc
goto|;
comment|/* If it goes past the end of the remaining length of the packet, 	   we'll give up. */
if|if
condition|(
name|len
operator|>
operator|(
name|u_int
operator|)
name|length
condition|)
goto|goto
name|trunc
goto|;
comment|/* If it goes past the end of the remaining length of the captured 	   data, we'll give up. */
name|TCHECK2
argument_list|(
operator|*
name|ptr
argument_list|,
name|len
argument_list|)
expr_stmt|;
comment|/* After this point, no need to worry about truncation */
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_FLAG_MANDATORY
condition|)
block|{
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_AVP_HDR_FLAG_HIDDEN
condition|)
block|{
name|hidden
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"?"
argument_list|)
expr_stmt|;
block|}
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
condition|)
block|{
comment|/* Vendor Specific Attribute */
name|printf
argument_list|(
literal|"VENDOR%04x:"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"ATTR%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|print_octets
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* IETF-defined Attributes */
name|ptr
operator|++
expr_stmt|;
name|attr_type
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tok2str
argument_list|(
name|l2tp_avp2str
argument_list|,
literal|"AVP-#%u"
argument_list|,
name|attr_type
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
if|if
condition|(
name|hidden
condition|)
block|{
name|printf
argument_list|(
literal|"???"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
switch|switch
condition|(
name|attr_type
condition|)
block|{
case|case
name|L2TP_AVP_MSGTYPE
case|:
name|l2tp_msgtype_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_RESULT_CODE
case|:
name|l2tp_result_code_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_PROTO_VER
case|:
name|l2tp_proto_ver_print
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_FRAMING_CAP
case|:
name|l2tp_framing_cap_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_BEARER_CAP
case|:
name|l2tp_bearer_cap_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_TIE_BREAKER
case|:
name|print_octets
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
literal|8
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_FIRM_VER
case|:
case|case
name|L2TP_AVP_ASSND_TUN_ID
case|:
case|case
name|L2TP_AVP_RECV_WIN_SIZE
case|:
case|case
name|L2TP_AVP_ASSND_SESS_ID
case|:
name|print_16bits_val
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_HOST_NAME
case|:
case|case
name|L2TP_AVP_VENDOR_NAME
case|:
case|case
name|L2TP_AVP_CALLING_NUMBER
case|:
case|case
name|L2TP_AVP_CALLED_NUMBER
case|:
case|case
name|L2TP_AVP_SUB_ADDRESS
case|:
case|case
name|L2TP_AVP_PROXY_AUTH_NAME
case|:
case|case
name|L2TP_AVP_PRIVATE_GRP_ID
case|:
name|print_string
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_CHALLENGE
case|:
case|case
name|L2TP_AVP_INI_RECV_LCP
case|:
case|case
name|L2TP_AVP_LAST_SENT_LCP
case|:
case|case
name|L2TP_AVP_LAST_RECV_LCP
case|:
case|case
name|L2TP_AVP_PROXY_AUTH_CHAL
case|:
case|case
name|L2TP_AVP_PROXY_AUTH_RESP
case|:
case|case
name|L2TP_AVP_RANDOM_VECTOR
case|:
name|print_octets
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_Q931_CC
case|:
name|l2tp_q931_cc_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_CHALLENGE_RESP
case|:
name|print_octets
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_CALL_SER_NUM
case|:
case|case
name|L2TP_AVP_MINIMUM_BPS
case|:
case|case
name|L2TP_AVP_MAXIMUM_BPS
case|:
case|case
name|L2TP_AVP_TX_CONN_SPEED
case|:
case|case
name|L2TP_AVP_PHY_CHANNEL_ID
case|:
case|case
name|L2TP_AVP_RX_CONN_SPEED
case|:
name|print_32bits_val
argument_list|(
operator|(
name|u_int32_t
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_BEARER_TYPE
case|:
name|l2tp_bearer_type_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_FRAMING_TYPE
case|:
name|l2tp_framing_type_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_PACKET_PROC_DELAY
case|:
name|l2tp_packet_proc_delay_print
argument_list|()
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_PROXY_AUTH_TYPE
case|:
name|l2tp_proxy_auth_type_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_PROXY_AUTH_ID
case|:
name|l2tp_proxy_auth_id_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_CALL_ERRORS
case|:
name|l2tp_call_errors_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_ACCM
case|:
name|l2tp_accm_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|L2TP_AVP_SEQ_REQUIRED
case|:
break|break;
comment|/* No Attribute Value */
case|case
name|L2TP_AVP_PPP_DISCON_CC
case|:
name|l2tp_ppp_discon_cc_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|len
operator|-
literal|6
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
name|printf
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
name|l2tp_avp_print
argument_list|(
name|dat
operator|+
name|len
argument_list|,
name|length
operator|-
name|len
argument_list|)
expr_stmt|;
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"|..."
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|l2tp_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|dat
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
specifier|const
name|u_int16_t
modifier|*
name|ptr
init|=
operator|(
name|u_int16_t
operator|*
operator|)
name|dat
decl_stmt|;
name|u_int
name|cnt
init|=
literal|0
decl_stmt|;
comment|/* total octets consumed */
name|u_int16_t
name|pad
decl_stmt|;
name|int
name|flag_t
decl_stmt|,
name|flag_l
decl_stmt|,
name|flag_s
decl_stmt|,
name|flag_o
decl_stmt|;
name|u_int16_t
name|l2tp_len
decl_stmt|;
name|flag_t
operator|=
name|flag_l
operator|=
name|flag_s
operator|=
name|flag_o
operator|=
name|FALSE
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Flags& Version */
if|if
condition|(
operator|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_VERSION_MASK
operator|)
operator|==
name|L2TP_VERSION_L2TP
condition|)
block|{
name|printf
argument_list|(
literal|" l2tp:"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_VERSION_MASK
operator|)
operator|==
name|L2TP_VERSION_L2F
condition|)
block|{
name|printf
argument_list|(
literal|" l2f:"
argument_list|)
expr_stmt|;
return|return;
comment|/* nothing to do */
block|}
else|else
block|{
name|printf
argument_list|(
literal|" Unknown Version, neither L2F(1) nor L2TP(2)"
argument_list|)
expr_stmt|;
return|return;
comment|/* nothing we can do */
block|}
name|printf
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_TYPE
condition|)
block|{
name|flag_t
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"T"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_LENGTH
condition|)
block|{
name|flag_l
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"L"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_SEQUENCE
condition|)
block|{
name|flag_s
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"S"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_OFFSET
condition|)
block|{
name|flag_o
operator|=
name|TRUE
expr_stmt|;
name|printf
argument_list|(
literal|"O"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
operator|&
name|L2TP_FLAG_PRIORITY
condition|)
name|printf
argument_list|(
literal|"P"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|flag_l
condition|)
block|{
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Length */
name|l2tp_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
block|}
else|else
block|{
name|l2tp_len
operator|=
literal|0
expr_stmt|;
block|}
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Tunnel ID */
name|printf
argument_list|(
literal|"(%u/"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Session ID */
name|printf
argument_list|(
literal|"%u)"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|flag_s
condition|)
block|{
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Ns */
name|printf
argument_list|(
literal|"Ns=%u,"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Nr */
name|printf
argument_list|(
literal|"Nr=%u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|cnt
operator|+=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|flag_o
condition|)
block|{
name|TCHECK
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
comment|/* Offset Size */
name|pad
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|ptr
operator|+=
name|pad
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|ptr
argument_list|)
expr_stmt|;
name|cnt
operator|+=
operator|(
literal|2
operator|+
name|pad
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|flag_l
condition|)
block|{
if|if
condition|(
name|length
operator|<
name|l2tp_len
condition|)
block|{
name|printf
argument_list|(
literal|" Length %u larger than packet"
argument_list|,
name|l2tp_len
argument_list|)
expr_stmt|;
return|return;
block|}
name|length
operator|=
name|l2tp_len
expr_stmt|;
block|}
if|if
condition|(
name|length
operator|<
name|cnt
condition|)
block|{
name|printf
argument_list|(
literal|" Length %u smaller than header length"
argument_list|,
name|length
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|flag_t
condition|)
block|{
if|if
condition|(
operator|!
name|flag_l
condition|)
block|{
name|printf
argument_list|(
literal|" No length"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|length
operator|-
name|cnt
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" ZLB"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|l2tp_avp_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
name|cnt
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|printf
argument_list|(
literal|" {"
argument_list|)
expr_stmt|;
name|ppp_print
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|ptr
argument_list|,
name|length
operator|-
name|cnt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|tstr
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

