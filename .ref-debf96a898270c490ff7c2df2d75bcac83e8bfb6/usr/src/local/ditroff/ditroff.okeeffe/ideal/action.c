begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"action.c	(CWI)	1.1	85/03/01"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"ideal.h"
end_include

begin_include
include|#
directive|include
file|"y.tab.h"
end_include

begin_function
name|LINEPTR
name|rbuild
parameter_list|(
name|noadtree
parameter_list|,
name|linelist
parameter_list|)
name|NOADPTR
name|noadtree
decl_stmt|;
name|LINEPTR
name|linelist
decl_stmt|;
block|{
name|STMTPTR
name|slist
index|[
literal|2
index|]
decl_stmt|;
name|STMTPTR
name|curstmt
decl_stmt|,
name|opqstmt
decl_stmt|;
name|NOADPTR
name|nextnoad
decl_stmt|;
name|int
name|i
decl_stmt|;
name|slist
index|[
literal|0
index|]
operator|=
name|noadtree
operator|->
name|defnode
operator|->
name|parm
operator|->
name|stmtlist
expr_stmt|;
name|slist
index|[
literal|1
index|]
operator|=
name|findbox
argument_list|(
name|noadtree
operator|->
name|defnode
operator|->
name|parm
operator|->
name|name
argument_list|,
name|FALSE
argument_list|)
operator|->
name|stmtlist
expr_stmt|;
name|nextnoad
operator|=
name|noadtree
operator|->
name|son
expr_stmt|;
if|if
condition|(
operator|(
name|opqstmt
operator|=
name|nextstmt
argument_list|(
name|OPAQUE
argument_list|,
name|slist
index|[
literal|0
index|]
argument_list|)
operator|)
operator|||
operator|(
name|opqstmt
operator|=
name|nextstmt
argument_list|(
name|OPAQUE
argument_list|,
name|slist
index|[
literal|1
index|]
argument_list|)
operator|)
condition|)
name|linelist
operator|=
name|opqact
argument_list|(
name|opqstmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
if|if
condition|(
name|noadtree
operator|->
name|defnode
operator|->
name|parm
operator|->
name|name
operator|==
name|lookup
argument_list|(
literal|"circle"
argument_list|)
condition|)
name|linelist
operator|=
name|circact
argument_list|(
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|noadtree
operator|->
name|defnode
operator|->
name|parm
operator|->
name|name
operator|==
name|lookup
argument_list|(
literal|"arc"
argument_list|)
condition|)
name|linelist
operator|=
name|arcact
argument_list|(
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
for|for
control|(
name|curstmt
operator|=
name|slist
index|[
name|i
index|]
init|;
name|curstmt
condition|;
name|curstmt
operator|=
name|curstmt
operator|->
name|next
control|)
block|{
switch|switch
condition|(
name|curstmt
operator|->
name|kind
condition|)
block|{
case|case
literal|'='
case|:
break|break;
case|case
name|CONN
case|:
name|linelist
operator|=
name|connact
argument_list|(
operator|(
name|EXPRPTR
operator|)
name|curstmt
operator|->
name|stmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
break|break;
case|case
name|USING
case|:
name|linelist
operator|=
name|penact
argument_list|(
operator|(
name|PENPTR
operator|)
name|curstmt
operator|->
name|stmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
break|break;
case|case
name|PUT
case|:
if|if
condition|(
operator|(
operator|(
name|PUTPTR
operator|)
name|curstmt
operator|->
name|stmt
operator|)
operator|->
name|p_or_c
operator|==
name|PUT
condition|)
name|linelist
operator|=
name|rbuild
argument_list|(
name|nextnoad
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|(
name|PUTPTR
operator|)
name|curstmt
operator|->
name|stmt
operator|)
operator|->
name|p_or_c
operator|==
name|CONSTRUCT
condition|)
name|nextnoad
operator|->
name|linelist
operator|=
name|rbuild
argument_list|(
name|nextnoad
argument_list|,
name|nextnoad
operator|->
name|linelist
argument_list|)
expr_stmt|;
else|else
name|impossible
argument_list|(
literal|"rbuild (PUT)"
argument_list|)
expr_stmt|;
name|nextnoad
operator|=
name|nextnoad
operator|->
name|brother
expr_stmt|;
break|break;
case|case
name|DRAW
case|:
name|linelist
operator|=
name|drawact
argument_list|(
operator|(
name|MISCPTR
operator|)
name|curstmt
operator|->
name|stmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
break|break;
case|case
name|STRING
case|:
name|linelist
operator|=
name|stract
argument_list|(
operator|(
name|STRPTR
operator|)
name|curstmt
operator|->
name|stmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPLINE
case|:
name|linelist
operator|=
name|splact
argument_list|(
operator|(
name|EXPRPTR
operator|)
name|curstmt
operator|->
name|stmt
argument_list|,
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPAQUE
case|:
break|break;
case|case
name|BDLIST
case|:
break|break;
case|case
name|VAR
case|:
break|break;
default|default:
name|impossible
argument_list|(
literal|"rbuild"
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|linelist
operator|)
return|;
block|}
end_function

begin_function
name|LINEPTR
name|build
parameter_list|(
name|noadtree
parameter_list|,
name|linelist
parameter_list|)
name|NOADPTR
name|noadtree
decl_stmt|;
name|LINEPTR
name|linelist
decl_stmt|;
block|{
name|LINEPTR
name|retval
decl_stmt|;
if|if
condition|(
name|when_bug
operator|&
literal|040
condition|)
name|bug_on
expr_stmt|;
name|retval
operator|=
name|rbuild
argument_list|(
name|noadtree
argument_list|,
name|linelist
argument_list|)
expr_stmt|;
name|bug_off
expr_stmt|;
return|return
operator|(
name|retval
operator|)
return|;
block|}
end_function

begin_function
name|LINEPTR
name|connact
parameter_list|(
name|connstmt
parameter_list|,
name|noadtree
parameter_list|,
name|linelist
parameter_list|)
name|EXPRPTR
name|connstmt
decl_stmt|;
name|NOADPTR
name|noadtree
decl_stmt|;
name|LINEPTR
name|linelist
decl_stmt|;
block|{
name|INTLPTR
name|frompt
decl_stmt|,
name|topt
decl_stmt|;
name|LINEPTR
name|newline
decl_stmt|;
name|EXPRPTR
name|linwalk
decl_stmt|;
name|newline
operator|=
name|NULL
expr_stmt|;
name|frompt
operator|=
name|expreval
argument_list|(
name|connstmt
operator|->
name|expr
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|linwalk
operator|=
name|connstmt
operator|->
name|next
expr_stmt|;
while|while
condition|(
name|linwalk
condition|)
block|{
name|topt
operator|=
name|expreval
argument_list|(
name|linwalk
operator|->
name|expr
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
name|frompt
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|topt
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: indeterminate endpoints\n>>>conn ignored\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|newline
operator|=
name|linegen
argument_list|(
name|Re
argument_list|(
name|frompt
argument_list|)
argument_list|,
name|Im
argument_list|(
name|frompt
argument_list|)
argument_list|,
name|Re
argument_list|(
name|topt
argument_list|)
argument_list|,
name|Im
argument_list|(
name|topt
argument_list|)
argument_list|)
expr_stmt|;
name|dprintf
literal|"Adding line (%f,%f) to (%f,%f)\n"
operator|,
name|Re
argument_list|(
name|frompt
argument_list|)
operator|,
name|Im
argument_list|(
name|frompt
argument_list|)
operator|,
name|Re
argument_list|(
name|topt
argument_list|)
operator|,
name|Im
argument_list|(
name|topt
argument_list|)
block|)
empty_stmt|;
name|newline
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
name|linelist
operator|=
name|newline
expr_stmt|;
block|}
name|intlfree
argument_list|(
name|frompt
argument_list|)
expr_stmt|;
name|frompt
operator|=
name|topt
expr_stmt|;
name|linwalk
operator|=
name|linwalk
operator|->
name|next
expr_stmt|;
block|}
end_function

begin_expr_stmt
name|intlfree
argument_list|(
name|topt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|newline
operator|)
return|;
end_return

begin_macro
unit|}  LINEPTR
name|penact
argument_list|(
argument|penstmt
argument_list|,
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|PENPTR
name|penstmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|INTLPTR
name|frompt
decl_stmt|,
name|topt
decl_stmt|,
name|copies
decl_stmt|;
name|LINEPTR
name|newline
decl_stmt|;
name|frompt
operator|=
name|expreval
argument_list|(
name|penstmt
operator|->
name|from
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|topt
operator|=
name|expreval
argument_list|(
name|penstmt
operator|->
name|to
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|copies
operator|=
name|expreval
argument_list|(
name|penstmt
operator|->
name|copies
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|newline
operator|=
name|linelist
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
name|frompt
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|topt
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|copies
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: indeterminate pen\n>>>pen ignored\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|PUTNODE
name|dummyput
decl_stmt|;
name|NOADPTR
name|pennoad
decl_stmt|;
name|STMTPTR
name|ostmthead
decl_stmt|;
name|int
name|i
decl_stmt|;
name|dprintf
literal|"Drawing pen from (%f,%f) to (%f,%f)\n"
operator|,
name|Re
argument_list|(
name|frompt
argument_list|)
operator|,
name|Im
argument_list|(
name|frompt
argument_list|)
operator|,
name|Re
argument_list|(
name|topt
argument_list|)
operator|,
name|Im
argument_list|(
name|topt
argument_list|)
block|)
empty_stmt|;
comment|/* add key statements to beginning of parameter section */
name|dummyput
operator|.
name|name
operator|=
literal|0
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|=
name|penstmt
operator|->
name|pen
expr_stmt|;
name|ostmthead
operator|=
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|=
name|stmtgen
argument_list|(
literal|'='
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intlgen
argument_list|(
literal|'='
argument_list|,
operator|(
name|EXPR
operator|)
name|extlgen
argument_list|(
name|namegen
argument_list|(
name|lookup
argument_list|(
literal|"$pencnt"
argument_list|)
argument_list|)
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|fextlgen
argument_list|(
literal|0.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|=
name|stmtgen
argument_list|(
literal|'='
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intlgen
argument_list|(
literal|'='
argument_list|,
name|penstmt
operator|->
name|start
argument_list|,
name|bracket
argument_list|(
operator|(
name|EXPR
operator|)
name|intlgen
argument_list|(
literal|'/'
argument_list|,
operator|(
name|EXPR
operator|)
name|extlgen
argument_list|(
name|namegen
argument_list|(
name|lookup
argument_list|(
literal|"$pencnt"
argument_list|)
argument_list|)
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|copies
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|frompt
argument_list|,
operator|(
name|EXPR
operator|)
name|topt
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|->
name|next
operator|=
name|stmtgen
argument_list|(
literal|'='
argument_list|,
operator|(
name|char
operator|*
operator|)
name|intlgen
argument_list|(
literal|'='
argument_list|,
name|penstmt
operator|->
name|end
argument_list|,
name|bracket
argument_list|(
operator|(
name|EXPR
operator|)
name|intlgen
argument_list|(
literal|'/'
argument_list|,
operator|(
name|EXPR
operator|)
name|intlgen
argument_list|(
literal|'+'
argument_list|,
operator|(
name|EXPR
operator|)
name|extlgen
argument_list|(
name|namegen
argument_list|(
name|lookup
argument_list|(
literal|"$pencnt"
argument_list|)
argument_list|)
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|fextlgen
argument_list|(
literal|1.0
argument_list|)
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|copies
argument_list|)
argument_list|,
operator|(
name|EXPR
operator|)
name|frompt
argument_list|,
operator|(
name|EXPR
operator|)
name|topt
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|=
name|stmtgen
argument_list|(
name|VAR
argument_list|,
operator|(
name|char
operator|*
operator|)
name|namegen
argument_list|(
name|lookup
argument_list|(
literal|"$pencnt"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|=
name|ostmthead
expr_stmt|;
comment|/* make N copies */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Re
argument_list|(
name|copies
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
operator|(
call|(
name|EXTLPTR
call|)
argument_list|(
operator|(
name|INTLPTR
operator|)
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|stmt
argument_list|)
operator|->
name|right
operator|)
operator|->
name|info
operator|.
expr|const
operator|=
name|i
expr_stmt|;
name|pennoad
operator|=
name|buildnoadtree
argument_list|(
operator|&
name|dummyput
argument_list|)
expr_stmt|;
name|pennoad
operator|->
name|father
operator|=
name|noadtree
expr_stmt|;
name|eqneval
argument_list|(
name|pennoad
argument_list|)
expr_stmt|;
name|nl_eval
argument_list|()
expr_stmt|;
name|newline
operator|=
name|build
argument_list|(
name|pennoad
argument_list|,
name|newline
argument_list|)
expr_stmt|;
name|depvarkill
argument_list|()
expr_stmt|;
name|noadfree
argument_list|(
name|pennoad
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|!=
name|ostmthead
condition|)
name|impossible
argument_list|(
literal|"penact"
argument_list|)
expr_stmt|;
name|dummyput
operator|.
name|parm
operator|->
name|stmtlist
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
comment|/* will have to let garbage collector get dummyput.parm */
name|penstmt
operator|->
name|pen
operator|->
name|stmtlist
operator|=
name|ostmthead
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|intlfree
argument_list|(
name|frompt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|intlfree
argument_list|(
name|topt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|intlfree
argument_list|(
name|copies
argument_list|)
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|newline
operator|)
return|;
end_return

begin_macro
unit|}  LINEPTR
name|drawact
argument_list|(
argument|noadname
argument_list|,
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|MISCPTR
name|noadname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|NOADPTR
name|noadwalk
decl_stmt|;
name|LINEPTR
name|nuline
decl_stmt|;
for|for
control|(
name|noadwalk
operator|=
name|noadtree
operator|->
name|son
init|;
name|noadwalk
operator|&&
operator|(
name|noadwalk
operator|->
name|defnode
operator|->
name|name
operator|!=
name|noadname
operator|->
name|info
operator|)
condition|;
name|noadwalk
operator|=
name|noadwalk
operator|->
name|brother
control|)
name|dprintf
literal|"%s %s"
operator|,
name|idprint
argument_list|(
name|noadwalk
operator|->
name|defnode
operator|->
name|name
argument_list|)
operator|,
name|idprint
argument_list|(
name|noadname
operator|->
name|info
argument_list|)
block|)
end_block

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_if
if|if
condition|(
name|noadwalk
condition|)
block|{
operator|(
operator|(
name|LINEPTR
operator|)
name|tail
argument_list|(
operator|(
name|BOXPTR
operator|)
name|noadwalk
operator|->
name|linelist
argument_list|)
operator|)
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
name|nuline
operator|=
name|noadwalk
operator|->
name|linelist
expr_stmt|;
name|noadwalk
operator|->
name|linelist
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|nuline
operator|)
return|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: can't find %s to draw it\n"
argument_list|,
name|idprint
argument_list|(
name|noadname
operator|->
name|info
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|linelist
operator|)
return|;
block|}
end_if

begin_macro
unit|}  LINEPTR
name|stract
argument_list|(
argument|strstmt
argument_list|,
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|STRPTR
name|strstmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|LINEPTR
name|newline
decl_stmt|;
name|INTLPTR
name|atpt
decl_stmt|;
name|atpt
operator|=
name|expreval
argument_list|(
name|strstmt
operator|->
name|at
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
name|atpt
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: indeterminate string location\n>>>string ignored\n"
argument_list|)
expr_stmt|;
name|newline
operator|=
name|linelist
expr_stmt|;
block|}
else|else
block|{
name|dprintf
literal|"Adding string %s\n"
operator|,
name|strstmt
operator|->
name|string
block|)
empty_stmt|;
name|newline
operator|=
name|textgen
argument_list|(
name|strstmt
operator|->
name|command
argument_list|,
name|strstmt
operator|->
name|string
argument_list|,
name|Re
argument_list|(
name|atpt
argument_list|)
argument_list|,
name|Im
argument_list|(
name|atpt
argument_list|)
argument_list|)
expr_stmt|;
name|newline
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|intlfree
argument_list|(
name|atpt
argument_list|)
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|newline
operator|)
return|;
end_return

begin_macro
unit|}  LINEPTR
name|circact
argument_list|(
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|LINEPTR
name|newline
decl_stmt|;
name|INTLPTR
name|radius
decl_stmt|,
name|center
decl_stmt|;
name|radius
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"radius"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|center
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"center"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
name|radius
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|center
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: indeterminate circle\n>>>ignored\n"
argument_list|)
expr_stmt|;
name|newline
operator|=
name|linelist
expr_stmt|;
block|}
else|else
block|{
name|float
name|rad
decl_stmt|;
name|rad
operator|=
name|Re
argument_list|(
name|radius
argument_list|)
expr_stmt|;
name|dprintf
literal|"Adding circle %f %f %f\n"
operator|,
name|Re
argument_list|(
name|center
argument_list|)
operator|,
name|Im
argument_list|(
name|center
argument_list|)
operator|,
name|rad
block|)
empty_stmt|;
name|newline
operator|=
name|circgen
argument_list|(
name|Re
argument_list|(
name|center
argument_list|)
argument_list|,
name|Im
argument_list|(
name|center
argument_list|)
argument_list|,
name|rad
argument_list|)
expr_stmt|;
name|newline
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|intlfree
argument_list|(
name|radius
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|intlfree
argument_list|(
name|center
argument_list|)
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|newline
operator|)
return|;
end_return

begin_macro
unit|}  LINEPTR
name|arcact
argument_list|(
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|LINEPTR
name|newline
decl_stmt|;
name|INTLPTR
name|start
decl_stmt|,
name|center
decl_stmt|,
name|end
decl_stmt|;
name|INTLPTR
name|temp
decl_stmt|;
name|float
name|radius
decl_stmt|;
name|float
name|startang
decl_stmt|,
name|midang
decl_stmt|,
name|endang
decl_stmt|;
name|center
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"center"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|start
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"start"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|end
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"end"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|temp
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"startang"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|startang
operator|=
name|Re
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|tryfree
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|temp
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"midang"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|midang
operator|=
name|Re
argument_list|(
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|midang
operator|-
name|startang
argument_list|)
operator|<
name|EPSILON
condition|)
name|midang
operator|=
name|startang
expr_stmt|;
name|tryfree
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|temp
operator|=
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"endang"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
expr_stmt|;
name|endang
operator|=
name|Re
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|tryfree
argument_list|(
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|radflag
condition|)
block|{
name|dtor
argument_list|(
name|startang
argument_list|)
expr_stmt|;
name|dtor
argument_list|(
name|midang
argument_list|)
expr_stmt|;
name|dtor
argument_list|(
name|endang
argument_list|)
expr_stmt|;
block|}
name|startang
operator|=
name|rprin
argument_list|(
name|startang
argument_list|)
expr_stmt|;
name|midang
operator|=
name|rprin
argument_list|(
name|midang
argument_list|)
expr_stmt|;
name|endang
operator|=
name|rprin
argument_list|(
name|endang
argument_list|)
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|startang
operator|-
name|midang
argument_list|)
operator|<
name|EPSILON
operator|&&
name|startang
operator|>
name|endang
condition|)
name|endang
operator|+=
literal|2
operator|*
name|PI
expr_stmt|;
name|radius
operator|=
operator|(
call|(
name|DEPPTR
call|)
argument_list|(
name|varfind
argument_list|(
name|lookup
argument_list|(
literal|"radius"
argument_list|)
argument_list|,
name|noadtree
argument_list|)
argument_list|)
operator|->
name|left
operator|)
operator|->
name|coeff
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
name|center
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|start
argument_list|)
operator|||
operator|!
name|known
argument_list|(
name|end
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: indeterminate arc\n>>>ignored\n"
argument_list|)
expr_stmt|;
name|newline
operator|=
name|linelist
expr_stmt|;
block|}
else|else
block|{
name|angorder
argument_list|(
operator|&
name|startang
argument_list|,
name|midang
argument_list|,
operator|&
name|endang
argument_list|)
expr_stmt|;
name|dprintf
literal|"Adding arc %f %f %f %f %f\n"
operator|,
name|Re
argument_list|(
name|center
argument_list|)
operator|,
name|Im
argument_list|(
name|center
argument_list|)
operator|,
name|radius
operator|,
name|startang
operator|,
name|endang
block|)
empty_stmt|;
name|newline
operator|=
name|angularc
argument_list|(
name|Re
argument_list|(
name|center
argument_list|)
argument_list|,
name|Im
argument_list|(
name|center
argument_list|)
argument_list|,
name|radius
argument_list|,
name|startang
argument_list|,
name|endang
argument_list|)
expr_stmt|;
name|newline
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|intlfree
argument_list|(
name|center
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|intlfree
argument_list|(
name|start
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|intlfree
argument_list|(
name|end
argument_list|)
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|newline
operator|)
return|;
end_return

begin_macro
unit|}  LINEPTR
name|splact
argument_list|(
argument|splstmt
argument_list|,
argument|noadtree
argument_list|,
argument|linelist
argument_list|)
end_macro

begin_decl_stmt
name|EXPRPTR
name|splstmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|NOADPTR
name|noadtree
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LINEPTR
name|linelist
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|EXPRNODE
name|knotlist
decl_stmt|;
name|EXPRPTR
name|knotwalk
decl_stmt|;
name|EXPRPTR
name|splwalk
decl_stmt|;
name|LINEPTR
name|nuline
decl_stmt|;
if|if
condition|(
name|when_bug
operator|&
literal|0200
condition|)
name|bug_on
expr_stmt|;
name|knotwalk
operator|=
operator|&
name|knotlist
expr_stmt|;
name|knotwalk
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|splwalk
operator|=
name|splstmt
init|;
name|splwalk
condition|;
name|splwalk
operator|=
name|splwalk
operator|->
name|next
control|)
block|{
name|knotwalk
operator|->
name|next
operator|=
name|exprgen
argument_list|(
operator|(
name|EXPR
operator|)
name|expreval
argument_list|(
name|splwalk
operator|->
name|expr
argument_list|,
name|noadtree
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|known
argument_list|(
operator|(
operator|(
name|INTLPTR
operator|)
name|knotwalk
operator|->
name|next
operator|->
name|expr
operator|)
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ideal: unknown spline knot\n>>>spline ignored\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|linelist
operator|)
return|;
block|}
name|knotwalk
operator|=
name|knotwalk
operator|->
name|next
expr_stmt|;
name|dprintf
literal|"spline knot: %f %f\n"
operator|,
name|Re
argument_list|(
operator|(
operator|(
name|INTLPTR
operator|)
name|knotwalk
operator|->
name|expr
operator|)
argument_list|)
operator|,
name|Im
argument_list|(
operator|(
operator|(
name|INTLPTR
operator|)
name|knotwalk
operator|->
name|expr
operator|)
argument_list|)
block|)
empty_stmt|;
block|}
end_block

begin_expr_stmt
name|nuline
operator|=
name|splgen
argument_list|(
name|knotlist
operator|.
name|next
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|nuline
operator|->
name|next
operator|=
name|linelist
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|nuline
operator|)
return|;
end_return

unit|}
end_unit

