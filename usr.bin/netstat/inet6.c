begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	BSDI inet.c,v 2.3 1995/10/24 02:19:29 prb Exp	*/
end_comment

begin_comment
comment|/*  * Copyright (c) 1983, 1988, 1993  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the University of  *	California, Berkeley and its contributors.  * 4. Neither the name of the University nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_if
if|#
directive|if
literal|0
end_if

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_endif
unit|static char sccsid[] = "@(#)inet6.c	8.4 (Berkeley) 4/20/94";
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|INET6
end_ifdef

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/socketvar.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/protosw.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<net/route.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netinet/ip6.h>
end_include

begin_include
include|#
directive|include
file|<netinet/icmp6.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in_systm.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/in6_pcb.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/in6_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/ip6_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/pim6_var.h>
end_include

begin_include
include|#
directive|include
file|<netinet6/raw_ip6.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"netstat.h"
end_include

begin_decl_stmt
name|struct
name|socket
name|sockb
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|inet6name
parameter_list|(
name|struct
name|in6_addr
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|char
name|ntop_buf
index|[
name|INET6_ADDRSTRLEN
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|ip6nh
index|[]
init|=
block|{
literal|"hop by hop"
block|,
literal|"ICMP"
block|,
literal|"IGMP"
block|,
literal|"#3"
block|,
literal|"IP"
block|,
literal|"#5"
block|,
literal|"TCP"
block|,
literal|"#7"
block|,
literal|"#8"
block|,
literal|"#9"
block|,
literal|"#10"
block|,
literal|"#11"
block|,
literal|"#12"
block|,
literal|"#13"
block|,
literal|"#14"
block|,
literal|"#15"
block|,
literal|"#16"
block|,
literal|"UDP"
block|,
literal|"#18"
block|,
literal|"#19"
block|,
literal|"#20"
block|,
literal|"#21"
block|,
literal|"IDP"
block|,
literal|"#23"
block|,
literal|"#24"
block|,
literal|"#25"
block|,
literal|"#26"
block|,
literal|"#27"
block|,
literal|"#28"
block|,
literal|"TP"
block|,
literal|"#30"
block|,
literal|"#31"
block|,
literal|"#32"
block|,
literal|"#33"
block|,
literal|"#34"
block|,
literal|"#35"
block|,
literal|"#36"
block|,
literal|"#37"
block|,
literal|"#38"
block|,
literal|"#39"
block|,
literal|"#40"
block|,
literal|"IP6"
block|,
literal|"#42"
block|,
literal|"routing"
block|,
literal|"fragment"
block|,
literal|"#45"
block|,
literal|"#46"
block|,
literal|"#47"
block|,
literal|"#48"
block|,
literal|"#49"
block|,
literal|"ESP"
block|,
literal|"AH"
block|,
literal|"#52"
block|,
literal|"#53"
block|,
literal|"#54"
block|,
literal|"#55"
block|,
literal|"#56"
block|,
literal|"#57"
block|,
literal|"ICMP6"
block|,
literal|"no next header"
block|,
literal|"destination option"
block|,
literal|"#61"
block|,
literal|"mobility"
block|,
literal|"#63"
block|,
literal|"#64"
block|,
literal|"#65"
block|,
literal|"#66"
block|,
literal|"#67"
block|,
literal|"#68"
block|,
literal|"#69"
block|,
literal|"#70"
block|,
literal|"#71"
block|,
literal|"#72"
block|,
literal|"#73"
block|,
literal|"#74"
block|,
literal|"#75"
block|,
literal|"#76"
block|,
literal|"#77"
block|,
literal|"#78"
block|,
literal|"#79"
block|,
literal|"ISOIP"
block|,
literal|"#81"
block|,
literal|"#82"
block|,
literal|"#83"
block|,
literal|"#84"
block|,
literal|"#85"
block|,
literal|"#86"
block|,
literal|"#87"
block|,
literal|"#88"
block|,
literal|"OSPF"
block|,
literal|"#80"
block|,
literal|"#91"
block|,
literal|"#92"
block|,
literal|"#93"
block|,
literal|"#94"
block|,
literal|"#95"
block|,
literal|"#96"
block|,
literal|"Ethernet"
block|,
literal|"#98"
block|,
literal|"#99"
block|,
literal|"#100"
block|,
literal|"#101"
block|,
literal|"#102"
block|,
literal|"PIM"
block|,
literal|"#104"
block|,
literal|"#105"
block|,
literal|"#106"
block|,
literal|"#107"
block|,
literal|"#108"
block|,
literal|"#109"
block|,
literal|"#110"
block|,
literal|"#111"
block|,
literal|"#112"
block|,
literal|"#113"
block|,
literal|"#114"
block|,
literal|"#115"
block|,
literal|"#116"
block|,
literal|"#117"
block|,
literal|"#118"
block|,
literal|"#119"
block|,
literal|"#120"
block|,
literal|"#121"
block|,
literal|"#122"
block|,
literal|"#123"
block|,
literal|"#124"
block|,
literal|"#125"
block|,
literal|"#126"
block|,
literal|"#127"
block|,
literal|"#128"
block|,
literal|"#129"
block|,
literal|"#130"
block|,
literal|"#131"
block|,
literal|"#132"
block|,
literal|"#133"
block|,
literal|"#134"
block|,
literal|"#135"
block|,
literal|"#136"
block|,
literal|"#137"
block|,
literal|"#138"
block|,
literal|"#139"
block|,
literal|"#140"
block|,
literal|"#141"
block|,
literal|"#142"
block|,
literal|"#143"
block|,
literal|"#144"
block|,
literal|"#145"
block|,
literal|"#146"
block|,
literal|"#147"
block|,
literal|"#148"
block|,
literal|"#149"
block|,
literal|"#150"
block|,
literal|"#151"
block|,
literal|"#152"
block|,
literal|"#153"
block|,
literal|"#154"
block|,
literal|"#155"
block|,
literal|"#156"
block|,
literal|"#157"
block|,
literal|"#158"
block|,
literal|"#159"
block|,
literal|"#160"
block|,
literal|"#161"
block|,
literal|"#162"
block|,
literal|"#163"
block|,
literal|"#164"
block|,
literal|"#165"
block|,
literal|"#166"
block|,
literal|"#167"
block|,
literal|"#168"
block|,
literal|"#169"
block|,
literal|"#170"
block|,
literal|"#171"
block|,
literal|"#172"
block|,
literal|"#173"
block|,
literal|"#174"
block|,
literal|"#175"
block|,
literal|"#176"
block|,
literal|"#177"
block|,
literal|"#178"
block|,
literal|"#179"
block|,
literal|"#180"
block|,
literal|"#181"
block|,
literal|"#182"
block|,
literal|"#183"
block|,
literal|"#184"
block|,
literal|"#185"
block|,
literal|"#186"
block|,
literal|"#187"
block|,
literal|"#188"
block|,
literal|"#189"
block|,
literal|"#180"
block|,
literal|"#191"
block|,
literal|"#192"
block|,
literal|"#193"
block|,
literal|"#194"
block|,
literal|"#195"
block|,
literal|"#196"
block|,
literal|"#197"
block|,
literal|"#198"
block|,
literal|"#199"
block|,
literal|"#200"
block|,
literal|"#201"
block|,
literal|"#202"
block|,
literal|"#203"
block|,
literal|"#204"
block|,
literal|"#205"
block|,
literal|"#206"
block|,
literal|"#207"
block|,
literal|"#208"
block|,
literal|"#209"
block|,
literal|"#210"
block|,
literal|"#211"
block|,
literal|"#212"
block|,
literal|"#213"
block|,
literal|"#214"
block|,
literal|"#215"
block|,
literal|"#216"
block|,
literal|"#217"
block|,
literal|"#218"
block|,
literal|"#219"
block|,
literal|"#220"
block|,
literal|"#221"
block|,
literal|"#222"
block|,
literal|"#223"
block|,
literal|"#224"
block|,
literal|"#225"
block|,
literal|"#226"
block|,
literal|"#227"
block|,
literal|"#228"
block|,
literal|"#229"
block|,
literal|"#230"
block|,
literal|"#231"
block|,
literal|"#232"
block|,
literal|"#233"
block|,
literal|"#234"
block|,
literal|"#235"
block|,
literal|"#236"
block|,
literal|"#237"
block|,
literal|"#238"
block|,
literal|"#239"
block|,
literal|"#240"
block|,
literal|"#241"
block|,
literal|"#242"
block|,
literal|"#243"
block|,
literal|"#244"
block|,
literal|"#245"
block|,
literal|"#246"
block|,
literal|"#247"
block|,
literal|"#248"
block|,
literal|"#249"
block|,
literal|"#250"
block|,
literal|"#251"
block|,
literal|"#252"
block|,
literal|"#253"
block|,
literal|"#254"
block|,
literal|"#255"
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|srcrule_str
index|[]
init|=
block|{
literal|"first candidate"
block|,
literal|"same address"
block|,
literal|"appropriate scope"
block|,
literal|"deprecated address"
block|,
literal|"home address"
block|,
literal|"outgoing interface"
block|,
literal|"matching label"
block|,
literal|"public/temporary address"
block|,
literal|"alive interface"
block|,
literal|"preferred interface"
block|,
literal|"rule #10"
block|,
literal|"rule #11"
block|,
literal|"rule #12"
block|,
literal|"rule #13"
block|,
literal|"longest match"
block|,
literal|"rule #15"
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Dump IP6 statistics structure.  */
end_comment

begin_function
name|void
name|ip6_stats
parameter_list|(
name|u_long
name|off
name|__unused
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|af1
name|__unused
parameter_list|)
block|{
name|struct
name|ip6stat
name|ip6stat
decl_stmt|;
name|int
name|first
decl_stmt|,
name|i
decl_stmt|;
name|int
name|mib
index|[
literal|4
index|]
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|mib
index|[
literal|0
index|]
operator|=
name|CTL_NET
expr_stmt|;
name|mib
index|[
literal|1
index|]
operator|=
name|PF_INET6
expr_stmt|;
name|mib
index|[
literal|2
index|]
operator|=
name|IPPROTO_IPV6
expr_stmt|;
name|mib
index|[
literal|3
index|]
operator|=
name|IPV6CTL_STATS
expr_stmt|;
name|len
operator|=
sizeof|sizeof
name|ip6stat
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ip6stat
argument_list|,
literal|0
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctl
argument_list|(
name|mib
argument_list|,
literal|4
argument_list|,
operator|&
name|ip6stat
argument_list|,
operator|&
name|len
argument_list|,
operator|(
name|void
operator|*
operator|)
literal|0
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ip6stat.f || sflag<= 1) \     printf(m, (uintmax_t)ip6stat.f, plural(ip6stat.f))
define|#
directive|define
name|p1a
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ip6stat.f || sflag<= 1) \     printf(m, (uintmax_t)ip6stat.f)
name|p
argument_list|(
name|ip6s_total
argument_list|,
literal|"\t%ju total packet%s received\n"
argument_list|)
expr_stmt|;
name|p1a
argument_list|(
name|ip6s_toosmall
argument_list|,
literal|"\t%ju with size smaller than minimum\n"
argument_list|)
expr_stmt|;
name|p1a
argument_list|(
name|ip6s_tooshort
argument_list|,
literal|"\t%ju with data size< data length\n"
argument_list|)
expr_stmt|;
name|p1a
argument_list|(
name|ip6s_badoptions
argument_list|,
literal|"\t%ju with bad options\n"
argument_list|)
expr_stmt|;
name|p1a
argument_list|(
name|ip6s_badvers
argument_list|,
literal|"\t%ju with incorrect version number\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_fragments
argument_list|,
literal|"\t%ju fragment%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_fragdropped
argument_list|,
literal|"\t%ju fragment%s dropped (dup or out of space)\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_fragtimeout
argument_list|,
literal|"\t%ju fragment%s dropped after timeout\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_fragoverflow
argument_list|,
literal|"\t%ju fragment%s that exceeded limit\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_reassembled
argument_list|,
literal|"\t%ju packet%s reassembled ok\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_delivered
argument_list|,
literal|"\t%ju packet%s for this host\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_forward
argument_list|,
literal|"\t%ju packet%s forwarded\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_cantforward
argument_list|,
literal|"\t%ju packet%s not forwardable\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_redirectsent
argument_list|,
literal|"\t%ju redirect%s sent\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_localout
argument_list|,
literal|"\t%ju packet%s sent from this host\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_rawout
argument_list|,
literal|"\t%ju packet%s sent with fabricated ip header\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_odropped
argument_list|,
literal|"\t%ju output packet%s dropped due to no bufs, etc.\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_noroute
argument_list|,
literal|"\t%ju output packet%s discarded due to no route\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_fragmented
argument_list|,
literal|"\t%ju output datagram%s fragmented\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_ofragments
argument_list|,
literal|"\t%ju fragment%s created\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_cantfrag
argument_list|,
literal|"\t%ju datagram%s that can't be fragmented\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_badscope
argument_list|,
literal|"\t%ju packet%s that violated scope rules\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_notmember
argument_list|,
literal|"\t%ju multicast packet%s which we don't join\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_nxthist
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tInput histogram:\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\t\t%s: %ju\n"
argument_list|,
name|ip6nh
index|[
name|i
index|]
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_nxthist
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\tMbuf statistics:\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\t%ju one mbuf\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_m1
argument_list|)
expr_stmt|;
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|char
name|ifbuf
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_m2m
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\t\ttwo or more mbuf:\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\t\t\t%s= %ju\n"
argument_list|,
name|if_indextoname
argument_list|(
name|i
argument_list|,
name|ifbuf
argument_list|)
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_m2m
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\t\t%ju one ext mbuf\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_mext1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\t%ju two or more ext mbuf\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_mext2m
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_exthdrtoolong
argument_list|,
literal|"\t%ju packet%s whose headers are not continuous\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_nogif
argument_list|,
literal|"\t%ju tunneling packet%s that can't find gif\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ip6s_toomanyhdr
argument_list|,
literal|"\t%ju packet%s discarded because of too many headers\n"
argument_list|)
expr_stmt|;
comment|/* for debugging source address selection */
define|#
directive|define
name|PRINT_SCOPESTAT
parameter_list|(
name|s
parameter_list|,
name|i
parameter_list|)
value|do {\ 		switch(i) {
comment|/* XXX hardcoding in each case */
value|\ 		case 1:\ 			p(s, "\t\t%ju node-local%s\n");\ 			break;\ 		case 2:\ 			p(s,"\t\t%ju link-local%s\n");\ 			break;\ 		case 5:\ 			p(s,"\t\t%ju site-local%s\n");\ 			break;\ 		case 14:\ 			p(s,"\t\t%ju global%s\n");\ 			break;\ 		default:\ 			printf("\t\t%ju addresses scope=%x\n",\ 			    (uintmax_t)ip6stat.s, i);\ 		}\ 	} while (0);
name|p
argument_list|(
name|ip6s_sources_none
argument_list|,
literal|"\t%ju failure%s of source address selection\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_sameif
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tsource addresses on an outgoing I/F\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|PRINT_SCOPESTAT
argument_list|(
name|ip6s_sources_sameif
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_otherif
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tsource addresses on a non-outgoing I/F\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|PRINT_SCOPESTAT
argument_list|(
name|ip6s_sources_otherif
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_samescope
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tsource addresses of same scope\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|PRINT_SCOPESTAT
argument_list|(
name|ip6s_sources_samescope
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_otherscope
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tsource addresses of a different scope\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|PRINT_SCOPESTAT
argument_list|(
name|ip6s_sources_otherscope
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_deprecated
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tdeprecated source addresses\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|PRINT_SCOPESTAT
argument_list|(
name|ip6s_sources_deprecated
index|[
name|i
index|]
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
name|p1a
argument_list|(
name|ip6s_forward_cachehit
argument_list|,
literal|"\t%ju forward cache hit\n"
argument_list|)
expr_stmt|;
name|p1a
argument_list|(
name|ip6s_forward_cachemiss
argument_list|,
literal|"\t%ju forward cache miss\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tSource addresses selection rule applied:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ip6stat
operator|.
name|ip6s_sources_rule
index|[
name|i
index|]
condition|)
name|printf
argument_list|(
literal|"\t\t%ju %s\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|ip6stat
operator|.
name|ip6s_sources_rule
index|[
name|i
index|]
argument_list|,
name|srcrule_str
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|p
undef|#
directive|undef
name|p1a
block|}
end_function

begin_comment
comment|/*  * Dump IPv6 per-interface statistics based on RFC 2465.  */
end_comment

begin_function
name|void
name|ip6_ifstats
parameter_list|(
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|in6_ifreq
name|ifr
decl_stmt|;
name|int
name|s
decl_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ifr.ifr_ifru.ifru_stat.f || sflag<= 1) \     printf(m, (uintmax_t)ifr.ifr_ifru.ifru_stat.f, plural(ifr.ifr_ifru.ifru_stat.f))
define|#
directive|define
name|p_5
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ifr.ifr_ifru.ifru_stat.f || sflag<= 1) \     printf(m, (uintmax_t)ip6stat.f)
if|if
condition|(
operator|(
name|s
operator|=
name|socket
argument_list|(
name|AF_INET6
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"Warning: socket(AF_INET6)"
argument_list|)
expr_stmt|;
return|return;
block|}
name|strcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ip6 on %s:\n"
argument_list|,
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGIFSTAT_IN6
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"Warning: ioctl(SIOCGIFSTAT_IN6)"
argument_list|)
expr_stmt|;
goto|goto
name|end
goto|;
block|}
name|p
argument_list|(
name|ifs6_in_receive
argument_list|,
literal|"\t%ju total input datagram%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_hdrerr
argument_list|,
literal|"\t%ju datagram%s with invalid header received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_toobig
argument_list|,
literal|"\t%ju datagram%s exceeded MTU received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_noroute
argument_list|,
literal|"\t%ju datagram%s with no route received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_addrerr
argument_list|,
literal|"\t%ju datagram%s with invalid dst received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_protounknown
argument_list|,
literal|"\t%ju datagram%s with unknown proto received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_truncated
argument_list|,
literal|"\t%ju truncated datagram%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_discard
argument_list|,
literal|"\t%ju input datagram%s discarded\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_deliver
argument_list|,
literal|"\t%ju datagram%s delivered to an upper layer protocol\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_forward
argument_list|,
literal|"\t%ju datagram%s forwarded to this interface\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_request
argument_list|,
literal|"\t%ju datagram%s sent from an upper layer protocol\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_discard
argument_list|,
literal|"\t%ju total discarded output datagram%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_fragok
argument_list|,
literal|"\t%ju output datagram%s fragmented\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_fragfail
argument_list|,
literal|"\t%ju output datagram%s failed on fragment\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_fragcreat
argument_list|,
literal|"\t%ju output datagram%s succeeded on fragment\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_reass_reqd
argument_list|,
literal|"\t%ju incoming datagram%s fragmented\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_reass_ok
argument_list|,
literal|"\t%ju datagram%s reassembled\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_reass_fail
argument_list|,
literal|"\t%ju datagram%s failed on reassembly\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_mcast
argument_list|,
literal|"\t%ju multicast datagram%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_mcast
argument_list|,
literal|"\t%ju multicast datagram%s sent\n"
argument_list|)
expr_stmt|;
name|end
label|:
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|p
undef|#
directive|undef
name|p_5
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|icmp6names
index|[]
init|=
block|{
literal|"#0"
block|,
literal|"unreach"
block|,
literal|"packet too big"
block|,
literal|"time exceed"
block|,
literal|"parameter problem"
block|,
literal|"#5"
block|,
literal|"#6"
block|,
literal|"#7"
block|,
literal|"#8"
block|,
literal|"#9"
block|,
literal|"#10"
block|,
literal|"#11"
block|,
literal|"#12"
block|,
literal|"#13"
block|,
literal|"#14"
block|,
literal|"#15"
block|,
literal|"#16"
block|,
literal|"#17"
block|,
literal|"#18"
block|,
literal|"#19"
block|,
literal|"#20"
block|,
literal|"#21"
block|,
literal|"#22"
block|,
literal|"#23"
block|,
literal|"#24"
block|,
literal|"#25"
block|,
literal|"#26"
block|,
literal|"#27"
block|,
literal|"#28"
block|,
literal|"#29"
block|,
literal|"#30"
block|,
literal|"#31"
block|,
literal|"#32"
block|,
literal|"#33"
block|,
literal|"#34"
block|,
literal|"#35"
block|,
literal|"#36"
block|,
literal|"#37"
block|,
literal|"#38"
block|,
literal|"#39"
block|,
literal|"#40"
block|,
literal|"#41"
block|,
literal|"#42"
block|,
literal|"#43"
block|,
literal|"#44"
block|,
literal|"#45"
block|,
literal|"#46"
block|,
literal|"#47"
block|,
literal|"#48"
block|,
literal|"#49"
block|,
literal|"#50"
block|,
literal|"#51"
block|,
literal|"#52"
block|,
literal|"#53"
block|,
literal|"#54"
block|,
literal|"#55"
block|,
literal|"#56"
block|,
literal|"#57"
block|,
literal|"#58"
block|,
literal|"#59"
block|,
literal|"#60"
block|,
literal|"#61"
block|,
literal|"#62"
block|,
literal|"#63"
block|,
literal|"#64"
block|,
literal|"#65"
block|,
literal|"#66"
block|,
literal|"#67"
block|,
literal|"#68"
block|,
literal|"#69"
block|,
literal|"#70"
block|,
literal|"#71"
block|,
literal|"#72"
block|,
literal|"#73"
block|,
literal|"#74"
block|,
literal|"#75"
block|,
literal|"#76"
block|,
literal|"#77"
block|,
literal|"#78"
block|,
literal|"#79"
block|,
literal|"#80"
block|,
literal|"#81"
block|,
literal|"#82"
block|,
literal|"#83"
block|,
literal|"#84"
block|,
literal|"#85"
block|,
literal|"#86"
block|,
literal|"#87"
block|,
literal|"#88"
block|,
literal|"#89"
block|,
literal|"#80"
block|,
literal|"#91"
block|,
literal|"#92"
block|,
literal|"#93"
block|,
literal|"#94"
block|,
literal|"#95"
block|,
literal|"#96"
block|,
literal|"#97"
block|,
literal|"#98"
block|,
literal|"#99"
block|,
literal|"#100"
block|,
literal|"#101"
block|,
literal|"#102"
block|,
literal|"#103"
block|,
literal|"#104"
block|,
literal|"#105"
block|,
literal|"#106"
block|,
literal|"#107"
block|,
literal|"#108"
block|,
literal|"#109"
block|,
literal|"#110"
block|,
literal|"#111"
block|,
literal|"#112"
block|,
literal|"#113"
block|,
literal|"#114"
block|,
literal|"#115"
block|,
literal|"#116"
block|,
literal|"#117"
block|,
literal|"#118"
block|,
literal|"#119"
block|,
literal|"#120"
block|,
literal|"#121"
block|,
literal|"#122"
block|,
literal|"#123"
block|,
literal|"#124"
block|,
literal|"#125"
block|,
literal|"#126"
block|,
literal|"#127"
block|,
literal|"echo"
block|,
literal|"echo reply"
block|,
literal|"multicast listener query"
block|,
literal|"multicast listener report"
block|,
literal|"multicast listener done"
block|,
literal|"router solicitation"
block|,
literal|"router advertisement"
block|,
literal|"neighbor solicitation"
block|,
literal|"neighbor advertisement"
block|,
literal|"redirect"
block|,
literal|"router renumbering"
block|,
literal|"node information request"
block|,
literal|"node information reply"
block|,
literal|"inverse neighbor solicitation"
block|,
literal|"inverse neighbor advertisement"
block|,
literal|"#143"
block|,
literal|"#144"
block|,
literal|"#145"
block|,
literal|"#146"
block|,
literal|"#147"
block|,
literal|"#148"
block|,
literal|"#149"
block|,
literal|"#150"
block|,
literal|"#151"
block|,
literal|"#152"
block|,
literal|"#153"
block|,
literal|"#154"
block|,
literal|"#155"
block|,
literal|"#156"
block|,
literal|"#157"
block|,
literal|"#158"
block|,
literal|"#159"
block|,
literal|"#160"
block|,
literal|"#161"
block|,
literal|"#162"
block|,
literal|"#163"
block|,
literal|"#164"
block|,
literal|"#165"
block|,
literal|"#166"
block|,
literal|"#167"
block|,
literal|"#168"
block|,
literal|"#169"
block|,
literal|"#170"
block|,
literal|"#171"
block|,
literal|"#172"
block|,
literal|"#173"
block|,
literal|"#174"
block|,
literal|"#175"
block|,
literal|"#176"
block|,
literal|"#177"
block|,
literal|"#178"
block|,
literal|"#179"
block|,
literal|"#180"
block|,
literal|"#181"
block|,
literal|"#182"
block|,
literal|"#183"
block|,
literal|"#184"
block|,
literal|"#185"
block|,
literal|"#186"
block|,
literal|"#187"
block|,
literal|"#188"
block|,
literal|"#189"
block|,
literal|"#180"
block|,
literal|"#191"
block|,
literal|"#192"
block|,
literal|"#193"
block|,
literal|"#194"
block|,
literal|"#195"
block|,
literal|"#196"
block|,
literal|"#197"
block|,
literal|"#198"
block|,
literal|"#199"
block|,
literal|"#200"
block|,
literal|"#201"
block|,
literal|"#202"
block|,
literal|"#203"
block|,
literal|"#204"
block|,
literal|"#205"
block|,
literal|"#206"
block|,
literal|"#207"
block|,
literal|"#208"
block|,
literal|"#209"
block|,
literal|"#210"
block|,
literal|"#211"
block|,
literal|"#212"
block|,
literal|"#213"
block|,
literal|"#214"
block|,
literal|"#215"
block|,
literal|"#216"
block|,
literal|"#217"
block|,
literal|"#218"
block|,
literal|"#219"
block|,
literal|"#220"
block|,
literal|"#221"
block|,
literal|"#222"
block|,
literal|"#223"
block|,
literal|"#224"
block|,
literal|"#225"
block|,
literal|"#226"
block|,
literal|"#227"
block|,
literal|"#228"
block|,
literal|"#229"
block|,
literal|"#230"
block|,
literal|"#231"
block|,
literal|"#232"
block|,
literal|"#233"
block|,
literal|"#234"
block|,
literal|"#235"
block|,
literal|"#236"
block|,
literal|"#237"
block|,
literal|"#238"
block|,
literal|"#239"
block|,
literal|"#240"
block|,
literal|"#241"
block|,
literal|"#242"
block|,
literal|"#243"
block|,
literal|"#244"
block|,
literal|"#245"
block|,
literal|"#246"
block|,
literal|"#247"
block|,
literal|"#248"
block|,
literal|"#249"
block|,
literal|"#250"
block|,
literal|"#251"
block|,
literal|"#252"
block|,
literal|"#253"
block|,
literal|"#254"
block|,
literal|"#255"
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Dump ICMP6 statistics.  */
end_comment

begin_function
name|void
name|icmp6_stats
parameter_list|(
name|u_long
name|off
name|__unused
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|af1
name|__unused
parameter_list|)
block|{
name|struct
name|icmp6stat
name|icmp6stat
decl_stmt|;
name|int
name|i
decl_stmt|,
name|first
decl_stmt|;
name|int
name|mib
index|[
literal|4
index|]
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|mib
index|[
literal|0
index|]
operator|=
name|CTL_NET
expr_stmt|;
name|mib
index|[
literal|1
index|]
operator|=
name|PF_INET6
expr_stmt|;
name|mib
index|[
literal|2
index|]
operator|=
name|IPPROTO_ICMPV6
expr_stmt|;
name|mib
index|[
literal|3
index|]
operator|=
name|ICMPV6CTL_STATS
expr_stmt|;
name|len
operator|=
sizeof|sizeof
name|icmp6stat
expr_stmt|;
name|memset
argument_list|(
operator|&
name|icmp6stat
argument_list|,
literal|0
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctl
argument_list|(
name|mib
argument_list|,
literal|4
argument_list|,
operator|&
name|icmp6stat
argument_list|,
operator|&
name|len
argument_list|,
operator|(
name|void
operator|*
operator|)
literal|0
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (icmp6stat.f || sflag<= 1) \     printf(m, (uintmax_t)icmp6stat.f, plural(icmp6stat.f))
define|#
directive|define
name|p_5
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|printf(m, (uintmax_t)icmp6stat.f)
name|p
argument_list|(
name|icp6s_error
argument_list|,
literal|"\t%ju call%s to icmp6_error\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_canterror
argument_list|,
literal|"\t%ju error%s not generated in response to an icmp6 message\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_toofreq
argument_list|,
literal|"\t%ju error%s not generated because of rate limitation\n"
argument_list|)
expr_stmt|;
define|#
directive|define
name|NELEM
value|(int)(sizeof(icmp6stat.icp6s_outhist)/sizeof(icmp6stat.icp6s_outhist[0]))
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NELEM
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|icmp6stat
operator|.
name|icp6s_outhist
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tOutput histogram:\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\t\t%s: %ju\n"
argument_list|,
name|icmp6names
index|[
name|i
index|]
argument_list|,
operator|(
name|uintmax_t
operator|)
name|icmp6stat
operator|.
name|icp6s_outhist
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|NELEM
name|p
argument_list|(
name|icp6s_badcode
argument_list|,
literal|"\t%ju message%s with bad code fields\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_tooshort
argument_list|,
literal|"\t%ju message%s< minimum length\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_checksum
argument_list|,
literal|"\t%ju bad checksum%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badlen
argument_list|,
literal|"\t%ju message%s with bad length\n"
argument_list|)
expr_stmt|;
define|#
directive|define
name|NELEM
value|(int)(sizeof(icmp6stat.icp6s_inhist)/sizeof(icmp6stat.icp6s_inhist[0]))
for|for
control|(
name|first
operator|=
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NELEM
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|icmp6stat
operator|.
name|icp6s_inhist
index|[
name|i
index|]
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"\tInput histogram:\n"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\t\t%s: %ju\n"
argument_list|,
name|icmp6names
index|[
name|i
index|]
argument_list|,
operator|(
name|uintmax_t
operator|)
name|icmp6stat
operator|.
name|icp6s_inhist
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|NELEM
name|printf
argument_list|(
literal|"\tHistogram of error messages to be generated:\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_odst_unreach_noroute
argument_list|,
literal|"\t\t%ju no route\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_odst_unreach_admin
argument_list|,
literal|"\t\t%ju administratively prohibited\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_odst_unreach_beyondscope
argument_list|,
literal|"\t\t%ju beyond scope\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_odst_unreach_addr
argument_list|,
literal|"\t\t%ju address unreachable\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_odst_unreach_noport
argument_list|,
literal|"\t\t%ju port unreachable\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_opacket_too_big
argument_list|,
literal|"\t\t%ju packet too big\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_otime_exceed_transit
argument_list|,
literal|"\t\t%ju time exceed transit\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_otime_exceed_reassembly
argument_list|,
literal|"\t\t%ju time exceed reassembly\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_oparamprob_header
argument_list|,
literal|"\t\t%ju erroneous header field\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_oparamprob_nextheader
argument_list|,
literal|"\t\t%ju unrecognized next header\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_oparamprob_option
argument_list|,
literal|"\t\t%ju unrecognized option\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_oredirect
argument_list|,
literal|"\t\t%ju redirect\n"
argument_list|)
expr_stmt|;
name|p_5
argument_list|(
name|icp6s_ounknown
argument_list|,
literal|"\t\t%ju unknown\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_reflect
argument_list|,
literal|"\t%ju message response%s generated\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_nd_toomanyopt
argument_list|,
literal|"\t%ju message%s with too many ND options\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_nd_badopt
argument_list|,
literal|"\t%ju message%s with bad ND options\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badns
argument_list|,
literal|"\t%ju bad neighbor solicitation message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badna
argument_list|,
literal|"\t%ju bad neighbor advertisement message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badrs
argument_list|,
literal|"\t%ju bad router solicitation message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badra
argument_list|,
literal|"\t%ju bad router advertisement message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_badredirect
argument_list|,
literal|"\t%ju bad redirect message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|icp6s_pmtuchg
argument_list|,
literal|"\t%ju path MTU change%s\n"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|p
undef|#
directive|undef
name|p_5
block|}
end_function

begin_comment
comment|/*  * Dump ICMPv6 per-interface statistics based on RFC 2466.  */
end_comment

begin_function
name|void
name|icmp6_ifstats
parameter_list|(
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|in6_ifreq
name|ifr
decl_stmt|;
name|int
name|s
decl_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ifr.ifr_ifru.ifru_icmp6stat.f || sflag<= 1) \     printf(m, (uintmax_t)ifr.ifr_ifru.ifru_icmp6stat.f, plural(ifr.ifr_ifru.ifru_icmp6stat.f))
define|#
directive|define
name|p2
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (ifr.ifr_ifru.ifru_icmp6stat.f || sflag<= 1) \     printf(m, (uintmax_t)ifr.ifr_ifru.ifru_icmp6stat.f, pluralies(ifr.ifr_ifru.ifru_icmp6stat.f))
if|if
condition|(
operator|(
name|s
operator|=
name|socket
argument_list|(
name|AF_INET6
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"Warning: socket(AF_INET6)"
argument_list|)
expr_stmt|;
return|return;
block|}
name|strcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|ifname
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"icmp6 on %s:\n"
argument_list|,
name|ifr
operator|.
name|ifr_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGIFSTAT_ICMP6
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"Warning: ioctl(SIOCGIFSTAT_ICMP6)"
argument_list|)
expr_stmt|;
goto|goto
name|end
goto|;
block|}
name|p
argument_list|(
name|ifs6_in_msg
argument_list|,
literal|"\t%ju total input message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_error
argument_list|,
literal|"\t%ju total input error message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_dstunreach
argument_list|,
literal|"\t%ju input destination unreachable error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_adminprohib
argument_list|,
literal|"\t%ju input administratively prohibited error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_timeexceed
argument_list|,
literal|"\t%ju input time exceeded error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_paramprob
argument_list|,
literal|"\t%ju input parameter problem error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_pkttoobig
argument_list|,
literal|"\t%ju input packet too big error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_echo
argument_list|,
literal|"\t%ju input echo request%s\n"
argument_list|)
expr_stmt|;
name|p2
argument_list|(
name|ifs6_in_echoreply
argument_list|,
literal|"\t%ju input echo repl%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_routersolicit
argument_list|,
literal|"\t%ju input router solicitation%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_routeradvert
argument_list|,
literal|"\t%ju input router advertisement%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_neighborsolicit
argument_list|,
literal|"\t%ju input neighbor solicitation%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_neighboradvert
argument_list|,
literal|"\t%ju input neighbor advertisement%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_redirect
argument_list|,
literal|"\t%ju input redirect%s\n"
argument_list|)
expr_stmt|;
name|p2
argument_list|(
name|ifs6_in_mldquery
argument_list|,
literal|"\t%ju input MLD quer%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_mldreport
argument_list|,
literal|"\t%ju input MLD report%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_in_mlddone
argument_list|,
literal|"\t%ju input MLD done%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_msg
argument_list|,
literal|"\t%ju total output message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_error
argument_list|,
literal|"\t%ju total output error message%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_dstunreach
argument_list|,
literal|"\t%ju output destination unreachable error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_adminprohib
argument_list|,
literal|"\t%ju output administratively prohibited error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_timeexceed
argument_list|,
literal|"\t%ju output time exceeded error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_paramprob
argument_list|,
literal|"\t%ju output parameter problem error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_pkttoobig
argument_list|,
literal|"\t%ju output packet too big error%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_echo
argument_list|,
literal|"\t%ju output echo request%s\n"
argument_list|)
expr_stmt|;
name|p2
argument_list|(
name|ifs6_out_echoreply
argument_list|,
literal|"\t%ju output echo repl%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_routersolicit
argument_list|,
literal|"\t%ju output router solicitation%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_routeradvert
argument_list|,
literal|"\t%ju output router advertisement%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_neighborsolicit
argument_list|,
literal|"\t%ju output neighbor solicitation%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_neighboradvert
argument_list|,
literal|"\t%ju output neighbor advertisement%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_redirect
argument_list|,
literal|"\t%ju output redirect%s\n"
argument_list|)
expr_stmt|;
name|p2
argument_list|(
name|ifs6_out_mldquery
argument_list|,
literal|"\t%ju output MLD quer%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_mldreport
argument_list|,
literal|"\t%ju output MLD report%s\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|ifs6_out_mlddone
argument_list|,
literal|"\t%ju output MLD done%s\n"
argument_list|)
expr_stmt|;
name|end
label|:
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|p
block|}
end_function

begin_comment
comment|/*  * Dump PIM statistics structure.  */
end_comment

begin_function
name|void
name|pim6_stats
parameter_list|(
name|u_long
name|off
name|__unused
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|af1
name|__unused
parameter_list|)
block|{
name|struct
name|pim6stat
name|pim6stat
decl_stmt|,
name|zerostat
decl_stmt|;
name|size_t
name|len
init|=
sizeof|sizeof
name|pim6stat
decl_stmt|;
comment|/* TODO put back the KVM functionality for -M switch ie coredumps. */
if|if
condition|(
name|zflag
condition|)
name|memset
argument_list|(
operator|&
name|zerostat
argument_list|,
literal|0
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctlbyname
argument_list|(
literal|"net.inet6.pim.stats"
argument_list|,
operator|&
name|pim6stat
argument_list|,
operator|&
name|len
argument_list|,
name|zflag
condition|?
operator|&
name|zerostat
else|:
name|NULL
argument_list|,
name|zflag
condition|?
name|len
else|:
literal|0
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|!=
name|ENOENT
condition|)
name|warn
argument_list|(
literal|"sysctl: net.inet6.pim.stats"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (pim6stat.f || sflag<= 1) \     printf(m, (uintmax_t)pim6stat.f, plural(pim6stat.f))
name|p
argument_list|(
name|pim6s_rcv_total
argument_list|,
literal|"\t%ju message%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_rcv_tooshort
argument_list|,
literal|"\t%ju message%s received with too few bytes\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_rcv_badsum
argument_list|,
literal|"\t%ju message%s received with bad checksum\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_rcv_badversion
argument_list|,
literal|"\t%ju message%s received with bad version\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_rcv_registers
argument_list|,
literal|"\t%ju register%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_rcv_badregisters
argument_list|,
literal|"\t%ju bad register%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|pim6s_snd_registers
argument_list|,
literal|"\t%ju register%s sent\n"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|p
block|}
end_function

begin_comment
comment|/*  * Dump raw ip6 statistics structure.  */
end_comment

begin_function
name|void
name|rip6_stats
parameter_list|(
name|u_long
name|off
name|__unused
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|af1
name|__unused
parameter_list|)
block|{
name|struct
name|rip6stat
name|rip6stat
decl_stmt|;
name|u_quad_t
name|delivered
decl_stmt|;
name|int
name|mib
index|[
literal|4
index|]
decl_stmt|;
name|size_t
name|l
decl_stmt|;
name|mib
index|[
literal|0
index|]
operator|=
name|CTL_NET
expr_stmt|;
name|mib
index|[
literal|1
index|]
operator|=
name|PF_INET6
expr_stmt|;
name|mib
index|[
literal|2
index|]
operator|=
name|IPPROTO_IPV6
expr_stmt|;
name|mib
index|[
literal|3
index|]
operator|=
name|IPV6CTL_RIP6STATS
expr_stmt|;
name|l
operator|=
sizeof|sizeof
argument_list|(
name|rip6stat
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctl
argument_list|(
name|mib
argument_list|,
literal|4
argument_list|,
operator|&
name|rip6stat
argument_list|,
operator|&
name|l
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
block|{
comment|/* Just shut up if the kernel doesn't have ipv6. */
if|if
condition|(
name|errno
operator|!=
name|ENOENT
condition|)
name|perror
argument_list|(
literal|"Warning: sysctl(net.inet6.ip6.rip6stats)"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
define|#
directive|define
name|p
parameter_list|(
name|f
parameter_list|,
name|m
parameter_list|)
value|if (rip6stat.f || sflag<= 1) \     printf(m, (uintmax_t)rip6stat.f, plural(rip6stat.f))
name|p
argument_list|(
name|rip6s_ipackets
argument_list|,
literal|"\t%ju message%s received\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_isum
argument_list|,
literal|"\t%ju checksum calcuration%s on inbound\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_badsum
argument_list|,
literal|"\t%ju message%s with bad checksum\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_nosock
argument_list|,
literal|"\t%ju message%s dropped due to no socket\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_nosockmcast
argument_list|,
literal|"\t%ju multicast message%s dropped due to no socket\n"
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_fullsock
argument_list|,
literal|"\t%ju message%s dropped due to full socket buffers\n"
argument_list|)
expr_stmt|;
name|delivered
operator|=
name|rip6stat
operator|.
name|rip6s_ipackets
operator|-
name|rip6stat
operator|.
name|rip6s_badsum
operator|-
name|rip6stat
operator|.
name|rip6s_nosock
operator|-
name|rip6stat
operator|.
name|rip6s_nosockmcast
operator|-
name|rip6stat
operator|.
name|rip6s_fullsock
expr_stmt|;
if|if
condition|(
name|delivered
operator|||
name|sflag
operator|<=
literal|1
condition|)
name|printf
argument_list|(
literal|"\t%ju delivered\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
name|delivered
argument_list|)
expr_stmt|;
name|p
argument_list|(
name|rip6s_opackets
argument_list|,
literal|"\t%ju datagram%s output\n"
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|p
block|}
end_function

begin_comment
comment|/*  * Pretty print an Internet address (net address + port).  * Take numeric_addr and numeric_port into consideration.  */
end_comment

begin_define
define|#
directive|define
name|GETSERVBYPORT6
parameter_list|(
name|port
parameter_list|,
name|proto
parameter_list|,
name|ret
parameter_list|)
define|\
value|{\ 	if (strcmp((proto), "tcp6") == 0)\ 		(ret) = getservbyport((int)(port), "tcp");\ 	else if (strcmp((proto), "udp6") == 0)\ 		(ret) = getservbyport((int)(port), "udp");\ 	else\ 		(ret) = getservbyport((int)(port), (proto));\ };
end_define

begin_function
name|void
name|inet6print
parameter_list|(
name|struct
name|in6_addr
modifier|*
name|in6
parameter_list|,
name|int
name|port
parameter_list|,
specifier|const
name|char
modifier|*
name|proto
parameter_list|,
name|int
name|numeric
parameter_list|)
block|{
name|struct
name|servent
modifier|*
name|sp
init|=
literal|0
decl_stmt|;
name|char
name|line
index|[
literal|80
index|]
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|int
name|width
decl_stmt|;
name|sprintf
argument_list|(
name|line
argument_list|,
literal|"%.*s."
argument_list|,
name|Wflag
condition|?
literal|39
else|:
operator|(
name|Aflag
operator|&&
operator|!
name|numeric
operator|)
condition|?
literal|12
else|:
literal|16
argument_list|,
name|inet6name
argument_list|(
name|in6
argument_list|)
argument_list|)
expr_stmt|;
name|cp
operator|=
name|index
argument_list|(
name|line
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|numeric
operator|&&
name|port
condition|)
name|GETSERVBYPORT6
argument_list|(
name|port
argument_list|,
name|proto
argument_list|,
name|sp
argument_list|)
expr_stmt|;
if|if
condition|(
name|sp
operator|||
name|port
operator|==
literal|0
condition|)
name|sprintf
argument_list|(
name|cp
argument_list|,
literal|"%.8s"
argument_list|,
name|sp
condition|?
name|sp
operator|->
name|s_name
else|:
literal|"*"
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|cp
argument_list|,
literal|"%d"
argument_list|,
name|ntohs
argument_list|(
operator|(
name|u_short
operator|)
name|port
argument_list|)
argument_list|)
expr_stmt|;
name|width
operator|=
name|Wflag
condition|?
literal|45
else|:
name|Aflag
condition|?
literal|18
else|:
literal|22
expr_stmt|;
name|printf
argument_list|(
literal|"%-*.*s "
argument_list|,
name|width
argument_list|,
name|width
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Construct an Internet address representation.  * If the numeric_addr has been supplied, give  * numeric value, otherwise try for symbolic name.  */
end_comment

begin_function
name|char
modifier|*
name|inet6name
parameter_list|(
name|struct
name|in6_addr
modifier|*
name|in6p
parameter_list|)
block|{
name|char
modifier|*
name|cp
decl_stmt|;
specifier|static
name|char
name|line
index|[
literal|50
index|]
decl_stmt|;
name|struct
name|hostent
modifier|*
name|hp
decl_stmt|;
specifier|static
name|char
name|domain
index|[
name|MAXHOSTNAMELEN
index|]
decl_stmt|;
specifier|static
name|int
name|first
init|=
literal|1
decl_stmt|;
if|if
condition|(
name|first
operator|&&
operator|!
name|numeric_addr
condition|)
block|{
name|first
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|gethostname
argument_list|(
name|domain
argument_list|,
name|MAXHOSTNAMELEN
argument_list|)
operator|==
literal|0
operator|&&
operator|(
name|cp
operator|=
name|index
argument_list|(
name|domain
argument_list|,
literal|'.'
argument_list|)
operator|)
condition|)
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|domain
argument_list|,
name|cp
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|domain
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
name|cp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|numeric_addr
operator|&&
operator|!
name|IN6_IS_ADDR_UNSPECIFIED
argument_list|(
name|in6p
argument_list|)
condition|)
block|{
name|hp
operator|=
name|gethostbyaddr
argument_list|(
operator|(
name|char
operator|*
operator|)
name|in6p
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|in6p
argument_list|)
argument_list|,
name|AF_INET6
argument_list|)
expr_stmt|;
if|if
condition|(
name|hp
condition|)
block|{
if|if
condition|(
operator|(
name|cp
operator|=
name|index
argument_list|(
name|hp
operator|->
name|h_name
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|&&
operator|!
name|strcmp
argument_list|(
name|cp
operator|+
literal|1
argument_list|,
name|domain
argument_list|)
condition|)
operator|*
name|cp
operator|=
literal|0
expr_stmt|;
name|cp
operator|=
name|hp
operator|->
name|h_name
expr_stmt|;
block|}
block|}
if|if
condition|(
name|IN6_IS_ADDR_UNSPECIFIED
argument_list|(
name|in6p
argument_list|)
condition|)
name|strcpy
argument_list|(
name|line
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cp
condition|)
name|strcpy
argument_list|(
name|line
argument_list|,
name|cp
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|line
argument_list|,
literal|"%s"
argument_list|,
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|(
name|void
operator|*
operator|)
name|in6p
argument_list|,
name|ntop_buf
argument_list|,
sizeof|sizeof
argument_list|(
name|ntop_buf
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|line
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*INET6*/
end_comment

end_unit

