begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * See i386-fbsd.c for copyright and license terms.  *  * System call arguments come in several flavours:  * Hex -- values that should be printed in hex (addresses)  * Octal -- Same as above, but octal  * Int -- normal integer values (file descriptors, for example)  * Name -- pointer to a NULL-terminated string.  * BinString -- pointer to an array of chars, printed via strvisx().  * Ptr -- pointer to some unspecified structure.  Just print as hex for now.  * Stat -- a pointer to a stat buffer.  Prints a couple fields.  * Ioctl -- an ioctl command.  Woefully limited.  * Quad -- a double-word value.  e.g., lseek(int, offset_t, int)  * Signal -- a signal number.  Prints the signal name (SIGxxx)  * Sockaddr -- a pointer to a struct sockaddr.  Prints symbolic AF, and IP:Port  * StringArray -- a pointer to an array of string pointers.  * Timespec -- a pointer to a struct timespec.  Prints both elements.  * Timeval -- a pointer to a struct timeval.  Prints both elements.  * Timeval2 -- a pointer to two struct timevals.  Prints both elements of both.  * Itimerval -- a pointer to a struct itimerval.  Prints all elements.  * Pollfd -- a pointer to an array of struct pollfd.  Prints .fd and .events.  * Fd_set -- a pointer to an array of fd_set.  Prints the fds that are set.  * Sigaction -- a pointer to a struct sigaction.  Prints all elements.  * Umtx -- a pointer to a struct umtx.  Prints the value of owner.  * Sigset -- a pointer to a sigset_t.  Prints the signals that are set.  * Sigprocmask -- the first argument to sigprocmask().  Prints the name.  * Kevent -- a pointer to an array of struct kevents.  Prints all elements.  * Pathconf -- the 2nd argument of patchconf().  *  * In addition, the pointer types (String, Ptr) may have OUT masked in --  * this means that the data is set on *return* from the system call -- or  * IN (meaning that the data is passed *into* the system call).  */
end_comment

begin_comment
comment|/*  * $FreeBSD$  */
end_comment

begin_enum
enum|enum
name|Argtype
block|{
name|None
init|=
literal|1
block|,
name|Hex
block|,
name|Octal
block|,
name|Int
block|,
name|Name
block|,
name|Ptr
block|,
name|Stat
block|,
name|Ioctl
block|,
name|Quad
block|,
name|Signal
block|,
name|Sockaddr
block|,
name|StringArray
block|,
name|Timespec
block|,
name|Timeval
block|,
name|Itimerval
block|,
name|Pollfd
block|,
name|Fd_set
block|,
name|Sigaction
block|,
name|Fcntl
block|,
name|Mprot
block|,
name|Mmapflags
block|,
name|Whence
block|,
name|Readlinkres
block|,
name|Umtx
block|,
name|Sigset
block|,
name|Sigprocmask
block|,
name|Kevent
block|,
name|Sockdomain
block|,
name|Socktype
block|,
name|Open
block|,
name|Fcntlflag
block|,
name|Rusage
block|,
name|BinString
block|,
name|Shutdown
block|,
name|Resource
block|,
name|Rlimit
block|,
name|Timeval2
block|,
name|Pathconf
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|ARG_MASK
value|0xff
end_define

begin_define
define|#
directive|define
name|OUT
value|0x100
end_define

begin_define
define|#
directive|define
name|IN
comment|/*0x20*/
value|0
end_define

begin_struct
struct|struct
name|syscall_args
block|{
name|enum
name|Argtype
name|type
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|syscall
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|ret_type
decl_stmt|;
comment|/* 0, 1, or 2 return values */
name|int
name|nargs
decl_stmt|;
comment|/* actual number of meaningful arguments */
comment|/* Hopefully, no syscalls with> 10 args */
name|struct
name|syscall_args
name|args
index|[
literal|10
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
name|struct
name|syscall
modifier|*
name|get_syscall
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|print_arg
parameter_list|(
name|struct
name|syscall_args
modifier|*
parameter_list|,
name|unsigned
name|long
modifier|*
parameter_list|,
name|long
parameter_list|,
name|struct
name|trussinfo
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|print_syscall
parameter_list|(
name|struct
name|trussinfo
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|print_syscall_ret
parameter_list|(
name|struct
name|trussinfo
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|,
name|int
parameter_list|,
name|long
parameter_list|)
function_decl|;
end_function_decl

end_unit

