begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 1997 Sean Eric Fagan  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by Sean Eric Fagan  * 4. Neither the name of the author may be used to endorse or promote  *    products derived from this software without specific prior written  *    permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_comment
comment|/*  * This file has routines used to print out system calls and their  * arguments.  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/mman.h>
end_include

begin_include
include|#
directive|include
file|<sys/procctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/ptrace.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/un.h>
end_include

begin_include
include|#
directive|include
file|<sys/wait.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioccom.h>
end_include

begin_include
include|#
directive|include
file|<machine/atomic.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/umtx.h>
end_include

begin_include
include|#
directive|include
file|<sys/event.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/resource.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<poll.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<vis.h>
end_include

begin_include
include|#
directive|include
file|"truss.h"
end_include

begin_include
include|#
directive|include
file|"extern.h"
end_include

begin_include
include|#
directive|include
file|"syscall.h"
end_include

begin_comment
comment|/* 64-bit alignment on 32-bit platforms. */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__powerpc__
end_ifdef

begin_define
define|#
directive|define
name|QUAD_ALIGN
value|1
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|QUAD_ALIGN
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Number of slots needed for a 64-bit argument. */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__LP64__
end_ifdef

begin_define
define|#
directive|define
name|QUAD_SLOTS
value|1
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|QUAD_SLOTS
value|2
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * This should probably be in its own file, sorted alphabetically.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|syscall
name|syscalls
index|[]
init|=
block|{
block|{
operator|.
name|name
operator|=
literal|"fcntl"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Fcntl
block|,
literal|1
block|}
block|,
block|{
name|Fcntlflag
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"fork"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"vfork"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"rfork"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Rforkflags
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getegid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"geteuid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_readlink"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Name
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_socketcall"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|LinuxSockArgs
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getgid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getpid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getpgid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getpgrp"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getppid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getsid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getuid"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|0
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"readlink"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Readlinkres
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"lseek"
block|,
operator|.
name|ret_type
operator|=
literal|2
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Quad
block|,
literal|1
operator|+
name|QUAD_ALIGN
block|}
block|,
block|{
name|Whence
block|,
literal|1
operator|+
name|QUAD_SLOTS
operator|+
name|QUAD_ALIGN
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_lseek"
block|,
operator|.
name|ret_type
operator|=
literal|2
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Whence
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"mmap"
block|,
operator|.
name|ret_type
operator|=
literal|2
block|,
operator|.
name|nargs
operator|=
literal|6
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Ptr
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Mprot
block|,
literal|2
block|}
block|,
block|{
name|Mmapflags
block|,
literal|3
block|}
block|,
block|{
name|Int
block|,
literal|4
block|}
block|,
block|{
name|Quad
block|,
literal|5
operator|+
name|QUAD_ALIGN
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_mkdir"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"mprotect"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Ptr
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Mprot
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"open"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Open
block|,
literal|1
block|}
block|,
block|{
name|Octal
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"mkdir"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Octal
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_open"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Hex
block|,
literal|1
block|}
block|,
block|{
name|Octal
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"close"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"link"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Name
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"unlink"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"chdir"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"chroot"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"mknod"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Octal
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|3
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"chmod"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Octal
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"chown"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_stat64"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Ptr
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"mount"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|4
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Name
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|,
block|{
name|Ptr
block|,
literal|3
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"umount"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"fstat"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Stat
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"stat"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Stat
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"lstat"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Stat
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_newstat"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_access"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_newfstat"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"write"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|BinString
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"ioctl"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Ioctl
block|,
literal|1
block|}
block|,
block|{
name|Hex
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"break"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Ptr
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"exit"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Hex
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"access"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"sigaction"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Signal
block|,
literal|0
block|}
block|,
block|{
name|Sigaction
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Sigaction
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"accept"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Sockaddr
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"bind"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Sockaddr
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"connect"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Sockaddr
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getpeername"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Sockaddr
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getsockname"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Sockaddr
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"recvfrom"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|6
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|BinString
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|,
block|{
name|Hex
block|,
literal|3
block|}
block|,
block|{
name|Sockaddr
operator||
name|OUT
block|,
literal|4
block|}
block|,
block|{
name|Ptr
operator||
name|OUT
block|,
literal|5
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"sendto"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|6
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|BinString
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|,
block|{
name|Hex
block|,
literal|3
block|}
block|,
block|{
name|Sockaddr
operator||
name|IN
block|,
literal|4
block|}
block|,
block|{
name|Ptr
operator||
name|IN
block|,
literal|5
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"execve"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|StringArray
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|StringArray
operator||
name|IN
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"linux_execve"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|StringArray
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|StringArray
operator||
name|IN
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldload"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldunload"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldfind"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldnext"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldstat"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Ptr
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kldfirstmod"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"nanosleep"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Timespec
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"select"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|5
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Fd_set
block|,
literal|1
block|}
block|,
block|{
name|Fd_set
block|,
literal|2
block|}
block|,
block|{
name|Fd_set
block|,
literal|3
block|}
block|,
block|{
name|Timeval
block|,
literal|4
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"poll"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Pollfd
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"gettimeofday"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Timeval
operator||
name|OUT
block|,
literal|0
block|}
block|,
block|{
name|Ptr
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"clock_gettime"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Timespec
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getitimer"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Itimerval
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"setitimer"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Itimerval
block|,
literal|1
block|}
block|,
block|{
name|Itimerval
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kse_release"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Timespec
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kevent"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|6
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Kevent
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|,
block|{
name|Kevent
operator||
name|OUT
block|,
literal|3
block|}
block|,
block|{
name|Int
block|,
literal|4
block|}
block|,
block|{
name|Timespec
block|,
literal|5
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"sigprocmask"
block|,
operator|.
name|ret_type
operator|=
literal|0
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Sigprocmask
block|,
literal|0
block|}
block|,
block|{
name|Sigset
block|,
literal|1
block|}
block|,
block|{
name|Sigset
operator||
name|OUT
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"unmount"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"socket"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Sockdomain
block|,
literal|0
block|}
block|,
block|{
name|Socktype
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getrusage"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Rusage
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"__getcwd"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|OUT
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"shutdown"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Shutdown
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"getrlimit"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Resource
block|,
literal|0
block|}
block|,
block|{
name|Rlimit
operator||
name|OUT
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"setrlimit"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Resource
block|,
literal|0
block|}
block|,
block|{
name|Rlimit
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"utimes"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Timeval2
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"lutimes"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Timeval2
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"futimes"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|Timeval
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"chflags"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Hex
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"lchflags"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Hex
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"pathconf"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Pathconf
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"pipe"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Ptr
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"truncate"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Int
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Quad
operator||
name|IN
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"ftruncate"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Int
operator||
name|IN
block|,
literal|1
block|}
block|,
block|{
name|Quad
operator||
name|IN
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"kill"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
operator||
name|IN
block|,
literal|0
block|}
block|,
block|{
name|Signal
operator||
name|IN
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"munmap"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Ptr
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"read"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|3
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|BinString
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Int
block|,
literal|2
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"rename"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Name
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"symlink"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|2
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Name
block|,
literal|0
block|}
block|,
block|{
name|Name
block|,
literal|1
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"posix_openpt"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|1
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Open
block|,
literal|0
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"wait4"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|4
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Int
block|,
literal|0
block|}
block|,
block|{
name|ExitStatus
operator||
name|OUT
block|,
literal|1
block|}
block|,
block|{
name|Waitoptions
block|,
literal|2
block|}
block|,
block|{
name|Rusage
operator||
name|OUT
block|,
literal|3
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"wait6"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|6
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Idtype
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|ExitStatus
operator||
name|OUT
block|,
literal|2
block|}
block|,
block|{
name|Waitoptions
block|,
literal|3
block|}
block|,
block|{
name|Rusage
operator||
name|OUT
block|,
literal|4
block|}
block|,
block|{
name|Ptr
block|,
literal|5
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|"procctl"
block|,
operator|.
name|ret_type
operator|=
literal|1
block|,
operator|.
name|nargs
operator|=
literal|4
block|,
operator|.
name|args
operator|=
block|{
block|{
name|Idtype
block|,
literal|0
block|}
block|,
block|{
name|Int
block|,
literal|1
block|}
block|,
block|{
name|Procctl
block|,
literal|2
block|}
block|,
block|{
name|Ptr
block|,
literal|3
block|}
block|}
block|}
block|,
block|{
operator|.
name|name
operator|=
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Xlat idea taken from strace */
end_comment

begin_struct
struct|struct
name|xlat
block|{
name|int
name|val
decl_stmt|;
specifier|const
name|char
modifier|*
name|str
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|X
parameter_list|(
name|a
parameter_list|)
value|{ a, #a },
end_define

begin_define
define|#
directive|define
name|XEND
value|{ 0, NULL }
end_define

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|kevent_filters
index|[]
init|=
block|{
name|X
argument_list|(
argument|EVFILT_READ
argument_list|)
name|X
argument_list|(
argument|EVFILT_WRITE
argument_list|)
name|X
argument_list|(
argument|EVFILT_AIO
argument_list|)
name|X
argument_list|(
argument|EVFILT_VNODE
argument_list|)
name|X
argument_list|(
argument|EVFILT_PROC
argument_list|)
name|X
argument_list|(
argument|EVFILT_SIGNAL
argument_list|)
name|X
argument_list|(
argument|EVFILT_TIMER
argument_list|)
name|X
argument_list|(
argument|EVFILT_FS
argument_list|)
name|X
argument_list|(
argument|EVFILT_READ
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|kevent_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|EV_ADD
argument_list|)
name|X
argument_list|(
argument|EV_DELETE
argument_list|)
name|X
argument_list|(
argument|EV_ENABLE
argument_list|)
name|X
argument_list|(
argument|EV_DISABLE
argument_list|)
name|X
argument_list|(
argument|EV_ONESHOT
argument_list|)
name|X
argument_list|(
argument|EV_CLEAR
argument_list|)
name|X
argument_list|(
argument|EV_FLAG1
argument_list|)
name|X
argument_list|(
argument|EV_ERROR
argument_list|)
name|X
argument_list|(
argument|EV_EOF
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|poll_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|POLLSTANDARD
argument_list|)
name|X
argument_list|(
argument|POLLIN
argument_list|)
name|X
argument_list|(
argument|POLLPRI
argument_list|)
name|X
argument_list|(
argument|POLLOUT
argument_list|)
name|X
argument_list|(
argument|POLLERR
argument_list|)
name|X
argument_list|(
argument|POLLHUP
argument_list|)
name|X
argument_list|(
argument|POLLNVAL
argument_list|)
name|X
argument_list|(
argument|POLLRDNORM
argument_list|)
name|X
argument_list|(
argument|POLLRDBAND
argument_list|)
name|X
argument_list|(
argument|POLLWRBAND
argument_list|)
name|X
argument_list|(
argument|POLLINIGNEOF
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|mmap_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|MAP_SHARED
argument_list|)
name|X
argument_list|(
argument|MAP_PRIVATE
argument_list|)
name|X
argument_list|(
argument|MAP_FIXED
argument_list|)
name|X
argument_list|(
argument|MAP_RENAME
argument_list|)
name|X
argument_list|(
argument|MAP_NORESERVE
argument_list|)
name|X
argument_list|(
argument|MAP_RESERVED0080
argument_list|)
name|X
argument_list|(
argument|MAP_RESERVED0100
argument_list|)
name|X
argument_list|(
argument|MAP_HASSEMAPHORE
argument_list|)
name|X
argument_list|(
argument|MAP_STACK
argument_list|)
name|X
argument_list|(
argument|MAP_NOSYNC
argument_list|)
name|X
argument_list|(
argument|MAP_ANON
argument_list|)
name|X
argument_list|(
argument|MAP_NOCORE
argument_list|)
name|X
argument_list|(
argument|MAP_PREFAULT_READ
argument_list|)
ifdef|#
directive|ifdef
name|MAP_32BIT
name|X
argument_list|(
argument|MAP_32BIT
argument_list|)
endif|#
directive|endif
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|mprot_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|PROT_NONE
argument_list|)
name|X
argument_list|(
argument|PROT_READ
argument_list|)
name|X
argument_list|(
argument|PROT_WRITE
argument_list|)
name|X
argument_list|(
argument|PROT_EXEC
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|whence_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|SEEK_SET
argument_list|)
name|X
argument_list|(
argument|SEEK_CUR
argument_list|)
name|X
argument_list|(
argument|SEEK_END
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|sigaction_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|SA_ONSTACK
argument_list|)
name|X
argument_list|(
argument|SA_RESTART
argument_list|)
name|X
argument_list|(
argument|SA_RESETHAND
argument_list|)
name|X
argument_list|(
argument|SA_NOCLDSTOP
argument_list|)
name|X
argument_list|(
argument|SA_NODEFER
argument_list|)
name|X
argument_list|(
argument|SA_NOCLDWAIT
argument_list|)
name|X
argument_list|(
argument|SA_SIGINFO
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|fcntl_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|F_DUPFD
argument_list|)
name|X
argument_list|(
argument|F_GETFD
argument_list|)
name|X
argument_list|(
argument|F_SETFD
argument_list|)
name|X
argument_list|(
argument|F_GETFL
argument_list|)
name|X
argument_list|(
argument|F_SETFL
argument_list|)
name|X
argument_list|(
argument|F_GETOWN
argument_list|)
name|X
argument_list|(
argument|F_SETOWN
argument_list|)
name|X
argument_list|(
argument|F_GETLK
argument_list|)
name|X
argument_list|(
argument|F_SETLK
argument_list|)
name|X
argument_list|(
argument|F_SETLKW
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|fcntlfd_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|FD_CLOEXEC
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|fcntlfl_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|O_APPEND
argument_list|)
name|X
argument_list|(
argument|O_ASYNC
argument_list|)
name|X
argument_list|(
argument|O_FSYNC
argument_list|)
name|X
argument_list|(
argument|O_NONBLOCK
argument_list|)
name|X
argument_list|(
argument|O_NOFOLLOW
argument_list|)
name|X
argument_list|(
argument|O_DIRECT
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|sockdomain_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|PF_UNSPEC
argument_list|)
name|X
argument_list|(
argument|PF_LOCAL
argument_list|)
name|X
argument_list|(
argument|PF_UNIX
argument_list|)
name|X
argument_list|(
argument|PF_INET
argument_list|)
name|X
argument_list|(
argument|PF_IMPLINK
argument_list|)
name|X
argument_list|(
argument|PF_PUP
argument_list|)
name|X
argument_list|(
argument|PF_CHAOS
argument_list|)
name|X
argument_list|(
argument|PF_NETBIOS
argument_list|)
name|X
argument_list|(
argument|PF_ISO
argument_list|)
name|X
argument_list|(
argument|PF_OSI
argument_list|)
name|X
argument_list|(
argument|PF_ECMA
argument_list|)
name|X
argument_list|(
argument|PF_DATAKIT
argument_list|)
name|X
argument_list|(
argument|PF_CCITT
argument_list|)
name|X
argument_list|(
argument|PF_SNA
argument_list|)
name|X
argument_list|(
argument|PF_DECnet
argument_list|)
name|X
argument_list|(
argument|PF_DLI
argument_list|)
name|X
argument_list|(
argument|PF_LAT
argument_list|)
name|X
argument_list|(
argument|PF_HYLINK
argument_list|)
name|X
argument_list|(
argument|PF_APPLETALK
argument_list|)
name|X
argument_list|(
argument|PF_ROUTE
argument_list|)
name|X
argument_list|(
argument|PF_LINK
argument_list|)
name|X
argument_list|(
argument|PF_XTP
argument_list|)
name|X
argument_list|(
argument|PF_COIP
argument_list|)
name|X
argument_list|(
argument|PF_CNT
argument_list|)
name|X
argument_list|(
argument|PF_SIP
argument_list|)
name|X
argument_list|(
argument|PF_IPX
argument_list|)
name|X
argument_list|(
argument|PF_RTIP
argument_list|)
name|X
argument_list|(
argument|PF_PIP
argument_list|)
name|X
argument_list|(
argument|PF_ISDN
argument_list|)
name|X
argument_list|(
argument|PF_KEY
argument_list|)
name|X
argument_list|(
argument|PF_INET6
argument_list|)
name|X
argument_list|(
argument|PF_NATM
argument_list|)
name|X
argument_list|(
argument|PF_ATM
argument_list|)
name|X
argument_list|(
argument|PF_NETGRAPH
argument_list|)
name|X
argument_list|(
argument|PF_SLOW
argument_list|)
name|X
argument_list|(
argument|PF_SCLUSTER
argument_list|)
name|X
argument_list|(
argument|PF_ARP
argument_list|)
name|X
argument_list|(
argument|PF_BLUETOOTH
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|socktype_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|SOCK_STREAM
argument_list|)
name|X
argument_list|(
argument|SOCK_DGRAM
argument_list|)
name|X
argument_list|(
argument|SOCK_RAW
argument_list|)
name|X
argument_list|(
argument|SOCK_RDM
argument_list|)
name|X
argument_list|(
argument|SOCK_SEQPACKET
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|open_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|O_RDONLY
argument_list|)
name|X
argument_list|(
argument|O_WRONLY
argument_list|)
name|X
argument_list|(
argument|O_RDWR
argument_list|)
name|X
argument_list|(
argument|O_ACCMODE
argument_list|)
name|X
argument_list|(
argument|O_NONBLOCK
argument_list|)
name|X
argument_list|(
argument|O_APPEND
argument_list|)
name|X
argument_list|(
argument|O_SHLOCK
argument_list|)
name|X
argument_list|(
argument|O_EXLOCK
argument_list|)
name|X
argument_list|(
argument|O_ASYNC
argument_list|)
name|X
argument_list|(
argument|O_FSYNC
argument_list|)
name|X
argument_list|(
argument|O_NOFOLLOW
argument_list|)
name|X
argument_list|(
argument|O_CREAT
argument_list|)
name|X
argument_list|(
argument|O_TRUNC
argument_list|)
name|X
argument_list|(
argument|O_EXCL
argument_list|)
name|X
argument_list|(
argument|O_NOCTTY
argument_list|)
name|X
argument_list|(
argument|O_DIRECT
argument_list|)
name|X
argument_list|(
argument|O_DIRECTORY
argument_list|)
name|X
argument_list|(
argument|O_EXEC
argument_list|)
name|X
argument_list|(
argument|O_TTY_INIT
argument_list|)
name|X
argument_list|(
argument|O_CLOEXEC
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|shutdown_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|SHUT_RD
argument_list|)
name|X
argument_list|(
argument|SHUT_WR
argument_list|)
name|X
argument_list|(
argument|SHUT_RDWR
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|resource_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|RLIMIT_CPU
argument_list|)
name|X
argument_list|(
argument|RLIMIT_FSIZE
argument_list|)
name|X
argument_list|(
argument|RLIMIT_DATA
argument_list|)
name|X
argument_list|(
argument|RLIMIT_STACK
argument_list|)
name|X
argument_list|(
argument|RLIMIT_CORE
argument_list|)
name|X
argument_list|(
argument|RLIMIT_RSS
argument_list|)
name|X
argument_list|(
argument|RLIMIT_MEMLOCK
argument_list|)
name|X
argument_list|(
argument|RLIMIT_NPROC
argument_list|)
name|X
argument_list|(
argument|RLIMIT_NOFILE
argument_list|)
name|X
argument_list|(
argument|RLIMIT_SBSIZE
argument_list|)
name|X
argument_list|(
argument|RLIMIT_VMEM
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|pathconf_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|_PC_LINK_MAX
argument_list|)
name|X
argument_list|(
argument|_PC_MAX_CANON
argument_list|)
name|X
argument_list|(
argument|_PC_MAX_INPUT
argument_list|)
name|X
argument_list|(
argument|_PC_NAME_MAX
argument_list|)
name|X
argument_list|(
argument|_PC_PATH_MAX
argument_list|)
name|X
argument_list|(
argument|_PC_PIPE_BUF
argument_list|)
name|X
argument_list|(
argument|_PC_CHOWN_RESTRICTED
argument_list|)
name|X
argument_list|(
argument|_PC_NO_TRUNC
argument_list|)
name|X
argument_list|(
argument|_PC_VDISABLE
argument_list|)
name|X
argument_list|(
argument|_PC_ASYNC_IO
argument_list|)
name|X
argument_list|(
argument|_PC_PRIO_IO
argument_list|)
name|X
argument_list|(
argument|_PC_SYNC_IO
argument_list|)
name|X
argument_list|(
argument|_PC_ALLOC_SIZE_MIN
argument_list|)
name|X
argument_list|(
argument|_PC_FILESIZEBITS
argument_list|)
name|X
argument_list|(
argument|_PC_REC_INCR_XFER_SIZE
argument_list|)
name|X
argument_list|(
argument|_PC_REC_MAX_XFER_SIZE
argument_list|)
name|X
argument_list|(
argument|_PC_REC_MIN_XFER_SIZE
argument_list|)
name|X
argument_list|(
argument|_PC_REC_XFER_ALIGN
argument_list|)
name|X
argument_list|(
argument|_PC_SYMLINK_MAX
argument_list|)
name|X
argument_list|(
argument|_PC_ACL_EXTENDED
argument_list|)
name|X
argument_list|(
argument|_PC_ACL_PATH_MAX
argument_list|)
name|X
argument_list|(
argument|_PC_CAP_PRESENT
argument_list|)
name|X
argument_list|(
argument|_PC_INF_PRESENT
argument_list|)
name|X
argument_list|(
argument|_PC_MAC_PRESENT
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|rfork_flags
index|[]
init|=
block|{
name|X
argument_list|(
argument|RFPROC
argument_list|)
name|X
argument_list|(
argument|RFNOWAIT
argument_list|)
name|X
argument_list|(
argument|RFFDG
argument_list|)
name|X
argument_list|(
argument|RFCFDG
argument_list|)
name|X
argument_list|(
argument|RFTHREAD
argument_list|)
name|X
argument_list|(
argument|RFMEM
argument_list|)
name|X
argument_list|(
argument|RFSIGSHARE
argument_list|)
name|X
argument_list|(
argument|RFTSIGZMB
argument_list|)
name|X
argument_list|(
argument|RFLINUXTHPN
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|wait_options
index|[]
init|=
block|{
name|X
argument_list|(
argument|WNOHANG
argument_list|)
name|X
argument_list|(
argument|WUNTRACED
argument_list|)
name|X
argument_list|(
argument|WCONTINUED
argument_list|)
name|X
argument_list|(
argument|WNOWAIT
argument_list|)
name|X
argument_list|(
argument|WEXITED
argument_list|)
name|X
argument_list|(
argument|WTRAPPED
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|idtype_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|P_PID
argument_list|)
name|X
argument_list|(
argument|P_PPID
argument_list|)
name|X
argument_list|(
argument|P_PGID
argument_list|)
name|X
argument_list|(
argument|P_SID
argument_list|)
name|X
argument_list|(
argument|P_CID
argument_list|)
name|X
argument_list|(
argument|P_UID
argument_list|)
name|X
argument_list|(
argument|P_GID
argument_list|)
name|X
argument_list|(
argument|P_ALL
argument_list|)
name|X
argument_list|(
argument|P_LWPID
argument_list|)
name|X
argument_list|(
argument|P_TASKID
argument_list|)
name|X
argument_list|(
argument|P_PROJID
argument_list|)
name|X
argument_list|(
argument|P_POOLID
argument_list|)
name|X
argument_list|(
argument|P_JAILID
argument_list|)
name|X
argument_list|(
argument|P_CTID
argument_list|)
name|X
argument_list|(
argument|P_CPUID
argument_list|)
name|X
argument_list|(
argument|P_PSETID
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|xlat
name|procctl_arg
index|[]
init|=
block|{
name|X
argument_list|(
argument|PROC_SPROTECT
argument_list|)
name|XEND
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|X
end_undef

begin_undef
undef|#
directive|undef
name|XEND
end_undef

begin_comment
comment|/*  * Searches an xlat array for a value, and returns it if found.  Otherwise  * return a string representation.  */
end_comment

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|lookup
parameter_list|(
name|struct
name|xlat
modifier|*
name|xlat
parameter_list|,
name|int
name|val
parameter_list|,
name|int
name|base
parameter_list|)
block|{
specifier|static
name|char
name|tmp
index|[
literal|16
index|]
decl_stmt|;
for|for
control|(
init|;
name|xlat
operator|->
name|str
operator|!=
name|NULL
condition|;
name|xlat
operator|++
control|)
if|if
condition|(
name|xlat
operator|->
name|val
operator|==
name|val
condition|)
return|return
operator|(
name|xlat
operator|->
name|str
operator|)
return|;
switch|switch
condition|(
name|base
condition|)
block|{
case|case
literal|8
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"0%o"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"0x%x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|sprintf
argument_list|(
name|tmp
argument_list|,
literal|"%u"
argument_list|,
name|val
argument_list|)
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"Unknown lookup base"
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|tmp
operator|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|xlookup
parameter_list|(
name|struct
name|xlat
modifier|*
name|xlat
parameter_list|,
name|int
name|val
parameter_list|)
block|{
return|return
operator|(
name|lookup
argument_list|(
name|xlat
argument_list|,
name|val
argument_list|,
literal|16
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Searches an xlat array containing bitfield values.  Remaining bits    set after removing the known ones are printed at the end:    IN|0x400 */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|xlookup_bits
parameter_list|(
name|struct
name|xlat
modifier|*
name|xlat
parameter_list|,
name|int
name|val
parameter_list|)
block|{
name|int
name|len
decl_stmt|,
name|rem
decl_stmt|;
specifier|static
name|char
name|str
index|[
literal|512
index|]
decl_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
name|rem
operator|=
name|val
expr_stmt|;
for|for
control|(
init|;
name|xlat
operator|->
name|str
operator|!=
name|NULL
condition|;
name|xlat
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|xlat
operator|->
name|val
operator|&
name|rem
operator|)
operator|==
name|xlat
operator|->
name|val
condition|)
block|{
comment|/* don't print the "all-bits-zero" string unless all 			   bits are really zero */
if|if
condition|(
name|xlat
operator|->
name|val
operator|==
literal|0
operator|&&
name|val
operator|!=
literal|0
condition|)
continue|continue;
name|len
operator|+=
name|sprintf
argument_list|(
name|str
operator|+
name|len
argument_list|,
literal|"%s|"
argument_list|,
name|xlat
operator|->
name|str
argument_list|)
expr_stmt|;
name|rem
operator|&=
operator|~
operator|(
name|xlat
operator|->
name|val
operator|)
expr_stmt|;
block|}
block|}
comment|/* if we have leftover bits or didn't match anything */
if|if
condition|(
name|rem
operator|||
name|len
operator|==
literal|0
condition|)
name|len
operator|+=
name|sprintf
argument_list|(
name|str
operator|+
name|len
argument_list|,
literal|"0x%x"
argument_list|,
name|rem
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|&&
name|str
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|'|'
condition|)
name|len
operator|--
expr_stmt|;
name|str
index|[
name|len
index|]
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|str
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * If/when the list gets big, it might be desirable to do it  * as a hash table or binary search.  */
end_comment

begin_function
name|struct
name|syscall
modifier|*
name|get_syscall
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|struct
name|syscall
modifier|*
name|sc
decl_stmt|;
name|sc
operator|=
name|syscalls
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
while|while
condition|(
name|sc
operator|->
name|name
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|sc
operator|->
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|sc
operator|)
return|;
name|sc
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * get_struct  *  * Copy a fixed amount of bytes from the process.  */
end_comment

begin_function
specifier|static
name|int
name|get_struct
parameter_list|(
name|pid_t
name|pid
parameter_list|,
name|void
modifier|*
name|offset
parameter_list|,
name|void
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|struct
name|ptrace_io_desc
name|iorequest
decl_stmt|;
name|iorequest
operator|.
name|piod_op
operator|=
name|PIOD_READ_D
expr_stmt|;
name|iorequest
operator|.
name|piod_offs
operator|=
name|offset
expr_stmt|;
name|iorequest
operator|.
name|piod_addr
operator|=
name|buf
expr_stmt|;
name|iorequest
operator|.
name|piod_len
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_IO
argument_list|,
name|pid
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|iorequest
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|MAXSIZE
value|4096
end_define

begin_define
define|#
directive|define
name|BLOCKSIZE
value|1024
end_define

begin_comment
comment|/*  * get_string  * Copy a string from the process.  Note that it is  * expected to be a C string, but if max is set, it will  * only get that much.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|get_string
parameter_list|(
name|pid_t
name|pid
parameter_list|,
name|void
modifier|*
name|offset
parameter_list|,
name|int
name|max
parameter_list|)
block|{
name|struct
name|ptrace_io_desc
name|iorequest
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|diff
decl_stmt|,
name|i
decl_stmt|,
name|size
decl_stmt|,
name|totalsize
decl_stmt|;
name|diff
operator|=
literal|0
expr_stmt|;
name|totalsize
operator|=
name|size
operator|=
name|max
condition|?
operator|(
name|max
operator|+
literal|1
operator|)
else|:
name|BLOCKSIZE
expr_stmt|;
name|buf
operator|=
name|malloc
argument_list|(
name|totalsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|diff
operator|=
name|totalsize
operator|-
name|size
expr_stmt|;
name|iorequest
operator|.
name|piod_op
operator|=
name|PIOD_READ_D
expr_stmt|;
name|iorequest
operator|.
name|piod_offs
operator|=
operator|(
name|char
operator|*
operator|)
name|offset
operator|+
name|diff
expr_stmt|;
name|iorequest
operator|.
name|piod_addr
operator|=
name|buf
operator|+
name|diff
expr_stmt|;
name|iorequest
operator|.
name|piod_len
operator|=
name|size
expr_stmt|;
if|if
condition|(
name|ptrace
argument_list|(
name|PT_IO
argument_list|,
name|pid
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|iorequest
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
block|{
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|buf
index|[
name|diff
operator|+
name|i
index|]
operator|==
literal|'\0'
condition|)
return|return
operator|(
name|buf
operator|)
return|;
block|}
if|if
condition|(
name|totalsize
operator|<
name|MAXSIZE
operator|-
name|BLOCKSIZE
operator|&&
name|max
operator|==
literal|0
condition|)
block|{
name|totalsize
operator|+=
name|BLOCKSIZE
expr_stmt|;
name|buf
operator|=
name|realloc
argument_list|(
name|buf
argument_list|,
name|totalsize
argument_list|)
expr_stmt|;
name|size
operator|=
name|BLOCKSIZE
expr_stmt|;
block|}
else|else
block|{
name|buf
index|[
name|totalsize
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|strsig2
parameter_list|(
name|int
name|sig
parameter_list|)
block|{
name|char
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|strsig
argument_list|(
name|sig
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|==
name|NULL
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"%d"
argument_list|,
name|sig
argument_list|)
expr_stmt|;
return|return
operator|(
name|tmp
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * print_arg  * Converts a syscall argument into a string.  Said string is  * allocated via malloc(), so needs to be free()'d.  The file  * descriptor is for the process' memory (via /proc), and is used  * to get any data (where the argument is a pointer).  sc is  * a pointer to the syscall description (see above); args is  * an array of all of the system call arguments.  */
end_comment

begin_function
name|char
modifier|*
name|print_arg
parameter_list|(
name|struct
name|syscall_args
modifier|*
name|sc
parameter_list|,
name|unsigned
name|long
modifier|*
name|args
parameter_list|,
name|long
name|retval
parameter_list|,
name|struct
name|trussinfo
modifier|*
name|trussinfo
parameter_list|)
block|{
name|char
modifier|*
name|tmp
decl_stmt|;
name|pid_t
name|pid
decl_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
name|pid
operator|=
name|trussinfo
operator|->
name|pid
expr_stmt|;
switch|switch
condition|(
name|sc
operator|->
name|type
operator|&
name|ARG_MASK
condition|)
block|{
case|case
name|Hex
case|:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%x"
argument_list|,
operator|(
name|int
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|Octal
case|:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0%o"
argument_list|,
operator|(
name|int
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|Int
case|:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|int
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|Name
case|:
block|{
comment|/* NULL-terminated string. */
name|char
modifier|*
name|tmp2
decl_stmt|;
name|tmp2
operator|=
name|get_string
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"\"%s\""
argument_list|,
name|tmp2
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|BinString
case|:
block|{
comment|/* Binary block of data that might have printable characters. 		   XXX If type|OUT, assume that the length is the syscall's 		   return value.  Otherwise, assume that the length of the block 		   is in the next syscall argument. */
name|int
name|max_string
init|=
name|trussinfo
operator|->
name|strsize
decl_stmt|;
name|char
name|tmp2
index|[
name|max_string
operator|+
literal|1
index|]
decl_stmt|,
modifier|*
name|tmp3
decl_stmt|;
name|int
name|len
decl_stmt|;
name|int
name|truncated
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|sc
operator|->
name|type
operator|&
name|OUT
condition|)
name|len
operator|=
name|retval
expr_stmt|;
else|else
name|len
operator|=
name|args
index|[
name|sc
operator|->
name|offset
operator|+
literal|1
index|]
expr_stmt|;
comment|/* Don't print more than max_string characters, to avoid word 		   wrap.  If we have to truncate put some ... after the string. 		*/
if|if
condition|(
name|len
operator|>
name|max_string
condition|)
block|{
name|len
operator|=
name|max_string
expr_stmt|;
name|truncated
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|&&
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|tmp2
argument_list|,
name|len
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|tmp3
operator|=
name|malloc
argument_list|(
name|len
operator|*
literal|4
operator|+
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
if|if
condition|(
name|strvisx
argument_list|(
name|tmp3
argument_list|,
name|tmp2
argument_list|,
name|len
argument_list|,
name|VIS_CSTYLE
operator||
name|VIS_TAB
operator||
name|VIS_NL
argument_list|)
operator|<=
name|max_string
condition|)
break|break;
name|len
operator|--
expr_stmt|;
name|truncated
operator|=
literal|1
expr_stmt|;
block|}
empty_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"\"%s\"%s"
argument_list|,
name|tmp3
argument_list|,
name|truncated
condition|?
literal|"..."
else|:
literal|""
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|tmp3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|StringArray
case|:
block|{
name|int
name|num
decl_stmt|,
name|size
decl_stmt|,
name|i
decl_stmt|;
name|char
modifier|*
name|tmp2
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|char
modifier|*
name|strarray
index|[
literal|100
index|]
decl_stmt|;
comment|/* XXX This is ugly. */
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|strarray
argument_list|,
sizeof|sizeof
argument_list|(
name|strarray
argument_list|)
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get_struct %p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
name|num
operator|=
literal|0
expr_stmt|;
name|size
operator|=
literal|0
expr_stmt|;
comment|/* Find out how large of a buffer we'll need. */
while|while
condition|(
name|strarray
index|[
name|num
index|]
operator|!=
name|NULL
condition|)
block|{
name|string
operator|=
name|get_string
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|strarray
index|[
name|num
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|size
operator|+=
name|strlen
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|num
operator|++
expr_stmt|;
block|}
name|size
operator|+=
literal|4
operator|+
operator|(
name|num
operator|*
literal|4
operator|)
expr_stmt|;
name|tmp
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|tmp2
operator|=
name|tmp
expr_stmt|;
name|tmp2
operator|+=
name|sprintf
argument_list|(
name|tmp2
argument_list|,
literal|" ["
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
name|string
operator|=
name|get_string
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|strarray
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|tmp2
operator|+=
name|sprintf
argument_list|(
name|tmp2
argument_list|,
literal|" \"%s\"%c"
argument_list|,
name|string
argument_list|,
operator|(
name|i
operator|+
literal|1
operator|==
name|num
operator|)
condition|?
literal|' '
else|:
literal|','
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
name|tmp2
operator|+=
name|sprintf
argument_list|(
name|tmp2
argument_list|,
literal|"]"
argument_list|)
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|__LP64__
case|case
name|Quad
case|:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
else|#
directive|else
case|case
name|Quad
case|:
block|{
name|unsigned
name|long
name|long
name|ll
decl_stmt|;
name|ll
operator|=
operator|*
operator|(
name|unsigned
name|long
name|long
operator|*
operator|)
operator|(
name|args
operator|+
name|sc
operator|->
name|offset
operator|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%llx"
argument_list|,
name|ll
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
case|case
name|Ptr
case|:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|Readlinkres
case|:
block|{
name|char
modifier|*
name|tmp2
decl_stmt|;
if|if
condition|(
name|retval
operator|==
operator|-
literal|1
condition|)
block|{
name|tmp
operator|=
name|strdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
break|break;
block|}
name|tmp2
operator|=
name|get_string
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
name|retval
argument_list|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"\"%s\""
argument_list|,
name|tmp2
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Ioctl
case|:
block|{
specifier|const
name|char
modifier|*
name|temp
init|=
name|ioctlname
argument_list|(
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
name|temp
condition|)
name|tmp
operator|=
name|strdup
argument_list|(
name|temp
argument_list|)
expr_stmt|;
else|else
block|{
name|unsigned
name|long
name|arg
init|=
name|args
index|[
name|sc
operator|->
name|offset
index|]
decl_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx { IO%s%s 0x%lx('%c'), %lu, %lu }"
argument_list|,
name|arg
argument_list|,
name|arg
operator|&
name|IOC_OUT
condition|?
literal|"R"
else|:
literal|""
argument_list|,
name|arg
operator|&
name|IOC_IN
condition|?
literal|"W"
else|:
literal|""
argument_list|,
name|IOCGROUP
argument_list|(
name|arg
argument_list|)
argument_list|,
name|isprint
argument_list|(
name|IOCGROUP
argument_list|(
name|arg
argument_list|)
argument_list|)
condition|?
operator|(
name|char
operator|)
name|IOCGROUP
argument_list|(
name|arg
argument_list|)
else|:
literal|'?'
argument_list|,
name|arg
operator|&
literal|0xFF
argument_list|,
name|IOCPARM_LEN
argument_list|(
name|arg
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|Timespec
case|:
block|{
name|struct
name|timespec
name|ts
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|ts
argument_list|,
sizeof|sizeof
argument_list|(
name|ts
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{%ld.%09ld }"
argument_list|,
operator|(
name|long
operator|)
name|ts
operator|.
name|tv_sec
argument_list|,
name|ts
operator|.
name|tv_nsec
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Timeval
case|:
block|{
name|struct
name|timeval
name|tv
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|tv
argument_list|,
sizeof|sizeof
argument_list|(
name|tv
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{%ld.%06ld }"
argument_list|,
operator|(
name|long
operator|)
name|tv
operator|.
name|tv_sec
argument_list|,
name|tv
operator|.
name|tv_usec
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Timeval2
case|:
block|{
name|struct
name|timeval
name|tv
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|tv
argument_list|,
sizeof|sizeof
argument_list|(
name|tv
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{%ld.%06ld, %ld.%06ld }"
argument_list|,
operator|(
name|long
operator|)
name|tv
index|[
literal|0
index|]
operator|.
name|tv_sec
argument_list|,
name|tv
index|[
literal|0
index|]
operator|.
name|tv_usec
argument_list|,
operator|(
name|long
operator|)
name|tv
index|[
literal|1
index|]
operator|.
name|tv_sec
argument_list|,
name|tv
index|[
literal|1
index|]
operator|.
name|tv_usec
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Itimerval
case|:
block|{
name|struct
name|itimerval
name|itv
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|itv
argument_list|,
sizeof|sizeof
argument_list|(
name|itv
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{%ld.%06ld, %ld.%06ld }"
argument_list|,
operator|(
name|long
operator|)
name|itv
operator|.
name|it_interval
operator|.
name|tv_sec
argument_list|,
name|itv
operator|.
name|it_interval
operator|.
name|tv_usec
argument_list|,
operator|(
name|long
operator|)
name|itv
operator|.
name|it_value
operator|.
name|tv_sec
argument_list|,
name|itv
operator|.
name|it_value
operator|.
name|tv_usec
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|LinuxSockArgs
case|:
block|{
name|struct
name|linux_socketcall_args
name|largs
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|largs
argument_list|,
sizeof|sizeof
argument_list|(
name|largs
argument_list|)
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|err
argument_list|(
literal|1
argument_list|,
literal|"get_struct %p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
specifier|const
name|char
modifier|*
name|what
decl_stmt|;
name|char
name|buf
index|[
literal|30
index|]
decl_stmt|;
switch|switch
condition|(
name|largs
operator|.
name|what
condition|)
block|{
case|case
name|LINUX_SOCKET
case|:
name|what
operator|=
literal|"LINUX_SOCKET"
expr_stmt|;
break|break;
case|case
name|LINUX_BIND
case|:
name|what
operator|=
literal|"LINUX_BIND"
expr_stmt|;
break|break;
case|case
name|LINUX_CONNECT
case|:
name|what
operator|=
literal|"LINUX_CONNECT"
expr_stmt|;
break|break;
case|case
name|LINUX_LISTEN
case|:
name|what
operator|=
literal|"LINUX_LISTEN"
expr_stmt|;
break|break;
case|case
name|LINUX_ACCEPT
case|:
name|what
operator|=
literal|"LINUX_ACCEPT"
expr_stmt|;
break|break;
case|case
name|LINUX_GETSOCKNAME
case|:
name|what
operator|=
literal|"LINUX_GETSOCKNAME"
expr_stmt|;
break|break;
case|case
name|LINUX_GETPEERNAME
case|:
name|what
operator|=
literal|"LINUX_GETPEERNAME"
expr_stmt|;
break|break;
case|case
name|LINUX_SOCKETPAIR
case|:
name|what
operator|=
literal|"LINUX_SOCKETPAIR"
expr_stmt|;
break|break;
case|case
name|LINUX_SEND
case|:
name|what
operator|=
literal|"LINUX_SEND"
expr_stmt|;
break|break;
case|case
name|LINUX_RECV
case|:
name|what
operator|=
literal|"LINUX_RECV"
expr_stmt|;
break|break;
case|case
name|LINUX_SENDTO
case|:
name|what
operator|=
literal|"LINUX_SENDTO"
expr_stmt|;
break|break;
case|case
name|LINUX_RECVFROM
case|:
name|what
operator|=
literal|"LINUX_RECVFROM"
expr_stmt|;
break|break;
case|case
name|LINUX_SHUTDOWN
case|:
name|what
operator|=
literal|"LINUX_SHUTDOWN"
expr_stmt|;
break|break;
case|case
name|LINUX_SETSOCKOPT
case|:
name|what
operator|=
literal|"LINUX_SETSOCKOPT"
expr_stmt|;
break|break;
case|case
name|LINUX_GETSOCKOPT
case|:
name|what
operator|=
literal|"LINUX_GETSOCKOPT"
expr_stmt|;
break|break;
case|case
name|LINUX_SENDMSG
case|:
name|what
operator|=
literal|"LINUX_SENDMSG"
expr_stmt|;
break|break;
case|case
name|LINUX_RECVMSG
case|:
name|what
operator|=
literal|"LINUX_RECVMSG"
expr_stmt|;
break|break;
default|default:
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|largs
operator|.
name|what
argument_list|)
expr_stmt|;
name|what
operator|=
name|buf
expr_stmt|;
break|break;
block|}
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"(0x%lx)%s, 0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
name|what
argument_list|,
operator|(
name|long
name|unsigned
name|int
operator|)
name|largs
operator|.
name|args
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Pollfd
case|:
block|{
comment|/* 		 * XXX: A Pollfd argument expects the /next/ syscall argument 		 * to be the number of fds in the array. This matches the poll 		 * syscall. 		 */
name|struct
name|pollfd
modifier|*
name|pfd
decl_stmt|;
name|int
name|numfds
init|=
name|args
index|[
name|sc
operator|->
name|offset
operator|+
literal|1
index|]
decl_stmt|;
name|int
name|bytes
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|pollfd
argument_list|)
operator|*
name|numfds
decl_stmt|;
name|int
name|i
decl_stmt|,
name|tmpsize
decl_stmt|,
name|u
decl_stmt|,
name|used
decl_stmt|;
specifier|const
name|int
name|per_fd
init|=
literal|100
decl_stmt|;
if|if
condition|(
operator|(
name|pfd
operator|=
name|malloc
argument_list|(
name|bytes
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot malloc %d bytes for pollfd array"
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
name|pfd
argument_list|,
name|bytes
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|used
operator|=
literal|0
expr_stmt|;
name|tmpsize
operator|=
literal|1
operator|+
name|per_fd
operator|*
name|numfds
operator|+
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|=
name|malloc
argument_list|(
name|tmpsize
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot alloc %d bytes for poll output"
argument_list|,
name|tmpsize
argument_list|)
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'{'
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numfds
condition|;
name|i
operator|++
control|)
block|{
name|u
operator|=
name|snprintf
argument_list|(
name|tmp
operator|+
name|used
argument_list|,
name|per_fd
argument_list|,
literal|"%s%d/%s"
argument_list|,
name|i
operator|>
literal|0
condition|?
literal|" "
else|:
literal|""
argument_list|,
name|pfd
index|[
name|i
index|]
operator|.
name|fd
argument_list|,
name|xlookup_bits
argument_list|(
name|poll_flags
argument_list|,
name|pfd
index|[
name|i
index|]
operator|.
name|events
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|u
operator|>
literal|0
condition|)
name|used
operator|+=
name|u
operator|<
name|per_fd
condition|?
name|u
else|:
name|per_fd
expr_stmt|;
block|}
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'}'
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
else|else
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|pfd
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Fd_set
case|:
block|{
comment|/* 		 * XXX: A Fd_set argument expects the /first/ syscall argument 		 * to be the number of fds in the array.  This matches the 		 * select syscall. 		 */
name|fd_set
modifier|*
name|fds
decl_stmt|;
name|int
name|numfds
init|=
name|args
index|[
literal|0
index|]
decl_stmt|;
name|int
name|bytes
init|=
name|_howmany
argument_list|(
name|numfds
argument_list|,
name|_NFDBITS
argument_list|)
operator|*
name|_NFDBITS
decl_stmt|;
name|int
name|i
decl_stmt|,
name|tmpsize
decl_stmt|,
name|u
decl_stmt|,
name|used
decl_stmt|;
specifier|const
name|int
name|per_fd
init|=
literal|20
decl_stmt|;
if|if
condition|(
operator|(
name|fds
operator|=
name|malloc
argument_list|(
name|bytes
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot malloc %d bytes for fd_set array"
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
name|fds
argument_list|,
name|bytes
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|used
operator|=
literal|0
expr_stmt|;
name|tmpsize
operator|=
literal|1
operator|+
name|numfds
operator|*
name|per_fd
operator|+
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|=
name|malloc
argument_list|(
name|tmpsize
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot alloc %d bytes for fd_set "
literal|"output"
argument_list|,
name|tmpsize
argument_list|)
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'{'
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numfds
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|FD_ISSET
argument_list|(
name|i
argument_list|,
name|fds
argument_list|)
condition|)
block|{
name|u
operator|=
name|snprintf
argument_list|(
name|tmp
operator|+
name|used
argument_list|,
name|per_fd
argument_list|,
literal|"%d "
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|u
operator|>
literal|0
condition|)
name|used
operator|+=
name|u
operator|<
name|per_fd
condition|?
name|u
else|:
name|per_fd
expr_stmt|;
block|}
block|}
if|if
condition|(
name|tmp
index|[
name|used
operator|-
literal|1
index|]
operator|==
literal|' '
condition|)
name|used
operator|--
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'}'
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|fds
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Signal
case|:
name|tmp
operator|=
name|strsig2
argument_list|(
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|Sigset
case|:
block|{
name|long
name|sig
decl_stmt|;
name|sigset_t
name|ss
decl_stmt|;
name|int
name|i
decl_stmt|,
name|used
decl_stmt|;
name|char
modifier|*
name|signame
decl_stmt|;
name|sig
operator|=
name|args
index|[
name|sc
operator|->
name|offset
index|]
expr_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|ss
argument_list|,
sizeof|sizeof
argument_list|(
name|ss
argument_list|)
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
name|tmp
operator|=
name|malloc
argument_list|(
name|sys_nsig
operator|*
literal|8
argument_list|)
expr_stmt|;
comment|/* 7 bytes avg per signal name */
name|used
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|sys_nsig
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|sigismember
argument_list|(
operator|&
name|ss
argument_list|,
name|i
argument_list|)
condition|)
block|{
name|signame
operator|=
name|strsig
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|used
operator|+=
name|sprintf
argument_list|(
name|tmp
operator|+
name|used
argument_list|,
literal|"%s|"
argument_list|,
name|signame
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|signame
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|used
condition|)
name|tmp
index|[
name|used
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|tmp
argument_list|,
literal|"0x0"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Sigprocmask
case|:
block|{
switch|switch
condition|(
name|args
index|[
name|sc
operator|->
name|offset
index|]
condition|)
block|{
define|#
directive|define
name|S
parameter_list|(
name|a
parameter_list|)
value|case a: tmp = strdup(#a); break;
name|S
argument_list|(
name|SIG_BLOCK
argument_list|)
expr_stmt|;
name|S
argument_list|(
name|SIG_UNBLOCK
argument_list|)
expr_stmt|;
name|S
argument_list|(
name|SIG_SETMASK
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|S
block|}
if|if
condition|(
name|tmp
operator|==
name|NULL
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Fcntlflag
case|:
block|{
comment|/* XXX output depends on the value of the previous argument */
switch|switch
condition|(
name|args
index|[
name|sc
operator|->
name|offset
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|F_SETFD
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|fcntlfd_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|F_SETFL
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|fcntlfl_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|F_GETFD
case|:
case|case
name|F_GETFL
case|:
case|case
name|F_GETOWN
case|:
name|tmp
operator|=
name|strdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
break|break;
default|default:
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
block|}
case|case
name|Open
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|open_flags
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Fcntl
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|fcntl_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Mprot
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|mprot_flags
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Mmapflags
case|:
block|{
name|char
modifier|*
name|base
decl_stmt|,
modifier|*
name|alignstr
decl_stmt|;
name|int
name|align
decl_stmt|,
name|flags
decl_stmt|;
comment|/* 		 * MAP_ALIGNED can't be handled by xlookup_bits(), so 		 * generate that string manually and prepend it to the 		 * string from xlookup_bits().  Have to be careful to 		 * avoid outputting MAP_ALIGNED|0 if MAP_ALIGNED is 		 * the only flag. 		 */
name|flags
operator|=
name|args
index|[
name|sc
operator|->
name|offset
index|]
operator|&
operator|~
name|MAP_ALIGNMENT_MASK
expr_stmt|;
name|align
operator|=
name|args
index|[
name|sc
operator|->
name|offset
index|]
operator|&
name|MAP_ALIGNMENT_MASK
expr_stmt|;
if|if
condition|(
name|align
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|align
operator|==
name|MAP_ALIGNED_SUPER
condition|)
name|alignstr
operator|=
name|strdup
argument_list|(
literal|"MAP_ALIGNED_SUPER"
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|alignstr
argument_list|,
literal|"MAP_ALIGNED(%d)"
argument_list|,
name|align
operator|>>
name|MAP_ALIGNMENT_SHIFT
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|==
literal|0
condition|)
block|{
name|tmp
operator|=
name|alignstr
expr_stmt|;
break|break;
block|}
block|}
else|else
name|alignstr
operator|=
name|NULL
expr_stmt|;
name|base
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|mmap_flags
argument_list|,
name|flags
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|alignstr
operator|==
name|NULL
condition|)
block|{
name|tmp
operator|=
name|base
expr_stmt|;
break|break;
block|}
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"%s|%s"
argument_list|,
name|alignstr
argument_list|,
name|base
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|alignstr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|base
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Whence
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|whence_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Sockdomain
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|sockdomain_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Socktype
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|socktype_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Shutdown
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|shutdown_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Resource
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|resource_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Pathconf
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|pathconf_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Rforkflags
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|rfork_flags
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Sockaddr
case|:
block|{
name|struct
name|sockaddr_storage
name|ss
decl_stmt|;
name|char
name|addr
index|[
literal|64
index|]
decl_stmt|;
name|struct
name|sockaddr_in
modifier|*
name|lsin
decl_stmt|;
name|struct
name|sockaddr_in6
modifier|*
name|lsin6
decl_stmt|;
name|struct
name|sockaddr_un
modifier|*
name|sun
decl_stmt|;
name|struct
name|sockaddr
modifier|*
name|sa
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|u_char
modifier|*
name|q
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|args
index|[
name|sc
operator|->
name|offset
index|]
operator|==
literal|0
condition|)
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"NULL"
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* yuck: get ss_len */
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|ss
argument_list|,
sizeof|sizeof
argument_list|(
name|ss
operator|.
name|ss_len
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|ss
operator|.
name|ss_family
argument_list|)
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get_struct %p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
comment|/* 		 * If ss_len is 0, then try to guess from the sockaddr type. 		 * AF_UNIX may be initialized incorrectly, so always frob 		 * it by using the "right" size. 		 */
if|if
condition|(
name|ss
operator|.
name|ss_len
operator|==
literal|0
operator|||
name|ss
operator|.
name|ss_family
operator|==
name|AF_UNIX
condition|)
block|{
switch|switch
condition|(
name|ss
operator|.
name|ss_family
condition|)
block|{
case|case
name|AF_INET
case|:
name|ss
operator|.
name|ss_len
operator|=
sizeof|sizeof
argument_list|(
operator|*
name|lsin
argument_list|)
expr_stmt|;
break|break;
case|case
name|AF_UNIX
case|:
name|ss
operator|.
name|ss_len
operator|=
sizeof|sizeof
argument_list|(
operator|*
name|sun
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* hurrrr */
break|break;
block|}
block|}
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|ss
argument_list|,
name|ss
operator|.
name|ss_len
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|err
argument_list|(
literal|2
argument_list|,
literal|"get_struct %p"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|ss
operator|.
name|ss_family
condition|)
block|{
case|case
name|AF_INET
case|:
name|lsin
operator|=
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|ss
expr_stmt|;
name|inet_ntop
argument_list|(
name|AF_INET
argument_list|,
operator|&
name|lsin
operator|->
name|sin_addr
argument_list|,
name|addr
argument_list|,
sizeof|sizeof
name|addr
argument_list|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ AF_INET %s:%d }"
argument_list|,
name|addr
argument_list|,
name|htons
argument_list|(
name|lsin
operator|->
name|sin_port
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|AF_INET6
case|:
name|lsin6
operator|=
operator|(
expr|struct
name|sockaddr_in6
operator|*
operator|)
operator|&
name|ss
expr_stmt|;
name|inet_ntop
argument_list|(
name|AF_INET6
argument_list|,
operator|&
name|lsin6
operator|->
name|sin6_addr
argument_list|,
name|addr
argument_list|,
sizeof|sizeof
name|addr
argument_list|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ AF_INET6 [%s]:%d }"
argument_list|,
name|addr
argument_list|,
name|htons
argument_list|(
name|lsin6
operator|->
name|sin6_port
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|AF_UNIX
case|:
name|sun
operator|=
operator|(
expr|struct
name|sockaddr_un
operator|*
operator|)
operator|&
name|ss
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ AF_UNIX \"%s\" }"
argument_list|,
name|sun
operator|->
name|sun_path
argument_list|)
expr_stmt|;
break|break;
default|default:
name|sa
operator|=
operator|(
expr|struct
name|sockaddr
operator|*
operator|)
operator|&
name|ss
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ sa_len = %d, sa_family = %d, sa_data "
literal|"= {%n%*s } }"
argument_list|,
operator|(
name|int
operator|)
name|sa
operator|->
name|sa_len
argument_list|,
operator|(
name|int
operator|)
name|sa
operator|->
name|sa_family
argument_list|,
operator|&
name|i
argument_list|,
literal|6
operator|*
call|(
name|int
call|)
argument_list|(
name|sa
operator|->
name|sa_len
operator|-
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sa
operator|->
name|sa_data
operator|-
operator|(
name|char
operator|*
operator|)
name|sa
operator|)
argument_list|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|!=
name|NULL
condition|)
block|{
name|p
operator|=
name|tmp
operator|+
name|i
expr_stmt|;
for|for
control|(
name|q
operator|=
operator|(
name|u_char
operator|*
operator|)
operator|&
name|sa
operator|->
name|sa_data
init|;
name|q
operator|<
operator|(
name|u_char
operator|*
operator|)
name|sa
operator|+
name|sa
operator|->
name|sa_len
condition|;
name|q
operator|++
control|)
name|p
operator|+=
name|sprintf
argument_list|(
name|p
argument_list|,
literal|" %#02x,"
argument_list|,
operator|*
name|q
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
block|}
case|case
name|Sigaction
case|:
block|{
name|struct
name|sigaction
name|sa
decl_stmt|;
name|char
modifier|*
name|hand
decl_stmt|;
specifier|const
name|char
modifier|*
name|h
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|sa
argument_list|,
sizeof|sizeof
argument_list|(
name|sa
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|asprintf
argument_list|(
operator|&
name|hand
argument_list|,
literal|"%p"
argument_list|,
name|sa
operator|.
name|sa_handler
argument_list|)
expr_stmt|;
if|if
condition|(
name|sa
operator|.
name|sa_handler
operator|==
name|SIG_DFL
condition|)
name|h
operator|=
literal|"SIG_DFL"
expr_stmt|;
elseif|else
if|if
condition|(
name|sa
operator|.
name|sa_handler
operator|==
name|SIG_IGN
condition|)
name|h
operator|=
literal|"SIG_IGN"
expr_stmt|;
else|else
name|h
operator|=
name|hand
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ %s %s ss_t }"
argument_list|,
name|h
argument_list|,
name|xlookup_bits
argument_list|(
name|sigaction_flags
argument_list|,
name|sa
operator|.
name|sa_flags
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|hand
argument_list|)
expr_stmt|;
block|}
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Kevent
case|:
block|{
comment|/* 		 * XXX XXX: the size of the array is determined by either the 		 * next syscall argument, or by the syscall returnvalue, 		 * depending on which argument number we are.  This matches the 		 * kevent syscall, but luckily that's the only syscall that uses 		 * them. 		 */
name|struct
name|kevent
modifier|*
name|ke
decl_stmt|;
name|int
name|numevents
init|=
operator|-
literal|1
decl_stmt|;
name|int
name|bytes
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|,
name|tmpsize
decl_stmt|,
name|u
decl_stmt|,
name|used
decl_stmt|;
specifier|const
name|int
name|per_ke
init|=
literal|100
decl_stmt|;
if|if
condition|(
name|sc
operator|->
name|offset
operator|==
literal|1
condition|)
name|numevents
operator|=
name|args
index|[
name|sc
operator|->
name|offset
operator|+
literal|1
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|sc
operator|->
name|offset
operator|==
literal|3
operator|&&
name|retval
operator|!=
operator|-
literal|1
condition|)
name|numevents
operator|=
name|retval
expr_stmt|;
if|if
condition|(
name|numevents
operator|>=
literal|0
condition|)
name|bytes
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|kevent
argument_list|)
operator|*
name|numevents
expr_stmt|;
if|if
condition|(
operator|(
name|ke
operator|=
name|malloc
argument_list|(
name|bytes
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot malloc %d bytes for kevent array"
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|numevents
operator|>=
literal|0
operator|&&
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
name|ke
argument_list|,
name|bytes
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|used
operator|=
literal|0
expr_stmt|;
name|tmpsize
operator|=
literal|1
operator|+
name|per_ke
operator|*
name|numevents
operator|+
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|=
name|malloc
argument_list|(
name|tmpsize
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot alloc %d bytes for kevent "
literal|"output"
argument_list|,
name|tmpsize
argument_list|)
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'{'
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numevents
condition|;
name|i
operator|++
control|)
block|{
name|u
operator|=
name|snprintf
argument_list|(
name|tmp
operator|+
name|used
argument_list|,
name|per_ke
argument_list|,
literal|"%s%p,%s,%s,%d,%p,%p"
argument_list|,
name|i
operator|>
literal|0
condition|?
literal|" "
else|:
literal|""
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ke
index|[
name|i
index|]
operator|.
name|ident
argument_list|,
name|xlookup
argument_list|(
name|kevent_filters
argument_list|,
name|ke
index|[
name|i
index|]
operator|.
name|filter
argument_list|)
argument_list|,
name|xlookup_bits
argument_list|(
name|kevent_flags
argument_list|,
name|ke
index|[
name|i
index|]
operator|.
name|flags
argument_list|)
argument_list|,
name|ke
index|[
name|i
index|]
operator|.
name|fflags
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ke
index|[
name|i
index|]
operator|.
name|data
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ke
index|[
name|i
index|]
operator|.
name|udata
argument_list|)
expr_stmt|;
if|if
condition|(
name|u
operator|>
literal|0
condition|)
name|used
operator|+=
name|u
operator|<
name|per_ke
condition|?
name|u
else|:
name|per_ke
expr_stmt|;
block|}
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'}'
expr_stmt|;
name|tmp
index|[
name|used
operator|++
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
else|else
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|ke
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Stat
case|:
block|{
name|struct
name|stat
name|st
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|st
argument_list|,
sizeof|sizeof
argument_list|(
name|st
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|char
name|mode
index|[
literal|12
index|]
decl_stmt|;
name|strmode
argument_list|(
name|st
operator|.
name|st_mode
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ mode=%s,inode=%jd,size=%jd,blksize=%ld }"
argument_list|,
name|mode
argument_list|,
operator|(
name|intmax_t
operator|)
name|st
operator|.
name|st_ino
argument_list|,
operator|(
name|intmax_t
operator|)
name|st
operator|.
name|st_size
argument_list|,
operator|(
name|long
operator|)
name|st
operator|.
name|st_blksize
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|Rusage
case|:
block|{
name|struct
name|rusage
name|ru
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|ru
argument_list|,
sizeof|sizeof
argument_list|(
name|ru
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ u=%ld.%06ld,s=%ld.%06ld,in=%ld,out=%ld }"
argument_list|,
operator|(
name|long
operator|)
name|ru
operator|.
name|ru_utime
operator|.
name|tv_sec
argument_list|,
name|ru
operator|.
name|ru_utime
operator|.
name|tv_usec
argument_list|,
operator|(
name|long
operator|)
name|ru
operator|.
name|ru_stime
operator|.
name|tv_sec
argument_list|,
name|ru
operator|.
name|ru_stime
operator|.
name|tv_usec
argument_list|,
name|ru
operator|.
name|ru_inblock
argument_list|,
name|ru
operator|.
name|ru_oublock
argument_list|)
expr_stmt|;
block|}
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Rlimit
case|:
block|{
name|struct
name|rlimit
name|rl
decl_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|rl
argument_list|,
sizeof|sizeof
argument_list|(
name|rl
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ cur=%ju,max=%ju }"
argument_list|,
name|rl
operator|.
name|rlim_cur
argument_list|,
name|rl
operator|.
name|rlim_max
argument_list|)
expr_stmt|;
block|}
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|ExitStatus
case|:
block|{
name|char
modifier|*
name|signame
decl_stmt|;
name|int
name|status
decl_stmt|;
name|signame
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|get_struct
argument_list|(
name|pid
argument_list|,
operator|(
name|void
operator|*
operator|)
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|,
operator|&
name|status
argument_list|,
sizeof|sizeof
argument_list|(
name|status
argument_list|)
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|WIFCONTINUED
argument_list|(
name|status
argument_list|)
condition|)
name|tmp
operator|=
name|strdup
argument_list|(
literal|"{ CONTINUED }"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|WIFEXITED
argument_list|(
name|status
argument_list|)
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ EXITED,val=%d }"
argument_list|,
name|WEXITSTATUS
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|WIFSIGNALED
argument_list|(
name|status
argument_list|)
condition|)
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ SIGNALED,sig=%s%s }"
argument_list|,
name|signame
operator|=
name|strsig2
argument_list|(
name|WTERMSIG
argument_list|(
name|status
argument_list|)
argument_list|)
argument_list|,
name|WCOREDUMP
argument_list|(
name|status
argument_list|)
condition|?
literal|",cored"
else|:
literal|""
argument_list|)
expr_stmt|;
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"{ STOPPED,sig=%s }"
argument_list|,
name|signame
operator|=
name|strsig2
argument_list|(
name|WTERMSIG
argument_list|(
name|status
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|asprintf
argument_list|(
operator|&
name|tmp
argument_list|,
literal|"0x%lx"
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|signame
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|Waitoptions
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup_bits
argument_list|(
name|wait_options
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Idtype
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|idtype_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Procctl
case|:
name|tmp
operator|=
name|strdup
argument_list|(
name|xlookup
argument_list|(
name|procctl_arg
argument_list|,
name|args
index|[
name|sc
operator|->
name|offset
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"Invalid argument type %d\n"
argument_list|,
name|sc
operator|->
name|type
operator|&
name|ARG_MASK
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|tmp
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * print_syscall  * Print (to outfile) the system call and its arguments.  Note that  * nargs is the number of arguments (not the number of words; this is  * potentially confusing, I know).  */
end_comment

begin_function
name|void
name|print_syscall
parameter_list|(
name|struct
name|trussinfo
modifier|*
name|trussinfo
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nargs
parameter_list|,
name|char
modifier|*
modifier|*
name|s_args
parameter_list|)
block|{
name|struct
name|timespec
name|timediff
decl_stmt|;
name|int
name|i
decl_stmt|,
name|len
decl_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|trussinfo
operator|->
name|flags
operator|&
name|FOLLOWFORKS
condition|)
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%5d: "
argument_list|,
name|trussinfo
operator|->
name|pid
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|!=
name|NULL
operator|&&
operator|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"execve"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"exit"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|clock_gettime
argument_list|(
name|CLOCK_REALTIME
argument_list|,
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|after
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|trussinfo
operator|->
name|flags
operator|&
name|ABSOLUTETIMESTAMPS
condition|)
block|{
name|timespecsubt
argument_list|(
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|after
argument_list|,
operator|&
name|trussinfo
operator|->
name|start_time
argument_list|,
operator|&
name|timediff
argument_list|)
expr_stmt|;
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%ld.%09ld "
argument_list|,
operator|(
name|long
operator|)
name|timediff
operator|.
name|tv_sec
argument_list|,
name|timediff
operator|.
name|tv_nsec
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|trussinfo
operator|->
name|flags
operator|&
name|RELATIVETIMESTAMPS
condition|)
block|{
name|timespecsubt
argument_list|(
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|after
argument_list|,
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|before
argument_list|,
operator|&
name|timediff
argument_list|)
expr_stmt|;
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%ld.%09ld "
argument_list|,
operator|(
name|long
operator|)
name|timediff
operator|.
name|tv_sec
argument_list|,
name|timediff
operator|.
name|tv_nsec
argument_list|)
expr_stmt|;
block|}
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%s("
argument_list|,
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nargs
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|s_args
index|[
name|i
index|]
condition|)
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%s"
argument_list|,
name|s_args
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"<missing argument>"
argument_list|)
expr_stmt|;
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%s"
argument_list|,
name|i
operator|<
operator|(
name|nargs
operator|-
literal|1
operator|)
condition|?
literal|","
else|:
literal|""
argument_list|)
expr_stmt|;
block|}
name|len
operator|+=
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
operator|-
operator|(
name|len
operator|/
literal|8
operator|)
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_syscall_ret
parameter_list|(
name|struct
name|trussinfo
modifier|*
name|trussinfo
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nargs
parameter_list|,
name|char
modifier|*
modifier|*
name|s_args
parameter_list|,
name|int
name|errorp
parameter_list|,
name|long
name|retval
parameter_list|,
name|struct
name|syscall
modifier|*
name|sc
parameter_list|)
block|{
name|struct
name|timespec
name|timediff
decl_stmt|;
if|if
condition|(
name|trussinfo
operator|->
name|flags
operator|&
name|COUNTONLY
condition|)
block|{
if|if
condition|(
operator|!
name|sc
condition|)
return|return;
name|clock_gettime
argument_list|(
name|CLOCK_REALTIME
argument_list|,
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|after
argument_list|)
expr_stmt|;
name|timespecsubt
argument_list|(
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|after
argument_list|,
operator|&
name|trussinfo
operator|->
name|curthread
operator|->
name|before
argument_list|,
operator|&
name|timediff
argument_list|)
expr_stmt|;
name|timespecadd
argument_list|(
operator|&
name|sc
operator|->
name|time
argument_list|,
operator|&
name|timediff
argument_list|,
operator|&
name|sc
operator|->
name|time
argument_list|)
expr_stmt|;
name|sc
operator|->
name|ncalls
operator|++
expr_stmt|;
if|if
condition|(
name|errorp
condition|)
name|sc
operator|->
name|nerror
operator|++
expr_stmt|;
return|return;
block|}
name|print_syscall
argument_list|(
name|trussinfo
argument_list|,
name|name
argument_list|,
name|nargs
argument_list|,
name|s_args
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|)
expr_stmt|;
if|if
condition|(
name|errorp
condition|)
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|" ERR#%ld '%s'\n"
argument_list|,
name|retval
argument_list|,
name|strerror
argument_list|(
name|retval
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* 		 * Because pipe(2) has a special assembly glue to provide the 		 * libc API, we have to adjust retval. 		 */
if|if
condition|(
name|name
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"pipe"
argument_list|)
operator|==
literal|0
condition|)
name|retval
operator|=
literal|0
expr_stmt|;
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|" = %ld (0x%lx)\n"
argument_list|,
name|retval
argument_list|,
name|retval
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|print_summary
parameter_list|(
name|struct
name|trussinfo
modifier|*
name|trussinfo
parameter_list|)
block|{
name|struct
name|timespec
name|total
init|=
block|{
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|struct
name|syscall
modifier|*
name|sc
decl_stmt|;
name|int
name|ncall
decl_stmt|,
name|nerror
decl_stmt|;
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%-20s%15s%8s%8s\n"
argument_list|,
literal|"syscall"
argument_list|,
literal|"seconds"
argument_list|,
literal|"calls"
argument_list|,
literal|"errors"
argument_list|)
expr_stmt|;
name|ncall
operator|=
name|nerror
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|sc
operator|=
name|syscalls
init|;
name|sc
operator|->
name|name
operator|!=
name|NULL
condition|;
name|sc
operator|++
control|)
if|if
condition|(
name|sc
operator|->
name|ncalls
condition|)
block|{
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%-20s%5jd.%09ld%8d%8d\n"
argument_list|,
name|sc
operator|->
name|name
argument_list|,
operator|(
name|intmax_t
operator|)
name|sc
operator|->
name|time
operator|.
name|tv_sec
argument_list|,
name|sc
operator|->
name|time
operator|.
name|tv_nsec
argument_list|,
name|sc
operator|->
name|ncalls
argument_list|,
name|sc
operator|->
name|nerror
argument_list|)
expr_stmt|;
name|timespecadd
argument_list|(
operator|&
name|total
argument_list|,
operator|&
name|sc
operator|->
name|time
argument_list|,
operator|&
name|total
argument_list|)
expr_stmt|;
name|ncall
operator|+=
name|sc
operator|->
name|ncalls
expr_stmt|;
name|nerror
operator|+=
name|sc
operator|->
name|nerror
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%20s%15s%8s%8s\n"
argument_list|,
literal|""
argument_list|,
literal|"-------------"
argument_list|,
literal|"-------"
argument_list|,
literal|"-------"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|trussinfo
operator|->
name|outfile
argument_list|,
literal|"%-20s%5jd.%09ld%8d%8d\n"
argument_list|,
literal|""
argument_list|,
operator|(
name|intmax_t
operator|)
name|total
operator|.
name|tv_sec
argument_list|,
name|total
operator|.
name|tv_nsec
argument_list|,
name|ncall
argument_list|,
name|nerror
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

