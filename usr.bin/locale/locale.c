begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2002, 2003 Alexey Zelkin<phantom@FreeBSD.org>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_comment
comment|/*  * XXX: implement missing era_* (LC_TIME) keywords (require libc&  *	nl_langinfo(3) extensions)  *  * XXX: correctly handle reserved 'charmap' keyword and '-m' option (require  *      localedef(1) implementation).  Currently it's handled via  *	nl_langinfo(CODESET).  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<dirent.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_include
include|#
directive|include
file|<langinfo.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stringlist.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"setlocale.h"
end_include

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
name|void
name|init_locales_list
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|list_charmaps
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|list_locales
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|const
name|char
modifier|*
name|lookup_localecat
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|kwval_lconv
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|kwval_lookup
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|showdetails
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|showkeywordslist
parameter_list|(
name|char
modifier|*
name|substring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|showlocale
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|usage
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Global variables */
end_comment

begin_decl_stmt
specifier|static
name|StringList
modifier|*
name|locales
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|all_locales
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|all_charmaps
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|prt_categories
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|prt_keywords
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|more_params
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|_lcinfo
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|id
decl_stmt|;
block|}
name|lcinfo
index|[]
init|=
block|{
block|{
literal|"LC_CTYPE"
block|,
name|LC_CTYPE
block|}
block|,
block|{
literal|"LC_COLLATE"
block|,
name|LC_COLLATE
block|}
block|,
block|{
literal|"LC_TIME"
block|,
name|LC_TIME
block|}
block|,
block|{
literal|"LC_NUMERIC"
block|,
name|LC_NUMERIC
block|}
block|,
block|{
literal|"LC_MONETARY"
block|,
name|LC_MONETARY
block|}
block|,
block|{
literal|"LC_MESSAGES"
block|,
name|LC_MESSAGES
block|}
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|NLCINFO
value|(sizeof(lcinfo)/sizeof(lcinfo[0]))
end_define

begin_comment
comment|/* ids for values not referenced by nl_langinfo() */
end_comment

begin_define
define|#
directive|define
name|KW_ZERO
value|10000
end_define

begin_define
define|#
directive|define
name|KW_GROUPING
value|(KW_ZERO+1)
end_define

begin_define
define|#
directive|define
name|KW_INT_CURR_SYMBOL
value|(KW_ZERO+2)
end_define

begin_define
define|#
directive|define
name|KW_CURRENCY_SYMBOL
value|(KW_ZERO+3)
end_define

begin_define
define|#
directive|define
name|KW_MON_DECIMAL_POINT
value|(KW_ZERO+4)
end_define

begin_define
define|#
directive|define
name|KW_MON_THOUSANDS_SEP
value|(KW_ZERO+5)
end_define

begin_define
define|#
directive|define
name|KW_MON_GROUPING
value|(KW_ZERO+6)
end_define

begin_define
define|#
directive|define
name|KW_POSITIVE_SIGN
value|(KW_ZERO+7)
end_define

begin_define
define|#
directive|define
name|KW_NEGATIVE_SIGN
value|(KW_ZERO+8)
end_define

begin_define
define|#
directive|define
name|KW_INT_FRAC_DIGITS
value|(KW_ZERO+9)
end_define

begin_define
define|#
directive|define
name|KW_FRAC_DIGITS
value|(KW_ZERO+10)
end_define

begin_define
define|#
directive|define
name|KW_P_CS_PRECEDES
value|(KW_ZERO+11)
end_define

begin_define
define|#
directive|define
name|KW_P_SEP_BY_SPACE
value|(KW_ZERO+12)
end_define

begin_define
define|#
directive|define
name|KW_N_CS_PRECEDES
value|(KW_ZERO+13)
end_define

begin_define
define|#
directive|define
name|KW_N_SEP_BY_SPACE
value|(KW_ZERO+14)
end_define

begin_define
define|#
directive|define
name|KW_P_SIGN_POSN
value|(KW_ZERO+15)
end_define

begin_define
define|#
directive|define
name|KW_N_SIGN_POSN
value|(KW_ZERO+16)
end_define

begin_define
define|#
directive|define
name|KW_INT_P_CS_PRECEDES
value|(KW_ZERO+17)
end_define

begin_define
define|#
directive|define
name|KW_INT_P_SEP_BY_SPACE
value|(KW_ZERO+18)
end_define

begin_define
define|#
directive|define
name|KW_INT_N_CS_PRECEDES
value|(KW_ZERO+19)
end_define

begin_define
define|#
directive|define
name|KW_INT_N_SEP_BY_SPACE
value|(KW_ZERO+20)
end_define

begin_define
define|#
directive|define
name|KW_INT_P_SIGN_POSN
value|(KW_ZERO+21)
end_define

begin_define
define|#
directive|define
name|KW_INT_N_SIGN_POSN
value|(KW_ZERO+22)
end_define

begin_struct
struct|struct
name|_kwinfo
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|isstr
decl_stmt|;
comment|/* true - string, false - number */
name|int
name|catid
decl_stmt|;
comment|/* LC_* */
name|int
name|value_ref
decl_stmt|;
specifier|const
name|char
modifier|*
name|comment
decl_stmt|;
block|}
name|kwinfo
index|[]
init|=
block|{
block|{
literal|"charmap"
block|,
literal|1
block|,
name|LC_CTYPE
block|,
name|CODESET
block|,
literal|""
block|}
block|,
comment|/* hack */
block|{
literal|"decimal_point"
block|,
literal|1
block|,
name|LC_NUMERIC
block|,
name|RADIXCHAR
block|,
literal|""
block|}
block|,
block|{
literal|"thousands_sep"
block|,
literal|1
block|,
name|LC_NUMERIC
block|,
name|THOUSEP
block|,
literal|""
block|}
block|,
block|{
literal|"grouping"
block|,
literal|1
block|,
name|LC_NUMERIC
block|,
name|KW_GROUPING
block|,
literal|""
block|}
block|,
block|{
literal|"radixchar"
block|,
literal|1
block|,
name|LC_NUMERIC
block|,
name|RADIXCHAR
block|,
literal|"Same as decimal_point (FreeBSD only)"
block|}
block|,
comment|/* compat */
block|{
literal|"thousep"
block|,
literal|1
block|,
name|LC_NUMERIC
block|,
name|THOUSEP
block|,
literal|"Same as thousands_sep (FreeBSD only)"
block|}
block|,
comment|/* compat */
block|{
literal|"int_curr_symbol"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_INT_CURR_SYMBOL
block|,
literal|""
block|}
block|,
block|{
literal|"currency_symbol"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_CURRENCY_SYMBOL
block|,
literal|""
block|}
block|,
block|{
literal|"mon_decimal_point"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_MON_DECIMAL_POINT
block|,
literal|""
block|}
block|,
block|{
literal|"mon_thousands_sep"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_MON_THOUSANDS_SEP
block|,
literal|""
block|}
block|,
block|{
literal|"mon_grouping"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_MON_GROUPING
block|,
literal|""
block|}
block|,
block|{
literal|"positive_sign"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_POSITIVE_SIGN
block|,
literal|""
block|}
block|,
block|{
literal|"negative_sign"
block|,
literal|1
block|,
name|LC_MONETARY
block|,
name|KW_NEGATIVE_SIGN
block|,
literal|""
block|}
block|,
block|{
literal|"int_frac_digits"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_FRAC_DIGITS
block|,
literal|""
block|}
block|,
block|{
literal|"frac_digits"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_FRAC_DIGITS
block|,
literal|""
block|}
block|,
block|{
literal|"p_cs_precedes"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_P_CS_PRECEDES
block|,
literal|""
block|}
block|,
block|{
literal|"p_sep_by_space"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_P_SEP_BY_SPACE
block|,
literal|""
block|}
block|,
block|{
literal|"n_cs_precedes"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_N_CS_PRECEDES
block|,
literal|""
block|}
block|,
block|{
literal|"n_sep_by_space"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_N_SEP_BY_SPACE
block|,
literal|""
block|}
block|,
block|{
literal|"p_sign_posn"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_P_SIGN_POSN
block|,
literal|""
block|}
block|,
block|{
literal|"n_sign_posn"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_N_SIGN_POSN
block|,
literal|""
block|}
block|,
block|{
literal|"int_p_cs_precedes"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_P_CS_PRECEDES
block|,
literal|""
block|}
block|,
block|{
literal|"int_p_sep_by_space"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_P_SEP_BY_SPACE
block|,
literal|""
block|}
block|,
block|{
literal|"int_n_cs_precedes"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_N_CS_PRECEDES
block|,
literal|""
block|}
block|,
block|{
literal|"int_n_sep_by_space"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_N_SEP_BY_SPACE
block|,
literal|""
block|}
block|,
block|{
literal|"int_p_sign_posn"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_P_SIGN_POSN
block|,
literal|""
block|}
block|,
block|{
literal|"int_n_sign_posn"
block|,
literal|0
block|,
name|LC_MONETARY
block|,
name|KW_INT_N_SIGN_POSN
block|,
literal|""
block|}
block|,
block|{
literal|"d_t_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|D_T_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"d_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|D_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"t_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|T_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"c_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|C_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"x_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|X_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"X_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|CAPITALX_FMT
block|,
literal|""
block|}
block|,
block|{
literal|"am_str"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|AM_STR
block|,
literal|""
block|}
block|,
block|{
literal|"pm_str"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|PM_STR
block|,
literal|""
block|}
block|,
block|{
literal|"t_fmt_ampm"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|T_FMT_AMPM
block|,
literal|""
block|}
block|,
block|{
literal|"day_1"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_1
block|,
literal|""
block|}
block|,
block|{
literal|"day_2"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_2
block|,
literal|""
block|}
block|,
block|{
literal|"day_3"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_3
block|,
literal|""
block|}
block|,
block|{
literal|"day_4"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_4
block|,
literal|""
block|}
block|,
block|{
literal|"day_5"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_5
block|,
literal|""
block|}
block|,
block|{
literal|"day_6"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_6
block|,
literal|""
block|}
block|,
block|{
literal|"day_7"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|DAY_7
block|,
literal|""
block|}
block|,
block|{
literal|"abday_1"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_1
block|,
literal|""
block|}
block|,
block|{
literal|"abday_2"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_2
block|,
literal|""
block|}
block|,
block|{
literal|"abday_3"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_3
block|,
literal|""
block|}
block|,
block|{
literal|"abday_4"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_4
block|,
literal|""
block|}
block|,
block|{
literal|"abday_5"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_5
block|,
literal|""
block|}
block|,
block|{
literal|"abday_6"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_6
block|,
literal|""
block|}
block|,
block|{
literal|"abday_7"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABDAY_7
block|,
literal|""
block|}
block|,
block|{
literal|"mon_1"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_1
block|,
literal|""
block|}
block|,
block|{
literal|"mon_2"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_2
block|,
literal|""
block|}
block|,
block|{
literal|"mon_3"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_3
block|,
literal|""
block|}
block|,
block|{
literal|"mon_4"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_4
block|,
literal|""
block|}
block|,
block|{
literal|"mon_5"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_5
block|,
literal|""
block|}
block|,
block|{
literal|"mon_6"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_6
block|,
literal|""
block|}
block|,
block|{
literal|"mon_7"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_7
block|,
literal|""
block|}
block|,
block|{
literal|"mon_8"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_8
block|,
literal|""
block|}
block|,
block|{
literal|"mon_9"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_9
block|,
literal|""
block|}
block|,
block|{
literal|"mon_10"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_10
block|,
literal|""
block|}
block|,
block|{
literal|"mon_11"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_11
block|,
literal|""
block|}
block|,
block|{
literal|"mon_12"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|MON_12
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_1"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_1
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_2"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_2
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_3"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_3
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_4"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_4
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_5"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_5
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_6"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_6
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_7"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_7
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_8"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_8
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_9"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_9
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_10"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_10
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_11"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_11
block|,
literal|""
block|}
block|,
block|{
literal|"abmon_12"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ABMON_12
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_1"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_1
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_2"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_2
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_3"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_3
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_4"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_4
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_5"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_5
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_6"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_6
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_7"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_7
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_8"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_8
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_9"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_9
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_10"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_10
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_11"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_11
block|,
literal|""
block|}
block|,
block|{
literal|"altmon_12"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALTMON_12
block|,
literal|""
block|}
block|,
block|{
literal|"era"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ERA
block|,
literal|"(unavailable)"
block|}
block|,
block|{
literal|"era_d_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ERA_D_FMT
block|,
literal|"(unavailable)"
block|}
block|,
block|{
literal|"era_d_t_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ERA_D_T_FMT
block|,
literal|"(unavailable)"
block|}
block|,
block|{
literal|"era_t_fmt"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ERA_T_FMT
block|,
literal|"(unavailable)"
block|}
block|,
block|{
literal|"alt_digits"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|ALT_DIGITS
block|,
literal|""
block|}
block|,
block|{
literal|"d_md_order"
block|,
literal|1
block|,
name|LC_TIME
block|,
name|D_MD_ORDER
block|,
literal|"(FreeBSD only)"
block|}
block|,
comment|/* local */
block|{
literal|"yesexpr"
block|,
literal|1
block|,
name|LC_MESSAGES
block|,
name|YESEXPR
block|,
literal|""
block|}
block|,
block|{
literal|"noexpr"
block|,
literal|1
block|,
name|LC_MESSAGES
block|,
name|NOEXPR
block|,
literal|""
block|}
block|,
block|{
literal|"yesstr"
block|,
literal|1
block|,
name|LC_MESSAGES
block|,
name|YESSTR
block|,
literal|"(POSIX legacy)"
block|}
block|,
comment|/* compat */
block|{
literal|"nostr"
block|,
literal|1
block|,
name|LC_MESSAGES
block|,
name|NOSTR
block|,
literal|"(POSIX legacy)"
block|}
comment|/* compat */
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|NKWINFO
value|(sizeof(kwinfo)/sizeof(kwinfo[0]))
end_define

begin_decl_stmt
specifier|const
name|char
modifier|*
name|boguslocales
index|[]
init|=
block|{
literal|"UTF-8"
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|NBOGUS
value|(sizeof(boguslocales)/sizeof(boguslocales[0]))
end_define

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|int
name|ch
decl_stmt|;
name|int
name|tmp
decl_stmt|;
while|while
condition|(
operator|(
name|ch
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"ackms:"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|ch
condition|)
block|{
case|case
literal|'a'
case|:
name|all_locales
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|prt_categories
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'k'
case|:
name|prt_keywords
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|all_charmaps
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
name|usage
argument_list|()
expr_stmt|;
block|}
block|}
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
comment|/* validate arguments */
if|if
condition|(
name|all_locales
operator|&&
name|all_charmaps
condition|)
name|usage
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|all_locales
operator|||
name|all_charmaps
operator|)
operator|&&
name|argc
operator|>
literal|0
condition|)
name|usage
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|all_locales
operator|||
name|all_charmaps
operator|)
operator|&&
operator|(
name|prt_categories
operator|||
name|prt_keywords
operator|)
condition|)
name|usage
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|prt_categories
operator|||
name|prt_keywords
operator|)
operator|&&
name|argc
operator|<=
literal|0
condition|)
name|usage
argument_list|()
expr_stmt|;
comment|/* process '-a' */
if|if
condition|(
name|all_locales
condition|)
block|{
name|list_locales
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* process '-m' */
if|if
condition|(
name|all_charmaps
condition|)
block|{
name|list_charmaps
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* check for special case '-k list' */
name|tmp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|prt_keywords
operator|&&
name|argc
operator|>
literal|0
condition|)
while|while
condition|(
name|tmp
operator|<
name|argc
condition|)
if|if
condition|(
name|strcasecmp
argument_list|(
name|argv
index|[
name|tmp
operator|++
index|]
argument_list|,
literal|"list"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|showkeywordslist
argument_list|(
name|argv
index|[
name|tmp
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* process '-c' and/or '-k' */
if|if
condition|(
name|prt_categories
operator|||
name|prt_keywords
operator|||
name|argc
operator|>
literal|0
condition|)
block|{
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|""
argument_list|)
expr_stmt|;
while|while
condition|(
name|argc
operator|>
literal|0
condition|)
block|{
name|showdetails
argument_list|(
operator|*
name|argv
argument_list|)
expr_stmt|;
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* no arguments, show current locale state */
name|showlocale
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|usage
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"Usage: locale [ -a | -m ]\n"
literal|"       locale -k list [prefix]\n"
literal|"       locale [ -ck ] keyword ...\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Output information about all available locales  *  * XXX actually output of this function does not guarantee that locale  *     is really available to application, since it can be broken or  *     inconsistent thus setlocale() will fail.  Maybe add '-V' function to  *     also validate these locales?  */
end_comment

begin_function
name|void
name|list_locales
parameter_list|(
name|void
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|init_locales_list
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|locales
operator|->
name|sl_cur
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|locales
operator|->
name|sl_str
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * qsort() helper function  */
end_comment

begin_function
specifier|static
name|int
name|scmp
parameter_list|(
specifier|const
name|void
modifier|*
name|s1
parameter_list|,
specifier|const
name|void
modifier|*
name|s2
parameter_list|)
block|{
return|return
name|strcmp
argument_list|(
operator|*
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|s1
argument_list|,
operator|*
operator|(
specifier|const
name|char
operator|*
operator|*
operator|)
name|s2
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Output information about all available charmaps  *  * XXX this function is doing a task in hackish way, i.e. by scaning  *     list of locales, spliting their codeset part and building list of  *     them.  */
end_comment

begin_function
name|void
name|list_charmaps
parameter_list|(
name|void
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|cs
decl_stmt|;
name|StringList
modifier|*
name|charmaps
decl_stmt|;
comment|/* initialize StringList */
name|charmaps
operator|=
name|sl_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|charmaps
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"could not allocate memory"
argument_list|)
expr_stmt|;
comment|/* fetch locales list */
name|init_locales_list
argument_list|()
expr_stmt|;
comment|/* split codesets and build their list */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|locales
operator|->
name|sl_cur
condition|;
name|i
operator|++
control|)
block|{
name|s
operator|=
name|locales
operator|->
name|sl_str
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|cs
operator|=
name|strchr
argument_list|(
name|s
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|cs
operator|++
expr_stmt|;
if|if
condition|(
name|sl_find
argument_list|(
name|charmaps
argument_list|,
name|cs
argument_list|)
operator|==
name|NULL
condition|)
name|sl_add
argument_list|(
name|charmaps
argument_list|,
name|cs
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* add US-ASCII, if not yet added */
if|if
condition|(
name|sl_find
argument_list|(
name|charmaps
argument_list|,
literal|"US-ASCII"
argument_list|)
operator|==
name|NULL
condition|)
name|sl_add
argument_list|(
name|charmaps
argument_list|,
literal|"US-ASCII"
argument_list|)
expr_stmt|;
comment|/* sort the list */
name|qsort
argument_list|(
name|charmaps
operator|->
name|sl_str
argument_list|,
name|charmaps
operator|->
name|sl_cur
argument_list|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
argument_list|,
name|scmp
argument_list|)
expr_stmt|;
comment|/* print results */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|charmaps
operator|->
name|sl_cur
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|charmaps
operator|->
name|sl_str
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Retrieve sorted list of system locales (or user locales, if PATH_LOCALE  * environment variable is set)  */
end_comment

begin_function
name|void
name|init_locales_list
parameter_list|(
name|void
parameter_list|)
block|{
name|DIR
modifier|*
name|dirp
decl_stmt|;
name|struct
name|dirent
modifier|*
name|dp
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|int
name|bogus
decl_stmt|;
comment|/* why call this function twice ? */
if|if
condition|(
name|locales
operator|!=
name|NULL
condition|)
return|return;
comment|/* initialize StringList */
name|locales
operator|=
name|sl_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|locales
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"could not allocate memory"
argument_list|)
expr_stmt|;
comment|/* get actual locales directory name */
if|if
condition|(
name|__detect_path_locale
argument_list|()
operator|!=
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"unable to find locales storage"
argument_list|)
expr_stmt|;
comment|/* open locales directory */
name|dirp
operator|=
name|opendir
argument_list|(
name|_PathLocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|dirp
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"could not open directory '%s'"
argument_list|,
name|_PathLocale
argument_list|)
expr_stmt|;
comment|/* scan directory and store its contents except "." and ".." */
while|while
condition|(
operator|(
name|dp
operator|=
name|readdir
argument_list|(
name|dirp
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
operator|(
name|dp
operator|->
name|d_name
operator|)
operator|==
literal|'.'
condition|)
continue|continue;
comment|/* exclude "." and ".." */
for|for
control|(
name|bogus
operator|=
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NBOGUS
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strncmp
argument_list|(
name|dp
operator|->
name|d_name
argument_list|,
name|boguslocales
index|[
name|i
index|]
argument_list|,
name|strlen
argument_list|(
name|boguslocales
index|[
name|i
index|]
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|bogus
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|bogus
condition|)
name|sl_add
argument_list|(
name|locales
argument_list|,
name|strdup
argument_list|(
name|dp
operator|->
name|d_name
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|closedir
argument_list|(
name|dirp
argument_list|)
expr_stmt|;
comment|/* make sure that 'POSIX' and 'C' locales are present in the list. 	 * POSIX 1003.1-2001 requires presence of 'POSIX' name only here, but          * we also list 'C' for constistency          */
if|if
condition|(
name|sl_find
argument_list|(
name|locales
argument_list|,
literal|"POSIX"
argument_list|)
operator|==
name|NULL
condition|)
name|sl_add
argument_list|(
name|locales
argument_list|,
literal|"POSIX"
argument_list|)
expr_stmt|;
if|if
condition|(
name|sl_find
argument_list|(
name|locales
argument_list|,
literal|"C"
argument_list|)
operator|==
name|NULL
condition|)
name|sl_add
argument_list|(
name|locales
argument_list|,
literal|"C"
argument_list|)
expr_stmt|;
comment|/* make output nicer, sort the list */
name|qsort
argument_list|(
name|locales
operator|->
name|sl_str
argument_list|,
name|locales
operator|->
name|sl_cur
argument_list|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
argument_list|,
name|scmp
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Show current locale status, depending on environment variables  */
end_comment

begin_function
name|void
name|showlocale
parameter_list|(
name|void
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
specifier|const
name|char
modifier|*
name|lang
decl_stmt|,
modifier|*
name|vval
decl_stmt|,
modifier|*
name|eval
decl_stmt|;
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|lang
operator|=
name|getenv
argument_list|(
literal|"LANG"
argument_list|)
expr_stmt|;
if|if
condition|(
name|lang
operator|==
name|NULL
condition|)
block|{
name|lang
operator|=
literal|""
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"LANG=%s\n"
argument_list|,
name|lang
argument_list|)
expr_stmt|;
comment|/* XXX: if LANG is null, then set it to "C" to get implied values? */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NLCINFO
condition|;
name|i
operator|++
control|)
block|{
name|vval
operator|=
name|setlocale
argument_list|(
name|lcinfo
index|[
name|i
index|]
operator|.
name|id
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|eval
operator|=
name|getenv
argument_list|(
name|lcinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|eval
operator|!=
name|NULL
operator|&&
operator|!
name|strcmp
argument_list|(
name|eval
argument_list|,
name|vval
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|lang
argument_list|,
name|vval
argument_list|)
condition|)
block|{
comment|/* 			 * Appropriate environment variable set, its value 			 * is valid and not overriden by LC_ALL 			 * 			 * XXX: possible side effect: if both LANG and 			 * overriden environment variable are set into same 			 * value, then it'll be assumed as 'implied' 			 */
name|printf
argument_list|(
literal|"%s=%s\n"
argument_list|,
name|lcinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|vval
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%s=\"%s\"\n"
argument_list|,
name|lcinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|vval
argument_list|)
expr_stmt|;
block|}
block|}
name|vval
operator|=
name|getenv
argument_list|(
literal|"LC_ALL"
argument_list|)
expr_stmt|;
if|if
condition|(
name|vval
operator|==
name|NULL
condition|)
block|{
name|vval
operator|=
literal|""
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"LC_ALL=%s\n"
argument_list|,
name|vval
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * keyword value lookup helper (via localeconv())  */
end_comment

begin_function
name|char
modifier|*
name|kwval_lconv
parameter_list|(
name|int
name|id
parameter_list|)
block|{
name|struct
name|lconv
modifier|*
name|lc
decl_stmt|;
name|char
modifier|*
name|rval
decl_stmt|;
name|rval
operator|=
name|NULL
expr_stmt|;
name|lc
operator|=
name|localeconv
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|KW_GROUPING
case|:
name|rval
operator|=
name|lc
operator|->
name|grouping
expr_stmt|;
break|break;
case|case
name|KW_INT_CURR_SYMBOL
case|:
name|rval
operator|=
name|lc
operator|->
name|int_curr_symbol
expr_stmt|;
break|break;
case|case
name|KW_CURRENCY_SYMBOL
case|:
name|rval
operator|=
name|lc
operator|->
name|currency_symbol
expr_stmt|;
break|break;
case|case
name|KW_MON_DECIMAL_POINT
case|:
name|rval
operator|=
name|lc
operator|->
name|mon_decimal_point
expr_stmt|;
break|break;
case|case
name|KW_MON_THOUSANDS_SEP
case|:
name|rval
operator|=
name|lc
operator|->
name|mon_thousands_sep
expr_stmt|;
break|break;
case|case
name|KW_MON_GROUPING
case|:
name|rval
operator|=
name|lc
operator|->
name|mon_grouping
expr_stmt|;
break|break;
case|case
name|KW_POSITIVE_SIGN
case|:
name|rval
operator|=
name|lc
operator|->
name|positive_sign
expr_stmt|;
break|break;
case|case
name|KW_NEGATIVE_SIGN
case|:
name|rval
operator|=
name|lc
operator|->
name|negative_sign
expr_stmt|;
break|break;
case|case
name|KW_INT_FRAC_DIGITS
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_frac_digits
operator|)
expr_stmt|;
break|break;
case|case
name|KW_FRAC_DIGITS
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|frac_digits
operator|)
expr_stmt|;
break|break;
case|case
name|KW_P_CS_PRECEDES
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|p_cs_precedes
operator|)
expr_stmt|;
break|break;
case|case
name|KW_P_SEP_BY_SPACE
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|p_sep_by_space
operator|)
expr_stmt|;
break|break;
case|case
name|KW_N_CS_PRECEDES
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|n_cs_precedes
operator|)
expr_stmt|;
break|break;
case|case
name|KW_N_SEP_BY_SPACE
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|n_sep_by_space
operator|)
expr_stmt|;
break|break;
case|case
name|KW_P_SIGN_POSN
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|p_sign_posn
operator|)
expr_stmt|;
break|break;
case|case
name|KW_N_SIGN_POSN
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|n_sign_posn
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_P_CS_PRECEDES
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_p_cs_precedes
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_P_SEP_BY_SPACE
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_p_sep_by_space
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_N_CS_PRECEDES
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_n_cs_precedes
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_N_SEP_BY_SPACE
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_n_sep_by_space
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_P_SIGN_POSN
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_p_sign_posn
operator|)
expr_stmt|;
break|break;
case|case
name|KW_INT_N_SIGN_POSN
case|:
name|rval
operator|=
operator|&
operator|(
name|lc
operator|->
name|int_n_sign_posn
operator|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
operator|(
name|rval
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * keyword value and properties lookup  */
end_comment

begin_function
name|int
name|kwval_lookup
parameter_list|(
name|char
modifier|*
name|kwname
parameter_list|,
name|char
modifier|*
modifier|*
name|kwval
parameter_list|,
name|int
modifier|*
name|cat
parameter_list|,
name|int
modifier|*
name|isstr
parameter_list|)
block|{
name|int
name|rval
decl_stmt|;
name|size_t
name|i
decl_stmt|;
name|rval
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NKWINFO
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcasecmp
argument_list|(
name|kwname
argument_list|,
name|kwinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|rval
operator|=
literal|1
expr_stmt|;
operator|*
name|cat
operator|=
name|kwinfo
index|[
name|i
index|]
operator|.
name|catid
expr_stmt|;
operator|*
name|isstr
operator|=
name|kwinfo
index|[
name|i
index|]
operator|.
name|isstr
expr_stmt|;
if|if
condition|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|value_ref
operator|<
name|KW_ZERO
condition|)
block|{
operator|*
name|kwval
operator|=
name|nl_langinfo
argument_list|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|value_ref
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|kwval
operator|=
name|kwval_lconv
argument_list|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|value_ref
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
return|return
operator|(
name|rval
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Show details about requested keyword according to '-k' and/or '-c'  * command line options specified.  */
end_comment

begin_function
name|void
name|showdetails
parameter_list|(
name|char
modifier|*
name|kw
parameter_list|)
block|{
name|int
name|isstr
decl_stmt|,
name|cat
decl_stmt|,
name|tmpval
decl_stmt|;
name|char
modifier|*
name|kwval
decl_stmt|;
if|if
condition|(
name|kwval_lookup
argument_list|(
name|kw
argument_list|,
operator|&
name|kwval
argument_list|,
operator|&
name|cat
argument_list|,
operator|&
name|isstr
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* 		 * invalid keyword specified. 		 * XXX: any actions? 		 */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Unknown keyword: `%s'\n"
argument_list|,
name|kw
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|prt_categories
condition|)
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|lookup_localecat
argument_list|(
name|cat
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|prt_keywords
condition|)
block|{
if|if
condition|(
name|isstr
condition|)
block|{
name|printf
argument_list|(
literal|"%s=\"%s\"\n"
argument_list|,
name|kw
argument_list|,
name|kwval
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmpval
operator|=
operator|(
name|char
operator|)
operator|*
name|kwval
expr_stmt|;
name|printf
argument_list|(
literal|"%s=%d\n"
argument_list|,
name|kw
argument_list|,
name|tmpval
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|prt_categories
operator|&&
operator|!
name|prt_keywords
condition|)
block|{
if|if
condition|(
name|isstr
condition|)
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|kwval
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmpval
operator|=
operator|(
name|char
operator|)
operator|*
name|kwval
expr_stmt|;
name|printf
argument_list|(
literal|"%d\n"
argument_list|,
name|tmpval
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Convert locale category id into string  */
end_comment

begin_function
specifier|const
name|char
modifier|*
name|lookup_localecat
parameter_list|(
name|int
name|cat
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NLCINFO
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|lcinfo
index|[
name|i
index|]
operator|.
name|id
operator|==
name|cat
condition|)
block|{
return|return
operator|(
name|lcinfo
index|[
name|i
index|]
operator|.
name|name
operator|)
return|;
block|}
return|return
operator|(
literal|"UNKNOWN"
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Show list of keywords  */
end_comment

begin_function
name|void
name|showkeywordslist
parameter_list|(
name|char
modifier|*
name|substring
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
define|#
directive|define
name|FMT
value|"%-20s %-12s %-7s %-20s\n"
if|if
condition|(
name|substring
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|"List of available keywords\n\n"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"List of available keywords starting with '%s'\n\n"
argument_list|,
name|substring
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|FMT
argument_list|,
literal|"Keyword"
argument_list|,
literal|"Category"
argument_list|,
literal|"Type"
argument_list|,
literal|"Comment"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-------------------- ------------ ------- --------------------\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NKWINFO
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|substring
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|substring
argument_list|,
name|strlen
argument_list|(
name|substring
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
continue|continue;
block|}
name|printf
argument_list|(
name|FMT
argument_list|,
name|kwinfo
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|lookup_localecat
argument_list|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|catid
argument_list|)
argument_list|,
operator|(
name|kwinfo
index|[
name|i
index|]
operator|.
name|isstr
operator|==
literal|0
operator|)
condition|?
literal|"number"
else|:
literal|"string"
argument_list|,
name|kwinfo
index|[
name|i
index|]
operator|.
name|comment
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

