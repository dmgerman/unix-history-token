begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $FreeBSD$ */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__LP64__
end_ifndef

begin_error
error|#
directive|error
literal|"this file must be compiled for LP64."
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|__ELF_WORD_SIZE
value|32
end_define

begin_define
define|#
directive|define
name|_MACHINE_ELF_WANT_32BIT
end_define

begin_include
include|#
directive|include
file|<sys/procfs.h>
end_include

begin_struct
struct|struct
name|prpsinfo32
block|{
name|int
name|pr_version
decl_stmt|;
name|u_int
name|pr_psinfosz
decl_stmt|;
name|char
name|pr_fname
index|[
name|PRFNAMESZ
operator|+
literal|1
index|]
decl_stmt|;
name|char
name|pr_psargs
index|[
name|PRARGSZ
operator|+
literal|1
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|prstatus32
block|{
name|int
name|pr_version
decl_stmt|;
name|u_int
name|pr_statussz
decl_stmt|;
name|u_int
name|pr_gregsetsz
decl_stmt|;
name|u_int
name|pr_fpregsetsz
decl_stmt|;
name|int
name|pr_osreldate
decl_stmt|;
name|int
name|pr_cursig
decl_stmt|;
name|pid_t
name|pr_pid
decl_stmt|;
name|struct
name|reg32
name|pr_reg
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ELFCORE_COMPAT_32
value|1
end_define

begin_include
include|#
directive|include
file|"elfcore.c"
end_include

begin_function
specifier|static
name|void
name|elf_convert_gregset
parameter_list|(
name|elfcore_gregset_t
modifier|*
name|rd
parameter_list|,
name|struct
name|reg
modifier|*
name|rs
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|__amd64__
name|rd
operator|->
name|r_gs
operator|=
name|rs
operator|->
name|r_gs
expr_stmt|;
name|rd
operator|->
name|r_fs
operator|=
name|rs
operator|->
name|r_fs
expr_stmt|;
name|rd
operator|->
name|r_es
operator|=
name|rs
operator|->
name|r_es
expr_stmt|;
name|rd
operator|->
name|r_ds
operator|=
name|rs
operator|->
name|r_ds
expr_stmt|;
name|rd
operator|->
name|r_edi
operator|=
name|rs
operator|->
name|r_rdi
expr_stmt|;
name|rd
operator|->
name|r_esi
operator|=
name|rs
operator|->
name|r_rsi
expr_stmt|;
name|rd
operator|->
name|r_ebp
operator|=
name|rs
operator|->
name|r_rbp
expr_stmt|;
name|rd
operator|->
name|r_ebx
operator|=
name|rs
operator|->
name|r_rbx
expr_stmt|;
name|rd
operator|->
name|r_edx
operator|=
name|rs
operator|->
name|r_rdx
expr_stmt|;
name|rd
operator|->
name|r_ecx
operator|=
name|rs
operator|->
name|r_rcx
expr_stmt|;
name|rd
operator|->
name|r_eax
operator|=
name|rs
operator|->
name|r_rax
expr_stmt|;
name|rd
operator|->
name|r_eip
operator|=
name|rs
operator|->
name|r_rip
expr_stmt|;
name|rd
operator|->
name|r_cs
operator|=
name|rs
operator|->
name|r_cs
expr_stmt|;
name|rd
operator|->
name|r_eflags
operator|=
name|rs
operator|->
name|r_rflags
expr_stmt|;
name|rd
operator|->
name|r_esp
operator|=
name|rs
operator|->
name|r_rsp
expr_stmt|;
name|rd
operator|->
name|r_ss
operator|=
name|rs
operator|->
name|r_ss
expr_stmt|;
else|#
directive|else
error|#
directive|error
error|Unsupported architecture
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
name|elf_convert_fpregset
parameter_list|(
name|elfcore_fpregset_t
modifier|*
name|rd
parameter_list|,
name|struct
name|fpreg
modifier|*
name|rs
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|__amd64__
comment|/* XXX this is wrong... */
name|memcpy
argument_list|(
name|rd
argument_list|,
name|rs
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|rd
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
error|#
directive|error
error|Unsupported architecture
endif|#
directive|endif
block|}
end_function

end_unit

