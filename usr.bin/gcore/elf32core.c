begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $FreeBSD$ */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__LP64__
end_ifndef

begin_error
error|#
directive|error
literal|"this file must be compiled for LP64."
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|__ELF_WORD_SIZE
value|32
end_define

begin_define
define|#
directive|define
name|_MACHINE_ELF_WANT_32BIT
end_define

begin_define
define|#
directive|define
name|_WANT_LWPINFO32
end_define

begin_include
include|#
directive|include
file|<sys/procfs.h>
end_include

begin_define
define|#
directive|define
name|ELFCORE_COMPAT_32
value|1
end_define

begin_include
include|#
directive|include
file|"elfcore.c"
end_include

begin_function
specifier|static
name|void
name|elf_convert_gregset
parameter_list|(
name|elfcore_gregset_t
modifier|*
name|rd
parameter_list|,
name|struct
name|reg
modifier|*
name|rs
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|__amd64__
name|rd
operator|->
name|r_gs
operator|=
name|rs
operator|->
name|r_gs
expr_stmt|;
name|rd
operator|->
name|r_fs
operator|=
name|rs
operator|->
name|r_fs
expr_stmt|;
name|rd
operator|->
name|r_es
operator|=
name|rs
operator|->
name|r_es
expr_stmt|;
name|rd
operator|->
name|r_ds
operator|=
name|rs
operator|->
name|r_ds
expr_stmt|;
name|rd
operator|->
name|r_edi
operator|=
name|rs
operator|->
name|r_rdi
expr_stmt|;
name|rd
operator|->
name|r_esi
operator|=
name|rs
operator|->
name|r_rsi
expr_stmt|;
name|rd
operator|->
name|r_ebp
operator|=
name|rs
operator|->
name|r_rbp
expr_stmt|;
name|rd
operator|->
name|r_ebx
operator|=
name|rs
operator|->
name|r_rbx
expr_stmt|;
name|rd
operator|->
name|r_edx
operator|=
name|rs
operator|->
name|r_rdx
expr_stmt|;
name|rd
operator|->
name|r_ecx
operator|=
name|rs
operator|->
name|r_rcx
expr_stmt|;
name|rd
operator|->
name|r_eax
operator|=
name|rs
operator|->
name|r_rax
expr_stmt|;
name|rd
operator|->
name|r_eip
operator|=
name|rs
operator|->
name|r_rip
expr_stmt|;
name|rd
operator|->
name|r_cs
operator|=
name|rs
operator|->
name|r_cs
expr_stmt|;
name|rd
operator|->
name|r_eflags
operator|=
name|rs
operator|->
name|r_rflags
expr_stmt|;
name|rd
operator|->
name|r_esp
operator|=
name|rs
operator|->
name|r_rsp
expr_stmt|;
name|rd
operator|->
name|r_ss
operator|=
name|rs
operator|->
name|r_ss
expr_stmt|;
else|#
directive|else
error|#
directive|error
error|Unsupported architecture
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
name|elf_convert_fpregset
parameter_list|(
name|elfcore_fpregset_t
modifier|*
name|rd
parameter_list|,
name|struct
name|fpreg
modifier|*
name|rs
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|__amd64__
comment|/* XXX this is wrong... */
name|memcpy
argument_list|(
name|rd
argument_list|,
name|rs
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|rd
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
error|#
directive|error
error|Unsupported architecture
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
name|elf_convert_siginfo
parameter_list|(
name|struct
name|siginfo32
modifier|*
name|sid
parameter_list|,
name|siginfo_t
modifier|*
name|sis
parameter_list|)
block|{
name|bzero
argument_list|(
name|sid
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|sid
argument_list|)
argument_list|)
expr_stmt|;
name|sid
operator|->
name|si_signo
operator|=
name|sis
operator|->
name|si_signo
expr_stmt|;
name|sid
operator|->
name|si_errno
operator|=
name|sis
operator|->
name|si_errno
expr_stmt|;
name|sid
operator|->
name|si_code
operator|=
name|sis
operator|->
name|si_code
expr_stmt|;
name|sid
operator|->
name|si_pid
operator|=
name|sis
operator|->
name|si_pid
expr_stmt|;
name|sid
operator|->
name|si_uid
operator|=
name|sis
operator|->
name|si_uid
expr_stmt|;
name|sid
operator|->
name|si_status
operator|=
name|sis
operator|->
name|si_status
expr_stmt|;
name|sid
operator|->
name|si_addr
operator|=
operator|(
name|uintptr_t
operator|)
name|sis
operator|->
name|si_addr
expr_stmt|;
if|#
directive|if
name|_BYTE_ORDER
operator|==
name|_BIG_ENDIAN
if|if
condition|(
name|sis
operator|->
name|si_value
operator|.
name|sival_int
operator|==
literal|0
condition|)
name|sid
operator|->
name|si_value
operator|.
name|sival_ptr
operator|=
operator|(
name|uintptr_t
operator|)
name|sis
operator|->
name|si_value
operator|.
name|sival_ptr
expr_stmt|;
else|else
endif|#
directive|endif
name|sid
operator|->
name|si_value
operator|.
name|sival_int
operator|=
name|sis
operator|->
name|si_value
operator|.
name|sival_int
expr_stmt|;
name|sid
operator|->
name|si_timerid
operator|=
name|sis
operator|->
name|si_timerid
expr_stmt|;
name|sid
operator|->
name|si_overrun
operator|=
name|sis
operator|->
name|si_overrun
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|elf_convert_lwpinfo
parameter_list|(
name|struct
name|ptrace_lwpinfo32
modifier|*
name|pld
parameter_list|,
name|struct
name|ptrace_lwpinfo
modifier|*
name|pls
parameter_list|)
block|{
name|pld
operator|->
name|pl_lwpid
operator|=
name|pls
operator|->
name|pl_lwpid
expr_stmt|;
name|pld
operator|->
name|pl_event
operator|=
name|pls
operator|->
name|pl_event
expr_stmt|;
name|pld
operator|->
name|pl_flags
operator|=
name|pls
operator|->
name|pl_flags
expr_stmt|;
name|pld
operator|->
name|pl_sigmask
operator|=
name|pls
operator|->
name|pl_sigmask
expr_stmt|;
name|pld
operator|->
name|pl_siglist
operator|=
name|pls
operator|->
name|pl_siglist
expr_stmt|;
name|elf_convert_siginfo
argument_list|(
operator|&
name|pld
operator|->
name|pl_siginfo
argument_list|,
operator|&
name|pls
operator|->
name|pl_siginfo
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|pld
operator|->
name|pl_tdname
argument_list|,
name|pls
operator|->
name|pl_tdname
argument_list|,
sizeof|sizeof
argument_list|(
name|pld
operator|->
name|pl_tdname
argument_list|)
argument_list|)
expr_stmt|;
name|pld
operator|->
name|pl_child_pid
operator|=
name|pls
operator|->
name|pl_child_pid
expr_stmt|;
name|pld
operator|->
name|pl_syscall_code
operator|=
name|pls
operator|->
name|pl_syscall_code
expr_stmt|;
name|pld
operator|->
name|pl_syscall_narg
operator|=
name|pls
operator|->
name|pl_syscall_narg
expr_stmt|;
block|}
end_function

end_unit

