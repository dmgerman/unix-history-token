begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992, 1993, 1996  *	Berkeley Software Design, Inc.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by Berkeley Software  *	Design, Inc.  *  * THIS SOFTWARE IS PROVIDED BY Berkeley Software Design, Inc. ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL Berkeley Software Design, Inc. BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *	BSDI bios.c,v 2.3 1996/04/08 19:32:19 bostic Exp  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|"doscmd.h"
end_include

begin_include
include|#
directive|include
file|"mouse.h"
end_include

begin_include
include|#
directive|include
file|"com.h"
end_include

begin_define
define|#
directive|define
name|BIOS_copyright
value|0xfe000
end_define

begin_define
define|#
directive|define
name|BIOS_reset
value|0xfe05b
end_define

begin_define
define|#
directive|define
name|BIOS_nmi
value|0xfe2c3
end_define

begin_define
define|#
directive|define
name|BIOS_hdisk_table
value|0xfe401
end_define

begin_define
define|#
directive|define
name|BIOS_boot
value|0xfe6f2
end_define

begin_define
define|#
directive|define
name|BIOS_comm_table
value|0xfe729
end_define

begin_define
define|#
directive|define
name|BIOS_comm_io
value|0xfe739
end_define

begin_define
define|#
directive|define
name|BIOS_keyboard_io
value|0xfe82e
end_define

begin_define
define|#
directive|define
name|BIOS_keyboard_isr
value|0xfe987
end_define

begin_define
define|#
directive|define
name|BIOS_fdisk_io
value|0xfec59
end_define

begin_define
define|#
directive|define
name|BIOS_fdisk_isr
value|0xfef57
end_define

begin_define
define|#
directive|define
name|BIOS_disk_parms
value|0xfefc7
end_define

begin_define
define|#
directive|define
name|BIOS_printer_io
value|0xfefd2
end_define

begin_define
define|#
directive|define
name|BIOS_video_io
value|0xff065
end_define

begin_define
define|#
directive|define
name|BIOS_video_parms
value|0xff0a4
end_define

begin_define
define|#
directive|define
name|BIOS_mem_size
value|0xff841
end_define

begin_define
define|#
directive|define
name|BIOS_equipment
value|0xff84d
end_define

begin_define
define|#
directive|define
name|BIOS_cassette_io
value|0xff859
end_define

begin_define
define|#
directive|define
name|BIOS_video_font
value|0xffa6e
end_define

begin_define
define|#
directive|define
name|BIOS_time_of_day
value|0xffe6e
end_define

begin_define
define|#
directive|define
name|BIOS_timer_int
value|0xffea5
end_define

begin_define
define|#
directive|define
name|BIOS_vector
value|0xffef3
end_define

begin_define
define|#
directive|define
name|BIOS_dummy_iret
value|0xfff53
end_define

begin_define
define|#
directive|define
name|BIOS_print_screen
value|0xfff54
end_define

begin_define
define|#
directive|define
name|BIOS_hard_reset
value|0xffff0
end_define

begin_define
define|#
directive|define
name|BIOS_date_stamp
value|0xffff5
end_define

begin_define
define|#
directive|define
name|BIOS_hardware_id
value|0xffffe
end_define

begin_decl_stmt
specifier|static
name|u_char
name|video_parms
index|[]
init|=
block|{
literal|0x38
block|,
literal|40
block|,
literal|0x2d
block|,
literal|10
block|,
literal|0x1f
block|,
literal|6
block|,
literal|0x19
block|,
literal|0x1c
block|,
literal|2
block|,
literal|7
block|,
literal|6
block|,
literal|7
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0x71
block|,
literal|80
block|,
literal|0x5a
block|,
literal|10
block|,
literal|0x1f
block|,
literal|6
block|,
literal|0x19
block|,
literal|0x1c
block|,
literal|2
block|,
literal|7
block|,
literal|6
block|,
literal|7
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0x38
block|,
literal|40
block|,
literal|0x2d
block|,
literal|10
block|,
literal|0x7f
block|,
literal|6
block|,
literal|0x64
block|,
literal|0x70
block|,
literal|2
block|,
literal|1
block|,
literal|6
block|,
literal|7
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0x61
block|,
literal|80
block|,
literal|0x52
block|,
literal|15
block|,
literal|0x19
block|,
literal|6
block|,
literal|0x19
block|,
literal|0x19
block|,
literal|2
block|,
literal|13
block|,
literal|11
block|,
literal|12
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_char
name|disk_params
index|[]
init|=
block|{
literal|0xdf
block|,
literal|2
block|,
literal|0x25
block|,
literal|2
block|,
literal|0x0f
block|,
literal|0x1b
block|,
literal|0xff
block|,
literal|0x54
block|,
literal|0xf6
block|,
literal|0x0f
block|,
literal|8
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|u_short
name|comm_table
index|[]
init|=
block|{
literal|1047
block|,
literal|768
block|,
literal|384
block|,
literal|192
block|,
literal|96
block|,
literal|48
block|,
literal|24
block|,
literal|12
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* exports */
end_comment

begin_decl_stmt
name|int
name|nfloppies
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ndisks
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nserial
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nparallel
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|long
name|rom_config
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ** BIOS equipment list */
end_comment

begin_function
specifier|static
name|void
name|int11
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
block|{
name|R_AX
operator|=
operator|(
name|nfloppies
condition|?
literal|1
else|:
literal|0
operator|)
operator||
comment|/* do we have any floppydisks? */
operator|(
literal|0x2
operator|<<
literal|4
operator|)
operator||
comment|/* 80x25 colour */
operator|(
operator|(
name|nfloppies
operator|-
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
comment|/* how many floppies? */
operator|(
name|nserial
operator|<<
literal|9
operator|)
operator||
comment|/* serial ports? */
operator|(
name|nparallel
operator|<<
literal|14
operator|)
expr_stmt|;
comment|/* parallel ports? */
block|}
end_function

begin_comment
comment|/* ** get installed memory */
end_comment

begin_function
specifier|static
name|void
name|int12
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
block|{
name|R_AX
operator|=
literal|640
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ** assorted oddments */
end_comment

begin_function
specifier|static
name|void
name|int15
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
block|{
name|int
name|cond
decl_stmt|;
name|int
name|count
decl_stmt|;
name|R_FLAGS
operator|&=
operator|~
name|PSL_C
expr_stmt|;
switch|switch
condition|(
name|R_AH
condition|)
block|{
case|case
literal|0x00
case|:
comment|/* Get Cassette Status */
name|R_AH
operator|=
literal|0x86
expr_stmt|;
name|R_FLAGS
operator||=
name|PSL_C
expr_stmt|;
comment|/* We don't support a cassette */
break|break;
case|case
literal|0x04
case|:
comment|/* Set ABIOS table */
name|R_FLAGS
operator||=
name|PSL_C
expr_stmt|;
comment|/* We don't support it */
break|break;
case|case
literal|0x4f
case|:
comment|/* 	 * XXX - Check scan code in GET8L(sc->sc_eax). 	 */
break|break;
case|case
literal|0x88
case|:
name|get_raw_extmemory_info
argument_list|(
name|REGS
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xc0
case|:
comment|/* get configuration */
name|debug
argument_list|(
name|D_TRAPS
operator||
literal|0x15
argument_list|,
literal|"Get configuration\n"
argument_list|,
name|R_DX
argument_list|)
expr_stmt|;
name|N_PUTVEC
argument_list|(
name|R_ES
argument_list|,
name|R_BX
argument_list|,
name|rom_config
argument_list|)
expr_stmt|;
name|R_AH
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|0xc1
case|:
comment|/* get extended BIOS data area */
name|R_FLAGS
operator||=
name|PSL_C
expr_stmt|;
break|break;
case|case
literal|0xc2
case|:
comment|/* Pointing device */
name|R_FLAGS
operator||=
name|PSL_C
expr_stmt|;
name|R_AH
operator|=
literal|5
expr_stmt|;
comment|/* No pointer */
break|break;
default|default:
name|unknown_int2
argument_list|(
literal|0x15
argument_list|,
name|R_AX
argument_list|,
name|REGS
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function_decl
specifier|extern
name|void
name|int16
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|int17
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|int1a
parameter_list|(
name|regcontext_t
modifier|*
name|REGS
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|bios_init
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|u_char
modifier|*
name|jtab
decl_stmt|;
name|struct
name|timeval
name|tv
decl_stmt|;
name|time_t
name|tv_sec
decl_stmt|;
name|struct
name|timezone
name|tz
decl_stmt|;
name|struct
name|tm
name|tm
decl_stmt|;
name|u_long
name|vec
decl_stmt|;
if|if
condition|(
literal|1
operator|||
operator|!
name|raw_kbd
condition|)
block|{
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|BIOS_copyright
argument_list|,
literal|"Copyright (C) 1993 Krystal Technologies/BSDI"
argument_list|)
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_reset
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_nmi
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_boot
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_comm_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_keyboard_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_keyboard_isr
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_fdisk_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_fdisk_isr
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_printer_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_video_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_cassette_io
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_time_of_day
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_timer_int
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_dummy_iret
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_print_screen
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_hard_reset
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_mem_size
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_equipment
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_vector
operator|=
literal|0xffcd
expr_stmt|;
operator|*
operator|(
name|u_char
operator|*
operator|)
literal|0xffff2
operator|=
literal|0xcf
expr_stmt|;
comment|/* IRET */
comment|/* 	 *memcpy((u_char *)BIOS_video_parms, video_parms, sizeof(video_parms)); 	 */
name|memcpy
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|BIOS_disk_parms
argument_list|,
name|disk_params
argument_list|,
sizeof|sizeof
argument_list|(
name|disk_params
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|BIOS_comm_table
argument_list|,
name|comm_table
argument_list|,
sizeof|sizeof
argument_list|(
name|comm_table
argument_list|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
name|BIOS_video_font
operator|=
literal|0xffcd
expr_stmt|;
name|jtab
operator|=
operator|(
name|u_char
operator|*
operator|)
name|BIOS_date_stamp
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'1'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'0'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'/'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'3'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'1'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'/'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'9'
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|'3'
expr_stmt|;
if|#
directive|if
literal|0
block|*(u_char *)BIOS_hardware_id = 0xfe;
comment|/* Identify as a PC/XT */
block|*(u_char *)BIOS_hardware_id = 0xff;
comment|/* Identify as a PC */
endif|#
directive|endif
operator|*
operator|(
name|u_char
operator|*
operator|)
name|BIOS_hardware_id
operator|=
literal|0xfc
expr_stmt|;
comment|/* Identify as a PC/AT */
block|}
comment|/*      * Interrupt revectors F000:0000 - F000:03ff      */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
operator|,
name|k
operator|=
literal|0
init|;
name|i
operator|<
literal|0x100
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|>=
literal|0x60
operator|&&
name|i
operator|<
literal|0x68
operator|)
operator|||
operator|(
name|i
operator|>=
literal|0x78
operator|&&
name|i
operator|<
literal|0xe2
operator|)
condition|)
continue|continue;
if|if
condition|(
operator|(
name|i
operator|>=
literal|0x00
operator|&&
name|i
operator|<
literal|0x2f
operator|)
operator|||
operator|(
name|i
operator|>=
literal|0x30
operator|&&
name|i
operator|<
literal|0xfe
operator|)
condition|)
block|{
name|ivec
index|[
name|i
index|]
operator|=
literal|0xF0300000L
operator||
operator|(
name|k
operator|*
literal|1
operator|)
expr_stmt|;
name|jtab
operator|=
operator|(
name|u_char
operator|*
operator|)
name|VECPTR
argument_list|(
name|ivec
index|[
name|i
index|]
argument_list|)
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0xf4
expr_stmt|;
comment|/* HLT */
operator|++
name|k
expr_stmt|;
block|}
else|else
block|{
name|ivec
index|[
name|i
index|]
operator|=
literal|0xF0000000L
operator||
operator|(
name|j
operator|*
literal|6
operator|)
expr_stmt|;
name|jtab
operator|=
operator|(
name|u_char
operator|*
operator|)
name|VECPTR
argument_list|(
name|ivec
index|[
name|i
index|]
argument_list|)
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0xcd
expr_stmt|;
comment|/* INT i */
operator|*
name|jtab
operator|++
operator|=
name|i
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0xca
expr_stmt|;
comment|/* RETF 2 */
operator|*
name|jtab
operator|++
operator|=
literal|2
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
operator|++
name|j
expr_stmt|;
block|}
block|}
comment|/*      * Misc variables from F000:0400 - F000:0fff      */
name|rom_config
operator|=
literal|0xF0000400
expr_stmt|;
name|jtab
operator|=
operator|(
name|u_char
operator|*
operator|)
name|VECPTR
argument_list|(
name|rom_config
argument_list|)
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|20
expr_stmt|;
comment|/* length of entry */
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
operator|*
operator|(
name|u_char
operator|*
operator|)
name|BIOS_hardware_id
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0x00
expr_stmt|;
comment|/* Sub model */
operator|*
name|jtab
operator|++
operator|=
literal|0x01
expr_stmt|;
comment|/* Bios Rev Enhanced kbd w/3.5" floppy */
operator|*
name|jtab
operator|++
operator|=
literal|0x20
expr_stmt|;
comment|/* real time clock present */
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
comment|/* Reserved */
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|jtab
operator|++
operator|=
literal|0
expr_stmt|;
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|jtab
argument_list|,
literal|"BSDI BIOS"
argument_list|)
expr_stmt|;
operator|*
name|jtab
operator|+=
literal|10
expr_stmt|;
name|InDOS
operator|=
name|jtab
operator|++
expr_stmt|;
operator|*
name|InDOS
operator|=
literal|0
expr_stmt|;
name|mouse_area
operator|=
name|jtab
expr_stmt|;
name|jtab
operator|+=
literal|0x10
expr_stmt|;
operator|*
operator|(
name|u_short
operator|*
operator|)
operator|&
name|BIOSDATA
index|[
literal|0x10
index|]
operator|=
operator|(
literal|1
operator|<<
literal|0
operator|)
operator||
comment|/* Diskette avail for boot */
operator|(
literal|1
operator|<<
literal|1
operator|)
operator||
comment|/* Math co-processor */
operator|(
name|nmice
operator|<<
literal|2
operator|)
operator||
comment|/* No pointing device */
operator|(
literal|2
operator|<<
literal|4
operator|)
operator||
comment|/* Initial video (80 x 25 C) */
operator|(
name|nfloppies
operator|-
literal|1
operator|<<
literal|6
operator|)
operator||
comment|/* Number of floppies - 1 */
operator|(
name|nserial
operator|<<
literal|9
operator|)
operator||
comment|/* Number of serial devices */
operator|(
name|nparallel
operator|<<
literal|14
operator|)
expr_stmt|;
comment|/* Number of parallel devices */
operator|*
operator|(
name|u_short
operator|*
operator|)
operator|&
name|BIOSDATA
index|[
literal|0x13
index|]
operator|=
literal|640
expr_stmt|;
comment|/* Amount of memory */
name|BIOSDATA
index|[
literal|0x75
index|]
operator|=
name|ndisks
expr_stmt|;
comment|/* number of fixed disks */
name|BIOSDATA
index|[
literal|0x8F
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|nfloppies
operator|>=
literal|1
condition|)
block|{
name|BIOSDATA
index|[
literal|0x8F
index|]
operator||=
literal|0x04
expr_stmt|;
name|BIOSDATA
index|[
literal|0x90
index|]
operator|=
literal|0x40
expr_stmt|;
block|}
if|if
condition|(
name|nfloppies
operator|>=
literal|2
condition|)
block|{
name|BIOSDATA
index|[
literal|0x8F
index|]
operator||=
literal|0x40
expr_stmt|;
name|BIOSDATA
index|[
literal|0x91
index|]
operator|=
literal|0x40
expr_stmt|;
block|}
name|gettimeofday
argument_list|(
operator|&
name|tv
argument_list|,
operator|&
name|tz
argument_list|)
expr_stmt|;
name|tv_sec
operator|=
name|tv
operator|.
name|tv_sec
expr_stmt|;
name|tm
operator|=
operator|*
name|localtime
argument_list|(
operator|&
name|tv_sec
argument_list|)
expr_stmt|;
operator|*
operator|(
name|u_long
operator|*
operator|)
operator|&
name|BIOSDATA
index|[
literal|0x6c
index|]
operator|=
operator|(
operator|(
operator|(
name|tm
operator|.
name|tm_hour
operator|*
literal|60
operator|+
name|tm
operator|.
name|tm_min
operator|)
operator|*
literal|60
operator|)
operator|+
name|tm
operator|.
name|tm_sec
operator|)
operator|*
literal|182
operator|/
literal|10
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x11
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int11
argument_list|,
literal|"int 11"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x12
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int12
argument_list|,
literal|"int 12"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x14
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int14
argument_list|,
literal|"int 14"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x15
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int15
argument_list|,
literal|"int 15"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x16
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int16
argument_list|,
literal|"int 16"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x17
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int17
argument_list|,
literal|"int 17"
argument_list|)
expr_stmt|;
name|vec
operator|=
name|insert_softint_trampoline
argument_list|()
expr_stmt|;
name|ivec
index|[
literal|0x1a
index|]
operator|=
name|vec
expr_stmt|;
name|register_callback
argument_list|(
name|vec
argument_list|,
name|int1a
argument_list|,
literal|"int 1a"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

