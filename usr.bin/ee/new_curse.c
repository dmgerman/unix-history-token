begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  |	new_curse.c  |  |	A subset of curses developed for use with ae.  |  |	written by Hugh Mahon  |  |	THIS MATERIAL IS PROVIDED "AS IS".  THERE ARE  |	NO WARRANTIES OF ANY KIND WITH REGARD TO THIS  |	MATERIAL, INCLUDING, BUT NOT LIMITED TO, THE  |	IMPLIED WARRANTIES OF MERCHANTABILITY AND  |	FITNESS FOR A PARTICULAR PURPOSE.  Neither  |	Hewlett-Packard nor Hugh Mahon shall be liable  |	for errors contained herein, nor for  |	incidental or consequential damages in  |	connection with the furnishing, performance or  |	use of this material.  Neither Hewlett-Packard  |	nor Hugh Mahon assumes any responsibility for  |	the use or reliability of this software or  |	documentation.  This software and  |	documentation is totally UNSUPPORTED.  There  |	is no support contract available.  Hewlett-  |	Packard has done NO Quality Assurance on ANY  |	of the program or documentation.  You may find  |	the quality of the materials inferior to  |	supported materials.  |  |	This software is not a product of Hewlett-Packard, Co., or any   |	other company.  No support is implied or offered with this software.  |	You've got the source, and you're on your own.  |  |	This software may be distributed under the terms of Larry Wall's   |	Artistic license, a copy of which is included in this distribution.   |  |	This notice must be included with this software and any derivatives.  |  |	Copyright (c) 1986, 1987, 1988, 1991, 1992, 1993, 1994, 1995 Hugh Mahon  |	All are rights reserved.  |  | $FreeBSD$  |  */
end_comment

begin_decl_stmt
name|char
modifier|*
name|copyright_message
index|[]
init|=
block|{
literal|"Copyright (c) 1986, 1987, 1988, 1991, 1992, 1993, 1994, 1995 Hugh Mahon"
block|,
literal|"All rights are reserved."
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|new_curse_name
init|=
literal|"@(#) new_curse.c $FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|"new_curse.h"
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|SYS5
end_ifdef

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BSD_SELECT
end_ifdef

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|SLCT_HDR
end_ifdef

begin_include
include|#
directive|include
file|<sys/select.h>
end_include

begin_comment
comment|/* on AIX */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SLCT_HDR */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BSD_SELECT */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_STDLIB
end_ifdef

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__STDC__
argument_list|)
end_if

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<varargs.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_UNISTD
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_SYS_IOCTL
end_ifdef

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|WINDOW
modifier|*
name|curscr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|WINDOW
modifier|*
name|virtual_scr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|stdscr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|last_window_refreshed
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|TIOCGWINSZ
end_ifdef

begin_decl_stmt
name|struct
name|winsize
name|ws
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|min
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(a< b ? a : b)
end_define

begin_define
define|#
directive|define
name|highbitset
parameter_list|(
name|a
parameter_list|)
value|((a)& 0x80)
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|CAP
end_ifndef

begin_define
define|#
directive|define
name|String_Out
parameter_list|(
name|table
parameter_list|,
name|stack
parameter_list|,
name|place
parameter_list|)
value|Info_Out(table, stack, place)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|String_Out
parameter_list|(
name|table
parameter_list|,
name|stack
parameter_list|,
name|place
parameter_list|)
value|Cap_Out(table, stack, place)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|bw__
value|0
end_define

begin_comment
comment|/* booleans	*/
end_comment

begin_define
define|#
directive|define
name|am__
value|1
end_define

begin_define
define|#
directive|define
name|xb__
value|2
end_define

begin_define
define|#
directive|define
name|xs__
value|3
end_define

begin_comment
comment|/* hp glitch (standout not erased by overwrite)	*/
end_comment

begin_define
define|#
directive|define
name|xn__
value|4
end_define

begin_define
define|#
directive|define
name|eo__
value|5
end_define

begin_define
define|#
directive|define
name|gn__
value|6
end_define

begin_comment
comment|/* generic type terminal	*/
end_comment

begin_define
define|#
directive|define
name|hc__
value|7
end_define

begin_comment
comment|/* hardcopy terminal		*/
end_comment

begin_define
define|#
directive|define
name|km__
value|8
end_define

begin_define
define|#
directive|define
name|hs__
value|9
end_define

begin_define
define|#
directive|define
name|in__
value|10
end_define

begin_define
define|#
directive|define
name|da__
value|11
end_define

begin_define
define|#
directive|define
name|db__
value|12
end_define

begin_define
define|#
directive|define
name|mi__
value|13
end_define

begin_comment
comment|/* safe to move during insert mode	*/
end_comment

begin_define
define|#
directive|define
name|ms__
value|14
end_define

begin_comment
comment|/* safe to move during standout mode	*/
end_comment

begin_define
define|#
directive|define
name|os__
value|15
end_define

begin_define
define|#
directive|define
name|es__
value|16
end_define

begin_define
define|#
directive|define
name|xt__
value|17
end_define

begin_define
define|#
directive|define
name|hz__
value|18
end_define

begin_comment
comment|/* hazeltine glitch	*/
end_comment

begin_define
define|#
directive|define
name|ul__
value|19
end_define

begin_define
define|#
directive|define
name|xo__
value|20
end_define

begin_define
define|#
directive|define
name|chts__
value|21
end_define

begin_define
define|#
directive|define
name|nxon__
value|22
end_define

begin_define
define|#
directive|define
name|nrrmc__
value|23
end_define

begin_define
define|#
directive|define
name|npc__
value|24
end_define

begin_define
define|#
directive|define
name|mc5i__
value|25
end_define

begin_define
define|#
directive|define
name|co__
value|0
end_define

begin_comment
comment|/* number of columns	*/
end_comment

begin_comment
comment|/* numbers		*/
end_comment

begin_define
define|#
directive|define
name|it__
value|1
end_define

begin_comment
comment|/* spaces per tab	*/
end_comment

begin_define
define|#
directive|define
name|li__
value|2
end_define

begin_comment
comment|/* number of lines	*/
end_comment

begin_define
define|#
directive|define
name|lm__
value|3
end_define

begin_define
define|#
directive|define
name|sg__
value|4
end_define

begin_comment
comment|/* magic cookie glitch	*/
end_comment

begin_define
define|#
directive|define
name|pb__
value|5
end_define

begin_define
define|#
directive|define
name|vt__
value|6
end_define

begin_define
define|#
directive|define
name|ws__
value|7
end_define

begin_define
define|#
directive|define
name|cols__
value|0
end_define

begin_define
define|#
directive|define
name|lines__
value|2
end_define

begin_define
define|#
directive|define
name|xmc__
value|4
end_define

begin_define
define|#
directive|define
name|vt__
value|6
end_define

begin_define
define|#
directive|define
name|wsl__
value|7
end_define

begin_define
define|#
directive|define
name|nlab__
value|8
end_define

begin_define
define|#
directive|define
name|lh__
value|9
end_define

begin_define
define|#
directive|define
name|lw__
value|10
end_define

begin_define
define|#
directive|define
name|bt__
value|0
end_define

begin_comment
comment|/* back tab		*/
end_comment

begin_comment
comment|/* strings	*/
end_comment

begin_define
define|#
directive|define
name|bl__
value|1
end_define

begin_comment
comment|/* bell			*/
end_comment

begin_define
define|#
directive|define
name|cr__
value|2
end_define

begin_comment
comment|/* carriage return	*/
end_comment

begin_define
define|#
directive|define
name|cs__
value|3
end_define

begin_comment
comment|/* change scroll region	*/
end_comment

begin_define
define|#
directive|define
name|ct__
value|4
end_define

begin_comment
comment|/* clear all tab stops	*/
end_comment

begin_define
define|#
directive|define
name|cl__
value|5
end_define

begin_comment
comment|/* clear screen and home cursor	*/
end_comment

begin_define
define|#
directive|define
name|ce__
value|6
end_define

begin_comment
comment|/* clear to end of line	*/
end_comment

begin_define
define|#
directive|define
name|cd__
value|7
end_define

begin_comment
comment|/* clear to end of display	*/
end_comment

begin_define
define|#
directive|define
name|ch__
value|8
end_define

begin_comment
comment|/* set cursor column	*/
end_comment

begin_define
define|#
directive|define
name|CC__
value|9
end_define

begin_comment
comment|/* term, settable cmd char in 	*/
end_comment

begin_define
define|#
directive|define
name|cm__
value|10
end_define

begin_comment
comment|/* screen rel cursor motion, row, column	*/
end_comment

begin_define
define|#
directive|define
name|do__
value|11
end_define

begin_comment
comment|/* down one line	*/
end_comment

begin_define
define|#
directive|define
name|ho__
value|12
end_define

begin_comment
comment|/* home cursor	*/
end_comment

begin_define
define|#
directive|define
name|vi__
value|13
end_define

begin_comment
comment|/* make cursor invisible	*/
end_comment

begin_define
define|#
directive|define
name|le__
value|14
end_define

begin_comment
comment|/* move cursor left one space	*/
end_comment

begin_define
define|#
directive|define
name|CM__
value|15
end_define

begin_comment
comment|/* memory rel cursor addressing	*/
end_comment

begin_define
define|#
directive|define
name|ve__
value|16
end_define

begin_comment
comment|/* make cursor appear normal	*/
end_comment

begin_define
define|#
directive|define
name|nd__
value|17
end_define

begin_comment
comment|/* non-destructive space (cursor right)	*/
end_comment

begin_define
define|#
directive|define
name|ll__
value|18
end_define

begin_comment
comment|/* last line, first col	*/
end_comment

begin_define
define|#
directive|define
name|up__
value|19
end_define

begin_comment
comment|/* cursor up		*/
end_comment

begin_define
define|#
directive|define
name|vs__
value|20
end_define

begin_define
define|#
directive|define
name|dc__
value|21
end_define

begin_comment
comment|/* delete character	*/
end_comment

begin_define
define|#
directive|define
name|dl__
value|22
end_define

begin_comment
comment|/* delete line		*/
end_comment

begin_define
define|#
directive|define
name|ds__
value|23
end_define

begin_define
define|#
directive|define
name|hd__
value|24
end_define

begin_define
define|#
directive|define
name|as__
value|25
end_define

begin_define
define|#
directive|define
name|mb__
value|26
end_define

begin_define
define|#
directive|define
name|md__
value|27
end_define

begin_comment
comment|/* turn on bold		*/
end_comment

begin_define
define|#
directive|define
name|ti__
value|28
end_define

begin_define
define|#
directive|define
name|dm__
value|29
end_define

begin_comment
comment|/* turn on delete mode	*/
end_comment

begin_define
define|#
directive|define
name|mh__
value|30
end_define

begin_comment
comment|/* half bright mode	*/
end_comment

begin_define
define|#
directive|define
name|im__
value|31
end_define

begin_comment
comment|/* insert mode		*/
end_comment

begin_define
define|#
directive|define
name|mk__
value|32
end_define

begin_define
define|#
directive|define
name|mp__
value|33
end_define

begin_define
define|#
directive|define
name|mr__
value|34
end_define

begin_define
define|#
directive|define
name|so__
value|35
end_define

begin_comment
comment|/* enter standout mode	*/
end_comment

begin_define
define|#
directive|define
name|us__
value|36
end_define

begin_define
define|#
directive|define
name|ec__
value|37
end_define

begin_define
define|#
directive|define
name|ae__
value|38
end_define

begin_define
define|#
directive|define
name|me__
value|39
end_define

begin_define
define|#
directive|define
name|te__
value|40
end_define

begin_define
define|#
directive|define
name|ed__
value|41
end_define

begin_define
define|#
directive|define
name|ei__
value|42
end_define

begin_comment
comment|/* exit insert mode	*/
end_comment

begin_define
define|#
directive|define
name|se__
value|43
end_define

begin_comment
comment|/* exit standout mode	*/
end_comment

begin_define
define|#
directive|define
name|ue__
value|44
end_define

begin_define
define|#
directive|define
name|vb__
value|45
end_define

begin_define
define|#
directive|define
name|ff__
value|46
end_define

begin_define
define|#
directive|define
name|fs__
value|47
end_define

begin_define
define|#
directive|define
name|i1__
value|48
end_define

begin_define
define|#
directive|define
name|i2__
value|49
end_define

begin_define
define|#
directive|define
name|i3__
value|50
end_define

begin_define
define|#
directive|define
name|if__
value|51
end_define

begin_define
define|#
directive|define
name|ic__
value|52
end_define

begin_define
define|#
directive|define
name|al__
value|53
end_define

begin_define
define|#
directive|define
name|ip__
value|54
end_define

begin_define
define|#
directive|define
name|kb__
value|55
end_define

begin_comment
comment|/* backspace key	*/
end_comment

begin_define
define|#
directive|define
name|ka__
value|56
end_define

begin_define
define|#
directive|define
name|kC__
value|57
end_define

begin_define
define|#
directive|define
name|kt__
value|58
end_define

begin_define
define|#
directive|define
name|kD__
value|59
end_define

begin_define
define|#
directive|define
name|kL__
value|60
end_define

begin_define
define|#
directive|define
name|kd__
value|61
end_define

begin_define
define|#
directive|define
name|kM__
value|62
end_define

begin_define
define|#
directive|define
name|kE__
value|63
end_define

begin_define
define|#
directive|define
name|kS__
value|64
end_define

begin_define
define|#
directive|define
name|k0__
value|65
end_define

begin_define
define|#
directive|define
name|k1__
value|66
end_define

begin_define
define|#
directive|define
name|kf10__
value|67
end_define

begin_define
define|#
directive|define
name|k2__
value|68
end_define

begin_define
define|#
directive|define
name|k3__
value|69
end_define

begin_define
define|#
directive|define
name|k4__
value|70
end_define

begin_define
define|#
directive|define
name|k5__
value|71
end_define

begin_define
define|#
directive|define
name|k6__
value|72
end_define

begin_define
define|#
directive|define
name|k7__
value|73
end_define

begin_define
define|#
directive|define
name|k8__
value|74
end_define

begin_define
define|#
directive|define
name|k9__
value|75
end_define

begin_define
define|#
directive|define
name|kh__
value|76
end_define

begin_define
define|#
directive|define
name|kI__
value|77
end_define

begin_define
define|#
directive|define
name|kA__
value|78
end_define

begin_define
define|#
directive|define
name|kl__
value|79
end_define

begin_define
define|#
directive|define
name|kH__
value|80
end_define

begin_define
define|#
directive|define
name|kN__
value|81
end_define

begin_define
define|#
directive|define
name|kP__
value|82
end_define

begin_define
define|#
directive|define
name|kr__
value|83
end_define

begin_define
define|#
directive|define
name|kF__
value|84
end_define

begin_define
define|#
directive|define
name|kR__
value|85
end_define

begin_define
define|#
directive|define
name|kT__
value|86
end_define

begin_define
define|#
directive|define
name|ku__
value|87
end_define

begin_comment
comment|/* key up	*/
end_comment

begin_define
define|#
directive|define
name|ke__
value|88
end_define

begin_define
define|#
directive|define
name|ks__
value|89
end_define

begin_define
define|#
directive|define
name|l0__
value|90
end_define

begin_define
define|#
directive|define
name|l1__
value|91
end_define

begin_define
define|#
directive|define
name|la__
value|92
end_define

begin_define
define|#
directive|define
name|l2__
value|93
end_define

begin_define
define|#
directive|define
name|l3__
value|94
end_define

begin_define
define|#
directive|define
name|l4__
value|95
end_define

begin_define
define|#
directive|define
name|l5__
value|96
end_define

begin_define
define|#
directive|define
name|l6__
value|97
end_define

begin_define
define|#
directive|define
name|l7__
value|98
end_define

begin_define
define|#
directive|define
name|l8__
value|99
end_define

begin_define
define|#
directive|define
name|l9__
value|100
end_define

begin_define
define|#
directive|define
name|mo__
value|101
end_define

begin_define
define|#
directive|define
name|mm__
value|102
end_define

begin_define
define|#
directive|define
name|nw__
value|103
end_define

begin_define
define|#
directive|define
name|pc__
value|104
end_define

begin_define
define|#
directive|define
name|DC__
value|105
end_define

begin_define
define|#
directive|define
name|DL__
value|106
end_define

begin_define
define|#
directive|define
name|DO__
value|107
end_define

begin_define
define|#
directive|define
name|IC__
value|118
end_define

begin_define
define|#
directive|define
name|SF__
value|109
end_define

begin_define
define|#
directive|define
name|AL__
value|110
end_define

begin_define
define|#
directive|define
name|LE__
value|111
end_define

begin_define
define|#
directive|define
name|RI__
value|112
end_define

begin_define
define|#
directive|define
name|SR__
value|113
end_define

begin_define
define|#
directive|define
name|UP__
value|114
end_define

begin_define
define|#
directive|define
name|pk__
value|115
end_define

begin_define
define|#
directive|define
name|pl__
value|116
end_define

begin_define
define|#
directive|define
name|px__
value|117
end_define

begin_define
define|#
directive|define
name|ps__
value|118
end_define

begin_define
define|#
directive|define
name|pf__
value|119
end_define

begin_define
define|#
directive|define
name|po__
value|120
end_define

begin_define
define|#
directive|define
name|rp__
value|121
end_define

begin_define
define|#
directive|define
name|r1__
value|122
end_define

begin_define
define|#
directive|define
name|r2__
value|123
end_define

begin_define
define|#
directive|define
name|r3__
value|124
end_define

begin_define
define|#
directive|define
name|rf__
value|125
end_define

begin_define
define|#
directive|define
name|rc__
value|126
end_define

begin_define
define|#
directive|define
name|cv__
value|127
end_define

begin_define
define|#
directive|define
name|sc__
value|128
end_define

begin_define
define|#
directive|define
name|sf__
value|129
end_define

begin_define
define|#
directive|define
name|sr__
value|130
end_define

begin_define
define|#
directive|define
name|sa__
value|131
end_define

begin_comment
comment|/* sgr	*/
end_comment

begin_define
define|#
directive|define
name|st__
value|132
end_define

begin_define
define|#
directive|define
name|wi__
value|133
end_define

begin_define
define|#
directive|define
name|ta__
value|134
end_define

begin_define
define|#
directive|define
name|ts__
value|135
end_define

begin_define
define|#
directive|define
name|uc__
value|136
end_define

begin_define
define|#
directive|define
name|hu__
value|137
end_define

begin_define
define|#
directive|define
name|iP__
value|138
end_define

begin_define
define|#
directive|define
name|K1__
value|139
end_define

begin_define
define|#
directive|define
name|K2__
value|140
end_define

begin_define
define|#
directive|define
name|K3__
value|141
end_define

begin_define
define|#
directive|define
name|K4__
value|142
end_define

begin_define
define|#
directive|define
name|K5__
value|143
end_define

begin_define
define|#
directive|define
name|pO__
value|144
end_define

begin_define
define|#
directive|define
name|ml__
value|145
end_define

begin_define
define|#
directive|define
name|mu__
value|146
end_define

begin_define
define|#
directive|define
name|rmp__
value|145
end_define

begin_define
define|#
directive|define
name|acsc__
value|146
end_define

begin_define
define|#
directive|define
name|pln__
value|147
end_define

begin_define
define|#
directive|define
name|kcbt__
value|148
end_define

begin_define
define|#
directive|define
name|smxon__
value|149
end_define

begin_define
define|#
directive|define
name|rmxon__
value|150
end_define

begin_define
define|#
directive|define
name|smam__
value|151
end_define

begin_define
define|#
directive|define
name|rmam__
value|152
end_define

begin_define
define|#
directive|define
name|xonc__
value|153
end_define

begin_define
define|#
directive|define
name|xoffc__
value|154
end_define

begin_define
define|#
directive|define
name|enacs__
value|155
end_define

begin_define
define|#
directive|define
name|smln__
value|156
end_define

begin_define
define|#
directive|define
name|rmln__
value|157
end_define

begin_define
define|#
directive|define
name|kbeg__
value|158
end_define

begin_define
define|#
directive|define
name|kcan__
value|159
end_define

begin_define
define|#
directive|define
name|kclo__
value|160
end_define

begin_define
define|#
directive|define
name|kcmd__
value|161
end_define

begin_define
define|#
directive|define
name|kcpy__
value|162
end_define

begin_define
define|#
directive|define
name|kcrt__
value|163
end_define

begin_define
define|#
directive|define
name|kend__
value|164
end_define

begin_define
define|#
directive|define
name|kent__
value|165
end_define

begin_define
define|#
directive|define
name|kext__
value|166
end_define

begin_define
define|#
directive|define
name|kfnd__
value|167
end_define

begin_define
define|#
directive|define
name|khlp__
value|168
end_define

begin_define
define|#
directive|define
name|kmrk__
value|169
end_define

begin_define
define|#
directive|define
name|kmsg__
value|170
end_define

begin_define
define|#
directive|define
name|kmov__
value|171
end_define

begin_define
define|#
directive|define
name|knxt__
value|172
end_define

begin_define
define|#
directive|define
name|kopn__
value|173
end_define

begin_define
define|#
directive|define
name|kopt__
value|174
end_define

begin_define
define|#
directive|define
name|kprv__
value|175
end_define

begin_define
define|#
directive|define
name|kprt__
value|176
end_define

begin_define
define|#
directive|define
name|krdo__
value|177
end_define

begin_define
define|#
directive|define
name|kref__
value|178
end_define

begin_define
define|#
directive|define
name|krfr__
value|179
end_define

begin_define
define|#
directive|define
name|krpl__
value|180
end_define

begin_define
define|#
directive|define
name|krst__
value|181
end_define

begin_define
define|#
directive|define
name|kres__
value|182
end_define

begin_define
define|#
directive|define
name|ksav__
value|183
end_define

begin_define
define|#
directive|define
name|kspd__
value|184
end_define

begin_define
define|#
directive|define
name|kund__
value|185
end_define

begin_define
define|#
directive|define
name|kBEG__
value|186
end_define

begin_define
define|#
directive|define
name|kCAN__
value|187
end_define

begin_define
define|#
directive|define
name|kCMD__
value|188
end_define

begin_define
define|#
directive|define
name|kCPY__
value|189
end_define

begin_define
define|#
directive|define
name|kCRT__
value|190
end_define

begin_define
define|#
directive|define
name|kDC__
value|191
end_define

begin_define
define|#
directive|define
name|kDL__
value|192
end_define

begin_define
define|#
directive|define
name|kslt__
value|193
end_define

begin_define
define|#
directive|define
name|kEND__
value|194
end_define

begin_define
define|#
directive|define
name|kEOL__
value|195
end_define

begin_define
define|#
directive|define
name|kEXT__
value|196
end_define

begin_define
define|#
directive|define
name|kFND__
value|197
end_define

begin_define
define|#
directive|define
name|kHLP__
value|198
end_define

begin_define
define|#
directive|define
name|kHOM__
value|199
end_define

begin_define
define|#
directive|define
name|kIC__
value|200
end_define

begin_define
define|#
directive|define
name|kLFT__
value|201
end_define

begin_define
define|#
directive|define
name|kMSG__
value|202
end_define

begin_define
define|#
directive|define
name|kMOV__
value|203
end_define

begin_define
define|#
directive|define
name|kNXT__
value|204
end_define

begin_define
define|#
directive|define
name|kOPT__
value|205
end_define

begin_define
define|#
directive|define
name|kPRV__
value|206
end_define

begin_define
define|#
directive|define
name|kPRT__
value|207
end_define

begin_define
define|#
directive|define
name|kRDO__
value|208
end_define

begin_define
define|#
directive|define
name|kRPL__
value|209
end_define

begin_define
define|#
directive|define
name|kRIT__
value|210
end_define

begin_define
define|#
directive|define
name|kRES__
value|211
end_define

begin_define
define|#
directive|define
name|kSAV__
value|212
end_define

begin_define
define|#
directive|define
name|kSPD__
value|213
end_define

begin_define
define|#
directive|define
name|kUND__
value|214
end_define

begin_define
define|#
directive|define
name|rfi__
value|215
end_define

begin_define
define|#
directive|define
name|kf11__
value|216
end_define

begin_define
define|#
directive|define
name|kf12__
value|217
end_define

begin_define
define|#
directive|define
name|kf13__
value|218
end_define

begin_define
define|#
directive|define
name|kf14__
value|219
end_define

begin_define
define|#
directive|define
name|kf15__
value|220
end_define

begin_define
define|#
directive|define
name|kf16__
value|221
end_define

begin_define
define|#
directive|define
name|kf17__
value|222
end_define

begin_define
define|#
directive|define
name|kf18__
value|223
end_define

begin_define
define|#
directive|define
name|kf19__
value|224
end_define

begin_define
define|#
directive|define
name|kf20__
value|225
end_define

begin_define
define|#
directive|define
name|kf21__
value|226
end_define

begin_define
define|#
directive|define
name|kf22__
value|227
end_define

begin_define
define|#
directive|define
name|kf23__
value|228
end_define

begin_define
define|#
directive|define
name|kf24__
value|229
end_define

begin_define
define|#
directive|define
name|kf25__
value|230
end_define

begin_define
define|#
directive|define
name|kf26__
value|231
end_define

begin_define
define|#
directive|define
name|kf27__
value|232
end_define

begin_define
define|#
directive|define
name|kf28__
value|233
end_define

begin_define
define|#
directive|define
name|kf29__
value|234
end_define

begin_define
define|#
directive|define
name|kf30__
value|235
end_define

begin_define
define|#
directive|define
name|kf31__
value|236
end_define

begin_define
define|#
directive|define
name|kf32__
value|237
end_define

begin_define
define|#
directive|define
name|kf33__
value|238
end_define

begin_define
define|#
directive|define
name|kf34__
value|239
end_define

begin_define
define|#
directive|define
name|kf35__
value|240
end_define

begin_define
define|#
directive|define
name|kf36__
value|241
end_define

begin_define
define|#
directive|define
name|kf37__
value|242
end_define

begin_define
define|#
directive|define
name|kf38__
value|243
end_define

begin_define
define|#
directive|define
name|kf39__
value|244
end_define

begin_define
define|#
directive|define
name|kf40__
value|245
end_define

begin_define
define|#
directive|define
name|kf41__
value|246
end_define

begin_define
define|#
directive|define
name|kf42__
value|247
end_define

begin_define
define|#
directive|define
name|kf43__
value|248
end_define

begin_define
define|#
directive|define
name|kf44__
value|249
end_define

begin_define
define|#
directive|define
name|kf45__
value|250
end_define

begin_define
define|#
directive|define
name|kf46__
value|251
end_define

begin_define
define|#
directive|define
name|kf47__
value|252
end_define

begin_define
define|#
directive|define
name|kf48__
value|253
end_define

begin_define
define|#
directive|define
name|kf49__
value|254
end_define

begin_define
define|#
directive|define
name|kf50__
value|255
end_define

begin_define
define|#
directive|define
name|kf51__
value|256
end_define

begin_define
define|#
directive|define
name|kf52__
value|257
end_define

begin_define
define|#
directive|define
name|kf53__
value|258
end_define

begin_define
define|#
directive|define
name|kf54__
value|259
end_define

begin_define
define|#
directive|define
name|kf55__
value|260
end_define

begin_define
define|#
directive|define
name|kf56__
value|261
end_define

begin_define
define|#
directive|define
name|kf57__
value|262
end_define

begin_define
define|#
directive|define
name|kf58__
value|263
end_define

begin_define
define|#
directive|define
name|kf59__
value|264
end_define

begin_define
define|#
directive|define
name|kf60__
value|265
end_define

begin_define
define|#
directive|define
name|kf61__
value|266
end_define

begin_define
define|#
directive|define
name|kf62__
value|267
end_define

begin_define
define|#
directive|define
name|kf63__
value|268
end_define

begin_define
define|#
directive|define
name|el1__
value|269
end_define

begin_define
define|#
directive|define
name|mgc__
value|270
end_define

begin_define
define|#
directive|define
name|smgl__
value|271
end_define

begin_define
define|#
directive|define
name|smgr__
value|272
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|CAP
end_ifdef

begin_decl_stmt
name|char
modifier|*
name|Boolean_names
index|[]
init|=
block|{
literal|"bw"
block|,
literal|"am"
block|,
literal|"xb"
block|,
literal|"xs"
block|,
literal|"xn"
block|,
literal|"eo"
block|,
literal|"gn"
block|,
literal|"hc"
block|,
literal|"km"
block|,
literal|"hs"
block|,
literal|"in"
block|,
literal|"da"
block|,
literal|"db"
block|,
literal|"mi"
block|,
literal|"ms"
block|,
literal|"os"
block|,
literal|"es"
block|,
literal|"xt"
block|,
literal|"hz"
block|,
literal|"ul"
block|,
literal|"xo"
block|,
literal|"HC"
block|,
literal|"nx"
block|,
literal|"NR"
block|,
literal|"NP"
block|,
literal|"5i"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Number_names
index|[]
init|=
block|{
literal|"co#"
block|,
literal|"it#"
block|,
literal|"li#"
block|,
literal|"lm#"
block|,
literal|"sg#"
block|,
literal|"pb#"
block|,
literal|"vt#"
block|,
literal|"ws#"
block|,
literal|"Nl#"
block|,
literal|"lh#"
block|,
literal|"lw#"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|String_names
index|[]
init|=
block|{
literal|"bt="
block|,
literal|"bl="
block|,
literal|"cr="
block|,
literal|"cs="
block|,
literal|"ct="
block|,
literal|"cl="
block|,
literal|"ce="
block|,
literal|"cd="
block|,
literal|"ch="
block|,
literal|"CC="
block|,
literal|"cm="
block|,
literal|"do="
block|,
literal|"ho="
block|,
literal|"vi="
block|,
literal|"le="
block|,
literal|"CM="
block|,
literal|"ve="
block|,
literal|"nd="
block|,
literal|"ll="
block|,
literal|"up="
block|,
literal|"vs="
block|,
literal|"dc="
block|,
literal|"dl="
block|,
literal|"ds="
block|,
literal|"hd="
block|,
literal|"as="
block|,
literal|"mb="
block|,
literal|"md="
block|,
literal|"ti="
block|,
literal|"dm="
block|,
literal|"mh="
block|,
literal|"im="
block|,
literal|"mk="
block|,
literal|"mp="
block|,
literal|"mr="
block|,
literal|"so="
block|,
literal|"us="
block|,
literal|"ec="
block|,
literal|"ae="
block|,
literal|"me="
block|,
literal|"te="
block|,
literal|"ed="
block|,
literal|"ei="
block|,
literal|"se="
block|,
literal|"ue="
block|,
literal|"vb="
block|,
literal|"ff="
block|,
literal|"fs="
block|,
literal|"i1="
block|,
literal|"i2="
block|,
literal|"i3="
block|,
literal|"if="
block|,
literal|"ic="
block|,
literal|"al="
block|,
literal|"ip="
block|,
literal|"kb="
block|,
literal|"ka="
block|,
literal|"kC="
block|,
literal|"kt="
block|,
literal|"kD="
block|,
literal|"kL="
block|,
literal|"kd="
block|,
literal|"kM="
block|,
literal|"kE="
block|,
literal|"kS="
block|,
literal|"k0="
block|,
literal|"k1="
block|,
literal|"k;="
block|,
literal|"k2="
block|,
literal|"k3="
block|,
literal|"k4="
block|,
literal|"k5="
block|,
literal|"k6="
block|,
literal|"k7="
block|,
literal|"k8="
block|,
literal|"k9="
block|,
literal|"kh="
block|,
literal|"kI="
block|,
literal|"kA="
block|,
literal|"kl="
block|,
literal|"kH="
block|,
literal|"kN="
block|,
literal|"kP="
block|,
literal|"kr="
block|,
literal|"kF="
block|,
literal|"kR="
block|,
literal|"kT="
block|,
literal|"ku="
block|,
literal|"ke="
block|,
literal|"ks="
block|,
literal|"l0="
block|,
literal|"l1="
block|,
literal|"la="
block|,
literal|"l2="
block|,
literal|"l3="
block|,
literal|"l4="
block|,
literal|"l5="
block|,
literal|"l6="
block|,
literal|"l7="
block|,
literal|"l8="
block|,
literal|"l9="
block|,
literal|"mo="
block|,
literal|"mm="
block|,
literal|"nw="
block|,
literal|"pc="
block|,
literal|"DC="
block|,
literal|"DL="
block|,
literal|"DO="
block|,
literal|"IC="
block|,
literal|"SF="
block|,
literal|"AL="
block|,
literal|"LE="
block|,
literal|"RI="
block|,
literal|"SR="
block|,
literal|"UP="
block|,
literal|"pk="
block|,
literal|"pl="
block|,
literal|"px="
block|,
literal|"ps="
block|,
literal|"pf="
block|,
literal|"po="
block|,
literal|"rp="
block|,
literal|"r1="
block|,
literal|"r2="
block|,
literal|"r3="
block|,
literal|"rf="
block|,
literal|"rc="
block|,
literal|"cv="
block|,
literal|"sc="
block|,
literal|"sf="
block|,
literal|"sr="
block|,
literal|"sa="
block|,
literal|"st="
block|,
literal|"wi="
block|,
literal|"ta="
block|,
literal|"ts="
block|,
literal|"uc="
block|,
literal|"hu="
block|,
literal|"iP="
block|,
literal|"K1="
block|,
literal|"K3="
block|,
literal|"K2="
block|,
literal|"K4="
block|,
literal|"K5="
block|,
literal|"pO="
block|,
literal|"rP="
block|,
literal|"ac="
block|,
literal|"pn="
block|,
literal|"kB="
block|,
literal|"SX="
block|,
literal|"RX="
block|,
literal|"SA="
block|,
literal|"RA="
block|,
literal|"XN="
block|,
literal|"XF="
block|,
literal|"eA="
block|,
literal|"LO="
block|,
literal|"LF="
block|,
literal|"@1="
block|,
literal|"@2="
block|,
literal|"@3="
block|,
literal|"@4="
block|,
literal|"@5="
block|,
literal|"@6="
block|,
literal|"@7="
block|,
literal|"@8="
block|,
literal|"@9="
block|,
literal|"@0="
block|,
literal|"%1="
block|,
literal|"%2="
block|,
literal|"%3="
block|,
literal|"%4="
block|,
literal|"%5="
block|,
literal|"%6="
block|,
literal|"%7="
block|,
literal|"%8="
block|,
literal|"%9="
block|,
literal|"%0="
block|,
literal|"&1="
block|,
literal|"&2="
block|,
literal|"&3="
block|,
literal|"&4="
block|,
literal|"&5="
block|,
literal|"&6="
block|,
literal|"&7="
block|,
literal|"&8="
block|,
literal|"&9="
block|,
literal|"&0="
block|,
literal|"*1="
block|,
literal|"*2="
block|,
literal|"*3="
block|,
literal|"*4="
block|,
literal|"*5="
block|,
literal|"*6="
block|,
literal|"*7="
block|,
literal|"*8="
block|,
literal|"*9="
block|,
literal|"*0="
block|,
literal|"#1="
block|,
literal|"#2="
block|,
literal|"#3="
block|,
literal|"#4="
block|,
literal|"%a="
block|,
literal|"%b="
block|,
literal|"%c="
block|,
literal|"%d="
block|,
literal|"%e="
block|,
literal|"%f="
block|,
literal|"%g="
block|,
literal|"%h="
block|,
literal|"%i="
block|,
literal|"%j="
block|,
literal|"!1="
block|,
literal|"!2="
block|,
literal|"!3="
block|,
literal|"RF="
block|,
literal|"F1="
block|,
literal|"F2="
block|,
literal|"F3="
block|,
literal|"F4="
block|,
literal|"F5="
block|,
literal|"F6="
block|,
literal|"F7="
block|,
literal|"F8="
block|,
literal|"F9="
block|,
literal|"FA="
block|,
literal|"FB="
block|,
literal|"FC="
block|,
literal|"FD="
block|,
literal|"FE="
block|,
literal|"FF="
block|,
literal|"FG="
block|,
literal|"FH="
block|,
literal|"FI="
block|,
literal|"FJ="
block|,
literal|"FK="
block|,
literal|"FL="
block|,
literal|"FM="
block|,
literal|"FN="
block|,
literal|"FO="
block|,
literal|"FP="
block|,
literal|"FQ="
block|,
literal|"FR="
block|,
literal|"FS="
block|,
literal|"FT="
block|,
literal|"FU="
block|,
literal|"FV="
block|,
literal|"FW="
block|,
literal|"FX="
block|,
literal|"FY="
block|,
literal|"FZ="
block|,
literal|"Fa="
block|,
literal|"Fb="
block|,
literal|"Fc="
block|,
literal|"Fd="
block|,
literal|"Fe="
block|,
literal|"Ff="
block|,
literal|"Fg="
block|,
literal|"Fh="
block|,
literal|"Fi="
block|,
literal|"Fj="
block|,
literal|"Fk="
block|,
literal|"Fl="
block|,
literal|"Fm="
block|,
literal|"Fn="
block|,
literal|"Fo="
block|,
literal|"Fp="
block|,
literal|"Fq="
block|,
literal|"Fr="
block|,
literal|"cb="
block|,
literal|"MC="
block|,
literal|"ML="
block|,
literal|"MR="
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|char
modifier|*
name|new_curse
init|=
literal|"October 1987"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|in_buff
index|[
literal|100
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* buffer for ungetch			*/
end_comment

begin_decl_stmt
name|int
name|bufp
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* next free position in in_buff	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|TERMINAL_TYPE
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* terminal type to be gotten from environment	*/
end_comment

begin_decl_stmt
name|int
name|CFOUND
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Data_Line_len
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Max_Key_len
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* max length of a sequence sent by a key	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|Data_Line
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|TERM_PATH
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|TERM_data_ptr
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Term_File_name
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* name of file containing terminal description	*/
end_comment

begin_decl_stmt
name|FILE
modifier|*
name|TFP
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file pointer to file with terminal des.	*/
end_comment

begin_decl_stmt
name|int
name|Fildes
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file descriptor for terminfo file		*/
end_comment

begin_decl_stmt
name|int
name|STAND
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* is standout mode activated?			*/
end_comment

begin_decl_stmt
name|int
name|TERM_INFO
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* is terminfo being used (TRUE), or termcap (FALSE) */
end_comment

begin_decl_stmt
name|int
name|Time_Out
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* set when time elapsed while trying to read function key */
end_comment

begin_decl_stmt
name|int
name|Curr_x
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current x position on screen			*/
end_comment

begin_decl_stmt
name|int
name|Curr_y
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current y position on the screen		*/
end_comment

begin_decl_stmt
name|int
name|LINES
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|COLS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Move_It
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag to move cursor if magic cookie glitch	*/
end_comment

begin_decl_stmt
name|int
name|initialized
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* tells whether new_curse is initialized	*/
end_comment

begin_decl_stmt
name|float
name|speed
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|chars_per_millisecond
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Repaint_screen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* if an operation to change screen impossible, repaint screen	*/
end_comment

begin_decl_stmt
name|int
name|Intr
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* storeage for interrupt character		*/
end_comment

begin_decl_stmt
name|int
name|Parity
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0 = no parity, 1 = odd parity, 2 = even parity */
end_comment

begin_decl_stmt
name|int
name|Noblock
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* for BSD systems				*/
end_comment

begin_decl_stmt
name|int
name|Num_bits
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* number of bits per character	*/
end_comment

begin_decl_stmt
name|int
name|Flip_Bytes
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* some systems have byte order reversed	*/
end_comment

begin_decl_stmt
name|int
name|interrupt_flag
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* set true if SIGWINCH received	*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|CAP
end_ifndef

begin_decl_stmt
name|char
modifier|*
name|Strings
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_struct
struct|struct
name|KEYS
block|{
name|int
name|length
decl_stmt|;
comment|/* length of string sent by key			*/
name|char
modifier|*
name|string
decl_stmt|;
comment|/* string sent by key				*/
name|int
name|value
decl_stmt|;
comment|/* CURSES value of key (9-bit)			*/
block|}
struct|;
end_struct

begin_struct
struct|struct
name|KEY_STACK
block|{
name|struct
name|KEYS
modifier|*
name|element
decl_stmt|;
name|struct
name|KEY_STACK
modifier|*
name|next
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|KEY_STACK
modifier|*
name|KEY_TOS
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|KEY_STACK
modifier|*
name|KEY_POINT
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  |  |	Not all systems have good terminal information, so we will define   |	keyboard information here for the most widely used terminal type,   |	the VT100.  |  */
end_comment

begin_decl_stmt
name|struct
name|KEYS
name|vt100
index|[]
init|=
block|{
block|{
literal|3
block|,
literal|"\033[A"
block|,
literal|0403
block|}
block|,
comment|/* key up 	*/
block|{
literal|3
block|,
literal|"\033[C"
block|,
literal|0405
block|}
block|,
comment|/* key right	*/
block|{
literal|3
block|,
literal|"\033[D"
block|,
literal|0404
block|}
block|,
comment|/* key left	*/
block|{
literal|4
block|,
literal|"\033[6~"
block|,
literal|0522
block|}
block|,
comment|/* key next page	*/
block|{
literal|4
block|,
literal|"\033[5~"
block|,
literal|0523
block|}
block|,
comment|/* key prev page	*/
block|{
literal|3
block|,
literal|"\033[["
block|,
literal|0550
block|}
block|,
comment|/* key end	*/
block|{
literal|3
block|,
literal|"\033[@"
block|,
literal|0406
block|}
block|,
comment|/* key home	*/
block|{
literal|4
block|,
literal|"\033[2~"
block|,
literal|0513
block|}
block|,
comment|/* key insert char	*/
block|{
literal|3
block|,
literal|"\033[y"
block|,
literal|0410
block|}
block|,
comment|/* key F0	*/
block|{
literal|3
block|,
literal|"\033[P"
block|,
literal|0411
block|}
block|,
comment|/* key F1	*/
block|{
literal|3
block|,
literal|"\033[Q"
block|,
literal|0412
block|}
block|,
comment|/* key F2	*/
block|{
literal|3
block|,
literal|"\033[R"
block|,
literal|0413
block|}
block|,
comment|/* key F3	*/
block|{
literal|3
block|,
literal|"\033[S"
block|,
literal|0414
block|}
block|,
comment|/* key F4	*/
block|{
literal|3
block|,
literal|"\033[t"
block|,
literal|0415
block|}
block|,
comment|/* key F5	*/
block|{
literal|3
block|,
literal|"\033[u"
block|,
literal|0416
block|}
block|,
comment|/* key F6	*/
block|{
literal|3
block|,
literal|"\033[v"
block|,
literal|0417
block|}
block|,
comment|/* key F7	*/
block|{
literal|3
block|,
literal|"\033[l"
block|,
literal|0420
block|}
block|,
comment|/* key F8	*/
block|{
literal|3
block|,
literal|"\033[w"
block|,
literal|0421
block|}
block|,
comment|/* key F9	*/
block|{
literal|3
block|,
literal|"\033[x"
block|,
literal|0422
block|}
block|,
comment|/* key F10	*/
block|{
literal|5
block|,
literal|"\033[10~"
block|,
literal|0410
block|}
block|,
comment|/* key F0	*/
block|{
literal|5
block|,
literal|"\033[11~"
block|,
literal|0411
block|}
block|,
comment|/* key F1	*/
block|{
literal|5
block|,
literal|"\033[12~"
block|,
literal|0412
block|}
block|,
comment|/* key F2	*/
block|{
literal|5
block|,
literal|"\033[13~"
block|,
literal|0413
block|}
block|,
comment|/* key F3	*/
block|{
literal|5
block|,
literal|"\033[14~"
block|,
literal|0414
block|}
block|,
comment|/* key F4	*/
block|{
literal|5
block|,
literal|"\033[15~"
block|,
literal|0415
block|}
block|,
comment|/* key F5	*/
block|{
literal|5
block|,
literal|"\033[17~"
block|,
literal|0416
block|}
block|,
comment|/* key F6	*/
block|{
literal|5
block|,
literal|"\033[18~"
block|,
literal|0417
block|}
block|,
comment|/* key F7	*/
block|{
literal|5
block|,
literal|"\033[19~"
block|,
literal|0420
block|}
block|,
comment|/* key F8	*/
block|{
literal|5
block|,
literal|"\033[20~"
block|,
literal|0421
block|}
block|,
comment|/* key F9	*/
block|{
literal|5
block|,
literal|"\033[21~"
block|,
literal|0422
block|}
block|,
comment|/* key F10	*/
block|{
literal|5
block|,
literal|"\033[23~"
block|,
literal|0423
block|}
block|,
comment|/* key F11	*/
block|{
literal|5
block|,
literal|"\033[24~"
block|,
literal|0424
block|}
block|,
comment|/* key F12	*/
block|{
literal|3
block|,
literal|"\033[q"
block|,
literal|0534
block|}
block|,
comment|/* ka1 upper-left of keypad	*/
block|{
literal|3
block|,
literal|"\033[s"
block|,
literal|0535
block|}
block|,
comment|/* ka3 upper-right of keypad	*/
block|{
literal|3
block|,
literal|"\033[r"
block|,
literal|0536
block|}
block|,
comment|/* kb2 center of keypad	*/
block|{
literal|3
block|,
literal|"\033[p"
block|,
literal|0537
block|}
block|,
comment|/* kc1 lower-left of keypad	*/
block|{
literal|3
block|,
literal|"\033[n"
block|,
literal|0540
block|}
block|,
comment|/* kc3 lower-right of keypad	*/
comment|/* 		 |	The following are the same keys as above, but with  		 |	a different character following the escape char. 		 */
block|{
literal|3
block|,
literal|"\033OA"
block|,
literal|0403
block|}
block|,
comment|/* key up 	*/
block|{
literal|3
block|,
literal|"\033OC"
block|,
literal|0405
block|}
block|,
comment|/* key right	*/
block|{
literal|3
block|,
literal|"\033OD"
block|,
literal|0404
block|}
block|,
comment|/* key left	*/
block|{
literal|3
block|,
literal|"\033OB"
block|,
literal|0402
block|}
block|,
comment|/* key down	*/
block|{
literal|4
block|,
literal|"\033O6~"
block|,
literal|0522
block|}
block|,
comment|/* key next page	*/
block|{
literal|4
block|,
literal|"\033O5~"
block|,
literal|0523
block|}
block|,
comment|/* key prev page	*/
block|{
literal|3
block|,
literal|"\033O["
block|,
literal|0550
block|}
block|,
comment|/* key end	*/
block|{
literal|3
block|,
literal|"\033O@"
block|,
literal|0406
block|}
block|,
comment|/* key home	*/
block|{
literal|4
block|,
literal|"\033O2~"
block|,
literal|0513
block|}
block|,
comment|/* key insert char	*/
block|{
literal|3
block|,
literal|"\033Oy"
block|,
literal|0410
block|}
block|,
comment|/* key F0	*/
block|{
literal|3
block|,
literal|"\033OP"
block|,
literal|0411
block|}
block|,
comment|/* key F1	*/
block|{
literal|3
block|,
literal|"\033OQ"
block|,
literal|0412
block|}
block|,
comment|/* key F2	*/
block|{
literal|3
block|,
literal|"\033OR"
block|,
literal|0413
block|}
block|,
comment|/* key F3	*/
block|{
literal|3
block|,
literal|"\033OS"
block|,
literal|0414
block|}
block|,
comment|/* key F4	*/
block|{
literal|3
block|,
literal|"\033Ot"
block|,
literal|0415
block|}
block|,
comment|/* key F5	*/
block|{
literal|3
block|,
literal|"\033Ou"
block|,
literal|0416
block|}
block|,
comment|/* key F6	*/
block|{
literal|3
block|,
literal|"\033Ov"
block|,
literal|0417
block|}
block|,
comment|/* key F7	*/
block|{
literal|3
block|,
literal|"\033Ol"
block|,
literal|0420
block|}
block|,
comment|/* key F8	*/
block|{
literal|3
block|,
literal|"\033Ow"
block|,
literal|0421
block|}
block|,
comment|/* key F9	*/
block|{
literal|3
block|,
literal|"\033Ox"
block|,
literal|0422
block|}
block|,
comment|/* key F10	*/
block|{
literal|5
block|,
literal|"\033O10~"
block|,
literal|0410
block|}
block|,
comment|/* key F0	*/
block|{
literal|5
block|,
literal|"\033O11~"
block|,
literal|0411
block|}
block|,
comment|/* key F1	*/
block|{
literal|5
block|,
literal|"\033O12~"
block|,
literal|0412
block|}
block|,
comment|/* key F2	*/
block|{
literal|5
block|,
literal|"\033O13~"
block|,
literal|0413
block|}
block|,
comment|/* key F3	*/
block|{
literal|5
block|,
literal|"\033O14~"
block|,
literal|0414
block|}
block|,
comment|/* key F4	*/
block|{
literal|5
block|,
literal|"\033O15~"
block|,
literal|0415
block|}
block|,
comment|/* key F5	*/
block|{
literal|5
block|,
literal|"\033O17~"
block|,
literal|0416
block|}
block|,
comment|/* key F6	*/
block|{
literal|5
block|,
literal|"\033O18~"
block|,
literal|0417
block|}
block|,
comment|/* key F7	*/
block|{
literal|5
block|,
literal|"\033O19~"
block|,
literal|0420
block|}
block|,
comment|/* key F8	*/
block|{
literal|5
block|,
literal|"\033O20~"
block|,
literal|0421
block|}
block|,
comment|/* key F9	*/
block|{
literal|5
block|,
literal|"\033O21~"
block|,
literal|0422
block|}
block|,
comment|/* key F10	*/
block|{
literal|5
block|,
literal|"\033O23~"
block|,
literal|0423
block|}
block|,
comment|/* key F11	*/
block|{
literal|5
block|,
literal|"\033O24~"
block|,
literal|0424
block|}
block|,
comment|/* key F12	*/
block|{
literal|3
block|,
literal|"\033Oq"
block|,
literal|0534
block|}
block|,
comment|/* ka1 upper-left of keypad	*/
block|{
literal|3
block|,
literal|"\033Os"
block|,
literal|0535
block|}
block|,
comment|/* ka3 upper-right of keypad	*/
block|{
literal|3
block|,
literal|"\033Or"
block|,
literal|0536
block|}
block|,
comment|/* kb2 center of keypad	*/
block|{
literal|3
block|,
literal|"\033Op"
block|,
literal|0537
block|}
block|,
comment|/* kc1 lower-left of keypad	*/
block|{
literal|3
block|,
literal|"\033On"
block|,
literal|0540
block|}
block|,
comment|/* kc3 lower-right of keypad	*/
block|{
literal|0
block|,
literal|""
block|,
literal|0
block|}
comment|/* end	*/
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|Parameters
block|{
name|int
name|value
decl_stmt|;
name|struct
name|Parameters
modifier|*
name|next
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|int
name|Key_vals
index|[]
init|=
block|{
literal|0407
block|,
literal|0526
block|,
literal|0515
block|,
literal|0525
block|,
literal|0512
block|,
literal|0510
block|,
literal|0402
block|,
literal|0514
block|,
literal|0517
block|,
literal|0516
block|,
literal|0410
block|,
literal|0411
block|,
literal|0422
block|,
literal|0412
block|,
literal|0413
block|,
literal|0414
block|,
literal|0415
block|,
literal|0416
block|,
literal|0417
block|,
literal|0420
block|,
literal|0421
block|,
literal|0406
block|,
literal|0513
block|,
literal|0511
block|,
literal|0404
block|,
literal|0533
block|,
literal|0522
block|,
literal|0523
block|,
literal|0405
block|,
literal|0520
block|,
literal|0521
block|,
literal|0524
block|,
literal|0403
block|,
literal|0534
block|,
literal|0535
block|,
literal|0536
block|,
literal|0537
block|,
literal|0540
block|,
literal|0541
block|,
literal|0542
block|,
literal|0543
block|,
literal|0544
block|,
literal|0545
block|,
literal|0546
block|,
literal|0547
block|,
literal|0550
block|,
literal|0527
block|,
literal|0551
block|,
literal|0552
block|,
literal|0553
block|,
literal|0554
block|,
literal|0555
block|,
literal|0556
block|,
literal|0557
block|,
literal|0560
block|,
literal|0561
block|,
literal|0562
block|,
literal|0532
block|,
literal|0563
block|,
literal|0564
block|,
literal|0565
block|,
literal|0566
block|,
literal|0567
block|,
literal|0570
block|,
literal|0571
block|,
literal|0627
block|,
literal|0630
block|,
literal|0572
block|,
literal|0573
block|,
literal|0574
block|,
literal|0575
block|,
literal|0576
block|,
literal|0577
block|,
literal|0600
block|,
literal|0601
block|,
literal|0602
block|,
literal|0603
block|,
literal|0604
block|,
literal|0605
block|,
literal|0606
block|,
literal|0607
block|,
literal|0610
block|,
literal|0611
block|,
literal|0612
block|,
literal|0613
block|,
literal|0614
block|,
literal|0615
block|,
literal|0616
block|,
literal|0617
block|,
literal|0620
block|,
literal|0621
block|,
literal|0622
block|,
literal|0623
block|,
literal|0624
block|,
literal|0625
block|,
literal|0626
block|,
literal|0423
block|,
literal|0424
block|,
literal|0425
block|,
literal|0426
block|,
literal|0427
block|,
literal|0430
block|,
literal|0431
block|,
literal|0432
block|,
literal|0433
block|,
literal|0434
block|,
literal|0435
block|,
literal|0436
block|,
literal|0437
block|,
literal|0440
block|,
literal|0441
block|,
literal|0442
block|,
literal|0443
block|,
literal|0444
block|,
literal|0445
block|,
literal|0446
block|,
literal|0447
block|,
literal|0450
block|,
literal|0451
block|,
literal|0452
block|,
literal|0453
block|,
literal|0454
block|,
literal|0455
block|,
literal|0456
block|,
literal|0457
block|,
literal|0460
block|,
literal|0461
block|,
literal|0462
block|,
literal|0463
block|,
literal|0464
block|,
literal|0465
block|,
literal|0466
block|,
literal|0467
block|,
literal|0470
block|,
literal|0471
block|,
literal|0472
block|,
literal|0473
block|,
literal|0474
block|,
literal|0475
block|,
literal|0476
block|,
literal|0477
block|,
literal|0500
block|,
literal|0501
block|,
literal|0502
block|,
literal|0503
block|,
literal|0504
block|,
literal|0505
block|,
literal|0506
block|,
literal|0507
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|attributes_set
index|[
literal|9
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|nc_attributes
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* global attributes for new_curse to observe */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SYS5
end_ifdef

begin_decl_stmt
name|struct
name|termio
name|Terminal
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|termio
name|Saved_tty
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
name|struct
name|sgttyb
name|Terminal
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|sgttyb
name|Saved_tty
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|char
modifier|*
name|tc_
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Booleans
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Numbers
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|String_table
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|virtual_lines
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|nc_scrolling_ability
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|CAP
end_ifdef

begin_if
if|#
directive|if
name|__STDC__
operator|||
name|defined
argument_list|(
name|__cplusplus
argument_list|)
end_if

begin_define
define|#
directive|define
name|P_
parameter_list|(
name|s
parameter_list|)
value|s
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|P_
parameter_list|(
name|s
parameter_list|)
value|()
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __STDC__ */
end_comment

begin_decl_stmt
name|int
name|tc_Get_int
name|P_
argument_list|(
operator|(
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|CAP_PARSE
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|Find_term
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|P_
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CAP */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__STDC__
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|HAS_STDLIB
end_ifndef

begin_function_decl
specifier|extern
name|char
modifier|*
name|fgets
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|getenv
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|FILE
modifier|*
name|fopen
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* declaration for open function	*/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAS_STDLIB */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __STDC__ */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SIGWINCH
end_ifdef

begin_comment
comment|/*  |	Copy the contents of one window to another.  */
end_comment

begin_function
name|void
name|copy_window
parameter_list|(
name|origin
parameter_list|,
name|destination
parameter_list|)
name|WINDOW
modifier|*
name|origin
decl_stmt|,
decl|*
name|destination
decl_stmt|;
end_function

begin_block
block|{
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
name|struct
name|_line
modifier|*
name|orig
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|orig
operator|=
name|origin
operator|->
name|first_line
expr_stmt|;
name|dest
operator|=
name|destination
operator|->
name|first_line
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
init|;
name|row
operator|<
operator|(
name|min
argument_list|(
name|origin
operator|->
name|Num_lines
argument_list|,
name|destination
operator|->
name|Num_lines
argument_list|)
operator|)
condition|;
name|row
operator|++
control|)
block|{
for|for
control|(
name|column
operator|=
literal|0
init|;
name|column
operator|<
operator|(
name|min
argument_list|(
name|origin
operator|->
name|Num_cols
argument_list|,
name|destination
operator|->
name|Num_cols
argument_list|)
operator|)
condition|;
name|column
operator|++
control|)
block|{
name|dest
operator|->
name|row
index|[
name|column
index|]
operator|=
name|orig
operator|->
name|row
index|[
name|column
index|]
expr_stmt|;
name|dest
operator|->
name|attributes
index|[
name|column
index|]
operator|=
name|orig
operator|->
name|attributes
index|[
name|column
index|]
expr_stmt|;
block|}
name|dest
operator|->
name|changed
operator|=
name|orig
operator|->
name|changed
expr_stmt|;
name|dest
operator|->
name|scroll
operator|=
name|orig
operator|->
name|scroll
expr_stmt|;
name|dest
operator|->
name|last_char
operator|=
name|min
argument_list|(
name|orig
operator|->
name|last_char
argument_list|,
name|destination
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
name|orig
operator|=
name|orig
operator|->
name|next_screen
expr_stmt|;
name|dest
operator|=
name|dest
operator|->
name|next_screen
expr_stmt|;
block|}
name|destination
operator|->
name|LX
operator|=
name|min
argument_list|(
operator|(
name|destination
operator|->
name|Num_cols
operator|-
literal|1
operator|)
argument_list|,
name|origin
operator|->
name|LX
argument_list|)
expr_stmt|;
name|destination
operator|->
name|LY
operator|=
name|min
argument_list|(
operator|(
name|destination
operator|->
name|Num_lines
operator|-
literal|1
operator|)
argument_list|,
name|origin
operator|->
name|LY
argument_list|)
expr_stmt|;
name|destination
operator|->
name|Attrib
operator|=
name|origin
operator|->
name|Attrib
expr_stmt|;
name|destination
operator|->
name|scroll_up
operator|=
name|origin
operator|->
name|scroll_up
expr_stmt|;
name|destination
operator|->
name|scroll_down
operator|=
name|origin
operator|->
name|scroll_down
expr_stmt|;
name|destination
operator|->
name|SCROLL_CLEAR
operator|=
name|origin
operator|->
name|SCROLL_CLEAR
expr_stmt|;
block|}
end_block

begin_function
name|void
name|reinitscr
parameter_list|(
name|foo
parameter_list|)
name|int
name|foo
decl_stmt|;
block|{
name|WINDOW
modifier|*
name|local_virt
decl_stmt|;
name|WINDOW
modifier|*
name|local_std
decl_stmt|;
name|WINDOW
modifier|*
name|local_cur
decl_stmt|;
name|signal
argument_list|(
name|SIGWINCH
argument_list|,
name|reinitscr
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|TIOCGWINSZ
if|if
condition|(
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGWINSZ
argument_list|,
operator|&
name|ws
argument_list|)
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|ws
operator|.
name|ws_row
operator|==
name|LINES
operator|&&
name|ws
operator|.
name|ws_col
operator|==
name|COLS
condition|)
return|return;
if|if
condition|(
name|ws
operator|.
name|ws_row
operator|>
literal|0
condition|)
name|LINES
operator|=
name|ws
operator|.
name|ws_row
expr_stmt|;
if|if
condition|(
name|ws
operator|.
name|ws_col
operator|>
literal|0
condition|)
name|COLS
operator|=
name|ws
operator|.
name|ws_col
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* TIOCGWINSZ */
name|local_virt
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|local_std
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|local_cur
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|copy_window
argument_list|(
name|virtual_scr
argument_list|,
name|local_virt
argument_list|)
expr_stmt|;
name|copy_window
argument_list|(
name|stdscr
argument_list|,
name|local_std
argument_list|)
expr_stmt|;
name|copy_window
argument_list|(
name|curscr
argument_list|,
name|local_cur
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|virtual_scr
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|curscr
argument_list|)
expr_stmt|;
name|virtual_scr
operator|=
name|local_virt
expr_stmt|;
name|stdscr
operator|=
name|local_std
expr_stmt|;
name|curscr
operator|=
name|local_cur
expr_stmt|;
name|free
argument_list|(
name|virtual_lines
argument_list|)
expr_stmt|;
name|virtual_lines
operator|=
operator|(
name|int
operator|*
operator|)
name|malloc
argument_list|(
name|LINES
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|interrupt_flag
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SIGWINCH */
end_comment

begin_function
name|void
name|initscr
parameter_list|()
comment|/* initialize terminal for operations	*/
block|{
name|int
name|value
decl_stmt|;
name|char
modifier|*
name|lines_string
decl_stmt|;
name|char
modifier|*
name|columns_string
decl_stmt|;
ifdef|#
directive|ifdef
name|CAP
name|char
modifier|*
name|pointer
decl_stmt|;
endif|#
directive|endif
comment|/* CAP */
ifdef|#
directive|ifdef
name|DIAG
name|printf
argument_list|(
literal|"starting initscr \n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|initialized
condition|)
return|return;
ifdef|#
directive|ifdef
name|BSD_SELECT
name|setbuf
argument_list|(
name|stdin
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* BSD_SELECT */
name|Flip_Bytes
operator|=
name|FALSE
expr_stmt|;
name|Parity
operator|=
literal|0
expr_stmt|;
name|Time_Out
operator|=
name|FALSE
expr_stmt|;
name|bufp
operator|=
literal|0
expr_stmt|;
name|Move_It
operator|=
name|FALSE
expr_stmt|;
name|Noblock
operator|=
name|FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCGETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
if|if
condition|(
name|Terminal
operator|.
name|c_cflag
operator|&
name|PARENB
condition|)
block|{
if|if
condition|(
name|Terminal
operator|.
name|c_cflag
operator|&
name|PARENB
condition|)
name|Parity
operator|=
literal|1
expr_stmt|;
else|else
name|Parity
operator|=
literal|2
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|Terminal
operator|.
name|c_cflag
operator|&
name|CS8
operator|)
operator|==
name|CS8
condition|)
block|{
name|Num_bits
operator|=
literal|8
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|Terminal
operator|.
name|c_cflag
operator|&
name|CS7
operator|)
operator|==
name|CS7
condition|)
name|Num_bits
operator|=
literal|7
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|Terminal
operator|.
name|c_cflag
operator|&
name|CS6
operator|)
operator|==
name|CS6
condition|)
name|Num_bits
operator|=
literal|6
expr_stmt|;
else|else
name|Num_bits
operator|=
literal|5
expr_stmt|;
name|value
operator|=
name|Terminal
operator|.
name|c_cflag
operator|&
literal|037
expr_stmt|;
switch|switch
condition|(
name|value
condition|)
block|{
case|case
literal|01
case|:
name|speed
operator|=
literal|50.0
expr_stmt|;
break|break;
case|case
literal|02
case|:
name|speed
operator|=
literal|75.0
expr_stmt|;
break|break;
case|case
literal|03
case|:
name|speed
operator|=
literal|110.0
expr_stmt|;
break|break;
case|case
literal|04
case|:
name|speed
operator|=
literal|134.5
expr_stmt|;
break|break;
case|case
literal|05
case|:
name|speed
operator|=
literal|150.0
expr_stmt|;
break|break;
case|case
literal|06
case|:
name|speed
operator|=
literal|200.0
expr_stmt|;
break|break;
case|case
literal|07
case|:
name|speed
operator|=
literal|300.0
expr_stmt|;
break|break;
case|case
literal|010
case|:
name|speed
operator|=
literal|600.0
expr_stmt|;
break|break;
case|case
literal|011
case|:
name|speed
operator|=
literal|900.0
expr_stmt|;
break|break;
case|case
literal|012
case|:
name|speed
operator|=
literal|1200.0
expr_stmt|;
break|break;
case|case
literal|013
case|:
name|speed
operator|=
literal|1800.0
expr_stmt|;
break|break;
case|case
literal|014
case|:
name|speed
operator|=
literal|2400.0
expr_stmt|;
break|break;
case|case
literal|015
case|:
name|speed
operator|=
literal|3600.0
expr_stmt|;
break|break;
case|case
literal|016
case|:
name|speed
operator|=
literal|4800.0
expr_stmt|;
break|break;
case|case
literal|017
case|:
name|speed
operator|=
literal|7200.0
expr_stmt|;
break|break;
case|case
literal|020
case|:
name|speed
operator|=
literal|9600.0
expr_stmt|;
break|break;
case|case
literal|021
case|:
name|speed
operator|=
literal|19200.0
expr_stmt|;
break|break;
case|case
literal|022
case|:
name|speed
operator|=
literal|38400.0
expr_stmt|;
break|break;
default|default:
name|speed
operator|=
literal|0.0
expr_stmt|;
block|}
else|#
directive|else
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
if|if
condition|(
name|Terminal
operator|.
name|sg_flags
operator|&
name|EVENP
condition|)
name|Parity
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|Terminal
operator|.
name|sg_flags
operator|&
name|ODDP
condition|)
name|Parity
operator|=
literal|1
expr_stmt|;
name|value
operator|=
name|Terminal
operator|.
name|sg_ospeed
expr_stmt|;
switch|switch
condition|(
name|value
condition|)
block|{
case|case
literal|01
case|:
name|speed
operator|=
literal|50.0
expr_stmt|;
break|break;
case|case
literal|02
case|:
name|speed
operator|=
literal|75.0
expr_stmt|;
break|break;
case|case
literal|03
case|:
name|speed
operator|=
literal|110.0
expr_stmt|;
break|break;
case|case
literal|04
case|:
name|speed
operator|=
literal|134.5
expr_stmt|;
break|break;
case|case
literal|05
case|:
name|speed
operator|=
literal|150.0
expr_stmt|;
break|break;
case|case
literal|06
case|:
name|speed
operator|=
literal|200.0
expr_stmt|;
break|break;
case|case
literal|07
case|:
name|speed
operator|=
literal|300.0
expr_stmt|;
break|break;
case|case
literal|010
case|:
name|speed
operator|=
literal|600.0
expr_stmt|;
break|break;
case|case
literal|011
case|:
name|speed
operator|=
literal|1200.0
expr_stmt|;
break|break;
case|case
literal|012
case|:
name|speed
operator|=
literal|1800.0
expr_stmt|;
break|break;
case|case
literal|013
case|:
name|speed
operator|=
literal|2400.0
expr_stmt|;
break|break;
case|case
literal|014
case|:
name|speed
operator|=
literal|4800.0
expr_stmt|;
break|break;
case|case
literal|015
case|:
name|speed
operator|=
literal|9600.0
expr_stmt|;
break|break;
default|default:
name|speed
operator|=
literal|0.0
expr_stmt|;
block|}
endif|#
directive|endif
name|chars_per_millisecond
operator|=
operator|(
literal|0.001
operator|*
name|speed
operator|)
operator|/
literal|8.0
expr_stmt|;
name|TERMINAL_TYPE
operator|=
name|getenv
argument_list|(
literal|"TERM"
argument_list|)
expr_stmt|;
if|if
condition|(
name|TERMINAL_TYPE
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"unknown terminal type\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|CAP
name|Fildes
operator|=
operator|-
literal|1
expr_stmt|;
name|TERM_PATH
operator|=
name|getenv
argument_list|(
literal|"TERMINFO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|TERM_PATH
operator|!=
name|NULL
condition|)
block|{
name|Data_Line_len
operator|=
literal|23
operator|+
name|strlen
argument_list|(
name|TERM_PATH
argument_list|)
operator|+
name|strlen
argument_list|(
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Term_File_name
operator|=
name|malloc
argument_list|(
name|Data_Line_len
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|Term_File_name
argument_list|,
literal|"%s/%c/%s"
argument_list|,
name|TERM_PATH
argument_list|,
operator|*
name|TERMINAL_TYPE
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Fildes
operator|=
name|open
argument_list|(
name|Term_File_name
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Fildes
operator|==
operator|-
literal|1
condition|)
block|{
name|TERM_PATH
operator|=
literal|"/usr/lib/terminfo"
expr_stmt|;
name|Data_Line_len
operator|=
literal|23
operator|+
name|strlen
argument_list|(
name|TERM_PATH
argument_list|)
operator|+
name|strlen
argument_list|(
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Term_File_name
operator|=
name|malloc
argument_list|(
name|Data_Line_len
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|Term_File_name
argument_list|,
literal|"%s/%c/%s"
argument_list|,
name|TERM_PATH
argument_list|,
operator|*
name|TERMINAL_TYPE
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Fildes
operator|=
name|open
argument_list|(
name|Term_File_name
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Fildes
operator|==
operator|-
literal|1
condition|)
block|{
name|TERM_PATH
operator|=
literal|"/usr/share/lib/terminfo"
expr_stmt|;
name|Data_Line_len
operator|=
literal|23
operator|+
name|strlen
argument_list|(
name|TERM_PATH
argument_list|)
operator|+
name|strlen
argument_list|(
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Term_File_name
operator|=
name|malloc
argument_list|(
name|Data_Line_len
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|Term_File_name
argument_list|,
literal|"%s/%c/%s"
argument_list|,
name|TERM_PATH
argument_list|,
operator|*
name|TERMINAL_TYPE
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Fildes
operator|=
name|open
argument_list|(
name|Term_File_name
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Fildes
operator|==
operator|-
literal|1
condition|)
block|{
name|TERM_PATH
operator|=
literal|"/usr/share/terminfo"
expr_stmt|;
name|Data_Line_len
operator|=
literal|23
operator|+
name|strlen
argument_list|(
name|TERM_PATH
argument_list|)
operator|+
name|strlen
argument_list|(
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Term_File_name
operator|=
name|malloc
argument_list|(
name|Data_Line_len
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|Term_File_name
argument_list|,
literal|"%s/%c/%s"
argument_list|,
name|TERM_PATH
argument_list|,
operator|*
name|TERMINAL_TYPE
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|Fildes
operator|=
name|open
argument_list|(
name|Term_File_name
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Fildes
operator|==
operator|-
literal|1
condition|)
block|{
name|free
argument_list|(
name|Term_File_name
argument_list|)
expr_stmt|;
name|Term_File_name
operator|=
name|NULL
expr_stmt|;
block|}
else|else
name|TERM_INFO
operator|=
name|INFO_PARSE
argument_list|()
expr_stmt|;
else|#
directive|else
comment|/* 	 |	termcap information can be in the TERMCAP env variable, if so  	 |	use that, otherwise check the /etc/termcap file 	 */
if|if
condition|(
operator|(
name|pointer
operator|=
name|Term_File_name
operator|=
name|getenv
argument_list|(
literal|"TERMCAP"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|Term_File_name
operator|!=
literal|'/'
condition|)
name|Term_File_name
operator|=
literal|"/etc/termcap"
expr_stmt|;
block|}
else|else
block|{
name|Term_File_name
operator|=
literal|"/etc/termcap"
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|TFP
operator|=
name|fopen
argument_list|(
name|Term_File_name
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"unable to open /etc/termcap file \n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|value
operator|=
literal|0
init|;
name|value
operator|<
literal|1024
condition|;
name|value
operator|++
control|)
name|String_table
index|[
name|value
index|]
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
init|;
name|value
operator|<
literal|128
condition|;
name|value
operator|++
control|)
name|Booleans
index|[
name|value
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
init|;
name|value
operator|<
literal|128
condition|;
name|value
operator|++
control|)
name|Numbers
index|[
name|value
index|]
operator|=
literal|0
expr_stmt|;
name|Data_Line
operator|=
name|malloc
argument_list|(
literal|512
argument_list|)
expr_stmt|;
if|if
condition|(
name|pointer
operator|&&
operator|*
name|pointer
operator|!=
literal|'/'
condition|)
block|{
name|TERM_data_ptr
operator|=
name|pointer
expr_stmt|;
name|CAP_PARSE
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|Find_term
argument_list|()
expr_stmt|;
name|CAP_PARSE
argument_list|()
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|String_table
index|[
name|pc__
index|]
operator|==
name|NULL
condition|)
name|String_table
index|[
name|pc__
index|]
operator|=
literal|"\0"
expr_stmt|;
if|if
condition|(
operator|(
name|String_table
index|[
name|cm__
index|]
operator|==
name|NULL
operator|)
operator|||
operator|(
name|Booleans
index|[
name|hc__
index|]
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"sorry, unable to use this terminal type for screen editing\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|Key_Get
argument_list|()
expr_stmt|;
name|keys_vt100
argument_list|()
expr_stmt|;
name|LINES
operator|=
name|Numbers
index|[
name|li__
index|]
expr_stmt|;
name|COLS
operator|=
name|Numbers
index|[
name|co__
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|lines_string
operator|=
name|getenv
argument_list|(
literal|"LINES"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|value
operator|=
name|atoi
argument_list|(
name|lines_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|>
literal|0
condition|)
name|LINES
operator|=
name|value
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|columns_string
operator|=
name|getenv
argument_list|(
literal|"COLUMNS"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|value
operator|=
name|atoi
argument_list|(
name|columns_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|>
literal|0
condition|)
name|COLS
operator|=
name|value
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|TIOCGWINSZ
comment|/* 	 |	get the window size 	 */
if|if
condition|(
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGWINSZ
argument_list|,
operator|&
name|ws
argument_list|)
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|ws
operator|.
name|ws_row
operator|>
literal|0
condition|)
name|LINES
operator|=
name|ws
operator|.
name|ws_row
expr_stmt|;
if|if
condition|(
name|ws
operator|.
name|ws_col
operator|>
literal|0
condition|)
name|COLS
operator|=
name|ws
operator|.
name|ws_col
expr_stmt|;
block|}
endif|#
directive|endif
name|virtual_scr
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|stdscr
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|curscr
operator|=
name|newwin
argument_list|(
name|LINES
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|stdscr
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
name|Repaint_screen
operator|=
name|TRUE
expr_stmt|;
name|initialized
operator|=
name|TRUE
expr_stmt|;
name|virtual_lines
operator|=
operator|(
name|int
operator|*
operator|)
name|malloc
argument_list|(
name|LINES
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|int
argument_list|)
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SIGWINCH
comment|/* 	 |	reset size of windows and LINES and COLS if term window  	 |	changes size 	 */
name|signal
argument_list|(
name|SIGWINCH
argument_list|,
name|reinitscr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* SIGWINCH */
comment|/* 	 |	check if scrolling is available 	 */
name|nc_scrolling_ability
operator|=
operator|(
operator|(
name|String_table
index|[
name|al__
index|]
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|String_table
index|[
name|dl__
index|]
operator|)
operator|)
operator|||
operator|(
operator|(
name|String_table
index|[
name|cs__
index|]
operator|)
operator|&&
operator|(
name|String_table
index|[
name|sr__
index|]
operator|)
operator|)
expr_stmt|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|CAP
end_ifndef

begin_function
name|int
name|Get_int
parameter_list|()
comment|/* get a two-byte integer from the terminfo file */
block|{
name|int
name|High_byte
decl_stmt|;
name|int
name|Low_byte
decl_stmt|;
name|int
name|temp
decl_stmt|;
name|Low_byte
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|TERM_data_ptr
operator|++
operator|)
expr_stmt|;
name|High_byte
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|TERM_data_ptr
operator|++
operator|)
expr_stmt|;
if|if
condition|(
name|Flip_Bytes
condition|)
block|{
name|temp
operator|=
name|Low_byte
expr_stmt|;
name|Low_byte
operator|=
name|High_byte
expr_stmt|;
name|High_byte
operator|=
name|temp
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|High_byte
operator|==
literal|255
operator|)
operator|&&
operator|(
name|Low_byte
operator|==
literal|255
operator|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
else|else
return|return
operator|(
name|Low_byte
operator|+
operator|(
name|High_byte
operator|*
literal|256
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|INFO_PARSE
parameter_list|()
comment|/* parse off the data in the terminfo data file	*/
block|{
name|int
name|offset
decl_stmt|;
name|int
name|magic_number
init|=
literal|0
decl_stmt|;
name|int
name|counter
init|=
literal|0
decl_stmt|;
name|int
name|Num_names
init|=
literal|0
decl_stmt|;
name|int
name|Num_bools
init|=
literal|0
decl_stmt|;
name|int
name|Num_ints
init|=
literal|0
decl_stmt|;
name|int
name|Num_strings
init|=
literal|0
decl_stmt|;
name|int
name|string_table_len
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|temp_ptr
decl_stmt|;
name|TERM_data_ptr
operator|=
name|Data_Line
operator|=
name|malloc
argument_list|(
operator|(
literal|10240
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|char
argument_list|)
operator|)
operator|)
argument_list|)
expr_stmt|;
name|Data_Line_len
operator|=
name|read
argument_list|(
name|Fildes
argument_list|,
name|Data_Line
argument_list|,
literal|10240
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|Data_Line_len
operator|>=
literal|10240
operator|)
operator|||
operator|(
name|Data_Line_len
operator|<
literal|0
operator|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* 	 |	get magic number 	 */
name|magic_number
operator|=
name|Get_int
argument_list|()
expr_stmt|;
comment|/* 	 |	if magic number not right, reverse byte order and check again 	 */
if|if
condition|(
name|magic_number
operator|!=
literal|282
condition|)
block|{
name|Flip_Bytes
operator|=
name|TRUE
expr_stmt|;
name|TERM_data_ptr
operator|--
expr_stmt|;
name|TERM_data_ptr
operator|--
expr_stmt|;
name|magic_number
operator|=
name|Get_int
argument_list|()
expr_stmt|;
if|if
condition|(
name|magic_number
operator|!=
literal|282
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* 	 |	get the number of each type in the terminfo data file 	 */
name|Num_names
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|Num_bools
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|Num_ints
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|Num_strings
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|string_table_len
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|Strings
operator|=
name|malloc
argument_list|(
name|string_table_len
argument_list|)
expr_stmt|;
while|while
condition|(
name|Num_names
operator|>
literal|0
condition|)
block|{
name|TERM_data_ptr
operator|++
expr_stmt|;
name|Num_names
operator|--
expr_stmt|;
block|}
name|counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|Num_bools
condition|)
block|{
name|Num_bools
operator|--
expr_stmt|;
name|Booleans
index|[
name|counter
operator|++
index|]
operator|=
operator|*
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|(
name|unsigned
name|int
operator|)
name|TERM_data_ptr
operator|)
operator|&
literal|1
condition|)
comment|/* force alignment	*/
name|TERM_data_ptr
operator|++
expr_stmt|;
name|counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|Num_ints
condition|)
block|{
name|Num_ints
operator|--
expr_stmt|;
name|Numbers
index|[
name|counter
index|]
operator|=
name|Get_int
argument_list|()
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
name|temp_ptr
operator|=
name|TERM_data_ptr
operator|+
name|Num_strings
operator|+
name|Num_strings
expr_stmt|;
name|memcpy
argument_list|(
name|Strings
argument_list|,
name|temp_ptr
argument_list|,
name|string_table_len
argument_list|)
expr_stmt|;
name|counter
operator|=
name|bt__
expr_stmt|;
while|while
condition|(
name|Num_strings
condition|)
block|{
name|Num_strings
operator|--
expr_stmt|;
if|if
condition|(
operator|(
name|offset
operator|=
name|Get_int
argument_list|()
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|String_table
index|[
name|counter
index|]
operator|==
name|NULL
condition|)
name|String_table
index|[
name|counter
index|]
operator|=
name|Strings
operator|+
name|offset
expr_stmt|;
block|}
else|else
name|String_table
index|[
name|counter
index|]
operator|=
name|NULL
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
name|close
argument_list|(
name|Fildes
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|Data_Line
argument_list|)
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ifndef CAP	*/
end_comment

begin_function
name|int
name|AtoI
parameter_list|()
comment|/* convert ascii text to integers	*/
block|{
name|int
name|Temp
decl_stmt|;
name|Temp
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|Temp
operator|=
operator|(
name|Temp
operator|*
literal|10
operator|)
operator|+
operator|(
operator|*
name|TERM_data_ptr
operator|-
literal|'0'
operator|)
expr_stmt|;
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|Temp
operator|)
return|;
block|}
end_function

begin_function
name|void
name|Key_Get
parameter_list|()
comment|/* create linked list with all key sequences obtained from terminal database	*/
block|{
name|int
name|Counter
decl_stmt|;
name|int
name|Klen
decl_stmt|;
name|int
name|key_def
decl_stmt|;
name|struct
name|KEY_STACK
modifier|*
name|Spoint
decl_stmt|;
name|Max_Key_len
operator|=
literal|0
expr_stmt|;
name|Counter
operator|=
literal|0
expr_stmt|;
name|key_def
operator|=
name|kb__
expr_stmt|;
while|while
condition|(
name|key_def
operator|<=
name|kf63__
condition|)
block|{
if|if
condition|(
name|key_def
operator|==
name|ke__
condition|)
name|key_def
operator|=
name|K1__
expr_stmt|;
elseif|else
if|if
condition|(
name|key_def
operator|==
operator|(
name|K5__
operator|+
literal|1
operator|)
condition|)
name|key_def
operator|=
name|kcbt__
expr_stmt|;
elseif|else
if|if
condition|(
name|key_def
operator|==
operator|(
name|kcbt__
operator|+
literal|1
operator|)
condition|)
name|key_def
operator|=
name|kbeg__
expr_stmt|;
elseif|else
if|if
condition|(
name|key_def
operator|==
operator|(
name|kUND__
operator|+
literal|1
operator|)
condition|)
name|key_def
operator|=
name|kf11__
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|key_def
index|]
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|KEY_TOS
operator|==
name|NULL
condition|)
name|Spoint
operator|=
name|KEY_TOS
operator|=
operator|(
expr|struct
name|KEY_STACK
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEY_STACK
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|Spoint
operator|=
name|KEY_TOS
expr_stmt|;
while|while
condition|(
name|Spoint
operator|->
name|next
operator|!=
name|NULL
condition|)
name|Spoint
operator|=
name|Spoint
operator|->
name|next
expr_stmt|;
name|Spoint
operator|->
name|next
operator|=
operator|(
expr|struct
name|KEY_STACK
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEY_STACK
argument_list|)
argument_list|)
expr_stmt|;
name|Spoint
operator|=
name|Spoint
operator|->
name|next
expr_stmt|;
block|}
name|Spoint
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|Spoint
operator|->
name|element
operator|=
operator|(
expr|struct
name|KEYS
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEYS
argument_list|)
argument_list|)
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|string
operator|=
name|String_table
index|[
name|key_def
index|]
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|length
operator|=
name|strlen
argument_list|(
name|String_table
index|[
name|key_def
index|]
argument_list|)
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|value
operator|=
name|Key_vals
index|[
name|Counter
index|]
expr_stmt|;
name|Klen
operator|=
name|strlen
argument_list|(
name|Spoint
operator|->
name|element
operator|->
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|Klen
operator|>
name|Max_Key_len
condition|)
name|Max_Key_len
operator|=
name|Klen
expr_stmt|;
comment|/* 			 |  Some terminal types accept keystrokes of the form 			 |  \E[A and \EOA, substituting '[' for 'O'.  Make a  			 |  duplicate of such key strings (since the  			 |  database will only have one version) so new_curse  			 |  can understand both. 			 */
if|if
condition|(
operator|(
name|Spoint
operator|->
name|element
operator|->
name|length
operator|>
literal|1
operator|)
operator|&&
operator|(
operator|(
name|String_table
index|[
name|key_def
index|]
index|[
literal|1
index|]
operator|==
literal|'['
operator|)
operator|||
operator|(
name|String_table
index|[
name|key_def
index|]
index|[
literal|1
index|]
operator|==
literal|'O'
operator|)
operator|)
condition|)
block|{
name|Spoint
operator|->
name|next
operator|=
operator|(
expr|struct
name|KEY_STACK
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEY_STACK
argument_list|)
argument_list|)
expr_stmt|;
name|Spoint
operator|=
name|Spoint
operator|->
name|next
expr_stmt|;
name|Spoint
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|Spoint
operator|->
name|element
operator|=
operator|(
expr|struct
name|KEYS
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEYS
argument_list|)
argument_list|)
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|length
operator|=
name|strlen
argument_list|(
name|String_table
index|[
name|key_def
index|]
argument_list|)
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|string
operator|=
name|malloc
argument_list|(
name|Spoint
operator|->
name|element
operator|->
name|length
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|Spoint
operator|->
name|element
operator|->
name|string
argument_list|,
name|String_table
index|[
name|key_def
index|]
argument_list|)
expr_stmt|;
name|Spoint
operator|->
name|element
operator|->
name|value
operator|=
name|Key_vals
index|[
name|Counter
index|]
expr_stmt|;
name|Klen
operator|=
name|strlen
argument_list|(
name|Spoint
operator|->
name|element
operator|->
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|Klen
operator|>
name|Max_Key_len
condition|)
name|Max_Key_len
operator|=
name|Klen
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|key_def
index|]
index|[
literal|1
index|]
operator|==
literal|'['
condition|)
name|Spoint
operator|->
name|element
operator|->
name|string
index|[
literal|1
index|]
operator|=
literal|'O'
expr_stmt|;
else|else
name|Spoint
operator|->
name|element
operator|->
name|string
index|[
literal|1
index|]
operator|=
literal|'['
expr_stmt|;
block|}
block|}
name|key_def
operator|++
expr_stmt|;
name|Counter
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  |	insert information about keys for a vt100 terminal  */
end_comment

begin_function
name|void
name|keys_vt100
parameter_list|()
block|{
name|int
name|counter
decl_stmt|;
name|int
name|Klen
decl_stmt|;
name|struct
name|KEY_STACK
modifier|*
name|Spoint
decl_stmt|;
name|Spoint
operator|=
name|KEY_TOS
expr_stmt|;
while|while
condition|(
name|Spoint
operator|->
name|next
operator|!=
name|NULL
condition|)
name|Spoint
operator|=
name|Spoint
operator|->
name|next
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|vt100
index|[
name|counter
index|]
operator|.
name|length
operator|!=
literal|0
condition|;
name|counter
operator|++
control|)
block|{
name|Spoint
operator|->
name|next
operator|=
operator|(
expr|struct
name|KEY_STACK
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|KEY_STACK
argument_list|)
argument_list|)
expr_stmt|;
name|Spoint
operator|=
name|Spoint
operator|->
name|next
expr_stmt|;
name|Spoint
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|Spoint
operator|->
name|element
operator|=
operator|&
name|vt100
index|[
name|counter
index|]
expr_stmt|;
name|Klen
operator|=
name|strlen
argument_list|(
name|Spoint
operator|->
name|element
operator|->
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|Klen
operator|>
name|Max_Key_len
condition|)
name|Max_Key_len
operator|=
name|Klen
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CAP
end_ifdef

begin_function
name|char
modifier|*
name|String_Get
parameter_list|(
name|param
parameter_list|)
comment|/* read the string */
name|char
modifier|*
name|param
decl_stmt|;
block|{
name|char
modifier|*
name|String
decl_stmt|;
name|char
modifier|*
name|Temp
decl_stmt|;
name|int
name|Counter
decl_stmt|;
if|if
condition|(
name|param
operator|==
name|NULL
condition|)
block|{
while|while
condition|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'='
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
name|Temp
operator|=
operator|++
name|TERM_data_ptr
expr_stmt|;
name|Counter
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|Temp
operator|!=
literal|':'
operator|)
operator|&&
operator|(
operator|*
name|Temp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|Counter
operator|++
expr_stmt|;
name|Temp
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|Counter
operator|==
literal|1
condition|)
comment|/* no data */
return|return
operator|(
name|NULL
operator|)
return|;
name|String
operator|=
name|Temp
operator|=
name|malloc
argument_list|(
name|Counter
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|':'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'\\'
condition|)
block|{
name|TERM_data_ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'n'
condition|)
operator|*
name|Temp
operator|=
literal|'\n'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'t'
condition|)
operator|*
name|Temp
operator|=
literal|'\t'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'b'
condition|)
operator|*
name|Temp
operator|=
literal|'\b'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'r'
condition|)
operator|*
name|Temp
operator|=
literal|'\r'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'f'
condition|)
operator|*
name|Temp
operator|=
literal|'\f'
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|==
literal|'e'
operator|)
operator|||
operator|(
operator|*
name|TERM_data_ptr
operator|==
literal|'E'
operator|)
condition|)
operator|*
name|Temp
operator|=
literal|'\033'
expr_stmt|;
comment|/* escape */
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'\\'
condition|)
operator|*
name|Temp
operator|=
literal|'\\'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'\''
condition|)
operator|*
name|Temp
operator|=
literal|'\''
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|Counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|Counter
operator|=
operator|(
literal|8
operator|*
name|Counter
operator|)
operator|+
operator|(
operator|*
name|TERM_data_ptr
operator|-
literal|'0'
operator|)
expr_stmt|;
name|TERM_data_ptr
operator|++
expr_stmt|;
comment|/* ? */
block|}
operator|*
name|Temp
operator|=
name|Counter
expr_stmt|;
name|TERM_data_ptr
operator|--
expr_stmt|;
block|}
name|TERM_data_ptr
operator|++
expr_stmt|;
name|Temp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'^'
condition|)
block|{
name|TERM_data_ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|>=
literal|'@'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|<=
literal|'_'
operator|)
condition|)
operator|*
name|Temp
operator|=
operator|*
name|TERM_data_ptr
operator|-
literal|'@'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'?'
condition|)
operator|*
name|Temp
operator|=
literal|127
expr_stmt|;
name|TERM_data_ptr
operator|++
expr_stmt|;
name|Temp
operator|++
expr_stmt|;
block|}
else|else
operator|*
name|Temp
operator|++
operator|=
operator|*
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
operator|*
name|Temp
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|param
operator|=
name|String
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|':'
operator|)
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|param
operator|)
return|;
block|}
end_function

begin_function
name|int
name|tc_Get_int
parameter_list|(
name|param
parameter_list|)
comment|/* read the integer			*/
name|int
name|param
decl_stmt|;
block|{
name|int
name|Itemp
decl_stmt|;
if|if
condition|(
name|param
operator|==
literal|0
condition|)
block|{
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'#'
operator|)
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
name|TERM_data_ptr
operator|++
expr_stmt|;
name|Itemp
operator|=
name|AtoI
argument_list|()
expr_stmt|;
name|param
operator|=
name|Itemp
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|*
name|TERM_data_ptr
operator|!=
literal|':'
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|param
operator|)
return|;
block|}
end_function

begin_function
name|void
name|Find_term
parameter_list|()
comment|/* find terminal description in termcap file	*/
block|{
name|char
modifier|*
name|Name
decl_stmt|;
name|char
modifier|*
name|Ftemp
decl_stmt|;
name|Ftemp
operator|=
name|Name
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|TERMINAL_TYPE
operator|+
literal|1
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|Name
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|Ftemp
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
name|Ftemp
operator|++
expr_stmt|;
operator|*
name|Ftemp
operator|++
operator|=
literal|'|'
expr_stmt|;
operator|*
name|Ftemp
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|CFOUND
operator|=
name|FALSE
expr_stmt|;
name|Data_Line_len
operator|=
name|strlen
argument_list|(
name|TERMINAL_TYPE
argument_list|)
operator|+
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|!
name|CFOUND
operator|)
operator|&&
operator|(
operator|(
name|TERM_data_ptr
operator|=
name|fgets
argument_list|(
name|Data_Line
argument_list|,
literal|512
argument_list|,
name|TFP
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'\t'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'#'
operator|)
condition|)
block|{
while|while
condition|(
operator|(
operator|!
name|CFOUND
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|CFOUND
operator|=
operator|!
name|strncmp
argument_list|(
name|TERM_data_ptr
argument_list|,
name|Name
argument_list|,
name|Data_Line_len
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'|'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|'#'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|':'
operator|)
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|'|'
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|CFOUND
condition|)
operator|*
name|TERM_data_ptr
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|CFOUND
condition|)
block|{
name|printf
argument_list|(
literal|"terminal type %s not found\n"
argument_list|,
name|TERMINAL_TYPE
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|CAP_PARSE
parameter_list|()
comment|/* parse off the data in the termcap data file	*/
block|{
name|int
name|offset
decl_stmt|;
name|int
name|found
decl_stmt|;
do|do
block|{
while|while
condition|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
for|for
control|(
name|found
operator|=
name|FALSE
operator|,
name|offset
operator|=
literal|0
init|;
operator|(
operator|!
name|found
operator|)
operator|&&
operator|(
name|offset
operator|<
literal|26
operator|)
condition|;
name|offset
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|TERM_data_ptr
argument_list|,
name|Boolean_names
index|[
name|offset
index|]
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|Booleans
index|[
name|offset
index|]
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
block|{
for|for
control|(
name|found
operator|=
name|FALSE
operator|,
name|offset
operator|=
literal|0
init|;
operator|(
operator|!
name|found
operator|)
operator|&&
operator|(
name|offset
operator|<
name|lw__
operator|)
condition|;
name|offset
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|TERM_data_ptr
argument_list|,
name|Number_names
index|[
name|offset
index|]
argument_list|,
literal|3
argument_list|)
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|Numbers
index|[
name|offset
index|]
operator|=
name|tc_Get_int
argument_list|(
name|Numbers
index|[
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
block|{
for|for
control|(
name|found
operator|=
name|FALSE
operator|,
name|offset
operator|=
literal|0
init|;
operator|(
operator|!
name|found
operator|)
operator|&&
operator|(
name|offset
operator|<
name|smgr__
operator|)
condition|;
name|offset
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|TERM_data_ptr
argument_list|,
name|String_names
index|[
name|offset
index|]
argument_list|,
literal|3
argument_list|)
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|String_table
index|[
name|offset
index|]
operator|=
name|String_Get
argument_list|(
name|String_table
index|[
name|offset
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|TERM_data_ptr
argument_list|,
literal|"tc="
argument_list|,
literal|3
argument_list|)
condition|)
name|tc_
operator|=
name|String_Get
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|TERM_data_ptr
operator|!=
literal|':'
operator|)
operator|&&
operator|(
operator|*
name|TERM_data_ptr
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|TERM_data_ptr
operator|==
literal|':'
condition|)
name|TERM_data_ptr
operator|++
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|(
operator|(
name|TERM_data_ptr
operator|=
name|fgets
argument_list|(
name|Data_Line
argument_list|,
literal|512
argument_list|,
name|TFP
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|*
name|TERM_data_ptr
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|TERM_data_ptr
operator|==
literal|'\t'
operator|)
operator|)
condition|)
do|;
if|if
condition|(
name|tc_
operator|!=
name|NULL
condition|)
block|{
name|TERMINAL_TYPE
operator|=
name|tc_
expr_stmt|;
name|rewind
argument_list|(
name|TFP
argument_list|)
expr_stmt|;
name|Find_term
argument_list|()
expr_stmt|;
name|free
argument_list|(
name|tc_
argument_list|)
expr_stmt|;
name|tc_
operator|=
name|NULL
expr_stmt|;
name|CAP_PARSE
argument_list|()
expr_stmt|;
block|}
else|else
name|fclose
argument_list|(
name|TFP
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ifdef CAP	*/
end_comment

begin_function
name|struct
name|_line
modifier|*
name|Screenalloc
parameter_list|(
name|columns
parameter_list|)
name|int
name|columns
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
operator|(
expr|struct
name|_line
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|_line
argument_list|)
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|row
operator|=
name|malloc
argument_list|(
name|columns
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|attributes
operator|=
name|malloc
argument_list|(
name|columns
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmp
operator|->
name|prev_screen
operator|=
name|NULL
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|columns
condition|;
name|i
operator|++
control|)
block|{
name|tmp
operator|->
name|row
index|[
name|i
index|]
operator|=
literal|' '
expr_stmt|;
name|tmp
operator|->
name|attributes
index|[
name|i
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
block|}
name|tmp
operator|->
name|scroll
operator|=
name|tmp
operator|->
name|changed
operator|=
name|FALSE
expr_stmt|;
name|tmp
operator|->
name|row
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp
operator|->
name|attributes
index|[
literal|0
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp
operator|->
name|row
index|[
name|columns
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp
operator|->
name|attributes
index|[
name|columns
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp
operator|->
name|last_char
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|tmp
operator|)
return|;
block|}
end_function

begin_function
name|WINDOW
modifier|*
name|newwin
parameter_list|(
name|lines
parameter_list|,
name|cols
parameter_list|,
name|start_l
parameter_list|,
name|start_c
parameter_list|)
name|int
name|lines
decl_stmt|,
name|cols
decl_stmt|;
comment|/* number of lines and columns to be in window	*/
name|int
name|start_l
decl_stmt|,
name|start_c
decl_stmt|;
comment|/* starting line and column to be inwindow	*/
block|{
name|WINDOW
modifier|*
name|Ntemp
decl_stmt|;
name|struct
name|_line
modifier|*
name|temp_screen
decl_stmt|;
name|int
name|i
decl_stmt|;
name|Ntemp
operator|=
operator|(
name|WINDOW
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|WINDOW
argument_list|)
argument_list|)
expr_stmt|;
name|Ntemp
operator|->
name|SR
operator|=
name|start_l
expr_stmt|;
name|Ntemp
operator|->
name|SC
operator|=
name|start_c
expr_stmt|;
name|Ntemp
operator|->
name|Num_lines
operator|=
name|lines
expr_stmt|;
name|Ntemp
operator|->
name|Num_cols
operator|=
name|cols
expr_stmt|;
name|Ntemp
operator|->
name|LX
operator|=
literal|0
expr_stmt|;
name|Ntemp
operator|->
name|LY
operator|=
literal|0
expr_stmt|;
name|Ntemp
operator|->
name|scroll_down
operator|=
name|Ntemp
operator|->
name|scroll_up
operator|=
literal|0
expr_stmt|;
name|Ntemp
operator|->
name|SCROLL_CLEAR
operator|=
name|FALSE
expr_stmt|;
name|Ntemp
operator|->
name|Attrib
operator|=
name|FALSE
expr_stmt|;
name|Ntemp
operator|->
name|first_line
operator|=
name|temp_screen
operator|=
name|Screenalloc
argument_list|(
name|cols
argument_list|)
expr_stmt|;
name|Ntemp
operator|->
name|first_line
operator|->
name|number
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|lines
condition|;
name|i
operator|++
control|)
block|{
name|temp_screen
operator|->
name|next_screen
operator|=
name|Screenalloc
argument_list|(
name|cols
argument_list|)
expr_stmt|;
name|temp_screen
operator|->
name|next_screen
operator|->
name|number
operator|=
name|i
expr_stmt|;
name|temp_screen
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|temp_screen
expr_stmt|;
name|temp_screen
operator|=
name|temp_screen
operator|->
name|next_screen
expr_stmt|;
block|}
name|Ntemp
operator|->
name|first_line
operator|->
name|prev_screen
operator|=
name|NULL
expr_stmt|;
name|temp_screen
operator|->
name|next_screen
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|Ntemp
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CAP
end_ifdef

begin_function
name|void
name|Cap_Out
parameter_list|(
name|string
parameter_list|,
name|p_list
parameter_list|,
name|place
parameter_list|)
comment|/* interpret the output string if necessary */
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|p_list
index|[]
decl_stmt|;
comment|/* stack of values	*/
name|int
name|place
decl_stmt|;
comment|/* place keeper of top of stack	*/
block|{
name|char
modifier|*
name|Otemp
decl_stmt|;
comment|/* temporary string pointer to parse output */
name|int
name|delay
decl_stmt|;
name|int
name|p1
decl_stmt|,
name|p2
decl_stmt|,
name|temp
decl_stmt|;
name|float
name|chars
decl_stmt|;
if|if
condition|(
name|string
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|p_list
operator|!=
name|NULL
condition|)
block|{
name|p1
operator|=
name|p_list
index|[
operator|--
name|place
index|]
expr_stmt|;
name|p2
operator|=
name|p_list
index|[
operator|--
name|place
index|]
expr_stmt|;
block|}
name|delay
operator|=
literal|0
expr_stmt|;
name|Otemp
operator|=
name|string
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|Otemp
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|Otemp
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|delay
operator|=
name|atoi
argument_list|(
name|Otemp
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|Otemp
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|Otemp
operator|<=
literal|'9'
operator|)
condition|)
name|Otemp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'*'
condition|)
name|Otemp
operator|++
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'%'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|Otemp
operator|==
literal|'d'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'2'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'3'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'.'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'+'
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'d'
condition|)
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|p1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'2'
condition|)
name|printf
argument_list|(
literal|"%02d"
argument_list|,
name|p1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'3'
condition|)
name|printf
argument_list|(
literal|"%03d"
argument_list|,
name|p1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'+'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|p1
operator|+=
operator|*
name|Otemp
expr_stmt|;
name|putchar
argument_list|(
name|p1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'.'
condition|)
name|putchar
argument_list|(
name|p1
argument_list|)
expr_stmt|;
name|p1
operator|=
name|p2
expr_stmt|;
name|p2
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'>'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
if|if
condition|(
name|p1
operator|>
operator|*
name|Otemp
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|p1
operator|+=
operator|*
name|Otemp
expr_stmt|;
block|}
else|else
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'r'
condition|)
block|{
name|temp
operator|=
name|p1
expr_stmt|;
name|p1
operator|=
name|p2
expr_stmt|;
name|p2
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'i'
condition|)
block|{
name|p1
operator|++
expr_stmt|;
name|p2
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'%'
condition|)
name|putchar
argument_list|(
operator|*
name|Otemp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'n'
condition|)
block|{
name|p1
operator|^=
literal|0140
expr_stmt|;
name|p2
operator|^=
literal|0140
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'B'
condition|)
block|{
name|p1
operator|=
operator|(
literal|16
operator|*
operator|(
name|p1
operator|/
literal|10
operator|)
operator|)
operator|+
operator|(
name|p1
operator|%
literal|10
operator|)
expr_stmt|;
name|p2
operator|=
operator|(
literal|16
operator|*
operator|(
name|p2
operator|/
literal|10
operator|)
operator|)
operator|+
operator|(
name|p2
operator|%
literal|10
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'D'
condition|)
block|{
name|p1
operator|=
operator|(
name|p1
operator|-
literal|2
operator|*
operator|(
name|p1
operator|%
literal|16
operator|)
operator|)
expr_stmt|;
name|p2
operator|=
operator|(
name|p2
operator|-
literal|2
operator|*
operator|(
name|p2
operator|%
literal|16
operator|)
operator|)
expr_stmt|;
block|}
block|}
else|else
name|putchar
argument_list|(
operator|*
name|Otemp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|delay
operator|!=
literal|0
condition|)
block|{
name|chars
operator|=
name|delay
operator|*
name|chars_per_millisecond
expr_stmt|;
name|delay
operator|=
name|chars
expr_stmt|;
if|if
condition|(
operator|(
name|chars
operator|-
name|delay
operator|)
operator|>
literal|0.0
condition|)
name|delay
operator|++
expr_stmt|;
for|for
control|(
init|;
name|delay
operator|>
literal|0
condition|;
name|delay
operator|--
control|)
name|putchar
argument_list|(
operator|*
name|String_table
index|[
name|pc__
index|]
argument_list|)
expr_stmt|;
block|}
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_decl_stmt
name|char
modifier|*
name|Otemp
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary string pointer to parse output */
end_comment

begin_decl_stmt
name|float
name|chars
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|p
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|variable
index|[
literal|27
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|Operation
parameter_list|(
name|Temp_Stack
parameter_list|,
name|place
parameter_list|)
comment|/* handle conditional operations	*/
name|int
name|Temp_Stack
index|[]
decl_stmt|;
name|int
name|place
decl_stmt|;
block|{
name|int
name|temp
decl_stmt|;
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'d'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%d"
argument_list|,
name|temp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"2d"
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%2d"
argument_list|,
name|temp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"3d"
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%0d"
argument_list|,
name|temp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"02d"
argument_list|,
literal|3
argument_list|)
condition|)
block|{
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%02d"
argument_list|,
name|temp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"03d"
argument_list|,
literal|3
argument_list|)
condition|)
block|{
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%03d"
argument_list|,
name|temp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'+'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|+=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'-'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|-=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'*'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|*=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'/'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|/=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'m'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|%=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'&'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|&=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'|'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator||=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'^'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|^=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'='
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|=
operator|(
name|temp
operator|==
name|Temp_Stack
index|[
operator|--
name|place
index|]
operator|)
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'>'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|=
name|temp
operator|>
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'<'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|temp
operator|=
name|temp
operator|<
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'c'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|putchar
argument_list|(
name|Temp_Stack
index|[
operator|--
name|place
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'i'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|++
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'%'
condition|)
block|{
name|putchar
argument_list|(
operator|*
name|Otemp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'!'
condition|)
block|{
name|temp
operator|=
operator|!
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'~'
condition|)
block|{
name|temp
operator|=
operator|~
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'p'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|p
index|[
operator|*
name|Otemp
operator|-
literal|'0'
index|]
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'P'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|variable
index|[
operator|*
name|Otemp
operator|-
literal|'a'
index|]
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'g'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|variable
index|[
operator|*
name|Otemp
operator|-
literal|'a'
index|]
operator|=
name|Temp_Stack
index|[
operator|--
name|place
index|]
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'\''
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
operator|*
name|Otemp
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'{'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|temp
operator|=
name|atoi
argument_list|(
name|Otemp
argument_list|)
expr_stmt|;
name|Temp_Stack
index|[
name|place
operator|++
index|]
operator|=
name|temp
expr_stmt|;
while|while
condition|(
operator|*
name|Otemp
operator|!=
literal|'}'
condition|)
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|place
operator|)
return|;
block|}
end_function

begin_function
name|void
name|Info_Out
parameter_list|(
name|string
parameter_list|,
name|p_list
parameter_list|,
name|place
parameter_list|)
comment|/* interpret the output string if necessary */
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|p_list
index|[]
decl_stmt|;
name|int
name|place
decl_stmt|;
block|{
name|char
modifier|*
name|tchar
decl_stmt|;
name|int
name|delay
decl_stmt|;
name|int
name|temp
decl_stmt|;
name|int
name|Cond_FLAG
decl_stmt|;
name|int
name|EVAL
decl_stmt|;
name|int
name|Cond_Stack
index|[
literal|128
index|]
decl_stmt|;
name|int
name|Cond_place
decl_stmt|;
name|int
name|Stack
index|[
literal|128
index|]
decl_stmt|;
name|int
name|Top_of_stack
decl_stmt|;
if|if
condition|(
name|string
operator|==
name|NULL
condition|)
return|return;
name|Cond_FLAG
operator|=
name|FALSE
expr_stmt|;
name|Cond_place
operator|=
literal|0
expr_stmt|;
name|Top_of_stack
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|4
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|5
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|6
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|7
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|8
index|]
operator|=
literal|0
expr_stmt|;
name|p
index|[
literal|9
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|p_list
operator|!=
name|NULL
condition|)
block|{
for|for
control|(
name|temp
operator|=
literal|1
init|;
operator|(
name|place
operator|!=
literal|0
operator|)
condition|;
name|temp
operator|++
control|)
block|{
name|p
index|[
name|temp
index|]
operator|=
name|p_list
index|[
operator|--
name|place
index|]
expr_stmt|;
block|}
block|}
name|delay
operator|=
literal|0
expr_stmt|;
name|Otemp
operator|=
name|string
expr_stmt|;
while|while
condition|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'%'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|Otemp
operator|==
literal|'?'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'t'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|'e'
operator|)
operator|||
operator|(
operator|*
name|Otemp
operator|==
literal|';'
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|Otemp
operator|==
literal|'?'
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Cond_FLAG
operator|=
name|TRUE
expr_stmt|;
name|EVAL
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
name|EVAL
condition|)
block|{
comment|/* 						 |  find the end of the  						 |  conditional statement 						 */
while|while
condition|(
operator|(
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%t"
argument_list|,
literal|2
argument_list|)
operator|)
operator|&&
operator|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
comment|/* 							 |  move past '%' 							 */
name|Otemp
operator|++
expr_stmt|;
name|Cond_place
operator|=
name|Operation
argument_list|(
name|Cond_Stack
argument_list|,
name|Cond_place
argument_list|)
expr_stmt|;
block|}
comment|/* 						 |  if condition is true 						 */
if|if
condition|(
operator|(
name|Cond_place
operator|>
literal|0
operator|)
operator|&&
operator|(
name|Cond_Stack
index|[
name|Cond_place
operator|-
literal|1
index|]
operator|)
condition|)
block|{
comment|/* 							 |  end conditional  							 |  parsing 							 */
name|EVAL
operator|=
name|FALSE
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
else|else
comment|/* condition is false */
block|{
comment|/* 							 |  find 'else' or end  							 |  of if statement 							 */
while|while
condition|(
operator|(
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%e"
argument_list|,
literal|2
argument_list|)
operator|)
operator|&&
operator|(
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%;"
argument_list|,
literal|2
argument_list|)
operator|)
operator|&&
operator|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|Otemp
operator|++
expr_stmt|;
comment|/* 							 |  if an 'else' found 							 */
if|if
condition|(
operator|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%e"
argument_list|,
literal|2
argument_list|)
operator|)
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|tchar
operator|=
name|Otemp
expr_stmt|;
comment|/* 								 |  check for 'then' part 								 */
while|while
condition|(
operator|(
operator|*
name|tchar
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|strncmp
argument_list|(
name|tchar
argument_list|,
literal|"%t"
argument_list|,
literal|2
argument_list|)
operator|)
operator|&&
operator|(
name|strncmp
argument_list|(
name|tchar
argument_list|,
literal|"%;"
argument_list|,
literal|2
argument_list|)
operator|)
condition|)
name|tchar
operator|++
expr_stmt|;
comment|/* 								 |  if end of string 								 */
if|if
condition|(
operator|*
name|tchar
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|EVAL
operator|=
name|FALSE
expr_stmt|;
name|Cond_FLAG
operator|=
name|FALSE
expr_stmt|;
name|Otemp
operator|=
name|tchar
expr_stmt|;
block|}
comment|/* 								 |  if end of if found, 								 |  set up to parse  								 |  info 								 */
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|tchar
argument_list|,
literal|"%;"
argument_list|,
literal|2
argument_list|)
condition|)
name|EVAL
operator|=
name|FALSE
expr_stmt|;
comment|/* 								 |  otherwise, check  								 |  conditional in  								 |  'else' 								 */
block|}
comment|/* 							 |  if end of if found, 							 |  get out of if  							 |  statement 							 */
elseif|else
if|if
condition|(
operator|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%;"
argument_list|,
literal|2
argument_list|)
operator|)
condition|)
block|{
name|EVAL
operator|=
name|FALSE
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
else|else
comment|/* Otemp == NULL */
block|{
name|EVAL
operator|=
name|FALSE
expr_stmt|;
name|Cond_FLAG
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
name|Otemp
operator|++
expr_stmt|;
name|Cond_FLAG
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|*
name|Otemp
operator|!=
literal|';'
condition|)
block|{
while|while
condition|(
operator|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"%;"
argument_list|,
literal|2
argument_list|)
operator|)
condition|)
name|Otemp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|Otemp
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
block|}
else|else
name|Otemp
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
name|Top_of_stack
operator|=
name|Operation
argument_list|(
name|Stack
argument_list|,
name|Top_of_stack
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|Otemp
argument_list|,
literal|"$<"
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|delay
operator|=
name|atoi
argument_list|(
name|Otemp
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|Otemp
operator|!=
literal|'>'
condition|)
name|Otemp
operator|++
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
name|chars
operator|=
name|delay
operator|*
name|chars_per_millisecond
expr_stmt|;
name|delay
operator|=
name|chars
expr_stmt|;
if|if
condition|(
operator|(
name|chars
operator|-
name|delay
operator|)
operator|>
literal|0.0
condition|)
name|delay
operator|++
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|pc__
index|]
operator|==
name|NULL
condition|)
name|temp
operator|=
literal|0
expr_stmt|;
else|else
name|temp
operator|=
operator|*
name|String_table
index|[
name|pc__
index|]
expr_stmt|;
for|for
control|(
init|;
name|delay
operator|>
literal|0
condition|;
name|delay
operator|--
control|)
name|putc
argument_list|(
name|temp
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|putchar
argument_list|(
operator|*
name|Otemp
argument_list|)
expr_stmt|;
name|Otemp
operator|++
expr_stmt|;
block|}
block|}
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|wmove
parameter_list|(
name|window
parameter_list|,
name|row
parameter_list|,
name|column
parameter_list|)
comment|/* move cursor to indicated position in window */
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|row
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
name|column
operator|<
name|window
operator|->
name|Num_cols
operator|)
condition|)
block|{
name|window
operator|->
name|LX
operator|=
name|column
expr_stmt|;
name|window
operator|->
name|LY
operator|=
name|row
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|clear_line
parameter_list|(
name|line
parameter_list|,
name|column
parameter_list|,
name|cols
parameter_list|)
name|struct
name|_line
modifier|*
name|line
decl_stmt|;
name|int
name|column
decl_stmt|;
name|int
name|cols
decl_stmt|;
block|{
name|int
name|j
decl_stmt|;
if|if
condition|(
name|column
operator|>
name|line
operator|->
name|last_char
condition|)
name|line
operator|->
name|row
index|[
name|line
operator|->
name|last_char
index|]
operator|=
literal|' '
expr_stmt|;
name|line
operator|->
name|last_char
operator|=
name|column
expr_stmt|;
name|line
operator|->
name|row
index|[
name|column
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|line
operator|->
name|attributes
index|[
name|column
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|line
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|j
operator|=
name|column
operator|+
literal|1
init|;
name|j
operator|<
name|cols
condition|;
name|j
operator|++
control|)
block|{
name|line
operator|->
name|row
index|[
name|j
index|]
operator|=
literal|' '
expr_stmt|;
name|line
operator|->
name|attributes
index|[
name|j
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|werase
parameter_list|(
name|window
parameter_list|)
comment|/* clear the specified window		*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|CLEAR
expr_stmt|;
name|window
operator|->
name|scroll_up
operator|=
name|window
operator|->
name|scroll_down
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
name|i
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|i
operator|++
operator|,
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
control|)
name|clear_line
argument_list|(
name|tmp
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wclrtoeol
parameter_list|(
name|window
parameter_list|)
comment|/* erase from current cursor position to end of line */
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|column
decl_stmt|,
name|row
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|CHANGE
expr_stmt|;
name|column
operator|=
name|window
operator|->
name|LX
expr_stmt|;
name|row
operator|=
name|window
operator|->
name|LY
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
name|row
operator|<
name|window
operator|->
name|LY
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|clear_line
argument_list|(
name|tmp
argument_list|,
name|column
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wrefresh
parameter_list|(
name|window
parameter_list|)
comment|/* flush all previous output		*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|wnoutrefresh
argument_list|(
name|window
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DIAG
block|{
name|struct
name|_line
modifier|*
name|temp
decl_stmt|;
name|int
name|value
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"columns=%d, lines=%d, SC=%d, SR=%d\n"
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|,
name|window
operator|->
name|Num_lines
argument_list|,
name|window
operator|->
name|SC
argument_list|,
name|window
operator|->
name|SR
argument_list|)
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
operator|,
name|temp
operator|=
name|window
operator|->
name|first_line
init|;
name|value
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|value
operator|++
operator|,
name|temp
operator|=
name|temp
operator|->
name|next_screen
control|)
block|{
if|if
condition|(
name|temp
operator|->
name|number
operator|==
operator|-
literal|1
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"line moved "
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp
operator|->
name|scroll
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"scroll_x is set:  "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"lc%d=%s|\n"
argument_list|,
name|temp
operator|->
name|last_char
argument_list|,
name|temp
operator|->
name|row
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"+-------------------- virtual screen ----------------------------------------+\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"columns=%d, lines=%d \n"
argument_list|,
name|virtual_scr
operator|->
name|Num_cols
argument_list|,
name|virtual_scr
operator|->
name|Num_lines
argument_list|)
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
operator|,
name|temp
operator|=
name|virtual_scr
operator|->
name|first_line
init|;
name|value
operator|<
name|virtual_scr
operator|->
name|Num_lines
condition|;
name|value
operator|++
operator|,
name|temp
operator|=
name|temp
operator|->
name|next_screen
control|)
block|{
if|if
condition|(
name|temp
operator|->
name|number
operator|==
operator|-
literal|1
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"line moved "
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp
operator|->
name|scroll
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"scroll_x is set:  "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"lc%d=%s|\n"
argument_list|,
name|temp
operator|->
name|last_char
argument_list|,
name|temp
operator|->
name|row
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"columns=%d, lines=%d \n"
argument_list|,
name|curscr
operator|->
name|Num_cols
argument_list|,
name|curscr
operator|->
name|Num_lines
argument_list|)
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
operator|,
name|temp
operator|=
name|curscr
operator|->
name|first_line
init|;
name|value
operator|<
name|curscr
operator|->
name|Num_lines
condition|;
name|value
operator|++
operator|,
name|temp
operator|=
name|temp
operator|->
name|next_screen
control|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"line=%s|\n"
argument_list|,
name|temp
operator|->
name|row
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|doupdate
argument_list|()
expr_stmt|;
name|virtual_scr
operator|->
name|SCROLL_CLEAR
operator|=
name|FALSE
expr_stmt|;
name|virtual_scr
operator|->
name|scroll_down
operator|=
name|virtual_scr
operator|->
name|scroll_up
operator|=
literal|0
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|touchwin
parameter_list|(
name|window
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|struct
name|_line
modifier|*
name|user_line
decl_stmt|;
name|int
name|line_counter
init|=
literal|0
decl_stmt|;
for|for
control|(
name|line_counter
operator|=
literal|0
operator|,
name|user_line
operator|=
name|window
operator|->
name|first_line
init|;
name|line_counter
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|line_counter
operator|++
control|)
block|{
name|user_line
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wnoutrefresh
parameter_list|(
name|window
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|struct
name|_line
modifier|*
name|user_line
decl_stmt|;
name|struct
name|_line
modifier|*
name|virtual_line
decl_stmt|;
name|int
name|line_counter
init|=
literal|0
decl_stmt|;
name|int
name|user_col
init|=
literal|0
decl_stmt|;
name|int
name|virt_col
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|window
operator|->
name|SR
operator|>=
name|virtual_scr
operator|->
name|Num_lines
condition|)
return|return;
name|user_line
operator|=
name|window
operator|->
name|first_line
expr_stmt|;
name|virtual_line
operator|=
name|virtual_scr
operator|->
name|first_line
expr_stmt|;
name|virtual_scr
operator|->
name|SCROLL_CLEAR
operator|=
name|window
operator|->
name|SCROLL_CLEAR
expr_stmt|;
name|virtual_scr
operator|->
name|LX
operator|=
name|window
operator|->
name|LX
operator|+
name|window
operator|->
name|SC
expr_stmt|;
name|virtual_scr
operator|->
name|LY
operator|=
name|window
operator|->
name|LY
operator|+
name|window
operator|->
name|SR
expr_stmt|;
name|virtual_scr
operator|->
name|scroll_up
operator|=
name|window
operator|->
name|scroll_up
expr_stmt|;
name|virtual_scr
operator|->
name|scroll_down
operator|=
name|window
operator|->
name|scroll_down
expr_stmt|;
if|if
condition|(
operator|(
name|last_window_refreshed
operator|==
name|window
operator|)
operator|&&
operator|(
operator|!
name|window
operator|->
name|SCROLL_CLEAR
operator|)
condition|)
return|return;
for|for
control|(
name|line_counter
operator|=
literal|0
init|;
name|line_counter
operator|<
name|window
operator|->
name|SR
condition|;
name|line_counter
operator|++
control|)
block|{
name|virtual_line
operator|=
name|virtual_line
operator|->
name|next_screen
expr_stmt|;
block|}
for|for
control|(
name|line_counter
operator|=
literal|0
init|;
operator|(
name|line_counter
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
operator|(
name|line_counter
operator|+
name|window
operator|->
name|SR
operator|)
operator|<
name|virtual_scr
operator|->
name|Num_lines
operator|)
condition|;
name|line_counter
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|last_window_refreshed
operator|!=
name|window
operator|)
operator|||
operator|(
name|user_line
operator|->
name|changed
operator|)
operator|||
operator|(
operator|(
name|SCROLL
operator||
name|CLEAR
operator|)
operator|&
name|window
operator|->
name|SCROLL_CLEAR
operator|)
condition|)
block|{
for|for
control|(
name|user_col
operator|=
literal|0
operator|,
name|virt_col
operator|=
name|window
operator|->
name|SC
init|;
operator|(
name|virt_col
operator|<
name|virtual_scr
operator|->
name|Num_cols
operator|)
operator|&&
operator|(
name|user_col
operator|<
name|window
operator|->
name|Num_cols
operator|)
condition|;
name|virt_col
operator|++
operator|,
name|user_col
operator|++
control|)
block|{
name|virtual_line
operator|->
name|row
index|[
name|virt_col
index|]
operator|=
name|user_line
operator|->
name|row
index|[
name|user_col
index|]
expr_stmt|;
name|virtual_line
operator|->
name|attributes
index|[
name|virt_col
index|]
operator|=
name|user_line
operator|->
name|attributes
index|[
name|user_col
index|]
expr_stmt|;
block|}
block|}
if|if
condition|(
name|virtual_scr
operator|->
name|Num_cols
operator|!=
name|window
operator|->
name|Num_cols
condition|)
block|{
if|if
condition|(
name|virtual_line
operator|->
name|last_char
operator|<
operator|(
name|user_line
operator|->
name|last_char
operator|+
name|window
operator|->
name|SC
operator|)
condition|)
block|{
if|if
condition|(
name|virtual_line
operator|->
name|row
index|[
name|virtual_line
operator|->
name|last_char
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
name|virtual_line
operator|->
name|row
index|[
name|virtual_line
operator|->
name|last_char
index|]
operator|=
literal|' '
expr_stmt|;
name|virtual_line
operator|->
name|last_char
operator|=
name|min
argument_list|(
name|virtual_scr
operator|->
name|Num_cols
argument_list|,
operator|(
name|user_line
operator|->
name|last_char
operator|+
name|window
operator|->
name|SC
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|virtual_line
operator|->
name|last_char
operator|>
operator|(
name|user_line
operator|->
name|last_char
operator|+
name|window
operator|->
name|SC
operator|)
condition|)
block|{
name|virtual_line
operator|->
name|row
index|[
name|min
argument_list|(
name|virtual_scr
operator|->
name|Num_cols
argument_list|,
operator|(
name|user_line
operator|->
name|last_char
operator|+
name|window
operator|->
name|SC
operator|)
argument_list|)
index|]
operator|=
literal|' '
expr_stmt|;
block|}
block|}
else|else
name|virtual_line
operator|->
name|last_char
operator|=
name|user_line
operator|->
name|last_char
expr_stmt|;
name|virtual_line
operator|->
name|row
index|[
name|virtual_line
operator|->
name|last_char
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|virtual_line
operator|->
name|changed
operator|=
name|user_line
operator|->
name|changed
expr_stmt|;
name|virtual_line
operator|=
name|virtual_line
operator|->
name|next_screen
expr_stmt|;
name|user_line
operator|=
name|user_line
operator|->
name|next_screen
expr_stmt|;
block|}
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|FALSE
expr_stmt|;
name|window
operator|->
name|scroll_up
operator|=
name|window
operator|->
name|scroll_down
operator|=
literal|0
expr_stmt|;
name|last_window_refreshed
operator|=
name|window
expr_stmt|;
block|}
end_function

begin_function
name|void
name|flushinp
parameter_list|()
comment|/* flush input				*/
block|{ }
end_function

begin_function
name|void
name|ungetch
parameter_list|(
name|c
parameter_list|)
comment|/* push a character back on input	*/
name|int
name|c
decl_stmt|;
block|{
if|if
condition|(
name|bufp
operator|<
literal|100
condition|)
name|in_buff
index|[
name|bufp
operator|++
index|]
operator|=
name|c
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|BSD_SELECT
end_ifdef

begin_function
name|int
name|timed_getchar
parameter_list|()
block|{
name|struct
name|timeval
name|tv
decl_stmt|;
name|fd_set
name|fds
decl_stmt|;
name|int
name|ret_val
decl_stmt|;
name|int
name|nfds
init|=
literal|1
decl_stmt|;
name|char
name|temp
decl_stmt|;
name|FD_ZERO
argument_list|(
operator|&
name|fds
argument_list|)
expr_stmt|;
name|tv
operator|.
name|tv_sec
operator|=
literal|0
expr_stmt|;
name|tv
operator|.
name|tv_usec
operator|=
literal|500000
expr_stmt|;
comment|/* half a second */
name|FD_SET
argument_list|(
literal|0
argument_list|,
operator|&
name|fds
argument_list|)
expr_stmt|;
name|Time_Out
operator|=
name|FALSE
expr_stmt|;
comment|/* just in case */
name|ret_val
operator|=
name|select
argument_list|(
name|nfds
argument_list|,
operator|&
name|fds
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|tv
argument_list|)
expr_stmt|;
comment|/* 	 |	if ret_val is less than zero, there was no input 	 |	otherwise, get a character and return it 	 */
if|if
condition|(
name|ret_val
operator|<=
literal|0
condition|)
block|{
name|Time_Out
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|temp
argument_list|,
literal|1
argument_list|)
condition|?
name|temp
else|:
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|wgetch
parameter_list|(
name|window
parameter_list|)
comment|/* get character from specified window	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|in_value
decl_stmt|;
name|char
name|temp
decl_stmt|;
ifndef|#
directive|ifndef
name|SYS5
name|int
name|old_arg
decl_stmt|;
endif|#
directive|endif
comment|/* SYS5 */
ifdef|#
directive|ifdef
name|BSD_SELECT
if|if
condition|(
name|Noblock
condition|)
name|in_value
operator|=
operator|(
operator|(
name|bufp
operator|>
literal|0
operator|)
condition|?
name|in_buff
index|[
operator|--
name|bufp
index|]
else|:
name|timed_getchar
argument_list|()
operator|)
expr_stmt|;
else|else
name|in_value
operator|=
operator|(
operator|(
name|bufp
operator|>
literal|0
operator|)
condition|?
name|in_buff
index|[
operator|--
name|bufp
index|]
else|:
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|temp
argument_list|,
literal|1
argument_list|)
condition|?
name|temp
else|:
operator|-
literal|1
operator|)
expr_stmt|;
else|#
directive|else
comment|/* BSD_SELECT */
ifdef|#
directive|ifdef
name|SYS5
name|in_value
operator|=
operator|(
operator|(
name|bufp
operator|>
literal|0
operator|)
condition|?
name|in_buff
index|[
operator|--
name|bufp
index|]
else|:
operator|(
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|temp
argument_list|,
literal|1
argument_list|)
operator|>
literal|0
operator|)
condition|?
name|temp
else|:
operator|-
literal|1
operator|)
expr_stmt|;
else|#
directive|else
comment|/* SYS5 */
if|if
condition|(
name|Noblock
condition|)
block|{
name|Time_Out
operator|=
name|FALSE
expr_stmt|;
name|old_arg
operator|=
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_GETFL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|in_value
operator|=
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_SETFL
argument_list|,
name|old_arg
operator||
name|FNDELAY
argument_list|)
expr_stmt|;
block|}
name|in_value
operator|=
operator|(
operator|(
name|bufp
operator|>
literal|0
operator|)
condition|?
name|in_buff
index|[
operator|--
name|bufp
index|]
else|:
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|temp
argument_list|,
literal|1
argument_list|)
condition|?
name|temp
else|:
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|Noblock
condition|)
block|{
name|fcntl
argument_list|(
literal|0
argument_list|,
name|F_SETFL
argument_list|,
name|old_arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Time_Out
condition|)
name|in_value
operator|=
operator|-
literal|1
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* SYS5 */
endif|#
directive|endif
comment|/* BSD_SELECT */
if|if
condition|(
name|in_value
operator|!=
operator|-
literal|1
condition|)
block|{
name|in_value
operator|&=
literal|0xff
expr_stmt|;
if|if
condition|(
operator|(
name|Parity
operator|)
operator|&&
operator|(
name|Num_bits
operator|<
literal|8
operator|)
condition|)
comment|/* strip eighth bit if parity in use */
name|in_value
operator|&=
literal|0177
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|interrupt_flag
condition|)
block|{
name|interrupt_flag
operator|=
name|FALSE
expr_stmt|;
name|in_value
operator|=
name|wgetch
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|in_value
operator|==
literal|'\033'
operator|)
operator|||
operator|(
name|in_value
operator|==
literal|'\037'
operator|)
condition|)
comment|/* escape character */
name|in_value
operator|=
name|Get_key
argument_list|(
name|in_value
argument_list|)
expr_stmt|;
return|return
operator|(
name|in_value
operator|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|BSD_SELECT
end_ifndef

begin_function
name|void
name|Clear
parameter_list|(
name|arg
parameter_list|)
comment|/* notify that time out has occurred	*/
name|int
name|arg
decl_stmt|;
block|{
name|Time_Out
operator|=
name|TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"inside Clear()\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG */
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BSD_SELECT */
end_comment

begin_function
name|int
name|Get_key
parameter_list|(
name|first_char
parameter_list|)
comment|/* try to decode key sequence	*/
name|int
name|first_char
decl_stmt|;
comment|/* first character of sequence	*/
block|{
name|int
name|in_char
decl_stmt|;
name|int
name|Count
decl_stmt|;
name|char
name|string
index|[
literal|128
index|]
decl_stmt|;
name|char
modifier|*
name|Gtemp
decl_stmt|;
name|int
name|Found
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|struct
name|termio
name|Gterminal
decl_stmt|;
else|#
directive|else
name|struct
name|sgttyb
name|Gterminal
decl_stmt|;
endif|#
directive|endif
name|struct
name|KEY_STACK
modifier|*
name|St_point
decl_stmt|;
if|#
directive|if
operator|(
operator|!
name|defined
argument_list|(
name|BSD_SELECT
argument_list|)
operator|)
operator|||
operator|(
operator|!
name|defined
argument_list|(
name|SYS5
argument_list|)
operator|)
name|int
name|value
decl_stmt|;
endif|#
directive|endif
comment|/* BSD_SELECT */
name|Count
operator|=
literal|0
expr_stmt|;
name|Gtemp
operator|=
name|string
expr_stmt|;
name|string
index|[
name|Count
operator|++
index|]
operator|=
name|first_char
expr_stmt|;
name|string
index|[
name|Count
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|Time_Out
operator|=
name|FALSE
expr_stmt|;
ifndef|#
directive|ifndef
name|BSD_SELECT
name|signal
argument_list|(
name|SIGALRM
argument_list|,
name|Clear
argument_list|)
expr_stmt|;
name|value
operator|=
name|alarm
argument_list|(
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* BSD_SELECT */
name|Noblock
operator|=
name|TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Gterminal
operator|.
name|c_cc
index|[
name|VTIME
index|]
operator|=
literal|0
expr_stmt|;
comment|/* timeout value	*/
name|Gterminal
operator|.
name|c_lflag
operator|&=
operator|~
name|ICANON
expr_stmt|;
comment|/* disable canonical operation	*/
name|Gterminal
operator|.
name|c_lflag
operator|&=
operator|~
name|ECHO
expr_stmt|;
comment|/* disable echo		*/
endif|#
directive|endif
name|Count
operator|=
literal|1
expr_stmt|;
name|Found
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
operator|(
name|Count
operator|<
name|Max_Key_len
operator|)
operator|&&
operator|(
operator|!
name|Time_Out
operator|)
operator|&&
operator|(
operator|!
name|Found
operator|)
condition|)
block|{
name|in_char
operator|=
name|wgetch
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"back in GetKey()\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG */
if|if
condition|(
name|in_char
operator|!=
operator|-
literal|1
condition|)
block|{
name|string
index|[
name|Count
operator|++
index|]
operator|=
name|in_char
expr_stmt|;
name|string
index|[
name|Count
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|St_point
operator|=
name|KEY_TOS
expr_stmt|;
while|while
condition|(
operator|(
name|St_point
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|!
name|Found
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|string
argument_list|,
name|St_point
operator|->
name|element
operator|->
name|string
argument_list|)
condition|)
name|Found
operator|=
name|TRUE
expr_stmt|;
else|else
name|St_point
operator|=
name|St_point
operator|->
name|next
expr_stmt|;
block|}
block|}
block|}
ifndef|#
directive|ifndef
name|BSD_SELECT
if|if
condition|(
operator|!
name|Time_Out
condition|)
name|value
operator|=
name|alarm
argument_list|(
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* BSD_SELECT */
ifdef|#
directive|ifdef
name|SYS5
comment|/*	value = ioctl(0, TCSETA,&Terminal);*/
else|#
directive|else
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/*	value = fcntl(0, F_SETFL, old_arg);*/
endif|#
directive|endif
name|Noblock
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|Found
condition|)
block|{
return|return
operator|(
name|St_point
operator|->
name|element
operator|->
name|value
operator|)
return|;
block|}
else|else
block|{
while|while
condition|(
name|Count
operator|>
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|string
index|[
operator|--
name|Count
index|]
operator|!=
operator|-
literal|1
operator|)
operator|&&
operator|(
call|(
name|unsigned
name|char
call|)
argument_list|(
name|string
index|[
name|Count
index|]
argument_list|)
operator|!=
literal|255
operator|)
condition|)
block|{
ifdef|#
directive|ifdef
name|DIAG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ungetting character %d\n"
argument_list|,
name|string
index|[
name|Count
index|]
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ungetch
argument_list|(
name|string
index|[
name|Count
index|]
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|first_char
operator|)
return|;
block|}
block|}
end_function

begin_function
name|void
name|waddch
parameter_list|(
name|window
parameter_list|,
name|c
parameter_list|)
comment|/* output the character in the specified window	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|c
decl_stmt|;
block|{
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
name|int
name|shift
decl_stmt|;
comment|/* number of spaces to shift if a tab		*/
name|struct
name|_line
modifier|*
name|tmpline
decl_stmt|;
ifdef|#
directive|ifdef
name|DIAG
comment|/*printf("starting waddch \n");fflush(stdout);*/
endif|#
directive|endif
name|row
operator|=
name|window
operator|->
name|LY
expr_stmt|;
name|column
operator|=
name|window
operator|->
name|LX
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
block|{
name|shift
operator|=
operator|(
name|column
operator|+
literal|1
operator|)
operator|%
literal|8
expr_stmt|;
if|if
condition|(
name|shift
operator|==
literal|0
condition|)
name|shift
operator|++
expr_stmt|;
else|else
name|shift
operator|=
literal|9
operator|-
name|shift
expr_stmt|;
while|while
condition|(
name|shift
operator|>
literal|0
condition|)
block|{
name|shift
operator|--
expr_stmt|;
name|waddch
argument_list|(
name|window
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|column
operator|<
name|window
operator|->
name|Num_cols
operator|)
operator|&&
operator|(
name|row
operator|<
name|window
operator|->
name|Num_lines
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|c
operator|==
literal|'~'
operator|)
operator|&&
operator|(
name|Booleans
index|[
name|hz__
index|]
operator|)
condition|)
name|c
operator|=
literal|'@'
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|!=
literal|'\b'
operator|)
operator|&&
operator|(
name|c
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|c
operator|!=
literal|'\r'
operator|)
condition|)
block|{
name|row
operator|=
literal|0
expr_stmt|;
name|tmpline
operator|=
name|window
operator|->
name|first_line
expr_stmt|;
while|while
condition|(
name|row
operator|<
name|window
operator|->
name|LY
condition|)
block|{
name|row
operator|++
expr_stmt|;
name|tmpline
operator|=
name|tmpline
operator|->
name|next_screen
expr_stmt|;
block|}
name|tmpline
operator|->
name|row
index|[
name|column
index|]
operator|=
name|c
expr_stmt|;
name|tmpline
operator|->
name|attributes
index|[
name|column
index|]
operator|=
name|window
operator|->
name|Attrib
expr_stmt|;
name|tmpline
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|column
operator|>=
name|tmpline
operator|->
name|last_char
condition|)
block|{
if|if
condition|(
name|column
operator|>
name|tmpline
operator|->
name|last_char
condition|)
name|tmpline
operator|->
name|row
index|[
name|tmpline
operator|->
name|last_char
index|]
operator|=
literal|' '
expr_stmt|;
name|tmpline
operator|->
name|row
index|[
name|column
operator|+
literal|1
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmpline
operator|->
name|attributes
index|[
name|column
operator|+
literal|1
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmpline
operator|->
name|last_char
operator|=
name|column
operator|+
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
name|wclrtoeol
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|window
operator|->
name|LX
operator|=
name|window
operator|->
name|Num_cols
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
name|window
operator|->
name|LX
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\b'
condition|)
name|window
operator|->
name|LX
operator|--
expr_stmt|;
else|else
name|window
operator|->
name|LX
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|window
operator|->
name|LX
operator|>=
name|window
operator|->
name|Num_cols
condition|)
block|{
name|window
operator|->
name|LX
operator|=
literal|0
expr_stmt|;
name|window
operator|->
name|LY
operator|++
expr_stmt|;
if|if
condition|(
name|window
operator|->
name|LY
operator|>=
name|window
operator|->
name|Num_lines
condition|)
block|{
name|window
operator|->
name|LY
operator|=
name|window
operator|->
name|Num_lines
operator|-
literal|1
expr_stmt|;
comment|/*			window->LY = row; 			wmove(window, 0, 0); 			wdeleteln(window); 			wmove(window, row, 0);*/
block|}
block|}
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|CHANGE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|winsertln
parameter_list|(
name|window
parameter_list|)
comment|/* insert a blank line into the specified window */
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp1
decl_stmt|;
name|window
operator|->
name|scroll_down
operator|+=
literal|1
expr_stmt|;
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|SCROLL
expr_stmt|;
name|column
operator|=
name|window
operator|->
name|LX
expr_stmt|;
name|row
operator|=
name|window
operator|->
name|LY
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
operator|(
name|row
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|NULL
expr_stmt|;
name|tmp1
operator|=
name|tmp
expr_stmt|;
name|clear_line
argument_list|(
name|tmp1
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
name|tmp1
operator|->
name|number
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
operator|(
name|row
operator|<
name|window
operator|->
name|LY
operator|)
operator|&&
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
operator|(
name|window
operator|->
name|LY
operator|==
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
operator|)
operator|&&
operator|(
name|window
operator|->
name|Num_lines
operator|>
literal|1
operator|)
condition|)
block|{
name|tmp1
operator|->
name|next_screen
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|tmp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|window
operator|->
name|Num_lines
operator|>
literal|1
condition|)
block|{
if|if
condition|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp1
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
name|tmp
operator|->
name|prev_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp1
operator|->
name|next_screen
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
name|tmp
operator|->
name|scroll
operator|=
name|DOWN
expr_stmt|;
block|}
if|if
condition|(
name|window
operator|->
name|LY
operator|==
literal|0
condition|)
name|window
operator|->
name|first_line
operator|=
name|tmp1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wdeleteln
parameter_list|(
name|window
parameter_list|)
comment|/* delete a line in the specified window */
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmpline
decl_stmt|;
if|if
condition|(
name|window
operator|->
name|Num_lines
operator|>
literal|1
condition|)
block|{
name|window
operator|->
name|scroll_up
operator|+=
literal|1
expr_stmt|;
name|window
operator|->
name|SCROLL_CLEAR
operator|=
name|SCROLL
expr_stmt|;
name|column
operator|=
name|window
operator|->
name|LX
expr_stmt|;
name|row
operator|=
name|window
operator|->
name|LY
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
name|row
operator|<
name|window
operator|->
name|LY
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|window
operator|->
name|LY
operator|==
literal|0
condition|)
name|window
operator|->
name|first_line
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
condition|)
block|{
name|tmp
operator|->
name|next_screen
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|->
name|scroll
operator|=
name|UP
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
block|}
name|tmpline
operator|=
name|tmp
expr_stmt|;
name|clear_line
argument_list|(
name|tmpline
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
name|tmpline
operator|->
name|number
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|!=
name|NULL
condition|)
block|{
name|tmp
operator|->
name|next_screen
operator|=
name|tmpline
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|changed
operator|=
name|TRUE
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
block|}
else|else
name|tmp
operator|=
name|tmpline
expr_stmt|;
name|tmp
operator|->
name|next_screen
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|clear_line
argument_list|(
name|window
operator|->
name|first_line
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|wclrtobot
parameter_list|(
name|window
parameter_list|)
comment|/* delete from current position to end of the window */
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|window
operator|->
name|SCROLL_CLEAR
operator||=
name|CLEAR
expr_stmt|;
name|column
operator|=
name|window
operator|->
name|LX
expr_stmt|;
name|row
operator|=
name|window
operator|->
name|LY
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|tmp
operator|=
name|window
operator|->
name|first_line
init|;
name|row
operator|<
name|window
operator|->
name|LY
condition|;
name|row
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|clear_line
argument_list|(
name|tmp
argument_list|,
name|column
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
operator|(
name|window
operator|->
name|LY
operator|+
literal|1
operator|)
init|;
name|row
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|row
operator|++
control|)
block|{
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|clear_line
argument_list|(
name|tmp
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|window
argument_list|,
name|row
argument_list|,
name|column
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wstandout
parameter_list|(
name|window
parameter_list|)
comment|/* begin standout mode in window	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
if|if
condition|(
name|Numbers
index|[
name|sg__
index|]
operator|<
literal|1
condition|)
comment|/* if not magic cookie glitch	*/
name|window
operator|->
name|Attrib
operator||=
name|A_STANDOUT
expr_stmt|;
block|}
end_function

begin_function
name|void
name|wstandend
parameter_list|(
name|window
parameter_list|)
comment|/* end standout mode in window	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|window
operator|->
name|Attrib
operator|&=
operator|~
name|A_STANDOUT
expr_stmt|;
block|}
end_function

begin_function
name|void
name|waddstr
parameter_list|(
name|window
parameter_list|,
name|string
parameter_list|)
comment|/* write 'string' in window	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
block|{
name|char
modifier|*
name|wstring
decl_stmt|;
for|for
control|(
name|wstring
operator|=
name|string
init|;
operator|*
name|wstring
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|;
name|wstring
operator|++
control|)
name|waddch
argument_list|(
name|window
argument_list|,
operator|*
name|wstring
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|clearok
parameter_list|(
name|window
parameter_list|,
name|flag
parameter_list|)
comment|/* erase screen and redraw at next refresh	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|flag
decl_stmt|;
block|{
name|Repaint_screen
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|echo
parameter_list|()
comment|/* turn on echoing				*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Terminal
operator|.
name|c_lflag
operator||=
name|ECHO
expr_stmt|;
comment|/* enable echo		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|Terminal
operator|.
name|sg_flags
operator||=
name|ECHO
expr_stmt|;
comment|/* enable echo		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|noecho
parameter_list|()
comment|/* turn off echoing				*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|ECHO
expr_stmt|;
comment|/* disable echo		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|Terminal
operator|.
name|sg_flags
operator|&=
operator|~
name|ECHO
expr_stmt|;
comment|/* disable echo		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|raw
parameter_list|()
comment|/* set to read characters immediately		*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Intr
operator|=
name|Terminal
operator|.
name|c_cc
index|[
name|VINTR
index|]
expr_stmt|;
comment|/* get the interrupt character	*/
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|ICANON
expr_stmt|;
comment|/* disable canonical operation	*/
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|ISIG
expr_stmt|;
comment|/* disable signal checking	*/
ifdef|#
directive|ifdef
name|FLUSHO
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|FLUSHO
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|PENDIN
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|PENDIN
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|IEXTEN
name|Terminal
operator|.
name|c_lflag
operator|&=
operator|~
name|IEXTEN
expr_stmt|;
endif|#
directive|endif
name|Terminal
operator|.
name|c_cc
index|[
name|VMIN
index|]
operator|=
literal|1
expr_stmt|;
comment|/* minimum of one character */
name|Terminal
operator|.
name|c_cc
index|[
name|VTIME
index|]
operator|=
literal|255
expr_stmt|;
comment|/* timeout value	*/
name|Terminal
operator|.
name|c_cc
index|[
name|VINTR
index|]
operator|=
literal|0
expr_stmt|;
comment|/* eliminate interrupt	*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|Terminal
operator|.
name|sg_flags
operator||=
name|RAW
expr_stmt|;
comment|/* enable raw mode		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|noraw
parameter_list|()
comment|/* set to normal character read mode		*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Terminal
operator|.
name|c_lflag
operator||=
name|ICANON
expr_stmt|;
comment|/* enable canonical operation	*/
name|Terminal
operator|.
name|c_lflag
operator||=
name|ISIG
expr_stmt|;
comment|/* enable signal checking	*/
name|Terminal
operator|.
name|c_cc
index|[
name|VEOF
index|]
operator|=
literal|4
expr_stmt|;
comment|/* EOF character = 4	*/
name|Terminal
operator|.
name|c_cc
index|[
name|VEOL
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
comment|/* EOL = 0		*/
name|Terminal
operator|.
name|c_cc
index|[
name|VINTR
index|]
operator|=
name|Intr
expr_stmt|;
comment|/* reset interrupt char	*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|Terminal
operator|.
name|sg_flags
operator|&=
operator|~
name|RAW
expr_stmt|;
comment|/* disable raw mode		*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
comment|/*	old_arg = fcntl(0, F_GETFL, 0); 	value = fcntl(0, F_SETFL, old_arg& ~FNDELAY);*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|nl
parameter_list|()
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Terminal
operator|.
name|c_iflag
operator||=
name|ICRNL
expr_stmt|;
comment|/* enable carriage-return to line-feed mapping	*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|nonl
parameter_list|()
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|Terminal
operator|.
name|c_iflag
operator|&=
operator|~
name|ICRNL
expr_stmt|;
comment|/* disable carriage-return to line-feed mapping	*/
name|Terminal
operator|.
name|c_iflag
operator|&=
operator|~
name|IGNCR
expr_stmt|;
comment|/* do not ignore carriage-return	*/
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Terminal
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|saveterm
parameter_list|()
block|{ }
end_function

begin_function
name|void
name|fixterm
parameter_list|()
block|{ }
end_function

begin_function
name|void
name|resetterm
parameter_list|()
block|{ }
end_function

begin_function
name|void
name|nodelay
parameter_list|(
name|window
parameter_list|,
name|flag
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|flag
decl_stmt|;
block|{ }
end_function

begin_function
name|void
name|idlok
parameter_list|(
name|window
parameter_list|,
name|flag
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|flag
decl_stmt|;
block|{ }
end_function

begin_function
name|void
name|keypad
parameter_list|(
name|window
parameter_list|,
name|flag
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|flag
decl_stmt|;
block|{
if|if
condition|(
name|flag
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|ks__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|String_Out
argument_list|(
name|String_table
index|[
name|ke__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|savetty
parameter_list|()
comment|/* save current tty stats			*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCGETA
argument_list|,
operator|&
name|Saved_tty
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|Saved_tty
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|resetty
parameter_list|()
comment|/* restore previous tty stats			*/
block|{
name|int
name|value
decl_stmt|;
ifdef|#
directive|ifdef
name|SYS5
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TCSETA
argument_list|,
operator|&
name|Saved_tty
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
else|#
directive|else
name|value
operator|=
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETP
argument_list|,
operator|&
name|Saved_tty
argument_list|)
expr_stmt|;
comment|/* set characteristics	*/
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|endwin
parameter_list|()
comment|/* end windows					*/
block|{
name|keypad
argument_list|(
name|stdscr
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|initialized
operator|=
name|FALSE
expr_stmt|;
name|delwin
argument_list|(
name|curscr
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|virtual_scr
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|stdscr
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|SYS5
block|{
name|int
name|old_arg
decl_stmt|,
name|value
decl_stmt|;
comment|/*	old_arg = fcntl(0, F_GETFL, 0); 	value = fcntl(0, F_SETFL, old_arg& ~FNDELAY);*/
block|}
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|delwin
parameter_list|(
name|window
parameter_list|)
comment|/* delete the window structure			*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
operator|(
name|i
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
name|window
operator|->
name|first_line
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|window
operator|->
name|first_line
operator|=
name|window
operator|->
name|first_line
operator|->
name|next_screen
expr_stmt|;
name|free
argument_list|(
name|window
operator|->
name|first_line
operator|->
name|prev_screen
operator|->
name|row
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|window
operator|->
name|first_line
operator|->
name|prev_screen
operator|->
name|attributes
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|window
operator|->
name|first_line
operator|->
name|prev_screen
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|window
operator|==
name|last_window_refreshed
condition|)
name|last_window_refreshed
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|window
operator|->
name|first_line
operator|!=
name|NULL
condition|)
block|{
name|free
argument_list|(
name|window
operator|->
name|first_line
operator|->
name|row
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|window
operator|->
name|first_line
operator|->
name|attributes
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|window
operator|->
name|first_line
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|__STDC__
end_ifndef

begin_decl_stmt
name|void
name|wprintw
argument_list|(
name|va_alist
argument_list|)
name|va_dcl
else|#
directive|else
comment|/* __STDC__ */
name|void
name|wprintw
argument_list|(
name|WINDOW
operator|*
name|window
argument_list|,
specifier|const
name|char
operator|*
name|format
argument_list|,
operator|...
argument_list|)
endif|#
directive|endif
comment|/* __STDC__ */
block|{
ifndef|#
directive|ifndef
name|__STDC__
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
else|#
directive|else
name|va_list
name|ap
decl_stmt|;
endif|#
directive|endif
name|int
name|value
decl_stmt|;
name|char
modifier|*
name|fpoint
decl_stmt|;
name|char
modifier|*
name|wtemp
decl_stmt|;
ifndef|#
directive|ifndef
name|__STDC__
name|va_start
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|window
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|WINDOW
operator|*
argument_list|)
expr_stmt|;
name|format
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* __STDC__ */
name|va_start
argument_list|(
name|ap
argument_list|,
name|format
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* __STDC__ */
name|fpoint
operator|=
operator|(
name|char
operator|*
operator|)
name|format
expr_stmt|;
while|while
condition|(
operator|*
name|fpoint
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'%'
condition|)
block|{
name|fpoint
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'d'
condition|)
block|{
name|value
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|int
argument_list|)
expr_stmt|;
name|iout
argument_list|(
name|window
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'c'
condition|)
block|{
name|value
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|int
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|window
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'s'
condition|)
block|{
name|wtemp
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|window
argument_list|,
name|wtemp
argument_list|)
expr_stmt|;
block|}
name|fpoint
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'\\'
condition|)
block|{
name|fpoint
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|fpoint
operator|==
literal|'n'
condition|)
name|waddch
argument_list|(
name|window
argument_list|,
literal|'\n'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|fpoint
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|fpoint
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|value
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|fpoint
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|fpoint
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|value
operator|=
operator|(
name|value
operator|*
literal|8
operator|)
operator|+
operator|(
operator|*
name|fpoint
operator|-
literal|'0'
operator|)
expr_stmt|;
name|fpoint
operator|++
expr_stmt|;
block|}
name|waddch
argument_list|(
name|window
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
name|fpoint
operator|++
expr_stmt|;
block|}
else|else
name|waddch
argument_list|(
name|window
argument_list|,
operator|*
name|fpoint
operator|++
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|__STDC__
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* __STDC__ */
block|}
end_decl_stmt

begin_function
name|void
name|iout
parameter_list|(
name|window
parameter_list|,
name|value
parameter_list|)
comment|/* output characters		*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|value
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|(
name|i
operator|=
name|value
operator|/
literal|10
operator|)
operator|!=
literal|0
condition|)
name|iout
argument_list|(
name|window
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|window
argument_list|,
operator|(
operator|(
name|value
operator|%
literal|10
operator|)
operator|+
literal|'0'
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|Comp_line
parameter_list|(
name|line1
parameter_list|,
name|line2
parameter_list|)
comment|/* compare lines	*/
name|struct
name|_line
modifier|*
name|line1
decl_stmt|;
name|struct
name|_line
modifier|*
name|line2
decl_stmt|;
block|{
name|int
name|count1
decl_stmt|,
name|count2
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|att1
decl_stmt|,
modifier|*
name|att2
decl_stmt|;
name|char
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|c1
operator|=
name|line1
operator|->
name|row
expr_stmt|;
name|c2
operator|=
name|line2
operator|->
name|row
expr_stmt|;
name|att1
operator|=
name|line1
operator|->
name|attributes
expr_stmt|;
name|att2
operator|=
name|line2
operator|->
name|attributes
expr_stmt|;
name|count2
operator|=
name|strlen
argument_list|(
name|c1
argument_list|)
operator|+
literal|1
expr_stmt|;
name|count1
operator|=
name|strlen
argument_list|(
name|c2
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|count1
operator|>
name|count2
condition|)
block|{
name|i
operator|=
name|count2
expr_stmt|;
name|count2
operator|=
name|count1
expr_stmt|;
name|count1
operator|=
name|i
expr_stmt|;
block|}
if|if
condition|(
name|count2
operator|>
operator|(
name|count1
operator|+
name|count1
operator|)
condition|)
return|return
operator|(
literal|2
operator|)
return|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|c1
index|[
name|i
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|c2
index|[
name|i
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|c1
index|[
name|i
index|]
operator|==
name|c2
index|[
name|i
index|]
operator|)
operator|&&
operator|(
name|att1
index|[
name|i
index|]
operator|==
name|att2
index|[
name|i
index|]
operator|)
condition|)
name|i
operator|++
expr_stmt|;
name|count1
operator|=
name|i
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|count1
operator|==
literal|1
operator|)
operator|&&
operator|(
name|count2
operator|==
literal|1
operator|)
condition|)
name|count1
operator|=
literal|0
expr_stmt|;
comment|/* both lines blank	*/
elseif|else
if|if
condition|(
name|count2
operator|==
name|count1
condition|)
name|count1
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* equal		*/
else|else
name|count1
operator|=
name|count2
operator|/
name|count1
expr_stmt|;
comment|/* lines unequal	*/
return|return
operator|(
name|count1
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|_line
modifier|*
name|Insert_line
parameter_list|(
name|row
parameter_list|,
name|end_row
parameter_list|,
name|window
parameter_list|)
comment|/* insert line into screen */
name|int
name|row
decl_stmt|;
name|int
name|end_row
decl_stmt|;
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp1
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|curscr
operator|->
name|first_line
init|;
name|i
operator|<
name|window
operator|->
name|SR
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
operator|(
name|end_row
operator|+
name|window
operator|->
name|SR
operator|)
operator|==
literal|0
condition|)
name|curscr
operator|->
name|first_line
operator|=
name|curscr
operator|->
name|first_line
operator|->
name|next_screen
expr_stmt|;
name|top_of_win
operator|=
name|tmp
expr_stmt|;
comment|/* 	 |	find bottom line to delete 	 */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|top_of_win
init|;
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|i
operator|<
name|end_row
operator|)
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
name|tmp1
operator|=
name|tmp
expr_stmt|;
comment|/* 	 |	clear deleted line 	 */
name|clear_line
argument_list|(
name|tmp
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
name|tmp1
operator|->
name|number
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|curscr
operator|->
name|first_line
init|;
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|i
operator|<
name|window
operator|->
name|SR
operator|)
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|top_of_win
operator|=
name|tmp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|top_of_win
init|;
name|i
operator|<
name|row
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|window
operator|->
name|Num_lines
operator|>
literal|0
operator|)
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp1
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
name|tmp
operator|->
name|prev_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp1
operator|->
name|next_screen
operator|=
name|tmp
expr_stmt|;
if|if
condition|(
operator|(
name|row
operator|+
name|window
operator|->
name|SR
operator|)
operator|==
literal|0
condition|)
name|curscr
operator|->
name|first_line
operator|=
name|tmp1
expr_stmt|;
if|if
condition|(
name|tmp1
operator|->
name|next_screen
operator|!=
name|NULL
condition|)
name|tmp1
operator|=
name|tmp1
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|String_table
index|[
name|cs__
index|]
operator|)
operator|&&
operator|(
name|end_row
operator|<
name|window
operator|->
name|Num_lines
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
operator|(
name|window
operator|->
name|SR
operator|+
name|end_row
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|dl__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|Position
argument_list|(
name|window
argument_list|,
operator|(
name|window
operator|->
name|SR
operator|+
name|row
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|al__
index|]
operator|!=
name|NULL
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|al__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|String_Out
argument_list|(
name|String_table
index|[
name|sr__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|top_of_win
operator|=
name|curscr
operator|->
name|first_line
init|;
operator|(
name|top_of_win
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|i
operator|<
name|window
operator|->
name|SR
operator|)
condition|;
name|i
operator|++
control|)
name|top_of_win
operator|=
name|top_of_win
operator|->
name|next_screen
expr_stmt|;
return|return
operator|(
name|tmp1
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|_line
modifier|*
name|Delete_line
parameter_list|(
name|row
parameter_list|,
name|end_row
parameter_list|,
name|window
parameter_list|)
comment|/* delete a line on screen */
name|int
name|row
decl_stmt|;
name|int
name|end_row
decl_stmt|;
name|WINDOW
modifier|*
name|window
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp1
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp2
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|curscr
operator|->
name|first_line
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|window
operator|->
name|SR
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
block|}
comment|/* 	 |	find line to delete 	 */
name|top_of_win
operator|=
name|tmp
expr_stmt|;
if|if
condition|(
operator|(
name|row
operator|+
name|window
operator|->
name|SR
operator|)
operator|==
literal|0
condition|)
name|curscr
operator|->
name|first_line
operator|=
name|top_of_win
operator|->
name|next_screen
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|top_of_win
init|;
name|i
operator|<
name|row
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
condition|)
name|tmp
operator|->
name|next_screen
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
name|tmp2
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|tmp1
operator|=
name|tmp
expr_stmt|;
comment|/* 	 |	clear deleted line 	 */
name|clear_line
argument_list|(
name|tmp1
argument_list|,
literal|0
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
name|tmp1
operator|->
name|number
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* 	 |	find location to insert deleted line 	 */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|curscr
operator|->
name|first_line
init|;
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|i
operator|<
name|window
operator|->
name|SR
operator|)
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|top_of_win
operator|=
name|tmp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|tmp
operator|=
name|top_of_win
init|;
operator|(
name|i
operator|<
name|end_row
operator|)
operator|&&
operator|(
name|tmp
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
condition|;
name|i
operator|++
control|)
name|tmp
operator|=
name|tmp
operator|->
name|next_screen
expr_stmt|;
name|tmp1
operator|->
name|next_screen
operator|=
name|tmp
expr_stmt|;
name|tmp1
operator|->
name|prev_screen
operator|=
name|tmp
operator|->
name|prev_screen
expr_stmt|;
if|if
condition|(
name|tmp1
operator|->
name|prev_screen
operator|!=
name|NULL
condition|)
name|tmp1
operator|->
name|prev_screen
operator|->
name|next_screen
operator|=
name|tmp1
expr_stmt|;
name|tmp
operator|->
name|prev_screen
operator|=
name|tmp1
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
operator|(
name|window
operator|->
name|SR
operator|+
name|row
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|dl__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|String_table
index|[
name|cs__
index|]
operator|)
operator|&&
operator|(
name|end_row
operator|<
name|window
operator|->
name|Num_lines
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
operator|(
name|window
operator|->
name|SR
operator|+
name|end_row
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|al__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|String_table
index|[
name|cs__
index|]
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|String_table
index|[
name|dl__
index|]
operator|==
name|NULL
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
operator|(
name|window
operator|->
name|SR
operator|+
name|end_row
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|row
operator|==
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
condition|)
name|tmp2
operator|=
name|tmp1
expr_stmt|;
if|if
condition|(
operator|(
name|row
operator|+
name|window
operator|->
name|SR
operator|)
operator|==
literal|0
condition|)
name|curscr
operator|->
name|first_line
operator|=
name|top_of_win
operator|=
name|tmp2
expr_stmt|;
return|return
operator|(
name|tmp2
operator|)
return|;
block|}
end_function

begin_function
name|void
name|CLEAR_TO_EOL
parameter_list|(
name|window
parameter_list|,
name|row
parameter_list|,
name|column
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|row
decl_stmt|,
name|column
decl_stmt|;
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|struct
name|_line
modifier|*
name|tmp1
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
operator|,
name|tmp1
operator|=
name|curscr
operator|->
name|first_line
init|;
operator|(
name|y
operator|<
operator|(
name|window
operator|->
name|SR
operator|+
name|row
operator|)
operator|)
operator|&&
operator|(
name|tmp1
operator|->
name|next_screen
operator|!=
name|NULL
operator|)
condition|;
name|y
operator|++
control|)
name|tmp1
operator|=
name|tmp1
operator|->
name|next_screen
expr_stmt|;
for|for
control|(
name|x
operator|=
name|column
init|;
name|x
operator|<
name|window
operator|->
name|Num_cols
condition|;
name|x
operator|++
control|)
block|{
name|tmp1
operator|->
name|row
index|[
name|x
index|]
operator|=
literal|' '
expr_stmt|;
name|tmp1
operator|->
name|attributes
index|[
name|x
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
block|}
name|tmp1
operator|->
name|row
index|[
name|column
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp1
operator|->
name|last_char
operator|=
name|column
expr_stmt|;
if|if
condition|(
name|column
operator|<
name|COLS
condition|)
block|{
if|if
condition|(
name|STAND
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
name|row
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|String_table
index|[
name|ce__
index|]
operator|!=
name|NULL
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|ce__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
for|for
control|(
name|x
operator|=
name|column
init|;
name|x
operator|<
name|window
operator|->
name|Num_cols
condition|;
name|x
operator|++
control|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|Curr_x
operator|=
name|x
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|int
name|check_delete
parameter_list|(
name|window
parameter_list|,
name|line
parameter_list|,
name|offset
parameter_list|,
name|pointer_new
parameter_list|,
name|pointer_old
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|line
decl_stmt|,
name|offset
decl_stmt|;
name|struct
name|_line
modifier|*
name|pointer_new
decl_stmt|,
decl|*
name|pointer_old
decl_stmt|;
end_function

begin_block
block|{
name|int
name|end_old
decl_stmt|;
name|int
name|end_new
decl_stmt|;
name|int
name|k
decl_stmt|;
name|int
name|changed
decl_stmt|;
name|char
modifier|*
name|old_lin
decl_stmt|;
name|char
modifier|*
name|new_lin
decl_stmt|;
name|char
modifier|*
name|old_att
decl_stmt|;
name|char
modifier|*
name|new_att
decl_stmt|;
name|changed
operator|=
name|FALSE
expr_stmt|;
name|new_lin
operator|=
name|pointer_new
operator|->
name|row
expr_stmt|;
name|new_att
operator|=
name|pointer_new
operator|->
name|attributes
expr_stmt|;
name|old_lin
operator|=
name|pointer_old
operator|->
name|row
expr_stmt|;
name|old_att
operator|=
name|pointer_old
operator|->
name|attributes
expr_stmt|;
name|end_old
operator|=
name|end_new
operator|=
name|offset
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|new_lin
index|[
name|end_new
index|]
operator|!=
name|old_lin
index|[
name|end_old
index|]
operator|)
operator|||
operator|(
name|new_att
index|[
name|end_new
index|]
operator|!=
name|old_att
index|[
name|end_old
index|]
operator|)
operator|)
operator|&&
operator|(
name|old_lin
index|[
name|end_old
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|new_lin
index|[
name|end_old
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|end_old
operator|++
expr_stmt|;
if|if
condition|(
name|old_lin
index|[
name|end_old
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|k
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|old_lin
index|[
name|end_old
operator|+
name|k
index|]
operator|==
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|)
operator|&&
operator|(
name|new_att
index|[
name|end_new
operator|+
name|k
index|]
operator|==
name|old_att
index|[
name|end_old
operator|+
name|k
index|]
operator|)
operator|&&
operator|(
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|old_lin
index|[
name|end_old
operator|+
name|k
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|k
operator|<
literal|10
operator|)
condition|)
name|k
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|k
operator|>
literal|8
operator|)
operator|||
operator|(
operator|(
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|k
operator|!=
literal|0
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|line
argument_list|,
operator|(
name|end_new
operator|+
name|k
operator|)
argument_list|)
expr_stmt|;
name|CLEAR_TO_EOL
argument_list|(
name|window
argument_list|,
name|line
argument_list|,
operator|(
name|end_new
operator|+
name|k
operator|)
argument_list|)
expr_stmt|;
block|}
name|Position
argument_list|(
name|window
argument_list|,
name|line
argument_list|,
name|offset
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
name|offset
init|;
name|k
operator|<
name|end_old
condition|;
name|k
operator|++
control|)
name|Char_del
argument_list|(
name|old_lin
argument_list|,
name|old_att
argument_list|,
name|offset
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|old_lin
index|[
name|offset
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|offset
operator|<
name|COLS
operator|)
condition|)
name|offset
operator|++
expr_stmt|;
name|pointer_old
operator|->
name|last_char
operator|=
name|offset
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
return|return
operator|(
name|changed
operator|)
return|;
block|}
end_block

begin_comment
comment|/*  |	Check if characters were inserted in the middle of a line, and if   |	so, insert them.  */
end_comment

begin_function
name|int
name|check_insert
parameter_list|(
name|window
parameter_list|,
name|line
parameter_list|,
name|offset
parameter_list|,
name|pointer_new
parameter_list|,
name|pointer_old
parameter_list|)
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|line
decl_stmt|,
name|offset
decl_stmt|;
name|struct
name|_line
modifier|*
name|pointer_new
decl_stmt|,
decl|*
name|pointer_old
decl_stmt|;
end_function

begin_block
block|{
name|int
name|changed
decl_stmt|;
name|int
name|end_old
decl_stmt|,
name|end_new
decl_stmt|;
name|int
name|k
decl_stmt|;
name|int
name|same
init|=
name|FALSE
decl_stmt|;
name|int
name|old_off
decl_stmt|;
name|int
name|insert
decl_stmt|;
name|char
modifier|*
name|old_lin
decl_stmt|;
name|char
modifier|*
name|new_lin
decl_stmt|;
name|char
modifier|*
name|old_att
decl_stmt|;
name|char
modifier|*
name|new_att
decl_stmt|;
name|changed
operator|=
name|FALSE
expr_stmt|;
name|new_lin
operator|=
name|pointer_new
operator|->
name|row
expr_stmt|;
name|new_att
operator|=
name|pointer_new
operator|->
name|attributes
expr_stmt|;
name|old_lin
operator|=
name|pointer_old
operator|->
name|row
expr_stmt|;
name|old_att
operator|=
name|pointer_old
operator|->
name|attributes
expr_stmt|;
name|end_old
operator|=
name|end_new
operator|=
name|offset
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|new_lin
index|[
name|end_new
index|]
operator|!=
name|old_lin
index|[
name|end_old
index|]
operator|)
operator|||
operator|(
name|new_att
index|[
name|end_new
index|]
operator|!=
name|old_att
index|[
name|end_old
index|]
operator|)
operator|)
operator|&&
operator|(
name|new_lin
index|[
name|end_new
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|old_lin
index|[
name|end_new
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|end_new
operator|++
expr_stmt|;
if|if
condition|(
name|new_lin
index|[
name|end_new
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|k
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|old_lin
index|[
name|end_old
operator|+
name|k
index|]
operator|==
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|)
operator|&&
operator|(
name|old_att
index|[
name|end_old
operator|+
name|k
index|]
operator|==
name|new_att
index|[
name|end_new
operator|+
name|k
index|]
operator|)
operator|&&
operator|(
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|old_lin
index|[
name|end_old
operator|+
name|k
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|k
operator|<
literal|10
operator|)
condition|)
name|k
operator|++
expr_stmt|;
comment|/* 		 |  check for commonality between rest of lines (are the old  		 |  and new lines the same, except for a chunk in the middle?) 		 |  if the rest of the lines are common, do not insert text 		 */
name|old_off
operator|=
name|end_new
expr_stmt|;
while|while
condition|(
operator|(
name|old_lin
index|[
name|old_off
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|new_lin
index|[
name|old_off
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|old_lin
index|[
name|old_off
index|]
operator|==
name|new_lin
index|[
name|old_off
index|]
operator|)
operator|&&
operator|(
name|old_att
index|[
name|old_off
index|]
operator|==
name|new_att
index|[
name|old_off
index|]
operator|)
condition|)
name|old_off
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|old_lin
index|[
name|old_off
index|]
operator|==
name|new_lin
index|[
name|old_off
index|]
operator|)
operator|&&
operator|(
name|old_att
index|[
name|old_off
index|]
operator|==
name|new_att
index|[
name|old_off
index|]
operator|)
condition|)
name|same
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|same
operator|)
operator|&&
operator|(
operator|(
name|k
operator|>
literal|8
operator|)
operator|||
operator|(
operator|(
name|new_lin
index|[
name|end_new
operator|+
name|k
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|k
operator|!=
literal|0
operator|)
operator|)
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|line
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|insert
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|ic__
index|]
operator|==
name|NULL
condition|)
block|{
name|String_Out
argument_list|(
name|String_table
index|[
name|im__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|insert
operator|=
name|TRUE
expr_stmt|;
block|}
for|for
control|(
name|k
operator|=
name|offset
init|;
name|k
operator|<
name|end_new
condition|;
name|k
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|insert
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|ic__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Char_ins
argument_list|(
name|old_lin
argument_list|,
name|old_att
argument_list|,
name|new_lin
index|[
name|k
index|]
argument_list|,
name|new_att
index|[
name|k
index|]
argument_list|,
name|k
argument_list|,
name|window
operator|->
name|Num_cols
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|insert
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|ei__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|old_lin
index|[
name|offset
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|offset
operator|<
name|COLS
operator|)
condition|)
name|offset
operator|++
expr_stmt|;
name|pointer_old
operator|->
name|last_char
operator|=
name|offset
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
return|return
operator|(
name|changed
operator|)
return|;
block|}
end_block

begin_function
name|void
name|doupdate
parameter_list|()
block|{
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|similar
decl_stmt|;
name|int
name|diff
decl_stmt|;
name|int
name|begin_old
decl_stmt|,
name|begin_new
decl_stmt|;
name|int
name|end_old
decl_stmt|,
name|end_new
decl_stmt|;
name|int
name|count1
decl_stmt|,
name|j
decl_stmt|;
name|int
name|from_top
decl_stmt|,
name|tmp_ft
decl_stmt|,
name|offset
decl_stmt|;
name|int
name|changed
decl_stmt|;
name|int
name|first_time
decl_stmt|;
name|int
name|first_same
decl_stmt|;
name|int
name|last_same
decl_stmt|;
name|int
name|list
index|[
literal|10
index|]
decl_stmt|;
name|struct
name|_line
modifier|*
name|curr
decl_stmt|;
name|struct
name|_line
modifier|*
name|virt
decl_stmt|;
name|struct
name|_line
modifier|*
name|old
decl_stmt|;
name|struct
name|_line
modifier|*
name|new
decl_stmt|;
name|char
modifier|*
name|cur_lin
decl_stmt|;
name|char
modifier|*
name|vrt_lin
decl_stmt|;
name|char
modifier|*
name|cur_att
decl_stmt|;
name|char
modifier|*
name|vrt_att
decl_stmt|;
name|char
modifier|*
name|att1
decl_stmt|,
modifier|*
name|att2
decl_stmt|;
name|char
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|char
name|NC_chinese
init|=
name|FALSE
decl_stmt|;
comment|/* flag to indicate handling Chinese */
name|window
operator|=
name|virtual_scr
expr_stmt|;
if|if
condition|(
operator|(
name|nc_attributes
operator|&
name|A_NC_BIG5
operator|)
operator|!=
literal|0
condition|)
name|NC_chinese
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|Repaint_screen
condition|)
block|{
if|if
condition|(
name|String_table
index|[
name|cl__
index|]
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|cl__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
name|from_top
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|from_top
operator|<
name|LINES
condition|)
block|{
name|Position
argument_list|(
name|curscr
argument_list|,
name|from_top
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|String_table
index|[
name|ce__
index|]
operator|!=
name|NULL
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|ce__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|window
operator|->
name|Num_cols
condition|;
name|j
operator|++
control|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
name|from_top
operator|++
expr_stmt|;
block|}
block|}
for|for
control|(
name|from_top
operator|=
literal|0
operator|,
name|curr
operator|=
name|curscr
operator|->
name|first_line
init|;
name|from_top
operator|<
name|curscr
operator|->
name|Num_lines
condition|;
name|from_top
operator|++
operator|,
name|curr
operator|=
name|curr
operator|->
name|next_screen
control|)
block|{
name|Position
argument_list|(
name|curscr
argument_list|,
name|from_top
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
operator|(
name|curr
operator|->
name|row
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|j
operator|<
name|curscr
operator|->
name|Num_cols
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|Char_out
argument_list|(
name|curr
operator|->
name|row
index|[
name|j
index|]
argument_list|,
name|curr
operator|->
name|attributes
index|[
name|j
index|]
argument_list|,
name|curr
operator|->
name|row
argument_list|,
name|curr
operator|->
name|attributes
argument_list|,
name|j
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|STAND
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|Position
argument_list|(
name|curscr
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
block|}
name|Repaint_screen
operator|=
name|FALSE
expr_stmt|;
block|}
name|similar
operator|=
literal|0
expr_stmt|;
name|diff
operator|=
name|FALSE
expr_stmt|;
name|top_of_win
operator|=
name|curscr
operator|->
name|first_line
expr_stmt|;
for|for
control|(
name|from_top
operator|=
literal|0
operator|,
name|curr
operator|=
name|top_of_win
operator|,
name|virt
operator|=
name|window
operator|->
name|first_line
init|;
name|from_top
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|from_top
operator|++
control|)
block|{
name|virtual_lines
index|[
name|from_top
index|]
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|similar
operator|=
name|Comp_line
argument_list|(
name|curr
argument_list|,
name|virt
argument_list|)
operator|)
operator|>
literal|0
condition|)
block|{
name|virtual_lines
index|[
name|from_top
index|]
operator|=
name|FALSE
expr_stmt|;
name|diff
operator|=
name|TRUE
expr_stmt|;
block|}
name|curr
operator|=
name|curr
operator|->
name|next_screen
expr_stmt|;
name|virt
operator|=
name|virt
operator|->
name|next_screen
expr_stmt|;
block|}
name|from_top
operator|=
literal|0
expr_stmt|;
name|virt
operator|=
name|window
operator|->
name|first_line
expr_stmt|;
name|curr
operator|=
name|top_of_win
expr_stmt|;
name|similar
operator|=
literal|0
expr_stmt|;
comment|/* 	 |  if the window has lines that are different, check for scrolling 	 */
if|if
condition|(
name|diff
condition|)
block|{
name|last_same
operator|=
operator|-
literal|1
expr_stmt|;
name|changed
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|first_same
operator|=
name|window
operator|->
name|Num_lines
init|;
operator|(
name|first_same
operator|>
name|from_top
operator|)
operator|&&
operator|(
name|virtual_lines
index|[
name|first_same
operator|-
literal|1
index|]
operator|)
condition|;
name|first_same
operator|--
control|)
empty_stmt|;
name|count1
operator|=
name|first_same
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|last_same
operator|=
literal|0
init|;
operator|(
name|last_same
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
name|virtual_lines
index|[
name|last_same
index|]
operator|==
name|FALSE
operator|)
condition|;
name|last_same
operator|++
control|)
empty_stmt|;
while|while
condition|(
operator|(
name|from_top
operator|<
name|first_same
operator|)
operator|&&
name|nc_scrolling_ability
condition|)
comment|/* check entire lines for diffs	*/
block|{
if|if
condition|(
name|from_top
operator|>=
name|last_same
condition|)
block|{
for|for
control|(
name|last_same
operator|=
name|from_top
init|;
operator|(
name|last_same
operator|<
name|window
operator|->
name|Num_lines
operator|)
operator|&&
operator|(
name|virtual_lines
index|[
name|last_same
index|]
operator|==
name|FALSE
operator|)
condition|;
name|last_same
operator|++
control|)
empty_stmt|;
block|}
if|if
condition|(
operator|!
name|virtual_lines
index|[
name|from_top
index|]
condition|)
block|{
name|diff
operator|=
name|TRUE
expr_stmt|;
comment|/* 				 |	check for lines deleted (scroll up) 				 */
for|for
control|(
name|tmp_ft
operator|=
name|from_top
operator|+
literal|1
operator|,
name|old
operator|=
name|curr
operator|->
name|next_screen
init|;
operator|(
operator|(
name|window
operator|->
name|scroll_up
operator|)
operator|&&
operator|(
name|diff
operator|)
operator|&&
operator|(
name|tmp_ft
operator|<
name|last_same
operator|)
operator|&&
operator|(
operator|!
name|virtual_lines
index|[
name|tmp_ft
index|]
operator|)
operator|)
condition|;
name|tmp_ft
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|Comp_line
argument_list|(
name|old
argument_list|,
name|virt
argument_list|)
operator|==
operator|-
literal|1
operator|)
operator|&&
operator|(
operator|!
name|virtual_lines
index|[
name|from_top
index|]
operator|)
condition|)
block|{
if|if
condition|(
name|String_table
index|[
name|cs__
index|]
condition|)
comment|/* scrolling region */
block|{
name|list
index|[
literal|1
index|]
operator|=
name|from_top
expr_stmt|;
name|list
index|[
literal|0
index|]
operator|=
name|min
argument_list|(
operator|(
name|last_same
operator|-
literal|1
operator|)
argument_list|,
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|cs__
index|]
argument_list|,
name|list
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|Curr_y
operator|=
name|Curr_x
operator|=
operator|-
literal|1
expr_stmt|;
block|}
for|for
control|(
name|offset
operator|=
operator|(
name|tmp_ft
operator|-
name|from_top
operator|)
init|;
operator|(
name|offset
operator|>
literal|0
operator|)
condition|;
name|offset
operator|--
control|)
block|{
name|old
operator|=
name|Delete_line
argument_list|(
name|from_top
argument_list|,
name|min
argument_list|(
operator|(
name|last_same
operator|-
literal|1
operator|)
argument_list|,
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|diff
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|String_table
index|[
name|cs__
index|]
condition|)
comment|/* scrolling region */
block|{
name|list
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|list
index|[
literal|0
index|]
operator|=
name|LINES
operator|-
literal|1
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|cs__
index|]
argument_list|,
name|list
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|Curr_y
operator|=
name|Curr_x
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|top_of_win
operator|=
name|curscr
operator|->
name|first_line
expr_stmt|;
name|curr
operator|=
name|top_of_win
expr_stmt|;
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
name|from_top
condition|;
name|offset
operator|++
control|)
name|curr
operator|=
name|curr
operator|->
name|next_screen
expr_stmt|;
for|for
control|(
name|offset
operator|=
name|from_top
operator|,
name|old
operator|=
name|curr
operator|,
name|new
operator|=
name|virt
init|;
name|offset
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|old
operator|=
name|old
operator|->
name|next_screen
operator|,
name|new
operator|=
name|new
operator|->
name|next_screen
operator|,
name|offset
operator|++
control|)
block|{
name|similar
operator|=
name|Comp_line
argument_list|(
name|old
argument_list|,
name|new
argument_list|)
expr_stmt|;
name|virtual_lines
index|[
name|offset
index|]
operator|=
operator|(
name|similar
operator|>
literal|0
condition|?
name|FALSE
else|:
name|TRUE
operator|)
expr_stmt|;
block|}
block|}
else|else
name|old
operator|=
name|old
operator|->
name|next_screen
expr_stmt|;
block|}
comment|/* 				 |	check for lines inserted (scroll down) 				 */
for|for
control|(
name|tmp_ft
operator|=
name|from_top
operator|-
literal|1
operator|,
name|old
operator|=
name|curr
operator|->
name|prev_screen
init|;
operator|(
operator|(
name|window
operator|->
name|scroll_down
operator|)
operator|&&
operator|(
name|tmp_ft
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|diff
operator|)
operator|&&
operator|(
operator|!
name|virtual_lines
index|[
name|tmp_ft
index|]
operator|)
operator|)
condition|;
name|tmp_ft
operator|--
control|)
block|{
if|if
condition|(
name|Comp_line
argument_list|(
name|old
argument_list|,
name|virt
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|String_table
index|[
name|cs__
index|]
condition|)
comment|/* scrolling region */
block|{
name|list
index|[
literal|1
index|]
operator|=
name|tmp_ft
expr_stmt|;
name|list
index|[
literal|0
index|]
operator|=
name|min
argument_list|(
operator|(
name|last_same
operator|-
literal|1
operator|)
argument_list|,
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|cs__
index|]
argument_list|,
name|list
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|Curr_y
operator|=
name|Curr_x
operator|=
operator|-
literal|1
expr_stmt|;
block|}
for|for
control|(
name|offset
operator|=
operator|(
name|from_top
operator|-
name|tmp_ft
operator|)
init|;
operator|(
name|offset
operator|>
literal|0
operator|)
condition|;
name|offset
operator|--
control|)
block|{
name|old
operator|=
name|Insert_line
argument_list|(
name|tmp_ft
argument_list|,
name|min
argument_list|(
operator|(
name|last_same
operator|-
literal|1
operator|)
argument_list|,
operator|(
name|window
operator|->
name|Num_lines
operator|-
literal|1
operator|)
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|diff
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|String_table
index|[
name|cs__
index|]
condition|)
comment|/* scrolling region */
block|{
name|list
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|list
index|[
literal|0
index|]
operator|=
name|LINES
operator|-
literal|1
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|cs__
index|]
argument_list|,
name|list
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|Curr_y
operator|=
name|Curr_x
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|top_of_win
operator|=
name|curscr
operator|->
name|first_line
expr_stmt|;
name|curr
operator|=
name|top_of_win
expr_stmt|;
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
name|from_top
condition|;
name|offset
operator|++
control|)
name|curr
operator|=
name|curr
operator|->
name|next_screen
expr_stmt|;
for|for
control|(
name|offset
operator|=
name|from_top
operator|,
name|old
operator|=
name|curr
operator|,
name|new
operator|=
name|virt
init|;
name|offset
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|old
operator|=
name|old
operator|->
name|next_screen
operator|,
name|new
operator|=
name|new
operator|->
name|next_screen
operator|,
name|offset
operator|++
control|)
block|{
name|similar
operator|=
name|Comp_line
argument_list|(
name|old
argument_list|,
name|new
argument_list|)
expr_stmt|;
name|virtual_lines
index|[
name|offset
index|]
operator|=
operator|(
name|similar
operator|>
literal|0
condition|?
name|FALSE
else|:
name|TRUE
operator|)
expr_stmt|;
block|}
block|}
else|else
name|old
operator|=
name|old
operator|->
name|prev_screen
expr_stmt|;
block|}
block|}
name|from_top
operator|++
expr_stmt|;
name|curr
operator|=
name|curr
operator|->
name|next_screen
expr_stmt|;
name|virt
operator|=
name|virt
operator|->
name|next_screen
expr_stmt|;
block|}
block|}
comment|/* 	 |	Scrolling done, now need to insert, delete, or modify text  	 |	within lines. 	 */
for|for
control|(
name|from_top
operator|=
literal|0
operator|,
name|curr
operator|=
name|curscr
operator|->
name|first_line
init|;
name|from_top
operator|<
name|window
operator|->
name|SR
condition|;
name|from_top
operator|++
control|)
name|curr
operator|=
name|curr
operator|->
name|next_screen
expr_stmt|;
name|top_of_win
operator|=
name|curr
expr_stmt|;
for|for
control|(
name|from_top
operator|=
literal|0
operator|,
name|curr
operator|=
name|top_of_win
operator|,
name|virt
operator|=
name|window
operator|->
name|first_line
init|;
name|from_top
operator|<
name|window
operator|->
name|Num_lines
condition|;
name|from_top
operator|++
operator|,
name|curr
operator|=
name|curr
operator|->
name|next_screen
operator|,
name|virt
operator|=
name|virt
operator|->
name|next_screen
control|)
block|{
comment|/* 		 |	If either 'insert mode' or 'insert char' are  		 |	available, enter the following 'if' statement,  		 |	else, need to simply rewrite the contents of the line 		 |	at the point where the contents of the line change. 		 */
if|if
condition|(
operator|(
operator|(
name|String_table
index|[
name|ic__
index|]
operator|)
operator|||
operator|(
name|String_table
index|[
name|im__
index|]
operator|)
operator|)
operator|&&
operator|(
name|String_table
index|[
name|dc__
index|]
operator|)
operator|&&
operator|(
name|curr
operator|->
name|row
index|[
literal|0
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|!
name|NC_chinese
operator|)
condition|)
block|{
name|j
operator|=
literal|0
expr_stmt|;
name|first_time
operator|=
name|TRUE
expr_stmt|;
name|vrt_lin
operator|=
name|virt
operator|->
name|row
expr_stmt|;
name|vrt_att
operator|=
name|virt
operator|->
name|attributes
expr_stmt|;
name|cur_lin
operator|=
name|curr
operator|->
name|row
expr_stmt|;
name|cur_att
operator|=
name|curr
operator|->
name|attributes
expr_stmt|;
while|while
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|STAND
operator|)
operator|&&
operator|(
name|Booleans
index|[
name|xs__
index|]
operator|)
condition|)
block|{
while|while
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|==
name|cur_lin
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|vrt_att
index|[
name|j
index|]
operator|==
name|cur_att
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|vrt_att
index|[
name|j
index|]
operator|)
condition|)
name|j
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|STAND
operator|)
operator|&&
operator|(
operator|!
name|vrt_att
index|[
name|j
index|]
operator|)
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|==
name|cur_lin
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|vrt_att
index|[
name|j
index|]
operator|==
name|cur_att
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|vrt_att
index|[
name|j
index|]
operator|!=
name|cur_att
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|cur_att
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|Booleans
index|[
name|xs__
index|]
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
comment|/*					CLEAR_TO_EOL(window, from_top, j);*/
name|attribute_off
argument_list|()
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|vrt_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|begin_new
operator|=
name|j
expr_stmt|;
name|begin_old
operator|=
name|j
expr_stmt|;
name|end_old
operator|=
name|j
expr_stmt|;
name|end_new
operator|=
name|j
expr_stmt|;
if|if
condition|(
operator|(
name|first_time
operator|)
operator|&&
operator|(
name|virt
operator|->
name|changed
operator|)
condition|)
block|{
if|if
condition|(
name|curr
operator|->
name|last_char
operator|<=
name|virt
operator|->
name|last_char
condition|)
name|changed
operator|=
name|check_insert
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|,
name|virt
argument_list|,
name|curr
argument_list|)
expr_stmt|;
block|}
name|changed
operator|=
name|check_delete
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|,
name|virt
argument_list|,
name|curr
argument_list|)
expr_stmt|;
name|first_time
operator|=
name|FALSE
expr_stmt|;
name|virt
operator|->
name|changed
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|changed
condition|)
name|changed
operator|=
name|check_insert
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|,
name|virt
argument_list|,
name|curr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
operator|!
name|changed
operator|)
operator|||
operator|(
name|cur_lin
index|[
name|j
index|]
operator|!=
name|vrt_lin
index|[
name|j
index|]
operator|)
operator|||
operator|(
name|cur_att
index|[
name|j
index|]
operator|!=
name|vrt_att
index|[
name|j
index|]
operator|)
operator|)
operator|&&
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|==
literal|' '
operator|)
operator|&&
operator|(
name|cur_lin
index|[
name|j
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|vrt_att
index|[
name|j
index|]
operator|==
name|cur_att
index|[
name|j
index|]
operator|)
condition|)
name|cur_lin
index|[
name|j
index|]
operator|=
literal|' '
expr_stmt|;
else|else
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|Char_out
argument_list|(
name|vrt_lin
index|[
name|j
index|]
argument_list|,
name|vrt_att
index|[
name|j
index|]
argument_list|,
name|cur_lin
argument_list|,
name|cur_att
argument_list|,
name|j
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|j
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|STAND
operator|)
operator|&&
operator|(
operator|!
name|vrt_att
index|[
name|j
index|]
operator|)
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|vrt_lin
index|[
name|j
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|cur_lin
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|CLEAR_TO_EOL
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
block|}
block|}
else|else
comment|/*if ((similar != -1)&& (similar != 0))*/
block|{
name|j
operator|=
literal|0
expr_stmt|;
name|c1
operator|=
name|curr
operator|->
name|row
expr_stmt|;
name|att1
operator|=
name|curr
operator|->
name|attributes
expr_stmt|;
name|c2
operator|=
name|virt
operator|->
name|row
expr_stmt|;
name|att2
operator|=
name|virt
operator|->
name|attributes
expr_stmt|;
while|while
condition|(
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
operator|&&
operator|(
name|c2
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
while|while
condition|(
operator|(
name|c1
index|[
name|j
index|]
operator|==
name|c2
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|att1
index|[
name|j
index|]
operator|==
name|att2
index|[
name|j
index|]
operator|)
operator|&&
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
operator|&&
operator|(
name|c2
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|j
operator|++
expr_stmt|;
comment|/* 				 |	if previous character is an eight bit  				 |	char, start redraw from that character 				 */
if|if
condition|(
operator|(
name|NC_chinese
operator|)
operator|&&
operator|(
name|highbitset
argument_list|(
name|c1
index|[
name|j
operator|-
literal|1
index|]
argument_list|)
operator|)
condition|)
name|j
operator|--
expr_stmt|;
name|begin_old
operator|=
name|j
expr_stmt|;
name|begin_new
operator|=
name|j
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
operator|&&
operator|(
name|c2
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|begin_old
argument_list|)
expr_stmt|;
name|CLEAR_TO_EOL
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|begin_old
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
name|begin_old
init|;
operator|(
name|c2
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|j
operator|<
name|window
operator|->
name|Num_cols
operator|)
condition|;
name|j
operator|++
control|)
name|Char_out
argument_list|(
name|c2
index|[
name|j
index|]
argument_list|,
name|att2
index|[
name|j
index|]
argument_list|,
name|c1
argument_list|,
name|att1
argument_list|,
name|j
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|c2
index|[
name|j
index|]
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|c1
index|[
name|j
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|CLEAR_TO_EOL
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|STAND
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|Position
argument_list|(
name|window
argument_list|,
name|from_top
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
name|virt
operator|->
name|number
operator|=
name|from_top
expr_stmt|;
block|}
name|Position
argument_list|(
name|window
argument_list|,
name|window
operator|->
name|LY
argument_list|,
name|window
operator|->
name|LX
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Position
parameter_list|(
name|window
parameter_list|,
name|row
parameter_list|,
name|col
parameter_list|)
comment|/* position the cursor for output on the screen	*/
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|int
name|row
decl_stmt|;
name|int
name|col
decl_stmt|;
block|{
name|int
name|list
index|[
literal|10
index|]
decl_stmt|;
name|int
name|place
decl_stmt|;
name|int
name|pos_row
decl_stmt|;
name|int
name|pos_column
decl_stmt|;
name|pos_row
operator|=
name|row
operator|+
name|window
operator|->
name|SR
expr_stmt|;
name|pos_column
operator|=
name|col
operator|+
name|window
operator|->
name|SC
expr_stmt|;
if|if
condition|(
operator|(
name|pos_row
operator|!=
name|Curr_y
operator|)
operator|||
operator|(
name|pos_column
operator|!=
name|Curr_x
operator|)
condition|)
block|{
if|if
condition|(
name|String_table
index|[
name|cm__
index|]
operator|!=
name|NULL
condition|)
comment|/*&& (row< window->Num_lines)&& (column< window->Num_cols))*/
block|{
name|place
operator|=
literal|0
expr_stmt|;
name|list
index|[
name|place
operator|++
index|]
operator|=
name|pos_column
expr_stmt|;
name|list
index|[
name|place
operator|++
index|]
operator|=
name|pos_row
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|cm__
index|]
argument_list|,
name|list
argument_list|,
name|place
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|STAND
operator|)
operator|&&
operator|(
operator|!
name|Booleans
index|[
name|ms__
index|]
operator|)
condition|)
name|attribute_on
argument_list|()
expr_stmt|;
block|}
name|Curr_x
operator|=
name|pos_column
expr_stmt|;
name|Curr_y
operator|=
name|pos_row
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|Char_del
parameter_list|(
name|line
parameter_list|,
name|attrib
parameter_list|,
name|offset
parameter_list|,
name|maxlen
parameter_list|)
comment|/* delete chars from line	*/
name|char
modifier|*
name|line
decl_stmt|;
name|char
modifier|*
name|attrib
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|maxlen
decl_stmt|;
block|{
name|int
name|one
decl_stmt|,
name|two
decl_stmt|;
for|for
control|(
name|one
operator|=
name|offset
operator|,
name|two
operator|=
name|offset
operator|+
literal|1
init|;
operator|(
name|line
index|[
name|one
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|one
operator|<
name|maxlen
operator|)
condition|;
name|one
operator|++
operator|,
name|two
operator|++
control|)
block|{
name|line
index|[
name|one
index|]
operator|=
name|line
index|[
name|two
index|]
expr_stmt|;
name|attrib
index|[
name|one
index|]
operator|=
name|attrib
index|[
name|two
index|]
expr_stmt|;
block|}
name|String_Out
argument_list|(
name|String_table
index|[
name|dc__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Char_ins
parameter_list|(
name|line
parameter_list|,
name|attrib
parameter_list|,
name|newc
parameter_list|,
name|newatt
parameter_list|,
name|offset
parameter_list|,
name|maxlen
parameter_list|)
comment|/* insert chars in line	*/
name|char
modifier|*
name|line
decl_stmt|;
name|char
modifier|*
name|attrib
decl_stmt|;
name|char
name|newc
decl_stmt|;
name|char
name|newatt
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|maxlen
decl_stmt|;
block|{
name|int
name|one
decl_stmt|,
name|two
decl_stmt|;
name|one
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|line
index|[
name|one
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|one
operator|<
operator|(
name|maxlen
operator|-
literal|2
operator|)
operator|)
condition|)
name|one
operator|++
expr_stmt|;
for|for
control|(
name|two
operator|=
name|one
operator|+
literal|1
init|;
operator|(
name|two
operator|>
name|offset
operator|)
condition|;
name|one
operator|--
operator|,
name|two
operator|--
control|)
block|{
name|line
index|[
name|two
index|]
operator|=
name|line
index|[
name|one
index|]
expr_stmt|;
name|attrib
index|[
name|two
index|]
operator|=
name|attrib
index|[
name|one
index|]
expr_stmt|;
block|}
name|line
index|[
name|offset
index|]
operator|=
name|newc
expr_stmt|;
name|attrib
index|[
name|offset
index|]
operator|=
name|newatt
expr_stmt|;
name|Char_out
argument_list|(
name|newc
argument_list|,
name|newatt
argument_list|,
name|line
argument_list|,
name|attrib
argument_list|,
name|offset
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|attribute_on
parameter_list|()
block|{
if|if
condition|(
name|String_table
index|[
name|sa__
index|]
condition|)
block|{
name|attributes_set
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|sa__
index|]
argument_list|,
name|attributes_set
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|String_table
index|[
name|so__
index|]
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|so__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|attribute_off
parameter_list|()
block|{
if|if
condition|(
name|String_table
index|[
name|me__
index|]
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|me__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|String_table
index|[
name|sa__
index|]
condition|)
block|{
name|attributes_set
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|String_Out
argument_list|(
name|String_table
index|[
name|sa__
index|]
argument_list|,
name|attributes_set
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|String_table
index|[
name|se__
index|]
condition|)
name|String_Out
argument_list|(
name|String_table
index|[
name|se__
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|Char_out
parameter_list|(
name|newc
parameter_list|,
name|newatt
parameter_list|,
name|line
parameter_list|,
name|attrib
parameter_list|,
name|offset
parameter_list|)
comment|/* output character with proper attribute	*/
name|char
name|newc
decl_stmt|;
name|char
name|newatt
decl_stmt|;
name|char
modifier|*
name|line
decl_stmt|;
name|char
modifier|*
name|attrib
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|newatt
operator|)
operator|&&
operator|(
operator|!
name|STAND
operator|)
condition|)
block|{
name|STAND
operator|=
name|TRUE
expr_stmt|;
name|attribute_on
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|STAND
operator|)
operator|&&
operator|(
operator|!
name|newatt
operator|)
condition|)
block|{
name|STAND
operator|=
name|FALSE
expr_stmt|;
name|attribute_off
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|newatt
operator|)
operator|&&
operator|(
name|STAND
operator|)
operator|&&
operator|(
name|Booleans
index|[
name|xs__
index|]
operator|)
condition|)
block|{
name|attribute_on
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|(
name|Curr_y
operator|>=
operator|(
name|LINES
operator|-
literal|1
operator|)
operator|)
operator|&&
operator|(
name|Curr_x
operator|>=
operator|(
name|COLS
operator|-
literal|1
operator|)
operator|)
operator|)
condition|)
block|{
name|putchar
argument_list|(
name|newc
argument_list|)
expr_stmt|;
name|line
index|[
name|offset
index|]
operator|=
name|newc
expr_stmt|;
name|attrib
index|[
name|offset
index|]
operator|=
name|newatt
expr_stmt|;
block|}
name|Curr_x
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  |  |	The two routines that follow, nc_setattrib(), nc_clearattrib(), are   |	hacks that notify new_curse to handle characters that have the high   |	bit set as the first of two bytes of a multi-byte string.  |  */
end_comment

begin_function
name|void
name|nc_setattrib
parameter_list|(
name|flag
parameter_list|)
name|int
name|flag
decl_stmt|;
block|{
name|nc_attributes
operator||=
name|flag
expr_stmt|;
block|}
end_function

begin_function
name|void
name|nc_clearattrib
parameter_list|(
name|flag
parameter_list|)
name|int
name|flag
decl_stmt|;
block|{
name|nc_attributes
operator|&=
operator|~
name|flag
expr_stmt|;
block|}
end_function

end_unit

