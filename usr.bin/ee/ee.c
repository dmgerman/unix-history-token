begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  |	ee (easy editor)  |  |	An easy to use, simple screen oriented editor.  |  |	written by Hugh Mahon  |  |	THIS MATERIAL IS PROVIDED "AS IS".  THERE ARE  |	NO WARRANTIES OF ANY KIND WITH REGARD TO THIS  |	MATERIAL, INCLUDING, BUT NOT LIMITED TO, THE  |	IMPLIED WARRANTIES OF MERCHANTABILITY AND  |	FITNESS FOR A PARTICULAR PURPOSE.  Neither  |	Hewlett-Packard nor Hugh Mahon shall be liable  |	for errors contained herein, nor for  |	incidental or consequential damages in  |	connection with the furnishing, performance or  |	use of this material.  Neither Hewlett-Packard  |	nor Hugh Mahon assumes any responsibility for  |	the use or reliability of this software or  |	documentation.  This software and  |	documentation is totally UNSUPPORTED.  There  |	is no support contract available.  Hewlett-  |	Packard has done NO Quality Assurance on ANY  |	of the program or documentation.  You may find  |	the quality of the materials inferior to  |	supported materials.  |  |	This software is not a product of Hewlett-Packard, Co., or any   |	other company.  No support is implied or offered with this software.  |	You've got the source, and you're on your own.  |  |	This software may be distributed under the terms of Larry Wall's   |	Artistic license, a copy of which is included in this distribution.   |  |	This notice must be included with this software and any derivatives.  |  |	This editor was purposely developed to be simple, both in   |	interface and implementation.  This editor was developed to   |	address a specific audience: the user who is new to computers   |	(especially UNIX).  |	  |	ee is not aimed at technical users; for that reason more   |	complex features were intentionally left out.  In addition,   |	ee is intended to be compiled by people with little computer   |	experience, which means that it needs to be small, relatively   |	simple in implementation, and portable.  |  |	This software and documentation contains  |	proprietary information which is protected by  |	copyright.  All rights are reserved.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$Id: ee.c,v 1.9 1998/01/12 07:51:07 charnier Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_decl_stmt
name|char
modifier|*
name|ee_copyright_message
init|=
literal|"Copyright (c) 1986, 1990, 1991, 1992, 1993, 1994, 1995, 1996 Hugh Mahon "
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ee_long_notice
index|[]
init|=
block|{
literal|"This software and documentation contains"
block|,
literal|"proprietary information which is protected by"
block|,
literal|"copyright.  All rights are reserved."
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|version
init|=
literal|"@(#) ee, version 1.3  $Revision: 1.9 $"
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|NCURSE
end_ifdef

begin_include
include|#
directive|include
file|"new_curse.h"
end_include

begin_elif
elif|#
directive|elif
name|HAS_NCURSES
end_elif

begin_include
include|#
directive|include
file|<ncurses.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<curses.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_CTYPE
end_ifdef

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_SYS_WAIT
end_ifdef

begin_include
include|#
directive|include
file|<sys/wait.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_STDARG
end_ifdef

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_STDLIB
end_ifdef

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAS_UNISTD
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|NO_CATGETS
end_ifndef

begin_include
include|#
directive|include
file|<locale.h>
end_include

begin_include
include|#
directive|include
file|<nl_types.h>
end_include

begin_decl_stmt
name|nl_catd
name|catalog
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|catgetlocal
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(b)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NO_CATGETS */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SIGCHLD
end_ifndef

begin_define
define|#
directive|define
name|SIGCHLD
value|SIGCLD
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|TAB
value|9
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(a> b ? a : b)
end_define

begin_define
define|#
directive|define
name|min
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(a< b ? a : b)
end_define

begin_comment
comment|/*  |	defines for type of data to show in info window  */
end_comment

begin_define
define|#
directive|define
name|CONTROL_KEYS
value|1
end_define

begin_define
define|#
directive|define
name|COMMANDS
value|2
end_define

begin_struct
struct|struct
name|text
block|{
name|char
modifier|*
name|line
decl_stmt|;
comment|/* line of characters		*/
name|int
name|line_number
decl_stmt|;
comment|/* line number			*/
name|int
name|line_length
decl_stmt|;
comment|/* actual number of characters in the line */
name|int
name|max_length
decl_stmt|;
comment|/* maximum number of characters the line handles */
name|struct
name|text
modifier|*
name|next_line
decl_stmt|;
comment|/* next line of text		*/
name|struct
name|text
modifier|*
name|prev_line
decl_stmt|;
comment|/* previous line of text	*/
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|text
modifier|*
name|first_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* first line of current buffer		*/
end_comment

begin_decl_stmt
name|struct
name|text
modifier|*
name|dlt_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* structure for info on deleted line	*/
end_comment

begin_decl_stmt
name|struct
name|text
modifier|*
name|curr_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current line cursor is on		*/
end_comment

begin_decl_stmt
name|struct
name|text
modifier|*
name|tmp_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary line pointer		*/
end_comment

begin_decl_stmt
name|struct
name|text
modifier|*
name|srch_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary pointer for search routine */
end_comment

begin_struct
struct|struct
name|files
block|{
comment|/* structure to store names of files to be edited*/
name|char
modifier|*
name|name
decl_stmt|;
comment|/* name of file				*/
name|struct
name|files
modifier|*
name|next_name
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|files
modifier|*
name|top_of_stack
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|d_wrd_len
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* length of deleted word		*/
end_comment

begin_decl_stmt
name|int
name|position
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* offset in bytes from begin of line	*/
end_comment

begin_decl_stmt
name|int
name|scr_pos
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* horizontal position			*/
end_comment

begin_decl_stmt
name|int
name|scr_vert
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* vertical position on screen		*/
end_comment

begin_decl_stmt
name|int
name|scr_horz
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* horizontal position on screen	*/
end_comment

begin_decl_stmt
name|int
name|tmp_vert
decl_stmt|,
name|tmp_horz
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|input_file
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* indicate to read input file		*/
end_comment

begin_decl_stmt
name|int
name|recv_file
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* indicate reading a file		*/
end_comment

begin_decl_stmt
name|int
name|edit
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* continue executing while true	*/
end_comment

begin_decl_stmt
name|int
name|gold
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 'gold' function key pressed		*/
end_comment

begin_decl_stmt
name|int
name|fildes
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file descriptor			*/
end_comment

begin_decl_stmt
name|int
name|case_sen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* case sensitive search flag		*/
end_comment

begin_decl_stmt
name|int
name|last_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* last line for text display		*/
end_comment

begin_decl_stmt
name|int
name|last_col
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* last column for text display		*/
end_comment

begin_decl_stmt
name|int
name|horiz_offset
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* offset from left edge of text	*/
end_comment

begin_decl_stmt
name|int
name|clear_com_win
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag to indicate com_win needs clearing */
end_comment

begin_decl_stmt
name|int
name|text_changes
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* indicate changes have been made to text */
end_comment

begin_decl_stmt
name|int
name|get_fd
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file descriptor for reading a file	*/
end_comment

begin_decl_stmt
name|int
name|info_window
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag to indicate if help window visible */
end_comment

begin_decl_stmt
name|int
name|info_type
init|=
name|CONTROL_KEYS
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag to indicate type of info to display */
end_comment

begin_decl_stmt
name|int
name|expand_tabs
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag for expanding tabs		*/
end_comment

begin_decl_stmt
name|int
name|right_margin
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the right margin 			*/
end_comment

begin_decl_stmt
name|int
name|observ_margins
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag for whether margins are observed */
end_comment

begin_decl_stmt
name|int
name|shell_fork
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|temp_stdin
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary storage for stdin		*/
end_comment

begin_decl_stmt
name|int
name|temp_stdout
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temp storage for stdout descriptor	*/
end_comment

begin_decl_stmt
name|int
name|temp_stderr
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temp storage for stderr descriptor	*/
end_comment

begin_decl_stmt
name|int
name|pipe_out
index|[
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pipe file desc for output		*/
end_comment

begin_decl_stmt
name|int
name|pipe_in
index|[
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pipe file descriptors for input	*/
end_comment

begin_decl_stmt
name|int
name|out_pipe
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag that info is piped out		*/
end_comment

begin_decl_stmt
name|int
name|in_pipe
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag that info is piped in		*/
end_comment

begin_decl_stmt
name|int
name|formatted
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag indicating paragraph formatted	*/
end_comment

begin_decl_stmt
name|int
name|auto_format
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag for auto_format mode		*/
end_comment

begin_decl_stmt
name|int
name|restricted
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag to indicate restricted mode	*/
end_comment

begin_decl_stmt
name|int
name|nohighlight
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* turns off highlighting		*/
end_comment

begin_decl_stmt
name|int
name|eightbit
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* eight bit character flag		*/
end_comment

begin_decl_stmt
name|int
name|local_LINES
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* copy of LINES, to detect when win resizes */
end_comment

begin_decl_stmt
name|int
name|local_COLS
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* copy of COLS, to detect when win resizes  */
end_comment

begin_decl_stmt
name|int
name|curses_initialized
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* flag indicating if curses has been started*/
end_comment

begin_decl_stmt
name|int
name|emacs_keys_mode
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* mode for if emacs key binings are used    */
end_comment

begin_decl_stmt
name|char
modifier|*
name|point
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* points to current position in line	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|srch_str
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pointer for search string		*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|u_srch_str
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pointer to non-case sensitive search	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|srch_1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pointer to start of suspect string	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|srch_2
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pointer to next character of string	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|srch_3
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|in_file_name
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* name of input file			*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|tmp_file
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary file name			*/
end_comment

begin_decl_stmt
name|char
name|d_char
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* deleted character			*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|d_word
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* deleted word				*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|d_line
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* deleted line				*/
end_comment

begin_decl_stmt
name|char
name|in_string
index|[
literal|513
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* buffer for reading a file		*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|print_command
init|=
literal|"lp"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* string to use for the print command 	*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|start_at_line
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* move to this line at start of session*/
end_comment

begin_decl_stmt
name|int
name|in
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* input character			*/
end_comment

begin_decl_stmt
name|FILE
modifier|*
name|temp_fp
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* temporary file pointer		*/
end_comment

begin_decl_stmt
name|FILE
modifier|*
name|bit_bucket
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file pointer to /dev/null		*/
end_comment

begin_decl_stmt
name|char
modifier|*
name|table
index|[]
init|=
block|{
literal|"^@"
block|,
literal|"^A"
block|,
literal|"^B"
block|,
literal|"^C"
block|,
literal|"^D"
block|,
literal|"^E"
block|,
literal|"^F"
block|,
literal|"^G"
block|,
literal|"^H"
block|,
literal|"\t"
block|,
literal|"^J"
block|,
literal|"^K"
block|,
literal|"^L"
block|,
literal|"^M"
block|,
literal|"^N"
block|,
literal|"^O"
block|,
literal|"^P"
block|,
literal|"^Q"
block|,
literal|"^R"
block|,
literal|"^S"
block|,
literal|"^T"
block|,
literal|"^U"
block|,
literal|"^V"
block|,
literal|"^W"
block|,
literal|"^X"
block|,
literal|"^Y"
block|,
literal|"^Z"
block|,
literal|"^["
block|,
literal|"^\\"
block|,
literal|"^]"
block|,
literal|"^^"
block|,
literal|"^_"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|com_win
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|text_win
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|help_win
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WINDOW
modifier|*
name|info_win
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__STDC__
argument_list|)
operator|||
name|defined
argument_list|(
name|__cplusplus
argument_list|)
end_if

begin_define
define|#
directive|define
name|P_
parameter_list|(
name|s
parameter_list|)
value|s
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|P_
parameter_list|(
name|s
parameter_list|)
value|()
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  |	The following structure allows menu items to be flexibly declared.  |	The first item is the string describing the selection, the second   |	is the address of the procedure to call when the item is selected,  |	and the third is the argument for the procedure.  |  |	For those systems with i18n, the string should be accompanied by a  |	catalog number.  The 'int *' should be replaced with 'void *' on   |	systems with that type.  |  |	The first menu item will be the title of the menu, with NULL   |	parameters for the procedure and argument, followed by the menu items.  |  |	If the procedure value is NULL, the menu item is displayed, but no   |	procedure is called when the item is selected.  The number of the   |	item will be returned.  If the third (argument) parameter is -1, no   |	argument is given to the procedure when it is called.  */
end_comment

begin_struct
struct|struct
name|menu_entries
block|{
name|char
modifier|*
name|item_string
decl_stmt|;
name|int
argument_list|(
argument|*procedure
argument_list|)
name|P_
argument_list|(
operator|(
expr|struct
name|menu_entries
operator|*
operator|)
argument_list|)
expr_stmt|;
name|struct
name|menu_entries
modifier|*
name|ptr_argument
decl_stmt|;
name|int
argument_list|(
argument|*iprocedure
argument_list|)
name|P_
argument_list|(
operator|(
name|int
operator|)
argument_list|)
expr_stmt|;
name|void
argument_list|(
argument|*nprocedure
argument_list|)
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
expr_stmt|;
name|unsigned
name|int
name|argument
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|int
decl|main
name|P_
argument_list|(
operator|(
name|int
name|argc
operator|,
name|char
operator|*
name|argv
index|[]
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|resiz_line
name|P_
argument_list|(
operator|(
name|int
name|factor
operator|,
expr|struct
name|text
operator|*
name|rline
operator|,
name|int
name|rpos
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|insert
name|P_
argument_list|(
operator|(
name|int
name|character
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|delete
name|P_
argument_list|(
operator|(
name|int
name|disp
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|scanline
name|P_
argument_list|(
operator|(
name|char
operator|*
name|pos
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tabshift
name|P_
argument_list|(
operator|(
name|int
name|temp_int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|out_char
name|P_
argument_list|(
operator|(
name|WINDOW
operator|*
name|window
operator|,
name|int
name|character
operator|,
name|int
name|column
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|len_char
name|P_
argument_list|(
operator|(
name|int
name|character
operator|,
name|int
name|column
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|draw_line
name|P_
argument_list|(
operator|(
name|int
name|vertical
operator|,
name|int
name|horiz
operator|,
name|char
operator|*
name|ptr
operator|,
name|int
name|t_pos
operator|,
name|int
name|length
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|insert_line
name|P_
argument_list|(
operator|(
name|int
name|disp
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|text
modifier|*
name|txtalloc
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|files
modifier|*
name|name_alloc
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|next_word
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|prev_word
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|control
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|emacs_control
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|bottom
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|top
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|nextline
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|prevline
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|left
name|P_
argument_list|(
operator|(
name|int
name|disp
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|right
name|P_
argument_list|(
operator|(
name|int
name|disp
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|find_pos
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|up
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|down
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|function_key
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|print_buffer
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|command_prompt
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|command
name|P_
argument_list|(
operator|(
name|char
operator|*
name|cmd_str1
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|scan
name|P_
argument_list|(
operator|(
name|char
operator|*
name|line
operator|,
name|int
name|offset
operator|,
name|int
name|column
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|get_string
name|P_
argument_list|(
operator|(
name|char
operator|*
name|prompt
operator|,
name|int
name|advance
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|compare
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string1
operator|,
name|char
operator|*
name|string2
operator|,
name|int
name|sensitive
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|goto_line
name|P_
argument_list|(
operator|(
name|char
operator|*
name|cmd_str
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|midscreen
name|P_
argument_list|(
operator|(
name|int
name|line
operator|,
name|char
operator|*
name|pnt
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|get_options
name|P_
argument_list|(
operator|(
name|int
name|numargs
operator|,
name|char
operator|*
name|arguments
index|[]
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|check_fp
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|get_file
name|P_
argument_list|(
operator|(
name|char
operator|*
name|file_name
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|get_line
name|P_
argument_list|(
operator|(
name|int
name|length
operator|,
name|char
operator|*
name|in_string
operator|,
name|int
operator|*
name|append
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|draw_screen
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|finish
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|quit
name|P_
argument_list|(
operator|(
name|int
name|noverify
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|edit_abort
name|P_
argument_list|(
operator|(
name|int
name|arg
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|delete_text
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|write_file
name|P_
argument_list|(
operator|(
name|char
operator|*
name|file_name
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|search
name|P_
argument_list|(
operator|(
name|int
name|display_message
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|search_prompt
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|del_char
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|undel_char
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|del_word
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|undel_word
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|del_line
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|undel_line
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|adv_word
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|move_rel
name|P_
argument_list|(
operator|(
name|char
operator|*
name|direction
operator|,
name|int
name|lines
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|eol
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|bol
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|adv_line
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|sh_command
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|set_up_term
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|resize_check
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|menu_op
name|P_
argument_list|(
operator|(
expr|struct
name|menu_entries
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|paint_menu
name|P_
argument_list|(
operator|(
expr|struct
name|menu_entries
name|menu_list
index|[]
operator|,
name|int
name|max_width
operator|,
name|int
name|max_height
operator|,
name|int
name|list_size
operator|,
name|int
name|top_offset
operator|,
name|WINDOW
operator|*
name|menu_win
operator|,
name|int
name|off_start
operator|,
name|int
name|vert_size
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|help
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|paint_info_win
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|no_info_window
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|create_info_window
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|file_op
name|P_
argument_list|(
operator|(
name|int
name|arg
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|shell_op
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|leave_op
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|redraw
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Blank_Line
name|P_
argument_list|(
operator|(
expr|struct
name|text
operator|*
name|test_line
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|Format
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|ee_init
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|dump_ee_conf
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|echo_string
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|spell_op
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|ispell_op
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|first_word_len
name|P_
argument_list|(
operator|(
expr|struct
name|text
operator|*
name|test_line
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|Auto_Format
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|modes_op
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|is_in_string
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string
operator|,
name|char
operator|*
name|substring
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|resolve_name
name|P_
argument_list|(
operator|(
name|char
operator|*
name|name
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|restrict_mode
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|unique_test
name|P_
argument_list|(
operator|(
name|char
operator|*
name|string
operator|,
name|char
operator|*
name|list
index|[]
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|strings_init
name|P_
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|P_
end_undef

begin_comment
comment|/*  |	allocate space here for the strings that will be in the menu  */
end_comment

begin_decl_stmt
name|struct
name|menu_entries
name|modes_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|dump_ee_conf
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|mode_strings
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|NUM_MODES_ITEMS
value|9
end_define

begin_decl_stmt
name|struct
name|menu_entries
name|config_dump_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|menu_entries
name|leave_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|finish
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|quit
block|,
name|NULL
block|,
name|TRUE
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|READ_FILE
value|1
end_define

begin_define
define|#
directive|define
name|WRITE_FILE
value|2
end_define

begin_define
define|#
directive|define
name|SAVE_FILE
value|3
end_define

begin_decl_stmt
name|struct
name|menu_entries
name|file_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|file_op
block|,
name|NULL
block|,
name|READ_FILE
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|file_op
block|,
name|NULL
block|,
name|WRITE_FILE
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|file_op
block|,
name|NULL
block|,
name|SAVE_FILE
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|print_buffer
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|menu_entries
name|search_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|search_prompt
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|search
block|,
name|NULL
block|,
name|TRUE
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|menu_entries
name|spell_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|spell_op
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ispell_op
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|menu_entries
name|misc_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|Format
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|shell_op
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|menu_op
block|,
name|spell_menu
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|menu_entries
name|main_menu
index|[]
init|=
block|{
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|leave_op
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|help
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|menu_op
block|,
name|file_menu
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|redraw
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|modes_op
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|menu_op
block|,
name|search_menu
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
literal|""
block|,
name|menu_op
block|,
name|misc_menu
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
operator|-
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|help_text
index|[
literal|22
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|control_keys
index|[
literal|5
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|emacs_help_text
index|[
literal|22
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|emacs_control_keys
index|[
literal|5
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|command_strings
index|[
literal|5
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|commands
index|[
literal|30
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|init_strings
index|[
literal|20
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MENU_WARN
value|1
end_define

begin_define
define|#
directive|define
name|max_alpha_char
value|36
end_define

begin_comment
comment|/*  |	Declarations for strings for localization  */
end_comment

begin_decl_stmt
name|char
modifier|*
name|com_win_message
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* to be shown in com_win if no info window */
end_comment

begin_decl_stmt
name|char
modifier|*
name|no_file_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ascii_code_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|printer_msg_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|command_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_write_prompt_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_read_prompt_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|char_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|unkn_cmd_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|non_unique_cmd_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|line_num_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|line_len_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|current_file_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|usage0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|usage1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|usage2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|usage3
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|usage4
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_is_dir_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|new_file_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|cant_open_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|open_file_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_read_fin_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|reading_file_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|read_only_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_read_lines_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|save_file_name_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_not_saved_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|changes_made_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|yes_char
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_exists_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|create_file_fail_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|writing_file_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|file_written_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|searching_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|str_not_found_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|search_prompt_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|exec_err_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|continue_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|menu_cancel_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|menu_size_err_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|press_any_key_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|shell_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|formatting_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|shell_echo_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|spell_in_prog_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|margin_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|restricted_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ON
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|OFF
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|HELP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|WRITE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|READ
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|LINE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|FILE_str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|CHARACTER
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|REDRAW
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|RESEQUENCE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|AUTHOR
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|VERSION
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|CASE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOCASE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|EXPAND
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOEXPAND
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Exit_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|QUIT_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|INFO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOINFO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|MARGINS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOMARGINS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|AUTOFORMAT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOAUTOFORMAT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Echo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|PRINTCOMMAND
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|RIGHTMARGIN
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|HIGHLIGHT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOHIGHLIGHT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|EIGHTBIT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOEIGHTBIT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|EMACS_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|NOEMACS_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|conf_dump_err_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|conf_dump_success_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|conf_not_saved_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ree_no_file_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|cancel_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|menu_too_lrg_msg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|more_above_str
decl_stmt|,
modifier|*
name|more_below_str
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|__STDC__
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|HAS_STDLIB
end_ifndef

begin_function_decl
specifier|extern
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|realloc
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|getenv
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|FILE
modifier|*
name|fopen
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* declaration for open function	*/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAS_STDLIB */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __STDC__ */
end_comment

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
comment|/* beginning of main program		*/
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|counter
decl_stmt|;
for|for
control|(
name|counter
operator|=
literal|1
init|;
name|counter
operator|<
literal|24
condition|;
name|counter
operator|++
control|)
name|signal
argument_list|(
name|counter
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGSEGV
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|edit_abort
argument_list|)
expr_stmt|;
name|d_char
operator|=
literal|0
expr_stmt|;
name|d_word
operator|=
name|malloc
argument_list|(
literal|150
argument_list|)
expr_stmt|;
operator|*
name|d_word
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|d_line
operator|=
name|NULL
expr_stmt|;
name|dlt_line
operator|=
name|txtalloc
argument_list|()
expr_stmt|;
name|dlt_line
operator|->
name|line
operator|=
name|d_line
expr_stmt|;
name|dlt_line
operator|->
name|line_length
operator|=
literal|1
expr_stmt|;
name|curr_line
operator|=
name|first_line
operator|=
name|txtalloc
argument_list|()
expr_stmt|;
name|curr_line
operator|->
name|line
operator|=
name|point
operator|=
name|malloc
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|=
literal|1
expr_stmt|;
name|curr_line
operator|->
name|max_length
operator|=
literal|10
expr_stmt|;
name|curr_line
operator|->
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|curr_line
operator|->
name|next_line
operator|=
name|NULL
expr_stmt|;
name|curr_line
operator|->
name|line_number
operator|=
literal|1
expr_stmt|;
name|srch_str
operator|=
name|NULL
expr_stmt|;
name|u_srch_str
operator|=
name|NULL
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|scr_pos
operator|=
literal|0
expr_stmt|;
name|scr_vert
operator|=
literal|0
expr_stmt|;
name|scr_horz
operator|=
literal|0
expr_stmt|;
name|bit_bucket
operator|=
name|fopen
argument_list|(
literal|"/dev/null"
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
name|edit
operator|=
name|TRUE
expr_stmt|;
name|gold
operator|=
name|case_sen
operator|=
name|FALSE
expr_stmt|;
name|shell_fork
operator|=
name|TRUE
expr_stmt|;
name|strings_init
argument_list|()
expr_stmt|;
name|ee_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
name|get_options
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
name|set_up_term
argument_list|()
expr_stmt|;
if|if
condition|(
name|right_margin
operator|==
literal|0
condition|)
name|right_margin
operator|=
name|COLS
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|top_of_stack
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|ree_no_file_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|edit_abort
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|no_file_string
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
else|else
name|check_fp
argument_list|()
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
name|edit
condition|)
block|{
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|in
operator|=
name|wgetch
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|in
operator|==
operator|-
literal|1
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|resize_check
argument_list|()
expr_stmt|;
if|if
condition|(
name|clear_com_win
condition|)
block|{
name|clear_com_win
operator|=
name|FALSE
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|info_window
condition|)
block|{
name|wprintw
argument_list|(
name|com_win
argument_list|,
literal|"%s"
argument_list|,
name|com_win_message
argument_list|)
expr_stmt|;
block|}
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|in
operator|>
literal|255
condition|)
name|function_key
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|in
operator|==
literal|'\10'
operator|)
operator|||
operator|(
name|in
operator|==
literal|127
operator|)
condition|)
name|delete
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|in
operator|>
literal|31
operator|)
operator|||
operator|(
name|in
operator|==
literal|9
operator|)
condition|)
name|insert
argument_list|(
name|in
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|in
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|in
operator|<=
literal|31
operator|)
condition|)
block|{
if|if
condition|(
name|emacs_keys_mode
condition|)
name|emacs_control
argument_list|()
expr_stmt|;
else|else
name|control
argument_list|()
expr_stmt|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|resiz_line
parameter_list|(
name|factor
parameter_list|,
name|rline
parameter_list|,
name|rpos
parameter_list|)
comment|/* resize the line to length + factor*/
name|int
name|factor
decl_stmt|;
comment|/* resize factor				*/
name|struct
name|text
modifier|*
name|rline
decl_stmt|;
comment|/* position in line				*/
name|int
name|rpos
decl_stmt|;
block|{
name|char
modifier|*
name|rpoint
decl_stmt|;
name|int
name|resiz_var
decl_stmt|;
name|rline
operator|->
name|max_length
operator|+=
name|factor
expr_stmt|;
name|rpoint
operator|=
name|rline
operator|->
name|line
operator|=
name|realloc
argument_list|(
name|rline
operator|->
name|line
argument_list|,
name|rline
operator|->
name|max_length
argument_list|)
expr_stmt|;
for|for
control|(
name|resiz_var
operator|=
literal|1
init|;
operator|(
name|resiz_var
operator|<
name|rpos
operator|)
condition|;
name|resiz_var
operator|++
control|)
name|rpoint
operator|++
expr_stmt|;
return|return
operator|(
name|rpoint
operator|)
return|;
block|}
end_function

begin_function
name|void
name|insert
parameter_list|(
name|character
parameter_list|)
comment|/* insert character into line		*/
name|int
name|character
decl_stmt|;
comment|/* new character			*/
block|{
name|int
name|counter
decl_stmt|;
name|int
name|value
decl_stmt|;
name|char
modifier|*
name|temp
decl_stmt|;
comment|/* temporary pointer			*/
name|char
modifier|*
name|temp2
decl_stmt|;
comment|/* temporary pointer			*/
if|if
condition|(
operator|(
name|character
operator|==
literal|'\011'
operator|)
operator|&&
operator|(
name|expand_tabs
operator|)
condition|)
block|{
name|counter
operator|=
name|len_char
argument_list|(
literal|'\011'
argument_list|,
name|scr_horz
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|counter
operator|>
literal|0
condition|;
name|counter
operator|--
control|)
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
if|if
condition|(
name|auto_format
condition|)
name|Auto_Format
argument_list|()
expr_stmt|;
return|return;
block|}
name|text_changes
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|curr_line
operator|->
name|max_length
operator|-
name|curr_line
operator|->
name|line_length
operator|)
operator|<
literal|5
condition|)
name|point
operator|=
name|resiz_line
argument_list|(
literal|10
argument_list|,
name|curr_line
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|++
expr_stmt|;
name|temp
operator|=
name|point
expr_stmt|;
name|counter
operator|=
name|position
expr_stmt|;
while|while
condition|(
name|counter
operator|<
name|curr_line
operator|->
name|line_length
condition|)
comment|/* find end of line */
block|{
name|counter
operator|++
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
name|temp
operator|++
expr_stmt|;
comment|/* increase length of line by one	*/
while|while
condition|(
name|point
operator|<
name|temp
condition|)
block|{
name|temp2
operator|=
name|temp
operator|-
literal|1
expr_stmt|;
operator|*
name|temp
operator|=
operator|*
name|temp2
expr_stmt|;
comment|/* shift characters over by one		*/
name|temp
operator|--
expr_stmt|;
block|}
operator|*
name|point
operator|=
name|character
expr_stmt|;
comment|/* insert new character			*/
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|character
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|character
operator|<
literal|' '
operator|)
operator|)
operator|||
operator|(
name|character
operator|>=
literal|127
operator|)
condition|)
comment|/* check for TAB character*/
block|{
name|scr_pos
operator|=
name|scr_horz
operator|+=
name|out_char
argument_list|(
name|text_win
argument_list|,
name|character
argument_list|,
name|scr_horz
argument_list|)
expr_stmt|;
name|point
operator|++
expr_stmt|;
name|position
operator|++
expr_stmt|;
block|}
else|else
block|{
name|waddch
argument_list|(
name|text_win
argument_list|,
name|character
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
operator|++
name|scr_horz
expr_stmt|;
name|point
operator|++
expr_stmt|;
name|position
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|observ_margins
operator|)
operator|&&
operator|(
name|right_margin
operator|<
name|scr_pos
operator|)
condition|)
block|{
name|counter
operator|=
name|position
expr_stmt|;
while|while
condition|(
name|scr_pos
operator|>
name|right_margin
condition|)
name|prev_word
argument_list|()
expr_stmt|;
if|if
condition|(
name|scr_pos
operator|==
literal|0
condition|)
block|{
while|while
condition|(
name|position
operator|<
name|counter
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|counter
operator|-=
name|position
expr_stmt|;
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|value
operator|=
literal|0
init|;
name|value
operator|<
name|counter
condition|;
name|value
operator|++
control|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
operator|>
name|last_col
condition|)
block|{
name|horiz_offset
operator|+=
literal|8
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|auto_format
operator|)
operator|&&
operator|(
name|character
operator|==
literal|' '
operator|)
operator|&&
operator|(
operator|!
name|formatted
operator|)
condition|)
name|Auto_Format
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|character
operator|!=
literal|' '
operator|)
operator|&&
operator|(
name|character
operator|!=
literal|'\t'
operator|)
condition|)
name|formatted
operator|=
name|FALSE
expr_stmt|;
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|delete
parameter_list|(
name|disp
parameter_list|)
comment|/* delete character		*/
name|int
name|disp
decl_stmt|;
block|{
name|char
modifier|*
name|tp
decl_stmt|;
name|char
modifier|*
name|temp2
decl_stmt|;
name|struct
name|text
modifier|*
name|temp_buff
decl_stmt|;
name|int
name|temp_vert
decl_stmt|;
name|int
name|temp_pos
decl_stmt|;
if|if
condition|(
name|point
operator|!=
name|curr_line
operator|->
name|line
condition|)
comment|/* if not at beginning of line	*/
block|{
name|text_changes
operator|=
name|TRUE
expr_stmt|;
name|temp2
operator|=
name|tp
operator|=
name|point
expr_stmt|;
name|tp
operator|--
expr_stmt|;
name|point
operator|--
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|tp
operator|>=
literal|'\000'
operator|)
operator|&&
operator|(
operator|*
name|tp
operator|<
literal|' '
operator|)
condition|)
comment|/* check for TAB	*/
name|scanline
argument_list|(
name|tp
argument_list|)
expr_stmt|;
else|else
operator|--
name|scr_horz
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
if|if
condition|(
name|in
operator|==
literal|8
condition|)
name|d_char
operator|=
operator|*
name|point
expr_stmt|;
comment|/* save deleted character  */
name|temp_pos
operator|=
operator|--
name|position
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|--
expr_stmt|;
while|while
condition|(
name|temp_pos
operator|<=
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|temp_pos
operator|++
expr_stmt|;
operator|*
name|tp
operator|=
operator|*
name|temp2
expr_stmt|;
name|tp
operator|++
expr_stmt|;
name|temp2
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|scr_horz
operator|<
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|-=
literal|8
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|text_changes
operator|=
name|TRUE
expr_stmt|;
name|left
argument_list|(
name|disp
argument_list|)
expr_stmt|;
comment|/* go to previous line	*/
name|temp_buff
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
name|point
operator|=
name|resiz_line
argument_list|(
name|temp_buff
operator|->
name|line_length
argument_list|,
name|curr_line
argument_list|,
name|position
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp_buff
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|temp_buff
operator|->
name|next_line
operator|->
name|prev_line
operator|=
name|curr_line
expr_stmt|;
name|curr_line
operator|->
name|next_line
operator|=
name|temp_buff
operator|->
name|next_line
expr_stmt|;
name|temp2
operator|=
name|temp_buff
operator|->
name|line
expr_stmt|;
if|if
condition|(
name|in
operator|==
literal|8
condition|)
name|d_char
operator|=
literal|'\n'
expr_stmt|;
name|tp
operator|=
name|point
expr_stmt|;
name|temp_pos
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|temp_pos
operator|<
name|temp_buff
operator|->
name|line_length
condition|)
block|{
name|curr_line
operator|->
name|line_length
operator|++
expr_stmt|;
name|temp_pos
operator|++
expr_stmt|;
operator|*
name|tp
operator|=
operator|*
name|temp2
expr_stmt|;
name|tp
operator|++
expr_stmt|;
name|temp2
operator|++
expr_stmt|;
block|}
operator|*
name|tp
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|free
argument_list|(
name|temp_buff
operator|->
name|line
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|temp_buff
argument_list|)
expr_stmt|;
name|temp_buff
operator|=
name|curr_line
expr_stmt|;
name|temp_vert
operator|=
name|scr_vert
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
if|if
condition|(
name|scr_vert
operator|<
name|last_line
condition|)
block|{
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
operator|+
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wdeleteln
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|temp_buff
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|temp_vert
operator|<
name|last_line
operator|)
condition|)
block|{
name|temp_buff
operator|=
name|temp_buff
operator|->
name|next_line
expr_stmt|;
name|temp_vert
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|temp_vert
operator|==
name|last_line
operator|)
operator|&&
operator|(
name|temp_buff
operator|!=
name|NULL
operator|)
condition|)
block|{
name|tp
operator|=
name|temp_buff
operator|->
name|line
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|last_line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtobot
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|draw_line
argument_list|(
name|last_line
argument_list|,
literal|0
argument_list|,
name|tp
argument_list|,
literal|1
argument_list|,
name|temp_buff
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|formatted
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|scanline
parameter_list|(
name|pos
parameter_list|)
comment|/* find the proper horizontal position for the pointer	*/
name|char
modifier|*
name|pos
decl_stmt|;
block|{
name|int
name|temp
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
name|ptr
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|temp
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|ptr
operator|<
name|pos
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|ptr
operator|>=
literal|0
operator|)
operator|&&
operator|(
operator|*
name|ptr
operator|<=
literal|8
operator|)
condition|)
name|temp
operator|+=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|ptr
operator|==
literal|9
condition|)
name|temp
operator|+=
name|tabshift
argument_list|(
name|temp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|ptr
operator|>=
literal|10
operator|)
operator|&&
operator|(
operator|*
name|ptr
operator|<=
literal|31
operator|)
condition|)
name|temp
operator|+=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|ptr
operator|>=
literal|32
operator|)
operator|&&
operator|(
operator|*
name|ptr
operator|<
literal|127
operator|)
condition|)
name|temp
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|ptr
operator|==
literal|127
condition|)
name|temp
operator|+=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|eightbit
condition|)
name|temp
operator|+=
literal|5
expr_stmt|;
else|else
name|temp
operator|++
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
block|}
name|scr_horz
operator|=
name|temp
expr_stmt|;
if|if
condition|(
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
operator|>
name|last_col
condition|)
block|{
name|horiz_offset
operator|=
operator|(
name|scr_horz
operator|-
operator|(
name|scr_horz
operator|%
literal|8
operator|)
operator|)
operator|-
operator|(
name|COLS
operator|-
literal|8
operator|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|scr_horz
operator|<
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|=
name|max
argument_list|(
literal|0
argument_list|,
operator|(
name|scr_horz
operator|-
operator|(
name|scr_horz
operator|%
literal|8
operator|)
operator|)
argument_list|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|tabshift
parameter_list|(
name|temp_int
parameter_list|)
comment|/* give the number of spaces to shift	*/
name|int
name|temp_int
decl_stmt|;
block|{
name|int
name|leftover
decl_stmt|;
name|leftover
operator|=
operator|(
operator|(
name|temp_int
operator|+
literal|1
operator|)
operator|%
literal|8
operator|)
expr_stmt|;
if|if
condition|(
name|leftover
operator|==
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
else|else
return|return
operator|(
literal|9
operator|-
name|leftover
operator|)
return|;
block|}
end_function

begin_function
name|int
name|out_char
parameter_list|(
name|window
parameter_list|,
name|character
parameter_list|,
name|column
parameter_list|)
comment|/* output non-printing character */
name|WINDOW
modifier|*
name|window
decl_stmt|;
name|char
name|character
decl_stmt|;
name|int
name|column
decl_stmt|;
block|{
name|int
name|i1
decl_stmt|,
name|i2
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|char
name|string2
index|[
literal|8
index|]
decl_stmt|;
if|if
condition|(
name|character
operator|==
name|TAB
condition|)
block|{
name|i1
operator|=
name|tabshift
argument_list|(
name|column
argument_list|)
expr_stmt|;
for|for
control|(
name|i2
operator|=
literal|0
init|;
operator|(
name|i2
operator|<
name|i1
operator|)
operator|&&
operator|(
operator|(
operator|(
name|column
operator|+
name|i2
operator|+
literal|1
operator|)
operator|-
name|horiz_offset
operator|)
operator|<
name|last_col
operator|)
condition|;
name|i2
operator|++
control|)
block|{
name|waddch
argument_list|(
name|window
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|i1
operator|)
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|character
operator|>=
literal|'\0'
operator|)
operator|&&
operator|(
name|character
operator|<
literal|' '
operator|)
condition|)
block|{
name|string
operator|=
name|table
index|[
operator|(
name|int
operator|)
name|character
index|]
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|character
operator|<
literal|0
operator|)
operator|||
operator|(
name|character
operator|>=
literal|127
operator|)
condition|)
block|{
if|if
condition|(
name|character
operator|==
literal|127
condition|)
name|string
operator|=
literal|"^?"
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|eightbit
condition|)
block|{
name|sprintf
argument_list|(
name|string2
argument_list|,
literal|"<%d>"
argument_list|,
operator|(
name|character
operator|<
literal|0
operator|)
condition|?
operator|(
name|character
operator|+
literal|256
operator|)
else|:
name|character
argument_list|)
expr_stmt|;
name|string
operator|=
name|string2
expr_stmt|;
block|}
else|else
block|{
name|waddch
argument_list|(
name|window
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|character
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
else|else
block|{
name|waddch
argument_list|(
name|window
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|character
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
for|for
control|(
name|i2
operator|=
literal|0
init|;
operator|(
name|string
index|[
name|i2
index|]
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|(
name|column
operator|+
name|i2
operator|+
literal|1
operator|)
operator|-
name|horiz_offset
operator|)
operator|<
name|last_col
operator|)
condition|;
name|i2
operator|++
control|)
name|waddch
argument_list|(
name|window
argument_list|,
name|string
index|[
name|i2
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|strlen
argument_list|(
name|string
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|len_char
parameter_list|(
name|character
parameter_list|,
name|column
parameter_list|)
comment|/* return the length of the character	*/
name|char
name|character
decl_stmt|;
name|int
name|column
decl_stmt|;
comment|/* the column must be known to provide spacing for tabs	*/
block|{
name|int
name|length
decl_stmt|;
if|if
condition|(
name|character
operator|==
literal|'\t'
condition|)
name|length
operator|=
name|tabshift
argument_list|(
name|column
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|character
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|character
operator|<
literal|32
operator|)
condition|)
name|length
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|character
operator|>=
literal|32
operator|)
operator|&&
operator|(
name|character
operator|<=
literal|126
operator|)
condition|)
name|length
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|character
operator|==
literal|127
condition|)
name|length
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|(
name|character
operator|>
literal|126
operator|)
operator|||
operator|(
name|character
operator|<
literal|0
operator|)
operator|)
operator|&&
operator|(
operator|!
name|eightbit
operator|)
condition|)
name|length
operator|=
literal|5
expr_stmt|;
else|else
name|length
operator|=
literal|1
expr_stmt|;
return|return
operator|(
name|length
operator|)
return|;
block|}
end_function

begin_function
name|void
name|draw_line
parameter_list|(
name|vertical
parameter_list|,
name|horiz
parameter_list|,
name|ptr
parameter_list|,
name|t_pos
parameter_list|,
name|length
parameter_list|)
comment|/* redraw line from current position */
name|int
name|vertical
decl_stmt|;
comment|/* current vertical position on screen		*/
name|int
name|horiz
decl_stmt|;
comment|/* current horizontal position on screen	*/
name|char
modifier|*
name|ptr
decl_stmt|;
comment|/* pointer to line				*/
name|int
name|t_pos
decl_stmt|;
comment|/* current position (offset in bytes) from bol	*/
name|int
name|length
decl_stmt|;
comment|/* length (in bytes) of line			*/
block|{
name|int
name|d
decl_stmt|;
comment|/* partial length of special or tab char to display  */
name|char
modifier|*
name|temp
decl_stmt|;
comment|/* temporary pointer to position in line	     */
name|int
name|abs_column
decl_stmt|;
comment|/* offset in screen units from begin of line	     */
name|int
name|column
decl_stmt|;
comment|/* horizontal position on screen		     */
name|int
name|row
decl_stmt|;
comment|/* vertical position on screen			     */
name|int
name|posit
decl_stmt|;
comment|/* temporary position indicator within line	     */
name|abs_column
operator|=
name|horiz
expr_stmt|;
name|column
operator|=
name|horiz
operator|-
name|horiz_offset
expr_stmt|;
name|row
operator|=
name|vertical
expr_stmt|;
name|temp
operator|=
name|ptr
expr_stmt|;
name|d
operator|=
literal|0
expr_stmt|;
name|posit
operator|=
name|t_pos
expr_stmt|;
if|if
condition|(
name|column
operator|<
literal|0
condition|)
block|{
name|wmove
argument_list|(
name|text_win
argument_list|,
name|row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|column
operator|<
literal|0
condition|)
block|{
name|d
operator|=
name|len_char
argument_list|(
operator|*
name|temp
argument_list|,
name|abs_column
argument_list|)
expr_stmt|;
name|abs_column
operator|+=
name|d
expr_stmt|;
name|column
operator|+=
name|d
expr_stmt|;
name|posit
operator|++
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|row
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|posit
operator|<
name|length
operator|)
operator|&&
operator|(
name|column
operator|<=
name|last_col
operator|)
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|temp
operator|<
literal|32
operator|)
operator|||
operator|(
operator|*
name|temp
operator|==
literal|127
operator|)
condition|)
block|{
name|column
operator|+=
name|len_char
argument_list|(
operator|*
name|temp
argument_list|,
name|abs_column
argument_list|)
expr_stmt|;
name|abs_column
operator|+=
name|out_char
argument_list|(
name|text_win
argument_list|,
operator|*
name|temp
argument_list|,
name|abs_column
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|abs_column
operator|++
expr_stmt|;
name|column
operator|++
expr_stmt|;
name|waddch
argument_list|(
name|text_win
argument_list|,
operator|*
name|temp
argument_list|)
expr_stmt|;
block|}
name|posit
operator|++
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|column
operator|<
name|last_col
condition|)
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|vertical
argument_list|,
operator|(
name|horiz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|insert_line
parameter_list|(
name|disp
parameter_list|)
comment|/* insert new line		*/
name|int
name|disp
decl_stmt|;
block|{
name|int
name|temp_pos
decl_stmt|;
name|int
name|temp_pos2
decl_stmt|;
name|char
modifier|*
name|temp
decl_stmt|;
name|char
modifier|*
name|extra
decl_stmt|;
name|struct
name|text
modifier|*
name|temp_nod
decl_stmt|;
name|text_changes
operator|=
name|TRUE
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|temp_nod
operator|=
name|txtalloc
argument_list|()
expr_stmt|;
name|temp_nod
operator|->
name|line
operator|=
name|extra
operator|=
name|malloc
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|temp_nod
operator|->
name|line_length
operator|=
literal|1
expr_stmt|;
name|temp_nod
operator|->
name|max_length
operator|=
literal|10
expr_stmt|;
name|temp_nod
operator|->
name|line_number
operator|=
name|curr_line
operator|->
name|line_number
operator|+
literal|1
expr_stmt|;
name|temp_nod
operator|->
name|next_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
if|if
condition|(
name|temp_nod
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|temp_nod
operator|->
name|next_line
operator|->
name|prev_line
operator|=
name|temp_nod
expr_stmt|;
name|temp_nod
operator|->
name|prev_line
operator|=
name|curr_line
expr_stmt|;
name|curr_line
operator|->
name|next_line
operator|=
name|temp_nod
expr_stmt|;
name|temp_pos2
operator|=
name|position
expr_stmt|;
name|temp
operator|=
name|point
expr_stmt|;
if|if
condition|(
name|temp_pos2
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|temp_pos
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|temp_pos2
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
if|if
condition|(
operator|(
name|temp_nod
operator|->
name|max_length
operator|-
name|temp_nod
operator|->
name|line_length
operator|)
operator|<
literal|5
condition|)
name|extra
operator|=
name|resiz_line
argument_list|(
literal|10
argument_list|,
name|temp_nod
argument_list|,
name|temp_pos
argument_list|)
expr_stmt|;
name|temp_nod
operator|->
name|line_length
operator|++
expr_stmt|;
name|temp_pos
operator|++
expr_stmt|;
name|temp_pos2
operator|++
expr_stmt|;
operator|*
name|extra
operator|=
operator|*
name|temp
expr_stmt|;
name|extra
operator|++
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
name|temp
operator|=
name|point
expr_stmt|;
operator|*
name|temp
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|temp
operator|=
name|resiz_line
argument_list|(
operator|(
literal|1
operator|-
name|temp_nod
operator|->
name|line_length
operator|)
argument_list|,
name|curr_line
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|=
literal|1
operator|+
name|temp
operator|-
name|curr_line
operator|->
name|line
expr_stmt|;
block|}
name|curr_line
operator|->
name|line_length
operator|=
name|position
expr_stmt|;
name|curr_line
operator|=
name|temp_nod
expr_stmt|;
operator|*
name|extra
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
if|if
condition|(
name|disp
condition|)
block|{
if|if
condition|(
name|scr_vert
operator|<
name|last_line
condition|)
block|{
name|scr_vert
operator|++
expr_stmt|;
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|winsertln
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|wmove
argument_list|(
name|text_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wdeleteln
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|last_line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtobot
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
name|scr_pos
operator|=
name|scr_horz
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|=
literal|0
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|struct
name|text
modifier|*
name|txtalloc
parameter_list|()
comment|/* allocate space for line structure	*/
block|{
return|return
operator|(
operator|(
expr|struct
name|text
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|text
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|files
modifier|*
name|name_alloc
parameter_list|()
comment|/* allocate space for file name list node */
block|{
return|return
operator|(
operator|(
expr|struct
name|files
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|files
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|next_word
parameter_list|(
name|string
parameter_list|)
comment|/* move to next word in string		*/
name|char
modifier|*
name|string
decl_stmt|;
block|{
while|while
condition|(
operator|(
operator|*
name|string
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|*
name|string
operator|!=
literal|32
operator|)
operator|&&
operator|(
operator|*
name|string
operator|!=
literal|9
operator|)
operator|)
condition|)
name|string
operator|++
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|string
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|*
name|string
operator|==
literal|32
operator|)
operator|||
operator|(
operator|*
name|string
operator|==
literal|9
operator|)
operator|)
condition|)
name|string
operator|++
expr_stmt|;
return|return
operator|(
name|string
operator|)
return|;
block|}
end_function

begin_function
name|void
name|prev_word
parameter_list|()
comment|/* move to start of previous word in text	*/
block|{
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
name|point
index|[
operator|-
literal|1
index|]
operator|==
literal|' '
operator|)
operator|||
operator|(
name|point
index|[
operator|-
literal|1
index|]
operator|==
literal|'\t'
operator|)
operator|)
condition|)
block|{
comment|/* if at the start of a word	*/
while|while
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|point
operator|!=
literal|'\t'
operator|)
operator|)
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
operator|)
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|point
operator|!=
literal|'\t'
operator|)
operator|)
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
operator|)
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|control
parameter_list|()
comment|/* use control for commands		*/
block|{
name|char
modifier|*
name|string
decl_stmt|;
if|if
condition|(
name|in
operator|==
literal|1
condition|)
comment|/* control a	*/
block|{
name|string
operator|=
name|get_string
argument_list|(
name|ascii_code_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|string
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|in
operator|=
name|atoi
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|insert
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
literal|2
condition|)
comment|/* control b	*/
name|bottom
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|3
condition|)
comment|/* control c	*/
block|{
name|command_prompt
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
literal|4
condition|)
comment|/* control d	*/
name|down
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|5
condition|)
comment|/* control e	*/
name|search_prompt
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|6
condition|)
comment|/* control f	*/
name|undel_char
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|7
condition|)
comment|/* control g	*/
name|bol
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|8
condition|)
comment|/* control h	*/
name|delete
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|9
condition|)
comment|/* control i	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|10
condition|)
comment|/* control j	*/
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|11
condition|)
comment|/* control k	*/
name|del_char
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|12
condition|)
comment|/* control l	*/
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|13
condition|)
comment|/* control m	*/
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|14
condition|)
comment|/* control n	*/
name|move_rel
argument_list|(
literal|"d"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|15
condition|)
comment|/* control o	*/
name|eol
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|16
condition|)
comment|/* control p	*/
name|move_rel
argument_list|(
literal|"u"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|17
condition|)
comment|/* control q	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|18
condition|)
comment|/* control r	*/
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|19
condition|)
comment|/* control s	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|20
condition|)
comment|/* control t	*/
name|top
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|21
condition|)
comment|/* control u	*/
name|up
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|22
condition|)
comment|/* control v	*/
name|undel_word
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|23
condition|)
comment|/* control w	*/
name|del_word
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|24
condition|)
comment|/* control x	*/
name|search
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|25
condition|)
comment|/* control y	*/
name|del_line
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|26
condition|)
comment|/* control z	*/
name|undel_line
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|27
condition|)
comment|/* control [ (escape)	*/
block|{
name|menu_op
argument_list|(
name|main_menu
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  |	Emacs control-key bindings  */
end_comment

begin_function
name|void
name|emacs_control
parameter_list|()
block|{
name|char
modifier|*
name|string
decl_stmt|;
if|if
condition|(
name|in
operator|==
literal|1
condition|)
comment|/* control a	*/
name|bol
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|2
condition|)
comment|/* control b	*/
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|3
condition|)
comment|/* control c	*/
block|{
name|command_prompt
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
literal|4
condition|)
comment|/* control d	*/
name|del_char
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|5
condition|)
comment|/* control e	*/
name|eol
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|6
condition|)
comment|/* control f	*/
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|7
condition|)
comment|/* control g	*/
name|move_rel
argument_list|(
literal|"u"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|8
condition|)
comment|/* control h	*/
name|delete
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|9
condition|)
comment|/* control i	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|10
condition|)
comment|/* control j	*/
name|undel_char
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|11
condition|)
comment|/* control k	*/
name|del_line
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|12
condition|)
comment|/* control l	*/
name|undel_line
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|13
condition|)
comment|/* control m	*/
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|14
condition|)
comment|/* control n	*/
name|down
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|15
condition|)
comment|/* control o	*/
block|{
name|string
operator|=
name|get_string
argument_list|(
name|ascii_code_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|string
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|in
operator|=
name|atoi
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|insert
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
literal|16
condition|)
comment|/* control p	*/
name|up
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|17
condition|)
comment|/* control q	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|18
condition|)
comment|/* control r	*/
name|undel_word
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|19
condition|)
comment|/* control s	*/
empty_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|20
condition|)
comment|/* control t	*/
name|top
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|21
condition|)
comment|/* control u	*/
name|bottom
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|22
condition|)
comment|/* control v	*/
name|move_rel
argument_list|(
literal|"d"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|23
condition|)
comment|/* control w	*/
name|del_word
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|24
condition|)
comment|/* control x	*/
name|search
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|25
condition|)
comment|/* control y	*/
name|search_prompt
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|26
condition|)
comment|/* control z	*/
name|adv_word
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
literal|27
condition|)
comment|/* control [ (escape)	*/
block|{
name|menu_op
argument_list|(
name|main_menu
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|bottom
parameter_list|()
comment|/* go to bottom of file			*/
block|{
while|while
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|curr_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
if|if
condition|(
name|horiz_offset
condition|)
name|horiz_offset
operator|=
literal|0
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|midscreen
argument_list|(
name|last_line
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
block|}
end_function

begin_function
name|void
name|top
parameter_list|()
comment|/* go to top of file			*/
block|{
while|while
condition|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
condition|)
name|curr_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
if|if
condition|(
name|horiz_offset
condition|)
name|horiz_offset
operator|=
literal|0
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|midscreen
argument_list|(
literal|0
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
block|}
end_function

begin_function
name|void
name|nextline
parameter_list|()
comment|/* move pointers to start of next line	*/
block|{
name|curr_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|scr_vert
operator|==
name|last_line
condition|)
block|{
name|wmove
argument_list|(
name|text_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wdeleteln
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|last_line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtobot
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|draw_line
argument_list|(
name|last_line
argument_list|,
literal|0
argument_list|,
name|point
argument_list|,
literal|1
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
else|else
name|scr_vert
operator|++
expr_stmt|;
block|}
end_function

begin_function
name|void
name|prevline
parameter_list|()
comment|/* move pointers to start of previous line*/
block|{
name|curr_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|scr_vert
operator|==
literal|0
condition|)
block|{
name|winsertln
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|draw_line
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|point
argument_list|,
literal|1
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
else|else
name|scr_vert
operator|--
expr_stmt|;
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|position
operator|++
expr_stmt|;
name|point
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|left
parameter_list|(
name|disp
parameter_list|)
comment|/* move left one character	*/
name|int
name|disp
decl_stmt|;
block|{
if|if
condition|(
name|point
operator|!=
name|curr_line
operator|->
name|line
condition|)
comment|/* if not at begin of line	*/
block|{
name|point
operator|--
expr_stmt|;
name|position
operator|--
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
name|disp
condition|)
block|{
name|curr_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
operator|+
name|curr_line
operator|->
name|line_length
expr_stmt|;
name|position
operator|=
name|curr_line
operator|->
name|line_length
expr_stmt|;
return|return;
block|}
name|position
operator|=
literal|1
expr_stmt|;
name|prevline
argument_list|()
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|right
parameter_list|(
name|disp
parameter_list|)
comment|/* move right one character	*/
name|int
name|disp
decl_stmt|;
block|{
if|if
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|point
operator|++
expr_stmt|;
name|position
operator|++
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
name|disp
condition|)
block|{
name|curr_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
return|return;
block|}
name|nextline
argument_list|()
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|=
literal|0
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|find_pos
parameter_list|()
comment|/* move to the same column as on other line	*/
block|{
name|scr_horz
operator|=
literal|0
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|scr_horz
operator|<
name|scr_pos
operator|)
operator|&&
operator|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|point
operator|==
literal|9
condition|)
name|scr_horz
operator|+=
name|tabshift
argument_list|(
name|scr_horz
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|point
operator|>=
literal|'\0'
operator|)
operator|&&
operator|(
operator|*
name|point
operator|<
literal|' '
operator|)
condition|)
name|scr_horz
operator|+=
literal|2
expr_stmt|;
else|else
name|scr_horz
operator|++
expr_stmt|;
name|position
operator|++
expr_stmt|;
name|point
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
operator|>
name|last_col
condition|)
block|{
name|horiz_offset
operator|=
operator|(
name|scr_horz
operator|-
operator|(
name|scr_horz
operator|%
literal|8
operator|)
operator|)
operator|-
operator|(
name|COLS
operator|-
literal|8
operator|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|scr_horz
operator|<
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|=
name|max
argument_list|(
literal|0
argument_list|,
operator|(
name|scr_horz
operator|-
operator|(
name|scr_horz
operator|%
literal|8
operator|)
operator|)
argument_list|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|up
parameter_list|()
comment|/* move up one line		*/
block|{
if|if
condition|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|prevline
argument_list|()
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|find_pos
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|down
parameter_list|()
comment|/* move down one line		*/
block|{
if|if
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
block|{
name|nextline
argument_list|()
expr_stmt|;
name|find_pos
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|function_key
parameter_list|()
comment|/* process function key		*/
block|{
if|if
condition|(
name|in
operator|==
name|KEY_LEFT
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_RIGHT
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_HOME
condition|)
name|top
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_UP
condition|)
name|up
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_DOWN
condition|)
name|down
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_NPAGE
condition|)
name|move_rel
argument_list|(
literal|"d"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_PPAGE
condition|)
name|move_rel
argument_list|(
literal|"u"
argument_list|,
name|max
argument_list|(
literal|5
argument_list|,
operator|(
name|last_line
operator|-
literal|5
operator|)
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_DL
condition|)
name|del_line
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_DC
condition|)
name|del_char
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_BACKSPACE
condition|)
name|delete
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_IL
condition|)
block|{
comment|/* insert a line before current line	*/
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|1
argument_list|)
condition|)
name|gold
operator|=
operator|!
name|gold
expr_stmt|;
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|2
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|undel_line
argument_list|()
expr_stmt|;
block|}
else|else
name|undel_char
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|3
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|undel_word
argument_list|()
expr_stmt|;
block|}
else|else
name|del_word
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|4
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
else|else
name|adv_word
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|5
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|search_prompt
argument_list|()
expr_stmt|;
block|}
else|else
name|search
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|6
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|bottom
argument_list|()
expr_stmt|;
block|}
else|else
name|top
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|7
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|eol
argument_list|()
expr_stmt|;
block|}
else|else
name|bol
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|in
operator|==
name|KEY_F
argument_list|(
literal|8
argument_list|)
condition|)
block|{
if|if
condition|(
name|gold
condition|)
block|{
name|gold
operator|=
name|FALSE
expr_stmt|;
name|command_prompt
argument_list|()
expr_stmt|;
block|}
else|else
name|adv_line
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|print_buffer
parameter_list|()
block|{
name|char
name|buffer
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|">!%s"
argument_list|,
name|print_command
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|printer_msg_str
argument_list|,
name|print_command
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|command
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|command_prompt
parameter_list|()
block|{
name|char
modifier|*
name|cmd_str
decl_stmt|;
name|int
name|result
decl_stmt|;
name|info_type
operator|=
name|COMMANDS
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
name|cmd_str
operator|=
name|get_string
argument_list|(
name|command_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|result
operator|=
name|unique_test
argument_list|(
name|cmd_str
argument_list|,
name|commands
argument_list|)
operator|)
operator|!=
literal|1
condition|)
block|{
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
literal|0
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|unkn_cmd_str
argument_list|,
name|cmd_str
argument_list|)
expr_stmt|;
else|else
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|non_unique_cmd_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|info_type
operator|=
name|CONTROL_KEYS
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
if|if
condition|(
name|cmd_str
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
return|return;
block|}
name|command
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|info_type
operator|=
name|CONTROL_KEYS
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
if|if
condition|(
name|cmd_str
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|command
parameter_list|(
name|cmd_str1
parameter_list|)
comment|/* process commands from keyboard	*/
name|char
modifier|*
name|cmd_str1
decl_stmt|;
block|{
name|char
modifier|*
name|cmd_str2
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|cmd_str
init|=
name|cmd_str1
decl_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|HELP
argument_list|,
name|FALSE
argument_list|)
condition|)
name|help
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|WRITE
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
name|cmd_str
operator|=
name|next_word
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|cmd_str
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|cmd_str
operator|=
name|cmd_str2
operator|=
name|get_string
argument_list|(
name|file_write_prompt_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|write_file
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|cmd_str
condition|)
name|free
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|READ
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
name|cmd_str
operator|=
name|next_word
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|cmd_str
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
name|cmd_str
operator|=
name|cmd_str2
operator|=
name|get_string
argument_list|(
name|file_read_prompt_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|tmp_file
operator|=
name|cmd_str
expr_stmt|;
name|recv_file
operator|=
name|TRUE
expr_stmt|;
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|check_fp
argument_list|()
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|cmd_str
condition|)
name|free
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|LINE
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|line_num_str
argument_list|,
name|curr_line
operator|->
name|line_number
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|line_len_str
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|FILE_str
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|in_file_name
operator|==
name|NULL
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|no_file_string
argument_list|)
expr_stmt|;
else|else
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|current_file_str
argument_list|,
name|in_file_name
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|cmd_str
operator|<=
literal|'9'
operator|)
condition|)
name|goto_line
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|CHARACTER
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|point
operator|>=
literal|'\0'
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|char_str
argument_list|,
operator|*
name|point
argument_list|)
expr_stmt|;
else|else
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|char_str
argument_list|,
operator|(
operator|*
name|point
operator|+
literal|256
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|REDRAW
argument_list|,
name|FALSE
argument_list|)
condition|)
name|redraw
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|RESEQUENCE
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|tmp_line
operator|=
name|first_line
operator|->
name|next_line
expr_stmt|;
while|while
condition|(
name|tmp_line
operator|!=
name|NULL
condition|)
block|{
name|tmp_line
operator|->
name|line_number
operator|=
name|tmp_line
operator|->
name|prev_line
operator|->
name|line_number
operator|+
literal|1
expr_stmt|;
name|tmp_line
operator|=
name|tmp_line
operator|->
name|next_line
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|AUTHOR
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
literal|"written by Hugh Mahon"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|VERSION
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
literal|"%s"
argument_list|,
name|version
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|CASE
argument_list|,
name|FALSE
argument_list|)
condition|)
name|case_sen
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|NOCASE
argument_list|,
name|FALSE
argument_list|)
condition|)
name|case_sen
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|EXPAND
argument_list|,
name|FALSE
argument_list|)
condition|)
name|expand_tabs
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|NOEXPAND
argument_list|,
name|FALSE
argument_list|)
condition|)
name|expand_tabs
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|Exit_string
argument_list|,
name|FALSE
argument_list|)
condition|)
name|finish
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|cmd_str
argument_list|,
name|QUIT_string
argument_list|,
name|FALSE
argument_list|)
condition|)
name|quit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|cmd_str
operator|==
literal|'!'
condition|)
block|{
name|cmd_str
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|cmd_str
operator|==
literal|9
operator|)
condition|)
name|cmd_str
operator|=
name|next_word
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|sh_command
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|==
literal|'<'
operator|)
operator|&&
operator|(
operator|!
name|in_pipe
operator|)
condition|)
block|{
name|in_pipe
operator|=
name|TRUE
expr_stmt|;
name|shell_fork
operator|=
name|FALSE
expr_stmt|;
name|cmd_str
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|cmd_str
operator|==
literal|'\t'
operator|)
condition|)
name|cmd_str
operator|=
name|next_word
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|command
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|in_pipe
operator|=
name|FALSE
expr_stmt|;
name|shell_fork
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|==
literal|'>'
operator|)
operator|&&
operator|(
operator|!
name|out_pipe
operator|)
condition|)
block|{
name|out_pipe
operator|=
name|TRUE
expr_stmt|;
name|cmd_str
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|cmd_str
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|cmd_str
operator|==
literal|'\t'
operator|)
condition|)
name|cmd_str
operator|=
name|next_word
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|command
argument_list|(
name|cmd_str
argument_list|)
expr_stmt|;
name|out_pipe
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|unkn_cmd_str
argument_list|,
name|cmd_str
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|cmd_str2
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|cmd_str2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|scan
parameter_list|(
name|line
parameter_list|,
name|offset
parameter_list|,
name|column
parameter_list|)
comment|/* determine horizontal position for get_string	*/
name|char
modifier|*
name|line
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|column
decl_stmt|;
block|{
name|char
modifier|*
name|stemp
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|stemp
operator|=
name|line
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|j
operator|=
name|column
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|offset
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|j
operator|+=
name|len_char
argument_list|(
operator|*
name|stemp
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|stemp
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|j
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|get_string
parameter_list|(
name|prompt
parameter_list|,
name|advance
parameter_list|)
comment|/* read string from input on command line */
name|char
modifier|*
name|prompt
decl_stmt|;
comment|/* string containing user prompt message	*/
name|int
name|advance
decl_stmt|;
comment|/* if true, skip leading spaces and tabs	*/
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|char
modifier|*
name|tmp_string
decl_stmt|;
name|char
modifier|*
name|nam_str
decl_stmt|;
name|char
modifier|*
name|g_point
decl_stmt|;
name|int
name|tmp_int
decl_stmt|;
name|int
name|g_horz
decl_stmt|,
name|g_position
decl_stmt|,
name|g_pos
decl_stmt|;
name|int
name|esc_flag
decl_stmt|;
name|g_point
operator|=
name|tmp_string
operator|=
name|malloc
argument_list|(
literal|512
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|com_win
argument_list|,
name|prompt
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|nam_str
operator|=
name|tmp_string
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
name|g_horz
operator|=
name|g_position
operator|=
name|scan
argument_list|(
name|prompt
argument_list|,
name|strlen
argument_list|(
name|prompt
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_pos
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|esc_flag
operator|=
name|FALSE
expr_stmt|;
name|in
operator|=
name|wgetch
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|in
operator|==
operator|-
literal|1
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|in
operator|==
literal|8
operator|)
operator|||
operator|(
name|in
operator|==
literal|127
operator|)
operator|||
operator|(
name|in
operator|==
name|KEY_BACKSPACE
operator|)
operator|)
operator|&&
operator|(
name|g_pos
operator|>
literal|0
operator|)
condition|)
block|{
name|tmp_int
operator|=
name|g_horz
expr_stmt|;
name|g_pos
operator|--
expr_stmt|;
name|g_horz
operator|=
name|scan
argument_list|(
name|g_point
argument_list|,
name|g_pos
argument_list|,
name|g_position
argument_list|)
expr_stmt|;
name|tmp_int
operator|=
name|tmp_int
operator|-
name|g_horz
expr_stmt|;
for|for
control|(
init|;
literal|0
operator|<
name|tmp_int
condition|;
name|tmp_int
operator|--
control|)
block|{
if|if
condition|(
operator|(
name|g_horz
operator|+
name|tmp_int
operator|)
operator|<
operator|(
name|last_col
operator|-
literal|1
operator|)
condition|)
block|{
name|waddch
argument_list|(
name|com_win
argument_list|,
literal|'\010'
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|com_win
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|com_win
argument_list|,
literal|'\010'
argument_list|)
expr_stmt|;
block|}
block|}
name|nam_str
operator|--
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|in
operator|!=
literal|8
operator|)
operator|&&
operator|(
name|in
operator|!=
literal|127
operator|)
operator|&&
operator|(
name|in
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|in
operator|!=
literal|'\r'
operator|)
operator|&&
operator|(
name|in
operator|<
literal|256
operator|)
condition|)
block|{
if|if
condition|(
name|in
operator|==
literal|'\026'
condition|)
comment|/* control-v, accept next character verbatim	*/
block|{
comment|/* allows entry of ^m, ^j, and ^h	*/
name|esc_flag
operator|=
name|TRUE
expr_stmt|;
name|in
operator|=
name|wgetch
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|in
operator|==
operator|-
literal|1
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
operator|*
name|nam_str
operator|=
name|in
expr_stmt|;
name|g_pos
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|in
operator|<
literal|' '
operator|)
operator|||
operator|(
name|in
operator|>
literal|126
operator|)
operator|)
operator|&&
operator|(
name|g_horz
operator|<
operator|(
name|last_col
operator|-
literal|1
operator|)
operator|)
condition|)
name|g_horz
operator|+=
name|out_char
argument_list|(
name|com_win
argument_list|,
name|in
argument_list|,
name|g_horz
argument_list|)
expr_stmt|;
else|else
block|{
name|g_horz
operator|++
expr_stmt|;
if|if
condition|(
name|g_horz
operator|<
operator|(
name|last_col
operator|-
literal|1
operator|)
condition|)
name|waddch
argument_list|(
name|com_win
argument_list|,
name|in
argument_list|)
expr_stmt|;
block|}
name|nam_str
operator|++
expr_stmt|;
block|}
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|esc_flag
condition|)
name|in
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|in
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|in
operator|!=
literal|'\r'
operator|)
condition|)
do|;
operator|*
name|nam_str
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|nam_str
operator|=
name|tmp_string
expr_stmt|;
if|if
condition|(
operator|(
operator|(
operator|*
name|nam_str
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|nam_str
operator|==
literal|9
operator|)
operator|)
operator|&&
operator|(
name|advance
operator|)
condition|)
name|nam_str
operator|=
name|next_word
argument_list|(
name|nam_str
argument_list|)
expr_stmt|;
name|string
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|nam_str
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|string
argument_list|,
name|nam_str
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|tmp_string
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
return|return
operator|(
name|string
operator|)
return|;
block|}
end_function

begin_function
name|int
name|compare
parameter_list|(
name|string1
parameter_list|,
name|string2
parameter_list|,
name|sensitive
parameter_list|)
comment|/* compare two strings	*/
name|char
modifier|*
name|string1
decl_stmt|;
name|char
modifier|*
name|string2
decl_stmt|;
name|int
name|sensitive
decl_stmt|;
block|{
name|char
modifier|*
name|strng1
decl_stmt|;
name|char
modifier|*
name|strng2
decl_stmt|;
name|int
name|tmp
decl_stmt|;
name|int
name|equal
decl_stmt|;
name|strng1
operator|=
name|string1
expr_stmt|;
name|strng2
operator|=
name|string2
expr_stmt|;
name|tmp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|strng1
operator|==
name|NULL
operator|)
operator|||
operator|(
name|strng2
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|strng1
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|||
operator|(
operator|*
name|strng2
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
name|equal
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
name|equal
condition|)
block|{
if|if
condition|(
name|sensitive
condition|)
block|{
if|if
condition|(
operator|*
name|strng1
operator|!=
operator|*
name|strng2
condition|)
name|equal
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|toupper
argument_list|(
operator|*
name|strng1
argument_list|)
operator|!=
name|toupper
argument_list|(
operator|*
name|strng2
argument_list|)
condition|)
name|equal
operator|=
name|FALSE
expr_stmt|;
block|}
name|strng1
operator|++
expr_stmt|;
name|strng2
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|strng1
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|||
operator|(
operator|*
name|strng2
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|||
operator|(
operator|*
name|strng1
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|strng2
operator|==
literal|' '
operator|)
condition|)
break|break;
name|tmp
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|equal
operator|)
return|;
block|}
end_function

begin_function
name|void
name|goto_line
parameter_list|(
name|cmd_str
parameter_list|)
name|char
modifier|*
name|cmd_str
decl_stmt|;
block|{
name|int
name|number
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
name|char
modifier|*
name|direction
decl_stmt|;
name|struct
name|text
modifier|*
name|t_line
decl_stmt|;
name|ptr
operator|=
name|cmd_str
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|ptr
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|ptr
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|i
operator|=
name|i
operator|*
literal|10
operator|+
operator|(
operator|*
name|ptr
operator|-
literal|'0'
operator|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
block|}
name|number
operator|=
name|i
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|t_line
operator|=
name|curr_line
expr_stmt|;
while|while
condition|(
operator|(
name|t_line
operator|->
name|line_number
operator|>
name|number
operator|)
operator|&&
operator|(
name|t_line
operator|->
name|prev_line
operator|!=
name|NULL
operator|)
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|t_line
operator|=
name|t_line
operator|->
name|prev_line
expr_stmt|;
name|direction
operator|=
literal|"u"
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|t_line
operator|->
name|line_number
operator|<
name|number
operator|)
operator|&&
operator|(
name|t_line
operator|->
name|next_line
operator|!=
name|NULL
operator|)
condition|)
block|{
name|i
operator|++
expr_stmt|;
name|direction
operator|=
literal|"d"
expr_stmt|;
name|t_line
operator|=
name|t_line
operator|->
name|next_line
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|i
operator|<
literal|30
operator|)
operator|&&
operator|(
name|i
operator|>
literal|0
operator|)
condition|)
block|{
name|move_rel
argument_list|(
name|direction
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|curr_line
operator|=
name|t_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|midscreen
argument_list|(
operator|(
name|last_line
operator|/
literal|2
operator|)
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
block|}
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|line_num_str
argument_list|,
name|curr_line
operator|->
name|line_number
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|midscreen
parameter_list|(
name|line
parameter_list|,
name|pnt
parameter_list|)
comment|/* put current line in middle of screen	*/
name|int
name|line
decl_stmt|;
name|char
modifier|*
name|pnt
decl_stmt|;
block|{
name|struct
name|text
modifier|*
name|mid_line
decl_stmt|;
name|int
name|i
decl_stmt|;
name|line
operator|=
name|min
argument_list|(
name|line
argument_list|,
name|last_line
argument_list|)
expr_stmt|;
name|mid_line
operator|=
name|curr_line
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
operator|(
name|i
operator|<
name|line
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
operator|)
operator|)
condition|;
name|i
operator|++
control|)
name|curr_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|scr_vert
operator|=
name|scr_horz
operator|=
literal|0
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|draw_screen
argument_list|()
expr_stmt|;
name|scr_vert
operator|=
name|i
expr_stmt|;
name|curr_line
operator|=
name|mid_line
expr_stmt|;
name|scanline
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_options
parameter_list|(
name|numargs
parameter_list|,
name|arguments
parameter_list|)
comment|/* get arguments from command line	*/
name|int
name|numargs
decl_stmt|;
name|char
modifier|*
name|arguments
index|[]
decl_stmt|;
block|{
name|char
modifier|*
name|buff
decl_stmt|;
name|int
name|count
decl_stmt|;
name|struct
name|files
modifier|*
name|temp_names
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
comment|/* 	 |	see if editor was invoked as 'ree' (restricted mode) 	 */
if|if
condition|(
operator|!
operator|(
name|name
operator|=
name|strrchr
argument_list|(
name|arguments
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
operator|)
condition|)
name|name
operator|=
name|arguments
index|[
literal|0
index|]
expr_stmt|;
else|else
name|name
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"ree"
argument_list|)
condition|)
name|restricted
operator|=
name|TRUE
expr_stmt|;
name|top_of_stack
operator|=
name|NULL
expr_stmt|;
name|input_file
operator|=
name|FALSE
expr_stmt|;
name|recv_file
operator|=
name|FALSE
expr_stmt|;
name|count
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|count
operator|<
name|numargs
condition|)
block|{
name|buff
operator|=
name|arguments
index|[
name|count
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"-i"
argument_list|,
name|buff
argument_list|)
condition|)
block|{
name|info_window
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"-e"
argument_list|,
name|buff
argument_list|)
condition|)
block|{
name|expand_tabs
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"-h"
argument_list|,
name|buff
argument_list|)
condition|)
block|{
name|nohighlight
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"-?"
argument_list|,
name|buff
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|usage0
argument_list|,
name|arguments
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|usage1
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|usage2
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|usage3
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|usage4
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|buff
operator|==
literal|'+'
condition|)
block|{
name|buff
operator|++
expr_stmt|;
name|start_at_line
operator|=
name|buff
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|top_of_stack
operator|==
name|NULL
condition|)
block|{
name|temp_names
operator|=
name|top_of_stack
operator|=
name|name_alloc
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|temp_names
operator|->
name|next_name
operator|=
name|name_alloc
argument_list|()
expr_stmt|;
name|temp_names
operator|=
name|temp_names
operator|->
name|next_name
expr_stmt|;
block|}
name|ptr
operator|=
name|temp_names
operator|->
name|name
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|buff
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|buff
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
operator|*
name|ptr
operator|=
operator|*
name|buff
expr_stmt|;
name|buff
operator|++
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
block|}
operator|*
name|ptr
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|temp_names
operator|->
name|next_name
operator|=
name|NULL
expr_stmt|;
name|input_file
operator|=
name|TRUE
expr_stmt|;
name|recv_file
operator|=
name|TRUE
expr_stmt|;
block|}
name|count
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|check_fp
parameter_list|()
comment|/* open or close files according to flags */
block|{
name|int
name|line_num
decl_stmt|;
name|int
name|temp
decl_stmt|;
name|struct
name|stat
name|buf
decl_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
name|tmp_vert
operator|=
name|scr_vert
expr_stmt|;
name|tmp_horz
operator|=
name|scr_horz
expr_stmt|;
name|tmp_line
operator|=
name|curr_line
expr_stmt|;
if|if
condition|(
name|input_file
condition|)
block|{
name|in_file_name
operator|=
name|tmp_file
operator|=
name|top_of_stack
operator|->
name|name
expr_stmt|;
name|top_of_stack
operator|=
name|top_of_stack
operator|->
name|next_name
expr_stmt|;
block|}
name|temp
operator|=
name|stat
argument_list|(
name|tmp_file
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|.
name|st_mode
operator|&=
operator|~
literal|07777
expr_stmt|;
if|if
condition|(
operator|(
name|temp
operator|!=
operator|-
literal|1
operator|)
operator|&&
operator|(
name|buf
operator|.
name|st_mode
operator|!=
literal|0100000
operator|)
operator|&&
operator|(
name|buf
operator|.
name|st_mode
operator|!=
literal|0
operator|)
condition|)
block|{
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_is_dir_msg
argument_list|,
name|tmp_file
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|input_file
condition|)
block|{
name|quit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
return|return;
block|}
if|if
condition|(
operator|(
name|get_fd
operator|=
name|open
argument_list|(
name|tmp_file
argument_list|,
name|O_RDONLY
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|input_file
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|new_file_msg
argument_list|,
name|tmp_file
argument_list|)
expr_stmt|;
else|else
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|cant_open_msg
argument_list|,
name|tmp_file
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|recv_file
operator|=
name|FALSE
expr_stmt|;
name|input_file
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
else|else
name|get_file
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
name|recv_file
operator|=
name|FALSE
expr_stmt|;
name|line_num
operator|=
name|curr_line
operator|->
name|line_number
expr_stmt|;
name|scr_vert
operator|=
name|tmp_vert
expr_stmt|;
name|scr_horz
operator|=
name|tmp_horz
expr_stmt|;
if|if
condition|(
name|input_file
condition|)
name|curr_line
operator|=
name|first_line
expr_stmt|;
else|else
name|curr_line
operator|=
name|tmp_line
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|draw_screen
argument_list|()
expr_stmt|;
if|if
condition|(
name|input_file
condition|)
block|{
name|input_file
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|start_at_line
operator|!=
name|NULL
condition|)
block|{
name|line_num
operator|=
name|atoi
argument_list|(
name|start_at_line
argument_list|)
operator|-
literal|1
expr_stmt|;
name|move_rel
argument_list|(
literal|"d"
argument_list|,
name|line_num
argument_list|)
expr_stmt|;
name|line_num
operator|=
literal|0
expr_stmt|;
name|start_at_line
operator|=
name|NULL
expr_stmt|;
block|}
block|}
else|else
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|text_changes
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|tmp_file
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|tmp_file
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_read_fin_msg
argument_list|,
name|tmp_file
argument_list|)
expr_stmt|;
block|}
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_file
parameter_list|(
name|file_name
parameter_list|)
comment|/* read specified file into current buffer	*/
name|char
modifier|*
name|file_name
decl_stmt|;
block|{
name|int
name|can_read
decl_stmt|;
comment|/* file has at least one character	*/
name|int
name|length
decl_stmt|;
comment|/* length of line read by read		*/
name|int
name|append
decl_stmt|;
comment|/* should text be appended to current line */
name|struct
name|text
modifier|*
name|temp_line
decl_stmt|;
name|char
name|ro_flag
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|recv_file
condition|)
comment|/* if reading a file			*/
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|reading_file_msg
argument_list|,
name|file_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|access
argument_list|(
name|file_name
argument_list|,
literal|2
argument_list|)
condition|)
comment|/* check permission to write */
block|{
if|if
condition|(
operator|(
name|errno
operator|==
name|ENOTDIR
operator|)
operator|||
operator|(
name|errno
operator|==
name|EACCES
operator|)
operator|||
operator|(
name|errno
operator|==
name|EROFS
operator|)
operator|||
operator|(
name|errno
operator|==
name|ETXTBSY
operator|)
operator|||
operator|(
name|errno
operator|==
name|EFAULT
operator|)
condition|)
block|{
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|read_only_msg
argument_list|)
expr_stmt|;
name|ro_flag
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|curr_line
operator|->
name|line_length
operator|>
literal|1
condition|)
comment|/* if current line is not blank	*/
block|{
name|insert_line
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|left
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|append
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
name|append
operator|=
name|TRUE
expr_stmt|;
name|can_read
operator|=
name|FALSE
expr_stmt|;
comment|/* test if file has any characters  */
while|while
condition|(
operator|(
operator|(
name|length
operator|=
name|read
argument_list|(
name|get_fd
argument_list|,
name|in_string
argument_list|,
literal|512
argument_list|)
operator|)
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|length
operator|!=
operator|-
literal|1
operator|)
condition|)
block|{
name|can_read
operator|=
name|TRUE
expr_stmt|;
comment|/* if set file has at least 1 character   */
name|get_line
argument_list|(
name|length
argument_list|,
name|in_string
argument_list|,
operator|&
name|append
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|can_read
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|line_length
operator|==
literal|1
operator|)
condition|)
block|{
name|temp_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|temp_line
operator|->
name|next_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
if|if
condition|(
name|temp_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|temp_line
operator|->
name|next_line
operator|->
name|prev_line
operator|=
name|temp_line
expr_stmt|;
if|if
condition|(
name|curr_line
operator|->
name|line
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|curr_line
operator|->
name|line
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|curr_line
argument_list|)
expr_stmt|;
name|curr_line
operator|=
name|temp_line
expr_stmt|;
block|}
if|if
condition|(
name|input_file
condition|)
comment|/* if this is the file to be edited display number of lines	*/
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_read_lines_msg
argument_list|,
name|in_file_name
argument_list|,
name|curr_line
operator|->
name|line_number
argument_list|)
expr_stmt|;
if|if
condition|(
name|ro_flag
condition|)
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|read_only_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|can_read
condition|)
comment|/* not input_file and file is non-zero size */
name|text_changes
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|recv_file
condition|)
comment|/* if reading a file			*/
block|{
name|in
operator|=
name|EOF
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|get_line
parameter_list|(
name|length
parameter_list|,
name|in_string
parameter_list|,
name|append
parameter_list|)
comment|/* read string and split into lines */
name|int
name|length
decl_stmt|;
comment|/* length of string read by read		*/
name|char
modifier|*
name|in_string
decl_stmt|;
comment|/* string read by read				*/
name|int
modifier|*
name|append
decl_stmt|;
comment|/* TRUE if must append more text to end of current line	*/
block|{
name|char
modifier|*
name|str1
decl_stmt|;
name|char
modifier|*
name|str2
decl_stmt|;
name|int
name|num
decl_stmt|;
comment|/* offset from start of string		*/
name|int
name|char_count
decl_stmt|;
comment|/* length of new line (or added portion	*/
name|int
name|temp_counter
decl_stmt|;
comment|/* temporary counter value		*/
name|struct
name|text
modifier|*
name|tline
decl_stmt|;
comment|/* temporary pointer to new line	*/
name|int
name|first_time
decl_stmt|;
comment|/* if TRUE, the first time through the loop */
name|str2
operator|=
name|in_string
expr_stmt|;
name|num
operator|=
literal|0
expr_stmt|;
name|first_time
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
name|num
operator|<
name|length
condition|)
block|{
if|if
condition|(
operator|!
name|first_time
condition|)
block|{
if|if
condition|(
name|num
operator|<
name|length
condition|)
block|{
name|str2
operator|++
expr_stmt|;
name|num
operator|++
expr_stmt|;
block|}
block|}
else|else
name|first_time
operator|=
name|FALSE
expr_stmt|;
name|str1
operator|=
name|str2
expr_stmt|;
name|char_count
operator|=
literal|1
expr_stmt|;
comment|/* find end of line	*/
while|while
condition|(
operator|(
operator|*
name|str2
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|num
operator|<
name|length
operator|)
condition|)
block|{
name|str2
operator|++
expr_stmt|;
name|num
operator|++
expr_stmt|;
name|char_count
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|append
operator|)
condition|)
comment|/* if not append to current line, insert new one */
block|{
name|tline
operator|=
name|txtalloc
argument_list|()
expr_stmt|;
comment|/* allocate data structure for next line */
name|tline
operator|->
name|line_number
operator|=
name|curr_line
operator|->
name|line_number
operator|+
literal|1
expr_stmt|;
name|tline
operator|->
name|next_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
name|tline
operator|->
name|prev_line
operator|=
name|curr_line
expr_stmt|;
name|curr_line
operator|->
name|next_line
operator|=
name|tline
expr_stmt|;
if|if
condition|(
name|tline
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|tline
operator|->
name|next_line
operator|->
name|prev_line
operator|=
name|tline
expr_stmt|;
name|curr_line
operator|=
name|tline
expr_stmt|;
name|curr_line
operator|->
name|line
operator|=
name|point
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|char_count
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|=
name|char_count
expr_stmt|;
name|curr_line
operator|->
name|max_length
operator|=
name|char_count
expr_stmt|;
block|}
else|else
block|{
name|point
operator|=
name|resiz_line
argument_list|(
name|char_count
argument_list|,
name|curr_line
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|+=
operator|(
name|char_count
operator|-
literal|1
operator|)
expr_stmt|;
block|}
for|for
control|(
name|temp_counter
operator|=
literal|1
init|;
name|temp_counter
operator|<
name|char_count
condition|;
name|temp_counter
operator|++
control|)
block|{
operator|*
name|point
operator|=
operator|*
name|str1
expr_stmt|;
name|point
operator|++
expr_stmt|;
name|str1
operator|++
expr_stmt|;
block|}
operator|*
name|point
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
operator|*
name|append
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|num
operator|==
name|length
operator|)
operator|&&
operator|(
operator|*
name|str2
operator|!=
literal|'\n'
operator|)
condition|)
operator|*
name|append
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|draw_screen
parameter_list|()
comment|/* redraw the screen from current postion	*/
block|{
name|struct
name|text
modifier|*
name|temp_line
decl_stmt|;
name|char
modifier|*
name|line_out
decl_stmt|;
name|int
name|temp_vert
decl_stmt|;
name|temp_line
operator|=
name|curr_line
expr_stmt|;
name|temp_vert
operator|=
name|scr_vert
expr_stmt|;
name|wclrtobot
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|temp_line
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|temp_vert
operator|<=
name|last_line
operator|)
condition|)
block|{
name|line_out
operator|=
name|temp_line
operator|->
name|line
expr_stmt|;
name|draw_line
argument_list|(
name|temp_vert
argument_list|,
literal|0
argument_list|,
name|line_out
argument_list|,
literal|1
argument_list|,
name|temp_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|temp_vert
operator|++
expr_stmt|;
name|temp_line
operator|=
name|temp_line
operator|->
name|next_line
expr_stmt|;
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|temp_vert
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|finish
parameter_list|()
comment|/* prepare to exit edit session	*/
block|{
name|char
modifier|*
name|file_name
init|=
name|in_file_name
decl_stmt|;
comment|/* 	 |	changes made here should be reflected in the 'save'  	 |	portion of file_op() 	 */
if|if
condition|(
operator|(
name|file_name
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|file_name
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|file_name
operator|=
name|get_string
argument_list|(
name|save_file_name_prompt
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|file_name
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|file_name
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_not_saved_msg
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|file_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|file_name
condition|)
block|{
name|free
argument_list|(
name|file_name
argument_list|)
expr_stmt|;
name|file_name
operator|=
name|tmp_file
expr_stmt|;
block|}
if|if
condition|(
name|write_file
argument_list|(
name|file_name
argument_list|)
condition|)
block|{
name|text_changes
operator|=
name|FALSE
expr_stmt|;
name|quit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|quit
parameter_list|(
name|noverify
parameter_list|)
comment|/* exit editor			*/
name|int
name|noverify
decl_stmt|;
block|{
name|char
modifier|*
name|ans
decl_stmt|;
name|touchwin
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|text_changes
operator|)
operator|&&
operator|(
operator|!
name|noverify
operator|)
condition|)
block|{
name|ans
operator|=
name|get_string
argument_list|(
name|changes_made_prompt
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|toupper
argument_list|(
operator|*
name|ans
argument_list|)
operator|==
name|toupper
argument_list|(
operator|*
name|yes_char
argument_list|)
condition|)
name|text_changes
operator|=
name|FALSE
expr_stmt|;
else|else
return|return
operator|(
literal|0
operator|)
return|;
name|free
argument_list|(
name|ans
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|top_of_stack
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|info_window
condition|)
name|wrefresh
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|resetty
argument_list|()
expr_stmt|;
name|endwin
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|delete_text
argument_list|()
expr_stmt|;
name|recv_file
operator|=
name|TRUE
expr_stmt|;
name|input_file
operator|=
name|TRUE
expr_stmt|;
name|check_fp
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|edit_abort
parameter_list|(
name|arg
parameter_list|)
name|int
name|arg
decl_stmt|;
block|{
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|resetty
argument_list|()
expr_stmt|;
name|endwin
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|delete_text
parameter_list|()
block|{
while|while
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
name|curr_line
operator|=
name|curr_line
operator|->
name|next_line
expr_stmt|;
while|while
condition|(
name|curr_line
operator|!=
name|first_line
condition|)
block|{
name|free
argument_list|(
name|curr_line
operator|->
name|line
argument_list|)
expr_stmt|;
name|curr_line
operator|=
name|curr_line
operator|->
name|prev_line
expr_stmt|;
name|free
argument_list|(
name|curr_line
operator|->
name|next_line
argument_list|)
expr_stmt|;
block|}
name|curr_line
operator|->
name|next_line
operator|=
name|NULL
expr_stmt|;
operator|*
name|curr_line
operator|->
name|line
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|=
literal|1
expr_stmt|;
name|curr_line
operator|->
name|line_number
operator|=
literal|1
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|scr_pos
operator|=
name|scr_vert
operator|=
name|scr_horz
operator|=
literal|0
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|int
name|write_file
parameter_list|(
name|file_name
parameter_list|)
name|char
modifier|*
name|file_name
decl_stmt|;
block|{
name|char
name|cr
decl_stmt|;
name|char
modifier|*
name|tmp_point
decl_stmt|;
name|struct
name|text
modifier|*
name|out_line
decl_stmt|;
name|int
name|lines
decl_stmt|,
name|charac
decl_stmt|;
name|int
name|temp_pos
decl_stmt|;
name|int
name|write_flag
init|=
name|TRUE
decl_stmt|;
name|charac
operator|=
name|lines
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|in_file_name
operator|==
name|NULL
operator|)
operator|||
name|strcmp
argument_list|(
name|in_file_name
argument_list|,
name|file_name
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|temp_fp
operator|=
name|fopen
argument_list|(
name|file_name
argument_list|,
literal|"r"
argument_list|)
operator|)
condition|)
block|{
name|tmp_point
operator|=
name|get_string
argument_list|(
name|file_exists_prompt
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|toupper
argument_list|(
operator|*
name|tmp_point
argument_list|)
operator|==
name|toupper
argument_list|(
operator|*
name|yes_char
argument_list|)
condition|)
name|write_flag
operator|=
name|TRUE
expr_stmt|;
else|else
name|write_flag
operator|=
name|FALSE
expr_stmt|;
name|fclose
argument_list|(
name|temp_fp
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|tmp_point
argument_list|)
expr_stmt|;
block|}
block|}
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|write_flag
condition|)
block|{
if|if
condition|(
operator|(
name|temp_fp
operator|=
name|fopen
argument_list|(
name|file_name
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|create_file_fail_msg
argument_list|,
name|file_name
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
else|else
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|writing_file_msg
argument_list|,
name|file_name
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|cr
operator|=
literal|'\n'
expr_stmt|;
name|out_line
operator|=
name|first_line
expr_stmt|;
while|while
condition|(
name|out_line
operator|!=
name|NULL
condition|)
block|{
name|temp_pos
operator|=
literal|1
expr_stmt|;
name|tmp_point
operator|=
name|out_line
operator|->
name|line
expr_stmt|;
while|while
condition|(
name|temp_pos
operator|<
name|out_line
operator|->
name|line_length
condition|)
block|{
name|putc
argument_list|(
operator|*
name|tmp_point
argument_list|,
name|temp_fp
argument_list|)
expr_stmt|;
name|tmp_point
operator|++
expr_stmt|;
name|temp_pos
operator|++
expr_stmt|;
block|}
name|charac
operator|+=
name|out_line
operator|->
name|line_length
expr_stmt|;
name|out_line
operator|=
name|out_line
operator|->
name|next_line
expr_stmt|;
name|putc
argument_list|(
name|cr
argument_list|,
name|temp_fp
argument_list|)
expr_stmt|;
name|lines
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|temp_fp
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_written_msg
argument_list|,
name|file_name
argument_list|,
name|lines
argument_list|,
name|charac
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
block|}
else|else
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
name|int
name|search
parameter_list|(
name|display_message
parameter_list|)
comment|/* search for string in srch_str	*/
name|int
name|display_message
decl_stmt|;
block|{
name|int
name|lines_moved
decl_stmt|;
name|int
name|iter
decl_stmt|;
name|int
name|found
decl_stmt|;
if|if
condition|(
operator|(
name|srch_str
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|srch_str
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
if|if
condition|(
name|display_message
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|searching_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
block|}
name|lines_moved
operator|=
literal|0
expr_stmt|;
name|found
operator|=
name|FALSE
expr_stmt|;
name|srch_line
operator|=
name|curr_line
expr_stmt|;
name|srch_1
operator|=
name|point
expr_stmt|;
if|if
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
name|srch_1
operator|++
expr_stmt|;
name|iter
operator|=
name|position
operator|+
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|!
name|found
operator|)
operator|&&
operator|(
name|srch_line
operator|!=
name|NULL
operator|)
condition|)
block|{
while|while
condition|(
operator|(
name|iter
operator|<
name|srch_line
operator|->
name|line_length
operator|)
operator|&&
operator|(
operator|!
name|found
operator|)
condition|)
block|{
name|srch_2
operator|=
name|srch_1
expr_stmt|;
if|if
condition|(
name|case_sen
condition|)
comment|/* if case sensitive		*/
block|{
name|srch_3
operator|=
name|srch_str
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|srch_2
operator|==
operator|*
name|srch_3
operator|)
operator|&&
operator|(
operator|*
name|srch_3
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|srch_2
operator|++
expr_stmt|;
name|srch_3
operator|++
expr_stmt|;
block|}
comment|/* end while	*/
block|}
else|else
comment|/* if not case sensitive	*/
block|{
name|srch_3
operator|=
name|u_srch_str
expr_stmt|;
while|while
condition|(
operator|(
name|toupper
argument_list|(
operator|*
name|srch_2
argument_list|)
operator|==
operator|*
name|srch_3
operator|)
operator|&&
operator|(
operator|*
name|srch_3
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|srch_2
operator|++
expr_stmt|;
name|srch_3
operator|++
expr_stmt|;
block|}
block|}
comment|/* end else	*/
if|if
condition|(
operator|!
operator|(
operator|(
operator|*
name|srch_3
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|found
operator|)
operator|)
condition|)
block|{
name|found
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|iter
operator|<
name|srch_line
operator|->
name|line_length
condition|)
name|srch_1
operator|++
expr_stmt|;
name|iter
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|srch_line
operator|=
name|srch_line
operator|->
name|next_line
expr_stmt|;
if|if
condition|(
name|srch_line
operator|!=
name|NULL
condition|)
name|srch_1
operator|=
name|srch_line
operator|->
name|line
expr_stmt|;
name|iter
operator|=
literal|1
expr_stmt|;
name|lines_moved
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|found
condition|)
block|{
if|if
condition|(
name|display_message
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|lines_moved
operator|==
literal|0
condition|)
block|{
while|while
condition|(
name|position
operator|<
name|iter
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|lines_moved
operator|<
literal|30
condition|)
block|{
name|move_rel
argument_list|(
literal|"d"
argument_list|,
name|lines_moved
argument_list|)
expr_stmt|;
while|while
condition|(
name|position
operator|<
name|iter
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|curr_line
operator|=
name|srch_line
expr_stmt|;
name|point
operator|=
name|srch_1
expr_stmt|;
name|position
operator|=
name|iter
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
expr_stmt|;
name|midscreen
argument_list|(
operator|(
name|last_line
operator|/
literal|2
operator|)
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|display_message
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|str_not_found_msg
argument_list|,
name|srch_str
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|found
operator|)
return|;
block|}
end_function

begin_function
name|void
name|search_prompt
parameter_list|()
comment|/* prompt and read search string (srch_str)	*/
block|{
if|if
condition|(
name|srch_str
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|srch_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|u_srch_str
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|u_srch_str
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|free
argument_list|(
name|u_srch_str
argument_list|)
expr_stmt|;
name|srch_str
operator|=
name|get_string
argument_list|(
name|search_prompt_str
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gold
operator|=
name|FALSE
expr_stmt|;
name|srch_3
operator|=
name|srch_str
expr_stmt|;
name|srch_1
operator|=
name|u_srch_str
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|srch_str
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|srch_3
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
operator|*
name|srch_1
operator|=
name|toupper
argument_list|(
operator|*
name|srch_3
argument_list|)
expr_stmt|;
name|srch_1
operator|++
expr_stmt|;
name|srch_3
operator|++
expr_stmt|;
block|}
operator|*
name|srch_1
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|search
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|del_char
parameter_list|()
comment|/* delete current character	*/
block|{
name|in
operator|=
literal|8
expr_stmt|;
comment|/* backspace */
if|if
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
comment|/* if not end of line	*/
block|{
name|position
operator|++
expr_stmt|;
name|point
operator|++
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|delete
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|right
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|delete
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|undel_char
parameter_list|()
comment|/* undelete last deleted character	*/
block|{
if|if
condition|(
name|d_char
operator|==
literal|'\n'
condition|)
comment|/* insert line if last del_char deleted eol */
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
else|else
block|{
name|in
operator|=
name|d_char
expr_stmt|;
name|insert
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|del_word
parameter_list|()
comment|/* delete word in front of cursor	*/
block|{
name|int
name|tposit
decl_stmt|;
name|int
name|difference
decl_stmt|;
name|char
modifier|*
name|d_word2
decl_stmt|;
name|char
modifier|*
name|d_word3
decl_stmt|;
name|char
name|tmp_char
decl_stmt|;
if|if
condition|(
name|d_word
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|d_word
argument_list|)
expr_stmt|;
name|d_word
operator|=
name|malloc
argument_list|(
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|tmp_char
operator|=
name|d_char
expr_stmt|;
name|d_word3
operator|=
name|point
expr_stmt|;
name|d_word2
operator|=
name|d_word
expr_stmt|;
name|tposit
operator|=
name|position
expr_stmt|;
while|while
condition|(
operator|(
name|tposit
operator|<
name|curr_line
operator|->
name|line_length
operator|)
operator|&&
operator|(
operator|(
operator|*
name|d_word3
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|d_word3
operator|!=
literal|'\t'
operator|)
operator|)
condition|)
block|{
name|tposit
operator|++
expr_stmt|;
operator|*
name|d_word2
operator|=
operator|*
name|d_word3
expr_stmt|;
name|d_word2
operator|++
expr_stmt|;
name|d_word3
operator|++
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|tposit
operator|<
name|curr_line
operator|->
name|line_length
operator|)
operator|&&
operator|(
operator|(
operator|*
name|d_word3
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|d_word3
operator|==
literal|'\t'
operator|)
operator|)
condition|)
block|{
name|tposit
operator|++
expr_stmt|;
operator|*
name|d_word2
operator|=
operator|*
name|d_word3
expr_stmt|;
name|d_word2
operator|++
expr_stmt|;
name|d_word3
operator|++
expr_stmt|;
block|}
operator|*
name|d_word2
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|d_wrd_len
operator|=
name|difference
operator|=
name|d_word2
operator|-
name|d_word
expr_stmt|;
name|d_word2
operator|=
name|point
expr_stmt|;
while|while
condition|(
name|tposit
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|tposit
operator|++
expr_stmt|;
operator|*
name|d_word2
operator|=
operator|*
name|d_word3
expr_stmt|;
name|d_word2
operator|++
expr_stmt|;
name|d_word3
operator|++
expr_stmt|;
block|}
name|curr_line
operator|->
name|line_length
operator|-=
name|difference
expr_stmt|;
operator|*
name|d_word2
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|d_char
operator|=
name|tmp_char
expr_stmt|;
name|text_changes
operator|=
name|TRUE
expr_stmt|;
name|formatted
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|undel_word
parameter_list|()
comment|/* undelete last deleted word		*/
block|{
name|int
name|temp
decl_stmt|;
name|int
name|tposit
decl_stmt|;
name|char
modifier|*
name|tmp_old_ptr
decl_stmt|;
name|char
modifier|*
name|tmp_space
decl_stmt|;
name|char
modifier|*
name|tmp_ptr
decl_stmt|;
name|char
modifier|*
name|d_word_ptr
decl_stmt|;
comment|/* 	 |	resize line to handle undeleted word 	 */
if|if
condition|(
operator|(
name|curr_line
operator|->
name|max_length
operator|-
operator|(
name|curr_line
operator|->
name|line_length
operator|+
name|d_wrd_len
operator|)
operator|)
operator|<
literal|5
condition|)
name|point
operator|=
name|resiz_line
argument_list|(
name|d_wrd_len
argument_list|,
name|curr_line
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|tmp_ptr
operator|=
name|tmp_space
operator|=
name|malloc
argument_list|(
name|curr_line
operator|->
name|line_length
operator|+
name|d_wrd_len
argument_list|)
expr_stmt|;
name|d_word_ptr
operator|=
name|d_word
expr_stmt|;
name|temp
operator|=
literal|1
expr_stmt|;
comment|/* 	 |	copy d_word contents into temp space 	 */
while|while
condition|(
name|temp
operator|<=
name|d_wrd_len
condition|)
block|{
name|temp
operator|++
expr_stmt|;
operator|*
name|tmp_ptr
operator|=
operator|*
name|d_word_ptr
expr_stmt|;
name|tmp_ptr
operator|++
expr_stmt|;
name|d_word_ptr
operator|++
expr_stmt|;
block|}
name|tmp_old_ptr
operator|=
name|point
expr_stmt|;
name|tposit
operator|=
name|position
expr_stmt|;
comment|/* 	 |	copy contents of line from curent position to eol into  	 |	temp space 	 */
while|while
condition|(
name|tposit
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|temp
operator|++
expr_stmt|;
name|tposit
operator|++
expr_stmt|;
operator|*
name|tmp_ptr
operator|=
operator|*
name|tmp_old_ptr
expr_stmt|;
name|tmp_ptr
operator|++
expr_stmt|;
name|tmp_old_ptr
operator|++
expr_stmt|;
block|}
name|curr_line
operator|->
name|line_length
operator|+=
name|d_wrd_len
expr_stmt|;
name|tmp_old_ptr
operator|=
name|point
expr_stmt|;
operator|*
name|tmp_ptr
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|tmp_ptr
operator|=
name|tmp_space
expr_stmt|;
name|tposit
operator|=
literal|1
expr_stmt|;
comment|/* 	 |	now copy contents from temp space back to original line 	 */
while|while
condition|(
name|tposit
operator|<
name|temp
condition|)
block|{
name|tposit
operator|++
expr_stmt|;
operator|*
name|tmp_old_ptr
operator|=
operator|*
name|tmp_ptr
expr_stmt|;
name|tmp_ptr
operator|++
expr_stmt|;
name|tmp_old_ptr
operator|++
expr_stmt|;
block|}
operator|*
name|tmp_old_ptr
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|free
argument_list|(
name|tmp_space
argument_list|)
expr_stmt|;
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|del_line
parameter_list|()
comment|/* delete from cursor to end of line	*/
block|{
name|char
modifier|*
name|dl1
decl_stmt|;
name|char
modifier|*
name|dl2
decl_stmt|;
name|int
name|tposit
decl_stmt|;
if|if
condition|(
name|d_line
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|d_line
argument_list|)
expr_stmt|;
name|d_line
operator|=
name|malloc
argument_list|(
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
name|dl1
operator|=
name|d_line
expr_stmt|;
name|dl2
operator|=
name|point
expr_stmt|;
name|tposit
operator|=
name|position
expr_stmt|;
while|while
condition|(
name|tposit
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
operator|*
name|dl1
operator|=
operator|*
name|dl2
expr_stmt|;
name|dl1
operator|++
expr_stmt|;
name|dl2
operator|++
expr_stmt|;
name|tposit
operator|++
expr_stmt|;
block|}
name|dlt_line
operator|->
name|line_length
operator|=
literal|1
operator|+
name|tposit
operator|-
name|position
expr_stmt|;
operator|*
name|dl1
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
operator|*
name|point
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|=
name|position
expr_stmt|;
name|wclrtoeol
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
block|{
name|right
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|delete
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
block|}
name|text_changes
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|undel_line
parameter_list|()
comment|/* undelete last deleted line		*/
block|{
name|char
modifier|*
name|ud1
decl_stmt|;
name|char
modifier|*
name|ud2
decl_stmt|;
name|int
name|tposit
decl_stmt|;
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|point
operator|=
name|resiz_line
argument_list|(
name|dlt_line
operator|->
name|line_length
argument_list|,
name|curr_line
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|curr_line
operator|->
name|line_length
operator|+=
name|dlt_line
operator|->
name|line_length
operator|-
literal|1
expr_stmt|;
name|ud1
operator|=
name|point
expr_stmt|;
name|ud2
operator|=
name|d_line
expr_stmt|;
name|tposit
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|tposit
operator|<
name|dlt_line
operator|->
name|line_length
condition|)
block|{
name|tposit
operator|++
expr_stmt|;
operator|*
name|ud1
operator|=
operator|*
name|ud2
expr_stmt|;
name|ud1
operator|++
expr_stmt|;
name|ud2
operator|++
expr_stmt|;
block|}
operator|*
name|ud1
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|draw_line
argument_list|(
name|scr_vert
argument_list|,
name|scr_horz
argument_list|,
name|point
argument_list|,
name|position
argument_list|,
name|curr_line
operator|->
name|line_length
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|adv_word
parameter_list|()
comment|/* advance to next word		*/
block|{
while|while
condition|(
operator|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|!=
literal|32
operator|)
operator|&&
operator|(
operator|*
name|point
operator|!=
literal|9
operator|)
operator|)
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|==
literal|32
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|9
operator|)
operator|)
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|move_rel
parameter_list|(
name|direction
parameter_list|,
name|lines
parameter_list|)
comment|/* move relative to current line	*/
name|char
modifier|*
name|direction
decl_stmt|;
name|int
name|lines
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|tmp
decl_stmt|;
if|if
condition|(
operator|*
name|direction
operator|==
literal|'u'
condition|)
block|{
name|scr_pos
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|position
operator|>
literal|1
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|lines
condition|;
name|i
operator|++
control|)
block|{
name|up
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|last_line
operator|>
literal|5
operator|)
operator|&&
operator|(
name|scr_vert
operator|<
literal|4
operator|)
condition|)
block|{
name|tmp
operator|=
name|point
expr_stmt|;
name|tmp_line
operator|=
name|curr_line
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
literal|5
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|up
argument_list|()
expr_stmt|;
block|}
name|scr_vert
operator|=
name|scr_vert
operator|+
name|i
expr_stmt|;
name|curr_line
operator|=
name|tmp_line
expr_stmt|;
name|point
operator|=
name|tmp
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
operator|)
condition|)
block|{
name|nextline
argument_list|()
expr_stmt|;
name|scr_pos
operator|=
name|scr_horz
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|horiz_offset
condition|)
block|{
name|horiz_offset
operator|=
literal|0
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|adv_line
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|lines
condition|;
name|i
operator|++
control|)
block|{
name|down
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|last_line
operator|>
literal|10
operator|)
operator|&&
operator|(
name|scr_vert
operator|>
operator|(
name|last_line
operator|-
literal|5
operator|)
operator|)
condition|)
block|{
name|tmp
operator|=
name|point
expr_stmt|;
name|tmp_line
operator|=
name|curr_line
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
literal|5
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|down
argument_list|()
expr_stmt|;
block|}
name|scr_vert
operator|=
name|scr_vert
operator|-
name|i
expr_stmt|;
name|curr_line
operator|=
name|tmp_line
expr_stmt|;
name|point
operator|=
name|tmp
expr_stmt|;
name|scanline
argument_list|(
name|point
argument_list|)
expr_stmt|;
block|}
block|}
name|wmove
argument_list|(
name|text_win
argument_list|,
name|scr_vert
argument_list|,
operator|(
name|scr_horz
operator|-
name|horiz_offset
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|eol
parameter_list|()
comment|/* go to end of line			*/
block|{
if|if
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
block|{
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|bol
parameter_list|()
comment|/* move to beginning of line	*/
block|{
if|if
condition|(
name|point
operator|!=
name|curr_line
operator|->
name|line
condition|)
block|{
while|while
condition|(
name|point
operator|!=
name|curr_line
operator|->
name|line
condition|)
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|scr_pos
operator|=
literal|0
expr_stmt|;
name|up
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|adv_line
parameter_list|()
comment|/* advance to beginning of next line	*/
block|{
if|if
condition|(
operator|(
name|point
operator|!=
name|curr_line
operator|->
name|line
operator|)
operator|||
operator|(
name|scr_pos
operator|>
literal|0
operator|)
condition|)
block|{
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
condition|)
block|{
name|scr_pos
operator|=
literal|0
expr_stmt|;
name|down
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|sh_command
parameter_list|(
name|string
parameter_list|)
comment|/* execute shell command			*/
name|char
modifier|*
name|string
decl_stmt|;
comment|/* string containing user command		*/
block|{
name|char
modifier|*
name|temp_point
decl_stmt|;
name|char
modifier|*
name|last_slash
decl_stmt|;
name|char
modifier|*
name|path
decl_stmt|;
comment|/* directory path to executable		*/
name|int
name|parent
decl_stmt|;
comment|/* zero if child, child's pid if parent	*/
name|int
name|value
decl_stmt|;
name|int
name|return_val
decl_stmt|;
name|struct
name|text
modifier|*
name|line_holder
decl_stmt|;
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|path
operator|=
name|getenv
argument_list|(
literal|"SHELL"
argument_list|)
operator|)
condition|)
name|path
operator|=
literal|"/bin/sh"
expr_stmt|;
name|last_slash
operator|=
name|temp_point
operator|=
name|path
expr_stmt|;
while|while
condition|(
operator|*
name|temp_point
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|temp_point
operator|==
literal|'/'
condition|)
name|last_slash
operator|=
operator|++
name|temp_point
expr_stmt|;
else|else
name|temp_point
operator|++
expr_stmt|;
block|}
comment|/* 	 |	if in_pipe is true, then output of the shell operation will be  	 |	read by the editor, and curses doesn't need to be turned off 	 */
if|if
condition|(
operator|!
name|in_pipe
condition|)
block|{
name|keypad
argument_list|(
name|com_win
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|text_win
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|echo
argument_list|()
expr_stmt|;
name|nl
argument_list|()
expr_stmt|;
name|noraw
argument_list|()
expr_stmt|;
name|resetty
argument_list|()
expr_stmt|;
ifndef|#
directive|ifndef
name|NCURSE
name|endwin
argument_list|()
expr_stmt|;
endif|#
directive|endif
block|}
if|if
condition|(
name|in_pipe
condition|)
block|{
name|pipe
argument_list|(
name|pipe_in
argument_list|)
expr_stmt|;
comment|/* create a pipe	*/
name|parent
operator|=
name|fork
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|parent
condition|)
comment|/* if the child		*/
block|{
comment|/*  |  child process which will fork and exec shell command (if shell output is  |  to be read by editor)  */
name|in_pipe
operator|=
name|FALSE
expr_stmt|;
comment|/*  |  redirect stdout to pipe  */
name|temp_stdout
operator|=
name|dup
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|dup
argument_list|(
name|pipe_in
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/*  |  redirect stderr to pipe  */
name|temp_stderr
operator|=
name|dup
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|dup
argument_list|(
name|pipe_in
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|pipe_in
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
comment|/* 			 |	child will now continue down 'if (!in_pipe)'  			 |	path below 			 */
block|}
else|else
comment|/* if the parent	*/
block|{
comment|/*  |  prepare editor to read from the pipe  */
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|line_holder
operator|=
name|curr_line
expr_stmt|;
name|tmp_vert
operator|=
name|scr_vert
expr_stmt|;
name|close
argument_list|(
name|pipe_in
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|get_fd
operator|=
name|pipe_in
index|[
literal|0
index|]
expr_stmt|;
name|get_file
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|pipe_in
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|scr_vert
operator|=
name|tmp_vert
expr_stmt|;
name|scr_horz
operator|=
name|scr_pos
operator|=
literal|0
expr_stmt|;
name|position
operator|=
literal|1
expr_stmt|;
name|curr_line
operator|=
name|line_holder
expr_stmt|;
name|point
operator|=
name|curr_line
operator|->
name|line
expr_stmt|;
name|out_pipe
operator|=
name|FALSE
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
comment|/*  |  since flag "in_pipe" is still TRUE, the path which waits for the child   |  process to die will be avoided.  |  (the pipe is closed, no more output can be expected)  */
block|}
block|}
if|if
condition|(
operator|!
name|in_pipe
condition|)
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
if|if
condition|(
name|out_pipe
condition|)
block|{
name|pipe
argument_list|(
name|pipe_out
argument_list|)
expr_stmt|;
block|}
comment|/*  |  fork process which will exec command  */
name|parent
operator|=
name|fork
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|parent
condition|)
comment|/* if the child	*/
block|{
if|if
condition|(
name|shell_fork
condition|)
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
if|if
condition|(
name|out_pipe
condition|)
block|{
comment|/*  |  prepare the child process (soon to exec a shell command) to read from the   |  pipe (which will be output from the editor's buffer)  */
name|close
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|dup
argument_list|(
name|pipe_out
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|pipe_out
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|pipe_out
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|value
operator|=
literal|1
init|;
name|value
operator|<
literal|24
condition|;
name|value
operator|++
control|)
name|signal
argument_list|(
name|value
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
name|execl
argument_list|(
name|path
argument_list|,
name|last_slash
argument_list|,
literal|"-c"
argument_list|,
name|string
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|errx
argument_list|(
literal|1
argument_list|,
name|exec_err_msg
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* if the parent	*/
block|{
if|if
condition|(
name|out_pipe
condition|)
block|{
comment|/*  |  output the contents of the buffer to the pipe (to be read by the   |  process forked and exec'd above as stdin)  */
name|close
argument_list|(
name|pipe_out
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|line_holder
operator|=
name|first_line
expr_stmt|;
while|while
condition|(
name|line_holder
operator|!=
name|NULL
condition|)
block|{
name|write
argument_list|(
name|pipe_out
index|[
literal|1
index|]
argument_list|,
name|line_holder
operator|->
name|line
argument_list|,
operator|(
name|line_holder
operator|->
name|line_length
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|write
argument_list|(
name|pipe_out
index|[
literal|1
index|]
argument_list|,
literal|"\n"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|line_holder
operator|=
name|line_holder
operator|->
name|next_line
expr_stmt|;
block|}
name|close
argument_list|(
name|pipe_out
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|out_pipe
operator|=
name|FALSE
expr_stmt|;
block|}
do|do
block|{
name|return_val
operator|=
name|wait
argument_list|(
operator|(
name|int
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|return_val
operator|!=
name|parent
operator|)
operator|&&
operator|(
name|return_val
operator|!=
operator|-
literal|1
operator|)
condition|)
do|;
comment|/*  |  if this process is actually the child of the editor, exit.  Here's how it   |  works:  |  The editor forks a process.  If output must be sent to the command to be   |  exec'd another process is forked, and that process (the child's child)   |  will exec the command.  In this case, "shell_fork" will be FALSE.  If no   |  output is to be performed to the shell command, "shell_fork" will be TRUE.  |  If this is the editor process, shell_fork will be true, otherwise this is   |  the child of the edit process.  */
if|if
condition|(
operator|!
name|shell_fork
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|edit_abort
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|shell_fork
condition|)
block|{
name|printf
argument_list|(
name|continue_msg
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|in
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
empty_stmt|;
block|}
if|if
condition|(
operator|!
name|in_pipe
condition|)
block|{
name|fixterm
argument_list|()
expr_stmt|;
name|noecho
argument_list|()
expr_stmt|;
name|nonl
argument_list|()
expr_stmt|;
name|raw
argument_list|()
expr_stmt|;
name|keypad
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|com_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|info_window
condition|)
name|clearok
argument_list|(
name|info_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|set_up_term
parameter_list|()
comment|/* set up the terminal for operating with ae	*/
block|{
if|if
condition|(
operator|!
name|curses_initialized
condition|)
block|{
name|initscr
argument_list|()
expr_stmt|;
name|savetty
argument_list|()
expr_stmt|;
name|noecho
argument_list|()
expr_stmt|;
name|raw
argument_list|()
expr_stmt|;
name|nonl
argument_list|()
expr_stmt|;
name|curses_initialized
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|(
name|LINES
operator|>
literal|15
operator|)
operator|&&
operator|(
name|COLS
operator|>=
literal|80
operator|)
operator|)
operator|&&
name|info_window
condition|)
name|last_line
operator|=
name|LINES
operator|-
literal|8
expr_stmt|;
else|else
block|{
name|info_window
operator|=
name|FALSE
expr_stmt|;
name|last_line
operator|=
name|LINES
operator|-
literal|2
expr_stmt|;
block|}
name|idlok
argument_list|(
name|stdscr
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|com_win
operator|=
name|newwin
argument_list|(
literal|1
argument_list|,
name|COLS
argument_list|,
operator|(
name|LINES
operator|-
literal|1
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|com_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|idlok
argument_list|(
name|com_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|info_window
condition|)
name|text_win
operator|=
name|newwin
argument_list|(
operator|(
name|LINES
operator|-
literal|1
operator|)
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|text_win
operator|=
name|newwin
argument_list|(
operator|(
name|LINES
operator|-
literal|7
operator|)
argument_list|,
name|COLS
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|idlok
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|help_win
operator|=
name|newwin
argument_list|(
operator|(
name|LINES
operator|-
literal|1
operator|)
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|help_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|idlok
argument_list|(
name|help_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|info_window
condition|)
block|{
name|info_type
operator|=
name|CONTROL_KEYS
expr_stmt|;
name|info_win
operator|=
name|newwin
argument_list|(
literal|6
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
block|}
name|last_col
operator|=
name|COLS
operator|-
literal|1
expr_stmt|;
name|local_LINES
operator|=
name|LINES
expr_stmt|;
name|local_COLS
operator|=
name|COLS
expr_stmt|;
block|}
end_function

begin_function
name|void
name|resize_check
parameter_list|()
block|{
if|if
condition|(
operator|(
name|LINES
operator|==
name|local_LINES
operator|)
operator|&&
operator|(
name|COLS
operator|==
name|local_COLS
operator|)
condition|)
return|return;
if|if
condition|(
name|info_window
condition|)
name|delwin
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|help_win
argument_list|)
expr_stmt|;
name|set_up_term
argument_list|()
expr_stmt|;
name|redraw
argument_list|()
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
name|item_alpha
index|[]
init|=
literal|"abcdefghijklmnopqrstuvwxyz0123456789 "
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|menu_op
parameter_list|(
name|menu_list
parameter_list|)
name|struct
name|menu_entries
name|menu_list
index|[]
decl_stmt|;
block|{
name|WINDOW
modifier|*
name|temp_win
decl_stmt|;
name|int
name|max_width
decl_stmt|,
name|max_height
decl_stmt|;
name|int
name|x_off
decl_stmt|,
name|y_off
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|int
name|length
decl_stmt|;
name|int
name|input
decl_stmt|;
name|int
name|temp
decl_stmt|;
name|int
name|list_size
decl_stmt|;
name|int
name|top_offset
decl_stmt|;
comment|/* offset from top where menu items start */
name|int
name|vert_pos
decl_stmt|;
comment|/* vertical position			  */
name|int
name|vert_size
decl_stmt|;
comment|/* vertical size for menu list item display */
name|int
name|off_start
init|=
literal|1
decl_stmt|;
comment|/* offset from start of menu items to start display */
comment|/* 	 |	determine number and width of menu items 	 */
name|list_size
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|menu_list
index|[
name|list_size
operator|+
literal|1
index|]
operator|.
name|item_string
operator|!=
name|NULL
condition|)
name|list_size
operator|++
expr_stmt|;
name|max_width
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<=
name|list_size
condition|;
name|counter
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|length
operator|=
name|strlen
argument_list|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|item_string
argument_list|)
operator|)
operator|>
name|max_width
condition|)
name|max_width
operator|=
name|length
expr_stmt|;
block|}
name|max_width
operator|+=
literal|3
expr_stmt|;
name|max_width
operator|=
name|max
argument_list|(
name|max_width
argument_list|,
name|strlen
argument_list|(
name|cancel_string
argument_list|)
argument_list|)
expr_stmt|;
name|max_width
operator|=
name|max
argument_list|(
name|max_width
argument_list|,
name|max
argument_list|(
name|strlen
argument_list|(
name|more_above_str
argument_list|)
argument_list|,
name|strlen
argument_list|(
name|more_below_str
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|max_width
operator|+=
literal|6
expr_stmt|;
comment|/* 	 |	make sure that window is large enough to handle menu 	 |	if not, print error message and return to calling function 	 */
if|if
condition|(
name|max_width
operator|>
name|COLS
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|menu_too_lrg_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|top_offset
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|list_size
operator|>
name|LINES
condition|)
block|{
name|max_height
operator|=
name|LINES
expr_stmt|;
if|if
condition|(
name|max_height
operator|>
literal|11
condition|)
name|vert_size
operator|=
name|max_height
operator|-
literal|8
expr_stmt|;
else|else
name|vert_size
operator|=
name|max_height
expr_stmt|;
block|}
else|else
block|{
name|vert_size
operator|=
name|list_size
expr_stmt|;
name|max_height
operator|=
name|list_size
expr_stmt|;
block|}
if|if
condition|(
name|LINES
operator|>=
operator|(
name|vert_size
operator|+
literal|8
operator|)
condition|)
block|{
if|if
condition|(
name|menu_list
index|[
literal|0
index|]
operator|.
name|argument
operator|!=
name|MENU_WARN
condition|)
name|max_height
operator|=
name|vert_size
operator|+
literal|8
expr_stmt|;
else|else
name|max_height
operator|=
name|vert_size
operator|+
literal|7
expr_stmt|;
name|top_offset
operator|=
literal|4
expr_stmt|;
block|}
name|x_off
operator|=
operator|(
name|COLS
operator|-
name|max_width
operator|)
operator|/
literal|2
expr_stmt|;
name|y_off
operator|=
operator|(
name|LINES
operator|-
name|max_height
operator|-
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
name|temp_win
operator|=
name|newwin
argument_list|(
name|max_height
argument_list|,
name|max_width
argument_list|,
name|y_off
argument_list|,
name|x_off
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|temp_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paint_menu
argument_list|(
name|menu_list
argument_list|,
name|max_width
argument_list|,
name|max_height
argument_list|,
name|list_size
argument_list|,
name|top_offset
argument_list|,
name|temp_win
argument_list|,
name|off_start
argument_list|,
name|vert_size
argument_list|)
expr_stmt|;
name|counter
operator|=
literal|1
expr_stmt|;
name|vert_pos
operator|=
literal|0
expr_stmt|;
do|do
block|{
if|if
condition|(
name|off_start
operator|>
literal|2
condition|)
name|wmove
argument_list|(
name|temp_win
argument_list|,
operator|(
literal|1
operator|+
name|counter
operator|+
name|top_offset
operator|-
name|off_start
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
else|else
name|wmove
argument_list|(
name|temp_win
argument_list|,
operator|(
name|counter
operator|+
name|top_offset
operator|-
name|off_start
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|temp_win
argument_list|)
expr_stmt|;
name|in
operator|=
name|wgetch
argument_list|(
name|temp_win
argument_list|)
expr_stmt|;
name|input
operator|=
name|in
expr_stmt|;
if|if
condition|(
name|input
operator|==
operator|-
literal|1
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|tolower
argument_list|(
name|input
argument_list|)
operator|>=
literal|'a'
operator|)
operator|&&
operator|(
name|tolower
argument_list|(
name|input
argument_list|)
operator|<=
literal|'z'
operator|)
operator|)
operator|||
operator|(
operator|(
name|input
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
name|input
operator|<=
literal|'9'
operator|)
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|tolower
argument_list|(
name|input
argument_list|)
operator|>=
literal|'a'
operator|)
operator|&&
operator|(
name|tolower
argument_list|(
name|input
argument_list|)
operator|<=
literal|'z'
operator|)
condition|)
block|{
name|temp
operator|=
literal|1
operator|+
name|tolower
argument_list|(
name|input
argument_list|)
operator|-
literal|'a'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|input
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
name|input
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|temp
operator|=
operator|(
literal|2
operator|+
literal|'z'
operator|-
literal|'a'
operator|)
operator|+
operator|(
name|input
operator|-
literal|'0'
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|temp
operator|<=
name|list_size
condition|)
block|{
name|input
operator|=
literal|'\n'
expr_stmt|;
name|counter
operator|=
name|temp
expr_stmt|;
block|}
block|}
else|else
block|{
switch|switch
condition|(
name|input
condition|)
block|{
case|case
literal|' '
case|:
comment|/* space	*/
case|case
literal|'\004'
case|:
comment|/* ^d, down	*/
case|case
name|KEY_RIGHT
case|:
case|case
name|KEY_DOWN
case|:
name|counter
operator|++
expr_stmt|;
if|if
condition|(
name|counter
operator|>
name|list_size
condition|)
name|counter
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'\010'
case|:
comment|/* ^h, backspace*/
case|case
literal|'\025'
case|:
comment|/* ^u, up	*/
case|case
literal|127
case|:
comment|/* ^?, delete	*/
case|case
name|KEY_BACKSPACE
case|:
case|case
name|KEY_LEFT
case|:
case|case
name|KEY_UP
case|:
name|counter
operator|--
expr_stmt|;
if|if
condition|(
name|counter
operator|==
literal|0
condition|)
name|counter
operator|=
name|list_size
expr_stmt|;
break|break;
case|case
literal|'\033'
case|:
comment|/* escape key	*/
if|if
condition|(
name|menu_list
index|[
literal|0
index|]
operator|.
name|argument
operator|!=
name|MENU_WARN
condition|)
name|counter
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'\014'
case|:
comment|/* ^l       	*/
case|case
literal|'\022'
case|:
comment|/* ^r, redraw	*/
name|paint_menu
argument_list|(
name|menu_list
argument_list|,
name|max_width
argument_list|,
name|max_height
argument_list|,
name|list_size
argument_list|,
name|top_offset
argument_list|,
name|temp_win
argument_list|,
name|off_start
argument_list|,
name|vert_size
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
if|if
condition|(
operator|(
operator|(
name|list_size
operator|-
name|off_start
operator|)
operator|>=
operator|(
name|vert_size
operator|-
literal|1
operator|)
operator|)
operator|&&
operator|(
name|counter
operator|>
operator|(
name|off_start
operator|+
name|vert_size
operator|-
literal|3
operator|)
operator|)
operator|&&
operator|(
name|off_start
operator|>
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|counter
operator|==
name|list_size
condition|)
name|off_start
operator|=
operator|(
name|list_size
operator|-
name|vert_size
operator|)
operator|+
literal|2
expr_stmt|;
else|else
name|off_start
operator|++
expr_stmt|;
name|paint_menu
argument_list|(
name|menu_list
argument_list|,
name|max_width
argument_list|,
name|max_height
argument_list|,
name|list_size
argument_list|,
name|top_offset
argument_list|,
name|temp_win
argument_list|,
name|off_start
argument_list|,
name|vert_size
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|list_size
operator|!=
name|vert_size
operator|)
operator|&&
operator|(
name|counter
operator|>
operator|(
name|off_start
operator|+
name|vert_size
operator|-
literal|2
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|counter
operator|==
name|list_size
condition|)
name|off_start
operator|=
literal|2
operator|+
operator|(
name|list_size
operator|-
name|vert_size
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|off_start
operator|==
literal|1
condition|)
name|off_start
operator|=
literal|3
expr_stmt|;
else|else
name|off_start
operator|++
expr_stmt|;
name|paint_menu
argument_list|(
name|menu_list
argument_list|,
name|max_width
argument_list|,
name|max_height
argument_list|,
name|list_size
argument_list|,
name|top_offset
argument_list|,
name|temp_win
argument_list|,
name|off_start
argument_list|,
name|vert_size
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|counter
operator|<
name|off_start
condition|)
block|{
if|if
condition|(
name|counter
operator|<=
literal|2
condition|)
name|off_start
operator|=
literal|1
expr_stmt|;
else|else
name|off_start
operator|=
name|counter
expr_stmt|;
name|paint_menu
argument_list|(
name|menu_list
argument_list|,
name|max_width
argument_list|,
name|max_height
argument_list|,
name|list_size
argument_list|,
name|top_offset
argument_list|,
name|temp_win
argument_list|,
name|off_start
argument_list|,
name|vert_size
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|(
name|input
operator|!=
literal|'\r'
operator|)
operator|&&
operator|(
name|input
operator|!=
literal|'\n'
operator|)
operator|&&
operator|(
name|counter
operator|!=
literal|0
operator|)
condition|)
do|;
name|werase
argument_list|(
name|temp_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|temp_win
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|temp_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|procedure
operator|!=
name|NULL
operator|)
operator|||
operator|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|iprocedure
operator|!=
name|NULL
operator|)
operator|||
operator|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|nprocedure
operator|!=
name|NULL
operator|)
condition|)
block|{
if|if
condition|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|argument
operator|!=
operator|-
literal|1
condition|)
operator|(
operator|*
name|menu_list
index|[
name|counter
index|]
operator|.
name|iprocedure
operator|)
operator|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|argument
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|ptr_argument
operator|!=
name|NULL
condition|)
operator|(
operator|*
name|menu_list
index|[
name|counter
index|]
operator|.
name|procedure
operator|)
operator|(
name|menu_list
index|[
name|counter
index|]
operator|.
name|ptr_argument
operator|)
expr_stmt|;
else|else
operator|(
operator|*
name|menu_list
index|[
name|counter
index|]
operator|.
name|nprocedure
operator|)
operator|(
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|info_window
condition|)
name|paint_info_win
argument_list|()
expr_stmt|;
name|redraw
argument_list|()
expr_stmt|;
return|return
operator|(
name|counter
operator|)
return|;
block|}
end_function

begin_function
name|void
name|paint_menu
parameter_list|(
name|menu_list
parameter_list|,
name|max_width
parameter_list|,
name|max_height
parameter_list|,
name|list_size
parameter_list|,
name|top_offset
parameter_list|,
name|menu_win
parameter_list|,
name|off_start
parameter_list|,
name|vert_size
parameter_list|)
name|struct
name|menu_entries
name|menu_list
index|[]
decl_stmt|;
name|int
name|max_width
decl_stmt|,
name|max_height
decl_stmt|,
name|list_size
decl_stmt|,
name|top_offset
decl_stmt|;
name|WINDOW
modifier|*
name|menu_win
decl_stmt|;
name|int
name|off_start
decl_stmt|,
name|vert_size
decl_stmt|;
block|{
name|int
name|counter
decl_stmt|,
name|temp_int
decl_stmt|;
name|werase
argument_list|(
name|menu_win
argument_list|)
expr_stmt|;
comment|/* 	 |	output top and bottom portions of menu box only if window  	 |	large enough  	 */
if|if
condition|(
name|max_height
operator|>
name|vert_size
condition|)
block|{
name|wmove
argument_list|(
name|menu_win
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nohighlight
condition|)
name|wstandout
argument_list|(
name|menu_win
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
operator|(
name|max_width
operator|-
literal|4
operator|)
condition|;
name|counter
operator|++
control|)
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
operator|(
name|max_height
operator|-
literal|2
operator|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
operator|(
name|max_width
operator|-
literal|4
operator|)
condition|;
name|counter
operator|++
control|)
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
name|wstandend
argument_list|(
name|menu_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|menu_win
argument_list|,
name|menu_list
index|[
literal|0
index|]
operator|.
name|item_string
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
operator|(
name|max_height
operator|-
literal|3
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|menu_list
index|[
literal|0
index|]
operator|.
name|argument
operator|!=
name|MENU_WARN
condition|)
name|waddstr
argument_list|(
name|menu_win
argument_list|,
name|cancel_string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|nohighlight
condition|)
name|wstandout
argument_list|(
name|menu_win
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
operator|(
name|vert_size
operator|+
name|top_offset
operator|)
condition|;
name|counter
operator|++
control|)
block|{
if|if
condition|(
name|top_offset
operator|==
literal|4
condition|)
block|{
name|temp_int
operator|=
name|counter
operator|+
literal|2
expr_stmt|;
block|}
else|else
name|temp_int
operator|=
name|counter
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
name|temp_int
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
name|temp_int
argument_list|,
operator|(
name|max_width
operator|-
literal|2
operator|)
argument_list|)
expr_stmt|;
name|waddch
argument_list|(
name|menu_win
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
block|}
name|wstandend
argument_list|(
name|menu_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|list_size
operator|>
name|vert_size
condition|)
block|{
if|if
condition|(
name|off_start
operator|>=
literal|3
condition|)
block|{
name|temp_int
operator|=
literal|1
expr_stmt|;
name|wmove
argument_list|(
name|menu_win
argument_list|,
name|top_offset
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|menu_win
argument_list|,
name|more_above_str
argument_list|)
expr_stmt|;
block|}
else|else
name|temp_int
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|counter
operator|=
name|off_start
init|;
operator|(
operator|(
name|temp_int
operator|+
name|counter
operator|-
name|off_start
operator|)
operator|<
operator|(
name|vert_size
operator|-
literal|1
operator|)
operator|)
condition|;
name|counter
operator|++
control|)
block|{
name|wmove
argument_list|(
name|menu_win
argument_list|,
operator|(
name|top_offset
operator|+
name|temp_int
operator|+
operator|(
name|counter
operator|-
name|off_start
operator|)
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|list_size
operator|>
literal|1
condition|)
name|wprintw
argument_list|(
name|menu_win
argument_list|,
literal|"%c) "
argument_list|,
name|item_alpha
index|[
name|min
argument_list|(
operator|(
name|counter
operator|-
literal|1
operator|)
argument_list|,
name|max_alpha_char
argument_list|)
index|]
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|menu_win
argument_list|,
name|menu_list
index|[
name|counter
index|]
operator|.
name|item_string
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|menu_win
argument_list|,
operator|(
name|top_offset
operator|+
operator|(
name|vert_size
operator|-
literal|1
operator|)
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|counter
operator|==
name|list_size
condition|)
block|{
if|if
condition|(
name|list_size
operator|>
literal|1
condition|)
name|wprintw
argument_list|(
name|menu_win
argument_list|,
literal|"%c) "
argument_list|,
name|item_alpha
index|[
name|min
argument_list|(
operator|(
name|counter
operator|-
literal|1
operator|)
argument_list|,
name|max_alpha_char
argument_list|)
index|]
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|menu_win
argument_list|,
name|menu_list
index|[
name|counter
index|]
operator|.
name|item_string
argument_list|)
expr_stmt|;
block|}
else|else
name|wprintw
argument_list|(
name|menu_win
argument_list|,
name|more_below_str
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|counter
operator|=
literal|1
init|;
name|counter
operator|<=
name|list_size
condition|;
name|counter
operator|++
control|)
block|{
name|wmove
argument_list|(
name|menu_win
argument_list|,
operator|(
name|top_offset
operator|+
name|counter
operator|-
literal|1
operator|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|list_size
operator|>
literal|1
condition|)
name|wprintw
argument_list|(
name|menu_win
argument_list|,
literal|"%c) "
argument_list|,
name|item_alpha
index|[
name|min
argument_list|(
operator|(
name|counter
operator|-
literal|1
operator|)
argument_list|,
name|max_alpha_char
argument_list|)
index|]
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|menu_win
argument_list|,
name|menu_list
index|[
name|counter
index|]
operator|.
name|item_string
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
name|help
parameter_list|()
block|{
name|int
name|counter
decl_stmt|;
name|werase
argument_list|(
name|help_win
argument_list|)
expr_stmt|;
name|clearok
argument_list|(
name|help_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
literal|22
condition|;
name|counter
operator|++
control|)
block|{
name|wmove
argument_list|(
name|help_win
argument_list|,
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|help_win
argument_list|,
operator|(
name|emacs_keys_mode
operator|)
condition|?
name|emacs_help_text
index|[
name|counter
index|]
else|:
name|help_text
index|[
name|counter
index|]
argument_list|)
expr_stmt|;
block|}
name|wrefresh
argument_list|(
name|help_win
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|press_any_key_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|counter
operator|=
name|wgetch
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|counter
operator|==
operator|-
literal|1
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|help_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|help_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|paint_info_win
parameter_list|()
block|{
name|int
name|counter
decl_stmt|;
if|if
condition|(
operator|!
name|info_window
condition|)
return|return;
name|werase
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
literal|5
condition|;
name|counter
operator|++
control|)
block|{
name|wmove
argument_list|(
name|info_win
argument_list|,
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
if|if
condition|(
name|info_type
operator|==
name|CONTROL_KEYS
condition|)
name|waddstr
argument_list|(
name|info_win
argument_list|,
operator|(
name|emacs_keys_mode
operator|)
condition|?
name|emacs_control_keys
index|[
name|counter
index|]
else|:
name|control_keys
index|[
name|counter
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|info_type
operator|==
name|COMMANDS
condition|)
name|waddstr
argument_list|(
name|info_win
argument_list|,
name|command_strings
index|[
name|counter
index|]
argument_list|)
expr_stmt|;
block|}
name|wmove
argument_list|(
name|info_win
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nohighlight
condition|)
name|wstandout
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|waddstr
argument_list|(
name|info_win
argument_list|,
literal|"==============================================================================="
argument_list|)
expr_stmt|;
name|wstandend
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|no_info_window
parameter_list|()
block|{
if|if
condition|(
operator|!
name|info_window
condition|)
return|return;
name|delwin
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|delwin
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|info_window
operator|=
name|FALSE
expr_stmt|;
name|last_line
operator|=
name|LINES
operator|-
literal|2
expr_stmt|;
name|text_win
operator|=
name|newwin
argument_list|(
operator|(
name|LINES
operator|-
literal|1
operator|)
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|idlok
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|clearok
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
name|create_info_window
parameter_list|()
block|{
if|if
condition|(
name|info_window
condition|)
return|return;
name|last_line
operator|=
name|LINES
operator|-
literal|8
expr_stmt|;
name|delwin
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|text_win
operator|=
name|newwin
argument_list|(
operator|(
name|LINES
operator|-
literal|7
operator|)
argument_list|,
name|COLS
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|keypad
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|idlok
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|info_window
operator|=
name|TRUE
expr_stmt|;
name|info_win
operator|=
name|newwin
argument_list|(
literal|6
argument_list|,
name|COLS
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|info_win
argument_list|)
expr_stmt|;
name|info_type
operator|=
name|CONTROL_KEYS
expr_stmt|;
name|midscreen
argument_list|(
name|min
argument_list|(
name|scr_vert
argument_list|,
name|last_line
argument_list|)
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|clearok
argument_list|(
name|info_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
name|wrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|int
name|file_op
parameter_list|(
name|arg
parameter_list|)
name|int
name|arg
decl_stmt|;
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|flag
decl_stmt|;
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|arg
operator|==
name|READ_FILE
condition|)
block|{
name|string
operator|=
name|get_string
argument_list|(
name|file_read_prompt_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|recv_file
operator|=
name|TRUE
expr_stmt|;
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|check_fp
argument_list|()
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|string
condition|)
name|free
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|arg
operator|==
name|WRITE_FILE
condition|)
block|{
name|string
operator|=
name|get_string
argument_list|(
name|file_write_prompt_str
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|write_file
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|string
condition|)
name|free
argument_list|(
name|tmp_file
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|arg
operator|==
name|SAVE_FILE
condition|)
block|{
comment|/* 	 |	changes made here should be reflected in finish() 	 */
if|if
condition|(
name|in_file_name
condition|)
name|flag
operator|=
name|TRUE
expr_stmt|;
else|else
name|flag
operator|=
name|FALSE
expr_stmt|;
name|string
operator|=
name|in_file_name
expr_stmt|;
if|if
condition|(
operator|(
name|string
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|string
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
name|string
operator|=
name|get_string
argument_list|(
name|save_file_name_prompt
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|string
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|string
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|file_not_saved_msg
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|flag
condition|)
block|{
name|tmp_file
operator|=
name|resolve_name
argument_list|(
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp_file
operator|!=
name|string
condition|)
block|{
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|string
operator|=
name|tmp_file
expr_stmt|;
block|}
block|}
if|if
condition|(
name|write_file
argument_list|(
name|string
argument_list|)
condition|)
block|{
name|in_file_name
operator|=
name|string
expr_stmt|;
name|text_changes
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|flag
condition|)
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|void
name|shell_op
parameter_list|()
block|{
name|char
modifier|*
name|string
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|string
operator|=
name|get_string
argument_list|(
name|shell_prompt
argument_list|,
name|TRUE
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|string
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|)
block|{
name|sh_command
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|leave_op
parameter_list|()
block|{
if|if
condition|(
name|text_changes
condition|)
block|{
name|menu_op
argument_list|(
name|leave_menu
argument_list|)
expr_stmt|;
block|}
else|else
name|quit
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|redraw
parameter_list|()
block|{
if|if
condition|(
name|info_window
condition|)
block|{
name|clearok
argument_list|(
name|info_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paint_info_win
argument_list|()
expr_stmt|;
block|}
else|else
name|clearok
argument_list|(
name|text_win
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  |	The following routines will "format" a paragraph (as defined by a   |	block of text with blank lines before and after the block).  */
end_comment

begin_function
name|int
name|Blank_Line
parameter_list|(
name|test_line
parameter_list|)
comment|/* test if line has any non-space characters	*/
name|struct
name|text
modifier|*
name|test_line
decl_stmt|;
block|{
name|char
modifier|*
name|line
decl_stmt|;
name|int
name|length
decl_stmt|;
if|if
condition|(
name|test_line
operator|==
name|NULL
condition|)
return|return
operator|(
name|TRUE
operator|)
return|;
name|length
operator|=
literal|1
expr_stmt|;
name|line
operator|=
name|test_line
operator|->
name|line
expr_stmt|;
comment|/* 	 |	To handle troff/nroff documents, consider a line with a  	 |	period ('.') in the first column to be blank.  To handle mail  	 |	messages with included text, consider a line with a '>' blank. 	 */
if|if
condition|(
operator|(
operator|*
name|line
operator|==
literal|'.'
operator|)
operator|||
operator|(
operator|*
name|line
operator|==
literal|'>'
operator|)
condition|)
return|return
operator|(
name|TRUE
operator|)
return|;
while|while
condition|(
operator|(
operator|(
operator|*
name|line
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|line
operator|==
literal|'\t'
operator|)
operator|)
operator|&&
operator|(
name|length
operator|<
name|test_line
operator|->
name|line_length
operator|)
condition|)
block|{
name|length
operator|++
expr_stmt|;
name|line
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|length
operator|!=
name|test_line
operator|->
name|line_length
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
else|else
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_function
name|void
name|Format
parameter_list|()
comment|/* format the paragraph according to set margins	*/
block|{
name|int
name|string_count
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|temp_case
decl_stmt|;
name|int
name|status
decl_stmt|;
name|int
name|tmp_af
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|char
modifier|*
name|line
decl_stmt|;
name|char
modifier|*
name|tmp_srchstr
decl_stmt|;
name|char
modifier|*
name|temp1
decl_stmt|,
modifier|*
name|temp2
decl_stmt|;
name|char
modifier|*
name|temp_dword
decl_stmt|;
name|char
name|temp_d_char
init|=
name|d_char
decl_stmt|;
comment|/*  |	if observ_margins is not set, or the current line is blank,   |	do not format the current paragraph  */
if|if
condition|(
operator|(
operator|!
name|observ_margins
operator|)
operator|||
operator|(
name|Blank_Line
argument_list|(
name|curr_line
argument_list|)
operator|)
condition|)
return|return;
comment|/*  |	save the currently set flags, and clear them  */
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|formatting_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
comment|/*  |	get current position in paragraph, so after formatting, the cursor   |	will be in the same relative position  */
name|tmp_af
operator|=
name|auto_format
expr_stmt|;
name|auto_format
operator|=
name|FALSE
expr_stmt|;
name|offset
operator|=
name|position
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|prev_word
argument_list|()
expr_stmt|;
name|temp_dword
operator|=
name|d_word
expr_stmt|;
name|d_word
operator|=
name|NULL
expr_stmt|;
name|temp_case
operator|=
name|case_sen
expr_stmt|;
name|case_sen
operator|=
name|TRUE
expr_stmt|;
name|tmp_srchstr
operator|=
name|srch_str
expr_stmt|;
name|temp2
operator|=
name|srch_str
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
literal|1
operator|+
name|curr_line
operator|->
name|line_length
operator|-
name|position
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
condition|)
name|adv_word
argument_list|()
expr_stmt|;
name|offset
operator|-=
name|position
expr_stmt|;
name|counter
operator|=
name|position
expr_stmt|;
name|line
operator|=
name|temp1
operator|=
name|point
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|temp1
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|temp1
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|temp1
operator|!=
literal|'\t'
operator|)
operator|&&
operator|(
name|counter
operator|<
name|curr_line
operator|->
name|line_length
operator|)
condition|)
block|{
operator|*
name|temp2
operator|=
operator|*
name|temp1
expr_stmt|;
name|temp2
operator|++
expr_stmt|;
name|temp1
operator|++
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
operator|*
name|temp2
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
condition|)
name|bol
argument_list|()
expr_stmt|;
name|string_count
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
operator|(
name|line
operator|!=
name|point
operator|)
operator|&&
operator|(
name|status
operator|)
condition|)
block|{
name|status
operator|=
name|search
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|string_count
operator|++
expr_stmt|;
block|}
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|formatting_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
comment|/*  |	now get back to the start of the paragraph to start formatting  */
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
condition|)
name|bol
argument_list|()
expr_stmt|;
name|observ_margins
operator|=
name|FALSE
expr_stmt|;
comment|/*  |	Start going through lines, putting spaces at end of lines if they do   |	not already exist.  Append lines together to get one long line, and   |	eliminate spacing at begin of lines.  */
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|next_line
argument_list|)
condition|)
block|{
name|eol
argument_list|()
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|point
operator|!=
literal|' '
condition|)
block|{
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
else|else
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|del_char
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
condition|)
name|del_word
argument_list|()
expr_stmt|;
block|}
comment|/*  |	Now there is one long line.  Eliminate extra spaces within the line  |	after the first word (so as not to blow away any indenting the user   |	may have put in).  */
name|bol
argument_list|()
expr_stmt|;
name|adv_word
argument_list|()
expr_stmt|;
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|&&
operator|(
operator|*
operator|(
name|point
operator|+
literal|1
operator|)
operator|==
literal|' '
operator|)
condition|)
name|del_char
argument_list|()
expr_stmt|;
else|else
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/*  |	Now make sure there are two spaces after a '.'.  */
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|'.'
operator|)
operator|&&
operator|(
operator|*
operator|(
name|point
operator|+
literal|1
operator|)
operator|==
literal|' '
operator|)
condition|)
block|{
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|point
operator|==
literal|' '
condition|)
name|del_char
argument_list|()
expr_stmt|;
block|}
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|observ_margins
operator|=
name|TRUE
expr_stmt|;
name|bol
argument_list|()
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|formatting_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
comment|/*  |	create lines between margins  */
while|while
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
while|while
condition|(
operator|(
name|scr_pos
operator|<
name|right_margin
operator|)
operator|&&
operator|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
operator|)
condition|)
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|position
operator|<
name|curr_line
operator|->
name|line_length
condition|)
block|{
name|prev_word
argument_list|()
expr_stmt|;
if|if
condition|(
name|position
operator|==
literal|1
condition|)
name|adv_word
argument_list|()
expr_stmt|;
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  |	go back to begin of paragraph, put cursor back to original position  */
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
condition|)
name|bol
argument_list|()
expr_stmt|;
comment|/*  |	find word cursor was in  */
while|while
condition|(
operator|(
name|status
operator|)
operator|&&
operator|(
name|string_count
operator|>
literal|0
operator|)
condition|)
block|{
name|search
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|string_count
operator|--
expr_stmt|;
block|}
comment|/*  |	offset the cursor to where it was before from the start of the word  */
while|while
condition|(
name|offset
operator|>
literal|0
condition|)
block|{
name|offset
operator|--
expr_stmt|;
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/*  |	reset flags and strings to what they were before formatting  */
if|if
condition|(
name|d_word
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|d_word
argument_list|)
expr_stmt|;
name|d_word
operator|=
name|temp_dword
expr_stmt|;
name|case_sen
operator|=
name|temp_case
expr_stmt|;
name|free
argument_list|(
name|srch_str
argument_list|)
expr_stmt|;
name|srch_str
operator|=
name|tmp_srchstr
expr_stmt|;
name|d_char
operator|=
name|temp_d_char
expr_stmt|;
name|auto_format
operator|=
name|tmp_af
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|char
modifier|*
name|init_name
index|[
literal|3
index|]
init|=
block|{
literal|"/usr/share/misc/init.ee"
block|,
name|NULL
block|,
literal|".init.ee"
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|ee_init
parameter_list|()
comment|/* check for init file and read it if it exists	*/
block|{
name|FILE
modifier|*
name|init_file
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|char
modifier|*
name|str1
decl_stmt|;
name|char
modifier|*
name|str2
decl_stmt|;
name|char
modifier|*
name|home
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|int
name|temp_int
decl_stmt|;
name|string
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|string
condition|)
name|string
operator|=
literal|"/root"
expr_stmt|;
comment|/* Set to reasonable default so we don't crash */
name|str1
operator|=
name|home
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|string
argument_list|)
operator|+
literal|10
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|home
argument_list|,
name|string
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|home
argument_list|,
literal|"/.init.ee"
argument_list|)
expr_stmt|;
name|init_name
index|[
literal|1
index|]
operator|=
name|home
expr_stmt|;
name|string
operator|=
name|malloc
argument_list|(
literal|512
argument_list|)
expr_stmt|;
for|for
control|(
name|counter
operator|=
literal|0
init|;
name|counter
operator|<
literal|3
condition|;
name|counter
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|access
argument_list|(
name|init_name
index|[
name|counter
index|]
argument_list|,
literal|4
argument_list|)
operator|)
condition|)
block|{
name|init_file
operator|=
name|fopen
argument_list|(
name|init_name
index|[
name|counter
index|]
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|str2
operator|=
name|fgets
argument_list|(
name|string
argument_list|,
literal|512
argument_list|,
name|init_file
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|str1
operator|=
name|str2
operator|=
name|string
expr_stmt|;
while|while
condition|(
operator|*
name|str2
operator|!=
literal|'\n'
condition|)
name|str2
operator|++
expr_stmt|;
operator|*
name|str2
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
name|unique_test
argument_list|(
name|string
argument_list|,
name|init_strings
argument_list|)
operator|!=
literal|1
condition|)
continue|continue;
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|CASE
argument_list|,
name|FALSE
argument_list|)
condition|)
name|case_sen
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOCASE
argument_list|,
name|FALSE
argument_list|)
condition|)
name|case_sen
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|EXPAND
argument_list|,
name|FALSE
argument_list|)
condition|)
name|expand_tabs
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOEXPAND
argument_list|,
name|FALSE
argument_list|)
condition|)
name|expand_tabs
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|INFO
argument_list|,
name|FALSE
argument_list|)
condition|)
name|info_window
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOINFO
argument_list|,
name|FALSE
argument_list|)
condition|)
name|info_window
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|MARGINS
argument_list|,
name|FALSE
argument_list|)
condition|)
name|observ_margins
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOMARGINS
argument_list|,
name|FALSE
argument_list|)
condition|)
name|observ_margins
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|AUTOFORMAT
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|auto_format
operator|=
name|TRUE
expr_stmt|;
name|observ_margins
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOAUTOFORMAT
argument_list|,
name|FALSE
argument_list|)
condition|)
name|auto_format
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|Echo
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|str1
operator|=
name|next_word
argument_list|(
name|str1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|str1
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
name|echo_string
argument_list|(
name|str1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|PRINTCOMMAND
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|str1
operator|=
name|next_word
argument_list|(
name|str1
argument_list|)
expr_stmt|;
name|print_command
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|str1
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|print_command
argument_list|,
name|str1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|RIGHTMARGIN
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|str1
operator|=
name|next_word
argument_list|(
name|str1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|str1
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|str1
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|temp_int
operator|=
name|atoi
argument_list|(
name|str1
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp_int
operator|>
literal|0
condition|)
name|right_margin
operator|=
name|temp_int
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|HIGHLIGHT
argument_list|,
name|FALSE
argument_list|)
condition|)
name|nohighlight
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOHIGHLIGHT
argument_list|,
name|FALSE
argument_list|)
condition|)
name|nohighlight
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|EIGHTBIT
argument_list|,
name|FALSE
argument_list|)
condition|)
name|eightbit
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOEIGHTBIT
argument_list|,
name|FALSE
argument_list|)
condition|)
name|eightbit
operator|=
name|FALSE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|EMACS_string
argument_list|,
name|FALSE
argument_list|)
condition|)
name|emacs_keys_mode
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
name|compare
argument_list|(
name|str1
argument_list|,
name|NOEMACS_string
argument_list|,
name|FALSE
argument_list|)
condition|)
name|emacs_keys_mode
operator|=
name|FALSE
expr_stmt|;
block|}
name|fclose
argument_list|(
name|init_file
argument_list|)
expr_stmt|;
block|}
block|}
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|home
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  |	Save current configuration to .init.ee file in the current directory.  */
end_comment

begin_function
name|void
name|dump_ee_conf
parameter_list|()
block|{
name|FILE
modifier|*
name|init_file
decl_stmt|;
name|FILE
modifier|*
name|old_init_file
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|file_name
init|=
literal|".init.ee"
decl_stmt|;
name|char
modifier|*
name|home_dir
init|=
literal|"~/.init.ee"
decl_stmt|;
name|char
name|buffer
index|[
literal|512
index|]
decl_stmt|;
name|struct
name|stat
name|buf
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|length
decl_stmt|;
name|int
name|option
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
name|option
operator|=
name|menu_op
argument_list|(
name|config_dump_menu
argument_list|)
expr_stmt|;
name|werase
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|==
literal|0
condition|)
block|{
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|conf_not_saved_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|option
operator|==
literal|2
condition|)
name|file_name
operator|=
name|resolve_name
argument_list|(
name|home_dir
argument_list|)
expr_stmt|;
comment|/* 	 |	If a .init.ee file exists, move it to .init.ee.old. 	 */
if|if
condition|(
name|stat
argument_list|(
name|file_name
argument_list|,
operator|&
name|buf
argument_list|)
operator|!=
operator|-
literal|1
condition|)
block|{
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%s.old"
argument_list|,
name|file_name
argument_list|)
expr_stmt|;
name|unlink
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|link
argument_list|(
name|file_name
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|unlink
argument_list|(
name|file_name
argument_list|)
expr_stmt|;
name|old_init_file
operator|=
name|fopen
argument_list|(
name|buffer
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
block|}
name|init_file
operator|=
name|fopen
argument_list|(
name|file_name
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|init_file
operator|==
name|NULL
condition|)
block|{
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|conf_dump_err_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|old_init_file
operator|!=
name|NULL
condition|)
block|{
comment|/* 		 |	Copy non-configuration info into new .init.ee file. 		 */
while|while
condition|(
operator|(
name|string
operator|=
name|fgets
argument_list|(
name|buffer
argument_list|,
literal|512
argument_list|,
name|old_init_file
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|length
operator|=
name|strlen
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|string
index|[
name|length
operator|-
literal|1
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
name|unique_test
argument_list|(
name|string
argument_list|,
name|init_strings
argument_list|)
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|compare
argument_list|(
name|string
argument_list|,
name|Echo
argument_list|,
name|FALSE
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|string
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|string
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|old_init_file
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|case_sen
condition|?
name|CASE
else|:
name|NOCASE
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|expand_tabs
condition|?
name|EXPAND
else|:
name|NOEXPAND
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|info_window
condition|?
name|INFO
else|:
name|NOINFO
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|observ_margins
condition|?
name|MARGINS
else|:
name|NOMARGINS
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|auto_format
condition|?
name|AUTOFORMAT
else|:
name|NOAUTOFORMAT
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s %s\n"
argument_list|,
name|PRINTCOMMAND
argument_list|,
name|print_command
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s %d\n"
argument_list|,
name|RIGHTMARGIN
argument_list|,
name|right_margin
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|nohighlight
condition|?
name|NOHIGHLIGHT
else|:
name|HIGHLIGHT
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|eightbit
condition|?
name|EIGHTBIT
else|:
name|NOEIGHTBIT
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|init_file
argument_list|,
literal|"%s\n"
argument_list|,
name|emacs_keys_mode
condition|?
name|EMACS_string
else|:
name|NOEMACS_string
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|init_file
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|conf_dump_success_msg
argument_list|,
name|file_name
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|option
operator|==
literal|2
operator|)
operator|&&
operator|(
name|file_name
operator|!=
name|home_dir
operator|)
condition|)
block|{
name|free
argument_list|(
name|file_name
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|echo_string
parameter_list|(
name|string
parameter_list|)
comment|/* echo the given string	*/
name|char
modifier|*
name|string
decl_stmt|;
block|{
name|char
modifier|*
name|temp
decl_stmt|;
name|int
name|Counter
decl_stmt|;
name|temp
operator|=
name|string
expr_stmt|;
while|while
condition|(
operator|*
name|temp
operator|!=
operator|(
name|char
operator|)
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|temp
operator|==
literal|'\\'
condition|)
block|{
name|temp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|temp
operator|==
literal|'n'
condition|)
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'t'
condition|)
name|putchar
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'b'
condition|)
name|putchar
argument_list|(
literal|'\b'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'r'
condition|)
name|putchar
argument_list|(
literal|'\r'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'f'
condition|)
name|putchar
argument_list|(
literal|'\f'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|temp
operator|==
literal|'e'
operator|)
operator|||
operator|(
operator|*
name|temp
operator|==
literal|'E'
operator|)
condition|)
name|putchar
argument_list|(
literal|'\033'
argument_list|)
expr_stmt|;
comment|/* escape */
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'\\'
condition|)
name|putchar
argument_list|(
literal|'\\'
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|temp
operator|==
literal|'\''
condition|)
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|*
name|temp
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|temp
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|Counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|temp
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|temp
operator|<=
literal|'9'
operator|)
condition|)
block|{
name|Counter
operator|=
operator|(
literal|8
operator|*
name|Counter
operator|)
operator|+
operator|(
operator|*
name|temp
operator|-
literal|'0'
operator|)
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
name|putchar
argument_list|(
name|Counter
argument_list|)
expr_stmt|;
name|temp
operator|--
expr_stmt|;
block|}
name|temp
operator|++
expr_stmt|;
block|}
else|else
block|{
name|putchar
argument_list|(
operator|*
name|temp
argument_list|)
expr_stmt|;
name|temp
operator|++
expr_stmt|;
block|}
block|}
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|spell_op
parameter_list|()
comment|/* check spelling of words in the editor	*/
block|{
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
name|top
argument_list|()
expr_stmt|;
comment|/* go to top of file		*/
name|insert_line
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
comment|/* create two blank lines	*/
name|insert_line
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|top
argument_list|()
expr_stmt|;
name|command
argument_list|(
name|shell_echo_msg
argument_list|)
expr_stmt|;
name|adv_line
argument_list|()
expr_stmt|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|spell_in_prog_msg
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|command
argument_list|(
literal|"<>!spell"
argument_list|)
expr_stmt|;
comment|/* send contents of buffer to command 'spell'  				   and read the results back into the editor */
block|}
end_function

begin_function
name|void
name|ispell_op
parameter_list|()
block|{
name|char
name|name
index|[
literal|128
index|]
decl_stmt|;
name|char
name|string
index|[
literal|256
index|]
decl_stmt|;
name|int
name|pid
decl_stmt|;
if|if
condition|(
name|restrict_mode
argument_list|()
condition|)
block|{
return|return;
block|}
name|pid
operator|=
name|getpid
argument_list|()
expr_stmt|;
name|sprintf
argument_list|(
name|name
argument_list|,
literal|"/tmp/ee.%d"
argument_list|,
name|pid
argument_list|)
expr_stmt|;
if|if
condition|(
name|write_file
argument_list|(
name|name
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|string
argument_list|,
literal|"ispell %s"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|sh_command
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|delete_text
argument_list|()
expr_stmt|;
name|tmp_file
operator|=
name|name
expr_stmt|;
name|recv_file
operator|=
name|TRUE
expr_stmt|;
name|check_fp
argument_list|()
expr_stmt|;
name|unlink
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|first_word_len
parameter_list|(
name|test_line
parameter_list|)
name|struct
name|text
modifier|*
name|test_line
decl_stmt|;
block|{
name|int
name|counter
decl_stmt|;
name|char
modifier|*
name|pnt
decl_stmt|;
if|if
condition|(
name|test_line
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|pnt
operator|=
name|test_line
operator|->
name|line
expr_stmt|;
if|if
condition|(
operator|(
name|pnt
operator|==
name|NULL
operator|)
operator|||
operator|(
operator|*
name|pnt
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|||
operator|(
operator|*
name|pnt
operator|==
literal|'.'
operator|)
operator|||
operator|(
operator|*
name|pnt
operator|==
literal|'>'
operator|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|pnt
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|pnt
operator|==
literal|'\t'
operator|)
condition|)
block|{
name|pnt
operator|=
name|next_word
argument_list|(
name|pnt
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|pnt
operator|==
operator|(
name|char
operator|)
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|pnt
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|*
name|pnt
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|pnt
operator|!=
literal|'\t'
operator|)
operator|)
condition|)
block|{
name|pnt
operator|++
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
while|while
condition|(
operator|(
operator|*
name|pnt
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|(
operator|*
name|pnt
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|pnt
operator|==
literal|'\t'
operator|)
operator|)
condition|)
block|{
name|pnt
operator|++
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|counter
operator|)
return|;
block|}
end_function

begin_function
name|void
name|Auto_Format
parameter_list|()
comment|/* format the paragraph according to set margins	*/
block|{
name|int
name|string_count
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|temp_case
decl_stmt|;
name|int
name|word_len
decl_stmt|;
name|int
name|temp_dwl
decl_stmt|;
name|int
name|tmp_d_line_length
decl_stmt|;
name|int
name|leave_loop
init|=
name|FALSE
decl_stmt|;
name|int
name|status
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|char
name|not_blank
decl_stmt|;
name|char
modifier|*
name|line
decl_stmt|;
name|char
modifier|*
name|tmp_srchstr
decl_stmt|;
name|char
modifier|*
name|temp1
decl_stmt|,
modifier|*
name|temp2
decl_stmt|;
name|char
modifier|*
name|temp_dword
decl_stmt|;
name|char
name|temp_d_char
init|=
name|d_char
decl_stmt|;
name|char
modifier|*
name|tmp_d_line
decl_stmt|;
comment|/*  |	if observ_margins is not set, or the current line is blank,   |	do not format the current paragraph  */
if|if
condition|(
operator|(
operator|!
name|observ_margins
operator|)
operator|||
operator|(
name|Blank_Line
argument_list|(
name|curr_line
argument_list|)
operator|)
condition|)
return|return;
comment|/*  |	get current position in paragraph, so after formatting, the cursor   |	will be in the same relative position  */
name|tmp_d_line
operator|=
name|d_line
expr_stmt|;
name|tmp_d_line_length
operator|=
name|dlt_line
operator|->
name|line_length
expr_stmt|;
name|d_line
operator|=
name|NULL
expr_stmt|;
name|auto_format
operator|=
name|FALSE
expr_stmt|;
name|offset
operator|=
name|position
expr_stmt|;
if|if
condition|(
operator|(
name|position
operator|!=
literal|1
operator|)
operator|&&
operator|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
operator|||
operator|(
name|position
operator|==
name|curr_line
operator|->
name|line_length
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
operator|(
name|char
operator|)
name|NULL
operator|)
operator|)
condition|)
name|prev_word
argument_list|()
expr_stmt|;
name|temp_dword
operator|=
name|d_word
expr_stmt|;
name|temp_dwl
operator|=
name|d_wrd_len
expr_stmt|;
name|d_wrd_len
operator|=
literal|0
expr_stmt|;
name|d_word
operator|=
name|NULL
expr_stmt|;
name|temp_case
operator|=
name|case_sen
expr_stmt|;
name|case_sen
operator|=
name|TRUE
expr_stmt|;
name|tmp_srchstr
operator|=
name|srch_str
expr_stmt|;
name|temp2
operator|=
name|srch_str
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
literal|1
operator|+
name|curr_line
operator|->
name|line_length
operator|-
name|position
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
condition|)
name|adv_word
argument_list|()
expr_stmt|;
name|offset
operator|-=
name|position
expr_stmt|;
name|counter
operator|=
name|position
expr_stmt|;
name|line
operator|=
name|temp1
operator|=
name|point
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|temp1
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|temp1
operator|!=
literal|' '
operator|)
operator|&&
operator|(
operator|*
name|temp1
operator|!=
literal|'\t'
operator|)
operator|&&
operator|(
name|counter
operator|<
name|curr_line
operator|->
name|line_length
operator|)
condition|)
block|{
operator|*
name|temp2
operator|=
operator|*
name|temp1
expr_stmt|;
name|temp2
operator|++
expr_stmt|;
name|temp1
operator|++
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
operator|*
name|temp2
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
condition|)
name|bol
argument_list|()
expr_stmt|;
name|string_count
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
operator|(
name|line
operator|!=
name|point
operator|)
operator|&&
operator|(
name|status
operator|)
condition|)
block|{
name|status
operator|=
name|search
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|string_count
operator|++
expr_stmt|;
block|}
comment|/*  |	now get back to the start of the paragraph to start checking  */
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
condition|)
name|bol
argument_list|()
expr_stmt|;
comment|/*  |	Start going through lines, putting spaces at end of lines if they do   |	not already exist.  Check line length, and move words to the next line   |	if they cross the margin.  Then get words from the next line if they   |	will fit in before the margin.    */
name|counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|leave_loop
condition|)
block|{
if|if
condition|(
name|position
operator|!=
name|curr_line
operator|->
name|line_length
condition|)
name|eol
argument_list|()
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|point
operator|!=
literal|' '
condition|)
block|{
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
else|else
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|not_blank
operator|=
name|FALSE
expr_stmt|;
comment|/* 		 |	fill line if first word on next line will fit  		 |	in the line without crossing the margin 		 */
while|while
condition|(
operator|(
name|curr_line
operator|->
name|next_line
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|(
name|word_len
operator|=
name|first_word_len
argument_list|(
name|curr_line
operator|->
name|next_line
argument_list|)
operator|)
operator|>
literal|0
operator|)
operator|&&
operator|(
operator|(
name|scr_pos
operator|+
name|word_len
operator|)
operator|<
name|right_margin
operator|)
condition|)
block|{
name|adv_line
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
condition|)
name|adv_word
argument_list|()
expr_stmt|;
name|del_word
argument_list|()
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
comment|/* 			 |	We know this line was not blank before, so  			 |	make sure that it doesn't have one of the  			 |	leading characters that indicate the line  			 |	should not be modified. 			 | 			 |	We also know that this character should not  			 |	be left as the first character of this line. 			 */
if|if
condition|(
operator|(
name|Blank_Line
argument_list|(
name|curr_line
argument_list|)
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|line
index|[
literal|0
index|]
operator|!=
literal|'.'
operator|)
operator|&&
operator|(
name|curr_line
operator|->
name|line
index|[
literal|0
index|]
operator|!=
literal|'>'
operator|)
condition|)
block|{
name|del_line
argument_list|()
expr_stmt|;
name|not_blank
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
name|not_blank
operator|=
name|TRUE
expr_stmt|;
comment|/* 			 |   go to end of previous line 			 */
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|undel_word
argument_list|()
expr_stmt|;
name|eol
argument_list|()
expr_stmt|;
comment|/* 			 |   make sure there's a space at the end of the line 			 */
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|point
operator|!=
literal|' '
condition|)
block|{
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|insert
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
else|else
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* 		 |	make sure line does not cross right margin 		 */
while|while
condition|(
name|right_margin
operator|<=
name|scr_pos
condition|)
block|{
name|prev_word
argument_list|()
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
block|{
name|del_word
argument_list|()
expr_stmt|;
if|if
condition|(
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|next_line
argument_list|)
condition|)
name|insert_line
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|adv_line
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|point
operator|==
literal|' '
operator|)
operator|||
operator|(
operator|*
name|point
operator|==
literal|'\t'
operator|)
condition|)
name|adv_word
argument_list|()
expr_stmt|;
name|undel_word
argument_list|()
expr_stmt|;
name|not_blank
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|next_line
argument_list|)
operator|)
operator|||
operator|(
name|not_blank
operator|)
condition|)
block|{
name|adv_line
argument_list|()
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
else|else
name|leave_loop
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/*  |	go back to begin of paragraph, put cursor back to original position  */
if|if
condition|(
name|position
operator|!=
literal|1
condition|)
name|bol
argument_list|()
expr_stmt|;
while|while
condition|(
operator|(
name|counter
operator|--
operator|>
literal|0
operator|)
operator|||
operator|(
operator|!
name|Blank_Line
argument_list|(
name|curr_line
operator|->
name|prev_line
argument_list|)
operator|)
condition|)
name|bol
argument_list|()
expr_stmt|;
comment|/*  |	find word cursor was in  */
name|status
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
operator|(
name|status
operator|)
operator|&&
operator|(
name|string_count
operator|>
literal|0
operator|)
condition|)
block|{
name|status
operator|=
name|search
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|string_count
operator|--
expr_stmt|;
block|}
comment|/*  |	offset the cursor to where it was before from the start of the word  */
while|while
condition|(
name|offset
operator|>
literal|0
condition|)
block|{
name|offset
operator|--
expr_stmt|;
name|right
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|string_count
operator|>
literal|0
operator|)
operator|&&
operator|(
name|offset
operator|<
literal|0
operator|)
condition|)
block|{
while|while
condition|(
name|offset
operator|<
literal|0
condition|)
block|{
name|offset
operator|++
expr_stmt|;
name|left
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  |	reset flags and strings to what they were before formatting  */
if|if
condition|(
name|d_word
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|d_word
argument_list|)
expr_stmt|;
name|d_word
operator|=
name|temp_dword
expr_stmt|;
name|d_wrd_len
operator|=
name|temp_dwl
expr_stmt|;
name|case_sen
operator|=
name|temp_case
expr_stmt|;
name|free
argument_list|(
name|srch_str
argument_list|)
expr_stmt|;
name|srch_str
operator|=
name|tmp_srchstr
expr_stmt|;
name|d_char
operator|=
name|temp_d_char
expr_stmt|;
name|auto_format
operator|=
name|TRUE
expr_stmt|;
name|dlt_line
operator|->
name|line_length
operator|=
name|tmp_d_line_length
expr_stmt|;
name|d_line
operator|=
name|tmp_d_line
expr_stmt|;
name|formatted
operator|=
name|TRUE
expr_stmt|;
name|midscreen
argument_list|(
name|scr_vert
argument_list|,
name|point
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|modes_op
parameter_list|()
block|{
name|int
name|ret_value
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
do|do
block|{
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|1
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|1
index|]
argument_list|,
operator|(
name|expand_tabs
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|2
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|2
index|]
argument_list|,
operator|(
name|case_sen
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|3
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|3
index|]
argument_list|,
operator|(
name|observ_margins
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|4
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|4
index|]
argument_list|,
operator|(
name|auto_format
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|5
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|5
index|]
argument_list|,
operator|(
name|eightbit
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|6
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|6
index|]
argument_list|,
operator|(
name|info_window
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|7
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %s"
argument_list|,
name|mode_strings
index|[
literal|7
index|]
argument_list|,
operator|(
name|emacs_keys_mode
condition|?
name|ON
else|:
name|OFF
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|modes_menu
index|[
literal|8
index|]
operator|.
name|item_string
argument_list|,
literal|"%s %d"
argument_list|,
name|mode_strings
index|[
literal|8
index|]
argument_list|,
name|right_margin
argument_list|)
expr_stmt|;
name|ret_value
operator|=
name|menu_op
argument_list|(
name|modes_menu
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ret_value
condition|)
block|{
case|case
literal|1
case|:
name|expand_tabs
operator|=
operator|!
name|expand_tabs
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|case_sen
operator|=
operator|!
name|case_sen
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|observ_margins
operator|=
operator|!
name|observ_margins
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|auto_format
operator|=
operator|!
name|auto_format
expr_stmt|;
if|if
condition|(
name|auto_format
condition|)
name|observ_margins
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|eightbit
operator|=
operator|!
name|eightbit
expr_stmt|;
name|redraw
argument_list|()
expr_stmt|;
name|wnoutrefresh
argument_list|(
name|text_win
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
if|if
condition|(
name|info_window
condition|)
name|no_info_window
argument_list|()
expr_stmt|;
else|else
name|create_info_window
argument_list|()
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|emacs_keys_mode
operator|=
operator|!
name|emacs_keys_mode
expr_stmt|;
if|if
condition|(
name|info_window
condition|)
name|paint_info_win
argument_list|()
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|string
operator|=
name|get_string
argument_list|(
name|margin_prompt
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|!=
name|NULL
condition|)
block|{
name|counter
operator|=
name|atoi
argument_list|(
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|counter
operator|>
literal|0
condition|)
name|right_margin
operator|=
name|counter
expr_stmt|;
name|free
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
do|while
condition|(
name|ret_value
operator|!=
literal|0
condition|)
do|;
block|}
end_function

begin_function
name|char
modifier|*
name|is_in_string
parameter_list|(
name|string
parameter_list|,
name|substring
parameter_list|)
comment|/* a strchr() look-alike for systems without 				   strchr() */
name|char
modifier|*
name|string
decl_stmt|,
decl|*
name|substring
decl_stmt|;
end_function

begin_block
block|{
name|char
modifier|*
name|full
decl_stmt|,
modifier|*
name|sub
decl_stmt|;
for|for
control|(
name|sub
operator|=
name|substring
init|;
operator|(
name|sub
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|sub
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|;
name|sub
operator|++
control|)
block|{
for|for
control|(
name|full
operator|=
name|string
init|;
operator|(
name|full
operator|!=
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|full
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
condition|;
name|full
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|sub
operator|==
operator|*
name|full
condition|)
return|return
operator|(
name|full
operator|)
return|;
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_block

begin_comment
comment|/*  |	handle names of the form "~/file", "~user/file",   |	"$HOME/foo", "~/$FOO", etc.  */
end_comment

begin_function
name|char
modifier|*
name|resolve_name
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
block|{
name|char
name|long_buffer
index|[
literal|1024
index|]
decl_stmt|;
name|char
name|short_buffer
index|[
literal|128
index|]
decl_stmt|;
name|char
modifier|*
name|buffer
decl_stmt|;
name|char
modifier|*
name|slash
decl_stmt|;
name|char
modifier|*
name|tmp
decl_stmt|;
name|char
modifier|*
name|start_of_var
decl_stmt|;
name|int
name|offset
decl_stmt|;
name|int
name|index
decl_stmt|;
name|int
name|counter
decl_stmt|;
name|struct
name|passwd
modifier|*
name|user
decl_stmt|;
if|if
condition|(
name|name
index|[
literal|0
index|]
operator|==
literal|'~'
condition|)
block|{
if|if
condition|(
name|name
index|[
literal|1
index|]
operator|==
literal|'/'
condition|)
block|{
name|index
operator|=
name|getuid
argument_list|()
expr_stmt|;
name|user
operator|=
operator|(
expr|struct
name|passwd
operator|*
operator|)
name|getpwuid
argument_list|(
name|index
argument_list|)
expr_stmt|;
name|slash
operator|=
name|name
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|slash
operator|=
name|strchr
argument_list|(
name|name
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|slash
operator|==
name|NULL
condition|)
return|return
operator|(
name|name
operator|)
return|;
operator|*
name|slash
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
name|user
operator|=
operator|(
expr|struct
name|passwd
operator|*
operator|)
name|getpwnam
argument_list|(
operator|(
name|name
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
operator|*
name|slash
operator|=
literal|'/'
expr_stmt|;
block|}
if|if
condition|(
name|user
operator|==
name|NULL
condition|)
block|{
return|return
operator|(
name|name
operator|)
return|;
block|}
name|buffer
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|user
operator|->
name|pw_dir
argument_list|)
operator|+
name|strlen
argument_list|(
name|slash
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|user
operator|->
name|pw_dir
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|buffer
argument_list|,
name|slash
argument_list|)
expr_stmt|;
block|}
else|else
name|buffer
operator|=
name|name
expr_stmt|;
if|if
condition|(
name|is_in_string
argument_list|(
name|buffer
argument_list|,
literal|"$"
argument_list|)
condition|)
block|{
name|tmp
operator|=
name|buffer
expr_stmt|;
name|index
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|tmp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
name|index
operator|<
literal|1024
operator|)
condition|)
block|{
while|while
condition|(
operator|(
operator|*
name|tmp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'$'
operator|)
operator|&&
operator|(
name|index
operator|<
literal|1024
operator|)
condition|)
block|{
name|long_buffer
index|[
name|index
index|]
operator|=
operator|*
name|tmp
expr_stmt|;
name|tmp
operator|++
expr_stmt|;
name|index
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|*
name|tmp
operator|==
literal|'$'
operator|)
operator|&&
operator|(
name|index
operator|<
literal|1024
operator|)
condition|)
block|{
name|counter
operator|=
literal|0
expr_stmt|;
name|start_of_var
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'{'
condition|)
comment|/* } */
comment|/* bracketed variable name */
block|{
name|tmp
operator|++
expr_stmt|;
comment|/* { */
while|while
condition|(
operator|(
operator|*
name|tmp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'}'
operator|)
operator|&&
operator|(
name|counter
operator|<
literal|128
operator|)
condition|)
block|{
name|short_buffer
index|[
name|counter
index|]
operator|=
operator|*
name|tmp
expr_stmt|;
name|counter
operator|++
expr_stmt|;
name|tmp
operator|++
expr_stmt|;
block|}
comment|/* { */
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'}'
condition|)
name|tmp
operator|++
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|(
operator|*
name|tmp
operator|!=
operator|(
name|char
operator|)
name|NULL
operator|)
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'/'
operator|)
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'$'
operator|)
operator|&&
operator|(
name|counter
operator|<
literal|128
operator|)
condition|)
block|{
name|short_buffer
index|[
name|counter
index|]
operator|=
operator|*
name|tmp
expr_stmt|;
name|counter
operator|++
expr_stmt|;
name|tmp
operator|++
expr_stmt|;
block|}
block|}
name|short_buffer
index|[
name|counter
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
operator|(
name|slash
operator|=
name|getenv
argument_list|(
name|short_buffer
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|offset
operator|=
name|strlen
argument_list|(
name|slash
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|offset
operator|+
name|index
operator|)
operator|<
literal|1024
condition|)
name|strcpy
argument_list|(
operator|&
name|long_buffer
index|[
name|index
index|]
argument_list|,
name|slash
argument_list|)
expr_stmt|;
name|index
operator|+=
name|offset
expr_stmt|;
block|}
else|else
block|{
while|while
condition|(
operator|(
name|start_of_var
operator|!=
name|tmp
operator|)
operator|&&
operator|(
name|index
operator|<
literal|1024
operator|)
condition|)
block|{
name|long_buffer
index|[
name|index
index|]
operator|=
operator|*
name|start_of_var
expr_stmt|;
name|start_of_var
operator|++
expr_stmt|;
name|index
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
name|index
operator|==
literal|1024
condition|)
return|return
operator|(
name|buffer
operator|)
return|;
else|else
name|long_buffer
index|[
name|index
index|]
operator|=
operator|(
name|char
operator|)
name|NULL
expr_stmt|;
if|if
condition|(
name|name
operator|!=
name|buffer
condition|)
name|free
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|buffer
operator|=
name|malloc
argument_list|(
name|index
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|long_buffer
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|buffer
operator|)
return|;
block|}
end_function

begin_function
name|int
name|restrict_mode
parameter_list|()
block|{
if|if
condition|(
operator|!
name|restricted
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
name|wmove
argument_list|(
name|com_win
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wprintw
argument_list|(
name|com_win
argument_list|,
name|restricted_msg
argument_list|)
expr_stmt|;
name|wclrtoeol
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|wrefresh
argument_list|(
name|com_win
argument_list|)
expr_stmt|;
name|clear_com_win
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  |	The following routine tests the input string against the list of   |	strings, to determine if the string is a unique match with one of the   |	valid values.  */
end_comment

begin_function
name|int
name|unique_test
parameter_list|(
name|string
parameter_list|,
name|list
parameter_list|)
name|char
modifier|*
name|string
decl_stmt|;
name|char
modifier|*
name|list
index|[]
decl_stmt|;
block|{
name|int
name|counter
decl_stmt|;
name|int
name|num_match
decl_stmt|;
name|int
name|result
decl_stmt|;
name|num_match
operator|=
literal|0
expr_stmt|;
name|counter
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|list
index|[
name|counter
index|]
operator|!=
name|NULL
condition|)
block|{
name|result
operator|=
name|compare
argument_list|(
name|string
argument_list|,
name|list
index|[
name|counter
index|]
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
condition|)
name|num_match
operator|++
expr_stmt|;
name|counter
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|num_match
operator|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|NO_CATGETS
end_ifndef

begin_comment
comment|/*  |	Get the catalog entry, and if it got it from the catalog,   |	make a copy, since the buffer will be overwritten by the   |	next call to catgets().  */
end_comment

begin_function
name|char
modifier|*
name|catgetlocal
parameter_list|(
name|number
parameter_list|,
name|string
parameter_list|)
name|int
name|number
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
block|{
name|char
modifier|*
name|temp1
decl_stmt|;
name|char
modifier|*
name|temp2
decl_stmt|;
name|temp1
operator|=
name|catgets
argument_list|(
name|catalog
argument_list|,
literal|1
argument_list|,
name|number
argument_list|,
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp1
operator|!=
name|string
condition|)
block|{
name|temp2
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|temp1
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|temp2
argument_list|,
name|temp1
argument_list|)
expr_stmt|;
name|temp1
operator|=
name|temp2
expr_stmt|;
block|}
return|return
operator|(
name|temp1
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NO_CATGETS */
end_comment

begin_comment
comment|/*  |	The following is to allow for using message catalogs which allow   |	the software to be 'localized', that is, to use different languages   |	all with the same binary.  For more information, see your system   |	documentation, or the X/Open Internationalization Guide.  */
end_comment

begin_function
name|void
name|strings_init
parameter_list|()
block|{
name|int
name|counter
decl_stmt|;
ifndef|#
directive|ifndef
name|NO_CATGETS
name|setlocale
argument_list|(
name|LC_ALL
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|catalog
operator|=
name|catopen
argument_list|(
literal|"ee"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* NO_CATGETS */
name|modes_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|1
argument_list|,
literal|"modes menu"
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|2
argument_list|,
literal|"tabs to spaces       "
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|3
argument_list|,
literal|"case sensitive search"
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|4
argument_list|,
literal|"margins observed     "
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|5
argument_list|,
literal|"auto-paragraph format"
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|5
index|]
operator|=
name|catgetlocal
argument_list|(
literal|6
argument_list|,
literal|"eightbit characters  "
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|6
index|]
operator|=
name|catgetlocal
argument_list|(
literal|7
argument_list|,
literal|"info window          "
argument_list|)
expr_stmt|;
name|mode_strings
index|[
literal|8
index|]
operator|=
name|catgetlocal
argument_list|(
literal|8
argument_list|,
literal|"right margin         "
argument_list|)
expr_stmt|;
name|leave_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|9
argument_list|,
literal|"leave menu"
argument_list|)
expr_stmt|;
name|leave_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|10
argument_list|,
literal|"save changes"
argument_list|)
expr_stmt|;
name|leave_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|11
argument_list|,
literal|"no save"
argument_list|)
expr_stmt|;
name|file_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|12
argument_list|,
literal|"file menu"
argument_list|)
expr_stmt|;
name|file_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|13
argument_list|,
literal|"read a file"
argument_list|)
expr_stmt|;
name|file_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|14
argument_list|,
literal|"write a file"
argument_list|)
expr_stmt|;
name|file_menu
index|[
literal|3
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|15
argument_list|,
literal|"save file"
argument_list|)
expr_stmt|;
name|file_menu
index|[
literal|4
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|16
argument_list|,
literal|"print editor contents"
argument_list|)
expr_stmt|;
name|search_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|17
argument_list|,
literal|"search menu"
argument_list|)
expr_stmt|;
name|search_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|18
argument_list|,
literal|"search for ..."
argument_list|)
expr_stmt|;
name|search_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|19
argument_list|,
literal|"search"
argument_list|)
expr_stmt|;
name|spell_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|20
argument_list|,
literal|"spell menu"
argument_list|)
expr_stmt|;
name|spell_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|21
argument_list|,
literal|"use 'spell'"
argument_list|)
expr_stmt|;
name|spell_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|22
argument_list|,
literal|"use 'ispell'"
argument_list|)
expr_stmt|;
name|misc_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|23
argument_list|,
literal|"miscellaneous menu"
argument_list|)
expr_stmt|;
name|misc_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|24
argument_list|,
literal|"format paragraph"
argument_list|)
expr_stmt|;
name|misc_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|25
argument_list|,
literal|"shell command"
argument_list|)
expr_stmt|;
name|misc_menu
index|[
literal|3
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|26
argument_list|,
literal|"check spelling"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|27
argument_list|,
literal|"main menu"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|28
argument_list|,
literal|"leave editor"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|29
argument_list|,
literal|"help"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|3
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|30
argument_list|,
literal|"file operations"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|4
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|31
argument_list|,
literal|"redraw screen"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|5
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|32
argument_list|,
literal|"settings"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|6
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|33
argument_list|,
literal|"search"
argument_list|)
expr_stmt|;
name|main_menu
index|[
literal|7
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|34
argument_list|,
literal|"miscellaneous"
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|0
index|]
operator|=
name|catgetlocal
argument_list|(
literal|35
argument_list|,
literal|"Control keys:                                                              "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|36
argument_list|,
literal|"^a ascii code           ^i tab                  ^r right                   "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|37
argument_list|,
literal|"^b bottom of text       ^j newline              ^t top of text             "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|38
argument_list|,
literal|"^c command              ^k delete char          ^u up                      "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|39
argument_list|,
literal|"^d down                 ^l left                 ^v undelete word           "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|5
index|]
operator|=
name|catgetlocal
argument_list|(
literal|40
argument_list|,
literal|"^e search prompt        ^m newline              ^w delete word             "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|6
index|]
operator|=
name|catgetlocal
argument_list|(
literal|41
argument_list|,
literal|"^f undelete char        ^n next page            ^x search                  "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|7
index|]
operator|=
name|catgetlocal
argument_list|(
literal|42
argument_list|,
literal|"^g begin of line        ^o end of line          ^y delete line             "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|8
index|]
operator|=
name|catgetlocal
argument_list|(
literal|43
argument_list|,
literal|"^h backspace            ^p prev page            ^z undelete line           "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|9
index|]
operator|=
name|catgetlocal
argument_list|(
literal|44
argument_list|,
literal|"^[ (escape) menu        ESC-Enter: exit ee                                 "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|10
index|]
operator|=
name|catgetlocal
argument_list|(
literal|45
argument_list|,
literal|"                                                                           "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|11
index|]
operator|=
name|catgetlocal
argument_list|(
literal|46
argument_list|,
literal|"Commands:                                                                  "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|12
index|]
operator|=
name|catgetlocal
argument_list|(
literal|47
argument_list|,
literal|"help    : get this info                 file    : print file name          "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|13
index|]
operator|=
name|catgetlocal
argument_list|(
literal|48
argument_list|,
literal|"read    : read a file                   char    : ascii code of char       "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|14
index|]
operator|=
name|catgetlocal
argument_list|(
literal|49
argument_list|,
literal|"write   : write a file                  case    : case sensitive search    "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|15
index|]
operator|=
name|catgetlocal
argument_list|(
literal|50
argument_list|,
literal|"exit    : leave and save                nocase  : case insensitive search  "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|16
index|]
operator|=
name|catgetlocal
argument_list|(
literal|51
argument_list|,
literal|"quit    : leave, no save                !cmd    : execute \"cmd\" in shell   "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|17
index|]
operator|=
name|catgetlocal
argument_list|(
literal|52
argument_list|,
literal|"line    : display line #                0-9     : go to line \"#\"           "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|18
index|]
operator|=
name|catgetlocal
argument_list|(
literal|53
argument_list|,
literal|"expand  : expand tabs                   noexpand: do not expand tabs         "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|19
index|]
operator|=
name|catgetlocal
argument_list|(
literal|54
argument_list|,
literal|"                                                                             "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|20
index|]
operator|=
name|catgetlocal
argument_list|(
literal|55
argument_list|,
literal|"  ee [-i] [-e] [-h] [file(s)]                                                 "
argument_list|)
expr_stmt|;
name|help_text
index|[
literal|21
index|]
operator|=
name|catgetlocal
argument_list|(
literal|56
argument_list|,
literal|"   -i : no information window  -e : do not expand tabs   -h : no highlight "
argument_list|)
expr_stmt|;
name|control_keys
index|[
literal|0
index|]
operator|=
name|catgetlocal
argument_list|(
literal|57
argument_list|,
literal|"^[ (escape) menu  ^e search prompt  ^y delete line    ^u up     ^p prev page  "
argument_list|)
expr_stmt|;
name|control_keys
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|58
argument_list|,
literal|"^a ascii code     ^x search         ^z undelete line  ^d down   ^n next page  "
argument_list|)
expr_stmt|;
name|control_keys
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|59
argument_list|,
literal|"^b bottom of text ^g begin of line  ^w delete word    ^l left                 "
argument_list|)
expr_stmt|;
name|control_keys
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|60
argument_list|,
literal|"^t top of text    ^o end of line    ^v undelete word  ^r right                "
argument_list|)
expr_stmt|;
name|control_keys
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|61
argument_list|,
literal|"^c command        ^k delete char    ^f undelete char      ESC-Enter: exit ee  "
argument_list|)
expr_stmt|;
name|command_strings
index|[
literal|0
index|]
operator|=
name|catgetlocal
argument_list|(
literal|62
argument_list|,
literal|"help : get help info  |file  : print file name         |line : print line # "
argument_list|)
expr_stmt|;
name|command_strings
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|63
argument_list|,
literal|"read : read a file    |char  : ascii code of char      |0-9 : go to line \"#\""
argument_list|)
expr_stmt|;
name|command_strings
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|64
argument_list|,
literal|"write: write a file   |case  : case sensitive search   |exit : leave and save "
argument_list|)
expr_stmt|;
name|command_strings
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|65
argument_list|,
literal|"!cmd : shell \"cmd\"    |nocase: ignore case in search   |quit : leave, no save"
argument_list|)
expr_stmt|;
name|command_strings
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|66
argument_list|,
literal|"expand: expand tabs   |noexpand: do not expand tabs                           "
argument_list|)
expr_stmt|;
name|com_win_message
operator|=
name|catgetlocal
argument_list|(
literal|67
argument_list|,
literal|"    press Escape (^[) for menu"
argument_list|)
expr_stmt|;
name|no_file_string
operator|=
name|catgetlocal
argument_list|(
literal|68
argument_list|,
literal|"no file"
argument_list|)
expr_stmt|;
name|ascii_code_str
operator|=
name|catgetlocal
argument_list|(
literal|69
argument_list|,
literal|"ascii code: "
argument_list|)
expr_stmt|;
name|printer_msg_str
operator|=
name|catgetlocal
argument_list|(
literal|70
argument_list|,
literal|"sending contents of buffer to \"%s\" "
argument_list|)
expr_stmt|;
name|command_str
operator|=
name|catgetlocal
argument_list|(
literal|71
argument_list|,
literal|"command: "
argument_list|)
expr_stmt|;
name|file_write_prompt_str
operator|=
name|catgetlocal
argument_list|(
literal|72
argument_list|,
literal|"name of file to write: "
argument_list|)
expr_stmt|;
name|file_read_prompt_str
operator|=
name|catgetlocal
argument_list|(
literal|73
argument_list|,
literal|"name of file to read: "
argument_list|)
expr_stmt|;
name|char_str
operator|=
name|catgetlocal
argument_list|(
literal|74
argument_list|,
literal|"character = %d"
argument_list|)
expr_stmt|;
name|unkn_cmd_str
operator|=
name|catgetlocal
argument_list|(
literal|75
argument_list|,
literal|"unknown command \"%s\""
argument_list|)
expr_stmt|;
name|non_unique_cmd_msg
operator|=
name|catgetlocal
argument_list|(
literal|76
argument_list|,
literal|"entered command is not unique"
argument_list|)
expr_stmt|;
name|line_num_str
operator|=
name|catgetlocal
argument_list|(
literal|77
argument_list|,
literal|"line %d  "
argument_list|)
expr_stmt|;
name|line_len_str
operator|=
name|catgetlocal
argument_list|(
literal|78
argument_list|,
literal|"length = %d"
argument_list|)
expr_stmt|;
name|current_file_str
operator|=
name|catgetlocal
argument_list|(
literal|79
argument_list|,
literal|"current file is \"%s\" "
argument_list|)
expr_stmt|;
name|usage0
operator|=
name|catgetlocal
argument_list|(
literal|80
argument_list|,
literal|"usage: %s [-i] [-e] [-h] [+line_number] [file(s)]\n"
argument_list|)
expr_stmt|;
name|usage1
operator|=
name|catgetlocal
argument_list|(
literal|81
argument_list|,
literal|"       -i   turn off info window\n"
argument_list|)
expr_stmt|;
name|usage2
operator|=
name|catgetlocal
argument_list|(
literal|82
argument_list|,
literal|"       -e   do not convert tabs to spaces\n"
argument_list|)
expr_stmt|;
name|usage3
operator|=
name|catgetlocal
argument_list|(
literal|83
argument_list|,
literal|"       -h   do not use highlighting\n"
argument_list|)
expr_stmt|;
name|file_is_dir_msg
operator|=
name|catgetlocal
argument_list|(
literal|84
argument_list|,
literal|"file \"%s\" is a directory"
argument_list|)
expr_stmt|;
name|new_file_msg
operator|=
name|catgetlocal
argument_list|(
literal|85
argument_list|,
literal|"new file \"%s\""
argument_list|)
expr_stmt|;
name|cant_open_msg
operator|=
name|catgetlocal
argument_list|(
literal|86
argument_list|,
literal|"can't open \"%s\""
argument_list|)
expr_stmt|;
name|open_file_msg
operator|=
name|catgetlocal
argument_list|(
literal|87
argument_list|,
literal|"file \"%s\", %d lines"
argument_list|)
expr_stmt|;
name|file_read_fin_msg
operator|=
name|catgetlocal
argument_list|(
literal|88
argument_list|,
literal|"finished reading file \"%s\""
argument_list|)
expr_stmt|;
name|reading_file_msg
operator|=
name|catgetlocal
argument_list|(
literal|89
argument_list|,
literal|"reading file \"%s\""
argument_list|)
expr_stmt|;
name|read_only_msg
operator|=
name|catgetlocal
argument_list|(
literal|90
argument_list|,
literal|", read only"
argument_list|)
expr_stmt|;
name|file_read_lines_msg
operator|=
name|catgetlocal
argument_list|(
literal|91
argument_list|,
literal|"file \"%s\", %d lines"
argument_list|)
expr_stmt|;
name|save_file_name_prompt
operator|=
name|catgetlocal
argument_list|(
literal|92
argument_list|,
literal|"enter name of file: "
argument_list|)
expr_stmt|;
name|file_not_saved_msg
operator|=
name|catgetlocal
argument_list|(
literal|93
argument_list|,
literal|"no filename entered: file not saved"
argument_list|)
expr_stmt|;
name|changes_made_prompt
operator|=
name|catgetlocal
argument_list|(
literal|94
argument_list|,
literal|"changes have been made, are you sure? (y/n [n]) "
argument_list|)
expr_stmt|;
name|yes_char
operator|=
name|catgetlocal
argument_list|(
literal|95
argument_list|,
literal|"y"
argument_list|)
expr_stmt|;
name|file_exists_prompt
operator|=
name|catgetlocal
argument_list|(
literal|96
argument_list|,
literal|"file already exists, overwrite? (y/n) [n] "
argument_list|)
expr_stmt|;
name|create_file_fail_msg
operator|=
name|catgetlocal
argument_list|(
literal|97
argument_list|,
literal|"unable to create file \"%s\""
argument_list|)
expr_stmt|;
name|writing_file_msg
operator|=
name|catgetlocal
argument_list|(
literal|98
argument_list|,
literal|"writing file \"%s\""
argument_list|)
expr_stmt|;
name|file_written_msg
operator|=
name|catgetlocal
argument_list|(
literal|99
argument_list|,
literal|"\"%s\" %d lines, %d characters"
argument_list|)
expr_stmt|;
name|searching_msg
operator|=
name|catgetlocal
argument_list|(
literal|100
argument_list|,
literal|"           ...searching"
argument_list|)
expr_stmt|;
name|str_not_found_msg
operator|=
name|catgetlocal
argument_list|(
literal|101
argument_list|,
literal|"string \"%s\" not found"
argument_list|)
expr_stmt|;
name|search_prompt_str
operator|=
name|catgetlocal
argument_list|(
literal|102
argument_list|,
literal|"search for: "
argument_list|)
expr_stmt|;
name|exec_err_msg
operator|=
name|catgetlocal
argument_list|(
literal|103
argument_list|,
literal|"could not exec %s"
argument_list|)
expr_stmt|;
name|continue_msg
operator|=
name|catgetlocal
argument_list|(
literal|104
argument_list|,
literal|"press return to continue "
argument_list|)
expr_stmt|;
name|menu_cancel_msg
operator|=
name|catgetlocal
argument_list|(
literal|105
argument_list|,
literal|"press Esc to cancel"
argument_list|)
expr_stmt|;
name|menu_size_err_msg
operator|=
name|catgetlocal
argument_list|(
literal|106
argument_list|,
literal|"menu too large for window"
argument_list|)
expr_stmt|;
name|press_any_key_msg
operator|=
name|catgetlocal
argument_list|(
literal|107
argument_list|,
literal|"press any key to continue "
argument_list|)
expr_stmt|;
name|shell_prompt
operator|=
name|catgetlocal
argument_list|(
literal|108
argument_list|,
literal|"shell command: "
argument_list|)
expr_stmt|;
name|formatting_msg
operator|=
name|catgetlocal
argument_list|(
literal|109
argument_list|,
literal|"...formatting paragraph..."
argument_list|)
expr_stmt|;
name|shell_echo_msg
operator|=
name|catgetlocal
argument_list|(
literal|110
argument_list|,
literal|"<!echo 'list of unrecognized words'; echo -=-=-=-=-=-"
argument_list|)
expr_stmt|;
name|spell_in_prog_msg
operator|=
name|catgetlocal
argument_list|(
literal|111
argument_list|,
literal|"sending contents of edit buffer to 'spell'"
argument_list|)
expr_stmt|;
name|margin_prompt
operator|=
name|catgetlocal
argument_list|(
literal|112
argument_list|,
literal|"right margin is: "
argument_list|)
expr_stmt|;
name|restricted_msg
operator|=
name|catgetlocal
argument_list|(
literal|113
argument_list|,
literal|"restricted mode: unable to perform requested operation"
argument_list|)
expr_stmt|;
name|ON
operator|=
name|catgetlocal
argument_list|(
literal|114
argument_list|,
literal|"ON"
argument_list|)
expr_stmt|;
name|OFF
operator|=
name|catgetlocal
argument_list|(
literal|115
argument_list|,
literal|"OFF"
argument_list|)
expr_stmt|;
name|HELP
operator|=
name|catgetlocal
argument_list|(
literal|116
argument_list|,
literal|"HELP"
argument_list|)
expr_stmt|;
name|WRITE
operator|=
name|catgetlocal
argument_list|(
literal|117
argument_list|,
literal|"WRITE"
argument_list|)
expr_stmt|;
name|READ
operator|=
name|catgetlocal
argument_list|(
literal|118
argument_list|,
literal|"READ"
argument_list|)
expr_stmt|;
name|LINE
operator|=
name|catgetlocal
argument_list|(
literal|119
argument_list|,
literal|"LINE"
argument_list|)
expr_stmt|;
name|FILE_str
operator|=
name|catgetlocal
argument_list|(
literal|120
argument_list|,
literal|"FILE"
argument_list|)
expr_stmt|;
name|CHARACTER
operator|=
name|catgetlocal
argument_list|(
literal|121
argument_list|,
literal|"CHARACTER"
argument_list|)
expr_stmt|;
name|REDRAW
operator|=
name|catgetlocal
argument_list|(
literal|122
argument_list|,
literal|"REDRAW"
argument_list|)
expr_stmt|;
name|RESEQUENCE
operator|=
name|catgetlocal
argument_list|(
literal|123
argument_list|,
literal|"RESEQUENCE"
argument_list|)
expr_stmt|;
name|AUTHOR
operator|=
name|catgetlocal
argument_list|(
literal|124
argument_list|,
literal|"AUTHOR"
argument_list|)
expr_stmt|;
name|VERSION
operator|=
name|catgetlocal
argument_list|(
literal|125
argument_list|,
literal|"VERSION"
argument_list|)
expr_stmt|;
name|CASE
operator|=
name|catgetlocal
argument_list|(
literal|126
argument_list|,
literal|"CASE"
argument_list|)
expr_stmt|;
name|NOCASE
operator|=
name|catgetlocal
argument_list|(
literal|127
argument_list|,
literal|"NOCASE"
argument_list|)
expr_stmt|;
name|EXPAND
operator|=
name|catgetlocal
argument_list|(
literal|128
argument_list|,
literal|"EXPAND"
argument_list|)
expr_stmt|;
name|NOEXPAND
operator|=
name|catgetlocal
argument_list|(
literal|129
argument_list|,
literal|"NOEXPAND"
argument_list|)
expr_stmt|;
name|Exit_string
operator|=
name|catgetlocal
argument_list|(
literal|130
argument_list|,
literal|"EXIT"
argument_list|)
expr_stmt|;
name|QUIT_string
operator|=
name|catgetlocal
argument_list|(
literal|131
argument_list|,
literal|"QUIT"
argument_list|)
expr_stmt|;
name|INFO
operator|=
name|catgetlocal
argument_list|(
literal|132
argument_list|,
literal|"INFO"
argument_list|)
expr_stmt|;
name|NOINFO
operator|=
name|catgetlocal
argument_list|(
literal|133
argument_list|,
literal|"NOINFO"
argument_list|)
expr_stmt|;
name|MARGINS
operator|=
name|catgetlocal
argument_list|(
literal|134
argument_list|,
literal|"MARGINS"
argument_list|)
expr_stmt|;
name|NOMARGINS
operator|=
name|catgetlocal
argument_list|(
literal|135
argument_list|,
literal|"NOMARGINS"
argument_list|)
expr_stmt|;
name|AUTOFORMAT
operator|=
name|catgetlocal
argument_list|(
literal|136
argument_list|,
literal|"AUTOFORMAT"
argument_list|)
expr_stmt|;
name|NOAUTOFORMAT
operator|=
name|catgetlocal
argument_list|(
literal|137
argument_list|,
literal|"NOAUTOFORMAT"
argument_list|)
expr_stmt|;
name|Echo
operator|=
name|catgetlocal
argument_list|(
literal|138
argument_list|,
literal|"ECHO"
argument_list|)
expr_stmt|;
name|PRINTCOMMAND
operator|=
name|catgetlocal
argument_list|(
literal|139
argument_list|,
literal|"PRINTCOMMAND"
argument_list|)
expr_stmt|;
name|RIGHTMARGIN
operator|=
name|catgetlocal
argument_list|(
literal|140
argument_list|,
literal|"RIGHTMARGIN"
argument_list|)
expr_stmt|;
name|HIGHLIGHT
operator|=
name|catgetlocal
argument_list|(
literal|141
argument_list|,
literal|"HIGHLIGHT"
argument_list|)
expr_stmt|;
name|NOHIGHLIGHT
operator|=
name|catgetlocal
argument_list|(
literal|142
argument_list|,
literal|"NOHIGHLIGHT"
argument_list|)
expr_stmt|;
name|EIGHTBIT
operator|=
name|catgetlocal
argument_list|(
literal|143
argument_list|,
literal|"EIGHTBIT"
argument_list|)
expr_stmt|;
name|NOEIGHTBIT
operator|=
name|catgetlocal
argument_list|(
literal|144
argument_list|,
literal|"NOEIGHTBIT"
argument_list|)
expr_stmt|;
comment|/* 	 |	additions 	 */
name|mode_strings
index|[
literal|7
index|]
operator|=
name|catgetlocal
argument_list|(
literal|145
argument_list|,
literal|"emacs key bindings   "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|0
index|]
operator|=
name|help_text
index|[
literal|0
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|146
argument_list|,
literal|"^a beginning of line    ^i tab                  ^r restore word            "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|147
argument_list|,
literal|"^b back 1 char          ^j undel char           ^t top of text             "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|148
argument_list|,
literal|"^c command              ^k delete line          ^u bottom of text          "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|149
argument_list|,
literal|"^d delete char          ^l undelete line        ^v next page               "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|5
index|]
operator|=
name|catgetlocal
argument_list|(
literal|150
argument_list|,
literal|"^e end of line          ^m newline              ^w delete word             "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|6
index|]
operator|=
name|catgetlocal
argument_list|(
literal|151
argument_list|,
literal|"^f forward 1 char       ^n next line            ^x search                  "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|7
index|]
operator|=
name|catgetlocal
argument_list|(
literal|152
argument_list|,
literal|"^g go back 1 page       ^o ascii char insert    ^y search prompt           "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|8
index|]
operator|=
name|catgetlocal
argument_list|(
literal|153
argument_list|,
literal|"^h backspace            ^p prev line            ^z next word               "
argument_list|)
expr_stmt|;
name|emacs_help_text
index|[
literal|9
index|]
operator|=
name|help_text
index|[
literal|9
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|10
index|]
operator|=
name|help_text
index|[
literal|10
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|11
index|]
operator|=
name|help_text
index|[
literal|11
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|12
index|]
operator|=
name|help_text
index|[
literal|12
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|13
index|]
operator|=
name|help_text
index|[
literal|13
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|14
index|]
operator|=
name|help_text
index|[
literal|14
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|15
index|]
operator|=
name|help_text
index|[
literal|15
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|16
index|]
operator|=
name|help_text
index|[
literal|16
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|17
index|]
operator|=
name|help_text
index|[
literal|17
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|18
index|]
operator|=
name|help_text
index|[
literal|18
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|19
index|]
operator|=
name|help_text
index|[
literal|19
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|20
index|]
operator|=
name|help_text
index|[
literal|20
index|]
expr_stmt|;
name|emacs_help_text
index|[
literal|21
index|]
operator|=
name|help_text
index|[
literal|21
index|]
expr_stmt|;
name|emacs_control_keys
index|[
literal|0
index|]
operator|=
name|catgetlocal
argument_list|(
literal|154
argument_list|,
literal|"^[ (escape) menu  ^y search prompt  ^k delete line   ^p prev li   ^g prev page"
argument_list|)
expr_stmt|;
name|emacs_control_keys
index|[
literal|1
index|]
operator|=
name|catgetlocal
argument_list|(
literal|155
argument_list|,
literal|"^o ascii code     ^x search         ^l undelete line ^n next li   ^v next page"
argument_list|)
expr_stmt|;
name|emacs_control_keys
index|[
literal|2
index|]
operator|=
name|catgetlocal
argument_list|(
literal|156
argument_list|,
literal|"^u end of file    ^a begin of line  ^w delete word   ^b back 1 char           "
argument_list|)
expr_stmt|;
name|emacs_control_keys
index|[
literal|3
index|]
operator|=
name|catgetlocal
argument_list|(
literal|157
argument_list|,
literal|"^t top of text    ^e end of line    ^r restore word  ^f forward 1 char        "
argument_list|)
expr_stmt|;
name|emacs_control_keys
index|[
literal|4
index|]
operator|=
name|catgetlocal
argument_list|(
literal|158
argument_list|,
literal|"^c command        ^d delete char    ^j undelete char ^z next word              "
argument_list|)
expr_stmt|;
name|EMACS_string
operator|=
name|catgetlocal
argument_list|(
literal|159
argument_list|,
literal|"EMACS"
argument_list|)
expr_stmt|;
name|NOEMACS_string
operator|=
name|catgetlocal
argument_list|(
literal|160
argument_list|,
literal|"NOEMACS"
argument_list|)
expr_stmt|;
name|usage4
operator|=
name|catgetlocal
argument_list|(
literal|161
argument_list|,
literal|"       +#   put cursor at line #\n"
argument_list|)
expr_stmt|;
name|conf_dump_err_msg
operator|=
name|catgetlocal
argument_list|(
literal|162
argument_list|,
literal|"unable to open .init.ee for writing, no configuration saved!"
argument_list|)
expr_stmt|;
name|conf_dump_success_msg
operator|=
name|catgetlocal
argument_list|(
literal|163
argument_list|,
literal|"ee configuration saved in file %s"
argument_list|)
expr_stmt|;
name|modes_menu
index|[
literal|9
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|164
argument_list|,
literal|"save editor configuration"
argument_list|)
expr_stmt|;
name|config_dump_menu
index|[
literal|0
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|165
argument_list|,
literal|"save ee configuration"
argument_list|)
expr_stmt|;
name|config_dump_menu
index|[
literal|1
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|166
argument_list|,
literal|"save in current directory"
argument_list|)
expr_stmt|;
name|config_dump_menu
index|[
literal|2
index|]
operator|.
name|item_string
operator|=
name|catgetlocal
argument_list|(
literal|167
argument_list|,
literal|"save in home directory"
argument_list|)
expr_stmt|;
name|conf_not_saved_msg
operator|=
name|catgetlocal
argument_list|(
literal|168
argument_list|,
literal|"ee configuration not saved"
argument_list|)
expr_stmt|;
name|ree_no_file_msg
operator|=
name|catgetlocal
argument_list|(
literal|169
argument_list|,
literal|"must specify a file when invoking ree"
argument_list|)
expr_stmt|;
name|cancel_string
operator|=
name|catgetlocal
argument_list|(
literal|170
argument_list|,
literal|"press Esc to cancel"
argument_list|)
expr_stmt|;
name|menu_too_lrg_msg
operator|=
name|catgetlocal
argument_list|(
literal|180
argument_list|,
literal|"menu too large for window"
argument_list|)
expr_stmt|;
name|more_above_str
operator|=
name|catgetlocal
argument_list|(
literal|181
argument_list|,
literal|"^^more^^"
argument_list|)
expr_stmt|;
name|more_below_str
operator|=
name|catgetlocal
argument_list|(
literal|182
argument_list|,
literal|"VVmoreVV"
argument_list|)
expr_stmt|;
name|commands
index|[
literal|0
index|]
operator|=
name|HELP
expr_stmt|;
name|commands
index|[
literal|1
index|]
operator|=
name|WRITE
expr_stmt|;
name|commands
index|[
literal|2
index|]
operator|=
name|READ
expr_stmt|;
name|commands
index|[
literal|3
index|]
operator|=
name|LINE
expr_stmt|;
name|commands
index|[
literal|4
index|]
operator|=
name|FILE_str
expr_stmt|;
name|commands
index|[
literal|5
index|]
operator|=
name|REDRAW
expr_stmt|;
name|commands
index|[
literal|6
index|]
operator|=
name|RESEQUENCE
expr_stmt|;
name|commands
index|[
literal|7
index|]
operator|=
name|AUTHOR
expr_stmt|;
name|commands
index|[
literal|8
index|]
operator|=
name|VERSION
expr_stmt|;
name|commands
index|[
literal|9
index|]
operator|=
name|CASE
expr_stmt|;
name|commands
index|[
literal|10
index|]
operator|=
name|NOCASE
expr_stmt|;
name|commands
index|[
literal|11
index|]
operator|=
name|EXPAND
expr_stmt|;
name|commands
index|[
literal|12
index|]
operator|=
name|NOEXPAND
expr_stmt|;
name|commands
index|[
literal|13
index|]
operator|=
name|Exit_string
expr_stmt|;
name|commands
index|[
literal|14
index|]
operator|=
name|QUIT_string
expr_stmt|;
name|commands
index|[
literal|15
index|]
operator|=
literal|"<"
expr_stmt|;
name|commands
index|[
literal|16
index|]
operator|=
literal|">"
expr_stmt|;
name|commands
index|[
literal|17
index|]
operator|=
literal|"!"
expr_stmt|;
name|commands
index|[
literal|18
index|]
operator|=
literal|"0"
expr_stmt|;
name|commands
index|[
literal|19
index|]
operator|=
literal|"1"
expr_stmt|;
name|commands
index|[
literal|20
index|]
operator|=
literal|"2"
expr_stmt|;
name|commands
index|[
literal|21
index|]
operator|=
literal|"3"
expr_stmt|;
name|commands
index|[
literal|22
index|]
operator|=
literal|"4"
expr_stmt|;
name|commands
index|[
literal|23
index|]
operator|=
literal|"5"
expr_stmt|;
name|commands
index|[
literal|24
index|]
operator|=
literal|"6"
expr_stmt|;
name|commands
index|[
literal|25
index|]
operator|=
literal|"7"
expr_stmt|;
name|commands
index|[
literal|26
index|]
operator|=
literal|"8"
expr_stmt|;
name|commands
index|[
literal|27
index|]
operator|=
literal|"9"
expr_stmt|;
name|commands
index|[
literal|28
index|]
operator|=
name|CHARACTER
expr_stmt|;
name|commands
index|[
literal|29
index|]
operator|=
name|NULL
expr_stmt|;
name|init_strings
index|[
literal|0
index|]
operator|=
name|CASE
expr_stmt|;
name|init_strings
index|[
literal|1
index|]
operator|=
name|NOCASE
expr_stmt|;
name|init_strings
index|[
literal|2
index|]
operator|=
name|EXPAND
expr_stmt|;
name|init_strings
index|[
literal|3
index|]
operator|=
name|NOEXPAND
expr_stmt|;
name|init_strings
index|[
literal|4
index|]
operator|=
name|INFO
expr_stmt|;
name|init_strings
index|[
literal|5
index|]
operator|=
name|NOINFO
expr_stmt|;
name|init_strings
index|[
literal|6
index|]
operator|=
name|MARGINS
expr_stmt|;
name|init_strings
index|[
literal|7
index|]
operator|=
name|NOMARGINS
expr_stmt|;
name|init_strings
index|[
literal|8
index|]
operator|=
name|AUTOFORMAT
expr_stmt|;
name|init_strings
index|[
literal|9
index|]
operator|=
name|NOAUTOFORMAT
expr_stmt|;
name|init_strings
index|[
literal|10
index|]
operator|=
name|Echo
expr_stmt|;
name|init_strings
index|[
literal|11
index|]
operator|=
name|PRINTCOMMAND
expr_stmt|;
name|init_strings
index|[
literal|12
index|]
operator|=
name|RIGHTMARGIN
expr_stmt|;
name|init_strings
index|[
literal|13
index|]
operator|=
name|HIGHLIGHT
expr_stmt|;
name|init_strings
index|[
literal|14
index|]
operator|=
name|NOHIGHLIGHT
expr_stmt|;
name|init_strings
index|[
literal|15
index|]
operator|=
name|EIGHTBIT
expr_stmt|;
name|init_strings
index|[
literal|16
index|]
operator|=
name|NOEIGHTBIT
expr_stmt|;
name|init_strings
index|[
literal|17
index|]
operator|=
name|EMACS_string
expr_stmt|;
name|init_strings
index|[
literal|18
index|]
operator|=
name|NOEMACS_string
expr_stmt|;
name|init_strings
index|[
literal|19
index|]
operator|=
name|NULL
expr_stmt|;
comment|/* 	 |	allocate space for strings here for settings menu 	 */
for|for
control|(
name|counter
operator|=
literal|1
init|;
name|counter
operator|<
name|NUM_MODES_ITEMS
condition|;
name|counter
operator|++
control|)
block|{
name|modes_menu
index|[
name|counter
index|]
operator|.
name|item_string
operator|=
name|malloc
argument_list|(
literal|80
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|NO_CATGETS
name|catclose
argument_list|(
name|catalog
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* NO_CATGETS */
block|}
end_function

end_unit

