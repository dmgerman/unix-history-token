begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1983, 1993  *	The Regents of the University of California.  All rights reserved.  *  * This code is derived from software contributed to Berkeley by  * Edward Wang at The University of California, Berkeley.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the University of  *	California, Berkeley and its contributors.  * 4. Neither the name of the University nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)ttgeneric.c	8.1 (Berkeley) 6/6/93"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|"ww.h"
end_include

begin_include
include|#
directive|include
file|"tt.h"
end_include

begin_decl_stmt
name|char
name|PC
decl_stmt|,
modifier|*
name|BC
decl_stmt|,
modifier|*
name|UP
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* normal frame */
end_comment

begin_decl_stmt
name|short
name|gen_frame
index|[
literal|16
index|]
init|=
block|{
literal|' '
block|,
literal|'|'
block|,
literal|'-'
block|,
literal|'+'
block|,
literal|'|'
block|,
literal|'|'
block|,
literal|'+'
block|,
literal|'+'
block|,
literal|'-'
block|,
literal|'+'
block|,
literal|'-'
block|,
literal|'+'
block|,
literal|'+'
block|,
literal|'+'
block|,
literal|'+'
block|,
literal|'+'
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ANSI graphics frame */
end_comment

begin_define
define|#
directive|define
name|G
value|(WWM_GRP<< WWC_MSHIFT)
end_define

begin_decl_stmt
name|short
name|ansi_frame
index|[
literal|16
index|]
init|=
block|{
literal|' '
block|,
literal|'x'
operator||
name|G
block|,
literal|'Q'
operator||
name|G
block|,
literal|'m'
operator||
name|G
block|,
literal|'x'
operator||
name|G
block|,
literal|'x'
operator||
name|G
block|,
literal|'l'
operator||
name|G
block|,
literal|'t'
operator||
name|G
block|,
literal|'q'
operator||
name|G
block|,
literal|'j'
operator||
name|G
block|,
literal|'q'
operator||
name|G
block|,
literal|'v'
operator||
name|G
block|,
literal|'k'
operator||
name|G
block|,
literal|'u'
operator||
name|G
block|,
literal|'w'
operator||
name|G
block|,
literal|'n'
operator||
name|G
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
name|ansi_AS
init|=
block|{
literal|"\033(0"
block|,
literal|3
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_PC
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CM
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_IM
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_IC
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_ICn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_IP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_EI
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_DC
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_DCn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_AL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_ALn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_DL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_DLn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CD
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_VS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_VE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_TI
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_TE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_US
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_UE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_LE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_ND
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_UP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_DO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_BC
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_NL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CR
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_HO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_AS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_AE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_XS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_XE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SF
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SFn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SR
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_SRn
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tt_str
modifier|*
name|gen_CS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_MI
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_MS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_AM
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_OS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_BS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_DA
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_DB
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_NS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|gen_XN
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|gen_CO
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|gen_LI
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|gen_UG
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|gen_SG
decl_stmt|;
end_decl_stmt

begin_macro
name|gen_setinsert
argument_list|(
argument|new
argument_list|)
end_macro

begin_decl_stmt
name|char
name|new
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|new
condition|)
block|{
if|if
condition|(
name|gen_IM
condition|)
name|ttxputs
argument_list|(
name|gen_IM
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gen_EI
condition|)
name|ttxputs
argument_list|(
name|gen_EI
argument_list|)
expr_stmt|;
name|tt
operator|.
name|tt_insert
operator|=
name|new
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|gen_setmodes
argument_list|(
name|new
argument_list|)
specifier|register
name|new
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|diff
expr_stmt|;
name|diff
operator|=
name|new
operator|^
name|tt
operator|.
name|tt_modes
expr_stmt|;
if|if
condition|(
name|diff
operator|&
name|WWM_REV
condition|)
block|{
if|if
condition|(
name|new
operator|&
name|WWM_REV
condition|)
block|{
if|if
condition|(
name|gen_SO
condition|)
name|ttxputs
argument_list|(
name|gen_SO
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gen_SE
condition|)
name|ttxputs
argument_list|(
name|gen_SE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|diff
operator|&
name|WWM_UL
condition|)
block|{
if|if
condition|(
name|new
operator|&
name|WWM_UL
condition|)
block|{
if|if
condition|(
name|gen_US
condition|)
name|ttxputs
argument_list|(
name|gen_US
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gen_UE
condition|)
name|ttxputs
argument_list|(
name|gen_UE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|diff
operator|&
name|WWM_GRP
condition|)
block|{
if|if
condition|(
name|new
operator|&
name|WWM_GRP
condition|)
block|{
if|if
condition|(
name|gen_AS
condition|)
name|ttxputs
argument_list|(
name|gen_AS
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gen_AE
condition|)
name|ttxputs
argument_list|(
name|gen_AE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|diff
operator|&
name|WWM_USR
condition|)
block|{
if|if
condition|(
name|new
operator|&
name|WWM_USR
condition|)
block|{
if|if
condition|(
name|gen_XS
condition|)
name|ttxputs
argument_list|(
name|gen_XS
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gen_XE
condition|)
name|ttxputs
argument_list|(
name|gen_XE
argument_list|)
expr_stmt|;
block|}
name|tt
operator|.
name|tt_modes
operator|=
name|new
expr_stmt|;
block|}
end_block

begin_macro
name|gen_insline
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_modes
condition|)
comment|/* for concept 100 */
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_ALn
condition|)
name|ttpgoto
argument_list|(
name|gen_ALn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|gen_LI
operator|-
name|tt
operator|.
name|tt_row
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|tttputs
argument_list|(
name|gen_AL
argument_list|,
name|gen_LI
operator|-
name|tt
operator|.
name|tt_row
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_delline
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_modes
condition|)
comment|/* for concept 100 */
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_DLn
condition|)
name|ttpgoto
argument_list|(
name|gen_DLn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|gen_LI
operator|-
name|tt
operator|.
name|tt_row
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|tttputs
argument_list|(
name|gen_DL
argument_list|,
name|gen_LI
operator|-
name|tt
operator|.
name|tt_row
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|gen_putc
argument_list|(
name|c
argument_list|)
specifier|register
name|char
name|c
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_insert
condition|)
name|gen_setinsert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|tt
operator|.
name|tt_nmodes
operator|!=
name|tt
operator|.
name|tt_modes
condition|)
name|gen_setmodes
argument_list|(
name|tt
operator|.
name|tt_nmodes
argument_list|)
expr_stmt|;
name|ttputc
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
operator|++
name|tt
operator|.
name|tt_col
operator|==
name|gen_CO
condition|)
if|if
condition|(
name|gen_XN
condition|)
name|tt
operator|.
name|tt_col
operator|=
name|tt
operator|.
name|tt_row
operator|=
operator|-
literal|10
expr_stmt|;
elseif|else
if|if
condition|(
name|gen_AM
condition|)
name|tt
operator|.
name|tt_col
operator|=
literal|0
operator|,
name|tt
operator|.
name|tt_row
operator|++
expr_stmt|;
else|else
name|tt
operator|.
name|tt_col
operator|--
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|gen_write
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
specifier|register
name|char
operator|*
name|p
expr_stmt|;
end_expr_stmt

begin_expr_stmt
specifier|register
name|n
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_insert
condition|)
name|gen_setinsert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|tt
operator|.
name|tt_nmodes
operator|!=
name|tt
operator|.
name|tt_modes
condition|)
name|gen_setmodes
argument_list|(
name|tt
operator|.
name|tt_nmodes
argument_list|)
expr_stmt|;
name|ttwrite
argument_list|(
name|p
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|tt
operator|.
name|tt_col
operator|+=
name|n
expr_stmt|;
if|if
condition|(
name|tt
operator|.
name|tt_col
operator|==
name|gen_CO
condition|)
if|if
condition|(
name|gen_XN
condition|)
name|tt
operator|.
name|tt_col
operator|=
name|tt
operator|.
name|tt_row
operator|=
operator|-
literal|10
expr_stmt|;
elseif|else
if|if
condition|(
name|gen_AM
condition|)
name|tt
operator|.
name|tt_col
operator|=
literal|0
operator|,
name|tt
operator|.
name|tt_row
operator|++
expr_stmt|;
else|else
name|tt
operator|.
name|tt_col
operator|--
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|gen_move
argument_list|(
name|row
argument_list|,
name|col
argument_list|)
specifier|register
name|int
name|row
operator|,
name|col
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_row
operator|==
name|row
operator|&&
name|tt
operator|.
name|tt_col
operator|==
name|col
condition|)
return|return;
if|if
condition|(
operator|!
name|gen_MI
operator|&&
name|tt
operator|.
name|tt_insert
condition|)
name|gen_setinsert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gen_MS
operator|&&
name|tt
operator|.
name|tt_modes
condition|)
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|row
operator|<
name|tt
operator|.
name|tt_scroll_top
operator|||
name|row
operator|>
name|tt
operator|.
name|tt_scroll_bot
condition|)
name|gen_setscroll
argument_list|(
literal|0
argument_list|,
name|tt
operator|.
name|tt_nrow
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|tt
operator|.
name|tt_row
operator|==
name|row
condition|)
block|{
if|if
condition|(
name|col
operator|==
literal|0
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_CR
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|tt
operator|.
name|tt_col
operator|==
name|col
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|gen_ND
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_ND
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
elseif|else
if|if
condition|(
name|tt
operator|.
name|tt_col
operator|==
name|col
operator|+
literal|1
condition|)
block|{
if|if
condition|(
name|gen_LE
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_LE
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
block|}
if|if
condition|(
name|tt
operator|.
name|tt_col
operator|==
name|col
condition|)
block|{
if|if
condition|(
name|tt
operator|.
name|tt_row
operator|==
name|row
operator|+
literal|1
condition|)
block|{
if|if
condition|(
name|gen_UP
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_UP
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
elseif|else
if|if
condition|(
name|tt
operator|.
name|tt_row
operator|==
name|row
operator|-
literal|1
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_DO
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
if|if
condition|(
name|gen_HO
operator|&&
name|col
operator|==
literal|0
operator|&&
name|row
operator|==
literal|0
condition|)
block|{
name|ttxputs
argument_list|(
name|gen_HO
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|tttgoto
argument_list|(
name|gen_CM
argument_list|,
name|col
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|out
label|:
name|tt
operator|.
name|tt_col
operator|=
name|col
expr_stmt|;
name|tt
operator|.
name|tt_row
operator|=
name|row
expr_stmt|;
block|}
end_block

begin_macro
name|gen_start
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|gen_VS
condition|)
name|ttxputs
argument_list|(
name|gen_VS
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_TI
condition|)
name|ttxputs
argument_list|(
name|gen_TI
argument_list|)
expr_stmt|;
name|ttxputs
argument_list|(
name|gen_CL
argument_list|)
expr_stmt|;
name|tt
operator|.
name|tt_col
operator|=
name|tt
operator|.
name|tt_row
operator|=
literal|0
expr_stmt|;
name|tt
operator|.
name|tt_insert
operator|=
literal|0
expr_stmt|;
name|tt
operator|.
name|tt_nmodes
operator|=
name|tt
operator|.
name|tt_modes
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|gen_end
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_insert
condition|)
name|gen_setinsert
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_TE
condition|)
name|ttxputs
argument_list|(
name|gen_TE
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_VE
condition|)
name|ttxputs
argument_list|(
name|gen_VE
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_clreol
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_modes
condition|)
comment|/* for concept 100 */
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tttputs
argument_list|(
name|gen_CE
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_clreos
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_modes
condition|)
comment|/* for concept 100 */
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tttputs
argument_list|(
name|gen_CD
argument_list|,
name|gen_LI
operator|-
name|tt
operator|.
name|tt_row
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_clear
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|tt
operator|.
name|tt_modes
condition|)
comment|/* for concept 100 */
name|gen_setmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|ttxputs
argument_list|(
name|gen_CL
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|gen_inschar
argument_list|(
name|c
argument_list|)
specifier|register
name|char
name|c
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
operator|!
name|tt
operator|.
name|tt_insert
condition|)
name|gen_setinsert
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|tt
operator|.
name|tt_nmodes
operator|!=
name|tt
operator|.
name|tt_modes
condition|)
name|gen_setmodes
argument_list|(
name|tt
operator|.
name|tt_nmodes
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_IC
condition|)
name|tttputs
argument_list|(
name|gen_IC
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
name|ttputc
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_IP
condition|)
name|tttputs
argument_list|(
name|gen_IP
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
if|if
condition|(
operator|++
name|tt
operator|.
name|tt_col
operator|==
name|gen_CO
condition|)
if|if
condition|(
name|gen_XN
condition|)
name|tt
operator|.
name|tt_col
operator|=
name|tt
operator|.
name|tt_row
operator|=
operator|-
literal|10
expr_stmt|;
elseif|else
if|if
condition|(
name|gen_AM
condition|)
name|tt
operator|.
name|tt_col
operator|=
literal|0
operator|,
name|tt
operator|.
name|tt_row
operator|++
expr_stmt|;
else|else
name|tt
operator|.
name|tt_col
operator|--
expr_stmt|;
block|}
end_block

begin_macro
name|gen_insspace
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|gen_ICn
condition|)
name|ttpgoto
argument_list|(
name|gen_ICn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|tttputs
argument_list|(
name|gen_IC
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_delchar
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
name|gen_DCn
condition|)
name|ttpgoto
argument_list|(
name|gen_DCn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|tttputs
argument_list|(
name|gen_DC
argument_list|,
name|gen_CO
operator|-
name|tt
operator|.
name|tt_col
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_scroll_down
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
name|gen_move
argument_list|(
name|tt
operator|.
name|tt_scroll_bot
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_SFn
condition|)
name|ttpgoto
argument_list|(
name|gen_SFn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|n
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|ttxputs
argument_list|(
name|gen_SF
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_scroll_up
argument_list|(
argument|n
argument_list|)
end_macro

begin_block
block|{
name|gen_move
argument_list|(
name|tt
operator|.
name|tt_scroll_top
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_SRn
condition|)
name|ttpgoto
argument_list|(
name|gen_SRn
argument_list|,
literal|0
argument_list|,
name|n
argument_list|,
name|n
argument_list|)
expr_stmt|;
else|else
while|while
condition|(
operator|--
name|n
operator|>=
literal|0
condition|)
name|ttxputs
argument_list|(
name|gen_SR
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gen_setscroll
argument_list|(
argument|top
argument_list|,
argument|bot
argument_list|)
end_macro

begin_block
block|{
name|tttgoto
argument_list|(
name|gen_CS
argument_list|,
name|bot
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|tt
operator|.
name|tt_scroll_top
operator|=
name|top
expr_stmt|;
name|tt
operator|.
name|tt_scroll_bot
operator|=
name|bot
expr_stmt|;
name|tt
operator|.
name|tt_row
operator|=
name|tt
operator|.
name|tt_col
operator|=
operator|-
literal|10
expr_stmt|;
block|}
end_block

begin_macro
name|tt_generic
argument_list|()
end_macro

begin_block
block|{
name|gen_PC
operator|=
name|tttgetstr
argument_list|(
literal|"pc"
argument_list|)
expr_stmt|;
name|PC
operator|=
name|gen_PC
condition|?
operator|*
name|gen_PC
operator|->
name|ts_str
else|:
literal|0
expr_stmt|;
name|gen_CM
operator|=
name|ttxgetstr
argument_list|(
literal|"cm"
argument_list|)
expr_stmt|;
comment|/* may not work */
name|gen_IM
operator|=
name|ttxgetstr
argument_list|(
literal|"im"
argument_list|)
expr_stmt|;
name|gen_IC
operator|=
name|tttgetstr
argument_list|(
literal|"ic"
argument_list|)
expr_stmt|;
name|gen_ICn
operator|=
name|tttgetstr
argument_list|(
literal|"IC"
argument_list|)
expr_stmt|;
name|gen_IP
operator|=
name|tttgetstr
argument_list|(
literal|"ip"
argument_list|)
expr_stmt|;
name|gen_EI
operator|=
name|ttxgetstr
argument_list|(
literal|"ei"
argument_list|)
expr_stmt|;
name|gen_DC
operator|=
name|tttgetstr
argument_list|(
literal|"dc"
argument_list|)
expr_stmt|;
name|gen_DCn
operator|=
name|tttgetstr
argument_list|(
literal|"DC"
argument_list|)
expr_stmt|;
name|gen_AL
operator|=
name|tttgetstr
argument_list|(
literal|"al"
argument_list|)
expr_stmt|;
name|gen_ALn
operator|=
name|tttgetstr
argument_list|(
literal|"AL"
argument_list|)
expr_stmt|;
name|gen_DL
operator|=
name|tttgetstr
argument_list|(
literal|"dl"
argument_list|)
expr_stmt|;
name|gen_DLn
operator|=
name|tttgetstr
argument_list|(
literal|"DL"
argument_list|)
expr_stmt|;
name|gen_CE
operator|=
name|tttgetstr
argument_list|(
literal|"ce"
argument_list|)
expr_stmt|;
name|gen_CD
operator|=
name|tttgetstr
argument_list|(
literal|"cd"
argument_list|)
expr_stmt|;
name|gen_CL
operator|=
name|ttxgetstr
argument_list|(
literal|"cl"
argument_list|)
expr_stmt|;
name|gen_VS
operator|=
name|ttxgetstr
argument_list|(
literal|"vs"
argument_list|)
expr_stmt|;
name|gen_VE
operator|=
name|ttxgetstr
argument_list|(
literal|"ve"
argument_list|)
expr_stmt|;
name|gen_TI
operator|=
name|ttxgetstr
argument_list|(
literal|"ti"
argument_list|)
expr_stmt|;
name|gen_TE
operator|=
name|ttxgetstr
argument_list|(
literal|"te"
argument_list|)
expr_stmt|;
name|gen_SO
operator|=
name|ttxgetstr
argument_list|(
literal|"so"
argument_list|)
expr_stmt|;
name|gen_SE
operator|=
name|ttxgetstr
argument_list|(
literal|"se"
argument_list|)
expr_stmt|;
name|gen_US
operator|=
name|ttxgetstr
argument_list|(
literal|"us"
argument_list|)
expr_stmt|;
name|gen_UE
operator|=
name|ttxgetstr
argument_list|(
literal|"ue"
argument_list|)
expr_stmt|;
name|gen_LE
operator|=
name|ttxgetstr
argument_list|(
literal|"le"
argument_list|)
expr_stmt|;
name|gen_ND
operator|=
name|ttxgetstr
argument_list|(
literal|"nd"
argument_list|)
expr_stmt|;
name|gen_UP
operator|=
name|ttxgetstr
argument_list|(
literal|"up"
argument_list|)
expr_stmt|;
name|gen_DO
operator|=
name|ttxgetstr
argument_list|(
literal|"do"
argument_list|)
expr_stmt|;
name|gen_BC
operator|=
name|ttxgetstr
argument_list|(
literal|"bc"
argument_list|)
expr_stmt|;
name|gen_NL
operator|=
name|ttxgetstr
argument_list|(
literal|"nl"
argument_list|)
expr_stmt|;
name|gen_CR
operator|=
name|ttxgetstr
argument_list|(
literal|"cr"
argument_list|)
expr_stmt|;
name|gen_HO
operator|=
name|ttxgetstr
argument_list|(
literal|"ho"
argument_list|)
expr_stmt|;
name|gen_AS
operator|=
name|ttxgetstr
argument_list|(
literal|"as"
argument_list|)
expr_stmt|;
name|gen_AE
operator|=
name|ttxgetstr
argument_list|(
literal|"ae"
argument_list|)
expr_stmt|;
name|gen_XS
operator|=
name|ttxgetstr
argument_list|(
literal|"XS"
argument_list|)
expr_stmt|;
name|gen_XE
operator|=
name|ttxgetstr
argument_list|(
literal|"XE"
argument_list|)
expr_stmt|;
name|gen_SF
operator|=
name|ttxgetstr
argument_list|(
literal|"sf"
argument_list|)
expr_stmt|;
name|gen_SFn
operator|=
name|ttxgetstr
argument_list|(
literal|"SF"
argument_list|)
expr_stmt|;
name|gen_SR
operator|=
name|ttxgetstr
argument_list|(
literal|"sr"
argument_list|)
expr_stmt|;
name|gen_SRn
operator|=
name|ttxgetstr
argument_list|(
literal|"SR"
argument_list|)
expr_stmt|;
name|gen_CS
operator|=
name|ttxgetstr
argument_list|(
literal|"cs"
argument_list|)
expr_stmt|;
name|gen_MI
operator|=
name|tgetflag
argument_list|(
literal|"mi"
argument_list|)
expr_stmt|;
name|gen_MS
operator|=
name|tgetflag
argument_list|(
literal|"ms"
argument_list|)
expr_stmt|;
name|gen_AM
operator|=
name|tgetflag
argument_list|(
literal|"am"
argument_list|)
expr_stmt|;
name|gen_OS
operator|=
name|tgetflag
argument_list|(
literal|"os"
argument_list|)
expr_stmt|;
name|gen_BS
operator|=
name|tgetflag
argument_list|(
literal|"bs"
argument_list|)
expr_stmt|;
name|gen_DA
operator|=
name|tgetflag
argument_list|(
literal|"da"
argument_list|)
expr_stmt|;
name|gen_DB
operator|=
name|tgetflag
argument_list|(
literal|"db"
argument_list|)
expr_stmt|;
name|gen_NS
operator|=
name|tgetflag
argument_list|(
literal|"ns"
argument_list|)
expr_stmt|;
name|gen_XN
operator|=
name|tgetflag
argument_list|(
literal|"xn"
argument_list|)
expr_stmt|;
name|gen_CO
operator|=
name|tgetnum
argument_list|(
literal|"co"
argument_list|)
expr_stmt|;
name|gen_LI
operator|=
name|tgetnum
argument_list|(
literal|"li"
argument_list|)
expr_stmt|;
name|gen_UG
operator|=
name|tgetnum
argument_list|(
literal|"ug"
argument_list|)
expr_stmt|;
name|gen_SG
operator|=
name|tgetnum
argument_list|(
literal|"sg"
argument_list|)
expr_stmt|;
if|if
condition|(
name|gen_CL
operator|==
literal|0
operator|||
name|gen_OS
operator|||
name|gen_CM
operator|==
literal|0
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 	 * Deal with obsolete termcap fields. 	 */
if|if
condition|(
name|gen_LE
operator|==
literal|0
condition|)
if|if
condition|(
name|gen_BC
condition|)
name|gen_LE
operator|=
name|gen_BC
expr_stmt|;
elseif|else
if|if
condition|(
name|gen_BS
condition|)
block|{
specifier|static
name|struct
name|tt_str
name|bc
init|=
block|{
literal|"\b"
block|,
literal|1
block|}
decl_stmt|;
name|gen_BC
operator|=
operator|&
name|bc
expr_stmt|;
block|}
if|if
condition|(
name|gen_NL
operator|==
literal|0
condition|)
block|{
specifier|static
name|struct
name|tt_str
name|nl
init|=
block|{
literal|"\n"
block|,
literal|1
block|}
decl_stmt|;
name|gen_NL
operator|=
operator|&
name|nl
expr_stmt|;
block|}
if|if
condition|(
name|gen_DO
operator|==
literal|0
condition|)
name|gen_DO
operator|=
name|gen_NL
expr_stmt|;
if|if
condition|(
name|gen_CR
operator|==
literal|0
condition|)
block|{
specifier|static
name|struct
name|tt_str
name|cr
init|=
block|{
literal|"\r"
block|,
literal|1
block|}
decl_stmt|;
name|gen_CR
operator|=
operator|&
name|cr
expr_stmt|;
block|}
comment|/* 	 * Most terminal will scroll with "nl", but very few specify "sf". 	 * We shouldn't use "do" here. 	 */
if|if
condition|(
name|gen_SF
operator|==
literal|0
operator|&&
operator|!
name|gen_NS
condition|)
name|gen_SF
operator|=
name|gen_NL
expr_stmt|;
name|BC
operator|=
name|gen_LE
condition|?
name|gen_LE
operator|->
name|ts_str
else|:
literal|0
expr_stmt|;
name|UP
operator|=
name|gen_UP
condition|?
name|gen_UP
operator|->
name|ts_str
else|:
literal|0
expr_stmt|;
comment|/* 	 * Fix up display attributes that we can't handle, or don't 	 * really exist. 	 */
if|if
condition|(
name|gen_SG
operator|>
literal|0
condition|)
name|gen_SO
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|gen_UG
operator|>
literal|0
operator|||
name|gen_US
operator|&&
name|gen_SO
operator|&&
name|ttstrcmp
argument_list|(
name|gen_US
argument_list|,
name|gen_SO
argument_list|)
operator|==
literal|0
condition|)
name|gen_US
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|gen_IM
operator|&&
name|gen_IM
operator|->
name|ts_n
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|gen_IM
argument_list|)
expr_stmt|;
name|gen_IM
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|gen_EI
operator|&&
name|gen_EI
operator|->
name|ts_n
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|gen_EI
argument_list|)
expr_stmt|;
name|gen_EI
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|gen_IC
operator|&&
name|gen_IC
operator|->
name|ts_n
operator|==
literal|0
condition|)
block|{
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|gen_IC
argument_list|)
expr_stmt|;
name|gen_IC
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|gen_IM
condition|)
name|tt
operator|.
name|tt_inschar
operator|=
name|gen_inschar
expr_stmt|;
elseif|else
if|if
condition|(
name|gen_IC
condition|)
name|tt
operator|.
name|tt_insspace
operator|=
name|gen_insspace
expr_stmt|;
if|if
condition|(
name|gen_DC
condition|)
name|tt
operator|.
name|tt_delchar
operator|=
name|gen_delchar
expr_stmt|;
if|if
condition|(
name|gen_AL
condition|)
name|tt
operator|.
name|tt_insline
operator|=
name|gen_insline
expr_stmt|;
if|if
condition|(
name|gen_DL
condition|)
name|tt
operator|.
name|tt_delline
operator|=
name|gen_delline
expr_stmt|;
if|if
condition|(
name|gen_CE
condition|)
name|tt
operator|.
name|tt_clreol
operator|=
name|gen_clreol
expr_stmt|;
if|if
condition|(
name|gen_CD
condition|)
name|tt
operator|.
name|tt_clreos
operator|=
name|gen_clreos
expr_stmt|;
if|if
condition|(
name|gen_SF
condition|)
name|tt
operator|.
name|tt_scroll_down
operator|=
name|gen_scroll_down
expr_stmt|;
comment|/* 	 * Don't allow scroll_up if da or db but not cs. 	 * See comment in wwscroll.c. 	 */
if|if
condition|(
name|gen_SR
operator|&&
operator|(
name|gen_CS
operator|||
operator|!
name|gen_DA
operator|&&
operator|!
name|gen_DB
operator|)
condition|)
name|tt
operator|.
name|tt_scroll_up
operator|=
name|gen_scroll_up
expr_stmt|;
if|if
condition|(
name|gen_CS
condition|)
name|tt
operator|.
name|tt_setscroll
operator|=
name|gen_setscroll
expr_stmt|;
if|if
condition|(
name|gen_SO
condition|)
name|tt
operator|.
name|tt_availmodes
operator||=
name|WWM_REV
expr_stmt|;
if|if
condition|(
name|gen_US
condition|)
name|tt
operator|.
name|tt_availmodes
operator||=
name|WWM_UL
expr_stmt|;
if|if
condition|(
name|gen_AS
condition|)
name|tt
operator|.
name|tt_availmodes
operator||=
name|WWM_GRP
expr_stmt|;
if|if
condition|(
name|gen_XS
condition|)
name|tt
operator|.
name|tt_availmodes
operator||=
name|WWM_USR
expr_stmt|;
name|tt
operator|.
name|tt_wrap
operator|=
name|gen_AM
expr_stmt|;
name|tt
operator|.
name|tt_retain
operator|=
name|gen_DB
expr_stmt|;
name|tt
operator|.
name|tt_ncol
operator|=
name|gen_CO
expr_stmt|;
name|tt
operator|.
name|tt_nrow
operator|=
name|gen_LI
expr_stmt|;
name|tt
operator|.
name|tt_start
operator|=
name|gen_start
expr_stmt|;
name|tt
operator|.
name|tt_end
operator|=
name|gen_end
expr_stmt|;
name|tt
operator|.
name|tt_write
operator|=
name|gen_write
expr_stmt|;
name|tt
operator|.
name|tt_putc
operator|=
name|gen_putc
expr_stmt|;
name|tt
operator|.
name|tt_move
operator|=
name|gen_move
expr_stmt|;
name|tt
operator|.
name|tt_clear
operator|=
name|gen_clear
expr_stmt|;
name|tt
operator|.
name|tt_setmodes
operator|=
name|gen_setmodes
expr_stmt|;
name|tt
operator|.
name|tt_frame
operator|=
name|gen_AS
operator|&&
name|ttstrcmp
argument_list|(
name|gen_AS
argument_list|,
operator|&
name|ansi_AS
argument_list|)
operator|==
literal|0
condition|?
name|ansi_frame
else|:
name|gen_frame
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block

end_unit

