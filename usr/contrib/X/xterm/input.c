begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1984, 1985	*/
end_comment

begin_comment
comment|/* input.c */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_input_c
init|=
literal|"$Header: input.c,v 10.10 86/02/01 16:06:22 tony Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<X/Xkeyboard.h>
end_include

begin_include
include|#
directive|include
file|"ptyx.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_decl_stmt
specifier|static
name|char
modifier|*
name|kypd_num
init|=
literal|"0x. 123456,789-"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|kypd_apl
init|=
literal|"pxnMqrstuvlwxym"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cur
init|=
literal|"DCBA"
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|Input
argument_list|(
name|keyboard
argument_list|,
name|screen
argument_list|,
name|event
argument_list|)
specifier|register
name|Keyboard
operator|*
name|keyboard
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|Screen
modifier|*
name|screen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|XKeyPressedEvent
modifier|*
name|event
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|keycode
init|=
name|event
operator|->
name|detail
decl_stmt|;
specifier|register
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|tx8bit
init|=
name|screen
operator|->
name|tx8bit
decl_stmt|;
name|int
name|pty
init|=
name|screen
operator|->
name|respond
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
name|ANSI
name|reply
decl_stmt|;
name|string
operator|=
name|XLookupMapping
argument_list|(
name|event
argument_list|,
operator|&
name|nbytes
argument_list|)
expr_stmt|;
name|keycode
operator|&=
name|ValueMask
expr_stmt|;
comment|/* no longer need shift bits for anything */
name|reply
operator|.
name|a_pintro
operator|=
literal|0
expr_stmt|;
name|reply
operator|.
name|a_final
operator|=
literal|0
expr_stmt|;
name|reply
operator|.
name|a_nparam
operator|=
literal|0
expr_stmt|;
name|reply
operator|.
name|a_inters
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|nbytes
operator|>
literal|0
condition|)
block|{
while|while
condition|(
name|nbytes
operator|--
operator|>
literal|0
condition|)
name|unparseputc
argument_list|(
operator|*
name|string
operator|++
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IsKeypadKey
argument_list|(
name|keycode
argument_list|)
condition|)
block|{
if|if
condition|(
name|keyboard
operator|->
name|flags
operator|&
name|KYPD_APL
condition|)
block|{
name|reply
operator|.
name|a_type
operator|=
name|SS3
expr_stmt|;
name|unparseseq
argument_list|(
operator|&
name|reply
argument_list|,
name|tx8bit
argument_list|,
name|pty
argument_list|)
expr_stmt|;
name|unparseputc
argument_list|(
name|kypd_apl
index|[
name|keycode
operator|-
name|KC_KEYPAD_0
index|]
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
else|else
name|unparseputc
argument_list|(
name|kypd_num
index|[
name|keycode
operator|-
name|KC_KEYPAD_0
index|]
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IsCursorKey
argument_list|(
name|keycode
argument_list|)
condition|)
block|{
if|if
condition|(
name|keyboard
operator|->
name|flags
operator|&
name|CURSOR_APL
condition|)
block|{
name|reply
operator|.
name|a_type
operator|=
name|SS3
expr_stmt|;
name|unparseseq
argument_list|(
operator|&
name|reply
argument_list|,
name|tx8bit
argument_list|,
name|pty
argument_list|)
expr_stmt|;
name|unparseputc
argument_list|(
name|cur
index|[
name|keycode
operator|-
name|KC_CURSOR_LEFT
index|]
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|reply
operator|.
name|a_type
operator|=
name|CSI
expr_stmt|;
name|reply
operator|.
name|a_final
operator|=
name|cur
index|[
name|keycode
operator|-
name|KC_CURSOR_LEFT
index|]
expr_stmt|;
name|unparseseq
argument_list|(
operator|&
name|reply
argument_list|,
name|tx8bit
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|IsPFKey
argument_list|(
name|keycode
argument_list|)
condition|)
block|{
name|reply
operator|.
name|a_type
operator|=
name|SS3
expr_stmt|;
name|unparseseq
argument_list|(
operator|&
name|reply
argument_list|,
name|tx8bit
argument_list|,
name|pty
argument_list|)
expr_stmt|;
name|unparseputc
argument_list|(
call|(
name|char
call|)
argument_list|(
name|keycode
operator|-
name|KC_PF1
operator|+
literal|'P'
argument_list|)
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IsFunctionKey
argument_list|(
name|keycode
argument_list|)
condition|)
block|{
name|reply
operator|.
name|a_type
operator|=
name|CSI
expr_stmt|;
name|reply
operator|.
name|a_nparam
operator|=
literal|1
expr_stmt|;
name|reply
operator|.
name|a_param
index|[
literal|0
index|]
operator|=
name|funcvalue
argument_list|(
name|keycode
argument_list|)
expr_stmt|;
name|reply
operator|.
name|a_final
operator|=
literal|'~'
expr_stmt|;
if|if
condition|(
name|reply
operator|.
name|a_param
index|[
literal|0
index|]
operator|>
literal|0
condition|)
name|unparseseq
argument_list|(
operator|&
name|reply
argument_list|,
name|tx8bit
argument_list|,
name|pty
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|ENABLE_PRINT
if|if
condition|(
name|keycode
operator|==
name|KC_F2
condition|)
name|TekPrint
argument_list|()
expr_stmt|;
endif|#
directive|endif
return|return;
block|}
end_block

begin_macro
name|funcvalue
argument_list|(
argument|keycode
argument_list|)
end_macro

begin_block
block|{
switch|switch
condition|(
name|keycode
condition|)
block|{
case|case
name|KC_F1
case|:
return|return
operator|(
literal|11
operator|)
return|;
case|case
name|KC_F2
case|:
return|return
operator|(
literal|12
operator|)
return|;
case|case
name|KC_F3
case|:
return|return
operator|(
literal|13
operator|)
return|;
case|case
name|KC_F4
case|:
return|return
operator|(
literal|14
operator|)
return|;
case|case
name|KC_F5
case|:
return|return
operator|(
literal|15
operator|)
return|;
case|case
name|KC_F6
case|:
return|return
operator|(
literal|17
operator|)
return|;
case|case
name|KC_F7
case|:
return|return
operator|(
literal|18
operator|)
return|;
case|case
name|KC_F8
case|:
return|return
operator|(
literal|19
operator|)
return|;
case|case
name|KC_F9
case|:
return|return
operator|(
literal|20
operator|)
return|;
case|case
name|KC_F10
case|:
return|return
operator|(
literal|21
operator|)
return|;
case|case
name|KC_F11
case|:
return|return
operator|(
literal|23
operator|)
return|;
case|case
name|KC_F12
case|:
return|return
operator|(
literal|24
operator|)
return|;
case|case
name|KC_F13
case|:
return|return
operator|(
literal|25
operator|)
return|;
case|case
name|KC_F14
case|:
return|return
operator|(
literal|26
operator|)
return|;
case|case
name|KC_F15
case|:
return|return
operator|(
literal|28
operator|)
return|;
case|case
name|KC_F16
case|:
return|return
operator|(
literal|29
operator|)
return|;
case|case
name|KC_F17
case|:
return|return
operator|(
literal|31
operator|)
return|;
case|case
name|KC_F18
case|:
return|return
operator|(
literal|32
operator|)
return|;
case|case
name|KC_F19
case|:
return|return
operator|(
literal|33
operator|)
return|;
case|case
name|KC_F20
case|:
return|return
operator|(
literal|34
operator|)
return|;
case|case
name|KC_E1
case|:
return|return
operator|(
literal|1
operator|)
return|;
case|case
name|KC_E2
case|:
return|return
operator|(
literal|2
operator|)
return|;
case|case
name|KC_E3
case|:
return|return
operator|(
literal|3
operator|)
return|;
case|case
name|KC_E4
case|:
return|return
operator|(
literal|4
operator|)
return|;
case|case
name|KC_E5
case|:
return|return
operator|(
literal|5
operator|)
return|;
case|case
name|KC_E6
case|:
return|return
operator|(
literal|6
operator|)
return|;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
end_block

end_unit

