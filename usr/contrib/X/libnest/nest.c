begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1986 */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|"../Xlib/Xlib.h"
end_include

begin_undef
undef|#
directive|undef
name|CURSOR
end_undef

begin_include
include|#
directive|include
file|"../Xlib/Xkeyboard.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|"../X/vsinput.h"
end_include

begin_include
include|#
directive|include
file|"../X/Xdev.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|,
name|XFlush
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|Xalloc
argument_list|()
decl_stmt|,
modifier|*
name|Xrealloc
argument_list|()
decl_stmt|,
modifier|*
name|strcpy
argument_list|()
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|Xpixmap
parameter_list|(
name|p
parameter_list|)
value|((Pixmap) p->data)
end_define

begin_define
define|#
directive|define
name|Xbitmap
parameter_list|(
name|b
parameter_list|)
value|((Bitmap) b->data)
end_define

begin_define
define|#
directive|define
name|Xfinf
parameter_list|(
name|f
parameter_list|)
value|((FontInfo *) f->data)
end_define

begin_define
define|#
directive|define
name|Xfont
parameter_list|(
name|f
parameter_list|)
value|(Xfinf(f)->id)
end_define

begin_define
define|#
directive|define
name|Xcursor
parameter_list|(
name|c
parameter_list|)
value|((Cursor) c->data)
end_define

begin_define
define|#
directive|define
name|npix
parameter_list|(
name|p
parameter_list|)
value|(((p)<< pixshift) | basepix)
end_define

begin_define
define|#
directive|define
name|opix
parameter_list|(
name|p
parameter_list|)
value|(((p)&~ basepix)>> pixshift)
end_define

begin_define
define|#
directive|define
name|nmask
parameter_list|(
name|m
parameter_list|)
value|((m)<< pixshift)
end_define

begin_decl_stmt
specifier|static
name|Window
name|w
decl_stmt|,
name|t
decl_stmt|,
name|ot
decl_stmt|,
name|tt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|extrapix
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|pixplanes
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|pixshift
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|basepix
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|screen_height
decl_stmt|,
name|screen_width
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|tilex
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|tiley
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|CLIP
name|tileclip
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|vsCursor
name|mouse
init|=
block|{
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|vsBox
name|mbox
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|cursor_x
decl_stmt|,
name|cursor_y
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|DEVICE
modifier|*
name|dev
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|ProcessInput
argument_list|(
argument|ev
argument_list|)
end_macro

begin_decl_stmt
name|vsEvent
name|ev
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|OpenDisplay
argument_list|(
argument|display
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* display number */
end_comment

begin_block
block|{
name|OpaqueFrame
name|frame
decl_stmt|;
name|char
name|def
index|[
literal|32
index|]
decl_stmt|;
name|char
modifier|*
name|option
decl_stmt|;
name|Color
name|cdef
decl_stmt|;
if|if
condition|(
name|XOpenDisplay
argument_list|(
operator|(
name|char
operator|*
operator|)
name|NULL
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|option
operator|=
name|XGetDefault
argument_list|(
literal|"X"
argument_list|,
literal|"BorderWidth"
argument_list|)
condition|)
name|frame
operator|.
name|bdrwidth
operator|=
name|atoi
argument_list|(
name|option
argument_list|)
expr_stmt|;
else|else
name|frame
operator|.
name|bdrwidth
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|frame
operator|.
name|bdrwidth
operator|&&
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
literal|"X"
argument_list|,
literal|"Border"
argument_list|)
operator|)
operator|&&
name|XParseColor
argument_list|(
name|option
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|frame
operator|.
name|border
operator|=
name|XMakeTile
argument_list|(
name|cdef
operator|.
name|pixel
argument_list|)
expr_stmt|;
else|else
name|frame
operator|.
name|border
operator|=
name|BlackPixmap
expr_stmt|;
name|frame
operator|.
name|background
operator|=
name|NULL
expr_stmt|;
name|frame
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|frame
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|sprintf
argument_list|(
name|def
argument_list|,
literal|"=%dx%d+0+0"
argument_list|,
name|DisplayWidth
argument_list|()
operator|-
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
argument_list|,
name|DisplayHeight
argument_list|()
operator|-
operator|(
name|frame
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|w
operator|=
name|XCreate
argument_list|(
literal|"X"
argument_list|,
literal|"X"
argument_list|,
literal|""
argument_list|,
name|def
argument_list|,
operator|&
name|frame
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|screen_height
operator|=
name|frame
operator|.
name|height
expr_stmt|;
name|screen_width
operator|=
name|frame
operator|.
name|width
expr_stmt|;
name|XMapWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|w
argument_list|,
name|KeyPressed
operator||
name|KeyReleased
operator||
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|MouseMoved
operator||
name|EnterWindow
operator||
name|LeaveWindow
argument_list|)
expr_stmt|;
name|t
operator|=
name|XCreateTransparency
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|screen_width
argument_list|,
name|screen_height
argument_list|)
expr_stmt|;
name|ot
operator|=
name|XCreateTransparency
argument_list|(
name|w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|screen_width
argument_list|,
name|screen_height
argument_list|)
expr_stmt|;
name|XTileAbsolute
argument_list|(
name|ot
argument_list|)
expr_stmt|;
name|tt
operator|=
name|XCreateTransparency
argument_list|(
name|ot
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|screen_width
argument_list|,
name|screen_height
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|ot
argument_list|)
expr_stmt|;
return|return
operator|(
name|dpyno
argument_list|()
operator|)
return|;
block|}
end_block

begin_macro
name|InputReader
argument_list|()
end_macro

begin_block
block|{
name|XEvent
name|xev
decl_stmt|;
name|vsEvent
name|ev
decl_stmt|;
name|int
name|nstate
decl_stmt|;
specifier|static
name|int
name|state
init|=
literal|0
decl_stmt|;
name|vsCursor
name|ms
decl_stmt|;
name|XPending
argument_list|()
expr_stmt|;
while|while
condition|(
name|QLength
argument_list|()
condition|)
block|{
name|XNextEvent
argument_list|(
operator|&
name|xev
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|xev
operator|.
name|type
condition|)
block|{
case|case
name|EnterWindow
case|:
if|if
condition|(
name|xev
operator|.
name|subwindow
condition|)
continue|continue;
case|case
name|MouseMoved
case|:
name|ms
operator|.
name|x
operator|=
operator|(
operator|(
name|XMouseMovedEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|x
operator|-
name|cursor_x
expr_stmt|;
name|ms
operator|.
name|y
operator|=
operator|(
operator|(
name|XMouseMovedEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|y
operator|-
name|cursor_y
expr_stmt|;
if|if
condition|(
operator|(
name|ms
operator|.
name|x
operator|!=
name|mouse
operator|.
name|x
operator|||
name|ms
operator|.
name|y
operator|!=
name|mouse
operator|.
name|y
operator|)
operator|&&
name|ms
operator|.
name|x
operator|>=
literal|0
operator|&&
name|ms
operator|.
name|x
operator|<
name|screen_width
operator|&&
name|ms
operator|.
name|y
operator|>=
literal|0
operator|&&
name|ms
operator|.
name|y
operator|<
name|screen_height
condition|)
block|{
name|mouse
operator|=
name|ms
expr_stmt|;
if|if
condition|(
name|ms
operator|.
name|y
operator|>=
name|mbox
operator|.
name|bottom
operator|||
name|ms
operator|.
name|y
operator|<
name|mbox
operator|.
name|top
operator|||
name|ms
operator|.
name|x
operator|>=
name|mbox
operator|.
name|right
operator|||
name|ms
operator|.
name|x
operator|<
name|mbox
operator|.
name|left
condition|)
block|{
name|mbox
operator|.
name|bottom
operator|=
literal|0
expr_stmt|;
name|Deal_with_movement
argument_list|()
expr_stmt|;
block|}
block|}
if|if
condition|(
name|xev
operator|.
name|type
operator|!=
name|EnterWindow
condition|)
continue|continue;
name|ev
operator|.
name|vse_time
operator|=
operator|(
operator|(
name|XKeyOrButtonEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|time
expr_stmt|;
name|nstate
operator|=
operator|(
operator|(
name|XEnterWindowEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|detail
operator|&
operator|~
name|ValueMask
expr_stmt|;
name|nstate
operator|^=
name|state
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTUP
expr_stmt|;
name|ButtonTransition
argument_list|(
operator|&
name|ev
argument_list|,
name|nstate
operator|&
name|state
argument_list|)
expr_stmt|;
name|KeyTransition
argument_list|(
operator|&
name|ev
argument_list|,
name|nstate
operator|&
name|state
argument_list|)
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTDOWN
expr_stmt|;
name|KeyTransition
argument_list|(
operator|&
name|ev
argument_list|,
name|nstate
operator|&
operator|~
name|state
argument_list|)
expr_stmt|;
name|ButtonTransition
argument_list|(
operator|&
name|ev
argument_list|,
name|nstate
operator|&
operator|~
name|state
argument_list|)
expr_stmt|;
continue|continue;
case|case
name|LeaveWindow
case|:
name|state
operator|=
operator|(
operator|(
name|XLeaveWindowEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|detail
operator|&
operator|~
name|ValueMask
expr_stmt|;
continue|continue;
block|}
name|ev
operator|.
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|.
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|.
name|vse_time
operator|=
operator|(
operator|(
name|XKeyOrButtonEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|time
expr_stmt|;
name|ev
operator|.
name|vse_key
operator|=
operator|(
operator|(
name|XKeyOrButtonEvent
operator|*
operator|)
operator|(
operator|&
name|xev
operator|)
operator|)
operator|->
name|detail
operator|&
name|ValueMask
expr_stmt|;
switch|switch
condition|(
name|xev
operator|.
name|type
condition|)
block|{
case|case
name|KeyPressed
case|:
name|ev
operator|.
name|vse_device
operator|=
name|VSE_DKB
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTDOWN
expr_stmt|;
break|break;
case|case
name|KeyReleased
case|:
name|ev
operator|.
name|vse_device
operator|=
name|VSE_DKB
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTUP
expr_stmt|;
break|break;
case|case
name|ButtonPressed
case|:
name|ev
operator|.
name|vse_device
operator|=
name|VSE_MOUSE
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTDOWN
expr_stmt|;
name|ev
operator|.
name|vse_key
operator|=
literal|2
operator|-
name|ev
operator|.
name|vse_key
expr_stmt|;
break|break;
case|case
name|ButtonReleased
case|:
name|ev
operator|.
name|vse_device
operator|=
name|VSE_MOUSE
expr_stmt|;
name|ev
operator|.
name|vse_direction
operator|=
name|VSE_KBTUP
expr_stmt|;
name|ev
operator|.
name|vse_key
operator|=
literal|2
operator|-
name|ev
operator|.
name|vse_key
expr_stmt|;
break|break;
block|}
name|Deal_with_input
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|KeyTransition
argument_list|(
name|ev
argument_list|,
name|bits
argument_list|)
specifier|register
name|vsEvent
operator|*
name|ev
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|bits
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|ev
operator|->
name|vse_device
operator|=
name|VSE_DKB
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|ControlMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
name|KC_CTRL
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|MetaMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
name|KC_META
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|ShiftMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
name|KC_SHIFT
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|ShiftLockMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
name|KC_LOCK
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|ButtonTransition
argument_list|(
name|ev
argument_list|,
name|bits
argument_list|)
specifier|register
name|vsEvent
operator|*
name|ev
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|bits
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|ev
operator|->
name|vse_device
operator|=
name|VSE_MOUSE
expr_stmt|;
if|if
condition|(
name|bits
operator|&
name|LeftMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
literal|2
operator|-
name|LeftButton
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|MiddleMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
literal|2
operator|-
name|MiddleButton
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bits
operator|&
name|RightMask
condition|)
block|{
name|ev
operator|->
name|vse_x
operator|=
name|mouse
operator|.
name|x
expr_stmt|;
name|ev
operator|->
name|vse_y
operator|=
name|mouse
operator|.
name|y
expr_stmt|;
name|ev
operator|->
name|vse_key
operator|=
literal|2
operator|-
name|RightButton
expr_stmt|;
name|Deal_with_input
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|InitDisplay
argument_list|(
argument|info
argument_list|)
end_macro

begin_decl_stmt
name|DEVICE
modifier|*
name|info
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* device data */
end_comment

begin_block
block|{
name|char
modifier|*
name|option
decl_stmt|;
name|int
name|planes
decl_stmt|;
specifier|static
name|vsEventQueue
name|queue
init|=
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|dev
operator|=
name|info
expr_stmt|;
name|info
operator|->
name|id
operator|=
name|XDEV_XNEST
expr_stmt|;
name|info
operator|->
name|width
operator|=
name|screen_width
expr_stmt|;
name|info
operator|->
name|height
operator|=
name|screen_height
expr_stmt|;
name|info
operator|->
name|planes
operator|=
name|DisplayPlanes
argument_list|()
expr_stmt|;
name|info
operator|->
name|entries
operator|=
literal|0
expr_stmt|;
name|pixplanes
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
operator|&&
operator|(
name|option
operator|=
name|XGetDefault
argument_list|(
literal|"X"
argument_list|,
literal|"CellExponent"
argument_list|)
operator|)
operator|&&
operator|(
name|pixplanes
operator|=
name|atoi
argument_list|(
name|option
argument_list|)
operator|)
operator|&&
name|XGetColorCells
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
operator|&
name|planes
argument_list|,
operator|&
name|extrapix
argument_list|)
condition|)
block|{
while|while
condition|(
name|pixplanes
operator|&&
operator|!
name|XGetColorCells
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|pixplanes
argument_list|,
operator|&
name|planes
argument_list|,
operator|&
name|basepix
argument_list|)
condition|)
name|pixplanes
operator|--
expr_stmt|;
if|if
condition|(
name|pixplanes
condition|)
block|{
name|info
operator|->
name|entries
operator|=
literal|1
operator|<<
name|pixplanes
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|planes
operator|&
literal|1
operator|)
condition|)
block|{
name|pixshift
operator|++
expr_stmt|;
name|planes
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
else|else
name|XFreeColors
argument_list|(
operator|&
name|extrapix
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|info
operator|->
name|mouse
operator|=
operator|&
name|mouse
expr_stmt|;
name|info
operator|->
name|mbox
operator|=
operator|&
name|mbox
expr_stmt|;
name|info
operator|->
name|queue
operator|=
operator|&
name|queue
expr_stmt|;
name|Define_input_handler
argument_list|(
name|InputReader
argument_list|)
expr_stmt|;
name|Define_block_handler
argument_list|(
name|XFlush
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|DisplayDead
argument_list|()
end_macro

begin_block
block|{
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|InitMouse
argument_list|()
end_macro

begin_block
block|{ }
end_block

begin_function
name|caddr_t
name|AllocateSpace
parameter_list|(
name|bytes
parameter_list|)
name|int
name|bytes
decl_stmt|;
comment|/* number of bytes to allocate */
block|{
specifier|static
name|char
modifier|*
name|buf
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|buflen
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|bytes
operator|>
name|buflen
condition|)
block|{
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|buf
operator|=
name|Xalloc
argument_list|(
operator|(
name|bytes
operator|+
literal|0xff
operator|)
operator|&
operator|~
literal|0xff
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_macro
name|PixFill
argument_list|(
argument|srcpix
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|int
name|srcpix
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source pixel */
end_comment

begin_decl_stmt
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source mask or NULL */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|srcpix
operator|=
name|npix
argument_list|(
name|srcpix
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XPixFill
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|srcpix
argument_list|,
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|TileFill
argument_list|(
argument|tile
argument_list|,
argument|xoff
argument_list|,
argument|yoff
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|PIXMAP
modifier|*
name|tile
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source tile */
end_comment

begin_decl_stmt
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* tile origin */
end_comment

begin_decl_stmt
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source mask or NULL */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
name|SetTileOrigin
argument_list|(
name|tile
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetTileClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XTileFill
argument_list|(
name|tt
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|Xpixmap
argument_list|(
name|tile
argument_list|)
argument_list|,
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|PixmapPut
argument_list|(
argument|src
argument_list|,
argument|srcx
argument_list|,
argument|srcy
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|PIXMAP
modifier|*
name|src
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source */
end_comment

begin_decl_stmt
name|int
name|srcx
decl_stmt|,
name|srcy
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* region of source */
end_comment

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XPixmapPut
argument_list|(
name|t
argument_list|,
name|srcx
argument_list|,
name|srcy
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|Xpixmap
argument_list|(
name|src
argument_list|)
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|PixmapBitsPut
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|format
argument_list|,
argument|data
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|int
name|width
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source width */
end_comment

begin_decl_stmt
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source height */
end_comment

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: XY-format, 1: Z-format */
end_comment

begin_decl_stmt
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source data */
end_comment

begin_decl_stmt
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source mask or NULL */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|ToPixmap
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|format
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
if|if
condition|(
name|format
operator|==
name|XYFormat
condition|)
name|XPixmapBitsPutXY
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|,
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
else|else
block|{
name|XPixmapBitsPutZ
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|,
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|BitmapBitsPut
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|data
argument_list|,
argument|fore
argument_list|,
argument|back
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|int
name|width
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source width */
end_comment

begin_decl_stmt
name|int
name|height
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source height */
end_comment

begin_decl_stmt
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source data */
end_comment

begin_decl_stmt
name|int
name|fore
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* foreground source pixel */
end_comment

begin_decl_stmt
name|int
name|back
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* background source pixel */
end_comment

begin_decl_stmt
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source mask or NULL */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|fore
operator|=
name|npix
argument_list|(
name|fore
argument_list|)
expr_stmt|;
name|back
operator|=
name|npix
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XBitmapBitsPut
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|,
name|fore
argument_list|,
name|back
argument_list|,
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|CopyArea
argument_list|(
argument|srcx
argument_list|,
argument|srcy
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|int
name|srcx
decl_stmt|,
name|srcy
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source */
end_comment

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|int
name|dstr
decl_stmt|,
name|dstb
decl_stmt|,
name|left
decl_stmt|,
name|top
decl_stmt|;
name|dstr
operator|=
name|dstx
operator|+
name|width
expr_stmt|;
name|dstb
operator|=
name|dsty
operator|+
name|height
expr_stmt|;
name|srcx
operator|-=
name|dstx
expr_stmt|;
name|srcy
operator|-=
name|dsty
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|left
operator|=
name|clips
operator|->
name|left
expr_stmt|;
if|if
condition|(
name|left
operator|<
name|dstx
condition|)
name|left
operator|=
name|dstx
expr_stmt|;
name|width
operator|=
name|clips
operator|->
name|left
operator|+
name|clips
operator|->
name|width
expr_stmt|;
if|if
condition|(
name|width
operator|>
name|dstr
condition|)
name|width
operator|=
name|dstr
expr_stmt|;
name|width
operator|-=
name|left
expr_stmt|;
name|top
operator|=
name|clips
operator|->
name|top
expr_stmt|;
if|if
condition|(
name|top
operator|<
name|dsty
condition|)
name|top
operator|=
name|dsty
expr_stmt|;
name|height
operator|=
name|clips
operator|->
name|top
operator|+
name|clips
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|height
operator|>
name|dstb
condition|)
name|height
operator|=
name|dstb
expr_stmt|;
name|height
operator|-=
name|top
expr_stmt|;
if|if
condition|(
name|width
operator|>
literal|0
operator|&&
name|height
operator|>
literal|0
condition|)
name|XCopyArea
argument_list|(
name|w
argument_list|,
name|srcx
operator|+
name|left
argument_list|,
name|srcy
operator|+
name|top
argument_list|,
name|left
argument_list|,
name|top
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|PrintText
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|font
argument_list|,
argument|fore
argument_list|,
argument|back
argument_list|,
argument|charpad
argument_list|,
argument|spacepad
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* character string */
end_comment

begin_decl_stmt
name|int
name|strlen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* string length */
end_comment

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source font */
end_comment

begin_decl_stmt
name|int
name|fore
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* foreground source pixel */
end_comment

begin_decl_stmt
name|int
name|back
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* background source pixel */
end_comment

begin_decl_stmt
name|int
name|charpad
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* inter-character pad */
end_comment

begin_decl_stmt
name|int
name|spacepad
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* space-character pad */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|fore
operator|=
name|npix
argument_list|(
name|fore
argument_list|)
expr_stmt|;
name|back
operator|=
name|npix
argument_list|(
name|back
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XTextPad
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|string
argument_list|,
name|strlen
argument_list|,
name|Xfont
argument_list|(
name|font
argument_list|)
argument_list|,
name|charpad
argument_list|,
name|spacepad
argument_list|,
name|fore
argument_list|,
name|back
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|PrintTextMask
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|font
argument_list|,
argument|srcpix
argument_list|,
argument|charpad
argument_list|,
argument|spacepad
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* character string */
end_comment

begin_decl_stmt
name|int
name|strlen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* string length */
end_comment

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* font mask */
end_comment

begin_decl_stmt
name|int
name|srcpix
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source pixel */
end_comment

begin_decl_stmt
name|int
name|charpad
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* inter-character pad */
end_comment

begin_decl_stmt
name|int
name|spacepad
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* space-character pad */
end_comment

begin_decl_stmt
name|int
name|dstx
decl_stmt|,
name|dsty
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* destination */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|srcpix
operator|=
name|npix
argument_list|(
name|srcpix
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XTextMaskPad
argument_list|(
name|t
argument_list|,
name|dstx
operator|-
name|clips
operator|->
name|left
argument_list|,
name|dsty
operator|-
name|clips
operator|->
name|top
argument_list|,
name|string
argument_list|,
name|strlen
argument_list|,
name|Xfont
argument_list|(
name|font
argument_list|)
argument_list|,
name|charpad
argument_list|,
name|spacepad
argument_list|,
name|srcpix
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|DrawCurve
argument_list|(
argument|verts
argument_list|,
argument|vertcount
argument_list|,
argument|xbase
argument_list|,
argument|ybase
argument_list|,
argument|srcpix
argument_list|,
argument|altpix
argument_list|,
argument|mode
argument_list|,
argument|bwidth
argument_list|,
argument|bheight
argument_list|,
argument|pat
argument_list|,
argument|patlen
argument_list|,
argument|patmul
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|Vertex
modifier|*
name|verts
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* vertexes */
end_comment

begin_decl_stmt
name|int
name|vertcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* vertex count */
end_comment

begin_decl_stmt
name|int
name|xbase
decl_stmt|,
name|ybase
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* draw origin */
end_comment

begin_decl_stmt
name|int
name|srcpix
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source pixel * 	int altpix;			/* alternate source pixel */
end_comment

begin_decl_stmt
name|int
name|mode
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: solid, 1: dashed, 2: patterned */
end_comment

begin_decl_stmt
name|int
name|bwidth
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* brush width */
end_comment

begin_decl_stmt
name|int
name|bheight
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* brush height */
end_comment

begin_decl_stmt
name|int
name|pat
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pattern */
end_comment

begin_decl_stmt
name|int
name|patlen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pattern length */
end_comment

begin_decl_stmt
name|int
name|patmul
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pattern repeat count */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
name|srcpix
operator|=
name|npix
argument_list|(
name|srcpix
argument_list|)
expr_stmt|;
name|altpix
operator|=
name|npix
argument_list|(
name|altpix
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|PathOffsets
argument_list|(
name|verts
argument_list|,
name|vertcount
argument_list|,
name|xbase
operator|-
name|clips
operator|->
name|left
argument_list|,
name|ybase
operator|-
name|clips
operator|->
name|top
argument_list|)
expr_stmt|;
name|xbase
operator|=
name|clips
operator|->
name|left
expr_stmt|;
name|ybase
operator|=
name|clips
operator|->
name|top
expr_stmt|;
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|DrawSolidLine
case|:
name|XDraw
argument_list|(
name|t
argument_list|,
name|verts
argument_list|,
name|vertcount
argument_list|,
name|bwidth
argument_list|,
name|bheight
argument_list|,
name|srcpix
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawDashedLine
case|:
name|XDrawDashed
argument_list|(
name|t
argument_list|,
name|verts
argument_list|,
name|vertcount
argument_list|,
name|bwidth
argument_list|,
name|bheight
argument_list|,
name|srcpix
argument_list|,
name|XMakePattern
argument_list|(
name|pat
argument_list|,
name|patlen
argument_list|,
name|patmul
argument_list|)
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
case|case
name|DrawPatternedLine
case|:
name|XDrawPatterned
argument_list|(
name|t
argument_list|,
name|verts
argument_list|,
name|vertcount
argument_list|,
name|bwidth
argument_list|,
name|bheight
argument_list|,
name|srcpix
argument_list|,
name|altpix
argument_list|,
name|XMakePattern
argument_list|(
name|pat
argument_list|,
name|patlen
argument_list|,
name|patmul
argument_list|)
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_block

begin_macro
name|DrawFilled
argument_list|(
argument|verts
argument_list|,
argument|vertcount
argument_list|,
argument|xbase
argument_list|,
argument|ybase
argument_list|,
argument|srcpix
argument_list|,
argument|tile
argument_list|,
argument|xoff
argument_list|,
argument|yoff
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|Vertex
modifier|*
name|verts
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* vertexes */
end_comment

begin_decl_stmt
name|int
name|vertcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* vertex count */
end_comment

begin_decl_stmt
name|int
name|xbase
decl_stmt|,
name|ybase
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* draw origin */
end_comment

begin_decl_stmt
name|int
name|srcpix
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source pixel */
end_comment

begin_decl_stmt
name|PIXMAP
modifier|*
name|tile
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* optional tile or NULL */
end_comment

begin_decl_stmt
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* tile origin */
end_comment

begin_decl_stmt
specifier|register
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* clipping rectangles */
end_comment

begin_decl_stmt
name|int
name|clipcount
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of rectangles */
end_comment

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* GX display function */
end_comment

begin_decl_stmt
name|int
name|zmask
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* plane mask */
end_comment

begin_block
block|{
if|if
condition|(
name|tile
condition|)
name|SetTileOrigin
argument_list|(
name|tile
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|)
expr_stmt|;
else|else
name|srcpix
operator|=
name|npix
argument_list|(
name|srcpix
argument_list|)
expr_stmt|;
name|zmask
operator|=
name|nmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|--
name|clipcount
operator|>=
literal|0
condition|;
name|clips
operator|++
control|)
block|{
name|PathOffsets
argument_list|(
name|verts
argument_list|,
name|vertcount
argument_list|,
name|xbase
operator|-
name|clips
operator|->
name|left
argument_list|,
name|ybase
operator|-
name|clips
operator|->
name|top
argument_list|)
expr_stmt|;
name|xbase
operator|=
name|clips
operator|->
name|left
expr_stmt|;
name|ybase
operator|=
name|clips
operator|->
name|top
expr_stmt|;
if|if
condition|(
name|tile
condition|)
block|{
name|SetTileClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XDrawTiled
argument_list|(
name|tt
argument_list|,
name|verts
argument_list|,
name|vertcount
argument_list|,
name|Xpixmap
argument_list|(
name|tile
argument_list|)
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|SetClip
argument_list|(
name|clips
argument_list|)
expr_stmt|;
name|XDrawFilled
argument_list|(
name|t
argument_list|,
name|verts
argument_list|,
name|vertcount
argument_list|,
name|srcpix
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_expr_stmt
name|PathOffsets
argument_list|(
name|verts
argument_list|,
name|vertcount
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|)
specifier|register
name|Vertex
operator|*
name|verts
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|vertcount
decl_stmt|,
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
for|for
control|(
init|;
operator|--
name|vertcount
operator|>=
literal|0
condition|;
name|verts
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|verts
operator|->
name|flags
operator|&
name|VertexRelative
operator|)
condition|)
block|{
name|verts
operator|->
name|x
operator|+=
name|xoff
expr_stmt|;
name|verts
operator|->
name|y
operator|+=
name|yoff
expr_stmt|;
block|}
block|}
block|}
end_block

begin_expr_stmt
name|SetClip
argument_list|(
name|clip
argument_list|)
specifier|register
name|CLIP
operator|*
name|clip
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|static
name|CLIP
name|normclip
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
if|if
condition|(
name|clip
operator|->
name|left
operator|!=
name|normclip
operator|.
name|left
operator|||
name|clip
operator|->
name|top
operator|!=
name|normclip
operator|.
name|top
operator|||
name|clip
operator|->
name|width
operator|!=
name|normclip
operator|.
name|width
operator|||
name|clip
operator|->
name|height
operator|!=
name|normclip
operator|.
name|height
condition|)
block|{
name|XConfigureWindow
argument_list|(
name|t
argument_list|,
name|clip
operator|->
name|left
argument_list|,
name|clip
operator|->
name|top
argument_list|,
name|clip
operator|->
name|width
argument_list|,
name|clip
operator|->
name|height
argument_list|)
expr_stmt|;
name|normclip
operator|=
operator|*
name|clip
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|SetTileClip
argument_list|(
name|clip
argument_list|)
specifier|register
name|CLIP
operator|*
name|clip
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|clip
operator|->
name|left
operator|!=
name|tileclip
operator|.
name|left
operator|||
name|clip
operator|->
name|top
operator|!=
name|tileclip
operator|.
name|top
operator|||
name|clip
operator|->
name|width
operator|!=
name|tileclip
operator|.
name|width
operator|||
name|clip
operator|->
name|height
operator|!=
name|tileclip
operator|.
name|height
condition|)
block|{
name|XConfigureWindow
argument_list|(
name|tt
argument_list|,
name|clip
operator|->
name|left
operator|-
name|tilex
argument_list|,
name|clip
operator|->
name|top
operator|-
name|tiley
argument_list|,
name|clip
operator|->
name|width
argument_list|,
name|clip
operator|->
name|height
argument_list|)
expr_stmt|;
name|tileclip
operator|=
operator|*
name|clip
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|SetTileOrigin
argument_list|(
name|tile
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|)
specifier|register
name|PIXMAP
operator|*
name|tile
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|tile
operator|->
name|width
condition|)
block|{
name|xoff
operator|%=
name|tile
operator|->
name|width
expr_stmt|;
if|if
condition|(
name|xoff
condition|)
name|xoff
operator|-=
name|tile
operator|->
name|width
expr_stmt|;
name|yoff
operator|%=
name|tile
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|yoff
condition|)
name|yoff
operator|-=
name|tile
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|xoff
operator|!=
name|tilex
operator|||
name|yoff
operator|!=
name|tiley
condition|)
block|{
name|XConfigureWindow
argument_list|(
name|ot
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|,
name|screen_width
operator|-
name|xoff
argument_list|,
name|screen_height
operator|-
name|yoff
argument_list|)
expr_stmt|;
name|tileclip
operator|.
name|left
operator|+=
operator|(
name|xoff
operator|-
name|tilex
operator|)
expr_stmt|;
name|tileclip
operator|.
name|top
operator|+=
operator|(
name|yoff
operator|-
name|tiley
operator|)
expr_stmt|;
name|tilex
operator|=
name|xoff
expr_stmt|;
name|tiley
operator|=
name|yoff
expr_stmt|;
block|}
block|}
block|}
end_block

begin_function
name|PIXMAP
modifier|*
name|PixmapSave
parameter_list|(
name|srcx
parameter_list|,
name|srcy
parameter_list|,
name|width
parameter_list|,
name|height
parameter_list|)
name|int
name|srcx
decl_stmt|,
name|srcy
decl_stmt|;
comment|/* source */
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
block|{
name|Pixmap
name|pix
decl_stmt|;
name|PIXMAP
modifier|*
name|pm
decl_stmt|;
name|pix
operator|=
name|XPixmapSave
argument_list|(
name|w
argument_list|,
name|srcx
argument_list|,
name|srcy
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|pix
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|pm
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|PIXMAP
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|pm
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|pm
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|pm
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|pix
expr_stmt|;
name|IsTile
argument_list|(
name|pm
argument_list|)
expr_stmt|;
return|return
operator|(
name|pm
operator|)
return|;
block|}
end_function

begin_macro
name|PixmapGet
argument_list|(
argument|srcx
argument_list|,
argument|srcy
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|,
argument|client
argument_list|,
argument|format
argument_list|,
argument|swapit
argument_list|)
end_macro

begin_decl_stmt
name|int
name|srcx
decl_stmt|,
name|srcy
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* source */
end_comment

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|client
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* file desc to write to */
end_comment

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: XY-format, 1: Z-format */
end_comment

begin_decl_stmt
name|int
name|swapit
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 1: swap shorts */
end_comment

begin_block
block|{
name|int
name|count
decl_stmt|;
name|caddr_t
name|data
decl_stmt|;
if|if
condition|(
name|format
operator|==
name|XYFormat
condition|)
block|{
name|count
operator|=
operator|(
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|dev
operator|->
name|planes
argument_list|)
operator|+
literal|3
operator|)
operator|&
operator|~
literal|3
expr_stmt|;
name|data
operator|=
name|Xalloc
argument_list|(
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
name|XPixmapGetXY
argument_list|(
name|w
argument_list|,
name|srcx
argument_list|,
name|srcy
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|)
operator|==
name|NULL
condition|)
return|return;
block|}
else|else
block|{
if|if
condition|(
name|dev
operator|->
name|planes
operator|>
literal|8
condition|)
name|count
operator|=
name|WZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
else|else
block|{
name|count
operator|=
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|swapit
operator|=
literal|0
expr_stmt|;
block|}
name|count
operator|=
operator|(
name|count
operator|+
literal|3
operator|)
operator|&
operator|~
literal|3
expr_stmt|;
name|data
operator|=
name|Xalloc
argument_list|(
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
name|XPixmapGetZ
argument_list|(
name|w
argument_list|,
name|srcx
argument_list|,
name|srcy
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|)
operator|==
name|NULL
condition|)
return|return;
block|}
name|FromPixmap
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|format
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|swapit
condition|)
name|Swap_shorts
argument_list|(
name|data
argument_list|,
name|count
operator|>>
literal|1
argument_list|)
expr_stmt|;
name|Write
argument_list|(
name|client
argument_list|,
name|data
argument_list|,
name|count
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ResolveColor
argument_list|(
argument|red
argument_list|,
argument|green
argument_list|,
argument|blue
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|short
modifier|*
name|red
decl_stmt|,
modifier|*
name|green
decl_stmt|,
modifier|*
name|blue
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* update in place */
end_comment

begin_block
block|{
name|Color
name|def
decl_stmt|;
if|if
condition|(
name|dev
operator|->
name|entries
condition|)
block|{
name|def
operator|.
name|pixel
operator|=
name|extrapix
expr_stmt|;
name|def
operator|.
name|red
operator|=
operator|*
name|red
expr_stmt|;
name|def
operator|.
name|green
operator|=
operator|*
name|green
expr_stmt|;
name|def
operator|.
name|blue
operator|=
operator|*
name|blue
expr_stmt|;
name|XStoreColor
argument_list|(
operator|&
name|def
argument_list|)
expr_stmt|;
name|XQueryColor
argument_list|(
operator|&
name|def
argument_list|)
expr_stmt|;
operator|*
name|red
operator|=
name|def
operator|.
name|red
expr_stmt|;
operator|*
name|green
operator|=
name|def
operator|.
name|green
expr_stmt|;
operator|*
name|blue
operator|=
name|def
operator|.
name|blue
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|StoreColors
argument_list|(
argument|count
argument_list|,
argument|entries
argument_list|)
end_macro

begin_decl_stmt
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* number of entries */
end_comment

begin_decl_stmt
specifier|register
name|ColorDef
modifier|*
name|entries
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|Color
modifier|*
name|ptr
decl_stmt|;
specifier|register
name|int
name|n
decl_stmt|;
specifier|static
name|Color
modifier|*
name|ents
init|=
name|NULL
decl_stmt|;
specifier|static
name|entcnt
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|count
operator|>
name|entcnt
condition|)
block|{
name|free
argument_list|(
operator|(
name|caddr_t
operator|)
name|ents
argument_list|)
expr_stmt|;
name|ents
operator|=
operator|(
name|Color
operator|*
operator|)
name|Xalloc
argument_list|(
name|count
operator|*
sizeof|sizeof
argument_list|(
name|Color
argument_list|)
argument_list|)
expr_stmt|;
name|entcnt
operator|=
name|count
expr_stmt|;
block|}
for|for
control|(
name|ptr
operator|=
name|ents
operator|,
name|n
operator|=
name|count
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|entries
operator|++
operator|,
name|ptr
operator|++
control|)
block|{
name|ptr
operator|->
name|pixel
operator|=
name|npix
argument_list|(
name|entries
operator|->
name|pixel
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|red
operator|=
name|entries
operator|->
name|red
expr_stmt|;
name|ptr
operator|->
name|green
operator|=
name|entries
operator|->
name|green
expr_stmt|;
name|ptr
operator|->
name|blue
operator|=
name|entries
operator|->
name|blue
expr_stmt|;
block|}
name|XStoreColors
argument_list|(
name|count
argument_list|,
name|ents
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|FONT
modifier|*
name|GetFont
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
comment|/* font or file name */
block|{
specifier|register
name|FontInfo
modifier|*
name|info
decl_stmt|;
specifier|register
name|FONT
modifier|*
name|fd
decl_stmt|;
name|char
modifier|*
name|fname
decl_stmt|;
name|info
operator|=
name|XOpenFont
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|==
name|NULL
condition|)
block|{
name|errno
operator|=
name|EINVAL
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|fd
operator|=
operator|(
name|FONT
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|FONT
argument_list|)
argument_list|)
expr_stmt|;
name|fname
operator|=
name|Xalloc
argument_list|(
name|strlen
argument_list|(
name|name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|fname
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|fd
operator|->
name|name
operator|=
name|fname
expr_stmt|;
name|fd
operator|->
name|first
operator|=
name|info
operator|->
name|firstchar
expr_stmt|;
name|fd
operator|->
name|last
operator|=
name|info
operator|->
name|lastchar
expr_stmt|;
name|fd
operator|->
name|space
operator|=
literal|' '
expr_stmt|;
name|fd
operator|->
name|height
operator|=
name|info
operator|->
name|height
expr_stmt|;
name|fd
operator|->
name|avg_width
operator|=
name|info
operator|->
name|width
expr_stmt|;
name|fd
operator|->
name|fixed
operator|=
name|info
operator|->
name|fixedwidth
expr_stmt|;
name|fd
operator|->
name|base
operator|=
name|info
operator|->
name|baseline
expr_stmt|;
name|fd
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|fd
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|info
expr_stmt|;
return|return
operator|(
name|fd
operator|)
return|;
block|}
end_function

begin_macro
name|FreeFont
argument_list|(
argument|font
argument_list|)
end_macro

begin_decl_stmt
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XCloseFont
argument_list|(
name|Xfinf
argument_list|(
name|font
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|font
operator|->
name|name
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|caddr_t
operator|)
name|font
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|CharWidth
argument_list|(
argument|c
argument_list|,
argument|font
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|c
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* character */
end_comment

begin_decl_stmt
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* font */
end_comment

begin_block
block|{
if|if
condition|(
name|c
operator|<
name|font
operator|->
name|first
operator|||
name|c
operator|>
name|font
operator|->
name|last
condition|)
return|return
operator|(
literal|0
operator|)
return|;
elseif|else
if|if
condition|(
name|font
operator|->
name|fixed
condition|)
return|return
operator|(
name|font
operator|->
name|avg_width
operator|)
return|;
else|else
return|return
operator|(
name|Xfinf
argument_list|(
name|font
argument_list|)
operator|->
name|widths
index|[
name|c
operator|-
name|font
operator|->
name|first
index|]
operator|)
return|;
block|}
end_block

begin_macro
name|TextWidth
argument_list|(
argument|string
argument_list|,
argument|strlen
argument_list|,
argument|spacepad
argument_list|,
argument|font
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* character string */
end_comment

begin_decl_stmt
name|int
name|strlen
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* string length */
end_comment

begin_decl_stmt
name|int
name|spacepad
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* space-character pad */
end_comment

begin_decl_stmt
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* font */
end_comment

begin_block
block|{
specifier|register
name|u_char
modifier|*
name|strptr
init|=
operator|(
name|u_char
operator|*
operator|)
name|string
decl_stmt|;
name|short
name|c
decl_stmt|;
specifier|register
name|short
modifier|*
name|widths
decl_stmt|;
name|int
name|width
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|font
operator|->
name|fixed
condition|)
block|{
name|width
operator|=
name|strlen
operator|*
name|font
operator|->
name|avg_width
expr_stmt|;
if|if
condition|(
name|spacepad
condition|)
block|{
while|while
condition|(
operator|--
name|strlen
operator|>=
literal|0
condition|)
if|if
condition|(
operator|*
name|strptr
operator|++
operator|==
name|font
operator|->
name|space
condition|)
name|width
operator|+=
name|spacepad
expr_stmt|;
block|}
block|}
else|else
block|{
name|widths
operator|=
name|Xfinf
argument_list|(
name|font
argument_list|)
operator|->
name|widths
expr_stmt|;
while|while
condition|(
operator|--
name|strlen
operator|>=
literal|0
condition|)
block|{
name|c
operator|=
operator|*
name|strptr
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|>=
name|font
operator|->
name|first
operator|&&
name|c
operator|<=
name|font
operator|->
name|last
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|font
operator|->
name|space
condition|)
name|width
operator|+=
name|spacepad
expr_stmt|;
name|width
operator|+=
name|widths
index|[
name|c
operator|-
name|font
operator|->
name|first
index|]
expr_stmt|;
block|}
block|}
block|}
return|return
operator|(
name|width
operator|)
return|;
block|}
end_block

begin_function
name|BITMAP
modifier|*
name|StoreBitmap
parameter_list|(
name|width
parameter_list|,
name|height
parameter_list|,
name|data
parameter_list|)
name|int
name|width
decl_stmt|;
comment|/* bitmap width */
name|int
name|height
decl_stmt|;
comment|/* bitmap height */
name|char
modifier|*
name|data
decl_stmt|;
comment|/* bitmap data */
block|{
name|Bitmap
name|bitmap
decl_stmt|;
specifier|register
name|BITMAP
modifier|*
name|bm
decl_stmt|;
name|bitmap
operator|=
name|XStoreBitmap
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitmap
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|bm
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|BITMAP
argument_list|)
argument_list|)
expr_stmt|;
name|bm
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|bm
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|bm
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|bm
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|bitmap
expr_stmt|;
return|return
operator|(
name|bm
operator|)
return|;
block|}
end_function

begin_macro
name|FreeBitmap
argument_list|(
argument|bitmap
argument_list|)
end_macro

begin_decl_stmt
name|BITMAP
modifier|*
name|bitmap
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XFreeBitmap
argument_list|(
name|Xbitmap
argument_list|(
name|bitmap
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|caddr_t
operator|)
name|bitmap
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|BITMAP
modifier|*
name|CharBitmap
parameter_list|(
name|c
parameter_list|,
name|font
parameter_list|)
name|unsigned
name|c
decl_stmt|;
comment|/* character */
specifier|register
name|FONT
modifier|*
name|font
decl_stmt|;
comment|/* font */
block|{
name|Bitmap
name|bitmap
decl_stmt|;
specifier|register
name|BITMAP
modifier|*
name|bm
decl_stmt|;
name|bitmap
operator|=
name|XCharBitmap
argument_list|(
name|Xfont
argument_list|(
name|font
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitmap
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|bm
operator|=
operator|(
name|BITMAP
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|BITMAP
argument_list|)
argument_list|)
expr_stmt|;
name|bm
operator|->
name|width
operator|=
name|CharWidth
argument_list|(
name|c
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|bm
operator|->
name|height
operator|=
name|Xfinf
argument_list|(
name|font
argument_list|)
operator|->
name|height
expr_stmt|;
name|bm
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|bm
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|bitmap
expr_stmt|;
return|return
operator|(
name|bm
operator|)
return|;
block|}
end_function

begin_function
name|PIXMAP
modifier|*
name|StorePixmap
parameter_list|(
name|width
parameter_list|,
name|height
parameter_list|,
name|format
parameter_list|,
name|data
parameter_list|)
name|int
name|width
decl_stmt|;
comment|/* pixmap width */
name|int
name|height
decl_stmt|;
comment|/* pixmap height */
name|int
name|format
decl_stmt|;
comment|/* 0: XY-format, 1: Z-format */
name|char
modifier|*
name|data
decl_stmt|;
comment|/* pixmap data */
block|{
name|Pixmap
name|pix
decl_stmt|;
specifier|register
name|PIXMAP
modifier|*
name|pm
decl_stmt|;
name|ToPixmap
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|format
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|format
operator|==
name|XYFormat
condition|)
name|pix
operator|=
name|XStorePixmapXY
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|)
expr_stmt|;
else|else
name|pix
operator|=
name|XStorePixmapZ
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|pix
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|pm
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|PIXMAP
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|pm
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|pm
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|pm
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|pix
expr_stmt|;
name|IsTile
argument_list|(
name|pm
argument_list|)
expr_stmt|;
return|return
operator|(
name|pm
operator|)
return|;
block|}
end_function

begin_macro
name|FreePixmap
argument_list|(
argument|pixmap
argument_list|)
end_macro

begin_decl_stmt
name|PIXMAP
modifier|*
name|pixmap
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XFreePixmap
argument_list|(
name|Xpixmap
argument_list|(
name|pixmap
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|caddr_t
operator|)
name|pixmap
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ToPixmap
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|format
argument_list|,
argument|data
argument_list|)
end_macro

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|format
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
name|int
name|shift
decl_stmt|;
specifier|register
name|u_short
modifier|*
name|sptr
decl_stmt|;
specifier|register
name|u_char
modifier|*
name|cptr
decl_stmt|;
specifier|register
name|char
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|dev
operator|->
name|entries
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
name|format
operator|==
name|XYFormat
condition|)
block|{
name|n
operator|=
name|BitmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixshift
condition|)
block|{
name|ptr
operator|=
name|data
operator|+
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|dev
operator|->
name|planes
argument_list|)
expr_stmt|;
name|shift
operator|=
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|pixplanes
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|ptr
operator|-
name|shift
argument_list|,
name|ptr
operator|-
operator|(
name|shift
operator|+
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|pixshift
argument_list|)
operator|)
argument_list|,
name|shift
argument_list|)
expr_stmt|;
for|for
control|(
name|shift
operator|=
literal|0
operator|,
name|ptr
operator|-=
name|n
init|;
name|shift
operator|<
name|pixshift
condition|;
name|shift
operator|++
operator|,
name|ptr
operator|-=
name|n
control|)
block|{
if|if
condition|(
name|basepix
operator|&
operator|(
literal|1
operator|<<
name|shift
operator|)
condition|)
name|AllOnes
argument_list|(
name|ptr
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
else|else
name|bzero
argument_list|(
name|ptr
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|shift
operator|=
name|dev
operator|->
name|planes
operator|,
name|ptr
operator|=
name|data
init|;
operator|--
name|shift
operator|>=
name|pixshift
operator|+
name|pixplanes
condition|;
name|ptr
operator|+=
name|n
control|)
block|{
if|if
condition|(
name|basepix
operator|&
operator|(
literal|1
operator|<<
name|shift
operator|)
condition|)
name|AllOnes
argument_list|(
name|ptr
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dev
operator|->
name|planes
operator|>
literal|8
condition|)
block|{
for|for
control|(
name|n
operator|=
name|WZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
operator|>>
literal|1
operator|,
name|sptr
operator|=
operator|(
name|u_short
operator|*
operator|)
name|data
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|sptr
operator|++
control|)
operator|*
name|sptr
operator|=
name|npix
argument_list|(
operator|*
name|sptr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|n
operator|=
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
operator|,
name|cptr
operator|=
operator|(
name|u_char
operator|*
operator|)
name|data
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|cptr
operator|++
control|)
operator|*
name|cptr
operator|=
name|npix
argument_list|(
operator|*
name|cptr
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|AllOnes
argument_list|(
name|data
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
specifier|register
name|char
operator|*
name|data
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|,
name|cnt
decl_stmt|;
specifier|register
name|char
modifier|*
name|ptr
decl_stmt|;
name|n
operator|=
name|BitmapSize
argument_list|(
name|width
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|ptr
operator|=
name|data
operator|,
name|cnt
operator|=
name|n
init|;
operator|--
name|cnt
operator|>=
literal|0
condition|;
control|)
operator|*
name|ptr
operator|++
operator|=
operator|~
literal|0
expr_stmt|;
for|for
control|(
name|ptr
operator|=
name|data
operator|+
name|n
operator|,
name|cnt
operator|=
name|height
init|;
operator|--
name|cnt
operator|>
literal|0
condition|;
name|ptr
operator|+=
name|n
control|)
name|bcopy
argument_list|(
name|data
argument_list|,
name|ptr
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|FromPixmap
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|format
argument_list|,
argument|data
argument_list|)
end_macro

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|format
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
specifier|register
name|u_short
modifier|*
name|sptr
decl_stmt|;
specifier|register
name|u_char
modifier|*
name|cptr
decl_stmt|;
specifier|register
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|cnt
decl_stmt|,
name|shift
decl_stmt|;
if|if
condition|(
name|dev
operator|->
name|entries
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
name|format
operator|==
name|XYFormat
condition|)
block|{
if|if
condition|(
name|pixshift
condition|)
block|{
name|cnt
operator|=
name|BitmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|shift
operator|=
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|pixshift
argument_list|)
expr_stmt|;
for|for
control|(
name|ptr
operator|=
name|data
operator|+
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|dev
operator|->
name|planes
argument_list|)
operator|-
name|cnt
operator|,
name|n
operator|=
name|pixshift
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|ptr
operator|-=
name|cnt
control|)
name|bcopy
argument_list|(
name|ptr
operator|-
name|shift
argument_list|,
name|ptr
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
block|}
name|bzero
argument_list|(
name|data
argument_list|,
name|XYPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|dev
operator|->
name|planes
operator|-
name|pixplanes
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|dev
operator|->
name|planes
operator|>
literal|8
condition|)
block|{
for|for
control|(
name|n
operator|=
name|WZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
operator|>>
literal|1
operator|,
name|sptr
operator|=
operator|(
name|u_short
operator|*
operator|)
name|data
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|sptr
operator|++
control|)
operator|*
name|sptr
operator|=
name|opix
argument_list|(
operator|*
name|sptr
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|n
operator|=
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
operator|,
name|cptr
operator|=
operator|(
name|u_char
operator|*
operator|)
name|data
init|;
operator|--
name|n
operator|>=
literal|0
condition|;
name|cptr
operator|++
control|)
operator|*
name|cptr
operator|=
name|opix
argument_list|(
operator|*
name|cptr
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
name|PIXMAP
modifier|*
name|MakePixmap
parameter_list|(
name|xymask
parameter_list|,
name|fore
parameter_list|,
name|back
parameter_list|)
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
comment|/* mask or NULL */
name|int
name|fore
decl_stmt|;
comment|/* foreground pixel */
name|int
name|back
decl_stmt|;
comment|/* background pixel */
block|{
name|Pixmap
name|pix
decl_stmt|;
specifier|register
name|PIXMAP
modifier|*
name|pm
decl_stmt|;
name|pix
operator|=
name|XMakePixmap
argument_list|(
name|xymask
condition|?
name|Xbitmap
argument_list|(
name|xymask
argument_list|)
else|:
name|NULL
argument_list|,
name|npix
argument_list|(
name|fore
argument_list|)
argument_list|,
name|npix
argument_list|(
name|back
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pix
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|pm
operator|=
operator|(
name|PIXMAP
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|PIXMAP
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|pm
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|pix
expr_stmt|;
if|if
condition|(
name|xymask
condition|)
block|{
name|pm
operator|->
name|width
operator|=
name|xymask
operator|->
name|width
expr_stmt|;
name|pm
operator|->
name|height
operator|=
name|xymask
operator|->
name|height
expr_stmt|;
name|IsTile
argument_list|(
name|pm
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pm
operator|->
name|width
operator|=
literal|0
expr_stmt|;
name|pm
operator|->
name|height
operator|=
literal|0
expr_stmt|;
name|pm
operator|->
name|tile
operator|=
literal|1
expr_stmt|;
block|}
return|return
operator|(
name|pm
operator|)
return|;
block|}
end_function

begin_macro
name|IsTile
argument_list|(
argument|pm
argument_list|)
end_macro

begin_decl_stmt
name|PIXMAP
modifier|*
name|pm
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|XQueryTileShape
argument_list|(
name|pm
operator|->
name|width
argument_list|,
name|pm
operator|->
name|height
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|pm
operator|->
name|width
operator|==
name|width
operator|&&
name|pm
operator|->
name|height
operator|==
name|height
condition|)
name|pm
operator|->
name|tile
operator|=
literal|1
expr_stmt|;
else|else
name|pm
operator|->
name|tile
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|QueryShape
argument_list|(
argument|shape
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|)
end_macro

begin_decl_stmt
name|int
name|shape
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: cursor, 1: tile, 2: brush */
end_comment

begin_decl_stmt
name|short
modifier|*
name|width
decl_stmt|,
modifier|*
name|height
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* update in place */
end_comment

begin_block
block|{
name|int
name|rwidth
decl_stmt|,
name|rheight
decl_stmt|;
switch|switch
condition|(
name|shape
condition|)
block|{
case|case
name|CursorShape
case|:
name|XQueryCursorShape
argument_list|(
operator|*
name|width
argument_list|,
operator|*
name|height
argument_list|,
operator|&
name|rwidth
argument_list|,
operator|&
name|rheight
argument_list|)
expr_stmt|;
break|break;
case|case
name|TileShape
case|:
name|XQueryTileShape
argument_list|(
operator|*
name|width
argument_list|,
operator|*
name|height
argument_list|,
operator|&
name|rwidth
argument_list|,
operator|&
name|rheight
argument_list|)
expr_stmt|;
break|break;
case|case
name|BrushShape
case|:
name|XQueryBrushShape
argument_list|(
operator|*
name|width
argument_list|,
operator|*
name|height
argument_list|,
operator|&
name|rwidth
argument_list|,
operator|&
name|rheight
argument_list|)
expr_stmt|;
break|break;
block|}
operator|*
name|width
operator|=
name|rwidth
expr_stmt|;
operator|*
name|height
operator|=
name|rheight
expr_stmt|;
block|}
end_block

begin_function
name|CURSOR
modifier|*
name|StoreCursor
parameter_list|(
name|func
parameter_list|,
name|image
parameter_list|,
name|fore
parameter_list|,
name|back
parameter_list|,
name|mask
parameter_list|,
name|xoff
parameter_list|,
name|yoff
parameter_list|)
name|int
name|func
decl_stmt|;
comment|/* GX display function */
name|BITMAP
modifier|*
name|image
decl_stmt|;
comment|/* cursor image */
name|int
name|fore
decl_stmt|;
comment|/* foreground pixel */
name|int
name|back
decl_stmt|;
comment|/* background pixel */
name|BITMAP
modifier|*
name|mask
decl_stmt|;
comment|/* cursor mask or NULL */
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
comment|/* tip */
block|{
name|Cursor
name|cursor
decl_stmt|;
specifier|register
name|CURSOR
modifier|*
name|cr
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|cursor
operator|=
name|XStoreCursor
argument_list|(
name|Xbitmap
argument_list|(
name|image
argument_list|)
argument_list|,
name|mask
condition|?
name|Xbitmap
argument_list|(
name|mask
argument_list|)
else|:
name|NULL
argument_list|,
name|xoff
argument_list|,
name|yoff
argument_list|,
name|npix
argument_list|(
name|fore
argument_list|)
argument_list|,
name|npix
argument_list|(
name|back
argument_list|)
argument_list|,
name|func
argument_list|)
expr_stmt|;
if|if
condition|(
name|cursor
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|XQueryCursorShape
argument_list|(
name|image
operator|->
name|width
argument_list|,
name|image
operator|->
name|height
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|cr
operator|=
operator|(
name|CURSOR
operator|*
operator|)
name|Xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|CURSOR
argument_list|)
argument_list|)
expr_stmt|;
name|cr
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|cr
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|cr
operator|->
name|xoff
operator|=
name|xoff
expr_stmt|;
name|cr
operator|->
name|yoff
operator|=
name|yoff
expr_stmt|;
name|cr
operator|->
name|xmin
operator|=
name|xoff
expr_stmt|;
name|cr
operator|->
name|ymin
operator|=
name|yoff
expr_stmt|;
name|cr
operator|->
name|xmax
operator|=
name|screen_width
operator|-
operator|(
name|width
operator|-
name|xoff
operator|)
expr_stmt|;
name|cr
operator|->
name|ymax
operator|=
name|screen_height
operator|-
operator|(
name|height
operator|-
name|yoff
operator|)
expr_stmt|;
name|cr
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|cr
operator|->
name|data
operator|=
operator|(
name|caddr_t
operator|)
name|cursor
expr_stmt|;
return|return
operator|(
name|cr
operator|)
return|;
block|}
end_function

begin_macro
name|FreeCursor
argument_list|(
argument|cursor
argument_list|)
end_macro

begin_decl_stmt
name|CURSOR
modifier|*
name|cursor
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XFreeCursor
argument_list|(
name|Xcursor
argument_list|(
name|cursor
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|caddr_t
operator|)
name|cursor
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|LoadCursor
argument_list|(
argument|cursor
argument_list|)
end_macro

begin_decl_stmt
name|CURSOR
modifier|*
name|cursor
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|cursor
operator|->
name|xoff
operator|!=
name|cursor_x
operator|||
name|cursor
operator|->
name|yoff
operator|!=
name|cursor_y
condition|)
block|{
name|XCondWarpMouse
argument_list|(
name|w
argument_list|,
name|mouse
operator|.
name|x
operator|+
name|cursor
operator|->
name|xoff
argument_list|,
name|mouse
operator|.
name|y
operator|+
name|cursor
operator|->
name|yoff
argument_list|,
name|w
argument_list|,
name|mouse
operator|.
name|x
operator|+
name|cursor_x
argument_list|,
name|mouse
operator|.
name|y
operator|+
name|cursor_y
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|cursor_x
operator|=
name|cursor
operator|->
name|xoff
expr_stmt|;
name|cursor_y
operator|=
name|cursor
operator|->
name|yoff
expr_stmt|;
block|}
name|XDefineCursor
argument_list|(
name|w
argument_list|,
name|Xcursor
argument_list|(
name|cursor
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|SetMouseCharacteristics
argument_list|(
argument|threshold
argument_list|,
argument|acceleration
argument_list|)
end_macro

begin_decl_stmt
name|int
name|threshold
decl_stmt|,
name|acceleration
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

begin_macro
name|SetCursorPosition
argument_list|(
argument|pos
argument_list|)
end_macro

begin_decl_stmt
name|vsCursor
modifier|*
name|pos
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XCondWarpMouse
argument_list|(
name|w
argument_list|,
name|pos
operator|->
name|x
operator|+
name|cursor_x
argument_list|,
name|pos
operator|->
name|y
operator|+
name|cursor_y
argument_list|,
name|w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mouse
operator|=
operator|*
name|pos
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|SetAutoRepeat
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: off, 1: on */
end_comment

begin_block
block|{ }
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|SetKeyClick
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: off, 1-8: on */
end_comment

begin_block
block|{ }
end_block

begin_macro
name|SoundBell
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0-7 */
end_comment

begin_block
block|{
name|XFeep
argument_list|(
name|volume
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|SetLockLED
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: off, 1: on */
end_comment

begin_block
block|{ }
end_block

begin_macro
name|SetVideo
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0: off, 1: on */
end_comment

begin_block
block|{
return|return
operator|(
name|onoff
operator|-
literal|1
operator|)
return|;
block|}
end_block

end_unit

