begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"wm.h"
end_include

begin_include
include|#
directive|include
file|"../cursors/icon.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/xterm.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/xterm_mask.cursor"
end_include

begin_define
define|#
directive|define
name|solid_vcount
value|(1 + 4*2)
end_define

begin_comment
comment|/* We're goin' around twice */
end_comment

begin_define
define|#
directive|define
name|flash_vcount
value|(1 + 4*4)
end_define

begin_comment
comment|/* 4 times, if flashing! */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_wmsubs_c
init|=
literal|"$Header: wmsubs.c,v 10.3 86/02/01 16:02:10 tony Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|int
name|vcount
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Vertex
name|solidBox
index|[
name|solid_vcount
index|]
decl_stmt|,
name|flashBox
index|[
name|flash_vcount
index|]
decl_stmt|,
modifier|*
name|box
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|iconHeight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|sizeWin
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|sizeWidth
decl_stmt|,
name|sizeHeight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|variableWidth
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|sizeX
decl_stmt|,
name|sizeY
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Where the size window is */
end_comment

begin_decl_stmt
name|Pixmap
name|behindSize
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* And what it obscures */
end_comment

begin_decl_stmt
name|Window
name|oldfocus
decl_stmt|;
end_decl_stmt

begin_macro
name|InitializeWm
argument_list|()
end_macro

begin_block
block|{
name|SetUpSizeWindow
argument_list|()
expr_stmt|;
name|SetUpBox
argument_list|()
expr_stmt|;
name|StoreWmCursors
argument_list|()
expr_stmt|;
name|FocusOn
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
name|oldfocus
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|SetUpSizeWindow
argument_list|()
end_macro

begin_block
block|{
name|FontInfo
name|finfo
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|,
name|minwid
decl_stmt|,
name|maxwid
decl_stmt|;
name|short
name|cwid
index|[
literal|10
index|]
decl_stmt|;
name|status
operator|=
name|XQueryFont
argument_list|(
name|sizefont
argument_list|,
operator|&
name|finfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't query size font in SetUpSizeWindow"
argument_list|)
expr_stmt|;
name|status
operator|=
name|XCharWidths
argument_list|(
literal|"0123456789x"
argument_list|,
literal|11
argument_list|,
name|sizefont
argument_list|,
name|cwid
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't get char widths in SetUpSizeWindow"
argument_list|)
expr_stmt|;
name|minwid
operator|=
literal|99999
expr_stmt|;
name|maxwid
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|10
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cwid
index|[
name|i
index|]
operator|<
name|minwid
condition|)
name|minwid
operator|=
name|cwid
index|[
name|i
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|cwid
index|[
name|i
index|]
operator|>
name|maxwid
condition|)
name|maxwid
operator|=
name|cwid
index|[
name|i
index|]
expr_stmt|;
block|}
name|variableWidth
operator|=
operator|(
name|minwid
operator|!=
name|maxwid
operator|)
expr_stmt|;
name|sizeWidth
operator|=
literal|7
operator|*
name|maxwid
operator|+
literal|4
expr_stmt|;
name|sizeHeight
operator|=
name|finfo
operator|.
name|height
operator|+
literal|4
expr_stmt|;
name|sizeWin
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|sizeWidth
operator|-
literal|2
argument_list|,
name|sizeHeight
operator|-
literal|2
argument_list|,
literal|1
argument_list|,
name|bgPixmap
argument_list|,
name|fgPixmap
argument_list|)
expr_stmt|;
if|if
condition|(
name|sizeWin
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't create sizeWin in SetUpSizeWindow"
argument_list|)
expr_stmt|;
name|status
operator|=
name|XQueryFont
argument_list|(
name|iconfont
argument_list|,
operator|&
name|finfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't query icon font in SetUpSizeWindow"
argument_list|)
expr_stmt|;
name|iconHeight
operator|=
name|finfo
operator|.
name|height
operator|+
literal|8
expr_stmt|;
block|}
end_block

begin_macro
name|SetUpBox
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|freeze
condition|)
block|{
name|vcount
operator|=
name|solid_vcount
expr_stmt|;
name|i
operator|=
name|solid_vcount
operator|-
literal|1
expr_stmt|;
name|box
operator|=
name|solidBox
expr_stmt|;
block|}
else|else
block|{
name|vcount
operator|=
name|flash_vcount
expr_stmt|;
name|i
operator|=
name|flash_vcount
operator|-
literal|1
expr_stmt|;
name|box
operator|=
name|flashBox
expr_stmt|;
block|}
name|box
index|[
name|i
operator|--
index|]
operator|.
name|flags
operator|=
name|VertexRelative
operator||
name|VertexDrawLastPoint
expr_stmt|;
while|while
condition|(
name|i
operator|>
literal|0
condition|)
name|box
index|[
name|i
operator|--
index|]
operator|.
name|flags
operator|=
name|VertexRelative
expr_stmt|;
name|box
index|[
literal|0
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|freeze
condition|)
name|box
index|[
name|solid_vcount
operator|-
literal|1
index|]
operator|.
name|flags
operator||=
name|VertexDrawLastPoint
expr_stmt|;
block|}
end_block

begin_macro
name|StoreWmCursors
argument_list|()
end_macro

begin_block
block|{
name|iconCursor
operator|=
name|XCreateCursor
argument_list|(
name|icon_width
argument_list|,
name|icon_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|icon_bits
argument_list|,
operator|(
name|caddr_t
operator|)
name|NULL
argument_list|,
literal|8
argument_list|,
literal|8
argument_list|,
name|WhitePixel
argument_list|,
name|BlackPixel
argument_list|,
name|GXcopyInverted
argument_list|)
expr_stmt|;
if|if
condition|(
name|iconCursor
operator|==
literal|0
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't store iconCursor in StoreWmCursors"
argument_list|)
expr_stmt|;
block|}
name|textCursor
operator|=
name|XCreateCursor
argument_list|(
name|xterm_width
argument_list|,
name|xterm_height
argument_list|,
operator|(
name|caddr_t
operator|)
name|xterm_bits
argument_list|,
operator|(
name|caddr_t
operator|)
name|xterm_mask_bits
argument_list|,
literal|8
argument_list|,
literal|8
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|,
name|GXcopyInverted
argument_list|)
expr_stmt|;
if|if
condition|(
name|textCursor
operator|==
literal|0
condition|)
block|{
name|Error
argument_list|(
literal|"Couldn't store textCursor in StoreWmCursors"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Raise
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|neww
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
return|return;
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|neww
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|neww
operator|!=
name|w
condition|)
return|return;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XRaiseWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Lower
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|neww
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
return|return;
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|neww
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|neww
operator|!=
name|w
condition|)
return|return;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XLowerWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Move
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Window
name|subwindow
decl_stmt|;
name|BEvent
name|newbutton
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|oldx
decl_stmt|,
name|oldy
decl_stmt|,
name|left
decl_stmt|,
name|top
decl_stmt|;
name|int
name|stop
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
name|InterpretLocatorXY
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|loc
argument_list|)
expr_stmt|;
name|left
operator|=
name|winfo
operator|->
name|x
expr_stmt|;
name|top
operator|=
name|winfo
operator|->
name|y
expr_stmt|;
name|oldx
operator|=
name|x
expr_stmt|;
name|oldy
operator|=
name|y
expr_stmt|;
name|StoreBox
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|winfo
operator|->
name|width
operator|+
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
argument_list|,
name|winfo
operator|->
name|height
operator|+
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* If we're willing to freeze the server, we don't flicker the box. 	   If not, we do double inverts that draw and then erase the box, 	   so we have to do them more often */
if|if
condition|(
name|freeze
condition|)
name|XGrabServer
argument_list|()
expr_stmt|;
name|DrawBox
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|stop
condition|)
block|{
comment|/* If we've moved at all, change the box and reset old x,y */
if|if
condition|(
name|x
operator|!=
name|oldx
operator|||
name|y
operator|!=
name|oldy
condition|)
block|{
if|if
condition|(
name|freeze
condition|)
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Erase */
name|oldx
operator|=
name|x
expr_stmt|;
name|oldy
operator|=
name|y
expr_stmt|;
name|box
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|left
expr_stmt|;
name|box
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|top
expr_stmt|;
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Redraw */
block|}
elseif|else
if|if
condition|(
operator|!
name|freeze
condition|)
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Find the new x,y.  If there's an event, use that; otherwise 	       query the mouse */
if|if
condition|(
name|XPending
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|GetEvent
argument_list|(
operator|&
name|newbutton
argument_list|)
condition|)
block|{
name|QueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|subwindow
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
break|break;
else|else
block|{
name|x
operator|=
name|newbutton
operator|.
name|x
expr_stmt|;
name|y
operator|=
name|newbutton
operator|.
name|y
expr_stmt|;
name|stop
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
name|QueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|subwindow
argument_list|)
expr_stmt|;
name|left
operator|+=
name|x
operator|-
name|oldx
expr_stmt|;
name|top
operator|+=
name|y
operator|-
name|oldy
expr_stmt|;
block|}
if|if
condition|(
name|freeze
condition|)
block|{
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Erase */
name|XUngrabServer
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|stop
condition|)
return|return;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XMoveWindow
argument_list|(
name|w
argument_list|,
name|left
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
comment|/* Fix up frame */
block|}
end_block

begin_macro
name|Resize
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|int
name|t
decl_stmt|;
name|int
name|baseheight
decl_stmt|,
name|hinc
decl_stmt|,
name|basewidth
decl_stmt|,
name|winc
decl_stmt|;
name|int
name|x0
decl_stmt|,
name|y0
decl_stmt|;
comment|/* Initial x,y of mouse */
name|int
name|fixedx
decl_stmt|,
name|fixedy
decl_stmt|;
comment|/* x,y of fixed corner */
name|int
name|movex
decl_stmt|,
name|movey
decl_stmt|;
comment|/* x,y of movable corner */
name|int
name|limitx
decl_stmt|,
name|limity
decl_stmt|;
comment|/* limit to movement due to min window size */
name|int
name|oldx
decl_stmt|,
name|oldy
decl_stmt|;
comment|/* previous location of moving corner */
name|int
name|newx
decl_stmt|,
name|newy
decl_stmt|;
comment|/* new location of moving corner */
name|int
name|lastx
decl_stmt|,
name|lasty
decl_stmt|;
comment|/* previous cursor location */
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* new cursor location */
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
comment|/* flags indicating movement direction */
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
comment|/* width& height of window */
name|int
name|usesize
decl_stmt|,
name|stop
init|=
name|FALSE
decl_stmt|;
name|Window
name|subwindow
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
comment|/* Find out about window and get resizing info */
name|status
operator|=
name|XGetResizeHint
argument_list|(
name|w
argument_list|,
operator|&
name|basewidth
argument_list|,
operator|&
name|baseheight
argument_list|,
operator|&
name|winc
argument_list|,
operator|&
name|hinc
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't get resize hint in Resize"
argument_list|)
expr_stmt|;
name|InterpretLocatorXY
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
name|loc
argument_list|)
expr_stmt|;
comment|/* Initially fixedx is left, fixedy top, movex right, and 	   movey bottom */
name|fixedx
operator|=
name|winfo
operator|->
name|x
expr_stmt|;
name|fixedy
operator|=
name|winfo
operator|->
name|y
expr_stmt|;
name|width
operator|=
name|winfo
operator|->
name|width
operator|+
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
expr_stmt|;
name|height
operator|=
name|winfo
operator|->
name|height
operator|+
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
expr_stmt|;
name|movex
operator|=
name|fixedx
operator|+
name|width
expr_stmt|;
name|movey
operator|=
name|fixedy
operator|+
name|height
expr_stmt|;
comment|/* We only will use a size window if the increments are large 	   enough and the current window size corresponds to the hints */
name|usesize
operator|=
operator|(
name|winc
operator|>
literal|3
operator|&&
name|hinc
operator|>
literal|3
operator|&&
operator|(
name|winfo
operator|->
name|width
operator|-
name|basewidth
operator|)
operator|%
name|winc
operator|==
literal|0
operator|&&
operator|(
name|winfo
operator|->
name|height
operator|-
name|baseheight
operator|)
operator|%
name|hinc
operator|==
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|basewidth
operator|==
literal|0
operator|&&
name|winc
operator|==
literal|1
operator|&&
name|baseheight
operator|==
literal|0
operator|&&
name|hinc
operator|==
literal|1
condition|)
block|{
name|basewidth
operator|=
literal|1
expr_stmt|;
name|baseheight
operator|=
literal|1
expr_stmt|;
block|}
comment|/* movex,y are still right and bottom */
name|limitx
operator|=
name|movex
operator|-
name|winfo
operator|->
name|width
operator|+
name|basewidth
operator|+
name|winc
expr_stmt|;
name|limity
operator|=
name|movey
operator|-
name|winfo
operator|->
name|height
operator|+
name|baseheight
operator|+
name|hinc
expr_stmt|;
name|basewidth
operator|+=
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
expr_stmt|;
name|baseheight
operator|+=
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
operator|-
literal|1
expr_stmt|;
comment|/* Calculate the moving directions dx,dy */
name|CalculateMovingEdges
argument_list|(
operator|&
name|dx
argument_list|,
operator|&
name|dy
argument_list|,
name|x0
argument_list|,
name|fixedx
argument_list|,
name|movex
argument_list|,
name|y0
argument_list|,
name|fixedy
argument_list|,
name|movey
argument_list|,
name|winfo
argument_list|)
expr_stmt|;
comment|/* Figure out which edges to move depending upon which ninth 	   the cursor is in.  Adjust fixed and move edges accordingly:  	   dx,y indicate which edges are fixed.  Values:  		dx	fixedx	movex		dy	fixedy	movey 		1,0	left	right		1,0	top	bottom 		-1	right	left		-1	bottom	top  	   A value of 0 means that both edges are fixed in that direction */
comment|/* If we're moving left edge, switch */
if|if
condition|(
name|dx
operator|==
operator|-
literal|1
condition|)
block|{
name|limitx
operator|=
name|movex
operator|-
operator|(
name|limitx
operator|-
name|fixedx
operator|)
expr_stmt|;
name|t
operator|=
name|fixedx
expr_stmt|;
name|fixedx
operator|=
name|movex
expr_stmt|;
name|movex
operator|=
name|t
expr_stmt|;
name|width
operator|=
operator|-
name|width
expr_stmt|;
block|}
comment|/* If we're moving top edge, switch */
if|if
condition|(
name|dy
operator|==
operator|-
literal|1
condition|)
block|{
name|limity
operator|=
name|movey
operator|-
operator|(
name|limity
operator|-
name|fixedy
operator|)
expr_stmt|;
name|t
operator|=
name|fixedy
expr_stmt|;
name|fixedy
operator|=
name|movey
expr_stmt|;
name|movey
operator|=
name|t
expr_stmt|;
name|height
operator|=
operator|-
name|height
expr_stmt|;
block|}
name|oldx
operator|=
name|newx
operator|=
name|movex
expr_stmt|;
name|oldy
operator|=
name|newy
operator|=
name|movey
expr_stmt|;
name|lastx
operator|=
name|x0
expr_stmt|;
name|lasty
operator|=
name|y0
expr_stmt|;
name|StoreBox
argument_list|(
name|fixedx
argument_list|,
name|fixedy
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* If we're willing to freeze the server, we don't flicker the box. 	   If not, we do double inverts that draw and then erase the box, 	   so we have to do them more often */
if|if
condition|(
name|freeze
condition|)
name|XGrabServer
argument_list|()
expr_stmt|;
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Draw box */
if|if
condition|(
name|usesize
condition|)
block|{
name|CreateSize
argument_list|(
name|dx
argument_list|,
name|dy
argument_list|,
name|fixedx
argument_list|,
name|fixedy
argument_list|,
name|winfo
argument_list|)
expr_stmt|;
name|FillinSize
argument_list|(
operator|(
name|abs
argument_list|(
name|width
argument_list|)
operator|-
name|basewidth
operator|)
operator|/
name|winc
argument_list|,
operator|(
name|abs
argument_list|(
name|height
argument_list|)
operator|-
name|baseheight
operator|)
operator|/
name|hinc
argument_list|)
expr_stmt|;
block|}
comment|/* Loop until a button event occurs */
while|while
condition|(
operator|!
name|stop
condition|)
block|{
comment|/* If we've moved at all, change the box, fill in the 	       size window and reset old x,y */
if|if
condition|(
name|newx
operator|!=
name|oldx
operator|||
name|newy
operator|!=
name|oldy
condition|)
block|{
if|if
condition|(
name|freeze
condition|)
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Erase */
name|StoreBox
argument_list|(
name|fixedx
argument_list|,
name|fixedy
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|usesize
condition|)
block|{
name|FillinSize
argument_list|(
operator|(
name|abs
argument_list|(
name|width
argument_list|)
operator|-
name|basewidth
operator|)
operator|/
name|winc
argument_list|,
operator|(
name|abs
argument_list|(
name|height
argument_list|)
operator|-
name|baseheight
operator|)
operator|/
name|hinc
argument_list|)
expr_stmt|;
block|}
name|oldx
operator|=
name|newx
expr_stmt|;
name|oldy
operator|=
name|newy
expr_stmt|;
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Redraw */
block|}
elseif|else
if|if
condition|(
operator|!
name|freeze
condition|)
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Find the cursor x,y -- by an event if there is one, by 	       querying if not */
if|if
condition|(
name|XPending
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|GetEvent
argument_list|(
operator|&
name|newbutton
argument_list|)
condition|)
block|{
name|QueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|subwindow
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
break|break;
else|else
block|{
name|x
operator|=
name|newbutton
operator|.
name|x
expr_stmt|;
name|y
operator|=
name|newbutton
operator|.
name|y
expr_stmt|;
name|stop
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
name|QueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|subwindow
argument_list|)
expr_stmt|;
comment|/* If we haven't moved since last time, skip the rest */
if|if
condition|(
name|x
operator|==
name|lastx
operator|&&
name|y
operator|==
name|lasty
condition|)
continue|continue;
name|lastx
operator|=
name|x
expr_stmt|;
name|lasty
operator|=
name|y
expr_stmt|;
name|newx
operator|=
name|CalculateChange
argument_list|(
name|dx
argument_list|,
name|x
argument_list|,
name|x0
argument_list|,
name|winc
argument_list|,
name|limitx
argument_list|,
name|movex
argument_list|,
name|oldx
argument_list|)
expr_stmt|;
name|newy
operator|=
name|CalculateChange
argument_list|(
name|dy
argument_list|,
name|y
argument_list|,
name|y0
argument_list|,
name|hinc
argument_list|,
name|limity
argument_list|,
name|movey
argument_list|,
name|oldy
argument_list|)
expr_stmt|;
name|width
operator|+=
name|newx
operator|-
name|oldx
expr_stmt|;
name|height
operator|+=
name|newy
operator|-
name|oldy
expr_stmt|;
block|}
if|if
condition|(
name|freeze
condition|)
block|{
name|DrawBox
argument_list|()
expr_stmt|;
comment|/* Erase */
name|XUngrabServer
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|stop
condition|)
block|{
if|if
condition|(
name|usesize
condition|)
name|DestroySize
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|newx
operator|==
name|movex
operator|&&
name|newy
operator|==
name|movey
condition|)
block|{
comment|/* i.e. no change */
if|if
condition|(
name|usesize
condition|)
name|DestroySize
argument_list|()
expr_stmt|;
name|XRaiseWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Re-exchange things so that fixedx,y is the left top */
if|if
condition|(
name|newx
operator|<
name|fixedx
condition|)
block|{
name|t
operator|=
name|fixedx
expr_stmt|;
name|fixedx
operator|=
name|newx
expr_stmt|;
name|newx
operator|=
name|t
expr_stmt|;
block|}
if|if
condition|(
name|newy
operator|<
name|fixedy
condition|)
block|{
name|t
operator|=
name|fixedy
expr_stmt|;
name|fixedy
operator|=
name|newy
expr_stmt|;
name|newy
operator|=
name|t
expr_stmt|;
block|}
comment|/* Calculate new width and height. */
name|width
operator|=
name|newx
operator|-
name|fixedx
operator|+
literal|1
operator|-
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
name|height
operator|=
name|newy
operator|-
name|fixedy
operator|+
literal|1
operator|-
operator|(
name|winfo
operator|->
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|usesize
condition|)
name|DestroySize
argument_list|()
expr_stmt|;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XConfigureWindow
argument_list|(
name|w
argument_list|,
name|fixedx
argument_list|,
name|fixedy
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|CalculateMovingEdges
argument_list|(
argument|dx
argument_list|,
argument|dy
argument_list|,
argument|x0
argument_list|,
argument|fixedx
argument_list|,
argument|movex
argument_list|,
argument|y0
argument_list|,
argument|fixedy
argument_list|,
argument|movey
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|dx
decl_stmt|,
modifier|*
name|dy
decl_stmt|,
name|x0
decl_stmt|,
name|fixedx
decl_stmt|,
name|movex
decl_stmt|,
name|y0
decl_stmt|,
name|fixedy
decl_stmt|,
name|movey
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|xthird
decl_stmt|,
name|ythird
decl_stmt|;
operator|*
name|dx
operator|=
operator|*
name|dy
operator|=
literal|1
expr_stmt|;
comment|/* If we're closer to the left than to the right, switch */
if|if
condition|(
name|x0
operator|-
name|fixedx
operator|<
name|movex
operator|-
name|x0
condition|)
operator|*
name|dx
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* If we're closer to the top than the bottom, switch */
if|if
condition|(
name|y0
operator|-
name|fixedy
operator|<
name|movey
operator|-
name|y0
condition|)
operator|*
name|dy
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* Now, watch closely!  We take the offset from the point to the 	   left edge, multiply by 3 and divide by the width.  This gives 	   a value of 0, 1, or 2 depending if the point is in the left, 	   middle, or right thirds.  Do the same for y.  Add them together. 	   If the result is odd, the point must be in one of the edge ninths, 	   rather than a corner ninth or the middle ninth.  Figure out 	   which one and set dx,y accordingly. (gag) */
if|if
condition|(
name|winfo
operator|->
name|width
operator|>
literal|2
operator|&&
name|winfo
operator|->
name|height
operator|>
literal|2
condition|)
block|{
name|xthird
operator|=
operator|(
operator|(
name|x0
operator|-
name|winfo
operator|->
name|x
operator|-
name|winfo
operator|->
name|bdrwidth
operator|)
operator|*
literal|3
operator|)
operator|/
name|winfo
operator|->
name|width
expr_stmt|;
name|ythird
operator|=
operator|(
operator|(
name|y0
operator|-
name|winfo
operator|->
name|y
operator|-
name|winfo
operator|->
name|bdrwidth
operator|)
operator|*
literal|3
operator|)
operator|/
name|winfo
operator|->
name|height
expr_stmt|;
if|if
condition|(
operator|(
name|xthird
operator|+
name|ythird
operator|)
operator|&
literal|1
condition|)
block|{
if|if
condition|(
name|xthird
operator|&
literal|1
condition|)
operator|*
name|dx
operator|=
literal|0
expr_stmt|;
else|else
operator|*
name|dy
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
end_block

begin_expr_stmt
name|FillinSize
argument_list|(
name|hsize
argument_list|,
name|vsize
argument_list|)
specifier|register
name|int
name|hsize
operator|,
name|vsize
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|static
name|char
name|sizeText
index|[
literal|7
index|]
init|=
block|{
literal|'0'
block|,
literal|'0'
block|,
literal|'0'
block|,
literal|'x'
block|,
literal|'0'
block|,
literal|'0'
block|,
literal|'0'
block|}
decl_stmt|;
name|sizeText
index|[
literal|0
index|]
operator|=
name|vsize
operator|/
literal|100
operator|+
literal|'0'
expr_stmt|;
name|sizeText
index|[
literal|1
index|]
operator|=
operator|(
name|vsize
operator|/
literal|10
operator|)
operator|%
literal|10
operator|+
literal|'0'
expr_stmt|;
name|sizeText
index|[
literal|2
index|]
operator|=
name|vsize
operator|%
literal|10
operator|+
literal|'0'
expr_stmt|;
name|sizeText
index|[
literal|4
index|]
operator|=
name|hsize
operator|/
literal|100
operator|+
literal|'0'
expr_stmt|;
name|sizeText
index|[
literal|5
index|]
operator|=
operator|(
name|hsize
operator|/
literal|10
operator|)
operator|%
literal|10
operator|+
literal|'0'
expr_stmt|;
name|sizeText
index|[
literal|6
index|]
operator|=
name|hsize
operator|%
literal|10
operator|+
literal|'0'
expr_stmt|;
if|if
condition|(
name|variableWidth
condition|)
name|XClear
argument_list|(
name|sizeWin
argument_list|)
expr_stmt|;
name|XText
argument_list|(
name|sizeWin
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|sizeText
argument_list|,
sizeof|sizeof
argument_list|(
name|sizeText
argument_list|)
argument_list|,
name|sizefont
argument_list|,
name|bgColor
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|CreateSize
argument_list|(
argument|dx
argument_list|,
argument|dy
argument_list|,
argument|fixedx
argument_list|,
argument|fixedy
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|fixedx
decl_stmt|,
name|fixedy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|px
decl_stmt|,
name|py
decl_stmt|;
comment|/* Size x, y */
comment|/* If a corner is being moved, put the size window in the opposite 	   corner.  If an edge, put in middle of opposite edge. */
if|if
condition|(
name|dx
operator|>
literal|0
condition|)
name|px
operator|=
name|fixedx
operator|+
name|winfo
operator|->
name|bdrwidth
expr_stmt|;
elseif|else
if|if
condition|(
name|dx
operator|<
literal|0
condition|)
name|px
operator|=
name|fixedx
operator|-
name|sizeWidth
operator|-
name|winfo
operator|->
name|bdrwidth
operator|+
literal|1
expr_stmt|;
else|else
name|px
operator|=
name|winfo
operator|->
name|x
operator|+
name|winfo
operator|->
name|bdrwidth
operator|+
operator|(
name|winfo
operator|->
name|width
operator|-
name|sizeWidth
operator|)
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|dy
operator|>
literal|0
condition|)
name|py
operator|=
name|fixedy
operator|+
name|winfo
operator|->
name|bdrwidth
expr_stmt|;
elseif|else
if|if
condition|(
name|dy
operator|<
literal|0
condition|)
name|py
operator|=
name|fixedy
operator|-
name|sizeHeight
operator|-
name|winfo
operator|->
name|bdrwidth
operator|+
literal|1
expr_stmt|;
else|else
name|py
operator|=
name|winfo
operator|->
name|y
operator|+
name|winfo
operator|->
name|bdrwidth
operator|+
operator|(
name|winfo
operator|->
name|height
operator|-
name|sizeHeight
operator|)
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
block|{
name|sizeX
operator|=
name|px
expr_stmt|;
name|sizeY
operator|=
name|py
expr_stmt|;
name|behindSize
operator|=
name|XPixmapSave
argument_list|(
name|RootWindow
argument_list|,
name|px
argument_list|,
name|py
argument_list|,
name|sizeWidth
argument_list|,
name|sizeHeight
argument_list|)
expr_stmt|;
comment|/* Ok to return 0; this means it wasn't on the screen */
block|}
name|XMoveWindow
argument_list|(
name|sizeWin
argument_list|,
name|px
argument_list|,
name|py
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|sizeWin
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|DestroySize
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|behindSize
operator|!=
literal|0
condition|)
block|{
name|XUnmapTransparent
argument_list|(
name|sizeWin
argument_list|)
expr_stmt|;
name|XPixmapPut
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|sizeX
argument_list|,
name|sizeY
argument_list|,
name|sizeWidth
argument_list|,
name|sizeHeight
argument_list|,
name|behindSize
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|behindSize
argument_list|)
expr_stmt|;
name|behindSize
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|XUnmapWindow
argument_list|(
name|sizeWin
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|int
name|CalculateChange
parameter_list|(
name|direction
parameter_list|,
name|new
parameter_list|,
name|orig
parameter_list|,
name|inc
parameter_list|,
name|limit
parameter_list|,
name|origedge
parameter_list|,
name|oldedge
parameter_list|)
name|int
name|direction
decl_stmt|,
name|new
decl_stmt|,
name|orig
decl_stmt|,
name|inc
decl_stmt|,
name|limit
decl_stmt|,
name|origedge
decl_stmt|,
name|oldedge
decl_stmt|;
block|{
specifier|register
name|int
name|d
decl_stmt|,
name|newedge
decl_stmt|;
if|if
condition|(
name|direction
condition|)
block|{
comment|/* If we're changing this way */
comment|/* Calculate the change in cursor position in inc units */
name|d
operator|=
name|abs
argument_list|(
name|new
operator|-
name|orig
argument_list|)
operator|+
operator|(
name|inc
operator|>>
literal|1
operator|)
expr_stmt|;
empty_stmt|;
name|d
operator|=
operator|(
name|d
operator|/
name|inc
operator|)
operator|*
name|inc
expr_stmt|;
comment|/* Adjust the new position and check against the limit */
if|if
condition|(
name|new
operator|<
name|orig
condition|)
block|{
name|newedge
operator|=
name|origedge
operator|-
name|d
expr_stmt|;
if|if
condition|(
name|direction
operator|>
literal|0
operator|&&
name|newedge
operator|<
name|limit
condition|)
name|newedge
operator|=
name|limit
expr_stmt|;
block|}
else|else
block|{
name|newedge
operator|=
name|origedge
operator|+
name|d
expr_stmt|;
if|if
condition|(
name|direction
operator|<
literal|0
operator|&&
name|newedge
operator|>
name|limit
condition|)
name|newedge
operator|=
name|limit
expr_stmt|;
block|}
block|}
else|else
name|newedge
operator|=
name|oldedge
expr_stmt|;
return|return
operator|(
name|newedge
operator|)
return|;
block|}
end_function

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Iconify
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|BEvent
name|newbutton
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|char
modifier|*
name|iconName
decl_stmt|;
name|WindowInfo
name|iconInfo
decl_stmt|;
name|Window
name|icon
init|=
literal|0
decl_stmt|;
struct|struct
name|_xy
block|{
name|short
name|x
decl_stmt|,
name|y
block|}
modifier|*
name|xy
struct|;
comment|/* To turn locators into xy pairs */
name|int
name|downx
decl_stmt|,
name|downy
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
comment|/* First change the cursor into the icon cursor */
name|status
operator|=
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|iconCursor
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't grab mouse in Iconify"
argument_list|)
expr_stmt|;
comment|/* Then wait for the upbutton; if it doesn't occur abort */
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
return|return;
name|x
operator|=
name|newbutton
operator|.
name|x
expr_stmt|;
name|y
operator|=
name|newbutton
operator|.
name|y
expr_stmt|;
comment|/* See if it already has an associated icon window; 	   if not, figure out the size */
if|if
condition|(
name|winfo
operator|->
name|assoc_wind
operator|==
literal|0
condition|)
block|{
name|height
operator|=
name|iconHeight
expr_stmt|;
comment|/* Now get the name of the window */
name|status
operator|=
name|XFetchName
argument_list|(
name|w
argument_list|,
operator|&
name|iconName
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't fetch name in Iconify"
argument_list|)
expr_stmt|;
name|width
operator|=
name|XQueryWidth
argument_list|(
name|iconName
argument_list|,
name|iconfont
argument_list|)
expr_stmt|;
if|if
condition|(
name|width
operator|==
literal|0
condition|)
name|width
operator|=
name|height
expr_stmt|;
else|else
name|width
operator|+=
literal|8
expr_stmt|;
block|}
else|else
block|{
name|icon
operator|=
name|winfo
operator|->
name|assoc_wind
expr_stmt|;
name|QueryWindow
argument_list|(
name|icon
argument_list|,
operator|&
name|iconInfo
argument_list|)
expr_stmt|;
name|height
operator|=
name|iconInfo
operator|.
name|height
expr_stmt|;
name|width
operator|=
name|iconInfo
operator|.
name|width
expr_stmt|;
name|xy
operator|=
operator|(
expr|struct
name|_xy
operator|*
operator|)
operator|&
name|loc
expr_stmt|;
name|downx
operator|=
name|xy
operator|->
name|x
expr_stmt|;
name|downy
operator|=
name|xy
operator|->
name|y
expr_stmt|;
block|}
comment|/* Center the icon on the new cursor position */
name|x
operator|-=
name|width
operator|>>
literal|1
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
name|x
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|x
operator|+
name|width
operator|+
literal|2
operator|>
name|screen_width
condition|)
name|x
operator|=
name|screen_width
operator|-
name|width
operator|-
literal|2
expr_stmt|;
name|y
operator|-=
name|height
operator|>>
literal|1
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|y
operator|<
literal|0
condition|)
name|y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|y
operator|+
name|height
operator|+
literal|2
operator|>
name|screen_height
condition|)
name|y
operator|=
name|screen_height
operator|-
name|height
operator|-
literal|2
expr_stmt|;
comment|/* Open the icon, give it a text cursor, choose key events, and 	   map it */
if|if
condition|(
name|icon
operator|==
literal|0
condition|)
block|{
name|icon
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
literal|1
argument_list|,
name|fgPixmap
argument_list|,
name|gray
argument_list|)
expr_stmt|;
if|if
condition|(
name|icon
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't create icon in Iconify"
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|icon
argument_list|,
name|KeyPressed
operator||
name|ExposeWindow
operator||
name|UnmapWindow
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|icon
argument_list|,
name|textCursor
argument_list|)
expr_stmt|;
name|XSetIconWindow
argument_list|(
name|w
argument_list|,
name|icon
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|xy
operator|=
operator|(
expr|struct
name|_xy
operator|*
operator|)
operator|&
operator|(
name|newbutton
operator|.
name|location
operator|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|xy
operator|->
name|x
operator|-
name|downx
argument_list|)
operator|>
name|iconifyDelta
operator|||
name|abs
argument_list|(
name|xy
operator|->
name|y
operator|-
name|downy
argument_list|)
operator|>
name|iconifyDelta
condition|)
block|{
name|XMoveWindow
argument_list|(
name|icon
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XMapWindow
argument_list|(
name|icon
argument_list|)
expr_stmt|;
name|XUnmapWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
comment|/* If the iconified window was the focus, change to the background */
if|if
condition|(
name|focus
operator|==
name|w
condition|)
name|FocusOn
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Deiconify
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|neww
decl_stmt|;
if|if
condition|(
name|w
operator|==
name|RootWindow
condition|)
return|return;
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
return|return;
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|neww
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|neww
operator|!=
name|w
condition|)
return|return;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XUnmapWindow
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|winfo
operator|->
name|assoc_wind
argument_list|)
expr_stmt|;
comment|/* If icon was the focus, change to the window itself */
if|if
condition|(
name|focus
operator|==
name|w
condition|)
name|FocusOn
argument_list|(
name|winfo
operator|->
name|assoc_wind
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Select
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|BEvent
name|newbutton
decl_stmt|;
name|Window
name|neww
decl_stmt|;
name|GetButton
argument_list|(
operator|&
name|newbutton
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|MatchUp
argument_list|(
name|newbutton
argument_list|,
name|which
argument_list|)
condition|)
return|return;
name|InterpretLocatorW
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|neww
argument_list|,
name|newbutton
operator|.
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|neww
operator|==
literal|0
condition|)
name|neww
operator|=
name|RootWindow
expr_stmt|;
if|if
condition|(
name|neww
operator|!=
name|w
condition|)
return|return;
comment|/* See if the current focus is an icon.  If not, set oldfocus 	   so we can go back to it if we want to */
if|if
condition|(
name|focusInfo
operator|.
name|type
operator|!=
name|IsIcon
condition|)
name|oldfocus
operator|=
name|focus
expr_stmt|;
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|FocusOn
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
comment|/* Now frame the focus window */
name|XRaiseWindow
argument_list|(
name|focus
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|FocusOn
argument_list|(
argument|w
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|focus
operator|=
name|w
expr_stmt|;
name|QueryWindow
argument_list|(
name|focus
argument_list|,
operator|&
name|focusInfo
argument_list|)
expr_stmt|;
name|XFocusKeyboard
argument_list|(
name|focus
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|FrameFocus
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|frameWidth
operator|==
literal|0
condition|)
return|return;
comment|/* Nothing to do */
comment|/* Remove the frame from around any old focus window first */
name|XClear
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
if|if
condition|(
name|focus
operator|==
name|RootWindow
condition|)
return|return;
name|QueryWindow
argument_list|(
name|focus
argument_list|,
operator|&
name|focusInfo
argument_list|)
expr_stmt|;
comment|/* Refresh it */
comment|/* Undo the default clipmode for the base window */
name|XClipClipped
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
name|XPixSet
argument_list|(
name|RootWindow
argument_list|,
name|focusInfo
operator|.
name|x
operator|-
name|frameWidth
argument_list|,
name|focusInfo
operator|.
name|y
operator|-
name|frameWidth
argument_list|,
name|focusInfo
operator|.
name|width
operator|+
literal|2
operator|*
operator|(
name|focusInfo
operator|.
name|bdrwidth
operator|+
name|frameWidth
operator|)
argument_list|,
name|focusInfo
operator|.
name|height
operator|+
literal|2
operator|*
operator|(
name|focusInfo
operator|.
name|bdrwidth
operator|+
name|frameWidth
operator|)
argument_list|,
name|fgColor
argument_list|)
expr_stmt|;
name|XClipDrawThrough
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
comment|/* Put it back */
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|Circulate
argument_list|(
argument|which
argument_list|,
argument|loc
argument_list|,
argument|w
argument_list|,
argument|winfo
argument_list|)
end_macro

begin_decl_stmt
name|int
name|which
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|winfo
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|popup
condition|)
name|UnmapPopup
argument_list|()
expr_stmt|;
name|XCircWindowUp
argument_list|(
name|RootWindow
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|EditIconName
argument_list|(
argument|be
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|XKeyPressedEvent
modifier|*
name|be
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Window
name|w
init|=
name|be
operator|->
name|window
decl_stmt|;
name|short
name|charcode
init|=
name|be
operator|->
name|detail
decl_stmt|;
specifier|register
name|int
name|nameLen
decl_stmt|,
name|c
decl_stmt|;
name|int
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|size
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
specifier|register
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|string
operator|=
name|XLookupMapping
argument_list|(
name|be
argument_list|,
operator|&
name|nbytes
argument_list|)
expr_stmt|;
name|nameLen
operator|=
operator|(
name|name
operator|==
name|NULL
operator|)
condition|?
literal|0
else|:
name|strlen
argument_list|(
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nbytes
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
name|string
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\177'
condition|)
block|{
comment|/* a 'delete' */
if|if
condition|(
name|nameLen
operator|>
literal|0
condition|)
name|name
index|[
operator|--
name|nameLen
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* control-u if you can't read ascii */
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\025'
condition|)
block|{
if|if
condition|(
name|nameLen
operator|>
literal|0
condition|)
block|{
operator|*
name|name
operator|=
literal|'\0'
expr_stmt|;
name|nameLen
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
block|{
comment|/* return means reset focus */
name|FocusOn
argument_list|(
name|oldfocus
condition|?
name|oldfocus
else|:
name|RootWindow
argument_list|)
expr_stmt|;
name|oldfocus
operator|=
literal|0
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|<=
literal|0
condition|)
empty_stmt|;
comment|/* unknown character, ignore it */
comment|/* Else append the letter to the name */
else|else
block|{
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|nameLen
operator|+
literal|2
argument_list|)
expr_stmt|;
else|else
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|realloc
argument_list|(
name|name
argument_list|,
name|nameLen
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
block|{
name|errno
operator|=
name|ENOMEM
expr_stmt|;
name|perror
argument_list|(
literal|"newwm:"
argument_list|)
expr_stmt|;
block|}
name|name
index|[
name|nameLen
index|]
operator|=
name|c
expr_stmt|;
name|name
index|[
operator|++
name|nameLen
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
name|QueryWindow
argument_list|(
name|w
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
name|x0
operator|=
name|winfo
operator|.
name|x
expr_stmt|;
name|y0
operator|=
name|winfo
operator|.
name|y
expr_stmt|;
name|size
operator|=
name|XQueryWidth
argument_list|(
name|name
argument_list|,
name|iconfont
argument_list|)
expr_stmt|;
comment|/* Make sure icon is entirely on screen */
if|if
condition|(
name|x0
operator|<
literal|0
condition|)
name|x0
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|x0
operator|+
name|size
operator|+
literal|10
operator|>
name|screen_width
condition|)
block|{
name|x0
operator|=
name|screen_width
operator|-
name|size
operator|-
literal|10
expr_stmt|;
block|}
if|if
condition|(
name|y0
operator|<
literal|0
condition|)
name|y0
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|y0
operator|+
name|iconHeight
operator|+
literal|2
operator|>
name|screen_height
condition|)
block|{
name|y0
operator|=
name|screen_height
operator|-
name|iconHeight
operator|-
literal|2
expr_stmt|;
block|}
name|XConfigureWindow
argument_list|(
name|w
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|size
operator|+
literal|8
argument_list|,
name|iconHeight
argument_list|)
expr_stmt|;
name|XWarpMouse
argument_list|(
name|w
argument_list|,
operator|(
name|size
operator|+
literal|8
operator|)
operator|>>
literal|1
argument_list|,
name|iconHeight
operator|>>
literal|1
argument_list|)
expr_stmt|;
name|FrameFocus
argument_list|()
expr_stmt|;
comment|/* Redraw frame */
name|XStoreName
argument_list|(
name|winfo
operator|.
name|assoc_wind
argument_list|,
name|name
argument_list|)
expr_stmt|;
comment|/* Don't redraw the text yet; the expose event will cause that */
block|}
end_block

begin_macro
name|StoreBox
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|w
argument_list|,
argument|h
argument_list|)
end_macro

begin_decl_stmt
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|box
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|box
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|y
expr_stmt|;
name|box
index|[
literal|1
index|]
operator|.
name|x
operator|=
name|w
operator|+
literal|2
expr_stmt|;
name|box
index|[
literal|1
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|2
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|2
index|]
operator|.
name|y
operator|=
name|h
operator|+
literal|2
expr_stmt|;
name|box
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|-
operator|(
name|w
operator|+
literal|2
operator|)
expr_stmt|;
name|box
index|[
literal|3
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|4
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|-
operator|(
name|h
operator|+
literal|1
operator|)
expr_stmt|;
name|box
index|[
literal|5
index|]
operator|.
name|x
operator|=
name|w
operator|+
literal|1
expr_stmt|;
name|box
index|[
literal|5
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|6
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|6
index|]
operator|.
name|y
operator|=
name|h
expr_stmt|;
name|box
index|[
literal|7
index|]
operator|.
name|x
operator|=
operator|-
name|w
expr_stmt|;
name|box
index|[
literal|7
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|8
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|8
index|]
operator|.
name|y
operator|=
operator|-
operator|(
name|h
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|freeze
condition|)
block|{
name|box
index|[
literal|9
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|9
index|]
operator|.
name|y
operator|=
name|h
operator|-
literal|1
expr_stmt|;
name|box
index|[
literal|10
index|]
operator|.
name|x
operator|=
name|w
expr_stmt|;
name|box
index|[
literal|10
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|11
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|11
index|]
operator|.
name|y
operator|=
operator|-
name|h
expr_stmt|;
name|box
index|[
literal|12
index|]
operator|.
name|x
operator|=
operator|-
operator|(
name|w
operator|+
literal|1
operator|)
expr_stmt|;
name|box
index|[
literal|12
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|13
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|13
index|]
operator|.
name|y
operator|=
name|h
operator|+
literal|1
expr_stmt|;
name|box
index|[
literal|14
index|]
operator|.
name|x
operator|=
name|w
operator|+
literal|2
expr_stmt|;
name|box
index|[
literal|14
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|15
index|]
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|box
index|[
literal|15
index|]
operator|.
name|y
operator|=
operator|-
operator|(
name|h
operator|+
literal|2
operator|)
expr_stmt|;
name|box
index|[
literal|16
index|]
operator|.
name|x
operator|=
operator|-
operator|(
name|w
operator|+
literal|2
operator|)
expr_stmt|;
name|box
index|[
literal|16
index|]
operator|.
name|y
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|DrawBox
argument_list|()
end_macro

begin_block
block|{
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|vcount
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|InterpretLocator
argument_list|(
argument|w
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|subw
argument_list|,
argument|loc
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
modifier|*
name|subw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|status
operator|=
name|XInterpretLocator
argument_list|(
name|w
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|subw
argument_list|,
name|loc
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't interpret in InterpretLocator"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|InterpretLocatorW
argument_list|(
argument|w
argument_list|,
argument|subw
argument_list|,
argument|loc
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
modifier|*
name|subw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|status
operator|=
name|XInterpretLocator
argument_list|(
name|w
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|subw
argument_list|,
name|loc
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't interpret in InterpretLocator"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|InterpretLocatorXY
argument_list|(
argument|w
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|loc
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Locator
name|loc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Window
name|subw
decl_stmt|;
name|status
operator|=
name|XInterpretLocator
argument_list|(
name|w
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|subw
argument_list|,
name|loc
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't interpret in InterpretLocator"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|QueryMouse
argument_list|(
argument|w
argument_list|,
argument|x
argument_list|,
argument|y
argument_list|,
argument|subw
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
modifier|*
name|subw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|x
decl_stmt|,
modifier|*
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|status
operator|=
name|XQueryMouse
argument_list|(
name|w
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|subw
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't query mouse in QueryMouse"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|QueryWindow
argument_list|(
argument|w
argument_list|,
argument|info
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
modifier|*
name|info
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|status
operator|=
name|XQueryWindow
argument_list|(
name|w
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
name|Error
argument_list|(
literal|"Couldn't query windown in QueryWindow"
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

