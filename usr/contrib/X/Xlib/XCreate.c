begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* $Header: XCreate.c,v 10.8 86/02/01 15:30:58 tony Rel $ */
end_comment

begin_comment
comment|/* Copyright 1985, Massachusetts Institute of Technology */
end_comment

begin_comment
comment|/* stolen from CLU routine x_cons, redone by J. Gettys */
end_comment

begin_include
include|#
directive|include
file|"XlibInternal.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|( (a)> (b) ? (a) : (b) )
end_define

begin_define
define|#
directive|define
name|min
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|( (a)> (b) ? (b) : (a) )
end_define

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|a
parameter_list|)
value|( (a)> 0 ? (a) : -(a))
end_define

begin_define
define|#
directive|define
name|DCOUNT
value|2
end_define

begin_define
define|#
directive|define
name|VCOUNT
value|1 + (4  * 2 * DCOUNT)
end_define

begin_define
define|#
directive|define
name|FCOUNT
value|1 + 4
end_define

begin_include
include|#
directive|include
file|"../cursors/cross.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/cross_mask.cursor"
end_include

begin_function
name|Window
name|XCreate
parameter_list|(
name|prompt
parameter_list|,
name|name
parameter_list|,
name|geometry
parameter_list|,
name|def
parameter_list|,
name|frame
parameter_list|,
name|minwidth
parameter_list|,
name|minheight
parameter_list|)
name|char
modifier|*
name|prompt
decl_stmt|,
decl|*
name|name
decl_stmt|;
end_function

begin_decl_stmt
specifier|register
name|OpaqueFrame
modifier|*
name|frame
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|minwidth
decl_stmt|,
name|minheight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|geometry
decl_stmt|,
modifier|*
name|def
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|fn
init|=
literal|"8x13"
decl_stmt|;
comment|/* default default font */
name|FontInfo
modifier|*
name|pfninfo
decl_stmt|;
comment|/* font info on prompt */
name|Window
name|pop
decl_stmt|;
comment|/* pop up window */
name|char
modifier|*
name|opt
decl_stmt|;
name|int
name|pfore
decl_stmt|,
name|pback
decl_stmt|;
comment|/* prompt window colors */
name|int
name|bpix
decl_stmt|;
comment|/* border color */
name|int
name|mfore
decl_stmt|,
name|mback
decl_stmt|;
comment|/* mouse colors */
name|int
name|pbw
init|=
literal|1
decl_stmt|;
comment|/* prompt window border width */
name|int
name|ibw
init|=
literal|1
decl_stmt|;
comment|/* internal border width */
name|int
name|freeze
init|=
literal|0
decl_stmt|;
comment|/* should we freeze the server */
name|Color
name|cdef
decl_stmt|;
comment|/* color structure for lookup */
name|Cursor
name|cr
decl_stmt|;
comment|/* cursor for the prompt window */
name|int
name|events
decl_stmt|;
comment|/* event mask */
name|int
name|popw
decl_stmt|,
name|poph
decl_stmt|;
comment|/* prompt window height and width */
name|int
name|count
init|=
name|VCOUNT
decl_stmt|;
comment|/* vertex count */
name|Pixmap
name|save
init|=
literal|0
decl_stmt|;
comment|/* saved pixmap */
name|Pixmap
name|backmap
decl_stmt|,
name|bdrmap
decl_stmt|;
comment|/* background and border pixmaps */
name|Vertex
name|box
index|[
name|VCOUNT
index|]
decl_stmt|;
comment|/* vertex list for box */
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|;
comment|/* location of mouse */
name|int
name|x2
decl_stmt|,
name|y2
decl_stmt|;
comment|/* other corner of box */
name|Window
name|subw
decl_stmt|;
comment|/* subwindow it is in */
name|int
name|mindim
decl_stmt|;
comment|/* minimum dimension */
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
comment|/* width and height of box */
name|int
name|left
decl_stmt|,
name|stop
decl_stmt|;
name|int
name|mouse
decl_stmt|;
name|int
name|force
decl_stmt|;
comment|/* force default window to track */
name|int
name|xa
decl_stmt|,
name|ya
decl_stmt|,
name|xb
decl_stmt|,
name|yb
decl_stmt|;
name|int
name|doit
decl_stmt|;
name|XButtonEvent
name|event
decl_stmt|;
comment|/* someplace to put the event */
specifier|register
name|int
name|i
decl_stmt|;
comment|/* ye olde indexe variabel */
name|int
name|fx
decl_stmt|,
name|fy
decl_stmt|,
name|fw
decl_stmt|,
name|fh
decl_stmt|;
comment|/* frame from parse... */
name|int
name|pr
decl_stmt|;
comment|/* parse geometry result */
name|pr
operator|=
name|XGeometry
argument_list|(
name|geometry
argument_list|,
name|def
argument_list|,
name|frame
operator|->
name|bdrwidth
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|fx
argument_list|,
operator|&
name|fy
argument_list|,
operator|&
name|fw
argument_list|,
operator|&
name|fh
argument_list|)
expr_stmt|;
comment|/* 	 * none of this nonsense would be necessary if I hadn't blown 	 * the frame structure definition. 	 */
name|frame
operator|->
name|x
operator|=
name|fx
expr_stmt|;
name|frame
operator|->
name|y
operator|=
name|fy
expr_stmt|;
name|frame
operator|->
name|width
operator|=
name|fw
expr_stmt|;
name|frame
operator|->
name|height
operator|=
name|fh
expr_stmt|;
if|if
condition|(
name|geometry
operator|!=
name|NULL
condition|)
block|{
comment|/* 		 * if x or y offsets are specified, then we should autoplace 		 */
if|if
condition|(
operator|(
name|pr
operator|&
name|XValue
operator|)
operator|||
operator|(
name|pr
operator|&
name|YValue
operator|)
condition|)
block|{
if|if
condition|(
name|frame
operator|->
name|width
operator|<
name|minwidth
condition|)
name|frame
operator|->
name|width
operator|=
name|minwidth
expr_stmt|;
if|if
condition|(
name|frame
operator|->
name|height
operator|<
name|minheight
condition|)
name|frame
operator|->
name|height
operator|=
name|minheight
expr_stmt|;
goto|goto
name|makeit
goto|;
block|}
block|}
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.BodyFont"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|fn
operator|=
name|opt
expr_stmt|;
if|if
condition|(
operator|(
name|pfninfo
operator|=
name|XOpenFont
argument_list|(
name|fn
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't open font %s!\n"
argument_list|,
name|fn
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|pfore
operator|=
name|mback
operator|=
name|WhitePixel
expr_stmt|;
name|pback
operator|=
name|bpix
operator|=
name|mfore
operator|=
name|BlackPixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.ReverseVideo"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|strcmp
argument_list|(
name|opt
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pfore
operator|=
name|BlackPixel
expr_stmt|;
name|pback
operator|=
name|WhitePixel
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.BorderWidth"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|pbw
operator|=
name|atoi
argument_list|(
name|opt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.InternalBorder"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|ibw
operator|=
name|atoi
argument_list|(
name|opt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.Freeze"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|strcmp
argument_list|(
name|opt
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|freeze
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|DisplayPlanes
argument_list|()
operator|>
literal|2
condition|)
block|{
comment|/* on color display, do color stuff */
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.Foreground"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|pfore
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.Background"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|pback
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.Border"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|bpix
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.Mouse"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|mfore
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|name
argument_list|,
literal|"MakeWindow.MouseMask"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|mback
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
name|cr
operator|=
name|XCreateCursor
argument_list|(
name|cross_width
argument_list|,
name|cross_height
argument_list|,
name|cross_bits
argument_list|,
name|cross_mask_bits
argument_list|,
name|cross_x_hot
argument_list|,
name|cross_y_hot
argument_list|,
name|mfore
argument_list|,
name|mback
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|events
operator|=
name|ButtonPressed
operator||
name|ButtonReleased
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
name|events
operator||=
name|MouseMoved
expr_stmt|;
comment|/*  	 * go get the mouse as soon as you can  	 */
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|cr
argument_list|,
name|events
argument_list|)
operator|!=
literal|0
condition|)
break|break;
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|popw
operator|=
name|XStringWidth
argument_list|(
name|prompt
argument_list|,
name|pfninfo
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|+
literal|2
operator|*
name|ibw
expr_stmt|;
name|poph
operator|=
name|pfninfo
operator|->
name|height
operator|+
literal|2
operator|*
name|ibw
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
block|{
name|XGrabServer
argument_list|()
expr_stmt|;
name|count
operator|=
name|FCOUNT
expr_stmt|;
name|save
operator|=
name|XPixmapSave
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|poph
operator|+
literal|2
operator|*
name|pbw
argument_list|)
expr_stmt|;
block|}
name|backmap
operator|=
name|XMakeTile
argument_list|(
name|pback
argument_list|)
expr_stmt|;
name|bdrmap
operator|=
name|XMakeTile
argument_list|(
name|bpix
argument_list|)
expr_stmt|;
name|pop
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
argument_list|,
name|poph
argument_list|,
name|pbw
argument_list|,
name|bdrmap
argument_list|,
name|backmap
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|pop
argument_list|)
expr_stmt|;
name|XText
argument_list|(
name|pop
argument_list|,
name|ibw
argument_list|,
name|ibw
argument_list|,
name|prompt
argument_list|,
name|strlen
argument_list|(
name|prompt
argument_list|)
argument_list|,
name|pfninfo
operator|->
name|id
argument_list|,
name|pfore
argument_list|,
name|pback
argument_list|)
expr_stmt|;
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
name|mindim
operator|=
literal|2
operator|*
name|frame
operator|->
name|bdrwidth
operator|-
literal|1
expr_stmt|;
name|minwidth
operator|=
name|minwidth
operator|+
name|mindim
expr_stmt|;
name|minheight
operator|=
name|minheight
operator|+
name|mindim
expr_stmt|;
name|x2
operator|=
name|x1
operator|+
name|minwidth
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|minheight
expr_stmt|;
name|width
operator|=
name|minwidth
expr_stmt|;
name|height
operator|=
name|minheight
expr_stmt|;
name|left
operator|=
name|TRUE
expr_stmt|;
name|force
operator|=
name|FALSE
expr_stmt|;
name|stop
operator|=
name|FALSE
expr_stmt|;
name|mouse
operator|=
name|TRUE
expr_stmt|;
name|xa
operator|=
name|ya
operator|=
name|xb
operator|=
name|yb
operator|=
operator|-
literal|1
expr_stmt|;
name|doit
operator|=
name|TRUE
expr_stmt|;
while|while
condition|(
name|stop
operator|==
name|FALSE
condition|)
block|{
if|if
condition|(
operator|(
name|xb
operator|!=
name|max
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
operator|)
operator|||
operator|(
name|yb
operator|!=
name|max
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
operator|)
operator|||
operator|(
name|xa
operator|!=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
operator|)
operator|||
operator|(
name|ya
operator|!=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|freeze
operator|&&
operator|(
name|doit
operator|==
name|FALSE
operator|)
condition|)
block|{
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|xa
operator|=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|ya
operator|=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|xb
operator|=
name|max
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|yb
operator|=
name|max
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|+=
literal|4
control|)
block|{
name|box
index|[
name|i
index|]
operator|.
name|x
operator|=
name|xa
expr_stmt|;
name|box
index|[
name|i
index|]
operator|.
name|y
operator|=
name|ya
expr_stmt|;
name|box
index|[
name|i
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
operator|+
literal|1
operator|==
name|count
condition|)
break|break;
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|x
operator|=
name|xb
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|y
operator|=
name|ya
operator|,
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|x
operator|=
name|xb
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|y
operator|=
name|yb
operator|,
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|x
operator|=
name|xa
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|y
operator|=
name|yb
operator|,
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
block|}
name|doit
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|doit
condition|)
block|{
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|doit
operator|=
operator|!
name|freeze
expr_stmt|;
block|}
if|if
condition|(
name|freeze
operator|||
name|XPending
argument_list|()
condition|)
block|{
specifier|register
name|int
name|button
decl_stmt|;
name|XNextEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
name|button
operator|=
name|event
operator|.
name|detail
operator|&
name|ValueMask
expr_stmt|;
if|if
condition|(
name|mouse
condition|)
block|{
name|x2
operator|=
name|event
operator|.
name|x
expr_stmt|;
name|y2
operator|=
name|event
operator|.
name|y
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|left
operator|==
name|TRUE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonPressed
operator|)
operator|&&
operator|(
name|button
operator|==
name|MiddleButton
operator|)
condition|)
block|{
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
name|left
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|left
operator|==
name|FALSE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonReleased
operator|)
operator|&&
operator|(
name|button
operator|==
name|MiddleButton
operator|)
condition|)
name|stop
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|left
operator|==
name|TRUE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonPressed
operator|)
operator|&&
operator|(
name|button
operator|==
name|LeftButton
operator|)
condition|)
block|{
name|x1
operator|=
name|frame
operator|->
name|x
expr_stmt|;
name|y1
operator|=
name|frame
operator|->
name|y
expr_stmt|;
name|x2
operator|=
name|x1
operator|+
name|frame
operator|->
name|width
operator|+
name|mindim
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|frame
operator|->
name|height
operator|+
name|mindim
expr_stmt|;
name|mouse
operator|=
name|FALSE
expr_stmt|;
name|left
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|left
operator|==
name|FALSE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonReleased
operator|)
operator|&&
operator|(
name|button
operator|==
name|LeftButton
operator|)
condition|)
block|{
name|x1
operator|=
name|frame
operator|->
name|x
expr_stmt|;
name|y1
operator|=
name|frame
operator|->
name|y
expr_stmt|;
name|x2
operator|=
name|x1
operator|+
name|frame
operator|->
name|width
operator|+
name|mindim
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|frame
operator|->
name|height
operator|+
name|mindim
expr_stmt|;
name|stop
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|left
operator|==
name|TRUE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonPressed
operator|)
operator|&&
operator|(
name|button
operator|==
name|RightButton
operator|)
condition|)
block|{
name|force
operator|=
name|TRUE
expr_stmt|;
name|left
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|left
operator|==
name|FALSE
operator|)
operator|&&
operator|(
name|event
operator|.
name|type
operator|==
name|ButtonReleased
operator|)
operator|&&
operator|(
name|button
operator|==
name|RightButton
operator|)
condition|)
block|{
name|stop
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mouse
condition|)
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mouse
condition|)
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
if|if
condition|(
name|force
condition|)
block|{
comment|/* we force the default box */
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
name|x2
operator|=
name|x1
operator|+
name|frame
operator|->
name|width
operator|+
name|mindim
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|frame
operator|->
name|height
operator|+
name|mindim
expr_stmt|;
block|}
if|if
condition|(
name|left
condition|)
block|{
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
block|}
name|width
operator|=
name|max
argument_list|(
name|abs
argument_list|(
name|x2
operator|-
name|x1
argument_list|)
argument_list|,
name|minwidth
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
name|x1
condition|)
name|x2
operator|=
name|x1
operator|-
name|width
expr_stmt|;
else|else
name|x2
operator|=
name|x1
operator|+
name|width
expr_stmt|;
name|height
operator|=
name|max
argument_list|(
name|abs
argument_list|(
name|y2
operator|-
name|y1
argument_list|)
argument_list|,
name|minheight
argument_list|)
expr_stmt|;
if|if
condition|(
name|y2
operator|<
name|y1
condition|)
name|y2
operator|=
name|y1
operator|-
name|height
expr_stmt|;
else|else
name|y2
operator|=
name|y1
operator|+
name|height
expr_stmt|;
block|}
if|if
condition|(
name|freeze
condition|)
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|XUngrabMouse
argument_list|()
expr_stmt|;
if|if
condition|(
name|save
operator|!=
literal|0
condition|)
block|{
name|XUnmapTransparent
argument_list|(
name|pop
argument_list|)
expr_stmt|;
name|XPixmapPut
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|poph
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|save
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|save
argument_list|)
expr_stmt|;
block|}
name|XDestroyWindow
argument_list|(
name|pop
argument_list|)
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
name|XUngrabServer
argument_list|()
expr_stmt|;
name|XCloseFont
argument_list|(
name|pfninfo
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|backmap
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|bdrmap
argument_list|)
expr_stmt|;
name|frame
operator|->
name|x
operator|=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|frame
operator|->
name|y
operator|=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|frame
operator|->
name|width
operator|=
name|width
operator|-
name|mindim
expr_stmt|;
name|frame
operator|->
name|height
operator|=
name|height
operator|-
name|mindim
expr_stmt|;
name|makeit
label|:
name|XCreateWindows
argument_list|(
name|RootWindow
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* store default name of the window and set the resize hint */
name|XStoreName
argument_list|(
name|frame
operator|->
name|self
argument_list|,
name|prompt
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|frame
operator|->
name|self
argument_list|,
name|minwidth
argument_list|,
name|minheight
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|XSync
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* get rid of any extraneous events */
return|return
operator|(
name|frame
operator|->
name|self
operator|)
return|;
block|}
end_block

end_unit

