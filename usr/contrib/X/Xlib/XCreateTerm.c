begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* $Header: XCreateTerm.c,v 10.10 86/02/01 15:31:14 tony Rel $ */
end_comment

begin_comment
comment|/* Copyright 1985, Massachusetts Institute of Technology */
end_comment

begin_comment
comment|/* stolen from CLU routine x_tcons, redone by J. Gettys */
end_comment

begin_include
include|#
directive|include
file|"XlibInternal.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_define
define|#
directive|define
name|TRUE
value|1
end_define

begin_define
define|#
directive|define
name|FALSE
value|0
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|( (a)> (b) ? (a) : (b) )
end_define

begin_define
define|#
directive|define
name|min
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|( (a)> (b) ? (b) : (a) )
end_define

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|a
parameter_list|)
value|( (a)> 0 ? (a) : -(a))
end_define

begin_define
define|#
directive|define
name|DCOUNT
value|2
end_define

begin_define
define|#
directive|define
name|VCOUNT
value|1 + (4  * 2 * DCOUNT)
end_define

begin_define
define|#
directive|define
name|FCOUNT
value|1 + 4
end_define

begin_include
include|#
directive|include
file|"../cursors/cross.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/cross_mask.cursor"
end_include

begin_function
name|Window
name|XCreateTerm
parameter_list|(
name|name
parameter_list|,
name|prog
parameter_list|,
name|geometry
parameter_list|,
name|def
parameter_list|,
name|frame
parameter_list|,
name|minwidth
parameter_list|,
name|minheight
parameter_list|,
name|xadder
parameter_list|,
name|yadder
parameter_list|,
name|cwidth
parameter_list|,
name|cheight
parameter_list|,
name|f
parameter_list|,
name|fwidth
parameter_list|,
name|fheight
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|,
decl|*
name|prog
decl_stmt|;
end_function

begin_comment
comment|/* prompt string and name of program */
end_comment

begin_decl_stmt
specifier|register
name|OpaqueFrame
modifier|*
name|frame
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* frame for resulting window 	   */
end_comment

begin_decl_stmt
name|int
name|minwidth
decl_stmt|,
name|minheight
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* this time in units of characters*/
end_comment

begin_decl_stmt
name|int
modifier|*
name|cwidth
decl_stmt|,
modifier|*
name|cheight
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* returns the size of the window  */
end_comment

begin_decl_stmt
name|FontInfo
modifier|*
name|f
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* major bodyfont of the window	   */
end_comment

begin_decl_stmt
name|int
name|fwidth
decl_stmt|,
name|fheight
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* width and height of increments  */
end_comment

begin_decl_stmt
name|int
name|xadder
decl_stmt|,
name|yadder
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* add is size of internal padding */
end_comment

begin_block
block|{
name|int
name|pr
decl_stmt|;
comment|/* parse geometry result	    */
name|int
name|defwidth
decl_stmt|,
name|defheight
decl_stmt|;
comment|/* frame from parse...		    */
name|int
name|defx
decl_stmt|,
name|defy
decl_stmt|;
name|FontInfo
modifier|*
name|pfont
decl_stmt|;
name|int
name|pfore
decl_stmt|,
name|pback
decl_stmt|;
comment|/* prompt foreground and background */
name|int
name|bpix
decl_stmt|;
name|int
name|mfore
decl_stmt|;
comment|/* mouse cursor colors		    */
name|int
name|mback
decl_stmt|;
comment|/* background color for mouse	    */
name|int
name|clip
init|=
literal|0
decl_stmt|;
comment|/* clip window to screen	    */
name|int
name|freeze
init|=
literal|0
decl_stmt|;
comment|/* freeze server		    */
name|Color
name|cdef
decl_stmt|;
comment|/* color structure		    */
name|int
name|events
decl_stmt|;
comment|/* what events we want.		    */
name|int
name|popw
decl_stmt|,
name|poph
decl_stmt|;
comment|/* width and height of prompt window*/
name|char
name|text
index|[
literal|64
index|]
decl_stmt|;
comment|/* text for prompt string	    */
name|int
name|zero
init|=
literal|'0'
decl_stmt|;
comment|/* zero offset for char conversion  */
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|;
comment|/* location of mouse 		*/
name|int
name|x2
decl_stmt|,
name|y2
decl_stmt|;
comment|/* other corner of box		*/
name|XButtonEvent
name|e
decl_stmt|;
comment|/* someplace to put the event	*/
name|Cursor
name|cr
decl_stmt|;
comment|/* cursor for rubber banding    */
name|Window
name|pop
decl_stmt|;
comment|/* pop up prompt window		*/
name|Pixmap
name|save
init|=
literal|0
decl_stmt|;
comment|/* saved pixmap 		*/
name|Pixmap
name|backmap
decl_stmt|,
name|bdrmap
decl_stmt|;
comment|/* background and border pixmaps*/
name|Vertex
name|box
index|[
name|VCOUNT
index|]
decl_stmt|;
comment|/* vertex list for box 		*/
name|Window
name|subw
decl_stmt|;
comment|/* window cursor was in (not used) */
specifier|register
name|int
name|i
decl_stmt|;
comment|/* ye olde indexe variabel 	*/
name|int
name|count
init|=
name|VCOUNT
decl_stmt|;
comment|/* vertex count 		*/
name|int
name|nz
decl_stmt|;
comment|/* count where zeros are 	*/
name|int
name|xadd
decl_stmt|,
name|yadd
decl_stmt|;
name|int
name|hsize
decl_stmt|,
name|vsize
decl_stmt|;
name|char
modifier|*
name|opt
decl_stmt|;
comment|/* option back from XGetdefault */
name|int
name|ibw
init|=
literal|0
decl_stmt|;
comment|/* internal border width 	*/
name|int
name|pbw
init|=
literal|0
decl_stmt|;
comment|/* prompt window border width 	*/
name|int
name|bwidth
init|=
name|frame
operator|->
name|bdrwidth
decl_stmt|;
comment|/* border width of final window */
name|int
name|xa
init|=
operator|-
literal|1
decl_stmt|,
name|ya
init|=
operator|-
literal|1
decl_stmt|,
name|xb
init|=
operator|-
literal|1
decl_stmt|,
name|yb
init|=
operator|-
literal|1
decl_stmt|;
name|int
name|chosen
init|=
operator|-
literal|1
decl_stmt|;
name|int
name|stop
init|=
name|FALSE
decl_stmt|;
name|int
name|changed
init|=
name|TRUE
decl_stmt|;
name|int
name|doit
init|=
name|TRUE
decl_stmt|;
name|int
name|xmindim
decl_stmt|,
name|ymindim
decl_stmt|;
name|int
name|d
decl_stmt|;
name|pr
operator|=
name|XGeometry
argument_list|(
name|geometry
argument_list|,
name|def
argument_list|,
name|bwidth
argument_list|,
name|fwidth
argument_list|,
name|fheight
argument_list|,
name|xadder
argument_list|,
name|yadder
argument_list|,
operator|&
name|defx
argument_list|,
operator|&
name|defy
argument_list|,
operator|&
name|defwidth
argument_list|,
operator|&
name|defheight
argument_list|)
expr_stmt|;
name|defwidth
operator|=
name|max
argument_list|(
name|defwidth
argument_list|,
name|minwidth
argument_list|)
expr_stmt|;
name|defheight
operator|=
name|max
argument_list|(
name|defheight
argument_list|,
name|minheight
argument_list|)
expr_stmt|;
comment|/* "do the right thing" if the user asked for placement */
if|if
condition|(
operator|(
name|pr
operator|&
name|XValue
operator|)
operator|||
operator|(
name|pr
operator|&
name|YValue
operator|)
condition|)
block|{
operator|*
name|cwidth
operator|=
name|defwidth
expr_stmt|;
operator|*
name|cheight
operator|=
name|defheight
expr_stmt|;
name|frame
operator|->
name|width
operator|=
name|defwidth
operator|*
name|fwidth
operator|+
name|xadder
expr_stmt|;
name|frame
operator|->
name|height
operator|=
name|defheight
operator|*
name|fheight
operator|+
name|yadder
expr_stmt|;
name|frame
operator|->
name|x
operator|=
name|defx
expr_stmt|;
name|frame
operator|->
name|y
operator|=
name|defy
expr_stmt|;
goto|goto
name|makeit
goto|;
block|}
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.BodyFont"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|pfont
operator|=
name|f
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pfont
operator|=
name|XOpenFont
argument_list|(
name|opt
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|pfont
operator|=
name|f
expr_stmt|;
name|pfore
operator|=
name|WhitePixel
expr_stmt|;
name|pback
operator|=
name|BlackPixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.ReverseVideo"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|strcmp
argument_list|(
name|opt
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|pfore
operator|=
name|BlackPixel
expr_stmt|;
name|pback
operator|=
name|WhitePixel
expr_stmt|;
block|}
name|bpix
operator|=
name|pback
expr_stmt|;
name|mfore
operator|=
name|pback
expr_stmt|;
name|mback
operator|=
name|pfore
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.BorderWidth"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|pbw
operator|=
name|atoi
argument_list|(
name|opt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.InternalBorder"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|ibw
operator|=
name|atoi
argument_list|(
name|opt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.Freeze"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|strcmp
argument_list|(
name|opt
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|freeze
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.ClipToScreen"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|strcmp
argument_list|(
name|opt
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|clip
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|DisplayPlanes
argument_list|()
operator|>
literal|2
condition|)
block|{
comment|/* on color display, do color stuff */
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.Foreground"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|pfore
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.Background"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|pback
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.Border"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|bpix
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.Mouse"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|mfore
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
if|if
condition|(
operator|(
name|opt
operator|=
name|XGetDefault
argument_list|(
name|prog
argument_list|,
literal|"MakeWindow.MouseMask"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|XParseColor
argument_list|(
name|opt
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|mback
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
block|}
name|cr
operator|=
name|XCreateCursor
argument_list|(
name|cross_width
argument_list|,
name|cross_height
argument_list|,
name|cross_bits
argument_list|,
name|cross_mask_bits
argument_list|,
name|cross_x_hot
argument_list|,
name|cross_y_hot
argument_list|,
name|mfore
argument_list|,
name|mback
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|events
operator|=
name|ButtonPressed
operator||
name|ButtonReleased
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
name|events
operator||=
name|MouseMoved
expr_stmt|;
comment|/*  	 * go get the mouse as soon as you can  	 */
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|cr
argument_list|,
name|events
argument_list|)
operator|!=
literal|0
condition|)
break|break;
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|text
argument_list|,
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|text
argument_list|)
operator|-
literal|10
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncat
argument_list|(
name|text
argument_list|,
literal|": 000x000"
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|nz
operator|=
name|strlen
argument_list|(
name|name
argument_list|)
operator|+
literal|8
expr_stmt|;
comment|/* compute number of characters */
name|popw
operator|=
name|XStringWidth
argument_list|(
name|text
argument_list|,
name|pfont
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|+
literal|2
operator|*
name|ibw
expr_stmt|;
name|poph
operator|=
name|pfont
operator|->
name|height
operator|+
literal|2
operator|*
name|ibw
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
block|{
name|XGrabServer
argument_list|()
expr_stmt|;
name|count
operator|=
name|FCOUNT
expr_stmt|;
name|save
operator|=
name|XPixmapSave
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|poph
operator|+
literal|2
operator|*
name|pbw
argument_list|)
expr_stmt|;
block|}
name|backmap
operator|=
name|XMakeTile
argument_list|(
name|pback
argument_list|)
expr_stmt|;
name|bdrmap
operator|=
name|XMakeTile
argument_list|(
name|bpix
argument_list|)
expr_stmt|;
name|pop
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
argument_list|,
name|poph
argument_list|,
name|pbw
argument_list|,
name|bdrmap
argument_list|,
name|backmap
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|pop
argument_list|)
expr_stmt|;
name|xadd
operator|=
name|fwidth
operator|/
literal|2
operator|-
name|xadder
expr_stmt|;
name|yadd
operator|=
name|fheight
operator|/
literal|2
operator|-
name|yadder
expr_stmt|;
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
name|x2
operator|=
name|x1
operator|+
name|minwidth
operator|*
name|fwidth
operator|+
name|xadder
operator|+
literal|2
operator|*
name|bwidth
operator|-
literal|1
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|minheight
operator|*
name|fheight
operator|+
name|yadder
operator|+
literal|2
operator|*
name|bwidth
operator|-
literal|1
expr_stmt|;
name|hsize
operator|=
name|minwidth
expr_stmt|;
name|vsize
operator|=
name|minheight
expr_stmt|;
name|xmindim
operator|=
name|xadder
operator|+
literal|2
operator|*
name|bwidth
expr_stmt|;
name|ymindim
operator|=
name|yadder
operator|+
literal|2
operator|*
name|bwidth
expr_stmt|;
while|while
condition|(
name|stop
operator|==
name|FALSE
condition|)
block|{
if|if
condition|(
operator|(
name|xb
operator|!=
name|max
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
operator|)
operator|||
operator|(
name|yb
operator|!=
name|max
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
operator|)
operator|||
operator|(
name|xa
operator|!=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
operator|)
operator|||
operator|(
name|ya
operator|!=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|freeze
operator|&&
operator|!
name|doit
condition|)
block|{
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|xa
operator|=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|ya
operator|=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|xb
operator|=
name|max
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|yb
operator|=
name|max
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|+=
literal|4
control|)
block|{
name|box
index|[
name|i
index|]
operator|.
name|x
operator|=
name|xa
expr_stmt|;
name|box
index|[
name|i
index|]
operator|.
name|y
operator|=
name|ya
expr_stmt|;
name|box
index|[
name|i
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
operator|+
literal|1
operator|==
name|count
condition|)
break|break;
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|x
operator|=
name|xb
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|y
operator|=
name|ya
operator|,
name|box
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|x
operator|=
name|xb
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|y
operator|=
name|yb
operator|,
name|box
index|[
name|i
operator|+
literal|2
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|x
operator|=
name|xa
expr_stmt|;
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|y
operator|=
name|yb
operator|,
name|box
index|[
name|i
operator|+
literal|3
index|]
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
block|}
name|doit
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|changed
condition|)
block|{
name|changed
operator|=
name|FALSE
expr_stmt|;
name|text
index|[
name|nz
operator|-
literal|6
index|]
operator|=
name|hsize
operator|/
literal|100
operator|+
name|zero
expr_stmt|;
name|text
index|[
name|nz
operator|-
literal|5
index|]
operator|=
operator|(
name|hsize
operator|/
literal|10
operator|)
operator|%
literal|10
operator|+
name|zero
expr_stmt|;
name|text
index|[
name|nz
operator|-
literal|4
index|]
operator|=
name|hsize
operator|%
literal|10
operator|+
name|zero
expr_stmt|;
name|text
index|[
name|nz
operator|-
literal|2
index|]
operator|=
name|vsize
operator|/
literal|100
operator|+
name|zero
expr_stmt|;
name|text
index|[
name|nz
operator|-
literal|1
index|]
operator|=
operator|(
name|vsize
operator|/
literal|10
operator|)
operator|%
literal|10
operator|+
name|zero
expr_stmt|;
name|text
index|[
name|nz
index|]
operator|=
name|vsize
operator|%
literal|10
operator|+
name|zero
expr_stmt|;
name|XText
argument_list|(
name|pop
argument_list|,
name|ibw
argument_list|,
name|ibw
argument_list|,
name|text
argument_list|,
name|strlen
argument_list|(
name|text
argument_list|)
argument_list|,
name|pfont
operator|->
name|id
argument_list|,
name|pfore
argument_list|,
name|pback
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doit
condition|)
block|{
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|doit
operator|=
operator|!
name|freeze
expr_stmt|;
block|}
if|if
condition|(
name|freeze
operator|||
name|XPending
argument_list|()
condition|)
block|{
name|XNextEvent
argument_list|(
operator|&
name|e
argument_list|)
expr_stmt|;
name|x2
operator|=
name|e
operator|.
name|x
expr_stmt|;
name|y2
operator|=
name|e
operator|.
name|y
expr_stmt|;
if|if
condition|(
operator|(
name|chosen
operator|<
literal|0
operator|)
operator|&&
operator|(
name|e
operator|.
name|type
operator|==
name|ButtonPressed
operator|)
condition|)
block|{
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
name|chosen
operator|=
name|e
operator|.
name|detail
operator|&
name|ValueMask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|e
operator|.
name|type
operator|==
name|ButtonReleased
operator|)
operator|&&
operator|(
operator|(
name|e
operator|.
name|detail
operator|&
name|ValueMask
operator|)
operator|==
name|chosen
operator|)
condition|)
name|stop
operator|=
name|TRUE
expr_stmt|;
else|else
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
block|}
else|else
name|XQueryMouse
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|subw
argument_list|)
expr_stmt|;
if|if
condition|(
name|chosen
operator|!=
name|MiddleButton
condition|)
block|{
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
if|if
condition|(
name|chosen
operator|>=
literal|0
condition|)
block|{
name|x2
operator|=
name|defwidth
expr_stmt|;
if|if
condition|(
name|chosen
operator|==
name|LeftButton
condition|)
name|y2
operator|=
name|defheight
expr_stmt|;
else|else
name|y2
operator|=
operator|(
name|DisplayHeight
argument_list|()
operator|-
name|ymindim
operator|-
name|cross_y_hot
operator|)
operator|/
name|fheight
expr_stmt|;
if|if
condition|(
name|clip
condition|)
block|{
name|x2
operator|=
name|min
argument_list|(
name|max
argument_list|(
operator|(
name|DisplayWidth
argument_list|()
operator|-
name|x1
operator|-
name|xmindim
operator|)
operator|/
name|fwidth
argument_list|,
literal|0
argument_list|)
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|y2
operator|=
name|min
argument_list|(
name|max
argument_list|(
operator|(
name|DisplayHeight
argument_list|()
operator|-
name|y1
operator|-
name|ymindim
operator|)
operator|/
name|fheight
argument_list|,
literal|0
argument_list|)
argument_list|,
name|y2
argument_list|)
expr_stmt|;
block|}
name|x2
operator|=
name|x1
operator|+
name|x2
operator|*
name|fwidth
operator|+
name|xadder
operator|-
literal|1
expr_stmt|;
name|y2
operator|=
name|y1
operator|+
name|y2
operator|*
name|fheight
operator|+
name|yadder
operator|-
literal|1
expr_stmt|;
block|}
block|}
name|d
operator|=
name|max
argument_list|(
operator|(
name|abs
argument_list|(
name|x2
operator|-
name|x1
argument_list|)
operator|+
name|xadd
operator|)
operator|/
name|fwidth
argument_list|,
name|minwidth
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|!=
name|hsize
condition|)
block|{
name|hsize
operator|=
name|d
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
name|d
operator|=
name|d
operator|*
name|fwidth
operator|+
name|xmindim
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|x2
operator|<
name|x1
condition|)
name|x2
operator|=
name|x1
operator|-
name|d
expr_stmt|;
else|else
name|x2
operator|=
name|x1
operator|+
name|d
expr_stmt|;
name|d
operator|=
name|max
argument_list|(
operator|(
name|abs
argument_list|(
name|y2
operator|-
name|y1
argument_list|)
operator|+
name|yadd
operator|)
operator|/
name|fheight
argument_list|,
name|minheight
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|!=
name|vsize
condition|)
block|{
name|vsize
operator|=
name|d
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
name|d
operator|=
name|d
operator|*
name|fheight
operator|+
name|ymindim
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|y2
operator|<
name|y1
condition|)
name|y2
operator|=
name|y1
operator|-
name|d
expr_stmt|;
else|else
name|y2
operator|=
name|y1
operator|+
name|d
expr_stmt|;
block|}
if|if
condition|(
name|freeze
condition|)
name|XDraw
argument_list|(
name|RootWindow
argument_list|,
name|box
argument_list|,
name|count
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|GXinvert
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|XUngrabMouse
argument_list|()
expr_stmt|;
if|if
condition|(
name|save
condition|)
block|{
name|XUnmapTransparent
argument_list|(
name|pop
argument_list|)
expr_stmt|;
name|XPixmapPut
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|popw
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|poph
operator|+
literal|2
operator|*
name|pbw
argument_list|,
name|save
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|save
argument_list|)
expr_stmt|;
block|}
name|XDestroyWindow
argument_list|(
name|pop
argument_list|)
expr_stmt|;
if|if
condition|(
name|freeze
condition|)
name|XUngrabServer
argument_list|()
expr_stmt|;
if|if
condition|(
name|pfont
operator|!=
name|f
condition|)
name|XCloseFont
argument_list|(
name|pfont
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|backmap
argument_list|)
expr_stmt|;
name|XFreePixmap
argument_list|(
name|bdrmap
argument_list|)
expr_stmt|;
name|frame
operator|->
name|x
operator|=
name|min
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|frame
operator|->
name|y
operator|=
name|min
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|frame
operator|->
name|width
operator|=
name|hsize
operator|*
name|fwidth
operator|+
name|xadder
expr_stmt|;
name|frame
operator|->
name|height
operator|=
name|vsize
operator|*
name|fheight
operator|+
name|yadder
expr_stmt|;
operator|*
name|cwidth
operator|=
name|hsize
expr_stmt|;
operator|*
name|cheight
operator|=
name|vsize
expr_stmt|;
name|makeit
label|:
name|XCreateWindows
argument_list|(
name|RootWindow
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* store default name of the window and set the resize hint */
name|XStoreName
argument_list|(
name|frame
operator|->
name|self
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|XSetResizeHint
argument_list|(
name|frame
operator|->
name|self
argument_list|,
name|xadder
argument_list|,
name|yadder
argument_list|,
name|fwidth
argument_list|,
name|fheight
argument_list|)
expr_stmt|;
name|XSync
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* get rid of any extraneous events */
return|return
operator|(
name|frame
operator|->
name|self
operator|)
return|;
block|}
end_block

end_unit

