begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) Stichting Mathematisch Centrum, Amsterdam, 1984. */
end_comment

begin_decl_stmt
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$Header: help.c,v 2.6 85/08/22 16:03:38 timo Exp $"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * B editor -- Print help blurb.  */
end_comment

begin_include
include|#
directive|include
file|"feat.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HELPFUL
end_ifdef

begin_include
include|#
directive|include
file|"unix.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|IBMPC
end_ifdef

begin_define
define|#
directive|define
name|getchar
parameter_list|()
value|getch()
end_define

begin_endif
endif|#
directive|endif
endif|IBMPC
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|SIGNAL
end_ifdef

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_endif
endif|#
directive|endif
endif|SIGNAL
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|SGTTY_H
end_ifdef

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_endif
endif|#
directive|endif
endif|SGTTY_H
end_endif

begin_include
include|#
directive|include
file|"b.h"
end_include

begin_function_decl
name|string
name|unixerror
parameter_list|()
function_decl|;
end_function_decl

begin_ifndef
ifndef|#
directive|ifndef
name|HELPBLURB
end_ifndef

begin_define
define|#
directive|define
name|HELPBLURB
value|"/usr/new/lib/B/Bed_help"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|SOBIT
value|0200
end_define

begin_decl_stmt
specifier|extern
name|int
name|winheight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|llength
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|winstart
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Interrupt catcher while printing message.  */
end_comment

begin_decl_stmt
name|Hidden
name|int
name|intr
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|SIGNAL
end_ifdef

begin_function
name|Hidden
name|Procedure
name|stop
parameter_list|()
block|{
name|intr
operator|=
name|Yes
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|stop
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
endif|SIGNAL
end_endif

begin_comment
comment|/*  * Print help blurb.  * This is done through the standard screen interface.  * An interrupt during the printing only stops the printing.  * The user must type [return] to continue.  */
end_comment

begin_function
name|Visible
name|bool
name|help
parameter_list|()
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|string
name|helpblurb
decl_stmt|;
name|char
name|buffer
index|[
literal|81
index|]
decl_stmt|;
name|int
name|len
init|=
sizeof|sizeof
name|buffer
decl_stmt|;
name|string
name|cp
decl_stmt|;
ifdef|#
directive|ifdef
name|SIGNAL
name|int
function_decl|(
modifier|*
name|prevsig
function_decl|)
parameter_list|()
function_decl|;
endif|#
directive|endif
endif|SIGNAL
ifdef|#
directive|ifdef
name|SGTTY_H
name|struct
name|sgttyb
name|tty
decl_stmt|;
endif|#
directive|endif
endif|SGTTY_H
name|int
name|c
decl_stmt|;
name|helpblurb
operator|=
name|getenv
argument_list|(
literal|"BED_HELP"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|helpblurb
operator|||
operator|!
name|helpblurb
index|[
literal|0
index|]
condition|)
name|helpblurb
operator|=
name|HELPBLURB
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|helpblurb
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|error
argument_list|(
literal|"Sorry, I can't help [%s]"
argument_list|,
name|unixerror
argument_list|(
name|helpblurb
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|No
return|;
block|}
ifdef|#
directive|ifdef
name|SIGNAL
name|intr
operator|=
name|No
expr_stmt|;
name|prevsig
operator|=
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|stop
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|SIGNAL
if|if
condition|(
name|llength
operator|<
operator|(
sizeof|sizeof
name|buffer
operator|)
operator|-
literal|1
condition|)
name|len
operator|=
name|llength
operator|+
literal|1
expr_stmt|;
while|while
condition|(
operator|!
name|intr
operator|&&
name|fgets
argument_list|(
name|buffer
argument_list|,
name|len
argument_list|,
name|fp
argument_list|)
condition|)
block|{
name|cp
operator|=
name|index
argument_list|(
name|buffer
argument_list|,
literal|'\n'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cp
condition|)
operator|*
name|cp
operator|=
literal|'\0'
expr_stmt|;
name|trmputdata
argument_list|(
name|winheight
argument_list|,
name|winheight
argument_list|,
literal|0
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|trmscrollup
argument_list|(
literal|0
argument_list|,
name|winheight
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|trmsync
argument_list|(
name|winheight
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SIGNAL
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|prevsig
argument_list|)
expr_stmt|;
if|if
condition|(
name|intr
condition|)
name|trmundefined
argument_list|()
expr_stmt|;
comment|/* UNIX discards output when interrupted */
comment|/* so output position is uncertain */
endif|#
directive|endif
endif|SIGNAL
name|trmputdata
argument_list|(
name|winheight
argument_list|,
name|winheight
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buffer
argument_list|,
literal|"Press [return] to continue"
argument_list|)
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|buffer
init|;
operator|*
name|cp
condition|;
control|)
operator|*
name|cp
operator|++
operator||=
name|SOBIT
expr_stmt|;
name|trmputdata
argument_list|(
name|winheight
argument_list|,
name|winheight
argument_list|,
literal|0
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|trmsync
argument_list|(
name|winheight
argument_list|,
name|cp
operator|-
name|buffer
argument_list|)
expr_stmt|;
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
while|while
condition|(
name|c
operator|!=
literal|'\n'
operator|&&
name|c
operator|!=
literal|'\r'
operator|&&
name|c
operator|!=
name|EOF
condition|)
block|{
name|trmbell
argument_list|()
expr_stmt|;
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
block|}
name|trmputdata
argument_list|(
name|winheight
argument_list|,
name|winheight
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|winstart
operator|=
name|winheight
expr_stmt|;
return|return
name|Yes
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
endif|HELPFUL
end_endif

end_unit

