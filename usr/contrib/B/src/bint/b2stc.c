begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) Stichting Mathematisch Centrum, Amsterdam, 1985. */
end_comment

begin_comment
comment|/*   $Header: b2stc.c,v 1.4 85/08/22 16:55:56 timo Exp $ */
end_comment

begin_comment
comment|/* B (intra-unit) type check */
end_comment

begin_include
include|#
directive|include
file|"b.h"
end_include

begin_include
include|#
directive|include
file|"b1obj.h"
end_include

begin_include
include|#
directive|include
file|"b2nod.h"
end_include

begin_include
include|#
directive|include
file|"b2syn.h"
end_include

begin_comment
comment|/* temporary? for Cap in tc_refinement */
end_comment

begin_include
include|#
directive|include
file|"b2tcP.h"
end_include

begin_include
include|#
directive|include
file|"b2tcU.h"
end_include

begin_include
include|#
directive|include
file|"b2tcE.h"
end_include

begin_include
include|#
directive|include
file|"b3err.h"
end_include

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_decl_stmt
name|Hidden
name|value
name|refname
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * if in commandsuite of refinement:   *	holds refinement name;  * if in commandsuite of yield unit:  * 	holds B-text "returned value"   *		(used in error messages, no confusion possible)  * else  *	Vnil  * To be used in tc_return()  */
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function_decl
name|Forward
name|polytype
name|pt_expr
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Visible
name|Procedure
name|type_check
parameter_list|(
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
block|{
name|typenode
name|n
decl_stmt|;
specifier|extern
name|bool
name|extcmds
decl_stmt|;
comment|/* Set in main by -E option */
if|if
condition|(
name|extcmds
operator|||
operator|!
name|still_ok
operator|||
name|v
name|EQ
name|NilTree
condition|)
return|return;
name|n
operator|=
name|nodetype
argument_list|(
name|v
argument_list|)
expr_stmt|;
name|curline
operator|=
name|v
expr_stmt|;
name|curlino
operator|=
name|one
expr_stmt|;
name|start_vars
argument_list|()
expr_stmt|;
name|refname
operator|=
name|Vnil
expr_stmt|;
name|usetypetable
argument_list|(
name|mk_elt
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|Unit
argument_list|(
name|n
argument_list|)
condition|)
name|tc_unit
argument_list|(
name|v
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|Command
argument_list|(
name|n
argument_list|)
condition|)
name|tc_command
argument_list|(
name|v
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|Expression
argument_list|(
name|n
argument_list|)
condition|)
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2300
argument_list|,
literal|"wrong argument of 'type_check'"
argument_list|)
argument_list|)
expr_stmt|;
name|end_vars
argument_list|()
expr_stmt|;
name|deltypetable
argument_list|()
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|TABSIZE
value|72
end_define

begin_decl_stmt
name|Hidden
name|Procedure
argument_list|(
operator|*
operator|(
name|uni_tab
index|[
name|TABSIZE
index|]
operator|)
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*Units*/
end_comment

begin_decl_stmt
name|Hidden
name|Procedure
argument_list|(
operator|*
operator|(
name|cmd_tab
index|[
name|TABSIZE
index|]
operator|)
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*Commands*/
end_comment

begin_decl_stmt
name|Hidden
name|polytype
argument_list|(
operator|*
operator|(
name|exp_tab
index|[
name|TABSIZE
index|]
operator|)
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*Expressions*/
end_comment

begin_decl_stmt
name|Hidden
name|Procedure
argument_list|(
operator|*
operator|(
name|tes_tab
index|[
name|TABSIZE
index|]
operator|)
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*Tests*/
end_comment

begin_define
define|#
directive|define
name|FF
value|First_fieldnr
end_define

begin_decl_stmt
name|Hidden
name|Procedure
name|tc_node
argument_list|(
name|v
argument_list|,
name|tab
argument_list|)
name|parsetree
name|v
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
argument_list|(
operator|*
operator|(
name|tab
index|[]
operator|)
argument_list|)
argument_list|()
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|auto
function_decl|(
modifier|*
name|f
function_decl|)
parameter_list|()
init|=
name|tab
index|[
name|nodetype
argument_list|(
name|v
argument_list|)
index|]
function_decl|;
switch|switch
condition|(
name|Nbranches
argument_list|(
name|v
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
call|(
modifier|*
name|f
call|)
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|7
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|7
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2301
argument_list|,
literal|"Wrong size node in tc_node"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_decl_stmt
name|Hidden
name|polytype
name|pt_node
argument_list|(
name|v
argument_list|,
name|tab
argument_list|)
name|parsetree
name|v
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|polytype
argument_list|(
operator|*
operator|(
name|tab
index|[]
operator|)
argument_list|)
argument_list|()
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|polytype
function_decl|(
modifier|*
name|f
function_decl|)
parameter_list|()
init|=
name|tab
index|[
name|nodetype
argument_list|(
name|v
argument_list|)
index|]
function_decl|;
switch|switch
condition|(
name|Nbranches
argument_list|(
name|v
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
call|(
modifier|*
name|f
call|)
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|8
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|7
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
call|(
modifier|*
name|f
call|)
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|1
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|2
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|3
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|4
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|5
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|6
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|7
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|FF
operator|+
literal|8
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2302
argument_list|,
literal|"Wrong size node in pt_node"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* NOTREACHED */
block|}
block|}
end_block

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/* Type Check units */
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Hidden
name|Procedure
name|tc_unit
parameter_list|(
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
block|{
if|if
condition|(
name|v
operator|!=
name|NilTree
condition|)
name|tc_node
argument_list|(
name|v
argument_list|,
name|uni_tab
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_howto_unit
parameter_list|(
name|name
parameter_list|,
name|formals
parameter_list|,
name|cmt
parameter_list|,
name|suite
parameter_list|,
name|refinement
parameter_list|,
name|reftab
parameter_list|,
name|nlocals
parameter_list|)
name|parsetree
name|suite
decl_stmt|,
name|refinement
decl_stmt|;
name|value
name|name
decl_stmt|,
name|formals
decl_stmt|,
name|cmt
decl_stmt|,
name|reftab
decl_stmt|,
name|nlocals
decl_stmt|;
block|{
name|tc_command
argument_list|(
name|suite
argument_list|)
expr_stmt|;
name|tc_unit
argument_list|(
name|refinement
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_yield_unit
parameter_list|(
name|name
parameter_list|,
name|adic
parameter_list|,
name|formals
parameter_list|,
name|cmt
parameter_list|,
name|suite
parameter_list|,
name|refinement
parameter_list|,
name|reftab
parameter_list|,
name|nlocals
parameter_list|)
name|parsetree
name|suite
decl_stmt|,
name|refinement
decl_stmt|;
name|value
name|name
decl_stmt|,
name|adic
decl_stmt|,
name|formals
decl_stmt|,
name|cmt
decl_stmt|,
name|reftab
decl_stmt|,
name|nlocals
decl_stmt|;
block|{
name|refname
operator|=
name|mk_text
argument_list|(
literal|"returned value"
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|suite
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|refname
argument_list|)
expr_stmt|;
name|refname
operator|=
name|Vnil
expr_stmt|;
name|tc_unit
argument_list|(
name|refinement
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_test_unit
parameter_list|(
name|name
parameter_list|,
name|adic
parameter_list|,
name|formals
parameter_list|,
name|cmt
parameter_list|,
name|suite
parameter_list|,
name|refinement
parameter_list|,
name|reftab
parameter_list|,
name|nlocals
parameter_list|)
name|parsetree
name|suite
decl_stmt|,
name|refinement
decl_stmt|;
name|value
name|name
decl_stmt|,
name|adic
decl_stmt|,
name|formals
decl_stmt|,
name|cmt
decl_stmt|,
name|reftab
decl_stmt|,
name|nlocals
decl_stmt|;
block|{
name|tc_command
argument_list|(
name|suite
argument_list|)
expr_stmt|;
name|tc_unit
argument_list|(
name|refinement
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_refinement
parameter_list|(
name|name
parameter_list|,
name|cmt
parameter_list|,
name|suite
parameter_list|,
name|next
parameter_list|)
name|parsetree
name|suite
decl_stmt|,
name|next
decl_stmt|;
name|value
name|name
decl_stmt|,
name|cmt
decl_stmt|;
block|{
name|value
name|n1
init|=
name|curtail
argument_list|(
name|name
argument_list|,
name|one
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|Cap
argument_list|(
name|charval
argument_list|(
name|n1
argument_list|)
argument_list|)
condition|)
comment|/* should test for expression refinement */
name|refname
operator|=
name|copy
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|n1
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|suite
argument_list|)
expr_stmt|;
if|if
condition|(
name|refname
name|NE
name|Vnil
condition|)
block|{
name|release
argument_list|(
name|refname
argument_list|)
expr_stmt|;
name|refname
operator|=
name|Vnil
expr_stmt|;
block|}
name|tc_unit
argument_list|(
name|next
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/* TypeCheck commands */
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Hidden
name|Procedure
name|tc_command
parameter_list|(
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
block|{
name|curline
operator|=
name|v
expr_stmt|;
name|end_vars
argument_list|()
expr_stmt|;
name|start_vars
argument_list|()
expr_stmt|;
if|if
condition|(
name|v
operator|!=
name|NilTree
condition|)
name|tc_node
argument_list|(
name|v
argument_list|,
name|cmd_tab
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_suite
parameter_list|(
name|lino
parameter_list|,
name|cmd
parameter_list|,
name|cmt
parameter_list|,
name|next
parameter_list|)
name|parsetree
name|cmd
decl_stmt|,
name|next
decl_stmt|;
name|value
name|lino
decl_stmt|,
name|cmt
decl_stmt|;
block|{
name|curlino
operator|=
name|lino
expr_stmt|;
name|tc_command
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|next
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_put
parameter_list|(
name|e
parameter_list|,
name|t
parameter_list|)
name|parsetree
name|e
decl_stmt|,
name|t
decl_stmt|;
block|{
name|polytype
name|te
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|tt
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_ins_rem
parameter_list|(
name|e
parameter_list|,
name|t
parameter_list|)
name|parsetree
name|e
decl_stmt|,
name|t
decl_stmt|;
block|{
name|polytype
name|t_list_e
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|t_list_e
operator|=
name|mkt_list
argument_list|(
name|pt_expr
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|t_list_e
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_list_e
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_choose
parameter_list|(
name|t
parameter_list|,
name|e
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|e
decl_stmt|;
block|{
name|polytype
name|t_tlt_t
decl_stmt|,
name|te
decl_stmt|,
name|u
decl_stmt|;
name|t_tlt_t
operator|=
name|mkt_tlt
argument_list|(
name|pt_expr
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|t_tlt_t
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_t
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_draw
parameter_list|(
name|t
parameter_list|)
name|parsetree
name|t
decl_stmt|;
block|{
name|polytype
name|t_number
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|t_number
operator|=
name|mkt_number
argument_list|()
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_number
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_set_random
parameter_list|(
name|e
parameter_list|)
name|parsetree
name|e
decl_stmt|;
block|{
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_delete
parameter_list|(
name|t
parameter_list|)
name|parsetree
name|t
decl_stmt|;
block|{
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_check
parameter_list|(
name|c
parameter_list|)
name|parsetree
name|c
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_nothing
parameter_list|(
name|t
parameter_list|)
name|parsetree
name|t
decl_stmt|;
block|{}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_write
parameter_list|(
name|nl1
parameter_list|,
name|e
parameter_list|,
name|nl2
parameter_list|)
name|parsetree
name|e
decl_stmt|;
name|value
name|nl1
decl_stmt|,
name|nl2
decl_stmt|;
block|{
if|if
condition|(
name|e
operator|!=
name|NilTree
condition|)
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_read
parameter_list|(
name|t
parameter_list|,
name|e
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|e
decl_stmt|;
block|{
name|polytype
name|te
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|te
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_raw_read
parameter_list|(
name|t
parameter_list|)
name|parsetree
name|t
decl_stmt|;
block|{
name|polytype
name|t_text
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|t_text
operator|=
name|mkt_text
argument_list|()
expr_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_text
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_ifwhile
parameter_list|(
name|c
parameter_list|,
name|cmt
parameter_list|,
name|s
parameter_list|)
name|parsetree
name|c
decl_stmt|,
name|s
decl_stmt|;
name|value
name|cmt
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_for
parameter_list|(
name|t
parameter_list|,
name|e
parameter_list|,
name|cmt
parameter_list|,
name|s
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|e
decl_stmt|,
name|s
decl_stmt|;
name|value
name|cmt
decl_stmt|;
block|{
name|polytype
name|t_tlt_t
decl_stmt|,
name|te
decl_stmt|,
name|u
decl_stmt|;
name|t_tlt_t
operator|=
name|mkt_tlt
argument_list|(
name|pt_expr
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|t_tlt_t
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_t
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_select
parameter_list|(
name|cmt
parameter_list|,
name|s
parameter_list|)
name|parsetree
name|s
decl_stmt|;
name|value
name|cmt
decl_stmt|;
block|{
name|tc_command
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tes_suite
parameter_list|(
name|lino
parameter_list|,
name|c
parameter_list|,
name|cmt
parameter_list|,
name|s
parameter_list|,
name|next
parameter_list|)
name|parsetree
name|c
decl_stmt|,
name|s
decl_stmt|,
name|next
decl_stmt|;
name|value
name|lino
decl_stmt|,
name|cmt
decl_stmt|;
block|{
name|curlino
operator|=
name|lino
expr_stmt|;
if|if
condition|(
name|c
operator|!=
name|NilTree
condition|)
block|{
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|tc_command
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|tc_command
argument_list|(
name|next
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_else
parameter_list|(
name|lino
parameter_list|,
name|cmt
parameter_list|,
name|s
parameter_list|)
name|parsetree
name|s
decl_stmt|;
name|value
name|lino
decl_stmt|,
name|cmt
decl_stmt|;
block|{
name|curlino
operator|=
name|lino
expr_stmt|;
name|tc_command
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_return
parameter_list|(
name|e
parameter_list|)
name|parsetree
name|e
decl_stmt|;
block|{
name|polytype
name|te
decl_stmt|,
name|tt
decl_stmt|,
name|u
decl_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
if|if
condition|(
name|refname
name|EQ
name|Vnil
condition|)
name|error
argument_list|(
name|MESS
argument_list|(
literal|2303
argument_list|,
literal|"RETURN not in YIELD unit or expression refinement"
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|tt
operator|=
name|mkt_var
argument_list|(
name|copy
argument_list|(
name|refname
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|te
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_report
parameter_list|(
name|c
parameter_list|)
name|parsetree
name|c
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_user_command
parameter_list|(
name|name
parameter_list|,
name|v
parameter_list|)
name|value
name|name
decl_stmt|,
name|v
decl_stmt|;
block|{
name|parsetree
name|e
decl_stmt|;
name|value
name|w
init|=
name|v
decl_stmt|;
while|while
condition|(
name|w
operator|!=
name|Vnil
condition|)
block|{
name|e
operator|=
operator|*
name|Branch
argument_list|(
name|w
argument_list|,
name|ACT_EXPR
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|!=
name|NilTree
condition|)
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|=
operator|*
name|Branch
argument_list|(
name|w
argument_list|,
name|ACT_NEXT
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/* calculate PolyType of EXPRessions /* ******************************************************************** */
end_comment

begin_function
name|Hidden
name|polytype
name|pt_expr
parameter_list|(
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
block|{
return|return
name|pt_node
argument_list|(
name|v
argument_list|,
name|exp_tab
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_compound
parameter_list|(
name|e
parameter_list|)
name|parsetree
name|e
decl_stmt|;
block|{
return|return
name|pt_expr
argument_list|(
name|e
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_collateral
parameter_list|(
name|e
parameter_list|)
name|value
name|e
decl_stmt|;
block|{
name|intlet
name|k
decl_stmt|,
name|len
init|=
name|Nfields
argument_list|(
name|e
argument_list|)
decl_stmt|;
name|polytype
name|tc
decl_stmt|;
name|tc
operator|=
name|mkt_compound
argument_list|(
name|len
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|len
condition|;
name|k
operator|++
control|)
name|putsubtype
argument_list|(
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
name|k
argument_list|)
argument_list|)
argument_list|,
name|tc
argument_list|,
name|k
argument_list|)
expr_stmt|;
return|return
name|tc
return|;
block|}
end_function

begin_function
name|Hidden
name|bool
name|is_string
parameter_list|(
name|v
parameter_list|,
name|s
parameter_list|)
name|value
name|v
decl_stmt|;
name|string
name|s
decl_stmt|;
block|{
name|value
name|t
decl_stmt|;
name|relation
name|rel
decl_stmt|;
name|rel
operator|=
name|compare
argument_list|(
name|v
argument_list|,
name|t
operator|=
name|mk_text
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
return|return
operator|(
name|rel
name|EQ
literal|0
condition|?
name|Yes
else|:
name|No
operator|)
return|;
block|}
end_function

begin_function
name|Hidden
name|bool
name|monf_on_number
parameter_list|(
name|n
parameter_list|)
name|value
name|n
decl_stmt|;
block|{
return|return
operator|(
name|is_string
argument_list|(
name|n
argument_list|,
literal|"~"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"+"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"-"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"*/"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"/*"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"root"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"abs"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"sign"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"floor"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"ceiling"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"round"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"sin"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"cos"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"tan"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"atan"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"exp"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"log"
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|Hidden
name|bool
name|dyaf_on_number
parameter_list|(
name|n
parameter_list|)
name|value
name|n
decl_stmt|;
block|{
return|return
operator|(
name|is_string
argument_list|(
name|n
argument_list|,
literal|"+"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"-"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"*"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"/"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"**"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"root"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"round"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"mod"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"atan"
argument_list|)
operator|||
name|is_string
argument_list|(
name|n
argument_list|,
literal|"log"
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_monf
parameter_list|(
name|name
parameter_list|,
name|r
parameter_list|,
name|fct
parameter_list|)
name|parsetree
name|r
decl_stmt|;
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
name|polytype
name|tr
decl_stmt|,
name|tf
decl_stmt|,
name|u
decl_stmt|;
name|tr
operator|=
name|pt_expr
argument_list|(
name|r
argument_list|)
expr_stmt|;
if|if
condition|(
name|monf_on_number
argument_list|(
name|name
argument_list|)
condition|)
block|{
name|polytype
name|t_number
init|=
name|mkt_number
argument_list|()
decl_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_number
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"keys"
argument_list|)
condition|)
block|{
name|polytype
name|t_table
decl_stmt|,
name|t_keys
decl_stmt|;
name|t_keys
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
name|t_table
operator|=
name|mkt_table
argument_list|(
name|p_copy
argument_list|(
name|t_keys
argument_list|)
argument_list|,
name|mkt_newvar
argument_list|()
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_table
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_table
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|mkt_list
argument_list|(
name|t_keys
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"#"
argument_list|)
condition|)
block|{
name|polytype
name|t_tlt
init|=
name|mkt_tlt
argument_list|(
name|mkt_newvar
argument_list|()
argument_list|)
decl_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|mkt_number
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"min"
argument_list|)
operator|||
name|is_string
argument_list|(
name|name
argument_list|,
literal|"max"
argument_list|)
condition|)
block|{
name|polytype
name|t_tlt_x
decl_stmt|,
name|t_x
decl_stmt|;
name|t_x
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
name|t_tlt_x
operator|=
name|mkt_tlt
argument_list|(
name|p_copy
argument_list|(
name|t_x
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt_x
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_x
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_x
expr_stmt|;
block|}
else|else
block|{
name|tf
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
block|}
name|p_release
argument_list|(
name|tr
argument_list|)
expr_stmt|;
return|return
name|tf
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_dyaf
parameter_list|(
name|l
parameter_list|,
name|name
parameter_list|,
name|r
parameter_list|,
name|fct
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
name|polytype
name|tl
decl_stmt|,
name|tr
decl_stmt|,
name|tf
decl_stmt|,
name|u
decl_stmt|;
name|tl
operator|=
name|pt_expr
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|tr
operator|=
name|pt_expr
argument_list|(
name|r
argument_list|)
expr_stmt|;
if|if
condition|(
name|dyaf_on_number
argument_list|(
name|name
argument_list|)
condition|)
block|{
name|polytype
name|t_number
init|=
name|mkt_number
argument_list|()
decl_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_number
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"^"
argument_list|)
condition|)
block|{
name|polytype
name|t_text
init|=
name|mkt_text
argument_list|()
decl_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_text
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"^^"
argument_list|)
condition|)
block|{
name|polytype
name|t_text
init|=
name|mkt_text
argument_list|()
decl_stmt|,
name|t_number
init|=
name|mkt_number
argument_list|()
decl_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_number
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_text
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"<<"
argument_list|)
operator|||
name|is_string
argument_list|(
name|name
argument_list|,
literal|"><"
argument_list|)
operator|||
name|is_string
argument_list|(
name|name
argument_list|,
literal|">>"
argument_list|)
condition|)
block|{
name|polytype
name|t_number
init|=
name|mkt_number
argument_list|()
decl_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_number
argument_list|)
expr_stmt|;
name|tf
operator|=
name|mkt_text
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"#"
argument_list|)
condition|)
block|{
name|polytype
name|t_tlt_l
init|=
name|mkt_tlt
argument_list|(
name|p_copy
argument_list|(
name|tl
argument_list|)
argument_list|)
decl_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt_l
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_l
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|mkt_number
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"min"
argument_list|)
operator|||
name|is_string
argument_list|(
name|name
argument_list|,
literal|"max"
argument_list|)
condition|)
block|{
name|polytype
name|t_tlt_l
init|=
name|mkt_tlt
argument_list|(
name|p_copy
argument_list|(
name|tl
argument_list|)
argument_list|)
decl_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt_l
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|p_copy
argument_list|(
name|asctype
argument_list|(
name|u
argument_list|)
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_l
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"th'of"
argument_list|)
condition|)
block|{
name|polytype
name|t_number
decl_stmt|,
name|t_tlt_x
decl_stmt|,
name|t_x
decl_stmt|;
name|t_number
operator|=
name|mkt_number
argument_list|()
expr_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_number
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|t_x
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
name|t_tlt_x
operator|=
name|mkt_tlt
argument_list|(
name|p_copy
argument_list|(
name|t_x
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt_x
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_x
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tf
operator|=
name|t_x
expr_stmt|;
block|}
else|else
block|{
name|tf
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
block|}
name|p_release
argument_list|(
name|tl
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tr
argument_list|)
expr_stmt|;
return|return
name|tf
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tag
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{
name|polytype
name|var
decl_stmt|;
comment|/*  *	if (is_globalstring(name, "pi") || is_globalstring(name, "e"))  *		return mkt_number();  *	else  */
name|var
operator|=
name|mkt_var
argument_list|(
name|copy
argument_list|(
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|add_var
argument_list|(
name|var
argument_list|)
expr_stmt|;
return|return
name|var
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tformal
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tlocal
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tglobal
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tmystery
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_trefinement
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tfun
parameter_list|(
name|name
parameter_list|,
name|fct
parameter_list|)
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tprd
parameter_list|(
name|name
parameter_list|,
name|fct
parameter_list|)
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
return|return
name|pt_tag
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_number
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
name|value
name|v
decl_stmt|,
name|t
decl_stmt|;
block|{
return|return
name|mkt_number
argument_list|()
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_text_dis
parameter_list|(
name|q
parameter_list|,
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
name|value
name|q
decl_stmt|;
block|{
while|while
condition|(
name|v
name|NE
name|NilTree
condition|)
block|{
switch|switch
condition|(
name|nodetype
argument_list|(
name|v
argument_list|)
condition|)
block|{
case|case
name|TEXT_LIT
case|:
name|v
operator|=
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|XLIT_NEXT
argument_list|)
expr_stmt|;
break|break;
case|case
name|TEXT_CONV
case|:
name|p_release
argument_list|(
name|pt_expr
argument_list|(
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|XCON_EXPR
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|v
operator|=
operator|*
name|Branch
argument_list|(
name|v
argument_list|,
name|XCON_NEXT
argument_list|)
expr_stmt|;
break|break;
default|default:
name|v
operator|=
name|NilTree
expr_stmt|;
block|}
block|}
return|return
name|mkt_text
argument_list|()
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_elt_dis
parameter_list|()
block|{
return|return
name|mkt_lt
argument_list|(
name|mkt_newvar
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_list_dis
parameter_list|(
name|e
parameter_list|)
name|value
name|e
decl_stmt|;
block|{
name|intlet
name|k
decl_stmt|,
name|len
init|=
name|Nfields
argument_list|(
name|e
argument_list|)
decl_stmt|;
name|polytype
name|tres
init|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|k
operator|=
literal|1
init|;
name|k
operator|<
name|len
condition|;
name|k
operator|++
control|)
block|{
name|polytype
name|te
decl_stmt|,
name|u
decl_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|tres
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tres
argument_list|)
expr_stmt|;
name|tres
operator|=
name|u
expr_stmt|;
block|}
return|return
name|mkt_list
argument_list|(
name|tres
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_range_dis
parameter_list|(
name|l
parameter_list|,
name|h
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|h
decl_stmt|;
block|{
name|polytype
name|tl
decl_stmt|,
name|th
decl_stmt|,
name|t_tn
decl_stmt|,
name|tres
decl_stmt|,
name|u
decl_stmt|;
name|t_tn
operator|=
name|mkt_tn
argument_list|()
expr_stmt|;
name|tl
operator|=
name|pt_expr
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_tn
argument_list|,
operator|&
name|tres
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tl
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tn
argument_list|)
expr_stmt|;
name|th
operator|=
name|pt_expr
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|th
argument_list|,
name|tres
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|th
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|tres
argument_list|)
expr_stmt|;
return|return
name|mkt_list
argument_list|(
name|u
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_tab_dis
parameter_list|(
name|e
parameter_list|)
name|value
name|e
decl_stmt|;
block|{
name|intlet
name|k
decl_stmt|,
name|len
init|=
name|Nfields
argument_list|(
name|e
argument_list|)
decl_stmt|;
name|polytype
name|tresk
decl_stmt|,
name|tresa
decl_stmt|;
name|tresk
operator|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|tresa
operator|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|2
init|;
name|k
operator|<
name|len
condition|;
name|k
operator|+=
literal|2
control|)
block|{
name|polytype
name|tk
decl_stmt|,
name|ta
decl_stmt|,
name|u
decl_stmt|;
name|tk
operator|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tk
argument_list|,
name|tresk
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tk
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tresk
argument_list|)
expr_stmt|;
name|tresk
operator|=
name|u
expr_stmt|;
name|ta
operator|=
name|pt_expr
argument_list|(
operator|*
name|Field
argument_list|(
name|e
argument_list|,
name|k
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|ta
argument_list|,
name|tresa
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|ta
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tresa
argument_list|)
expr_stmt|;
name|tresa
operator|=
name|u
expr_stmt|;
block|}
return|return
name|mkt_table
argument_list|(
name|tresk
argument_list|,
name|tresa
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_selection
parameter_list|(
name|t
parameter_list|,
name|k
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|k
decl_stmt|;
block|{
name|polytype
name|tt
decl_stmt|,
name|ta
decl_stmt|,
name|ttab
decl_stmt|,
name|u
decl_stmt|;
name|tt
operator|=
name|pt_expr
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|ta
operator|=
name|mkt_newvar
argument_list|()
expr_stmt|;
name|ttab
operator|=
name|mkt_table
argument_list|(
name|pt_expr
argument_list|(
name|k
argument_list|)
argument_list|,
name|p_copy
argument_list|(
name|ta
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tt
argument_list|,
name|ttab
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tt
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|ttab
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
return|return
name|ta
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_trim
parameter_list|(
name|l
parameter_list|,
name|r
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
block|{
name|polytype
name|tl
decl_stmt|,
name|tr
decl_stmt|,
name|t_text
decl_stmt|,
name|t_number
decl_stmt|,
name|u
decl_stmt|;
name|tl
operator|=
name|pt_expr
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|t_text
operator|=
name|mkt_text
argument_list|()
expr_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tl
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tr
operator|=
name|pt_expr
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|t_number
operator|=
name|mkt_number
argument_list|()
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_number
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tr
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_number
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
return|return
name|t_text
return|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_unparsed
parameter_list|(
name|v
parameter_list|,
name|t
parameter_list|)
name|parsetree
name|v
decl_stmt|,
name|t
decl_stmt|;
block|{
return|return
name|mkt_newvar
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_comment
comment|/* Type Check tests */
end_comment

begin_comment
comment|/* ******************************************************************** */
end_comment

begin_function
name|Hidden
name|Procedure
name|tc_test
parameter_list|(
name|v
parameter_list|)
name|parsetree
name|v
decl_stmt|;
block|{
name|tc_node
argument_list|(
name|v
argument_list|,
name|tes_tab
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_compound
parameter_list|(
name|c
parameter_list|)
name|parsetree
name|c
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_junction
parameter_list|(
name|l
parameter_list|,
name|r
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|tc_test
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_not
parameter_list|(
name|r
parameter_list|)
name|parsetree
name|r
decl_stmt|;
block|{
name|tc_test
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_in_quantification
parameter_list|(
name|t
parameter_list|,
name|e
parameter_list|,
name|c
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|e
decl_stmt|,
name|c
decl_stmt|;
block|{
name|polytype
name|t_tlt_t
decl_stmt|,
name|te
decl_stmt|,
name|u
decl_stmt|;
name|t_tlt_t
operator|=
name|mkt_tlt
argument_list|(
name|pt_expr
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|t_tlt_t
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_t
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_p_quantification
parameter_list|(
name|t
parameter_list|,
name|e
parameter_list|,
name|c
parameter_list|)
name|parsetree
name|t
decl_stmt|,
name|e
decl_stmt|,
name|c
decl_stmt|;
block|{
name|intlet
name|k
decl_stmt|,
name|len
decl_stmt|;
name|value
name|ct
decl_stmt|;
comment|/* the Collateral Tag in t */
name|polytype
name|t_text
decl_stmt|,
name|te
decl_stmt|,
name|u
decl_stmt|;
name|t_text
operator|=
name|mkt_text
argument_list|()
expr_stmt|;
name|ct
operator|=
operator|*
name|Branch
argument_list|(
name|t
argument_list|,
name|COLL_SEQ
argument_list|)
expr_stmt|;
name|len
operator|=
name|Nfields
argument_list|(
name|ct
argument_list|)
expr_stmt|;
name|k_Over_len
block|{
name|polytype
name|ttag
decl_stmt|;
name|ttag
operator|=
name|mkt_var
argument_list|(
name|copy
argument_list|(
operator|*
name|Branch
argument_list|(
operator|*
name|Field
argument_list|(
name|ct
argument_list|,
name|k
argument_list|)
argument_list|,
name|TAG_NAME
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|add_var
argument_list|(
name|ttag
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|ttag
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|ttag
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
name|te
operator|=
name|pt_expr
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|te
argument_list|,
name|t_text
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|te
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_text
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tc_test
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tag
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tformal
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tlocal
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tglobal
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tmystery
parameter_list|(
name|name
parameter_list|,
name|number
parameter_list|)
name|value
name|name
decl_stmt|,
name|number
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_trefinement
parameter_list|(
name|name
parameter_list|)
name|value
name|name
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tfun
parameter_list|(
name|name
parameter_list|,
name|fct
parameter_list|)
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_tprd
parameter_list|(
name|name
parameter_list|,
name|fct
parameter_list|)
name|value
name|name
decl_stmt|,
name|fct
decl_stmt|;
block|{
name|tc_tag
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_monprd
parameter_list|(
name|name
parameter_list|,
name|r
parameter_list|,
name|pred
parameter_list|)
name|parsetree
name|r
decl_stmt|;
name|value
name|name
decl_stmt|,
name|pred
decl_stmt|;
block|{
name|p_release
argument_list|(
name|pt_expr
argument_list|(
name|r
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_dyaprd
parameter_list|(
name|l
parameter_list|,
name|name
parameter_list|,
name|r
parameter_list|,
name|pred
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
name|value
name|name
decl_stmt|,
name|pred
decl_stmt|;
block|{
name|polytype
name|tl
decl_stmt|,
name|tr
decl_stmt|;
name|tl
operator|=
name|pt_expr
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|tr
operator|=
name|pt_expr
argument_list|(
name|r
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_string
argument_list|(
name|name
argument_list|,
literal|"in"
argument_list|)
operator|||
name|is_string
argument_list|(
name|name
argument_list|,
literal|"not'in"
argument_list|)
condition|)
block|{
name|polytype
name|t_tlt_l
decl_stmt|,
name|u
decl_stmt|;
name|t_tlt_l
operator|=
name|mkt_tlt
argument_list|(
name|p_copy
argument_list|(
name|tl
argument_list|)
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tr
argument_list|,
name|t_tlt_l
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|t_tlt_l
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
name|p_release
argument_list|(
name|tl
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
name|Forward
name|polytype
name|pt_relop
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Hidden
name|Procedure
name|tc_relop
parameter_list|(
name|l
parameter_list|,
name|r
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
block|{
name|p_release
argument_list|(
name|pt_relop
argument_list|(
name|l
argument_list|,
name|r
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|pt_relop
parameter_list|(
name|l
parameter_list|,
name|r
parameter_list|)
name|parsetree
name|l
decl_stmt|,
name|r
decl_stmt|;
block|{
name|polytype
name|tl
decl_stmt|,
name|tr
decl_stmt|,
name|u
decl_stmt|;
if|if
condition|(
name|Comparison
argument_list|(
name|nodetype
argument_list|(
name|l
argument_list|)
argument_list|)
condition|)
name|tl
operator|=
name|pt_relop
argument_list|(
operator|*
name|Branch
argument_list|(
name|l
argument_list|,
name|REL_LEFT
argument_list|)
argument_list|,
operator|*
name|Branch
argument_list|(
name|l
argument_list|,
name|REL_RIGHT
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|tl
operator|=
name|pt_expr
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|tr
operator|=
name|pt_expr
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|unify
argument_list|(
name|tl
argument_list|,
name|tr
argument_list|,
operator|&
name|u
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tl
argument_list|)
expr_stmt|;
name|p_release
argument_list|(
name|tr
argument_list|)
expr_stmt|;
return|return
name|u
return|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tc_unparsed
parameter_list|(
name|c
parameter_list|,
name|t
parameter_list|)
name|parsetree
name|c
decl_stmt|,
name|t
decl_stmt|;
block|{}
end_function

begin_function
name|Hidden
name|Procedure
name|uni_bad
parameter_list|()
block|{
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2304
argument_list|,
literal|"bad uni node in type check"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|cmd_bad
parameter_list|()
block|{
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2305
argument_list|,
literal|"bad cmd node in type check"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|polytype
name|exp_bad
parameter_list|()
block|{
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2306
argument_list|,
literal|"bad exp node in type check"
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|polytype
operator|)
literal|0
return|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|tes_bad
parameter_list|()
block|{
name|syserr
argument_list|(
name|MESS
argument_list|(
literal|2307
argument_list|,
literal|"bad tes node in type check"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Visible
name|Procedure
name|inittyp
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TABSIZE
condition|;
name|i
operator|++
control|)
block|{
name|uni_tab
index|[
name|i
index|]
operator|=
name|uni_bad
expr_stmt|;
name|cmd_tab
index|[
name|i
index|]
operator|=
name|cmd_bad
expr_stmt|;
name|exp_tab
index|[
name|i
index|]
operator|=
name|exp_bad
expr_stmt|;
name|tes_tab
index|[
name|i
index|]
operator|=
name|tes_bad
expr_stmt|;
block|}
name|uni_tab
index|[
name|HOW_TO
index|]
operator|=
name|tc_howto_unit
expr_stmt|;
name|uni_tab
index|[
name|YIELD
index|]
operator|=
name|tc_yield_unit
expr_stmt|;
name|uni_tab
index|[
name|TEST
index|]
operator|=
name|tc_test_unit
expr_stmt|;
name|uni_tab
index|[
name|REFINEMENT
index|]
operator|=
name|tc_refinement
expr_stmt|;
name|cmd_tab
index|[
name|SUITE
index|]
operator|=
name|tc_suite
expr_stmt|;
name|cmd_tab
index|[
name|PUT
index|]
operator|=
name|tc_put
expr_stmt|;
name|cmd_tab
index|[
name|INSERT
index|]
operator|=
name|tc_ins_rem
expr_stmt|;
name|cmd_tab
index|[
name|REMOVE
index|]
operator|=
name|tc_ins_rem
expr_stmt|;
name|cmd_tab
index|[
name|CHOOSE
index|]
operator|=
name|tc_choose
expr_stmt|;
name|cmd_tab
index|[
name|DRAW
index|]
operator|=
name|tc_draw
expr_stmt|;
name|cmd_tab
index|[
name|SET_RANDOM
index|]
operator|=
name|tc_set_random
expr_stmt|;
name|cmd_tab
index|[
name|DELETE
index|]
operator|=
name|tc_delete
expr_stmt|;
name|cmd_tab
index|[
name|CHECK
index|]
operator|=
name|tc_check
expr_stmt|;
name|cmd_tab
index|[
name|SHARE
index|]
operator|=
name|tc_nothing
expr_stmt|;
name|cmd_tab
index|[
name|WRITE
index|]
operator|=
name|tc_write
expr_stmt|;
name|cmd_tab
index|[
name|READ
index|]
operator|=
name|tc_read
expr_stmt|;
name|cmd_tab
index|[
name|READ_RAW
index|]
operator|=
name|tc_raw_read
expr_stmt|;
name|cmd_tab
index|[
name|IF
index|]
operator|=
name|tc_ifwhile
expr_stmt|;
name|cmd_tab
index|[
name|WHILE
index|]
operator|=
name|tc_ifwhile
expr_stmt|;
name|cmd_tab
index|[
name|FOR
index|]
operator|=
name|tc_for
expr_stmt|;
name|cmd_tab
index|[
name|SELECT
index|]
operator|=
name|tc_select
expr_stmt|;
name|cmd_tab
index|[
name|TEST_SUITE
index|]
operator|=
name|tc_tes_suite
expr_stmt|;
name|cmd_tab
index|[
name|ELSE
index|]
operator|=
name|tc_else
expr_stmt|;
name|cmd_tab
index|[
name|QUIT
index|]
operator|=
name|tc_nothing
expr_stmt|;
name|cmd_tab
index|[
name|RETURN
index|]
operator|=
name|tc_return
expr_stmt|;
name|cmd_tab
index|[
name|REPORT
index|]
operator|=
name|tc_report
expr_stmt|;
name|cmd_tab
index|[
name|SUCCEED
index|]
operator|=
name|tc_nothing
expr_stmt|;
name|cmd_tab
index|[
name|FAIL
index|]
operator|=
name|tc_nothing
expr_stmt|;
name|cmd_tab
index|[
name|USER_COMMAND
index|]
operator|=
name|tc_user_command
expr_stmt|;
name|cmd_tab
index|[
name|EXTENDED_COMMAND
index|]
operator|=
name|tc_nothing
expr_stmt|;
name|exp_tab
index|[
name|TAG
index|]
operator|=
name|pt_tag
expr_stmt|;
name|tes_tab
index|[
name|TAG
index|]
operator|=
name|tc_tag
expr_stmt|;
name|exp_tab
index|[
name|TAGformal
index|]
operator|=
name|pt_tformal
expr_stmt|;
name|tes_tab
index|[
name|TAGformal
index|]
operator|=
name|tc_tformal
expr_stmt|;
name|exp_tab
index|[
name|TAGlocal
index|]
operator|=
name|pt_tlocal
expr_stmt|;
name|tes_tab
index|[
name|TAGlocal
index|]
operator|=
name|tc_tlocal
expr_stmt|;
name|exp_tab
index|[
name|TAGglobal
index|]
operator|=
name|pt_tglobal
expr_stmt|;
name|tes_tab
index|[
name|TAGglobal
index|]
operator|=
name|tc_tglobal
expr_stmt|;
name|exp_tab
index|[
name|TAGmystery
index|]
operator|=
name|pt_tmystery
expr_stmt|;
name|tes_tab
index|[
name|TAGmystery
index|]
operator|=
name|tc_tmystery
expr_stmt|;
name|exp_tab
index|[
name|TAGrefinement
index|]
operator|=
name|pt_trefinement
expr_stmt|;
name|tes_tab
index|[
name|TAGrefinement
index|]
operator|=
name|tc_trefinement
expr_stmt|;
name|exp_tab
index|[
name|TAGzerfun
index|]
operator|=
name|pt_tfun
expr_stmt|;
name|tes_tab
index|[
name|TAGzerfun
index|]
operator|=
name|tc_tfun
expr_stmt|;
name|exp_tab
index|[
name|TAGzerprd
index|]
operator|=
name|pt_tprd
expr_stmt|;
name|tes_tab
index|[
name|TAGzerprd
index|]
operator|=
name|tc_tprd
expr_stmt|;
name|exp_tab
index|[
name|COMPOUND
index|]
operator|=
name|pt_compound
expr_stmt|;
name|tes_tab
index|[
name|COMPOUND
index|]
operator|=
name|tc_compound
expr_stmt|;
name|exp_tab
index|[
name|COLLATERAL
index|]
operator|=
name|pt_collateral
expr_stmt|;
name|exp_tab
index|[
name|SELECTION
index|]
operator|=
name|pt_selection
expr_stmt|;
name|exp_tab
index|[
name|BEHEAD
index|]
operator|=
name|pt_trim
expr_stmt|;
name|exp_tab
index|[
name|CURTAIL
index|]
operator|=
name|pt_trim
expr_stmt|;
name|exp_tab
index|[
name|UNPARSED
index|]
operator|=
name|pt_unparsed
expr_stmt|;
name|tes_tab
index|[
name|UNPARSED
index|]
operator|=
name|tc_unparsed
expr_stmt|;
name|exp_tab
index|[
name|MONF
index|]
operator|=
name|pt_monf
expr_stmt|;
name|exp_tab
index|[
name|DYAF
index|]
operator|=
name|pt_dyaf
expr_stmt|;
name|exp_tab
index|[
name|NUMBER
index|]
operator|=
name|pt_number
expr_stmt|;
name|exp_tab
index|[
name|TEXT_DIS
index|]
operator|=
name|pt_text_dis
expr_stmt|;
name|exp_tab
index|[
name|ELT_DIS
index|]
operator|=
name|pt_elt_dis
expr_stmt|;
name|exp_tab
index|[
name|LIST_DIS
index|]
operator|=
name|pt_list_dis
expr_stmt|;
name|exp_tab
index|[
name|RANGE_DIS
index|]
operator|=
name|pt_range_dis
expr_stmt|;
name|exp_tab
index|[
name|TAB_DIS
index|]
operator|=
name|pt_tab_dis
expr_stmt|;
name|tes_tab
index|[
name|AND
index|]
operator|=
name|tc_junction
expr_stmt|;
name|tes_tab
index|[
name|OR
index|]
operator|=
name|tc_junction
expr_stmt|;
name|tes_tab
index|[
name|NOT
index|]
operator|=
name|tc_not
expr_stmt|;
name|tes_tab
index|[
name|SOME_IN
index|]
operator|=
name|tc_in_quantification
expr_stmt|;
name|tes_tab
index|[
name|EACH_IN
index|]
operator|=
name|tc_in_quantification
expr_stmt|;
name|tes_tab
index|[
name|NO_IN
index|]
operator|=
name|tc_in_quantification
expr_stmt|;
name|tes_tab
index|[
name|SOME_PARSING
index|]
operator|=
name|tc_p_quantification
expr_stmt|;
name|tes_tab
index|[
name|EACH_PARSING
index|]
operator|=
name|tc_p_quantification
expr_stmt|;
name|tes_tab
index|[
name|NO_PARSING
index|]
operator|=
name|tc_p_quantification
expr_stmt|;
name|tes_tab
index|[
name|MONPRD
index|]
operator|=
name|tc_monprd
expr_stmt|;
name|tes_tab
index|[
name|DYAPRD
index|]
operator|=
name|tc_dyaprd
expr_stmt|;
name|tes_tab
index|[
name|LESS_THAN
index|]
operator|=
name|tc_relop
expr_stmt|;
name|tes_tab
index|[
name|AT_MOST
index|]
operator|=
name|tc_relop
expr_stmt|;
name|tes_tab
index|[
name|GREATER_THAN
index|]
operator|=
name|tc_relop
expr_stmt|;
name|tes_tab
index|[
name|AT_LEAST
index|]
operator|=
name|tc_relop
expr_stmt|;
name|tes_tab
index|[
name|EQUAL
index|]
operator|=
name|tc_relop
expr_stmt|;
name|tes_tab
index|[
name|UNEQUAL
index|]
operator|=
name|tc_relop
expr_stmt|;
block|}
end_function

end_unit

