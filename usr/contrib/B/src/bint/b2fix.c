begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) Stichting Mathematisch Centrum, Amsterdam, 1985. */
end_comment

begin_comment
comment|/* $Header: b2fix.c,v 1.4 85/08/22 16:55:08 timo Exp $ */
end_comment

begin_comment
comment|/* Fix unparsed expr/test */
end_comment

begin_include
include|#
directive|include
file|"b.h"
end_include

begin_include
include|#
directive|include
file|"b1obj.h"
end_include

begin_include
include|#
directive|include
file|"b2exp.h"
end_include

begin_include
include|#
directive|include
file|"b2nod.h"
end_include

begin_include
include|#
directive|include
file|"b2gen.h"
end_include

begin_comment
comment|/* Must be after b2nod.h */
end_comment

begin_include
include|#
directive|include
file|"b2par.h"
end_include

begin_comment
comment|/* For is_b_tag */
end_comment

begin_include
include|#
directive|include
file|"b3err.h"
end_include

begin_include
include|#
directive|include
file|"b3env.h"
end_include

begin_include
include|#
directive|include
file|"b3sem.h"
end_include

begin_decl_stmt
name|Forward
name|parsetree
name|fix_expr
argument_list|()
decl_stmt|,
name|fix_test
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
name|Visible
name|Procedure
name|f_eunparsed
parameter_list|(
name|pt
parameter_list|)
name|parsetree
modifier|*
name|pt
decl_stmt|;
block|{
name|f_unparsed
argument_list|(
name|pt
argument_list|,
name|fix_expr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Visible
name|Procedure
name|f_cunparsed
parameter_list|(
name|pt
parameter_list|)
name|parsetree
modifier|*
name|pt
decl_stmt|;
block|{
name|f_unparsed
argument_list|(
name|pt
argument_list|,
name|fix_test
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
name|Hidden
name|Procedure
name|f_unparsed
argument_list|(
name|pt
argument_list|,
name|fct
argument_list|)
name|parsetree
modifier|*
name|pt
decl_stmt|,
argument_list|(
operator|*
name|fct
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|parsetree
name|t
init|=
operator|*
name|pt
decl_stmt|;
name|unpadm
name|adm
decl_stmt|;
name|struct
name|state
name|v
decl_stmt|;
comment|/* Ignore visits done during resolving UNPARSED: */
name|hold
argument_list|(
operator|&
name|v
argument_list|)
expr_stmt|;
name|initunp
argument_list|(
operator|&
name|adm
argument_list|,
operator|*
name|Branch
argument_list|(
name|t
argument_list|,
name|UNP_SEQ
argument_list|)
argument_list|)
expr_stmt|;
name|t
operator|=
call|(
modifier|*
name|fct
call|)
argument_list|(
operator|&
name|adm
argument_list|)
expr_stmt|;
name|release
argument_list|(
operator|*
name|pt
argument_list|)
expr_stmt|;
operator|*
name|pt
operator|=
name|t
expr_stmt|;
name|jumpto
argument_list|(
name|NilTree
argument_list|)
expr_stmt|;
name|let_go
argument_list|(
operator|&
name|v
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_define
define|#
directive|define
name|Fld
value|*Field(Node(adm), N_fld(adm))
end_define

begin_define
define|#
directive|define
name|Is_fld
value|(N_fld(adm)< Nfields(Node(adm)))
end_define

begin_define
define|#
directive|define
name|Get_fld
parameter_list|(
name|v
parameter_list|)
value|v= copy(Fld); N_fld(adm)++
end_define

begin_function
name|Hidden
name|Procedure
name|initunp
parameter_list|(
name|adm
parameter_list|,
name|root
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
name|value
name|root
decl_stmt|;
block|{
name|Prop
argument_list|(
name|adm
argument_list|)
operator|=
name|No
expr_stmt|;
name|Node
argument_list|(
name|adm
argument_list|)
operator|=
name|root
expr_stmt|;
name|N_fld
argument_list|(
name|adm
argument_list|)
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function
name|Hidden
name|bool
name|f_dyafun
parameter_list|(
name|v
parameter_list|,
name|s
parameter_list|,
name|fct
parameter_list|)
name|value
name|v
decl_stmt|,
decl|*
name|fct
decl_stmt|;
end_function

begin_decl_stmt
name|string
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|value
name|t
init|=
name|Vnil
decl_stmt|;
name|bool
name|is
init|=
name|Is_text
argument_list|(
name|v
argument_list|)
operator|&&
name|compare
argument_list|(
name|v
argument_list|,
name|t
operator|=
name|mk_text
argument_list|(
name|s
argument_list|)
argument_list|)
operator|==
literal|0
operator|&&
name|is_dyafun
argument_list|(
name|v
argument_list|,
name|fct
argument_list|)
decl_stmt|;
name|release
argument_list|(
name|t
argument_list|)
expr_stmt|;
return|return
name|is
return|;
block|}
end_block

begin_function
name|Hidden
name|bool
name|f_dyatag
parameter_list|(
name|v
parameter_list|,
name|fct
parameter_list|)
name|value
name|v
decl_stmt|,
decl|*
name|fct
decl_stmt|;
end_function

begin_block
block|{
return|return
name|Is_text
argument_list|(
name|v
argument_list|)
operator|&&
name|is_b_tag
argument_list|(
name|v
argument_list|)
operator|&&
name|is_dyafun
argument_list|(
name|v
argument_list|,
name|fct
argument_list|)
return|;
block|}
end_block

begin_function
name|Visible
name|bool
name|is_b_tag
parameter_list|(
name|v
parameter_list|)
name|value
name|v
decl_stmt|;
block|{
name|value
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|;
name|bool
name|x
decl_stmt|;
comment|/* REPORT v|1 in {'a' .. 'z'} */
name|a
operator|=
name|mk_charrange
argument_list|(
name|b
operator|=
name|mk_text
argument_list|(
literal|"a"
argument_list|)
argument_list|,
name|c
operator|=
name|mk_text
argument_list|(
literal|"z"
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|x
operator|=
name|in
argument_list|(
name|b
operator|=
name|curtail
argument_list|(
name|v
argument_list|,
name|one
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|b
argument_list|)
expr_stmt|;
return|return
name|x
return|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_decl_stmt
name|Hidden
name|Procedure
name|fix_formula
argument_list|(
name|adm
argument_list|,
name|v
argument_list|,
name|fct
argument_list|,
name|lev
argument_list|,
name|right
argument_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|parsetree
modifier|*
name|v
decl_stmt|,
argument_list|(
operator|*
name|right
argument_list|)
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|value
name|fct
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|intlet
name|lev
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|parsetree
name|w
decl_stmt|;
name|value
name|name
decl_stmt|;
if|if
condition|(
name|Level
argument_list|(
name|adm
argument_list|)
operator|<
name|lev
condition|)
name|fixerr
argument_list|(
name|Prio
argument_list|)
expr_stmt|;
name|Get_fld
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|w
operator|=
call|(
modifier|*
name|right
call|)
argument_list|(
name|adm
argument_list|)
expr_stmt|;
if|if
condition|(
name|Trim
argument_list|(
name|adm
argument_list|)
condition|)
operator|*
name|v
operator|=
name|node3
argument_list|(
name|b_behead
argument_list|(
name|name
argument_list|)
condition|?
name|BEHEAD
else|:
name|CURTAIL
argument_list|,
operator|*
name|v
argument_list|,
name|w
argument_list|)
expr_stmt|;
else|else
operator|*
name|v
operator|=
name|node5
argument_list|(
name|DYAF
argument_list|,
operator|*
name|v
argument_list|,
name|name
argument_list|,
name|w
argument_list|,
name|copy
argument_list|(
name|fct
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function
name|Hidden
name|bool
name|b_expr_opr
parameter_list|(
name|v
parameter_list|,
name|fct
parameter_list|)
name|value
name|v
decl_stmt|,
decl|*
name|fct
decl_stmt|;
end_function

begin_block
block|{
return|return
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"^^"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"><"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"<<"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|">>"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyatag
argument_list|(
name|v
argument_list|,
name|fct
argument_list|)
return|;
block|}
end_block

begin_decl_stmt
name|Forward
name|parsetree
name|fix_term
argument_list|()
decl_stmt|,
name|fix_factor
argument_list|()
decl_stmt|,
name|fix_primary
argument_list|()
decl_stmt|,
name|fix_base
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
name|Hidden
name|parsetree
name|fix_expr
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|fct
decl_stmt|;
if|if
condition|(
operator|!
name|Is_fld
condition|)
block|{
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4700
argument_list|,
literal|"no expression where expected"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|NilTree
return|;
block|}
name|v
operator|=
name|fix_term
argument_list|(
name|adm
argument_list|)
expr_stmt|;
if|if
condition|(
name|Is_fld
operator|&&
name|b_expr_opr
argument_list|(
name|Fld
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
block|{
if|if
condition|(
name|nodetype
argument_list|(
name|v
argument_list|)
operator|==
name|DYAF
condition|)
name|fixerr
argument_list|(
name|Prio
argument_list|)
expr_stmt|;
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_expr
argument_list|,
name|fix_base
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Is_fld
operator|&&
operator|!
name|Prop
argument_list|(
name|adm
argument_list|)
condition|)
block|{
name|value
name|f
decl_stmt|;
if|if
condition|(
name|Is_text
argument_list|(
name|Fld
argument_list|)
operator|&&
name|is_dyafun
argument_list|(
name|Fld
argument_list|,
operator|&
name|f
argument_list|)
condition|)
name|fixerr
argument_list|(
name|Prio
argument_list|)
expr_stmt|;
else|else
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4701
argument_list|,
literal|"something unexpected following expression"
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|v
return|;
block|}
end_function

begin_function
name|Hidden
name|parsetree
name|fix_test
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|w
init|=
name|Vnil
decl_stmt|,
name|f
init|=
name|Vnil
decl_stmt|;
name|value
modifier|*
name|aa
decl_stmt|;
if|if
condition|(
operator|!
name|Is_fld
condition|)
block|{
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4702
argument_list|,
literal|"no test where expected"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|NilTree
return|;
block|}
if|if
condition|(
name|Is_text
argument_list|(
name|Fld
argument_list|)
condition|)
block|{
name|Get_fld
argument_list|(
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_zerprd
argument_list|(
name|v
argument_list|,
operator|&
name|f
argument_list|)
condition|)
block|{
if|if
condition|(
name|Is_fld
condition|)
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4703
argument_list|,
literal|"something unexpected following test"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|node3
argument_list|(
name|TAGzerprd
argument_list|,
name|v
argument_list|,
name|copydef
argument_list|(
name|f
argument_list|)
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|aa
operator|=
name|envassoc
argument_list|(
name|refinements
argument_list|,
name|v
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|Is_fld
condition|)
return|return
name|node3
argument_list|(
name|TAGrefinement
argument_list|,
name|v
argument_list|,
name|copy
argument_list|(
operator|*
name|aa
argument_list|)
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|is_monprd
argument_list|(
name|v
argument_list|,
operator|&
name|f
argument_list|)
condition|)
return|return
name|node4
argument_list|(
name|MONPRD
argument_list|,
name|v
argument_list|,
name|fix_expr
argument_list|(
name|adm
argument_list|)
argument_list|,
name|copydef
argument_list|(
name|f
argument_list|)
argument_list|)
return|;
name|release
argument_list|(
name|v
argument_list|)
expr_stmt|;
name|N_fld
argument_list|(
name|adm
argument_list|)
operator|--
expr_stmt|;
block|}
name|Prop
argument_list|(
name|adm
argument_list|)
operator|=
name|Yes
expr_stmt|;
name|v
operator|=
name|fix_expr
argument_list|(
name|adm
argument_list|)
expr_stmt|;
name|Prop
argument_list|(
name|adm
argument_list|)
operator|=
name|No
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|Is_fld
operator|&&
name|Is_text
argument_list|(
name|Fld
argument_list|)
operator|&&
name|is_dyaprd
argument_list|(
name|Fld
argument_list|,
operator|&
name|f
argument_list|)
operator|)
condition|)
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4704
argument_list|,
literal|"no test where expected"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|Is_fld
condition|)
name|Get_fld
argument_list|(
name|w
argument_list|)
expr_stmt|;
return|return
name|node5
argument_list|(
name|DYAPRD
argument_list|,
name|v
argument_list|,
name|w
argument_list|,
name|fix_expr
argument_list|(
name|adm
argument_list|)
argument_list|,
name|copydef
argument_list|(
name|f
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function
name|Hidden
name|bool
name|b_term_opr
parameter_list|(
name|v
parameter_list|,
name|fct
parameter_list|)
name|value
name|v
decl_stmt|,
decl|*
name|fct
decl_stmt|;
end_function

begin_block
block|{
return|return
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"+"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"-"
argument_list|,
name|fct
argument_list|)
operator|||
name|f_dyafun
argument_list|(
name|v
argument_list|,
literal|"^"
argument_list|,
name|fct
argument_list|)
return|;
block|}
end_block

begin_function
name|Hidden
name|parsetree
name|fix_term
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|fct
decl_stmt|;
name|v
operator|=
name|fix_factor
argument_list|(
name|adm
argument_list|)
expr_stmt|;
while|while
condition|(
name|Is_fld
operator|&&
name|b_term_opr
argument_list|(
name|Fld
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_term
argument_list|,
name|fix_factor
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function
name|Hidden
name|parsetree
name|fix_factor
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|fct
decl_stmt|;
name|v
operator|=
name|fix_primary
argument_list|(
name|adm
argument_list|)
expr_stmt|;
while|while
condition|(
name|Is_fld
operator|&&
name|f_dyafun
argument_list|(
name|Fld
argument_list|,
literal|"*"
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_factor
argument_list|,
name|fix_primary
argument_list|)
expr_stmt|;
if|if
condition|(
name|Is_fld
operator|&&
name|f_dyafun
argument_list|(
name|Fld
argument_list|,
literal|"/"
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_factor
argument_list|,
name|fix_primary
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function
name|Hidden
name|parsetree
name|fix_primary
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|;
name|value
name|fct
decl_stmt|;
name|v
operator|=
name|fix_base
argument_list|(
name|adm
argument_list|)
expr_stmt|;
if|if
condition|(
name|Is_fld
operator|&&
name|f_dyafun
argument_list|(
name|Fld
argument_list|,
literal|"#"
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_number
argument_list|,
name|fix_base
argument_list|)
expr_stmt|;
if|if
condition|(
name|Is_fld
operator|&&
name|f_dyafun
argument_list|(
name|Fld
argument_list|,
literal|"**"
argument_list|,
operator|&
name|fct
argument_list|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|,
name|fct
argument_list|,
name|L_power
argument_list|,
name|fix_base
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_comment
comment|/* ********************************************************************	*/
end_comment

begin_function_decl
name|Forward
name|parsetree
name|fix_rbase
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Hidden
name|parsetree
name|fix_base
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|Level
argument_list|(
name|adm
argument_list|)
operator|=
name|L_expr
expr_stmt|;
name|Trim
argument_list|(
name|adm
argument_list|)
operator|=
name|No
expr_stmt|;
return|return
name|fix_rbase
argument_list|(
name|adm
argument_list|)
return|;
block|}
end_function

begin_function_decl
name|Forward
name|parsetree
name|fix_monadic
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|Hidden
name|parsetree
name|fix_rbase
parameter_list|(
name|adm
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
block|{
name|parsetree
name|v
decl_stmt|,
name|w
init|=
name|NilTree
decl_stmt|;
name|value
name|f
decl_stmt|;
if|if
condition|(
operator|!
name|Is_fld
operator|&&
operator|!
name|Prop
argument_list|(
name|adm
argument_list|)
condition|)
block|{
name|fixerr
argument_list|(
name|MESS
argument_list|(
literal|4705
argument_list|,
literal|"no expression where expected"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|NilTree
return|;
block|}
if|if
condition|(
name|Is_parsetree
argument_list|(
name|Fld
argument_list|)
condition|)
block|{
name|f_expr
argument_list|(
name|Branch
argument_list|(
name|Node
argument_list|(
name|adm
argument_list|)
argument_list|,
name|N_fld
argument_list|(
name|adm
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Get_fld
argument_list|(
name|v
argument_list|)
expr_stmt|;
name|fix_trim
argument_list|(
name|adm
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
return|return
name|v
return|;
block|}
name|Get_fld
argument_list|(
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|modify_tag
argument_list|(
name|v
argument_list|,
operator|&
name|w
argument_list|)
condition|)
name|fix_trim
argument_list|(
name|adm
argument_list|,
operator|&
name|w
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|is_monfun
argument_list|(
name|v
argument_list|,
operator|&
name|f
argument_list|)
condition|)
name|w
operator|=
name|fix_monadic
argument_list|(
name|adm
argument_list|,
name|v
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
block|{
name|fixerr2
argument_list|(
name|v
argument_list|,
name|MESS
argument_list|(
literal|4706
argument_list|,
literal|" has not yet received a value"
argument_list|)
argument_list|)
expr_stmt|;
name|release
argument_list|(
name|v
argument_list|)
expr_stmt|;
block|}
return|return
name|w
return|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|adjust_level
parameter_list|(
name|adm
parameter_list|,
name|lev
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
name|intlet
name|lev
decl_stmt|;
block|{
if|if
condition|(
name|lev
operator|<
name|Level
argument_list|(
name|adm
argument_list|)
condition|)
name|Level
argument_list|(
name|adm
argument_list|)
operator|=
name|lev
expr_stmt|;
block|}
end_function

begin_function
name|Hidden
name|parsetree
name|fix_monadic
parameter_list|(
name|adm
parameter_list|,
name|v
parameter_list|,
name|fct
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
name|value
name|v
decl_stmt|,
name|fct
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|Trim
argument_list|(
name|adm
argument_list|)
condition|)
block|{
if|if
condition|(
name|b_minus
argument_list|(
name|v
argument_list|)
condition|)
name|adjust_level
argument_list|(
name|adm
argument_list|,
name|L_factor
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|b_number
argument_list|(
name|v
argument_list|)
condition|)
name|adjust_level
argument_list|(
name|adm
argument_list|,
name|L_power
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|b_plus
argument_list|(
name|v
argument_list|)
operator|||
name|b_about
argument_list|(
name|v
argument_list|)
operator|)
condition|)
name|adjust_level
argument_list|(
name|adm
argument_list|,
name|L_bottom
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|Trim
argument_list|(
name|adm
argument_list|)
operator|&&
name|b_minus
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|intlet
name|lev
init|=
name|Level
argument_list|(
name|adm
argument_list|)
decl_stmt|;
name|parsetree
name|t
init|=
name|node4
argument_list|(
name|MONF
argument_list|,
name|v
argument_list|,
name|fix_primary
argument_list|(
name|adm
argument_list|)
argument_list|,
name|copydef
argument_list|(
name|fct
argument_list|)
argument_list|)
decl_stmt|;
name|adjust_level
argument_list|(
name|adm
argument_list|,
name|lev
argument_list|)
expr_stmt|;
return|return
name|t
return|;
block|}
else|else
return|return
name|node4
argument_list|(
name|MONF
argument_list|,
name|v
argument_list|,
name|fix_rbase
argument_list|(
name|adm
argument_list|)
argument_list|,
name|copydef
argument_list|(
name|fct
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|Hidden
name|Procedure
name|fix_trim
parameter_list|(
name|adm
parameter_list|,
name|v
parameter_list|)
name|unpadm
modifier|*
name|adm
decl_stmt|;
name|parsetree
modifier|*
name|v
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|Trim
argument_list|(
name|adm
argument_list|)
condition|)
block|{
name|Trim
argument_list|(
name|adm
argument_list|)
operator|=
name|Yes
expr_stmt|;
while|while
condition|(
name|Is_fld
operator|&&
operator|(
name|b_behead
argument_list|(
name|Fld
argument_list|)
operator|||
name|b_curtail
argument_list|(
name|Fld
argument_list|)
operator|)
condition|)
name|fix_formula
argument_list|(
name|adm
argument_list|,
name|v
argument_list|,
name|Vnil
argument_list|,
name|L_bottom
argument_list|,
name|fix_rbase
argument_list|)
expr_stmt|;
name|Trim
argument_list|(
name|adm
argument_list|)
operator|=
name|No
expr_stmt|;
block|}
block|}
end_function

end_unit

