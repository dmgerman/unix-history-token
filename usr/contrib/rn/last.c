begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $Header: last.c,v 4.3 85/05/01 11:42:16 lwall Exp $  *  * $Log:	last.c,v $  * Revision 4.3  85/05/01  11:42:16  lwall  * Baseline for release with 4.3bsd.  *   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"rn.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_include
include|#
directive|include
file|"intrp.h"
end_include

begin_include
include|#
directive|include
file|"INTERN.h"
end_include

begin_include
include|#
directive|include
file|"last.h"
end_include

begin_decl_stmt
name|char
modifier|*
name|lastname
init|=
name|Nullch
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* path name of .rnlast file */
end_comment

begin_function
name|void
name|last_init
parameter_list|(
name|tcbuf
parameter_list|)
name|char
modifier|*
name|tcbuf
decl_stmt|;
block|{
name|lastname
operator|=
name|savestr
argument_list|(
name|filexp
argument_list|(
name|LASTNAME
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|tmpfp
operator|=
name|fopen
argument_list|(
name|lastname
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|!=
name|Nullfp
condition|)
block|{
name|fgets
argument_list|(
name|tcbuf
argument_list|,
literal|1024
argument_list|,
name|tmpfp
argument_list|)
expr_stmt|;
name|tcbuf
index|[
name|strlen
argument_list|(
name|tcbuf
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|lastngname
operator|=
name|savestr
argument_list|(
name|tcbuf
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|tcbuf
argument_list|,
literal|1024
argument_list|,
name|tmpfp
argument_list|)
expr_stmt|;
name|lasttime
operator|=
name|atol
argument_list|(
name|tcbuf
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|tcbuf
argument_list|,
literal|1024
argument_list|,
name|tmpfp
argument_list|)
expr_stmt|;
name|lastactsiz
operator|=
name|atol
argument_list|(
name|tcbuf
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|tmpfp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|lastngname
operator|=
name|nullstr
expr_stmt|;
name|lasttime
operator|=
literal|0
expr_stmt|;
name|lastactsiz
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* put out certain values for next run of rn */
end_comment

begin_function
name|void
name|writelast
parameter_list|()
block|{
if|if
condition|(
operator|(
name|tmpfp
operator|=
name|fopen
argument_list|(
name|lastname
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|!=
name|Nullfp
condition|)
block|{
name|fprintf
argument_list|(
name|tmpfp
argument_list|,
literal|"%s\n%ld\n%ld\n"
argument_list|,
name|ngname
argument_list|,
operator|(
name|long
operator|)
name|lasttime
argument_list|,
operator|(
name|long
operator|)
name|lastactsiz
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|tmpfp
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
argument|cantcreate
argument_list|,
argument|lastname
argument_list|)
name|FLUSH
expr_stmt|;
block|}
end_function

end_unit

