begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_comment
comment|/*  * set teletype modes  */
end_comment

begin_comment
comment|/*  * tty flags  */
end_comment

begin_define
define|#
directive|define
name|HUPCL
value|01
end_define

begin_define
define|#
directive|define
name|XTABS
value|02
end_define

begin_define
define|#
directive|define
name|LCASE
value|04
end_define

begin_define
define|#
directive|define
name|ECHO
value|010
end_define

begin_define
define|#
directive|define
name|CRMOD
value|020
end_define

begin_define
define|#
directive|define
name|RAW
value|040
end_define

begin_define
define|#
directive|define
name|ODDP
value|0100
end_define

begin_define
define|#
directive|define
name|EVENP
value|0200
end_define

begin_define
define|#
directive|define
name|ANYP
value|0300
end_define

begin_comment
comment|/*  * Delay algorithms  */
end_comment

begin_define
define|#
directive|define
name|CR0
value|0
end_define

begin_define
define|#
directive|define
name|CR1
value|010000
end_define

begin_define
define|#
directive|define
name|CR2
value|020000
end_define

begin_define
define|#
directive|define
name|CR3
value|030000
end_define

begin_define
define|#
directive|define
name|NL0
value|0
end_define

begin_define
define|#
directive|define
name|NL1
value|000400
end_define

begin_define
define|#
directive|define
name|NL2
value|001000
end_define

begin_define
define|#
directive|define
name|NL3
value|001400
end_define

begin_define
define|#
directive|define
name|TAB0
value|0
end_define

begin_define
define|#
directive|define
name|TAB1
value|002000
end_define

begin_define
define|#
directive|define
name|TAB2
value|004000
end_define

begin_define
define|#
directive|define
name|TAB3
value|006000
end_define

begin_define
define|#
directive|define
name|FF0
value|0
end_define

begin_define
define|#
directive|define
name|FF1
value|040000
end_define

begin_define
define|#
directive|define
name|BS0
value|0
end_define

begin_define
define|#
directive|define
name|BS1
value|0100000
end_define

begin_define
define|#
directive|define
name|ALL
value|0177400
end_define

begin_struct
struct|struct
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|speed
decl_stmt|;
block|}
name|speeds
index|[]
block|{
literal|"0"
operator|,
operator|(
literal|0
operator|<<
literal|8
operator|)
operator||
literal|0
operator|,
literal|"50"
operator|,
operator|(
literal|1
operator|<<
literal|8
operator|)
operator||
literal|1
operator|,
literal|"75"
operator|,
operator|(
literal|2
operator|<<
literal|8
operator|)
operator||
literal|2
operator|,
literal|"110"
operator|,
operator|(
literal|3
operator|<<
literal|8
operator|)
operator||
literal|3
operator|,
literal|"134"
operator|,
operator|(
literal|4
operator|<<
literal|8
operator|)
operator||
literal|4
operator|,
literal|"134.5"
operator|,
operator|(
literal|4
operator|<<
literal|8
operator|)
operator||
literal|4
operator|,
literal|"150"
operator|,
operator|(
literal|5
operator|<<
literal|8
operator|)
operator||
literal|5
operator|,
literal|"200"
operator|,
operator|(
literal|6
operator|<<
literal|8
operator|)
operator||
literal|6
operator|,
literal|"300"
operator|,
operator|(
literal|7
operator|<<
literal|8
operator|)
operator||
literal|7
operator|,
literal|"600"
operator|,
operator|(
literal|8
operator|<<
literal|8
operator|)
operator||
literal|8
operator|,
literal|"1200"
operator|,
operator|(
literal|9
operator|<<
literal|8
operator|)
operator||
literal|9
operator|,
literal|"1800"
operator|,
operator|(
literal|10
operator|<<
literal|8
operator|)
operator||
literal|10
operator|,
literal|"2400"
operator|,
operator|(
literal|11
operator|<<
literal|8
operator|)
operator||
literal|11
operator|,
literal|"4800"
operator|,
operator|(
literal|12
operator|<<
literal|8
operator|)
operator||
literal|12
operator|,
literal|"9600"
operator|,
operator|(
literal|13
operator|<<
literal|8
operator|)
operator||
literal|13
operator|,
literal|"exta"
operator|,
operator|(
literal|14
operator|<<
literal|8
operator|)
operator||
literal|14
operator|,
literal|"extb"
operator|,
operator|(
literal|15
operator|<<
literal|8
operator|)
operator||
literal|15
operator|,
literal|0
operator|,
block|}
struct|;
end_struct

begin_struct
struct|struct
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|set
decl_stmt|;
name|int
name|reset
decl_stmt|;
block|}
name|modes
index|[]
block|{
literal|"even"
operator|,
name|EVENP
operator|,
literal|0
operator|,
literal|"-even"
operator|,
literal|0
operator|,
name|EVENP
operator|,
literal|"odd"
operator|,
name|ODDP
operator|,
literal|0
operator|,
literal|"-odd"
operator|,
literal|0
operator|,
name|ODDP
operator|,
literal|"raw"
operator|,
name|RAW
operator|,
literal|0
operator|,
literal|"-raw"
operator|,
literal|0
operator|,
name|RAW
operator|,
literal|"cooked"
operator|,
literal|0
operator|,
name|RAW
operator|,
literal|"-nl"
operator|,
name|CRMOD
operator|,
literal|0
operator|,
literal|"nl"
operator|,
literal|0
operator|,
name|CRMOD
operator|,
literal|"echo"
operator|,
name|ECHO
operator|,
literal|0
operator|,
literal|"-echo"
operator|,
literal|0
operator|,
name|ECHO
operator|,
literal|"LCASE"
operator|,
name|LCASE
operator|,
literal|0
operator|,
literal|"lcase"
operator|,
name|LCASE
operator|,
literal|0
operator|,
literal|"-LCASE"
operator|,
literal|0
operator|,
name|LCASE
operator|,
literal|"-lcase"
operator|,
literal|0
operator|,
name|LCASE
operator|,
literal|"-tabs"
operator|,
name|XTABS
operator|,
literal|0
operator|,
literal|"tabs"
operator|,
literal|0
operator|,
name|XTABS
operator|,
literal|"hup"
operator|,
name|HUPCL
operator|,
literal|0
operator|,
literal|"-hup"
operator|,
literal|0
operator|,
name|HUPCL
operator|,
literal|"cr0"
operator|,
name|CR0
operator|,
name|CR3
operator|,
literal|"cr1"
operator|,
name|CR1
operator|,
name|CR3
operator|,
literal|"cr2"
operator|,
name|CR2
operator|,
name|CR3
operator|,
literal|"cr3"
operator|,
name|CR3
operator|,
name|CR3
operator|,
literal|"tab0"
operator|,
name|TAB0
operator|,
name|TAB3
operator|,
literal|"tab1"
operator|,
name|TAB1
operator|,
name|TAB3
operator|,
literal|"tab2"
operator|,
name|TAB2
operator|,
name|TAB3
operator|,
literal|"tab3"
operator|,
name|TAB3
operator|,
name|TAB3
operator|,
literal|"nl0"
operator|,
name|NL0
operator|,
name|NL3
operator|,
literal|"nl1"
operator|,
name|NL1
operator|,
name|NL3
operator|,
literal|"nl2"
operator|,
name|NL2
operator|,
name|NL3
operator|,
literal|"nl3"
operator|,
name|NL3
operator|,
name|NL3
operator|,
literal|"ff0"
operator|,
name|FF0
operator|,
name|FF1
operator|,
literal|"ff1"
operator|,
name|FF1
operator|,
name|FF1
operator|,
literal|"bs0"
operator|,
name|BS0
operator|,
name|BS1
operator|,
literal|"bs1"
operator|,
name|BS1
operator|,
name|BS1
operator|,
literal|"33"
operator|,
name|CR1
operator|,
name|ALL
operator|,
literal|"tty33"
operator|,
name|CR1
operator|,
name|ALL
operator|,
literal|"37"
operator|,
name|FF1
operator|+
name|CR2
operator|+
name|TAB1
operator|+
name|NL1
operator|,
name|ALL
operator|,
literal|"tty37"
operator|,
name|FF1
operator|+
name|CR2
operator|+
name|TAB1
operator|+
name|NL1
operator|,
name|ALL
operator|,
literal|"05"
operator|,
name|NL2
operator|,
name|ALL
operator|,
literal|"vt05"
operator|,
name|NL2
operator|,
name|ALL
operator|,
literal|"tn"
operator|,
name|CR1
operator|,
name|ALL
operator|,
literal|"tn300"
operator|,
name|CR1
operator|,
name|ALL
operator|,
literal|"ti"
operator|,
name|CR2
operator|,
name|ALL
operator|,
literal|"ti700"
operator|,
name|CR2
operator|,
name|ALL
operator|,
literal|"tek"
operator|,
name|FF1
operator|,
name|ALL
operator|,
literal|0
operator|,
block|}
struct|;
end_struct

begin_decl_stmt
name|char
modifier|*
name|arg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mode
index|[
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
block|{
name|char
name|lobyte
decl_stmt|,
name|hibyte
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|gtty
argument_list|(
literal|1
argument_list|,
name|mode
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
block|{
name|prmodes
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|--
name|argc
operator|>
literal|0
condition|)
block|{
name|arg
operator|=
operator|*
operator|++
name|argv
expr_stmt|;
if|if
condition|(
name|eq
argument_list|(
literal|"ek"
argument_list|)
condition|)
name|mode
index|[
literal|1
index|]
operator|=
literal|'#@'
expr_stmt|;
if|if
condition|(
name|eq
argument_list|(
literal|"erase"
argument_list|)
condition|)
block|{
name|mode
index|[
literal|1
index|]
operator|.
name|lobyte
operator|=
operator|*
operator|*
operator|++
name|argv
expr_stmt|;
name|argc
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"kill"
argument_list|)
condition|)
block|{
name|mode
index|[
literal|1
index|]
operator|.
name|hibyte
operator|=
operator|*
operator|*
operator|++
name|argv
expr_stmt|;
name|argc
operator|--
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|speeds
index|[
name|i
index|]
operator|.
name|string
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|eq
argument_list|(
name|speeds
index|[
name|i
index|]
operator|.
name|string
argument_list|)
condition|)
name|mode
index|[
literal|0
index|]
operator|=
name|speeds
index|[
name|i
index|]
operator|.
name|speed
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|modes
index|[
name|i
index|]
operator|.
name|string
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|eq
argument_list|(
name|modes
index|[
name|i
index|]
operator|.
name|string
argument_list|)
condition|)
block|{
name|mode
index|[
literal|2
index|]
operator|=
operator|&
operator|~
name|modes
index|[
name|i
index|]
operator|.
name|reset
expr_stmt|;
name|mode
index|[
literal|2
index|]
operator|=
operator||
name|modes
index|[
name|i
index|]
operator|.
name|set
expr_stmt|;
block|}
if|if
condition|(
name|arg
condition|)
name|printf
argument_list|(
literal|"unknown mode: %s\n"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
name|stty
argument_list|(
literal|1
argument_list|,
name|mode
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|eq
argument_list|(
argument|string
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|arg
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|i
operator|=
literal|0
expr_stmt|;
name|loop
label|:
if|if
condition|(
name|arg
index|[
name|i
index|]
operator|!=
name|string
index|[
name|i
index|]
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|arg
index|[
name|i
operator|++
index|]
operator|!=
literal|'\0'
condition|)
goto|goto
name|loop
goto|;
name|arg
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|prmodes
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|m
expr_stmt|;
if|if
condition|(
name|mode
index|[
literal|0
index|]
operator|.
name|lobyte
operator|!=
name|mode
index|[
literal|0
index|]
operator|.
name|hibyte
condition|)
block|{
name|prspeed
argument_list|(
literal|"input speed  "
argument_list|,
name|mode
index|[
literal|0
index|]
operator|.
name|lobyte
argument_list|)
expr_stmt|;
name|prspeed
argument_list|(
literal|"output speed "
argument_list|,
name|mode
index|[
literal|0
index|]
operator|.
name|hibyte
argument_list|)
expr_stmt|;
block|}
else|else
name|prspeed
argument_list|(
literal|"speed "
argument_list|,
name|mode
index|[
literal|0
index|]
operator|.
name|lobyte
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"erase = '%c'; kill = '%c'\n"
argument_list|,
name|mode
index|[
literal|1
index|]
operator|.
name|lobyte
argument_list|,
name|mode
index|[
literal|1
index|]
operator|.
name|hibyte
argument_list|)
expr_stmt|;
name|m
operator|=
name|mode
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|0200
condition|)
name|printf
argument_list|(
literal|"even "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|0100
condition|)
name|printf
argument_list|(
literal|"odd "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|040
condition|)
name|printf
argument_list|(
literal|"raw "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|020
condition|)
name|printf
argument_list|(
literal|"-nl "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|010
condition|)
name|printf
argument_list|(
literal|"echo "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|04
condition|)
name|printf
argument_list|(
literal|"lcase "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|02
condition|)
name|printf
argument_list|(
literal|"-tabs "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
literal|01
condition|)
name|printf
argument_list|(
literal|"hup "
argument_list|)
expr_stmt|;
name|delay
argument_list|(
name|m
operator|>>
literal|8
argument_list|,
literal|"nl"
argument_list|)
expr_stmt|;
name|delay
argument_list|(
name|m
operator|>>
literal|10
argument_list|,
literal|"tab"
argument_list|)
expr_stmt|;
name|delay
argument_list|(
name|m
operator|>>
literal|12
argument_list|,
literal|"cr"
argument_list|)
expr_stmt|;
name|delay
argument_list|(
operator|(
name|m
operator|>>
literal|14
operator|)
operator|&
literal|1
argument_list|,
literal|"ff"
argument_list|)
expr_stmt|;
name|delay
argument_list|(
operator|(
name|m
operator|>>
literal|15
operator|)
operator|&
literal|1
argument_list|,
literal|"bs"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|delay
argument_list|(
argument|m
argument_list|,
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|m
operator|=
operator|&
literal|3
condition|)
name|printf
argument_list|(
literal|"%s%d "
argument_list|,
name|s
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|speed
index|[]
block|{
literal|0
operator|,
literal|50
operator|,
literal|75
operator|,
literal|110
operator|,
literal|134
operator|,
literal|150
operator|,
literal|200
operator|,
literal|300
operator|,
literal|600
operator|,
literal|1200
operator|,
literal|1800
operator|,
literal|2400
operator|,
literal|4800
operator|,
literal|9600
operator|,
literal|0
operator|,
literal|0
block|}
end_decl_stmt

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_macro
name|prspeed
argument_list|(
argument|c
argument_list|,
argument|s
argument_list|)
end_macro

begin_block
block|{
name|printf
argument_list|(
literal|"%s%d baud\n"
argument_list|,
name|c
argument_list|,
name|speed
index|[
name|s
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|putchar
argument_list|(
argument|c
argument_list|)
end_macro

begin_block
block|{
name|write
argument_list|(
literal|2
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

