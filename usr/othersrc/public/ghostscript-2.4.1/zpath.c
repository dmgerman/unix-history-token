begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 1989, 1990, 1991 Aladdin Enterprises.  All rights reserved.    Distributed by Free Software Foundation, Inc.  This file is part of Ghostscript.  Ghostscript is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the Ghostscript General Public License for full details.  Everyone is granted permission to copy, modify and redistribute Ghostscript, but only under the conditions described in the Ghostscript General Public License.  A copy of this license is supposed to have been given to you along with Ghostscript so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* zpath.c */
end_comment

begin_comment
comment|/* Path operators for GhostScript */
end_comment

begin_include
include|#
directive|include
file|"math_.h"
end_include

begin_include
include|#
directive|include
file|"ghost.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"oper.h"
end_include

begin_include
include|#
directive|include
file|"gsmatrix.h"
end_include

begin_include
include|#
directive|include
file|"gspath.h"
end_include

begin_include
include|#
directive|include
file|"state.h"
end_include

begin_include
include|#
directive|include
file|"store.h"
end_include

begin_comment
comment|/* Forward references */
end_comment

begin_decl_stmt
name|private
name|int
name|near
name|common_to
argument_list|(
name|P2
argument_list|(
name|os_ptr
argument_list|,
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
name|P3
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|common_arc
argument_list|(
name|P2
argument_list|(
name|os_ptr
argument_list|,
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
name|P6
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|common_arct
argument_list|(
name|P2
argument_list|(
name|os_ptr
argument_list|,
name|float
operator|*
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|int
name|near
name|common_curve
argument_list|(
name|P2
argument_list|(
name|os_ptr
argument_list|,
name|int
argument_list|(
operator|*
argument_list|)
argument_list|(
name|P7
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Imported from zmath.c */
end_comment

begin_decl_stmt
specifier|extern
name|double
name|degrees_to_radians
decl_stmt|,
name|radians_to_degrees
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* newpath */
end_comment

begin_function
name|int
name|znewpath
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|gs_newpath
argument_list|(
name|igs
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* currentpoint */
end_comment

begin_function
name|int
name|zcurrentpoint
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
name|gs_point
name|pt
decl_stmt|;
name|int
name|code
init|=
name|gs_currentpoint
argument_list|(
name|igs
argument_list|,
operator|&
name|pt
argument_list|)
decl_stmt|;
if|if
condition|(
name|code
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|push
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|make_real
argument_list|(
name|op
operator|-
literal|1
argument_list|,
name|pt
operator|.
name|x
argument_list|)
expr_stmt|;
name|make_real
argument_list|(
name|op
argument_list|,
name|pt
operator|.
name|y
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* moveto */
end_comment

begin_function
name|int
name|zmoveto
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_to
argument_list|(
name|op
argument_list|,
name|gs_moveto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* rmoveto */
end_comment

begin_function
name|int
name|zrmoveto
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_to
argument_list|(
name|op
argument_list|,
name|gs_rmoveto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lineto */
end_comment

begin_function
name|int
name|zlineto
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_to
argument_list|(
name|op
argument_list|,
name|gs_lineto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* rlineto */
end_comment

begin_function
name|int
name|zrlineto
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_to
argument_list|(
name|op
argument_list|,
name|gs_rlineto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Common code for [r](move/line)to */
end_comment

begin_decl_stmt
name|private
name|int
name|near
name|common_to
argument_list|(
name|os_ptr
name|op
argument_list|,
name|int
argument_list|(
operator|*
name|add_proc
argument_list|)
argument_list|(
name|P3
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
block|{
name|float
name|opxy
index|[
literal|2
index|]
decl_stmt|;
name|int
name|code
decl_stmt|;
if|if
condition|(
operator|(
name|code
operator|=
name|num_params
argument_list|(
name|op
argument_list|,
literal|2
argument_list|,
name|opxy
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|(
name|code
operator|=
call|(
modifier|*
name|add_proc
call|)
argument_list|(
name|igs
argument_list|,
name|opxy
index|[
literal|0
index|]
argument_list|,
name|opxy
index|[
literal|1
index|]
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|pop
argument_list|(
literal|2
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_decl_stmt

begin_comment
comment|/* arc */
end_comment

begin_function
name|int
name|zarc
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_arc
argument_list|(
name|op
argument_list|,
name|gs_arc
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* arcn */
end_comment

begin_function
name|int
name|zarcn
parameter_list|(
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_arc
argument_list|(
name|op
argument_list|,
name|gs_arcn
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Common code for arc[n] */
end_comment

begin_decl_stmt
name|private
name|int
name|near
name|common_arc
argument_list|(
name|os_ptr
name|op
argument_list|,
name|int
argument_list|(
operator|*
name|aproc
argument_list|)
argument_list|(
name|P6
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
block|{
name|float
name|xyra
index|[
literal|5
index|]
decl_stmt|;
comment|/* x, y, r, ang1, ang2 */
name|int
name|code
decl_stmt|;
if|if
condition|(
operator|(
name|code
operator|=
name|num_params
argument_list|(
name|op
argument_list|,
literal|5
argument_list|,
name|xyra
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|code
operator|=
call|(
modifier|*
name|aproc
call|)
argument_list|(
name|igs
argument_list|,
name|xyra
index|[
literal|0
index|]
argument_list|,
name|xyra
index|[
literal|1
index|]
argument_list|,
name|xyra
index|[
literal|2
index|]
argument_list|,
name|xyra
index|[
literal|3
index|]
argument_list|,
name|xyra
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|>=
literal|0
condition|)
name|pop
argument_list|(
literal|5
argument_list|)
expr_stmt|;
return|return
name|code
return|;
block|}
end_decl_stmt

begin_comment
comment|/* arct */
end_comment

begin_function
name|int
name|zarct
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
name|int
name|code
init|=
name|common_arct
argument_list|(
name|op
argument_list|,
operator|(
name|float
operator|*
operator|)
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|code
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|pop
argument_list|(
literal|5
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* arcto */
end_comment

begin_function
name|int
name|zarcto
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
name|float
name|tanxy
index|[
literal|4
index|]
decl_stmt|;
comment|/* xt1, yt1, xt2, yt2 */
name|int
name|code
init|=
name|common_arct
argument_list|(
name|op
argument_list|,
name|tanxy
argument_list|)
decl_stmt|;
if|if
condition|(
name|code
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|make_real
argument_list|(
name|op
operator|-
literal|4
argument_list|,
name|tanxy
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|make_real
argument_list|(
name|op
operator|-
literal|3
argument_list|,
name|tanxy
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|make_real
argument_list|(
name|op
operator|-
literal|2
argument_list|,
name|tanxy
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|make_real
argument_list|(
name|op
operator|-
literal|1
argument_list|,
name|tanxy
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|pop
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Common code for arct[o] */
end_comment

begin_function
name|private
name|int
name|near
name|common_arct
parameter_list|(
name|os_ptr
name|op
parameter_list|,
name|float
modifier|*
name|tanxy
parameter_list|)
block|{
name|float
name|args
index|[
literal|5
index|]
decl_stmt|;
comment|/* x1, y1, x2, y2, r */
name|int
name|code
decl_stmt|;
if|if
condition|(
operator|(
name|code
operator|=
name|num_params
argument_list|(
name|op
argument_list|,
literal|5
argument_list|,
name|args
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
name|code
return|;
return|return
name|gs_arcto
argument_list|(
name|igs
argument_list|,
name|args
index|[
literal|0
index|]
argument_list|,
name|args
index|[
literal|1
index|]
argument_list|,
name|args
index|[
literal|2
index|]
argument_list|,
name|args
index|[
literal|3
index|]
argument_list|,
name|args
index|[
literal|4
index|]
argument_list|,
name|tanxy
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* curveto */
end_comment

begin_function
name|int
name|zcurveto
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_curve
argument_list|(
name|op
argument_list|,
name|gs_curveto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* rcurveto */
end_comment

begin_function
name|int
name|zrcurveto
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|common_curve
argument_list|(
name|op
argument_list|,
name|gs_rcurveto
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Common code for [r]curveto */
end_comment

begin_decl_stmt
name|private
name|int
name|near
name|common_curve
argument_list|(
name|os_ptr
name|op
argument_list|,
name|int
argument_list|(
operator|*
name|add_proc
argument_list|)
argument_list|(
name|P7
argument_list|(
name|gs_state
operator|*
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|,
name|floatp
argument_list|)
argument_list|)
argument_list|)
block|{
name|float
name|opxy
index|[
literal|6
index|]
decl_stmt|;
name|int
name|code
decl_stmt|;
if|if
condition|(
operator|(
name|code
operator|=
name|num_params
argument_list|(
name|op
argument_list|,
literal|6
argument_list|,
name|opxy
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
name|code
return|;
name|code
operator|=
call|(
modifier|*
name|add_proc
call|)
argument_list|(
name|igs
argument_list|,
name|opxy
index|[
literal|0
index|]
argument_list|,
name|opxy
index|[
literal|1
index|]
argument_list|,
name|opxy
index|[
literal|2
index|]
argument_list|,
name|opxy
index|[
literal|3
index|]
argument_list|,
name|opxy
index|[
literal|4
index|]
argument_list|,
name|opxy
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|>=
literal|0
condition|)
name|pop
argument_list|(
literal|6
argument_list|)
expr_stmt|;
return|return
name|code
return|;
block|}
end_decl_stmt

begin_comment
comment|/* closepath */
end_comment

begin_function
name|int
name|zclosepath
parameter_list|(
specifier|register
name|os_ptr
name|op
parameter_list|)
block|{
return|return
name|gs_closepath
argument_list|(
name|igs
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* ------ Initialization procedure ------ */
end_comment

begin_decl_stmt
name|op_def
name|zpath_op_defs
index|[]
init|=
block|{
block|{
literal|"5arc"
block|,
name|zarc
block|}
block|,
block|{
literal|"5arcn"
block|,
name|zarcn
block|}
block|,
block|{
literal|"5arct"
block|,
name|zarct
block|}
block|,
block|{
literal|"5arcto"
block|,
name|zarcto
block|}
block|,
block|{
literal|"0closepath"
block|,
name|zclosepath
block|}
block|,
block|{
literal|"0currentpoint"
block|,
name|zcurrentpoint
block|}
block|,
block|{
literal|"6curveto"
block|,
name|zcurveto
block|}
block|,
block|{
literal|"2lineto"
block|,
name|zlineto
block|}
block|,
block|{
literal|"2moveto"
block|,
name|zmoveto
block|}
block|,
block|{
literal|"0newpath"
block|,
name|znewpath
block|}
block|,
block|{
literal|"6rcurveto"
block|,
name|zrcurveto
block|}
block|,
block|{
literal|"2rlineto"
block|,
name|zrlineto
block|}
block|,
block|{
literal|"2rmoveto"
block|,
name|zrmoveto
block|}
block|,
name|op_def_end
argument_list|(
literal|0
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

end_unit

