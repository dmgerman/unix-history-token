begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* dispose_command.c -- dispose of a COMMAND structure. */
end_comment

begin_comment
comment|/* Copyright (C) 1987,1991 Free Software Foundation, Inc.     This file is part of GNU Bash, the Bourne Again SHell.     Bash is free software; you can redistribute it and/or modify it    under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 1, or (at your option)    any later version.     Bash is distributed in the hope that it will be useful, but WITHOUT    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY    or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public    License for more details.     You should have received a copy of the GNU General Public License    along with Bash; see the file COPYING.  If not, write to the Free    Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA. */
end_comment

begin_include
include|#
directive|include
file|"shell.h"
end_include

begin_comment
comment|/* Dispose of the command structure passed. */
end_comment

begin_function
name|void
name|dispose_command
parameter_list|(
name|command
parameter_list|)
specifier|register
name|COMMAND
modifier|*
name|command
decl_stmt|;
block|{
if|if
condition|(
operator|!
name|command
condition|)
return|return;
if|if
condition|(
name|command
operator|->
name|redirects
condition|)
name|dispose_redirects
argument_list|(
name|command
operator|->
name|redirects
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|command
operator|->
name|type
condition|)
block|{
case|case
name|cm_for
case|:
block|{
specifier|register
name|FOR_COM
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|For
decl_stmt|;
name|dispose_word
argument_list|(
name|c
operator|->
name|name
argument_list|)
expr_stmt|;
name|dispose_words
argument_list|(
name|c
operator|->
name|map_list
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|action
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_group
case|:
block|{
name|dispose_command
argument_list|(
name|command
operator|->
name|value
operator|.
name|Group
operator|->
name|command
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_case
case|:
block|{
specifier|register
name|CASE_COM
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|Case
decl_stmt|;
name|PATTERN_LIST
modifier|*
name|t
decl_stmt|,
modifier|*
name|p
init|=
name|c
operator|->
name|clauses
decl_stmt|;
name|dispose_word
argument_list|(
name|c
operator|->
name|word
argument_list|)
expr_stmt|;
while|while
condition|(
name|p
condition|)
block|{
name|dispose_words
argument_list|(
name|p
operator|->
name|patterns
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|p
operator|->
name|action
argument_list|)
expr_stmt|;
name|t
operator|=
name|p
expr_stmt|;
name|p
operator|=
name|p
operator|->
name|next
expr_stmt|;
name|free
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
case|case
name|cm_until
case|:
case|case
name|cm_while
case|:
block|{
specifier|register
name|WHILE_COM
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|While
decl_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|test
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|action
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_if
case|:
block|{
specifier|register
name|IF_COM
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|If
decl_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|test
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|true_case
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|false_case
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_simple
case|:
block|{
specifier|register
name|SIMPLE_COM
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|Simple
decl_stmt|;
name|dispose_words
argument_list|(
name|c
operator|->
name|words
argument_list|)
expr_stmt|;
name|dispose_redirects
argument_list|(
name|c
operator|->
name|redirects
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_connection
case|:
block|{
specifier|register
name|CONNECTION
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|Connection
decl_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|first
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|second
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|cm_function_def
case|:
block|{
specifier|register
name|FUNCTION_DEF
modifier|*
name|c
init|=
name|command
operator|->
name|value
operator|.
name|Function_def
decl_stmt|;
name|dispose_word
argument_list|(
name|c
operator|->
name|name
argument_list|)
expr_stmt|;
name|dispose_command
argument_list|(
name|c
operator|->
name|command
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
name|report_error
argument_list|(
literal|"Attempt to free unknown command type `%d'.\n"
argument_list|,
name|command
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
name|free
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* How to free a WORD_DESC. */
end_comment

begin_macro
name|dispose_word
argument_list|(
argument|word
argument_list|)
end_macro

begin_decl_stmt
name|WORD_DESC
modifier|*
name|word
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|free
argument_list|(
name|word
operator|->
name|word
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|word
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* How to get rid of a linked list of words.  A WORD_LIST. */
end_comment

begin_macro
name|dispose_words
argument_list|(
argument|list
argument_list|)
end_macro

begin_decl_stmt
name|WORD_LIST
modifier|*
name|list
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|WORD_LIST
modifier|*
name|t
decl_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|t
operator|=
name|list
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
name|dispose_word
argument_list|(
name|t
operator|->
name|word
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/* How to dispose of an array of pointers to char. */
end_comment

begin_macro
name|dispose_word_array
argument_list|(
argument|array
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
modifier|*
name|array
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|count
decl_stmt|;
for|for
control|(
name|count
operator|=
literal|0
init|;
name|array
index|[
name|count
index|]
condition|;
name|count
operator|++
control|)
name|free
argument_list|(
name|array
index|[
name|count
index|]
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|array
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* How to dispose of an list of redirections.  A REDIRECT. */
end_comment

begin_macro
name|dispose_redirects
argument_list|(
argument|list
argument_list|)
end_macro

begin_decl_stmt
name|REDIRECT
modifier|*
name|list
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|REDIRECT
modifier|*
name|t
decl_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|t
operator|=
name|list
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
switch|switch
condition|(
name|t
operator|->
name|instruction
condition|)
block|{
case|case
name|r_reading_until
case|:
case|case
name|r_deblank_reading_until
case|:
name|free
argument_list|(
name|t
operator|->
name|here_doc_eof
argument_list|)
expr_stmt|;
comment|/* ... */
case|case
name|r_output_direction
case|:
case|case
name|r_input_direction
case|:
case|case
name|r_inputa_direction
case|:
case|case
name|r_appending_to
case|:
case|case
name|r_err_and_out
case|:
case|case
name|r_input_output
case|:
case|case
name|r_output_force
case|:
case|case
name|r_duplicating_input_word
case|:
case|case
name|r_duplicating_output_word
case|:
name|dispose_word
argument_list|(
name|t
operator|->
name|redirectee
operator|.
name|filename
argument_list|)
expr_stmt|;
break|break;
block|}
name|free
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
block|}
end_block

end_unit

