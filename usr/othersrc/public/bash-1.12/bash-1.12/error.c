begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* error.c -- Functions for handling errors. */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|HAVE_VFPRINTF
argument_list|)
end_if

begin_include
include|#
directive|include
file|<varargs.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|char
modifier|*
name|strerror
parameter_list|()
function_decl|;
end_function_decl

begin_include
include|#
directive|include
file|"flags.h"
end_include

begin_include
include|#
directive|include
file|"error.h"
end_include

begin_comment
comment|/* Report an error having to do with FILENAME. */
end_comment

begin_function
name|void
name|file_error
parameter_list|(
name|filename
parameter_list|)
name|char
modifier|*
name|filename
decl_stmt|;
block|{
name|report_error
argument_list|(
literal|"%s: %s"
argument_list|,
name|filename
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|HAVE_VFPRINTF
argument_list|)
end_if

begin_function
name|void
name|programming_error
parameter_list|(
name|reason
parameter_list|,
name|arg1
parameter_list|,
name|arg2
parameter_list|,
name|arg3
parameter_list|,
name|arg4
parameter_list|,
name|arg5
parameter_list|)
name|char
modifier|*
name|reason
decl_stmt|;
block|{
specifier|extern
name|char
modifier|*
name|the_current_maintainer
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|JOB_CONTROL
argument_list|)
block|{
specifier|extern
name|pid_t
name|shell_pgrp
decl_stmt|;
name|give_terminal_to
argument_list|(
name|shell_pgrp
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* JOB_CONTROL */
name|report_error
argument_list|(
name|reason
argument_list|,
name|arg1
argument_list|,
name|arg2
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Tell %s to fix this someday.\n"
argument_list|,
name|the_current_maintainer
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|MAKE_BUG_REPORTS
argument_list|)
if|if
condition|(
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Mailing a bug report..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|make_bug_report
argument_list|(
name|reason
argument_list|,
name|arg1
argument_list|,
name|arg2
argument_list|,
name|arg3
argument_list|,
name|arg4
argument_list|,
name|arg5
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done.\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* MAKE_BUG_REPORTS */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Stopping myself..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|report_error
parameter_list|(
name|format
parameter_list|,
name|arg1
parameter_list|,
name|arg2
parameter_list|,
name|arg3
parameter_list|,
name|arg4
parameter_list|,
name|arg5
parameter_list|)
name|char
modifier|*
name|format
decl_stmt|;
block|{
if|#
directive|if
name|defined
argument_list|(
name|NOTDEF
argument_list|)
specifier|extern
name|char
modifier|*
name|shell_name
decl_stmt|,
modifier|*
name|base_pathname
argument_list|()
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: "
argument_list|,
name|base_pathname
argument_list|(
name|shell_name
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* NOTDEF */
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|format
argument_list|,
name|arg1
argument_list|,
name|arg2
argument_list|,
name|arg3
argument_list|,
name|arg4
argument_list|,
name|arg5
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|exit_immediately_on_error
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fatal_error
parameter_list|(
name|format
parameter_list|,
name|arg1
parameter_list|,
name|arg2
parameter_list|,
name|arg3
parameter_list|,
name|arg4
parameter_list|,
name|arg5
parameter_list|)
name|char
modifier|*
name|format
decl_stmt|;
block|{
name|report_error
argument_list|(
name|format
argument_list|,
name|arg1
argument_list|,
name|arg2
argument_list|,
name|arg3
argument_list|,
name|arg4
argument_list|,
name|arg5
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* We have VARARGS support, so use it. */
end_comment

begin_function
name|void
name|programming_error
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
specifier|extern
name|char
modifier|*
name|the_current_maintainer
decl_stmt|,
modifier|*
name|shell_name
decl_stmt|;
specifier|extern
name|char
modifier|*
name|base_pathname
parameter_list|()
function_decl|;
name|va_list
name|args
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|JOB_CONTROL
argument_list|)
block|{
specifier|extern
name|pid_t
name|shell_pgrp
decl_stmt|;
name|give_terminal_to
argument_list|(
name|shell_pgrp
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* JOB_CONTROL */
name|va_start
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|format
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
name|stderr
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Tell %s to fix this someday.\n"
argument_list|,
name|the_current_maintainer
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|MAKE_BUG_REPORTS
argument_list|)
if|if
condition|(
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Mailing a bug report..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|make_bug_report
argument_list|(
name|va_alist
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done.\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Stopping myself..."
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|report_error
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|va_list
name|args
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|NOTDEF
argument_list|)
specifier|extern
name|char
modifier|*
name|shell_name
decl_stmt|,
modifier|*
name|base_pathname
argument_list|()
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: "
argument_list|,
name|base_pathname
argument_list|(
name|shell_name
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* NOTDEF */
name|va_start
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|format
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
name|stderr
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
if|if
condition|(
name|exit_immediately_on_error
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|fatal_error
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|va_list
name|args
decl_stmt|;
name|char
modifier|*
name|format
decl_stmt|;
specifier|extern
name|char
modifier|*
name|shell_name
decl_stmt|,
modifier|*
name|base_pathname
argument_list|()
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: "
argument_list|,
name|base_pathname
argument_list|(
name|shell_name
argument_list|)
argument_list|)
expr_stmt|;
name|va_start
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|format
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|char
operator|*
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
name|stderr
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_VFPRINTF */
end_comment

end_unit

