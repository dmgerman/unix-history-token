begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * zle_misc.c - miscellaneous editor routines  *  * This file is part of zsh, the Z shell.  *  * This software is Copyright 1992 by Paul Falstad  *  * Permission is hereby granted to copy, reproduce, redistribute or otherwise  * use this software as long as: there is no monetary profit gained  * specifically from the use or reproduction of this software, it is not  * sold, rented, traded or otherwise marketed, and this copyright notice is  * included prominently in any copy made.   *  * The author make no claims as to the fitness or correctness of this software  * for any use whatsoever, and it is provided as is. Any use of this software  * is at the user's own risk.   *  */
end_comment

begin_define
define|#
directive|define
name|ZLE
end_define

begin_include
include|#
directive|include
file|"zsh.h"
end_include

begin_function
name|void
name|selfinsert
parameter_list|()
comment|/**/
block|{
name|int
name|ncs
init|=
name|cs
operator|+
name|mult
decl_stmt|;
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|ncs
operator|=
name|cs
expr_stmt|;
block|}
if|if
condition|(
name|insmode
operator|||
name|ll
operator|==
name|cs
condition|)
name|spaceinline
argument_list|(
name|mult
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mult
operator|+
name|cs
operator|>
name|ll
condition|)
name|spaceinline
argument_list|(
name|ll
operator|-
operator|(
name|mult
operator|+
name|cs
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|mult
operator|--
condition|)
name|line
index|[
name|cs
operator|++
index|]
operator|=
name|c
expr_stmt|;
name|cs
operator|=
name|ncs
expr_stmt|;
block|}
end_function

begin_function
name|void
name|selfinsertunmeta
parameter_list|()
comment|/**/
block|{
name|c
operator|&=
literal|0x7f
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
name|c
operator|=
literal|'\n'
expr_stmt|;
name|selfinsert
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|deletechar
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|backwarddeletechar
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|==
literal|4
operator|&&
operator|!
name|ll
condition|)
block|{
name|eofsent
operator|=
literal|1
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|cs
operator|+
name|mult
operator|>
name|ll
operator|||
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
operator|)
condition|)
block|{
name|cs
operator|+=
name|mult
expr_stmt|;
name|backdel
argument_list|(
name|mult
argument_list|)
expr_stmt|;
block|}
else|else
name|feep
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|backwarddeletechar
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|deletechar
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|mult
operator|>
name|cs
condition|)
name|mult
operator|=
name|cs
expr_stmt|;
name|backdel
argument_list|(
name|mult
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|videletechar
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|vibackwarddeletechar
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|==
literal|4
operator|&&
operator|!
name|ll
condition|)
block|{
name|eofsent
operator|=
literal|1
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|cs
operator|+
name|mult
operator|>
name|ll
operator|||
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
operator|)
condition|)
block|{
name|cs
operator|+=
name|mult
expr_stmt|;
name|backkill
argument_list|(
name|mult
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|cs
operator|&&
operator|(
name|cs
operator|==
name|ll
operator|||
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
operator|)
condition|)
name|cs
operator|--
expr_stmt|;
block|}
else|else
name|feep
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|vibackwarddeletechar
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|videletechar
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|mult
operator|>
name|cs
condition|)
name|mult
operator|=
name|cs
expr_stmt|;
if|if
condition|(
name|cs
operator|-
name|mult
operator|<
name|viinsbegin
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|backkill
argument_list|(
name|mult
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|vikillline
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|viinsbegin
operator|>
name|cs
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|backdel
argument_list|(
name|cs
operator|-
name|viinsbegin
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|killwholeline
parameter_list|()
comment|/**/
block|{
name|int
name|i
decl_stmt|,
name|fg
decl_stmt|;
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
return|return;
while|while
condition|(
name|mult
operator|--
condition|)
block|{
if|if
condition|(
name|fg
operator|=
operator|(
name|cs
operator|&&
name|cs
operator|==
name|ll
operator|)
condition|)
name|cs
operator|--
expr_stmt|;
while|while
condition|(
name|cs
operator|&&
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|!=
literal|'\n'
condition|)
name|cs
operator|--
expr_stmt|;
for|for
control|(
name|i
operator|=
name|cs
init|;
name|i
operator|!=
name|ll
operator|&&
name|line
index|[
name|i
index|]
operator|!=
literal|'\n'
condition|;
name|i
operator|++
control|)
empty_stmt|;
name|forekill
argument_list|(
name|i
operator|-
name|cs
operator|+
operator|(
name|i
operator|!=
name|ll
operator|)
argument_list|,
name|fg
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|killbuffer
parameter_list|()
comment|/**/
block|{
name|cs
operator|=
literal|0
expr_stmt|;
name|forekill
argument_list|(
name|ll
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|backwardkillline
parameter_list|()
comment|/**/
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|killline
argument_list|()
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|mult
operator|--
condition|)
block|{
while|while
condition|(
name|cs
operator|&&
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|!=
literal|'\n'
condition|)
name|cs
operator|--
operator|,
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|mult
operator|&&
name|cs
operator|&&
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
name|cs
operator|--
operator|,
name|i
operator|++
expr_stmt|;
block|}
name|forekill
argument_list|(
name|i
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|gosmacstransposechars
parameter_list|()
comment|/**/
block|{
name|int
name|cc
decl_stmt|;
if|if
condition|(
name|cs
operator|<
literal|2
operator|||
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|==
literal|'\n'
operator|||
name|line
index|[
name|cs
operator|-
literal|2
index|]
operator|==
literal|'\n'
condition|)
block|{
if|if
condition|(
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
operator|||
name|line
index|[
name|cs
operator|+
literal|1
index|]
operator|==
literal|'\n'
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|cs
operator|+=
operator|(
name|cs
operator|==
literal|0
operator|||
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|==
literal|'\n'
operator|)
condition|?
literal|2
else|:
literal|1
expr_stmt|;
block|}
name|cc
operator|=
name|line
index|[
name|cs
operator|-
literal|2
index|]
expr_stmt|;
name|line
index|[
name|cs
operator|-
literal|2
index|]
operator|=
name|line
index|[
name|cs
operator|-
literal|1
index|]
expr_stmt|;
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|=
name|cc
expr_stmt|;
block|}
end_function

begin_function
name|void
name|transposechars
parameter_list|()
comment|/**/
block|{
name|int
name|cc
decl_stmt|;
name|int
name|neg
init|=
name|mult
operator|<
literal|0
decl_stmt|;
if|if
condition|(
name|neg
condition|)
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
while|while
condition|(
name|mult
operator|--
condition|)
block|{
if|if
condition|(
name|cs
operator|==
literal|0
operator|||
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
block|{
if|if
condition|(
name|ll
operator|==
name|cs
operator|||
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
operator|||
name|line
index|[
name|cs
operator|+
literal|1
index|]
operator|==
literal|'\n'
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|cs
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|neg
condition|)
block|{
if|if
condition|(
name|cs
operator|!=
name|ll
operator|&&
name|line
index|[
name|cs
index|]
operator|!=
literal|'\n'
condition|)
name|cs
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|cs
operator|!=
literal|0
operator|&&
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|!=
literal|'\n'
condition|)
name|cs
operator|--
expr_stmt|;
block|}
name|cc
operator|=
name|line
index|[
name|cs
operator|-
literal|2
index|]
expr_stmt|;
name|line
index|[
name|cs
operator|-
literal|2
index|]
operator|=
name|line
index|[
name|cs
operator|-
literal|1
index|]
expr_stmt|;
name|line
index|[
name|cs
operator|-
literal|1
index|]
operator|=
name|cc
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|poundinsert
parameter_list|()
comment|/**/
block|{
if|if
condition|(
operator|*
name|line
operator|!=
literal|'#'
condition|)
block|{
name|cs
operator|=
literal|0
expr_stmt|;
name|spaceinline
argument_list|(
literal|1
argument_list|)
expr_stmt|;
operator|*
name|line
operator|=
literal|'#'
expr_stmt|;
block|}
else|else
block|{
name|cs
operator|=
literal|0
expr_stmt|;
name|foredel
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|done
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|acceptline
parameter_list|()
comment|/**/
block|{
name|done
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|acceptandhold
parameter_list|()
comment|/**/
block|{
name|pushnode
argument_list|(
name|bufstack
argument_list|,
name|ztrdup
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
argument_list|)
argument_list|)
expr_stmt|;
name|stackcs
operator|=
name|cs
expr_stmt|;
name|done
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|killline
parameter_list|()
comment|/**/
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
block|{
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
name|backwardkillline
argument_list|()
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|mult
operator|--
condition|)
block|{
if|if
condition|(
name|line
index|[
name|cs
index|]
operator|==
literal|'\n'
condition|)
name|cs
operator|++
operator|,
name|i
operator|++
expr_stmt|;
while|while
condition|(
name|cs
operator|!=
name|ll
operator|&&
name|line
index|[
name|cs
index|]
operator|!=
literal|'\n'
condition|)
name|cs
operator|++
operator|,
name|i
operator|++
expr_stmt|;
block|}
name|backkill
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|killregion
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mark
operator|>
name|ll
condition|)
name|mark
operator|=
name|ll
expr_stmt|;
if|if
condition|(
name|mark
operator|>
name|cs
condition|)
name|forekill
argument_list|(
name|mark
operator|-
name|cs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|backkill
argument_list|(
name|cs
operator|-
name|mark
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|copyregionaskill
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|mark
operator|>
name|ll
condition|)
name|mark
operator|=
name|ll
expr_stmt|;
if|if
condition|(
name|mark
operator|>
name|cs
condition|)
name|cut
argument_list|(
name|cs
argument_list|,
name|mark
operator|-
name|cs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|cut
argument_list|(
name|mark
argument_list|,
name|cs
operator|-
name|mark
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|kct
decl_stmt|,
name|yankb
decl_stmt|,
name|yanke
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|yank
parameter_list|()
comment|/**/
block|{
name|int
name|cc
decl_stmt|;
name|char
modifier|*
name|buf
init|=
name|cutbuf
decl_stmt|;
if|if
condition|(
operator|!
name|cutbuf
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
return|return;
if|if
condition|(
name|vibufspec
condition|)
block|{
name|vibufspec
operator|=
name|tolower
argument_list|(
name|vibufspec
argument_list|)
expr_stmt|;
name|vibufspec
operator|+=
operator|(
name|idigit
argument_list|(
name|vibufspec
argument_list|)
operator|)
condition|?
operator|-
literal|'1'
operator|+
literal|26
else|:
operator|-
literal|'a'
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|buf
operator|=
name|vibuf
index|[
name|vibufspec
index|]
operator|)
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
name|vibufspec
operator|=
literal|0
expr_stmt|;
return|return;
block|}
name|vibufspec
operator|=
literal|0
expr_stmt|;
block|}
name|yankb
operator|=
name|cs
expr_stmt|;
while|while
condition|(
name|mult
operator|--
condition|)
block|{
name|kct
operator|=
name|kringnum
expr_stmt|;
name|cc
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|spaceinline
argument_list|(
name|cc
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
name|buf
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|cs
operator|+=
name|cc
expr_stmt|;
name|yanke
operator|=
name|cs
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|viputafter
parameter_list|()
comment|/**/
block|{
name|int
name|cc
decl_stmt|;
name|char
modifier|*
name|buf
init|=
name|cutbuf
decl_stmt|;
if|if
condition|(
operator|!
name|cutbuf
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|mult
operator|<
literal|0
condition|)
return|return;
if|if
condition|(
name|vibufspec
condition|)
block|{
name|vibufspec
operator|=
name|tolower
argument_list|(
name|vibufspec
argument_list|)
expr_stmt|;
name|vibufspec
operator|+=
operator|(
name|idigit
argument_list|(
name|vibufspec
argument_list|)
operator|)
condition|?
operator|-
literal|'1'
operator|+
literal|26
else|:
operator|-
literal|'a'
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|buf
operator|=
name|vibuf
index|[
name|vibufspec
index|]
operator|)
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
name|vibufspec
operator|=
literal|0
expr_stmt|;
return|return;
block|}
name|vibufspec
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|strchr
argument_list|(
name|buf
argument_list|,
literal|'\n'
argument_list|)
condition|)
block|{
name|cs
operator|=
name|findeol
argument_list|()
expr_stmt|;
if|if
condition|(
name|cs
operator|==
name|ll
condition|)
block|{
name|spaceinline
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|line
index|[
name|cs
index|]
operator|=
literal|'\n'
expr_stmt|;
block|}
block|}
if|if
condition|(
name|cs
operator|!=
name|ll
condition|)
name|cs
operator|++
expr_stmt|;
name|yankb
operator|=
name|cs
expr_stmt|;
while|while
condition|(
name|mult
operator|--
condition|)
block|{
name|kct
operator|=
name|kringnum
expr_stmt|;
name|cc
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|spaceinline
argument_list|(
name|cc
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
name|buf
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|cs
operator|+=
name|cc
expr_stmt|;
name|yanke
operator|=
name|cs
expr_stmt|;
block|}
name|cs
operator|=
name|yankb
expr_stmt|;
block|}
end_function

begin_function
name|void
name|yankpop
parameter_list|()
comment|/**/
block|{
name|int
name|cc
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|lastcmd
operator|&
name|ZLE_YANK
operator|)
operator|||
operator|!
name|kring
index|[
name|kct
index|]
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|cs
operator|=
name|yankb
expr_stmt|;
name|foredel
argument_list|(
name|yanke
operator|-
name|yankb
argument_list|)
expr_stmt|;
name|cc
operator|=
name|strlen
argument_list|(
name|kring
index|[
name|kct
index|]
argument_list|)
expr_stmt|;
name|spaceinline
argument_list|(
name|cc
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
name|kring
index|[
name|kct
index|]
argument_list|,
name|cc
argument_list|)
expr_stmt|;
name|cs
operator|+=
name|cc
expr_stmt|;
name|yanke
operator|=
name|cs
expr_stmt|;
name|kct
operator|=
operator|(
name|kct
operator|-
literal|1
operator|)
operator|&
operator|(
name|KRINGCT
operator|-
literal|1
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|overwritemode
parameter_list|()
comment|/**/
block|{
name|insmode
operator|^=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|undefinedkey
parameter_list|()
comment|/**/
block|{
name|feep
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|quotedinsert
parameter_list|()
comment|/**/
block|{
ifndef|#
directive|ifndef
name|TIO
name|struct
name|sgttyb
name|sob
decl_stmt|;
name|sob
operator|=
name|shttyinfo
operator|.
name|sgttyb
expr_stmt|;
name|sob
operator|.
name|sg_flags
operator|=
operator|(
name|sob
operator|.
name|sg_flags
operator||
name|RAW
operator|)
operator|&
operator|~
name|ECHO
expr_stmt|;
name|ioctl
argument_list|(
name|SHTTY
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|sob
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|c
operator|=
name|getkey
argument_list|(
literal|0
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|TIO
name|setterm
argument_list|()
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|c
condition|)
name|selfinsert
argument_list|()
expr_stmt|;
else|else
name|feep
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|digitargument
parameter_list|()
comment|/**/
block|{
if|if
condition|(
operator|!
operator|(
name|lastcmd
operator|&
name|ZLE_ARG
operator|)
condition|)
name|mult
operator|=
literal|0
expr_stmt|;
name|mult
operator|=
name|mult
operator|*
literal|10
operator|+
operator|(
name|c
operator|&
literal|0xf
operator|)
expr_stmt|;
if|if
condition|(
name|lastcmd
operator|&
name|ZLE_NEGARG
condition|)
name|mult
operator|=
operator|-
name|mult
expr_stmt|;
block|}
end_function

begin_function
name|void
name|negargument
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|lastcmd
operator|&
name|ZLE_ARG
condition|)
name|feep
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|universalargument
parameter_list|()
comment|/**/
block|{
if|if
condition|(
operator|!
operator|(
name|lastcmd
operator|&
name|ZLE_ARG
operator|)
condition|)
name|mult
operator|=
literal|4
expr_stmt|;
else|else
name|mult
operator|*=
literal|4
expr_stmt|;
block|}
end_function

begin_function
name|void
name|copyprevword
parameter_list|()
comment|/**/
block|{
name|int
name|len
decl_stmt|,
name|t0
decl_stmt|;
for|for
control|(
name|t0
operator|=
name|cs
operator|-
literal|1
init|;
name|t0
operator|>=
literal|0
condition|;
name|t0
operator|--
control|)
if|if
condition|(
name|iword
argument_list|(
name|line
index|[
name|t0
index|]
argument_list|)
condition|)
break|break;
for|for
control|(
init|;
name|t0
operator|>=
literal|0
condition|;
name|t0
operator|--
control|)
if|if
condition|(
operator|!
name|iword
argument_list|(
name|line
index|[
name|t0
index|]
argument_list|)
condition|)
break|break;
if|if
condition|(
name|t0
condition|)
name|t0
operator|++
expr_stmt|;
name|len
operator|=
name|cs
operator|-
name|t0
expr_stmt|;
name|spaceinline
argument_list|(
name|len
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|t0
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|cs
operator|+=
name|len
expr_stmt|;
block|}
end_function

begin_function
name|void
name|sendbreak
parameter_list|()
comment|/**/
block|{
name|errflag
operator|=
name|done
operator|=
literal|1
expr_stmt|;
block|}
end_function

begin_function
name|void
name|undo
parameter_list|()
comment|/**/
block|{
name|char
modifier|*
name|s
decl_stmt|;
name|struct
name|undoent
modifier|*
name|ue
decl_stmt|;
name|ue
operator|=
name|undos
operator|+
name|undoct
expr_stmt|;
if|if
condition|(
operator|!
name|ue
operator|->
name|change
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|line
index|[
name|ll
index|]
operator|=
literal|'\0'
expr_stmt|;
name|s
operator|=
name|ztrdup
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|ll
operator|-
name|ue
operator|->
name|suff
argument_list|)
expr_stmt|;
name|sizeline
argument_list|(
operator|(
name|ll
operator|=
name|ue
operator|->
name|pref
operator|+
name|ue
operator|->
name|suff
operator|+
name|ue
operator|->
name|len
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|ue
operator|->
name|pref
argument_list|,
name|ue
operator|->
name|change
argument_list|,
name|ue
operator|->
name|len
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|ue
operator|->
name|pref
operator|+
name|ue
operator|->
name|len
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|ue
operator|->
name|change
operator|=
name|NULL
expr_stmt|;
name|undoct
operator|=
operator|(
name|undoct
operator|-
literal|1
operator|)
operator|&
operator|(
name|UNDOCT
operator|-
literal|1
operator|)
expr_stmt|;
name|cs
operator|=
name|ue
operator|->
name|cs
expr_stmt|;
block|}
end_function

begin_function
name|void
name|quoteregion
parameter_list|()
comment|/**/
block|{
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|mark
operator|>
name|ll
condition|)
name|mark
operator|=
name|ll
expr_stmt|;
if|if
condition|(
name|mark
operator|<
name|cs
condition|)
block|{
name|x
operator|=
name|mark
expr_stmt|;
name|mark
operator|=
name|cs
expr_stmt|;
name|cs
operator|=
name|x
expr_stmt|;
block|}
name|s
operator|=
name|hcalloc
argument_list|(
operator|(
name|y
operator|=
name|mark
operator|-
name|cs
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|s
argument_list|,
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|s
index|[
name|y
index|]
operator|=
literal|'\0'
expr_stmt|;
name|foredel
argument_list|(
name|mark
operator|-
name|cs
argument_list|)
expr_stmt|;
name|t
operator|=
name|makequote
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|spaceinline
argument_list|(
name|x
operator|=
name|strlen
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
operator|+
name|cs
argument_list|,
name|t
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|mark
operator|=
name|cs
expr_stmt|;
name|cs
operator|+=
name|x
expr_stmt|;
block|}
end_function

begin_function
name|void
name|quoteline
parameter_list|()
comment|/**/
block|{
name|char
modifier|*
name|s
decl_stmt|;
name|line
index|[
name|ll
index|]
operator|=
literal|'\0'
expr_stmt|;
name|s
operator|=
name|makequote
argument_list|(
operator|(
name|char
operator|*
operator|)
name|line
argument_list|)
expr_stmt|;
name|setline
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|makequote
parameter_list|(
name|s
parameter_list|)
comment|/**/
name|char
modifier|*
name|s
decl_stmt|;
block|{
name|int
name|qtct
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|l
decl_stmt|,
modifier|*
name|ol
decl_stmt|;
for|for
control|(
name|l
operator|=
name|s
init|;
operator|*
name|l
condition|;
name|l
operator|++
control|)
if|if
condition|(
operator|*
name|l
operator|==
literal|'\''
condition|)
name|qtct
operator|++
expr_stmt|;
name|l
operator|=
name|ol
operator|=
name|halloc
argument_list|(
operator|(
name|qtct
operator|*
literal|3
operator|)
operator|+
literal|3
operator|+
name|strlen
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|l
operator|++
operator|=
literal|'\''
expr_stmt|;
for|for
control|(
init|;
operator|*
name|s
condition|;
name|s
operator|++
control|)
if|if
condition|(
operator|*
name|s
operator|==
literal|'\''
condition|)
block|{
operator|*
name|l
operator|++
operator|=
literal|'\''
expr_stmt|;
operator|*
name|l
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|l
operator|++
operator|=
literal|'\''
expr_stmt|;
operator|*
name|l
operator|++
operator|=
literal|'\''
expr_stmt|;
block|}
else|else
operator|*
name|l
operator|++
operator|=
operator|*
name|s
expr_stmt|;
operator|*
name|l
operator|++
operator|=
literal|'\''
expr_stmt|;
operator|*
name|l
operator|=
literal|'\0'
expr_stmt|;
return|return
name|ol
return|;
block|}
end_function

begin_define
define|#
directive|define
name|NAMLEN
value|70
end_define

begin_function
name|int
name|executenamedcommand
parameter_list|()
comment|/**/
block|{
name|char
name|buf
index|[
name|NAMLEN
index|]
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
name|int
name|len
decl_stmt|,
name|ch
decl_stmt|,
name|t0
decl_stmt|;
name|strcpy
argument_list|(
name|buf
argument_list|,
literal|"execute: "
argument_list|)
expr_stmt|;
name|ptr
operator|=
name|buf
operator|+
literal|9
expr_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
name|statusline
operator|=
name|buf
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
for|for
control|(
init|;
name|ch
operator|=
name|getkey
argument_list|(
literal|1
argument_list|)
condition|;
name|refresh
argument_list|()
control|)
block|{
switch|switch
condition|(
name|ch
condition|)
block|{
case|case
literal|8
case|:
case|case
literal|127
case|:
if|if
condition|(
name|len
condition|)
block|{
name|len
operator|--
expr_stmt|;
operator|*
operator|--
name|ptr
operator|=
literal|'\0'
expr_stmt|;
block|}
break|break;
case|case
literal|23
case|:
while|while
condition|(
name|len
operator|&&
operator|(
name|len
operator|--
operator|,
operator|*
operator|--
name|ptr
operator|!=
literal|'-'
operator|)
condition|)
operator|*
name|ptr
operator|=
literal|'\0'
expr_stmt|;
break|break;
case|case
literal|21
case|:
name|len
operator|=
literal|0
expr_stmt|;
name|ptr
operator|=
name|buf
operator|+
literal|9
expr_stmt|;
operator|*
name|ptr
operator|=
literal|'\0'
expr_stmt|;
break|break;
case|case
literal|10
case|:
case|case
literal|13
case|:
goto|goto
name|brk
goto|;
case|case
literal|7
case|:
case|case
operator|-
literal|1
case|:
name|statusline
operator|=
name|NULL
expr_stmt|;
return|return
name|z_undefinedkey
return|;
case|case
literal|9
case|:
case|case
literal|32
case|:
block|{
name|Lklist
name|ll
decl_stmt|;
name|int
name|ambig
init|=
literal|100
decl_stmt|;
name|heapalloc
argument_list|()
expr_stmt|;
name|ll
operator|=
name|newlist
argument_list|()
expr_stmt|;
for|for
control|(
name|t0
operator|=
literal|0
init|;
name|t0
operator|!=
name|ZLECMDCOUNT
condition|;
name|t0
operator|++
control|)
if|if
condition|(
name|strpfx
argument_list|(
name|buf
operator|+
literal|9
argument_list|,
name|zlecmds
index|[
name|t0
index|]
operator|.
name|name
argument_list|)
condition|)
block|{
name|int
name|xx
decl_stmt|;
name|addnode
argument_list|(
name|ll
argument_list|,
name|zlecmds
index|[
name|t0
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|xx
operator|=
name|pfxlen
argument_list|(
name|peekfirst
argument_list|(
name|ll
argument_list|)
argument_list|,
name|zlecmds
index|[
name|t0
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|xx
operator|<
name|ambig
condition|)
name|ambig
operator|=
name|xx
expr_stmt|;
block|}
name|permalloc
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|full
argument_list|(
name|ll
argument_list|)
condition|)
name|feep
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|nextnode
argument_list|(
name|firstnode
argument_list|(
name|ll
argument_list|)
argument_list|)
condition|)
block|{
name|strcpy
argument_list|(
name|buf
operator|+
literal|9
argument_list|,
name|peekfirst
argument_list|(
name|ll
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|=
name|buf
operator|+
operator|(
name|len
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
operator|)
expr_stmt|;
block|}
else|else
block|{
name|strcpy
argument_list|(
name|buf
operator|+
literal|9
argument_list|,
name|peekfirst
argument_list|(
name|ll
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
name|ambig
expr_stmt|;
name|ptr
operator|=
name|buf
operator|+
literal|9
operator|+
name|len
expr_stmt|;
operator|*
name|ptr
operator|=
literal|'\0'
expr_stmt|;
name|feep
argument_list|()
expr_stmt|;
name|listmatches
argument_list|(
name|ll
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
default|default:
if|if
condition|(
name|len
operator|==
name|NAMLEN
operator|-
literal|10
operator|||
name|icntrl
argument_list|(
name|ch
argument_list|)
condition|)
name|feep
argument_list|()
expr_stmt|;
else|else
operator|*
name|ptr
operator|++
operator|=
name|ch
operator|,
operator|*
name|ptr
operator|=
literal|'\0'
operator|,
name|len
operator|++
expr_stmt|;
break|break;
block|}
block|}
name|brk
label|:
name|statusline
operator|=
name|NULL
expr_stmt|;
name|ptr
operator|=
name|buf
operator|+
literal|9
expr_stmt|;
for|for
control|(
name|t0
operator|=
literal|0
init|;
name|t0
operator|!=
name|ZLECMDCOUNT
condition|;
name|t0
operator|++
control|)
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|ptr
argument_list|,
name|zlecmds
index|[
name|t0
index|]
operator|.
name|name
argument_list|)
condition|)
break|break;
if|if
condition|(
name|t0
operator|!=
name|ZLECMDCOUNT
condition|)
return|return
name|lastnamed
operator|=
name|t0
return|;
else|else
return|return
name|z_undefinedkey
return|;
block|}
end_function

begin_function
name|void
name|vijoin
parameter_list|()
comment|/**/
block|{
name|int
name|x
decl_stmt|;
if|if
condition|(
operator|(
name|x
operator|=
name|findeol
argument_list|()
operator|)
operator|==
name|ll
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|cs
operator|=
name|x
operator|+
literal|1
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|1
init|;
name|cs
operator|!=
name|ll
operator|&&
name|iblank
argument_list|(
name|line
index|[
name|cs
index|]
argument_list|)
condition|;
name|cs
operator|++
operator|,
name|x
operator|++
control|)
empty_stmt|;
name|backdel
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|spaceinline
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|line
index|[
name|cs
index|]
operator|=
literal|' '
expr_stmt|;
block|}
end_function

begin_function
name|void
name|viswapcase
parameter_list|()
comment|/**/
block|{
if|if
condition|(
name|cs
operator|<
name|ll
condition|)
block|{
name|int
name|ch
init|=
name|line
index|[
name|cs
index|]
decl_stmt|;
if|if
condition|(
name|islower
argument_list|(
name|ch
argument_list|)
condition|)
name|ch
operator|=
name|tuupper
argument_list|(
name|ch
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|isupper
argument_list|(
name|ch
argument_list|)
condition|)
name|ch
operator|=
name|tulower
argument_list|(
name|ch
argument_list|)
expr_stmt|;
name|line
index|[
name|cs
operator|++
index|]
operator|=
name|ch
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|vicapslockpanic
parameter_list|()
comment|/**/
block|{
name|char
name|ch
decl_stmt|;
name|statusline
operator|=
literal|"press a lowercase key to continue"
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
do|do
name|ch
operator|=
name|getkey
argument_list|(
literal|0
argument_list|)
expr_stmt|;
do|while
condition|(
operator|!
name|islower
argument_list|(
name|ch
argument_list|)
condition|)
do|;
block|}
end_function

begin_function
name|void
name|visetbuffer
parameter_list|()
comment|/**/
block|{
name|int
name|ch
decl_stmt|;
name|ch
operator|=
name|getkey
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ialnum
argument_list|(
name|ch
argument_list|)
condition|)
block|{
name|feep
argument_list|()
expr_stmt|;
return|return;
block|}
name|vibufspec
operator|=
name|ch
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|char
modifier|*
name|bp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|lensb
decl_stmt|,
name|countp
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|stradd
parameter_list|(
name|d
parameter_list|)
comment|/**/
name|char
modifier|*
name|d
decl_stmt|;
block|{
while|while
condition|(
operator|*
name|bp
operator|++
operator|=
operator|*
name|d
operator|++
condition|)
empty_stmt|;
name|bp
operator|--
expr_stmt|;
block|}
end_function

begin_function
name|int
name|putstr
parameter_list|(
name|d
parameter_list|)
comment|/**/
name|int
name|d
decl_stmt|;
block|{
operator|*
name|bp
operator|++
operator|=
name|d
expr_stmt|;
if|if
condition|(
name|countp
condition|)
name|lensb
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_define
define|#
directive|define
name|tstradd
parameter_list|(
name|X
parameter_list|)
define|\
value|if (termok&& unset(SINGLELINEZLE)) { \ 		char tbuf[2048],*tptr = tbuf; \ 		if (tgetstr(X,&tptr)) \ 			tputs(tbuf,1,putstr); \ 	} \ 	break
end_define

begin_comment
comment|/* get a prompt string */
end_comment

begin_function
name|char
modifier|*
name|putprompt
parameter_list|(
name|fm
parameter_list|,
name|lenp
parameter_list|)
comment|/**/
name|char
modifier|*
name|fm
decl_stmt|;
name|int
modifier|*
name|lenp
decl_stmt|;
block|{
name|char
modifier|*
name|ss
decl_stmt|,
modifier|*
name|bl0
decl_stmt|;
specifier|static
name|char
name|buf1
index|[
literal|256
index|]
decl_stmt|,
name|buf2
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|char
name|buf3
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
name|int
name|t0
decl_stmt|,
name|bracepos
init|=
literal|0
decl_stmt|;
name|struct
name|tm
modifier|*
name|tm
init|=
name|NULL
decl_stmt|;
name|time_t
name|timet
decl_stmt|;
name|lensb
operator|=
literal|0
expr_stmt|;
name|countp
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|fm
condition|)
block|{
operator|*
name|lenp
operator|=
literal|0
expr_stmt|;
return|return
literal|""
return|;
block|}
comment|/* kludge alert! */
name|buf
operator|=
operator|(
name|buf
operator|==
name|buf1
operator|)
condition|?
name|buf2
else|:
name|buf1
expr_stmt|;
name|bp
operator|=
name|bl0
operator|=
name|buf
expr_stmt|;
if|if
condition|(
operator|!
name|columns
condition|)
name|columns
operator|=
literal|80
expr_stmt|;
name|clearerr
argument_list|(
name|stdin
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|*
name|fm
condition|;
name|fm
operator|++
control|)
block|{
if|if
condition|(
name|bp
operator|-
name|buf
operator|>=
literal|220
condition|)
break|break;
if|if
condition|(
operator|*
name|fm
operator|==
literal|'%'
condition|)
switch|switch
condition|(
operator|*
operator|++
name|fm
condition|)
block|{
case|case
literal|'~'
case|:
name|t0
operator|=
name|finddir
argument_list|(
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|t0
operator|!=
operator|-
literal|1
condition|)
block|{
operator|*
name|bp
operator|++
operator|=
literal|'~'
expr_stmt|;
name|stradd
argument_list|(
name|usernames
index|[
name|t0
index|]
argument_list|)
expr_stmt|;
name|stradd
argument_list|(
name|pwd
operator|+
name|strlen
argument_list|(
name|userdirs
index|[
name|t0
index|]
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|pwd
argument_list|,
name|home
argument_list|,
name|t0
operator|=
name|strlen
argument_list|(
name|home
argument_list|)
argument_list|)
operator|&&
name|t0
operator|>
literal|1
condition|)
block|{
operator|*
name|bp
operator|++
operator|=
literal|'~'
expr_stmt|;
name|stradd
argument_list|(
name|pwd
operator|+
name|t0
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|'d'
case|:
case|case
literal|'/'
case|:
name|stradd
argument_list|(
name|pwd
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
case|case
literal|'.'
case|:
name|t0
operator|=
name|finddir
argument_list|(
name|pwd
argument_list|)
expr_stmt|;
if|if
condition|(
name|t0
operator|!=
operator|-
literal|1
condition|)
block|{
name|sprintf
argument_list|(
name|buf3
argument_list|,
literal|"~%s%s"
argument_list|,
name|usernames
index|[
name|t0
index|]
argument_list|,
name|pwd
operator|+
name|strlen
argument_list|(
name|userdirs
index|[
name|t0
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|pwd
argument_list|,
name|home
argument_list|,
name|t0
operator|=
name|strlen
argument_list|(
name|home
argument_list|)
argument_list|)
operator|&&
name|t0
operator|>
literal|1
condition|)
block|{
name|sprintf
argument_list|(
name|buf3
argument_list|,
literal|"~%s"
argument_list|,
name|pwd
operator|+
name|t0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|strcpy
argument_list|(
name|buf3
argument_list|,
name|pwd
argument_list|)
expr_stmt|;
block|}
name|t0
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|idigit
argument_list|(
name|fm
index|[
literal|1
index|]
argument_list|)
condition|)
block|{
name|t0
operator|=
name|fm
index|[
literal|1
index|]
operator|-
literal|'0'
expr_stmt|;
name|fm
operator|++
expr_stmt|;
block|}
for|for
control|(
name|ss
operator|=
name|buf3
operator|+
name|strlen
argument_list|(
name|buf3
argument_list|)
init|;
name|ss
operator|>
name|buf3
condition|;
name|ss
operator|--
control|)
if|if
condition|(
operator|*
name|ss
operator|==
literal|'/'
operator|&&
operator|!
operator|--
name|t0
condition|)
block|{
name|ss
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|*
name|ss
operator|==
literal|'/'
operator|&&
name|ss
index|[
literal|1
index|]
operator|&&
operator|(
name|ss
operator|!=
name|buf3
operator|)
condition|)
name|ss
operator|++
expr_stmt|;
name|stradd
argument_list|(
name|ss
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'C'
case|:
name|strcpy
argument_list|(
name|buf3
argument_list|,
name|pwd
argument_list|)
expr_stmt|;
name|t0
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|idigit
argument_list|(
name|fm
index|[
literal|1
index|]
argument_list|)
condition|)
block|{
name|t0
operator|=
name|fm
index|[
literal|1
index|]
operator|-
literal|'0'
expr_stmt|;
name|fm
operator|++
expr_stmt|;
block|}
for|for
control|(
name|ss
operator|=
name|buf3
operator|+
name|strlen
argument_list|(
name|buf3
argument_list|)
init|;
name|ss
operator|>
name|buf3
condition|;
name|ss
operator|--
control|)
if|if
condition|(
operator|*
name|ss
operator|==
literal|'/'
operator|&&
operator|!
operator|--
name|t0
condition|)
block|{
name|ss
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|*
name|ss
operator|==
literal|'/'
operator|&&
name|ss
index|[
literal|1
index|]
operator|&&
operator|(
name|ss
operator|!=
name|buf3
operator|)
condition|)
name|ss
operator|++
expr_stmt|;
name|stradd
argument_list|(
name|ss
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'h'
case|:
case|case
literal|'!'
case|:
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"%d"
argument_list|,
name|curhist
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
name|stradd
argument_list|(
name|hostnam
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
if|if
condition|(
name|idigit
argument_list|(
name|fm
index|[
literal|1
index|]
argument_list|)
condition|)
name|t0
operator|=
operator|(
operator|*
operator|++
name|fm
operator|)
operator|-
literal|'0'
expr_stmt|;
else|else
name|t0
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|ss
operator|=
name|hostnam
init|;
operator|*
name|ss
condition|;
name|ss
operator|++
control|)
if|if
condition|(
operator|*
name|ss
operator|==
literal|'.'
operator|&&
operator|!
operator|--
name|t0
condition|)
break|break;
name|t0
operator|=
operator|*
name|ss
expr_stmt|;
operator|*
name|ss
operator|=
literal|'\0'
expr_stmt|;
name|stradd
argument_list|(
name|hostnam
argument_list|)
expr_stmt|;
operator|*
name|ss
operator|=
name|t0
expr_stmt|;
break|break;
case|case
literal|'S'
case|:
name|tstradd
argument_list|(
literal|"so"
argument_list|)
expr_stmt|;
comment|/*<- this is a macro */
case|case
literal|'s'
case|:
name|tstradd
argument_list|(
literal|"se"
argument_list|)
expr_stmt|;
case|case
literal|'B'
case|:
name|tstradd
argument_list|(
literal|"md"
argument_list|)
expr_stmt|;
case|case
literal|'b'
case|:
name|tstradd
argument_list|(
literal|"me"
argument_list|)
expr_stmt|;
case|case
literal|'U'
case|:
name|tstradd
argument_list|(
literal|"us"
argument_list|)
expr_stmt|;
case|case
literal|'u'
case|:
name|tstradd
argument_list|(
literal|"ue"
argument_list|)
expr_stmt|;
case|case
literal|'{'
case|:
name|bracepos
operator|=
name|bp
operator|-
name|buf
expr_stmt|;
name|countp
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'}'
case|:
name|lensb
operator|+=
operator|(
name|bp
operator|-
name|buf
operator|)
operator|-
name|bracepos
expr_stmt|;
name|countp
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
case|case
literal|'@'
case|:
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
literal|"%l:%M%p"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|bp
operator|==
literal|' '
condition|)
name|chuck
argument_list|(
name|bp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
literal|"%k:%M"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'*'
case|:
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
literal|"%k:%M:%S"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
name|stradd
argument_list|(
name|username
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
literal|"%a %e"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'W'
case|:
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
literal|"%m/%d/%y"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'D'
case|:
name|strcpy
argument_list|(
name|buf3
argument_list|,
literal|"%y-%m-%d"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fm
index|[
literal|1
index|]
operator|==
literal|'{'
condition|)
block|{
for|for
control|(
name|ss
operator|=
name|fm
operator|+
literal|1
operator|,
name|t0
operator|=
literal|0
init|;
operator|*
name|ss
condition|;
operator|++
name|ss
control|)
if|if
condition|(
operator|*
name|ss
operator|==
literal|'{'
condition|)
operator|++
name|t0
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|ss
operator|==
literal|'}'
condition|)
if|if
condition|(
operator|--
name|t0
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|*
name|ss
operator|==
literal|'}'
operator|&&
name|t0
operator|==
literal|0
condition|)
block|{
name|t0
operator|=
operator|(
name|ss
operator|-
literal|1
operator|)
operator|-
operator|(
name|fm
operator|+
literal|1
operator|)
expr_stmt|;
name|strncpy
argument_list|(
name|buf3
argument_list|,
name|fm
operator|+
literal|2
argument_list|,
name|t0
argument_list|)
expr_stmt|;
name|buf3
index|[
name|t0
index|]
operator|=
literal|0
expr_stmt|;
name|fm
operator|=
name|ss
expr_stmt|;
block|}
block|}
name|timet
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|tm
operator|=
name|localtime
argument_list|(
operator|&
name|timet
argument_list|)
expr_stmt|;
name|ztrftime
argument_list|(
name|bp
argument_list|,
literal|16
argument_list|,
name|buf3
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
if|if
condition|(
operator|*
name|ttystrname
condition|)
name|stradd
argument_list|(
operator|(
name|strncmp
argument_list|(
name|ttystrname
argument_list|,
literal|"/dev/tty"
argument_list|,
literal|8
argument_list|)
condition|?
name|ttystrname
operator|+
literal|5
else|:
name|ttystrname
operator|+
literal|8
operator|)
argument_list|)
expr_stmt|;
else|else
name|stradd
argument_list|(
literal|"()"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'?'
case|:
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"%d"
argument_list|,
name|lastval
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'%'
case|:
operator|*
name|bp
operator|++
operator|=
literal|'%'
expr_stmt|;
break|break;
case|case
literal|'#'
case|:
operator|*
name|bp
operator|++
operator|=
operator|(
name|geteuid
argument_list|()
operator|)
condition|?
literal|'%'
else|:
literal|'#'
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|stradd
argument_list|(
name|rstring
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'R'
case|:
name|stradd
argument_list|(
name|Rstring
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|*
name|bp
operator|++
operator|=
literal|'%'
expr_stmt|;
operator|*
name|bp
operator|++
operator|=
operator|*
name|fm
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
operator|*
name|fm
operator|==
literal|'!'
condition|)
block|{
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"%d"
argument_list|,
name|curhist
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|fm
index|[
literal|0
index|]
operator|==
literal|'\\'
operator|&&
name|fm
index|[
literal|1
index|]
condition|)
name|fm
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|bp
operator|++
operator|=
operator|*
name|fm
operator|)
operator|==
literal|'\n'
condition|)
name|bl0
operator|=
name|bp
operator|,
name|lensb
operator|=
literal|0
expr_stmt|;
block|}
block|}
operator|*
name|lenp
operator|=
operator|(
name|bp
operator|-
name|bl0
operator|)
operator|-
name|lensb
expr_stmt|;
operator|*
name|lenp
operator|%=
name|columns
expr_stmt|;
if|if
condition|(
operator|*
name|lenp
operator|==
name|columns
operator|-
literal|1
condition|)
block|{
operator|*
name|lenp
operator|=
literal|0
expr_stmt|;
operator|*
name|bp
operator|++
operator|=
literal|' '
expr_stmt|;
block|}
operator|*
name|bp
operator|=
literal|'\0'
expr_stmt|;
return|return
name|buf
return|;
block|}
end_function

end_unit

