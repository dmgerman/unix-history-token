begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) 1991  *      Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)  *      Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)  * Copyright (c) 1987 Oliver Laumann  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 1, or (at your option)  * any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program (see the file COPYING); if not, write to the  * Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  *  * Noteworthy contributors to screen's design and implementation:  *	Wayne Davison (davison@borland.com)  *	Patrick Wolfe (pat@kai.com, kailand!pat)  *	Bart Schaefer (schaefer@cse.ogi.edu)  *	Nathan Glasser (nathan@brokaw.lcs.mit.edu)  *	Larry W. Virden (lwv27%cas.BITNET@CUNYVM.CUNY.Edu)  *	Howard Chu (hyc@hanauma.jpl.nasa.gov)  *	Tim MacKenzie (tym@dibbler.cs.monash.edu.au)  *	Markku Jarvinen (mta@{cc,cs,ee}.tut.fi)  *	Marc Boucher (marc@CAM.ORG)  *  ****************************************************************  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|rcs_id
index|[]
init|=
literal|"$Id: help.c,v 1.2 92/02/03 02:28:33 jnweiger Exp $ FAU"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|BSDI
end_ifdef

begin_include
include|#
directive|include
file|<sys/signal.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BSDI */
end_comment

begin_include
include|#
directive|include
file|"screen.h"
end_include

begin_include
include|#
directive|include
file|"ansi.h"
end_include

begin_include
include|#
directive|include
file|"extern.h"
end_include

begin_include
include|#
directive|include
file|"patchlevel.h"
end_include

begin_decl_stmt
name|int
name|help_page
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|command_search
decl_stmt|,
name|command_bindings
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
name|Esc
decl_stmt|,
name|MetaEsc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|KeyNames
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|key
name|ktab
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|screenwidth
decl_stmt|,
name|screenheight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|blank
decl_stmt|,
modifier|*
name|null
decl_stmt|,
modifier|*
name|CE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|struct
name|win
modifier|*
name|fore
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|centerline
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|HelpRedisplayLine
name|__P
argument_list|(
operator|(
name|int
operator|,
name|int
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|process_help_input
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|*
operator|,
name|int
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|AbortHelp
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|add_key_to_buf
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|exit_with_usage
parameter_list|(
name|myname
parameter_list|)
name|char
modifier|*
name|myname
decl_stmt|;
block|{
name|printf
argument_list|(
literal|"Use: %s [-opts] [cmd [args]]\n"
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" or: %s -r [host.tty]\n\nOptions:\n"
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-a           Force all capabilities into each window's termcap\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-A -[r|R]    Adapt all windows to the new display width& height\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-c file      Read configuration file instead of .screenrc\n"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|REMOTE_DETACH
name|printf
argument_list|(
literal|"-d (-r)      Detach the elsewhere running screen (and reattach here)\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-D (-r)      Detach and logout remote (and reattach here)\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|printf
argument_list|(
literal|"-e xy        Change command characters\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-f           Flow control on, -fn = off, -fa = auto\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-h lines     Set the size of the scrollback history buffer\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-i           Interrupt output sooner when flow control is on\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-l           Login mode on (update %s), -ln = off\n"
argument_list|,
name|UTMPFILE
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-list        or -ls. Do nothing, just list our SockDir\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-L           Terminal's last character can be safely updated\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-O           Choose optimal output rather than exact vt100 emulation\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-q           Quiet startup. Sets $status if unsuccessful.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-r           Reattach to a detached screen process\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-R           Reattach if possible, otherwise start a new session\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-s shell     Shell to execute rather than $SHELL\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-T term      Use term as $TERM for windows, rather than \"screen\"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-t title     Set command's a.k.a. (window title)\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-wipe        Do nothing, just clean up SockDir\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Esc-char is not consumed. All others are. Esc-char, space, and return end */
end_comment

begin_function
specifier|static
name|void
name|process_help_input
parameter_list|(
name|ppbuf
parameter_list|,
name|plen
parameter_list|)
name|char
modifier|*
modifier|*
name|ppbuf
decl_stmt|;
name|int
modifier|*
name|plen
decl_stmt|;
block|{
name|int
name|done
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|ppbuf
operator|==
literal|0
condition|)
block|{
name|AbortHelp
argument_list|()
expr_stmt|;
return|return;
block|}
while|while
condition|(
operator|!
name|done
operator|&&
operator|*
name|plen
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
operator|*
operator|*
name|ppbuf
condition|)
block|{
case|case
literal|' '
case|:
if|if
condition|(
name|display_help
argument_list|()
operator|==
literal|0
condition|)
break|break;
comment|/* FALLTHROUGH */
case|case
literal|'\r'
case|:
case|case
literal|'\n'
case|:
name|done
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
if|if
condition|(
operator|*
operator|*
name|ppbuf
operator|==
name|Esc
condition|)
block|{
name|done
operator|=
literal|1
expr_stmt|;
continue|continue;
block|}
break|break;
block|}
operator|++
operator|*
name|ppbuf
expr_stmt|;
operator|--
operator|*
name|plen
expr_stmt|;
block|}
if|if
condition|(
name|done
condition|)
name|AbortHelp
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|AbortHelp
parameter_list|()
block|{
name|help_page
operator|=
literal|0
expr_stmt|;
name|ExitOverlayPage
argument_list|()
expr_stmt|;
name|Activate
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|int
name|maxrow
decl_stmt|,
name|grow
decl_stmt|,
name|numcols
decl_stmt|,
name|numrows
decl_stmt|,
name|num_names
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|numskip
decl_stmt|,
name|numpages
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|display_help
parameter_list|()
block|{
name|int
name|col
decl_stmt|,
name|crow
decl_stmt|,
name|n
decl_stmt|,
name|key
init|=
literal|0
decl_stmt|;
name|enum
name|keytype
name|typ
init|=
name|ktab
index|[
literal|0
index|]
operator|.
name|type
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
name|Esc_buf
index|[
literal|5
index|]
decl_stmt|,
name|cbuf
index|[
literal|256
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|help_page
operator|++
condition|)
block|{
if|if
condition|(
name|screenwidth
operator|<
literal|26
operator|||
name|screenheight
operator|<
literal|6
condition|)
block|{
name|Msg
argument_list|(
literal|0
argument_list|,
literal|"Window size too small for help page"
argument_list|)
expr_stmt|;
name|help_page
operator|=
literal|0
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|InitOverlayPage
argument_list|(
name|process_help_input
argument_list|,
name|HelpRedisplayLine
argument_list|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|command_bindings
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|key
operator|=
literal|0
init|;
name|key
operator|<
literal|256
condition|;
name|key
operator|++
control|)
if|if
condition|(
operator|(
name|typ
operator|=
name|ktab
index|[
name|key
index|]
operator|.
name|type
operator|)
operator|==
name|KEY_CREATE
operator|||
name|typ
operator|==
name|KEY_SCREEN
operator|||
name|typ
operator|==
name|KEY_SET
operator|||
operator|(
name|typ
operator|==
name|KEY_AKA
operator|&&
name|ktab
index|[
name|key
index|]
operator|.
name|args
operator|)
condition|)
name|command_bindings
operator|++
expr_stmt|;
name|debug1
argument_list|(
literal|"help: command_bindings counted: %d\n"
argument_list|,
name|command_bindings
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|KeyNames
index|[
name|n
index|]
operator|!=
name|NULL
condition|;
name|n
operator|++
control|)
empty_stmt|;
comment|/* we dont know "sizeof * KeyNames" */
name|num_names
operator|=
name|n
operator|-
literal|1
expr_stmt|;
name|debug1
argument_list|(
literal|"help: we find %d named keys (+1).\n"
argument_list|,
name|num_names
argument_list|)
expr_stmt|;
name|command_search
operator|=
literal|0
expr_stmt|;
name|numcols
operator|=
name|screenwidth
operator|/
literal|26
expr_stmt|;
if|if
condition|(
name|numcols
operator|==
literal|0
condition|)
name|numcols
operator|=
literal|1
expr_stmt|;
name|numrows
operator|=
operator|(
name|num_names
operator|+
name|numcols
operator|-
literal|1
operator|)
operator|/
name|numcols
expr_stmt|;
name|debug1
argument_list|(
literal|"Numrows: %d\n"
argument_list|,
name|numrows
argument_list|)
expr_stmt|;
name|numskip
operator|=
name|screenheight
operator|-
literal|5
operator|-
operator|(
literal|2
operator|+
name|numrows
operator|)
expr_stmt|;
while|while
condition|(
name|numskip
operator|<
literal|0
condition|)
name|numskip
operator|+=
name|screenheight
operator|-
literal|5
expr_stmt|;
name|numskip
operator|%=
name|screenheight
operator|-
literal|5
expr_stmt|;
name|debug1
argument_list|(
literal|"Numskip: %d\n"
argument_list|,
name|numskip
argument_list|)
expr_stmt|;
if|if
condition|(
name|numskip
operator|>
name|screenheight
operator|/
literal|3
operator|||
name|numskip
operator|>
name|command_bindings
condition|)
name|numskip
operator|=
literal|1
expr_stmt|;
name|maxrow
operator|=
literal|2
operator|+
name|numrows
operator|+
name|numskip
operator|+
name|command_bindings
expr_stmt|;
name|grow
operator|=
literal|0
expr_stmt|;
name|numpages
operator|=
operator|(
name|maxrow
operator|+
name|screenheight
operator|-
literal|6
operator|)
operator|/
operator|(
name|screenheight
operator|-
literal|5
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|grow
operator|>=
name|maxrow
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
comment|/* Clear the help screen */
name|ClearDisplay
argument_list|()
expr_stmt|;
name|sprintf
argument_list|(
name|cbuf
argument_list|,
literal|"Screen key bindings, page %d of %d."
argument_list|,
name|help_page
argument_list|,
name|numpages
argument_list|)
expr_stmt|;
name|centerline
argument_list|(
name|cbuf
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|crow
operator|=
literal|2
expr_stmt|;
operator|*
name|Esc_buf
operator|=
literal|'\0'
expr_stmt|;
name|add_key_to_buf
argument_list|(
name|Esc_buf
argument_list|,
name|Esc
argument_list|)
expr_stmt|;
name|Esc_buf
index|[
name|strlen
argument_list|(
name|Esc_buf
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
init|;
name|crow
operator|<
name|screenheight
operator|-
literal|3
condition|;
name|crow
operator|++
control|)
block|{
if|if
condition|(
name|grow
operator|<
literal|1
condition|)
block|{
operator|*
name|buf
operator|=
literal|'\0'
expr_stmt|;
name|add_key_to_buf
argument_list|(
name|buf
argument_list|,
name|MetaEsc
argument_list|)
expr_stmt|;
name|buf
index|[
name|strlen
argument_list|(
name|buf
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|sprintf
argument_list|(
name|cbuf
argument_list|,
literal|"Command key:  %s   Literal %s:  %s"
argument_list|,
name|Esc_buf
argument_list|,
name|Esc_buf
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|centerline
argument_list|(
name|cbuf
argument_list|)
expr_stmt|;
name|grow
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|grow
operator|>=
literal|2
operator|&&
name|grow
operator|-
literal|2
operator|<
name|numrows
condition|)
block|{
for|for
control|(
name|col
operator|=
literal|0
init|;
name|col
operator|<
name|numcols
operator|&&
operator|(
name|n
operator|=
name|numrows
operator|*
name|col
operator|+
operator|(
name|grow
operator|-
literal|2
operator|)
operator|)
operator|<
name|num_names
condition|;
name|col
operator|++
control|)
block|{
name|debug1
argument_list|(
literal|"help: searching key %d\n"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|key
operator|=
literal|0
init|;
name|key
operator|<
literal|128
condition|;
name|key
operator|++
control|)
if|if
condition|(
name|ktab
index|[
name|key
index|]
operator|.
name|type
operator|==
operator|(
expr|enum
name|keytype
operator|)
operator|(
name|n
operator|+
literal|2
operator|)
operator|&&
operator|(
operator|(
expr|enum
name|keytype
operator|)
operator|(
name|n
operator|+
literal|2
operator|)
operator|!=
name|KEY_AKA
operator|||
operator|!
name|ktab
index|[
name|key
index|]
operator|.
name|args
operator|)
condition|)
name|add_key_to_buf
argument_list|(
name|buf
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|buf
index|[
literal|14
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* 	       * Format is up to 10 chars of name, 1 spaces, 14 chars of key 	       * bindings, and a space. 	       */
name|printf
argument_list|(
literal|"%-10.10s %-14.14s "
argument_list|,
name|KeyNames
index|[
name|n
operator|+
literal|1
index|]
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\r\n"
argument_list|)
expr_stmt|;
name|grow
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|grow
operator|-
literal|2
operator|-
name|numrows
operator|>=
name|numskip
operator|&&
name|grow
operator|-
literal|2
operator|-
name|numrows
operator|-
name|numskip
operator|<
name|command_bindings
condition|)
block|{
name|char
modifier|*
modifier|*
name|pp
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
while|while
condition|(
name|command_search
operator|<
literal|128
operator|&&
operator|(
name|typ
operator|=
name|ktab
index|[
name|command_search
index|]
operator|.
name|type
operator|)
operator|!=
name|KEY_CREATE
operator|&&
name|typ
operator|!=
name|KEY_SCREEN
operator|&&
name|typ
operator|!=
name|KEY_SET
operator|&&
operator|(
name|typ
operator|!=
name|KEY_AKA
operator|||
operator|!
name|ktab
index|[
name|command_search
index|]
operator|.
name|args
operator|)
condition|)
name|command_search
operator|++
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|add_key_to_buf
argument_list|(
name|buf
argument_list|,
name|command_search
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-4s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|col
operator|=
literal|4
expr_stmt|;
if|if
condition|(
name|typ
operator|!=
name|KEY_CREATE
condition|)
block|{
name|col
operator|+=
name|strlen
argument_list|(
name|KeyNames
index|[
operator|(
name|int
operator|)
name|typ
operator|-
literal|1
index|]
argument_list|)
operator|+
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|KeyNames
index|[
operator|(
name|int
operator|)
name|typ
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|pp
operator|=
name|ktab
index|[
name|command_search
operator|++
index|]
operator|.
name|args
expr_stmt|;
while|while
condition|(
name|pp
operator|&&
operator|(
name|cp
operator|=
operator|*
name|pp
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
operator|*
name|cp
operator|||
operator|(
name|index
argument_list|(
name|cp
argument_list|,
literal|' '
argument_list|)
operator|!=
name|NULL
operator|)
condition|)
block|{
if|if
condition|(
name|index
argument_list|(
name|cp
argument_list|,
literal|'\''
argument_list|)
operator|!=
name|NULL
condition|)
operator|*
name|buf
operator|=
literal|'"'
expr_stmt|;
else|else
operator|*
name|buf
operator|=
literal|'\''
expr_stmt|;
name|sprintf
argument_list|(
name|buf
operator|+
literal|1
argument_list|,
literal|"%s%c"
argument_list|,
name|cp
argument_list|,
operator|*
name|buf
argument_list|)
expr_stmt|;
name|cp
operator|=
name|buf
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|col
operator|+=
name|strlen
argument_list|(
name|cp
argument_list|)
operator|+
literal|1
operator|)
operator|>=
name|screenwidth
condition|)
block|{
name|col
operator|=
name|screenwidth
operator|-
operator|(
name|col
operator|-
operator|(
name|strlen
argument_list|(
name|cp
argument_list|)
operator|+
literal|1
operator|)
operator|)
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|col
operator|>=
literal|0
condition|)
block|{
name|n
operator|=
name|cp
index|[
name|col
index|]
expr_stmt|;
name|cp
index|[
name|col
index|]
operator|=
literal|'\0'
expr_stmt|;
name|printf
argument_list|(
literal|"%s$"
argument_list|,
operator|*
name|pp
argument_list|)
expr_stmt|;
name|cp
index|[
name|col
index|]
operator|=
operator|(
name|char
operator|)
name|n
expr_stmt|;
block|}
break|break;
block|}
name|printf
argument_list|(
literal|"%s%c"
argument_list|,
name|cp
argument_list|,
operator|(
name|screenwidth
operator|-
name|col
operator|!=
literal|1
operator|||
operator|!
name|pp
index|[
literal|1
index|]
operator|)
condition|?
literal|' '
else|:
literal|'$'
argument_list|)
expr_stmt|;
name|pp
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\r\n"
argument_list|)
expr_stmt|;
name|grow
operator|++
expr_stmt|;
block|}
else|else
block|{
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|grow
operator|++
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|cbuf
argument_list|,
literal|"[Press Space %s Return to end; %s to begin a command.]"
argument_list|,
name|grow
operator|<
name|maxrow
condition|?
literal|"for next page;"
else|:
literal|"or"
argument_list|,
name|Esc_buf
argument_list|)
expr_stmt|;
name|centerline
argument_list|(
name|cbuf
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|SetLastPos
argument_list|(
literal|0
argument_list|,
name|screenheight
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|add_key_to_buf
parameter_list|(
name|buf
parameter_list|,
name|key
parameter_list|)
name|char
modifier|*
name|buf
decl_stmt|;
name|int
name|key
decl_stmt|;
block|{
name|debug1
argument_list|(
literal|"help: key found: %c\n"
argument_list|,
name|key
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|key
condition|)
block|{
case|case
literal|' '
case|:
name|strcat
argument_list|(
name|buf
argument_list|,
literal|"sp "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7f
case|:
name|strcat
argument_list|(
name|buf
argument_list|,
literal|"^? "
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|key
operator|<
literal|' '
condition|)
name|sprintf
argument_list|(
name|buf
operator|+
name|strlen
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"^%c "
argument_list|,
operator|(
name|key
operator||
literal|0x40
operator|)
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|buf
operator|+
name|strlen
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%c "
argument_list|,
name|key
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|centerline
parameter_list|(
name|str
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
block|{
name|int
name|l
decl_stmt|;
name|l
operator|=
operator|(
name|screenwidth
operator|-
literal|1
operator|+
name|strlen
argument_list|(
name|str
argument_list|)
operator|)
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|l
operator|>
name|screenwidth
operator|-
literal|1
condition|)
name|l
operator|=
name|screenwidth
operator|-
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"%*.*s\r\n"
argument_list|,
name|l
argument_list|,
name|l
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|HelpRedisplayLine
parameter_list|(
name|y
parameter_list|,
name|xs
parameter_list|,
name|xe
parameter_list|,
name|isblank
parameter_list|)
name|int
name|y
decl_stmt|,
name|xs
decl_stmt|,
name|xe
decl_stmt|,
name|isblank
decl_stmt|;
block|{
if|if
condition|(
name|isblank
condition|)
return|return;
if|if
condition|(
name|CE
condition|)
block|{
name|GotoPos
argument_list|(
name|xs
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|PutStr
argument_list|(
name|CE
argument_list|)
expr_stmt|;
return|return;
block|}
name|DisplayLine
argument_list|(
name|null
argument_list|,
name|null
argument_list|,
name|null
argument_list|,
name|blank
argument_list|,
name|null
argument_list|,
name|null
argument_list|,
name|y
argument_list|,
name|xs
argument_list|,
name|xe
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * here all the copyright stuff   */
end_comment

begin_decl_stmt
specifier|static
name|char
name|version
index|[
literal|40
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|cpmsg
index|[]
init|=
literal|"\ \n\ iScreen version %v\n\ \n\ Copyright (c) 1991\n\     Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)\n\     Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)\n\ Copyright (c) 1987 Oliver Laumann\n\ \n\ This program is free software; you can redistribute it and/or \ modify it under the terms of the GNU General Public License as published \ by the Free Software Foundation; either version 1, or (at your option) \ any later version.\n\ \n\ This program is distributed in the hope that it will be useful, \ but WITHOUT ANY WARRANTY; without even the implied warranty of \ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \ GNU General Public License for more details.\n\ \n\ You should have received a copy of the GNU General Public License \ along with this program (see the file COPYING); if not, write to the \ Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.\n"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|process_copyright_input
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|*
operator|,
name|int
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|AbortCopyright
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|copypage
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cps
decl_stmt|,
modifier|*
name|savedcps
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|process_copyright_input
parameter_list|(
name|ppbuf
parameter_list|,
name|plen
parameter_list|)
name|char
modifier|*
modifier|*
name|ppbuf
decl_stmt|;
name|int
modifier|*
name|plen
decl_stmt|;
block|{
name|int
name|done
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|ppbuf
operator|==
literal|0
condition|)
block|{
name|AbortCopyright
argument_list|()
expr_stmt|;
return|return;
block|}
while|while
condition|(
operator|!
name|done
operator|&&
operator|*
name|plen
operator|>
literal|0
condition|)
block|{
switch|switch
condition|(
operator|*
operator|*
name|ppbuf
condition|)
block|{
case|case
literal|' '
case|:
if|if
condition|(
operator|*
name|cps
condition|)
block|{
name|copypage
argument_list|()
expr_stmt|;
break|break;
block|}
comment|/* FALLTHROUGH */
case|case
literal|'\r'
case|:
case|case
literal|'\n'
case|:
name|AbortCopyright
argument_list|()
expr_stmt|;
name|done
operator|=
literal|1
expr_stmt|;
break|break;
default|default:
break|break;
block|}
operator|++
operator|*
name|ppbuf
expr_stmt|;
operator|--
operator|*
name|plen
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|AbortCopyright
parameter_list|()
block|{
name|ExitOverlayPage
argument_list|()
expr_stmt|;
name|Activate
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|display_copyright
parameter_list|()
block|{
if|if
condition|(
name|screenwidth
operator|<
literal|10
operator|||
name|screenheight
operator|<
literal|5
condition|)
block|{
name|Msg
argument_list|(
literal|0
argument_list|,
literal|"Window size too small for copyright page"
argument_list|)
expr_stmt|;
return|return;
block|}
name|InitOverlayPage
argument_list|(
name|process_copyright_input
argument_list|,
name|HelpRedisplayLine
argument_list|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|version
argument_list|,
literal|"%d.%.2d.%.2d%s (%s) %s"
argument_list|,
name|REV
argument_list|,
name|VERS
argument_list|,
name|PATCHLEVEL
argument_list|,
name|STATE
argument_list|,
name|ORIGIN
argument_list|,
name|DATE
argument_list|)
expr_stmt|;
name|cps
operator|=
name|cpmsg
expr_stmt|;
name|savedcps
operator|=
literal|0
expr_stmt|;
name|copypage
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|copypage
parameter_list|()
block|{
name|char
modifier|*
name|ws
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|l
decl_stmt|;
name|char
name|cbuf
index|[
literal|80
index|]
decl_stmt|;
name|ClearDisplay
argument_list|()
expr_stmt|;
name|x
operator|=
name|y
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|cps
condition|)
block|{
name|ws
operator|=
name|cps
expr_stmt|;
while|while
condition|(
operator|*
name|cps
operator|==
literal|' '
condition|)
name|cps
operator|++
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|cps
argument_list|,
literal|"%v"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
block|{
name|savedcps
operator|=
name|cps
operator|+
literal|2
expr_stmt|;
name|ws
operator|=
name|cps
operator|=
name|version
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|cps
operator|&&
operator|*
name|cps
operator|!=
literal|' '
operator|&&
operator|*
name|cps
operator|!=
literal|'\n'
condition|)
name|cps
operator|++
expr_stmt|;
name|l
operator|=
name|cps
operator|-
name|ws
expr_stmt|;
name|cps
operator|=
name|ws
expr_stmt|;
if|if
condition|(
name|l
operator|>
name|screenwidth
operator|-
literal|1
condition|)
name|l
operator|=
name|screenwidth
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|x
operator|&&
name|x
operator|+
name|l
operator|>=
name|screenwidth
operator|-
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|"\r\n"
argument_list|)
expr_stmt|;
name|x
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|++
name|y
operator|>
name|screenheight
operator|-
literal|4
condition|)
break|break;
block|}
if|if
condition|(
name|x
condition|)
block|{
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|l
condition|)
name|printf
argument_list|(
literal|"%*.*s"
argument_list|,
name|l
argument_list|,
name|l
argument_list|,
name|ws
argument_list|)
expr_stmt|;
name|x
operator|+=
name|l
expr_stmt|;
name|cps
operator|+=
name|l
expr_stmt|;
if|if
condition|(
operator|*
name|cps
operator|==
literal|0
operator|&&
name|savedcps
condition|)
block|{
name|cps
operator|=
name|savedcps
expr_stmt|;
name|savedcps
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|cps
operator|==
literal|'\n'
condition|)
block|{
name|printf
argument_list|(
literal|"\r\n"
argument_list|)
expr_stmt|;
name|x
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|++
name|y
operator|>
name|screenheight
operator|-
literal|4
condition|)
break|break;
block|}
if|if
condition|(
operator|*
name|cps
operator|==
literal|' '
operator|||
operator|*
name|cps
operator|==
literal|'\n'
condition|)
name|cps
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|y
operator|++
operator|<
name|screenheight
operator|-
literal|2
condition|)
name|printf
argument_list|(
literal|"\r\n"
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|cbuf
argument_list|,
literal|"[Press Space %s Return to end.]"
argument_list|,
operator|*
name|cps
condition|?
literal|"for next page;"
else|:
literal|"or"
argument_list|)
expr_stmt|;
name|centerline
argument_list|(
name|cbuf
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|SetLastPos
argument_list|(
literal|0
argument_list|,
name|screenheight
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

