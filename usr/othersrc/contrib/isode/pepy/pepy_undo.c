begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* pepy_undo.c - PE parser (yacc-based) building routines */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/pepy/RCS/pepy_undo.c,v 7.4 91/02/22 09:35:08 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * $Header: /f/osi/pepy/RCS/pepy_undo.c,v 7.4 91/02/22 09:35:08 mrose Interim $  *  *  * $Log:	pepy_undo.c,v $  * Revision 7.4  91/02/22  09:35:08  mrose  * Interim 6.8  *   * Revision 7.3  90/11/11  10:01:29  mrose  * touch-up  *   * Revision 7.2  90/10/29  18:38:24  mrose  * updates  *   * Revision 7.1  90/10/23  20:42:45  mrose  * update  *   * Revision 7.0  89/11/23  22:11:55  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"pepy.h"
end_include

begin_decl_stmt
specifier|extern
name|struct
name|tuple
name|tuples
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|rflag
decl_stmt|,
name|hflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|gensym
argument_list|()
decl_stmt|,
modifier|*
name|modsym
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|YP
name|lookup_type
argument_list|()
decl_stmt|,
name|lookup_binding
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|YT
name|lookup_tag
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|add_point
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
name|undo_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|Vflag
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|arg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Vflag
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|register
name|char
modifier|*
name|narg
decl_stmt|;
specifier|register
name|struct
name|tuple
modifier|*
name|t
decl_stmt|;
specifier|register
name|YP
name|y
decl_stmt|;
specifier|register
name|YV
name|yv
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
block|{
name|yyerror_aux
argument_list|(
literal|"oops, I shouldn't be here!"
argument_list|)
expr_stmt|;
name|print_type
argument_list|(
name|yp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|level
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"(pe, explicit, len, buffer, parm)\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%sPE\tpe;\nint\texplicit;\n"
argument_list|,
name|yp
operator|->
name|yp_code
operator|!=
name|YP_ANY
operator|&&
name|yp
operator|->
name|yp_code
operator|!=
name|YP_NULL
operator|&&
operator|(
name|yp
operator|->
name|yp_code
operator|!=
name|YP_CHOICE
operator|||
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_CONTROLLED
operator|)
operator|)
condition|?
literal|"register "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"int    *len;\nchar  **buffer;\n%s parm;\n{\n"
argument_list|,
name|yp
operator|->
name|yp_param_type
condition|?
name|yp
operator|->
name|yp_param_type
else|:
literal|"PEPYPARM"
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_action0
condition|)
block|{
if|if
condition|(
operator|!
name|Pflag
operator|&&
operator|*
name|sysin
condition|)
name|printf
argument_list|(
literal|"# line %d \"%s\"\n"
argument_list|,
name|yp
operator|->
name|yp_act0_lineno
argument_list|,
name|sysin
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_action0
argument_list|)
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BOOL
case|:
case|case
name|YP_INT
case|:
if|if
condition|(
operator|!
name|Vflag
operator|&&
operator|(
name|dflag
operator|||
operator|!
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_intexp
operator|)
operator|)
condition|)
break|break;
comment|/* else fall */
case|case
name|YP_INTLIST
case|:
case|case
name|YP_ENUMLIST
case|:
name|printf
argument_list|(
literal|"%*sregister integer %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_BIT
case|:
if|if
condition|(
operator|!
name|Vflag
operator|&&
operator|(
name|dflag
operator|||
operator|!
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
operator|)
condition|)
break|break;
comment|/* else fall */
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"%*sregister PE %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_OCT
case|:
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
condition|)
block|{
name|narg
operator|=
name|gensym
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|Vflag
operator|&&
name|yp
operator|->
name|yp_prfexp
operator|==
literal|'q'
condition|)
name|printf
argument_list|(
literal|"%*sregister struct qbuf *%s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sregister char *%s;\n%*sint %s_len;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_REAL
case|:
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
condition|)
block|{
name|narg
operator|=
name|gensym
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"%*sregister double %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_NULL
case|:
case|case
name|YP_CHOICE
case|:
case|case
name|YP_ANY
case|:
case|case
name|YP_IDEFINED
case|:
name|narg
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|YP_OID
case|:
if|if
condition|(
operator|!
name|Vflag
operator|&&
operator|(
name|dflag
operator|||
operator|(
operator|!
name|yp
operator|->
name|yp_action2
operator|&&
operator|!
name|yp
operator|->
name|yp_strexp
operator|&&
name|level
operator|!=
literal|1
operator|)
operator|)
condition|)
break|break;
comment|/* else fall */
name|printf
argument_list|(
literal|"%*sregister OID %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQ
case|:
case|case
name|YP_SEQTYPE
case|:
case|case
name|YP_SEQLIST
case|:
case|case
name|YP_SET
case|:
case|case
name|YP_SETTYPE
case|:
case|case
name|YP_SETLIST
case|:
name|narg
operator|=
name|gensym
argument_list|()
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_code
operator|==
name|YP_SETLIST
condition|)
name|printf
argument_list|(
literal|"%*sint %s_count = 0;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sregister PE %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
default|default:
name|myyerror
argument_list|(
literal|"unknown type: %d"
argument_list|,
name|yp
operator|->
name|yp_code
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|Vflag
condition|)
block|{
name|printf
argument_list|(
literal|"#ifdef DEBUG\n%*s(void) testdebug (%s, \""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"%s."
argument_list|,
name|mymodule
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s\");\n#endif\n\n"
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|level
operator|==
literal|1
operator|&&
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (explicit\n%*s&& PE_ID (%s -> pe_class, %s -> pe_id)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s!= PE_ID (PE_CLASS_%s, %d)) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|pe_classlist
index|[
name|yp
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|yp
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s/0x%%x\", PEPY_ERR_BAD_CLASS,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_classlist[%s -> pe_class], %s -> pe_id);\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|*
literal|4
operator|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
condition|)
block|{
for|for
control|(
name|t
operator|=
name|tuples
init|;
name|t
operator|->
name|t_type
operator|!=
name|YP_UNDF
condition|;
name|t
operator|++
control|)
if|if
condition|(
name|t
operator|->
name|t_type
operator|==
name|yp
operator|->
name|yp_code
condition|)
block|{
name|check_type
argument_list|(
name|id
argument_list|,
name|level
argument_list|,
name|t
operator|->
name|t_class
argument_list|,
name|t
operator|->
name|t_form
argument_list|,
name|t
operator|->
name|t_id
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|level
operator|==
literal|1
operator|&&
name|yp
operator|->
name|yp_code
operator|!=
name|YP_CHOICE
operator|&&
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|==
name|YP_TAG
condition|)
block|{
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
operator|==
literal|0
operator|||
name|is_nonimplicit_type
argument_list|(
name|yp
argument_list|)
condition|)
name|tag_pullup
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
literal|"element"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
block|{
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"%*svname (\"%s\");\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|hflag
operator|&&
name|yp
operator|->
name|yp_code
operator|==
name|YP_IDEFINED
condition|)
name|printf
argument_list|(
literal|"%*svname (\"%s\");\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|&&
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*svtag (%d, %d);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_tag
operator|->
name|yt_class
argument_list|,
name|val2int
argument_list|(
name|yp
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action05
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action05
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_act05_lineno
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action1
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action1
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_act1_lineno
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BOOL
case|:
if|if
condition|(
name|Vflag
operator|||
operator|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_intexp
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif ((%s = prim2flag (%s)) == NOTOK) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sif (prim2flag (%s) == NOTOK) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_BOOLEAN,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
name|level
operator|==
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif (len)\n%*s*len = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (%s ? \"TRUE\" : \"FALSE\");\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_INT
case|:
if|if
condition|(
name|Vflag
operator|||
operator|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_intexp
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif ((%s = prim2num (%s)) == NOTOK\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sif (prim2num (%s) == NOTOK\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s&& %s -> pe_errno != PE_ERR_NONE) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_INTEGER,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
name|level
operator|==
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif (len)\n%*s*len = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"%%d\", %s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_REAL
case|:
if|if
condition|(
name|Vflag
operator|||
operator|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif ((%s = prim2real (%s)) == NOTOK\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sif (prim2real (%s) == NOTOK\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s&& %s -> pe_errno != PE_ERR_NONE) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_REAL,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"%%g\", %s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_INTLIST
case|:
case|case
name|YP_ENUMLIST
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2%snum (%s)) == NOTOK\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_code
operator|==
name|YP_ENUMLIST
condition|?
literal|"e"
else|:
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s&& %s -> pe_errno != PE_ERR_NONE) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_INTEGER,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
name|level
operator|==
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif (len)\n%*s*len = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|uniqint
argument_list|(
name|yp
operator|->
name|yp_value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sswitch (%s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
block|{
name|printf
argument_list|(
literal|"%*scase %d:"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
block|{
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"%s\");\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*svprint (\"%%d\", %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yv
operator|->
name|yv_action
condition|)
name|do_action
argument_list|(
name|yv
operator|->
name|yv_action
argument_list|,
name|level
operator|+
literal|2
argument_list|,
name|narg
argument_list|,
name|yv
operator|->
name|yv_act_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sbreak;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|rflag
operator|&&
name|yp
operator|->
name|yp_code
operator|==
name|YP_ENUMLIST
condition|)
block|{
name|printf
argument_list|(
literal|"%*sdefault:\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%d\", PEPY_ERR_UNK_COMP, %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|Vflag
condition|)
block|{
name|printf
argument_list|(
literal|"%*sdefault:\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*svprint (\"%%d\", %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sbreak;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_BIT
case|:
if|if
condition|(
name|Vflag
operator|||
operator|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif ((%s = prim2bit (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sif (prim2bit (%s) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_BITS,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = bitstr2strb (%s,&(%s));\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
name|level
operator|==
literal|1
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (buffer&& len)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s*buffer = %s, *len = %s;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*s*buffer = bitstr2strb (%s, len);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (%s -> pe_nbits< 128)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*svprint (\"%%s\", bit2str (%s, \"\\020\"));\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*selse\n%*svunknown (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2bit (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_BITS,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = bitstr2strb (%s,&(%s));\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
name|level
operator|==
literal|1
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (buffer&& len)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s*buffer = %s, *len = %s;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*s*buffer = bitstr2strb (%s, len);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|notdef
if|if
condition|(
operator|!
name|rflag
condition|)
block|{
specifier|register
name|int
name|j
decl_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
operator|,
name|i
operator|=
literal|0
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
if|if
condition|(
operator|(
name|j
operator|=
name|val2int
argument_list|(
name|yv
argument_list|)
operator|)
operator|>
name|i
condition|)
name|i
operator|=
name|j
expr_stmt|;
name|i
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (%s -> pe_nbits> %d) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s(%d): %%d\", PEPY_ERR_TOO_MANY_BITS,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s -> pe_nbits);\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|i
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
if|if
condition|(
operator|(
name|j
operator|=
name|val2int
argument_list|(
name|yv
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"invalid bit number in BIT STRING"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|j
operator|>
name|i
condition|)
name|i
operator|=
name|j
expr_stmt|;
name|printf
argument_list|(
literal|"#define\tBITS\t\"\\020"
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
sizeof|sizeof
argument_list|(
name|int
argument_list|)
operator|*
literal|8
condition|)
block|{
comment|/* NBBY */
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\\0%o%s"
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
operator|+
literal|1
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\0%oBIT%d"
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
operator|+
literal|1
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
name|uniqint
argument_list|(
name|yp
operator|->
name|yp_value
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
condition|)
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
block|{
if|if
condition|(
operator|!
name|yv
operator|->
name|yv_action
condition|)
continue|continue;
name|printf
argument_list|(
literal|"%*sif (bit_test (%s, %d)> OK) {"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|do_action
argument_list|(
name|yv
operator|->
name|yv_action
argument_list|,
name|level
operator|+
literal|1
argument_list|,
name|narg
argument_list|,
name|yv
operator|->
name|yv_act_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"%%s\", bit2str (%s, BITS));\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_OCT
case|:
if|if
condition|(
operator|!
name|dflag
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif ((%s = "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Vflag
operator|&&
name|yp
operator|->
name|yp_prfexp
operator|==
literal|'q'
condition|)
name|printf
argument_list|(
literal|"prim2qb (%s)) == (struct qbuf *)0) {\n"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"prim2str (%s,&%s_len)) == NULLCP) {\n"
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_OCTET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_prfexp
operator|==
literal|'q'
operator|&&
name|Vflag
operator|)
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_intexp
operator|&&
name|yp
operator|->
name|yp_prfexp
operator|!=
literal|'q'
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s_len;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svstring (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_ANY
case|:
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s(%s = %s) -> pe_refcnt++;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svunknown (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_NULL
case|:
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"NULL\");\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_OID
case|:
if|if
condition|(
name|Vflag
operator|||
operator|(
operator|!
name|dflag
operator|&&
operator|(
name|yp
operator|->
name|yp_action2
operator|||
name|yp
operator|->
name|yp_strexp
operator|||
name|level
operator|==
literal|1
operator|)
operator|)
condition|)
name|printf
argument_list|(
literal|"%*sif ((%s = prim2oid (%s)) == NULLOID) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*sif (prim2oid (%s) == NULLOID) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_OID,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|level
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (buffer)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s*buffer = sprintoid (%s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = oid_cpy (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svprint (\"%%s\", oid2ode (%s));\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQ
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2seq (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s(%s = %s) -> pe_refcnt++;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svunknown (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQTYPE
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2seq (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpush ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_type
condition|)
block|{
name|printf
argument_list|(
literal|"%*sfor (%s = first_member (%s); %s; %s = next_member (%s, %s)) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
block|{
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action3
argument_list|,
operator|++
name|level
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_act3_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|undo_type
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|level
operator|+
literal|1
argument_list|,
literal|"element"
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|--
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpop ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQLIST
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2seq (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpush ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
operator|,
name|i
operator|=
literal|0
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|i
operator|+=
name|undo_components_seq
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|y
operator|==
name|yp
operator|->
name|yp_type
argument_list|,
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
else|else
block|{
name|undo_type_element
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|y
operator|==
name|yp
operator|->
name|yp_type
argument_list|,
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpop ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
specifier|register
name|YP
name|z
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|y
argument_list|)
operator|==
name|NULLYT
condition|)
continue|continue;
for|for
control|(
name|z
operator|=
name|y
operator|->
name|yp_next
init|;
name|z
condition|;
name|z
operator|=
name|z
operator|->
name|yp_next
control|)
if|if
condition|(
operator|!
operator|(
name|z
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|z
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
name|uniqtag
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|z
operator|==
name|NULLYP
condition|)
break|break;
name|y
operator|=
name|z
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|rflag
condition|)
block|{
name|printf
argument_list|(
literal|"\n%*sif (%s -> pe_cardinal> %d) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s(%d): %%d\", PEPY_ERR_TOO_MANY_ELEMENTS,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s -> pe_cardinal);\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_SET
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2set (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s(%s = %s) -> pe_refcnt++;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svunknown (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SETTYPE
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2set (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpush ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_type
condition|)
block|{
name|printf
argument_list|(
literal|"%*sfor (%s = first_member (%s); %s; %s = next_member (%s, %s)) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
block|{
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action3
argument_list|,
operator|++
name|level
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_act3_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|undo_type
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|level
operator|+
literal|1
argument_list|,
literal|"member"
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|--
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpop ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SETLIST
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = prim2set (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpush ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_type
condition|)
block|{
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|undo_components_set
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
else|else
name|undo_type_member
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
name|choice_pullup
argument_list|(
name|y
operator|=
name|copy_type
argument_list|(
name|yp
argument_list|)
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
name|uniqtag
argument_list|(
name|y
operator|->
name|yp_type
argument_list|,
name|NULLYP
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|rflag
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (%s_count != %s -> pe_cardinal)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%%s\", PEPY_ERR_EXTRA_MEMBERS);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpop ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_CHOICE
case|:
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpush ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_type
condition|)
block|{
name|int
name|didefault
decl_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|&&
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_PULLEDUP
operator|)
condition|)
name|tag_pullup
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
literal|"choice"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sswitch (PE_ID (%s -> pe_class, %s -> pe_id)) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|choice_pullup
argument_list|(
name|yp
argument_list|,
name|CH_PARTIAL
argument_list|)
expr_stmt|;
name|didefault
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
name|didefault
operator|+=
name|undo_type_choice
argument_list|(
name|y
argument_list|,
name|level
operator|+
literal|1
argument_list|,
name|arg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
if|if
condition|(
name|didefault
operator|>
literal|1
condition|)
name|yyerror_aux
argument_list|(
literal|"multiple non-tagged ANYs in CHOICE"
argument_list|)
expr_stmt|;
name|uniqtag
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|NULLYP
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|didefault
operator|&&
operator|!
name|rflag
condition|)
block|{
name|printf
argument_list|(
literal|"\n%*sdefault:\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s/%%d/0x%%x\", PEPY_ERR_UNKNOWN_CHOICE,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_classlist[%s -> pe_class], %s -> pe_form, %s -> pe_id);\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|arg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Vflag
condition|)
name|printf
argument_list|(
literal|"%*svpop ();\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_IDEFINED
case|:
name|printf
argument_list|(
literal|"%*sif (%s ("
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|modsym
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|,
name|Vflag
condition|?
name|YP_PRINTER
else|:
name|YP_DECODER
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s, "
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|level
operator|!=
literal|1
operator|||
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
condition|)
name|printf
argument_list|(
literal|"%d, "
argument_list|,
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
condition|?
literal|0
else|:
literal|1
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"explicit, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"&(%s), "
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"len, "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"NULLIP, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"&(%s)"
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"buffer"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"NULLVP"
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_PARMVAL
condition|)
name|printf
argument_list|(
literal|", %s"
argument_list|,
name|yp
operator|->
name|yp_parm
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|", NullParm"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") == NOTOK)\n%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
default|default:
name|myyerror
argument_list|(
literal|"unknown type: %d"
argument_list|,
name|yp
operator|->
name|yp_code
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action2
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action2
argument_list|,
name|level
argument_list|,
name|narg
condition|?
name|narg
else|:
name|arg
argument_list|,
name|yp
operator|->
name|yp_act2_lineno
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"#undef\tBITS\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_OCT
case|:
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_prfexp
operator|!=
literal|'q'
operator|&&
operator|(
operator|(
name|level
operator|==
literal|1
operator|)
operator|||
name|yp
operator|->
name|yp_action2
operator|)
condition|)
block|{
if|if
condition|(
name|level
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"%*sif (len)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s*len = %s_len;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (buffer)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s*buffer = %s;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*selse\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"/* do nothing */;\n"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"if (%s)\n%*sfree (%s);\n"
argument_list|,
name|narg
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
specifier|static
name|undo_type_element
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|first
decl_stmt|,
name|last
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|arg
decl_stmt|,
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Vflag
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|narg2
decl_stmt|;
specifier|register
name|YT
name|yt
decl_stmt|;
name|printf
argument_list|(
literal|"%*s{\n%*sregister PE %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|&&
operator|!
name|last
condition|)
block|{
name|YP
name|yp2
init|=
name|copy_type
argument_list|(
name|yp
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|yp2
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
block|{
switch|switch
condition|(
name|yp2
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_CHOICE
case|:
break|break;
case|case
name|YP_IDEFINED
case|:
if|if
condition|(
name|lookup_tag
argument_list|(
name|yp2
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
default|default:
name|tag_type
argument_list|(
name|yp2
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|printf
argument_list|(
literal|"%*sif ((%s = "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
if|if
condition|(
name|first
condition|)
name|printf
argument_list|(
literal|"first_member (%s)) != NULLPE"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"(%s != %s ? next_member (%s, %s) : first_member (%s))"
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") \n%*s!= NULLPE"
argument_list|,
operator|(
name|level
operator|+
literal|3
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|yp2
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|&&
operator|!
name|last
condition|)
block|{
name|yt
operator|=
name|yp2
operator|->
name|yp_tag
expr_stmt|;
name|printf
argument_list|(
literal|"\n%*s&& PE_ID (%s -> pe_class, %s -> pe_id)\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s!= PE_ID (PE_CLASS_%s, %d))\n%*s%s = NULLPE;\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|pe_classlist
index|[
name|yt
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|yt
operator|->
name|yt_value
argument_list|)
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ype
name|zy
decl_stmt|;
specifier|register
name|YP
name|y
init|=
operator|&
name|zy
decl_stmt|;
name|y
operator|->
name|yp_type
operator|=
name|copy_type
argument_list|(
name|yp2
argument_list|)
expr_stmt|;
comment|/* XXX */
name|y
operator|->
name|yp_type
operator|->
name|yp_next
operator|=
name|NULLYP
expr_stmt|;
name|choice_pullup
argument_list|(
name|y
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
comment|/* XXX */
for|for
control|(
name|y
operator|=
name|y
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
name|tag_type
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n%*s&& PE_ID (%s -> pe_class, %s -> pe_id)\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s!= PE_ID (PE_CLASS_%s, %d)"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|pe_classlist
index|[
name|y
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|y
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|")\n%*s%s = NULLPE;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*sif (%s != NULLPE"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%*sif ((%s = "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
if|if
condition|(
name|first
condition|)
name|printf
argument_list|(
literal|"first_member (%s)"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"(%s != %s ? next_member (%s, %s) : first_member (%s))"
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") != NULLPE"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|") {\n%*s%s = %s;\n\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_code
operator|!=
name|YP_CHOICE
operator|&&
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
operator|==
literal|0
operator|||
name|is_nonimplicit_type
argument_list|(
name|yp
argument_list|)
condition|)
name|tag_pullup
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg2
argument_list|,
literal|"element"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s{"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|undo_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"element"
argument_list|,
name|narg2
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_DEFAULT
operator|)
operator|||
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_OPTIONAL
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*selse {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_DEFAULT
condition|)
name|printf
argument_list|(
literal|"%*s/* set default here using yp -> yp_default */\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"element\", PEPY_ERR_MISSING);\n%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s}\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
specifier|static
name|undo_type_member
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|arg
decl_stmt|,
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Vflag
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|pullup
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|id
init|=
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"member"
decl_stmt|;
name|char
modifier|*
name|narg2
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
block|{
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_CHOICE
case|:
break|break;
case|case
name|YP_IDEFINED
case|:
if|if
condition|(
name|lookup_tag
argument_list|(
name|yp
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
default|default:
name|tag_type
argument_list|(
name|yp
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
condition|)
name|printf
argument_list|(
literal|"%*sif (%s = set_find (%s, PE_CLASS_%s, %d)) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|pe_classlist
index|[
name|yp
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|yp
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|ype
name|zy
decl_stmt|;
specifier|register
name|YP
name|y
init|=
operator|&
name|zy
decl_stmt|;
name|y
operator|->
name|yp_type
operator|=
name|copy_type
argument_list|(
name|yp
argument_list|)
expr_stmt|;
comment|/* XXXX !!! */
name|y
operator|->
name|yp_type
operator|->
name|yp_next
operator|=
name|NULLYP
expr_stmt|;
name|choice_pullup
argument_list|(
name|y
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
comment|/* this is dependant on choice_pullup coding... */
name|y
operator|=
name|y
operator|->
name|yp_type
expr_stmt|;
if|if
condition|(
name|y
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
name|tag_type
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif ( (%s = set_find (%s, PE_CLASS_%s, %d))"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|pe_classlist
index|[
name|y
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|y
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|y
operator|->
name|yp_next
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
name|tag_type
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n%*s|| (%s = set_find (%s, PE_CLASS_%s, %d))"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|arg
argument_list|,
name|pe_classlist
index|[
name|y
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|y
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|" ) {\n"
argument_list|)
expr_stmt|;
block|}
block|}
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
condition|)
block|{
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
operator|==
literal|0
operator|||
name|is_nonimplicit_type
argument_list|(
name|yp
argument_list|)
condition|)
name|pullup
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pullup
condition|)
block|{
name|printf
argument_list|(
literal|"%*sregister PE %s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|tag_pullup
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg2
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|yp
operator|->
name|yp_flags
operator||=
name|YP_PULLEDUP
expr_stmt|;
block|}
else|else
name|narg2
operator|=
name|narg
expr_stmt|;
name|undo_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|narg2
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
if|if
condition|(
name|pullup
condition|)
block|{
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s%s_count ++;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_DEFAULT
operator|)
operator|||
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_OPTIONAL
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*selse {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_DEFAULT
condition|)
name|printf
argument_list|(
literal|"%*s/* set default here using yp -> yp_default */\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s "
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"%s "
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"member\", PEPY_ERR_MISSING);\n%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s}\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|undo_type_choice
parameter_list|(
name|yp
parameter_list|,
name|level
parameter_list|,
name|narg
parameter_list|,
name|Vflag
parameter_list|)
specifier|register
name|YP
name|yp
decl_stmt|;
specifier|register
name|int
name|level
decl_stmt|;
specifier|register
name|char
modifier|*
name|narg
decl_stmt|;
name|int
name|Vflag
decl_stmt|;
block|{
name|int
name|pullup
init|=
literal|0
decl_stmt|;
name|int
name|result
decl_stmt|;
name|char
modifier|*
name|id
init|=
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"member"
decl_stmt|;
name|char
modifier|*
name|narg2
decl_stmt|;
if|if
condition|(
name|is_any_type
argument_list|(
name|yp
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sdefault:"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|result
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|&&
name|yp
operator|->
name|yp_code
operator|==
name|YP_IDEFINED
condition|)
block|{
name|ype
name|zy
decl_stmt|;
specifier|register
name|YP
name|y
init|=
operator|&
name|zy
decl_stmt|;
name|result
operator|=
literal|0
expr_stmt|;
name|y
operator|->
name|yp_type
operator|=
name|copy_type
argument_list|(
name|yp
argument_list|)
expr_stmt|;
comment|/* XXXX !!! */
name|y
operator|->
name|yp_type
operator|->
name|yp_next
operator|=
name|NULL
expr_stmt|;
name|choice_pullup
argument_list|(
name|y
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
comment|/* this is dependant on choice_pullup coding..*/
for|for
control|(
name|y
operator|=
name|y
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
name|is_any_type
argument_list|(
name|y
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%*sdefault:%s"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|y
operator|->
name|yp_next
condition|?
literal|"\n"
else|:
literal|""
argument_list|)
expr_stmt|;
name|result
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
name|tag_type
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*scase PE_ID (PE_CLASS_%s, %d):%s"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|pe_classlist
index|[
name|y
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|y
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|,
name|y
operator|->
name|yp_next
condition|?
literal|"\n"
else|:
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
name|tag_type
argument_list|(
name|yp
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*scase PE_ID (PE_CLASS_%s, %d):"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|pe_classlist
index|[
name|yp
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|,
name|val2int
argument_list|(
name|yp
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
condition|)
block|{
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
operator|==
literal|0
operator|||
name|is_nonimplicit_type
argument_list|(
name|yp
argument_list|)
condition|)
name|pullup
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|pullup
condition|)
block|{
name|printf
argument_list|(
literal|"%*sregister PE %s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|tag_pullup
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg2
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|yp
operator|->
name|yp_flags
operator||=
name|YP_PULLEDUP
expr_stmt|;
block|}
else|else
name|narg2
operator|=
name|narg
expr_stmt|;
name|undo_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|narg2
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
if|if
condition|(
name|pullup
condition|)
block|{
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n%*sbreak;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|undo_components_seq
argument_list|(
argument|yp
argument_list|,
argument|level
argument_list|,
argument|first
argument_list|,
argument|last
argument_list|,
argument|id
argument_list|,
argument|arg
argument_list|,
argument|narg
argument_list|,
argument|Vflag
argument_list|)
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|,
name|first
decl_stmt|,
name|last
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|arg
decl_stmt|,
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Vflag
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|YP
name|newyp
decl_stmt|;
name|YP
name|y
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_module
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't do COMPONENTS OF with external types for %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return
name|i
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|newyp
operator|=
name|lookup_type
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
operator|)
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't find referenced COMPONENTS OF %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return
name|i
return|;
block|}
for|for
control|(
name|y
operator|=
name|newyp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|i
operator|+=
name|undo_components_seq
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|first
operator|&&
name|y
operator|==
name|yp
operator|->
name|yp_type
argument_list|,
name|last
operator|&&
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
else|else
block|{
name|undo_type_element
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|first
operator|&&
name|y
operator|==
name|newyp
operator|->
name|yp_type
argument_list|,
name|last
operator|&&
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
block|}
return|return
name|i
return|;
block|}
end_block

begin_expr_stmt
specifier|static
name|undo_components_set
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|arg
decl_stmt|,
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Vflag
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|YP
name|newyp
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_module
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't do COMPONENTS OF with external types for %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|newyp
operator|=
name|lookup_type
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
operator|)
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't find referenced COMPONENTS OF %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|newyp
operator|->
name|yp_code
operator|!=
name|YP_SETLIST
condition|)
block|{
name|yyerror_aux
argument_list|(
literal|"COMPONENTS OF type is not a SET"
argument_list|)
expr_stmt|;
name|print_type
argument_list|(
name|newyp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
name|choice_pullup
argument_list|(
name|newyp
argument_list|,
name|CH_PARTIAL
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|newyp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|undo_components_set
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
else|else
name|undo_type_member
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|Vflag
argument_list|)
expr_stmt|;
name|choice_pullup
argument_list|(
name|newyp
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

