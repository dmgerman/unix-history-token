begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)n8.c	4.1 6/7/82"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_include
include|#
directive|include
file|"tdef.h"
end_include

begin_comment
comment|/* troff8.c  hyphenation */
end_comment

begin_decl_stmt
name|char
name|hbuf
index|[
name|NHEX
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|nexth
init|=
name|hbuf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|hyend
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
modifier|*
name|wdstart
decl_stmt|,
modifier|*
name|wdend
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
modifier|*
name|hyptr
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
modifier|*
modifier|*
name|hyp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|hyoff
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|noscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|xxx
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|THRESH
value|160
end_define

begin_comment
comment|/*digram goodness threshold*/
end_comment

begin_decl_stmt
name|int
name|thresh
init|=
name|THRESH
decl_stmt|;
end_decl_stmt

begin_macro
name|hyphen
argument_list|(
argument|wp
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|wp
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
operator|*
name|i
operator|,
name|j
expr_stmt|;
name|i
operator|=
name|wp
expr_stmt|;
while|while
condition|(
name|punct
argument_list|(
operator|*
name|i
operator|++
argument_list|)
condition|)
empty_stmt|;
if|if
condition|(
operator|!
name|alph
argument_list|(
operator|*
operator|--
name|i
argument_list|)
condition|)
return|return;
name|wdstart
operator|=
name|i
operator|++
expr_stmt|;
while|while
condition|(
name|alph
argument_list|(
operator|*
name|i
operator|++
argument_list|)
condition|)
empty_stmt|;
name|hyend
operator|=
name|wdend
operator|=
operator|--
name|i
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|punct
argument_list|(
operator|*
name|i
operator|++
argument_list|)
condition|)
empty_stmt|;
if|if
condition|(
operator|*
operator|--
name|i
condition|)
return|return;
if|if
condition|(
operator|(
name|wdend
operator|-
name|wdstart
operator|-
literal|4
operator|)
operator|<
literal|0
condition|)
return|return;
name|hyp
operator|=
name|hyptr
expr_stmt|;
operator|*
name|hyp
operator|=
literal|0
expr_stmt|;
name|hyoff
operator|=
literal|2
expr_stmt|;
if|if
condition|(
operator|!
name|exword
argument_list|()
operator|&&
operator|!
name|suffix
argument_list|()
condition|)
name|digram
argument_list|()
expr_stmt|;
operator|*
name|hyp
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|*
name|hyptr
condition|)
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
condition|;
control|)
block|{
name|j
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|hyp
operator|=
name|hyptr
operator|+
literal|1
init|;
operator|*
name|hyp
operator|!=
literal|0
condition|;
name|hyp
operator|++
control|)
block|{
if|if
condition|(
operator|*
operator|(
name|hyp
operator|-
literal|1
operator|)
operator|>
operator|*
name|hyp
condition|)
block|{
name|j
operator|++
expr_stmt|;
name|i
operator|=
operator|*
name|hyp
expr_stmt|;
operator|*
name|hyp
operator|=
operator|*
operator|(
name|hyp
operator|-
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|hyp
operator|-
literal|1
operator|)
operator|=
name|i
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|punct
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
operator|!
name|i
operator|||
name|alph
argument_list|(
name|i
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|alph
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|j
expr_stmt|;
name|j
operator|=
name|i
operator|&
name|CMASK
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|j
operator|>=
literal|'A'
operator|)
operator|&&
operator|(
name|j
operator|<=
literal|'Z'
operator|)
operator|)
operator|||
operator|(
operator|(
name|j
operator|>=
literal|'a'
operator|)
operator|&&
operator|(
name|j
operator|<=
literal|'z'
operator|)
operator|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
else|else
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|caseht
argument_list|()
end_macro

begin_block
block|{
name|thresh
operator|=
name|THRESH
expr_stmt|;
if|if
condition|(
name|skip
argument_list|()
condition|)
return|return;
name|noscale
operator|++
expr_stmt|;
name|thresh
operator|=
name|atoi
argument_list|()
expr_stmt|;
name|noscale
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|casehw
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
operator|,
name|k
expr_stmt|;
specifier|register
name|char
modifier|*
name|j
decl_stmt|;
name|k
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|skip
argument_list|()
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|=
name|nexth
operator|)
operator|>=
operator|(
name|hbuf
operator|+
name|NHEX
operator|-
literal|2
operator|)
condition|)
goto|goto
name|full
goto|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|=
name|getch
argument_list|()
operator|)
operator|&
name|MOT
condition|)
continue|continue;
if|if
condition|(
operator|(
operator|(
name|i
operator|&=
name|CMASK
operator|)
operator|==
literal|' '
operator|)
operator|||
operator|(
name|i
operator|==
literal|'\n'
operator|)
condition|)
block|{
operator|*
name|j
operator|++
operator|=
literal|0
expr_stmt|;
name|nexth
operator|=
name|j
expr_stmt|;
operator|*
name|j
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|' '
condition|)
break|break;
else|else
return|return;
block|}
if|if
condition|(
name|i
operator|==
literal|'-'
condition|)
block|{
name|k
operator|=
literal|0200
expr_stmt|;
continue|continue;
block|}
operator|*
name|j
operator|++
operator|=
name|maplow
argument_list|(
name|i
argument_list|)
operator||
name|k
expr_stmt|;
name|k
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|j
operator|>=
operator|(
name|hbuf
operator|+
name|NHEX
operator|-
literal|2
operator|)
condition|)
goto|goto
name|full
goto|;
block|}
block|}
return|return;
name|full
label|:
name|prstr
argument_list|(
literal|"Exception word list full.\n"
argument_list|)
expr_stmt|;
operator|*
name|nexth
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|exword
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
modifier|*
name|w
decl_stmt|;
specifier|register
name|char
modifier|*
name|e
decl_stmt|;
name|char
modifier|*
name|save
decl_stmt|;
name|e
operator|=
name|hbuf
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|save
operator|=
name|e
expr_stmt|;
if|if
condition|(
operator|*
name|e
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|w
operator|=
name|wdstart
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|e
operator|&&
operator|(
name|w
operator|<=
name|hyend
operator|)
operator|)
operator|&&
operator|(
operator|(
operator|*
name|e
operator|&
literal|0177
operator|)
operator|==
name|maplow
argument_list|(
operator|*
name|w
operator|&
name|CMASK
argument_list|)
operator|)
condition|)
block|{
name|e
operator|++
expr_stmt|;
name|w
operator|++
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
operator|!
operator|*
name|e
condition|)
block|{
if|if
condition|(
operator|(
operator|(
name|w
operator|-
literal|1
operator|)
operator|==
name|hyend
operator|)
operator|||
operator|(
operator|(
name|w
operator|==
name|wdend
operator|)
operator|&&
operator|(
name|maplow
argument_list|(
operator|*
name|w
operator|&
name|CMASK
argument_list|)
operator|==
literal|'s'
operator|)
operator|)
condition|)
block|{
name|w
operator|=
name|wdstart
expr_stmt|;
for|for
control|(
name|e
operator|=
name|save
init|;
operator|*
name|e
condition|;
name|e
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|e
operator|&
literal|0200
condition|)
operator|*
name|hyp
operator|++
operator|=
name|w
expr_stmt|;
if|if
condition|(
name|hyp
operator|>
operator|(
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
operator|)
condition|)
name|hyp
operator|=
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
expr_stmt|;
name|w
operator|++
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
else|else
block|{
name|e
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
else|else
while|while
condition|(
operator|*
name|e
operator|++
condition|)
empty_stmt|;
block|}
block|}
end_block

begin_macro
name|suffix
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
modifier|*
name|w
decl_stmt|;
specifier|register
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|s0
decl_stmt|;
name|int
name|i
decl_stmt|;
specifier|extern
name|char
modifier|*
name|suftab
index|[]
decl_stmt|;
specifier|extern
name|int
modifier|*
name|chkvow
parameter_list|()
function_decl|;
name|again
label|:
if|if
condition|(
operator|!
name|alph
argument_list|(
name|i
operator|=
operator|*
name|hyend
operator|&
name|CMASK
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|i
operator|<
literal|'a'
condition|)
name|i
operator|-=
literal|'A'
operator|-
literal|'a'
expr_stmt|;
if|if
condition|(
operator|(
name|s0
operator|=
name|suftab
index|[
name|i
operator|-
literal|'a'
index|]
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|=
operator|*
name|s0
operator|&
literal|017
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|s
operator|=
name|s0
operator|+
name|i
operator|-
literal|1
expr_stmt|;
name|w
operator|=
name|hyend
operator|-
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|s
operator|>
name|s0
operator|)
operator|&&
operator|(
name|w
operator|>=
name|wdstart
operator|)
operator|)
operator|&&
operator|(
operator|(
operator|*
name|s
operator|&
literal|0177
operator|)
operator|==
name|maplow
argument_list|(
operator|*
name|w
argument_list|)
operator|)
condition|)
block|{
name|s
operator|--
expr_stmt|;
name|w
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|s
operator|==
name|s0
condition|)
break|break;
name|s0
operator|+=
name|i
expr_stmt|;
block|}
name|s
operator|=
name|s0
operator|+
name|i
operator|-
literal|1
expr_stmt|;
name|w
operator|=
name|hyend
expr_stmt|;
if|if
condition|(
operator|*
name|s0
operator|&
literal|0200
condition|)
goto|goto
name|mark
goto|;
while|while
condition|(
name|s
operator|>
name|s0
condition|)
block|{
name|w
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|--
operator|&
literal|0200
condition|)
block|{
name|mark
label|:
name|hyend
operator|=
name|w
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|s0
operator|&
literal|0100
condition|)
continue|continue;
if|if
condition|(
operator|!
name|chkvow
argument_list|(
name|w
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
operator|*
name|hyp
operator|++
operator|=
name|w
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|*
name|s0
operator|&
literal|040
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|exword
argument_list|()
condition|)
return|return
operator|(
literal|1
operator|)
return|;
goto|goto
name|again
goto|;
block|}
end_block

begin_macro
name|maplow
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
operator|(
name|i
operator|&=
name|CMASK
operator|)
operator|<
literal|'a'
condition|)
name|i
operator|+=
literal|'a'
operator|-
literal|'A'
expr_stmt|;
return|return
operator|(
name|i
operator|)
return|;
block|}
end_block

begin_macro
name|vowel
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|maplow
argument_list|(
name|i
argument_list|)
condition|)
block|{
case|case
literal|'a'
case|:
case|case
literal|'e'
case|:
case|case
literal|'i'
case|:
case|case
literal|'o'
case|:
case|case
literal|'u'
case|:
case|case
literal|'y'
case|:
return|return
operator|(
literal|1
operator|)
return|;
default|default:
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
end_block

begin_function
name|int
modifier|*
name|chkvow
parameter_list|(
name|w
parameter_list|)
name|int
modifier|*
name|w
decl_stmt|;
block|{
while|while
condition|(
operator|--
name|w
operator|>=
name|wdstart
condition|)
if|if
condition|(
name|vowel
argument_list|(
operator|*
name|w
operator|&
name|CMASK
argument_list|)
condition|)
return|return
operator|(
name|w
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|digram
argument_list|()
end_macro

begin_block
block|{
specifier|register
operator|*
name|w
operator|,
name|val
expr_stmt|;
name|int
modifier|*
name|nhyend
decl_stmt|,
modifier|*
name|maxw
decl_stmt|,
name|maxval
decl_stmt|;
specifier|extern
name|char
name|bxh
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|,
name|bxxh
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|,
name|xxh
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|,
name|xhx
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|,
name|hxx
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|;
name|again
label|:
if|if
condition|(
operator|!
operator|(
name|w
operator|=
name|chkvow
argument_list|(
name|hyend
operator|+
literal|1
argument_list|)
operator|)
condition|)
return|return;
name|hyend
operator|=
name|w
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|w
operator|=
name|chkvow
argument_list|(
name|hyend
argument_list|)
operator|)
condition|)
return|return;
name|nhyend
operator|=
name|w
expr_stmt|;
name|maxval
operator|=
literal|0
expr_stmt|;
name|w
operator|--
expr_stmt|;
while|while
condition|(
operator|(
operator|++
name|w
operator|<
name|hyend
operator|)
operator|&&
operator|(
name|w
operator|<
operator|(
name|wdend
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
name|val
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|w
operator|==
name|wdstart
condition|)
name|val
operator|*=
name|dilook
argument_list|(
literal|'a'
argument_list|,
operator|*
name|w
argument_list|,
name|bxh
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|w
operator|==
name|wdstart
operator|+
literal|1
condition|)
name|val
operator|*=
name|dilook
argument_list|(
operator|*
operator|(
name|w
operator|-
literal|1
operator|)
argument_list|,
operator|*
name|w
argument_list|,
name|bxxh
argument_list|)
expr_stmt|;
else|else
name|val
operator|*=
name|dilook
argument_list|(
operator|*
operator|(
name|w
operator|-
literal|1
operator|)
argument_list|,
operator|*
name|w
argument_list|,
name|xxh
argument_list|)
expr_stmt|;
name|val
operator|*=
name|dilook
argument_list|(
operator|*
name|w
argument_list|,
operator|*
operator|(
name|w
operator|+
literal|1
operator|)
argument_list|,
name|xhx
argument_list|)
expr_stmt|;
name|val
operator|*=
name|dilook
argument_list|(
operator|*
operator|(
name|w
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|w
operator|+
literal|2
operator|)
argument_list|,
name|hxx
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>
name|maxval
condition|)
block|{
name|maxval
operator|=
name|val
expr_stmt|;
name|maxw
operator|=
name|w
operator|+
literal|1
expr_stmt|;
block|}
block|}
name|hyend
operator|=
name|nhyend
expr_stmt|;
if|if
condition|(
name|maxval
operator|>
name|thresh
condition|)
operator|*
name|hyp
operator|++
operator|=
name|maxw
expr_stmt|;
goto|goto
name|again
goto|;
block|}
end_block

begin_macro
name|dilook
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|,
argument|t
argument_list|)
end_macro

begin_decl_stmt
name|int
name|a
decl_stmt|,
name|b
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|t
index|[
literal|26
index|]
index|[
literal|13
index|]
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
operator|,
name|j
expr_stmt|;
name|i
operator|=
name|t
index|[
name|maplow
argument_list|(
name|a
argument_list|)
operator|-
literal|'a'
index|]
index|[
operator|(
name|j
operator|=
name|maplow
argument_list|(
name|b
argument_list|)
operator|-
literal|'a'
operator|)
operator|/
literal|2
index|]
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|j
operator|&
literal|01
operator|)
condition|)
name|i
operator|>>=
literal|4
expr_stmt|;
return|return
operator|(
name|i
operator|&
literal|017
operator|)
return|;
block|}
end_block

end_unit

