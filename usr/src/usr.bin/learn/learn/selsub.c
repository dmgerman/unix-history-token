begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)selsub.c	4.1	(Berkeley)	%G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_include
include|#
directive|include
file|"lrnref.h"
end_include

begin_macro
name|selsub
argument_list|(
argument|argc
argument_list|,
argument|argv
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
name|ans1
index|[
literal|100
index|]
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
specifier|static
name|char
name|ans2
index|[
literal|30
index|]
decl_stmt|;
specifier|static
name|char
name|dirname
index|[
literal|20
index|]
decl_stmt|;
specifier|static
name|char
name|subname
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
operator|&&
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
name|direct
operator|=
name|argv
index|[
literal|1
index|]
operator|+
literal|1
expr_stmt|;
name|argc
operator|--
expr_stmt|;
name|argv
operator|++
expr_stmt|;
block|}
name|chknam
argument_list|(
name|direct
argument_list|)
expr_stmt|;
if|if
condition|(
name|chdir
argument_list|(
name|direct
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"can't cd to %s\,"
argument_list|,
name|direct
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|sname
operator|=
name|argc
operator|>
literal|1
condition|?
name|argv
index|[
literal|1
index|]
else|:
literal|0
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|2
condition|)
name|strcpy
argument_list|(
name|level
operator|=
name|ans2
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
else|else
name|level
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|3
condition|)
name|speed
operator|=
name|atoi
argument_list|(
name|argv
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sname
condition|)
block|{
name|printf
argument_list|(
literal|"These are the available courses -\n"
argument_list|)
expr_stmt|;
name|list
argument_list|(
literal|"Linfo"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"If you want more information about the courses,\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"or if you have never used 'learn' before,\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"type 'return'; otherwise type the name of\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"the course you want, followed by 'return'.\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|sname
operator|=
name|subname
argument_list|)
expr_stmt|;
if|if
condition|(
name|sname
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
block|{
name|list
argument_list|(
literal|"Xinfo"
argument_list|)
expr_stmt|;
do|do
block|{
name|printf
argument_list|(
literal|"\nWhich subject?  "
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|sname
operator|=
name|subname
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|sname
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
do|;
block|}
block|}
name|chknam
argument_list|(
name|sname
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|level
condition|)
block|{
name|printf
argument_list|(
literal|"If you were in the middle of this subject\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"and want to start where you left off, type\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"the last lesson number the computer printed.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"To start at the beginning, just hit return.\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|gets
argument_list|(
name|ans2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ans2
index|[
literal|0
index|]
operator|==
literal|0
condition|)
name|strcpy
argument_list|(
name|ans2
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|ans2
init|;
operator|*
name|cp
condition|;
name|cp
operator|++
control|)
if|if
condition|(
operator|*
name|cp
operator|==
literal|'('
operator|||
operator|*
name|cp
operator|==
literal|' '
condition|)
operator|*
name|cp
operator|=
literal|0
expr_stmt|;
name|level
operator|=
name|ans2
expr_stmt|;
block|}
comment|/* make new directory for user to play in */
if|if
condition|(
name|chdir
argument_list|(
literal|"play"
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"can't cd to playpen\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|sprintf
argument_list|(
name|dir
operator|=
name|dirname
argument_list|,
literal|"pl%da"
argument_list|,
name|getpid
argument_list|()
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|ans1
argument_list|,
literal|"mkdir %s"
argument_list|,
name|dir
argument_list|)
expr_stmt|;
name|system
argument_list|(
name|ans1
argument_list|)
expr_stmt|;
if|if
condition|(
name|chdir
argument_list|(
name|dir
argument_list|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Couldn't create working directory.\nBye.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* after this point, we have a working directory. */
comment|/* have to call wrapup to clean up */
if|if
condition|(
name|access
argument_list|(
name|sprintf
argument_list|(
name|ans1
argument_list|,
literal|"%s/%s/Init"
argument_list|,
name|direct
argument_list|,
name|sname
argument_list|)
argument_list|,
literal|04
argument_list|)
operator|==
literal|0
condition|)
if|if
condition|(
name|system
argument_list|(
name|sprintf
argument_list|(
name|ans1
argument_list|,
literal|"%s/%s/Init %s"
argument_list|,
name|direct
argument_list|,
name|sname
argument_list|,
name|level
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Leaving learn.\n"
argument_list|)
expr_stmt|;
name|wrapup
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|level
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
comment|/* no lesson names start with - */
name|ask
operator|=
literal|1
expr_stmt|;
name|start
argument_list|(
name|level
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|chknam
argument_list|(
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|access
argument_list|(
name|name
argument_list|,
literal|05
argument_list|)
operator|<
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Sorry, there is no subject or lesson named %s.\nBye.\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_block

end_unit

