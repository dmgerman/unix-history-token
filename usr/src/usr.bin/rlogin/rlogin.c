begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)rlogin.c	4.2 82/04/06"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/in.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<pwd.h>
end_include

begin_comment
comment|/*  * rlogin - remote login; this is a hacked version of cu  */
end_comment

begin_decl_stmt
name|char
modifier|*
name|index
argument_list|()
decl_stmt|,
modifier|*
name|rindex
argument_list|()
decl_stmt|,
modifier|*
name|malloc
argument_list|()
decl_stmt|,
modifier|*
name|getenv
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|struct
name|passwd
modifier|*
name|getpwuid
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|struct
name|passwd
modifier|*
name|pwd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|pass
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rem
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|cmdchar
init|=
literal|'~'
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rcmdoptions
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|eight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|speeds
index|[]
init|=
block|{
literal|"0"
block|,
literal|"50"
block|,
literal|"75"
block|,
literal|"110"
block|,
literal|"134"
block|,
literal|"150"
block|,
literal|"200"
block|,
literal|"300"
block|,
literal|"600"
block|,
literal|"1200"
block|,
literal|"1800"
block|,
literal|"2400"
block|,
literal|"4800"
block|,
literal|"9600"
block|,
literal|"19200"
block|,
literal|"38400"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|term
index|[
literal|64
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|pid
decl_stmt|;
name|char
modifier|*
name|host
decl_stmt|,
modifier|*
name|cp
decl_stmt|,
modifier|*
modifier|*
name|ap
decl_stmt|,
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|;
specifier|register
name|int
name|cc
decl_stmt|;
name|struct
name|sgttyb
name|ttyb
decl_stmt|;
name|struct
name|passwd
modifier|*
name|pwd
decl_stmt|;
name|host
operator|=
name|rindex
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|host
condition|)
name|host
operator|++
expr_stmt|;
else|else
name|host
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|argv
operator|++
operator|,
operator|--
name|argc
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|host
argument_list|,
literal|"rlogin"
argument_list|)
condition|)
name|host
operator|=
operator|*
name|argv
operator|++
operator|,
operator|--
name|argc
expr_stmt|;
name|another
label|:
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-d"
argument_list|)
condition|)
block|{
name|argv
operator|++
operator|,
name|argc
operator|--
expr_stmt|;
name|rcmdoptions
operator||=
name|SO_DEBUG
expr_stmt|;
goto|goto
name|another
goto|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-l"
argument_list|)
condition|)
block|{
name|argv
operator|++
operator|,
name|argc
operator|--
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|0
condition|)
goto|goto
name|usage
goto|;
name|name
operator|=
operator|*
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
goto|goto
name|another
goto|;
block|}
if|if
condition|(
operator|!
name|strncmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-e"
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|cmdchar
operator|=
name|argv
index|[
literal|0
index|]
index|[
literal|2
index|]
expr_stmt|;
name|argv
operator|++
operator|,
name|argc
operator|--
expr_stmt|;
goto|goto
name|another
goto|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|*
name|argv
argument_list|,
literal|"-8"
argument_list|)
condition|)
block|{
name|eight
operator|=
literal|1
expr_stmt|;
name|argv
operator|++
operator|,
name|argc
operator|--
expr_stmt|;
goto|goto
name|another
goto|;
block|}
if|if
condition|(
name|host
operator|==
literal|0
condition|)
goto|goto
name|usage
goto|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
goto|goto
name|usage
goto|;
name|pwd
operator|=
name|getpwuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|pwd
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Who are you?\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|cc
operator|=
literal|0
expr_stmt|;
name|strcpy
argument_list|(
name|term
argument_list|,
name|getenv
argument_list|(
literal|"TERM"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtty
argument_list|(
literal|0
argument_list|,
operator|&
name|ttyb
argument_list|)
operator|==
literal|0
condition|)
block|{
name|strcat
argument_list|(
name|term
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|term
argument_list|,
name|speeds
index|[
name|ttyb
operator|.
name|sg_ospeed
index|]
argument_list|)
expr_stmt|;
block|}
name|rem
operator|=
name|rcmd
argument_list|(
operator|&
name|host
argument_list|,
name|IPPORT_LOGINSERVER
argument_list|,
name|pwd
operator|->
name|pw_name
argument_list|,
name|name
condition|?
name|name
else|:
name|pwd
operator|->
name|pw_name
argument_list|,
name|term
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|rem
operator|<
literal|0
condition|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|setuid
argument_list|(
name|getuid
argument_list|()
argument_list|)
expr_stmt|;
name|cumain
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|usage
label|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: rlogin host [ -ex ] [ -l username ]\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_define
define|#
directive|define
name|CRLF
value|"\r\n"
end_define

begin_define
define|#
directive|define
name|wrc
parameter_list|(
name|ds
parameter_list|)
value|write(ds,&c,1)
end_define

begin_decl_stmt
name|char
name|tkill
decl_stmt|,
name|terase
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current input kill& erase */
end_comment

begin_decl_stmt
name|int
name|efk
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* process of id of listener  */
end_comment

begin_decl_stmt
name|char
name|c
decl_stmt|,
name|oc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pipes
index|[]
init|=
block|{
operator|-
literal|1
block|,
operator|-
literal|1
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|intr
decl_stmt|,
name|sig2
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|parent
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nhup
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|done
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|struct
name|tchars
name|deftchars
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tchars
name|notchars
init|=
block|{
literal|0377
block|,
literal|0377
block|,
literal|'q'
operator|&
literal|037
block|,
literal|'s'
operator|&
literal|037
block|,
literal|0377
block|,
literal|0377
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ltchars
name|defltchars
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ltchars
name|noltchars
init|=
block|{
literal|0377
block|,
literal|0377
block|,
literal|0377
block|,
literal|0377
block|,
literal|0377
block|,
literal|0377
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|defkill
decl_stmt|,
name|deferase
decl_stmt|,
name|defflags
decl_stmt|;
end_decl_stmt

begin_macro
name|cumain
argument_list|()
end_macro

begin_block
block|{
name|int
name|fk
decl_stmt|;
name|int
name|speed
decl_stmt|;
name|char
modifier|*
name|telno
decl_stmt|;
name|struct
name|sgttyb
name|stbuf
decl_stmt|;
name|int
name|exit
parameter_list|()
function_decl|;
name|gtty
argument_list|(
literal|0
argument_list|,
operator|&
name|stbuf
argument_list|)
expr_stmt|;
name|defkill
operator|=
name|stbuf
operator|.
name|sg_kill
expr_stmt|;
name|deferase
operator|=
name|stbuf
operator|.
name|sg_erase
expr_stmt|;
name|defflags
operator|=
name|stbuf
operator|.
name|sg_flags
operator|&
operator|(
name|ECHO
operator||
name|CRMOD
operator|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGETC
argument_list|,
operator|&
name|deftchars
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGLTC
argument_list|,
operator|&
name|defltchars
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|exit
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGHUP
argument_list|,
name|exit
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|exit
argument_list|)
expr_stmt|;
name|pipe
argument_list|(
name|pipes
argument_list|)
expr_stmt|;
name|parent
operator|=
name|getpid
argument_list|()
expr_stmt|;
name|fk
operator|=
name|fork
argument_list|()
expr_stmt|;
name|nhup
operator|=
operator|(
name|int
operator|)
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
if|if
condition|(
name|fk
operator|==
literal|0
condition|)
block|{
name|rd
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|prf
argument_list|(
literal|"\007Lost connection."
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|3
argument_list|)
expr_stmt|;
block|}
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|done
argument_list|)
expr_stmt|;
name|mode
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|efk
operator|=
name|fk
expr_stmt|;
name|wr
argument_list|()
expr_stmt|;
if|if
condition|(
name|fk
operator|!=
operator|-
literal|1
condition|)
name|kill
argument_list|(
name|fk
argument_list|,
name|SIGKILL
argument_list|)
expr_stmt|;
name|prf
argument_list|(
literal|"Disconnected."
argument_list|)
expr_stmt|;
name|done
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|done
argument_list|()
end_macro

begin_block
block|{
name|mode
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|wait
argument_list|(
operator|(
name|int
operator|*
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  *	wr: write to remote: 0 -> line.  *	~.	terminate  *	~<file	send file  *	~!	local login-style shell  *	~!cmd	execute cmd locally  *	~$proc	execute proc locally, send output to line  *	~%cmd	execute builtin cmd (put and take)  *	~^Z	suspend cu process.  */
end_comment

begin_macro
name|wr
argument_list|()
end_macro

begin_block
block|{
name|int
name|ds
decl_stmt|,
name|fk
decl_stmt|,
name|lcl
decl_stmt|,
name|x
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|,
name|b
index|[
literal|600
index|]
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|p
operator|=
name|b
expr_stmt|;
while|while
condition|(
name|rdc
argument_list|(
literal|0
argument_list|)
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|p
operator|==
name|b
condition|)
name|lcl
operator|=
operator|(
name|c
operator|==
name|cmdchar
operator|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|b
operator|+
literal|1
operator|&&
name|b
index|[
literal|0
index|]
operator|==
name|cmdchar
condition|)
name|lcl
operator|=
operator|(
name|c
operator|!=
name|cmdchar
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|lcl
condition|)
block|{
name|c
operator|=
name|oc
expr_stmt|;
if|if
condition|(
name|wrc
argument_list|(
name|rem
argument_list|)
operator|==
literal|0
condition|)
block|{
name|prf
argument_list|(
literal|"line gone"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|eight
operator|==
literal|0
condition|)
name|c
operator|&=
literal|0177
expr_stmt|;
block|}
if|if
condition|(
name|lcl
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|0177
condition|)
name|c
operator|=
name|tkill
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\r'
operator|||
name|c
operator|==
literal|'\n'
condition|)
goto|goto
name|A
goto|;
name|wrc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|terase
condition|)
block|{
name|p
operator|=
name|p
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|p
operator|<
name|b
condition|)
name|p
operator|=
name|b
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|==
name|tkill
operator|||
name|c
operator|==
literal|0177
operator|||
name|c
operator|==
literal|'\4'
operator|||
name|c
operator|==
literal|'\r'
operator|||
name|c
operator|==
literal|'\n'
condition|)
name|p
operator|=
name|b
expr_stmt|;
block|}
return|return;
name|A
label|:
name|echo
argument_list|(
literal|""
argument_list|)
expr_stmt|;
operator|*
name|p
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|b
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'.'
case|:
case|case
literal|'\004'
case|:
return|return;
case|case
literal|'!'
case|:
case|case
literal|'$'
case|:
name|fk
operator|=
name|fork
argument_list|()
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
if|if
condition|(
name|fk
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|shell
init|=
name|getenv
argument_list|(
literal|"SHELL"
argument_list|)
decl_stmt|;
if|if
condition|(
name|shell
operator|==
literal|0
condition|)
name|shell
operator|=
literal|"/bin/sh"
expr_stmt|;
name|close
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|dup
argument_list|(
name|b
index|[
literal|1
index|]
operator|==
literal|'$'
condition|?
name|rem
else|:
literal|2
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|rem
argument_list|)
expr_stmt|;
name|mode
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nhup
condition|)
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
index|[
literal|2
index|]
operator|==
literal|0
condition|)
name|execl
argument_list|(
name|shell
argument_list|,
name|shell
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* if (b[2] == 0) execl(shell,"-",0); */
else|else
name|execl
argument_list|(
name|shell
argument_list|,
literal|"sh"
argument_list|,
literal|"-c"
argument_list|,
name|b
operator|+
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|prf
argument_list|(
literal|"Can't execute shell"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|~
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fk
operator|!=
operator|(
operator|-
literal|1
operator|)
condition|)
block|{
while|while
condition|(
name|wait
argument_list|(
operator|&
name|x
argument_list|)
operator|!=
name|fk
condition|)
empty_stmt|;
block|}
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|done
argument_list|)
expr_stmt|;
name|mode
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
index|[
literal|1
index|]
operator|==
literal|'!'
condition|)
name|echo
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'<'
case|:
if|if
condition|(
name|b
index|[
literal|2
index|]
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|(
name|ds
operator|=
name|open
argument_list|(
name|b
operator|+
literal|2
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|prf
argument_list|(
literal|"Can't divert %s"
argument_list|,
name|b
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
name|intr
operator|=
name|x
operator|=
literal|0
expr_stmt|;
name|mode
argument_list|(
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nhup
condition|)
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|sig2
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|intr
operator|&&
name|rdc
argument_list|(
name|ds
argument_list|)
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|wrc
argument_list|(
name|rem
argument_list|)
operator|==
literal|0
condition|)
block|{
name|x
operator|=
literal|1
expr_stmt|;
break|break;
block|}
block|}
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|ds
argument_list|)
expr_stmt|;
name|mode
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
condition|)
return|return;
break|break;
case|case
literal|'>'
case|:
case|case
literal|':'
case|:
block|{
specifier|register
name|char
modifier|*
name|q
decl_stmt|;
name|q
operator|=
name|b
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|q
operator|==
literal|'>'
condition|)
name|q
operator|++
expr_stmt|;
name|write
argument_list|(
name|pipes
index|[
literal|1
index|]
argument_list|,
name|q
argument_list|,
name|strlen
argument_list|(
name|q
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|efk
operator|!=
operator|-
literal|1
condition|)
name|kill
argument_list|(
name|efk
argument_list|,
name|SIGEMT
argument_list|)
expr_stmt|;
block|}
break|break;
ifdef|#
directive|ifdef
name|SIGTSTP
define|#
directive|define
name|CTRLZ
value|26
case|case
name|CTRLZ
case|:
name|mode
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|kill
argument_list|(
literal|0
argument_list|,
name|SIGTSTP
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGCHLD
argument_list|,
name|done
argument_list|)
expr_stmt|;
name|mode
argument_list|(
literal|1
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
literal|'%'
case|:
name|dopercen
argument_list|(
operator|&
name|b
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|prf
argument_list|(
literal|"Use `%c%c' to start line with `%c'"
argument_list|,
name|cmdchar
argument_list|,
name|cmdchar
argument_list|,
name|cmdchar
argument_list|)
expr_stmt|;
block|}
continue|continue;
block|}
block|}
end_block

begin_expr_stmt
name|dopercen
argument_list|(
name|line
argument_list|)
specifier|register
name|char
operator|*
name|line
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|char
modifier|*
name|args
index|[
literal|10
index|]
decl_stmt|;
specifier|register
name|narg
operator|,
name|f
expr_stmt|;
name|int
name|rcount
decl_stmt|;
for|for
control|(
name|narg
operator|=
literal|0
init|;
name|narg
operator|<
literal|10
condition|;
control|)
block|{
while|while
condition|(
operator|*
name|line
operator|==
literal|' '
operator|||
operator|*
name|line
operator|==
literal|'\t'
condition|)
name|line
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|line
operator|==
literal|'\0'
condition|)
break|break;
name|args
index|[
name|narg
operator|++
index|]
operator|=
name|line
expr_stmt|;
while|while
condition|(
operator|*
name|line
operator|!=
literal|'\0'
operator|&&
operator|*
name|line
operator|!=
literal|' '
operator|&&
operator|*
name|line
operator|!=
literal|'\t'
condition|)
name|line
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|line
operator|==
literal|'\0'
condition|)
break|break;
operator|*
name|line
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
if|if
condition|(
name|equal
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
literal|"take"
argument_list|)
condition|)
block|{
if|if
condition|(
name|narg
operator|<
literal|2
condition|)
block|{
name|prf
argument_list|(
literal|"usage: %c%%take from [to]"
argument_list|,
name|cmdchar
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|narg
operator|<
literal|3
condition|)
name|args
index|[
literal|2
index|]
operator|=
name|args
index|[
literal|1
index|]
expr_stmt|;
name|write
argument_list|(
name|pipes
index|[
literal|1
index|]
argument_list|,
literal|">/dev/null"
argument_list|,
sizeof|sizeof
argument_list|(
literal|">/dev/null"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|efk
operator|!=
operator|-
literal|1
condition|)
name|kill
argument_list|(
name|efk
argument_list|,
name|SIGEMT
argument_list|)
expr_stmt|;
name|sleep
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|wrln
argument_list|(
literal|"echo '%c>:"
argument_list|,
name|cmdchar
argument_list|)
expr_stmt|;
name|wrln
argument_list|(
name|args
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|wrln
argument_list|(
literal|"'; tee /dev/null<"
argument_list|)
expr_stmt|;
name|wrln
argument_list|(
name|args
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|wrln
argument_list|(
literal|";echo '%c>'\n"
argument_list|,
name|cmdchar
argument_list|)
expr_stmt|;
return|return;
block|}
elseif|else
if|if
condition|(
name|equal
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
literal|"put"
argument_list|)
condition|)
block|{
name|prf
argument_list|(
literal|"%c%%put doesn't work yet (use rsh)"
argument_list|,
name|cmdchar
argument_list|)
expr_stmt|;
return|return;
comment|/* 		if (narg< 2) { 			prf("usage: %c%%put from [to]", cmdchar); 			return; 		} 		if (narg< 3) 			args[2] = args[1]; 		if ((f = open(args[1], 0))< 0) { 			prf("cannot open: %s", args[1]); 			return; 		} 		wrln("stty -echo;cat>"); 		wrln(args[2]); 		wrln(";stty echo\n"); 		sleep(5); 		intr = 0; 		if (!nhup) 			signal(SIGINT, sig2); 		mode(2); 		rcount = 0; 		while(!intr&& rdc(f) == 1) { 			rcount++; 			if (c == tkill || c == terase) 				wrln("\\"); 			if (wrc(rem) != 1) { 				sleep(2); 				if (wrc(rem) != 1) { 					prf("character missed"); 					intr = 1; 					break; 				} 			} 		} 		signal(SIGINT, SIG_IGN); 		close(f); 		if (intr) { 			wrln("\n"); 			prf("stopped after %d bytes", rcount); 		} 		wrln("\004"); 		sleep(5); 		mode(1); 		return; */
block|}
name|prf
argument_list|(
literal|"%c%%%s unknown\n"
argument_list|,
name|cmdchar
argument_list|,
name|args
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|equal
argument_list|(
name|s1
argument_list|,
name|s2
argument_list|)
specifier|register
name|char
operator|*
name|s1
operator|,
operator|*
name|s2
expr_stmt|;
end_expr_stmt

begin_block
block|{
while|while
condition|(
operator|*
name|s1
operator|++
operator|==
operator|*
name|s2
condition|)
if|if
condition|(
operator|*
name|s2
operator|++
operator|==
literal|'\0'
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|wrln
argument_list|(
name|s
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
specifier|register
name|char
operator|*
name|s
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|p1
decl_stmt|,
name|p2
decl_stmt|,
name|p3
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
name|wbuf
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|wbuf
argument_list|,
name|s
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|s
operator|=
name|wbuf
expr_stmt|;
while|while
condition|(
operator|*
name|s
condition|)
name|write
argument_list|(
name|rem
argument_list|,
name|s
operator|++
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|ds
decl_stmt|,
name|slnt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|justrung
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *	rd: read from remote: line -> 1  *	catch:  *	~>[>][:][file]  *	stuff from file...  *	~>	(ends diversion)  */
end_comment

begin_decl_stmt
name|int
name|ds
decl_stmt|,
name|slnt
decl_stmt|,
name|taking
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|justrung
decl_stmt|;
end_decl_stmt

begin_macro
name|readmsg
argument_list|()
end_macro

begin_block
block|{
specifier|static
name|char
name|dobuff
index|[
literal|128
index|]
decl_stmt|,
name|morejunk
index|[
literal|256
index|]
decl_stmt|;
name|int
name|n
decl_stmt|;
name|justrung
operator|=
literal|1
expr_stmt|;
name|signal
argument_list|(
name|SIGEMT
argument_list|,
name|readmsg
argument_list|)
expr_stmt|;
name|n
operator|=
name|read
argument_list|(
name|pipes
index|[
literal|0
index|]
argument_list|,
name|morejunk
argument_list|,
literal|256
argument_list|)
expr_stmt|;
name|dodiver
argument_list|(
name|morejunk
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dodiver
argument_list|(
argument|msg
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|msg
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
init|=
name|msg
decl_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|'>'
condition|)
name|cp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|':'
condition|)
block|{
name|cp
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|0
condition|)
block|{
name|slnt
operator|^=
literal|1
expr_stmt|;
return|return;
block|}
else|else
block|{
name|slnt
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ds
operator|>=
literal|0
condition|)
name|close
argument_list|(
name|ds
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|0
condition|)
block|{
name|slnt
operator|=
literal|0
expr_stmt|;
name|ds
operator|=
operator|-
literal|1
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|*
name|msg
operator|!=
literal|'>'
operator|||
operator|(
name|ds
operator|=
name|open
argument_list|(
name|cp
argument_list|,
literal|1
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|ds
operator|=
name|creat
argument_list|(
name|cp
argument_list|,
literal|0644
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|ds
argument_list|,
operator|(
name|long
operator|)
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ds
operator|<
literal|0
condition|)
name|prf
argument_list|(
literal|"Creat failed:"
argument_list|)
operator|,
name|prf
argument_list|(
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ds
operator|<
literal|0
condition|)
name|prf
argument_list|(
literal|"Can't divert %s"
argument_list|,
name|cp
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  *	rd: read from remote: line -> 1  *	catch: diversion caught by interrupt routine  */
end_comment

begin_define
define|#
directive|define
name|ORDIN
value|0
end_define

begin_define
define|#
directive|define
name|SAWCR
value|1
end_define

begin_define
define|#
directive|define
name|EOL
value|2
end_define

begin_define
define|#
directive|define
name|SAWTL
value|3
end_define

begin_define
define|#
directive|define
name|DIVER
value|4
end_define

begin_macro
name|oob
argument_list|()
end_macro

begin_block
block|{
name|int
name|mark
decl_stmt|,
name|cc
decl_stmt|,
name|out
init|=
literal|1
operator|+
literal|1
decl_stmt|;
name|char
name|waste
index|[
literal|512
index|]
decl_stmt|;
name|signal
argument_list|(
name|SIGURG
argument_list|,
name|oob
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCFLUSH
argument_list|,
operator|&
name|out
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|ioctl
argument_list|(
name|rem
argument_list|,
name|SIOCATMARK
argument_list|,
operator|&
name|mark
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"ioctl"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|mark
condition|)
break|break;
name|cc
operator|=
name|read
argument_list|(
name|rem
argument_list|,
name|waste
argument_list|,
literal|512
argument_list|)
expr_stmt|;
block|}
name|ioctl
argument_list|(
name|rem
argument_list|,
name|SIOCRCVOOB
argument_list|,
operator|&
name|mark
argument_list|)
expr_stmt|;
if|if
condition|(
name|mark
operator|&
name|TIOCPKT_NOSTOP
condition|)
block|{
name|notchars
operator|.
name|t_stopc
operator|=
literal|0377
expr_stmt|;
name|notchars
operator|.
name|t_startc
operator|=
literal|0377
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|notchars
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mark
operator|&
name|TIOCPKT_DOSTOP
condition|)
block|{
name|notchars
operator|.
name|t_stopc
operator|=
literal|'s'
operator|&
literal|037
expr_stmt|;
name|notchars
operator|.
name|t_startc
operator|=
literal|'q'
operator|&
literal|037
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|notchars
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|rd
argument_list|()
end_macro

begin_block
block|{
specifier|extern
name|int
name|ds
decl_stmt|,
name|slnt
decl_stmt|;
name|char
name|rb
index|[
literal|600
index|]
decl_stmt|,
name|lb
index|[
literal|600
index|]
decl_stmt|,
modifier|*
name|rlim
decl_stmt|,
modifier|*
name|llim
decl_stmt|,
name|c
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
name|int
name|cnt
decl_stmt|,
name|state
init|=
literal|0
decl_stmt|,
name|mustecho
decl_stmt|,
name|oldslnt
decl_stmt|,
name|readmsg
argument_list|()
decl_stmt|;
name|signal
argument_list|(
name|SIGEMT
argument_list|,
name|readmsg
argument_list|)
expr_stmt|;
comment|/* set up child for catching diversion msgs 				    from parent */
name|signal
argument_list|(
name|SIGURG
argument_list|,
name|oob
argument_list|)
expr_stmt|;
block|{
name|int
name|pid
init|=
operator|-
name|getpid
argument_list|()
decl_stmt|;
name|ioctl
argument_list|(
name|rem
argument_list|,
name|SIOCSPGRP
argument_list|,
operator|&
name|pid
argument_list|)
expr_stmt|;
block|}
name|ds
operator|=
operator|(
operator|-
literal|1
operator|)
expr_stmt|;
name|p
operator|=
name|lb
expr_stmt|;
name|llim
operator|=
name|lb
operator|+
literal|600
expr_stmt|;
name|agin
label|:
for|for
control|(
init|;
condition|;
control|)
block|{
extern|extern errno;
name|errno
operator|=
literal|0
expr_stmt|;
name|cnt
operator|=
name|read
argument_list|(
name|rem
argument_list|,
name|rb
argument_list|,
literal|600
argument_list|)
expr_stmt|;
if|if
condition|(
name|cnt
operator|<=
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|==
name|EINTR
condition|)
block|{
name|errno
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
break|break;
block|}
if|if
condition|(
operator|!
name|slnt
condition|)
name|write
argument_list|(
literal|1
argument_list|,
name|rb
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
if|if
condition|(
name|ds
operator|<
literal|0
condition|)
continue|continue;
name|oldslnt
operator|=
name|slnt
expr_stmt|;
for|for
control|(
name|q
operator|=
name|rb
operator|,
name|rlim
operator|=
name|rb
operator|+
name|cnt
operator|-
literal|1
init|;
name|q
operator|<=
name|rlim
condition|;
control|)
block|{
if|if
condition|(
name|eight
operator|==
literal|0
condition|)
name|c
operator|&=
literal|0177
expr_stmt|;
if|if
condition|(
name|p
operator|<
name|llim
condition|)
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|ORDIN
case|:
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
name|state
operator|=
name|SAWCR
expr_stmt|;
break|break;
case|case
name|SAWCR
case|:
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
name|state
operator|=
name|EOL
expr_stmt|;
name|p
operator|--
expr_stmt|;
name|p
index|[
operator|-
literal|1
index|]
operator|=
literal|'\n'
expr_stmt|;
block|}
else|else
name|state
operator|=
name|ORDIN
expr_stmt|;
break|break;
case|case
name|EOL
case|:
name|state
operator|=
operator|(
name|c
operator|==
name|cmdchar
condition|?
name|SAWTL
else|:
operator|(
name|c
operator|==
literal|'\r'
condition|?
name|SAWCR
else|:
name|ORDIN
operator|)
operator|)
expr_stmt|;
break|break;
case|case
name|SAWTL
case|:
name|state
operator|=
operator|(
name|c
operator|==
literal|'>'
condition|?
name|DIVER
else|:
operator|(
name|c
operator|==
literal|'\r'
condition|?
name|SAWCR
else|:
name|ORDIN
operator|)
operator|)
expr_stmt|;
break|break;
case|case
name|DIVER
case|:
if|if
condition|(
name|c
operator|==
literal|'\r'
condition|)
block|{
name|p
operator|--
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
name|state
operator|=
name|ORDIN
expr_stmt|;
name|p
index|[
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|dodiver
argument_list|(
name|lb
operator|+
literal|2
argument_list|)
expr_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|lb
expr_stmt|;
block|}
block|}
if|if
condition|(
name|slnt
operator|==
literal|0
operator|&&
name|oldslnt
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
name|write
argument_list|(
name|rem
argument_list|,
name|lb
argument_list|,
name|p
operator|-
name|lb
operator|-
literal|1
argument_list|)
expr_stmt|;
name|write
argument_list|(
name|rem
argument_list|,
name|CRLF
argument_list|,
sizeof|sizeof
argument_list|(
name|CRLF
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|q
operator|==
name|rlim
condition|)
block|{
name|write
argument_list|(
name|rem
argument_list|,
name|lb
argument_list|,
name|p
operator|-
name|lb
argument_list|)
expr_stmt|;
name|c
operator|=
literal|'\n'
expr_stmt|;
comment|/*force flush to file*/
block|}
block|}
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
if|if
condition|(
name|ds
operator|>=
literal|0
condition|)
name|write
argument_list|(
name|ds
argument_list|,
name|lb
argument_list|,
name|p
operator|-
name|lb
argument_list|)
expr_stmt|;
name|p
operator|=
name|lb
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|justrung
condition|)
block|{
name|justrung
operator|=
literal|0
expr_stmt|;
goto|goto
name|agin
goto|;
block|}
block|}
end_block

begin_struct
struct|struct
block|{
name|char
name|lobyte
decl_stmt|;
name|char
name|hibyte
decl_stmt|;
block|}
struct|;
end_struct

begin_macro
name|mode
argument_list|(
argument|f
argument_list|)
end_macro

begin_block
block|{
name|struct
name|sgttyb
name|stbuf
decl_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|stbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
literal|0
condition|)
block|{
name|stbuf
operator|.
name|sg_flags
operator|&=
operator|~
name|CBREAK
expr_stmt|;
name|stbuf
operator|.
name|sg_flags
operator||=
name|defflags
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|deftchars
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSLTC
argument_list|,
operator|&
name|defltchars
argument_list|)
expr_stmt|;
name|stbuf
operator|.
name|sg_kill
operator|=
name|defkill
expr_stmt|;
name|stbuf
operator|.
name|sg_erase
operator|=
name|deferase
expr_stmt|;
block|}
if|if
condition|(
name|f
operator|==
literal|1
condition|)
block|{
name|stbuf
operator|.
name|sg_flags
operator||=
name|CBREAK
expr_stmt|;
name|stbuf
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|ECHO
operator||
name|CRMOD
operator|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|notchars
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSLTC
argument_list|,
operator|&
name|noltchars
argument_list|)
expr_stmt|;
name|stbuf
operator|.
name|sg_kill
operator|=
literal|0377
expr_stmt|;
name|stbuf
operator|.
name|sg_erase
operator|=
literal|0377
expr_stmt|;
block|}
if|if
condition|(
name|f
operator|==
literal|2
condition|)
block|{
name|stbuf
operator|.
name|sg_flags
operator|&=
operator|~
name|CBREAK
expr_stmt|;
name|stbuf
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|ECHO
operator||
name|CRMOD
operator|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|deftchars
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSLTC
argument_list|,
operator|&
name|defltchars
argument_list|)
expr_stmt|;
name|stbuf
operator|.
name|sg_kill
operator|=
literal|0377
expr_stmt|;
name|stbuf
operator|.
name|sg_erase
operator|=
literal|0377
expr_stmt|;
block|}
name|ioctl
argument_list|(
literal|0
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|stbuf
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|echo
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|s
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|p
operator|>
name|s
condition|)
name|write
argument_list|(
literal|0
argument_list|,
name|s
argument_list|,
name|p
operator|-
name|s
argument_list|)
expr_stmt|;
name|write
argument_list|(
literal|0
argument_list|,
name|CRLF
argument_list|,
sizeof|sizeof
argument_list|(
name|CRLF
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|prf
argument_list|(
argument|f
argument_list|,
argument|a1
argument_list|,
argument|a2
argument_list|,
argument|a3
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|f
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|f
argument_list|,
name|a1
argument_list|,
name|a2
argument_list|,
name|a3
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|CRLF
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|exists
argument_list|(
argument|devname
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|devname
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|access
argument_list|(
name|devname
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|prf
argument_list|(
literal|"%s does not exist"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|rdc
argument_list|(
argument|ds
argument_list|)
end_macro

begin_block
block|{
name|ds
operator|=
name|read
argument_list|(
name|ds
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|oc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|eight
operator|==
literal|0
condition|)
name|c
operator|&=
literal|0177
expr_stmt|;
return|return
operator|(
name|ds
operator|)
return|;
block|}
end_block

begin_macro
name|sig2
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|intr
operator|=
literal|1
expr_stmt|;
block|}
end_block

end_unit

