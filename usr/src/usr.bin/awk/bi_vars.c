begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/******************************************** bi_vars.c copyright 1991, Michael D. Brennan  This is a source file for mawk, an implementation of the AWK programming language.  Mawk is distributed without warranty under the terms of the GNU General Public License, version 2, 1991. ********************************************/
end_comment

begin_comment
comment|/* $Log:	bi_vars.c,v $  * Revision 5.1  91/12/05  07:55:38  brennan  * 1.1 pre-release  *  */
end_comment

begin_comment
comment|/* bi_vars.c */
end_comment

begin_include
include|#
directive|include
file|"mawk.h"
end_include

begin_include
include|#
directive|include
file|"symtype.h"
end_include

begin_include
include|#
directive|include
file|"bi_vars.h"
end_include

begin_include
include|#
directive|include
file|"field.h"
end_include

begin_include
include|#
directive|include
file|"init.h"
end_include

begin_include
include|#
directive|include
file|"memory.h"
end_include

begin_comment
comment|/* the builtin variables */
end_comment

begin_decl_stmt
name|CELL
name|bi_vars
index|[
name|NUM_BI_VAR
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the order here must match the order in bi_vars.h */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|bi_var_names
index|[
name|NUM_BI_VAR
index|]
init|=
block|{
literal|"NR"
block|,
literal|"FNR"
block|,
literal|"ARGC"
block|,
literal|"FILENAME"
block|,
literal|"OFS"
block|,
literal|"ORS"
block|,
literal|"RLENGTH"
block|,
literal|"RSTART"
block|,
literal|"SUBSEP"
if|#
directive|if
name|MSDOS
operator|&&
name|NO_BINMODE
operator|==
literal|0
block|,
literal|"BINMODE"
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* insert the builtin vars in the hash table */
end_comment

begin_function
name|void
name|bi_vars_init
parameter_list|()
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|SYMTAB
modifier|*
name|s
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_BI_VAR
condition|;
name|i
operator|++
control|)
block|{
name|s
operator|=
name|insert
argument_list|(
name|bi_var_names
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|s
operator|->
name|type
operator|=
name|i
operator|<=
literal|1
condition|?
name|ST_NR
else|:
name|ST_VAR
expr_stmt|;
name|s
operator|->
name|stval
operator|.
name|cp
operator|=
name|bi_vars
operator|+
name|i
expr_stmt|;
comment|/* bi_vars[i].type = 0 which is C_NOINIT */
block|}
name|s
operator|=
name|insert
argument_list|(
literal|"ENVIRON"
argument_list|)
expr_stmt|;
name|s
operator|->
name|type
operator|=
name|ST_ENV
expr_stmt|;
comment|/* set defaults */
name|FILENAME
operator|->
name|type
operator|=
name|C_STRING
expr_stmt|;
name|FILENAME
operator|->
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|new_STRING
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|OFS
operator|->
name|type
operator|=
name|C_STRING
expr_stmt|;
name|OFS
operator|->
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|new_STRING
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|ORS
operator|->
name|type
operator|=
name|C_STRING
expr_stmt|;
name|ORS
operator|->
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|new_STRING
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|SUBSEP
operator|->
name|type
operator|=
name|C_STRING
expr_stmt|;
name|SUBSEP
operator|->
name|ptr
operator|=
operator|(
name|PTR
operator|)
name|new_STRING
argument_list|(
literal|"\034"
argument_list|)
expr_stmt|;
name|NR
operator|->
name|type
operator|=
name|FNR
operator|->
name|type
operator|=
name|C_DOUBLE
expr_stmt|;
comment|/* dval is already 0.0 */
if|#
directive|if
name|MSDOS
operator|&&
name|NO_BINMODE
operator|==
literal|0
name|BINMODE
operator|->
name|type
operator|=
name|C_DOUBLE
expr_stmt|;
endif|#
directive|endif
block|}
end_function

end_unit

