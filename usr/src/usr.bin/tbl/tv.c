begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)tv.c	4.3 8/11/83"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* tv.c: draw vertical lines */
end_comment

begin_include
include|#
directive|include
file|"t..c"
end_include

begin_macro
name|drawvert
argument_list|(
argument|start
argument_list|,
argument|end
argument_list|,
argument|c
argument_list|,
argument|lwid
argument_list|)
end_macro

begin_block
block|{
name|char
modifier|*
name|exb
init|=
literal|0
decl_stmt|,
modifier|*
name|ext
init|=
literal|0
decl_stmt|;
name|int
name|tp
init|=
literal|0
decl_stmt|,
name|sl
decl_stmt|,
name|ln
decl_stmt|,
name|pos
decl_stmt|,
name|epb
decl_stmt|,
name|ept
decl_stmt|,
name|vm
decl_stmt|;
name|end
operator|++
expr_stmt|;
name|vm
operator|=
literal|'v'
expr_stmt|;
comment|/* note: nr 35 has value of 1m outside of linesize */
while|while
condition|(
name|instead
index|[
name|end
index|]
condition|)
name|end
operator|++
expr_stmt|;
for|for
control|(
name|ln
operator|=
literal|0
init|;
name|ln
operator|<
name|lwid
condition|;
name|ln
operator|++
control|)
block|{
name|epb
operator|=
name|ept
operator|=
literal|0
expr_stmt|;
name|pos
operator|=
literal|2
operator|*
name|ln
operator|-
name|lwid
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|pos
operator|!=
name|tp
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\h'%dp'"
argument_list|,
name|pos
operator|-
name|tp
argument_list|)
expr_stmt|;
name|tp
operator|=
name|pos
expr_stmt|;
if|if
condition|(
name|end
operator|<
name|nlin
condition|)
block|{
if|if
condition|(
name|fullbot
index|[
name|end
index|]
operator|||
operator|(
operator|!
name|instead
index|[
name|end
index|]
operator|&&
name|allh
argument_list|(
name|end
argument_list|)
operator|)
condition|)
name|epb
operator|=
literal|2
expr_stmt|;
else|else
switch|switch
condition|(
name|midbar
argument_list|(
name|end
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
literal|'-'
case|:
name|exb
operator|=
literal|"1v-.5m"
expr_stmt|;
break|break;
case|case
literal|'='
case|:
name|exb
operator|=
literal|"1v-.5m"
expr_stmt|;
name|epb
operator|=
literal|1
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|lwid
operator|>
literal|1
condition|)
switch|switch
condition|(
name|interh
argument_list|(
name|end
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
name|THRU
case|:
name|epb
operator|-=
literal|1
expr_stmt|;
break|break;
case|case
name|RIGHT
case|:
name|epb
operator|+=
operator|(
name|ln
operator|==
literal|0
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
case|case
name|LEFT
case|:
name|epb
operator|+=
operator|(
name|ln
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|lwid
operator|==
literal|1
condition|)
switch|switch
condition|(
name|interh
argument_list|(
name|end
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
name|THRU
case|:
name|epb
operator|-=
literal|1
expr_stmt|;
break|break;
case|case
name|RIGHT
case|:
case|case
name|LEFT
case|:
name|epb
operator|+=
literal|1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|start
operator|>
literal|0
condition|)
block|{
name|sl
operator|=
name|start
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|sl
operator|>=
literal|0
operator|&&
name|instead
index|[
name|sl
index|]
condition|)
name|sl
operator|--
expr_stmt|;
if|if
condition|(
name|sl
operator|>=
literal|0
operator|&&
operator|(
name|fullbot
index|[
name|sl
index|]
operator|||
name|allh
argument_list|(
name|sl
argument_list|)
operator|)
condition|)
name|ept
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|sl
operator|>=
literal|0
condition|)
switch|switch
condition|(
name|midbar
argument_list|(
name|sl
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
literal|'-'
case|:
name|ext
operator|=
literal|".5m"
expr_stmt|;
break|break;
case|case
literal|'='
case|:
name|ext
operator|=
literal|".5m"
expr_stmt|;
name|ept
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
default|default:
name|vm
operator|=
literal|'m'
expr_stmt|;
break|break;
block|}
else|else
name|ept
operator|=
operator|-
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|start
operator|==
literal|0
operator|&&
name|allh
argument_list|(
literal|0
argument_list|)
condition|)
block|{
name|ept
operator|=
literal|0
expr_stmt|;
name|vm
operator|=
literal|'m'
expr_stmt|;
block|}
if|if
condition|(
name|lwid
operator|>
literal|1
condition|)
switch|switch
condition|(
name|interh
argument_list|(
name|start
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
name|THRU
case|:
name|ept
operator|+=
literal|1
expr_stmt|;
break|break;
case|case
name|LEFT
case|:
name|ept
operator|+=
operator|(
name|ln
operator|==
literal|0
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
case|case
name|RIGHT
case|:
name|ept
operator|+=
operator|(
name|ln
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|lwid
operator|==
literal|1
condition|)
switch|switch
condition|(
name|interh
argument_list|(
name|start
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
name|THRU
case|:
name|ept
operator|+=
literal|1
expr_stmt|;
break|break;
case|case
name|LEFT
case|:
case|case
name|RIGHT
case|:
name|ept
operator|-=
literal|1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|exb
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\v'%s'"
argument_list|,
name|exb
argument_list|)
expr_stmt|;
if|if
condition|(
name|epb
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\v'%dp'"
argument_list|,
name|epb
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\s\\n(%d"
argument_list|,
name|LSIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|linsize
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\v'-\\n(%dp/6u'"
argument_list|,
name|LSIZE
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\h'-\\n(#~u'"
argument_list|)
expr_stmt|;
comment|/* adjustment for T450 nroff boxes */
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\L'|\\n(#%cu-%s"
argument_list|,
name|linestop
index|[
name|start
index|]
operator|+
literal|'a'
operator|-
literal|1
argument_list|,
name|vm
operator|==
literal|'v'
condition|?
literal|"1v"
else|:
literal|"\\n(35u"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"-(%s)"
argument_list|,
name|ext
argument_list|)
expr_stmt|;
if|if
condition|(
name|exb
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"-(%s)"
argument_list|,
name|exb
argument_list|)
expr_stmt|;
name|pos
operator|=
name|ept
operator|-
name|epb
expr_stmt|;
if|if
condition|(
name|pos
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"%s%dp"
argument_list|,
name|pos
operator|>=
literal|0
condition|?
literal|"+"
else|:
literal|""
argument_list|,
name|pos
argument_list|)
expr_stmt|;
comment|/* the string #d is either "nl" or ".d" depending 	   on diversions; on GCOS not the same */
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"'\\s0\\v'\\n(\\*(#du-\\n(#%cu+%s"
argument_list|,
name|linestop
index|[
name|start
index|]
operator|+
literal|'a'
operator|-
literal|1
argument_list|,
name|vm
operator|==
literal|'v'
condition|?
literal|"1v"
else|:
literal|"\\n(35u"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ext
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"+%s"
argument_list|,
name|ext
argument_list|)
expr_stmt|;
if|if
condition|(
name|ept
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"%s%dp"
argument_list|,
operator|(
operator|-
name|ept
operator|)
operator|>
literal|0
condition|?
literal|"+"
else|:
literal|""
argument_list|,
operator|(
operator|-
name|ept
operator|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"'"
argument_list|)
expr_stmt|;
if|if
condition|(
name|linsize
condition|)
name|fprintf
argument_list|(
name|tabout
argument_list|,
literal|"\\v'\\n(%dp/6u'"
argument_list|,
name|LSIZE
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|midbar
argument_list|(
argument|i
argument_list|,
argument|c
argument_list|)
end_macro

begin_block
block|{
name|int
name|k
decl_stmt|;
name|k
operator|=
name|midbcol
argument_list|(
name|i
argument_list|,
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|==
literal|0
operator|&&
name|c
operator|>
literal|0
condition|)
name|k
operator|=
name|midbcol
argument_list|(
name|i
argument_list|,
name|c
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
operator|(
name|k
operator|)
return|;
block|}
end_block

begin_macro
name|midbcol
argument_list|(
argument|i
argument_list|,
argument|c
argument_list|)
end_macro

begin_block
block|{
name|int
name|ct
decl_stmt|;
while|while
condition|(
operator|(
name|ct
operator|=
name|ctype
argument_list|(
name|i
argument_list|,
name|c
argument_list|)
operator|)
operator|==
literal|'s'
condition|)
name|c
operator|--
expr_stmt|;
if|if
condition|(
name|ct
operator|==
literal|'-'
operator|||
name|ct
operator|==
literal|'='
condition|)
return|return
operator|(
name|ct
operator|)
return|;
if|if
condition|(
name|ct
operator|=
name|barent
argument_list|(
name|table
index|[
name|i
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
return|return
operator|(
name|ct
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|barent
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|s
operator|==
literal|0
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
operator|!
name|point
argument_list|(
name|s
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'\\'
condition|)
name|s
operator|++
expr_stmt|;
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|!=
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
switch|switch
condition|(
name|s
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|'_'
case|:
return|return
operator|(
literal|'-'
operator|)
return|;
case|case
literal|'='
case|:
return|return
operator|(
literal|'='
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

