begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"defs"
end_include

begin_macro
name|setopt
argument_list|(
argument|p
argument_list|,
argument|q
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|q
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|qval
decl_stmt|;
name|qval
operator|=
operator|(
name|q
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|equals
argument_list|(
name|q
argument_list|,
literal|"yes"
argument_list|)
operator|||
name|equals
argument_list|(
name|q
argument_list|,
literal|"on"
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"debug"
argument_list|)
condition|)
name|dbgopt
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"ndebug"
argument_list|)
condition|)
name|dbgopt
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"pfort"
argument_list|)
condition|)
name|langopt
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"ratfor"
argument_list|)
condition|)
name|langopt
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"efl"
argument_list|)
condition|)
name|langopt
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"dots"
argument_list|)
condition|)
name|dotsopt
operator|=
name|qval
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"ioerror"
argument_list|)
condition|)
block|{
if|if
condition|(
name|equals
argument_list|(
name|q
argument_list|,
literal|"none"
argument_list|)
condition|)
name|tailor
operator|.
name|errmode
operator|=
name|IOERRNONE
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|q
argument_list|,
literal|"ibm"
argument_list|)
condition|)
name|tailor
operator|.
name|errmode
operator|=
name|IOERRIBM
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|q
argument_list|,
literal|"fortran77"
argument_list|)
condition|)
name|tailor
operator|.
name|errmode
operator|=
name|IOERRFORT77
expr_stmt|;
else|else
name|execerr
argument_list|(
literal|"unknown ioerror option %s"
argument_list|,
name|q
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"system"
argument_list|)
condition|)
block|{
specifier|register
name|struct
name|system
modifier|*
name|sysp
decl_stmt|;
for|for
control|(
name|sysp
operator|=
name|systab
init|;
name|sysp
operator|->
name|sysname
condition|;
operator|++
name|sysp
control|)
if|if
condition|(
name|equals
argument_list|(
name|q
argument_list|,
name|sysp
operator|->
name|sysname
argument_list|)
condition|)
break|break;
if|if
condition|(
name|sysp
operator|->
name|sysname
condition|)
name|tailinit
argument_list|(
name|sysp
argument_list|)
expr_stmt|;
else|else
name|execerr
argument_list|(
literal|"unknown system %s"
argument_list|,
name|q
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"continue"
argument_list|)
condition|)
name|tailor
operator|.
name|ftncontnu
operator|=
name|equals
argument_list|(
name|q
argument_list|,
literal|"column1"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"procheader"
argument_list|)
condition|)
name|tailor
operator|.
name|procheader
operator|=
operator|(
name|q
condition|?
name|copys
argument_list|(
name|q
argument_list|)
else|:
literal|0
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"hollincall"
argument_list|)
condition|)
name|tailor
operator|.
name|hollincall
operator|=
name|qval
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"longcomplextype"
argument_list|)
condition|)
block|{
name|tailor
operator|.
name|lngcxtype
operator|=
operator|(
name|q
condition|?
name|copys
argument_list|(
name|q
argument_list|)
else|:
name|CNULL
operator|)
expr_stmt|;
if|if
condition|(
name|qval
condition|)
name|eflftn
index|[
name|TYLCOMPLEX
index|]
operator|=
name|FTNDCOMPLEX
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"longcomplexprefix"
argument_list|)
condition|)
name|tailor
operator|.
name|lngcxprefix
operator|=
operator|(
name|q
condition|?
name|copys
argument_list|(
name|q
argument_list|)
else|:
name|CNULL
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|p
argument_list|,
literal|"fortran77"
argument_list|)
condition|)
block|{
if|if
condition|(
name|tailor
operator|.
name|ftn77
operator|=
operator|(
name|q
operator|==
name|NULL
operator|||
name|qval
operator|)
condition|)
name|tailor
operator|.
name|errmode
operator|=
name|IOERRFORT77
expr_stmt|;
elseif|else
if|if
condition|(
name|tailor
operator|.
name|errmode
operator|==
name|IOERRFORT77
condition|)
name|tailor
operator|.
name|errmode
operator|=
name|IOERRNONE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|tailop
argument_list|(
name|p
argument_list|,
name|q
argument_list|)
condition|)
name|execerr
argument_list|(
literal|"unknown option %s"
argument_list|,
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|langopt
operator|==
literal|2
condition|)
name|setdot
argument_list|(
name|dotsopt
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|langopt
operator|==
literal|1
condition|)
name|setdot
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|tailinit
argument_list|(
name|sysp
argument_list|)
specifier|register
expr|struct
name|system
operator|*
name|sysp
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|int
name|sysf
init|=
name|sysp
operator|->
name|sysno
decl_stmt|;
name|tailor
operator|.
name|ftncontnu
operator|=
operator|(
name|sysf
operator|==
name|UNIX
operator|)
expr_stmt|;
name|tailor
operator|.
name|ftnsys
operator|=
name|sysf
expr_stmt|;
name|tailor
operator|.
name|ftnin
operator|=
literal|5
expr_stmt|;
name|tailor
operator|.
name|ftnout
operator|=
literal|6
expr_stmt|;
name|tailor
operator|.
name|errmode
operator|=
operator|(
name|sysf
operator|==
name|UNIX
condition|?
name|IOERRFORT77
else|:
name|IOERRIBM
operator|)
expr_stmt|;
name|tailor
operator|.
name|charcomp
operator|=
literal|2
expr_stmt|;
name|tailor
operator|.
name|hollincall
operator|=
name|YES
expr_stmt|;
name|tailor
operator|.
name|deltastno
operator|=
literal|1
expr_stmt|;
name|tailor
operator|.
name|dclintrinsics
operator|=
name|YES
expr_stmt|;
name|tailsize
argument_list|(
name|sysp
operator|->
name|chperwd
argument_list|)
expr_stmt|;
name|tailfmt
argument_list|(
name|sysp
operator|->
name|idig
argument_list|,
name|sysp
operator|->
name|rdig
argument_list|,
name|sysp
operator|->
name|ddig
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|tailsize
argument_list|(
argument|wordsize
argument_list|)
end_macro

begin_decl_stmt
name|int
name|wordsize
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
name|tailor
operator|.
name|ftnchwd
operator|=
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNINT
index|]
operator|=
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNREAL
index|]
operator|=
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNLOG
index|]
operator|=
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNCOMPLEX
index|]
operator|=
literal|2
operator|*
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNDOUBLE
index|]
operator|=
literal|2
operator|*
name|wordsize
expr_stmt|;
name|tailor
operator|.
name|ftnsize
index|[
name|FTNDCOMPLEX
index|]
operator|=
literal|2
operator|*
name|wordsize
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NFTNTYPES
condition|;
operator|++
name|i
control|)
name|tailor
operator|.
name|ftnalign
index|[
name|i
index|]
operator|=
name|tailor
operator|.
name|ftnsize
index|[
name|i
index|]
expr_stmt|;
block|}
end_block

begin_macro
name|tailfmt
argument_list|(
argument|idig
argument_list|,
argument|rdig
argument_list|,
argument|ddig
argument_list|)
end_macro

begin_decl_stmt
name|int
name|idig
decl_stmt|,
name|rdig
decl_stmt|,
name|ddig
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|sprintf
argument_list|(
name|msg
argument_list|,
literal|"i%d"
argument_list|,
name|idig
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYINT
index|]
operator|=
name|copys
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|msg
argument_list|,
literal|"e%d.%d"
argument_list|,
name|rdig
operator|+
literal|8
argument_list|,
name|rdig
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYREAL
index|]
operator|=
name|copys
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|msg
argument_list|,
literal|"d%d.%d"
argument_list|,
name|ddig
operator|+
literal|8
argument_list|,
name|ddig
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLREAL
index|]
operator|=
name|copys
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|msg
argument_list|,
literal|"1h(,1p%s,2h, ,%s,1h)"
argument_list|,
name|tailor
operator|.
name|dfltfmt
index|[
name|TYREAL
index|]
argument_list|,
name|tailor
operator|.
name|dfltfmt
index|[
name|TYREAL
index|]
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYCOMPLEX
index|]
operator|=
name|copys
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|msg
argument_list|,
literal|"1h(,1p%s,2h, ,%s,1h)"
argument_list|,
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLREAL
index|]
argument_list|,
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLREAL
index|]
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLCOMPLEX
index|]
operator|=
name|copys
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLOG
index|]
operator|=
literal|"l2"
expr_stmt|;
block|}
end_block

begin_macro
name|tailop
argument_list|(
argument|n
argument_list|,
argument|v
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|n
decl_stmt|,
modifier|*
name|v
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|val
decl_stmt|;
struct|struct
name|itable
block|{
name|char
modifier|*
name|optn
decl_stmt|;
name|int
modifier|*
name|ioptloc
decl_stmt|;
block|}
modifier|*
name|ip
struct|;
struct|struct
name|ctable
block|{
name|char
modifier|*
name|optn
decl_stmt|;
name|char
modifier|*
modifier|*
name|coptloc
decl_stmt|;
block|}
modifier|*
name|cp
struct|;
specifier|static
name|struct
name|ctable
name|formats
index|[ ]
init|=
block|{
literal|"iformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYINT
index|]
block|,
literal|"rformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYREAL
index|]
block|,
literal|"dformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLREAL
index|]
block|,
literal|"zformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYCOMPLEX
index|]
block|,
literal|"zdformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLCOMPLEX
index|]
block|,
literal|"lformat"
block|,
operator|&
name|tailor
operator|.
name|dfltfmt
index|[
name|TYLOG
index|]
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
specifier|static
name|struct
name|itable
name|ints
index|[ ]
init|=
block|{
literal|"ftnin"
block|,
operator|&
name|tailor
operator|.
name|ftnin
block|,
literal|"ftnout"
block|,
operator|&
name|tailor
operator|.
name|ftnout
block|,
literal|"charperint"
block|,
operator|&
name|tailor
operator|.
name|ftnchwd
block|,
literal|"charcomp"
block|,
operator|&
name|tailor
operator|.
name|charcomp
block|,
literal|"deltastno"
block|,
operator|&
name|tailor
operator|.
name|deltastno
block|,
literal|"dclintrinsics"
block|,
operator|&
name|tailor
operator|.
name|dclintrinsics
block|,
literal|"isize"
block|,
operator|&
name|tailor
operator|.
name|ftnsize
index|[
name|FTNINT
index|]
block|,
literal|"rsize"
block|,
operator|&
name|tailor
operator|.
name|ftnsize
index|[
name|FTNREAL
index|]
block|,
literal|"dsize"
block|,
operator|&
name|tailor
operator|.
name|ftnsize
index|[
name|FTNDOUBLE
index|]
block|,
literal|"lsize"
block|,
operator|&
name|tailor
operator|.
name|ftnsize
index|[
name|FTNLOG
index|]
block|,
literal|"zsize"
block|,
operator|&
name|tailor
operator|.
name|ftnsize
index|[
name|FTNCOMPLEX
index|]
block|,
literal|"ialign"
block|,
operator|&
name|tailor
operator|.
name|ftnalign
index|[
name|FTNINT
index|]
block|,
literal|"ralign"
block|,
operator|&
name|tailor
operator|.
name|ftnalign
index|[
name|FTNREAL
index|]
block|,
literal|"dalign"
block|,
operator|&
name|tailor
operator|.
name|ftnalign
index|[
name|FTNDOUBLE
index|]
block|,
literal|"lalign"
block|,
operator|&
name|tailor
operator|.
name|ftnalign
index|[
name|FTNLOG
index|]
block|,
literal|"zalign"
block|,
operator|&
name|tailor
operator|.
name|ftnalign
index|[
name|FTNCOMPLEX
index|]
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
for|for
control|(
name|cp
operator|=
name|formats
init|;
name|cp
operator|->
name|optn
condition|;
operator|++
name|cp
control|)
if|if
condition|(
name|equals
argument_list|(
name|n
argument_list|,
name|cp
operator|->
name|optn
argument_list|)
condition|)
block|{
operator|*
operator|(
name|cp
operator|->
name|coptloc
operator|)
operator|=
name|copys
argument_list|(
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
for|for
control|(
name|ip
operator|=
name|ints
init|;
name|ip
operator|->
name|optn
condition|;
operator|++
name|ip
control|)
if|if
condition|(
name|equals
argument_list|(
name|n
argument_list|,
name|ip
operator|->
name|optn
argument_list|)
condition|)
block|{
if|if
condition|(
name|equals
argument_list|(
name|v
argument_list|,
literal|"yes"
argument_list|)
operator|||
name|equals
argument_list|(
name|v
argument_list|,
literal|"on"
argument_list|)
condition|)
name|val
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|equals
argument_list|(
name|v
argument_list|,
literal|"no"
argument_list|)
operator|||
name|equals
argument_list|(
name|v
argument_list|,
literal|"off"
argument_list|)
condition|)
name|val
operator|=
literal|0
expr_stmt|;
else|else
name|val
operator|=
name|convci
argument_list|(
name|v
argument_list|)
expr_stmt|;
operator|*
operator|(
name|ip
operator|->
name|ioptloc
operator|)
operator|=
name|val
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

