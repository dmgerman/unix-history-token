begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1983 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  */
end_comment

begin_comment
comment|/*  * $Header: iso.c,v 3.3 88/12/08 14:44:49 hagens Exp $  * $Source: /usr/argo/src/ucb/netstat/RCS/iso.c,v $  */
end_comment

begin_comment
comment|/******************************************************************************* 		          Copyright IBM Corporation 1987                        All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the name of IBM not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    IBM DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL IBM BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *******************************************************************************/
end_comment

begin_comment
comment|/*  *	ARGO Project, Computer Sciences Dept., University of Wisconsin - Madison  */
end_comment

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)iso.c	5.2 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/domain.h>
end_include

begin_include
include|#
directive|include
file|<sys/protosw.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/socketvar.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/route.h>
end_include

begin_include
include|#
directive|include
file|<netiso/iso.h>
end_include

begin_include
include|#
directive|include
file|<netiso/iso_errno.h>
end_include

begin_include
include|#
directive|include
file|<netiso/clnp.h>
end_include

begin_include
include|#
directive|include
file|<netiso/cltp_var.h>
end_include

begin_include
include|#
directive|include
file|<netiso/esis.h>
end_include

begin_include
include|#
directive|include
file|<netiso/clnp_stat.h>
end_include

begin_include
include|#
directive|include
file|<netiso/argo_debug.h>
end_include

begin_undef
undef|#
directive|undef
name|satosiso
end_undef

begin_include
include|#
directive|include
file|<netiso/tp_param.h>
end_include

begin_include
include|#
directive|include
file|<netiso/tp_states.h>
end_include

begin_include
include|#
directive|include
file|<netiso/tp_astring.c>
end_include

begin_define
define|#
directive|define
name|KERNEL
end_define

begin_include
include|#
directive|include
file|<netiso/tp_pcb.h>
end_include

begin_include
include|#
directive|include
file|<netiso/tp_stat.h>
end_include

begin_include
include|#
directive|include
file|<netiso/iso_pcb.h>
end_include

begin_include
include|#
directive|include
file|<netiso/cons.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|IncStat
end_ifdef

begin_undef
undef|#
directive|undef
name|IncStat
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<netiso/cons_pcb.h>
end_include

begin_include
include|#
directive|include
file|<netdb.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|kmem
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *	Dump esis stats  */
end_comment

begin_macro
name|esis_stats
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|esis_stat
name|esis_stat
decl_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
condition|)
return|return;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|esis_stat
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|esis_stat
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d esh sent, %d esh received\n"
argument_list|,
name|esis_stat
operator|.
name|es_eshsent
argument_list|,
name|esis_stat
operator|.
name|es_eshrcvd
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d ish sent, %d ish received\n"
argument_list|,
name|esis_stat
operator|.
name|es_ishsent
argument_list|,
name|esis_stat
operator|.
name|es_ishrcvd
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d rd sent, %d rd received\n"
argument_list|,
name|esis_stat
operator|.
name|es_rdsent
argument_list|,
name|esis_stat
operator|.
name|es_rdrcvd
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d pdus not sent due to insufficient memory\n"
argument_list|,
name|esis_stat
operator|.
name|es_nomem
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d pdus received with bad checksum\n"
argument_list|,
name|esis_stat
operator|.
name|es_badcsum
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d pdus received with bad version number\n"
argument_list|,
name|esis_stat
operator|.
name|es_badvers
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d pdus received with bad type field\n"
argument_list|,
name|esis_stat
operator|.
name|es_badtype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d short pdus received\n"
argument_list|,
name|esis_stat
operator|.
name|es_toosmall
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Dump clnp statistics structure.  */
end_comment

begin_macro
name|clnp_stats
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|clnp_stat
name|clnp_stat
decl_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
condition|)
return|return;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|clnp_stat
argument_list|,
sizeof|sizeof
argument_list|(
name|clnp_stat
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s:\n\t%d total packets sent\n"
argument_list|,
name|name
argument_list|,
name|clnp_stat
operator|.
name|cns_sent
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d total fragments sent\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_fragments
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d total packets received\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_total
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with fixed part of header too small\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_toosmall
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with header length not reasonable\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_badhlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d incorrect checksum%s\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_badcsum
argument_list|,
name|plural
argument_list|(
name|clnp_stat
operator|.
name|cns_badcsum
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with unreasonable address lengths\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_badaddr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with forgotten segmentation information\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_noseg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with an incorrect protocol identifier\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_noproto
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d with an incorrect version\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_badvers
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d dropped because the ttl has expired\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_ttlexpired
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d clnp cache misses\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_cachemiss
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d clnp congestion experience bits set\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_congest_set
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%d clnp congestion experience bits received\n"
argument_list|,
name|clnp_stat
operator|.
name|cns_congest_rcvd
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Dump CLTP statistics structure.  */
end_comment

begin_macro
name|cltp_stats
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|cltpstat
name|cltpstat
decl_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
condition|)
return|return;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|cltpstat
argument_list|,
sizeof|sizeof
argument_list|(
name|cltpstat
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s:\n\t%u incomplete header%s\n"
argument_list|,
name|name
argument_list|,
name|cltpstat
operator|.
name|cltps_hdrops
argument_list|,
name|plural
argument_list|(
name|cltpstat
operator|.
name|cltps_hdrops
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%u bad data length field%s\n"
argument_list|,
name|cltpstat
operator|.
name|cltps_badlen
argument_list|,
name|plural
argument_list|(
name|cltpstat
operator|.
name|cltps_badlen
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%u bad checksum%s\n"
argument_list|,
name|cltpstat
operator|.
name|cltps_badsum
argument_list|,
name|plural
argument_list|(
name|cltpstat
operator|.
name|cltps_badsum
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|struct
name|tp_pcb
name|tpcb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|isopcb
name|isopcb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|socket
name|sockb
decl_stmt|;
end_decl_stmt

begin_union
union|union
block|{
name|struct
name|sockaddr_iso
name|siso
decl_stmt|;
name|char
name|data
index|[
literal|128
index|]
decl_stmt|;
block|}
name|laddr
union|,
name|faddr
union|;
end_union

begin_define
define|#
directive|define
name|kget
parameter_list|(
name|o
parameter_list|,
name|p
parameter_list|)
define|\
value|(klseek(kmem, (off_t)(o), 0), read(kmem, (char *)&p, sizeof (p)))
end_define

begin_decl_stmt
specifier|extern
name|int
name|kmem
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|Aflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|aflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|first
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Print a summary of connections related to an Internet  * protocol.  For TP, also give state of connection.  * Listening processes (aflag) are suppressed unless the  * -a (all) flag is specified.  */
end_comment

begin_macro
name|iso_protopr
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|isopcb
name|cb
decl_stmt|;
specifier|register
name|struct
name|isopcb
modifier|*
name|prev
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|int
name|istp
init|=
operator|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"tp"
argument_list|)
operator|==
literal|0
operator|)
decl_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"%s control block: symbol not in namelist\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return;
block|}
name|kget
argument_list|(
name|off
argument_list|,
name|cb
argument_list|)
expr_stmt|;
name|isopcb
operator|=
name|cb
expr_stmt|;
name|prev
operator|=
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
expr_stmt|;
if|if
condition|(
name|isopcb
operator|.
name|isop_next
operator|==
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
condition|)
return|return;
while|while
condition|(
name|isopcb
operator|.
name|isop_next
operator|!=
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
condition|)
block|{
name|next
operator|=
name|isopcb
operator|.
name|isop_next
expr_stmt|;
name|kget
argument_list|(
name|next
argument_list|,
name|isopcb
argument_list|)
expr_stmt|;
if|if
condition|(
name|isopcb
operator|.
name|isop_prev
operator|!=
name|prev
condition|)
block|{
name|printf
argument_list|(
literal|"prev 0x%x next 0x%x isop_prev 0x%x isop_next 0x%x???\n"
argument_list|,
name|prev
argument_list|,
name|next
argument_list|,
name|isopcb
operator|.
name|isop_prev
argument_list|,
name|isopcb
operator|.
name|isop_next
argument_list|)
expr_stmt|;
break|break;
block|}
name|kget
argument_list|(
name|isopcb
operator|.
name|isop_socket
argument_list|,
name|sockb
argument_list|)
expr_stmt|;
if|if
condition|(
name|istp
condition|)
block|{
name|kget
argument_list|(
name|sockb
operator|.
name|so_tpcb
argument_list|,
name|tpcb
argument_list|)
expr_stmt|;
if|if
condition|(
name|tpcb
operator|.
name|tp_state
operator|==
name|ST_ERROR
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"addr: 0x%x, prev 0x%x\n"
argument_list|,
name|next
argument_list|,
name|prev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|aflag
operator|&&
name|tpcb
operator|.
name|tp_state
operator|==
name|TP_LISTENING
operator|||
name|tpcb
operator|.
name|tp_state
operator|==
name|TP_CLOSED
operator|||
name|tpcb
operator|.
name|tp_state
operator|==
name|TP_REFWAIT
condition|)
block|{
name|prev
operator|=
name|next
expr_stmt|;
continue|continue;
block|}
block|}
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"Active ISO net connections"
argument_list|)
expr_stmt|;
if|if
condition|(
name|aflag
condition|)
name|printf
argument_list|(
literal|" (including servers)"
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
if|if
condition|(
name|Aflag
condition|)
name|printf
argument_list|(
literal|"%-8.8s "
argument_list|,
literal|"PCB"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|Aflag
condition|?
literal|"%-5.5s %-6.6s %-6.6s  %-18.18s %-18.18s %s\n"
else|:
literal|"%-5.5s %-6.6s %-6.6s  %-22.22s %-22.22s %s\n"
argument_list|,
literal|"Proto"
argument_list|,
literal|"Recv-Q"
argument_list|,
literal|"Send-Q"
argument_list|,
literal|"Local Address"
argument_list|,
literal|"Foreign Address"
argument_list|,
literal|"(state)"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|Aflag
condition|)
name|printf
argument_list|(
literal|"%8x "
argument_list|,
operator|(
name|istp
condition|?
operator|(
name|off_t
operator|)
name|sockb
operator|.
name|so_tpcb
else|:
operator|(
name|off_t
operator|)
name|next
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-5.5s %6d %6d "
argument_list|,
name|name
argument_list|,
name|sockb
operator|.
name|so_rcv
operator|.
name|sb_cc
argument_list|,
name|sockb
operator|.
name|so_snd
operator|.
name|sb_cc
argument_list|)
expr_stmt|;
if|if
condition|(
name|isopcb
operator|.
name|isop_laddr
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"*.*\t"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|isopcb
operator|.
name|isop_laddr
operator|==
operator|(
operator|(
name|char
operator|*
operator|)
name|next
operator|)
operator|+
name|_offsetof
argument_list|(
expr|struct
name|isopcb
argument_list|,
name|isop_sladdr
argument_list|)
condition|)
name|laddr
operator|.
name|siso
operator|=
name|isopcb
operator|.
name|isop_sladdr
expr_stmt|;
else|else
name|kget
argument_list|(
name|isopcb
operator|.
name|isop_laddr
argument_list|,
name|laddr
argument_list|)
expr_stmt|;
name|isonetprint
argument_list|(
operator|&
name|laddr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|isopcb
operator|.
name|isop_faddr
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"*.*\t"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|isopcb
operator|.
name|isop_faddr
operator|==
operator|(
operator|(
name|char
operator|*
operator|)
name|next
operator|)
operator|+
name|_offsetof
argument_list|(
expr|struct
name|isopcb
argument_list|,
name|isop_sfaddr
argument_list|)
condition|)
name|faddr
operator|.
name|siso
operator|=
name|isopcb
operator|.
name|isop_sfaddr
expr_stmt|;
else|else
name|kget
argument_list|(
name|isopcb
operator|.
name|isop_faddr
argument_list|,
name|faddr
argument_list|)
expr_stmt|;
name|isonetprint
argument_list|(
operator|&
name|faddr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|istp
condition|)
block|{
if|if
condition|(
name|tpcb
operator|.
name|tp_state
operator|>=
name|tp_NSTATES
condition|)
name|printf
argument_list|(
literal|" %d"
argument_list|,
name|tpcb
operator|.
name|tp_state
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" %-12.12s"
argument_list|,
name|tp_sstring
index|[
name|tpcb
operator|.
name|tp_state
index|]
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|prev
operator|=
name|next
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*  * Pretty print an iso address (net address + port).  * If the nflag was specified, use numbers instead of names.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|notdef
end_ifdef

begin_function
name|char
modifier|*
name|isonetname
parameter_list|(
name|iso
parameter_list|)
specifier|register
name|struct
name|iso_addr
modifier|*
name|iso
decl_stmt|;
block|{
name|struct
name|sockaddr_iso
name|sa
decl_stmt|;
name|struct
name|iso_hostent
modifier|*
name|ihe
init|=
literal|0
decl_stmt|;
name|struct
name|iso_hostent
modifier|*
name|iso_gethostentrybyaddr
parameter_list|()
function_decl|;
name|struct
name|iso_hostent
modifier|*
name|iso_getserventrybytsel
parameter_list|()
function_decl|;
name|struct
name|iso_hostent
name|Ihe
decl_stmt|;
specifier|static
name|char
name|line
index|[
literal|80
index|]
decl_stmt|;
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
name|bzero
argument_list|(
name|line
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iso
operator|->
name|isoa_afi
condition|)
block|{
name|sa
operator|.
name|siso_family
operator|=
name|AF_ISO
expr_stmt|;
name|sa
operator|.
name|siso_addr
operator|=
operator|*
name|iso
expr_stmt|;
name|sa
operator|.
name|siso_tsuffix
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|nflag
condition|)
name|ihe
operator|=
name|iso_gethostentrybyaddr
argument_list|(
operator|&
name|sa
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ihe
condition|)
block|{
name|Ihe
operator|=
operator|*
name|ihe
expr_stmt|;
name|ihe
operator|=
operator|&
name|Ihe
expr_stmt|;
name|sprintf
argument_list|(
name|line
argument_list|,
literal|"%s"
argument_list|,
name|ihe
operator|->
name|isoh_hname
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|line
argument_list|,
literal|"%s"
argument_list|,
name|iso_ntoa
argument_list|(
name|iso
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|sprintf
argument_list|(
name|line
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
block|}
return|return
name|line
return|;
block|}
end_function

begin_expr_stmt
name|isonetprint
argument_list|(
name|iso
argument_list|,
name|sufx
argument_list|,
name|sufxlen
argument_list|,
name|islocal
argument_list|)
specifier|register
expr|struct
name|iso_addr
operator|*
name|iso
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|char
modifier|*
name|sufx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_short
name|sufxlen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|islocal
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|iso_hostent
modifier|*
name|iso_getserventrybytsel
argument_list|()
decl_stmt|,
modifier|*
name|ihe
decl_stmt|;
name|struct
name|iso_hostent
name|Ihe
decl_stmt|;
name|char
modifier|*
name|line
decl_stmt|,
modifier|*
name|cp
decl_stmt|,
modifier|*
name|index
argument_list|()
decl_stmt|;
name|int
name|Alen
init|=
name|Aflag
condition|?
literal|18
else|:
literal|22
decl_stmt|;
name|line
operator|=
name|isonetname
argument_list|(
name|iso
argument_list|)
expr_stmt|;
name|cp
operator|=
name|index
argument_list|(
name|line
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
name|ihe
operator|=
operator|(
expr|struct
name|iso_hostent
operator|*
operator|)
literal|0
expr_stmt|;
if|if
condition|(
name|islocal
condition|)
name|islocal
operator|=
literal|20
expr_stmt|;
else|else
name|islocal
operator|=
literal|22
operator|+
name|Alen
expr_stmt|;
if|if
condition|(
name|Aflag
condition|)
name|islocal
operator|+=
literal|10
expr_stmt|;
if|if
condition|(
operator|!
name|nflag
condition|)
block|{
if|if
condition|(
operator|(
name|cp
operator|-
name|line
operator|)
operator|>
literal|10
condition|)
block|{
name|cp
operator|=
name|line
operator|+
literal|10
expr_stmt|;
name|bzero
argument_list|(
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
operator|-
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
operator|*
name|cp
operator|++
operator|=
literal|'.'
expr_stmt|;
if|if
condition|(
name|sufxlen
condition|)
block|{
if|if
condition|(
operator|!
name|Aflag
operator|&&
operator|!
name|nflag
operator|&&
operator|(
name|ihe
operator|=
name|iso_getserventrybytsel
argument_list|(
name|sufx
argument_list|,
name|sufxlen
argument_list|)
operator|)
condition|)
block|{
name|Ihe
operator|=
operator|*
name|ihe
expr_stmt|;
name|ihe
operator|=
operator|&
name|Ihe
expr_stmt|;
block|}
if|if
condition|(
name|ihe
operator|&&
operator|(
name|strlen
argument_list|(
name|ihe
operator|->
name|isoh_aname
argument_list|)
operator|>
literal|0
operator|)
condition|)
block|{
name|sprintf
argument_list|(
name|cp
argument_list|,
literal|"%s"
argument_list|,
name|ihe
operator|->
name|isoh_aname
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|iso_sprinttsel
argument_list|(
name|cp
argument_list|,
name|sufx
argument_list|,
name|sufxlen
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|sprintf
argument_list|(
name|cp
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
comment|/* 	fprintf(stdout, Aflag?" %-18.18s":" %-22.22s", line); 	*/
if|if
condition|(
name|strlen
argument_list|(
name|line
argument_list|)
operator|>
name|Alen
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" %s"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n %*.s"
argument_list|,
name|islocal
operator|+
name|Alen
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" %-*.*s"
argument_list|,
name|Alen
argument_list|,
name|Alen
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|notdef
end_ifdef

begin_macro
name|x25_protopr
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|char
modifier|*
name|xpcb_states
index|[]
init|=
block|{
literal|"CLOSED"
block|,
literal|"LISTENING"
block|,
literal|"CLOSING"
block|,
literal|"CONNECTING"
block|,
literal|"ACKWAIT"
block|,
literal|"OPEN"
block|, 	}
decl_stmt|;
specifier|register
name|struct
name|isopcb
modifier|*
name|prev
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|struct
name|x25_pcb
name|xpcb
decl_stmt|;
if|if
condition|(
name|off
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"%s control block: symbol not in namelist\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return;
block|}
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|xpcb
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|x25_pcb
argument_list|)
argument_list|)
expr_stmt|;
name|prev
operator|=
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
expr_stmt|;
if|if
condition|(
name|xpcb
operator|.
name|x_next
operator|==
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
condition|)
return|return;
while|while
condition|(
name|xpcb
operator|.
name|x_next
operator|!=
operator|(
expr|struct
name|isopcb
operator|*
operator|)
name|off
condition|)
block|{
name|next
operator|=
name|isopcb
operator|.
name|isop_next
expr_stmt|;
name|klseek
argument_list|(
name|kmem
argument_list|,
operator|(
name|off_t
operator|)
name|next
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|xpcb
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|x25_pcb
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|xpcb
operator|.
name|x_prev
operator|!=
name|prev
condition|)
block|{
name|printf
argument_list|(
literal|"???\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|klseek
argument_list|(
name|kmem
argument_list|,
operator|(
name|off_t
operator|)
name|xpcb
operator|.
name|x_socket
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|sockb
argument_list|,
sizeof|sizeof
argument_list|(
name|sockb
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|aflag
operator|&&
name|xpcb
operator|.
name|x_state
operator|==
name|LISTENING
operator|||
name|xpcb
operator|.
name|x_state
operator|==
name|TP_CLOSED
condition|)
block|{
name|prev
operator|=
name|next
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|first
condition|)
block|{
name|printf
argument_list|(
literal|"Active X25 net connections"
argument_list|)
expr_stmt|;
if|if
condition|(
name|aflag
condition|)
name|printf
argument_list|(
literal|" (including servers)"
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
if|if
condition|(
name|Aflag
condition|)
name|printf
argument_list|(
literal|"%-8.8s "
argument_list|,
literal|"PCB"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
name|Aflag
condition|?
literal|"%-5.5s %-6.6s %-6.6s  %-18.18s %-18.18s %s\n"
else|:
literal|"%-5.5s %-6.6s %-6.6s  %-22.22s %-22.22s %s\n"
argument_list|,
literal|"Proto"
argument_list|,
literal|"Recv-Q"
argument_list|,
literal|"Send-Q"
argument_list|,
literal|"Local Address"
argument_list|,
literal|"Foreign Address"
argument_list|,
literal|"(state)"
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%-5.5s %6d %6d "
argument_list|,
name|name
argument_list|,
name|sockb
operator|.
name|so_rcv
operator|.
name|sb_cc
argument_list|,
name|sockb
operator|.
name|so_snd
operator|.
name|sb_cc
argument_list|)
expr_stmt|;
name|isonetprint
argument_list|(
operator|&
name|xpcb
operator|.
name|x_laddr
operator|.
name|siso_addr
argument_list|,
operator|&
name|xpcb
operator|.
name|x_lport
argument_list|,
sizeof|sizeof
argument_list|(
name|xpcb
operator|.
name|x_lport
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|isonetprint
argument_list|(
operator|&
name|xpcb
operator|.
name|x_faddr
operator|.
name|siso_addr
argument_list|,
operator|&
name|xpcb
operator|.
name|x_fport
argument_list|,
sizeof|sizeof
argument_list|(
name|xpcb
operator|.
name|x_lport
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|xpcb
operator|.
name|x_state
operator|<
literal|0
operator|||
name|xpcb
operator|.
name|x_state
operator|>=
name|x25_NSTATES
condition|)
name|printf
argument_list|(
literal|" 0x0x0x0x0x0x0x0x0x%x"
argument_list|,
name|xpcb
operator|.
name|x_state
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" %-12.12s"
argument_list|,
name|xpcb_states
index|[
name|xpcb
operator|.
name|x_state
index|]
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|prev
operator|=
name|next
expr_stmt|;
block|}
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|struct
name|tp_stat
name|tp_stat
decl_stmt|;
end_decl_stmt

begin_macro
name|tp_stats
argument_list|(
argument|off
argument_list|,
argument|name
argument_list|)
end_macro

begin_decl_stmt
name|caddr_t
name|off
decl_stmt|,
name|name
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|off
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"TP not configured\n\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"%s:\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|kget
argument_list|(
name|off
argument_list|,
name|tp_stat
argument_list|)
expr_stmt|;
name|tprintstat
argument_list|(
operator|&
name|tp_stat
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|OUT
value|stdout
end_define

begin_define
define|#
directive|define
name|plural
parameter_list|(
name|x
parameter_list|)
value|(x>1?"s":"")
end_define

begin_expr_stmt
name|tprintstat
argument_list|(
name|s
argument_list|,
name|indent
argument_list|)
specifier|register
expr|struct
name|tp_stat
operator|*
name|s
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|indent
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*sReceiving:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d variable parameter%s ignored\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_param_ignored
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_param_ignored
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid parameter code%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_pcode
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_inv_pcode
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid parameter value%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_pval
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_inv_pval
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid dutype%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_dutype
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_inv_dutype
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d negotiation failure%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_negotfailed
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_negotfailed
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid destination reference%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_dref
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_inv_dref
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid suffix parameter%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_sufx
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_inv_sufx
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid length\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_inv_length
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d invalid checksum%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_bad_csum
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_bad_csum
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d DT%s out of order\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_dt_ooo
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_dt_ooo
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d DT%s not in window\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_dt_niw
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_dt_niw
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d duplicate DT%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_dt_dup
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_dt_dup
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d XPD%s not in window\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_xpd_niw
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_xpd_niw
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d XPD%s w/o credit to stash\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_xpd_dup
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_xpd_dup
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d time%s local credit reneged\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_lcdt_reduced
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_lcdt_reduced
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d concatenated TPDU%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_concat_rcvd
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_concat_rcvd
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*sSending:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d XPD mark%s discarded\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_xpdmark_del
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_xpdmark_del
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sXPD stopped data flow %d time%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_xpd_intheway
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_xpd_intheway
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d time%s foreign window closed\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_zfcdt
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_zfcdt
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*sMiscellaneous:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d small mbuf%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_mb_small
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_mb_small
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d cluster%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_mb_cluster
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_mb_cluster
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d source quench \n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_quench
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d dec bit%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_rcvdecbit
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_rcvdecbit
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sM:L ( M mbuf chains of length L)\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|{
specifier|register
name|int
name|j
decl_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d: over 16\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_mb_len_distr
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<=
literal|8
condition|;
name|j
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d: %d\t\t%d: %d\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_mb_len_distr
index|[
name|j
index|]
argument_list|,
name|j
argument_list|,
name|s
operator|->
name|ts_mb_len_distr
index|[
name|j
operator|<<
literal|1
index|]
argument_list|,
name|j
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d EOT rcvd\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_eot_input
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d EOT sent\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_EOT_sent
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d EOT indication%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_eot_user
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_eot_user
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*sConnections:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d connection%s used extended format\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_xtd_fmt
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_xtd_fmt
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d connection%s allowed transport expedited data\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_use_txpd
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_use_txpd
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d connection%s turned off checksumming\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_csum_off
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_csum_off
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d connection%s dropped due to retrans limit\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_conn_gaveup
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_conn_gaveup
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d tp 4 connection%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_tp4_conn
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_tp4_conn
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%d tp 0 connection%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_tp0_conn
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_tp0_conn
argument_list|)
argument_list|)
expr_stmt|;
block|{
specifier|register
name|int
name|j
decl_stmt|,
name|div
decl_stmt|;
specifier|register
name|float
name|f
decl_stmt|;
specifier|static
name|char
modifier|*
name|name
index|[]
init|=
block|{
literal|"~LOCAL, PDN"
block|,
literal|"~LOCAL,~PDN"
block|,
literal|" LOCAL,~PDN"
block|,
literal|" LOCAL, PDN"
block|}
decl_stmt|;
define|#
directive|define
name|factor
parameter_list|(
name|i
parameter_list|)
define|\
value|div = (s->ts_rtt[(i)].tv_sec * 1000000) + \ 		s->ts_rtt[(i)].tv_usec ;\ 	if(div) {\ 		f = ((s->ts_rtv[(i)].tv_sec * 1000000) + \ 				s->ts_rtv[(i)].tv_usec)/div;  \ 		div = (int) (f + 0.5);\ 	}
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sRound trip times, listed in (sec: usec):\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%11.11s  %12.12s | %12.12s | %s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
literal|"Category"
argument_list|,
literal|"Smoothed avg"
argument_list|,
literal|"Deviation"
argument_list|,
literal|"Deviation/Avg"
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|3
condition|;
name|j
operator|++
control|)
block|{
name|factor
argument_list|(
name|j
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%11.11s: %5d:%-6d | %5d:%-6d | %-6d\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|name
index|[
name|j
index|]
argument_list|,
name|s
operator|->
name|ts_rtt
index|[
name|j
index|]
operator|.
name|tv_sec
argument_list|,
name|s
operator|->
name|ts_rtt
index|[
name|j
index|]
operator|.
name|tv_usec
argument_list|,
name|s
operator|->
name|ts_rtv
index|[
name|j
index|]
operator|.
name|tv_sec
argument_list|,
name|s
operator|->
name|ts_rtv
index|[
name|j
index|]
operator|.
name|tv_usec
argument_list|,
name|div
argument_list|)
expr_stmt|;
block|}
block|}
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sTpdus RECVD [%d valid, %3.6f %% of total (%d); %d dropped]\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_tpdu_rcvd
argument_list|,
operator|(
operator|(
name|s
operator|->
name|ts_pkt_rcvd
operator|>
literal|0
operator|)
condition|?
operator|(
operator|(
literal|100
operator|*
operator|(
name|float
operator|)
name|s
operator|->
name|ts_tpdu_rcvd
operator|)
operator|/
operator|(
name|float
operator|)
name|s
operator|->
name|ts_pkt_rcvd
operator|)
else|:
literal|0
operator|)
argument_list|,
name|s
operator|->
name|ts_pkt_rcvd
argument_list|,
name|s
operator|->
name|ts_recv_drop
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sDT  %6d   AK  %6d   DR  %4d   CR  %4d \n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_DT_rcvd
argument_list|,
name|s
operator|->
name|ts_AK_rcvd
argument_list|,
name|s
operator|->
name|ts_DR_rcvd
argument_list|,
name|s
operator|->
name|ts_CR_rcvd
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sXPD %6d   XAK %6d   DC  %4d   CC  %4d   ER  %4d\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_XPD_rcvd
argument_list|,
name|s
operator|->
name|ts_XAK_rcvd
argument_list|,
name|s
operator|->
name|ts_DC_rcvd
argument_list|,
name|s
operator|->
name|ts_CC_rcvd
argument_list|,
name|s
operator|->
name|ts_ER_rcvd
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sTpdus SENT [%d total, %d dropped]\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_tpdu_sent
argument_list|,
name|s
operator|->
name|ts_send_drop
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sDT  %6d   AK  %6d   DR  %4d   CR  %4d \n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_DT_sent
argument_list|,
name|s
operator|->
name|ts_AK_sent
argument_list|,
name|s
operator|->
name|ts_DR_sent
argument_list|,
name|s
operator|->
name|ts_CR_sent
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sXPD %6d   XAK %6d   DC  %4d   CC  %4d   ER  %4d\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_XPD_sent
argument_list|,
name|s
operator|->
name|ts_XAK_sent
argument_list|,
name|s
operator|->
name|ts_DC_sent
argument_list|,
name|s
operator|->
name|ts_CC_sent
argument_list|,
name|s
operator|->
name|ts_ER_sent
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sRetransmissions:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
define|#
directive|define
name|PERCENT
parameter_list|(
name|X
parameter_list|,
name|Y
parameter_list|)
value|(((Y)>0)?((100 *(float)(X)) / (float) (Y)):0)
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sCR  %6d   CC  %6d   DR  %6d \n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_retrans_cr
argument_list|,
name|s
operator|->
name|ts_retrans_cc
argument_list|,
name|s
operator|->
name|ts_retrans_dr
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sDT  %6d (%5.2f%%)\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_retrans_dt
argument_list|,
name|PERCENT
argument_list|(
name|s
operator|->
name|ts_retrans_dt
argument_list|,
name|s
operator|->
name|ts_DT_sent
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*sXPD %6d (%5.2f%%)\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_retrans_xpd
argument_list|,
name|PERCENT
argument_list|(
name|s
operator|->
name|ts_retrans_xpd
argument_list|,
name|s
operator|->
name|ts_XPD_sent
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sE Timers: [%6d ticks]\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_Eticks
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*s%6d timer%s set \t%6d timer%s expired \t%6d timer%s cancelled\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_Eset
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Eset
argument_list|)
argument_list|,
name|s
operator|->
name|ts_Eexpired
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Eexpired
argument_list|)
argument_list|,
name|s
operator|->
name|ts_Ecan_act
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Ecan_act
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sC Timers: [%6d ticks]\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_Cticks
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*s%6d timer%s set \t%6d timer%s expired \t%6d timer%s cancelled\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_Cset
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Cset
argument_list|)
argument_list|,
name|s
operator|->
name|ts_Cexpired
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Cexpired
argument_list|)
argument_list|,
name|s
operator|->
name|ts_Ccan_act
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Ccan_act
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"%*s%6d inactive timer%s cancelled\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_Ccan_inact
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_Ccan_inact
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sPathological debugging activity:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d CC%s sent to zero dref\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_zdebug
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_zdebug
argument_list|)
argument_list|)
expr_stmt|;
comment|/* SAME LINE AS ABOVE */
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d random DT%s dropped\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ydebug
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_ydebug
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d illegally large XPD TPDU%s\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_vdebug
argument_list|,
name|plural
argument_list|(
name|s
operator|->
name|ts_vdebug
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d faked reneging of cdt\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ldebug
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\n%*sACK reasons:\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d not acked immediately\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_DONT_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d strategy==each\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_STRAT_EACH_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d strategy==fullwindow\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_STRAT_FULLWIN_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d duplicate DT\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_DUP_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d EOTSDU\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_EOT_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d reordered DT\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_REORDER_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d user rcvd\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_USRRCV_
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|OUT
argument_list|,
literal|"\t%*s%6d fcc reqd\n"
argument_list|,
name|indent
argument_list|,
literal|" "
argument_list|,
name|s
operator|->
name|ts_ackreason
index|[
name|_ACK_FCC_
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_ifndef
ifndef|#
directive|ifndef
name|SSEL
end_ifndef

begin_define
define|#
directive|define
name|SSEL
parameter_list|(
name|s
parameter_list|)
value|((s)->siso_tlen + TSEL(s))
end_define

begin_define
define|#
directive|define
name|PSEL
parameter_list|(
name|s
parameter_list|)
value|((s)->siso_slen + SSEL(s))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_expr_stmt
name|isonetprint
argument_list|(
name|siso
argument_list|,
name|islocal
argument_list|)
specifier|register
expr|struct
name|sockaddr_iso
operator|*
name|siso
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|islocal
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hexprint
argument_list|(
name|siso
operator|->
name|siso_nlen
argument_list|,
name|siso
operator|->
name|siso_addr
operator|.
name|isoa_genaddr
argument_list|,
literal|"{}"
argument_list|)
expr_stmt|;
if|if
condition|(
name|siso
operator|->
name|siso_tlen
operator|||
name|siso
operator|->
name|siso_slen
operator|||
name|siso
operator|->
name|siso_plen
condition|)
name|hexprint
argument_list|(
name|siso
operator|->
name|siso_tlen
argument_list|,
name|TSEL
argument_list|(
name|siso
argument_list|)
argument_list|,
literal|"()"
argument_list|)
expr_stmt|;
if|if
condition|(
name|siso
operator|->
name|siso_slen
operator|||
name|siso
operator|->
name|siso_plen
condition|)
name|hexprint
argument_list|(
name|siso
operator|->
name|siso_slen
argument_list|,
name|SSEL
argument_list|(
name|siso
argument_list|)
argument_list|,
literal|"[]"
argument_list|)
expr_stmt|;
if|if
condition|(
name|siso
operator|->
name|siso_plen
condition|)
name|hexprint
argument_list|(
name|siso
operator|->
name|siso_plen
argument_list|,
name|PSEL
argument_list|(
name|siso
argument_list|)
argument_list|,
literal|"<>"
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
specifier|static
name|char
name|hexlist
index|[]
init|=
literal|"0123456789abcdef"
decl_stmt|,
name|obuf
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_macro
name|hexprint
argument_list|(
argument|n
argument_list|,
argument|buf
argument_list|,
argument|delim
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|delim
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|u_char
modifier|*
name|in
init|=
operator|(
name|u_char
operator|*
operator|)
name|buf
decl_stmt|,
modifier|*
name|top
init|=
name|in
operator|+
name|n
decl_stmt|;
specifier|register
name|char
modifier|*
name|out
init|=
name|obuf
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
condition|)
return|return;
while|while
condition|(
name|in
operator|<
name|top
condition|)
block|{
name|i
operator|=
operator|*
name|in
operator|++
expr_stmt|;
operator|*
name|out
operator|++
operator|=
literal|'.'
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|0xf
condition|)
block|{
name|out
index|[
literal|1
index|]
operator|=
name|hexlist
index|[
name|i
operator|&
literal|0xf
index|]
expr_stmt|;
name|i
operator|>>=
literal|4
expr_stmt|;
name|out
index|[
literal|0
index|]
operator|=
name|hexlist
index|[
name|i
index|]
expr_stmt|;
name|out
operator|+=
literal|2
expr_stmt|;
block|}
else|else
operator|*
name|out
operator|++
operator|=
name|hexlist
index|[
name|i
index|]
expr_stmt|;
block|}
operator|*
name|obuf
operator|=
operator|*
name|delim
expr_stmt|;
operator|*
name|out
operator|++
operator|=
name|delim
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|out
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|obuf
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

