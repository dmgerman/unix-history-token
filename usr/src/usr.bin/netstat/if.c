begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)if.c	4.1 82/08/25"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/in.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|kmem
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|tflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|nflag
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|char
modifier|*
name|routename
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*  * Print a description of the network interfaces.  * If interval is non-zero, repeat display every   * interval seconds, showing statistics collected  * over that interval.  First line printed is always  * cumulative.  */
end_comment

begin_macro
name|intpr
argument_list|(
argument|interval
argument_list|,
argument|ifnetaddr
argument_list|)
end_macro

begin_decl_stmt
name|int
name|interval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|off_t
name|ifnetaddr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|ifnet
name|ifnet
decl_stmt|;
name|char
name|name
index|[
literal|16
index|]
decl_stmt|;
if|if
condition|(
name|ifnetaddr
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"ifnet: symbol not defined\n"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|interval
condition|)
block|{
name|sidewaysintpr
argument_list|(
name|interval
argument_list|,
name|ifnetaddr
argument_list|)
expr_stmt|;
return|return;
block|}
name|klseek
argument_list|(
name|kmem
argument_list|,
name|ifnetaddr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|ifnetaddr
argument_list|,
sizeof|sizeof
name|ifnetaddr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-5.5s %-5.5s %-8.8s %-12.12s %-7.7s %-5.5s %-7.7s %-5.5s"
argument_list|,
literal|"Name"
argument_list|,
literal|"Mtu"
argument_list|,
literal|"Network"
argument_list|,
literal|"Address"
argument_list|,
literal|"Ipkts"
argument_list|,
literal|"Ierrs"
argument_list|,
literal|"Opkts"
argument_list|,
literal|"Oerrs"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %-6.6s"
argument_list|,
literal|"Collis"
argument_list|)
expr_stmt|;
if|if
condition|(
name|tflag
condition|)
name|printf
argument_list|(
literal|" %-6.6s"
argument_list|,
literal|"Timer"
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
while|while
condition|(
name|ifnetaddr
condition|)
block|{
name|struct
name|sockaddr_in
modifier|*
name|sin
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|;
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|ifnetaddr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|ifnet
argument_list|,
sizeof|sizeof
name|ifnet
argument_list|)
expr_stmt|;
name|klseek
argument_list|(
name|kmem
argument_list|,
operator|(
name|int
operator|)
name|ifnet
operator|.
name|if_name
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
name|name
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|name
index|[
literal|15
index|]
operator|=
literal|'\0'
expr_stmt|;
name|cp
operator|=
name|index
argument_list|(
name|name
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|ifnet
operator|.
name|if_unit
operator|+
literal|'0'
expr_stmt|;
if|if
condition|(
operator|(
name|ifnet
operator|.
name|if_flags
operator|&
name|IFF_UP
operator|)
operator|==
literal|0
condition|)
operator|*
name|cp
operator|++
operator|=
literal|'*'
expr_stmt|;
operator|*
name|cp
operator|=
literal|'\0'
expr_stmt|;
name|printf
argument_list|(
literal|"%-5.5s %-5d "
argument_list|,
name|name
argument_list|,
name|ifnet
operator|.
name|if_mtu
argument_list|)
expr_stmt|;
name|sin
operator|=
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|ifnet
operator|.
name|if_addr
expr_stmt|;
name|printf
argument_list|(
literal|"%-8.8s "
argument_list|,
name|routename
argument_list|(
name|ifnet
operator|.
name|if_net
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-12.12s %-7d %-5d %-7d %-5d %-6d"
argument_list|,
name|routename
argument_list|(
name|sin
operator|->
name|sin_addr
argument_list|)
argument_list|,
name|ifnet
operator|.
name|if_ipackets
argument_list|,
name|ifnet
operator|.
name|if_ierrors
argument_list|,
name|ifnet
operator|.
name|if_opackets
argument_list|,
name|ifnet
operator|.
name|if_oerrors
argument_list|,
name|ifnet
operator|.
name|if_collisions
argument_list|)
expr_stmt|;
if|if
condition|(
name|tflag
condition|)
name|printf
argument_list|(
literal|" %-6d"
argument_list|,
name|ifnet
operator|.
name|if_timer
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|ifnetaddr
operator|=
operator|(
name|off_t
operator|)
name|ifnet
operator|.
name|if_next
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|sidewaysintpr
argument_list|(
argument|interval
argument_list|,
argument|off
argument_list|)
end_macro

begin_decl_stmt
name|int
name|interval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|off_t
name|off
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|ifnet
name|ifnet
decl_stmt|;
name|char
name|name
index|[
literal|16
index|]
decl_stmt|;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|off
argument_list|,
sizeof|sizeof
argument_list|(
name|off_t
argument_list|)
argument_list|)
expr_stmt|;
return|return;
comment|/*NOTREACHED*/
name|printf
argument_list|(
literal|"%-5.5s\t%-5.5s  %-10.10s  %-10.10s %-7.7s %-5.5s %-7.7s %-5.5s"
argument_list|,
literal|"Name"
argument_list|,
literal|"Ipkts"
argument_list|,
literal|"Ierrs"
argument_list|,
literal|"Opkts"
argument_list|,
literal|"Oerrs"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  %-6.6s"
argument_list|,
literal|"collis"
argument_list|)
expr_stmt|;
while|while
condition|(
name|off
condition|)
block|{
name|struct
name|sockaddr_in
modifier|*
name|sin
decl_stmt|;
name|klseek
argument_list|(
name|kmem
argument_list|,
name|off
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
operator|&
name|ifnet
argument_list|,
sizeof|sizeof
name|ifnet
argument_list|)
expr_stmt|;
name|klseek
argument_list|(
name|kmem
argument_list|,
operator|(
name|int
operator|)
name|ifnet
operator|.
name|if_name
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|kmem
argument_list|,
name|name
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|sin
operator|=
operator|(
expr|struct
name|sockaddr_in
operator|*
operator|)
operator|&
name|ifnet
operator|.
name|if_addr
expr_stmt|;
name|printf
argument_list|(
literal|"%s%d%c:\t%5d  "
argument_list|,
name|name
argument_list|,
name|ifnet
operator|.
name|if_unit
argument_list|,
name|ifnet
operator|.
name|if_flags
operator|&
name|IFF_UP
condition|?
literal|'\0'
else|:
literal|'*'
argument_list|,
name|ifnet
operator|.
name|if_mtu
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%-10.10s %-10.10s %7d %5d %7d %5d  %6d"
argument_list|,
name|inetname
argument_list|(
name|ifnet
operator|.
name|if_net
argument_list|)
argument_list|,
name|inetname
argument_list|(
name|sin
operator|->
name|sin_addr
argument_list|)
argument_list|,
name|ifnet
operator|.
name|if_ipackets
argument_list|,
name|ifnet
operator|.
name|if_ierrors
argument_list|,
name|ifnet
operator|.
name|if_opackets
argument_list|,
name|ifnet
operator|.
name|if_oerrors
argument_list|,
name|ifnet
operator|.
name|if_collisions
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|off
operator|=
operator|(
name|off_t
operator|)
name|ifnet
operator|.
name|if_next
expr_stmt|;
block|}
block|}
end_block

end_unit

