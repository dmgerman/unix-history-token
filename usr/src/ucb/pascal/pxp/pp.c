begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1980 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)pp.c	5.3 (Berkeley) 10/16/87"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_comment
comment|/*  * pxp - Pascal execution profiler  *  * Bill Joy UCB  * Version 1.2 January 1979  */
end_comment

begin_include
include|#
directive|include
file|"0.h"
end_include

begin_define
define|#
directive|define
name|noprint
parameter_list|()
value|nopflg
end_define

begin_decl_stmt
name|int
name|pplev
index|[
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* STAT, DECL, PRFN */
end_comment

begin_decl_stmt
name|int
name|nopflg
decl_stmt|;
end_decl_stmt

begin_macro
name|setprint
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|profile
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|table
condition|)
name|nopflg
operator|=
literal|1
expr_stmt|;
else|else
name|nopflg
operator|=
literal|0
expr_stmt|;
return|return;
block|}
name|nopflg
operator|=
operator|!
name|all
operator|&&
name|nowcnt
argument_list|()
operator|==
literal|0
operator|||
operator|!
name|opt
argument_list|(
literal|'z'
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printon
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|profile
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|table
condition|)
name|nopflg
operator|=
literal|1
expr_stmt|;
return|return;
block|}
name|nopflg
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|printoff
argument_list|()
end_macro

begin_block
block|{
name|nopflg
operator|=
literal|1
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|ppkw
argument_list|(
name|s
argument_list|)
specifier|register
name|char
operator|*
name|s
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
name|i
decl_stmt|;
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
comment|/* 	 * First real thing printed 	 * is always a keyword 	 * or includes an "id" (if a comment) 	 * (See ppnl below) 	 */
name|hadsome
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|underline
condition|)
block|{
for|for
control|(
name|cp
operator|=
name|s
init|;
operator|*
name|cp
condition|;
name|cp
operator|++
control|)
name|putchar
argument_list|(
literal|'_'
argument_list|)
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|s
init|;
operator|*
name|cp
condition|;
name|cp
operator|++
control|)
name|putchar
argument_list|(
literal|'\b'
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|ppid
argument_list|(
name|s
argument_list|)
specifier|register
name|char
operator|*
name|s
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|hadsome
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|s
operator|==
name|NIL
condition|)
name|s
operator|=
literal|"{identifier}"
expr_stmt|;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppbra
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|s
operator|!=
name|NIL
condition|)
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppsep
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppket
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|s
operator|!=
name|NIL
condition|)
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|char
name|killsp
decl_stmt|;
end_decl_stmt

begin_macro
name|ppunspac
argument_list|()
end_macro

begin_block
block|{
name|killsp
operator|=
literal|1
expr_stmt|;
block|}
end_block

begin_macro
name|ppspac
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|killsp
condition|)
block|{
name|killsp
operator|=
literal|0
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppitem
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|ppnl
argument_list|()
expr_stmt|;
name|indent
argument_list|()
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|owenl
decl_stmt|,
name|owenlb
decl_stmt|;
end_decl_stmt

begin_macro
name|ppsnlb
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|nopflg
condition|)
return|return;
name|owenlb
operator|++
expr_stmt|;
block|}
end_block

begin_macro
name|ppsnl
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|nopflg
condition|)
return|return;
name|owenl
operator|++
expr_stmt|;
block|}
end_block

begin_macro
name|pppay
argument_list|()
end_macro

begin_block
block|{
while|while
condition|(
name|owenl
operator|||
name|owenlb
condition|)
block|{
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
if|if
condition|(
name|owenlb
condition|)
block|{
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|owenlb
operator|--
expr_stmt|;
block|}
else|else
name|owenl
operator|--
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|ppnl
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|hadsome
operator|==
literal|0
condition|)
return|return;
name|pppay
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|indent
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
expr_stmt|;
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|linopr
argument_list|()
expr_stmt|;
if|if
condition|(
name|profile
operator|==
literal|0
condition|)
block|{
name|indent1
argument_list|(
name|pplev
index|[
name|PRFN
index|]
operator|+
name|pplev
index|[
name|DECL
index|]
operator|+
name|pplev
index|[
name|STAT
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
name|indent1
argument_list|(
name|pplev
index|[
name|PRFN
index|]
operator|+
name|pplev
index|[
name|STAT
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|i
operator|=
name|shudpcnt
argument_list|()
condition|)
block|{
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"%7ld."
argument_list|,
name|nowcnt
argument_list|()
argument_list|)
expr_stmt|;
name|dashes
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'|'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
case|case
operator|-
literal|1
case|:
name|printf
argument_list|(
literal|"        "
argument_list|)
expr_stmt|;
name|dashes
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
name|i
operator|==
literal|0
condition|?
literal|'|'
else|:
literal|' '
argument_list|)
expr_stmt|;
break|break;
block|}
name|indent1
argument_list|(
name|pplev
index|[
name|DECL
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dashes
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|char
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
expr_stmt|;
for|for
control|(
name|i
operator|=
name|unit
operator|-
literal|1
init|;
name|i
operator|!=
literal|0
condition|;
name|i
operator|--
control|)
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|indent1
argument_list|(
argument|in
argument_list|)
end_macro

begin_decl_stmt
name|int
name|in
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
expr_stmt|;
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|i
operator|=
name|in
expr_stmt|;
if|if
condition|(
name|profile
operator|==
literal|0
condition|)
while|while
condition|(
name|i
operator|>=
literal|8
condition|)
block|{
name|putchar
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
name|i
operator|-=
literal|8
expr_stmt|;
block|}
while|while
condition|(
name|i
operator|>
literal|0
condition|)
block|{
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
name|i
operator|--
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|linopr
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|profile
condition|)
block|{
if|if
condition|(
name|line
operator|<
literal|0
condition|)
name|line
operator|=
operator|-
name|line
expr_stmt|;
name|printf
argument_list|(
literal|"%6d  "
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|indentlab
argument_list|()
end_macro

begin_block
block|{
name|indent1
argument_list|(
name|pplev
index|[
name|PRFN
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppop
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppnumb
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|s
operator|==
name|NIL
condition|)
name|s
operator|=
literal|"{number}"
expr_stmt|;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppgoin
argument_list|(
argument|lv
argument_list|)
end_macro

begin_block
block|{
name|pplev
index|[
name|lv
index|]
operator|+=
name|unit
expr_stmt|;
block|}
end_block

begin_macro
name|ppgoout
argument_list|(
argument|lv
argument_list|)
end_macro

begin_block
block|{
name|pplev
index|[
name|lv
index|]
operator|-=
name|unit
expr_stmt|;
if|if
condition|(
name|pplev
index|[
name|lv
index|]
operator|<
literal|0
condition|)
name|panic
argument_list|(
literal|"pplev"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ppstr
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|;
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|s
operator|==
name|NIL
condition|)
block|{
name|printf
argument_list|(
literal|"{string}"
argument_list|)
expr_stmt|;
return|return;
block|}
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
name|cp
operator|=
name|s
expr_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
block|{
name|putchar
argument_list|(
operator|*
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|'\''
condition|)
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
name|cp
operator|++
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\''
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|pplab
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
if|if
condition|(
name|s
operator|==
name|NIL
condition|)
name|s
operator|=
literal|"{integer label}"
expr_stmt|;
name|printf
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|outcol
decl_stmt|;
end_decl_stmt

begin_macro
name|putchar
argument_list|(
argument|c
argument_list|)
end_macro

begin_decl_stmt
name|char
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|putc
argument_list|(
name|c
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|stdout
argument_list|)
condition|)
name|outerr
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\n'
case|:
name|outcol
operator|=
literal|0
expr_stmt|;
name|flush
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'\t'
case|:
name|outcol
operator|+=
literal|8
expr_stmt|;
name|outcol
operator|&=
operator|~
literal|07
expr_stmt|;
break|break;
case|case
literal|'\b'
case|:
if|if
condition|(
name|outcol
condition|)
name|outcol
operator|--
expr_stmt|;
break|break;
default|default:
name|outcol
operator|++
expr_stmt|;
case|case
literal|'\f'
case|:
break|break;
block|}
block|}
end_block

begin_macro
name|flush
argument_list|()
end_macro

begin_block
block|{
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|stdout
argument_list|)
condition|)
name|outerr
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|pptab
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|noprint
argument_list|()
condition|)
return|return;
name|i
operator|=
name|pplev
index|[
name|PRFN
index|]
operator|+
name|profile
condition|?
literal|44
operator|+
name|unit
else|:
literal|28
expr_stmt|;
comment|/* 	if (outcol> i + 8) { 		ppnl(); 		i += 8; 	} */
do|do
name|putchar
argument_list|(
literal|'\t'
argument_list|)
expr_stmt|;
do|while
condition|(
name|outcol
operator|<
name|i
condition|)
do|;
block|}
end_block

begin_macro
name|outerr
argument_list|()
end_macro

begin_block
block|{
name|perror
argument_list|(
name|stdoutn
argument_list|)
expr_stmt|;
name|pexit
argument_list|(
name|DIED
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

