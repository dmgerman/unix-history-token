begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<ingres.h>
end_include

begin_include
include|#
directive|include
file|<aux.h>
end_include

begin_include
include|#
directive|include
file|<symbol.h>
end_include

begin_include
include|#
directive|include
file|<tree.h>
end_include

begin_include
include|#
directive|include
file|<pv.h>
end_include

begin_include
include|#
directive|include
file|"qrymod.h"
end_include

begin_include
include|#
directive|include
file|<sccs.h>
end_include

begin_macro
name|SCCSID
argument_list|(
argument|@(#)issue.c
literal|7.1
literal|2
argument|/
literal|5
argument|/
literal|81
argument_list|)
end_macro

begin_comment
comment|/* **  ISSUE -- issue query to rest of system ** **	This function issues a query to the rest of the INGRES system. **	The sync from below is read, but not passed up. ** **	Parameters: **		tree -- pointer to tree to issue. ** **	Returns: **		none. ** **	Side Effects: **		A query is executed. ** **	Trace Flags: **		71 */
end_comment

begin_macro
name|issue
argument_list|(
argument|state
argument_list|,
argument|tree
argument_list|)
end_macro

begin_decl_stmt
name|int
name|state
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|QTREE
modifier|*
name|tree
decl_stmt|;
end_decl_stmt

begin_block
block|{
ifdef|#
directive|ifdef
name|xQTR2
if|if
condition|(
name|tTf
argument_list|(
literal|71
argument_list|,
literal|0
argument_list|)
condition|)
name|printf
argument_list|(
literal|"issue:\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|initp
argument_list|()
expr_stmt|;
name|setp
argument_list|(
name|PV_QTREE
argument_list|,
name|tree
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|call
argument_list|(
name|state
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* **  ISSUEINVERT -- issue a query, but invert the qualification ** **	This routine is similar to 'issue', except that it issues **	a query with the qualification inverted.  The inversion **	(and subsequent tree normalization) is done on a duplicate **	of the tree. ** **	Parameters: **		root -- the root of the tree to issue. ** **	Returns: **		none. ** **	Side Effects: **		'root' is issued. ** **	Trace Flags: **		none */
end_comment

begin_macro
name|issueinvert
argument_list|(
argument|root
argument_list|)
end_macro

begin_decl_stmt
name|QTREE
modifier|*
name|root
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|QTREE
modifier|*
name|t
decl_stmt|;
specifier|register
name|QTREE
modifier|*
name|uop
decl_stmt|;
specifier|extern
name|QTREE
modifier|*
name|treedup
parameter_list|()
function_decl|;
specifier|extern
name|QTREE
modifier|*
name|trimqlend
argument_list|()
decl_stmt|,
modifier|*
name|norml
argument_list|()
decl_stmt|;
comment|/* make duplicate of tree */
name|t
operator|=
name|treedup
argument_list|(
name|root
argument_list|)
expr_stmt|;
comment|/* prepend NOT node to qualification */
name|uop
operator|=
operator|(
name|QTREE
operator|*
operator|)
name|need
argument_list|(
name|Qbuf
argument_list|,
name|QT_HDR_SIZ
operator|+
sizeof|sizeof
argument_list|(
name|short
argument_list|)
argument_list|)
expr_stmt|;
name|uop
operator|->
name|left
operator|=
name|NULL
expr_stmt|;
name|uop
operator|->
name|right
operator|=
name|t
operator|->
name|right
expr_stmt|;
name|uop
operator|->
name|sym
operator|.
name|type
operator|=
name|UOP
expr_stmt|;
name|uop
operator|->
name|sym
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|short
argument_list|)
expr_stmt|;
name|uop
operator|->
name|sym
operator|.
name|value
operator|.
name|sym_op
operator|.
name|opno
operator|=
name|opNOT
expr_stmt|;
name|t
operator|->
name|right
operator|=
name|uop
expr_stmt|;
comment|/* normalize and issue */
name|t
operator|->
name|right
operator|=
name|norml
argument_list|(
name|trimqlend
argument_list|(
name|t
operator|->
name|right
argument_list|)
argument_list|)
expr_stmt|;
name|issue
argument_list|(
name|mdQRY
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

