begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<ingres.h>
end_include

begin_include
include|#
directive|include
file|<access.h>
end_include

begin_include
include|#
directive|include
file|<sccs.h>
end_include

begin_macro
name|SCCSID
argument_list|(
argument|@(#)utility.c
literal|7.1
literal|2
argument|/
literal|5
argument|/
literal|81
argument_list|)
end_macro

begin_expr_stmt
name|dumptid
argument_list|(
name|tid
argument_list|)
specifier|register
name|TID
operator|*
name|tid
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|long
name|pageid
decl_stmt|;
name|pluck_page
argument_list|(
name|tid
argument_list|,
operator|&
name|pageid
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"tid: %ld/%d\n"
argument_list|,
name|pageid
argument_list|,
operator|(
name|tid
operator|->
name|line_id
operator|&
name|I1MASK
operator|)
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* **	struct for extracting page number from a tid **	and storing in a long ** **	We want the line number (lpgx) to be in the low-order part of **	a long.  Since PDP's and VAXes have the order of the half- **	words reversed, this structure must be different. */
end_comment

begin_struct
struct|struct
name|lpage
block|{
ifdef|#
directive|ifdef
name|PDP11
name|char
name|lpg0
decl_stmt|,
name|lpgx
decl_stmt|;
name|char
name|lpg2
decl_stmt|,
name|lpg1
decl_stmt|;
else|#
directive|else
name|char
name|lpg2
decl_stmt|,
name|lpg1
decl_stmt|,
name|lpg0
decl_stmt|,
name|lpgx
decl_stmt|;
endif|#
directive|endif
block|}
struct|;
end_struct

begin_escape
end_escape

begin_comment
comment|/*  PLUCK_PAGE ** **	pluck_page extracts the three byte page_id from a TID **	and puts it into a long variable with proper allignment. */
end_comment

begin_expr_stmt
name|pluck_page
argument_list|(
name|t
argument_list|,
name|var
argument_list|)
specifier|register
name|TID
operator|*
name|t
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|long
modifier|*
name|var
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|lpage
modifier|*
name|v
decl_stmt|;
name|v
operator|=
operator|(
expr|struct
name|lpage
operator|*
operator|)
name|var
expr_stmt|;
name|v
operator|->
name|lpg0
operator|=
name|t
operator|->
name|pg0
expr_stmt|;
name|v
operator|->
name|lpg1
operator|=
name|t
operator|->
name|pg1
expr_stmt|;
name|v
operator|->
name|lpg2
operator|=
name|t
operator|->
name|pg2
expr_stmt|;
name|v
operator|->
name|lpgx
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/*	stuff_page is the reverse of pluck_page	*/
end_comment

begin_expr_stmt
name|stuff_page
argument_list|(
name|t
argument_list|,
name|var
argument_list|)
specifier|register
name|TID
operator|*
name|t
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|long
modifier|*
name|var
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|lpage
modifier|*
name|v
decl_stmt|;
name|v
operator|=
operator|(
expr|struct
name|lpage
operator|*
operator|)
name|var
expr_stmt|;
name|t
operator|->
name|pg0
operator|=
name|v
operator|->
name|lpg0
expr_stmt|;
name|t
operator|->
name|pg1
operator|=
name|v
operator|->
name|lpg1
expr_stmt|;
name|t
operator|->
name|pg2
operator|=
name|v
operator|->
name|lpg2
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

