begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  Copyright 1990 by the Massachusetts Institute of Technology  Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty.  */
end_comment

begin_comment
comment|/* $XConsortium: miscrinit.c,v 5.2 91/05/14 11:17:40 rws Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"servermd.h"
end_include

begin_include
include|#
directive|include
file|"misc.h"
end_include

begin_include
include|#
directive|include
file|"mi.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"mibstore.h"
end_include

begin_include
include|#
directive|include
file|"dix.h"
end_include

begin_include
include|#
directive|include
file|"hppriv.h"
end_include

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|Bool
name|hpCloseScreen
parameter_list|(
name|index
parameter_list|,
name|pScreen
parameter_list|)
name|int
name|index
decl_stmt|;
name|ScreenPtr
name|pScreen
decl_stmt|;
block|{
operator|(
name|void
operator|)
name|xfree
argument_list|(
name|getPrivScreenPtr
argument_list|(
name|pScreen
argument_list|)
operator|->
name|pDrawable
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/*  * If you pass in bsfuncs, then you must preinitialize the missing  * screen procs before calling miScreenInit, so that the backing store  * code can correctly wrap them.  */
end_comment

begin_function
name|Bool
name|hpScreenInit
parameter_list|(
name|pScreen
parameter_list|,
name|pbits
parameter_list|,
name|xsize
parameter_list|,
name|ysize
parameter_list|,
name|dpix
parameter_list|,
name|dpiy
parameter_list|,
comment|/* width, */
name|rootDepth
parameter_list|,
name|numDepths
parameter_list|,
name|depths
parameter_list|,
name|rootVisual
parameter_list|,
name|numVisuals
parameter_list|,
name|visuals
parameter_list|,
name|bsfuncs
parameter_list|)
specifier|register
name|ScreenPtr
name|pScreen
decl_stmt|;
name|pointer
name|pbits
decl_stmt|;
comment|/* pointer to screen bits */
name|int
name|xsize
decl_stmt|,
name|ysize
decl_stmt|;
comment|/* in pixels */
name|int
name|dpix
decl_stmt|,
name|dpiy
decl_stmt|;
comment|/* dots per inch */
if|#
directive|if
literal|0
function|int width;
comment|/* pixel width of frame buffer */
endif|#
directive|endif
name|int
name|rootDepth
decl_stmt|;
comment|/* depth of root window */
name|int
name|numDepths
decl_stmt|;
comment|/* number of depths supported */
name|DepthRec
modifier|*
name|depths
decl_stmt|;
comment|/* supported depths */
name|VisualID
name|rootVisual
decl_stmt|;
comment|/* root visual */
name|int
name|numVisuals
decl_stmt|;
comment|/* number of visuals supported */
name|VisualRec
modifier|*
name|visuals
decl_stmt|;
comment|/* supported visuals */
name|miBSFuncPtr
name|bsfuncs
decl_stmt|;
comment|/* backing store functions */
block|{
name|pScreen
operator|->
name|width
operator|=
name|xsize
expr_stmt|;
name|pScreen
operator|->
name|height
operator|=
name|ysize
expr_stmt|;
name|pScreen
operator|->
name|mmWidth
operator|=
operator|(
name|xsize
operator|*
literal|254
operator|)
operator|/
operator|(
name|dpix
operator|*
literal|10
operator|)
expr_stmt|;
name|pScreen
operator|->
name|mmHeight
operator|=
operator|(
name|ysize
operator|*
literal|254
operator|)
operator|/
operator|(
name|dpiy
operator|*
literal|10
operator|)
expr_stmt|;
name|pScreen
operator|->
name|numDepths
operator|=
name|numDepths
expr_stmt|;
name|pScreen
operator|->
name|rootDepth
operator|=
name|rootDepth
expr_stmt|;
name|pScreen
operator|->
name|allowedDepths
operator|=
name|depths
expr_stmt|;
name|pScreen
operator|->
name|rootVisual
operator|=
name|rootVisual
expr_stmt|;
comment|/* defColormap */
name|pScreen
operator|->
name|minInstalledCmaps
operator|=
literal|1
expr_stmt|;
name|pScreen
operator|->
name|maxInstalledCmaps
operator|=
literal|1
expr_stmt|;
name|pScreen
operator|->
name|backingStoreSupport
operator|=
name|Always
expr_stmt|;
name|pScreen
operator|->
name|saveUnderSupport
operator|=
name|NotUseful
expr_stmt|;
comment|/* whitePixel, blackPixel */
if|#
directive|if
literal|0
block|if (width)
endif|#
directive|endif
block|{
name|PixmapPtr
name|pPixmap
decl_stmt|;
name|hpPrivPixmapPtr
name|pPrivPixmap
decl_stmt|;
name|hpPrivScreenPtr
name|pPrivScreen
decl_stmt|;
name|pPixmap
operator|=
operator|(
name|PixmapPtr
operator|)
name|xalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|PixmapRec
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|hpPrivPixmap
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pPixmap
condition|)
return|return
name|FALSE
return|;
name|pPrivPixmap
operator|=
call|(
name|hpPrivPixmapPtr
call|)
argument_list|(
name|pPixmap
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pPrivScreen
operator|=
name|getPrivScreenPtr
argument_list|(
name|pScreen
argument_list|)
expr_stmt|;
name|pPrivScreen
operator|->
name|bits
operator|=
name|pbits
expr_stmt|;
name|pPrivScreen
operator|->
name|stride
operator|=
name|PixmapBytePad
argument_list|(
name|pPrivScreen
operator|->
name|memWidth
argument_list|,
name|rootDepth
argument_list|)
expr_stmt|;
name|pPrivScreen
operator|->
name|pDrawable
operator|=
operator|(
name|DrawablePtr
operator|)
name|pPixmap
expr_stmt|;
name|pPrivScreen
operator|->
name|isBlank
operator|=
name|FALSE
expr_stmt|;
name|pScreen
operator|->
name|devPrivate
operator|=
operator|(
name|pointer
operator|)
name|pPrivScreen
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|type
operator|=
name|DRAWABLE_PIXMAP
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|depth
operator|=
name|rootDepth
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|bitsPerPixel
operator|=
name|rootDepth
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|pScreen
operator|=
name|pScreen
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|serialNumber
operator|=
literal|0
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|width
operator|=
name|xsize
expr_stmt|;
name|pPixmap
operator|->
name|drawable
operator|.
name|height
operator|=
name|ysize
expr_stmt|;
name|pPixmap
operator|->
name|refcnt
operator|=
literal|1
expr_stmt|;
name|pPixmap
operator|->
name|devPrivate
operator|.
name|ptr
operator|=
operator|(
name|pointer
operator|)
name|pPrivPixmap
expr_stmt|;
name|pPixmap
operator|->
name|devKind
operator|=
name|PIXMAP_FRAME_BUFFER
expr_stmt|;
name|hpBufAllocInit
argument_list|(
name|pScreen
argument_list|,
name|pPrivScreen
operator|->
name|memWidth
argument_list|,
name|pPrivScreen
operator|->
name|memHeight
argument_list|,
name|xsize
argument_list|,
name|ysize
argument_list|)
expr_stmt|;
comment|/* set up for off-screen memory use */
name|pPrivPixmap
operator|->
name|pChunk
operator|=
name|hpBufAlloc
argument_list|(
name|pScreen
argument_list|,
name|xsize
argument_list|,
name|ysize
argument_list|)
expr_stmt|;
name|pPrivPixmap
operator|->
name|bits
operator|=
name|pbits
expr_stmt|;
name|pPrivPixmap
operator|->
name|stride
operator|=
name|pPrivScreen
operator|->
name|stride
expr_stmt|;
ifdef|#
directive|ifdef
name|MITSHM
name|ShmRegisterFbFuncs
argument_list|(
name|pScreen
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
if|#
directive|if
literal|0
block|else 	pScreen->devPrivate = pbits;
endif|#
directive|endif
name|pScreen
operator|->
name|numVisuals
operator|=
name|numVisuals
expr_stmt|;
name|pScreen
operator|->
name|visuals
operator|=
name|visuals
expr_stmt|;
if|#
directive|if
literal|0
block|if (width)
endif|#
directive|endif
name|pScreen
operator|->
name|CloseScreen
operator|=
name|hpCloseScreen
expr_stmt|;
comment|/* else CloseScreen */
comment|/* QueryBestSize, SaveScreen, GetImage, GetSpans */
name|pScreen
operator|->
name|PointerNonInterestBox
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
expr_stmt|;
name|pScreen
operator|->
name|SourceValidate
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
expr_stmt|;
comment|/* CreateWindow, DestroyWindow, PositionWindow, ChangeWindowAttributes */
comment|/* RealizeWindow, UnrealizeWindow */
name|pScreen
operator|->
name|ValidateTree
operator|=
name|miValidateTree
expr_stmt|;
name|pScreen
operator|->
name|PostValidateTree
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
expr_stmt|;
name|pScreen
operator|->
name|WindowExposures
operator|=
name|miWindowExposures
expr_stmt|;
comment|/* PaintWindowBackground, PaintWindowBorder, CopyWindow */
name|pScreen
operator|->
name|ClearToBackground
operator|=
name|miClearToBackground
expr_stmt|;
name|pScreen
operator|->
name|ClipNotify
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|0
expr_stmt|;
comment|/* CreatePixmap, DestroyPixmap */
comment|/* RealizeFont, UnrealizeFont */
comment|/* CreateGC */
comment|/* CreateColormap, DestroyColormap, InstallColormap, UninstallColormap */
comment|/* ListInstalledColormaps, StoreColors, ResolveColor */
name|pScreen
operator|->
name|RegionCreate
operator|=
name|miRegionCreate
expr_stmt|;
name|pScreen
operator|->
name|RegionInit
operator|=
name|miRegionInit
expr_stmt|;
name|pScreen
operator|->
name|RegionCopy
operator|=
name|miRegionCopy
expr_stmt|;
name|pScreen
operator|->
name|RegionDestroy
operator|=
name|miRegionDestroy
expr_stmt|;
name|pScreen
operator|->
name|RegionUninit
operator|=
name|miRegionUninit
expr_stmt|;
name|pScreen
operator|->
name|Intersect
operator|=
name|miIntersect
expr_stmt|;
name|pScreen
operator|->
name|Union
operator|=
name|miUnion
expr_stmt|;
name|pScreen
operator|->
name|Subtract
operator|=
name|miSubtract
expr_stmt|;
name|pScreen
operator|->
name|Inverse
operator|=
name|miInverse
expr_stmt|;
name|pScreen
operator|->
name|RegionReset
operator|=
name|miRegionReset
expr_stmt|;
name|pScreen
operator|->
name|TranslateRegion
operator|=
name|miTranslateRegion
expr_stmt|;
name|pScreen
operator|->
name|RectIn
operator|=
name|miRectIn
expr_stmt|;
name|pScreen
operator|->
name|PointInRegion
operator|=
name|miPointInRegion
expr_stmt|;
name|pScreen
operator|->
name|RegionNotEmpty
operator|=
name|miRegionNotEmpty
expr_stmt|;
name|pScreen
operator|->
name|RegionEmpty
operator|=
name|miRegionEmpty
expr_stmt|;
name|pScreen
operator|->
name|RegionExtents
operator|=
name|miRegionExtents
expr_stmt|;
name|pScreen
operator|->
name|RegionAppend
operator|=
name|miRegionAppend
expr_stmt|;
name|pScreen
operator|->
name|RegionValidate
operator|=
name|miRegionValidate
expr_stmt|;
comment|/* BitmapToRegion */
name|pScreen
operator|->
name|RectsToRegion
operator|=
name|miRectsToRegion
expr_stmt|;
name|pScreen
operator|->
name|SendGraphicsExpose
operator|=
name|miSendGraphicsExpose
expr_stmt|;
name|pScreen
operator|->
name|BlockHandler
operator|=
name|NoopDDA
expr_stmt|;
name|pScreen
operator|->
name|WakeupHandler
operator|=
name|NoopDDA
expr_stmt|;
name|pScreen
operator|->
name|blockData
operator|=
operator|(
name|pointer
operator|)
literal|0
expr_stmt|;
name|pScreen
operator|->
name|wakeupData
operator|=
operator|(
name|pointer
operator|)
literal|0
expr_stmt|;
if|if
condition|(
name|bsfuncs
condition|)
name|miInitializeBackingStore
argument_list|(
name|pScreen
argument_list|,
name|bsfuncs
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

end_unit

