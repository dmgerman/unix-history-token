begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  Copyright (c) 1986, 1987 by Hewlett-Packard Company Copyright (c) 1986, 1987 by the Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  HEWLETT-PACKARD MAKES NO WARRANTY OF ANY KIND WITH REGARD TO THIS SOFWARE, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  PURPOSE.  Hewlett-Packard shall not be liable for errors  contained herein or direct, indirect, special, incidental or  consequential damages in connection with the furnishing,  performance, or use of this material.  This software is not subject to any license of the American Telephone and Telegraph Company or of the Regents of the University of California.  */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"regionstr.h"
end_include

begin_include
include|#
directive|include
file|"../cfb/cfb.h"
end_include

begin_include
include|#
directive|include
file|"topcat.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"mi.h"
end_include

begin_decl_stmt
specifier|extern
name|u_char
name|XHP_NewRule
index|[
literal|16
index|]
index|[
literal|6
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|OUTCODES
parameter_list|(
name|result
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pbox
parameter_list|)
define|\
value|if (x< pbox->x1) \         result |= OUT_LEFT; \     if (y< pbox->y1) \         result |= OUT_ABOVE; \     if (x>= pbox->x2) \         result |= OUT_RIGHT; \     if (y>= pbox->y2) \         result |= OUT_BELOW;
end_define

begin_comment
comment|/********************************************************************  * Routine: topcatZeroLine - draws 0-width lines quickly  *   Most of this code was borrowed (really - I'll give it back!) from  *   mfbline.c  */
end_comment

begin_function
name|void
name|topcatZeroLine
parameter_list|(
name|dst
parameter_list|,
name|pgc
parameter_list|,
name|mode
parameter_list|,
name|nptInit
parameter_list|,
name|pptInit
parameter_list|)
name|DrawablePtr
name|dst
decl_stmt|;
name|GCPtr
name|pgc
decl_stmt|;
name|int
name|mode
decl_stmt|;
name|int
name|nptInit
decl_stmt|;
comment|/* number of points in polyline */
name|DDXPointRec
modifier|*
name|pptInit
decl_stmt|;
comment|/* points in the polyline */
block|{
name|int
name|nboxInit
decl_stmt|;
specifier|register
name|int
name|nbox
decl_stmt|;
name|BoxPtr
name|pboxInit
decl_stmt|;
specifier|register
name|BoxPtr
name|pbox
decl_stmt|;
name|int
name|nptTmp
decl_stmt|;
name|int
name|xorg
decl_stmt|,
name|yorg
decl_stmt|;
name|DDXPointPtr
name|ppt
decl_stmt|;
name|int
name|npt
decl_stmt|;
name|DDXPointRec
name|pt1
decl_stmt|,
name|pt2
decl_stmt|,
name|pt1Orig
decl_stmt|,
name|pt2Orig
decl_stmt|;
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
name|adx
decl_stmt|,
name|ady
decl_stmt|;
name|int
name|signdx
decl_stmt|,
name|signdy
decl_stmt|;
specifier|register
name|int
name|len
decl_stmt|;
name|int
name|du
decl_stmt|,
name|dv
decl_stmt|;
specifier|register
name|int
name|e
decl_stmt|,
name|e1
decl_stmt|,
name|e2
decl_stmt|;
name|int
name|axis
decl_stmt|;
comment|/* major axis of line */
name|int
name|yinc
decl_stmt|;
name|int
name|err
decl_stmt|;
name|unsigned
name|int
name|oc1
decl_stmt|,
name|oc2
decl_stmt|;
name|int
name|clip1
decl_stmt|,
name|clip2
decl_stmt|,
name|clipdx
decl_stmt|,
name|clipdy
decl_stmt|;
name|int
name|clipDone
decl_stmt|;
name|int
name|tmp
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* current point on the line */
name|int
name|i
decl_stmt|;
comment|/* traditional name for loop counter */
name|CARD8
modifier|*
name|pDstBase
decl_stmt|,
modifier|*
name|pPixel
decl_stmt|;
name|unsigned
name|int
name|dstWidth
decl_stmt|;
name|unsigned
name|int
name|fore
init|=
name|pgc
operator|->
name|fgPixel
decl_stmt|;
name|pboxInit
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pgc
operator|->
name|devPriv
operator|)
operator|)
operator|->
name|pCompositeClip
operator|->
name|rects
expr_stmt|;
name|nboxInit
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pgc
operator|->
name|devPriv
operator|)
operator|)
operator|->
name|pCompositeClip
operator|->
name|numRects
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|xorg
operator|=
operator|(
operator|(
name|WindowPtr
operator|)
name|dst
operator|)
operator|->
name|absCorner
operator|.
name|x
expr_stmt|;
name|yorg
operator|=
operator|(
operator|(
name|WindowPtr
operator|)
name|dst
operator|)
operator|->
name|absCorner
operator|.
name|y
expr_stmt|;
name|pDstBase
operator|=
operator|(
name|CARD8
operator|*
operator|)
operator|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
operator|)
operator|->
name|bits
expr_stmt|;
name|dstWidth
operator|=
call|(
name|unsigned
name|int
call|)
argument_list|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
argument_list|)
operator|->
name|stride
expr_stmt|;
block|}
else|else
block|{
name|cfbPrivPixmapPtr
name|pPriv
init|=
call|(
name|cfbPrivPixmapPtr
call|)
argument_list|(
operator|(
name|PixmapPtr
operator|)
name|dst
argument_list|)
operator|->
name|devPrivate
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|PixmapPtr
operator|)
name|dst
operator|)
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
block|{
name|xorg
operator|=
operator|(
operator|(
name|hpChunk
operator|*
operator|)
name|pPriv
operator|->
name|pChunk
operator|)
operator|->
name|x
expr_stmt|;
name|yorg
operator|=
operator|(
operator|(
name|hpChunk
operator|*
operator|)
name|pPriv
operator|->
name|pChunk
operator|)
operator|->
name|y
expr_stmt|;
name|pDstBase
operator|=
operator|(
name|CARD8
operator|*
operator|)
operator|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
operator|)
operator|->
name|bits
expr_stmt|;
name|dstWidth
operator|=
call|(
name|unsigned
name|int
call|)
argument_list|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
argument_list|)
operator|->
name|stride
expr_stmt|;
block|}
else|else
block|{
comment|/* XXX THIS DOESN"T WORK, AND WILL NEVER WORK */
name|xorg
operator|=
literal|0
expr_stmt|;
name|yorg
operator|=
literal|0
expr_stmt|;
name|pDstBase
operator|=
operator|(
name|CARD8
operator|*
operator|)
name|pPriv
operator|->
name|bits
expr_stmt|;
name|dstWidth
operator|=
operator|(
name|unsigned
name|int
operator|)
name|pPriv
operator|->
name|stride
expr_stmt|;
block|}
block|}
name|ppt
operator|=
name|pptInit
expr_stmt|;
name|npt
operator|=
name|nptInit
expr_stmt|;
if|if
condition|(
name|mode
operator|==
name|CoordModeOrigin
condition|)
block|{
if|if
condition|(
name|xorg
operator|||
name|yorg
condition|)
block|{
while|while
condition|(
name|npt
operator|--
condition|)
block|{
name|ppt
operator|->
name|x
operator|+=
name|xorg
expr_stmt|;
name|ppt
operator|++
operator|->
name|y
operator|+=
name|yorg
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|ppt
operator|->
name|x
operator|+=
name|xorg
expr_stmt|;
name|ppt
operator|->
name|y
operator|+=
name|yorg
expr_stmt|;
name|npt
operator|--
expr_stmt|;
while|while
condition|(
name|npt
operator|--
condition|)
block|{
name|ppt
operator|++
expr_stmt|;
name|ppt
operator|->
name|x
operator|+=
operator|(
name|ppt
operator|-
literal|1
operator|)
operator|->
name|x
expr_stmt|;
name|ppt
operator|->
name|y
operator|+=
operator|(
name|ppt
operator|-
literal|1
operator|)
operator|->
name|y
expr_stmt|;
block|}
block|}
name|ppt
operator|=
name|pptInit
expr_stmt|;
name|npt
operator|=
name|nptInit
expr_stmt|;
while|while
condition|(
operator|--
name|npt
condition|)
block|{
name|DDXPointPtr
name|pspan
decl_stmt|;
name|DDXPointPtr
name|pspanInit
decl_stmt|;
name|int
modifier|*
name|pwidth
decl_stmt|;
name|int
modifier|*
name|pwidthInit
decl_stmt|;
name|int
name|width
decl_stmt|;
name|nbox
operator|=
name|nboxInit
expr_stmt|;
name|pbox
operator|=
name|pboxInit
expr_stmt|;
name|pt1
operator|=
operator|*
name|ppt
operator|++
expr_stmt|;
name|pt2
operator|=
operator|*
name|ppt
expr_stmt|;
name|dx
operator|=
name|pt2
operator|.
name|x
operator|-
name|pt1
operator|.
name|x
expr_stmt|;
name|dy
operator|=
name|pt2
operator|.
name|y
operator|-
name|pt1
operator|.
name|y
expr_stmt|;
name|adx
operator|=
name|abs
argument_list|(
name|dx
argument_list|)
expr_stmt|;
name|ady
operator|=
name|abs
argument_list|(
name|dy
argument_list|)
expr_stmt|;
comment|/*  	 * ~jra Hack to go to directly to the block mover 	 */
if|if
condition|(
name|dx
operator|==
literal|0
condition|)
block|{
name|int
name|starty
decl_stmt|;
if|if
condition|(
name|dy
operator|<
literal|0
condition|)
block|{
name|starty
operator|=
name|pt2
operator|.
name|y
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|starty
operator|=
name|pt1
operator|.
name|y
expr_stmt|;
block|}
name|tcPaintBlockClipped
argument_list|(
name|dst
argument_list|,
name|pgc
argument_list|,
name|pt1
operator|.
name|x
argument_list|,
comment|/* x coor */
name|starty
argument_list|,
comment|/* y coor (topmost) */
literal|1
argument_list|,
comment|/* width */
name|ady
comment|/* height */
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|dy
operator|==
literal|0
condition|)
block|{
name|int
name|startx
decl_stmt|;
if|if
condition|(
name|dx
operator|<
literal|0
condition|)
block|{
name|startx
operator|=
name|pt2
operator|.
name|x
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|startx
operator|=
name|pt1
operator|.
name|x
expr_stmt|;
block|}
name|tcPaintBlockClipped
argument_list|(
name|dst
argument_list|,
name|pgc
argument_list|,
name|startx
argument_list|,
comment|/* x coor (leftmost) */
name|pt1
operator|.
name|y
argument_list|,
comment|/* y coor */
name|adx
argument_list|,
comment|/* width */
literal|1
comment|/* height */
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|topcatMaskConfig
argument_list|(
name|dst
operator|->
name|pScreen
argument_list|,
name|pgc
operator|->
name|planemask
argument_list|,
name|pgc
operator|->
name|alu
argument_list|)
expr_stmt|;
name|signdx
operator|=
name|sign
argument_list|(
name|dx
argument_list|)
expr_stmt|;
name|signdy
operator|=
name|sign
argument_list|(
name|dy
argument_list|)
expr_stmt|;
if|if
condition|(
name|adx
operator|>
name|ady
condition|)
block|{
name|axis
operator|=
name|X_AXIS
expr_stmt|;
name|e1
operator|=
name|ady
operator|*
literal|2
expr_stmt|;
name|e2
operator|=
name|e1
operator|-
literal|2
operator|*
name|adx
expr_stmt|;
name|e
operator|=
name|e1
operator|-
name|adx
expr_stmt|;
block|}
else|else
block|{
name|axis
operator|=
name|Y_AXIS
expr_stmt|;
name|e1
operator|=
name|adx
operator|*
literal|2
expr_stmt|;
name|e2
operator|=
name|e1
operator|-
literal|2
operator|*
name|ady
expr_stmt|;
name|e
operator|=
name|e1
operator|-
name|ady
expr_stmt|;
block|}
name|yinc
operator|=
name|signdy
operator|*
name|dstWidth
expr_stmt|;
name|pt1Orig
operator|=
name|pt1
expr_stmt|;
name|pt2Orig
operator|=
name|pt2
expr_stmt|;
while|while
condition|(
name|nbox
operator|--
condition|)
block|{
name|BoxRec
name|box
decl_stmt|;
name|pt1
operator|=
name|pt1Orig
expr_stmt|;
name|pt2
operator|=
name|pt2Orig
expr_stmt|;
name|clipDone
operator|=
literal|0
expr_stmt|;
name|box
operator|.
name|x1
operator|=
name|pbox
operator|->
name|x1
expr_stmt|;
name|box
operator|.
name|y1
operator|=
name|pbox
operator|->
name|y1
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|pbox
operator|->
name|x2
operator|-
literal|1
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|pbox
operator|->
name|y2
operator|-
literal|1
expr_stmt|;
name|clip1
operator|=
literal|0
expr_stmt|;
name|clip2
operator|=
literal|0
expr_stmt|;
name|oc1
operator|=
literal|0
expr_stmt|;
name|oc2
operator|=
literal|0
expr_stmt|;
name|OUTCODES
argument_list|(
name|oc1
argument_list|,
name|pt1
operator|.
name|x
argument_list|,
name|pt1
operator|.
name|y
argument_list|,
name|pbox
argument_list|)
expr_stmt|;
name|OUTCODES
argument_list|(
name|oc2
argument_list|,
name|pt2
operator|.
name|x
argument_list|,
name|pt2
operator|.
name|y
argument_list|,
name|pbox
argument_list|)
expr_stmt|;
if|if
condition|(
name|oc1
operator|&
name|oc2
condition|)
name|clipDone
operator|=
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|oc1
operator||
name|oc2
operator|)
operator|==
literal|0
condition|)
name|clipDone
operator|=
literal|1
expr_stmt|;
else|else
comment|/* have to clip */
name|clipDone
operator|=
name|mfbClipLine
argument_list|(
name|pbox
argument_list|,
name|box
argument_list|,
operator|&
name|pt1Orig
argument_list|,
operator|&
name|pt1
argument_list|,
operator|&
name|pt2
argument_list|,
name|adx
argument_list|,
name|ady
argument_list|,
name|signdx
argument_list|,
name|signdy
argument_list|,
name|axis
argument_list|,
operator|&
name|clip1
argument_list|,
operator|&
name|clip2
argument_list|)
expr_stmt|;
if|if
condition|(
name|clipDone
operator|==
operator|-
literal|1
condition|)
block|{
comment|/* 	     * the line doesn't go through this box 	     */
name|pbox
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
name|len
operator|=
name|abs
argument_list|(
name|pt2
operator|.
name|x
operator|-
name|pt1
operator|.
name|x
argument_list|)
expr_stmt|;
else|else
name|len
operator|=
name|abs
argument_list|(
name|pt2
operator|.
name|y
operator|-
name|pt1
operator|.
name|y
argument_list|)
expr_stmt|;
name|len
operator|+=
operator|(
name|clip2
operator|!=
literal|0
operator|)
expr_stmt|;
comment|/* if end clipped, draw the last point */
if|if
condition|(
name|len
condition|)
block|{
if|if
condition|(
name|clip1
condition|)
block|{
name|clipdx
operator|=
name|abs
argument_list|(
name|pt1
operator|.
name|x
operator|-
name|pt1Orig
operator|.
name|x
argument_list|)
expr_stmt|;
name|clipdy
operator|=
name|abs
argument_list|(
name|pt1
operator|.
name|y
operator|-
name|pt1Orig
operator|.
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
name|err
operator|=
name|e
operator|+
operator|(
operator|(
name|clipdy
operator|*
name|e2
operator|)
operator|+
operator|(
operator|(
name|clipdx
operator|-
name|clipdy
operator|)
operator|*
name|e1
operator|)
operator|)
expr_stmt|;
else|else
name|err
operator|=
name|e
operator|+
operator|(
operator|(
name|clipdx
operator|*
name|e2
operator|)
operator|+
operator|(
operator|(
name|clipdy
operator|-
name|clipdx
operator|)
operator|*
name|e1
operator|)
operator|)
expr_stmt|;
block|}
else|else
name|err
operator|=
name|e
expr_stmt|;
name|pPixel
operator|=
name|pDstBase
operator|+
operator|(
name|pt1
operator|.
name|y
operator|*
name|dstWidth
operator|)
operator|+
name|pt1
operator|.
name|x
expr_stmt|;
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
block|{
if|if
condition|(
name|signdx
operator|>
literal|0
condition|)
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|+=
name|yinc
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
if|if
condition|(
name|err
operator|<=
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|+=
name|yinc
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|--
expr_stmt|;
block|}
block|}
block|}
comment|/* if X_AXIS */
else|else
block|{
if|if
condition|(
name|signdx
operator|>
literal|0
condition|)
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|++
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|+=
name|yinc
expr_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
if|if
condition|(
name|err
operator|<=
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|--
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|+=
name|yinc
expr_stmt|;
block|}
block|}
block|}
comment|/* else Y_AXIS */
block|}
comment|/* if segment is unclipped, skip remaining rectangles */
if|if
condition|(
operator|!
operator|(
name|clip1
operator|||
name|clip2
operator|)
condition|)
break|break;
else|else
name|pbox
operator|++
expr_stmt|;
block|}
block|}
comment|/* while(--npt) */
if|if
condition|(
operator|(
name|pgc
operator|->
name|capStyle
operator|!=
name|CapNotLast
operator|)
operator|&&
operator|(
operator|(
name|ppt
operator|->
name|x
operator|!=
name|pptInit
operator|->
name|x
operator|)
operator|||
operator|(
name|ppt
operator|->
name|y
operator|!=
name|pptInit
operator|->
name|y
operator|)
operator|||
operator|(
name|ppt
operator|==
name|pptInit
operator|+
literal|1
operator|)
operator|)
condition|)
block|{
name|pt1
operator|=
operator|*
name|ppt
expr_stmt|;
name|nbox
operator|=
name|nboxInit
expr_stmt|;
name|pbox
operator|=
name|pboxInit
expr_stmt|;
while|while
condition|(
name|nbox
operator|--
condition|)
block|{
if|if
condition|(
operator|(
name|pt1
operator|.
name|x
operator|>=
name|pbox
operator|->
name|x1
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|y
operator|>=
name|pbox
operator|->
name|y1
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|x
operator|<
name|pbox
operator|->
name|x2
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|y
operator|<
name|pbox
operator|->
name|y2
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pDstBase
operator|+
operator|(
name|pt1
operator|.
name|y
operator|*
name|dstWidth
operator|)
operator|+
name|pt1
operator|.
name|x
expr_stmt|;
name|topcatMaskConfig
argument_list|(
name|dst
operator|->
name|pScreen
argument_list|,
name|pgc
operator|->
name|planemask
argument_list|,
name|pgc
operator|->
name|alu
argument_list|)
expr_stmt|;
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
block|}
name|pbox
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*********************************************************************  * Far from the most space efficient implementation, this is a   * modified duplicate of topcatZeroLine.  It has bits and pieces of  * miDashLine incorporated in it.  */
end_comment

begin_function
name|void
name|topcatZeroDash
parameter_list|(
name|dst
parameter_list|,
name|pgc
parameter_list|,
name|mode
parameter_list|,
name|nptInit
parameter_list|,
name|pptInit
parameter_list|)
name|DrawablePtr
name|dst
decl_stmt|;
name|GCPtr
name|pgc
decl_stmt|;
name|int
name|mode
decl_stmt|;
name|int
name|nptInit
decl_stmt|;
comment|/* number of points in polyline */
name|DDXPointRec
modifier|*
name|pptInit
decl_stmt|;
comment|/* points in the polyline */
block|{
name|int
name|nboxInit
decl_stmt|;
specifier|register
name|int
name|nbox
decl_stmt|;
name|BoxPtr
name|pboxInit
decl_stmt|;
specifier|register
name|BoxPtr
name|pbox
decl_stmt|;
name|int
name|nptTmp
decl_stmt|;
name|int
name|xorg
decl_stmt|,
name|yorg
decl_stmt|;
name|DDXPointPtr
name|ppt
decl_stmt|;
name|int
name|npt
decl_stmt|;
name|DDXPointRec
name|pt1
decl_stmt|,
name|pt2
decl_stmt|,
name|pt1Orig
decl_stmt|,
name|pt2Orig
decl_stmt|;
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
name|adx
decl_stmt|,
name|ady
decl_stmt|;
name|int
name|signdx
decl_stmt|,
name|signdy
decl_stmt|;
specifier|register
name|int
name|len
decl_stmt|;
name|int
name|du
decl_stmt|,
name|dv
decl_stmt|;
specifier|register
name|int
name|e
decl_stmt|,
name|e1
decl_stmt|,
name|e2
decl_stmt|;
name|int
name|axis
decl_stmt|;
comment|/* major axis of line */
name|int
name|yinc
decl_stmt|;
name|int
name|err
decl_stmt|;
name|unsigned
name|int
name|oc1
decl_stmt|,
name|oc2
decl_stmt|;
name|int
name|clip1
decl_stmt|,
name|clip2
decl_stmt|,
name|clipdx
decl_stmt|,
name|clipdy
decl_stmt|;
name|int
name|clipDone
decl_stmt|;
name|int
name|tmp
decl_stmt|;
name|int
name|lenCur
decl_stmt|;
comment|/* number of points used from this dash */
name|int
name|lenMax
decl_stmt|;
comment|/* number of points in this dash */
name|int
name|iDash
init|=
literal|0
decl_stmt|;
comment|/* index of current dash */
name|int
name|which
decl_stmt|;
comment|/* EVEN_DASH or ODD_DASH */
name|int
name|linestyle
init|=
name|pgc
operator|->
name|lineStyle
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pDash
init|=
name|pgc
operator|->
name|dash
decl_stmt|;
name|int
name|nDash
init|=
name|pgc
operator|->
name|numInDashList
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* current point on the line */
name|int
name|i
decl_stmt|;
comment|/* traditional name for loop counter */
name|CARD8
modifier|*
name|pDstBase
decl_stmt|,
modifier|*
name|pPixel
decl_stmt|;
name|unsigned
name|int
name|dstWidth
decl_stmt|;
name|unsigned
name|int
name|fore
init|=
name|pgc
operator|->
name|fgPixel
decl_stmt|;
name|unsigned
name|int
name|back
init|=
name|pgc
operator|->
name|bgPixel
decl_stmt|;
name|pboxInit
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pgc
operator|->
name|devPriv
operator|)
operator|)
operator|->
name|pCompositeClip
operator|->
name|rects
expr_stmt|;
name|nboxInit
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pgc
operator|->
name|devPriv
operator|)
operator|)
operator|->
name|pCompositeClip
operator|->
name|numRects
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|xorg
operator|=
operator|(
operator|(
name|WindowPtr
operator|)
name|dst
operator|)
operator|->
name|absCorner
operator|.
name|x
expr_stmt|;
name|yorg
operator|=
operator|(
operator|(
name|WindowPtr
operator|)
name|dst
operator|)
operator|->
name|absCorner
operator|.
name|y
expr_stmt|;
name|pDstBase
operator|=
operator|(
name|CARD8
operator|*
operator|)
operator|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
operator|)
operator|->
name|bits
expr_stmt|;
name|dstWidth
operator|=
call|(
name|unsigned
name|int
call|)
argument_list|(
call|(
name|cfbPrivScreenPtr
call|)
argument_list|(
name|dst
operator|->
name|pScreen
operator|->
name|devPrivate
argument_list|)
argument_list|)
operator|->
name|stride
expr_stmt|;
block|}
else|else
block|{
name|xorg
operator|=
literal|0
expr_stmt|;
name|yorg
operator|=
literal|0
expr_stmt|;
name|pDstBase
operator|=
operator|(
name|CARD8
operator|*
operator|)
operator|(
operator|(
call|(
name|cfbPrivPixmapPtr
call|)
argument_list|(
operator|(
operator|(
name|PixmapPtr
operator|)
name|dst
operator|)
operator|->
name|devPrivate
argument_list|)
operator|)
operator|->
name|bits
operator|)
expr_stmt|;
name|dstWidth
operator|=
call|(
name|unsigned
name|int
call|)
argument_list|(
operator|(
call|(
name|cfbPrivPixmapPtr
call|)
argument_list|(
operator|(
operator|(
name|PixmapPtr
operator|)
name|dst
operator|)
operator|->
name|devPrivate
argument_list|)
operator|)
operator|->
name|stride
argument_list|)
expr_stmt|;
block|}
name|ppt
operator|=
name|pptInit
expr_stmt|;
name|npt
operator|=
name|nptInit
expr_stmt|;
if|if
condition|(
name|mode
operator|==
name|CoordModeOrigin
condition|)
block|{
if|if
condition|(
name|xorg
operator|||
name|yorg
condition|)
block|{
while|while
condition|(
name|npt
operator|--
condition|)
block|{
name|ppt
operator|->
name|x
operator|+=
name|xorg
expr_stmt|;
name|ppt
operator|++
operator|->
name|y
operator|+=
name|yorg
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|ppt
operator|->
name|x
operator|+=
name|xorg
expr_stmt|;
name|ppt
operator|->
name|y
operator|+=
name|yorg
expr_stmt|;
name|npt
operator|--
expr_stmt|;
while|while
condition|(
name|npt
operator|--
condition|)
block|{
name|ppt
operator|++
expr_stmt|;
name|ppt
operator|->
name|x
operator|+=
operator|(
name|ppt
operator|-
literal|1
operator|)
operator|->
name|x
expr_stmt|;
name|ppt
operator|->
name|y
operator|+=
operator|(
name|ppt
operator|-
literal|1
operator|)
operator|->
name|y
expr_stmt|;
block|}
block|}
name|ppt
operator|=
name|pptInit
expr_stmt|;
name|npt
operator|=
name|nptInit
expr_stmt|;
name|lenCur
operator|=
name|pgc
operator|->
name|dashOffset
expr_stmt|;
name|which
operator|=
name|EVEN_DASH
expr_stmt|;
while|while
condition|(
name|lenCur
operator|>
name|pDash
index|[
name|iDash
index|]
condition|)
block|{
name|lenCur
operator|-=
name|pDash
index|[
name|iDash
index|]
expr_stmt|;
name|iDash
operator|++
expr_stmt|;
if|if
condition|(
name|iDash
operator|>=
name|nDash
condition|)
name|iDash
operator|=
literal|0
expr_stmt|;
name|which
operator|=
operator|~
name|which
expr_stmt|;
block|}
name|lenMax
operator|=
name|pDash
index|[
name|iDash
index|]
expr_stmt|;
name|topcatMaskConfig
argument_list|(
name|dst
operator|->
name|pScreen
argument_list|,
name|pgc
operator|->
name|planemask
argument_list|,
name|pgc
operator|->
name|alu
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|npt
condition|)
block|{
name|DDXPointPtr
name|pspan
decl_stmt|;
name|DDXPointPtr
name|pspanInit
decl_stmt|;
name|int
modifier|*
name|pwidth
decl_stmt|;
name|int
modifier|*
name|pwidthInit
decl_stmt|;
name|int
name|width
decl_stmt|;
name|int
name|totalLength
decl_stmt|;
name|nbox
operator|=
name|nboxInit
expr_stmt|;
name|pbox
operator|=
name|pboxInit
expr_stmt|;
name|pt1
operator|=
operator|*
name|ppt
operator|++
expr_stmt|;
name|pt2
operator|=
operator|*
name|ppt
expr_stmt|;
name|dx
operator|=
name|pt2
operator|.
name|x
operator|-
name|pt1
operator|.
name|x
expr_stmt|;
name|dy
operator|=
name|pt2
operator|.
name|y
operator|-
name|pt1
operator|.
name|y
expr_stmt|;
name|adx
operator|=
name|abs
argument_list|(
name|dx
argument_list|)
expr_stmt|;
name|ady
operator|=
name|abs
argument_list|(
name|dy
argument_list|)
expr_stmt|;
name|signdx
operator|=
name|sign
argument_list|(
name|dx
argument_list|)
expr_stmt|;
name|signdy
operator|=
name|sign
argument_list|(
name|dy
argument_list|)
expr_stmt|;
if|if
condition|(
name|adx
operator|>
name|ady
condition|)
block|{
name|axis
operator|=
name|X_AXIS
expr_stmt|;
name|e1
operator|=
name|ady
operator|*
literal|2
expr_stmt|;
name|e2
operator|=
name|e1
operator|-
literal|2
operator|*
name|adx
expr_stmt|;
name|e
operator|=
name|e1
operator|-
name|adx
expr_stmt|;
name|totalLength
operator|=
name|adx
expr_stmt|;
block|}
else|else
block|{
name|axis
operator|=
name|Y_AXIS
expr_stmt|;
name|e1
operator|=
name|adx
operator|*
literal|2
expr_stmt|;
name|e2
operator|=
name|e1
operator|-
literal|2
operator|*
name|ady
expr_stmt|;
name|e
operator|=
name|e1
operator|-
name|ady
expr_stmt|;
name|totalLength
operator|=
name|ady
expr_stmt|;
block|}
name|yinc
operator|=
name|signdy
operator|*
name|dstWidth
expr_stmt|;
name|pt1Orig
operator|=
name|pt1
expr_stmt|;
name|pt2Orig
operator|=
name|pt2
expr_stmt|;
while|while
condition|(
name|nbox
operator|--
condition|)
block|{
name|BoxRec
name|box
decl_stmt|;
name|int
name|tmpLenCur
init|=
name|lenCur
decl_stmt|;
name|int
name|tmpLenMax
init|=
name|lenMax
decl_stmt|;
name|int
name|tmpiDash
init|=
name|iDash
decl_stmt|;
name|int
name|tmpWhich
init|=
name|which
decl_stmt|;
name|int
name|clippedDashes
decl_stmt|;
name|pt1
operator|=
name|pt1Orig
expr_stmt|;
name|pt2
operator|=
name|pt2Orig
expr_stmt|;
name|clipDone
operator|=
literal|0
expr_stmt|;
name|box
operator|.
name|x1
operator|=
name|pbox
operator|->
name|x1
expr_stmt|;
name|box
operator|.
name|y1
operator|=
name|pbox
operator|->
name|y1
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|pbox
operator|->
name|x2
operator|-
literal|1
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|pbox
operator|->
name|y2
operator|-
literal|1
expr_stmt|;
name|clip1
operator|=
literal|0
expr_stmt|;
name|clip2
operator|=
literal|0
expr_stmt|;
name|oc1
operator|=
literal|0
expr_stmt|;
name|oc2
operator|=
literal|0
expr_stmt|;
name|OUTCODES
argument_list|(
name|oc1
argument_list|,
name|pt1
operator|.
name|x
argument_list|,
name|pt1
operator|.
name|y
argument_list|,
name|pbox
argument_list|)
expr_stmt|;
name|OUTCODES
argument_list|(
name|oc2
argument_list|,
name|pt2
operator|.
name|x
argument_list|,
name|pt2
operator|.
name|y
argument_list|,
name|pbox
argument_list|)
expr_stmt|;
if|if
condition|(
name|oc1
operator|&
name|oc2
condition|)
name|clipDone
operator|=
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|oc1
operator||
name|oc2
operator|)
operator|==
literal|0
condition|)
name|clipDone
operator|=
literal|1
expr_stmt|;
else|else
comment|/* have to clip */
name|clipDone
operator|=
name|mfbClipLine
argument_list|(
name|pbox
argument_list|,
name|box
argument_list|,
operator|&
name|pt1Orig
argument_list|,
operator|&
name|pt1
argument_list|,
operator|&
name|pt2
argument_list|,
name|adx
argument_list|,
name|ady
argument_list|,
name|signdx
argument_list|,
name|signdy
argument_list|,
name|axis
argument_list|,
operator|&
name|clip1
argument_list|,
operator|&
name|clip2
argument_list|)
expr_stmt|;
if|if
condition|(
name|clipDone
operator|==
operator|-
literal|1
condition|)
block|{
comment|/* 	     * the line doesn't go through this box 	     */
name|pbox
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
name|len
operator|=
name|abs
argument_list|(
name|pt2
operator|.
name|x
operator|-
name|pt1
operator|.
name|x
argument_list|)
expr_stmt|;
else|else
name|len
operator|=
name|abs
argument_list|(
name|pt2
operator|.
name|y
operator|-
name|pt1
operator|.
name|y
argument_list|)
expr_stmt|;
name|len
operator|+=
operator|(
name|clip2
operator|!=
literal|0
operator|)
expr_stmt|;
comment|/* if end clipped, draw the last point */
if|if
condition|(
name|len
condition|)
block|{
if|if
condition|(
name|clip1
condition|)
block|{
name|clipdx
operator|=
name|abs
argument_list|(
name|pt1
operator|.
name|x
operator|-
name|pt1Orig
operator|.
name|x
argument_list|)
expr_stmt|;
name|clipdy
operator|=
name|abs
argument_list|(
name|pt1
operator|.
name|y
operator|-
name|pt1Orig
operator|.
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
block|{
name|clippedDashes
operator|=
name|clipdx
expr_stmt|;
name|err
operator|=
name|e
operator|+
operator|(
operator|(
name|clipdy
operator|*
name|e2
operator|)
operator|+
operator|(
operator|(
name|clipdx
operator|-
name|clipdy
operator|)
operator|*
name|e1
operator|)
operator|)
expr_stmt|;
block|}
else|else
block|{
name|clippedDashes
operator|=
name|clipdy
expr_stmt|;
name|err
operator|=
name|e
operator|+
operator|(
operator|(
name|clipdx
operator|*
name|e2
operator|)
operator|+
operator|(
operator|(
name|clipdy
operator|-
name|clipdx
operator|)
operator|*
name|e1
operator|)
operator|)
expr_stmt|;
block|}
while|while
condition|(
name|clippedDashes
operator|>=
operator|(
name|tmpLenMax
operator|-
name|tmpLenCur
operator|)
condition|)
block|{
name|clippedDashes
operator|-=
name|tmpLenMax
operator|-
name|tmpLenCur
expr_stmt|;
if|if
condition|(
operator|++
name|tmpiDash
operator|>=
name|nDash
condition|)
name|tmpiDash
operator|=
literal|0
expr_stmt|;
name|tmpLenMax
operator|=
name|pDash
index|[
name|tmpiDash
index|]
expr_stmt|;
name|tmpLenCur
operator|=
literal|0
expr_stmt|;
name|tmpWhich
operator|=
operator|~
name|tmpWhich
expr_stmt|;
block|}
name|tmpLenCur
operator|=
name|clippedDashes
expr_stmt|;
block|}
else|else
name|err
operator|=
name|e
expr_stmt|;
name|pPixel
operator|=
name|pDstBase
operator|+
operator|(
name|pt1
operator|.
name|y
operator|*
name|dstWidth
operator|)
operator|+
name|pt1
operator|.
name|x
expr_stmt|;
if|if
condition|(
name|axis
operator|==
name|X_AXIS
condition|)
block|{
if|if
condition|(
name|signdx
operator|>
literal|0
condition|)
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
if|if
condition|(
name|tmpWhich
operator|==
name|EVEN_DASH
condition|)
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
elseif|else
if|if
condition|(
name|linestyle
operator|==
name|LineDoubleDash
condition|)
operator|*
name|pPixel
operator|=
name|back
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|+=
name|yinc
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|++
expr_stmt|;
if|if
condition|(
operator|++
name|tmpLenCur
operator|>=
name|tmpLenMax
condition|)
block|{
if|if
condition|(
operator|++
name|tmpiDash
operator|>=
name|nDash
condition|)
name|tmpiDash
operator|=
literal|0
expr_stmt|;
name|tmpLenMax
operator|=
name|pDash
index|[
name|tmpiDash
index|]
expr_stmt|;
name|tmpLenCur
operator|=
literal|0
expr_stmt|;
name|tmpWhich
operator|=
operator|~
name|tmpWhich
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
if|if
condition|(
name|tmpWhich
operator|==
name|EVEN_DASH
condition|)
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
elseif|else
if|if
condition|(
name|linestyle
operator|==
name|LineDoubleDash
condition|)
operator|*
name|pPixel
operator|=
name|back
expr_stmt|;
if|if
condition|(
name|err
operator|<=
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|+=
name|yinc
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|--
expr_stmt|;
if|if
condition|(
operator|++
name|tmpLenCur
operator|>=
name|tmpLenMax
condition|)
block|{
if|if
condition|(
operator|++
name|tmpiDash
operator|>=
name|nDash
condition|)
name|tmpiDash
operator|=
literal|0
expr_stmt|;
name|tmpLenMax
operator|=
name|pDash
index|[
name|tmpiDash
index|]
expr_stmt|;
name|tmpLenCur
operator|=
literal|0
expr_stmt|;
name|tmpWhich
operator|=
operator|~
name|tmpWhich
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/* if X_AXIS */
else|else
block|{
if|if
condition|(
name|signdx
operator|>
literal|0
condition|)
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
if|if
condition|(
name|tmpWhich
operator|==
name|EVEN_DASH
condition|)
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
elseif|else
if|if
condition|(
name|linestyle
operator|==
name|LineDoubleDash
condition|)
operator|*
name|pPixel
operator|=
name|back
expr_stmt|;
if|if
condition|(
name|err
operator|<
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|++
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|+=
name|yinc
expr_stmt|;
if|if
condition|(
operator|++
name|tmpLenCur
operator|>=
name|tmpLenMax
condition|)
block|{
if|if
condition|(
operator|++
name|tmpiDash
operator|>=
name|nDash
condition|)
name|tmpiDash
operator|=
literal|0
expr_stmt|;
name|tmpLenMax
operator|=
name|pDash
index|[
name|tmpiDash
index|]
expr_stmt|;
name|tmpLenCur
operator|=
literal|0
expr_stmt|;
name|tmpWhich
operator|=
operator|~
name|tmpWhich
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
while|while
condition|(
name|len
operator|--
condition|)
block|{
if|if
condition|(
name|tmpWhich
operator|==
name|EVEN_DASH
condition|)
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
elseif|else
if|if
condition|(
name|linestyle
operator|==
name|LineDoubleDash
condition|)
operator|*
name|pPixel
operator|=
name|back
expr_stmt|;
if|if
condition|(
name|err
operator|<=
literal|0
condition|)
name|err
operator|+=
name|e1
expr_stmt|;
else|else
block|{
name|pPixel
operator|--
expr_stmt|;
name|err
operator|+=
name|e2
expr_stmt|;
block|}
name|pPixel
operator|+=
name|yinc
expr_stmt|;
if|if
condition|(
operator|++
name|tmpLenCur
operator|>=
name|tmpLenMax
condition|)
block|{
if|if
condition|(
operator|++
name|tmpiDash
operator|>=
name|nDash
condition|)
name|tmpiDash
operator|=
literal|0
expr_stmt|;
name|tmpLenMax
operator|=
name|pDash
index|[
name|tmpiDash
index|]
expr_stmt|;
name|tmpLenCur
operator|=
literal|0
expr_stmt|;
name|tmpWhich
operator|=
operator|~
name|tmpWhich
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/* else Y_AXIS */
block|}
comment|/* if segment is unclipped, skip remaining rectangles */
if|if
condition|(
operator|!
operator|(
name|clip1
operator|||
name|clip2
operator|)
condition|)
break|break;
else|else
name|pbox
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|totalLength
operator|>=
name|lenCur
condition|)
block|{
name|totalLength
operator|-=
name|lenCur
expr_stmt|;
if|if
condition|(
operator|++
name|iDash
operator|>=
name|nDash
condition|)
name|iDash
operator|=
literal|0
expr_stmt|;
name|lenCur
operator|=
name|pDash
index|[
name|iDash
index|]
expr_stmt|;
name|which
operator|=
operator|~
name|which
expr_stmt|;
block|}
name|lenCur
operator|-=
name|totalLength
expr_stmt|;
block|}
comment|/* while(--npt) */
if|if
condition|(
operator|(
name|pgc
operator|->
name|capStyle
operator|!=
name|CapNotLast
operator|)
operator|&&
operator|(
operator|(
name|ppt
operator|->
name|x
operator|!=
name|pptInit
operator|->
name|x
operator|)
operator|||
operator|(
name|ppt
operator|->
name|y
operator|!=
name|pptInit
operator|->
name|y
operator|)
operator|)
condition|)
block|{
name|pt1
operator|=
operator|*
name|ppt
expr_stmt|;
name|nbox
operator|=
name|nboxInit
expr_stmt|;
name|pbox
operator|=
name|pboxInit
expr_stmt|;
while|while
condition|(
name|nbox
operator|--
condition|)
block|{
if|if
condition|(
operator|(
name|pt1
operator|.
name|x
operator|>=
name|pbox
operator|->
name|x1
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|y
operator|>=
name|pbox
operator|->
name|y1
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|x
operator|<
name|pbox
operator|->
name|x2
operator|)
operator|&&
operator|(
name|pt1
operator|.
name|y
operator|<
name|pbox
operator|->
name|y2
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pDstBase
operator|+
operator|(
name|pt1
operator|.
name|y
operator|*
name|dstWidth
operator|)
operator|+
name|pt1
operator|.
name|x
expr_stmt|;
name|waitbusy
argument_list|(
name|getPlanesMask
argument_list|(
name|dst
operator|->
name|pScreen
argument_list|)
argument_list|,
name|getTcHardware
argument_list|(
name|dst
operator|->
name|pScreen
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|which
operator|==
name|EVEN_DASH
condition|)
operator|*
name|pPixel
operator|=
name|fore
expr_stmt|;
elseif|else
if|if
condition|(
name|linestyle
operator|==
name|LineDoubleDash
condition|)
operator|*
name|pPixel
operator|=
name|back
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

end_unit

