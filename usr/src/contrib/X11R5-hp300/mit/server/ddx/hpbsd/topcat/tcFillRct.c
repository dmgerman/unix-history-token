begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xmd.h"
end_include

begin_include
include|#
directive|include
file|"servermd.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"window.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"../cfb/cfb.h"
end_include

begin_include
include|#
directive|include
file|"../cfb/cfbmskbits.h"
end_include

begin_include
include|#
directive|include
file|"topcat.h"
end_include

begin_if
if|#
directive|if
name|PPW
operator|==
literal|4
end_if

begin_function_decl
specifier|extern
name|void
name|cfb8FillRectOpaqueStippled32
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|cfb8FillRectTransparentStippled32
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|cfb8FillRectStippledUnnatural
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|void
name|cfbFillRectSolidCopy
argument_list|()
decl_stmt|,
name|cfbFillRectSolidXor
argument_list|()
decl_stmt|,
name|cfbFillRectSolidGeneral
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|cfbFillRectTile32Copy
argument_list|()
decl_stmt|,
name|cfbFillRectTile32General
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|void
name|cfbFillRectTileOdd
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|unsigned
name|char
name|XHP_NewRule
index|[
literal|16
index|]
index|[
literal|6
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|PIXER
parameter_list|(
name|Drawable
parameter_list|)
value|((hpPrivPixmapPtr)((PixmapPtr)Drawable)->devPrivate.ptr)
end_define

begin_comment
comment|/*  * tcFillBoxSolid - solid fill a rectangle in Screen Memory  */
end_comment

begin_function
name|void
name|tcFillBoxSolid
parameter_list|(
name|pDrawable
parameter_list|,
name|nBox
parameter_list|,
name|pBox
parameter_list|,
name|pixel
parameter_list|,
name|isCopy
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|int
name|nBox
decl_stmt|;
name|BoxPtr
name|pBox
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
name|Bool
name|isCopy
decl_stmt|;
block|{
name|TOPCAT
modifier|*
name|hardware
init|=
name|getTcHardware
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
decl_stmt|;
name|int
name|zmask
decl_stmt|;
comment|/* plane mask - set to all planes */
name|int
name|XHP_bits
init|=
name|hardware
operator|->
name|bits
decl_stmt|;
comment|/* 1 if low-res topcat else 0 */
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|h
decl_stmt|,
name|w
decl_stmt|;
if|if
condition|(
name|pDrawable
operator|->
name|type
operator|==
name|DRAWABLE_PIXMAP
condition|)
comment|/* offscreen pixmap */
block|{
name|xoff
operator|=
name|PIXER
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|pChunk
operator|->
name|x
expr_stmt|;
name|yoff
operator|=
name|PIXER
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|pChunk
operator|->
name|y
expr_stmt|;
block|}
else|else
block|{
name|xoff
operator|=
literal|0
expr_stmt|;
name|yoff
operator|=
literal|0
expr_stmt|;
block|}
name|zmask
operator|=
name|getPlanesMask
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
expr_stmt|;
while|while
condition|(
name|nBox
operator|--
condition|)
block|{
name|x
operator|=
name|pBox
operator|->
name|x1
operator|+
name|xoff
expr_stmt|;
name|y
operator|=
name|pBox
operator|->
name|y1
operator|+
name|yoff
expr_stmt|;
name|w
operator|=
name|pBox
operator|->
name|x2
operator|-
name|pBox
operator|->
name|x1
expr_stmt|;
name|h
operator|=
name|pBox
operator|->
name|y2
operator|-
name|pBox
operator|->
name|y1
expr_stmt|;
if|if
condition|(
name|w
operator|>
literal|0
operator|&&
name|h
operator|>
literal|0
condition|)
block|{
name|waitbusy
argument_list|(
name|zmask
argument_list|,
name|hardware
argument_list|)
expr_stmt|;
if|if
condition|(
name|isCopy
condition|)
block|{
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXcopy
index|]
index|[
literal|3
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
operator|~
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXcopy
index|]
index|[
literal|0
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
expr_stmt|;
name|hardware
operator|->
name|pixel_write_replacement_rule
operator|=
name|GXcopy
expr_stmt|;
block|}
else|else
block|{
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXxor
index|]
index|[
literal|3
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
operator|~
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXxor
index|]
index|[
literal|0
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
expr_stmt|;
name|hardware
operator|->
name|pixel_write_replacement_rule
operator|=
name|GXxor
expr_stmt|;
block|}
name|hardware
operator|->
name|source_x
operator|=
name|x
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|source_y
operator|=
name|y
expr_stmt|;
name|hardware
operator|->
name|dest_x
operator|=
name|x
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|dest_y
operator|=
name|y
expr_stmt|;
name|hardware
operator|->
name|window_width
operator|=
name|w
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|window_height
operator|=
name|h
expr_stmt|;
name|hardware
operator|->
name|start_move
operator|=
name|zmask
expr_stmt|;
block|}
name|pBox
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * tcFillRectSolid - solid fill a rectangle in Screen Memory  */
end_comment

begin_function
name|void
name|tcFillRectSolid
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|nBox
parameter_list|,
name|pBox
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|nBox
decl_stmt|;
name|BoxPtr
name|pBox
decl_stmt|;
block|{
name|TOPCAT
modifier|*
name|hardware
init|=
name|getTcHardware
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
decl_stmt|;
name|int
name|zmask
decl_stmt|;
comment|/* plane mask - set to all planes */
name|int
name|XHP_bits
init|=
name|hardware
operator|->
name|bits
decl_stmt|;
comment|/* 1 if low-res topcat else 0 */
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|h
decl_stmt|,
name|w
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
name|pixel
operator|=
operator|(
name|pGC
operator|->
name|alu
operator|==
name|GXinvert
operator|)
condition|?
name|pGC
operator|->
name|planemask
else|:
name|pGC
operator|->
name|fgPixel
expr_stmt|;
if|if
condition|(
name|pDrawable
operator|->
name|type
operator|==
name|DRAWABLE_PIXMAP
condition|)
comment|/* offscreen pixmap */
block|{
name|xoff
operator|=
name|PIXER
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|pChunk
operator|->
name|x
expr_stmt|;
name|yoff
operator|=
name|PIXER
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|pChunk
operator|->
name|y
expr_stmt|;
block|}
else|else
block|{
name|xoff
operator|=
literal|0
expr_stmt|;
name|yoff
operator|=
literal|0
expr_stmt|;
block|}
name|zmask
operator|=
name|getPlanesMask
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
expr_stmt|;
while|while
condition|(
name|nBox
operator|--
condition|)
block|{
name|x
operator|=
name|pBox
operator|->
name|x1
operator|+
name|xoff
expr_stmt|;
name|y
operator|=
name|pBox
operator|->
name|y1
operator|+
name|yoff
expr_stmt|;
name|w
operator|=
name|pBox
operator|->
name|x2
operator|-
name|pBox
operator|->
name|x1
expr_stmt|;
name|h
operator|=
name|pBox
operator|->
name|y2
operator|-
name|pBox
operator|->
name|y1
expr_stmt|;
if|if
condition|(
name|w
operator|>
literal|0
operator|&&
name|h
operator|>
literal|0
condition|)
block|{
name|waitbusy
argument_list|(
name|zmask
argument_list|,
name|hardware
argument_list|)
expr_stmt|;
if|if
condition|(
name|pGC
operator|->
name|alu
operator|==
name|GXcopy
condition|)
block|{
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXcopy
index|]
index|[
literal|3
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
operator|~
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXcopy
index|]
index|[
literal|0
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
expr_stmt|;
name|hardware
operator|->
name|pixel_write_replacement_rule
operator|=
name|GXcopy
expr_stmt|;
block|}
else|else
block|{
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXxor
index|]
index|[
literal|3
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
operator|&
operator|~
name|pixel
expr_stmt|;
name|hardware
operator|->
name|window_move_replacement_rule
operator|=
name|XHP_NewRule
index|[
name|GXxor
index|]
index|[
literal|0
index|]
expr_stmt|;
name|hardware
operator|->
name|write_enable
operator|=
name|zmask
expr_stmt|;
name|hardware
operator|->
name|pixel_write_replacement_rule
operator|=
name|GXxor
expr_stmt|;
block|}
name|hardware
operator|->
name|source_x
operator|=
name|x
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|source_y
operator|=
name|y
expr_stmt|;
name|hardware
operator|->
name|dest_x
operator|=
name|x
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|dest_y
operator|=
name|y
expr_stmt|;
name|hardware
operator|->
name|window_width
operator|=
name|w
operator|<<
name|XHP_bits
expr_stmt|;
name|hardware
operator|->
name|window_height
operator|=
name|h
expr_stmt|;
name|hardware
operator|->
name|start_move
operator|=
name|zmask
expr_stmt|;
block|}
name|pBox
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|tcFillRectTile
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|nBox
parameter_list|,
name|pBox
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|nBox
decl_stmt|;
name|BoxPtr
name|pBox
decl_stmt|;
block|{
name|int
name|xrot
decl_stmt|,
name|yrot
decl_stmt|;
name|PixmapPtr
name|pTile
decl_stmt|;
name|pTile
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|pRotatedPixmap
expr_stmt|;
if|if
condition|(
operator|!
name|pTile
condition|)
block|{
name|pTile
operator|=
name|pGC
operator|->
name|tile
operator|.
name|pixmap
expr_stmt|;
name|xrot
operator|=
name|pDrawable
operator|->
name|x
operator|+
name|pGC
operator|->
name|patOrg
operator|.
name|x
expr_stmt|;
name|yrot
operator|=
name|pDrawable
operator|->
name|y
operator|+
name|pGC
operator|->
name|patOrg
operator|.
name|y
expr_stmt|;
block|}
else|else
block|{
name|xrot
operator|=
literal|0
expr_stmt|;
name|yrot
operator|=
literal|0
expr_stmt|;
block|}
name|tcFillBoxTile
argument_list|(
name|pDrawable
argument_list|,
name|nBox
argument_list|,
name|pBox
argument_list|,
name|pTile
argument_list|,
name|xrot
argument_list|,
name|yrot
argument_list|,
name|pGC
operator|->
name|alu
argument_list|,
name|pGC
operator|->
name|planemask
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|NUM_STACK_RECTS
value|1024
end_define

begin_function
name|void
name|tcPolyFillRect
parameter_list|(
name|pDrawable
parameter_list|,
name|pGC
parameter_list|,
name|nrectFill
parameter_list|,
name|prectInit
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
specifier|register
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|nrectFill
decl_stmt|;
comment|/* number of rectangles to fill */
name|xRectangle
modifier|*
name|prectInit
decl_stmt|;
comment|/* Pointer to first rectangle to fill */
block|{
name|xRectangle
modifier|*
name|prect
decl_stmt|;
name|RegionPtr
name|prgnClip
decl_stmt|;
specifier|register
name|BoxPtr
name|pbox
decl_stmt|;
specifier|register
name|BoxPtr
name|pboxClipped
decl_stmt|;
name|BoxPtr
name|pboxClippedBase
decl_stmt|;
name|BoxPtr
name|pextent
decl_stmt|;
name|BoxRec
name|stackRects
index|[
name|NUM_STACK_RECTS
index|]
decl_stmt|;
name|cfbPrivGC
modifier|*
name|priv
decl_stmt|;
name|int
name|numRects
decl_stmt|;
name|void
function_decl|(
modifier|*
name|BoxFill
function_decl|)
parameter_list|()
function_decl|;
name|int
name|n
decl_stmt|;
name|int
name|xorg
decl_stmt|,
name|yorg
decl_stmt|;
name|int
name|onScreen
decl_stmt|;
name|priv
operator|=
operator|(
name|cfbPrivGC
operator|*
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
expr_stmt|;
name|prgnClip
operator|=
name|priv
operator|->
name|pCompositeClip
expr_stmt|;
name|onScreen
operator|=
operator|(
name|pDrawable
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
operator|||
operator|(
operator|(
name|PixmapPtr
operator|)
name|pDrawable
operator|)
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
operator|)
expr_stmt|;
name|BoxFill
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|pGC
operator|->
name|fillStyle
condition|)
block|{
case|case
name|FillSolid
case|:
if|if
condition|(
name|onScreen
condition|)
name|BoxFill
operator|=
name|tcFillRectSolid
expr_stmt|;
else|else
switch|switch
condition|(
name|priv
operator|->
name|rop
condition|)
block|{
case|case
name|GXcopy
case|:
name|BoxFill
operator|=
name|cfbFillRectSolidCopy
expr_stmt|;
break|break;
case|case
name|GXxor
case|:
name|BoxFill
operator|=
name|cfbFillRectSolidXor
expr_stmt|;
break|break;
default|default:
name|BoxFill
operator|=
name|cfbFillRectSolidGeneral
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|FillTiled
case|:
if|if
condition|(
operator|!
operator|(
operator|(
name|cfbPrivGCPtr
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|pRotatedPixmap
condition|)
block|{
if|if
condition|(
name|onScreen
operator|&&
name|pGC
operator|->
name|tile
operator|.
name|pixmap
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
name|BoxFill
operator|=
name|tcFillRectTile
expr_stmt|;
else|else
name|BoxFill
operator|=
name|cfbFillRectTileOdd
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|onScreen
operator|&&
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|pRotatedPixmap
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
name|BoxFill
operator|=
name|tcFillRectTile
expr_stmt|;
elseif|else
if|if
condition|(
name|pGC
operator|->
name|alu
operator|==
name|GXcopy
operator|&&
operator|(
name|pGC
operator|->
name|planemask
operator|&
name|PMSK
operator|)
operator|==
name|PMSK
condition|)
name|BoxFill
operator|=
name|cfbFillRectTile32Copy
expr_stmt|;
else|else
name|BoxFill
operator|=
name|cfbFillRectTile32General
expr_stmt|;
block|}
break|break;
if|#
directive|if
operator|(
name|PPW
operator|==
literal|4
operator|)
case|case
name|FillStippled
case|:
if|if
condition|(
operator|!
operator|(
operator|(
name|cfbPrivGCPtr
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|pRotatedPixmap
condition|)
name|BoxFill
operator|=
name|cfb8FillRectStippledUnnatural
expr_stmt|;
else|else
name|BoxFill
operator|=
name|cfb8FillRectTransparentStippled32
expr_stmt|;
break|break;
case|case
name|FillOpaqueStippled
case|:
if|if
condition|(
operator|!
operator|(
operator|(
name|cfbPrivGCPtr
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|->
name|pRotatedPixmap
condition|)
name|BoxFill
operator|=
name|cfb8FillRectStippledUnnatural
expr_stmt|;
else|else
name|BoxFill
operator|=
name|cfb8FillRectOpaqueStippled32
expr_stmt|;
break|break;
endif|#
directive|endif
block|}
name|prect
operator|=
name|prectInit
expr_stmt|;
name|xorg
operator|=
name|pDrawable
operator|->
name|x
expr_stmt|;
name|yorg
operator|=
name|pDrawable
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|xorg
operator|||
name|yorg
condition|)
block|{
name|prect
operator|=
name|prectInit
expr_stmt|;
name|n
operator|=
name|nrectFill
expr_stmt|;
while|while
condition|(
name|n
operator|--
condition|)
block|{
name|prect
operator|->
name|x
operator|+=
name|xorg
expr_stmt|;
name|prect
operator|->
name|y
operator|+=
name|yorg
expr_stmt|;
name|prect
operator|++
expr_stmt|;
block|}
block|}
name|prect
operator|=
name|prectInit
expr_stmt|;
name|numRects
operator|=
name|REGION_NUM_RECTS
argument_list|(
name|prgnClip
argument_list|)
operator|*
name|nrectFill
expr_stmt|;
if|if
condition|(
name|numRects
operator|>
name|NUM_STACK_RECTS
condition|)
block|{
name|pboxClippedBase
operator|=
operator|(
name|BoxPtr
operator|)
name|ALLOCATE_LOCAL
argument_list|(
name|numRects
operator|*
sizeof|sizeof
argument_list|(
name|BoxRec
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pboxClippedBase
condition|)
return|return;
block|}
else|else
name|pboxClippedBase
operator|=
name|stackRects
expr_stmt|;
name|pboxClipped
operator|=
name|pboxClippedBase
expr_stmt|;
if|if
condition|(
name|REGION_NUM_RECTS
argument_list|(
name|prgnClip
argument_list|)
operator|==
literal|1
condition|)
block|{
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|,
name|bx2
decl_stmt|,
name|by2
decl_stmt|;
name|pextent
operator|=
name|REGION_RECTS
argument_list|(
name|prgnClip
argument_list|)
expr_stmt|;
name|x1
operator|=
name|pextent
operator|->
name|x1
expr_stmt|;
name|y1
operator|=
name|pextent
operator|->
name|y1
expr_stmt|;
name|x2
operator|=
name|pextent
operator|->
name|x2
expr_stmt|;
name|y2
operator|=
name|pextent
operator|->
name|y2
expr_stmt|;
while|while
condition|(
name|nrectFill
operator|--
condition|)
block|{
if|if
condition|(
operator|(
name|pboxClipped
operator|->
name|x1
operator|=
name|prect
operator|->
name|x
operator|)
operator|<
name|x1
condition|)
name|pboxClipped
operator|->
name|x1
operator|=
name|x1
expr_stmt|;
if|if
condition|(
operator|(
name|pboxClipped
operator|->
name|y1
operator|=
name|prect
operator|->
name|y
operator|)
operator|<
name|y1
condition|)
name|pboxClipped
operator|->
name|y1
operator|=
name|y1
expr_stmt|;
name|bx2
operator|=
operator|(
name|int
operator|)
name|prect
operator|->
name|x
operator|+
operator|(
name|int
operator|)
name|prect
operator|->
name|width
expr_stmt|;
if|if
condition|(
name|bx2
operator|>
name|x2
condition|)
name|bx2
operator|=
name|x2
expr_stmt|;
name|pboxClipped
operator|->
name|x2
operator|=
name|bx2
expr_stmt|;
name|by2
operator|=
operator|(
name|int
operator|)
name|prect
operator|->
name|y
operator|+
operator|(
name|int
operator|)
name|prect
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|by2
operator|>
name|y2
condition|)
name|by2
operator|=
name|y2
expr_stmt|;
name|pboxClipped
operator|->
name|y2
operator|=
name|by2
expr_stmt|;
name|prect
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|pboxClipped
operator|->
name|x1
operator|<
name|pboxClipped
operator|->
name|x2
operator|)
operator|&&
operator|(
name|pboxClipped
operator|->
name|y1
operator|<
name|pboxClipped
operator|->
name|y2
operator|)
condition|)
block|{
name|pboxClipped
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|,
name|bx2
decl_stmt|,
name|by2
decl_stmt|;
name|pextent
operator|=
call|(
modifier|*
name|pGC
operator|->
name|pScreen
operator|->
name|RegionExtents
call|)
argument_list|(
name|prgnClip
argument_list|)
expr_stmt|;
name|x1
operator|=
name|pextent
operator|->
name|x1
expr_stmt|;
name|y1
operator|=
name|pextent
operator|->
name|y1
expr_stmt|;
name|x2
operator|=
name|pextent
operator|->
name|x2
expr_stmt|;
name|y2
operator|=
name|pextent
operator|->
name|y2
expr_stmt|;
while|while
condition|(
name|nrectFill
operator|--
condition|)
block|{
name|BoxRec
name|box
decl_stmt|;
if|if
condition|(
operator|(
name|box
operator|.
name|x1
operator|=
name|prect
operator|->
name|x
operator|)
operator|<
name|x1
condition|)
name|box
operator|.
name|x1
operator|=
name|x1
expr_stmt|;
if|if
condition|(
operator|(
name|box
operator|.
name|y1
operator|=
name|prect
operator|->
name|y
operator|)
operator|<
name|y1
condition|)
name|box
operator|.
name|y1
operator|=
name|y1
expr_stmt|;
name|bx2
operator|=
operator|(
name|int
operator|)
name|prect
operator|->
name|x
operator|+
operator|(
name|int
operator|)
name|prect
operator|->
name|width
expr_stmt|;
if|if
condition|(
name|bx2
operator|>
name|x2
condition|)
name|bx2
operator|=
name|x2
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|bx2
expr_stmt|;
name|by2
operator|=
operator|(
name|int
operator|)
name|prect
operator|->
name|y
operator|+
operator|(
name|int
operator|)
name|prect
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|by2
operator|>
name|y2
condition|)
name|by2
operator|=
name|y2
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|by2
expr_stmt|;
name|prect
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|box
operator|.
name|x1
operator|>=
name|box
operator|.
name|x2
operator|)
operator|||
operator|(
name|box
operator|.
name|y1
operator|>=
name|box
operator|.
name|y2
operator|)
condition|)
continue|continue;
name|n
operator|=
name|REGION_NUM_RECTS
argument_list|(
name|prgnClip
argument_list|)
expr_stmt|;
name|pbox
operator|=
name|REGION_RECTS
argument_list|(
name|prgnClip
argument_list|)
expr_stmt|;
comment|/* clip the rectangle to each box in the clip region 	       this is logically equivalent to calling Intersect() 	    */
while|while
condition|(
name|n
operator|--
condition|)
block|{
name|pboxClipped
operator|->
name|x1
operator|=
name|max
argument_list|(
name|box
operator|.
name|x1
argument_list|,
name|pbox
operator|->
name|x1
argument_list|)
expr_stmt|;
name|pboxClipped
operator|->
name|y1
operator|=
name|max
argument_list|(
name|box
operator|.
name|y1
argument_list|,
name|pbox
operator|->
name|y1
argument_list|)
expr_stmt|;
name|pboxClipped
operator|->
name|x2
operator|=
name|min
argument_list|(
name|box
operator|.
name|x2
argument_list|,
name|pbox
operator|->
name|x2
argument_list|)
expr_stmt|;
name|pboxClipped
operator|->
name|y2
operator|=
name|min
argument_list|(
name|box
operator|.
name|y2
argument_list|,
name|pbox
operator|->
name|y2
argument_list|)
expr_stmt|;
name|pbox
operator|++
expr_stmt|;
comment|/* see if clipping left anything */
if|if
condition|(
name|pboxClipped
operator|->
name|x1
operator|<
name|pboxClipped
operator|->
name|x2
operator|&&
name|pboxClipped
operator|->
name|y1
operator|<
name|pboxClipped
operator|->
name|y2
condition|)
block|{
name|pboxClipped
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
name|pboxClipped
operator|!=
name|pboxClippedBase
condition|)
call|(
modifier|*
name|BoxFill
call|)
argument_list|(
name|pDrawable
argument_list|,
name|pGC
argument_list|,
name|pboxClipped
operator|-
name|pboxClippedBase
argument_list|,
name|pboxClippedBase
argument_list|)
expr_stmt|;
if|if
condition|(
name|pboxClippedBase
operator|!=
name|stackRects
condition|)
name|DEALLOCATE_LOCAL
argument_list|(
name|pboxClippedBase
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

