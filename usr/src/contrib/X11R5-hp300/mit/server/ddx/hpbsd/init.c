begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  Copyright (c) 1986, 1987 by Hewlett-Packard Company Copyright (c) 1986, 1987 by the Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  HEWLETT-PACKARD MAKES NO WARRANTY OF ANY KIND WITH REGARD TO THIS SOFWARE, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  PURPOSE.  Hewlett-Packard shall not be liable for errors  contained herein or direct, indirect, special, incidental or  consequential damages in connection with the furnishing,  performance, or use of this material.  This software is not subject to any license of the American Telephone and Telegraph Company or of the Regents of the University of California.  */
end_comment

begin_comment
comment|/******************************************************************************* * * File:         init.c * RCS:          $Revision: 1.2 $ * Description:  Multiple screen initialization * Author:       John Howard Palevich * Created:      April 22, 1987 * Modified:     April 29, 1987  17:41:59 (John Howard Palevich) * Language:     C * Package:      USER * Status:       Experimental (Do Not Distribute) * * (c) Copyright 1987, Hewlett-Packard, Inc., all rights reserved. * *******************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_include
include|#
directive|include
file|<servermd.h>
end_include

begin_include
include|#
directive|include
file|"screenint.h"
end_include

begin_include
include|#
directive|include
file|"input.h"
end_include

begin_include
include|#
directive|include
file|"cursor.h"
end_include

begin_include
include|#
directive|include
file|"misc.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<setjmp.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|hpux
end_ifdef

begin_include
include|#
directive|include
file|<sys/sysmacros.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|hpux
end_ifndef

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<grfioctl.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<sys/graphics.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"hpDisplays.h"
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|display
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* display number as a string */
end_comment

begin_decl_stmt
specifier|static
name|char
name|xscreens
index|[
literal|80
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ConfigFile
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|hpux
end_ifdef

begin_decl_stmt
specifier|static
name|char
name|DefaultScreen
index|[]
init|=
literal|"/dev/crt"
decl_stmt|;
end_decl_stmt

begin_else
else|#
directive|else
end_else

begin_decl_stmt
specifier|static
name|char
name|DefaultScreen
index|[]
init|=
literal|"/dev/grf0"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * NewRule is an array of replacement rules.  Given a replacement rule,  *  *   colunm	foreground pixel	background pixel  *	0		0			0  *	1		0			1  *	2		1			0  *	3		1			1  *	4		1		      clear  *	5		0		      clear  */
end_comment

begin_decl_stmt
name|u_char
name|XHP_NewRule
index|[
literal|16
index|]
index|[
literal|6
index|]
init|=
block|{
name|GXclear
block|,
name|GXclear
block|,
name|GXclear
block|,
name|GXclear
block|,
name|GXandInverted
block|,
name|GXandInverted
block|,
name|GXclear
block|,
name|GXandInverted
block|,
name|GXand
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXandInverted
block|,
name|GXclear
block|,
name|GXnor
block|,
name|GXandReverse
block|,
name|GXinvert
block|,
name|GXxor
block|,
name|GXandInverted
block|,
name|GXclear
block|,
name|GXcopyInverted
block|,
name|GXcopy
block|,
name|GXset
block|,
name|GXor
block|,
name|GXandInverted
block|,
name|GXnoop
block|,
name|GXand
block|,
name|GXandInverted
block|,
name|GXclear
block|,
name|GXandInverted
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXequiv
block|,
name|GXxor
block|,
name|GXinvert
block|,
name|GXxor
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXorInverted
block|,
name|GXor
block|,
name|GXset
block|,
name|GXor
block|,
name|GXnoop
block|,
name|GXinvert
block|,
name|GXandReverse
block|,
name|GXnor
block|,
name|GXclear
block|,
name|GXandInverted
block|,
name|GXxor
block|,
name|GXinvert
block|,
name|GXxor
block|,
name|GXequiv
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXxor
block|,
name|GXinvert
block|,
name|GXinvert
block|,
name|GXinvert
block|,
name|GXinvert
block|,
name|GXxor
block|,
name|GXxor
block|,
name|GXinvert
block|,
name|GXnand
block|,
name|GXorReverse
block|,
name|GXset
block|,
name|GXor
block|,
name|GXxor
block|,
name|GXset
block|,
name|GXcopy
block|,
name|GXcopyInverted
block|,
name|GXclear
block|,
name|GXandInverted
block|,
name|GXor
block|,
name|GXset
block|,
name|GXor
block|,
name|GXorInverted
block|,
name|GXnoop
block|,
name|GXnoop
block|,
name|GXor
block|,
name|GXset
block|,
name|GXorReverse
block|,
name|GXnand
block|,
name|GXinvert
block|,
name|GXxor
block|,
name|GXor
block|,
name|GXset
block|,
name|GXset
block|,
name|GXset
block|,
name|GXset
block|,
name|GXor
block|,
name|GXor
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|IOMAP_BASE
value|0xb00000
end_define

begin_decl_stmt
specifier|static
name|unsigned
name|char
modifier|*
name|iomapBase
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|TopcatBrainDamage
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|catseyeMono
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|PixmapFormatRec
name|formats
index|[]
init|=
block|{
literal|1
block|,
literal|1
block|,
name|BITMAP_SCANLINE_PAD
block|,
comment|/* 1-bit deep for all */
if|#
directive|if
literal|0
block|4, 4, BITMAP_SCANLINE_PAD,
comment|/* 4-bit deep for Burgundy */
endif|#
directive|endif
literal|8
block|,
literal|8
block|,
name|BITMAP_SCANLINE_PAD
block|,
comment|/* 8-bit deep for most color displays */
if|#
directive|if
literal|0
block|16,16, BITMAP_SCANLINE_PAD,
comment|/*16-bit deep for most color displays */
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|NUMFORMATS
value|(sizeof formats)/(sizeof formats[0])
end_define

begin_comment
comment|/* Pmap represents all 256 combinations of 8 bits of information. */
end_comment

begin_comment
comment|/* For example, if my byte of 8 pixels of information is 01010101 */
end_comment

begin_comment
comment|/* then the bytes that get written in memory are 00ff00ff,00ff00ff*/
end_comment

begin_comment
comment|/* The bytes are written using the current write enable and       */
end_comment

begin_comment
comment|/* drawmode value.                                                */
end_comment

begin_decl_stmt
name|int
name|XHP_pmap
index|[
literal|256
index|]
index|[
literal|2
index|]
init|=
block|{
literal|0x00000000
block|,
literal|0x00000000
block|,
literal|0x00000000
block|,
literal|0x000000ff
block|,
literal|0x00000000
block|,
literal|0x0000ff00
block|,
literal|0x00000000
block|,
literal|0x0000ffff
block|,
literal|0x00000000
block|,
literal|0x00ff0000
block|,
literal|0x00000000
block|,
literal|0x00ff00ff
block|,
literal|0x00000000
block|,
literal|0x00ffff00
block|,
literal|0x00000000
block|,
literal|0x00ffffff
block|,
literal|0x00000000
block|,
literal|0xff000000
block|,
literal|0x00000000
block|,
literal|0xff0000ff
block|,
literal|0x00000000
block|,
literal|0xff00ff00
block|,
literal|0x00000000
block|,
literal|0xff00ffff
block|,
literal|0x00000000
block|,
literal|0xffff0000
block|,
literal|0x00000000
block|,
literal|0xffff00ff
block|,
literal|0x00000000
block|,
literal|0xffffff00
block|,
literal|0x00000000
block|,
literal|0xffffffff
block|,
literal|0x000000ff
block|,
literal|0x00000000
block|,
literal|0x000000ff
block|,
literal|0x000000ff
block|,
literal|0x000000ff
block|,
literal|0x0000ff00
block|,
literal|0x000000ff
block|,
literal|0x0000ffff
block|,
literal|0x000000ff
block|,
literal|0x00ff0000
block|,
literal|0x000000ff
block|,
literal|0x00ff00ff
block|,
literal|0x000000ff
block|,
literal|0x00ffff00
block|,
literal|0x000000ff
block|,
literal|0x00ffffff
block|,
literal|0x000000ff
block|,
literal|0xff000000
block|,
literal|0x000000ff
block|,
literal|0xff0000ff
block|,
literal|0x000000ff
block|,
literal|0xff00ff00
block|,
literal|0x000000ff
block|,
literal|0xff00ffff
block|,
literal|0x000000ff
block|,
literal|0xffff0000
block|,
literal|0x000000ff
block|,
literal|0xffff00ff
block|,
literal|0x000000ff
block|,
literal|0xffffff00
block|,
literal|0x000000ff
block|,
literal|0xffffffff
block|,
literal|0x0000ff00
block|,
literal|0x00000000
block|,
literal|0x0000ff00
block|,
literal|0x000000ff
block|,
literal|0x0000ff00
block|,
literal|0x0000ff00
block|,
literal|0x0000ff00
block|,
literal|0x0000ffff
block|,
literal|0x0000ff00
block|,
literal|0x00ff0000
block|,
literal|0x0000ff00
block|,
literal|0x00ff00ff
block|,
literal|0x0000ff00
block|,
literal|0x00ffff00
block|,
literal|0x0000ff00
block|,
literal|0x00ffffff
block|,
literal|0x0000ff00
block|,
literal|0xff000000
block|,
literal|0x0000ff00
block|,
literal|0xff0000ff
block|,
literal|0x0000ff00
block|,
literal|0xff00ff00
block|,
literal|0x0000ff00
block|,
literal|0xff00ffff
block|,
literal|0x0000ff00
block|,
literal|0xffff0000
block|,
literal|0x0000ff00
block|,
literal|0xffff00ff
block|,
literal|0x0000ff00
block|,
literal|0xffffff00
block|,
literal|0x0000ff00
block|,
literal|0xffffffff
block|,
literal|0x0000ffff
block|,
literal|0x00000000
block|,
literal|0x0000ffff
block|,
literal|0x000000ff
block|,
literal|0x0000ffff
block|,
literal|0x0000ff00
block|,
literal|0x0000ffff
block|,
literal|0x0000ffff
block|,
literal|0x0000ffff
block|,
literal|0x00ff0000
block|,
literal|0x0000ffff
block|,
literal|0x00ff00ff
block|,
literal|0x0000ffff
block|,
literal|0x00ffff00
block|,
literal|0x0000ffff
block|,
literal|0x00ffffff
block|,
literal|0x0000ffff
block|,
literal|0xff000000
block|,
literal|0x0000ffff
block|,
literal|0xff0000ff
block|,
literal|0x0000ffff
block|,
literal|0xff00ff00
block|,
literal|0x0000ffff
block|,
literal|0xff00ffff
block|,
literal|0x0000ffff
block|,
literal|0xffff0000
block|,
literal|0x0000ffff
block|,
literal|0xffff00ff
block|,
literal|0x0000ffff
block|,
literal|0xffffff00
block|,
literal|0x0000ffff
block|,
literal|0xffffffff
block|,
literal|0x00ff0000
block|,
literal|0x00000000
block|,
literal|0x00ff0000
block|,
literal|0x000000ff
block|,
literal|0x00ff0000
block|,
literal|0x0000ff00
block|,
literal|0x00ff0000
block|,
literal|0x0000ffff
block|,
literal|0x00ff0000
block|,
literal|0x00ff0000
block|,
literal|0x00ff0000
block|,
literal|0x00ff00ff
block|,
literal|0x00ff0000
block|,
literal|0x00ffff00
block|,
literal|0x00ff0000
block|,
literal|0x00ffffff
block|,
literal|0x00ff0000
block|,
literal|0xff000000
block|,
literal|0x00ff0000
block|,
literal|0xff0000ff
block|,
literal|0x00ff0000
block|,
literal|0xff00ff00
block|,
literal|0x00ff0000
block|,
literal|0xff00ffff
block|,
literal|0x00ff0000
block|,
literal|0xffff0000
block|,
literal|0x00ff0000
block|,
literal|0xffff00ff
block|,
literal|0x00ff0000
block|,
literal|0xffffff00
block|,
literal|0x00ff0000
block|,
literal|0xffffffff
block|,
literal|0x00ff00ff
block|,
literal|0x00000000
block|,
literal|0x00ff00ff
block|,
literal|0x000000ff
block|,
literal|0x00ff00ff
block|,
literal|0x0000ff00
block|,
literal|0x00ff00ff
block|,
literal|0x0000ffff
block|,
literal|0x00ff00ff
block|,
literal|0x00ff0000
block|,
literal|0x00ff00ff
block|,
literal|0x00ff00ff
block|,
literal|0x00ff00ff
block|,
literal|0x00ffff00
block|,
literal|0x00ff00ff
block|,
literal|0x00ffffff
block|,
literal|0x00ff00ff
block|,
literal|0xff000000
block|,
literal|0x00ff00ff
block|,
literal|0xff0000ff
block|,
literal|0x00ff00ff
block|,
literal|0xff00ff00
block|,
literal|0x00ff00ff
block|,
literal|0xff00ffff
block|,
literal|0x00ff00ff
block|,
literal|0xffff0000
block|,
literal|0x00ff00ff
block|,
literal|0xffff00ff
block|,
literal|0x00ff00ff
block|,
literal|0xffffff00
block|,
literal|0x00ff00ff
block|,
literal|0xffffffff
block|,
literal|0x00ffff00
block|,
literal|0x00000000
block|,
literal|0x00ffff00
block|,
literal|0x000000ff
block|,
literal|0x00ffff00
block|,
literal|0x0000ff00
block|,
literal|0x00ffff00
block|,
literal|0x0000ffff
block|,
literal|0x00ffff00
block|,
literal|0x00ff0000
block|,
literal|0x00ffff00
block|,
literal|0x00ff00ff
block|,
literal|0x00ffff00
block|,
literal|0x00ffff00
block|,
literal|0x00ffff00
block|,
literal|0x00ffffff
block|,
literal|0x00ffff00
block|,
literal|0xff000000
block|,
literal|0x00ffff00
block|,
literal|0xff0000ff
block|,
literal|0x00ffff00
block|,
literal|0xff00ff00
block|,
literal|0x00ffff00
block|,
literal|0xff00ffff
block|,
literal|0x00ffff00
block|,
literal|0xffff0000
block|,
literal|0x00ffff00
block|,
literal|0xffff00ff
block|,
literal|0x00ffff00
block|,
literal|0xffffff00
block|,
literal|0x00ffff00
block|,
literal|0xffffffff
block|,
literal|0x00ffffff
block|,
literal|0x00000000
block|,
literal|0x00ffffff
block|,
literal|0x000000ff
block|,
literal|0x00ffffff
block|,
literal|0x0000ff00
block|,
literal|0x00ffffff
block|,
literal|0x0000ffff
block|,
literal|0x00ffffff
block|,
literal|0x00ff0000
block|,
literal|0x00ffffff
block|,
literal|0x00ff00ff
block|,
literal|0x00ffffff
block|,
literal|0x00ffff00
block|,
literal|0x00ffffff
block|,
literal|0x00ffffff
block|,
literal|0x00ffffff
block|,
literal|0xff000000
block|,
literal|0x00ffffff
block|,
literal|0xff0000ff
block|,
literal|0x00ffffff
block|,
literal|0xff00ff00
block|,
literal|0x00ffffff
block|,
literal|0xff00ffff
block|,
literal|0x00ffffff
block|,
literal|0xffff0000
block|,
literal|0x00ffffff
block|,
literal|0xffff00ff
block|,
literal|0x00ffffff
block|,
literal|0xffffff00
block|,
literal|0x00ffffff
block|,
literal|0xffffffff
block|,
literal|0xff000000
block|,
literal|0x00000000
block|,
literal|0xff000000
block|,
literal|0x000000ff
block|,
literal|0xff000000
block|,
literal|0x0000ff00
block|,
literal|0xff000000
block|,
literal|0x0000ffff
block|,
literal|0xff000000
block|,
literal|0x00ff0000
block|,
literal|0xff000000
block|,
literal|0x00ff00ff
block|,
literal|0xff000000
block|,
literal|0x00ffff00
block|,
literal|0xff000000
block|,
literal|0x00ffffff
block|,
literal|0xff000000
block|,
literal|0xff000000
block|,
literal|0xff000000
block|,
literal|0xff0000ff
block|,
literal|0xff000000
block|,
literal|0xff00ff00
block|,
literal|0xff000000
block|,
literal|0xff00ffff
block|,
literal|0xff000000
block|,
literal|0xffff0000
block|,
literal|0xff000000
block|,
literal|0xffff00ff
block|,
literal|0xff000000
block|,
literal|0xffffff00
block|,
literal|0xff000000
block|,
literal|0xffffffff
block|,
literal|0xff0000ff
block|,
literal|0x00000000
block|,
literal|0xff0000ff
block|,
literal|0x000000ff
block|,
literal|0xff0000ff
block|,
literal|0x0000ff00
block|,
literal|0xff0000ff
block|,
literal|0x0000ffff
block|,
literal|0xff0000ff
block|,
literal|0x00ff0000
block|,
literal|0xff0000ff
block|,
literal|0x00ff00ff
block|,
literal|0xff0000ff
block|,
literal|0x00ffff00
block|,
literal|0xff0000ff
block|,
literal|0x00ffffff
block|,
literal|0xff0000ff
block|,
literal|0xff000000
block|,
literal|0xff0000ff
block|,
literal|0xff0000ff
block|,
literal|0xff0000ff
block|,
literal|0xff00ff00
block|,
literal|0xff0000ff
block|,
literal|0xff00ffff
block|,
literal|0xff0000ff
block|,
literal|0xffff0000
block|,
literal|0xff0000ff
block|,
literal|0xffff00ff
block|,
literal|0xff0000ff
block|,
literal|0xffffff00
block|,
literal|0xff0000ff
block|,
literal|0xffffffff
block|,
literal|0xff00ff00
block|,
literal|0x00000000
block|,
literal|0xff00ff00
block|,
literal|0x000000ff
block|,
literal|0xff00ff00
block|,
literal|0x0000ff00
block|,
literal|0xff00ff00
block|,
literal|0x0000ffff
block|,
literal|0xff00ff00
block|,
literal|0x00ff0000
block|,
literal|0xff00ff00
block|,
literal|0x00ff00ff
block|,
literal|0xff00ff00
block|,
literal|0x00ffff00
block|,
literal|0xff00ff00
block|,
literal|0x00ffffff
block|,
literal|0xff00ff00
block|,
literal|0xff000000
block|,
literal|0xff00ff00
block|,
literal|0xff0000ff
block|,
literal|0xff00ff00
block|,
literal|0xff00ff00
block|,
literal|0xff00ff00
block|,
literal|0xff00ffff
block|,
literal|0xff00ff00
block|,
literal|0xffff0000
block|,
literal|0xff00ff00
block|,
literal|0xffff00ff
block|,
literal|0xff00ff00
block|,
literal|0xffffff00
block|,
literal|0xff00ff00
block|,
literal|0xffffffff
block|,
literal|0xff00ffff
block|,
literal|0x00000000
block|,
literal|0xff00ffff
block|,
literal|0x000000ff
block|,
literal|0xff00ffff
block|,
literal|0x0000ff00
block|,
literal|0xff00ffff
block|,
literal|0x0000ffff
block|,
literal|0xff00ffff
block|,
literal|0x00ff0000
block|,
literal|0xff00ffff
block|,
literal|0x00ff00ff
block|,
literal|0xff00ffff
block|,
literal|0x00ffff00
block|,
literal|0xff00ffff
block|,
literal|0x00ffffff
block|,
literal|0xff00ffff
block|,
literal|0xff000000
block|,
literal|0xff00ffff
block|,
literal|0xff0000ff
block|,
literal|0xff00ffff
block|,
literal|0xff00ff00
block|,
literal|0xff00ffff
block|,
literal|0xff00ffff
block|,
literal|0xff00ffff
block|,
literal|0xffff0000
block|,
literal|0xff00ffff
block|,
literal|0xffff00ff
block|,
literal|0xff00ffff
block|,
literal|0xffffff00
block|,
literal|0xff00ffff
block|,
literal|0xffffffff
block|,
literal|0xffff0000
block|,
literal|0x00000000
block|,
literal|0xffff0000
block|,
literal|0x000000ff
block|,
literal|0xffff0000
block|,
literal|0x0000ff00
block|,
literal|0xffff0000
block|,
literal|0x0000ffff
block|,
literal|0xffff0000
block|,
literal|0x00ff0000
block|,
literal|0xffff0000
block|,
literal|0x00ff00ff
block|,
literal|0xffff0000
block|,
literal|0x00ffff00
block|,
literal|0xffff0000
block|,
literal|0x00ffffff
block|,
literal|0xffff0000
block|,
literal|0xff000000
block|,
literal|0xffff0000
block|,
literal|0xff0000ff
block|,
literal|0xffff0000
block|,
literal|0xff00ff00
block|,
literal|0xffff0000
block|,
literal|0xff00ffff
block|,
literal|0xffff0000
block|,
literal|0xffff0000
block|,
literal|0xffff0000
block|,
literal|0xffff00ff
block|,
literal|0xffff0000
block|,
literal|0xffffff00
block|,
literal|0xffff0000
block|,
literal|0xffffffff
block|,
literal|0xffff00ff
block|,
literal|0x00000000
block|,
literal|0xffff00ff
block|,
literal|0x000000ff
block|,
literal|0xffff00ff
block|,
literal|0x0000ff00
block|,
literal|0xffff00ff
block|,
literal|0x0000ffff
block|,
literal|0xffff00ff
block|,
literal|0x00ff0000
block|,
literal|0xffff00ff
block|,
literal|0x00ff00ff
block|,
literal|0xffff00ff
block|,
literal|0x00ffff00
block|,
literal|0xffff00ff
block|,
literal|0x00ffffff
block|,
literal|0xffff00ff
block|,
literal|0xff000000
block|,
literal|0xffff00ff
block|,
literal|0xff0000ff
block|,
literal|0xffff00ff
block|,
literal|0xff00ff00
block|,
literal|0xffff00ff
block|,
literal|0xff00ffff
block|,
literal|0xffff00ff
block|,
literal|0xffff0000
block|,
literal|0xffff00ff
block|,
literal|0xffff00ff
block|,
literal|0xffff00ff
block|,
literal|0xffffff00
block|,
literal|0xffff00ff
block|,
literal|0xffffffff
block|,
literal|0xffffff00
block|,
literal|0x00000000
block|,
literal|0xffffff00
block|,
literal|0x000000ff
block|,
literal|0xffffff00
block|,
literal|0x0000ff00
block|,
literal|0xffffff00
block|,
literal|0x0000ffff
block|,
literal|0xffffff00
block|,
literal|0x00ff0000
block|,
literal|0xffffff00
block|,
literal|0x00ff00ff
block|,
literal|0xffffff00
block|,
literal|0x00ffff00
block|,
literal|0xffffff00
block|,
literal|0x00ffffff
block|,
literal|0xffffff00
block|,
literal|0xff000000
block|,
literal|0xffffff00
block|,
literal|0xff0000ff
block|,
literal|0xffffff00
block|,
literal|0xff00ff00
block|,
literal|0xffffff00
block|,
literal|0xff00ffff
block|,
literal|0xffffff00
block|,
literal|0xffff0000
block|,
literal|0xffffff00
block|,
literal|0xffff00ff
block|,
literal|0xffffff00
block|,
literal|0xffffff00
block|,
literal|0xffffff00
block|,
literal|0xffffffff
block|,
literal|0xffffffff
block|,
literal|0x00000000
block|,
literal|0xffffffff
block|,
literal|0x000000ff
block|,
literal|0xffffffff
block|,
literal|0x0000ff00
block|,
literal|0xffffffff
block|,
literal|0x0000ffff
block|,
literal|0xffffffff
block|,
literal|0x00ff0000
block|,
literal|0xffffffff
block|,
literal|0x00ff00ff
block|,
literal|0xffffffff
block|,
literal|0x00ffff00
block|,
literal|0xffffffff
block|,
literal|0x00ffffff
block|,
literal|0xffffffff
block|,
literal|0xff000000
block|,
literal|0xffffffff
block|,
literal|0xff0000ff
block|,
literal|0xffffffff
block|,
literal|0xff00ff00
block|,
literal|0xffffffff
block|,
literal|0xff00ffff
block|,
literal|0xffffffff
block|,
literal|0xffff0000
block|,
literal|0xffffffff
block|,
literal|0xffff00ff
block|,
literal|0xffffffff
block|,
literal|0xffffff00
block|,
literal|0xffffffff
block|,
literal|0xffffffff
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*XHP_pmap end*/
end_comment

begin_decl_stmt
name|int
name|XHP_QUADALIGN
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|jmp_buf
name|env
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * routine to handle the bus error we might get in testing for the alignment  * restrictions of this cpu.  */
end_comment

begin_function
specifier|static
name|int
name|sigbusHandler
parameter_list|()
block|{
name|XHP_QUADALIGN
operator|=
literal|1
expr_stmt|;
name|longjmp
argument_list|(
name|env
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
specifier|static
name|int
name|ReadLine
parameter_list|()
function_decl|;
end_function_decl

begin_typedef
typedef|typedef
struct|struct
block|{
name|char
modifier|*
name|productNumber
decl_stmt|;
name|char
modifier|*
name|productNickname
decl_stmt|;
name|Bool
function_decl|(
modifier|*
name|InfoScreen
function_decl|)
parameter_list|()
function_decl|;
name|Bool
function_decl|(
modifier|*
name|InitScreen
function_decl|)
parameter_list|()
function_decl|;
block|}
name|ScreenTableRec
typedef|;
end_typedef

begin_function_decl
specifier|static
name|ScreenTableRec
modifier|*
name|FindScreen
parameter_list|()
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|MAXARG
value|10
end_define

begin_define
define|#
directive|define
name|MAXSTRING
value|120
end_define

begin_comment
comment|/*-  *-----------------------------------------------------------------------  * InitOutput --  *	Initialize screenInfo for all actually accessible framebuffers.  *	The  *  * Results:  *	screenInfo init proc field set  *  * Side Effects:  *	None  *  *-----------------------------------------------------------------------  */
end_comment

begin_function
name|void
name|InitOutput
parameter_list|(
name|pScreenInfo
parameter_list|,
name|argc
parameter_list|,
name|argv
parameter_list|)
name|ScreenInfo
modifier|*
name|pScreenInfo
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|FILE
modifier|*
name|in
decl_stmt|;
specifier|static
name|int
name|firstTime
init|=
literal|1
decl_stmt|;
specifier|static
name|int
name|numScreens
decl_stmt|;
specifier|static
name|ScreenTableRec
modifier|*
name|FoundScreens
index|[
name|MAXSCREENS
index|]
decl_stmt|;
name|ScreenTableRec
modifier|*
name|s
decl_stmt|;
ifdef|#
directive|ifdef
name|hpux
name|char
modifier|*
name|dispaddr
decl_stmt|,
modifier|*
name|getenv
argument_list|()
decl_stmt|;
endif|#
directive|endif
name|struct
name|stat
name|statbuf
decl_stmt|;
name|char
name|minornumber
index|[
literal|10
index|]
decl_stmt|;
comment|/*      * test for data alignment restriction of this cpu.  If this cpu      * doesn't allow long-word writes on an odd address, then we assume      * that it requires quad-word alignment.  This reduces our headaches      * to only two cases - 68020s (no restrictions) and others (e.g.      * 68010 and Spectrum).      */
block|{
name|int
modifier|*
name|test
decl_stmt|;
name|char
name|foo
index|[
literal|8
index|]
decl_stmt|;
specifier|static
name|struct
name|sigvec
name|timeout_vec
init|=
block|{
name|sigbusHandler
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|struct
name|sigvec
name|old_vec
decl_stmt|;
name|test
operator|=
operator|(
name|int
operator|*
operator|)
operator|(
operator|(
name|int
operator|)
name|foo
operator||
literal|3
operator|)
operator|+
literal|1
expr_stmt|;
comment|/* generate an odd address */
name|XHP_QUADALIGN
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|hp300
define|#
directive|define
name|sigvector
value|sigvec
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|hp9000s300
argument_list|)
operator|||
name|defined
argument_list|(
name|hp300
argument_list|)
comment|/* check for 310 */
name|sigvector
argument_list|(
name|SIGBUS
argument_list|,
operator|&
name|timeout_vec
argument_list|,
operator|&
name|old_vec
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|setjmp
argument_list|(
name|env
argument_list|)
condition|)
operator|*
name|test
operator|=
literal|1
expr_stmt|;
comment|/* generate a bus error on 68010s or Spectrums */
name|sigvector
argument_list|(
name|SIGBUS
argument_list|,
operator|&
name|old_vec
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* need word align on 800 */
name|XHP_QUADALIGN
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
comment|/* hp9000s300 */
block|}
name|iomapBase
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|IOMAP_BASE
expr_stmt|;
ifdef|#
directive|ifdef
name|hpux
if|if
condition|(
name|dispaddr
operator|=
name|getenv
argument_list|(
literal|"SB_DISPLAY_ADDR"
argument_list|)
condition|)
name|iomapBase
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|strtol
argument_list|(
name|dispaddr
argument_list|,
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScreenInfo
operator|->
name|imageByteOrder
operator|=
name|IMAGE_BYTE_ORDER
expr_stmt|;
name|pScreenInfo
operator|->
name|bitmapScanlineUnit
operator|=
name|BITMAP_SCANLINE_UNIT
expr_stmt|;
name|pScreenInfo
operator|->
name|bitmapScanlinePad
operator|=
name|BITMAP_SCANLINE_PAD
expr_stmt|;
name|pScreenInfo
operator|->
name|bitmapBitOrder
operator|=
name|BITMAP_BIT_ORDER
expr_stmt|;
name|pScreenInfo
operator|->
name|numPixmapFormats
operator|=
name|NUMFORMATS
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUMFORMATS
condition|;
name|i
operator|++
control|)
name|pScreenInfo
operator|->
name|formats
index|[
name|i
index|]
operator|=
name|formats
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|firstTime
condition|)
block|{
name|firstTime
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|xscreens
argument_list|,
literal|"%s/X%sscreens"
argument_list|,
name|LIBDIR
argument_list|,
name|display
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|==
operator|(
name|in
operator|=
name|fopen
argument_list|(
name|xscreens
argument_list|,
literal|"r"
argument_list|)
operator|)
condition|)
block|{
name|perror
argument_list|(
name|xscreens
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"Can't open screen configuration file, defaulting to %s.\n"
argument_list|,
name|DefaultScreen
argument_list|)
expr_stmt|;
name|ConfigFile
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
name|ConfigFile
operator|=
name|TRUE
expr_stmt|;
name|numScreens
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXSCREENS
operator|&&
operator|(
operator|(
operator|!
name|ConfigFile
operator|)
condition|?
name|TRUE
else|:
operator|!
name|feof
argument_list|(
name|in
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|char
modifier|*
name|argv
index|[
name|MAXARG
index|]
decl_stmt|;
name|int
name|argc
decl_stmt|;
if|if
condition|(
operator|!
name|ConfigFile
condition|)
name|argv
index|[
literal|0
index|]
operator|=
name|DefaultScreen
expr_stmt|;
else|else
block|{
while|while
condition|(
operator|!
operator|(
name|argc
operator|=
name|ReadLine
argument_list|(
name|in
argument_list|,
name|argv
argument_list|)
operator|)
condition|)
comment|/* handle blank lines */
empty_stmt|;
if|if
condition|(
name|argc
operator|==
operator|-
literal|1
condition|)
comment|/* eof */
break|break;
if|if
condition|(
name|argc
operator|<
literal|0
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: %s: line %d: Too many fields.\n"
argument_list|,
name|xscreens
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
comment|/* for compatibility with R2 screens tables */
if|if
condition|(
name|argc
operator|==
literal|3
condition|)
block|{
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"topcat"
argument_list|)
operator|==
literal|0
operator|)
operator|||
operator|(
name|strcmp
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Topcat"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|argv
index|[
literal|0
index|]
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
name|argc
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|ErrorF
argument_list|(
literal|"InitOutput:  %s, line %d:  unsupported display type \"%s\".\n"
argument_list|,
name|xscreens
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
block|}
if|if
condition|(
name|argc
operator|!=
literal|1
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: %s: line %d: Wrong number of fields.\n"
argument_list|,
name|xscreens
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
block|}
if|if
condition|(
operator|(
name|s
operator|=
name|FindScreen
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: %s: line %d: Unknown screen %s.\n"
argument_list|,
name|xscreens
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
comment|/* munge new structure to match old argv structures */
comment|/* BOGOSITY ALERT argv and argc are munged for subsequent calls */
name|argv
index|[
literal|2
index|]
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|s
operator|->
name|productNickname
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
operator|&
name|statbuf
argument_list|)
operator|<
literal|0
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: %s: could not stat %s.\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
ifdef|#
directive|ifdef
name|hpux
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|minornumber
argument_list|,
literal|"%x"
argument_list|,
name|minor
argument_list|(
name|statbuf
operator|.
name|st_rdev
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|minornumber
argument_list|,
literal|"%d"
argument_list|,
name|minor
argument_list|(
name|statbuf
operator|.
name|st_rdev
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|argv
index|[
literal|3
index|]
operator|=
name|minornumber
expr_stmt|;
name|argc
operator|=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
call|(
name|s
operator|->
name|InfoScreen
call|)
argument_list|(
name|numScreens
argument_list|,
name|argv
argument_list|,
name|argc
argument_list|)
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: %s: line %d: Couldn't find this screen %s.\n"
argument_list|,
name|xscreens
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
goto|goto
name|fatal_error
goto|;
block|}
name|FoundScreens
index|[
name|numScreens
operator|++
index|]
operator|=
name|s
expr_stmt|;
if|if
condition|(
operator|!
name|ConfigFile
condition|)
break|break;
block|}
if|if
condition|(
name|ConfigFile
condition|)
name|fclose
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numScreens
condition|;
name|i
operator|++
control|)
block|{
name|s
operator|=
name|FoundScreens
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|AddScreen
argument_list|(
name|s
operator|->
name|InitScreen
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|ErrorF
argument_list|(
literal|"InitOutput: Couldn't add a screen.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
return|return;
name|fatal_error
label|:
name|fclose
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"InitOutput: Couldn't initialize screens.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|ReadLine
parameter_list|(
name|in
parameter_list|,
name|argv
parameter_list|)
name|FILE
modifier|*
name|in
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|argc
decl_stmt|;
specifier|static
name|char
name|line
index|[
name|MAXSTRING
index|]
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|state
decl_stmt|;
if|if
condition|(
name|NULL
operator|==
name|fgets
argument_list|(
name|line
argument_list|,
name|MAXSTRING
argument_list|,
name|in
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|state
operator|=
name|argc
operator|=
literal|0
operator|,
name|s
operator|=
name|line
init|;
name|argc
operator|<
name|MAXARG
condition|;
name|s
operator|++
control|)
block|{
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
case|case
literal|'#'
case|:
case|case
literal|'\n'
case|:
operator|*
name|s
operator|=
literal|'\0'
expr_stmt|;
case|case
literal|'\0'
case|:
return|return
operator|(
name|argc
operator|)
return|;
case|case
literal|' '
case|:
case|case
literal|'\t'
case|:
name|state
operator|=
literal|0
expr_stmt|;
operator|*
name|s
operator|=
literal|'\0'
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|state
operator|==
literal|0
condition|)
block|{
name|state
operator|=
literal|1
expr_stmt|;
name|argv
index|[
name|argc
operator|++
index|]
operator|=
name|s
expr_stmt|;
block|}
break|break;
block|}
block|}
return|return
operator|(
operator|-
literal|2
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|STUPID_MOBERLY
value|-1
end_define

begin_comment
comment|/* Declare the ScreenInfo(), ScreenInit() and ScreenClose() functions here.  */
end_comment

begin_decl_stmt
specifier|extern
name|Bool
name|mobScreenInfo
argument_list|()
decl_stmt|,
name|mobScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|gbxScreenInfo
argument_list|()
decl_stmt|,
name|gbxScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|topcatScreenInfo
argument_list|()
decl_stmt|,
name|topcatScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|mrtopcatScreenInfo
argument_list|()
decl_stmt|,
name|mrtopcatScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|catseyeScreenInfo
argument_list|()
decl_stmt|,
name|catseyeScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|renScreenInfo
argument_list|()
decl_stmt|,
name|renScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|orenScreenInfo
argument_list|()
decl_stmt|,
name|orenScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Bool
name|davinciScreenInfo
argument_list|()
decl_stmt|,
name|davinciScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|Bool
name|oDavinciScreenInit
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|Bool
name|hyperScreenInfo
argument_list|()
decl_stmt|,
name|hyperScreenInit
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Table of known frame buffers  */
end_comment

begin_decl_stmt
specifier|static
name|ScreenTableRec
name|screenTable
index|[]
init|=
block|{
block|{
literal|"98633"
block|,
literal|"moberly"
block|,
name|mobScreenInfo
block|,
name|mobScreenInit
block|}
block|,
block|{
literal|"98700"
block|,
literal|"gatorbox"
block|,
name|gbxScreenInfo
block|,
name|gbxScreenInit
block|}
block|,
block|{
literal|"98547"
block|,
literal|"topcat"
block|,
name|topcatScreenInfo
block|,
name|topcatScreenInit
block|}
block|,
block|{
literal|"98543"
block|,
literal|"mrtopcat"
block|,
name|mrtopcatScreenInfo
block|,
name|mrtopcatScreenInit
block|}
block|,
block|{
literal|"98550"
block|,
literal|"catseye"
block|,
name|topcatScreenInfo
block|,
name|topcatScreenInit
block|}
block|,
block|{
literal|"98720"
block|,
literal|"renaissance"
block|,
name|renScreenInfo
block|,
name|renScreenInit
block|}
block|,
block|{
literal|"98720"
block|,
literal|"orenaissance"
block|,
name|orenScreenInfo
block|,
name|orenScreenInit
block|}
block|,
block|{
literal|"98730"
block|,
literal|"davinci"
block|,
name|davinciScreenInfo
block|,
name|davinciScreenInit
block|}
block|,
block|{
literal|"98730"
block|,
literal|"odavinci"
block|,
name|davinciScreenInfo
block|,
name|oDavinciScreenInit
block|}
block|,
block|{
literal|"a1096a"
block|,
literal|"hyperion"
block|,
name|hyperScreenInfo
block|,
name|hyperScreenInit
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
name|NULL
block|,
operator|(
name|char
operator|*
operator|)
name|NULL
block|,
operator|(
name|Bool
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
name|NULL
block|,
operator|(
name|Bool
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|ScreenTableRec
modifier|*
name|FindScreen
parameter_list|(
name|devname
parameter_list|)
name|char
modifier|*
name|devname
decl_stmt|;
block|{
name|ScreenTableRec
modifier|*
name|s
decl_stmt|;
name|int
name|fd
decl_stmt|,
name|gcid
decl_stmt|;
ifdef|#
directive|ifdef
name|hpux
name|int
name|gcon
decl_stmt|;
endif|#
directive|endif
name|char
name|name
index|[
literal|40
index|]
decl_stmt|;
specifier|static
name|struct
name|stat
name|buf
decl_stmt|;
name|struct
name|hp_grfreg
modifier|*
name|ce
decl_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|devname
argument_list|,
name|O_RDWR
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
name|devname
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"FindScreen couldn't open %s \n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
ifdef|#
directive|ifdef
name|hpux
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GCON
argument_list|,
operator|&
name|gcon
argument_list|)
operator|<
literal|0
operator|||
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GCID
argument_list|,
operator|&
name|gcid
argument_list|)
operator|<
literal|0
condition|)
name|gcid
operator|=
name|STUPID_MOBERLY
expr_stmt|;
else|#
directive|else
block|{
name|struct
name|grfinfo
name|gi
decl_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GRFIOCGINFO
argument_list|,
operator|&
name|gi
argument_list|)
operator|<
literal|0
operator|||
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GRFIOCON
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
name|gcid
operator|=
name|STUPID_MOBERLY
expr_stmt|;
else|else
name|gcid
operator|=
name|gi
operator|.
name|gd_id
expr_stmt|;
block|}
endif|#
directive|endif
name|fstat
argument_list|(
name|fd
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|gcid
condition|)
block|{
case|case
name|GCID_GATORBOX
case|:
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"gatorbox"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GCID_TOPCAT
case|:
ifdef|#
directive|ifdef
name|hpux
name|ce
operator|=
operator|(
expr|struct
name|hp_grfreg
operator|*
operator|)
name|iomapBase
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GCMAP
argument_list|,
operator|&
name|ce
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"GCMAP:"
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"FindScreen: Error getting address of %s\n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|#
directive|else
block|{
name|u_char
modifier|*
name|Addr
init|=
operator|(
name|u_char
operator|*
operator|)
literal|0
decl_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GRFIOCMAP
argument_list|,
operator|&
name|Addr
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GRFIOCOFF
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"GRFIOCMAP:"
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"FindScreen: Error getting address of %s\n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|ce
operator|=
operator|(
expr|struct
name|hp_grfreg
operator|*
operator|)
name|Addr
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|ce
operator|->
name|gr_id2
operator|>=
name|ID2_LCC
condition|)
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"catseye"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ce
operator|->
name|gr_bits
condition|)
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"mrtopcat"
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"topcat"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|hpux
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GCUNMAP
argument_list|,
operator|&
name|ce
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"GCUNMAP:"
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"FindScreen: Error freeing temp storage %s\n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|#
directive|else
if|if
condition|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|GRFIOCUNMAP
argument_list|,
operator|&
name|ce
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"GRFIOCUNMAP:"
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"FindScreen: Error freeing temp storage %s\n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
endif|#
directive|endif
break|break;
case|case
name|GCID_RENAISSANCE
case|:
if|if
condition|(
operator|(
name|minor
argument_list|(
name|buf
operator|.
name|st_rdev
argument_list|)
operator|)
operator|&
literal|0x000003
condition|)
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"orenaissance"
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"renaissance"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GCID_FIREEYE
case|:
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"catseye"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GCID_HYPERION
case|:
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"hyperion"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GCID_DAVINCI
case|:
if|if
condition|(
operator|(
name|minor
argument_list|(
name|buf
operator|.
name|st_rdev
argument_list|)
operator|)
operator|&
literal|0x000003
condition|)
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"odavinci"
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"davinci"
argument_list|)
expr_stmt|;
break|break;
case|case
name|STUPID_MOBERLY
case|:
name|strcpy
argument_list|(
name|name
argument_list|,
literal|"moberly"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ErrorF
argument_list|(
literal|"FindScreen: unknown screen type  %s \n"
argument_list|,
name|devname
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
for|for
control|(
name|s
operator|=
name|screenTable
init|;
name|s
operator|->
name|productNumber
operator|!=
name|NULL
condition|;
name|s
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|s
operator|->
name|productNumber
argument_list|,
name|name
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|s
operator|->
name|productNickname
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|s
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|hpux
end_ifdef

begin_function
name|unsigned
name|char
modifier|*
name|FrameBufferBase
parameter_list|(
name|size
parameter_list|)
name|long
name|int
name|size
decl_stmt|;
block|{
name|unsigned
name|char
modifier|*
name|base
init|=
name|iomapBase
decl_stmt|;
comment|/* Round size to a 4K page */
name|size
operator|=
operator|(
name|size
operator|+
literal|4095
operator|)
operator|&
literal|0xfffff000
expr_stmt|;
name|iomapBase
operator|+=
name|size
expr_stmt|;
return|return
operator|(
name|base
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * DDX - specific abort routine.  Called by AbortServer().  */
end_comment

begin_function
name|void
name|AbortDDX
parameter_list|()
block|{ }
end_function

begin_comment
comment|/* Called by GiveUp(). */
end_comment

begin_function
name|void
name|ddxGiveUp
parameter_list|()
block|{ }
end_function

begin_function
name|int
name|ddxProcessArgument
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|,
name|i
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
name|int
name|i
decl_stmt|;
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-tcbd"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|TopcatBrainDamage
operator|++
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-catseyeMono"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|catseyeMono
operator|++
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|ddxUseMsg
parameter_list|()
block|{
name|ErrorF
argument_list|(
literal|"-tcbd                  run in topcat braindamage mode\n"
argument_list|)
expr_stmt|;
name|ErrorF
argument_list|(
literal|"-catseyeMono           run 2bit deep catseyes in Monochrome\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

