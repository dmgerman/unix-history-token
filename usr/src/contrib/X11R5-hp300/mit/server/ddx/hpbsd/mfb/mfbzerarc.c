begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************ Copyright 1989 by The Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of MIT not be used in advertising or publicity pertaining to distribution of the software without specific prior written permission. M.I.T. makes no representation about the suitability of this software for any purpose. It is provided "as is" without any express or implied warranty.  ********************************************************/
end_comment

begin_comment
comment|/* $XConsortium: mfbzerarc.c,v 5.10 89/09/20 18:55:33 rws Exp $ */
end_comment

begin_comment
comment|/* Derived from:  * "Algorithm for drawing ellipses or hyperbolae with a digital plotter"  * by M. L. V. Pitteway  * The Computer Journal, November 1967, Volume 10, Number 3, pp. 282-289  */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xprotostr.h"
end_include

begin_include
include|#
directive|include
file|"miscstruct.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"mfb.h"
end_include

begin_include
include|#
directive|include
file|"maskbits.h"
end_include

begin_include
include|#
directive|include
file|"mizerarc.h"
end_include

begin_decl_stmt
specifier|extern
name|void
name|miPolyArc
argument_list|()
decl_stmt|,
name|miZeroPolyArc
argument_list|()
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
operator|(
name|BITMAP_BIT_ORDER
operator|==
name|MSBFirst
operator|)
end_if

begin_define
define|#
directive|define
name|LEFTMOST
value|((unsigned int) 0x80000000)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|LEFTMOST
value|((unsigned int) 1)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|PixelateWhite
parameter_list|(
name|addr
parameter_list|,
name|off
parameter_list|)
define|\
value|(addr)[(off)>>5] |= SCRRIGHT (LEFTMOST, ((off)& 0x1f))
end_define

begin_define
define|#
directive|define
name|PixelateBlack
parameter_list|(
name|addr
parameter_list|,
name|off
parameter_list|)
define|\
value|(addr)[(off)>>5]&= ~(SCRRIGHT (LEFTMOST, ((off)& 0x1f)))
end_define

begin_define
define|#
directive|define
name|Pixelate
parameter_list|(
name|base
parameter_list|,
name|off
parameter_list|)
define|\
value|{ \     paddr = base + ((off)>>5); \     pmask = SCRRIGHT(LEFTMOST, (off)& 0x1f); \     *paddr = (*paddr& ~pmask) | (pixel& pmask); \ }
end_define

begin_define
define|#
directive|define
name|DoPix
parameter_list|(
name|bit
parameter_list|,
name|base
parameter_list|,
name|off
parameter_list|)
value|if (mask& bit) Pixelate(base,off);
end_define

begin_function
specifier|static
name|void
name|mfbZeroArcSS
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|arc
parameter_list|)
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|xArc
modifier|*
name|arc
decl_stmt|;
block|{
name|miZeroArcRec
name|info
decl_stmt|;
name|Bool
name|do360
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|a
decl_stmt|,
name|b
decl_stmt|,
name|d
decl_stmt|,
name|mask
decl_stmt|;
specifier|register
name|int
name|k1
decl_stmt|,
name|k3
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
modifier|*
name|addrl
decl_stmt|;
name|int
modifier|*
name|yorgl
decl_stmt|,
modifier|*
name|yorgol
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
name|int
name|nlwidth
decl_stmt|,
name|yoffset
decl_stmt|,
name|dyoffset
decl_stmt|;
name|int
name|pmask
decl_stmt|;
specifier|register
name|int
modifier|*
name|paddr
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|mfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|mfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|)
operator|->
name|rop
operator|==
name|RROP_BLACK
condition|)
name|pixel
operator|=
literal|0
expr_stmt|;
else|else
name|pixel
operator|=
operator|~
literal|0L
expr_stmt|;
if|if
condition|(
name|pDraw
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|addrl
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
else|else
block|{
name|addrl
operator|=
operator|(
name|int
operator|*
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|bits
expr_stmt|;
name|nlwidth
operator|=
operator|(
name|int
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDraw
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
block|}
name|do360
operator|=
name|miZeroArcSetup
argument_list|(
name|arc
argument_list|,
operator|&
name|info
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|yorgl
operator|=
name|addrl
operator|+
operator|(
operator|(
name|info
operator|.
name|yorg
operator|+
name|pDraw
operator|->
name|y
operator|)
operator|*
name|nlwidth
operator|)
expr_stmt|;
name|yorgol
operator|=
name|addrl
operator|+
operator|(
operator|(
name|info
operator|.
name|yorgo
operator|+
name|pDraw
operator|->
name|y
operator|)
operator|*
name|nlwidth
operator|)
expr_stmt|;
name|info
operator|.
name|xorg
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|info
operator|.
name|xorgo
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|MIARCSETUP
argument_list|()
expr_stmt|;
name|yoffset
operator|=
name|y
condition|?
name|nlwidth
else|:
literal|0
expr_stmt|;
name|dyoffset
operator|=
literal|0
expr_stmt|;
name|mask
operator|=
name|info
operator|.
name|initialMask
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|arc
operator|->
name|width
operator|&
literal|1
operator|)
condition|)
block|{
name|DoPix
argument_list|(
literal|2
argument_list|,
name|yorgl
argument_list|,
name|info
operator|.
name|xorgo
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|8
argument_list|,
name|yorgol
argument_list|,
name|info
operator|.
name|xorgo
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|info
operator|.
name|end
operator|.
name|x
operator|||
operator|!
name|info
operator|.
name|end
operator|.
name|y
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|end
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|end
operator|=
name|info
operator|.
name|altend
expr_stmt|;
block|}
if|if
condition|(
name|do360
operator|&&
operator|(
name|arc
operator|->
name|width
operator|==
name|arc
operator|->
name|height
operator|)
operator|&&
operator|!
operator|(
name|arc
operator|->
name|width
operator|&
literal|1
operator|)
condition|)
block|{
name|int
name|xoffset
init|=
name|nlwidth
decl_stmt|;
name|int
modifier|*
name|yorghl
init|=
name|yorgl
operator|+
operator|(
name|info
operator|.
name|h
operator|*
name|nlwidth
operator|)
decl_stmt|;
name|int
name|xorghp
init|=
name|info
operator|.
name|xorg
operator|+
name|info
operator|.
name|h
decl_stmt|;
name|int
name|xorghn
init|=
name|info
operator|.
name|xorg
operator|-
name|info
operator|.
name|h
decl_stmt|;
if|if
condition|(
name|pixel
condition|)
block|{
while|while
condition|(
literal|1
condition|)
block|{
name|PixelateWhite
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|-
name|x
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|-
name|x
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|<
literal|0
condition|)
break|break;
name|PixelateWhite
argument_list|(
name|yorghl
operator|-
name|xoffset
argument_list|,
name|xorghp
operator|-
name|y
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorghl
operator|-
name|xoffset
argument_list|,
name|xorghn
operator|+
name|y
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorghl
operator|+
name|xoffset
argument_list|,
name|xorghn
operator|+
name|y
argument_list|)
expr_stmt|;
name|PixelateWhite
argument_list|(
name|yorghl
operator|+
name|xoffset
argument_list|,
name|xorghp
operator|-
name|y
argument_list|)
expr_stmt|;
name|xoffset
operator|+=
name|nlwidth
expr_stmt|;
name|MIARCCIRCLESTEP
argument_list|(
argument|yoffset += nlwidth;
argument_list|)
empty_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
literal|1
condition|)
block|{
name|PixelateBlack
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|-
name|x
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|-
name|x
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|<
literal|0
condition|)
break|break;
name|PixelateBlack
argument_list|(
name|yorghl
operator|-
name|xoffset
argument_list|,
name|xorghp
operator|-
name|y
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorghl
operator|-
name|xoffset
argument_list|,
name|xorghn
operator|+
name|y
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorghl
operator|+
name|xoffset
argument_list|,
name|xorghn
operator|+
name|y
argument_list|)
expr_stmt|;
name|PixelateBlack
argument_list|(
name|yorghl
operator|+
name|xoffset
argument_list|,
name|xorghp
operator|-
name|y
argument_list|)
expr_stmt|;
name|xoffset
operator|+=
name|nlwidth
expr_stmt|;
name|MIARCCIRCLESTEP
argument_list|(
argument|yoffset += nlwidth;
argument_list|)
empty_stmt|;
block|}
block|}
name|x
operator|=
name|info
operator|.
name|w
expr_stmt|;
name|yoffset
operator|=
name|info
operator|.
name|h
operator|*
name|nlwidth
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|do360
condition|)
block|{
while|while
condition|(
name|y
operator|<
name|info
operator|.
name|h
operator|||
name|x
operator|<
name|info
operator|.
name|w
condition|)
block|{
name|MIARCOCTANTSHIFT
argument_list|(
argument|dyoffset = nlwidth;
argument_list|)
empty_stmt|;
name|Pixelate
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|Pixelate
argument_list|(
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|Pixelate
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|Pixelate
argument_list|(
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|MIARCSTEP
argument_list|(
argument|yoffset += dyoffset;
argument_list|,
argument|yoffset += nlwidth;
argument_list|)
empty_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
name|y
operator|<
name|info
operator|.
name|h
operator|||
name|x
operator|<
name|info
operator|.
name|w
condition|)
block|{
name|MIARCOCTANTSHIFT
argument_list|(
argument|dyoffset = nlwidth;
argument_list|)
empty_stmt|;
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|start
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|start
operator|.
name|y
operator|)
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|start
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|start
operator|=
name|info
operator|.
name|altstart
expr_stmt|;
block|}
name|DoPix
argument_list|(
literal|1
argument_list|,
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|2
argument_list|,
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|4
argument_list|,
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|8
argument_list|,
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|end
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|end
operator|.
name|y
operator|)
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|end
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|end
operator|=
name|info
operator|.
name|altend
expr_stmt|;
block|}
name|MIARCSTEP
argument_list|(
argument|yoffset += dyoffset;
argument_list|,
argument|yoffset += nlwidth;
argument_list|)
empty_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|start
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|start
operator|.
name|y
operator|)
condition|)
name|mask
operator|=
name|info
operator|.
name|start
operator|.
name|mask
expr_stmt|;
name|DoPix
argument_list|(
literal|1
argument_list|,
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|4
argument_list|,
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|arc
operator|->
name|height
operator|&
literal|1
condition|)
block|{
name|DoPix
argument_list|(
literal|2
argument_list|,
name|yorgl
operator|+
name|yoffset
argument_list|,
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|DoPix
argument_list|(
literal|8
argument_list|,
name|yorgol
operator|-
name|yoffset
argument_list|,
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|mfbZeroPolyArcSS
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|narcs
parameter_list|,
name|parcs
parameter_list|)
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|narcs
decl_stmt|;
name|xArc
modifier|*
name|parcs
decl_stmt|;
block|{
specifier|register
name|xArc
modifier|*
name|arc
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|BoxRec
name|box
decl_stmt|;
name|RegionPtr
name|cclip
decl_stmt|;
if|if
condition|(
operator|!
name|pGC
operator|->
name|planemask
operator|&
literal|1
condition|)
return|return;
name|cclip
operator|=
operator|(
operator|(
name|mfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|mfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|)
operator|->
name|pCompositeClip
expr_stmt|;
for|for
control|(
name|arc
operator|=
name|parcs
operator|,
name|i
operator|=
name|narcs
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
name|arc
operator|++
control|)
block|{
if|if
condition|(
name|miCanZeroArc
argument_list|(
name|arc
argument_list|)
condition|)
block|{
name|box
operator|.
name|x1
operator|=
name|arc
operator|->
name|x
operator|+
name|pDraw
operator|->
name|x
expr_stmt|;
name|box
operator|.
name|y1
operator|=
name|arc
operator|->
name|y
operator|+
name|pDraw
operator|->
name|y
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|box
operator|.
name|x1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|width
operator|+
literal|1
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|box
operator|.
name|y1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|height
operator|+
literal|1
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|pDraw
operator|->
name|pScreen
operator|->
name|RectIn
call|)
argument_list|(
name|cclip
argument_list|,
operator|&
name|box
argument_list|)
operator|==
name|rgnIN
condition|)
name|mfbZeroArcSS
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
name|arc
argument_list|)
expr_stmt|;
else|else
name|miZeroPolyArc
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
literal|1
argument_list|,
name|arc
argument_list|)
expr_stmt|;
block|}
else|else
name|miPolyArc
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
literal|1
argument_list|,
name|arc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

