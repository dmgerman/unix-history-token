begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Push Pixels for 8 bit displays.  */
end_comment

begin_comment
comment|/* Copyright 1989 by the Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_comment
comment|/* $XConsortium: cfbpush8.c,v 5.9 91/04/10 11:41:54 keith Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xmd.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"regionstr.h"
end_include

begin_include
include|#
directive|include
file|"cfb.h"
end_include

begin_include
include|#
directive|include
file|"cfbmskbits.h"
end_include

begin_include
include|#
directive|include
file|"cfb8bit.h"
end_include

begin_if
if|#
directive|if
name|PPW
operator|==
literal|4
end_if

begin_function_decl
specifier|extern
name|void
name|mfbPushPixels
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|void
name|cfbPushPixels8
parameter_list|(
name|pGC
parameter_list|,
name|pBitmap
parameter_list|,
name|pDrawable
parameter_list|,
name|dx
parameter_list|,
name|dy
parameter_list|,
name|xOrg
parameter_list|,
name|yOrg
parameter_list|)
name|GCPtr
name|pGC
decl_stmt|;
name|PixmapPtr
name|pBitmap
decl_stmt|;
name|DrawablePtr
name|pDrawable
decl_stmt|;
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|xOrg
decl_stmt|,
name|yOrg
decl_stmt|;
block|{
specifier|register
name|unsigned
name|long
modifier|*
name|src
decl_stmt|,
modifier|*
name|dst
decl_stmt|;
specifier|register
name|unsigned
name|long
name|pixel
decl_stmt|;
specifier|register
name|unsigned
name|long
name|c
decl_stmt|,
name|bits
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pdstLine
decl_stmt|,
modifier|*
name|psrcLine
decl_stmt|;
name|unsigned
name|long
modifier|*
name|pdstBase
decl_stmt|;
name|int
name|srcWidth
decl_stmt|;
name|int
name|dstWidth
decl_stmt|;
name|int
name|xoff
decl_stmt|;
name|int
name|nBitmapLongs
decl_stmt|,
name|nPixmapLongs
decl_stmt|;
name|int
name|nBitmapTmp
decl_stmt|,
name|nPixmapTmp
decl_stmt|;
name|unsigned
name|long
name|rightMask
decl_stmt|;
name|BoxRec
name|bbox
decl_stmt|;
name|cfbPrivGCPtr
name|devPriv
decl_stmt|;
name|bbox
operator|.
name|x1
operator|=
name|xOrg
expr_stmt|;
name|bbox
operator|.
name|y1
operator|=
name|yOrg
expr_stmt|;
name|bbox
operator|.
name|x2
operator|=
name|bbox
operator|.
name|x1
operator|+
name|dx
expr_stmt|;
name|bbox
operator|.
name|y2
operator|=
name|bbox
operator|.
name|y1
operator|+
name|dy
expr_stmt|;
name|devPriv
operator|=
operator|(
name|cfbPrivGC
operator|*
operator|)
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
expr_stmt|;
switch|switch
condition|(
call|(
modifier|*
name|pGC
operator|->
name|pScreen
operator|->
name|RectIn
call|)
argument_list|(
name|devPriv
operator|->
name|pCompositeClip
argument_list|,
operator|&
name|bbox
argument_list|)
condition|)
block|{
case|case
name|rgnPART
case|:
name|mfbPushPixels
argument_list|(
name|pGC
argument_list|,
name|pBitmap
argument_list|,
name|pDrawable
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|,
name|xOrg
argument_list|,
name|yOrg
argument_list|)
expr_stmt|;
case|case
name|rgnOUT
case|:
return|return;
block|}
name|cfbGetLongWidthAndPointer
argument_list|(
argument|pDrawable
argument_list|,
argument|dstWidth
argument_list|,
argument|pdstBase
argument_list|)
name|psrcLine
operator|=
operator|(
name|unsigned
name|long
operator|*
operator|)
operator|(
operator|(
name|hpPrivPixmapPtr
operator|)
name|pBitmap
operator|->
name|devPrivate
operator|.
name|ptr
operator|)
operator|->
name|bits
expr_stmt|;
name|srcWidth
operator|=
call|(
name|int
call|)
argument_list|(
operator|(
name|hpPrivPixmapPtr
operator|)
name|pBitmap
operator|->
name|devPrivate
operator|.
name|ptr
argument_list|)
operator|->
name|stride
operator|>>
literal|2
expr_stmt|;
name|SET_REGISTERS_FOR_WRITING
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|,
operator|~
literal|0
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
if|if
condition|(
name|pBitmap
operator|->
name|devKind
operator|==
name|PIXMAP_FRAME_BUFFER
condition|)
name|WAIT_READY_TO_RENDER
argument_list|(
name|pBitmap
operator|->
name|drawable
operator|.
name|pScreen
argument_list|)
expr_stmt|;
name|pixel
operator|=
name|devPriv
operator|->
name|xor
expr_stmt|;
name|xoff
operator|=
name|xOrg
operator|&
literal|03
expr_stmt|;
name|nBitmapLongs
operator|=
operator|(
name|dx
operator|+
name|xoff
operator|)
operator|>>
literal|5
expr_stmt|;
name|nPixmapLongs
operator|=
operator|(
name|dx
operator|+
literal|3
operator|+
name|xoff
operator|)
operator|>>
literal|2
expr_stmt|;
name|rightMask
operator|=
operator|~
name|cfb8BitLenMasks
index|[
operator|(
operator|(
name|dx
operator|+
name|xoff
operator|)
operator|&
literal|0x1f
operator|)
index|]
expr_stmt|;
name|pdstLine
operator|=
name|pdstBase
operator|+
operator|(
name|yOrg
operator|*
name|dstWidth
operator|)
operator|+
operator|(
name|xOrg
operator|>>
literal|2
operator|)
expr_stmt|;
while|while
condition|(
name|dy
operator|--
condition|)
block|{
name|c
operator|=
literal|0
expr_stmt|;
name|nPixmapTmp
operator|=
name|nPixmapLongs
expr_stmt|;
name|nBitmapTmp
operator|=
name|nBitmapLongs
expr_stmt|;
name|src
operator|=
name|psrcLine
expr_stmt|;
name|dst
operator|=
name|pdstLine
expr_stmt|;
while|while
condition|(
name|nBitmapTmp
operator|--
condition|)
block|{
name|bits
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|c
operator||=
name|BitRight
argument_list|(
name|bits
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|nPixmapTmp
operator|-=
literal|8
expr_stmt|;
name|c
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|xoff
condition|)
name|c
operator|=
name|BitLeft
argument_list|(
name|bits
argument_list|,
literal|32
operator|-
name|xoff
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|BitLeft
argument_list|(
name|rightMask
argument_list|,
name|xoff
argument_list|)
condition|)
name|c
operator||=
name|BitRight
argument_list|(
operator|*
name|src
argument_list|,
name|xoff
argument_list|)
expr_stmt|;
name|c
operator|&=
name|rightMask
expr_stmt|;
switch|switch
condition|(
name|nPixmapTmp
condition|)
block|{
case|case
literal|8
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|7
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|6
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|5
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|4
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|3
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|2
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|1
case|:
name|WriteFourBits
argument_list|(
name|dst
argument_list|,
name|pixel
argument_list|,
name|GetFourBits
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|NextFourBits
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dst
operator|++
expr_stmt|;
case|case
literal|0
case|:
break|break;
block|}
name|pdstLine
operator|+=
name|dstWidth
expr_stmt|;
name|psrcLine
operator|+=
name|srcWidth
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

