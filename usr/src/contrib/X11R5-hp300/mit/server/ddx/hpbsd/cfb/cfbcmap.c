begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************ Copyright 1987 by Sun Microsystems, Inc. Mountain View, CA.                      All Rights Reserved  Permission  to  use,  copy,  modify,  and  distribute   this software  and  its documentation for any purpose and without fee is hereby granted, provided that the above copyright no- tice  appear  in all copies and that both that copyright no- tice and this permission notice appear in  supporting  docu- mentation,  and  that the names of Sun or MIT not be used in advertising or publicity pertaining to distribution  of  the software  without specific prior written permission. Sun and M.I.T. make no representations about the suitability of this software for any purpose. It is provided "as is" without any express or implied warranty.  SUN DISCLAIMS ALL WARRANTIES WITH REGARD TO  THIS  SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FIT- NESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL SUN BE  LI- ABLE  FOR  ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,  DATA  OR PROFITS,  WHETHER  IN  AN  ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION  WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ********************************************************/
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xproto.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"colormapst.h"
end_include

begin_include
include|#
directive|include
file|"resource.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|STATIC_COLOR
end_ifdef

begin_decl_stmt
specifier|static
name|ColormapPtr
name|InstalledMaps
index|[
name|MAXSCREENS
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|cfbListInstalledColormaps
parameter_list|(
name|pScreen
parameter_list|,
name|pmaps
parameter_list|)
name|ScreenPtr
name|pScreen
decl_stmt|;
name|Colormap
modifier|*
name|pmaps
decl_stmt|;
block|{
comment|/* By the time we are processing requests, we can guarantee that there      * is always a colormap installed */
operator|*
name|pmaps
operator|=
name|InstalledMaps
index|[
name|pScreen
operator|->
name|myNum
index|]
operator|->
name|mid
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|void
name|cfbInstallColormap
parameter_list|(
name|pmap
parameter_list|)
name|ColormapPtr
name|pmap
decl_stmt|;
block|{
name|int
name|index
init|=
name|pmap
operator|->
name|pScreen
operator|->
name|myNum
decl_stmt|;
name|ColormapPtr
name|oldpmap
init|=
name|InstalledMaps
index|[
name|index
index|]
decl_stmt|;
if|if
condition|(
name|pmap
operator|!=
name|oldpmap
condition|)
block|{
comment|/* Uninstall pInstalledMap. No hardware changes required, just 	 * notify all interested parties. */
if|if
condition|(
name|oldpmap
operator|!=
operator|(
name|ColormapPtr
operator|)
name|None
condition|)
name|WalkTree
argument_list|(
name|pmap
operator|->
name|pScreen
argument_list|,
name|TellLostMap
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|oldpmap
operator|->
name|mid
argument_list|)
expr_stmt|;
comment|/* Install pmap */
name|InstalledMaps
index|[
name|index
index|]
operator|=
name|pmap
expr_stmt|;
name|WalkTree
argument_list|(
name|pmap
operator|->
name|pScreen
argument_list|,
name|TellGainedMap
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|pmap
operator|->
name|mid
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|cfbUninstallColormap
parameter_list|(
name|pmap
parameter_list|)
name|ColormapPtr
name|pmap
decl_stmt|;
block|{
name|int
name|index
init|=
name|pmap
operator|->
name|pScreen
operator|->
name|myNum
decl_stmt|;
name|ColormapPtr
name|curpmap
init|=
name|InstalledMaps
index|[
name|index
index|]
decl_stmt|;
if|if
condition|(
name|pmap
operator|==
name|curpmap
condition|)
block|{
if|if
condition|(
name|pmap
operator|->
name|mid
operator|!=
name|pmap
operator|->
name|pScreen
operator|->
name|defColormap
condition|)
block|{
name|curpmap
operator|=
operator|(
name|ColormapPtr
operator|)
name|LookupIDByType
argument_list|(
name|pmap
operator|->
name|pScreen
operator|->
name|defColormap
argument_list|,
name|RT_COLORMAP
argument_list|)
expr_stmt|;
call|(
modifier|*
name|pmap
operator|->
name|pScreen
operator|->
name|InstallColormap
call|)
argument_list|(
name|curpmap
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|cfbResolveColor
parameter_list|(
name|pred
parameter_list|,
name|pgreen
parameter_list|,
name|pblue
parameter_list|,
name|pVisual
parameter_list|)
name|unsigned
name|short
modifier|*
name|pred
decl_stmt|,
decl|*
name|pgreen
decl_stmt|,
modifier|*
name|pblue
decl_stmt|;
end_function

begin_decl_stmt
specifier|register
name|VisualPtr
name|pVisual
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|shift
init|=
literal|16
operator|-
name|pVisual
operator|->
name|bitsPerRGBValue
decl_stmt|;
name|unsigned
name|lim
init|=
operator|(
literal|1
operator|<<
name|pVisual
operator|->
name|bitsPerRGBValue
operator|)
operator|-
literal|1
decl_stmt|;
if|if
condition|(
operator|(
name|pVisual
operator|->
name|class
operator|==
name|PseudoColor
operator|)
operator|||
operator|(
name|pVisual
operator|->
name|class
operator|==
name|DirectColor
operator|)
condition|)
block|{
comment|/* rescale to rgb bits */
operator|*
name|pred
operator|=
operator|(
operator|(
operator|*
name|pred
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
operator|*
name|pgreen
operator|=
operator|(
operator|(
operator|*
name|pgreen
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
operator|*
name|pblue
operator|=
operator|(
operator|(
operator|*
name|pblue
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pVisual
operator|->
name|class
operator|==
name|GrayScale
condition|)
block|{
comment|/* rescale to gray then rgb bits */
operator|*
name|pred
operator|=
operator|(
literal|30L
operator|*
operator|*
name|pred
operator|+
literal|59L
operator|*
operator|*
name|pgreen
operator|+
literal|11L
operator|*
operator|*
name|pblue
operator|)
operator|/
literal|100
expr_stmt|;
operator|*
name|pblue
operator|=
operator|*
name|pgreen
operator|=
operator|*
name|pred
operator|=
operator|(
operator|(
operator|*
name|pred
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pVisual
operator|->
name|class
operator|==
name|StaticGray
condition|)
block|{
name|unsigned
name|limg
init|=
name|pVisual
operator|->
name|ColormapEntries
operator|-
literal|1
decl_stmt|;
comment|/* rescale to gray then [0..limg] then [0..65535] then rgb bits */
operator|*
name|pred
operator|=
operator|(
literal|30L
operator|*
operator|*
name|pred
operator|+
literal|59L
operator|*
operator|*
name|pgreen
operator|+
literal|11L
operator|*
operator|*
name|pblue
operator|)
operator|/
literal|100
expr_stmt|;
operator|*
name|pred
operator|=
operator|(
operator|(
operator|(
operator|(
operator|*
name|pred
operator|*
operator|(
name|limg
operator|+
literal|1
operator|)
operator|)
operator|)
operator|>>
literal|16
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limg
expr_stmt|;
operator|*
name|pblue
operator|=
operator|*
name|pgreen
operator|=
operator|*
name|pred
operator|=
operator|(
operator|(
operator|*
name|pred
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
else|else
block|{
name|unsigned
name|limr
decl_stmt|,
name|limg
decl_stmt|,
name|limb
decl_stmt|;
name|limr
operator|=
name|pVisual
operator|->
name|redMask
operator|>>
name|pVisual
operator|->
name|offsetRed
expr_stmt|;
name|limg
operator|=
name|pVisual
operator|->
name|greenMask
operator|>>
name|pVisual
operator|->
name|offsetGreen
expr_stmt|;
name|limb
operator|=
name|pVisual
operator|->
name|blueMask
operator|>>
name|pVisual
operator|->
name|offsetBlue
expr_stmt|;
comment|/* rescale to [0..limN] then [0..65535] then rgb bits */
operator|*
name|pred
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
operator|*
name|pred
operator|*
operator|(
name|limr
operator|+
literal|1
operator|)
operator|)
operator|>>
literal|16
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limr
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
operator|*
name|pgreen
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
operator|*
name|pgreen
operator|*
operator|(
name|limg
operator|+
literal|1
operator|)
operator|)
operator|>>
literal|16
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limg
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
operator|*
name|pblue
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
operator|*
name|pblue
operator|*
operator|(
name|limb
operator|+
literal|1
operator|)
operator|)
operator|>>
literal|16
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limb
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
block|}
end_block

begin_function
name|Bool
name|cfbInitializeColormap
parameter_list|(
name|pmap
parameter_list|)
specifier|register
name|ColormapPtr
name|pmap
decl_stmt|;
block|{
specifier|register
name|unsigned
name|i
decl_stmt|;
specifier|register
name|VisualPtr
name|pVisual
decl_stmt|;
name|unsigned
name|lim
decl_stmt|,
name|maxent
decl_stmt|,
name|shift
decl_stmt|;
name|pVisual
operator|=
name|pmap
operator|->
name|pVisual
expr_stmt|;
name|lim
operator|=
operator|(
literal|1
operator|<<
name|pVisual
operator|->
name|bitsPerRGBValue
operator|)
operator|-
literal|1
expr_stmt|;
name|shift
operator|=
literal|16
operator|-
name|pVisual
operator|->
name|bitsPerRGBValue
expr_stmt|;
name|maxent
operator|=
name|pVisual
operator|->
name|ColormapEntries
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|pVisual
operator|->
name|class
operator|==
name|TrueColor
condition|)
block|{
name|unsigned
name|limr
decl_stmt|,
name|limg
decl_stmt|,
name|limb
decl_stmt|;
name|limr
operator|=
name|pVisual
operator|->
name|redMask
operator|>>
name|pVisual
operator|->
name|offsetRed
expr_stmt|;
name|limg
operator|=
name|pVisual
operator|->
name|greenMask
operator|>>
name|pVisual
operator|->
name|offsetGreen
expr_stmt|;
name|limb
operator|=
name|pVisual
operator|->
name|blueMask
operator|>>
name|pVisual
operator|->
name|offsetBlue
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|maxent
condition|;
name|i
operator|++
control|)
block|{
comment|/* rescale to [0..65535] then rgb bits */
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|red
operator|=
operator|(
operator|(
operator|(
operator|(
name|i
operator|*
literal|65535
operator|)
operator|/
name|limr
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
name|pmap
operator|->
name|green
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|green
operator|=
operator|(
operator|(
operator|(
operator|(
name|i
operator|*
literal|65535
operator|)
operator|/
name|limg
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
name|pmap
operator|->
name|blue
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|blue
operator|=
operator|(
operator|(
operator|(
operator|(
name|i
operator|*
literal|65535
operator|)
operator|/
name|limb
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pVisual
operator|->
name|class
operator|==
name|StaticColor
condition|)
block|{
name|unsigned
name|limr
decl_stmt|,
name|limg
decl_stmt|,
name|limb
decl_stmt|;
name|limr
operator|=
name|pVisual
operator|->
name|redMask
operator|>>
name|pVisual
operator|->
name|offsetRed
expr_stmt|;
name|limg
operator|=
name|pVisual
operator|->
name|greenMask
operator|>>
name|pVisual
operator|->
name|offsetGreen
expr_stmt|;
name|limb
operator|=
name|pVisual
operator|->
name|blueMask
operator|>>
name|pVisual
operator|->
name|offsetBlue
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|maxent
condition|;
name|i
operator|++
control|)
block|{
comment|/* rescale to [0..65535] then rgb bits */
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|red
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
name|i
operator|&
name|pVisual
operator|->
name|redMask
operator|)
operator|>>
name|pVisual
operator|->
name|offsetRed
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limr
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|green
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
name|i
operator|&
name|pVisual
operator|->
name|greenMask
operator|)
operator|>>
name|pVisual
operator|->
name|offsetGreen
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limg
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|blue
operator|=
operator|(
operator|(
operator|(
operator|(
operator|(
operator|(
name|i
operator|&
name|pVisual
operator|->
name|blueMask
operator|)
operator|>>
name|pVisual
operator|->
name|offsetBlue
operator|)
operator|*
literal|65535
operator|)
operator|/
name|limb
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pVisual
operator|->
name|class
operator|==
name|StaticGray
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|maxent
condition|;
name|i
operator|++
control|)
block|{
comment|/* rescale to [0..65535] then rgb bits */
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|red
operator|=
operator|(
operator|(
operator|(
operator|(
name|i
operator|*
literal|65535
operator|)
operator|/
name|maxent
operator|)
operator|>>
name|shift
operator|)
operator|*
literal|65535
operator|)
operator|/
name|lim
expr_stmt|;
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|green
operator|=
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|red
expr_stmt|;
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|blue
operator|=
name|pmap
operator|->
name|red
index|[
name|i
index|]
operator|.
name|co
operator|.
name|local
operator|.
name|red
expr_stmt|;
block|}
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* When simulating DirectColor on PseudoColor hardware, multiple    entries of the colormap must be updated  */
end_comment

begin_define
define|#
directive|define
name|AddElement
parameter_list|(
name|mask
parameter_list|)
value|{ \     pixel = red | green | blue; \     for (i = 0; i< nresult; i++) \   	if (outdefs[i].pixel == pixel) \     	    break; \     if (i == nresult) \     { \    	nresult++; \ 	outdefs[i].pixel = pixel; \ 	outdefs[i].flags = 0; \     } \     outdefs[i].flags |= (mask); \     outdefs[i].red = pmap->red[red>> pVisual->offsetRed].co.local.red; \     outdefs[i].green = pmap->green[green>> pVisual->offsetGreen].co.local.green; \     outdefs[i].blue = pmap->blue[blue>> pVisual->offsetBlue].co.local.blue; \ }
end_define

begin_macro
name|cfbExpandDirectColors
argument_list|(
argument|pmap
argument_list|,
argument|ndef
argument_list|,
argument|indefs
argument_list|,
argument|outdefs
argument_list|)
end_macro

begin_decl_stmt
name|ColormapPtr
name|pmap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ndef
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|xColorItem
modifier|*
name|indefs
decl_stmt|,
modifier|*
name|outdefs
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|minred
decl_stmt|,
name|mingreen
decl_stmt|,
name|minblue
decl_stmt|;
specifier|register
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
name|int
name|maxred
decl_stmt|,
name|maxgreen
decl_stmt|,
name|maxblue
decl_stmt|;
name|int
name|stepred
decl_stmt|,
name|stepgreen
decl_stmt|,
name|stepblue
decl_stmt|;
name|VisualPtr
name|pVisual
decl_stmt|;
specifier|register
name|int
name|pixel
decl_stmt|;
specifier|register
name|int
name|nresult
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|pVisual
operator|=
name|pmap
operator|->
name|pVisual
expr_stmt|;
name|stepred
operator|=
literal|1
operator|<<
name|pVisual
operator|->
name|offsetRed
expr_stmt|;
name|stepgreen
operator|=
literal|1
operator|<<
name|pVisual
operator|->
name|offsetGreen
expr_stmt|;
name|stepblue
operator|=
literal|1
operator|<<
name|pVisual
operator|->
name|offsetBlue
expr_stmt|;
name|maxred
operator|=
name|pVisual
operator|->
name|redMask
expr_stmt|;
name|maxgreen
operator|=
name|pVisual
operator|->
name|greenMask
expr_stmt|;
name|maxblue
operator|=
name|pVisual
operator|->
name|blueMask
expr_stmt|;
name|nresult
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
name|ndef
operator|--
condition|;
name|indefs
operator|++
control|)
block|{
if|if
condition|(
name|indefs
operator|->
name|flags
operator|&
name|DoRed
condition|)
block|{
name|red
operator|=
name|indefs
operator|->
name|pixel
operator|&
name|pVisual
operator|->
name|redMask
expr_stmt|;
for|for
control|(
name|green
operator|=
literal|0
init|;
name|green
operator|<=
name|maxgreen
condition|;
name|green
operator|+=
name|stepgreen
control|)
block|{
for|for
control|(
name|blue
operator|=
literal|0
init|;
name|blue
operator|<=
name|maxblue
condition|;
name|blue
operator|+=
name|stepblue
control|)
block|{
name|AddElement
argument_list|(
argument|DoRed
argument_list|)
block|}
block|}
block|}
if|if
condition|(
name|indefs
operator|->
name|flags
operator|&
name|DoGreen
condition|)
block|{
name|green
operator|=
name|indefs
operator|->
name|pixel
operator|&
name|pVisual
operator|->
name|greenMask
expr_stmt|;
for|for
control|(
name|red
operator|=
literal|0
init|;
name|red
operator|<=
name|maxred
condition|;
name|red
operator|+=
name|stepred
control|)
block|{
for|for
control|(
name|blue
operator|=
literal|0
init|;
name|blue
operator|<=
name|maxblue
condition|;
name|blue
operator|+=
name|stepblue
control|)
block|{
name|AddElement
argument_list|(
argument|DoGreen
argument_list|)
block|}
block|}
block|}
if|if
condition|(
name|indefs
operator|->
name|flags
operator|&
name|DoBlue
condition|)
block|{
name|blue
operator|=
name|indefs
operator|->
name|pixel
operator|&
name|pVisual
operator|->
name|blueMask
expr_stmt|;
for|for
control|(
name|red
operator|=
literal|0
init|;
name|red
operator|<=
name|maxred
condition|;
name|red
operator|+=
name|stepred
control|)
block|{
for|for
control|(
name|green
operator|=
literal|0
init|;
name|green
operator|<=
name|maxgreen
condition|;
name|green
operator|+=
name|stepgreen
control|)
block|{
name|AddElement
argument_list|(
argument|DoBlue
argument_list|)
block|}
block|}
block|}
block|}
return|return
name|nresult
return|;
block|}
end_block

begin_function
name|Bool
name|cfbCreateDefColormap
parameter_list|(
name|pScreen
parameter_list|)
name|ScreenPtr
name|pScreen
decl_stmt|;
block|{
name|unsigned
name|short
name|zero
init|=
literal|0
decl_stmt|,
name|ones
init|=
literal|0xFFFF
decl_stmt|;
name|VisualPtr
name|pVisual
decl_stmt|;
name|ColormapPtr
name|cmap
decl_stmt|;
for|for
control|(
name|pVisual
operator|=
name|pScreen
operator|->
name|visuals
init|;
name|pVisual
operator|->
name|vid
operator|!=
name|pScreen
operator|->
name|rootVisual
condition|;
name|pVisual
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|CreateColormap
argument_list|(
name|pScreen
operator|->
name|defColormap
argument_list|,
name|pScreen
argument_list|,
name|pVisual
argument_list|,
operator|&
name|cmap
argument_list|,
operator|(
name|pVisual
operator|->
name|class
operator|&
name|DynamicClass
operator|)
condition|?
name|AllocNone
else|:
name|AllocAll
argument_list|,
literal|0
argument_list|)
operator|!=
name|Success
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|(
name|AllocColor
argument_list|(
name|cmap
argument_list|,
operator|&
name|zero
argument_list|,
operator|&
name|zero
argument_list|,
operator|&
name|zero
argument_list|,
operator|&
operator|(
name|pScreen
operator|->
name|blackPixel
operator|)
argument_list|,
literal|0
argument_list|)
operator|!=
name|Success
operator|)
operator|||
operator|(
name|AllocColor
argument_list|(
name|cmap
argument_list|,
operator|&
name|ones
argument_list|,
operator|&
name|ones
argument_list|,
operator|&
name|ones
argument_list|,
operator|&
operator|(
name|pScreen
operator|->
name|whitePixel
operator|)
argument_list|,
literal|0
argument_list|)
operator|!=
name|Success
operator|)
condition|)
return|return
name|FALSE
return|;
call|(
modifier|*
name|pScreen
operator|->
name|InstallColormap
call|)
argument_list|(
name|cmap
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

end_unit

