begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/************************************************************ Copyright 1989 by The Massachusetts Institute of Technology  Permission to use, copy, modify, and distribute this software and its documentation for any purpose and without fee is hereby granted, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of MIT not be used in advertising or publicity pertaining to distribution of the software without specific prior written permission. M.I.T. makes no representation about the suitability of this software for any purpose. It is provided "as is" without any express or implied warranty.  ********************************************************/
end_comment

begin_comment
comment|/* $XConsortium: cfbzerarc.c,v 5.18 91/04/10 11:41:47 keith Exp $ */
end_comment

begin_comment
comment|/* Derived from:  * "Algorithm for drawing ellipses or hyperbolae with a digital plotter"  * by M. L. V. Pitteway  * The Computer Journal, November 1967, Volume 10, Number 3, pp. 282-289  */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xprotostr.h"
end_include

begin_include
include|#
directive|include
file|"miscstruct.h"
end_include

begin_include
include|#
directive|include
file|"gcstruct.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"cfb.h"
end_include

begin_include
include|#
directive|include
file|"cfbmskbits.h"
end_include

begin_include
include|#
directive|include
file|"mizerarc.h"
end_include

begin_include
include|#
directive|include
file|"cfbrrop.h"
end_include

begin_if
if|#
directive|if
name|PPW
operator|==
literal|4
end_if

begin_decl_stmt
specifier|extern
name|void
name|miPolyArc
argument_list|()
decl_stmt|,
name|miZeroPolyArc
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|RROP_NAME
function|(
name|cfbZeroArcSS8
function|)
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|arc
parameter_list|)
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|xArc
modifier|*
name|arc
decl_stmt|;
block|{
name|miZeroArcRec
name|info
decl_stmt|;
name|Bool
name|do360
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|;
name|unsigned
name|char
modifier|*
name|addrb
decl_stmt|;
specifier|register
name|unsigned
name|char
modifier|*
name|yorgb
decl_stmt|,
modifier|*
name|yorgob
decl_stmt|;
name|RROP_DECLARE
specifier|register
name|int
name|yoffset
decl_stmt|;
name|int
name|nbwidth
decl_stmt|,
name|dyoffset
decl_stmt|;
specifier|register
name|int
name|y
decl_stmt|,
name|a
decl_stmt|,
name|b
decl_stmt|,
name|d
decl_stmt|,
name|mask
decl_stmt|;
specifier|register
name|int
name|k1
decl_stmt|,
name|k3
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|cfbGetByteWidthAndPointer
argument_list|(
argument|pDraw
argument_list|,
argument|nbwidth
argument_list|,
argument|addrb
argument_list|)
name|SET_REGISTERS_FOR_WRITING
argument_list|(
name|pDraw
operator|->
name|pScreen
argument_list|,
operator|~
literal|0
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|RROP_FETCH_GC
argument_list|(
name|pGC
argument_list|)
expr_stmt|;
name|do360
operator|=
name|miZeroArcSetup
argument_list|(
name|arc
argument_list|,
operator|&
name|info
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|yorgb
operator|=
name|addrb
operator|+
operator|(
operator|(
name|info
operator|.
name|yorg
operator|+
name|pDraw
operator|->
name|y
operator|)
operator|*
name|nbwidth
operator|)
expr_stmt|;
name|yorgob
operator|=
name|addrb
operator|+
operator|(
operator|(
name|info
operator|.
name|yorgo
operator|+
name|pDraw
operator|->
name|y
operator|)
operator|*
name|nbwidth
operator|)
expr_stmt|;
name|info
operator|.
name|xorg
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|info
operator|.
name|xorgo
operator|+=
name|pDraw
operator|->
name|x
expr_stmt|;
name|MIARCSETUP
argument_list|()
expr_stmt|;
name|yoffset
operator|=
name|y
condition|?
name|nbwidth
else|:
literal|0
expr_stmt|;
name|dyoffset
operator|=
literal|0
expr_stmt|;
name|mask
operator|=
name|info
operator|.
name|initialMask
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|arc
operator|->
name|width
operator|&
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|mask
operator|&
literal|2
condition|)
name|RROP_SOLID
argument_list|(
operator|(
name|yorgb
operator|+
name|info
operator|.
name|xorgo
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|8
condition|)
name|RROP_SOLID
argument_list|(
operator|(
name|yorgob
operator|+
name|info
operator|.
name|xorgo
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|info
operator|.
name|end
operator|.
name|x
operator|||
operator|!
name|info
operator|.
name|end
operator|.
name|y
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|end
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|end
operator|=
name|info
operator|.
name|altend
expr_stmt|;
block|}
if|if
condition|(
name|do360
operator|&&
operator|(
name|arc
operator|->
name|width
operator|==
name|arc
operator|->
name|height
operator|)
operator|&&
operator|!
operator|(
name|arc
operator|->
name|width
operator|&
literal|1
operator|)
condition|)
block|{
specifier|register
name|int
name|xoffset
init|=
name|nbwidth
decl_stmt|;
name|unsigned
name|char
modifier|*
name|yorghb
init|=
name|yorgb
operator|+
operator|(
name|info
operator|.
name|h
operator|*
name|nbwidth
operator|)
operator|+
name|info
operator|.
name|xorg
decl_stmt|;
name|unsigned
name|char
modifier|*
name|yorgohb
init|=
name|yorghb
operator|-
name|info
operator|.
name|h
decl_stmt|;
name|yorgb
operator|+=
name|info
operator|.
name|xorg
expr_stmt|;
name|yorgob
operator|+=
name|info
operator|.
name|xorg
expr_stmt|;
name|yorghb
operator|+=
name|info
operator|.
name|h
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|-
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|-
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|<
literal|0
condition|)
break|break;
name|RROP_SOLID
argument_list|(
name|yorghb
operator|-
name|xoffset
operator|-
name|y
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgohb
operator|-
name|xoffset
operator|+
name|y
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgohb
operator|+
name|xoffset
operator|+
name|y
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorghb
operator|+
name|xoffset
operator|-
name|y
argument_list|)
expr_stmt|;
name|xoffset
operator|+=
name|nbwidth
expr_stmt|;
name|MIARCCIRCLESTEP
argument_list|(
argument|yoffset += nbwidth;
argument_list|)
empty_stmt|;
block|}
name|yorgb
operator|-=
name|info
operator|.
name|xorg
expr_stmt|;
name|yorgob
operator|-=
name|info
operator|.
name|xorg
expr_stmt|;
name|x
operator|=
name|info
operator|.
name|w
expr_stmt|;
name|yoffset
operator|=
name|info
operator|.
name|h
operator|*
name|nbwidth
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|do360
condition|)
block|{
while|while
condition|(
name|y
operator|<
name|info
operator|.
name|h
operator|||
name|x
operator|<
name|info
operator|.
name|w
condition|)
block|{
name|MIARCOCTANTSHIFT
argument_list|(
argument|dyoffset = nbwidth;
argument_list|)
empty_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
name|MIARCSTEP
argument_list|(
argument|yoffset += dyoffset;
argument_list|,
argument|yoffset += nbwidth;
argument_list|)
empty_stmt|;
block|}
block|}
else|else
block|{
while|while
condition|(
name|y
operator|<
name|info
operator|.
name|h
operator|||
name|x
operator|<
name|info
operator|.
name|w
condition|)
block|{
name|MIARCOCTANTSHIFT
argument_list|(
argument|dyoffset = nbwidth;
argument_list|)
empty_stmt|;
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|start
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|start
operator|.
name|y
operator|)
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|start
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|start
operator|=
name|info
operator|.
name|altstart
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
literal|1
condition|)
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|2
condition|)
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|4
condition|)
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|8
condition|)
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|end
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|end
operator|.
name|y
operator|)
condition|)
block|{
name|mask
operator|=
name|info
operator|.
name|end
operator|.
name|mask
expr_stmt|;
name|info
operator|.
name|end
operator|=
name|info
operator|.
name|altend
expr_stmt|;
block|}
name|MIARCSTEP
argument_list|(
argument|yoffset += dyoffset;
argument_list|,
argument|yoffset += nbwidth;
argument_list|)
empty_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|x
operator|==
name|info
operator|.
name|start
operator|.
name|x
operator|)
operator|||
operator|(
name|y
operator|==
name|info
operator|.
name|start
operator|.
name|y
operator|)
condition|)
name|mask
operator|=
name|info
operator|.
name|start
operator|.
name|mask
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|1
condition|)
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|4
condition|)
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|arc
operator|->
name|height
operator|&
literal|1
condition|)
block|{
if|if
condition|(
name|mask
operator|&
literal|2
condition|)
name|RROP_SOLID
argument_list|(
name|yorgb
operator|+
name|yoffset
operator|+
name|info
operator|.
name|xorgo
operator|-
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
operator|&
literal|8
condition|)
name|RROP_SOLID
argument_list|(
name|yorgob
operator|-
name|yoffset
operator|+
name|info
operator|.
name|xorg
operator|+
name|x
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|RROP_NAME
function|(
name|cfbZeroPolyArcSS8
function|)
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|narcs
parameter_list|,
name|parcs
parameter_list|)
specifier|register
name|DrawablePtr
name|pDraw
decl_stmt|;
name|GCPtr
name|pGC
decl_stmt|;
name|int
name|narcs
decl_stmt|;
name|xArc
modifier|*
name|parcs
decl_stmt|;
block|{
specifier|register
name|xArc
modifier|*
name|arc
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|BoxRec
name|box
decl_stmt|;
name|RegionPtr
name|cclip
decl_stmt|;
name|cclip
operator|=
operator|(
operator|(
name|cfbPrivGC
operator|*
operator|)
operator|(
name|pGC
operator|->
name|devPrivates
index|[
name|cfbGCPrivateIndex
index|]
operator|.
name|ptr
operator|)
operator|)
operator|->
name|pCompositeClip
expr_stmt|;
for|for
control|(
name|arc
operator|=
name|parcs
operator|,
name|i
operator|=
name|narcs
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
name|arc
operator|++
control|)
block|{
if|if
condition|(
name|miCanZeroArc
argument_list|(
name|arc
argument_list|)
condition|)
block|{
name|box
operator|.
name|x1
operator|=
name|arc
operator|->
name|x
operator|+
name|pDraw
operator|->
name|x
expr_stmt|;
name|box
operator|.
name|y1
operator|=
name|arc
operator|->
name|y
operator|+
name|pDraw
operator|->
name|y
expr_stmt|;
name|box
operator|.
name|x2
operator|=
name|box
operator|.
name|x1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|width
operator|+
literal|1
expr_stmt|;
name|box
operator|.
name|y2
operator|=
name|box
operator|.
name|y1
operator|+
operator|(
name|int
operator|)
name|arc
operator|->
name|height
operator|+
literal|1
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|pDraw
operator|->
name|pScreen
operator|->
name|RectIn
call|)
argument_list|(
name|cclip
argument_list|,
operator|&
name|box
argument_list|)
operator|==
name|rgnIN
condition|)
name|RROP_NAME
function_decl|(
name|cfbZeroArcSS8
function_decl|)
parameter_list|(
name|pDraw
parameter_list|,
name|pGC
parameter_list|,
name|arc
parameter_list|)
function_decl|;
else|else
name|miZeroPolyArc
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
literal|1
argument_list|,
name|arc
argument_list|)
expr_stmt|;
block|}
else|else
name|miPolyArc
argument_list|(
name|pDraw
argument_list|,
name|pGC
argument_list|,
literal|1
argument_list|,
name|arc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

