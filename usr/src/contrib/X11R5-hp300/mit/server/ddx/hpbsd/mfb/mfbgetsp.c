begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Combined Purdue/PurduePlus patches, level 2.0, 1/17/89 */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_comment
comment|/* $XConsortium: mfbgetsp.c,v 5.5 89/09/14 16:26:46 rws Exp $ */
end_comment

begin_include
include|#
directive|include
file|"X.h"
end_include

begin_include
include|#
directive|include
file|"Xmd.h"
end_include

begin_include
include|#
directive|include
file|"misc.h"
end_include

begin_include
include|#
directive|include
file|"region.h"
end_include

begin_include
include|#
directive|include
file|"gc.h"
end_include

begin_include
include|#
directive|include
file|"windowstr.h"
end_include

begin_include
include|#
directive|include
file|"pixmapstr.h"
end_include

begin_include
include|#
directive|include
file|"scrnintstr.h"
end_include

begin_include
include|#
directive|include
file|"mfb.h"
end_include

begin_include
include|#
directive|include
file|"maskbits.h"
end_include

begin_include
include|#
directive|include
file|"servermd.h"
end_include

begin_comment
comment|/* GetSpans -- for each span, gets bits from drawable starting at ppt[i]  * and continuing for pwidth[i] bits  * Each scanline returned will be server scanline padded, i.e., it will come  * out to an integral number of words.  */
end_comment

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
name|void
name|mfbGetSpans
parameter_list|(
name|pDrawable
parameter_list|,
name|wMax
parameter_list|,
name|ppt
parameter_list|,
name|pwidth
parameter_list|,
name|nspans
parameter_list|,
name|pdstStart
parameter_list|)
name|DrawablePtr
name|pDrawable
decl_stmt|;
comment|/* drawable from which to get bits */
name|int
name|wMax
decl_stmt|;
comment|/* largest value of all *pwidths */
specifier|register
name|DDXPointPtr
name|ppt
decl_stmt|;
comment|/* points to start copying from */
name|int
modifier|*
name|pwidth
decl_stmt|;
comment|/* list of number of bits to copy */
name|int
name|nspans
decl_stmt|;
comment|/* number of scanlines to copy */
name|unsigned
name|int
modifier|*
name|pdstStart
decl_stmt|;
comment|/* where to put the bits */
block|{
specifier|register
name|unsigned
name|int
modifier|*
name|pdst
decl_stmt|;
comment|/* where to put the bits */
specifier|register
name|unsigned
name|int
modifier|*
name|psrc
decl_stmt|;
comment|/* where to get the bits */
specifier|register
name|unsigned
name|int
name|tmpSrc
decl_stmt|;
comment|/* scratch buffer for bits */
name|unsigned
name|int
modifier|*
name|psrcBase
decl_stmt|;
comment|/* start of src bitmap */
name|int
name|widthSrc
decl_stmt|;
comment|/* width of pixmap in bytes */
specifier|register
name|DDXPointPtr
name|pptLast
decl_stmt|;
comment|/* one past last point to get */
name|int
name|xEnd
decl_stmt|;
comment|/* last pixel to copy from */
specifier|register
name|int
name|nstart
decl_stmt|;
name|int
name|nend
decl_stmt|;
name|int
name|srcStartOver
decl_stmt|;
name|int
name|startmask
decl_stmt|,
name|endmask
decl_stmt|,
name|nlMiddle
decl_stmt|,
name|nl
decl_stmt|,
name|srcBit
decl_stmt|;
name|int
name|w
decl_stmt|;
name|pptLast
operator|=
name|ppt
operator|+
name|nspans
expr_stmt|;
if|if
condition|(
name|pDrawable
operator|->
name|type
operator|==
name|DRAWABLE_WINDOW
condition|)
block|{
name|psrcBase
operator|=
operator|(
name|unsigned
name|int
operator|*
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
operator|->
name|bits
expr_stmt|;
name|widthSrc
operator|=
operator|(
name|int
operator|)
name|getPrivScreenPtr
argument_list|(
name|pDrawable
operator|->
name|pScreen
argument_list|)
operator|->
name|stride
expr_stmt|;
block|}
else|else
block|{
name|psrcBase
operator|=
operator|(
name|unsigned
name|int
operator|*
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|bits
expr_stmt|;
name|widthSrc
operator|=
operator|(
name|int
operator|)
name|getPrivPixmapPtr
argument_list|(
name|pDrawable
argument_list|)
operator|->
name|stride
expr_stmt|;
block|}
name|pdst
operator|=
name|pdstStart
expr_stmt|;
while|while
condition|(
name|ppt
operator|<
name|pptLast
condition|)
block|{
name|xEnd
operator|=
name|min
argument_list|(
name|ppt
operator|->
name|x
operator|+
operator|*
name|pwidth
argument_list|,
name|widthSrc
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|pwidth
operator|++
expr_stmt|;
name|psrc
operator|=
name|psrcBase
operator|+
operator|(
name|ppt
operator|->
name|y
operator|*
operator|(
name|widthSrc
operator|>>
literal|2
operator|)
operator|)
operator|+
operator|(
name|ppt
operator|->
name|x
operator|>>
literal|5
operator|)
expr_stmt|;
name|w
operator|=
name|xEnd
operator|-
name|ppt
operator|->
name|x
expr_stmt|;
name|srcBit
operator|=
name|ppt
operator|->
name|x
operator|&
literal|0x1f
expr_stmt|;
if|if
condition|(
name|srcBit
operator|+
name|w
operator|<=
literal|32
condition|)
block|{
name|getandputbits0
argument_list|(
name|psrc
argument_list|,
name|srcBit
argument_list|,
name|w
argument_list|,
name|pdst
argument_list|)
expr_stmt|;
name|pdst
operator|++
expr_stmt|;
block|}
else|else
block|{
name|maskbits
argument_list|(
name|ppt
operator|->
name|x
argument_list|,
name|w
argument_list|,
name|startmask
argument_list|,
name|endmask
argument_list|,
name|nlMiddle
argument_list|)
expr_stmt|;
if|if
condition|(
name|startmask
condition|)
name|nstart
operator|=
literal|32
operator|-
name|srcBit
expr_stmt|;
else|else
name|nstart
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|endmask
condition|)
name|nend
operator|=
name|xEnd
operator|&
literal|0x1f
expr_stmt|;
name|srcStartOver
operator|=
name|srcBit
operator|+
name|nstart
operator|>
literal|31
expr_stmt|;
if|if
condition|(
name|startmask
condition|)
block|{
name|getandputbits0
argument_list|(
name|psrc
argument_list|,
name|srcBit
argument_list|,
name|nstart
argument_list|,
name|pdst
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcStartOver
condition|)
name|psrc
operator|++
expr_stmt|;
block|}
name|nl
operator|=
name|nlMiddle
expr_stmt|;
ifdef|#
directive|ifdef
name|FASTPUTBITS
name|Duff
argument_list|(
argument|nl
argument_list|,
argument|putbits(*psrc, nstart,
literal|32
argument|, pdst); psrc++; pdst++;
argument_list|)
empty_stmt|;
else|#
directive|else
while|while
condition|(
name|nl
operator|--
condition|)
block|{
name|tmpSrc
operator|=
operator|*
name|psrc
expr_stmt|;
name|putbits
argument_list|(
name|tmpSrc
argument_list|,
name|nstart
argument_list|,
literal|32
argument_list|,
name|pdst
argument_list|)
expr_stmt|;
name|psrc
operator|++
expr_stmt|;
name|pdst
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|endmask
condition|)
block|{
name|putbits
argument_list|(
operator|*
name|psrc
argument_list|,
name|nstart
argument_list|,
name|nend
argument_list|,
name|pdst
argument_list|)
expr_stmt|;
if|if
condition|(
name|nstart
operator|+
name|nend
operator|>
literal|32
condition|)
name|pdst
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|startmask
operator|||
name|endmask
condition|)
name|pdst
operator|++
expr_stmt|;
block|}
name|ppt
operator|++
expr_stmt|;
block|}
block|}
end_function

end_unit

