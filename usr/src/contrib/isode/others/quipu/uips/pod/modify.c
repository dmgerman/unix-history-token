begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<malloc.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"quipu/util.h"
end_include

begin_include
include|#
directive|include
file|"quipu/common.h"
end_include

begin_include
include|#
directive|include
file|"quipu/entry.h"
end_include

begin_include
include|#
directive|include
file|"quipu/modify.h"
end_include

begin_include
include|#
directive|include
file|"quipu/name.h"
end_include

begin_include
include|#
directive|include
file|"sequence.h"
end_include

begin_include
include|#
directive|include
file|"dir_entry.h"
end_include

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_define
define|#
directive|define
name|AS_SYNTAX
parameter_list|(
name|attrSeq
parameter_list|)
value|attrSeq->attr_type->oa_syntax
end_define

begin_define
define|#
directive|define
name|AS_STROID
parameter_list|(
name|attrSeq
parameter_list|)
value|attrSeq->attr_type->oa_ot.ot_stroid
end_define

begin_define
define|#
directive|define
name|FOREACH
parameter_list|(
name|a
parameter_list|)
value|for (eptr = a; eptr != NULLATTR; eptr=eptr->attr_link)
end_define

begin_decl_stmt
specifier|extern
name|bool
name|photo_on
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|modify_error
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|Attr_Sequence
name|as_sort
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|void
name|char_map
argument_list|()
decl_stmt|,
name|char_unmap
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Attr_Sequence
name|eptr
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|NO_STATS
end_ifndef

begin_decl_stmt
specifier|extern
name|LLog
modifier|*
name|log_stat
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|struct
name|entrymod
modifier|*
name|ems_append
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
name|struct
name|entrymod
modifier|*
name|a
decl_stmt|;
name|struct
name|entrymod
modifier|*
name|b
decl_stmt|;
block|{
name|struct
name|entrymod
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
operator|(
name|ptr
operator|=
name|a
operator|)
operator|==
name|NULLMOD
condition|)
return|return
name|b
return|;
for|for
control|(
init|;
name|ptr
operator|->
name|em_next
operator|!=
name|NULLMOD
condition|;
name|ptr
operator|=
name|ptr
operator|->
name|em_next
control|)
empty_stmt|;
name|ptr
operator|->
name|em_next
operator|=
name|b
expr_stmt|;
return|return
name|a
return|;
block|}
end_function

begin_function
name|dsErrorStruct
name|modify_entry
parameter_list|(
name|mods
parameter_list|)
name|dirEntry
name|mods
decl_stmt|;
block|{
name|struct
name|ds_modifyentry_arg
name|mod_arg
decl_stmt|;
name|dsErrorStruct
name|mod_error
decl_stmt|;
name|struct
name|DSError
name|error
decl_stmt|;
name|struct
name|entrymod
modifier|*
name|curr_mod
init|=
literal|0
decl_stmt|,
modifier|*
name|entrymods
init|=
literal|0
decl_stmt|;
name|AttributeType
name|attr_type
init|=
literal|0
decl_stmt|;
name|AttributeValue
name|attr_val
init|=
literal|0
decl_stmt|;
name|AV_Sequence
name|attrVal_seq
init|=
literal|0
decl_stmt|;
specifier|register
name|modVals
name|curr_val
decl_stmt|;
name|dirAttrs
name|attrs
decl_stmt|;
name|char
name|err_buf
index|[
name|STRINGLEN
index|]
decl_stmt|,
name|attr_val_buf
index|[
name|STRINGLEN
index|]
decl_stmt|;
name|short
name|attr_removed
decl_stmt|;
if|if
condition|(
name|get_default_service
argument_list|(
operator|&
name|mod_arg
operator|.
name|mea_common
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|mod_error
operator|.
name|error
operator|=
name|serviceerror
expr_stmt|;
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Directory Service Error!\n"
argument_list|)
expr_stmt|;
block|}
name|mod_arg
operator|.
name|mea_common
operator|.
name|ca_servicecontrol
operator|.
name|svc_options
operator|=
name|SVC_OPT_PREFERCHAIN
expr_stmt|;
name|mod_arg
operator|.
name|mea_object
operator|=
name|str2dn
argument_list|(
name|mods
operator|->
name|entry_name
argument_list|)
expr_stmt|;
for|for
control|(
name|attrs
operator|=
name|mods
operator|->
name|attrs
init|;
name|attrs
condition|;
name|attrs
operator|=
name|attrs
operator|->
name|next
control|)
block|{
if|if
condition|(
name|attrs
operator|->
name|mod_flag
condition|)
block|{
name|attr_type
operator|=
name|str2AttrT
argument_list|(
name|attrs
operator|->
name|attr_name
argument_list|)
expr_stmt|;
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
operator|&&
name|curr_val
operator|->
name|mod_flag
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
empty_stmt|;
if|if
condition|(
operator|!
name|curr_val
condition|)
block|{
if|if
condition|(
name|attrs
operator|->
name|in_flag
condition|)
block|{
name|curr_mod
operator|=
name|em_alloc
argument_list|()
expr_stmt|;
name|curr_mod
operator|->
name|em_next
operator|=
name|NULLMOD
expr_stmt|;
name|curr_mod
operator|->
name|em_type
operator|=
name|EM_REMOVEATTRIBUTE
expr_stmt|;
name|curr_mod
operator|->
name|em_what
operator|=
name|NULLATTR
expr_stmt|;
name|curr_mod
operator|->
name|em_what
operator|=
name|as_comp_new
argument_list|(
name|attr_type
argument_list|,
name|NULLAV
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|entrymods
operator|=
name|ems_append
argument_list|(
name|entrymods
argument_list|,
name|curr_mod
argument_list|)
expr_stmt|;
block|}
name|curr_mod
operator|=
name|em_alloc
argument_list|()
expr_stmt|;
name|curr_mod
operator|->
name|em_next
operator|=
name|NULLMOD
expr_stmt|;
name|curr_mod
operator|->
name|em_type
operator|=
name|EM_ADDATTRIBUTE
expr_stmt|;
name|curr_mod
operator|->
name|em_what
operator|=
name|NULLATTR
expr_stmt|;
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
block|{
name|char_unmap
argument_list|(
name|attr_val_buf
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr_val_buf
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|attr_val
operator|=
name|str2AttrV
argument_list|(
name|attr_val_buf
argument_list|,
name|attr_type
operator|->
name|oa_syntax
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr_val
condition|)
block|{
if|if
condition|(
name|attrVal_seq
condition|)
name|attrVal_seq
operator|=
name|avs_merge
argument_list|(
name|attrVal_seq
argument_list|,
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|attrVal_seq
operator|=
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|entrymods
condition|)
name|ems_free
argument_list|(
name|entrymods
argument_list|)
expr_stmt|;
name|AttrT_free
argument_list|(
name|attr_type
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|error
operator|=
name|attributerror
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|err_buf
argument_list|,
literal|"Attribute Error!\nInvalid syntax for value %s type %s."
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|,
name|attrs
operator|->
name|attr_name
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
name|err_buf
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
block|}
block|}
if|if
condition|(
name|attrVal_seq
condition|)
block|{
name|curr_mod
operator|->
name|em_what
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|attr_type
argument_list|)
argument_list|,
name|attrVal_seq
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|entrymods
operator|=
name|ems_append
argument_list|(
name|entrymods
argument_list|,
name|curr_mod
argument_list|)
expr_stmt|;
name|attrVal_seq
operator|=
literal|0
expr_stmt|;
name|curr_mod
operator|=
literal|0
expr_stmt|;
name|AttrT_free
argument_list|(
name|attr_type
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|attrs
operator|->
name|in_flag
condition|)
block|{
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
block|{
name|char_unmap
argument_list|(
name|attr_val_buf
argument_list|,
name|curr_val
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|curr_val
operator|->
name|mod_flag
operator|&&
name|attr_val_buf
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|attrVal_seq
operator|=
name|avs_comp_new
argument_list|(
name|str2AttrV
argument_list|(
name|attr_val_buf
argument_list|,
name|attr_type
operator|->
name|oa_syntax
argument_list|)
argument_list|)
expr_stmt|;
name|curr_mod
operator|=
name|em_alloc
argument_list|()
expr_stmt|;
name|curr_mod
operator|->
name|em_next
operator|=
name|NULLMOD
expr_stmt|;
name|curr_mod
operator|->
name|em_type
operator|=
name|EM_REMOVEVALUES
expr_stmt|;
name|curr_mod
operator|->
name|em_what
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|attr_type
argument_list|)
argument_list|,
name|attrVal_seq
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|entrymods
operator|=
name|ems_append
argument_list|(
name|entrymods
argument_list|,
name|curr_mod
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
block|{
name|char_unmap
argument_list|(
name|attr_val_buf
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|curr_val
operator|->
name|mod_flag
operator|&&
name|attr_val_buf
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|attr_val
operator|=
name|str2AttrV
argument_list|(
name|attr_val_buf
argument_list|,
name|attr_type
operator|->
name|oa_syntax
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr_val
condition|)
block|{
if|if
condition|(
name|attrVal_seq
condition|)
name|attrVal_seq
operator|=
name|avs_merge
argument_list|(
name|attrVal_seq
argument_list|,
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|attrVal_seq
operator|=
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|entrymods
condition|)
name|ems_free
argument_list|(
name|entrymods
argument_list|)
expr_stmt|;
name|AttrT_free
argument_list|(
name|attr_type
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|error
operator|=
name|attributerror
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|err_buf
argument_list|,
literal|"Attribute Error!\nInvalid syntax for value %s type %s."
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|,
name|attrs
operator|->
name|attr_name
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
name|err_buf
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
name|curr_mod
operator|=
name|em_alloc
argument_list|()
expr_stmt|;
name|curr_mod
operator|->
name|em_next
operator|=
name|NULLMOD
expr_stmt|;
name|curr_mod
operator|->
name|em_type
operator|=
name|EM_ADDVALUES
expr_stmt|;
name|curr_mod
operator|->
name|em_what
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|attr_type
argument_list|)
argument_list|,
name|attrVal_seq
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|entrymods
operator|=
name|ems_append
argument_list|(
name|entrymods
argument_list|,
name|curr_mod
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|curr_mod
operator|=
name|em_alloc
argument_list|()
expr_stmt|;
name|curr_mod
operator|->
name|em_next
operator|=
name|NULLMOD
expr_stmt|;
name|curr_mod
operator|->
name|em_type
operator|=
name|EM_ADDATTRIBUTE
expr_stmt|;
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
block|{
name|char_unmap
argument_list|(
name|attr_val_buf
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr_val_buf
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|attr_val
operator|=
name|str2AttrV
argument_list|(
name|attr_val_buf
argument_list|,
name|attr_type
operator|->
name|oa_syntax
argument_list|)
expr_stmt|;
if|if
condition|(
name|attr_val
condition|)
block|{
if|if
condition|(
name|attrVal_seq
condition|)
name|attrVal_seq
operator|=
name|avs_merge
argument_list|(
name|attrVal_seq
argument_list|,
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|attrVal_seq
operator|=
name|avs_comp_new
argument_list|(
name|attr_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|entrymods
condition|)
name|ems_free
argument_list|(
name|entrymods
argument_list|)
expr_stmt|;
name|AttrT_free
argument_list|(
name|attr_type
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|error
operator|=
name|attributerror
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|err_buf
argument_list|,
literal|"Attribute Error!\nInvalid syntax for value %s type %s."
argument_list|,
name|curr_val
operator|->
name|new_value
argument_list|,
name|attrs
operator|->
name|attr_name
argument_list|)
expr_stmt|;
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
name|err_buf
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
block|}
block|}
if|if
condition|(
name|attrVal_seq
condition|)
block|{
name|curr_mod
operator|->
name|em_what
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|attr_type
argument_list|)
argument_list|,
name|attrVal_seq
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|entrymods
operator|=
name|ems_append
argument_list|(
name|entrymods
argument_list|,
name|curr_mod
argument_list|)
expr_stmt|;
name|attrVal_seq
operator|=
literal|0
expr_stmt|;
name|curr_mod
operator|=
literal|0
expr_stmt|;
name|AttrT_free
argument_list|(
name|attr_type
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
if|if
condition|(
name|entrymods
condition|)
block|{
name|mod_arg
operator|.
name|mea_changes
operator|=
name|entrymods
expr_stmt|;
if|if
condition|(
name|ds_modifyentry
argument_list|(
operator|&
name|mod_arg
argument_list|,
operator|&
name|error
argument_list|)
operator|!=
name|DS_OK
condition|)
block|{
name|mod_error
operator|.
name|err_mess
operator|=
name|modify_error
argument_list|(
operator|&
name|error
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|error
operator|.
name|dse_type
condition|)
block|{
case|case
name|DSE_LOCALERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|duaerror
expr_stmt|;
if|if
condition|(
operator|!
name|mod_error
operator|.
name|err_mess
condition|)
block|{
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Internal Error, No modifications made. Sorry!"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_REMOTEERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|localdsaerror
expr_stmt|;
break|break;
case|case
name|DSE_ATTRIBUTEERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|attributerror
expr_stmt|;
if|if
condition|(
operator|!
name|mod_error
operator|.
name|err_mess
condition|)
block|{
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Attribute Error! No Modifications made."
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_REFERRAL
case|:
case|case
name|DSE_DSAREFERRAL
case|:
name|mod_error
operator|.
name|error
operator|=
name|remotedsaerror
expr_stmt|;
if|if
condition|(
operator|!
name|mod_error
operator|.
name|err_mess
condition|)
block|{
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Referral Error! No Modifications made."
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_SECURITYERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|security
expr_stmt|;
if|if
condition|(
operator|!
name|mod_error
operator|.
name|err_mess
condition|)
block|{
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Security Error! Check access rights."
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_NAMEERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|namerror
expr_stmt|;
if|if
condition|(
operator|!
name|mod_error
operator|.
name|err_mess
condition|)
block|{
switch|switch
condition|(
name|error
operator|.
name|dse_un
operator|.
name|dse_un_name
operator|.
name|DSE_na_problem
condition|)
block|{
case|case
name|DSE_NA_NOSUCHOBJECT
case|:
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Name Error! No such object."
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_NA_ALIASPROBLEM
case|:
case|case
name|DSE_NA_ALIASDEREFERENCE
case|:
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Error! Alias problem."
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_NA_INVALIDATTRIBUTESYNTAX
case|:
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"Name Error! Invalid attribute syntax."
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
break|break;
case|case
name|DSE_SERVICEERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|serviceerror
expr_stmt|;
break|break;
case|case
name|DSE_UPDATEERROR
case|:
name|mod_error
operator|.
name|error
operator|=
name|updaterror
expr_stmt|;
break|break;
default|default:
name|mod_error
operator|.
name|error
operator|=
name|localdsaerror
expr_stmt|;
break|break;
block|}
name|ds_error_free
argument_list|(
operator|&
name|error
argument_list|)
expr_stmt|;
name|dn_free
argument_list|(
name|mod_arg
operator|.
name|mea_object
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
else|else
block|{
name|ems_free
argument_list|(
name|entrymods
argument_list|)
expr_stmt|;
name|delete_cache
argument_list|(
name|mod_arg
operator|.
name|mea_object
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|mod_error
operator|.
name|error
operator|=
name|updaterror
expr_stmt|;
name|mod_error
operator|.
name|err_mess
operator|=
name|strdup
argument_list|(
literal|"No modifications to make!"
argument_list|)
expr_stmt|;
name|dn_free
argument_list|(
name|mod_arg
operator|.
name|mea_object
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
for|for
control|(
name|attrs
operator|=
name|mods
operator|->
name|attrs
init|;
name|attrs
condition|;
name|attrs
operator|=
name|attrs
operator|->
name|next
control|)
block|{
if|if
condition|(
name|attrs
operator|->
name|mod_flag
operator|==
name|TRUE
operator|&&
name|attrs
operator|->
name|in_flag
operator|==
name|FALSE
condition|)
name|attrs
operator|->
name|in_flag
operator|=
name|TRUE
expr_stmt|;
name|attrs
operator|->
name|mod_flag
operator|=
name|FALSE
expr_stmt|;
name|attr_removed
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|curr_val
operator|=
name|attrs
operator|->
name|val_seq
init|;
name|curr_val
condition|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
control|)
block|{
if|if
condition|(
name|curr_val
operator|->
name|new_value
operator|!=
name|NULLCP
condition|)
block|{
if|if
condition|(
name|curr_val
operator|->
name|value
operator|!=
name|NULLCP
condition|)
name|free
argument_list|(
name|curr_val
operator|->
name|value
argument_list|)
expr_stmt|;
name|curr_val
operator|->
name|value
operator|=
name|curr_val
operator|->
name|new_value
expr_stmt|;
name|curr_val
operator|->
name|new_value
operator|=
name|NULLCP
expr_stmt|;
name|attr_removed
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|curr_val
operator|->
name|value
operator|&&
operator|*
name|curr_val
operator|->
name|value
operator|!=
literal|'\0'
operator|&&
operator|!
name|curr_val
operator|->
name|mod_flag
condition|)
name|attr_removed
operator|=
name|FALSE
expr_stmt|;
name|curr_val
operator|->
name|mod_flag
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|attr_removed
condition|)
name|attrs
operator|->
name|in_flag
operator|=
name|FALSE
expr_stmt|;
block|}
name|mod_error
operator|.
name|error
operator|=
name|Okay
expr_stmt|;
name|dn_free
argument_list|(
name|mod_arg
operator|.
name|mea_object
argument_list|)
expr_stmt|;
return|return
name|mod_error
return|;
block|}
end_function

begin_function
name|void
name|make_template
parameter_list|(
name|entry_name
parameter_list|,
name|attrs
parameter_list|)
name|char
modifier|*
name|entry_name
decl_stmt|;
name|dirAttrs
modifier|*
name|attrs
decl_stmt|;
block|{
specifier|static
name|char
name|buffer
index|[
name|RESBUF
index|]
decl_stmt|;
name|PS
name|ps
decl_stmt|;
specifier|extern
name|AttributeType
name|at_objectclass
decl_stmt|;
name|struct
name|ds_read_arg
name|read_arg
decl_stmt|;
name|struct
name|ds_read_result
name|result
decl_stmt|;
name|struct
name|DSError
name|error
decl_stmt|;
name|Entry
name|read_entry
decl_stmt|;
name|Attr_Sequence
name|as
decl_stmt|,
name|read_attrs
decl_stmt|;
name|Attr_Sequence
name|nas
init|=
literal|0
decl_stmt|,
name|tas
init|=
literal|0
decl_stmt|,
name|templ_as
decl_stmt|,
name|make_template_as
argument_list|()
decl_stmt|;
name|buffer
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|*
name|attrs
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|*
name|entry_name
operator|==
literal|'\0'
condition|)
return|return;
if|if
condition|(
operator|(
name|ps
operator|=
name|ps_alloc
argument_list|(
name|str_open
argument_list|)
operator|)
operator|==
name|NULLPS
condition|)
return|return;
if|if
condition|(
name|str_setup
argument_list|(
name|ps
argument_list|,
name|buffer
argument_list|,
name|RESBUF
argument_list|,
literal|1
argument_list|)
operator|==
name|NOTOK
condition|)
return|return;
if|if
condition|(
name|get_default_service
argument_list|(
operator|&
name|read_arg
operator|.
name|rda_common
argument_list|)
operator|!=
literal|0
condition|)
return|return;
name|read_arg
operator|.
name|rda_common
operator|.
name|ca_servicecontrol
operator|.
name|svc_options
operator|=
name|SVC_OPT_PREFERCHAIN
expr_stmt|;
name|read_arg
operator|.
name|rda_eis
operator|.
name|eis_allattributes
operator|=
name|TRUE
expr_stmt|;
name|read_arg
operator|.
name|rda_eis
operator|.
name|eis_infotypes
operator|=
name|EIS_ATTRIBUTESANDVALUES
expr_stmt|;
name|read_arg
operator|.
name|rda_object
operator|=
name|str2dn
argument_list|(
name|entry_name
argument_list|)
expr_stmt|;
name|photo_on
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
name|read_entry
operator|=
name|local_find_entry
argument_list|(
name|read_arg
operator|.
name|rda_object
argument_list|,
name|FALSE
argument_list|)
operator|)
operator|!=
name|NULLENTRY
operator|&&
name|read_entry
operator|->
name|e_data
operator|!=
name|E_TYPE_CONSTRUCTOR
condition|)
block|{
name|read_attrs
operator|=
name|read_entry
operator|->
name|e_attributes
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|ds_read
argument_list|(
operator|&
name|read_arg
argument_list|,
operator|&
name|error
argument_list|,
operator|&
name|result
argument_list|)
operator|!=
name|DS_OK
condition|)
block|{
name|photo_on
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|result
operator|.
name|rdr_entry
operator|.
name|ent_attr
operator|==
name|NULLATTR
condition|)
block|{
name|photo_on
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
name|read_attrs
operator|=
name|result
operator|.
name|rdr_entry
operator|.
name|ent_attr
expr_stmt|;
block|}
for|for
control|(
name|as
operator|=
name|read_attrs
init|;
name|as
operator|!=
name|NULLATTR
condition|;
name|as
operator|=
name|as
operator|->
name|attr_link
control|)
if|if
condition|(
name|as
operator|->
name|attr_type
operator|==
name|at_objectclass
condition|)
break|break;
name|templ_as
operator|=
name|make_template_as
argument_list|(
name|as
operator|->
name|attr_value
argument_list|)
expr_stmt|;
for|for
control|(
name|as
operator|=
name|read_attrs
init|;
name|as
operator|!=
name|NULLATTR
condition|;
name|as
operator|=
name|as
operator|->
name|attr_link
control|)
if|if
condition|(
operator|!
operator|(
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"schema"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"objectclass"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"acl"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"edbinfo"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"octetstring"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|AS_STROID
argument_list|(
name|as
argument_list|)
argument_list|,
literal|"0.9.2342.19200300.100.1.23"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|AS_STROID
argument_list|(
name|as
argument_list|)
argument_list|,
literal|"0.9.2342.19200300.100.1.24"
argument_list|)
operator|)
condition|)
block|{
name|nas
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|as
operator|->
name|attr_type
argument_list|)
argument_list|,
name|avs_cpy
argument_list|(
name|as
operator|->
name|attr_value
argument_list|)
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
if|if
condition|(
name|tas
condition|)
name|tas
operator|=
name|as_merge
argument_list|(
name|tas
argument_list|,
name|nas
argument_list|)
expr_stmt|;
else|else
name|tas
operator|=
name|nas
expr_stmt|;
block|}
name|as
operator|=
name|templ_as
expr_stmt|;
name|nas
operator|=
name|templ_as
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
name|as
operator|!=
name|NULLATTR
condition|;
name|as
operator|=
name|as
operator|->
name|attr_link
control|)
if|if
condition|(
operator|!
operator|(
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"schema"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"objectclass"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"acl"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"edbinfo"
argument_list|)
operator|||
name|AS_SYNTAX
argument_list|(
name|as
argument_list|)
operator|==
name|str2syntax
argument_list|(
literal|"octetstring"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|AS_STROID
argument_list|(
name|as
argument_list|)
argument_list|,
literal|"0.9.2342.19200300.100.1.23"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|AS_STROID
argument_list|(
name|as
argument_list|)
argument_list|,
literal|"0.9.2342.19200300.100.1.24"
argument_list|)
operator|)
condition|)
block|{
name|nas
operator|=
name|as_comp_new
argument_list|(
name|AttrT_cpy
argument_list|(
name|as
operator|->
name|attr_type
argument_list|)
argument_list|,
name|NULLAV
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
if|if
condition|(
name|templ_as
condition|)
name|templ_as
operator|=
name|as_merge
argument_list|(
name|templ_as
argument_list|,
name|nas
argument_list|)
expr_stmt|;
else|else
name|templ_as
operator|=
name|nas
expr_stmt|;
block|}
name|as
operator|=
name|as_merge
argument_list|(
name|tas
argument_list|,
name|templ_as
argument_list|)
expr_stmt|;
name|as
operator|=
name|as_sort
argument_list|(
name|as
argument_list|)
expr_stmt|;
name|my_as_print
argument_list|(
name|ps
argument_list|,
name|as
argument_list|,
name|READOUT
argument_list|)
expr_stmt|;
operator|*
operator|--
name|ps
operator|->
name|ps_ptr
operator|=
name|NULL
operator|,
name|ps
operator|->
name|ps_cnt
operator|++
expr_stmt|;
name|photo_on
operator|=
name|TRUE
expr_stmt|;
name|ps_free
argument_list|(
name|ps
argument_list|)
expr_stmt|;
name|as_free
argument_list|(
name|as
argument_list|)
expr_stmt|;
name|make_attr_sequence
argument_list|(
name|buffer
argument_list|,
name|attrs
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|make_attr_sequence
argument_list|(
argument|entry_string
argument_list|,
argument|attrs
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|entry_string
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|dirAttrs
modifier|*
name|attrs
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|str
decl_stmt|,
modifier|*
name|sptr
decl_stmt|;
name|char
name|save
decl_stmt|,
name|buffer
index|[
name|RESBUF
index|]
decl_stmt|;
name|modVals
name|curr_val
init|=
literal|0
decl_stmt|;
name|dirAttrs
name|curr_attr
init|=
literal|0
decl_stmt|;
name|AttributeType
name|curr_attr_type
decl_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|;
name|str
operator|=
name|sptr
operator|=
name|entry_string
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|str
operator|=
name|index
argument_list|(
name|sptr
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str
operator|||
name|str
operator|==
name|sptr
condition|)
return|return;
while|while
condition|(
operator|!
name|isalpha
argument_list|(
operator|*
name|str
argument_list|)
condition|)
block|{
if|if
condition|(
name|str
operator|<
name|sptr
condition|)
return|return;
else|else
operator|--
name|str
expr_stmt|;
block|}
name|str
operator|++
expr_stmt|;
name|save
operator|=
operator|*
name|str
expr_stmt|;
operator|*
name|str
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|curr_attr
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|curr_attr
operator|->
name|attr_name
argument_list|,
name|sptr
argument_list|)
condition|)
block|{
name|curr_val
operator|=
literal|0
expr_stmt|;
name|curr_attr
operator|->
name|next
operator|=
operator|(
name|dirAttrs
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|dir_attrs
argument_list|)
argument_list|)
expr_stmt|;
name|curr_attr
operator|=
name|curr_attr
operator|->
name|next
expr_stmt|;
name|curr_attr
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|curr_attr
operator|->
name|val_seq
operator|=
literal|0
expr_stmt|;
name|curr_attr
operator|->
name|mod_flag
operator|=
name|FALSE
expr_stmt|;
name|curr_attr
operator|->
name|in_flag
operator|=
name|TRUE
expr_stmt|;
name|curr_attr
operator|->
name|attr_name
operator|=
name|strdup
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
name|curr_attr_type
operator|=
name|str2AttrT
argument_list|(
name|curr_attr
operator|->
name|attr_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|curr_attr_type
operator|->
name|oa_ot
operator|.
name|ot_stroid
argument_list|,
literal|"2.5.4.35"
argument_list|)
condition|)
name|curr_attr
operator|->
name|hidden_flag
operator|=
name|TRUE
expr_stmt|;
else|else
name|curr_attr
operator|->
name|hidden_flag
operator|=
name|FALSE
expr_stmt|;
name|AttrT_free
argument_list|(
name|curr_attr_type
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|curr_attr
operator|=
operator|(
name|dirAttrs
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|dir_attrs
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|attrs
operator|=
name|curr_attr
expr_stmt|;
name|curr_attr
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|curr_attr
operator|->
name|val_seq
operator|=
operator|(
name|modVals
operator|)
literal|0
expr_stmt|;
name|curr_attr
operator|->
name|mod_flag
operator|=
name|FALSE
expr_stmt|;
name|curr_attr
operator|->
name|in_flag
operator|=
name|TRUE
expr_stmt|;
name|curr_attr
operator|->
name|attr_name
operator|=
name|strdup
argument_list|(
name|sptr
argument_list|)
expr_stmt|;
name|curr_attr_type
operator|=
name|str2AttrT
argument_list|(
name|curr_attr
operator|->
name|attr_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|curr_attr_type
operator|->
name|oa_ot
operator|.
name|ot_stroid
argument_list|,
literal|"2.5.4.35"
argument_list|)
condition|)
name|curr_attr
operator|->
name|hidden_flag
operator|=
name|TRUE
expr_stmt|;
else|else
name|curr_attr
operator|->
name|hidden_flag
operator|=
name|FALSE
expr_stmt|;
name|AttrT_free
argument_list|(
name|curr_attr_type
argument_list|)
expr_stmt|;
block|}
operator|*
name|str
operator|=
name|save
expr_stmt|;
while|while
condition|(
operator|(
name|isspace
argument_list|(
operator|*
name|str
argument_list|)
operator|||
operator|(
operator|*
name|str
operator|==
literal|'-'
operator|)
operator|)
operator|&&
operator|*
name|str
operator|!=
literal|'\n'
operator|&&
operator|*
name|str
operator|!=
literal|'\0'
condition|)
name|str
operator|++
expr_stmt|;
name|sptr
operator|=
name|str
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
while|while
condition|(
operator|*
name|str
operator|!=
literal|'\n'
operator|&&
operator|*
name|str
operator|!=
literal|'\0'
condition|)
block|{
name|buffer
index|[
name|count
operator|++
index|]
operator|=
operator|*
name|str
expr_stmt|;
name|str
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|str
operator|!=
literal|'\0'
operator|&&
operator|*
operator|(
name|str
operator|+
literal|1
operator|)
operator|==
literal|'\t'
condition|)
block|{
name|buffer
index|[
name|count
operator|++
index|]
operator|=
literal|'\n'
expr_stmt|;
while|while
condition|(
name|isspace
argument_list|(
operator|*
name|str
argument_list|)
condition|)
name|str
operator|++
expr_stmt|;
block|}
else|else
break|break;
block|}
name|buffer
index|[
name|count
index|]
operator|=
literal|'\0'
expr_stmt|;
name|save
operator|=
operator|*
name|str
expr_stmt|;
operator|*
name|str
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|curr_val
condition|)
block|{
name|curr_val
operator|->
name|next
operator|=
operator|(
name|modVals
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|mod_vals
argument_list|)
argument_list|)
expr_stmt|;
name|curr_val
operator|=
name|curr_val
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|curr_val
operator|=
operator|(
name|modVals
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|mod_vals
argument_list|)
argument_list|)
expr_stmt|;
name|curr_attr
operator|->
name|val_seq
operator|=
name|curr_val
expr_stmt|;
if|if
condition|(
operator|!
name|count
condition|)
name|curr_attr
operator|->
name|in_flag
operator|=
name|FALSE
expr_stmt|;
block|}
name|curr_val
operator|->
name|attr
operator|=
name|curr_attr
expr_stmt|;
name|curr_val
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|curr_val
operator|->
name|mod_flag
operator|=
name|FALSE
expr_stmt|;
name|curr_val
operator|->
name|new_value
operator|=
literal|0
expr_stmt|;
name|curr_val
operator|->
name|text_widg
operator|=
literal|0
expr_stmt|;
name|curr_val
operator|->
name|value
operator|=
name|strdup
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|char_map
argument_list|(
name|buffer
argument_list|,
name|curr_val
operator|->
name|value
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|curr_val
operator|->
name|value
argument_list|)
expr_stmt|;
name|curr_val
operator|->
name|value
operator|=
name|strdup
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
operator|*
name|str
operator|=
name|save
expr_stmt|;
if|if
condition|(
operator|*
name|str
operator|==
literal|'\0'
operator|||
operator|*
operator|++
name|str
operator|==
literal|'\0'
condition|)
return|return;
name|sptr
operator|=
name|str
expr_stmt|;
block|}
block|}
end_block

begin_function
name|void
name|char_map
parameter_list|(
name|buffer
parameter_list|,
name|value
parameter_list|)
name|char
modifier|*
name|buffer
decl_stmt|,
decl|*
name|value
decl_stmt|;
end_function

begin_block
block|{
if|if
condition|(
name|value
operator|!=
name|NULLCP
operator|&&
operator|*
name|value
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|value
operator|!=
literal|'\0'
condition|)
block|{
switch|switch
condition|(
operator|*
name|value
condition|)
block|{
case|case
literal|'$'
case|:
operator|*
name|buffer
operator|=
literal|'\n'
expr_stmt|;
break|break;
case|case
literal|'\\'
case|:
if|if
condition|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|value
operator|+
literal|1
operator|)
operator|)
operator|==
literal|'4'
operator|&&
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|value
operator|+
literal|2
operator|)
operator|)
operator|==
literal|'0'
condition|)
block|{
operator|*
name|buffer
operator|=
literal|'@'
expr_stmt|;
name|value
operator|+=
literal|2
expr_stmt|;
block|}
break|break;
default|default:
operator|*
name|buffer
operator|=
operator|*
name|value
expr_stmt|;
block|}
name|value
operator|++
expr_stmt|;
name|buffer
operator|++
expr_stmt|;
block|}
block|}
operator|*
name|buffer
operator|=
literal|'\0'
expr_stmt|;
block|}
end_block

begin_function
name|void
name|char_unmap
parameter_list|(
name|buffer
parameter_list|,
name|value
parameter_list|)
name|char
modifier|*
name|buffer
decl_stmt|,
decl|*
name|value
decl_stmt|;
end_function

begin_block
block|{
if|if
condition|(
name|value
operator|!=
name|NULLCP
operator|&&
operator|*
name|value
operator|!=
literal|'\0'
condition|)
block|{
while|while
condition|(
operator|*
name|value
operator|!=
literal|'\0'
condition|)
block|{
switch|switch
condition|(
operator|*
name|value
condition|)
block|{
case|case
literal|'\n'
case|:
operator|*
name|buffer
operator|=
literal|'$'
expr_stmt|;
break|break;
default|default:
operator|*
name|buffer
operator|=
operator|*
name|value
expr_stmt|;
block|}
name|value
operator|++
expr_stmt|;
name|buffer
operator|++
expr_stmt|;
block|}
block|}
operator|*
name|buffer
operator|=
literal|'\0'
expr_stmt|;
block|}
end_block

begin_function
name|Attr_Sequence
name|make_template_as
parameter_list|(
name|oc
parameter_list|)
name|AV_Sequence
name|oc
decl_stmt|;
block|{
name|AV_Sequence
name|avs
decl_stmt|;
name|Attr_Sequence
name|newas
decl_stmt|;
name|Attr_Sequence
name|as
init|=
name|NULLATTR
decl_stmt|;
name|table_seq
name|optr
decl_stmt|;
name|AttributeType
name|at
decl_stmt|;
name|objectclass
modifier|*
name|ocp
decl_stmt|;
for|for
control|(
name|avs
operator|=
name|oc
init|;
name|avs
operator|!=
name|NULLAV
condition|;
name|avs
operator|=
name|avs
operator|->
name|avseq_next
control|)
block|{
name|ocp
operator|=
operator|(
name|objectclass
operator|*
operator|)
name|avs
operator|->
name|avseq_av
operator|.
name|av_struct
expr_stmt|;
for|for
control|(
name|optr
operator|=
name|ocp
operator|->
name|oc_must
init|;
name|optr
operator|!=
name|NULLTABLE_SEQ
condition|;
name|optr
operator|=
name|optr
operator|->
name|ts_next
control|)
block|{
name|at
operator|=
name|optr
operator|->
name|ts_oa
expr_stmt|;
name|newas
operator|=
name|as_comp_new
argument_list|(
name|at
argument_list|,
name|NULLAV
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|as
operator|=
name|as_merge
argument_list|(
name|as
argument_list|,
name|newas
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|avs
operator|=
name|oc
init|;
name|avs
operator|!=
name|NULLAV
condition|;
name|avs
operator|=
name|avs
operator|->
name|avseq_next
control|)
block|{
name|ocp
operator|=
operator|(
name|objectclass
operator|*
operator|)
name|avs
operator|->
name|avseq_av
operator|.
name|av_struct
expr_stmt|;
for|for
control|(
name|optr
operator|=
name|ocp
operator|->
name|oc_may
init|;
name|optr
operator|!=
name|NULLTABLE_SEQ
condition|;
name|optr
operator|=
name|optr
operator|->
name|ts_next
control|)
block|{
name|at
operator|=
name|optr
operator|->
name|ts_oa
expr_stmt|;
name|newas
operator|=
name|as_comp_new
argument_list|(
name|at
argument_list|,
name|NULLAV
argument_list|,
name|NULLACL_INFO
argument_list|)
expr_stmt|;
name|as
operator|=
name|as_merge
argument_list|(
name|as
argument_list|,
name|newas
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|as
operator|)
return|;
block|}
end_function

begin_comment
comment|/*Big Bodge!*/
end_comment

begin_function
name|char
modifier|*
name|modify_error
parameter_list|(
name|error
parameter_list|)
name|struct
name|DSError
modifier|*
name|error
decl_stmt|;
block|{
name|PS
name|ps
decl_stmt|;
name|char
name|buffer
index|[
name|RESBUF
index|]
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|,
modifier|*
name|message
decl_stmt|;
if|if
condition|(
operator|(
name|ps
operator|=
name|ps_alloc
argument_list|(
name|str_open
argument_list|)
operator|)
operator|==
name|NULLPS
condition|)
block|{
return|return
name|NULLCP
return|;
block|}
if|if
condition|(
name|str_setup
argument_list|(
name|ps
argument_list|,
name|buffer
argument_list|,
name|RESBUF
argument_list|,
literal|1
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
return|return
name|NULLCP
return|;
block|}
name|ds_error
argument_list|(
name|ps
argument_list|,
name|error
argument_list|)
expr_stmt|;
operator|*
name|ps
operator|->
name|ps_ptr
operator|=
literal|0
expr_stmt|;
name|ps_free
argument_list|(
name|ps
argument_list|)
expr_stmt|;
name|str
operator|=
name|buffer
expr_stmt|;
if|if
condition|(
operator|*
name|str
operator|!=
literal|'\0'
condition|)
block|{
name|message
operator|=
name|strdup
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
else|else
name|message
operator|=
name|NULLCP
expr_stmt|;
return|return
name|message
return|;
block|}
end_function

begin_macro
name|my_as_comp_print
argument_list|(
argument|ps
argument_list|,
argument|as
argument_list|,
argument|format
argument_list|)
end_macro

begin_decl_stmt
name|PS
name|ps
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Attr_Sequence
name|as
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|AV_Sequence
name|avs
decl_stmt|;
name|char
name|buffer
index|[
name|RESBUF
index|]
decl_stmt|;
specifier|extern
name|int
name|oidformat
decl_stmt|;
if|if
condition|(
name|as
operator|!=
name|NULLATTR
condition|)
block|{
if|if
condition|(
name|format
operator|==
name|READOUT
condition|)
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%s"
argument_list|,
name|attr2name
argument_list|(
name|as
operator|->
name|attr_type
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%s"
argument_list|,
name|attr2name_aux
argument_list|(
name|as
operator|->
name|attr_type
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|split_attr
argument_list|(
name|as
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|as
operator|->
name|attr_value
operator|==
name|NULLAV
operator|)
operator|&&
operator|(
name|format
operator|!=
name|READOUT
operator|)
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s=\n"
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|as
operator|->
name|attr_value
operator|==
name|NULLAV
condition|)
block|{
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%-21s - \n"
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|avs
operator|=
name|as
operator|->
name|attr_value
init|;
name|avs
operator|!=
name|NULLAV
condition|;
name|avs
operator|=
name|avs
operator|->
name|avseq_next
control|)
block|{
if|if
condition|(
name|format
operator|==
name|READOUT
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%-21s - "
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
else|else
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s= "
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|avs_comp_print
argument_list|(
name|ps
argument_list|,
name|avs
argument_list|,
name|EDBOUT
argument_list|)
expr_stmt|;
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|format
operator|==
name|READOUT
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%-21s - "
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
else|else
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s= "
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|avs_print
argument_list|(
name|ps
argument_list|,
name|as
operator|->
name|attr_value
argument_list|,
name|format
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|my_as_print
argument_list|(
argument|ps
argument_list|,
argument|as
argument_list|,
argument|format
argument_list|)
end_macro

begin_decl_stmt
name|Attr_Sequence
name|as
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|PS
name|ps
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|as
operator|!=
name|NULLATTR
condition|)
name|FOREACH
argument_list|(
argument|as
argument_list|)
name|my_as_comp_print
argument_list|(
name|ps
argument_list|,
name|eptr
argument_list|,
name|format
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|Attr_Sequence
name|as_sort
parameter_list|(
name|as
parameter_list|)
name|Attr_Sequence
name|as
decl_stmt|;
block|{
name|Attr_Sequence
name|with_vals
init|=
name|NULLATTR
decl_stmt|,
name|without_vals
init|=
name|NULLATTR
decl_stmt|,
name|next_as
decl_stmt|;
if|if
condition|(
name|as
operator|==
name|NULLATTR
condition|)
return|return
name|as
return|;
while|while
condition|(
name|as
operator|!=
name|NULLATTR
condition|)
block|{
name|next_as
operator|=
name|as
operator|->
name|attr_link
expr_stmt|;
name|as
operator|->
name|attr_link
operator|=
name|NULLATTR
expr_stmt|;
if|if
condition|(
name|as
operator|->
name|attr_value
condition|)
name|with_vals
operator|=
name|as_merge
argument_list|(
name|with_vals
argument_list|,
name|as
argument_list|)
expr_stmt|;
else|else
name|without_vals
operator|=
name|as_merge
argument_list|(
name|without_vals
argument_list|,
name|as
argument_list|)
expr_stmt|;
name|as
operator|=
name|next_as
expr_stmt|;
block|}
name|as
operator|=
name|with_vals
expr_stmt|;
if|if
condition|(
name|as
operator|!=
name|NULLATTR
condition|)
for|for
control|(
init|;
name|as
operator|->
name|attr_link
operator|!=
name|NULLATTR
condition|;
name|as
operator|=
name|as
operator|->
name|attr_link
control|)
empty_stmt|;
else|else
return|return
name|without_vals
return|;
name|as
operator|->
name|attr_link
operator|=
name|without_vals
expr_stmt|;
return|return
name|with_vals
return|;
block|}
end_function

end_unit

