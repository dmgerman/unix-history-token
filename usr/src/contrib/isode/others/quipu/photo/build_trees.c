begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* build_trees.c - build decode trees */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/others/quipu/photo/RCS/build_trees.c,v 7.3 91/02/22 09:29:00 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/others/quipu/photo/RCS/build_trees.c,v 7.3 91/02/22 09:29:00 mrose Interim $  *  *  * $Log:	build_trees.c,v $  * Revision 7.3  91/02/22  09:29:00  mrose  * Interim 6.8  *   * Revision 7.2  91/01/15  13:42:36  mrose  * KEJ  *   * Revision 1.1  91/01/02  21:34:39  kej  * Initial revision  *   * Revision 7.0  89/11/23  22:01:33  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"quipu/photo.h"
end_include

begin_decl_stmt
name|int
name|built
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|node
modifier|*
name|bl_tree_top
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pointers to the decode trees */
end_comment

begin_decl_stmt
specifier|extern
name|node
modifier|*
name|wt_tree_top
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|node
modifier|*
name|two_tree_top
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *  Decoding tables  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|bl_make
index|[]
init|=
block|{
literal|"0000001111"
block|,
literal|"000011001000"
block|,
literal|"000011001001"
block|,
literal|"000001011011"
block|,
literal|"000000110011"
block|,
literal|"000000110100"
block|,
literal|"000000110101"
block|,
literal|"0000001101100"
block|,
literal|"0000001101101"
block|,
literal|"0000001001010"
block|,
literal|"0000001001011"
block|,
literal|"0000001001100"
block|,
literal|"0000001001101"
block|,
literal|"0000001110010"
block|,
literal|"0000001110011"
block|,
literal|"0000001110100"
block|,
literal|"0000001110101"
block|,
literal|"0000001110110"
block|,
literal|"0000001110111"
block|,
literal|"0000001010010"
block|,
literal|"0000001010011"
block|,
literal|"0000001010100"
block|,
literal|"0000001010101"
block|,
literal|"0000001011010"
block|,
literal|"0000001011011"
block|,
literal|"0000001100100"
block|,
literal|"0000001100101"
block|,
literal|"00000001000"
block|,
literal|"00000001100"
block|,
literal|"00000001101"
block|,
literal|"000000010010"
block|,
literal|"000000010011"
block|,
literal|"000000010100"
block|,
literal|"000000010101"
block|,
literal|"000000010110"
block|,
literal|"000000010111"
block|,
literal|"000000011100"
block|,
literal|"000000011101"
block|,
literal|"000000011110"
block|,
literal|"000000011111"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|bl_term
index|[]
init|=
block|{
literal|"0000110111"
block|,
literal|"010"
block|,
literal|"11"
block|,
literal|"10"
block|,
literal|"011"
block|,
literal|"0011"
block|,
literal|"0010"
block|,
literal|"00011"
block|,
literal|"000101"
block|,
literal|"000100"
block|,
literal|"0000100"
block|,
literal|"0000101"
block|,
literal|"0000111"
block|,
literal|"00000100"
block|,
literal|"00000111"
block|,
literal|"000011000"
block|,
literal|"0000010111"
block|,
literal|"0000011000"
block|,
literal|"0000001000"
block|,
literal|"00001100111"
block|,
literal|"00001101000"
block|,
literal|"00001101100"
block|,
literal|"00000110111"
block|,
literal|"00000101000"
block|,
literal|"00000010111"
block|,
literal|"00000011000"
block|,
literal|"000011001010"
block|,
literal|"000011001011"
block|,
literal|"000011001100"
block|,
literal|"000011001101"
block|,
literal|"000001101000"
block|,
literal|"000001101001"
block|,
literal|"000001101010"
block|,
literal|"000001101011"
block|,
literal|"000011010010"
block|,
literal|"000011010011"
block|,
literal|"000011010100"
block|,
literal|"000011010101"
block|,
literal|"000011010110"
block|,
literal|"000011010111"
block|,
literal|"000001101100"
block|,
literal|"000001101101"
block|,
literal|"000011011010"
block|,
literal|"000011011011"
block|,
literal|"000001010100"
block|,
literal|"000001010101"
block|,
literal|"000001010110"
block|,
literal|"000001010111"
block|,
literal|"000001100100"
block|,
literal|"000001100101"
block|,
literal|"000001010010"
block|,
literal|"000001010011"
block|,
literal|"000000100100"
block|,
literal|"000000110111"
block|,
literal|"000000111000"
block|,
literal|"000000100111"
block|,
literal|"000000101000"
block|,
literal|"000001011000"
block|,
literal|"000001011001"
block|,
literal|"000000101011"
block|,
literal|"000000101100"
block|,
literal|"000001011010"
block|,
literal|"000001100110"
block|,
literal|"000001100111"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|two_dim
index|[]
init|=
block|{
literal|"0001"
block|,
literal|"001"
block|,
literal|"0000010"
block|,
literal|"000010"
block|,
literal|"010"
block|,
literal|"1"
block|,
literal|"011"
block|,
literal|"000011"
block|,
literal|"0000011"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|wt_make
index|[]
init|=
block|{
literal|"11011"
block|,
literal|"10010"
block|,
literal|"010111"
block|,
literal|"0110111"
block|,
literal|"00110110"
block|,
literal|"00110111"
block|,
literal|"01100100"
block|,
literal|"01100101"
block|,
literal|"01101000"
block|,
literal|"01100111"
block|,
literal|"011001100"
block|,
literal|"011001101"
block|,
literal|"011010010"
block|,
literal|"011010011"
block|,
literal|"011010100"
block|,
literal|"011010101"
block|,
literal|"011010110"
block|,
literal|"011010111"
block|,
literal|"011011000"
block|,
literal|"011011001"
block|,
literal|"011011010"
block|,
literal|"011011011"
block|,
literal|"010011000"
block|,
literal|"010011001"
block|,
literal|"010011010"
block|,
literal|"011000"
block|,
literal|"010011011"
block|,
literal|"00000001000"
block|,
literal|"00000001100"
block|,
literal|"00000001101"
block|,
literal|"000000010010"
block|,
literal|"000000010011"
block|,
literal|"000000010100"
block|,
literal|"000000010101"
block|,
literal|"000000010110"
block|,
literal|"000000010111"
block|,
literal|"000000011100"
block|,
literal|"000000011101"
block|,
literal|"000000011110"
block|,
literal|"000000011111"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|wt_term
index|[]
init|=
block|{
literal|"00110101"
block|,
literal|"000111"
block|,
literal|"0111"
block|,
literal|"1000"
block|,
literal|"1011"
block|,
literal|"1100"
block|,
literal|"1110"
block|,
literal|"1111"
block|,
literal|"10011"
block|,
literal|"10100"
block|,
literal|"00111"
block|,
literal|"01000"
block|,
literal|"001000"
block|,
literal|"000011"
block|,
literal|"110100"
block|,
literal|"110101"
block|,
literal|"101010"
block|,
literal|"101011"
block|,
literal|"0100111"
block|,
literal|"0001100"
block|,
literal|"0001000"
block|,
literal|"0010111"
block|,
literal|"0000011"
block|,
literal|"0000100"
block|,
literal|"0101000"
block|,
literal|"0101011"
block|,
literal|"0010011"
block|,
literal|"0100100"
block|,
literal|"0011000"
block|,
literal|"00000010"
block|,
literal|"00000011"
block|,
literal|"00011010"
block|,
literal|"00011011"
block|,
literal|"00010010"
block|,
literal|"00010011"
block|,
literal|"00010100"
block|,
literal|"00010101"
block|,
literal|"00010110"
block|,
literal|"00010111"
block|,
literal|"00101000"
block|,
literal|"00101001"
block|,
literal|"00101010"
block|,
literal|"00101011"
block|,
literal|"00101100"
block|,
literal|"00101101"
block|,
literal|"00000100"
block|,
literal|"00000101"
block|,
literal|"00001010"
block|,
literal|"00001011"
block|,
literal|"01010010"
block|,
literal|"01010011"
block|,
literal|"01010100"
block|,
literal|"01010101"
block|,
literal|"00100100"
block|,
literal|"00100101"
block|,
literal|"01011000"
block|,
literal|"01011001"
block|,
literal|"01011010"
block|,
literal|"01011011"
block|,
literal|"01001010"
block|,
literal|"01001011"
block|,
literal|"00110010"
block|,
literal|"00110011"
block|,
literal|"00110100"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|uncompressed_1d
init|=
literal|"000000001111"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|uncompressed_2d
init|=
literal|"0000001111"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ROUTINE:     get_node                                                */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_comment
comment|/* SYNOPSIS:    creates a new node.                                     */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_comment
comment|/* DESCRIPTION: Uses malloc to allocate sufficient memory for a node to */
end_comment

begin_comment
comment|/*              be stored, and the sets all the pointer fields of the   */
end_comment

begin_comment
comment|/*              node to NULL, and initialises the other fields          */
end_comment

begin_function
name|node
modifier|*
name|get_node
parameter_list|()
block|{
name|node
modifier|*
name|mem
decl_stmt|;
name|mem
operator|=
operator|(
name|node
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|node
argument_list|)
argument_list|)
expr_stmt|;
name|mem
operator|->
name|n_type
operator|=
name|INTERNAL
expr_stmt|;
comment|/* The most common node type */
name|mem
operator|->
name|zero
operator|=
name|NULL
expr_stmt|;
name|mem
operator|->
name|one
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|mem
operator|)
return|;
block|}
end_function

begin_comment
comment|/* ROUTINE:     build_trees. /* /* SYNOPSIS:    build the decode tree. /* /* DESCRIPTION: For each of the three trees, read the data in from a file /* in string form, convert this into an integer, then add this integer to the /* tree. /* Also contained in the node is the value associated with the string read in, /* so we need to count each string as it is read in. */
end_comment

begin_macro
name|build_trees
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
expr_stmt|;
name|char
modifier|*
modifier|*
name|string
decl_stmt|;
if|if
condition|(
name|built
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* create the tops of the trees */
name|bl_tree_top
operator|=
name|get_node
argument_list|()
expr_stmt|;
name|wt_tree_top
operator|=
name|get_node
argument_list|()
expr_stmt|;
name|two_tree_top
operator|=
name|get_node
argument_list|()
expr_stmt|;
comment|/* Add the white terminals to the white tree */
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|string
operator|=
name|wt_term
init|;
operator|*
name|string
condition|;
operator|++
name|string
control|)
name|add_tree
argument_list|(
operator|*
name|string
argument_list|,
name|i
operator|++
argument_list|,
name|WT_TERM
argument_list|,
name|wt_tree_top
argument_list|)
expr_stmt|;
comment|/* Add the black terminals to the black tree */
name|i
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|string
operator|=
name|bl_term
init|;
operator|*
name|string
condition|;
operator|++
name|string
control|)
name|add_tree
argument_list|(
operator|*
name|string
argument_list|,
name|i
operator|++
argument_list|,
name|BL_TERM
argument_list|,
name|bl_tree_top
argument_list|)
expr_stmt|;
comment|/* Add the white make codes to the white tree */
name|i
operator|=
literal|64
expr_stmt|;
for|for
control|(
name|string
operator|=
name|wt_make
init|;
operator|*
name|string
condition|;
operator|++
name|string
control|)
block|{
name|add_tree
argument_list|(
operator|*
name|string
argument_list|,
name|i
argument_list|,
name|MAKE
argument_list|,
name|wt_tree_top
argument_list|)
expr_stmt|;
name|i
operator|+=
literal|64
expr_stmt|;
block|}
comment|/* Add the black make up codes to the black tree */
name|i
operator|=
literal|64
expr_stmt|;
for|for
control|(
name|string
operator|=
name|bl_make
init|;
operator|*
name|string
condition|;
operator|++
name|string
control|)
block|{
name|add_tree
argument_list|(
operator|*
name|string
argument_list|,
name|i
argument_list|,
name|MAKE
argument_list|,
name|bl_tree_top
argument_list|)
expr_stmt|;
name|i
operator|+=
literal|64
expr_stmt|;
block|}
comment|/* make the two dimensional decode tree */
name|i
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|string
operator|=
name|two_dim
init|;
operator|*
name|string
condition|;
operator|++
name|string
control|)
name|add_tree
argument_list|(
operator|*
name|string
argument_list|,
name|i
operator|++
argument_list|,
name|MAKE
argument_list|,
name|two_tree_top
argument_list|)
expr_stmt|;
comment|/* put uncompressed mode entrance codewords on all three trees */
name|add_tree
argument_list|(
name|uncompressed_1d
argument_list|,
operator|-
literal|1
argument_list|,
name|MAKE
argument_list|,
name|bl_tree_top
argument_list|)
expr_stmt|;
name|add_tree
argument_list|(
name|uncompressed_1d
argument_list|,
operator|-
literal|1
argument_list|,
name|MAKE
argument_list|,
name|wt_tree_top
argument_list|)
expr_stmt|;
name|add_tree
argument_list|(
name|uncompressed_2d
argument_list|,
operator|-
literal|1
argument_list|,
name|MAKE
argument_list|,
name|two_tree_top
argument_list|)
expr_stmt|;
comment|/* put end of line markers on all three trees */
name|add_tree
argument_list|(
literal|"00000000000"
argument_list|,
name|EOLN
argument_list|,
name|EOLN
argument_list|,
name|bl_tree_top
argument_list|)
expr_stmt|;
name|add_tree
argument_list|(
literal|"00000000000"
argument_list|,
name|EOLN
argument_list|,
name|EOLN
argument_list|,
name|wt_tree_top
argument_list|)
expr_stmt|;
name|add_tree
argument_list|(
literal|"00000000000"
argument_list|,
name|EOLN
argument_list|,
name|EOLN
argument_list|,
name|two_tree_top
argument_list|)
expr_stmt|;
name|built
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_comment
comment|/* ROUTINE:     add_tree                                                */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_comment
comment|/* SYNOPSIS:    adds a run to the tree                                  */
end_comment

begin_comment
comment|/*                                                                      */
end_comment

begin_macro
name|add_tree
argument_list|(
argument|string
argument_list|,
argument|run
argument_list|,
argument|mode
argument_list|,
argument|root
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* string containing the bit sequence           */
end_comment

begin_decl_stmt
name|int
name|run
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the run length associated with the sequence  */
end_comment

begin_decl_stmt
name|char
name|mode
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the type of data we are entering             */
end_comment

begin_decl_stmt
name|node
modifier|*
name|root
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* top of the tree string should be added to    */
end_comment

begin_block
block|{
name|char
modifier|*
name|ptr
decl_stmt|;
name|node
modifier|*
name|treeptr
decl_stmt|;
specifier|register
name|i
expr_stmt|;
name|ptr
operator|=
name|string
expr_stmt|;
name|treeptr
operator|=
name|root
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|string
argument_list|)
condition|;
name|i
operator|++
operator|,
name|ptr
operator|++
control|)
if|if
condition|(
operator|*
name|ptr
operator|==
literal|'0'
condition|)
block|{
if|if
condition|(
name|treeptr
operator|->
name|zero
operator|==
name|NULL
condition|)
name|treeptr
operator|->
name|zero
operator|=
name|get_node
argument_list|()
expr_stmt|;
name|treeptr
operator|=
name|treeptr
operator|->
name|zero
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|treeptr
operator|->
name|one
operator|==
name|NULL
condition|)
name|treeptr
operator|->
name|one
operator|=
name|get_node
argument_list|()
expr_stmt|;
name|treeptr
operator|=
name|treeptr
operator|->
name|one
expr_stmt|;
block|}
name|treeptr
operator|->
name|n_type
operator|=
name|mode
expr_stmt|;
name|treeptr
operator|->
name|value
operator|=
name|run
expr_stmt|;
block|}
end_block

end_unit

