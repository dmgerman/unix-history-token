begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ds_error.c - Directory Operation Errors */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/dsap/common/RCS/ds_error.c,v 7.5 91/03/09 11:53:21 mrose Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * $Header: /f/osi/dsap/common/RCS/ds_error.c,v 7.5 91/03/09 11:53:21 mrose Exp $  *  *  * $Log:	ds_error.c,v $  * Revision 7.5  91/03/09  11:53:21  mrose  * update  *   * Revision 7.4  91/02/22  09:19:04  mrose  * Interim 6.8  *   * Revision 7.3  90/10/17  11:41:43  mrose  * sync  *   * Revision 7.2  90/03/15  11:17:31  mrose  * quipu-sync  *   * Revision 7.1  89/12/19  16:19:20  mrose  * sync  *   * Revision 7.0  89/11/23  21:42:08  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *                                NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_comment
comment|/* LINTLIBRARY */
end_comment

begin_include
include|#
directive|include
file|"quipu/util.h"
end_include

begin_include
include|#
directive|include
file|"quipu/name.h"
end_include

begin_include
include|#
directive|include
file|"quipu/dsp.h"
end_include

begin_include
include|#
directive|include
file|"quipu/ds_error.h"
end_include

begin_include
include|#
directive|include
file|"quipu/bind.h"
end_include

begin_decl_stmt
specifier|extern
name|LLog
modifier|*
name|log_dsap
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|int
name|dn_print
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|AttrT_print
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|dsa_dead
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|abandon_fail
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"No such operation"
block|,
literal|"Too late"
block|,
literal|"Cannot abandon"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|at_problem
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"No such attribute in the entry"
block|,
literal|"Invalid attribute syntax"
block|,
literal|"Undefined Attribute type"
block|,
literal|"Inappropriate Matching"
block|,
literal|"Constrain violation"
block|,
literal|"Attribute or Value already exists"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|name
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"No such object"
block|,
literal|"Alias problem"
block|,
literal|"Invalid attribute syntax"
block|,
literal|"Alias dereference"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|security
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"Inappropriate authentication"
block|,
literal|"Invalid credentials"
block|,
literal|"Access rights"
block|,
literal|"Invalid signature"
block|,
literal|"Protection required"
block|,
literal|"No information"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|service
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"Busy"
block|,
literal|"Unavailable"
block|,
literal|"Unwilling to perform"
block|,
literal|"Chaining required"
block|,
literal|"Unable to proceed"
block|,
literal|"Invalid Reference"
block|,
literal|"Timelimit exceeded"
block|,
literal|"Administrative limit exceeded"
block|,
literal|"Loop detect"
block|,
literal|"Unavailable critical extension"
block|,
literal|"Out of scope"
block|,
literal|"DIT error"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|update
index|[]
init|=
block|{
literal|"No error !!!"
block|,
literal|"Naming violation"
block|,
literal|"Object class violation"
block|,
literal|"Only allowed on leaf entries"
block|,
literal|"Can't alter the RDN"
block|,
literal|"Already exists"
block|,
literal|"Affects multiple DSAs"
block|,
literal|"Object class modifications Prohibited"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|de_print
argument_list|(
argument|ps
argument_list|,
argument|err
argument_list|,
argument|format
argument_list|)
end_macro

begin_decl_stmt
name|PS
name|ps
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|DSError
modifier|*
name|err
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|ds_error
argument_list|(
name|ps
argument_list|,
name|err
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ds_error
argument_list|(
argument|ps
argument_list|,
argument|err
argument_list|)
end_macro

begin_decl_stmt
name|PS
name|ps
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|DSError
modifier|*
name|err
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|DSE_at_problem
modifier|*
name|at_prob
decl_stmt|;
switch|switch
condition|(
name|err
operator|->
name|dse_type
condition|)
block|{
case|case
name|DSE_NOERROR
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"No error !!!\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ABANDON_FAILED
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Abandon failure: %s, id %d ***\n"
argument_list|,
name|abandon_fail
index|[
name|err
operator|->
name|ERR_ABANDON_FAIL
operator|.
name|DSE_ab_problem
index|]
argument_list|,
name|err
operator|->
name|ERR_ABANDON_FAIL
operator|.
name|DSE_ab_invokeid
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ATTRIBUTEERROR
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Attribute error ***\n"
argument_list|)
expr_stmt|;
name|dn_print
argument_list|(
name|ps
argument_list|,
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_name
argument_list|,
name|RDNOUT
argument_list|)
expr_stmt|;
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|at_prob
operator|=
operator|&
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_plist
init|;
name|at_prob
operator|!=
name|DSE_AT_NOPROBLEM
condition|;
name|at_prob
operator|=
name|at_prob
operator|->
name|dse_at_next
control|)
block|{
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"Attribute type "
argument_list|)
expr_stmt|;
name|AttrT_print
argument_list|(
name|ps
argument_list|,
name|at_prob
operator|->
name|DSE_at_type
argument_list|,
name|READOUT
argument_list|)
expr_stmt|;
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_value
operator|!=
name|NULLAttrV
condition|)
block|{
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|", value "
argument_list|)
expr_stmt|;
name|AttrV_print
argument_list|(
name|ps
argument_list|,
name|at_prob
operator|->
name|DSE_at_value
argument_list|,
name|READOUT
argument_list|)
expr_stmt|;
block|}
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|" - %s\n"
argument_list|,
name|at_problem
index|[
name|at_prob
operator|->
name|DSE_at_what
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_NAMEERROR
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Name error: %s ***\n( Matched: "
argument_list|,
name|name
index|[
name|err
operator|->
name|ERR_NAME
operator|.
name|DSE_na_problem
index|]
argument_list|)
expr_stmt|;
name|dn_print
argument_list|(
name|ps
argument_list|,
name|err
operator|->
name|ERR_NAME
operator|.
name|DSE_na_matched
argument_list|,
name|RDNOUT
argument_list|)
expr_stmt|;
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|" )\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_SERVICEERROR
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Service error: %s ***\n"
argument_list|,
name|service
index|[
name|err
operator|->
name|ERR_SERVICE
operator|.
name|DSE_sv_problem
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_REFERRAL
case|:
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|==
name|NULLCONTINUATIONREF
condition|)
block|{
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Can't contact remote DSA - Address Unknown ***\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_reftype
operator|==
name|RT_NONSPECIFICSUBORDINATE
condition|)
block|{
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Non Specific Referral (unable to proceede) ***"
argument_list|)
expr_stmt|;
break|break;
block|}
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Can't contact remote part of the directory (\""
argument_list|)
expr_stmt|;
name|ufn_dn_print
argument_list|(
name|ps
argument_list|,
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_accesspoints
operator|->
name|ap_name
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"\") ***\n"
argument_list|)
expr_stmt|;
comment|/* 	ps_printf (ps,"\" ***\n    (%s)\n", paddr2str (err->ERR_REFERRAL.DSE_ref_candidates->cr_accesspoints->ap_address,NULLNA)); */
break|break;
case|case
name|DSE_DSAREFERRAL
case|:
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|==
name|NULLCONTINUATIONREF
condition|)
block|{
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Referral error - Null reference ***\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** DSA Referral error - "
argument_list|)
expr_stmt|;
name|dn_print
argument_list|(
name|ps
argument_list|,
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_accesspoints
operator|->
name|ap_name
argument_list|,
name|RDNOUT
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|" - %s ***\n"
argument_list|,
name|paddr2str
argument_list|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_accesspoints
operator|->
name|ap_address
argument_list|,
name|NULLNA
argument_list|)
argument_list|)
expr_stmt|;
name|dn_print
argument_list|(
name|ps
argument_list|,
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_prefix
argument_list|,
name|RDNOUT
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_SECURITYERROR
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Security error - %s ***\n"
argument_list|,
name|security
index|[
name|err
operator|->
name|ERR_SECURITY
operator|.
name|DSE_sc_problem
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_UPDATEERROR
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Update error - %s ***\n"
argument_list|,
name|update
index|[
name|err
operator|->
name|ERR_UPDATE
operator|.
name|DSE_up_problem
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ABANDONED
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Abandoned error ***\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_REMOTEERROR
case|:
name|dsa_dead
operator|=
name|TRUE
expr_stmt|;
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Problem with DSA ***\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_LOCALERROR
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Problem with DUA ***\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTR_ABANDON_FAILED
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Abandoned Failed ***\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTR_ABANDONED
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Abandoned ***\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTRERROR
case|:
name|ps_print
argument_list|(
name|ps
argument_list|,
literal|"*** Interrupted ***\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|dsa_dead
operator|=
name|TRUE
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Undefined error '%d' ***\n"
argument_list|,
name|err
operator|->
name|dse_type
argument_list|)
expr_stmt|;
break|break;
block|}
name|ds_error_free
argument_list|(
name|err
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|log_ds_error
argument_list|(
argument|err
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|DSError
modifier|*
name|err
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|DSE_at_problem
modifier|*
name|at_prob
decl_stmt|;
switch|switch
condition|(
name|err
operator|->
name|dse_type
condition|)
block|{
case|case
name|DSE_NOERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"No error !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ABANDON_FAILED
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Abandon failure"
operator|)
argument_list|)
expr_stmt|;
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
operator|(
literal|"%s,id %d"
operator|,
name|abandon_fail
index|[
name|err
operator|->
name|ERR_ABANDON_FAIL
operator|.
name|DSE_ab_problem
index|]
operator|,
name|err
operator|->
name|ERR_ABANDON_FAIL
operator|.
name|DSE_ab_invokeid
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ATTRIBUTEERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Attribute error\n"
operator|)
argument_list|)
expr_stmt|;
name|pslog
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
literal|"..."
argument_list|,
name|dn_print
argument_list|,
operator|(
name|caddr_t
operator|)
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_name
argument_list|)
expr_stmt|;
for|for
control|(
name|at_prob
operator|=
operator|&
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_plist
init|;
name|at_prob
operator|!=
name|DSE_AT_NOPROBLEM
condition|;
name|at_prob
operator|=
name|at_prob
operator|->
name|dse_at_next
control|)
block|{
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
operator|(
name|at_problem
index|[
name|at_prob
operator|->
name|DSE_at_what
index|]
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_value
operator|!=
name|NULLAttrV
condition|)
name|pslog
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
literal|"type"
argument_list|,
name|AttrT_print
argument_list|,
operator|(
name|caddr_t
operator|)
name|at_prob
operator|->
name|DSE_at_type
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_NAMEERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Name error: %s"
operator|,
name|name
index|[
name|err
operator|->
name|ERR_NAME
operator|.
name|DSE_na_problem
index|]
operator|)
argument_list|)
expr_stmt|;
name|pslog
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
literal|"   Matched"
argument_list|,
name|dn_print
argument_list|,
operator|(
name|caddr_t
operator|)
name|err
operator|->
name|ERR_NAME
operator|.
name|DSE_na_matched
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_SERVICEERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Service error: %s "
operator|,
name|service
index|[
name|err
operator|->
name|ERR_SERVICE
operator|.
name|DSE_sv_problem
index|]
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_REFERRAL
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Referral error"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|==
name|NULLCONTINUATIONREF
condition|)
block|{
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"NULL reference in referral error"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|pslog
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
literal|"ap_name"
argument_list|,
name|dn_print
argument_list|,
operator|(
name|caddr_t
operator|)
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_accesspoints
operator|->
name|ap_name
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_DSAREFERRAL
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"DSA!! Referral error"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|==
name|NULLCONTINUATIONREF
condition|)
block|{
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"NULL reference in DSA referral error"
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|pslog
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_TRACE
argument_list|,
literal|"ap_name"
argument_list|,
name|dn_print
argument_list|,
operator|(
name|caddr_t
operator|)
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
operator|->
name|cr_accesspoints
operator|->
name|ap_name
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_SECURITYERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Security error - %s "
operator|,
name|security
index|[
name|err
operator|->
name|ERR_SECURITY
operator|.
name|DSE_sc_problem
index|]
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_UPDATEERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Update error - %s "
operator|,
name|update
index|[
name|err
operator|->
name|ERR_UPDATE
operator|.
name|DSE_up_problem
index|]
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_ABANDONED
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Abandoned error"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_REMOTEERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"remote DSA error !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_LOCALERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"local DUA error !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTR_ABANDON_FAILED
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Abandon failed !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTR_ABANDONED
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Abandoned !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_INTRERROR
case|:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Interrupted !!!"
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"Unknown ds error type (%d)"
operator|,
name|err
operator|->
name|dse_type
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_macro
name|ds_error_free
argument_list|(
argument|err
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|DSError
modifier|*
name|err
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|DSE_at_problem
modifier|*
name|at_prob
decl_stmt|;
switch|switch
condition|(
name|err
operator|->
name|dse_type
condition|)
block|{
case|case
name|DSE_ATTRIBUTEERROR
case|:
name|dn_free
argument_list|(
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_name
argument_list|)
expr_stmt|;
name|at_prob
operator|=
operator|&
name|err
operator|->
name|ERR_ATTRIBUTE
operator|.
name|DSE_at_plist
expr_stmt|;
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_value
operator|!=
name|NULLAttrV
condition|)
name|AttrV_free
argument_list|(
name|at_prob
operator|->
name|DSE_at_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_type
operator|!=
name|NULLAttrT
condition|)
name|AttrT_free
argument_list|(
name|at_prob
operator|->
name|DSE_at_type
argument_list|)
expr_stmt|;
for|for
control|(
name|at_prob
operator|=
name|at_prob
operator|->
name|dse_at_next
init|;
name|at_prob
operator|!=
name|DSE_AT_NOPROBLEM
condition|;
name|at_prob
operator|=
name|at_prob
operator|->
name|dse_at_next
control|)
block|{
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_value
operator|!=
name|NULLAttrV
condition|)
name|AttrV_free
argument_list|(
name|at_prob
operator|->
name|DSE_at_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|at_prob
operator|->
name|DSE_at_type
operator|!=
name|NULLAttrT
condition|)
name|AttrT_free
argument_list|(
name|at_prob
operator|->
name|DSE_at_type
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|at_prob
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|DSE_NAMEERROR
case|:
name|dn_free
argument_list|(
name|err
operator|->
name|ERR_NAME
operator|.
name|DSE_na_matched
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSE_REFERRAL
case|:
if|if
condition|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_prefix
operator|!=
name|NULLDN
condition|)
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"SCREAM! prefix in referral"
operator|)
argument_list|)
expr_stmt|;
comment|/* fall */
case|case
name|DSE_DSAREFERRAL
case|:
name|dn_free
argument_list|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_prefix
argument_list|)
expr_stmt|;
name|crefs_free
argument_list|(
name|err
operator|->
name|ERR_REFERRAL
operator|.
name|DSE_ref_candidates
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|err
operator|->
name|dse_type
operator|=
name|DSE_NOERROR
expr_stmt|;
block|}
end_block

begin_macro
name|ds_bind_error
argument_list|(
argument|ps
argument_list|,
argument|err
argument_list|)
end_macro

begin_decl_stmt
name|PS
name|ps
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ds_bind_error
modifier|*
name|err
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|err
operator|->
name|dbe_type
condition|)
block|{
case|case
name|DBE_TYPE_SERVICE
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Service error : %s ***\n"
argument_list|,
name|service
index|[
name|err
operator|->
name|dbe_value
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DBE_TYPE_SECURITY
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Security error : %s ***\n"
argument_list|,
name|security
index|[
name|err
operator|->
name|dbe_value
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"*** Unrecognised bind error! ***"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

end_unit

