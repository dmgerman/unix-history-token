begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<gdbm.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|gdbm_errno
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|GDBM_FILE
name|db
decl_stmt|;
name|datum
name|key
decl_stmt|,
name|content
decl_stmt|;
name|char
name|buf
index|[
literal|4096
index|]
decl_stmt|,
name|kbuf
index|[
literal|256
index|]
decl_stmt|;
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|rc
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|int
name|buflen
decl_stmt|,
name|len
decl_stmt|;
name|char
name|type
index|[
literal|80
index|]
decl_stmt|,
name|version
index|[
literal|256
index|]
decl_stmt|;
name|char
name|gfname
index|[
literal|1024
index|]
decl_stmt|;
name|char
modifier|*
name|TidyString
argument_list|()
decl_stmt|,
modifier|*
name|rindex
argument_list|()
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|"usage: %s edbdbmfile\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|gfname
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|rindex
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|'.'
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|strcmp
argument_list|(
name|p
argument_list|,
literal|".gdbm"
argument_list|)
operator|!=
literal|0
condition|)
name|strcat
argument_list|(
name|gfname
argument_list|,
literal|".gdbm"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|db
operator|=
name|gdbm_open
argument_list|(
name|gfname
argument_list|,
literal|0
argument_list|,
name|GDBM_READER
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"Can't open (%s)\ndbm_error is (%d)\n"
argument_list|,
name|gfname
argument_list|,
name|gdbm_errno
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|key
operator|.
name|dptr
operator|=
literal|"HEADER"
expr_stmt|;
name|key
operator|.
name|dsize
operator|=
sizeof|sizeof
argument_list|(
literal|"HEADER"
argument_list|)
expr_stmt|;
name|content
operator|=
name|gdbm_fetch
argument_list|(
name|db
argument_list|,
name|key
argument_list|)
expr_stmt|;
if|if
condition|(
name|content
operator|.
name|dptr
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|"No header!  Continuing...\n"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|content
operator|.
name|dptr
argument_list|)
expr_stmt|;
for|for
control|(
name|key
operator|=
name|gdbm_firstkey
argument_list|(
name|db
argument_list|)
init|;
name|key
operator|.
name|dptr
condition|;
name|key
operator|=
name|gdbm_nextkey
argument_list|(
name|db
argument_list|,
name|key
argument_list|)
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|key
operator|.
name|dptr
argument_list|,
literal|"HEADER"
argument_list|)
operator|==
literal|0
condition|)
continue|continue;
name|content
operator|=
name|gdbm_fetch
argument_list|(
name|db
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|content
operator|.
name|dptr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|content
operator|.
name|dptr
argument_list|)
expr_stmt|;
name|content
operator|.
name|dptr
operator|=
name|NULL
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|gdbm_close
argument_list|(
name|db
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

