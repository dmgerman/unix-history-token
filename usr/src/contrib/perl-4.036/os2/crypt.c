begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*      From Andy Tanenbaum's book "Computer Networks",         rewritten in C */
end_comment

begin_struct
struct|struct
name|block
block|{
name|unsigned
name|char
name|b_data
index|[
literal|64
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ordering
block|{
name|unsigned
name|char
name|o_data
index|[
literal|64
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|block
name|key
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|InitialTr
init|=
block|{
literal|58
block|,
literal|50
block|,
literal|42
block|,
literal|34
block|,
literal|26
block|,
literal|18
block|,
literal|10
block|,
literal|2
block|,
literal|60
block|,
literal|52
block|,
literal|44
block|,
literal|36
block|,
literal|28
block|,
literal|20
block|,
literal|12
block|,
literal|4
block|,
literal|62
block|,
literal|54
block|,
literal|46
block|,
literal|38
block|,
literal|30
block|,
literal|22
block|,
literal|14
block|,
literal|6
block|,
literal|64
block|,
literal|56
block|,
literal|48
block|,
literal|40
block|,
literal|32
block|,
literal|24
block|,
literal|16
block|,
literal|8
block|,
literal|57
block|,
literal|49
block|,
literal|41
block|,
literal|33
block|,
literal|25
block|,
literal|17
block|,
literal|9
block|,
literal|1
block|,
literal|59
block|,
literal|51
block|,
literal|43
block|,
literal|35
block|,
literal|27
block|,
literal|19
block|,
literal|11
block|,
literal|3
block|,
literal|61
block|,
literal|53
block|,
literal|45
block|,
literal|37
block|,
literal|29
block|,
literal|21
block|,
literal|13
block|,
literal|5
block|,
literal|63
block|,
literal|55
block|,
literal|47
block|,
literal|39
block|,
literal|31
block|,
literal|23
block|,
literal|15
block|,
literal|7
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|FinalTr
init|=
block|{
literal|40
block|,
literal|8
block|,
literal|48
block|,
literal|16
block|,
literal|56
block|,
literal|24
block|,
literal|64
block|,
literal|32
block|,
literal|39
block|,
literal|7
block|,
literal|47
block|,
literal|15
block|,
literal|55
block|,
literal|23
block|,
literal|63
block|,
literal|31
block|,
literal|38
block|,
literal|6
block|,
literal|46
block|,
literal|14
block|,
literal|54
block|,
literal|22
block|,
literal|62
block|,
literal|30
block|,
literal|37
block|,
literal|5
block|,
literal|45
block|,
literal|13
block|,
literal|53
block|,
literal|21
block|,
literal|61
block|,
literal|29
block|,
literal|36
block|,
literal|4
block|,
literal|44
block|,
literal|12
block|,
literal|52
block|,
literal|20
block|,
literal|60
block|,
literal|28
block|,
literal|35
block|,
literal|3
block|,
literal|43
block|,
literal|11
block|,
literal|51
block|,
literal|19
block|,
literal|59
block|,
literal|27
block|,
literal|34
block|,
literal|2
block|,
literal|42
block|,
literal|10
block|,
literal|50
block|,
literal|18
block|,
literal|58
block|,
literal|26
block|,
literal|33
block|,
literal|1
block|,
literal|41
block|,
literal|9
block|,
literal|49
block|,
literal|17
block|,
literal|57
block|,
literal|25
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|swap
init|=
block|{
literal|33
block|,
literal|34
block|,
literal|35
block|,
literal|36
block|,
literal|37
block|,
literal|38
block|,
literal|39
block|,
literal|40
block|,
literal|41
block|,
literal|42
block|,
literal|43
block|,
literal|44
block|,
literal|45
block|,
literal|46
block|,
literal|47
block|,
literal|48
block|,
literal|49
block|,
literal|50
block|,
literal|51
block|,
literal|52
block|,
literal|53
block|,
literal|54
block|,
literal|55
block|,
literal|56
block|,
literal|57
block|,
literal|58
block|,
literal|59
block|,
literal|60
block|,
literal|61
block|,
literal|62
block|,
literal|63
block|,
literal|64
block|,
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|13
block|,
literal|14
block|,
literal|15
block|,
literal|16
block|,
literal|17
block|,
literal|18
block|,
literal|19
block|,
literal|20
block|,
literal|21
block|,
literal|22
block|,
literal|23
block|,
literal|24
block|,
literal|25
block|,
literal|26
block|,
literal|27
block|,
literal|28
block|,
literal|29
block|,
literal|30
block|,
literal|31
block|,
literal|32
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|KeyTr1
init|=
block|{
literal|57
block|,
literal|49
block|,
literal|41
block|,
literal|33
block|,
literal|25
block|,
literal|17
block|,
literal|9
block|,
literal|1
block|,
literal|58
block|,
literal|50
block|,
literal|42
block|,
literal|34
block|,
literal|26
block|,
literal|18
block|,
literal|10
block|,
literal|2
block|,
literal|59
block|,
literal|51
block|,
literal|43
block|,
literal|35
block|,
literal|27
block|,
literal|19
block|,
literal|11
block|,
literal|3
block|,
literal|60
block|,
literal|52
block|,
literal|44
block|,
literal|36
block|,
literal|63
block|,
literal|55
block|,
literal|47
block|,
literal|39
block|,
literal|31
block|,
literal|23
block|,
literal|15
block|,
literal|7
block|,
literal|62
block|,
literal|54
block|,
literal|46
block|,
literal|38
block|,
literal|30
block|,
literal|22
block|,
literal|14
block|,
literal|6
block|,
literal|61
block|,
literal|53
block|,
literal|45
block|,
literal|37
block|,
literal|29
block|,
literal|21
block|,
literal|13
block|,
literal|5
block|,
literal|28
block|,
literal|20
block|,
literal|12
block|,
literal|4
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|KeyTr2
init|=
block|{
literal|14
block|,
literal|17
block|,
literal|11
block|,
literal|24
block|,
literal|1
block|,
literal|5
block|,
literal|3
block|,
literal|28
block|,
literal|15
block|,
literal|6
block|,
literal|21
block|,
literal|10
block|,
literal|23
block|,
literal|19
block|,
literal|12
block|,
literal|4
block|,
literal|26
block|,
literal|8
block|,
literal|16
block|,
literal|7
block|,
literal|27
block|,
literal|20
block|,
literal|13
block|,
literal|2
block|,
literal|41
block|,
literal|52
block|,
literal|31
block|,
literal|37
block|,
literal|47
block|,
literal|55
block|,
literal|30
block|,
literal|40
block|,
literal|51
block|,
literal|45
block|,
literal|33
block|,
literal|48
block|,
literal|44
block|,
literal|49
block|,
literal|39
block|,
literal|56
block|,
literal|34
block|,
literal|53
block|,
literal|46
block|,
literal|42
block|,
literal|50
block|,
literal|36
block|,
literal|29
block|,
literal|32
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|etr
init|=
block|{
literal|32
block|,
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|7
block|,
literal|8
block|,
literal|9
block|,
literal|8
block|,
literal|9
block|,
literal|10
block|,
literal|11
block|,
literal|12
block|,
literal|13
block|,
literal|12
block|,
literal|13
block|,
literal|14
block|,
literal|15
block|,
literal|16
block|,
literal|17
block|,
literal|16
block|,
literal|17
block|,
literal|18
block|,
literal|19
block|,
literal|20
block|,
literal|21
block|,
literal|20
block|,
literal|21
block|,
literal|22
block|,
literal|23
block|,
literal|24
block|,
literal|25
block|,
literal|24
block|,
literal|25
block|,
literal|26
block|,
literal|27
block|,
literal|28
block|,
literal|29
block|,
literal|28
block|,
literal|29
block|,
literal|30
block|,
literal|31
block|,
literal|32
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|ordering
name|ptr
init|=
block|{
literal|16
block|,
literal|7
block|,
literal|20
block|,
literal|21
block|,
literal|29
block|,
literal|12
block|,
literal|28
block|,
literal|17
block|,
literal|1
block|,
literal|15
block|,
literal|23
block|,
literal|26
block|,
literal|5
block|,
literal|18
block|,
literal|31
block|,
literal|10
block|,
literal|2
block|,
literal|8
block|,
literal|24
block|,
literal|14
block|,
literal|32
block|,
literal|27
block|,
literal|3
block|,
literal|9
block|,
literal|19
block|,
literal|13
block|,
literal|30
block|,
literal|6
block|,
literal|22
block|,
literal|11
block|,
literal|4
block|,
literal|25
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|s_boxes
index|[
literal|8
index|]
index|[
literal|64
index|]
init|=
block|{
block|{
literal|14
block|,
literal|4
block|,
literal|13
block|,
literal|1
block|,
literal|2
block|,
literal|15
block|,
literal|11
block|,
literal|8
block|,
literal|3
block|,
literal|10
block|,
literal|6
block|,
literal|12
block|,
literal|5
block|,
literal|9
block|,
literal|0
block|,
literal|7
block|,
literal|0
block|,
literal|15
block|,
literal|7
block|,
literal|4
block|,
literal|14
block|,
literal|2
block|,
literal|13
block|,
literal|1
block|,
literal|10
block|,
literal|6
block|,
literal|12
block|,
literal|11
block|,
literal|9
block|,
literal|5
block|,
literal|3
block|,
literal|8
block|,
literal|4
block|,
literal|1
block|,
literal|14
block|,
literal|8
block|,
literal|13
block|,
literal|6
block|,
literal|2
block|,
literal|11
block|,
literal|15
block|,
literal|12
block|,
literal|9
block|,
literal|7
block|,
literal|3
block|,
literal|10
block|,
literal|5
block|,
literal|0
block|,
literal|15
block|,
literal|12
block|,
literal|8
block|,
literal|2
block|,
literal|4
block|,
literal|9
block|,
literal|1
block|,
literal|7
block|,
literal|5
block|,
literal|11
block|,
literal|3
block|,
literal|14
block|,
literal|10
block|,
literal|0
block|,
literal|6
block|,
literal|13
block|, }
block|,
block|{
literal|15
block|,
literal|1
block|,
literal|8
block|,
literal|14
block|,
literal|6
block|,
literal|11
block|,
literal|3
block|,
literal|4
block|,
literal|9
block|,
literal|7
block|,
literal|2
block|,
literal|13
block|,
literal|12
block|,
literal|0
block|,
literal|5
block|,
literal|10
block|,
literal|3
block|,
literal|13
block|,
literal|4
block|,
literal|7
block|,
literal|15
block|,
literal|2
block|,
literal|8
block|,
literal|14
block|,
literal|12
block|,
literal|0
block|,
literal|1
block|,
literal|10
block|,
literal|6
block|,
literal|9
block|,
literal|11
block|,
literal|5
block|,
literal|0
block|,
literal|14
block|,
literal|7
block|,
literal|11
block|,
literal|10
block|,
literal|4
block|,
literal|13
block|,
literal|1
block|,
literal|5
block|,
literal|8
block|,
literal|12
block|,
literal|6
block|,
literal|9
block|,
literal|3
block|,
literal|2
block|,
literal|15
block|,
literal|13
block|,
literal|8
block|,
literal|10
block|,
literal|1
block|,
literal|3
block|,
literal|15
block|,
literal|4
block|,
literal|2
block|,
literal|11
block|,
literal|6
block|,
literal|7
block|,
literal|12
block|,
literal|0
block|,
literal|5
block|,
literal|14
block|,
literal|9
block|, }
block|,
block|{
literal|10
block|,
literal|0
block|,
literal|9
block|,
literal|14
block|,
literal|6
block|,
literal|3
block|,
literal|15
block|,
literal|5
block|,
literal|1
block|,
literal|13
block|,
literal|12
block|,
literal|7
block|,
literal|11
block|,
literal|4
block|,
literal|2
block|,
literal|8
block|,
literal|13
block|,
literal|7
block|,
literal|0
block|,
literal|9
block|,
literal|3
block|,
literal|4
block|,
literal|6
block|,
literal|10
block|,
literal|2
block|,
literal|8
block|,
literal|5
block|,
literal|14
block|,
literal|12
block|,
literal|11
block|,
literal|15
block|,
literal|1
block|,
literal|13
block|,
literal|6
block|,
literal|4
block|,
literal|9
block|,
literal|8
block|,
literal|15
block|,
literal|3
block|,
literal|0
block|,
literal|11
block|,
literal|1
block|,
literal|2
block|,
literal|12
block|,
literal|5
block|,
literal|10
block|,
literal|14
block|,
literal|7
block|,
literal|1
block|,
literal|10
block|,
literal|13
block|,
literal|0
block|,
literal|6
block|,
literal|9
block|,
literal|8
block|,
literal|7
block|,
literal|4
block|,
literal|15
block|,
literal|14
block|,
literal|3
block|,
literal|11
block|,
literal|5
block|,
literal|2
block|,
literal|12
block|, }
block|,
block|{
literal|7
block|,
literal|13
block|,
literal|14
block|,
literal|3
block|,
literal|0
block|,
literal|6
block|,
literal|9
block|,
literal|10
block|,
literal|1
block|,
literal|2
block|,
literal|8
block|,
literal|5
block|,
literal|11
block|,
literal|12
block|,
literal|4
block|,
literal|15
block|,
literal|13
block|,
literal|8
block|,
literal|11
block|,
literal|5
block|,
literal|6
block|,
literal|15
block|,
literal|0
block|,
literal|3
block|,
literal|4
block|,
literal|7
block|,
literal|2
block|,
literal|12
block|,
literal|1
block|,
literal|10
block|,
literal|14
block|,
literal|9
block|,
literal|10
block|,
literal|6
block|,
literal|9
block|,
literal|0
block|,
literal|12
block|,
literal|11
block|,
literal|7
block|,
literal|13
block|,
literal|15
block|,
literal|1
block|,
literal|3
block|,
literal|14
block|,
literal|5
block|,
literal|2
block|,
literal|8
block|,
literal|4
block|,
literal|3
block|,
literal|15
block|,
literal|0
block|,
literal|6
block|,
literal|10
block|,
literal|1
block|,
literal|13
block|,
literal|8
block|,
literal|9
block|,
literal|4
block|,
literal|5
block|,
literal|11
block|,
literal|12
block|,
literal|7
block|,
literal|2
block|,
literal|14
block|, }
block|,
block|{
literal|2
block|,
literal|12
block|,
literal|4
block|,
literal|1
block|,
literal|7
block|,
literal|10
block|,
literal|11
block|,
literal|6
block|,
literal|8
block|,
literal|5
block|,
literal|3
block|,
literal|15
block|,
literal|13
block|,
literal|0
block|,
literal|14
block|,
literal|9
block|,
literal|14
block|,
literal|11
block|,
literal|2
block|,
literal|12
block|,
literal|4
block|,
literal|7
block|,
literal|13
block|,
literal|1
block|,
literal|5
block|,
literal|0
block|,
literal|15
block|,
literal|10
block|,
literal|3
block|,
literal|9
block|,
literal|8
block|,
literal|6
block|,
literal|4
block|,
literal|2
block|,
literal|1
block|,
literal|11
block|,
literal|10
block|,
literal|13
block|,
literal|7
block|,
literal|8
block|,
literal|15
block|,
literal|9
block|,
literal|12
block|,
literal|5
block|,
literal|6
block|,
literal|3
block|,
literal|0
block|,
literal|14
block|,
literal|11
block|,
literal|8
block|,
literal|12
block|,
literal|7
block|,
literal|1
block|,
literal|14
block|,
literal|2
block|,
literal|13
block|,
literal|6
block|,
literal|15
block|,
literal|0
block|,
literal|9
block|,
literal|10
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|, }
block|,
block|{
literal|12
block|,
literal|1
block|,
literal|10
block|,
literal|15
block|,
literal|9
block|,
literal|2
block|,
literal|6
block|,
literal|8
block|,
literal|0
block|,
literal|13
block|,
literal|3
block|,
literal|4
block|,
literal|14
block|,
literal|7
block|,
literal|5
block|,
literal|11
block|,
literal|10
block|,
literal|15
block|,
literal|4
block|,
literal|2
block|,
literal|7
block|,
literal|12
block|,
literal|9
block|,
literal|5
block|,
literal|6
block|,
literal|1
block|,
literal|13
block|,
literal|14
block|,
literal|0
block|,
literal|11
block|,
literal|3
block|,
literal|8
block|,
literal|9
block|,
literal|14
block|,
literal|15
block|,
literal|5
block|,
literal|2
block|,
literal|8
block|,
literal|12
block|,
literal|3
block|,
literal|7
block|,
literal|0
block|,
literal|4
block|,
literal|10
block|,
literal|1
block|,
literal|13
block|,
literal|11
block|,
literal|6
block|,
literal|4
block|,
literal|3
block|,
literal|2
block|,
literal|12
block|,
literal|9
block|,
literal|5
block|,
literal|15
block|,
literal|10
block|,
literal|11
block|,
literal|14
block|,
literal|1
block|,
literal|7
block|,
literal|6
block|,
literal|0
block|,
literal|8
block|,
literal|13
block|, }
block|,
block|{
literal|4
block|,
literal|11
block|,
literal|2
block|,
literal|14
block|,
literal|15
block|,
literal|0
block|,
literal|8
block|,
literal|13
block|,
literal|3
block|,
literal|12
block|,
literal|9
block|,
literal|7
block|,
literal|5
block|,
literal|10
block|,
literal|6
block|,
literal|1
block|,
literal|13
block|,
literal|0
block|,
literal|11
block|,
literal|7
block|,
literal|4
block|,
literal|9
block|,
literal|1
block|,
literal|10
block|,
literal|14
block|,
literal|3
block|,
literal|5
block|,
literal|12
block|,
literal|2
block|,
literal|15
block|,
literal|8
block|,
literal|6
block|,
literal|1
block|,
literal|4
block|,
literal|11
block|,
literal|13
block|,
literal|12
block|,
literal|3
block|,
literal|7
block|,
literal|14
block|,
literal|10
block|,
literal|15
block|,
literal|6
block|,
literal|8
block|,
literal|0
block|,
literal|5
block|,
literal|9
block|,
literal|2
block|,
literal|6
block|,
literal|11
block|,
literal|13
block|,
literal|8
block|,
literal|1
block|,
literal|4
block|,
literal|10
block|,
literal|7
block|,
literal|9
block|,
literal|5
block|,
literal|0
block|,
literal|15
block|,
literal|14
block|,
literal|2
block|,
literal|3
block|,
literal|12
block|, }
block|,
block|{
literal|13
block|,
literal|2
block|,
literal|8
block|,
literal|4
block|,
literal|6
block|,
literal|15
block|,
literal|11
block|,
literal|1
block|,
literal|10
block|,
literal|9
block|,
literal|3
block|,
literal|14
block|,
literal|5
block|,
literal|0
block|,
literal|12
block|,
literal|7
block|,
literal|1
block|,
literal|15
block|,
literal|13
block|,
literal|8
block|,
literal|10
block|,
literal|3
block|,
literal|7
block|,
literal|4
block|,
literal|12
block|,
literal|5
block|,
literal|6
block|,
literal|11
block|,
literal|0
block|,
literal|14
block|,
literal|9
block|,
literal|2
block|,
literal|7
block|,
literal|11
block|,
literal|4
block|,
literal|1
block|,
literal|9
block|,
literal|12
block|,
literal|14
block|,
literal|2
block|,
literal|0
block|,
literal|6
block|,
literal|10
block|,
literal|13
block|,
literal|15
block|,
literal|3
block|,
literal|5
block|,
literal|8
block|,
literal|2
block|,
literal|1
block|,
literal|14
block|,
literal|7
block|,
literal|4
block|,
literal|10
block|,
literal|8
block|,
literal|13
block|,
literal|15
block|,
literal|12
block|,
literal|9
block|,
literal|0
block|,
literal|3
block|,
literal|5
block|,
literal|6
block|,
literal|11
block|, }
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|rots
index|[]
init|=
block|{
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|1
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|transpose
parameter_list|(
name|struct
name|block
modifier|*
name|data
parameter_list|,
name|struct
name|ordering
modifier|*
name|t
parameter_list|,
name|int
name|n
parameter_list|)
block|{
name|struct
name|block
name|x
decl_stmt|;
name|x
operator|=
operator|*
name|data
expr_stmt|;
while|while
condition|(
name|n
operator|--
operator|>
literal|0
condition|)
block|{
name|data
operator|->
name|b_data
index|[
name|n
index|]
operator|=
name|x
operator|.
name|b_data
index|[
name|t
operator|->
name|o_data
index|[
name|n
index|]
operator|-
literal|1
index|]
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|rotate
parameter_list|(
name|struct
name|block
modifier|*
name|key
parameter_list|)
block|{
specifier|register
name|unsigned
name|char
modifier|*
name|p
init|=
name|key
operator|->
name|b_data
decl_stmt|;
specifier|register
name|unsigned
name|char
modifier|*
name|ep
init|=
operator|&
operator|(
name|key
operator|->
name|b_data
index|[
literal|55
index|]
operator|)
decl_stmt|;
name|int
name|data0
init|=
name|key
operator|->
name|b_data
index|[
literal|0
index|]
decl_stmt|,
name|data28
init|=
name|key
operator|->
name|b_data
index|[
literal|28
index|]
decl_stmt|;
while|while
condition|(
name|p
operator|++
operator|<
name|ep
condition|)
operator|*
operator|(
name|p
operator|-
literal|1
operator|)
operator|=
operator|*
name|p
expr_stmt|;
name|key
operator|->
name|b_data
index|[
literal|27
index|]
operator|=
operator|(
name|char
operator|)
name|data0
expr_stmt|;
name|key
operator|->
name|b_data
index|[
literal|55
index|]
operator|=
operator|(
name|char
operator|)
name|data28
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|ordering
modifier|*
name|EP
init|=
operator|&
name|etr
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|f
parameter_list|(
name|int
name|i
parameter_list|,
name|struct
name|block
modifier|*
name|key
parameter_list|,
name|struct
name|block
modifier|*
name|a
parameter_list|,
name|struct
name|block
modifier|*
name|x
parameter_list|)
block|{
name|struct
name|block
name|e
decl_stmt|,
name|ikey
decl_stmt|,
name|y
decl_stmt|;
name|int
name|k
decl_stmt|;
specifier|register
name|unsigned
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|,
modifier|*
name|r
decl_stmt|;
name|e
operator|=
operator|*
name|a
expr_stmt|;
name|transpose
argument_list|(
operator|&
name|e
argument_list|,
name|EP
argument_list|,
literal|48
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
name|rots
index|[
name|i
index|]
init|;
name|k
condition|;
name|k
operator|--
control|)
name|rotate
argument_list|(
name|key
argument_list|)
expr_stmt|;
name|ikey
operator|=
operator|*
name|key
expr_stmt|;
name|transpose
argument_list|(
operator|&
name|ikey
argument_list|,
operator|&
name|KeyTr2
argument_list|,
literal|48
argument_list|)
expr_stmt|;
name|p
operator|=
operator|&
operator|(
name|y
operator|.
name|b_data
index|[
literal|48
index|]
operator|)
expr_stmt|;
name|q
operator|=
operator|&
operator|(
name|e
operator|.
name|b_data
index|[
literal|48
index|]
operator|)
expr_stmt|;
name|r
operator|=
operator|&
operator|(
name|ikey
operator|.
name|b_data
index|[
literal|48
index|]
operator|)
expr_stmt|;
while|while
condition|(
name|p
operator|>
name|y
operator|.
name|b_data
condition|)
block|{
operator|*
operator|--
name|p
operator|=
operator|*
operator|--
name|q
operator|^
operator|*
operator|--
name|r
expr_stmt|;
block|}
name|q
operator|=
name|x
operator|->
name|b_data
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
literal|8
condition|;
name|k
operator|++
control|)
block|{
specifier|register
name|int
name|xb
decl_stmt|,
name|r
decl_stmt|;
name|r
operator|=
operator|*
name|p
operator|++
operator|<<
literal|5
expr_stmt|;
name|r
operator|+=
operator|*
name|p
operator|++
operator|<<
literal|3
expr_stmt|;
name|r
operator|+=
operator|*
name|p
operator|++
operator|<<
literal|2
expr_stmt|;
name|r
operator|+=
operator|*
name|p
operator|++
operator|<<
literal|1
expr_stmt|;
name|r
operator|+=
operator|*
name|p
operator|++
expr_stmt|;
name|r
operator|+=
operator|*
name|p
operator|++
operator|<<
literal|4
expr_stmt|;
name|xb
operator|=
name|s_boxes
index|[
name|k
index|]
index|[
name|r
index|]
expr_stmt|;
operator|*
name|q
operator|++
operator|=
call|(
name|char
call|)
argument_list|(
name|xb
operator|>>
literal|3
argument_list|)
operator|&
literal|1
expr_stmt|;
operator|*
name|q
operator|++
operator|=
call|(
name|char
call|)
argument_list|(
name|xb
operator|>>
literal|2
argument_list|)
operator|&
literal|1
expr_stmt|;
operator|*
name|q
operator|++
operator|=
call|(
name|char
call|)
argument_list|(
name|xb
operator|>>
literal|1
argument_list|)
operator|&
literal|1
expr_stmt|;
operator|*
name|q
operator|++
operator|=
call|(
name|char
call|)
argument_list|(
name|xb
operator|&
literal|1
argument_list|)
expr_stmt|;
block|}
name|transpose
argument_list|(
name|x
argument_list|,
operator|&
name|ptr
argument_list|,
literal|32
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|definekey
parameter_list|(
name|char
modifier|*
name|k
parameter_list|)
block|{
name|key
operator|=
operator|*
operator|(
operator|(
expr|struct
name|block
operator|*
operator|)
name|k
operator|)
expr_stmt|;
name|transpose
argument_list|(
operator|&
name|key
argument_list|,
operator|&
name|KeyTr1
argument_list|,
literal|56
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|encrypt
parameter_list|(
name|char
modifier|*
name|blck
parameter_list|,
name|int
name|edflag
parameter_list|)
block|{
specifier|register
name|struct
name|block
modifier|*
name|p
init|=
operator|(
expr|struct
name|block
operator|*
operator|)
name|blck
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|transpose
argument_list|(
name|p
argument_list|,
operator|&
name|InitialTr
argument_list|,
literal|64
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|15
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|int
name|j
init|=
name|edflag
condition|?
name|i
else|:
literal|15
operator|-
name|i
decl_stmt|;
specifier|register
name|int
name|k
decl_stmt|;
name|struct
name|block
name|b
decl_stmt|,
name|x
decl_stmt|;
name|b
operator|=
operator|*
name|p
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|31
init|;
name|k
operator|>=
literal|0
condition|;
name|k
operator|--
control|)
block|{
name|p
operator|->
name|b_data
index|[
name|k
index|]
operator|=
name|b
operator|.
name|b_data
index|[
name|k
operator|+
literal|32
index|]
expr_stmt|;
block|}
name|f
argument_list|(
name|j
argument_list|,
operator|&
name|key
argument_list|,
name|p
argument_list|,
operator|&
name|x
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|31
init|;
name|k
operator|>=
literal|0
condition|;
name|k
operator|--
control|)
block|{
name|p
operator|->
name|b_data
index|[
name|k
operator|+
literal|32
index|]
operator|=
name|b
operator|.
name|b_data
index|[
name|k
index|]
operator|^
name|x
operator|.
name|b_data
index|[
name|k
index|]
expr_stmt|;
block|}
block|}
name|transpose
argument_list|(
name|p
argument_list|,
operator|&
name|swap
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|transpose
argument_list|(
name|p
argument_list|,
operator|&
name|FinalTr
argument_list|,
literal|64
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
name|crypt
parameter_list|(
name|char
modifier|*
name|pw
parameter_list|,
name|char
modifier|*
name|salt
parameter_list|)
block|{
name|char
name|pwb
index|[
literal|66
index|]
decl_stmt|;
specifier|static
name|char
name|result
index|[
literal|16
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
init|=
name|pwb
decl_stmt|;
name|struct
name|ordering
name|new_etr
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
while|while
condition|(
operator|*
name|pw
operator|&&
name|p
operator|<
operator|&
name|pwb
index|[
literal|64
index|]
condition|)
block|{
specifier|register
name|int
name|j
init|=
literal|7
decl_stmt|;
while|while
condition|(
name|j
operator|--
condition|)
block|{
operator|*
name|p
operator|++
operator|=
operator|(
operator|*
name|pw
operator|>>
name|j
operator|)
operator|&
literal|01
expr_stmt|;
block|}
name|pw
operator|++
expr_stmt|;
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
block|}
while|while
condition|(
name|p
operator|<
operator|&
name|pwb
index|[
literal|64
index|]
condition|)
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
name|definekey
argument_list|(
name|p
operator|=
name|pwb
argument_list|)
expr_stmt|;
while|while
condition|(
name|p
operator|<
operator|&
name|pwb
index|[
literal|66
index|]
condition|)
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
name|new_etr
operator|=
name|etr
expr_stmt|;
name|EP
operator|=
operator|&
name|new_etr
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
specifier|register
name|char
name|c
init|=
operator|*
name|salt
operator|++
decl_stmt|;
specifier|register
name|int
name|j
decl_stmt|;
name|result
index|[
name|i
index|]
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|c
operator|>
literal|'Z'
condition|)
name|c
operator|-=
literal|6
operator|+
literal|7
operator|+
literal|'.'
expr_stmt|;
comment|/* c was a lower case letter */
elseif|else
if|if
condition|(
name|c
operator|>
literal|'9'
condition|)
name|c
operator|-=
literal|7
operator|+
literal|'.'
expr_stmt|;
comment|/* c was upper case letter */
else|else
name|c
operator|-=
literal|'.'
expr_stmt|;
comment|/* c was digit, '.' or '/'. */
comment|/* now, 0<= c<= 63 */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|6
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|c
operator|>>
name|j
operator|)
operator|&
literal|01
condition|)
block|{
name|int
name|t
init|=
literal|6
operator|*
name|i
operator|+
name|j
decl_stmt|;
name|int
name|temp
init|=
name|new_etr
operator|.
name|o_data
index|[
name|t
index|]
decl_stmt|;
name|new_etr
operator|.
name|o_data
index|[
name|t
index|]
operator|=
name|new_etr
operator|.
name|o_data
index|[
name|t
operator|+
literal|24
index|]
expr_stmt|;
name|new_etr
operator|.
name|o_data
index|[
name|t
operator|+
literal|24
index|]
operator|=
operator|(
name|char
operator|)
name|temp
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|result
index|[
literal|1
index|]
operator|==
literal|0
condition|)
name|result
index|[
literal|1
index|]
operator|=
name|result
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|25
condition|;
name|i
operator|++
control|)
name|encrypt
argument_list|(
name|pwb
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|EP
operator|=
operator|&
name|etr
expr_stmt|;
name|p
operator|=
name|pwb
expr_stmt|;
name|pw
operator|=
name|result
operator|+
literal|2
expr_stmt|;
while|while
condition|(
name|p
operator|<
operator|&
name|pwb
index|[
literal|66
index|]
condition|)
block|{
specifier|register
name|int
name|c
init|=
literal|0
decl_stmt|;
specifier|register
name|int
name|j
init|=
literal|6
decl_stmt|;
while|while
condition|(
name|j
operator|--
condition|)
block|{
name|c
operator|<<=
literal|1
expr_stmt|;
name|c
operator||=
operator|*
name|p
operator|++
expr_stmt|;
block|}
name|c
operator|+=
literal|'.'
expr_stmt|;
comment|/* becomes>= '.' */
if|if
condition|(
name|c
operator|>
literal|'9'
condition|)
name|c
operator|+=
literal|7
expr_stmt|;
comment|/* not in [./0-9], becomes upper */
if|if
condition|(
name|c
operator|>
literal|'Z'
condition|)
name|c
operator|+=
literal|6
expr_stmt|;
comment|/* not in [A-Z], becomes lower */
operator|*
name|pw
operator|++
operator|=
operator|(
name|char
operator|)
name|c
expr_stmt|;
block|}
operator|*
name|pw
operator|=
literal|0
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

end_unit

