begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/***************************************************************************  * This program is Copyright (C) 1986, 1987, 1988 by Jonathan Payne.  JOVE *  * is provided to you without charge, and with no warranty.  You may give  *  * away copies of JOVE, including sources, provided that this notice is    *  * included in all the files.                                              *  ***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"jove.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|IBMPC
end_ifdef

begin_comment
comment|/* here come the actual emulation routines	*/
end_comment

begin_include
include|#
directive|include
file|<dos.h>
end_include

begin_include
include|#
directive|include
file|<conio.h>
end_include

begin_define
define|#
directive|define
name|BYTE
value|unsigned char
end_define

begin_define
define|#
directive|define
name|WORD
value|unsigned int
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|MAC
end_ifdef

begin_undef
undef|#
directive|undef
name|private
end_undef

begin_define
define|#
directive|define
name|private
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|private
name|BYTE
name|near
name|get_mode
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|WORD
name|near
name|cur_page
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|get_cur
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|private
name|void
name|near
name|ch_out
name|proto
argument_list|(
operator|(
name|BYTE
operator|,
name|BYTE
operator|)
argument_list|)
decl_stmt|,
name|near
name|clr_eop
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|cur_advance
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|cur_down
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|cur_left
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|cur_right
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|cur_up
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|line_feed
name|proto
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|,
name|near
name|set_cur
name|proto
argument_list|(
operator|(
name|WORD
operator|)
argument_list|)
decl_stmt|,
name|near
name|set_mode
name|proto
argument_list|(
operator|(
name|BYTE
operator|)
argument_list|)
decl_stmt|,
name|near
name|wherexy
name|proto
argument_list|(
operator|(
name|BYTE
operator|*
operator|,
name|BYTE
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|near
name|normfun
name|proto
argument_list|(
operator|(
name|char
operator|)
argument_list|)
decl_stmt|,
name|near
name|scr_win
name|proto
argument_list|(
operator|(
name|int
operator|,
name|BYTE
operator|,
name|BYTE
operator|,
name|BYTE
operator|,
name|BYTE
operator|)
argument_list|)
decl_stmt|,
name|near
name|clr_page
argument_list|()
decl_stmt|,
name|near
name|clr_eoln
argument_list|()
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|MAC
end_ifdef

begin_undef
undef|#
directive|undef
name|private
end_undef

begin_define
define|#
directive|define
name|private
value|static
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|VIDEO
value|0x10
end_define

begin_define
define|#
directive|define
name|intr
parameter_list|(
name|n
parameter_list|,
name|r
parameter_list|)
value|int86((n), (r), (r));
end_define

begin_decl_stmt
name|BYTE
name|CHPL
init|=
literal|80
decl_stmt|,
name|LPP
init|=
literal|25
decl_stmt|,
name|CUR_PAGE
init|=
literal|0
decl_stmt|,
name|C_ATTR
init|=
literal|0x07
decl_stmt|,
name|C_X
init|=
literal|0
decl_stmt|,
name|C_Y
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|Fgcolor
init|=
literal|7
decl_stmt|,
name|Bgcolor
init|=
literal|0
decl_stmt|,
name|Mdcolor
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|setcolor
parameter_list|(
name|fg
parameter_list|,
name|bg
parameter_list|)
name|BYTE
name|fg
decl_stmt|,
name|bg
decl_stmt|;
block|{
name|C_ATTR
operator|=
operator|(
operator|(
name|bg
operator|&
literal|0xf
operator|)
operator|<<
literal|4
operator|)
operator||
operator|(
name|fg
operator|&
literal|0xf
operator|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|WORD
name|near
name|cur_page
parameter_list|()
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x0f
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
return|return
name|vr
operator|.
name|h
operator|.
name|bh
return|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|set_cur
parameter_list|(
name|xy
parameter_list|)
name|WORD
name|xy
decl_stmt|;
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
name|CUR_PAGE
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x02
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|dx
operator|=
name|xy
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|WORD
name|near
name|get_cur
parameter_list|()
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
name|CUR_PAGE
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x03
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
return|return
operator|(
name|vr
operator|.
name|x
operator|.
name|dx
operator|)
return|;
block|}
end_function

begin_function
name|private
name|BYTE
name|near
name|get_mode
parameter_list|()
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x0f
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
return|return
name|vr
operator|.
name|h
operator|.
name|al
return|;
block|}
end_function

begin_function
name|BYTE
name|lpp
parameter_list|()
block|{
name|int
name|far
modifier|*
name|regen
init|=
operator|(
name|int
name|far
operator|*
operator|)
literal|0x44C
decl_stmt|;
name|int
name|what
decl_stmt|;
name|BYTE
name|chpl
parameter_list|()
function_decl|;
name|what
operator|=
operator|(
operator|*
name|regen
operator|&
literal|0xff00
operator|)
operator|/
literal|2
operator|/
name|chpl
argument_list|()
expr_stmt|;
return|return
operator|(
name|what
operator|>
literal|43
condition|?
literal|25
else|:
name|what
operator|)
return|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|set_mode
parameter_list|(
name|n
parameter_list|)
name|BYTE
name|n
decl_stmt|;
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x00
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|al
operator|=
name|n
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|gotoxy
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|set_cur((x)<<8|((y)&0xff))
end_define

begin_define
define|#
directive|define
name|cur_mov
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|set_cur((C_X=(x))<<8|((C_Y=(y))&0xff))
end_define

begin_function
name|private
name|void
name|near
name|wherexy
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
name|BYTE
modifier|*
name|x
decl_stmt|,
decl|*
name|y
decl_stmt|;
end_function

begin_block
block|{
specifier|register
name|WORD
name|xy
decl_stmt|;
name|xy
operator|=
name|get_cur
argument_list|()
expr_stmt|;
operator|*
name|x
operator|=
name|xy
operator|>>
literal|8
expr_stmt|;
operator|*
name|y
operator|=
name|xy
operator|&
literal|0xff
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|wherex
parameter_list|()
value|C_X
end_define

begin_define
define|#
directive|define
name|wherey
parameter_list|()
value|C_Y
end_define

begin_function
name|void
name|near
name|scr_win
parameter_list|(
name|no
parameter_list|,
name|ulr
parameter_list|,
name|ulc
parameter_list|,
name|lrr
parameter_list|,
name|lrc
parameter_list|)
name|int
name|no
decl_stmt|;
name|BYTE
name|ulr
decl_stmt|,
name|ulc
decl_stmt|,
name|lrr
decl_stmt|,
name|lrc
decl_stmt|;
block|{
name|union
name|REGS
name|vr
decl_stmt|;
if|if
condition|(
name|no
operator|>=
literal|0
condition|)
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x06
expr_stmt|;
else|else
block|{
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x07
expr_stmt|;
name|no
operator|=
operator|-
name|no
expr_stmt|;
block|}
name|vr
operator|.
name|h
operator|.
name|al
operator|=
name|no
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|cx
operator|=
name|ulr
operator|<<
literal|8
operator||
name|ulc
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|dx
operator|=
name|lrr
operator|<<
literal|8
operator||
name|lrc
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
name|C_ATTR
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|BYTE
name|chpl
parameter_list|()
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x0f
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
return|return
name|vr
operator|.
name|h
operator|.
name|ah
return|;
block|}
end_function

begin_function
name|void
name|near
name|clr_page
parameter_list|()
block|{
name|scr_win
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|LPP
operator|-
literal|1
argument_list|,
name|CHPL
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gotoxy
argument_list|(
name|C_X
operator|=
literal|0
argument_list|,
name|C_Y
operator|=
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|cur_right
parameter_list|()
block|{
if|if
condition|(
name|C_Y
operator|<
name|CHPL
operator|-
literal|1
condition|)
name|C_Y
operator|++
expr_stmt|;
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|cur_up
parameter_list|()
block|{
if|if
condition|(
name|C_X
condition|)
name|C_X
operator|--
expr_stmt|;
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|cur_left
parameter_list|()
block|{
if|if
condition|(
name|C_Y
condition|)
name|C_Y
operator|--
expr_stmt|;
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|cur_down
parameter_list|()
block|{
if|if
condition|(
name|C_X
operator|<
name|LPP
operator|-
literal|1
condition|)
name|C_X
operator|++
expr_stmt|;
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|ch_out
parameter_list|(
name|c
parameter_list|,
name|n
parameter_list|)
name|BYTE
name|c
decl_stmt|,
name|n
decl_stmt|;
block|{
name|union
name|REGS
name|vr
decl_stmt|;
name|vr
operator|.
name|h
operator|.
name|ah
operator|=
literal|0x09
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|al
operator|=
name|c
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bl
operator|=
name|C_ATTR
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
name|CUR_PAGE
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|cx
operator|=
name|n
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|wrch
parameter_list|(
name|c
parameter_list|)
value|ch_out((c), 1), cur_advance()
end_define

begin_define
define|#
directive|define
name|home_cur
parameter_list|()
value|gotoxy(C_X = 0, C_Y = 0)
end_define

begin_function
name|void
name|near
name|clr_eoln
parameter_list|()
block|{
name|ch_out
argument_list|(
literal|' '
argument_list|,
name|CHPL
operator|-
name|wherey
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|private
name|void
name|near
name|clr_eop
parameter_list|()
block|{
name|clr_eoln
argument_list|()
expr_stmt|;
name|scr_win
argument_list|(
name|LPP
operator|-
literal|1
operator|-
name|wherex
argument_list|()
argument_list|,
name|wherex
argument_list|()
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
name|LPP
operator|-
literal|1
argument_list|,
name|CHPL
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|init_43
parameter_list|()
block|{
name|BYTE
name|far
modifier|*
name|info
init|=
operator|(
name|BYTE
name|far
operator|*
operator|)
literal|0x487
decl_stmt|;
name|WORD
name|far
modifier|*
name|CRTC
init|=
operator|(
name|WORD
name|far
operator|*
operator|)
literal|0x463
decl_stmt|;
name|union
name|REGS
name|vr
decl_stmt|;
name|WORD
name|cur
decl_stmt|;
name|CUR_PAGE
operator|=
name|cur_page
argument_list|()
expr_stmt|;
name|CHPL
operator|=
name|chpl
argument_list|()
expr_stmt|;
name|LPP
operator|=
name|lpp
argument_list|()
expr_stmt|;
if|if
condition|(
name|get_mode
argument_list|()
operator|!=
literal|3
condition|)
name|set_mode
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|cur
operator|=
name|get_cur
argument_list|()
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|ax
operator|=
literal|0x1112
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bl
operator|=
literal|0
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
operator|*
name|info
operator||=
literal|1
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|ax
operator|=
literal|0x0100
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
literal|0
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|cx
operator|=
literal|0x0600
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
name|outp
argument_list|(
operator|*
name|CRTC
argument_list|,
literal|0x14
argument_list|)
expr_stmt|;
name|outp
argument_list|(
operator|*
name|CRTC
operator|+
literal|1
argument_list|,
literal|0x07
argument_list|)
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|ax
operator|=
literal|0x1200
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bl
operator|=
literal|0x20
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
name|LPP
operator|=
name|lpp
argument_list|()
expr_stmt|;
name|set_cur
argument_list|(
name|cur
argument_list|)
expr_stmt|;
name|wherexy
argument_list|(
operator|&
name|C_X
argument_list|,
operator|&
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|reset_43
parameter_list|()
block|{
name|BYTE
name|far
modifier|*
name|info
init|=
operator|(
name|BYTE
name|far
operator|*
operator|)
literal|0x487
decl_stmt|;
name|WORD
name|far
modifier|*
name|CRTC
init|=
operator|(
name|WORD
name|far
operator|*
operator|)
literal|0x463
decl_stmt|;
name|union
name|REGS
name|vr
decl_stmt|;
name|set_mode
argument_list|(
literal|3
argument_list|)
expr_stmt|;
operator|*
name|info
operator|&=
literal|128
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|ax
operator|=
literal|0x0100
expr_stmt|;
name|vr
operator|.
name|h
operator|.
name|bh
operator|=
literal|0x0607
expr_stmt|;
name|vr
operator|.
name|x
operator|.
name|cx
operator|=
literal|0x0607
expr_stmt|;
name|intr
argument_list|(
name|VIDEO
argument_list|,
operator|&
name|vr
argument_list|)
expr_stmt|;
name|outp
argument_list|(
operator|*
name|CRTC
argument_list|,
literal|0x14
argument_list|)
expr_stmt|;
name|outp
argument_list|(
operator|*
name|CRTC
operator|+
literal|1
argument_list|,
literal|13
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|scr_up
parameter_list|()
value|scr_win(1, 0, 0, LPP-1, CHPL-1)
end_define

begin_define
define|#
directive|define
name|back_space
parameter_list|()
value|cur_left()
end_define

begin_function
name|private
name|void
name|near
name|line_feed
parameter_list|()
block|{
if|if
condition|(
operator|++
name|C_X
operator|>
name|LPP
operator|-
literal|1
condition|)
block|{
name|C_X
operator|=
name|LPP
operator|-
literal|1
expr_stmt|;
name|scr_up
argument_list|()
expr_stmt|;
block|}
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|BELL_P
value|0x61
end_define

begin_comment
comment|/* speaker */
end_comment

begin_define
define|#
directive|define
name|BELL_D
value|0x2dc
end_define

begin_comment
comment|/* 550 hz  */
end_comment

begin_define
define|#
directive|define
name|TIME_P
value|0x40
end_define

begin_comment
comment|/* timer   */
end_comment

begin_define
define|#
directive|define
name|TINI
value|182
end_define

begin_comment
comment|/* 10110110b timer initialization */
end_comment

begin_function
name|void
name|dobell
parameter_list|(
name|x
parameter_list|)
block|{
name|unsigned
name|int
name|n
init|=
literal|0x8888
decl_stmt|;
name|int
name|orgval
decl_stmt|;
name|outp
argument_list|(
name|TIME_P
operator|+
literal|3
argument_list|,
name|TINI
argument_list|)
expr_stmt|;
name|outp
argument_list|(
name|TIME_P
operator|+
literal|2
argument_list|,
name|BELL_D
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|outp
argument_list|(
name|TIME_P
operator|+
literal|2
argument_list|,
name|BELL_D
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|orgval
operator|=
name|inp
argument_list|(
name|BELL_P
argument_list|)
expr_stmt|;
name|outp
argument_list|(
name|BELL_P
argument_list|,
name|orgval
operator||
literal|3
argument_list|)
expr_stmt|;
comment|/* turn speaker on  */
while|while
condition|(
operator|--
name|n
operator|>
literal|0
condition|)
name|outp
argument_list|(
name|BELL_P
argument_list|,
name|orgval
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|carriage_return
parameter_list|()
value|gotoxy(wherex(), C_Y = 0)
end_define

begin_function
name|private
name|void
name|near
name|cur_advance
parameter_list|()
block|{
if|if
condition|(
operator|++
name|C_Y
operator|>
name|CHPL
operator|-
literal|1
condition|)
block|{
name|C_Y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|++
name|C_X
operator|>
name|LPP
operator|-
literal|1
condition|)
block|{
name|scr_up
argument_list|()
expr_stmt|;
name|C_X
operator|=
name|LPP
operator|-
literal|1
expr_stmt|;
block|}
block|}
name|gotoxy
argument_list|(
name|C_X
argument_list|,
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|init_term
parameter_list|()
block|{
if|if
condition|(
name|lpp
argument_list|()
operator|==
literal|43
condition|)
name|reset_43
argument_list|()
expr_stmt|;
name|CUR_PAGE
operator|=
name|cur_page
argument_list|()
expr_stmt|;
name|CHPL
operator|=
name|chpl
argument_list|()
expr_stmt|;
name|LPP
operator|=
name|lpp
argument_list|()
expr_stmt|;
name|wherexy
argument_list|(
operator|&
name|C_X
argument_list|,
operator|&
name|C_Y
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
name|void
name|near
name|normfun
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|void
name|write_em
parameter_list|(
name|s
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
block|{
while|while
condition|(
operator|*
name|s
condition|)
name|normfun
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|write_emif
parameter_list|(
name|s
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
block|{
if|if
condition|(
name|s
condition|)
name|write_em
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|write_emc
parameter_list|(
name|s
parameter_list|,
name|n
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|n
decl_stmt|;
block|{
while|while
condition|(
name|n
operator|--
condition|)
name|normfun
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|near
name|normfun
parameter_list|(
name|c
parameter_list|)
name|char
name|c
decl_stmt|;
block|{
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|10
case|:
name|line_feed
argument_list|()
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|carriage_return
argument_list|()
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|back_space
argument_list|()
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|dobell
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
break|break;
default|default:
name|wrch
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* IBMPC */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|IBMPC
end_ifdef

begin_comment
comment|/* No cursor optimization on an IBMPC, this simplifies things a lot.    Think about it: it would be silly!  */
end_comment

begin_decl_stmt
name|int
name|phystab
init|=
literal|8
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|Placur
parameter_list|(
name|line
parameter_list|,
name|col
parameter_list|)
block|{
name|cur_mov
argument_list|(
name|line
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|CapCol
operator|=
name|col
expr_stmt|;
name|CapLine
operator|=
name|line
expr_stmt|;
block|}
end_function

begin_function
name|void
name|SO_on
parameter_list|()
block|{
if|if
condition|(
name|Mdcolor
condition|)
name|setcolor
argument_list|(
name|Mdcolor
operator|&
literal|0xf
argument_list|,
name|Mdcolor
operator|>>
literal|4
argument_list|)
expr_stmt|;
else|else
name|setcolor
argument_list|(
name|Bgcolor
argument_list|,
name|Fgcolor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|SO_off
parameter_list|()
block|{
name|setcolor
argument_list|(
name|Fgcolor
argument_list|,
name|Bgcolor
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|extern
name|bool
name|EGA
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|UnsetTerm
parameter_list|(
name|foo
parameter_list|)
name|char
modifier|*
name|foo
decl_stmt|;
block|{
specifier|extern
name|int
name|ILI
decl_stmt|;
name|Placur
argument_list|(
name|ILI
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|clr_eoln
argument_list|()
expr_stmt|;
if|if
condition|(
name|EGA
condition|)
name|reset_43
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ResetTerm
parameter_list|()
block|{
if|if
condition|(
name|EGA
condition|)
name|init_43
argument_list|()
expr_stmt|;
else|else
name|init_term
argument_list|()
expr_stmt|;
name|do_sgtty
argument_list|()
expr_stmt|;
comment|/* this is so if you change baudrate or stuff 				   like that, JOVE will notice. */
name|ttyset
argument_list|(
name|ON
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

