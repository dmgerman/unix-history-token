begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: SetWMProps.c,v 1.7 91/04/01 20:18:31 gildea Exp $ */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1988 by Wyse Technology, Inc., San Jose, Ca., and the Massachusetts Institute of Technology, Cambridge, Massachusetts. Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Wyse or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    WYSE DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xutil.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|X_NOT_STDC_ENV
end_ifdef

begin_function_decl
specifier|extern
name|char
modifier|*
name|getenv
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * XSetWMProperties sets the following properties:  *	WM_NAME		  type: TEXT		format: varies?  *	WM_ICON_NAME	  type: TEXT		format: varies?  *	WM_HINTS	  type: WM_HINTS	format: 32  *	WM_COMMAND	  type: TEXT		format: varies?  *	WM_CLIENT_MACHINE type: TEXT		format: varies?  *	WM_NORMAL_HINTS	  type: WM_SIZE_HINTS 	format: 32  *	WM_CLASS	  type: STRING/STRING	format: 8  */
end_comment

begin_function
name|void
name|XSetWMProperties
parameter_list|(
name|dpy
parameter_list|,
name|w
parameter_list|,
name|windowName
parameter_list|,
name|iconName
parameter_list|,
name|argv
parameter_list|,
name|argc
parameter_list|,
name|sizeHints
parameter_list|,
name|wmHints
parameter_list|,
name|classHints
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Window
name|w
decl_stmt|;
comment|/* window to decorate */
name|XTextProperty
modifier|*
name|windowName
decl_stmt|;
comment|/* name of application */
name|XTextProperty
modifier|*
name|iconName
decl_stmt|;
comment|/* name string for icon */
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
comment|/* command line */
name|int
name|argc
decl_stmt|;
comment|/* size of command line */
name|XSizeHints
modifier|*
name|sizeHints
decl_stmt|;
comment|/* size hints for window in its normal state */
name|XWMHints
modifier|*
name|wmHints
decl_stmt|;
comment|/* miscelaneous window manager hints */
name|XClassHint
modifier|*
name|classHints
decl_stmt|;
comment|/* resource name and class */
block|{
name|XTextProperty
name|textprop
decl_stmt|;
name|char
name|hostName
index|[
literal|256
index|]
decl_stmt|;
name|int
name|len
init|=
name|_XGetHostname
argument_list|(
name|hostName
argument_list|,
sizeof|sizeof
name|hostName
argument_list|)
decl_stmt|;
comment|/* set names of window and icon */
if|if
condition|(
name|windowName
condition|)
name|XSetWMName
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|windowName
argument_list|)
expr_stmt|;
if|if
condition|(
name|iconName
condition|)
name|XSetWMIconName
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|iconName
argument_list|)
expr_stmt|;
comment|/* set the command if given */
if|if
condition|(
name|argv
condition|)
block|{
comment|/* 	 * for UNIX and other operating systems which use nul-terminated 	 * arrays of STRINGs. 	 */
name|XSetCommand
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|argv
argument_list|,
name|argc
argument_list|)
expr_stmt|;
block|}
comment|/* set the name of the machine on which this application is running */
name|textprop
operator|.
name|value
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|hostName
expr_stmt|;
name|textprop
operator|.
name|encoding
operator|=
name|XA_STRING
expr_stmt|;
name|textprop
operator|.
name|format
operator|=
literal|8
expr_stmt|;
name|textprop
operator|.
name|nitems
operator|=
name|len
expr_stmt|;
name|XSetWMClientMachine
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
operator|&
name|textprop
argument_list|)
expr_stmt|;
comment|/* set hints about how geometry and window manager interaction */
if|if
condition|(
name|sizeHints
condition|)
name|XSetWMNormalHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|sizeHints
argument_list|)
expr_stmt|;
if|if
condition|(
name|wmHints
condition|)
name|XSetWMHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|wmHints
argument_list|)
expr_stmt|;
if|if
condition|(
name|classHints
condition|)
block|{
name|XClassHint
name|tmp
decl_stmt|;
if|if
condition|(
operator|!
name|classHints
operator|->
name|res_name
condition|)
block|{
name|tmp
operator|.
name|res_name
operator|=
name|getenv
argument_list|(
literal|"RESOURCE_NAME"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp
operator|.
name|res_name
operator|&&
name|argv
operator|&&
name|argv
index|[
literal|0
index|]
condition|)
block|{
comment|/* 		 * UNIX uses /dir/subdir/.../basename; other operating 		 * systems will have to change this. 		 */
name|char
modifier|*
name|cp
init|=
name|rindex
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
decl_stmt|;
name|tmp
operator|.
name|res_name
operator|=
operator|(
name|cp
condition|?
name|cp
operator|+
literal|1
else|:
name|argv
index|[
literal|0
index|]
operator|)
expr_stmt|;
block|}
name|tmp
operator|.
name|res_class
operator|=
name|classHints
operator|->
name|res_class
expr_stmt|;
name|classHints
operator|=
operator|&
name|tmp
expr_stmt|;
block|}
name|XSetClassHint
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|classHints
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

