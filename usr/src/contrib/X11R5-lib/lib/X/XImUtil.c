begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XImUtil.c,v 11.51 91/07/23 12:02:13 rws Exp $ */
end_comment

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1986	*/
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xutil.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|Const
name|_lomask
index|[
literal|0x09
index|]
init|=
block|{
literal|0x00
block|,
literal|0x01
block|,
literal|0x03
block|,
literal|0x07
block|,
literal|0x0f
block|,
literal|0x1f
block|,
literal|0x3f
block|,
literal|0x7f
block|,
literal|0xff
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|Const
name|_himask
index|[
literal|0x09
index|]
init|=
block|{
literal|0xff
block|,
literal|0xfe
block|,
literal|0xfc
block|,
literal|0xf8
block|,
literal|0xf0
block|,
literal|0xe0
block|,
literal|0xc0
block|,
literal|0x80
block|,
literal|0x00
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* These two convenience routines return the scanline_pad and bits_per_pixel  	associated with a specific depth of ZPixmap format image for a  	display. */
end_comment

begin_macro
name|_XGetScanlinePad
argument_list|(
argument|dpy
argument_list|,
argument|depth
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|depth
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|ScreenFormat
modifier|*
name|fmt
init|=
name|dpy
operator|->
name|pixmap_format
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|dpy
operator|->
name|nformats
operator|+
literal|1
init|;
operator|--
name|i
condition|;
operator|++
name|fmt
control|)
if|if
condition|(
name|fmt
operator|->
name|depth
operator|==
name|depth
condition|)
return|return
operator|(
name|fmt
operator|->
name|scanline_pad
operator|)
return|;
return|return
operator|(
name|dpy
operator|->
name|bitmap_pad
operator|)
return|;
block|}
end_block

begin_macro
name|_XGetBitsPerPixel
argument_list|(
argument|dpy
argument_list|,
argument|depth
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|depth
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|ScreenFormat
modifier|*
name|fmt
init|=
name|dpy
operator|->
name|pixmap_format
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|dpy
operator|->
name|nformats
operator|+
literal|1
init|;
operator|--
name|i
condition|;
operator|++
name|fmt
control|)
if|if
condition|(
name|fmt
operator|->
name|depth
operator|==
name|depth
condition|)
return|return
operator|(
name|fmt
operator|->
name|bits_per_pixel
operator|)
return|;
return|return
operator|(
name|depth
operator|)
return|;
block|}
end_block

begin_comment
comment|/*  * This module provides rudimentary manipulation routines for image data  * structures.  The functions provided are:  *  *	XCreateImage	Creates a default XImage data structure  *	_XDestroyImage	Deletes an XImage data structure  *	_XGetPixel	Reads a pixel from an image data structure  *	_XGetPixel32	Reads a pixel from a 32-bit Z image data structure  *	_XGetPixel16	Reads a pixel from a 16-bit Z image data structure  *	_XGetPixel8	Reads a pixel from an 8-bit Z image data structure  *	_XGetPixel1	Reads a pixel from an 1-bit image data structure  *	_XPutPixel	Writes a pixel into an image data structure  *	_XPutPixel32	Writes a pixel into a 32-bit Z image data structure  *	_XPutPixel16	Writes a pixel into a 16-bit Z image data structure  *	_XPutPixel8	Writes a pixel into an 8-bit Z image data structure  *	_XPutPixel1	Writes a pixel into an 1-bit image data structure  *	_XSubImage	Clones a new (sub)image from an existing one  *	_XSetImage	Writes an image data pattern into another image  *	_XAddPixel	Adds a constant value to every pixel in an image  *  * The logic contained in these routines makes several assumptions about  * the image data structures, and at least for current implementations  * these assumptions are believed to be true.  They are:   *  *	For all formats, bits_per_pixel is less than or equal to 32.  *	For XY formats, bitmap_unit is always less than or equal to bitmap_pad.  *	For XY formats, bitmap_unit is 8, 16, or 32 bits.  *	For Z format, bits_per_pixel is 1, 4, 8, 16, 24, or 32 bits.  */
end_comment

begin_expr_stmt
specifier|static
name|_xynormalizeimagebits
argument_list|(
name|bp
argument_list|,
name|img
argument_list|)
specifier|register
name|unsigned
name|char
operator|*
name|bp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|XImage
modifier|*
name|img
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|unsigned
name|char
name|c
decl_stmt|;
if|if
condition|(
name|img
operator|->
name|byte_order
operator|!=
name|img
operator|->
name|bitmap_bit_order
condition|)
block|{
switch|switch
condition|(
name|img
operator|->
name|bitmap_unit
condition|)
block|{
case|case
literal|16
case|:
name|c
operator|=
operator|*
name|bp
expr_stmt|;
operator|*
name|bp
operator|=
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
operator|=
name|c
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|c
operator|=
operator|*
operator|(
name|bp
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|3
operator|)
operator|=
operator|*
name|bp
expr_stmt|;
operator|*
name|bp
operator|=
name|c
expr_stmt|;
name|c
operator|=
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
operator|=
name|c
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|img
operator|->
name|bitmap_bit_order
operator|==
name|MSBFirst
condition|)
name|_XReverse_Bytes
argument_list|(
name|bp
argument_list|,
name|img
operator|->
name|bitmap_unit
operator|>>
literal|3
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|_znormalizeimagebits
argument_list|(
name|bp
argument_list|,
name|img
argument_list|)
specifier|register
name|unsigned
name|char
operator|*
name|bp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|XImage
modifier|*
name|img
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|unsigned
name|char
name|c
decl_stmt|;
switch|switch
condition|(
name|img
operator|->
name|bits_per_pixel
condition|)
block|{
case|case
literal|4
case|:
operator|*
name|bp
operator|=
operator|(
operator|(
operator|*
name|bp
operator|>>
literal|4
operator|)
operator|&
literal|0xF
operator|)
operator||
operator|(
operator|(
operator|*
name|bp
operator|<<
literal|4
operator|)
operator|&
operator|~
literal|0xF
operator|)
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|c
operator|=
operator|*
name|bp
expr_stmt|;
operator|*
name|bp
operator|=
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
operator|=
name|c
expr_stmt|;
break|break;
case|case
literal|24
case|:
name|c
operator|=
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
operator|=
operator|*
name|bp
expr_stmt|;
operator|*
name|bp
operator|=
name|c
expr_stmt|;
break|break;
case|case
literal|32
case|:
name|c
operator|=
operator|*
operator|(
name|bp
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|3
operator|)
operator|=
operator|*
name|bp
expr_stmt|;
operator|*
name|bp
operator|=
name|c
expr_stmt|;
name|c
operator|=
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|bp
operator|+
literal|1
operator|)
operator|=
name|c
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_expr_stmt
specifier|static
name|_putbits
argument_list|(
name|src
argument_list|,
name|dstoffset
argument_list|,
name|numbits
argument_list|,
name|dst
argument_list|)
specifier|register
name|char
operator|*
name|src
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* address of source bit string */
end_comment

begin_decl_stmt
name|int
name|dstoffset
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* bit offset into destination; range is 0-31 */
end_comment

begin_decl_stmt
specifier|register
name|int
name|numbits
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* number of bits to copy to destination */
end_comment

begin_decl_stmt
specifier|register
name|char
modifier|*
name|dst
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* address of destination bit string */
end_comment

begin_block
block|{
specifier|register
name|unsigned
name|char
name|chlo
decl_stmt|,
name|chhi
decl_stmt|;
name|int
name|hibits
decl_stmt|;
name|dst
operator|=
name|dst
operator|+
operator|(
name|dstoffset
operator|>>
literal|3
operator|)
expr_stmt|;
name|dstoffset
operator|=
name|dstoffset
operator|&
literal|7
expr_stmt|;
name|hibits
operator|=
literal|8
operator|-
name|dstoffset
expr_stmt|;
name|chlo
operator|=
operator|*
name|dst
operator|&
name|_lomask
index|[
name|dstoffset
index|]
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|chhi
operator|=
operator|(
operator|*
name|src
operator|<<
name|dstoffset
operator|)
operator|&
name|_himask
index|[
name|dstoffset
index|]
expr_stmt|;
if|if
condition|(
name|numbits
operator|<=
name|hibits
condition|)
block|{
name|chhi
operator|=
name|chhi
operator|&
name|_lomask
index|[
name|dstoffset
operator|+
name|numbits
index|]
expr_stmt|;
operator|*
name|dst
operator|=
operator|(
operator|*
name|dst
operator|&
name|_himask
index|[
name|dstoffset
operator|+
name|numbits
index|]
operator|)
operator||
name|chlo
operator||
name|chhi
expr_stmt|;
break|break;
block|}
operator|*
name|dst
operator|=
name|chhi
operator||
name|chlo
expr_stmt|;
name|dst
operator|++
expr_stmt|;
name|numbits
operator|=
name|numbits
operator|-
name|hibits
expr_stmt|;
name|chlo
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|*
name|src
operator|&
name|_himask
index|[
name|hibits
index|]
argument_list|)
operator|>>
name|hibits
expr_stmt|;
name|src
operator|++
expr_stmt|;
if|if
condition|(
name|numbits
operator|<=
name|dstoffset
condition|)
block|{
name|chlo
operator|=
name|chlo
operator|&
name|_lomask
index|[
name|numbits
index|]
expr_stmt|;
operator|*
name|dst
operator|=
operator|(
operator|*
name|dst
operator|&
name|_himask
index|[
name|numbits
index|]
operator|)
operator||
name|chlo
expr_stmt|;
break|break;
block|}
name|numbits
operator|=
name|numbits
operator|-
name|dstoffset
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*  * Macros  *   * The ROUNDUP macro rounds up a quantity to the specified boundary,  * then truncates to bytes.  *  * The XYNORMALIZE macro determines whether XY format data requires   * normalization and calls a routine to do so if needed. The logic in  * this module is designed for LSBFirst byte and bit order, so   * normalization is done as required to present the data in this order.  *  * The ZNORMALIZE macro performs byte and nibble order normalization if   * required for Z format data.  *  * The XYINDEX macro computes the index to the starting byte (char) boundary  * for a bitmap_unit containing a pixel with coordinates x and y for image  * data in XY format.  *   * The ZINDEX macro computes the index to the starting byte (char) boundary   * for a pixel with coordinates x and y for image data in ZPixmap format.  *   */
end_comment

begin_define
define|#
directive|define
name|ROUNDUP
parameter_list|(
name|nbytes
parameter_list|,
name|pad
parameter_list|)
value|((((nbytes) + ((pad)-1)) / (pad)) * ((pad)>>3))
end_define

begin_define
define|#
directive|define
name|XYNORMALIZE
parameter_list|(
name|bp
parameter_list|,
name|img
parameter_list|)
define|\
value|if ((img->byte_order == MSBFirst) || (img->bitmap_bit_order == MSBFirst)) \ 	_xynormalizeimagebits((unsigned char *)(bp), img)
end_define

begin_define
define|#
directive|define
name|ZNORMALIZE
parameter_list|(
name|bp
parameter_list|,
name|img
parameter_list|)
define|\
value|if (img->byte_order == MSBFirst) \ 	_znormalizeimagebits((unsigned char *)(bp), img)
end_define

begin_define
define|#
directive|define
name|XYINDEX
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|img
parameter_list|)
define|\
value|((y) * img->bytes_per_line) + \     (((x) + img->xoffset) / img->bitmap_unit) * (img->bitmap_unit>> 3)
end_define

begin_define
define|#
directive|define
name|ZINDEX
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|img
parameter_list|)
value|((y) * img->bytes_per_line) + \     (((x) * img->bits_per_pixel)>> 3)
end_define

begin_comment
comment|/*  * CreateImage  *   * Allocates the memory necessary for an XImage data structure.   * Initializes the structure with "default" values and returns XImage.   *   */
end_comment

begin_function
name|XImage
modifier|*
name|XCreateImage
parameter_list|(
name|dpy
parameter_list|,
name|visual
parameter_list|,
name|depth
parameter_list|,
name|format
parameter_list|,
name|offset
parameter_list|,
name|data
parameter_list|,
name|width
parameter_list|,
name|height
parameter_list|,
name|xpad
parameter_list|,
name|image_bytes_per_line
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
specifier|register
name|Visual
modifier|*
name|visual
decl_stmt|;
name|unsigned
name|int
name|depth
decl_stmt|;
name|int
name|format
decl_stmt|;
name|int
name|offset
decl_stmt|;
comment|/*How many pixels from the start of the data does the 		picture to be transmitted start?*/
name|char
modifier|*
name|data
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|;
name|unsigned
name|int
name|height
decl_stmt|;
name|int
name|xpad
decl_stmt|;
name|int
name|image_bytes_per_line
decl_stmt|;
comment|/*How many bytes between a pixel on one line and the pixel with 		  the same X coordinate on the next line? 0 means 		  XCreateImage can calculate it.*/
block|{
specifier|register
name|XImage
modifier|*
name|image
decl_stmt|;
name|int
name|bits_per_pixel
init|=
literal|1
decl_stmt|;
if|if
condition|(
operator|(
name|image
operator|=
operator|(
name|XImage
operator|*
operator|)
name|Xcalloc
argument_list|(
literal|1
argument_list|,
operator|(
name|unsigned
operator|)
sizeof|sizeof
argument_list|(
name|XImage
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|XImage
operator|*
operator|)
name|NULL
return|;
name|image
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|image
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|image
operator|->
name|format
operator|=
name|format
expr_stmt|;
name|image
operator|->
name|byte_order
operator|=
name|dpy
operator|->
name|byte_order
expr_stmt|;
name|image
operator|->
name|bitmap_unit
operator|=
name|dpy
operator|->
name|bitmap_unit
expr_stmt|;
name|image
operator|->
name|bitmap_bit_order
operator|=
name|dpy
operator|->
name|bitmap_bit_order
expr_stmt|;
if|if
condition|(
name|visual
operator|!=
name|NULL
condition|)
block|{
name|image
operator|->
name|red_mask
operator|=
name|visual
operator|->
name|red_mask
expr_stmt|;
name|image
operator|->
name|green_mask
operator|=
name|visual
operator|->
name|green_mask
expr_stmt|;
name|image
operator|->
name|blue_mask
operator|=
name|visual
operator|->
name|blue_mask
expr_stmt|;
block|}
else|else
block|{
name|image
operator|->
name|red_mask
operator|=
name|image
operator|->
name|green_mask
operator|=
name|image
operator|->
name|blue_mask
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|format
operator|==
name|ZPixmap
condition|)
block|{
name|bits_per_pixel
operator|=
name|_XGetBitsPerPixel
argument_list|(
name|dpy
argument_list|,
operator|(
name|int
operator|)
name|depth
argument_list|)
expr_stmt|;
block|}
name|image
operator|->
name|xoffset
operator|=
name|offset
expr_stmt|;
name|image
operator|->
name|bitmap_pad
operator|=
name|xpad
expr_stmt|;
name|image
operator|->
name|depth
operator|=
name|depth
expr_stmt|;
name|image
operator|->
name|data
operator|=
name|data
expr_stmt|;
comment|/* 	 * compute per line accelerator. 	 */
if|if
condition|(
name|image_bytes_per_line
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|format
operator|==
name|ZPixmap
condition|)
name|image
operator|->
name|bytes_per_line
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|bits_per_pixel
operator|*
name|width
operator|)
argument_list|,
name|image
operator|->
name|bitmap_pad
argument_list|)
expr_stmt|;
else|else
name|image
operator|->
name|bytes_per_line
operator|=
name|ROUNDUP
argument_list|(
operator|(
name|width
operator|+
name|offset
operator|)
argument_list|,
name|image
operator|->
name|bitmap_pad
argument_list|)
expr_stmt|;
block|}
else|else
name|image
operator|->
name|bytes_per_line
operator|=
name|image_bytes_per_line
expr_stmt|;
name|image
operator|->
name|bits_per_pixel
operator|=
name|bits_per_pixel
expr_stmt|;
name|image
operator|->
name|obdata
operator|=
name|NULL
expr_stmt|;
name|_XInitImageFuncPtrs
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|image
return|;
block|}
end_function

begin_comment
comment|/*  * _DestroyImage  * 	  * Deallocates the memory associated with the ximage data structure.   * this version handles the case of the image data being malloc'd  * entirely by the library.  */
end_comment

begin_function
specifier|static
name|int
name|_XDestroyImage
parameter_list|(
name|ximage
parameter_list|)
name|XImage
modifier|*
name|ximage
decl_stmt|;
block|{
if|if
condition|(
name|ximage
operator|->
name|data
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|obdata
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ximage
operator|->
name|obdata
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|ximage
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * GetPixel  *   * Returns the specified pixel.  The X and Y coordinates are relative to   * the origin (upper left [0,0]) of the image.  The pixel value is returned  * in normalized format, i.e. the LSB of the long is the LSB of the pixel.  * The algorithm used is:  *  *	copy the source bitmap_unit or Zpixel into temp  *	normalize temp if needed  *	extract the pixel bits into return value  *  */
end_comment

begin_decl_stmt
specifier|static
name|unsigned
name|long
name|Const
name|low_bits_table
index|[]
init|=
block|{
literal|0x00000000
block|,
literal|0x00000001
block|,
literal|0x00000003
block|,
literal|0x00000007
block|,
literal|0x0000000f
block|,
literal|0x0000001f
block|,
literal|0x0000003f
block|,
literal|0x0000007f
block|,
literal|0x000000ff
block|,
literal|0x000001ff
block|,
literal|0x000003ff
block|,
literal|0x000007ff
block|,
literal|0x00000fff
block|,
literal|0x00001fff
block|,
literal|0x00003fff
block|,
literal|0x00007fff
block|,
literal|0x0000ffff
block|,
literal|0x0001ffff
block|,
literal|0x0003ffff
block|,
literal|0x0007ffff
block|,
literal|0x000fffff
block|,
literal|0x001fffff
block|,
literal|0x003fffff
block|,
literal|0x007fffff
block|,
literal|0x00ffffff
block|,
literal|0x01ffffff
block|,
literal|0x03ffffff
block|,
literal|0x07ffffff
block|,
literal|0x0fffffff
block|,
literal|0x1fffffff
block|,
literal|0x3fffffff
block|,
literal|0x7fffffff
block|,
literal|0xffffffff
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|unsigned
name|long
name|_XGetPixel
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
block|{
name|unsigned
name|long
name|pixel
decl_stmt|,
name|px
decl_stmt|;
specifier|register
name|char
modifier|*
name|src
decl_stmt|;
specifier|register
name|char
modifier|*
name|dst
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|bits
decl_stmt|,
name|nbytes
decl_stmt|;
name|long
name|plane
decl_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|==
literal|1
condition|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|pixel
expr_stmt|;
name|pixel
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|ximage
operator|->
name|bitmap_unit
operator|>>
literal|3
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|pixel
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|bits
operator|=
operator|(
name|x
operator|+
name|ximage
operator|->
name|xoffset
operator|)
operator|%
name|ximage
operator|->
name|bitmap_unit
expr_stmt|;
name|pixel
operator|=
operator|(
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|pixel
operator|)
index|[
name|bits
operator|>>
literal|3
index|]
operator|)
operator|>>
operator|(
name|bits
operator|&
literal|7
operator|)
operator|)
operator|&
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ximage
operator|->
name|format
operator|==
name|XYPixmap
condition|)
block|{
name|pixel
operator|=
literal|0
expr_stmt|;
name|plane
operator|=
literal|0
expr_stmt|;
name|nbytes
operator|=
name|ximage
operator|->
name|bitmap_unit
operator|>>
literal|3
expr_stmt|;
for|for
control|(
name|i
operator|=
name|ximage
operator|->
name|depth
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
operator|+
name|plane
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|px
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|j
operator|=
name|nbytes
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|bits
operator|=
operator|(
name|x
operator|+
name|ximage
operator|->
name|xoffset
operator|)
operator|%
name|ximage
operator|->
name|bitmap_unit
expr_stmt|;
name|pixel
operator|=
operator|(
name|pixel
operator|<<
literal|1
operator|)
operator||
operator|(
operator|(
operator|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|px
operator|)
index|[
name|bits
operator|>>
literal|3
index|]
operator|)
operator|>>
operator|(
name|bits
operator|&
literal|7
operator|)
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
name|plane
operator|=
name|plane
operator|+
operator|(
name|ximage
operator|->
name|bytes_per_line
operator|*
name|ximage
operator|->
name|height
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
condition|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|ZINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|px
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|+
literal|7
operator|)
operator|>>
literal|3
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|ZNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|pixel
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
name|pixel
operator|=
operator|(
name|pixel
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|px
operator|)
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|4
condition|)
block|{
if|if
condition|(
name|x
operator|&
literal|1
condition|)
name|pixel
operator|>>=
literal|4
expr_stmt|;
else|else
name|pixel
operator|&=
literal|0xf
expr_stmt|;
block|}
block|}
else|else
block|{
return|return
literal|0
return|;
comment|/* bad image */
block|}
if|if
condition|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
name|ximage
operator|->
name|depth
condition|)
return|return
name|pixel
return|;
else|else
return|return
operator|(
name|pixel
operator|&
name|low_bits_table
index|[
name|ximage
operator|->
name|depth
index|]
operator|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|WORD64
end_ifndef

begin_decl_stmt
specifier|static
name|unsigned
name|long
name|byteorderpixel
init|=
name|MSBFirst
operator|<<
literal|24
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|unsigned
name|long
name|_XGetPixel32
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
block|{
specifier|register
name|unsigned
name|char
modifier|*
name|addr
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|32
operator|)
condition|)
block|{
name|addr
operator|=
operator|&
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
operator|)
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|x
operator|<<
literal|2
operator|)
index|]
expr_stmt|;
ifndef|#
directive|ifndef
name|WORD64
if|if
condition|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|byteorderpixel
operator|)
operator|==
name|ximage
operator|->
name|byte_order
condition|)
name|pixel
operator|=
operator|*
operator|(
operator|(
name|unsigned
name|long
operator|*
operator|)
name|addr
operator|)
expr_stmt|;
elseif|else
endif|#
directive|endif
if|if
condition|(
name|ximage
operator|->
name|byte_order
operator|==
name|MSBFirst
condition|)
name|pixel
operator|=
operator|(
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|0
index|]
operator|<<
literal|24
operator||
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|1
index|]
operator|<<
literal|16
operator||
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|2
index|]
operator|<<
literal|8
operator||
name|addr
index|[
literal|3
index|]
operator|)
expr_stmt|;
else|else
name|pixel
operator|=
operator|(
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|3
index|]
operator|<<
literal|24
operator||
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|2
index|]
operator|<<
literal|16
operator||
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|addr
index|[
literal|0
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|!=
literal|32
condition|)
name|pixel
operator|&=
name|low_bits_table
index|[
name|ximage
operator|->
name|depth
index|]
expr_stmt|;
return|return
name|pixel
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|_XGetPixel16
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
block|{
specifier|register
name|unsigned
name|char
modifier|*
name|addr
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|16
operator|)
condition|)
block|{
name|addr
operator|=
operator|&
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
operator|)
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|x
operator|<<
literal|1
operator|)
index|]
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|byte_order
operator|==
name|MSBFirst
condition|)
name|pixel
operator|=
name|addr
index|[
literal|0
index|]
operator|<<
literal|8
operator||
name|addr
index|[
literal|1
index|]
expr_stmt|;
else|else
name|pixel
operator|=
name|addr
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|addr
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|!=
literal|16
condition|)
name|pixel
operator|&=
name|low_bits_table
index|[
name|ximage
operator|->
name|depth
index|]
expr_stmt|;
return|return
name|pixel
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|_XGetPixel8
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
block|{
name|unsigned
name|char
name|pixel
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
condition|)
block|{
name|pixel
operator|=
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
operator|)
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
name|x
index|]
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|!=
literal|8
condition|)
name|pixel
operator|&=
name|low_bits_table
index|[
name|ximage
operator|->
name|depth
index|]
expr_stmt|;
return|return
name|pixel
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|_XGetPixel1
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
block|{
name|unsigned
name|char
name|bit
decl_stmt|;
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|depth
operator|==
literal|1
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|byte_order
operator|==
name|ximage
operator|->
name|bitmap_bit_order
operator|)
condition|)
block|{
name|xoff
operator|=
name|x
operator|+
name|ximage
operator|->
name|xoffset
expr_stmt|;
name|yoff
operator|=
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|xoff
operator|>>
literal|3
operator|)
expr_stmt|;
name|xoff
operator|&=
literal|7
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|bitmap_bit_order
operator|==
name|MSBFirst
condition|)
name|bit
operator|=
literal|0x80
operator|>>
name|xoff
expr_stmt|;
else|else
name|bit
operator|=
literal|1
operator|<<
name|xoff
expr_stmt|;
return|return
operator|(
name|ximage
operator|->
name|data
index|[
name|yoff
index|]
operator|&
name|bit
operator|)
condition|?
literal|1
else|:
literal|0
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * PutPixel  *   * Overwrites the specified pixel.  The X and Y coordinates are relative to   * the origin (upper left [0,0]) of the image.  The input pixel value must be  * in normalized format, i.e. the LSB of the long is the LSB of the pixel.  * The algorithm used is:  *  *	copy the destination bitmap_unit or Zpixel to temp  *	normalize temp if needed  *	copy the pixel bits into the temp  *	renormalize temp if needed  *	copy the temp back into the destination image data  *  */
end_comment

begin_function
specifier|static
name|int
name|_XPutPixel
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pixel
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
block|{
name|unsigned
name|long
name|px
decl_stmt|,
name|npixel
decl_stmt|;
specifier|register
name|char
modifier|*
name|src
decl_stmt|;
specifier|register
name|char
modifier|*
name|dst
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|,
name|nbytes
decl_stmt|;
name|long
name|plane
decl_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|==
literal|4
condition|)
name|pixel
operator|&=
literal|0xf
expr_stmt|;
name|npixel
operator|=
name|pixel
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|px
operator|=
name|pixel
init|;
name|i
operator|<
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
condition|;
name|i
operator|++
operator|,
name|px
operator|>>=
literal|8
control|)
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|pixel
operator|)
index|[
name|i
index|]
operator|=
name|px
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|==
literal|1
condition|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|px
operator|=
literal|0
expr_stmt|;
name|nbytes
operator|=
name|ximage
operator|->
name|bitmap_unit
operator|>>
literal|3
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|i
operator|=
operator|(
operator|(
name|x
operator|+
name|ximage
operator|->
name|xoffset
operator|)
operator|%
name|ximage
operator|->
name|bitmap_unit
operator|)
expr_stmt|;
name|_putbits
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|pixel
argument_list|,
name|i
argument_list|,
literal|1
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|px
argument_list|)
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|src
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|dst
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ximage
operator|->
name|format
operator|==
name|XYPixmap
condition|)
block|{
name|plane
operator|=
operator|(
name|ximage
operator|->
name|bytes_per_line
operator|*
name|ximage
operator|->
name|height
operator|)
operator|*
operator|(
name|ximage
operator|->
name|depth
operator|-
literal|1
operator|)
expr_stmt|;
comment|/* do least signif plane 1st */
name|nbytes
operator|=
name|ximage
operator|->
name|bitmap_unit
operator|>>
literal|3
expr_stmt|;
for|for
control|(
name|j
operator|=
name|ximage
operator|->
name|depth
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
control|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
operator|+
name|plane
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|px
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|i
operator|=
operator|(
operator|(
name|x
operator|+
name|ximage
operator|->
name|xoffset
operator|)
operator|%
name|ximage
operator|->
name|bitmap_unit
operator|)
expr_stmt|;
name|_putbits
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|pixel
argument_list|,
name|i
argument_list|,
literal|1
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|px
argument_list|)
expr_stmt|;
name|XYNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|src
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|dst
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|XYINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
operator|+
name|plane
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|npixel
operator|=
name|npixel
operator|>>
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|px
operator|=
name|npixel
init|;
name|i
operator|<
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
condition|;
name|i
operator|++
operator|,
name|px
operator|>>=
literal|8
control|)
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|pixel
operator|)
index|[
name|i
index|]
operator|=
name|px
expr_stmt|;
name|plane
operator|=
name|plane
operator|-
operator|(
name|ximage
operator|->
name|bytes_per_line
operator|*
name|ximage
operator|->
name|height
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
condition|)
block|{
name|src
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|ZINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|px
operator|=
literal|0
expr_stmt|;
name|nbytes
operator|=
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
name|ZNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|_putbits
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|pixel
argument_list|,
operator|(
name|x
operator|*
name|ximage
operator|->
name|bits_per_pixel
operator|)
operator|&
literal|7
argument_list|,
name|ximage
operator|->
name|bits_per_pixel
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|px
argument_list|)
expr_stmt|;
name|ZNORMALIZE
argument_list|(
operator|&
name|px
argument_list|,
name|ximage
argument_list|)
expr_stmt|;
name|src
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|px
expr_stmt|;
name|dst
operator|=
operator|&
name|ximage
operator|->
name|data
index|[
name|ZINDEX
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|ximage
argument_list|)
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nbytes
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
operator|*
name|dst
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
else|else
block|{
return|return
literal|0
return|;
comment|/* bad image */
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|_XPutPixel32
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pixel
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
block|{
name|unsigned
name|char
modifier|*
name|addr
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|32
operator|)
condition|)
block|{
name|addr
operator|=
operator|&
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
operator|)
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|x
operator|<<
literal|2
operator|)
index|]
expr_stmt|;
ifndef|#
directive|ifndef
name|WORD64
if|if
condition|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|byteorderpixel
operator|)
operator|==
name|ximage
operator|->
name|byte_order
condition|)
operator|*
operator|(
operator|(
name|unsigned
name|long
operator|*
operator|)
name|addr
operator|)
operator|=
name|pixel
expr_stmt|;
elseif|else
endif|#
directive|endif
if|if
condition|(
name|ximage
operator|->
name|byte_order
operator|==
name|MSBFirst
condition|)
block|{
name|addr
index|[
literal|0
index|]
operator|=
name|pixel
operator|>>
literal|24
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|pixel
operator|>>
literal|16
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|pixel
operator|>>
literal|8
expr_stmt|;
name|addr
index|[
literal|3
index|]
operator|=
name|pixel
expr_stmt|;
block|}
else|else
block|{
name|addr
index|[
literal|3
index|]
operator|=
name|pixel
operator|>>
literal|24
expr_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|pixel
operator|>>
literal|16
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|pixel
operator|>>
literal|8
expr_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
name|pixel
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XPutPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|_XPutPixel16
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pixel
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
block|{
name|unsigned
name|char
modifier|*
name|addr
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|16
operator|)
condition|)
block|{
name|addr
operator|=
operator|&
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
operator|)
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|x
operator|<<
literal|1
operator|)
index|]
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|byte_order
operator|==
name|MSBFirst
condition|)
block|{
name|addr
index|[
literal|0
index|]
operator|=
name|pixel
operator|>>
literal|8
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
name|pixel
expr_stmt|;
block|}
else|else
block|{
name|addr
index|[
literal|1
index|]
operator|=
name|pixel
operator|>>
literal|8
expr_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
name|pixel
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XPutPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|_XPutPixel8
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pixel
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
condition|)
block|{
name|ximage
operator|->
name|data
index|[
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
name|x
index|]
operator|=
name|pixel
expr_stmt|;
return|return
literal|1
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XPutPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|_XPutPixel1
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|pixel
parameter_list|)
specifier|register
name|XImage
modifier|*
name|ximage
decl_stmt|;
name|int
name|x
decl_stmt|;
name|int
name|y
decl_stmt|;
name|unsigned
name|long
name|pixel
decl_stmt|;
block|{
name|unsigned
name|char
name|bit
decl_stmt|;
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
if|if
condition|(
operator|(
name|ximage
operator|->
name|depth
operator|==
literal|1
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|byte_order
operator|==
name|ximage
operator|->
name|bitmap_bit_order
operator|)
condition|)
block|{
name|xoff
operator|=
name|x
operator|+
name|ximage
operator|->
name|xoffset
expr_stmt|;
name|yoff
operator|=
name|y
operator|*
name|ximage
operator|->
name|bytes_per_line
operator|+
operator|(
name|xoff
operator|>>
literal|3
operator|)
expr_stmt|;
name|xoff
operator|&=
literal|7
expr_stmt|;
if|if
condition|(
name|ximage
operator|->
name|bitmap_bit_order
operator|==
name|MSBFirst
condition|)
name|bit
operator|=
literal|0x80
operator|>>
name|xoff
expr_stmt|;
else|else
name|bit
operator|=
literal|1
operator|<<
name|xoff
expr_stmt|;
if|if
condition|(
name|pixel
operator|&
literal|1
condition|)
name|ximage
operator|->
name|data
index|[
name|yoff
index|]
operator||=
name|bit
expr_stmt|;
else|else
name|ximage
operator|->
name|data
index|[
name|yoff
index|]
operator|&=
operator|~
name|bit
expr_stmt|;
return|return
literal|1
return|;
block|}
else|else
block|{
name|_XInitImageFuncPtrs
argument_list|(
name|ximage
argument_list|)
expr_stmt|;
return|return
name|XPutPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * SubImage  *   * Creates a new image that is a subsection of an existing one.  * Allocates the memory necessary for the new XImage data structure.   * Pointer to new image is returned.  The algorithm used is repetitive  * calls to get and put pixel.  *  */
end_comment

begin_function
specifier|static
name|XImage
modifier|*
name|_XSubImage
parameter_list|(
name|ximage
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|,
name|width
parameter_list|,
name|height
parameter_list|)
name|XImage
modifier|*
name|ximage
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|;
comment|/* starting x coordinate in existing image */
specifier|register
name|int
name|y
decl_stmt|;
comment|/* starting y coordinate in existing image */
name|unsigned
name|int
name|width
decl_stmt|;
comment|/* width in pixels of new subimage */
name|unsigned
name|int
name|height
decl_stmt|;
comment|/* height in pixels of new subimage */
block|{
specifier|register
name|XImage
modifier|*
name|subimage
decl_stmt|;
name|int
name|dsize
decl_stmt|;
specifier|register
name|int
name|row
decl_stmt|,
name|col
decl_stmt|;
specifier|register
name|unsigned
name|long
name|pixel
decl_stmt|;
name|char
modifier|*
name|data
decl_stmt|;
if|if
condition|(
operator|(
name|subimage
operator|=
operator|(
name|XImage
operator|*
operator|)
name|Xcalloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|XImage
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|XImage
operator|*
operator|)
name|NULL
return|;
name|subimage
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|subimage
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|subimage
operator|->
name|xoffset
operator|=
literal|0
expr_stmt|;
name|subimage
operator|->
name|format
operator|=
name|ximage
operator|->
name|format
expr_stmt|;
name|subimage
operator|->
name|byte_order
operator|=
name|ximage
operator|->
name|byte_order
expr_stmt|;
name|subimage
operator|->
name|bitmap_unit
operator|=
name|ximage
operator|->
name|bitmap_unit
expr_stmt|;
name|subimage
operator|->
name|bitmap_bit_order
operator|=
name|ximage
operator|->
name|bitmap_bit_order
expr_stmt|;
name|subimage
operator|->
name|bitmap_pad
operator|=
name|ximage
operator|->
name|bitmap_pad
expr_stmt|;
name|subimage
operator|->
name|bits_per_pixel
operator|=
name|ximage
operator|->
name|bits_per_pixel
expr_stmt|;
name|subimage
operator|->
name|depth
operator|=
name|ximage
operator|->
name|depth
expr_stmt|;
comment|/* 	 * compute per line accelerator. 	 */
if|if
condition|(
name|subimage
operator|->
name|format
operator|==
name|ZPixmap
condition|)
name|subimage
operator|->
name|bytes_per_line
operator|=
name|ROUNDUP
argument_list|(
name|subimage
operator|->
name|bits_per_pixel
operator|*
name|width
argument_list|,
name|subimage
operator|->
name|bitmap_pad
argument_list|)
expr_stmt|;
else|else
name|subimage
operator|->
name|bytes_per_line
operator|=
name|ROUNDUP
argument_list|(
name|width
argument_list|,
name|subimage
operator|->
name|bitmap_pad
argument_list|)
expr_stmt|;
name|subimage
operator|->
name|obdata
operator|=
name|NULL
expr_stmt|;
name|_XInitImageFuncPtrs
argument_list|(
name|subimage
argument_list|)
expr_stmt|;
name|dsize
operator|=
name|subimage
operator|->
name|bytes_per_line
operator|*
name|height
expr_stmt|;
if|if
condition|(
name|subimage
operator|->
name|format
operator|==
name|XYPixmap
condition|)
name|dsize
operator|=
name|dsize
operator|*
name|subimage
operator|->
name|depth
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|data
operator|=
name|Xcalloc
argument_list|(
literal|1
argument_list|,
operator|(
name|unsigned
operator|)
name|dsize
argument_list|)
operator|)
operator|==
name|NULL
operator|)
operator|&&
operator|(
name|dsize
operator|>
literal|0
operator|)
condition|)
block|{
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|subimage
argument_list|)
expr_stmt|;
return|return
operator|(
name|XImage
operator|*
operator|)
name|NULL
return|;
block|}
name|subimage
operator|->
name|data
operator|=
name|data
expr_stmt|;
comment|/* 	 * Test for cases where the new subimage is larger than the region 	 * that we are copying from the existing data.  In those cases, 	 * copy the area of the existing image, and allow the "uncovered" 	 * area of new subimage to remain with zero filled pixels. 	 */
if|if
condition|(
name|height
operator|>
name|ximage
operator|->
name|height
operator|-
name|y
condition|)
name|height
operator|=
name|ximage
operator|->
name|height
operator|-
name|y
expr_stmt|;
if|if
condition|(
name|width
operator|>
name|ximage
operator|->
name|width
operator|-
name|x
condition|)
name|width
operator|=
name|ximage
operator|->
name|width
operator|-
name|x
expr_stmt|;
for|for
control|(
name|row
operator|=
name|y
init|;
name|row
operator|<
operator|(
name|y
operator|+
name|height
operator|)
condition|;
name|row
operator|++
control|)
block|{
for|for
control|(
name|col
operator|=
name|x
init|;
name|col
operator|<
operator|(
name|x
operator|+
name|width
operator|)
condition|;
name|col
operator|++
control|)
block|{
name|pixel
operator|=
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|col
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|XPutPixel
argument_list|(
name|subimage
argument_list|,
operator|(
name|col
operator|-
name|x
operator|)
argument_list|,
operator|(
name|row
operator|-
name|y
operator|)
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|subimage
return|;
block|}
end_function

begin_comment
comment|/*  * SetImage  *   * Overwrites a section of one image with all of the data from another.  * If the two images are not of the same format (i.e. XYPixmap and ZPixmap),  * the image data is converted to the destination format.  The following  * restrictions apply:  *  *	1. The depths of the source and destination images must be equal.  *  *	2. If the height of the source image is too large to fit between  *	   the specified y starting point and the bottom of the image,  *	   then scanlines are truncated on the bottom.  *  *	3. If the width of the source image is too large to fit between  *	   the specified x starting point and the end of the scanline,  *	   then pixels are truncated on the right.  *   * The images need not have the same bitmap_bit_order, byte_order,  * bitmap_unit, bits_per_pixel, bitmap_pad, or xoffset.  *  */
end_comment

begin_function
name|int
name|_XSetImage
parameter_list|(
name|srcimg
parameter_list|,
name|dstimg
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
name|XImage
modifier|*
name|srcimg
decl_stmt|;
specifier|register
name|XImage
modifier|*
name|dstimg
decl_stmt|;
specifier|register
name|int
name|x
decl_stmt|;
specifier|register
name|int
name|y
decl_stmt|;
block|{
specifier|register
name|unsigned
name|long
name|pixel
decl_stmt|;
specifier|register
name|int
name|row
decl_stmt|,
name|col
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|startrow
decl_stmt|,
name|startcol
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
block|{
name|startcol
operator|=
operator|-
name|x
expr_stmt|;
name|x
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|startcol
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|y
operator|<
literal|0
condition|)
block|{
name|startrow
operator|=
operator|-
name|y
expr_stmt|;
name|y
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|startrow
operator|=
literal|0
expr_stmt|;
name|width
operator|=
name|dstimg
operator|->
name|width
operator|-
name|x
expr_stmt|;
if|if
condition|(
name|srcimg
operator|->
name|width
operator|<
name|width
condition|)
name|width
operator|=
name|srcimg
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|dstimg
operator|->
name|height
operator|-
name|y
expr_stmt|;
if|if
condition|(
name|srcimg
operator|->
name|height
operator|<
name|height
condition|)
name|height
operator|=
name|srcimg
operator|->
name|height
expr_stmt|;
comment|/* this is slow, will do better later */
for|for
control|(
name|row
operator|=
name|startrow
init|;
name|row
operator|<
name|height
condition|;
name|row
operator|++
control|)
block|{
for|for
control|(
name|col
operator|=
name|startcol
init|;
name|col
operator|<
name|width
condition|;
name|col
operator|++
control|)
block|{
name|pixel
operator|=
name|XGetPixel
argument_list|(
name|srcimg
argument_list|,
name|col
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|XPutPixel
argument_list|(
name|dstimg
argument_list|,
name|x
operator|+
name|col
argument_list|,
name|y
operator|+
name|row
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * AddPixel  *   * Adds a constant value to every pixel in a pixmap.  *  */
end_comment

begin_expr_stmt
specifier|static
name|_XAddPixel
argument_list|(
name|ximage
argument_list|,
name|value
argument_list|)
specifier|register
name|XImage
operator|*
name|ximage
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|long
name|value
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|x
decl_stmt|;
specifier|register
name|int
name|y
decl_stmt|;
if|if
condition|(
operator|!
name|value
condition|)
return|return;
if|if
condition|(
name|ximage
operator|->
name|depth
operator|==
literal|1
condition|)
block|{
comment|/* The only value that we can add here to an XYBitmap 	     * is one.  Since 1 + value = ~value for one bit wide 	     * data, we do this quickly by taking the ones complement 	     * of the entire bitmap data (offset and pad included!). 	     * Note that we don't need to be concerned with bit or 	     * byte order at all. 	     */
specifier|register
name|unsigned
name|char
modifier|*
name|dp
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
decl_stmt|;
name|x
operator|=
name|ximage
operator|->
name|bytes_per_line
operator|*
name|ximage
operator|->
name|height
expr_stmt|;
while|while
condition|(
operator|--
name|x
operator|>=
literal|0
condition|)
block|{
operator|*
name|dp
operator|=
operator|~
operator|*
name|dp
expr_stmt|;
name|dp
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
condition|)
block|{
specifier|register
name|unsigned
name|char
modifier|*
name|dp
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|ximage
operator|->
name|data
decl_stmt|;
name|x
operator|=
name|ximage
operator|->
name|bytes_per_line
operator|*
name|ximage
operator|->
name|height
expr_stmt|;
while|while
condition|(
operator|--
name|x
operator|>=
literal|0
condition|)
operator|*
name|dp
operator|++
operator|+=
name|value
expr_stmt|;
ifndef|#
directive|ifndef
name|WORD64
block|}
elseif|else
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|16
operator|)
operator|&&
operator|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|byteorderpixel
operator|)
operator|==
name|ximage
operator|->
name|byte_order
operator|)
condition|)
block|{
specifier|register
name|unsigned
name|short
modifier|*
name|dp
init|=
operator|(
name|unsigned
name|short
operator|*
operator|)
name|ximage
operator|->
name|data
decl_stmt|;
name|x
operator|=
operator|(
name|ximage
operator|->
name|bytes_per_line
operator|>>
literal|1
operator|)
operator|*
name|ximage
operator|->
name|height
expr_stmt|;
while|while
condition|(
operator|--
name|x
operator|>=
literal|0
condition|)
operator|*
name|dp
operator|++
operator|+=
name|value
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|ximage
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|ximage
operator|->
name|bits_per_pixel
operator|==
literal|32
operator|)
operator|&&
operator|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|byteorderpixel
operator|)
operator|==
name|ximage
operator|->
name|byte_order
operator|)
condition|)
block|{
specifier|register
name|unsigned
name|long
modifier|*
name|dp
init|=
operator|(
name|unsigned
name|long
operator|*
operator|)
name|ximage
operator|->
name|data
decl_stmt|;
name|x
operator|=
operator|(
name|ximage
operator|->
name|bytes_per_line
operator|>>
literal|2
operator|)
operator|*
name|ximage
operator|->
name|height
expr_stmt|;
while|while
condition|(
operator|--
name|x
operator|>=
literal|0
condition|)
operator|*
name|dp
operator|++
operator|+=
name|value
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
for|for
control|(
name|y
operator|=
name|ximage
operator|->
name|height
init|;
operator|--
name|y
operator|>=
literal|0
condition|;
control|)
block|{
for|for
control|(
name|x
operator|=
name|ximage
operator|->
name|width
init|;
operator|--
name|x
operator|>=
literal|0
condition|;
control|)
block|{
specifier|register
name|unsigned
name|long
name|pixel
init|=
name|XGetPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
name|pixel
operator|=
name|pixel
operator|+
name|value
expr_stmt|;
name|XPutPixel
argument_list|(
name|ximage
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_comment
comment|/*  * This routine initializes the image object function pointers.  The  * intent is to provide native (i.e. fast) routines for native format images  * only using the generic (i.e. slow) routines when fast ones don't exist.  * However, with the current rather botched external interface, clients may  * have to mung image attributes after the image gets created, so the fast  * routines always have to check to make sure the optimization is still  * valid, and reinit the functions if not.  */
end_comment

begin_expr_stmt
name|_XInitImageFuncPtrs
argument_list|(
name|image
argument_list|)
specifier|register
name|XImage
operator|*
name|image
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|image
operator|->
name|f
operator|.
name|create_image
operator|=
name|XCreateImage
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|destroy_image
operator|=
name|_XDestroyImage
expr_stmt|;
if|if
condition|(
operator|(
name|image
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|8
operator|)
condition|)
block|{
name|image
operator|->
name|f
operator|.
name|get_pixel
operator|=
name|_XGetPixel8
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|put_pixel
operator|=
name|_XPutPixel8
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|image
operator|->
name|depth
operator|==
literal|1
operator|)
operator|&&
operator|(
name|image
operator|->
name|byte_order
operator|==
name|image
operator|->
name|bitmap_bit_order
operator|)
condition|)
block|{
name|image
operator|->
name|f
operator|.
name|get_pixel
operator|=
name|_XGetPixel1
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|put_pixel
operator|=
name|_XPutPixel1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|image
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|32
operator|)
condition|)
block|{
name|image
operator|->
name|f
operator|.
name|get_pixel
operator|=
name|_XGetPixel32
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|put_pixel
operator|=
name|_XPutPixel32
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|image
operator|->
name|format
operator|==
name|ZPixmap
operator|)
operator|&&
operator|(
name|image
operator|->
name|bits_per_pixel
operator|==
literal|16
operator|)
condition|)
block|{
name|image
operator|->
name|f
operator|.
name|get_pixel
operator|=
name|_XGetPixel16
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|put_pixel
operator|=
name|_XPutPixel16
expr_stmt|;
block|}
else|else
block|{
name|image
operator|->
name|f
operator|.
name|get_pixel
operator|=
name|_XGetPixel
expr_stmt|;
name|image
operator|->
name|f
operator|.
name|put_pixel
operator|=
name|_XPutPixel
expr_stmt|;
block|}
name|image
operator|->
name|f
operator|.
name|sub_image
operator|=
name|_XSubImage
expr_stmt|;
comment|/*	image->f.set_image = _XSetImage;*/
name|image
operator|->
name|f
operator|.
name|add_pixel
operator|=
name|_XAddPixel
expr_stmt|;
block|}
end_block

end_unit

