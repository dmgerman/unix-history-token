begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XCrGC.c,v 11.38 92/03/04 09:22:18 rws Exp $ */
end_comment

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1986	*/
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|XGCValues
name|Const
name|initial_GC
init|=
block|{
name|GXcopy
block|,
comment|/* function */
name|AllPlanes
block|,
comment|/* plane_mask */
literal|0L
block|,
comment|/* foreground */
literal|1L
block|,
comment|/* background */
literal|0
block|,
comment|/* line_width */
name|LineSolid
block|,
comment|/* line_style */
name|CapButt
block|,
comment|/* cap_style */
name|JoinMiter
block|,
comment|/* join_style */
name|FillSolid
block|,
comment|/* fill_style */
name|EvenOddRule
block|,
comment|/* fill_rule */
name|ArcPieSlice
block|,
comment|/* arc_mode */
operator|(
name|Pixmap
operator|)
operator|~
literal|0L
block|,
comment|/* tile, impossible (unknown) resource */
operator|(
name|Pixmap
operator|)
operator|~
literal|0L
block|,
comment|/* stipple, impossible (unknown) resource */
literal|0
block|,
comment|/* ts_x_origin */
literal|0
block|,
comment|/* ts_y_origin */
operator|(
name|Font
operator|)
operator|~
literal|0L
block|,
comment|/* font, impossible (unknown) resource */
name|ClipByChildren
block|,
comment|/* subwindow_mode */
name|True
block|,
comment|/* graphics_exposures */
literal|0
block|,
comment|/* clip_x_origin */
literal|0
block|,
comment|/* clip_y_origin */
name|None
block|,
comment|/* clip_mask */
literal|0
block|,
comment|/* dash_offset */
literal|4
comment|/* dashes (list [4,4]) */
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|_XGenerateGCList
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|GC
name|XCreateGC
parameter_list|(
name|dpy
parameter_list|,
name|d
parameter_list|,
name|valuemask
parameter_list|,
name|values
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|Drawable
name|d
decl_stmt|;
comment|/* Window or Pixmap for which depth matches */
name|unsigned
name|long
name|valuemask
decl_stmt|;
comment|/* which ones to set initially */
name|XGCValues
modifier|*
name|values
decl_stmt|;
comment|/* the values themselves */
block|{
specifier|register
name|GC
name|gc
decl_stmt|;
specifier|register
name|xCreateGCReq
modifier|*
name|req
decl_stmt|;
specifier|register
name|_XExtension
modifier|*
name|ext
decl_stmt|;
name|LockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|gc
operator|=
operator|(
name|GC
operator|)
name|Xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|_XGC
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|UnlockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|SyncHandle
argument_list|()
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|gc
operator|->
name|rects
operator|=
literal|0
expr_stmt|;
name|gc
operator|->
name|dashes
operator|=
literal|0
expr_stmt|;
name|gc
operator|->
name|ext_data
operator|=
name|NULL
expr_stmt|;
name|gc
operator|->
name|values
operator|=
name|initial_GC
expr_stmt|;
name|gc
operator|->
name|dirty
operator|=
literal|0L
expr_stmt|;
name|valuemask
operator|&=
operator|(
literal|1L
operator|<<
operator|(
name|GCLastBit
operator|+
literal|1
operator|)
operator|)
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|valuemask
condition|)
name|_XUpdateGCCache
argument_list|(
name|gc
argument_list|,
name|valuemask
argument_list|,
name|values
argument_list|)
expr_stmt|;
name|GetReq
argument_list|(
name|CreateGC
argument_list|,
name|req
argument_list|)
expr_stmt|;
name|req
operator|->
name|drawable
operator|=
name|d
expr_stmt|;
name|req
operator|->
name|gc
operator|=
name|gc
operator|->
name|gid
operator|=
name|XAllocID
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
if|if
condition|(
name|req
operator|->
name|mask
operator|=
name|gc
operator|->
name|dirty
condition|)
name|_XGenerateGCList
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
operator|(
name|xReq
operator|*
operator|)
name|req
argument_list|)
expr_stmt|;
name|ext
operator|=
name|dpy
operator|->
name|ext_procs
expr_stmt|;
while|while
condition|(
name|ext
condition|)
block|{
comment|/* call out to any extensions interested */
if|if
condition|(
name|ext
operator|->
name|create_GC
condition|)
call|(
modifier|*
name|ext
operator|->
name|create_GC
call|)
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
operator|&
name|ext
operator|->
name|codes
argument_list|)
expr_stmt|;
name|ext
operator|=
name|ext
operator|->
name|next
expr_stmt|;
block|}
name|gc
operator|->
name|dirty
operator|=
literal|0L
expr_stmt|;
comment|/* allow extensions to see dirty bits */
name|UnlockDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|SyncHandle
argument_list|()
expr_stmt|;
return|return
operator|(
name|gc
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * GenerateGCList looks at the GC dirty bits, and appends all the required  * long words to the request being generated.  */
end_comment

begin_function
specifier|static
name|void
name|_XGenerateGCList
parameter_list|(
name|dpy
parameter_list|,
name|gc
parameter_list|,
name|req
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|xReq
modifier|*
name|req
decl_stmt|;
name|GC
name|gc
decl_stmt|;
block|{
comment|/* Warning!  This code assumes that "unsigned long" is 32-bits wide */
name|unsigned
name|long
name|values
index|[
literal|32
index|]
decl_stmt|;
specifier|register
name|unsigned
name|long
modifier|*
name|value
init|=
name|values
decl_stmt|;
name|long
name|nvalues
decl_stmt|;
specifier|register
name|XGCValues
modifier|*
name|gv
init|=
operator|&
name|gc
operator|->
name|values
decl_stmt|;
specifier|register
name|unsigned
name|long
name|dirty
init|=
name|gc
operator|->
name|dirty
decl_stmt|;
comment|/*      * Note: The order of these tests are critical; the order must be the      * same as the GC mask bits in the word.      */
if|if
condition|(
name|dirty
operator|&
name|GCFunction
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|function
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCPlaneMask
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|plane_mask
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCForeground
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|foreground
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCBackground
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|background
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCLineWidth
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|line_width
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCLineStyle
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|line_style
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCCapStyle
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|cap_style
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCJoinStyle
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|join_style
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCFillStyle
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|fill_style
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCFillRule
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|fill_rule
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCTile
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|tile
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCStipple
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|stipple
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCTileStipXOrigin
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|ts_x_origin
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCTileStipYOrigin
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|ts_y_origin
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCFont
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|font
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCSubwindowMode
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|subwindow_mode
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCGraphicsExposures
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|graphics_exposures
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCClipXOrigin
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|clip_x_origin
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCClipYOrigin
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|clip_y_origin
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCClipMask
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|clip_mask
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCDashOffset
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|dash_offset
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCDashList
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|dashes
expr_stmt|;
if|if
condition|(
name|dirty
operator|&
name|GCArcMode
condition|)
operator|*
name|value
operator|++
operator|=
name|gv
operator|->
name|arc_mode
expr_stmt|;
name|req
operator|->
name|length
operator|+=
operator|(
name|nvalues
operator|=
name|value
operator|-
name|values
operator|)
expr_stmt|;
comment|/*       * note: Data is a macro that uses its arguments multiple      * times, so "nvalues" is changed in a separate assignment      * statement       */
name|nvalues
operator|<<=
literal|2
expr_stmt|;
name|Data32
argument_list|(
name|dpy
argument_list|,
operator|(
name|long
operator|*
operator|)
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
end_function

begin_expr_stmt
name|_XUpdateGCCache
argument_list|(
name|gc
argument_list|,
name|mask
argument_list|,
name|attr
argument_list|)
specifier|register
name|unsigned
name|long
name|mask
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|XGCValues
modifier|*
name|attr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|GC
name|gc
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|XGCValues
modifier|*
name|gv
init|=
operator|&
name|gc
operator|->
name|values
decl_stmt|;
if|if
condition|(
name|mask
operator|&
name|GCFunction
condition|)
if|if
condition|(
name|gv
operator|->
name|function
operator|!=
name|attr
operator|->
name|function
condition|)
block|{
name|gv
operator|->
name|function
operator|=
name|attr
operator|->
name|function
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCFunction
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCPlaneMask
condition|)
if|if
condition|(
name|gv
operator|->
name|plane_mask
operator|!=
name|attr
operator|->
name|plane_mask
condition|)
block|{
name|gv
operator|->
name|plane_mask
operator|=
name|attr
operator|->
name|plane_mask
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCPlaneMask
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCForeground
condition|)
if|if
condition|(
name|gv
operator|->
name|foreground
operator|!=
name|attr
operator|->
name|foreground
condition|)
block|{
name|gv
operator|->
name|foreground
operator|=
name|attr
operator|->
name|foreground
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCForeground
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCBackground
condition|)
if|if
condition|(
name|gv
operator|->
name|background
operator|!=
name|attr
operator|->
name|background
condition|)
block|{
name|gv
operator|->
name|background
operator|=
name|attr
operator|->
name|background
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCBackground
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCLineWidth
condition|)
if|if
condition|(
name|gv
operator|->
name|line_width
operator|!=
name|attr
operator|->
name|line_width
condition|)
block|{
name|gv
operator|->
name|line_width
operator|=
name|attr
operator|->
name|line_width
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCLineWidth
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCLineStyle
condition|)
if|if
condition|(
name|gv
operator|->
name|line_style
operator|!=
name|attr
operator|->
name|line_style
condition|)
block|{
name|gv
operator|->
name|line_style
operator|=
name|attr
operator|->
name|line_style
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCLineStyle
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCCapStyle
condition|)
if|if
condition|(
name|gv
operator|->
name|cap_style
operator|!=
name|attr
operator|->
name|cap_style
condition|)
block|{
name|gv
operator|->
name|cap_style
operator|=
name|attr
operator|->
name|cap_style
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCCapStyle
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCJoinStyle
condition|)
if|if
condition|(
name|gv
operator|->
name|join_style
operator|!=
name|attr
operator|->
name|join_style
condition|)
block|{
name|gv
operator|->
name|join_style
operator|=
name|attr
operator|->
name|join_style
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCJoinStyle
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCFillStyle
condition|)
if|if
condition|(
name|gv
operator|->
name|fill_style
operator|!=
name|attr
operator|->
name|fill_style
condition|)
block|{
name|gv
operator|->
name|fill_style
operator|=
name|attr
operator|->
name|fill_style
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCFillStyle
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCFillRule
condition|)
if|if
condition|(
name|gv
operator|->
name|fill_rule
operator|!=
name|attr
operator|->
name|fill_rule
condition|)
block|{
name|gv
operator|->
name|fill_rule
operator|=
name|attr
operator|->
name|fill_rule
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCFillRule
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCArcMode
condition|)
if|if
condition|(
name|gv
operator|->
name|arc_mode
operator|!=
name|attr
operator|->
name|arc_mode
condition|)
block|{
name|gv
operator|->
name|arc_mode
operator|=
name|attr
operator|->
name|arc_mode
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCArcMode
expr_stmt|;
block|}
comment|/* always write through tile change, since client may have changed pixmap contents */
if|if
condition|(
name|mask
operator|&
name|GCTile
condition|)
block|{
name|gv
operator|->
name|tile
operator|=
name|attr
operator|->
name|tile
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCTile
expr_stmt|;
block|}
comment|/* always write through stipple change, since client may have changed pixmap contents */
if|if
condition|(
name|mask
operator|&
name|GCStipple
condition|)
block|{
name|gv
operator|->
name|stipple
operator|=
name|attr
operator|->
name|stipple
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCStipple
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCTileStipXOrigin
condition|)
if|if
condition|(
name|gv
operator|->
name|ts_x_origin
operator|!=
name|attr
operator|->
name|ts_x_origin
condition|)
block|{
name|gv
operator|->
name|ts_x_origin
operator|=
name|attr
operator|->
name|ts_x_origin
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCTileStipXOrigin
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCTileStipYOrigin
condition|)
if|if
condition|(
name|gv
operator|->
name|ts_y_origin
operator|!=
name|attr
operator|->
name|ts_y_origin
condition|)
block|{
name|gv
operator|->
name|ts_y_origin
operator|=
name|attr
operator|->
name|ts_y_origin
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCTileStipYOrigin
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCFont
condition|)
if|if
condition|(
name|gv
operator|->
name|font
operator|!=
name|attr
operator|->
name|font
condition|)
block|{
name|gv
operator|->
name|font
operator|=
name|attr
operator|->
name|font
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCFont
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCSubwindowMode
condition|)
if|if
condition|(
name|gv
operator|->
name|subwindow_mode
operator|!=
name|attr
operator|->
name|subwindow_mode
condition|)
block|{
name|gv
operator|->
name|subwindow_mode
operator|=
name|attr
operator|->
name|subwindow_mode
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCSubwindowMode
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCGraphicsExposures
condition|)
if|if
condition|(
name|gv
operator|->
name|graphics_exposures
operator|!=
name|attr
operator|->
name|graphics_exposures
condition|)
block|{
name|gv
operator|->
name|graphics_exposures
operator|=
name|attr
operator|->
name|graphics_exposures
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCGraphicsExposures
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCClipXOrigin
condition|)
if|if
condition|(
name|gv
operator|->
name|clip_x_origin
operator|!=
name|attr
operator|->
name|clip_x_origin
condition|)
block|{
name|gv
operator|->
name|clip_x_origin
operator|=
name|attr
operator|->
name|clip_x_origin
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCClipXOrigin
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCClipYOrigin
condition|)
if|if
condition|(
name|gv
operator|->
name|clip_y_origin
operator|!=
name|attr
operator|->
name|clip_y_origin
condition|)
block|{
name|gv
operator|->
name|clip_y_origin
operator|=
name|attr
operator|->
name|clip_y_origin
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCClipYOrigin
expr_stmt|;
block|}
comment|/* always write through mask change, since client may have changed pixmap contents */
if|if
condition|(
name|mask
operator|&
name|GCClipMask
condition|)
block|{
name|gv
operator|->
name|clip_mask
operator|=
name|attr
operator|->
name|clip_mask
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCClipMask
expr_stmt|;
name|gc
operator|->
name|rects
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCDashOffset
condition|)
if|if
condition|(
name|gv
operator|->
name|dash_offset
operator|!=
name|attr
operator|->
name|dash_offset
condition|)
block|{
name|gv
operator|->
name|dash_offset
operator|=
name|attr
operator|->
name|dash_offset
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCDashOffset
expr_stmt|;
block|}
if|if
condition|(
name|mask
operator|&
name|GCDashList
condition|)
if|if
condition|(
operator|(
name|gv
operator|->
name|dashes
operator|!=
name|attr
operator|->
name|dashes
operator|)
operator|||
operator|(
name|gc
operator|->
name|dashes
operator|==
name|True
operator|)
condition|)
block|{
name|gv
operator|->
name|dashes
operator|=
name|attr
operator|->
name|dashes
expr_stmt|;
name|gc
operator|->
name|dirty
operator||=
name|GCDashList
expr_stmt|;
name|gc
operator|->
name|dashes
operator|=
literal|0
expr_stmt|;
block|}
return|return;
block|}
end_block

begin_comment
comment|/* can only call when display is already locked. */
end_comment

begin_macro
name|_XFlushGCCache
argument_list|(
argument|dpy
argument_list|,
argument|gc
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|GC
name|gc
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|xChangeGCReq
modifier|*
name|req
decl_stmt|;
specifier|register
name|_XExtension
modifier|*
name|ext
decl_stmt|;
if|if
condition|(
name|gc
operator|->
name|dirty
condition|)
block|{
name|GetReq
argument_list|(
name|ChangeGC
argument_list|,
name|req
argument_list|)
expr_stmt|;
name|req
operator|->
name|gc
operator|=
name|gc
operator|->
name|gid
expr_stmt|;
name|req
operator|->
name|mask
operator|=
name|gc
operator|->
name|dirty
expr_stmt|;
name|_XGenerateGCList
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
operator|(
name|xReq
operator|*
operator|)
name|req
argument_list|)
expr_stmt|;
name|ext
operator|=
name|dpy
operator|->
name|ext_procs
expr_stmt|;
while|while
condition|(
name|ext
condition|)
block|{
comment|/* call out to any extensions interested */
if|if
condition|(
name|ext
operator|->
name|flush_GC
condition|)
call|(
modifier|*
name|ext
operator|->
name|flush_GC
call|)
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
operator|&
name|ext
operator|->
name|codes
argument_list|)
expr_stmt|;
name|ext
operator|=
name|ext
operator|->
name|next
expr_stmt|;
block|}
name|gc
operator|->
name|dirty
operator|=
literal|0L
expr_stmt|;
comment|/* allow extensions to see dirty bits */
block|}
block|}
end_block

begin_function
name|void
name|XFlushGC
parameter_list|(
name|dpy
parameter_list|,
name|gc
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|GC
name|gc
decl_stmt|;
block|{
name|FlushGC
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GContext
name|XGContextFromGC
parameter_list|(
name|gc
parameter_list|)
name|GC
name|gc
decl_stmt|;
block|{
return|return
operator|(
name|gc
operator|->
name|gid
operator|)
return|;
block|}
end_function

end_unit

