begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XInitCT.c,v 1.18 92/04/14 15:55:19 rws Exp $  */
end_comment

begin_comment
comment|/*  * Copyright 1990, 1991 by OMRON Corporation, NTT Software Corporation,  *                      and Nippon Telegraph and Telephone Corporation  * Copyright 1991 by the Massachusetts Institute of Technology  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the names of OMRON, NTT Software, NTT, and M.I.T.  * not be used in advertising or publicity pertaining to distribution of the  * software without specific, written prior permission. OMRON, NTT Software,  * NTT, and M.I.T. make no representations about the suitability of this  * software for any purpose.  It is provided "as is" without express or  * implied warranty.  *  * OMRON, NTT SOFTWARE, NTT, AND M.I.T. DISCLAIM ALL WARRANTIES WITH REGARD  * TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS, IN NO EVENT SHALL OMRON, NTT SOFTWARE, NTT, OR M.I.T. BE  * LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES   * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *  *	Authors: Li Yuhong		OMRON Corporation  *		 Hiroshi Kuribayashi	OMRON Corporation  *     */
end_comment

begin_comment
comment|/*   * This module provides functions operating on the CT(ISO 2022) encoding to  * support such conversion functions.  * All approved standard CT encodings are stored here, i.e., allocated  * to client's memory.  I don't know whether it is suitable or not, because  * X server does not provide any propertis for the CT encodings registered  * by X consortium.  *  * by Li Yuhong, Nov. 7, 1990  *  */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xresource.h>
end_include

begin_include
include|#
directive|include
file|"Xlocaleint.h"
end_include

begin_comment
comment|/*  * Font CharSet Name Registered by X Consortium.   * The order is same in page 5 of document, "Compound Text Encoding" */
end_comment

begin_define
define|#
directive|define
name|NISO8859_1
value|"iso8859-1"
end_define

begin_define
define|#
directive|define
name|NISO8859_2
value|"iso8859-2"
end_define

begin_define
define|#
directive|define
name|NISO8859_3
value|"iso8859-3"
end_define

begin_define
define|#
directive|define
name|NISO8859_4
value|"iso8859-4"
end_define

begin_define
define|#
directive|define
name|NISO8859_5
value|"iso8859-5"
end_define

begin_define
define|#
directive|define
name|NISO8859_6
value|"iso8859-6"
end_define

begin_define
define|#
directive|define
name|NISO8859_7
value|"iso8859-7"
end_define

begin_define
define|#
directive|define
name|NISO8859_8
value|"iso8859-8"
end_define

begin_define
define|#
directive|define
name|NISO8859_9
value|"iso8859-9"
end_define

begin_define
define|#
directive|define
name|NJISX0201_0
value|"jisx0201.1976-0"
end_define

begin_define
define|#
directive|define
name|NGB2312_0
value|"gb2312.1980-0"
end_define

begin_define
define|#
directive|define
name|NGB2312_1
value|"gb2312.1980-1"
end_define

begin_define
define|#
directive|define
name|NJISX0208_0
value|"jisx0208.1983-0"
end_define

begin_define
define|#
directive|define
name|NJISX0208_1
value|"jisx0208.1983-1"
end_define

begin_define
define|#
directive|define
name|NKSC5601_0
value|"ksc5601.1987-0"
end_define

begin_define
define|#
directive|define
name|NKSC5601_1
value|"ksc5601.1987-1"
end_define

begin_define
define|#
directive|define
name|NISO646_0
value|"iso646-0"
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|OLDJISX0208ONLY
end_ifndef

begin_define
define|#
directive|define
name|NNJISX0208_0
value|"jisx0208.1990-0"
end_define

begin_define
define|#
directive|define
name|NNJISX0208_1
value|"jisx0208.1990-1"
end_define

begin_define
define|#
directive|define
name|NNJISX0212_0
value|"jisx0212.1990-0"
end_define

begin_define
define|#
directive|define
name|NNJISX0212_1
value|"jisx0212.1990-1"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Approved Standard Encodings */
end_comment

begin_define
define|#
directive|define
name|EISO8859_1L
value|"\033(B"
end_define

begin_comment
comment|/* GL 94 character set */
end_comment

begin_define
define|#
directive|define
name|EJISX0201_L
value|"\033(J"
end_define

begin_comment
comment|/* GR 94 character set */
end_comment

begin_define
define|#
directive|define
name|EJISX0201_R
value|"\033)I"
end_define

begin_comment
comment|/* GR 94 character set */
end_comment

begin_define
define|#
directive|define
name|EISO8859_1R
value|"\033-A"
end_define

begin_comment
comment|/* GR 96 character set */
end_comment

begin_define
define|#
directive|define
name|EISO8859_2R
value|"\033-B"
end_define

begin_define
define|#
directive|define
name|EISO8859_3R
value|"\033-C"
end_define

begin_define
define|#
directive|define
name|EISO8859_4R
value|"\033-D"
end_define

begin_define
define|#
directive|define
name|EISO8859_7R
value|"\033-F"
end_define

begin_define
define|#
directive|define
name|EISO8859_6R
value|"\033-G"
end_define

begin_define
define|#
directive|define
name|EISO8859_8R
value|"\033-H"
end_define

begin_define
define|#
directive|define
name|EISO8859_5R
value|"\033-L"
end_define

begin_define
define|#
directive|define
name|EISO8859_9R
value|"\033-M"
end_define

begin_define
define|#
directive|define
name|EGB2312_0
value|"\033$(A"
end_define

begin_comment
comment|/* GL 94N character set */
end_comment

begin_define
define|#
directive|define
name|EGB2312_1
value|"\033$)A"
end_define

begin_comment
comment|/* GR 94N character set */
end_comment

begin_define
define|#
directive|define
name|EJISX0208_0
value|"\033$(B"
end_define

begin_define
define|#
directive|define
name|EJISX0208_1
value|"\033$)B"
end_define

begin_define
define|#
directive|define
name|EKSC5601_0
value|"\033$(C"
end_define

begin_define
define|#
directive|define
name|EKSC5601_1
value|"\033$)C"
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|OLDJISX0208ONLY
end_ifndef

begin_define
define|#
directive|define
name|EJISX0212_0
value|"\033$(D"
end_define

begin_define
define|#
directive|define
name|EJISX0212_1
value|"\033$)D"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|EISO646_0
value|EISO8859_1L
end_define

begin_comment
comment|/*  * Add one more for Taiwan.  * It would be better to invoke final characters for Taiwan into 03/01  * and 03/02 in accordance with ISO 2022 because it has not registered yet.  * However strict CT definition contains the following statements:  *  *    [Final characters for private encodings (in the range 03/00 to 03/15),  *    are not permitted here in Compound Text.]    *  * Ooh,Ooh!  * So the final characters for Taiwan is defined to 05/01 and 05/02.  *  * By Li Yuhong, Nov. 20, 1990 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|nodef
end_ifdef

begin_define
define|#
directive|define
name|NTW2312_1
value|"tw2312-1.1980-0"
end_define

begin_define
define|#
directive|define
name|NTW2312_2
value|"tw2312-2.1980-0"
end_define

begin_define
define|#
directive|define
name|ETW2312_1
value|"\033$(Y"
end_define

begin_comment
comment|/* Taiwan Font1, not registered yet.*/
end_comment

begin_define
define|#
directive|define
name|ETW2312_2
value|"\033$(Z"
end_define

begin_comment
comment|/* Taiwan Font2, not registered yet.*/
end_comment

begin_define
define|#
directive|define
name|WTW2312_1
value|PrivatePlaneLastI11
end_define

begin_define
define|#
directive|define
name|WTW2312_2
value|PrivatePlaneLastI10
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Offset in 4-byte wchar encoding, referred to  	ISO/IEC DIS 10646  	Infomation technology - Universal Coded Character Set (UCS) */
end_comment

begin_define
define|#
directive|define
name|WISO8859_1
value|0x20202000
end_define

begin_define
define|#
directive|define
name|WISO8859_1R
value|0x20202080
end_define

begin_comment
comment|/* We use Right half of JISX0201 (Katakana) in    Last rows of Private Use Zone */
end_comment

begin_define
define|#
directive|define
name|WJISX0201_L
value|PrivateZoneLast-0x100
end_define

begin_define
define|#
directive|define
name|WJISX0201_R
value|PrivateZoneLast
end_define

begin_define
define|#
directive|define
name|WISO8859_2R
value|0x20202180
end_define

begin_comment
comment|/* Row33:Latin Alphabet No.2 */
end_comment

begin_define
define|#
directive|define
name|WISO8859_3R
value|0x20202280
end_define

begin_comment
comment|/*? not found in DIS 10646 */
end_comment

begin_define
define|#
directive|define
name|WISO8859_4R
value|0x20202380
end_define

begin_comment
comment|/*? not found in DIS 10646 */
end_comment

begin_define
define|#
directive|define
name|WISO8859_9R
value|0x20202480
end_define

begin_comment
comment|/*? not found in DIS 10646 */
end_comment

begin_define
define|#
directive|define
name|WISO8859_5R
value|0x20202880
end_define

begin_comment
comment|/* Row40:Cyrillic*/
end_comment

begin_define
define|#
directive|define
name|WISO8859_7R
value|0x20202A80
end_define

begin_comment
comment|/* Row42:Greek(little bit diffrent)*/
end_comment

begin_define
define|#
directive|define
name|WISO8859_6R
value|0x20202C80
end_define

begin_comment
comment|/* Row44:Araabic(little bit diffrent)*/
end_comment

begin_define
define|#
directive|define
name|WISO8859_8R
value|0x20202D80
end_define

begin_comment
comment|/* Row45:Hebrew(little bit diffrent)*/
end_comment

begin_define
define|#
directive|define
name|WGB2312
value|HANZISCRIPT
end_define

begin_define
define|#
directive|define
name|WJISX0208
value|KANJISCRIPT
end_define

begin_define
define|#
directive|define
name|WKSC5601
value|HANJASCRIPT
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|OLDJISX0208ONLY
end_ifndef

begin_define
define|#
directive|define
name|WJISX0212
value|0x20408000
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|WISO646_0
value|WISO8859_1
end_define

begin_comment
comment|/*   * table for registered states, i.e., CT encodings. */
end_comment

begin_define
define|#
directive|define
name|MAXISOSTATE
value|127
end_define

begin_comment
comment|/* for 127 countries, enough? */
end_comment

begin_typedef
typedef|typedef
struct|struct
block|{
name|char
modifier|*
name|nstate_name
decl_stmt|;
comment|/* standard name registered by X */
name|char
modifier|*
name|nstate_encoding
decl_stmt|;
comment|/* control sequence of CT encoding */
name|XrmQuark
name|state_name
decl_stmt|;
comment|/* same as nstate_name, but quark */
name|XrmQuark
name|state_encoding
decl_stmt|;
comment|/* same as nstate_encoding, but quark*/
name|wchar
name|state_woffset
decl_stmt|;
comment|/* offset in 4-byte wchar encoding */
name|int
name|state_length
decl_stmt|;
comment|/* number of bytes of encoding */
name|_CSID
name|GLorGR
decl_stmt|;
name|_CSID
name|C94orC96
decl_stmt|;
block|}
name|ISORegisterState
typedef|;
end_typedef

begin_decl_stmt
specifier|static
name|ISORegisterState
modifier|*
name|ISOStateTable
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|_CSID
name|ISOStateTableNum
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|int
name|lock
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  *   Function Name: _XInitCTEncoding()  *    Arguments IN: none.  *             OUT: none.  *          Return: none.  *     Description: The function builds the internal table for CT encoding  *                  registered by X Consortium.  It will convert string  *                  names to quark names, and hire the resource memory  *                  to store strings.  *                   */
end_comment

begin_function
name|void
name|_XInitCTEncoding
parameter_list|()
block|{
specifier|register
name|ISORegisterState
modifier|*
name|ptr
decl_stmt|;
name|LockMutex
argument_list|(
operator|&
name|lock
argument_list|)
expr_stmt|;
if|if
condition|(
name|ISOStateTableNum
operator|>
literal|0
condition|)
block|{
name|UnlockMutex
argument_list|(
operator|&
name|lock
argument_list|)
expr_stmt|;
return|return;
comment|/* already initialized */
block|}
name|ptr
operator|=
name|ISOStateTable
operator|=
operator|(
name|ISORegisterState
operator|*
operator|)
name|Xmalloc
argument_list|(
name|MAXISOSTATE
operator|*
sizeof|sizeof
argument_list|(
name|ISORegisterState
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
operator|==
name|NULL
condition|)
block|{
name|UnlockMutex
argument_list|(
operator|&
name|lock
argument_list|)
expr_stmt|;
return|return;
block|}
define|#
directive|define
name|RegisterStandard
parameter_list|(
name|name
parameter_list|,
name|encoding
parameter_list|,
name|woffset
parameter_list|)
define|\
value|ptr->state_name = XrmStringToQuark(name);                       \         ptr->state_encoding = XrmStringToQuark(encoding);               \         ptr->state_woffset = woffset;                                   \
comment|/* hire the resource memory to store the string. */
value|\         ptr->nstate_name = XrmQuarkToString(ptr->state_name);           \         ptr->nstate_encoding = XrmQuarkToString(ptr->state_encoding);   \
comment|/* only 2 or 1 bytes are supported in X. */
value|\         ptr->state_length = (ptr->nstate_encoding[1] == '$')? 2 : 1;    \         ptr->GLorGR = ((_XctisGLdsg(ptr->nstate_encoding)) ? GL: GR);	\ 	ptr->C94orC96 = (ptr->nstate_encoding[1] == '-') ? C96 : C94;	\         ptr++; ISOStateTableNum++;
comment|/*       * sort the table with woffset key, but not done yet.      * So do not change the following order, it decides the previlidge       * as that first match is first got.      */
comment|/* Must Registerate ISO8859-1 GL first */
name|RegisterStandard
argument_list|(
name|NISO8859_1
argument_list|,
name|EISO8859_1L
argument_list|,
name|WISO8859_1
argument_list|)
expr_stmt|;
comment|/* Must Registerate ISO8859-1 GR second */
name|RegisterStandard
argument_list|(
name|NISO8859_1
argument_list|,
name|EISO8859_1R
argument_list|,
name|WISO8859_1R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NJISX0208_0
argument_list|,
name|EJISX0208_0
argument_list|,
name|WJISX0208
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NJISX0201_0
argument_list|,
name|EJISX0201_R
argument_list|,
name|WJISX0201_R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NJISX0201_0
argument_list|,
name|EJISX0201_L
argument_list|,
name|WJISX0201_L
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NGB2312_0
argument_list|,
name|EGB2312_0
argument_list|,
name|WGB2312
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NKSC5601_0
argument_list|,
name|EKSC5601_0
argument_list|,
name|WKSC5601
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO646_0
argument_list|,
name|EISO646_0
argument_list|,
name|WISO646_0
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_2
argument_list|,
name|EISO8859_2R
argument_list|,
name|WISO8859_2R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_3
argument_list|,
name|EISO8859_3R
argument_list|,
name|WISO8859_3R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_4
argument_list|,
name|EISO8859_4R
argument_list|,
name|WISO8859_4R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_9
argument_list|,
name|EISO8859_9R
argument_list|,
name|WISO8859_9R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_5
argument_list|,
name|EISO8859_5R
argument_list|,
name|WISO8859_5R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_7
argument_list|,
name|EISO8859_7R
argument_list|,
name|WISO8859_7R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_6
argument_list|,
name|EISO8859_6R
argument_list|,
name|WISO8859_6R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NISO8859_8
argument_list|,
name|EISO8859_8R
argument_list|,
name|WISO8859_8R
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NGB2312_1
argument_list|,
name|EGB2312_1
argument_list|,
name|WGB2312
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NJISX0208_1
argument_list|,
name|EJISX0208_1
argument_list|,
name|WJISX0208
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NKSC5601_1
argument_list|,
name|EKSC5601_1
argument_list|,
name|WKSC5601
argument_list|)
expr_stmt|;
comment|/*     RegisterStandard(NTW2312_1,  ETW2312_1,   WTW2312_1);     RegisterStandard(NTW2312_2,  ETW2312_2,   WTW2312_2); */
ifndef|#
directive|ifndef
name|OLDJISX0208ONLY
name|RegisterStandard
argument_list|(
name|NNJISX0208_0
argument_list|,
name|EJISX0208_0
argument_list|,
name|WJISX0208
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NNJISX0208_1
argument_list|,
name|EJISX0208_1
argument_list|,
name|WJISX0208
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NNJISX0212_0
argument_list|,
name|EJISX0212_0
argument_list|,
name|WJISX0212
argument_list|)
expr_stmt|;
name|RegisterStandard
argument_list|(
name|NNJISX0212_1
argument_list|,
name|EJISX0212_1
argument_list|,
name|WJISX0212
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|UnlockMutex
argument_list|(
operator|&
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *   Function Name: _XRegisterCharSet()  *    Arguments IN: state_name - name of CharSet.  *                  state_encoding - CT encoding, control sequence,  *                                   provided by caller. null-terminated.  *                  woffset - offset in wchar encoding.  *             OUT: none  *          Return: True - successful.  *                  False -- can not registered state name.  *     Description: The function registers a CharSet name into internal  *                  table.  *                  The control sequence and woffset should not conflict with  *                  already registered state.  */
end_comment

begin_function
name|Bool
name|_XRegisterCharSet
parameter_list|(
name|state_name
parameter_list|,
name|state_encoding
parameter_list|,
name|woffset
parameter_list|,
name|GLorGR
parameter_list|,
name|bytes
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|char
modifier|*
name|state_encoding
decl_stmt|;
name|wchar
name|woffset
decl_stmt|;
name|int
name|GLorGR
decl_stmt|;
name|int
name|bytes
decl_stmt|;
block|{
specifier|register
name|ISORegisterState
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|ISOStateTableNum
operator|>=
name|MAXISOSTATE
condition|)
comment|/* over maxinum, unacceptable fact!!! */
return|return
operator|(
name|False
operator|)
return|;
comment|/*      * Check Correctness. coding in later if this function is necessary.      */
name|ptr
operator|=
name|ISOStateTable
operator|+
name|ISOStateTableNum
expr_stmt|;
name|ptr
operator|->
name|state_name
operator|=
name|XrmStringToQuark
argument_list|(
name|state_name
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|state_encoding
operator|=
name|XrmStringToQuark
argument_list|(
name|state_encoding
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|state_woffset
operator|=
name|woffset
expr_stmt|;
name|ptr
operator|->
name|nstate_name
operator|=
name|XrmQuarkToString
argument_list|(
name|ptr
operator|->
name|state_name
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|nstate_encoding
operator|=
name|XrmQuarkToString
argument_list|(
name|ptr
operator|->
name|state_encoding
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|state_length
operator|=
name|bytes
expr_stmt|;
name|ptr
operator|->
name|GLorGR
operator|=
name|GLorGR
expr_stmt|;
name|ptr
operator|->
name|C94orC96
operator|=
operator|(
name|ptr
operator|->
name|nstate_encoding
index|[
literal|1
index|]
operator|==
literal|'-'
operator|)
condition|?
name|C96
else|:
name|C94
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
name|ISOStateTableNum
operator|++
expr_stmt|;
return|return
name|True
return|;
block|}
end_function

begin_function
name|Bool
name|_XctisGLdsg
parameter_list|(
name|dsg
parameter_list|)
name|char
modifier|*
name|dsg
decl_stmt|;
block|{
if|if
condition|(
operator|*
operator|(
name|dsg
operator|+
literal|1
operator|)
operator|==
literal|'('
operator|||
operator|*
operator|(
name|dsg
operator|+
literal|2
operator|)
operator|==
literal|'('
condition|)
return|return
operator|(
name|True
operator|)
return|;
elseif|else
if|if
condition|(
operator|*
operator|(
name|dsg
operator|+
literal|1
operator|)
operator|==
literal|')'
operator|||
operator|*
operator|(
name|dsg
operator|+
literal|2
operator|)
operator|==
literal|')'
operator|||
operator|*
operator|(
name|dsg
operator|+
literal|1
operator|)
operator|==
literal|'-'
condition|)
return|return
operator|(
name|False
operator|)
return|;
elseif|else
if|if
condition|(
operator|*
operator|(
name|dsg
operator|+
literal|1
operator|)
operator|==
literal|'$'
operator|&&
operator|(
operator|*
operator|(
name|dsg
operator|+
literal|2
operator|)
operator|==
literal|'@'
operator|||
operator|*
operator|(
name|dsg
operator|+
literal|2
operator|)
operator|==
literal|'A'
operator|||
operator|*
operator|(
name|dsg
operator|+
literal|2
operator|)
operator|==
literal|'B'
operator|)
condition|)
return|return
operator|(
name|True
operator|)
return|;
return|return
operator|(
name|False
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * The prefix of the following function names "_Xcw" means the functions  * operating on the CT and wchar. */
end_comment

begin_comment
comment|/*  * _XcwNameGetALL()  *   get all items of RegisterTable with the index state_name. */
end_comment

begin_function
name|_CSID
name|_XcwNameGetGLorGRId
parameter_list|(
name|state_name
parameter_list|,
name|GLorGR
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|_CSID
name|GLorGR
decl_stmt|;
block|{
specifier|register
name|XrmQuark
name|name
decl_stmt|;
specifier|register
name|ISORegisterState
modifier|*
name|ptr
decl_stmt|;
specifier|register
name|_CSID
name|id
decl_stmt|;
name|name
operator|=
name|XrmStringToQuark
argument_list|(
name|state_name
argument_list|)
expr_stmt|;
for|for
control|(
name|id
operator|=
literal|0
operator|,
name|ptr
operator|=
name|ISOStateTable
init|;
name|id
operator|<
name|ISOStateTableNum
condition|;
name|id
operator|++
operator|,
name|ptr
operator|++
control|)
if|if
condition|(
name|name
operator|==
name|ptr
operator|->
name|state_name
condition|)
block|{
if|if
condition|(
name|ptr
operator|->
name|GLorGR
operator|!=
name|GLorGR
condition|)
continue|continue;
return|return
operator|(
name|id
operator|)
return|;
block|}
return|return
operator|(
name|ND
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwNameGetAll
parameter_list|(
name|state_name
parameter_list|,
name|state_encoding
parameter_list|,
name|woffset
parameter_list|,
name|GLorGR
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
name|_CSID
name|GLorGR
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwNameGetGLorGRId
argument_list|(
name|state_name
argument_list|,
name|GLorGR
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|not_use
end_ifdef

begin_function
name|Bool
name|_XcwNameGetId
parameter_list|(
name|xlocale
parameter_list|,
name|state_name
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
name|state_name
decl_stmt|;
block|{
name|_CSID
name|GLorGR
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
name|GLorGR
operator|=
name|ctGetGLorGR
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwNameGetGLorGRId
argument_list|(
name|state_name
argument_list|,
name|GLorGR
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
name|ctSetid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|int
name|_XcwNameGetLength
parameter_list|(
name|state_name
parameter_list|,
name|GLorGR
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|_CSID
name|GLorGR
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwNameGetGLorGRId
argument_list|(
name|state_name
argument_list|,
name|GLorGR
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_length
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwNameGetEncoding
parameter_list|(
name|state_name
parameter_list|,
name|state_encoding
parameter_list|,
name|GLorGR
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
name|_CSID
name|GLorGR
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwNameGetGLorGRId
argument_list|(
name|state_name
argument_list|,
name|GLorGR
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwNameGetWoffset
parameter_list|(
name|state_name
parameter_list|,
name|woffset
parameter_list|,
name|GLorGR
parameter_list|)
name|char
modifier|*
name|state_name
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
name|_CSID
name|GLorGR
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwNameGetGLorGRId
argument_list|(
name|state_name
argument_list|,
name|GLorGR
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * _XcwEscGetAll()  *   get all items of ISOStateTable with the index state_encoding. */
end_comment

begin_function
specifier|static
name|_CSID
name|_XcwEscGetId
parameter_list|(
name|state_encoding
parameter_list|)
name|char
modifier|*
name|state_encoding
decl_stmt|;
block|{
specifier|register
name|XrmQuark
name|encoding
decl_stmt|;
specifier|register
name|ISORegisterState
modifier|*
name|ptr
decl_stmt|;
specifier|register
name|_CSID
name|i
decl_stmt|;
name|char
name|esc
index|[
literal|128
index|]
decl_stmt|;
if|if
condition|(
name|state_encoding
index|[
literal|1
index|]
operator|==
literal|0x25
condition|)
block|{
name|strcpy
argument_list|(
name|esc
argument_list|,
name|state_encoding
argument_list|)
expr_stmt|;
name|esc
index|[
literal|4
index|]
operator|=
literal|'0'
expr_stmt|;
name|esc
index|[
literal|5
index|]
operator|=
literal|'0'
expr_stmt|;
comment|/* mask length */
name|state_encoding
operator|=
name|esc
expr_stmt|;
block|}
name|encoding
operator|=
name|XrmStringToQuark
argument_list|(
name|state_encoding
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|ptr
operator|=
name|ISOStateTable
init|;
name|i
operator|<
name|ISOStateTableNum
condition|;
name|i
operator|++
operator|,
name|ptr
operator|++
control|)
if|if
condition|(
name|encoding
operator|==
name|ptr
operator|->
name|state_encoding
condition|)
block|{
return|return
operator|(
name|i
operator|)
return|;
block|}
return|return
operator|(
name|ND
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|_CSID
name|_XcwEscGetIdFromLocale
parameter_list|(
name|xlocale
parameter_list|,
name|state_encoding
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|Fontset
modifier|*
name|fontset
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
name|char
name|esc
index|[
literal|128
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|xlocale
operator|&&
operator|!
name|xlocale
operator|->
name|xlc_db
operator|&&
operator|!
name|xlocale
operator|->
name|xlc_db
operator|->
name|lc_fontset
condition|)
block|{
return|return
operator|(
name|_XcwEscGetId
argument_list|(
name|state_encoding
argument_list|)
operator|)
return|;
block|}
name|fontset
operator|=
name|xlocale
operator|->
name|xlc_db
operator|->
name|lc_fontset
expr_stmt|;
if|if
condition|(
name|state_encoding
index|[
literal|1
index|]
operator|==
literal|0x25
condition|)
block|{
name|strcpy
argument_list|(
name|esc
argument_list|,
name|state_encoding
argument_list|)
expr_stmt|;
name|esc
index|[
literal|4
index|]
operator|=
literal|'0'
expr_stmt|;
name|esc
index|[
literal|5
index|]
operator|=
literal|'0'
expr_stmt|;
comment|/* mask length */
name|state_encoding
operator|=
name|esc
expr_stmt|;
block|}
for|for
control|(
name|id
operator|=
literal|0
init|;
name|id
operator|<
name|fontset
operator|->
name|fs_num
condition|;
name|id
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|state_encoding
argument_list|,
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_des
argument_list|)
condition|)
return|return
operator|(
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_id
operator|)
return|;
block|}
return|return
operator|(
name|_XcwEscGetId
argument_list|(
name|state_encoding
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwEscSetStatus
parameter_list|(
name|xlocale
parameter_list|,
name|state_encoding
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetIdFromLocale
argument_list|(
name|xlocale
argument_list|,
name|state_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
name|ctSetGLorGR
argument_list|(
name|xlocale
argument_list|,
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|GLorGR
argument_list|)
expr_stmt|;
name|ctSetid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|not_use
end_ifdef

begin_function
name|Bool
name|_XcwEscGetAll
parameter_list|(
name|xlocale
parameter_list|,
name|state_encoding
parameter_list|,
name|woffset
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
name|state_encoding
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetIdFromLocale
argument_list|(
name|xlocale
argument_list|,
name|state_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
name|ctSetGLorGR
argument_list|(
name|xlocale
argument_list|,
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|GLorGR
argument_list|)
expr_stmt|;
name|ctSetid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|int
name|_XcwEscGetLength
parameter_list|(
name|state_encoding
parameter_list|)
name|char
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetId
argument_list|(
name|state_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
literal|0
return|;
return|return
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_length
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwEscGetName
parameter_list|(
name|state_encoding
parameter_list|,
name|state_name
parameter_list|)
name|char
modifier|*
name|state_encoding
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_name
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetId
argument_list|(
name|state_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|state_name
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_name
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwEscGetWoffset
parameter_list|(
name|state_encoding
parameter_list|,
name|woffset
parameter_list|)
name|char
modifier|*
name|state_encoding
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetId
argument_list|(
name|state_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * _XcwEscGetEncoding()  *   get same encoding sequence as caller passed, but the returned encoding  *   sequence stored in the internal table. */
end_comment

begin_function
name|Bool
name|_XcwEscGetEncoding
parameter_list|(
name|passed_encoding
parameter_list|,
name|state_encoding
parameter_list|)
name|char
modifier|*
name|passed_encoding
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwEscGetId
argument_list|(
name|passed_encoding
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
return|return
operator|(
name|False
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * _XcwGetAll()  *  calculate the minimun of difference between wc and woffset, then  *  return all items of ISOStateTable.  * */
end_comment

begin_function
name|_CSID
name|_XcwGetWoffset
parameter_list|(
name|wc
parameter_list|,
name|woffset
parameter_list|)
name|wchar
name|wc
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
block|{
specifier|register
name|ISORegisterState
modifier|*
name|ptr
init|=
name|ISOStateTable
decl_stmt|;
specifier|register
name|wchar
name|disp_min
decl_stmt|,
name|new
decl_stmt|;
name|_CSID
name|ind
decl_stmt|,
name|i
decl_stmt|;
name|_CSID
name|n
init|=
name|ISOStateTableNum
decl_stmt|;
define|#
directive|define
name|PosSub
parameter_list|(
name|s1
parameter_list|,
name|s2
parameter_list|)
value|(((s1)>= (s2)) ? ((s1) - (s2)) : ~0L)
operator|*
name|woffset
operator|=
name|ptr
operator|->
name|state_woffset
expr_stmt|;
name|wc
operator|&=
operator|~
literal|0x7f
expr_stmt|;
name|ind
operator|=
name|CODESET0
expr_stmt|;
name|disp_min
operator|=
name|PosSub
argument_list|(
name|wc
argument_list|,
name|ptr
operator|->
name|state_woffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|disp_min
operator|==
operator|(
name|wchar
operator|)
operator|~
literal|0L
condition|)
block|{
operator|*
name|woffset
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|ND
operator|)
return|;
block|}
if|if
condition|(
name|disp_min
operator|<
literal|0x80
condition|)
return|return
operator|(
name|CODESET0
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|1
operator|,
name|ptr
operator|++
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
operator|,
name|ptr
operator|++
control|)
block|{
if|if
condition|(
name|ptr
operator|->
name|state_length
operator|==
literal|2
condition|)
name|new
operator|=
name|PosSub
argument_list|(
name|wc
operator|&
operator|~
literal|0x7f00
argument_list|,
name|ptr
operator|->
name|state_woffset
argument_list|)
expr_stmt|;
else|else
name|new
operator|=
name|PosSub
argument_list|(
name|wc
argument_list|,
name|ptr
operator|->
name|state_woffset
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|new
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|new
operator|<
name|disp_min
operator|)
condition|)
block|{
operator|*
name|woffset
operator|=
name|ptr
operator|->
name|state_woffset
expr_stmt|;
if|if
condition|(
name|new
operator|<
literal|0x80
condition|)
return|return
operator|(
name|i
operator|)
return|;
name|ind
operator|=
name|i
expr_stmt|;
name|disp_min
operator|=
name|new
expr_stmt|;
block|}
block|}
return|return
operator|(
name|ind
operator|)
return|;
block|}
end_function

begin_function
name|_CSID
name|_XcwGetWoffsetFromLocale
parameter_list|(
name|xlocale
parameter_list|,
name|wc
parameter_list|,
name|woffset
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|wchar
name|wc
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
block|{
specifier|register
name|wchar
name|disp_min
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
name|Fontset
modifier|*
name|fontset
decl_stmt|;
if|if
condition|(
operator|!
name|xlocale
operator|&&
operator|!
name|xlocale
operator|->
name|xlc_db
operator|&&
operator|!
name|xlocale
operator|->
name|xlc_db
operator|->
name|lc_fontset
condition|)
block|{
operator|*
name|woffset
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|_XcwGetWoffset
argument_list|(
name|wc
argument_list|,
name|woffset
argument_list|)
operator|)
return|;
block|}
name|fontset
operator|=
name|xlocale
operator|->
name|xlc_db
operator|->
name|lc_fontset
expr_stmt|;
name|wc
operator|&=
operator|~
literal|0x7f
expr_stmt|;
for|for
control|(
name|id
operator|=
literal|0
init|;
name|id
operator|<
name|fontset
operator|->
name|fs_num
condition|;
name|id
operator|++
control|)
block|{
if|if
condition|(
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_len
operator|==
literal|2
condition|)
name|disp_min
operator|=
name|PosSub
argument_list|(
name|wc
operator|&
operator|~
literal|0x7f00
argument_list|,
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_woff
argument_list|)
expr_stmt|;
else|else
name|disp_min
operator|=
name|PosSub
argument_list|(
name|wc
argument_list|,
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_woff
argument_list|)
expr_stmt|;
if|if
condition|(
name|disp_min
operator|<
literal|0x80
condition|)
block|{
operator|*
name|woffset
operator|=
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_woff
expr_stmt|;
return|return
operator|(
name|fontset
operator|->
name|fs_cset
index|[
name|id
index|]
operator|->
name|cs_id
operator|)
return|;
block|}
block|}
return|return
operator|(
name|_XcwGetWoffset
argument_list|(
name|wc
argument_list|,
name|woffset
argument_list|)
operator|)
return|;
undef|#
directive|undef
name|PosSub
block|}
end_function

begin_function
specifier|static
name|void
name|SetISOinfo
parameter_list|(
name|isoinfo
parameter_list|,
name|id
parameter_list|)
name|ISOStateInfo
modifier|*
name|isoinfo
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
block|{
name|ISORegisterState
modifier|*
name|ptr
decl_stmt|;
name|ptr
operator|=
name|ISOStateTable
operator|+
name|id
expr_stmt|;
name|isoinfo
operator|->
name|code_bytes
operator|=
name|ptr
operator|->
name|state_length
expr_stmt|;
if|if
condition|(
name|ptr
operator|->
name|C94orC96
operator|==
name|C96
condition|)
block|{
name|isoinfo
operator|->
name|code_min
operator|=
literal|0xa0
expr_stmt|;
name|isoinfo
operator|->
name|code_max
operator|=
literal|0xff
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ptr
operator|->
name|GLorGR
operator|==
name|GL
condition|)
block|{
if|if
condition|(
name|id
operator|==
name|CODESET0
operator|||
operator|!
name|strcmp
argument_list|(
name|ptr
operator|->
name|nstate_encoding
argument_list|,
literal|"\033(J"
argument_list|)
condition|)
comment|/* ISO8859.1 GL  or JISX0201 GL: for SPACE */
name|isoinfo
operator|->
name|code_min
operator|=
literal|0x20
expr_stmt|;
else|else
name|isoinfo
operator|->
name|code_min
operator|=
literal|0x21
expr_stmt|;
name|isoinfo
operator|->
name|code_max
operator|=
literal|0x7e
expr_stmt|;
block|}
else|else
block|{
name|isoinfo
operator|->
name|code_min
operator|=
literal|0xa1
expr_stmt|;
name|isoinfo
operator|->
name|code_max
operator|=
literal|0xfe
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|_XcwGetAll
parameter_list|(
name|xlocale
parameter_list|,
name|wc
parameter_list|,
name|state_encoding
parameter_list|,
name|woffset
parameter_list|,
name|isoinfo
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|wchar
name|wc
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
name|ISOStateInfo
modifier|*
name|isoinfo
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwGetWoffsetFromLocale
argument_list|(
name|xlocale
argument_list|,
name|wc
argument_list|,
name|woffset
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return;
name|ctSetGLorGR
argument_list|(
name|xlocale
argument_list|,
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|GLorGR
argument_list|)
expr_stmt|;
name|ctSetid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
name|SetISOinfo
argument_list|(
name|isoinfo
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|_XcwGetLength
parameter_list|(
name|wc
parameter_list|)
name|wchar
name|wc
decl_stmt|;
block|{
name|wchar
name|woffset
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|_XcwGetWoffset
argument_list|(
name|wc
argument_list|,
operator|&
name|woffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
name|ND
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_length
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|not_use
end_ifdef

begin_function
name|void
name|_XcwGetName
parameter_list|(
name|xlocale
parameter_list|,
name|wc
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|wchar
name|wc
decl_stmt|;
block|{
name|wchar
name|woffset
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
if|if
condition|(
operator|(
name|id
operator|=
name|_XcwGetWoffsetFromLocale
argument_list|(
name|xlocale
argument_list|,
name|wc
argument_list|,
name|woffset
argument_list|)
operator|)
operator|==
name|ND
condition|)
return|return;
if|if
condition|(
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|GLorGR
operator|==
name|GL
condition|)
name|ctSetGLid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
else|else
name|ctSetGRid
argument_list|(
name|xlocale
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|_XcwGetEncoding
parameter_list|(
name|wc
parameter_list|,
name|state_encoding
parameter_list|)
name|wchar
name|wc
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|wchar
name|woffset
decl_stmt|;
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|_XcwGetWoffset
argument_list|(
name|wc
argument_list|,
operator|&
name|woffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
name|ND
condition|)
return|return;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * _XcwCheckDefaultState():  *   check whether the isostate is default encoding, both GL and GR of  *   Latin-1.  *   It will be called by conversion function CT->WC. */
end_comment

begin_function
name|Bool
name|_XcwCheckDefaultState
parameter_list|(
name|xlocale
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|xlocale
operator|->
name|ct_state
operator|&
literal|0xffff
operator|)
operator|==
operator|(
operator|(
name|CODESET1
operator|<<
literal|8
operator|)
operator||
name|CODESET0
operator|)
condition|)
return|return
operator|(
name|True
operator|)
return|;
else|else
return|return
operator|(
name|False
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  *   get items of RegisterTable with the index ct_state. */
end_comment

begin_function
name|Bool
name|_XcwIdCheck
parameter_list|(
name|xlocale
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
block|{
if|if
condition|(
operator|(
name|ctGetGLid
argument_list|(
name|xlocale
argument_list|)
operator|>=
name|ISOStateTableNum
operator|)
operator|||
operator|(
name|ctGetGRid
argument_list|(
name|xlocale
argument_list|)
operator|>=
name|ISOStateTableNum
operator|)
condition|)
return|return
operator|(
name|False
operator|)
return|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwIdGetAll
parameter_list|(
name|xlocale
parameter_list|,
name|woffset
parameter_list|,
name|isoinfo
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
name|ISOStateInfo
modifier|*
name|isoinfo
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|>=
name|ISOStateTableNum
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
name|SetISOinfo
argument_list|(
name|isoinfo
argument_list|,
name|id
argument_list|)
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|int
name|_XcwIdGetLength
parameter_list|(
name|xlocale
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|>=
name|ISOStateTableNum
condition|)
return|return
operator|(
name|False
operator|)
return|;
return|return
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_length
return|;
block|}
end_function

begin_function
name|Bool
name|_XcwIdGetEncoding
parameter_list|(
name|xlocale
parameter_list|,
name|state_encoding
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|>=
name|ISOStateTableNum
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|state_encoding
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_encoding
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_function
name|void
name|_XcwGetDefaultEncoding
parameter_list|(
name|xlocale
parameter_list|,
name|state_encoding
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|char
modifier|*
name|state_encoding
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
operator|*
name|state_encoding
operator|=
literal|0
expr_stmt|;
name|id
operator|=
name|ctGetGLid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|<
name|ISOStateTableNum
operator|&&
name|id
operator|!=
literal|0
condition|)
comment|/* GL is not ISO8859.1 */
name|strcpy
argument_list|(
name|state_encoding
argument_list|,
name|ISOStateTable
index|[
literal|0
index|]
operator|.
name|nstate_encoding
argument_list|)
expr_stmt|;
name|id
operator|=
name|ctGetGRid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|<
name|ISOStateTableNum
operator|&&
name|id
operator|!=
literal|1
condition|)
comment|/* GR is not ISO8859.1 */
name|strcat
argument_list|(
name|state_encoding
argument_list|,
name|ISOStateTable
index|[
literal|1
index|]
operator|.
name|nstate_encoding
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|Bool
name|_XcwIdGetWoffset
parameter_list|(
name|xlocale
parameter_list|,
name|woffset
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|wchar
modifier|*
name|woffset
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|>=
name|ISOStateTableNum
condition|)
return|return
operator|(
name|False
operator|)
return|;
operator|*
name|woffset
operator|=
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|state_woffset
expr_stmt|;
return|return
operator|(
name|True
operator|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|not_use
end_ifdef

begin_function
name|char
modifier|*
name|_XcwIdGetName
parameter_list|(
name|xlocale
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
block|{
name|_CSID
name|id
decl_stmt|;
name|id
operator|=
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|>=
name|ISOStateTableNum
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|ISOStateTable
index|[
name|id
index|]
operator|.
name|nstate_name
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|void
name|_XcwIdGetISOState
parameter_list|(
name|xlocale
parameter_list|,
name|isoinfo
parameter_list|)
name|XLocale
name|xlocale
decl_stmt|;
name|ISOStateInfo
modifier|*
name|isoinfo
decl_stmt|;
block|{
name|SetISOinfo
argument_list|(
name|isoinfo
argument_list|,
name|ctGetid
argument_list|(
name|xlocale
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

