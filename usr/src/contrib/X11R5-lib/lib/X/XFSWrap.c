begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XFSWrap.c,v 11.6 91/06/05 08:53:49 rws Exp $  */
end_comment

begin_comment
comment|/*  * Copyright 1991 by the Massachusetts Institute of Technology  * Copyright 1991 by the Open Software Foundation  *  * Permission to use, copy, modify, distribute, and sell this software and its  * documentation for any purpose is hereby granted without fee, provided that  * the above copyright notice appear in all copies and that both that  * copyright notice and this permission notice appear in supporting  * documentation, and that the names of Open Software Foundation and M.I.T.  * not be used in advertising or publicity pertaining to distribution of the  * software without specific, written prior permission.  Open Software  * Foundation and M.I.T. make no representations about the suitability of this  * software for any purpose.  It is provided "as is" without express or  * implied warranty.  *  * OPEN SOFTWARE FOUNDATION AND M.I.T. DISCLAIM ALL WARRANTIES WITH REGARD TO  * THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND  * FITNESS, IN NO EVENT SHALL OPEN SOFTWARE FOUNDATIONN OR M.I.T. BE  * LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES   * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN  * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF  * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  *   *		 M. Collins		OSF    */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xlcint.h"
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_define
define|#
directive|define
name|MAXLIST
value|256
end_define

begin_function
name|char
modifier|*
modifier|*
name|_XParseBaseFontNameList
parameter_list|(
name|str
parameter_list|,
name|num
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
name|int
modifier|*
name|num
decl_stmt|;
block|{
name|char
modifier|*
name|plist
index|[
name|MAXLIST
index|]
decl_stmt|;
name|char
modifier|*
modifier|*
name|list
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
operator|*
name|num
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|str
operator|||
operator|!
operator|*
name|str
condition|)
block|{
return|return
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
return|;
block|}
while|while
condition|(
operator|*
name|str
operator|&&
name|isspace
argument_list|(
operator|*
name|str
argument_list|)
condition|)
name|str
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|str
condition|)
return|return
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
return|;
if|if
condition|(
operator|!
operator|(
name|ptr
operator|=
name|Xmalloc
argument_list|(
operator|(
name|unsigned
operator|)
name|strlen
argument_list|(
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
condition|)
block|{
return|return
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
return|;
block|}
name|strcpy
argument_list|(
name|ptr
argument_list|,
name|str
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|char
modifier|*
name|back
decl_stmt|;
name|plist
index|[
operator|*
name|num
index|]
operator|=
name|ptr
expr_stmt|;
if|if
condition|(
operator|(
name|ptr
operator|=
name|index
argument_list|(
name|ptr
argument_list|,
literal|','
argument_list|)
operator|)
condition|)
block|{
name|back
operator|=
name|ptr
expr_stmt|;
block|}
else|else
block|{
name|back
operator|=
name|plist
index|[
operator|*
name|num
index|]
operator|+
name|strlen
argument_list|(
name|plist
index|[
operator|*
name|num
index|]
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|isspace
argument_list|(
operator|*
operator|(
name|back
operator|-
literal|1
operator|)
argument_list|)
condition|)
name|back
operator|--
expr_stmt|;
operator|*
name|back
operator|=
literal|'\0'
expr_stmt|;
operator|(
operator|*
name|num
operator|)
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|ptr
condition|)
break|break;
name|ptr
operator|++
expr_stmt|;
while|while
condition|(
operator|*
name|ptr
operator|&&
name|isspace
argument_list|(
operator|*
name|ptr
argument_list|)
condition|)
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|ptr
condition|)
break|break;
block|}
if|if
condition|(
operator|!
operator|(
name|list
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|Xmalloc
argument_list|(
operator|(
name|unsigned
operator|)
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
operator|(
operator|*
name|num
operator|+
literal|1
operator|)
argument_list|)
operator|)
condition|)
block|{
name|Xfree
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
return|return
operator|(
name|char
operator|*
operator|*
operator|)
name|NULL
return|;
block|}
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|plist
argument_list|,
operator|(
name|char
operator|*
operator|)
name|list
argument_list|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
operator|(
operator|*
name|num
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|list
operator|+
operator|*
name|num
operator|)
operator|=
name|NULL
expr_stmt|;
return|return
name|list
return|;
block|}
end_function

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_function
name|XFontSet
name|XCreateFontSet
parameter_list|(
name|Display
modifier|*
name|dpy
parameter_list|,
name|_Xconst
name|char
modifier|*
name|base_font_name_list
parameter_list|,
name|char
modifier|*
modifier|*
modifier|*
name|missing_charset_list
parameter_list|,
name|int
modifier|*
name|missing_charset_count
parameter_list|,
name|char
modifier|*
modifier|*
name|def_string
parameter_list|)
else|#
directive|else
function|XFontSet XCreateFontSet
parameter_list|(
name|dpy
parameter_list|,
name|base_font_name_list
parameter_list|,
name|missing_charset_list
parameter_list|,
name|missing_charset_count
parameter_list|,
name|def_string
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|char
modifier|*
name|base_font_name_list
decl_stmt|;
name|char
modifier|*
modifier|*
modifier|*
name|missing_charset_list
decl_stmt|;
name|int
modifier|*
name|missing_charset_count
decl_stmt|;
name|char
modifier|*
modifier|*
name|def_string
decl_stmt|;
endif|#
directive|endif
block|{
name|XLCd
name|lcd
init|=
name|_XlcCurrentLC
argument_list|()
decl_stmt|;
name|char
modifier|*
name|base_name
decl_stmt|;
name|char
modifier|*
modifier|*
name|name_list
decl_stmt|;
name|int
name|count
decl_stmt|;
name|XFontSet
name|font_set
decl_stmt|;
operator|*
name|missing_charset_list
operator|=
name|NULL
expr_stmt|;
operator|*
name|missing_charset_count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|lcd
condition|)
return|return
name|NULL
return|;
name|base_name
operator|=
operator|(
name|char
operator|*
operator|)
name|Xmalloc
argument_list|(
name|strlen
argument_list|(
name|base_font_name_list
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|base_name
condition|)
return|return
name|NULL
return|;
name|strcpy
argument_list|(
name|base_name
argument_list|,
name|base_font_name_list
argument_list|)
expr_stmt|;
name|name_list
operator|=
name|_XParseBaseFontNameList
argument_list|(
name|base_name
argument_list|,
operator|&
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|name_list
condition|)
block|{
name|Xfree
argument_list|(
name|base_name
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|font_set
operator|=
call|(
modifier|*
name|lcd
operator|->
name|methods
operator|->
name|create_fontset
call|)
argument_list|(
name|lcd
argument_list|,
name|dpy
argument_list|,
name|base_name
argument_list|,
name|name_list
argument_list|,
name|count
argument_list|,
name|missing_charset_list
argument_list|,
name|missing_charset_count
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|font_set
condition|)
block|{
name|XFreeStringList
argument_list|(
name|name_list
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
name|base_name
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|def_string
condition|)
block|{
operator|*
name|def_string
operator|=
name|font_set
operator|->
name|core
operator|.
name|default_string
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|def_string
condition|)
operator|*
name|def_string
operator|=
literal|""
expr_stmt|;
block|}
return|return
name|font_set
return|;
block|}
end_function

begin_function
name|int
name|XFontsOfFontSet
parameter_list|(
name|font_set
parameter_list|,
name|font_struct_list
parameter_list|,
name|font_name_list
parameter_list|)
name|XFontSet
name|font_set
decl_stmt|;
name|XFontStruct
modifier|*
modifier|*
modifier|*
name|font_struct_list
decl_stmt|;
name|char
modifier|*
modifier|*
modifier|*
name|font_name_list
decl_stmt|;
block|{
operator|*
name|font_name_list
operator|=
name|font_set
operator|->
name|core
operator|.
name|font_name_list
expr_stmt|;
operator|*
name|font_struct_list
operator|=
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
expr_stmt|;
return|return
name|font_set
operator|->
name|core
operator|.
name|num_of_fonts
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|XBaseFontNameListOfFontSet
parameter_list|(
name|font_set
parameter_list|)
name|XFontSet
name|font_set
decl_stmt|;
block|{
return|return
name|font_set
operator|->
name|core
operator|.
name|base_name_list
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|XLocaleOfFontSet
parameter_list|(
name|font_set
parameter_list|)
name|XFontSet
name|font_set
decl_stmt|;
block|{
return|return
name|font_set
operator|->
name|core
operator|.
name|lcd
operator|->
name|core
operator|.
name|name
return|;
block|}
end_function

begin_function
specifier|extern
name|Bool
name|XContextDependentDrawing
parameter_list|(
name|font_set
parameter_list|)
name|XFontSet
name|font_set
decl_stmt|;
block|{
return|return
name|font_set
operator|->
name|core
operator|.
name|context_dependent
return|;
block|}
end_function

begin_function
name|XFontSetExtents
modifier|*
name|XExtentsOfFontSet
parameter_list|(
name|font_set
parameter_list|)
name|XFontSet
name|font_set
decl_stmt|;
block|{
return|return
operator|&
name|font_set
operator|->
name|core
operator|.
name|font_set_extents
return|;
block|}
end_function

begin_function
name|void
name|XFreeFontSet
parameter_list|(
name|dpy
parameter_list|,
name|font_set
parameter_list|)
name|Display
modifier|*
name|dpy
decl_stmt|;
name|XFontSet
name|font_set
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
call|(
modifier|*
name|font_set
operator|->
name|methods
operator|->
name|free
call|)
argument_list|(
name|dpy
argument_list|,
name|font_set
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|font_set
operator|->
name|core
operator|.
name|num_of_fonts
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
index|[
name|i
index|]
operator|->
name|fid
condition|)
name|XFreeFont
argument_list|(
name|dpy
argument_list|,
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|font_set
operator|->
name|core
operator|.
name|font_struct_list
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
name|font_set
operator|->
name|core
operator|.
name|base_name_list
argument_list|)
expr_stmt|;
name|XFreeStringList
argument_list|(
name|font_set
operator|->
name|core
operator|.
name|font_name_list
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|font_set
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

