begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XStBytes.c,v 11.20 91/01/08 14:41:56 gildea Exp $ */
end_comment

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1986	*/
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_comment
comment|/* insulate predefined atom numbers from cut routines */
end_comment

begin_decl_stmt
specifier|static
name|Atom
name|n_to_atom
index|[
literal|8
index|]
init|=
block|{
name|XA_CUT_BUFFER0
block|,
name|XA_CUT_BUFFER1
block|,
name|XA_CUT_BUFFER2
block|,
name|XA_CUT_BUFFER3
block|,
name|XA_CUT_BUFFER4
block|,
name|XA_CUT_BUFFER5
block|,
name|XA_CUT_BUFFER6
block|,
name|XA_CUT_BUFFER7
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|XRotateBuffers
argument_list|(
name|dpy
argument_list|,
name|rotate
argument_list|)
specifier|register
name|Display
operator|*
name|dpy
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|rotate
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XRotateWindowProperties
argument_list|(
name|dpy
argument_list|,
name|RootWindow
argument_list|(
name|dpy
argument_list|,
literal|0
argument_list|)
argument_list|,
name|n_to_atom
argument_list|,
literal|8
argument_list|,
name|rotate
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|char
modifier|*
name|XFetchBuffer
parameter_list|(
name|dpy
parameter_list|,
name|nbytes
parameter_list|,
name|buffer
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|int
modifier|*
name|nbytes
decl_stmt|;
specifier|register
name|int
name|buffer
decl_stmt|;
block|{
name|Atom
name|actual_type
decl_stmt|;
name|int
name|actual_format
decl_stmt|;
name|unsigned
name|long
name|nitems
decl_stmt|;
name|unsigned
name|long
name|leftover
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
operator|*
name|nbytes
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|buffer
operator|<
literal|0
operator|)
operator|||
operator|(
name|buffer
operator|>
literal|7
operator|)
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* XXX should be (sizeof (maxint) - 1)/4 */
if|if
condition|(
name|XGetWindowProperty
argument_list|(
name|dpy
argument_list|,
name|RootWindow
argument_list|(
name|dpy
argument_list|,
literal|0
argument_list|)
argument_list|,
name|n_to_atom
index|[
name|buffer
index|]
argument_list|,
literal|0L
argument_list|,
literal|10000000L
argument_list|,
name|False
argument_list|,
name|XA_STRING
argument_list|,
operator|&
name|actual_type
argument_list|,
operator|&
name|actual_format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|leftover
argument_list|,
operator|&
name|data
argument_list|)
operator|!=
name|Success
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|actual_type
operator|==
name|XA_STRING
operator|)
operator|&&
operator|(
name|actual_format
operator|!=
literal|32
operator|)
condition|)
block|{
operator|*
name|nbytes
operator|=
name|nitems
expr_stmt|;
return|return
operator|(
operator|(
name|char
operator|*
operator|)
name|data
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|char
operator|*
operator|)
name|data
operator|!=
name|NULL
condition|)
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|XFetchBytes
parameter_list|(
name|dpy
parameter_list|,
name|nbytes
parameter_list|)
specifier|register
name|Display
modifier|*
name|dpy
decl_stmt|;
name|int
modifier|*
name|nbytes
decl_stmt|;
block|{
return|return
operator|(
name|XFetchBuffer
argument_list|(
name|dpy
argument_list|,
name|nbytes
argument_list|,
literal|0
argument_list|)
operator|)
return|;
block|}
end_function

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_macro
name|XStoreBuffer
argument_list|(
argument|register Display *dpy
argument_list|,
argument|_Xconst char *bytes
argument_list|,
argument|int nbytes
argument_list|,
argument|register int buffer
argument_list|)
end_macro

begin_else
else|#
directive|else
end_else

begin_expr_stmt
name|XStoreBuffer
argument_list|(
name|dpy
argument_list|,
name|bytes
argument_list|,
name|nbytes
argument_list|,
name|buffer
argument_list|)
specifier|register
name|Display
operator|*
name|dpy
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|char
modifier|*
name|bytes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nbytes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|buffer
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
if|if
condition|(
operator|(
name|buffer
operator|<
literal|0
operator|)
operator|||
operator|(
name|buffer
operator|>
literal|7
operator|)
condition|)
return|return;
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|RootWindow
argument_list|(
name|dpy
argument_list|,
literal|0
argument_list|)
argument_list|,
name|n_to_atom
index|[
name|buffer
index|]
argument_list|,
name|XA_STRING
argument_list|,
literal|8
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|bytes
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
block|}
end_block

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_macro
name|XStoreBytes
argument_list|(
argument|register Display *dpy
argument_list|,
argument|_Xconst char *bytes
argument_list|,
argument|int nbytes
argument_list|)
end_macro

begin_else
else|#
directive|else
end_else

begin_expr_stmt
name|XStoreBytes
argument_list|(
name|dpy
argument_list|,
name|bytes
argument_list|,
name|nbytes
argument_list|)
specifier|register
name|Display
operator|*
name|dpy
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|char
modifier|*
name|bytes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nbytes
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
name|XStoreBuffer
argument_list|(
name|dpy
argument_list|,
name|bytes
argument_list|,
name|nbytes
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

