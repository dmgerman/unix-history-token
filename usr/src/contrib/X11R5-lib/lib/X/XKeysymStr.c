begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XKeysymStr.c,v 11.7 91/05/04 14:03:22 rws Exp $ */
end_comment

begin_comment
comment|/* Copyright 1990 Massachusetts Institute of Technology */
end_comment

begin_comment
comment|/* Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of M.I.T. not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.  M.I.T. makes no representations about the suitability of this software for any purpose.  It is provided "as is" without express or implied warranty. */
end_comment

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xresource.h>
end_include

begin_include
include|#
directive|include
file|<X11/keysymdef.h>
end_include

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_typedef
typedef|typedef
name|unsigned
name|long
name|Signature
typedef|;
end_typedef

begin_define
define|#
directive|define
name|NEEDVTABLE
end_define

begin_include
include|#
directive|include
file|"ks_tables.h"
end_include

begin_function_decl
specifier|extern
name|XrmDatabase
name|_XInitKeysymDB
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|Const
name|unsigned
name|char
name|_XkeyTable
index|[]
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
name|_GRNData
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|XrmRepresentation
name|type
decl_stmt|;
name|XrmValuePtr
name|value
decl_stmt|;
block|}
name|GRNData
typedef|;
end_typedef

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|Bool
name|SameValue
parameter_list|(
name|db
parameter_list|,
name|bindings
parameter_list|,
name|quarks
parameter_list|,
name|type
parameter_list|,
name|value
parameter_list|,
name|data
parameter_list|)
name|XrmDatabase
modifier|*
name|db
decl_stmt|;
name|XrmBindingList
name|bindings
decl_stmt|;
name|XrmQuarkList
name|quarks
decl_stmt|;
name|XrmRepresentation
modifier|*
name|type
decl_stmt|;
name|XrmValuePtr
name|value
decl_stmt|;
name|XPointer
name|data
decl_stmt|;
block|{
name|GRNData
modifier|*
name|gd
init|=
operator|(
name|GRNData
operator|*
operator|)
name|data
decl_stmt|;
if|if
condition|(
operator|(
operator|*
name|type
operator|==
name|gd
operator|->
name|type
operator|)
operator|&&
operator|(
name|value
operator|->
name|size
operator|==
name|gd
operator|->
name|value
operator|->
name|size
operator|)
operator|&&
operator|!
name|strncmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|value
operator|->
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
name|gd
operator|->
name|value
operator|->
name|addr
argument_list|,
name|value
operator|->
name|size
argument_list|)
condition|)
block|{
name|gd
operator|->
name|name
operator|=
name|XrmQuarkToString
argument_list|(
operator|*
name|quarks
argument_list|)
expr_stmt|;
comment|/* XXX */
return|return
name|True
return|;
block|}
return|return
name|False
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|XKeysymToString
parameter_list|(
name|ks
parameter_list|)
name|KeySym
name|ks
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|,
name|n
decl_stmt|;
name|int
name|h
decl_stmt|;
specifier|register
name|int
name|idx
decl_stmt|;
name|Const
name|unsigned
name|char
modifier|*
name|entry
decl_stmt|;
name|unsigned
name|char
name|val1
decl_stmt|,
name|val2
decl_stmt|;
name|XrmDatabase
name|keysymdb
decl_stmt|;
if|if
condition|(
operator|!
name|ks
condition|)
return|return
operator|(
operator|(
name|char
operator|*
operator|)
name|NULL
operator|)
return|;
if|if
condition|(
name|ks
operator|==
name|XK_VoidSymbol
condition|)
name|ks
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|ks
operator|<=
literal|0xffff
condition|)
block|{
name|val1
operator|=
name|ks
operator|>>
literal|8
expr_stmt|;
name|val2
operator|=
name|ks
operator|&
literal|0xff
expr_stmt|;
name|i
operator|=
name|ks
operator|%
name|VTABLESIZE
expr_stmt|;
name|h
operator|=
name|i
operator|+
literal|1
expr_stmt|;
name|n
operator|=
name|VMAXHASH
expr_stmt|;
while|while
condition|(
name|idx
operator|=
name|hashKeysym
index|[
name|i
index|]
condition|)
block|{
name|entry
operator|=
operator|&
name|_XkeyTable
index|[
name|idx
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|entry
index|[
literal|0
index|]
operator|==
name|val1
operator|)
operator|&&
operator|(
name|entry
index|[
literal|1
index|]
operator|==
name|val2
operator|)
condition|)
return|return
operator|(
operator|(
name|char
operator|*
operator|)
name|entry
operator|+
literal|2
operator|)
return|;
if|if
condition|(
operator|!
operator|--
name|n
condition|)
break|break;
name|i
operator|+=
name|h
expr_stmt|;
if|if
condition|(
name|i
operator|>=
name|VTABLESIZE
condition|)
name|i
operator|-=
name|VTABLESIZE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|keysymdb
operator|=
name|_XInitKeysymDB
argument_list|()
condition|)
block|{
name|char
name|buf
index|[
literal|9
index|]
decl_stmt|;
name|XrmValue
name|resval
decl_stmt|;
name|XrmQuark
name|empty
init|=
name|NULLQUARK
decl_stmt|;
name|GRNData
name|data
decl_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%lX"
argument_list|,
name|ks
argument_list|)
expr_stmt|;
name|resval
operator|.
name|addr
operator|=
operator|(
name|XPointer
operator|)
name|buf
expr_stmt|;
name|resval
operator|.
name|size
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
operator|+
literal|1
expr_stmt|;
name|data
operator|.
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|NULL
expr_stmt|;
name|data
operator|.
name|type
operator|=
name|XrmPermStringToQuark
argument_list|(
literal|"String"
argument_list|)
expr_stmt|;
name|data
operator|.
name|value
operator|=
operator|&
name|resval
expr_stmt|;
operator|(
name|void
operator|)
name|XrmEnumerateDatabase
argument_list|(
name|keysymdb
argument_list|,
operator|&
name|empty
argument_list|,
operator|&
name|empty
argument_list|,
name|XrmEnumAllLevels
argument_list|,
name|SameValue
argument_list|,
operator|(
name|XPointer
operator|)
operator|&
name|data
argument_list|)
expr_stmt|;
return|return
name|data
operator|.
name|name
return|;
block|}
return|return
operator|(
operator|(
name|char
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
end_function

end_unit

