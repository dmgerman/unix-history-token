begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * $XConsortium: XFilterEv.c,v 1.8 91/06/05 09:15:44 rws Exp $  */
end_comment

begin_comment
comment|/*   * Copyright 1990, 1991 by OMRON Corporation   * Copyright 1991 by the Massachusetts Institute of Technology   *   * Permission to use, copy, modify, distribute, and sell this software and its   * documentation for any purpose is hereby granted without fee, provided that   * the above copyright notice appear in all copies and that both that   * copyright notice and this permission notice appear in supporting   * documentation, and that the names of OMRON and MIT not be used in   * advertising or publicity pertaining to distribution of the software without   * specific, written prior permission.  OMRON and MIT make no representations   * about the suitability of this software for any purpose.  It is provided   * "as is" without express or implied warranty.   *   * OMRON AND MIT DISCLAIM ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,   * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO   * EVENT SHALL OMRON OR MIT BE LIABLE FOR ANY SPECIAL, INDIRECT OR   * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,   * DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER   * TORTUOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR   * PERFORMANCE OF THIS SOFTWARE.    *   *	Author:	Seiji Kuwari	OMRON Corporation   *				kuwa@omron.co.jp   *				kuwa%omron.co.jp@uunet.uu.net   */
end_comment

begin_define
define|#
directive|define
name|NEED_EVENTS
end_define

begin_include
include|#
directive|include
file|"Xlibint.h"
end_include

begin_include
include|#
directive|include
file|"Xlcint.h"
end_include

begin_if
if|#
directive|if
name|__STDC__
end_if

begin_define
define|#
directive|define
name|Const
value|const
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|Const
end_define

begin_comment
comment|/**/
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|long
name|Const
name|_Xevent_to_mask
index|[]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Look up if there is a specified filter for the event.  */
end_comment

begin_function
name|Bool
name|XFilterEvent
parameter_list|(
name|ev
parameter_list|,
name|window
parameter_list|)
name|XEvent
modifier|*
name|ev
decl_stmt|;
name|Window
name|window
decl_stmt|;
block|{
name|XFilterEventList
name|p
decl_stmt|;
name|Window
name|win
decl_stmt|;
name|long
name|mask
decl_stmt|;
name|Bool
name|ret
decl_stmt|;
if|if
condition|(
name|window
condition|)
name|win
operator|=
name|window
expr_stmt|;
else|else
name|win
operator|=
name|ev
operator|->
name|xany
operator|.
name|window
expr_stmt|;
if|if
condition|(
name|ev
operator|->
name|type
operator|>=
name|LASTEvent
condition|)
name|mask
operator|=
literal|0
expr_stmt|;
else|else
name|mask
operator|=
name|_Xevent_to_mask
index|[
name|ev
operator|->
name|type
index|]
expr_stmt|;
name|LockDisplay
argument_list|(
name|ev
operator|->
name|xany
operator|.
name|display
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|ev
operator|->
name|xany
operator|.
name|display
operator|->
name|im_filters
init|;
name|p
operator|!=
name|NULL
condition|;
name|p
operator|=
name|p
operator|->
name|next
control|)
block|{
if|if
condition|(
name|win
operator|==
name|p
operator|->
name|window
condition|)
block|{
if|if
condition|(
operator|(
name|mask
operator|&
name|p
operator|->
name|event_mask
operator|)
operator|||
operator|(
name|ev
operator|->
name|type
operator|>=
name|p
operator|->
name|start_type
operator|&&
name|ev
operator|->
name|type
operator|<=
name|p
operator|->
name|end_type
operator|)
condition|)
block|{
name|ret
operator|=
operator|(
operator|*
operator|(
name|p
operator|->
name|filter
operator|)
operator|)
operator|(
name|ev
operator|->
name|xany
operator|.
name|display
operator|,
name|p
operator|->
name|window
operator|,
name|ev
operator|,
name|p
operator|->
name|client_data
operator|)
expr_stmt|;
name|UnlockDisplay
argument_list|(
name|ev
operator|->
name|xany
operator|.
name|display
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
block|}
block|}
name|UnlockDisplay
argument_list|(
name|ev
operator|->
name|xany
operator|.
name|display
argument_list|)
expr_stmt|;
return|return
operator|(
name|False
operator|)
return|;
block|}
end_function

end_unit

