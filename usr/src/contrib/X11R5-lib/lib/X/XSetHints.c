begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $XConsortium: XSetHints.c,v 11.38 91/01/08 14:41:39 gildea Exp $ */
end_comment

begin_comment
comment|/*********************************************************** Copyright 1987 by Digital Equipment Corporation, Maynard, Massachusetts, and the Massachusetts Institute of Technology, Cambridge, Massachusetts.                          All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the names of Digital or MIT not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    DIGITAL DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DIGITAL BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_include
include|#
directive|include
file|<X11/Xlibint.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xutil.h>
end_include

begin_include
include|#
directive|include
file|"Xatomtype.h"
end_include

begin_include
include|#
directive|include
file|<X11/Xatom.h>
end_include

begin_include
include|#
directive|include
file|<X11/Xos.h>
end_include

begin_define
define|#
directive|define
name|safestrlen
parameter_list|(
name|s
parameter_list|)
value|((s) ? strlen(s) : 0)
end_define

begin_macro
name|XSetSizeHints
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|hints
argument_list|,
argument|property
argument_list|)
end_macro

begin_comment
comment|/* old routine */
end_comment

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Atom
name|property
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|xPropSizeHints
name|prop
decl_stmt|;
name|prop
operator|.
name|flags
operator|=
operator|(
name|hints
operator|->
name|flags
operator|&
operator|(
name|USPosition
operator||
name|USSize
operator||
name|PAllHints
operator|)
operator|)
expr_stmt|;
name|prop
operator|.
name|x
operator|=
name|hints
operator|->
name|x
expr_stmt|;
name|prop
operator|.
name|y
operator|=
name|hints
operator|->
name|y
expr_stmt|;
name|prop
operator|.
name|width
operator|=
name|hints
operator|->
name|width
expr_stmt|;
name|prop
operator|.
name|height
operator|=
name|hints
operator|->
name|height
expr_stmt|;
name|prop
operator|.
name|minWidth
operator|=
name|hints
operator|->
name|min_width
expr_stmt|;
name|prop
operator|.
name|minHeight
operator|=
name|hints
operator|->
name|min_height
expr_stmt|;
name|prop
operator|.
name|maxWidth
operator|=
name|hints
operator|->
name|max_width
expr_stmt|;
name|prop
operator|.
name|maxHeight
operator|=
name|hints
operator|->
name|max_height
expr_stmt|;
name|prop
operator|.
name|widthInc
operator|=
name|hints
operator|->
name|width_inc
expr_stmt|;
name|prop
operator|.
name|heightInc
operator|=
name|hints
operator|->
name|height_inc
expr_stmt|;
name|prop
operator|.
name|minAspectX
operator|=
name|hints
operator|->
name|min_aspect
operator|.
name|x
expr_stmt|;
name|prop
operator|.
name|minAspectY
operator|=
name|hints
operator|->
name|min_aspect
operator|.
name|y
expr_stmt|;
name|prop
operator|.
name|maxAspectX
operator|=
name|hints
operator|->
name|max_aspect
operator|.
name|x
expr_stmt|;
name|prop
operator|.
name|maxAspectY
operator|=
name|hints
operator|->
name|max_aspect
operator|.
name|y
expr_stmt|;
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|property
argument_list|,
name|XA_WM_SIZE_HINTS
argument_list|,
literal|32
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|prop
argument_list|,
name|OldNumPropSizeElements
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*   * XSetWMHints sets the property   *	WM_HINTS 	type: WM_HINTS	format:32  */
end_comment

begin_macro
name|XSetWMHints
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|wmhints
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XWMHints
modifier|*
name|wmhints
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|xPropWMHints
name|prop
decl_stmt|;
name|prop
operator|.
name|flags
operator|=
name|wmhints
operator|->
name|flags
expr_stmt|;
name|prop
operator|.
name|input
operator|=
operator|(
name|wmhints
operator|->
name|input
operator|==
name|True
condition|?
literal|1
else|:
literal|0
operator|)
expr_stmt|;
name|prop
operator|.
name|initialState
operator|=
name|wmhints
operator|->
name|initial_state
expr_stmt|;
name|prop
operator|.
name|iconPixmap
operator|=
name|wmhints
operator|->
name|icon_pixmap
expr_stmt|;
name|prop
operator|.
name|iconWindow
operator|=
name|wmhints
operator|->
name|icon_window
expr_stmt|;
name|prop
operator|.
name|iconX
operator|=
name|wmhints
operator|->
name|icon_x
expr_stmt|;
name|prop
operator|.
name|iconY
operator|=
name|wmhints
operator|->
name|icon_y
expr_stmt|;
name|prop
operator|.
name|iconMask
operator|=
name|wmhints
operator|->
name|icon_mask
expr_stmt|;
name|prop
operator|.
name|windowGroup
operator|=
name|wmhints
operator|->
name|window_group
expr_stmt|;
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_HINTS
argument_list|,
name|XA_WM_HINTS
argument_list|,
literal|32
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|prop
argument_list|,
name|NumPropWMHintsElements
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*   * XSetZoomHints sets the property   *	WM_ZOOM_HINTS 	type: WM_SIZE_HINTS format: 32  */
end_comment

begin_macro
name|XSetZoomHints
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|zhints
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XSizeHints
modifier|*
name|zhints
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XSetSizeHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|zhints
argument_list|,
name|XA_WM_ZOOM_HINTS
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*   * XSetNormalHints sets the property   *	WM_NORMAL_HINTS 	type: WM_SIZE_HINTS format: 32  */
end_comment

begin_macro
name|XSetNormalHints
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|hints
argument_list|)
end_macro

begin_comment
comment|/* old routine */
end_comment

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XSetSizeHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|hints
argument_list|,
name|XA_WM_NORMAL_HINTS
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Note, the following is one of the few cases were we really do want sizeof  * when examining a protocol structure.  This is because the XChangeProperty  * routine will take care of converting to host to network data structures.  */
end_comment

begin_macro
name|XSetIconSizes
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|list
argument_list|,
argument|count
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* typically, root */
end_comment

begin_decl_stmt
name|XIconSize
modifier|*
name|list
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* number of items on the list */
end_comment

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
name|xPropIconSize
modifier|*
name|pp
decl_stmt|,
modifier|*
name|prop
decl_stmt|;
define|#
directive|define
name|size_of_the_real_thing
value|sizeof
comment|/* avoid grepping screwups */
name|unsigned
name|nbytes
init|=
name|count
operator|*
name|size_of_the_real_thing
argument_list|(
name|xPropIconSize
argument_list|)
decl_stmt|;
undef|#
directive|undef
name|size_of_the_real_thing
if|if
condition|(
name|prop
operator|=
name|pp
operator|=
operator|(
name|xPropIconSize
operator|*
operator|)
name|Xmalloc
argument_list|(
name|nbytes
argument_list|)
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
block|{
name|pp
operator|->
name|minWidth
operator|=
name|list
operator|->
name|min_width
expr_stmt|;
name|pp
operator|->
name|minHeight
operator|=
name|list
operator|->
name|min_height
expr_stmt|;
name|pp
operator|->
name|maxWidth
operator|=
name|list
operator|->
name|max_width
expr_stmt|;
name|pp
operator|->
name|maxHeight
operator|=
name|list
operator|->
name|max_height
expr_stmt|;
name|pp
operator|->
name|widthInc
operator|=
name|list
operator|->
name|width_inc
expr_stmt|;
name|pp
operator|->
name|heightInc
operator|=
name|list
operator|->
name|height_inc
expr_stmt|;
name|pp
operator|+=
literal|1
expr_stmt|;
name|list
operator|+=
literal|1
expr_stmt|;
block|}
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_ICON_SIZE
argument_list|,
name|XA_WM_ICON_SIZE
argument_list|,
literal|32
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|prop
argument_list|,
name|count
operator|*
name|NumPropIconSizeElements
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
operator|(
name|char
operator|*
operator|)
name|prop
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|XSetCommand
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|argv
argument_list|,
argument|argc
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|int
name|nbytes
decl_stmt|;
specifier|register
name|char
modifier|*
name|buf
decl_stmt|,
modifier|*
name|bp
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|nbytes
operator|=
literal|0
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|nbytes
operator|+=
name|safestrlen
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|bp
operator|=
name|buf
operator|=
name|Xmalloc
argument_list|(
operator|(
name|unsigned
operator|)
name|nbytes
argument_list|)
condition|)
block|{
comment|/* copy arguments into single buffer */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|argv
index|[
name|i
index|]
condition|)
block|{
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|bp
argument_list|,
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
else|else
operator|*
name|bp
operator|++
operator|=
literal|'\0'
expr_stmt|;
block|}
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_COMMAND
argument_list|,
name|XA_STRING
argument_list|,
literal|8
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
argument_list|,
name|nbytes
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*   * XSetStandardProperties sets the following properties:  *	WM_NAME		  type: STRING		format: 8  *	WM_ICON_NAME	  type: STRING		format: 8  *	WM_HINTS	  type: WM_HINTS	format: 32  *	WM_COMMAND	  type: STRING  *	WM_NORMAL_HINTS	  type: WM_SIZE_HINTS 	format: 32  */
end_comment

begin_if
if|#
directive|if
name|NeedFunctionPrototypes
end_if

begin_macro
name|XSetStandardProperties
argument_list|(
argument|Display *dpy
argument_list|,
argument|Window w
argument_list|,
comment|/* window to decorate */
argument|_Xconst char *name
argument_list|,
comment|/* name of application */
argument|_Xconst char *icon_string
argument_list|,
comment|/* name string for icon */
argument|Pixmap icon_pixmap
argument_list|,
comment|/* pixmap to use as icon, or None */
argument|char **argv
argument_list|,
comment|/* command to be used to restart application */
argument|int argc
argument_list|,
comment|/* count of arguments */
argument|XSizeHints *hints
argument_list|)
end_macro

begin_comment
comment|/* size hints for window in its normal state */
end_comment

begin_else
else|#
directive|else
end_else

begin_macro
name|XSetStandardProperties
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|name
argument_list|,
argument|icon_string
argument_list|,
argument|icon_pixmap
argument_list|,
argument|argv
argument_list|,
argument|argc
argument_list|,
argument|hints
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* window to decorate */
end_comment

begin_decl_stmt
name|char
modifier|*
name|name
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* name of application */
end_comment

begin_decl_stmt
name|char
modifier|*
name|icon_string
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* name string for icon */
end_comment

begin_decl_stmt
name|Pixmap
name|icon_pixmap
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* pixmap to use as icon, or None */
end_comment

begin_decl_stmt
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* command to be used to restart application */
end_comment

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* count of arguments */
end_comment

begin_decl_stmt
name|XSizeHints
modifier|*
name|hints
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* size hints for window in its normal state */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_block
block|{
name|XWMHints
name|phints
decl_stmt|;
name|phints
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|name
operator|!=
name|NULL
condition|)
name|XStoreName
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|icon_string
operator|!=
name|NULL
condition|)
block|{
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_ICON_NAME
argument_list|,
name|XA_STRING
argument_list|,
literal|8
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|icon_string
argument_list|,
name|safestrlen
argument_list|(
name|icon_string
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|icon_pixmap
operator|!=
name|None
condition|)
block|{
name|phints
operator|.
name|icon_pixmap
operator|=
name|icon_pixmap
expr_stmt|;
name|phints
operator|.
name|flags
operator||=
name|IconPixmapHint
expr_stmt|;
block|}
if|if
condition|(
name|argv
operator|!=
name|NULL
condition|)
name|XSetCommand
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|argv
argument_list|,
name|argc
argument_list|)
expr_stmt|;
if|if
condition|(
name|hints
operator|!=
name|NULL
condition|)
name|XSetNormalHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|hints
argument_list|)
expr_stmt|;
if|if
condition|(
name|phints
operator|.
name|flags
operator|!=
literal|0
condition|)
name|XSetWMHints
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
operator|&
name|phints
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|XSetTransientForHint
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|propWindow
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|propWindow
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_TRANSIENT_FOR
argument_list|,
name|XA_WINDOW
argument_list|,
literal|32
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|propWindow
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|XSetClassHint
argument_list|(
argument|dpy
argument_list|,
argument|w
argument_list|,
argument|classhint
argument_list|)
end_macro

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|w
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XClassHint
modifier|*
name|classhint
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|class_string
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|len_nm
decl_stmt|,
name|len_cl
decl_stmt|;
name|len_nm
operator|=
name|safestrlen
argument_list|(
name|classhint
operator|->
name|res_name
argument_list|)
expr_stmt|;
name|len_cl
operator|=
name|safestrlen
argument_list|(
name|classhint
operator|->
name|res_class
argument_list|)
expr_stmt|;
if|if
condition|(
name|class_string
operator|=
name|s
operator|=
name|Xmalloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|len_nm
operator|+
name|len_cl
operator|+
literal|2
argument_list|)
argument_list|)
condition|)
block|{
if|if
condition|(
name|len_nm
condition|)
block|{
name|strcpy
argument_list|(
name|s
argument_list|,
name|classhint
operator|->
name|res_name
argument_list|)
expr_stmt|;
name|s
operator|+=
name|len_nm
operator|+
literal|1
expr_stmt|;
block|}
else|else
operator|*
name|s
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|len_cl
condition|)
name|strcpy
argument_list|(
name|s
argument_list|,
name|classhint
operator|->
name|res_class
argument_list|)
expr_stmt|;
else|else
operator|*
name|s
operator|=
literal|'\0'
expr_stmt|;
name|XChangeProperty
argument_list|(
name|dpy
argument_list|,
name|w
argument_list|,
name|XA_WM_CLASS
argument_list|,
name|XA_STRING
argument_list|,
literal|8
argument_list|,
name|PropModeReplace
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|class_string
argument_list|,
name|len_nm
operator|+
name|len_cl
operator|+
literal|2
argument_list|)
expr_stmt|;
name|Xfree
argument_list|(
name|class_string
argument_list|)
expr_stmt|;
block|}
block|}
end_block

end_unit

