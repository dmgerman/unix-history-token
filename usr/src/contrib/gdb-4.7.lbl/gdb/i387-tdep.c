begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Intel 387 floating point stuff.    Copyright (C) 1988, 1989, 1991 Free Software Foundation, Inc.  This file is part of GDB.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"frame.h"
end_include

begin_include
include|#
directive|include
file|"inferior.h"
end_include

begin_include
include|#
directive|include
file|"language.h"
end_include

begin_include
include|#
directive|include
file|"gdbcore.h"
end_include

begin_include
include|#
directive|include
file|"ieee-float.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|USG
end_ifdef

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/dir.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<sys/user.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/reg.h>
end_include

begin_decl_stmt
name|struct
name|ext_format
name|ext_format_i387
init|=
block|{
comment|/* tot sbyte smask expbyte	manbyte */
literal|10
block|,
literal|9
block|,
literal|0x80
block|,
literal|9
block|,
literal|8
block|,
literal|4
block|,
literal|0
comment|/* i387 */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* FIXME:  Eliminate these routines when we have the time to change all    the callers.  */
end_comment

begin_function
name|void
name|i387_to_double
parameter_list|(
name|from
parameter_list|,
name|to
parameter_list|)
name|char
modifier|*
name|from
decl_stmt|;
name|char
modifier|*
name|to
decl_stmt|;
block|{
name|ieee_extended_to_double
argument_list|(
operator|&
name|ext_format_i387
argument_list|,
name|from
argument_list|,
operator|(
name|double
operator|*
operator|)
name|to
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|double_to_i387
parameter_list|(
name|from
parameter_list|,
name|to
parameter_list|)
name|char
modifier|*
name|from
decl_stmt|;
name|char
modifier|*
name|to
decl_stmt|;
block|{
name|double_to_ieee_extended
argument_list|(
operator|&
name|ext_format_i387
argument_list|,
operator|(
name|double
operator|*
operator|)
name|from
argument_list|,
name|to
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_387_control_word
parameter_list|(
name|control
parameter_list|)
name|unsigned
name|int
name|control
decl_stmt|;
block|{
name|printf
argument_list|(
literal|"control %s: "
argument_list|,
name|local_hex_string
argument_list|(
name|control
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"compute to "
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|8
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"24 bits; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"(bad); "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"53 bits; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"64 bits; "
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"round "
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|control
operator|>>
literal|10
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"NEAREST; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"DOWN; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"UP; "
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"CHOP; "
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|control
operator|&
literal|0x3f
condition|)
block|{
name|printf
argument_list|(
literal|"mask:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0001
condition|)
name|printf
argument_list|(
literal|" INVALID"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0002
condition|)
name|printf
argument_list|(
literal|" DENORM"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0004
condition|)
name|printf
argument_list|(
literal|" DIVZ"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0008
condition|)
name|printf
argument_list|(
literal|" OVERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0010
condition|)
name|printf
argument_list|(
literal|" UNDERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0x0020
condition|)
name|printf
argument_list|(
literal|" LOS"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|";"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|control
operator|&
literal|0xe080
condition|)
name|warning
argument_list|(
literal|"reserved bits on: %s\n"
argument_list|,
name|local_hex_string
argument_list|(
name|control
operator|&
literal|0xe080
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|print_387_status_word
parameter_list|(
name|status
parameter_list|)
name|unsigned
name|int
name|status
decl_stmt|;
block|{
name|printf
argument_list|(
literal|"status %s: "
argument_list|,
name|local_hex_string
argument_list|(
name|status
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0xff
condition|)
block|{
name|printf
argument_list|(
literal|"exceptions:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0001
condition|)
name|printf
argument_list|(
literal|" INVALID"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0002
condition|)
name|printf
argument_list|(
literal|" DENORM"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0004
condition|)
name|printf
argument_list|(
literal|" DIVZ"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0008
condition|)
name|printf
argument_list|(
literal|" OVERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0010
condition|)
name|printf
argument_list|(
literal|" UNDERF"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0020
condition|)
name|printf
argument_list|(
literal|" LOS"
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|&
literal|0x0040
condition|)
name|printf
argument_list|(
literal|" FPSTACK"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"; "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"flags: %d%d%d%d; "
argument_list|,
operator|(
name|status
operator|&
literal|0x4000
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0400
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0200
operator|)
operator|!=
literal|0
argument_list|,
operator|(
name|status
operator|&
literal|0x0100
operator|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"top %d\n"
argument_list|,
operator|(
name|status
operator|>>
literal|11
operator|)
operator|&
literal|7
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

