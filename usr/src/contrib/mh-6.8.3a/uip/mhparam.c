begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* mhparam.c - print mh_profile values */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|ident
index|[]
init|=
literal|"@(#)$Id: mhparam.c,v 1.9 1993/09/01 23:00:59 jromine Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* lint */
end_comment

begin_comment
comment|/* contributed by Jeffrey C Honig<Jeffrey_C_Honig@cornell.edu> */
end_comment

begin_include
include|#
directive|include
file|"../h/mh.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|mhlibdir
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* NB: this will change soon */
end_comment

begin_decl_stmt
name|char
modifier|*
name|sbackup
init|=
name|SBACKUP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|slink
init|=
name|LINK
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|*/
end_comment

begin_decl_stmt
specifier|static
name|struct
name|swit
name|switches
index|[]
init|=
block|{
define|#
directive|define
name|COMPSW
value|0
literal|"components"
block|,
literal|0
block|,
define|#
directive|define
name|NCOMPSW
value|1
literal|"nocomponents"
block|,
literal|0
block|,
define|#
directive|define
name|ALLSW
value|2
literal|"all"
block|,
literal|0
block|,
define|#
directive|define
name|HELPSW
value|3
literal|"help"
block|,
literal|4
block|,
name|NULL
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|char
modifier|*
name|p_find
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|i
decl_stmt|,
name|all
init|=
literal|0
decl_stmt|,
name|compp
init|=
literal|0
decl_stmt|,
name|components
init|=
operator|-
literal|1
decl_stmt|,
name|missed
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
name|buf
index|[
literal|100
index|]
decl_stmt|,
modifier|*
modifier|*
name|ap
decl_stmt|,
modifier|*
modifier|*
name|argp
decl_stmt|,
modifier|*
name|arguments
index|[
name|MAXARGS
index|]
decl_stmt|,
modifier|*
name|comps
index|[
name|MAXARGS
index|]
decl_stmt|;
name|invo_name
operator|=
name|r1bindex
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
name|m_find
argument_list|(
name|invo_name
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|ap
operator|=
name|brkstring
argument_list|(
name|cp
operator|=
name|getcpy
argument_list|(
name|cp
argument_list|)
argument_list|,
literal|" "
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|ap
operator|=
name|copyip
argument_list|(
name|ap
argument_list|,
name|arguments
argument_list|)
expr_stmt|;
block|}
else|else
name|ap
operator|=
name|arguments
expr_stmt|;
operator|(
name|void
operator|)
name|copyip
argument_list|(
name|argv
operator|+
literal|1
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|argp
operator|=
name|arguments
expr_stmt|;
comment|/*
comment|*/
while|while
condition|(
name|cp
operator|=
operator|*
name|argp
operator|++
condition|)
block|{
if|if
condition|(
operator|*
name|cp
operator|==
literal|'-'
condition|)
switch|switch
condition|(
name|smatch
argument_list|(
operator|++
name|cp
argument_list|,
name|switches
argument_list|)
condition|)
block|{
case|case
name|AMBIGSW
case|:
name|ambigsw
argument_list|(
name|cp
argument_list|,
name|switches
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|UNKWNSW
case|:
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"-%s unknown"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
case|case
name|HELPSW
case|:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s [profile-components] [switches]"
argument_list|,
name|invo_name
argument_list|)
expr_stmt|;
name|help
argument_list|(
name|buf
argument_list|,
name|switches
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
case|case
name|COMPSW
case|:
name|components
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|NCOMPSW
case|:
name|components
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|ALLSW
case|:
name|all
operator|=
literal|1
expr_stmt|;
break|break;
block|}
else|else
name|comps
index|[
name|compp
operator|++
index|]
operator|=
name|cp
expr_stmt|;
block|}
comment|/*
comment|*/
if|if
condition|(
name|all
condition|)
block|{
specifier|register
name|struct
name|node
modifier|*
name|np
decl_stmt|;
if|if
condition|(
name|compp
condition|)
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"profile-components ignored with -all"
argument_list|)
expr_stmt|;
if|if
condition|(
name|components
operator|>=
literal|0
condition|)
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"-%scomponents ignored with -all"
argument_list|,
name|components
condition|?
literal|""
else|:
literal|"no"
argument_list|)
expr_stmt|;
name|m_getdefs
argument_list|()
expr_stmt|;
for|for
control|(
name|np
operator|=
name|m_defs
init|;
name|np
condition|;
name|np
operator|=
name|np
operator|->
name|n_next
control|)
name|printf
argument_list|(
literal|"%s:\t%s\n"
argument_list|,
name|np
operator|->
name|n_name
argument_list|,
name|np
operator|->
name|n_field
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|components
operator|<
literal|0
condition|)
name|components
operator|=
name|compp
operator|>
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|compp
condition|;
name|i
operator|++
control|)
block|{
specifier|register
name|char
modifier|*
name|value
init|=
name|m_find
argument_list|(
name|comps
index|[
name|i
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|value
condition|)
name|value
operator|=
name|p_find
argument_list|(
name|comps
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
condition|)
block|{
if|if
condition|(
name|components
condition|)
name|printf
argument_list|(
literal|"%s:\t"
argument_list|,
name|comps
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
else|else
name|missed
operator|++
expr_stmt|;
block|}
block|}
name|done
argument_list|(
name|missed
argument_list|)
expr_stmt|;
block|}
end_function

begin_struct
specifier|static
struct|struct
name|procs
block|{
name|char
modifier|*
name|p_name
decl_stmt|;
name|char
modifier|*
modifier|*
name|p_field
decl_stmt|;
block|}
name|procs
index|[]
init|=
block|{
block|{
literal|"context"
block|,
operator|&
name|context
block|}
block|,
block|{
literal|"faceproc"
block|,
operator|&
name|faceproc
block|}
block|,
block|{
literal|"fileproc"
block|,
operator|&
name|fileproc
block|}
block|,
block|{
literal|"foldprot"
block|,
operator|&
name|foldprot
block|}
block|,
block|{
literal|"incproc"
block|,
operator|&
name|incproc
block|}
block|,
block|{
literal|"installproc"
block|,
operator|&
name|installproc
block|}
block|,
block|{
literal|"lproc"
block|,
operator|&
name|lproc
block|}
block|,
block|{
literal|"mailproc"
block|,
operator|&
name|mailproc
block|}
block|,
block|{
literal|"mhlproc"
block|,
operator|&
name|mhlproc
block|}
block|,
block|{
literal|"moreproc"
block|,
operator|&
name|moreproc
block|}
block|,
block|{
literal|"msgprot"
block|,
operator|&
name|msgprot
block|}
block|,
block|{
literal|"mshproc"
block|,
operator|&
name|mshproc
block|}
block|,
block|{
literal|"packproc"
block|,
operator|&
name|packproc
block|}
block|,
block|{
literal|"postproc"
block|,
operator|&
name|postproc
block|}
block|,
block|{
literal|"rmfproc"
block|,
operator|&
name|rmfproc
block|}
block|,
block|{
literal|"rmmproc"
block|,
operator|&
name|rmmproc
block|}
block|,
block|{
literal|"sendproc"
block|,
operator|&
name|sendproc
block|}
block|,
block|{
literal|"showproc"
block|,
operator|&
name|showproc
block|}
block|,
block|{
literal|"slocalproc"
block|,
operator|&
name|slocalproc
block|}
block|,
block|{
literal|"version"
block|,
operator|&
name|version
block|}
block|,
block|{
literal|"vmhproc"
block|,
operator|&
name|vmhproc
block|}
block|,
block|{
literal|"whatnowproc"
block|,
operator|&
name|whatnowproc
block|}
block|,
block|{
literal|"whomproc"
block|,
operator|&
name|whomproc
block|}
block|,
block|{
literal|"libdir"
block|,
operator|&
name|mhlibdir
block|}
block|,
block|{
literal|"sbackup"
block|,
operator|&
name|sbackup
block|}
block|,
block|{
literal|"link"
block|,
operator|&
name|slink
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
block|, }
struct|;
end_struct

begin_function
specifier|static
name|char
modifier|*
name|p_find
parameter_list|(
name|str
parameter_list|)
specifier|register
name|char
modifier|*
name|str
decl_stmt|;
block|{
specifier|register
name|struct
name|procs
modifier|*
name|ps
decl_stmt|;
for|for
control|(
name|ps
operator|=
name|procs
init|;
name|ps
operator|->
name|p_name
condition|;
name|ps
operator|++
control|)
if|if
condition|(
name|uleq
argument_list|(
name|ps
operator|->
name|p_name
argument_list|,
name|str
argument_list|)
condition|)
return|return
operator|(
operator|*
name|ps
operator|->
name|p_field
operator|)
return|;
return|return
name|NULL
return|;
block|}
end_function

end_unit

