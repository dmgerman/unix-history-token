begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1980 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
name|char
name|copyright
index|[]
init|=
literal|"@(#) Copyright (c) 1980 Regents of the University of California.\n\  All rights reserved.\n"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)stty.c	5.1 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_comment
comment|/*  * set teletype modes  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_struct
struct|struct
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|speed
decl_stmt|;
block|}
name|speeds
index|[]
init|=
block|{
literal|"0"
block|,
name|B0
block|,
literal|"50"
block|,
name|B50
block|,
literal|"75"
block|,
name|B75
block|,
literal|"110"
block|,
name|B110
block|,
literal|"134"
block|,
name|B134
block|,
literal|"134.5"
block|,
name|B134
block|,
literal|"150"
block|,
name|B150
block|,
literal|"200"
block|,
name|B200
block|,
literal|"300"
block|,
name|B300
block|,
literal|"600"
block|,
name|B600
block|,
literal|"1200"
block|,
name|B1200
block|,
literal|"1800"
block|,
name|B1800
block|,
literal|"2400"
block|,
name|B2400
block|,
literal|"4800"
block|,
name|B4800
block|,
literal|"9600"
block|,
name|B9600
block|,
literal|"exta"
block|,
name|EXTA
block|,
literal|"19200"
block|,
name|EXTA
block|,
literal|"extb"
block|,
name|EXTB
block|,
literal|"38400"
block|,
name|EXTB
block|,
literal|0
block|, }
struct|;
end_struct

begin_struct
struct|struct
block|{
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|set
decl_stmt|;
name|int
name|reset
decl_stmt|;
name|int
name|lset
decl_stmt|;
name|int
name|lreset
decl_stmt|;
block|}
name|modes
index|[]
init|=
block|{
literal|"even"
block|,
name|EVENP
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-even"
block|,
literal|0
block|,
name|EVENP
block|,
literal|0
block|,
literal|0
block|,
literal|"odd"
block|,
name|ODDP
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-odd"
block|,
literal|0
block|,
name|ODDP
block|,
literal|0
block|,
literal|0
block|,
literal|"raw"
block|,
name|RAW
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-raw"
block|,
literal|0
block|,
name|RAW
block|,
literal|0
block|,
literal|0
block|,
literal|"cooked"
block|,
literal|0
block|,
name|RAW
block|,
literal|0
block|,
literal|0
block|,
literal|"-nl"
block|,
name|CRMOD
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"nl"
block|,
literal|0
block|,
name|CRMOD
block|,
literal|0
block|,
literal|0
block|,
literal|"echo"
block|,
name|ECHO
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-echo"
block|,
literal|0
block|,
name|ECHO
block|,
literal|0
block|,
literal|0
block|,
literal|"LCASE"
block|,
name|LCASE
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"lcase"
block|,
name|LCASE
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-LCASE"
block|,
literal|0
block|,
name|LCASE
block|,
literal|0
block|,
literal|0
block|,
literal|"-lcase"
block|,
literal|0
block|,
name|LCASE
block|,
literal|0
block|,
literal|0
block|,
literal|"-tabs"
block|,
name|XTABS
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"tabs"
block|,
literal|0
block|,
name|XTABS
block|,
literal|0
block|,
literal|0
block|,
literal|"tandem"
block|,
name|TANDEM
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-tandem"
block|,
literal|0
block|,
name|TANDEM
block|,
literal|0
block|,
literal|0
block|,
literal|"cbreak"
block|,
name|CBREAK
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|"-cbreak"
block|,
literal|0
block|,
name|CBREAK
block|,
literal|0
block|,
literal|0
block|,
literal|"cr0"
block|,
name|CR0
block|,
name|CR3
block|,
literal|0
block|,
literal|0
block|,
literal|"cr1"
block|,
name|CR1
block|,
name|CR3
block|,
literal|0
block|,
literal|0
block|,
literal|"cr2"
block|,
name|CR2
block|,
name|CR3
block|,
literal|0
block|,
literal|0
block|,
literal|"cr3"
block|,
name|CR3
block|,
name|CR3
block|,
literal|0
block|,
literal|0
block|,
literal|"tab0"
block|,
name|TAB0
block|,
name|XTABS
block|,
literal|0
block|,
literal|0
block|,
literal|"tab1"
block|,
name|TAB1
block|,
name|XTABS
block|,
literal|0
block|,
literal|0
block|,
literal|"tab2"
block|,
name|TAB2
block|,
name|XTABS
block|,
literal|0
block|,
literal|0
block|,
literal|"nl0"
block|,
name|NL0
block|,
name|NL3
block|,
literal|0
block|,
literal|0
block|,
literal|"nl1"
block|,
name|NL1
block|,
name|NL3
block|,
literal|0
block|,
literal|0
block|,
literal|"nl2"
block|,
name|NL2
block|,
name|NL3
block|,
literal|0
block|,
literal|0
block|,
literal|"nl3"
block|,
name|NL3
block|,
name|NL3
block|,
literal|0
block|,
literal|0
block|,
literal|"ff0"
block|,
name|FF0
block|,
name|FF1
block|,
literal|0
block|,
literal|0
block|,
literal|"ff1"
block|,
name|FF1
block|,
name|FF1
block|,
literal|0
block|,
literal|0
block|,
literal|"bs0"
block|,
name|BS0
block|,
name|BS1
block|,
literal|0
block|,
literal|0
block|,
literal|"bs1"
block|,
name|BS1
block|,
name|BS1
block|,
literal|0
block|,
literal|0
block|,
literal|"33"
block|,
name|CR1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"tty33"
block|,
name|CR1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"37"
block|,
name|FF1
operator|+
name|CR2
operator|+
name|TAB1
operator|+
name|NL1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"tty37"
block|,
name|FF1
operator|+
name|CR2
operator|+
name|TAB1
operator|+
name|NL1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"05"
block|,
name|NL2
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"vt05"
block|,
name|NL2
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"tn"
block|,
name|CR1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"tn300"
block|,
name|CR1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"ti"
block|,
name|CR2
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"ti700"
block|,
name|CR2
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"tek"
block|,
name|FF1
block|,
name|ALLDELAY
block|,
literal|0
block|,
literal|0
block|,
literal|"crtbs"
block|,
literal|0
block|,
literal|0
block|,
name|LCRTBS
block|,
name|LPRTERA
block|,
literal|"-crtbs"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LCRTBS
block|,
literal|"prterase"
block|,
literal|0
block|,
literal|0
block|,
name|LPRTERA
block|,
name|LCRTBS
operator|+
name|LCRTKIL
operator|+
name|LCRTERA
block|,
literal|"-prterase"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LPRTERA
block|,
literal|"crterase"
block|,
literal|0
block|,
literal|0
block|,
name|LCRTERA
block|,
name|LPRTERA
block|,
literal|"-crterase"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LCRTERA
block|,
literal|"crtkill"
block|,
literal|0
block|,
literal|0
block|,
name|LCRTKIL
block|,
name|LPRTERA
block|,
literal|"-crtkill"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LCRTKIL
block|,
literal|"tilde"
block|,
literal|0
block|,
literal|0
block|,
name|LTILDE
block|,
literal|0
block|,
literal|"-tilde"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LTILDE
block|,
literal|"mdmbuf"
block|,
literal|0
block|,
literal|0
block|,
name|LMDMBUF
block|,
literal|0
block|,
literal|"-mdmbuf"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LMDMBUF
block|,
literal|"litout"
block|,
literal|0
block|,
literal|0
block|,
name|LLITOUT
block|,
literal|0
block|,
literal|"-litout"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LLITOUT
block|,
literal|"tostop"
block|,
literal|0
block|,
literal|0
block|,
name|LTOSTOP
block|,
literal|0
block|,
literal|"-tostop"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LTOSTOP
block|,
literal|"flusho"
block|,
literal|0
block|,
literal|0
block|,
name|LFLUSHO
block|,
literal|0
block|,
literal|"-flusho"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LFLUSHO
block|,
literal|"nohang"
block|,
literal|0
block|,
literal|0
block|,
name|LNOHANG
block|,
literal|0
block|,
literal|"-nohang"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LNOHANG
block|,
ifdef|#
directive|ifdef
name|notdef
literal|"etxack"
block|,
literal|0
block|,
literal|0
block|,
name|LETXACK
block|,
literal|0
block|,
literal|"-etxack"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LETXACK
block|,
endif|#
directive|endif
literal|"ctlecho"
block|,
literal|0
block|,
literal|0
block|,
name|LCTLECH
block|,
literal|0
block|,
literal|"-ctlecho"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LCTLECH
block|,
literal|"pendin"
block|,
literal|0
block|,
literal|0
block|,
name|LPENDIN
block|,
literal|0
block|,
literal|"-pendin"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LPENDIN
block|,
literal|"decctlq"
block|,
literal|0
block|,
literal|0
block|,
name|LDECCTQ
block|,
literal|0
block|,
literal|"-decctlq"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LDECCTQ
block|,
literal|"noflsh"
block|,
literal|0
block|,
literal|0
block|,
name|LNOFLSH
block|,
literal|0
block|,
literal|"-noflsh"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|LNOFLSH
block|,
literal|0
block|, }
struct|;
end_struct

begin_decl_stmt
name|struct
name|tchars
name|tc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ltchars
name|ltc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|sgttyb
name|mode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|winsize
name|win
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lmode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|oldisc
decl_stmt|,
name|ldisc
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|special
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|;
name|char
name|def
decl_stmt|;
block|}
name|special
index|[]
init|=
block|{
literal|"erase"
block|,
operator|&
name|mode
operator|.
name|sg_erase
block|,
name|CERASE
block|,
literal|"kill"
block|,
operator|&
name|mode
operator|.
name|sg_kill
block|,
name|CKILL
block|,
literal|"intr"
block|,
operator|&
name|tc
operator|.
name|t_intrc
block|,
name|CINTR
block|,
literal|"quit"
block|,
operator|&
name|tc
operator|.
name|t_quitc
block|,
name|CQUIT
block|,
literal|"start"
block|,
operator|&
name|tc
operator|.
name|t_startc
block|,
name|CSTART
block|,
literal|"stop"
block|,
operator|&
name|tc
operator|.
name|t_stopc
block|,
name|CSTOP
block|,
literal|"eof"
block|,
operator|&
name|tc
operator|.
name|t_eofc
block|,
name|CEOF
block|,
literal|"brk"
block|,
operator|&
name|tc
operator|.
name|t_brkc
block|,
name|CBRK
block|,
literal|"susp"
block|,
operator|&
name|ltc
operator|.
name|t_suspc
block|,
name|CSUSP
block|,
literal|"dsusp"
block|,
operator|&
name|ltc
operator|.
name|t_dsuspc
block|,
name|CDSUSP
block|,
literal|"rprnt"
block|,
operator|&
name|ltc
operator|.
name|t_rprntc
block|,
name|CRPRNT
block|,
literal|"flush"
block|,
operator|&
name|ltc
operator|.
name|t_flushc
block|,
name|CFLUSH
block|,
literal|"werase"
block|,
operator|&
name|ltc
operator|.
name|t_werasc
block|,
name|CWERASE
block|,
literal|"lnext"
block|,
operator|&
name|ltc
operator|.
name|t_lnextc
block|,
name|CLNEXT
block|,
literal|0
block|}
struct|;
end_struct

begin_decl_stmt
name|char
modifier|*
name|arg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|argc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|iargc
parameter_list|,
name|iargv
parameter_list|)
name|char
modifier|*
modifier|*
name|iargv
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
specifier|register
name|struct
name|special
modifier|*
name|sp
decl_stmt|;
name|char
name|obuf
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|setbuf
argument_list|(
name|stderr
argument_list|,
name|obuf
argument_list|)
expr_stmt|;
name|argc
operator|=
name|iargc
expr_stmt|;
name|argv
operator|=
name|iargv
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|mode
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCGETD
argument_list|,
operator|&
name|ldisc
argument_list|)
expr_stmt|;
name|oldisc
operator|=
name|ldisc
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCGETC
argument_list|,
operator|&
name|tc
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCLGET
argument_list|,
operator|&
name|lmode
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCGLTC
argument_list|,
operator|&
name|ltc
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCGWINSZ
argument_list|,
operator|&
name|win
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
block|{
name|prmodes
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"all"
argument_list|)
condition|)
block|{
name|prmodes
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|argc
operator|==
literal|2
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"everything"
argument_list|)
condition|)
block|{
name|prmodes
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* 	if (argc == 2&& !strcmp(argv[1], "all")) { 		prmodes(2); 		exit(0); 	} */
while|while
condition|(
operator|--
name|argc
operator|>
literal|0
condition|)
block|{
name|arg
operator|=
operator|*
operator|++
name|argv
expr_stmt|;
if|if
condition|(
name|eq
argument_list|(
literal|"ek"
argument_list|)
condition|)
block|{
name|mode
operator|.
name|sg_erase
operator|=
literal|'#'
expr_stmt|;
name|mode
operator|.
name|sg_kill
operator|=
literal|'@'
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"new"
argument_list|)
condition|)
block|{
name|ldisc
operator|=
name|NTTYDISC
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETD
argument_list|,
operator|&
name|ldisc
argument_list|)
operator|<
literal|0
condition|)
name|perror
argument_list|(
literal|"ioctl"
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"newcrt"
argument_list|)
condition|)
block|{
name|ldisc
operator|=
name|NTTYDISC
expr_stmt|;
name|lmode
operator|&=
operator|~
name|LPRTERA
expr_stmt|;
name|lmode
operator||=
name|LCRTBS
operator||
name|LCTLECH
expr_stmt|;
if|if
condition|(
name|mode
operator|.
name|sg_ospeed
operator|>=
name|B1200
condition|)
name|lmode
operator||=
name|LCRTERA
operator||
name|LCRTKIL
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETD
argument_list|,
operator|&
name|ldisc
argument_list|)
operator|<
literal|0
condition|)
name|perror
argument_list|(
literal|"ioctl"
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"crt"
argument_list|)
condition|)
block|{
name|lmode
operator|&=
operator|~
name|LPRTERA
expr_stmt|;
name|lmode
operator||=
name|LCRTBS
operator||
name|LCTLECH
expr_stmt|;
if|if
condition|(
name|mode
operator|.
name|sg_ospeed
operator|>=
name|B1200
condition|)
name|lmode
operator||=
name|LCRTERA
operator||
name|LCRTKIL
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"old"
argument_list|)
condition|)
block|{
name|ldisc
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETD
argument_list|,
operator|&
name|ldisc
argument_list|)
operator|<
literal|0
condition|)
name|perror
argument_list|(
literal|"ioctl"
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"dec"
argument_list|)
condition|)
block|{
name|mode
operator|.
name|sg_erase
operator|=
literal|0177
expr_stmt|;
name|mode
operator|.
name|sg_kill
operator|=
name|CTRL
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|tc
operator|.
name|t_intrc
operator|=
name|CTRL
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|ldisc
operator|=
name|NTTYDISC
expr_stmt|;
name|lmode
operator|&=
operator|~
name|LPRTERA
expr_stmt|;
name|lmode
operator||=
name|LCRTBS
operator||
name|LCTLECH
operator||
name|LDECCTQ
expr_stmt|;
if|if
condition|(
name|mode
operator|.
name|sg_ospeed
operator|>=
name|B1200
condition|)
name|lmode
operator||=
name|LCRTERA
operator||
name|LCRTKIL
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETD
argument_list|,
operator|&
name|ldisc
argument_list|)
operator|<
literal|0
condition|)
name|perror
argument_list|(
literal|"ioctl"
argument_list|)
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|sp
operator|=
name|special
init|;
name|sp
operator|->
name|name
condition|;
name|sp
operator|++
control|)
if|if
condition|(
name|eq
argument_list|(
name|sp
operator|->
name|name
argument_list|)
condition|)
block|{
if|if
condition|(
operator|--
name|argc
operator|==
literal|0
condition|)
goto|goto
name|done
goto|;
if|if
condition|(
operator|*
operator|*
operator|++
name|argv
operator|==
literal|'u'
condition|)
operator|*
name|sp
operator|->
name|cp
operator|=
literal|0377
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
operator|*
name|argv
operator|==
literal|'^'
condition|)
operator|*
name|sp
operator|->
name|cp
operator|=
operator|(
operator|(
operator|*
name|argv
operator|)
index|[
literal|1
index|]
operator|==
literal|'?'
operator|)
condition|?
literal|0177
else|:
operator|(
operator|*
name|argv
operator|)
index|[
literal|1
index|]
operator|&
literal|037
expr_stmt|;
else|else
operator|*
name|sp
operator|->
name|cp
operator|=
operator|*
operator|*
name|argv
expr_stmt|;
goto|goto
name|cont
goto|;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"gspeed"
argument_list|)
condition|)
block|{
name|mode
operator|.
name|sg_ispeed
operator|=
name|B300
expr_stmt|;
name|mode
operator|.
name|sg_ospeed
operator|=
name|B9600
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"hup"
argument_list|)
condition|)
block|{
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCHPCL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"rows"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|--
name|argc
operator|==
literal|0
condition|)
goto|goto
name|done
goto|;
name|win
operator|.
name|ws_row
operator|=
name|atoi
argument_list|(
operator|*
operator|++
name|argv
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"columns"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|--
name|argc
operator|==
literal|0
condition|)
goto|goto
name|done
goto|;
name|win
operator|.
name|ws_col
operator|=
name|atoi
argument_list|(
operator|*
operator|++
name|argv
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|speeds
index|[
name|i
index|]
operator|.
name|string
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|eq
argument_list|(
name|speeds
index|[
name|i
index|]
operator|.
name|string
argument_list|)
condition|)
block|{
name|mode
operator|.
name|sg_ispeed
operator|=
name|mode
operator|.
name|sg_ospeed
operator|=
name|speeds
index|[
name|i
index|]
operator|.
name|speed
expr_stmt|;
goto|goto
name|cont
goto|;
block|}
if|if
condition|(
name|eq
argument_list|(
literal|"speed"
argument_list|)
condition|)
block|{
name|ioctl
argument_list|(
name|open
argument_list|(
literal|"/dev/tty"
argument_list|,
literal|0
argument_list|)
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|mode
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|speeds
index|[
name|i
index|]
operator|.
name|string
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|mode
operator|.
name|sg_ospeed
operator|==
name|speeds
index|[
name|i
index|]
operator|.
name|speed
condition|)
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|speeds
index|[
name|i
index|]
operator|.
name|string
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"unknown\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|modes
index|[
name|i
index|]
operator|.
name|string
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|eq
argument_list|(
name|modes
index|[
name|i
index|]
operator|.
name|string
argument_list|)
condition|)
block|{
name|mode
operator|.
name|sg_flags
operator|&=
operator|~
name|modes
index|[
name|i
index|]
operator|.
name|reset
expr_stmt|;
name|mode
operator|.
name|sg_flags
operator||=
name|modes
index|[
name|i
index|]
operator|.
name|set
expr_stmt|;
name|lmode
operator|&=
operator|~
name|modes
index|[
name|i
index|]
operator|.
name|lreset
expr_stmt|;
name|lmode
operator||=
name|modes
index|[
name|i
index|]
operator|.
name|lset
expr_stmt|;
block|}
if|if
condition|(
name|arg
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unknown mode: %s\n"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|cont
label|:
empty_stmt|;
block|}
name|done
label|:
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|mode
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|tc
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSLTC
argument_list|,
operator|&
name|ltc
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCLSET
argument_list|,
operator|&
name|lmode
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|1
argument_list|,
name|TIOCSWINSZ
argument_list|,
operator|&
name|win
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|eq
argument_list|(
argument|string
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|string
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|arg
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|i
operator|=
literal|0
expr_stmt|;
name|loop
label|:
if|if
condition|(
name|arg
index|[
name|i
index|]
operator|!=
name|string
index|[
name|i
index|]
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|arg
index|[
name|i
operator|++
index|]
operator|!=
literal|'\0'
condition|)
goto|goto
name|loop
goto|;
name|arg
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|prmodes
argument_list|(
argument|all
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|m
expr_stmt|;
name|int
name|any
decl_stmt|;
if|if
condition|(
name|ldisc
operator|==
name|NETLDISC
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"net discipline, "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ldisc
operator|==
name|NTTYDISC
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"new tty, "
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|all
operator|==
literal|2
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"old tty, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|mode
operator|.
name|sg_ispeed
operator|!=
name|mode
operator|.
name|sg_ospeed
condition|)
block|{
name|prspeed
argument_list|(
literal|"input speed "
argument_list|,
name|mode
operator|.
name|sg_ispeed
argument_list|)
expr_stmt|;
name|prspeed
argument_list|(
literal|"output speed "
argument_list|,
name|mode
operator|.
name|sg_ospeed
argument_list|)
expr_stmt|;
block|}
else|else
name|prspeed
argument_list|(
literal|"speed "
argument_list|,
name|mode
operator|.
name|sg_ispeed
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|", %d rows, %d columns"
argument_list|,
name|win
operator|.
name|ws_row
argument_list|,
name|win
operator|.
name|ws_col
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|all
operator|==
literal|2
condition|?
literal|"\n"
else|:
literal|"; "
argument_list|)
expr_stmt|;
name|m
operator|=
name|mode
operator|.
name|sg_flags
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
operator|(
name|EVENP
operator||
name|ODDP
operator|)
operator|)
operator|!=
operator|(
name|EVENP
operator||
name|ODDP
operator|)
condition|)
block|{
if|if
condition|(
name|m
operator|&
name|EVENP
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"even "
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|&
name|ODDP
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"odd "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|all
operator|==
literal|2
operator|||
name|m
operator|&
name|RAW
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-raw "
operator|+
operator|(
operator|(
name|m
operator|&
name|RAW
operator|)
operator|!=
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|CRMOD
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-nl "
operator|+
operator|(
operator|(
name|m
operator|&
name|CRMOD
operator|)
operator|==
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|ECHO
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-echo "
operator|+
operator|(
operator|(
name|m
operator|&
name|ECHO
operator|)
operator|!=
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|LCASE
operator|)
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-lcase "
operator|+
operator|(
operator|(
name|m
operator|&
name|LCASE
operator|)
operator|!=
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|TANDEM
operator|)
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-tandem "
operator|+
operator|(
operator|(
name|m
operator|&
name|TANDEM
operator|)
operator|!=
literal|0
operator|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-tabs "
operator|+
operator|(
operator|(
name|m
operator|&
name|XTABS
operator|)
operator|!=
name|XTABS
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|CBREAK
operator|)
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-cbreak "
operator|+
operator|(
operator|(
name|m
operator|&
name|CBREAK
operator|)
operator|!=
literal|0
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|NLDELAY
operator|)
condition|)
name|delay
argument_list|(
operator|(
name|m
operator|&
name|NLDELAY
operator|)
operator|/
name|NL1
argument_list|,
literal|"nl"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m
operator|&
name|TBDELAY
operator|)
operator|!=
name|XTABS
condition|)
name|delay
argument_list|(
operator|(
name|m
operator|&
name|TBDELAY
operator|)
operator|/
name|TAB1
argument_list|,
literal|"tab"
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|CRDELAY
operator|)
condition|)
name|delay
argument_list|(
operator|(
name|m
operator|&
name|CRDELAY
operator|)
operator|/
name|CR1
argument_list|,
literal|"cr"
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|VTDELAY
operator|)
condition|)
name|delay
argument_list|(
operator|(
name|m
operator|&
name|VTDELAY
operator|)
operator|/
name|FF1
argument_list|,
literal|"ff"
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
operator|||
operator|(
name|m
operator|&
name|BSDELAY
operator|)
condition|)
name|delay
argument_list|(
operator|(
name|m
operator|&
name|BSDELAY
operator|)
operator|/
name|BS1
argument_list|,
literal|"bs"
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
define|#
directive|define
name|lpit
parameter_list|(
name|what
parameter_list|,
name|str
parameter_list|)
define|\
value|if (all==2||(lmode&what)) { \ 		fprintf(stderr,str+((lmode&what)!=0)); any++; \ 	}
if|if
condition|(
name|ldisc
operator|==
name|NTTYDISC
condition|)
block|{
name|int
name|newcrt
init|=
operator|(
name|lmode
operator|&
operator|(
name|LCTLECH
operator||
name|LCRTBS
operator|)
operator|)
operator|==
operator|(
name|LCTLECH
operator||
name|LCRTBS
operator|)
operator|&&
operator|(
name|lmode
operator|&
operator|(
name|LCRTERA
operator||
name|LCRTKIL
operator|)
operator|)
operator|==
operator|(
operator|(
name|mode
operator|.
name|sg_ospeed
operator|>
name|B300
operator|)
condition|?
name|LCRTERA
operator||
name|LCRTKIL
else|:
literal|0
operator|)
decl_stmt|;
name|int
name|nothing
init|=
literal|1
decl_stmt|;
if|if
condition|(
name|newcrt
condition|)
block|{
if|if
condition|(
name|all
operator|==
literal|2
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"crt: (crtbs crterase crtkill ctlecho) "
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"crt "
argument_list|)
expr_stmt|;
name|any
operator|++
expr_stmt|;
block|}
else|else
block|{
name|lpit
argument_list|(
name|LCRTBS
argument_list|,
literal|"-crtbs "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LCRTERA
argument_list|,
literal|"-crterase "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LCRTKIL
argument_list|,
literal|"-crtkill "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LCTLECH
argument_list|,
literal|"-ctlecho "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LPRTERA
argument_list|,
literal|"-prterase "
argument_list|)
expr_stmt|;
block|}
name|lpit
argument_list|(
name|LTOSTOP
argument_list|,
literal|"-tostop "
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
operator|==
literal|2
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|any
operator|=
literal|0
expr_stmt|;
name|nothing
operator|=
literal|0
expr_stmt|;
block|}
name|lpit
argument_list|(
name|LTILDE
argument_list|,
literal|"-tilde "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LFLUSHO
argument_list|,
literal|"-flusho "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LMDMBUF
argument_list|,
literal|"-mdmbuf "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LLITOUT
argument_list|,
literal|"-litout "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LNOHANG
argument_list|,
literal|"-nohang "
argument_list|)
expr_stmt|;
if|if
condition|(
name|any
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|any
operator|=
literal|0
expr_stmt|;
name|nothing
operator|=
literal|0
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|notdef
name|lpit
argument_list|(
name|LETXACK
argument_list|,
literal|"-etxack "
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|lpit
argument_list|(
name|LPENDIN
argument_list|,
literal|"-pendin "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LDECCTQ
argument_list|,
literal|"-decctlq "
argument_list|)
expr_stmt|;
name|lpit
argument_list|(
name|LNOFLSH
argument_list|,
literal|"-noflsh "
argument_list|)
expr_stmt|;
if|if
condition|(
name|any
operator|||
name|nothing
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|all
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|all
condition|)
block|{
switch|switch
condition|(
name|ldisc
condition|)
block|{
case|case
literal|0
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\ erase  kill   intr   quit   stop   eof\ \n"
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|mode
operator|.
name|sg_erase
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|mode
operator|.
name|sg_kill
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_intrc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_quitc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_stopc
argument_list|,
name|tc
operator|.
name|t_startc
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_eofc
argument_list|,
name|tc
operator|.
name|t_brkc
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NTTYDISC
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\ erase  kill   werase rprnt  flush  lnext  susp   intr   quit   stop   eof\ \n"
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|mode
operator|.
name|sg_erase
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|mode
operator|.
name|sg_kill
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|ltc
operator|.
name|t_werasc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|ltc
operator|.
name|t_rprntc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|ltc
operator|.
name|t_flushc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|ltc
operator|.
name|t_lnextc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|ltc
operator|.
name|t_suspc
argument_list|,
name|ltc
operator|.
name|t_dsuspc
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_intrc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_quitc
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_stopc
argument_list|,
name|tc
operator|.
name|t_startc
argument_list|)
expr_stmt|;
name|pcol
argument_list|(
name|tc
operator|.
name|t_eofc
argument_list|,
name|tc
operator|.
name|t_brkc
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|ldisc
operator|!=
name|NETLDISC
condition|)
block|{
specifier|register
name|struct
name|special
modifier|*
name|sp
decl_stmt|;
name|int
name|first
init|=
literal|1
decl_stmt|;
for|for
control|(
name|sp
operator|=
name|special
init|;
name|sp
operator|->
name|name
condition|;
name|sp
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|sp
operator|->
name|cp
operator|&
literal|0377
operator|)
operator|!=
operator|(
name|sp
operator|->
name|def
operator|&
literal|0377
operator|)
condition|)
block|{
name|pit
argument_list|(
operator|*
name|sp
operator|->
name|cp
argument_list|,
name|sp
operator|->
name|name
argument_list|,
name|first
condition|?
literal|""
else|:
literal|", "
argument_list|)
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
block|}
empty_stmt|;
if|if
condition|(
name|sp
operator|->
name|cp
operator|==
operator|&
name|tc
operator|.
name|t_brkc
operator|&&
name|ldisc
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
operator|!
name|first
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|pcol
argument_list|(
argument|ch1
argument_list|,
argument|ch2
argument_list|)
end_macro

begin_decl_stmt
name|int
name|ch1
decl_stmt|,
name|ch2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|nout
init|=
literal|0
decl_stmt|;
name|ch1
operator|&=
literal|0377
expr_stmt|;
name|ch2
operator|&=
literal|0377
expr_stmt|;
if|if
condition|(
name|ch1
operator|==
name|ch2
condition|)
name|ch2
operator|=
literal|0377
expr_stmt|;
for|for
control|(
init|;
name|ch1
operator|!=
literal|0377
operator|||
name|ch2
operator|!=
literal|0377
condition|;
name|ch1
operator|=
name|ch2
operator|,
name|ch2
operator|=
literal|0377
control|)
block|{
if|if
condition|(
name|ch1
operator|==
literal|0377
condition|)
continue|continue;
if|if
condition|(
name|ch1
operator|&
literal|0200
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"M-"
argument_list|)
expr_stmt|;
name|nout
operator|+=
literal|2
expr_stmt|;
name|ch1
operator|&=
operator|~
literal|0200
expr_stmt|;
block|}
if|if
condition|(
name|ch1
operator|==
literal|0177
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"^"
argument_list|)
expr_stmt|;
name|nout
operator|++
expr_stmt|;
name|ch1
operator|=
literal|'?'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ch1
operator|<
literal|' '
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"^"
argument_list|)
expr_stmt|;
name|nout
operator|++
expr_stmt|;
name|ch1
operator|+=
literal|'@'
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%c"
argument_list|,
name|ch1
argument_list|)
expr_stmt|;
name|nout
operator|++
expr_stmt|;
if|if
condition|(
name|ch2
operator|!=
literal|0377
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|nout
operator|++
expr_stmt|;
block|}
block|}
while|while
condition|(
name|nout
operator|<
literal|7
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
name|nout
operator|++
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|pit
argument_list|(
argument|what
argument_list|,
argument|itsname
argument_list|,
argument|sep
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|what
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|itsname
decl_stmt|,
modifier|*
name|sep
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|what
operator|&=
literal|0377
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s%s"
argument_list|,
name|sep
argument_list|,
name|itsname
argument_list|)
expr_stmt|;
if|if
condition|(
name|what
operator|==
literal|0377
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"<undef>"
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" = "
argument_list|)
expr_stmt|;
if|if
condition|(
name|what
operator|&
literal|0200
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"M-"
argument_list|)
expr_stmt|;
name|what
operator|&=
operator|~
literal|0200
expr_stmt|;
block|}
if|if
condition|(
name|what
operator|==
literal|0177
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"^"
argument_list|)
expr_stmt|;
name|what
operator|=
literal|'?'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|what
operator|<
literal|' '
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"^"
argument_list|)
expr_stmt|;
name|what
operator|+=
literal|'@'
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%c"
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|delay
argument_list|(
argument|m
argument_list|,
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|m
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s%d "
argument_list|,
name|s
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|speed
index|[]
init|=
block|{
literal|0
block|,
literal|50
block|,
literal|75
block|,
literal|110
block|,
literal|134
block|,
literal|150
block|,
literal|200
block|,
literal|300
block|,
literal|600
block|,
literal|1200
block|,
literal|1800
block|,
literal|2400
block|,
literal|4800
block|,
literal|9600
block|,
literal|19200
block|,
literal|38400
block|}
decl_stmt|;
end_decl_stmt

begin_macro
name|prspeed
argument_list|(
argument|c
argument_list|,
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|c
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s%d baud"
argument_list|,
name|c
argument_list|,
name|speed
index|[
name|s
index|]
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

