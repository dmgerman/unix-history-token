begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1991 The Regents of the University of California.  * All rights reserved.  *  * %sccs.include.redist.c%  *  *	@(#)if_ecreg.h	7.1 (Berkeley) %G%  */
end_comment

begin_comment
comment|/*  * Device definitions for the i82586 generally and the 3com ec507  * ISA bus ethernet controller.  */
end_comment

begin_comment
comment|/*  * Intermediate System Control Block pointer  */
end_comment

begin_struct
struct|struct
name|ec_iscp
block|{
name|u_short
name|busy
decl_stmt|;
name|u_short
name|scb_off
decl_stmt|;
name|caddr_t
name|scb_base
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * System Control Block  */
end_comment

begin_struct
struct|struct
name|ec_scb
block|{
name|u_short
name|status
decl_stmt|;
define|#
directive|define
name|CX
value|0x8000
define|#
directive|define
name|FR
value|0x4000
define|#
directive|define
name|CNA
value|0x2000
define|#
directive|define
name|RNR
value|0x1000
define|#
directive|define
name|CU_STATE
value|0x700
define|#
directive|define
name|CUS_IDLE
value|0x000
define|#
directive|define
name|CUS_SUSPENDED
value|0x100
define|#
directive|define
name|CUS_ACTIVE
value|0x200
define|#
directive|define
name|RU_STATE
value|0x70
define|#
directive|define
name|RUS_IDLE
value|0x00
define|#
directive|define
name|RUS_SUSPENDED
value|0x10
define|#
directive|define
name|RUS_OVERRUN
value|0x20
define|#
directive|define
name|RUS_READY
value|0x40
name|u_short
name|command
decl_stmt|;
define|#
directive|define
name|CU_NOP
value|0
define|#
directive|define
name|CU_START
value|0x100
define|#
directive|define
name|RU_NOP
value|0
define|#
directive|define
name|RU_START
value|0x100
define|#
directive|define
name|RU_ABORT
value|0x400
define|#
directive|define
name|ACK_CX
value|0x8000
define|#
directive|define
name|ACK_RX
value|0x4000
define|#
directive|define
name|ACK_CNA
value|0x2000
define|#
directive|define
name|ACK_RNR
value|0x1000
name|u_short
name|cbl_off
decl_stmt|;
name|u_short
name|rfa_off
decl_stmt|;
struct|struct
name|errors
block|{
name|u_short
name|crc
decl_stmt|;
name|u_short
name|alignment
decl_stmt|;
name|u_short
name|resource
decl_stmt|;
name|u_short
name|overrun
decl_stmt|;
block|}
name|scb_errs
struct|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * Individual Address Setup  */
end_comment

begin_struct
struct|struct
name|ec_iasetup
block|{
name|u_short
name|com0
decl_stmt|;
define|#
directive|define
name|COM0_A
value|0x1000
define|#
directive|define
name|COM0_OK
value|0x2000
define|#
directive|define
name|COM0_B
value|0x4000
define|#
directive|define
name|COM0_C
value|0x8000
name|u_short
name|com1
decl_stmt|;
define|#
directive|define
name|COM1_IASETUP
value|0x1
define|#
directive|define
name|COM1_I
value|0x2000
define|#
directive|define
name|COM1_S
value|0x4000
define|#
directive|define
name|COM1_EL
value|0x8000
name|u_short
name|next_off
decl_stmt|;
name|u_char
name|srcaddr
index|[
literal|6
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * Load Multicast Addresses  */
end_comment

begin_struct
struct|struct
name|ec_mcsetup
block|{
name|u_short
name|com0
decl_stmt|;
name|u_short
name|com1
decl_stmt|;
define|#
directive|define
name|COM1_MCSETUP
value|0x3
name|u_short
name|next_off
decl_stmt|;
name|u_short
name|count
decl_stmt|;
comment|/* number of bytes, 14 bits only */
comment|/* char	mcaddrs[6];	/* white lie, data goes here */
block|}
struct|;
end_struct

begin_comment
comment|/*  * Transmit Command  */
end_comment

begin_struct
struct|struct
name|ec_transmit
block|{
name|u_short
name|com0
decl_stmt|;
define|#
directive|define
name|COLLISIONS
parameter_list|(
name|p
parameter_list|)
value|(p->com0& 0xf)
define|#
directive|define
name|EXCOL
value|0x10
comment|/* Excessive Collisions, Aborted */
define|#
directive|define
name|HEARTBEAT
value|0x20
comment|/* CDT signal monitored and OK (good) */
define|#
directive|define
name|TXDEFFERED
value|0x40
comment|/* ``due to Previous Link Activity'' */
define|#
directive|define
name|DMALATE
value|0x80
comment|/* DMA underrun */
define|#
directive|define
name|NOCTS
value|0x100
comment|/* Transmission stopped due to ... */
define|#
directive|define
name|NOCARSENSE
value|0x200
comment|/* Loss of Carrier sense during TX */
define|#
directive|define
name|LATECOLL
value|0x400
comment|/* Late Collision detected */
define|#
directive|define
name|TXERRS
value|0x7d0
comment|/* Various Bad Things */
name|u_short
name|com1
decl_stmt|;
define|#
directive|define
name|COM1_TRANSMIT
value|0x4
name|u_short
name|next_off
decl_stmt|;
name|u_short
name|tbd_off
decl_stmt|;
name|u_char
name|dstaddr
index|[
literal|6
index|]
decl_stmt|;
name|u_short
name|proto
decl_stmt|;
comment|/* Length for 802.3 */
comment|/*  * };	 struct	ec_tba {  *  * Transmit Buffer Descriptor  * This really should be a separate structure,  * but it will be convenient to lump them together.  */
name|u_short
name|count
decl_stmt|;
name|u_short
name|next_tbd_off
decl_stmt|;
name|caddr_t
name|buffer
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * Receive Frame Descriptor  */
end_comment

begin_struct
struct|struct
name|ec_rfd
block|{
name|u_short
name|rfd0
decl_stmt|;
name|u_short
name|rfd1
decl_stmt|;
name|u_short
name|next_off
decl_stmt|;
name|u_short
name|rbd_off
decl_stmt|;
name|struct
name|ether_header
name|eh
decl_stmt|;
name|u_short
name|mbz
decl_stmt|;
comment|/*  * };	struct	ec_rbd {  *  * Receive Buffer Descriptor  */
name|u_short
name|count
decl_stmt|;
define|#
directive|define
name|RBD_EOF
value|0x8000
define|#
directive|define
name|RBD_F
value|0x4000
name|u_short
name|next_rbd_off
decl_stmt|;
name|caddr_t
name|buffer
decl_stmt|;
name|u_short
name|size
decl_stmt|;
name|u_short
name|mbz2
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * Set Operating Parameters  */
end_comment

begin_struct
struct|struct
name|ec_82586params
block|{
name|u_char
name|count
decl_stmt|;
name|u_char
name|fifolimit
decl_stmt|;
name|u_char
name|save_bad_frames
decl_stmt|;
name|u_char
name|data1
decl_stmt|;
comment|/* addr len, no src ins, lpbk, prmble */
name|u_char
name|ifspacing
decl_stmt|;
name|u_char
name|mbz1
decl_stmt|;
name|u_char
name|data2
decl_stmt|;
comment|/* max restries, slot time high */
name|u_char
name|promisc
decl_stmt|;
comment|/* brddis, mnch/nrz, tnocr, crc16, bstf, pad */
define|#
directive|define
name|M_PROMISC
value|1
define|#
directive|define
name|M_TNOCR
value|4
name|u_char
name|cdf_cds
decl_stmt|;
comment|/* carrier detect/sense filter(length)& src */
name|u_char
name|min_frame_len
decl_stmt|;
name|u_char
name|mbz2
index|[
literal|3
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ec_configure
block|{
name|u_short
name|com0
decl_stmt|;
name|u_short
name|com1
decl_stmt|;
define|#
directive|define
name|COM1_CONFIGURE
value|0x2
name|u_short
name|next_off
decl_stmt|;
name|struct
name|ec_82586params
name|modes
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|ECMTU
value|1518
end_define

begin_define
define|#
directive|define
name|ECMINSIZE
value|64
end_define

begin_define
define|#
directive|define
name|NTXBUF
value|2
end_define

begin_define
define|#
directive|define
name|NRXBUF
value|8
end_define

begin_struct
struct|struct
name|ec_mem
block|{
name|struct
name|ec_iscp
name|iscp
decl_stmt|;
name|struct
name|ec_scb
name|scb
decl_stmt|;
name|struct
name|ec_transmit
name|tcom
index|[
name|NTXBUF
index|]
decl_stmt|;
name|struct
name|ec_rfd
name|rcom
index|[
name|NRXBUF
index|]
decl_stmt|;
name|struct
name|ec_configure
name|config
decl_stmt|;
name|struct
name|ec_iasetup
name|iasetup
decl_stmt|;
name|struct
name|ec_mcsetup
name|mcsetup
decl_stmt|;
name|char
name|txbuf
index|[
name|NTXBUF
index|]
index|[
name|ECMTU
index|]
decl_stmt|;
name|char
name|rxbuf
index|[
name|NRXBUF
index|]
index|[
name|ECMTU
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ec_ports
block|{
name|u_char
name|data
index|[
literal|6
index|]
decl_stmt|;
name|u_char
name|creg
decl_stmt|;
define|#
directive|define
name|R_ECID
value|0x00
define|#
directive|define
name|R_ETHER
value|0x01
define|#
directive|define
name|R_REV
value|0x02
define|#
directive|define
name|R_IEN
value|0x04
define|#
directive|define
name|R_INT
value|0x08
define|#
directive|define
name|R_LAD
value|0x10
define|#
directive|define
name|R_LPB
value|0x20
define|#
directive|define
name|R_CA
value|0x40
define|#
directive|define
name|R_NORST
value|0x80
name|u_char
name|mbz0
index|[
literal|3
index|]
decl_stmt|;
name|u_char
name|port_ic
decl_stmt|;
name|u_char
name|port_ca
decl_stmt|;
name|u_char
name|mbz1
decl_stmt|;
name|u_char
name|rom_conf
decl_stmt|;
name|u_char
name|ram_conf
decl_stmt|;
name|u_char
name|int_conf
decl_stmt|;
block|}
struct|;
end_struct

end_unit

