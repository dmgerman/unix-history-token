begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	autoconf.c	4.7	82/12/17	*/
end_comment

begin_include
include|#
directive|include
file|"../machine/pte.h"
end_include

begin_include
include|#
directive|include
file|"../h/param.h"
end_include

begin_include
include|#
directive|include
file|"../vax/cpu.h"
end_include

begin_include
include|#
directive|include
file|"../vax/nexus.h"
end_include

begin_include
include|#
directive|include
file|"../vaxuba/ubareg.h"
end_include

begin_include
include|#
directive|include
file|"../vaxmba/mbareg.h"
end_include

begin_include
include|#
directive|include
file|"../vax/mtpr.h"
end_include

begin_include
include|#
directive|include
file|"savax.h"
end_include

begin_define
define|#
directive|define
name|UTR
parameter_list|(
name|i
parameter_list|)
value|((struct uba_regs *)(NEX780+(i)))
end_define

begin_define
define|#
directive|define
name|UMA
parameter_list|(
name|i
parameter_list|)
value|((caddr_t)UMEM780(i))
end_define

begin_define
define|#
directive|define
name|MTR
parameter_list|(
name|i
parameter_list|)
value|((struct mba_regs *)(NEX780+(i)))
end_define

begin_decl_stmt
name|struct
name|uba_regs
modifier|*
name|ubaddr780
index|[]
init|=
block|{
name|UTR
argument_list|(
literal|3
argument_list|)
block|,
name|UTR
argument_list|(
literal|4
argument_list|)
block|,
name|UTR
argument_list|(
literal|5
argument_list|)
block|,
name|UTR
argument_list|(
literal|6
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|caddr_t
name|umaddr780
index|[]
init|=
block|{
name|UMA
argument_list|(
literal|0
argument_list|)
block|,
name|UMA
argument_list|(
literal|1
argument_list|)
block|,
name|UMA
argument_list|(
literal|2
argument_list|)
block|,
name|UMA
argument_list|(
literal|3
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mba_regs
modifier|*
name|mbaddr780
index|[]
init|=
block|{
name|MTR
argument_list|(
literal|8
argument_list|)
block|,
name|MTR
argument_list|(
literal|9
argument_list|)
block|,
name|MTR
argument_list|(
literal|10
argument_list|)
block|,
name|MTR
argument_list|(
literal|11
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|UTR
end_undef

begin_undef
undef|#
directive|undef
name|UMA
end_undef

begin_undef
undef|#
directive|undef
name|MTR
end_undef

begin_define
define|#
directive|define
name|UTR
parameter_list|(
name|i
parameter_list|)
value|((struct uba_regs *)(NEX750+(i)))
end_define

begin_define
define|#
directive|define
name|UMA
parameter_list|(
name|i
parameter_list|)
value|((caddr_t)UMEM750(i))
end_define

begin_define
define|#
directive|define
name|MTR
parameter_list|(
name|i
parameter_list|)
value|((struct mba_regs *)(NEX750+(i)))
end_define

begin_decl_stmt
name|struct
name|uba_regs
modifier|*
name|ubaddr750
index|[]
init|=
block|{
name|UTR
argument_list|(
literal|8
argument_list|)
block|,
name|UTR
argument_list|(
literal|9
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|caddr_t
name|umaddr750
index|[]
init|=
block|{
name|UMA
argument_list|(
literal|0
argument_list|)
block|,
name|UMA
argument_list|(
literal|1
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|mba_regs
modifier|*
name|mbaddr750
index|[]
init|=
block|{
name|MTR
argument_list|(
literal|4
argument_list|)
block|,
name|MTR
argument_list|(
literal|5
argument_list|)
block|,
name|MTR
argument_list|(
literal|6
argument_list|)
block|,
name|MTR
argument_list|(
literal|7
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|UTR
end_undef

begin_undef
undef|#
directive|undef
name|UMA
end_undef

begin_undef
undef|#
directive|undef
name|MTR
end_undef

begin_define
define|#
directive|define
name|UTR
parameter_list|(
name|i
parameter_list|)
value|((struct uba_regs *)(NEX730+(i)))
end_define

begin_define
define|#
directive|define
name|UMA
value|((caddr_t)UMEM730)
end_define

begin_decl_stmt
name|struct
name|uba_regs
modifier|*
name|ubaddr730
index|[]
init|=
block|{
name|UTR
argument_list|(
literal|3
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|caddr_t
name|umaddr730
index|[]
init|=
block|{
name|UMA
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|UTR
end_undef

begin_undef
undef|#
directive|undef
name|UMA
end_undef

begin_macro
name|configure
argument_list|()
end_macro

begin_block
block|{
name|union
name|cpusid
name|cpusid
decl_stmt|;
name|int
name|nmba
decl_stmt|,
name|nuba
decl_stmt|,
name|i
decl_stmt|;
name|cpusid
operator|.
name|cpusid
operator|=
name|mfpr
argument_list|(
name|SID
argument_list|)
expr_stmt|;
name|cpu
operator|=
name|cpusid
operator|.
name|cpuany
operator|.
name|cp_type
expr_stmt|;
switch|switch
condition|(
name|cpu
condition|)
block|{
case|case
name|VAX_780
case|:
name|mbaddr
operator|=
name|mbaddr780
expr_stmt|;
name|ubaddr
operator|=
name|ubaddr780
expr_stmt|;
name|umaddr
operator|=
name|umaddr780
expr_stmt|;
name|nmba
operator|=
sizeof|sizeof
argument_list|(
name|mbaddr780
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|mbaddr780
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|nuba
operator|=
sizeof|sizeof
argument_list|(
name|ubaddr780
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ubaddr780
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|VAX_750
case|:
name|mbaddr
operator|=
name|mbaddr750
expr_stmt|;
name|ubaddr
operator|=
name|ubaddr750
expr_stmt|;
name|umaddr
operator|=
name|umaddr750
expr_stmt|;
name|nmba
operator|=
sizeof|sizeof
argument_list|(
name|mbaddr750
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|mbaddr750
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|nuba
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|VAX_730
case|:
name|ubaddr
operator|=
name|ubaddr730
expr_stmt|;
name|umaddr
operator|=
name|umaddr730
expr_stmt|;
name|nmba
operator|=
name|nuba
operator|=
literal|0
expr_stmt|;
break|break;
block|}
comment|/* 	 * Forward into the past... 	 */
comment|/* 	for (i = 0; i< nmba; i++) 		if (!badloc(mbaddr[i])) 			mbaddr[i]->mba_cr = MBCR_INIT; */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nuba
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|badloc
argument_list|(
name|ubaddr
index|[
name|i
index|]
argument_list|)
condition|)
name|ubaddr
index|[
name|i
index|]
operator|->
name|uba_cr
operator|=
name|UBACR_ADINIT
expr_stmt|;
if|if
condition|(
name|cpu
operator|!=
name|VAX_780
condition|)
name|mtpr
argument_list|(
name|IUR
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* give unibus devices a chance to recover... */
if|if
condition|(
name|nuba
operator|>
literal|0
condition|)
name|DELAY
argument_list|(
literal|2000000
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

