begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	uipc_proto.c	4.2	81/11/08	*/
end_comment

begin_include
include|#
directive|include
file|"../h/param.h"
end_include

begin_include
include|#
directive|include
file|"../h/socket.h"
end_include

begin_include
include|#
directive|include
file|"../h/protocol.h"
end_include

begin_include
include|#
directive|include
file|"../h/protosw.h"
end_include

begin_include
include|#
directive|include
file|"../h/mbuf.h"
end_include

begin_include
include|#
directive|include
file|"../net/inet.h"
end_include

begin_comment
comment|/* should include a header file giving desired protocols */
end_comment

begin_define
define|#
directive|define
name|NTCP
value|1
end_define

begin_comment
comment|/*  * Protocol configuration table and routines to search it.  */
end_comment

begin_comment
comment|/*  * Generic (local or not yet specified) protocol.  */
end_comment

begin_function_decl
name|int
name|gen_usrreq
parameter_list|()
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|NTCP
operator|>
literal|0
end_if

begin_comment
comment|/*  * TCP/IP protocol family: IP, ICMP, UDP, TCP.  */
end_comment

begin_decl_stmt
name|int
name|ip_init
argument_list|()
decl_stmt|,
name|ip_input
argument_list|()
decl_stmt|,
name|ip_output
argument_list|()
decl_stmt|,
name|ip_advise
argument_list|()
decl_stmt|,
name|ip_slowtimo
argument_list|()
decl_stmt|,
name|ip_drain
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|icmp_input
argument_list|()
decl_stmt|,
name|icmp_drain
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|udp_input
argument_list|()
decl_stmt|,
name|udp_advise
argument_list|()
decl_stmt|,
name|udp_usrreq
argument_list|()
decl_stmt|,
name|udp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tcp_init
argument_list|()
decl_stmt|,
name|tcp_input
argument_list|()
decl_stmt|,
name|tcp_advise
argument_list|()
decl_stmt|,
name|tcp_fasttimo
argument_list|()
decl_stmt|,
name|tcp_slowtimo
argument_list|()
decl_stmt|,
name|tcp_usrreq
argument_list|()
decl_stmt|,
name|tcp_drain
argument_list|()
decl_stmt|,
name|tcp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ri_input
argument_list|()
decl_stmt|,
name|ri_advise
argument_list|()
decl_stmt|,
name|ri_usrreq
argument_list|()
decl_stmt|,
name|ri_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NPUP
operator|>
literal|0
end_if

begin_comment
comment|/*  * Pup protocols: PUP, BSP.  */
end_comment

begin_decl_stmt
name|int
name|pup1_input
argument_list|()
decl_stmt|,
name|pup1_output
argument_list|()
decl_stmt|,
name|pup1_advise
argument_list|()
decl_stmt|,
name|pup1_slowtimo
argument_list|()
decl_stmt|,
name|pup1_drain
argument_list|()
decl_stmt|,
name|pup1_usrreq
argument_list|()
decl_stmt|,
name|pup1_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|bsp_input
argument_list|()
decl_stmt|,
name|bsp_advise
argument_list|()
decl_stmt|,
name|bsp_fasttimo
argument_list|()
decl_stmt|,
name|bsp_slowtimo
argument_list|()
decl_stmt|,
name|bsp_drain
argument_list|()
decl_stmt|,
name|bsp_usrreq
argument_list|()
decl_stmt|,
name|bsp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rawpup_input
argument_list|()
decl_stmt|,
name|rawpup_usrreq
argument_list|()
decl_stmt|,
name|rawpup_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NCHAOS
operator|>
literal|0
end_if

begin_comment
comment|/*  * Chaosnet protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NOISCP
operator|>
literal|0
end_if

begin_comment
comment|/*  * Office information system communcation protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NNBS
operator|>
literal|0
end_if

begin_comment
comment|/*  * NBS protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NECMA
operator|>
literal|0
end_if

begin_comment
comment|/*  * ECMA protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NDATAKIT
operator|>
literal|0
end_if

begin_comment
comment|/*  * Datakit protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|struct
name|protosw
name|protosw
index|[]
init|=
block|{
block|{
name|SOCK_STREAM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_DGRAM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_RDM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
if|#
directive|if
name|NTCP
operator|>
literal|0
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|ip_init
block|,
name|ip_input
block|,
name|ip_output
block|,
literal|0
block|,
literal|0
block|,
name|ip_slowtimo
block|,
name|ip_drain
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
name|IPPROTO_ICMP
block|,
literal|0
block|,
literal|0
block|,
name|icmp_input
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|icmp_drain
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_DGRAM
block|,
name|PF_INET
block|,
name|IPPROTO_UDP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
name|udp_input
block|,
literal|0
block|,
name|udp_advise
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|udp_usrreq
block|,
name|udp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_STREAM
block|,
name|PF_INET
block|,
name|IPPROTO_TCP
block|,
literal|0
block|,
name|tcp_init
block|,
name|tcp_input
block|,
literal|0
block|,
name|tcp_advise
block|,
name|tcp_fasttimo
block|,
name|tcp_slowtimo
block|,
name|tcp_drain
block|,
name|tcp_usrreq
block|,
name|tcp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_INET
block|,
name|IPPROTO_RAW
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
name|ri_input
block|,
literal|0
block|,
name|ri_advise
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|ri_usrreq
block|,
name|ri_sense
block|,
name|MLEN
block|}
block|,
endif|#
directive|endif
if|#
directive|if
name|NPUP
operator|>
literal|0
block|{
name|SOCK_DGRAM
block|,
name|PF_PUP
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|pup_init
block|,
name|pup_input
block|,
name|pup_output
block|,
name|pup_advise
block|,
literal|0
block|,
name|pup_slowtimo
block|,
name|pup_drain
block|,
name|pup_usrreq
block|,
name|pup_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_STREAM
block|,
name|PF_PUP1
block|,
name|PUPPROTO_BSP
block|,
literal|0
block|,
name|bsp_init
block|,
name|bsp_input
block|,
literal|0
block|,
name|bsp_advise
block|,
name|bsp_fasttimo
block|,
name|bsp_slowtimo
block|,
name|bsp_drain
block|,
name|bsp_usrreq
block|,
name|bsp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_PUP1
block|,
name|PUPPROTO_RAW
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|rp_init
block|,
name|rp_input
block|,
literal|0
block|,
name|rp_advise
block|,
name|rp_fasttimo
block|,
name|rp_slowtimo
block|,
name|rp_drain
block|,
name|rp_usrreq
block|,
name|rp_sense
block|,
name|MLEN
block|}
block|,
endif|#
directive|endif
if|#
directive|if
name|NCHAOS
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NOISCP
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NNBS
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NECMA
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NDATAKIT
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|protoswEND
value|&protosw[sizeof (protosw)/sizeof (protosw[0])]
end_define

begin_comment
comment|/*  * Operations on protocol table and protocol families.  */
end_comment

begin_comment
comment|/*  * Find a standard protocol in a protocol family  * of a specific type.  */
end_comment

begin_function
name|struct
name|protosw
modifier|*
name|pf_findtype
parameter_list|(
name|family
parameter_list|,
name|type
parameter_list|)
name|int
name|family
decl_stmt|,
name|type
decl_stmt|;
block|{
specifier|register
name|struct
name|protosw
modifier|*
name|pr
decl_stmt|;
if|if
condition|(
name|family
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
name|pr
operator|=
name|protosw
init|;
name|pr
operator|<
name|protoswEND
condition|;
name|pr
operator|++
control|)
if|if
condition|(
name|pr
operator|->
name|pr_family
operator|==
name|family
operator|&&
name|pr
operator|->
name|pr_type
operator|==
name|type
condition|)
return|return
operator|(
name|pr
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Find a specified protocol in a specified protocol family.  */
end_comment

begin_function
name|struct
name|protosw
modifier|*
name|pf_findproto
parameter_list|(
name|family
parameter_list|,
name|protocol
parameter_list|)
name|int
name|family
decl_stmt|,
name|protocol
decl_stmt|;
block|{
specifier|register
name|struct
name|protosw
modifier|*
name|pr
decl_stmt|;
if|if
condition|(
name|family
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
name|pr
operator|=
name|protosw
init|;
name|pr
operator|<
name|protoswEND
condition|;
name|pr
operator|++
control|)
if|if
condition|(
name|pr
operator|->
name|pr_family
operator|==
name|family
operator|&&
name|pr
operator|->
name|pr_protocol
operator|==
name|protocol
condition|)
return|return
operator|(
name|pr
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|prinit
argument_list|()
end_macro

begin_block
block|{  }
end_block

end_unit

