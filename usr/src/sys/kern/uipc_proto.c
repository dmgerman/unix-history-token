begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"../h/param.h"
end_include

begin_include
include|#
directive|include
file|"../inet/protocol.h"
end_include

begin_include
include|#
directive|include
file|"../inet/protocolsw.h"
end_include

begin_comment
comment|/* should include a header file giving desired protocols */
end_comment

begin_define
define|#
directive|define
name|NTCP
value|1
end_define

begin_comment
comment|/*  * Protocol configuration table and routines to search it.  */
end_comment

begin_comment
comment|/*  * Generic (local or not yet specified) protocol.  */
end_comment

begin_function_decl
name|int
name|gen_usrreq
parameter_list|()
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|NTCP
operator|>
literal|0
end_if

begin_comment
comment|/*  * TCP/IP protocol family: IP, ICMP, UDP, TCP.  */
end_comment

begin_decl_stmt
name|int
name|ip_input
argument_list|()
decl_stmt|,
name|ip_output
argument_list|()
decl_stmt|,
name|ip_advise
argument_list|()
decl_stmt|,
name|ip_slowtimo
argument_list|()
decl_stmt|,
name|ip_drain
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|icmp_input
argument_list|()
decl_stmt|,
name|icmp_output
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|udp_input
argument_list|()
decl_stmt|,
name|udp_advise
argument_list|()
decl_stmt|,
name|udp_usrreq
argument_list|()
decl_stmt|,
name|udp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tcp_input
argument_list|()
decl_stmt|,
name|tcp_advise
argument_list|()
decl_stmt|,
name|tcp_fasttimo
argument_list|()
decl_stmt|,
name|tcp_slowtimo
argument_list|()
decl_stmt|,
name|tcp_drain
argument_list|()
decl_stmt|,
name|tcp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rawip_input
argument_list|()
decl_stmt|,
name|rawip_advise
argument_list|()
decl_stmt|,
name|rawip_advise
argument_list|()
decl_stmt|,
name|rawip_usrreq
argument_list|()
decl_stmt|,
name|rawip_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NPUP
operator|>
literal|0
end_if

begin_comment
comment|/*  * Pup protocols: PUP, BSP.  */
end_comment

begin_decl_stmt
name|int
name|pup1_input
argument_list|()
decl_stmt|,
name|pup1_output
argument_list|()
decl_stmt|,
name|pup1_advise
argument_list|()
decl_stmt|,
name|pup1_slowtimo
argument_list|()
decl_stmt|,
name|pup1_drain
argument_list|()
decl_stmt|,
name|pup1_usrreq
argument_list|()
decl_stmt|,
name|pup1_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|bsp_input
argument_list|()
decl_stmt|,
name|bsp_advise
argument_list|()
decl_stmt|,
name|bsp_fasttimo
argument_list|()
decl_stmt|,
name|bsp_slowtimo
argument_list|()
decl_stmt|,
name|bsp_drain
argument_list|()
decl_stmt|,
name|bsp_usrreq
argument_list|()
decl_stmt|,
name|bsp_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rawpup_input
argument_list|()
decl_stmt|,
name|rawpup_usrreq
argument_list|()
decl_stmt|,
name|rawpup_sense
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NCHAOS
operator|>
literal|0
end_if

begin_comment
comment|/*  * Chaosnet protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NOISCP
operator|>
literal|0
end_if

begin_comment
comment|/*  * Office information system communcation protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NNBS
operator|>
literal|0
end_if

begin_comment
comment|/*  * NBS protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NECMA
operator|>
literal|0
end_if

begin_comment
comment|/*  * ECMA protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|NDATAKIT
operator|>
literal|0
end_if

begin_comment
comment|/*  * Datakit protocols.  */
end_comment

begin_comment
comment|/* ... */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|struct
name|protosw
name|protosw
index|[]
init|=
block|{
block|{
name|SOCK_STREAM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_DGRAM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_RDM
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_GENERIC
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|gen_usrreq
block|,
literal|0
block|,
if|#
directive|if
name|NTCP
operator|>
literal|0
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|ip_input
block|,
name|ip_output
block|,
literal|0
block|,
literal|0
block|,
name|ip_slowtimo
block|,
name|ip_drain
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
name|IPPROTO_ICMP
block|,
literal|0
block|,
name|icmp_input
block|,
name|icmp_output
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|icmp_drain
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
name|SOCK_DGRAM
block|,
name|PF_INET
block|,
name|IPPROTO_UDP
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
name|udp_input
block|,
literal|0
block|,
name|udp_advise
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|udp_usrreq
block|,
name|udp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_STREAM
block|,
name|PF_INET
block|,
name|IPPROTO_TCP
block|,
literal|0
block|,
name|tcp_input
block|,
literal|0
block|,
name|tcp_advise
block|,
name|tcp_fasttimo
block|,
name|tcp_slowtimo
block|,
name|tcp_drain
block|,
name|tcp_usrreq
block|,
name|tcp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_INET
block|,
name|IPPROTO_RAW
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
name|ri_input
block|,
literal|0
block|,
name|ri_advise
block|,
name|ri_fasttimo
block|,
name|ri_slowtimo
block|,
name|ri_drain
block|,
name|ri_usrreq
block|,
name|ri_sense
block|,
name|MLEN
block|}
block|,
endif|#
directive|endif
if|#
directive|if
name|NPUP
operator|>
literal|0
block|{
name|SOCK_DGRAM
block|,
name|PF_PUP
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
name|pup_input
block|,
name|pup_output
block|,
name|pup_advise
block|,
literal|0
block|,
name|pup_slowtimo
block|,
name|pup_drain
block|,
name|pup_usrreq
block|,
name|pup_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_STREAM
block|,
name|PF_PUP1
block|,
name|PUPPROTO_BSP
block|,
literal|0
block|,
name|bsp_input
block|,
literal|0
block|,
name|bsp_advise
block|,
name|bsp_fasttimo
block|,
name|bsp_slowtimo
block|,
name|bsp_drain
block|,
name|bsp_usrreq
block|,
name|bsp_sense
block|,
name|MLEN
block|}
block|,
block|{
name|SOCK_RAW
block|,
name|PF_PUP1
block|,
name|PUPPROTO_RAW
block|,
name|PR_ATOMIC
operator||
name|PR_PROVIDEADDR
block|,
name|rp_input
block|,
literal|0
block|,
name|rp_advise
block|,
name|rp_fasttimo
block|,
name|rp_slowtimo
block|,
name|rp_drain
block|,
name|rp_usrreq
block|,
name|rp_sense
block|,
name|MLEN
block|}
block|,
endif|#
directive|endif
if|#
directive|if
name|NCHAOS
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NOISCP
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NNBS
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NECMA
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
if|#
directive|if
name|NDATAKIT
operator|>
literal|0
comment|/* ... */
endif|#
directive|endif
block|}
block|;
define|#
directive|define
name|protoswEND
value|&protosw[sizeof (protosw)/sizeof (protosw[0])]
comment|/*  * Operations on protocol table and protocol families.  */
comment|/*  * Find a standard protocol in a protocol family  * of a specific type.  */
name|pf_stdproto
argument_list|(
argument|family
argument_list|,
argument|type
argument_list|)
name|int
name|family
block|,
name|type
block|;
block|{
specifier|register
expr|struct
name|protosw
operator|*
name|pr
block|;
if|if
condition|(
name|family
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
name|pr
operator|=
name|protosw
init|;
name|pr
operator|<
name|protoswEND
condition|;
name|pr
operator|++
control|)
if|if
condition|(
name|pr
operator|->
name|pr_family
operator|==
name|family
operator|&&
name|pr
operator|->
name|pr_type
operator|==
name|type
condition|)
return|return
operator|(
name|pr
operator|)
return|;
end_decl_stmt

begin_return
return|return
operator|(
literal|0
operator|)
return|;
end_return

begin_comment
unit|}
comment|/*  * Find a specified protocol in a specified protocol family.  */
end_comment

begin_expr_stmt
unit|pf_findproto
operator|(
name|family
operator|,
name|proto
operator|)
name|int
name|family
operator|,
name|proto
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|struct
name|protosw
modifier|*
name|pr
decl_stmt|;
if|if
condition|(
name|family
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
for|for
control|(
name|pr
operator|=
name|protosw
init|;
name|pr
operator|<
name|protoswEND
condition|;
name|pr
operator|++
control|)
if|if
condition|(
name|pr
operator|->
name|pr_family
operator|==
name|family
operator|&&
name|pr
operator|->
name|pr_proto
operator|==
name|proto
condition|)
return|return
operator|(
name|pr
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

