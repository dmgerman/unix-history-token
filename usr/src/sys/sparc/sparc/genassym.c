begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992 The Regents of the University of California.  * All rights reserved.  *  * This software was developed by the Computer Systems Engineering group  * at Lawrence Berkeley Laboratory under DARPA contract BG 91-66 and  * contributed to Berkeley.  *  * All advertising materials mentioning features or use of this software  * must display the following acknowledgement:  *	This product includes software developed by the University of  *	California, Lawrence Berkeley Laboratories.  *  * %sccs.include.redist.c%  *  *	@(#)genassym.c	7.2 (Berkeley) %G%  *  * from: $Header: genassym.c,v 1.12 92/06/28 10:13:01 mccanne $ (LBL)  */
end_comment

begin_include
include|#
directive|include
file|"sys/param.h"
end_include

begin_include
include|#
directive|include
file|"sys/buf.h"
end_include

begin_include
include|#
directive|include
file|"sys/proc.h"
end_include

begin_include
include|#
directive|include
file|"sys/map.h"
end_include

begin_include
include|#
directive|include
file|"sys/proc.h"
end_include

begin_include
include|#
directive|include
file|"sys/mbuf.h"
end_include

begin_include
include|#
directive|include
file|"sys/msgbuf.h"
end_include

begin_include
include|#
directive|include
file|"sys/syscall.h"
end_include

begin_include
include|#
directive|include
file|"sys/user.h"
end_include

begin_include
include|#
directive|include
file|"machine/pmap.h"
end_include

begin_include
include|#
directive|include
file|"machine/psl.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_include
include|#
directive|include
file|"../dev/zsreg.h"
end_include

begin_include
include|#
directive|include
file|"../dev/zsvar.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"../dev/bsd_audioreg.h"
end_include

begin_include
include|#
directive|include
file|"../dev/bsd_audiovar.h"
end_include

begin_include
include|#
directive|include
file|"intreg.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_comment
comment|/*nclude<stddef.h>*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|offsetof
end_ifndef

begin_define
define|#
directive|define
name|offsetof
parameter_list|(
name|str
parameter_list|,
name|mem
parameter_list|)
value|((size_t)&((str *)0)->mem)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|off
parameter_list|(
name|what
parameter_list|,
name|str
parameter_list|,
name|mem
parameter_list|)
value|def(what, (int)offsetof(str, mem))
end_define

begin_function
name|void
name|def
parameter_list|(
name|what
parameter_list|,
name|where
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|;
name|int
name|where
decl_stmt|;
block|{
if|if
condition|(
name|printf
argument_list|(
literal|"#define\t%s\t%d\n"
argument_list|,
name|what
argument_list|,
name|where
argument_list|)
operator|<
literal|0
condition|)
block|{
name|perror
argument_list|(
literal|"printf"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|flush
parameter_list|()
block|{
if|if
condition|(
name|fflush
argument_list|(
name|stdout
argument_list|)
condition|)
block|{
name|perror
argument_list|(
literal|"fflush"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|main
parameter_list|()
block|{
comment|/* general constants */
name|def
argument_list|(
literal|"BSD"
argument_list|,
name|BSD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"UPAGES"
argument_list|,
name|UPAGES
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"NBPG"
argument_list|,
name|NBPG
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"KERNBASE"
argument_list|,
name|KERNBASE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"USRSTACK"
argument_list|,
name|USRSTACK
argument_list|)
expr_stmt|;
comment|/* proc fields and values */
name|off
argument_list|(
literal|"P_ADDR"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_addr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_STAT"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_stat
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_WCHAN"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_wchan
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_VMSPACE"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_vmspace
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_RTIME"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_rtime
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SRUN"
argument_list|,
name|SRUN
argument_list|)
expr_stmt|;
comment|/* VM structure fields */
name|off
argument_list|(
literal|"VM_PMAP"
argument_list|,
expr|struct
name|vmspace
argument_list|,
name|vm_pmap
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"VM_PMAP_CTX"
argument_list|,
expr|struct
name|vmspace
argument_list|,
name|vm_pmap
operator|.
name|pm_ctx
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"VM_PMAP_CTXNUM"
argument_list|,
expr|struct
name|vmspace
argument_list|,
name|vm_pmap
operator|.
name|pm_ctxnum
argument_list|)
expr_stmt|;
comment|/* interrupt/fault metering */
name|off
argument_list|(
literal|"V_SWTCH"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_swtch
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"V_INTR"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_intr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"V_FAULTS"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_faults
argument_list|)
expr_stmt|;
comment|/* PTE bits and related information */
name|def
argument_list|(
literal|"PG_W"
argument_list|,
name|PG_W
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_VSHIFT"
argument_list|,
name|PG_VSHIFT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_PROTSHIFT"
argument_list|,
name|PG_PROTSHIFT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_PROTUREAD"
argument_list|,
name|PG_PROTUREAD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_PROTUWRITE"
argument_list|,
name|PG_PROTUWRITE
argument_list|)
expr_stmt|;
comment|/* FPU state */
name|off
argument_list|(
literal|"FS_REGS"
argument_list|,
expr|struct
name|fpstate
argument_list|,
name|fs_regs
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FS_FSR"
argument_list|,
expr|struct
name|fpstate
argument_list|,
name|fs_fsr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FS_QSIZE"
argument_list|,
expr|struct
name|fpstate
argument_list|,
name|fs_qsize
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FS_QUEUE"
argument_list|,
expr|struct
name|fpstate
argument_list|,
name|fs_queue
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"FSR_QNE"
argument_list|,
name|FSR_QNE
argument_list|)
expr_stmt|;
comment|/* system calls */
name|def
argument_list|(
literal|"SYS_sigreturn"
argument_list|,
name|SYS_sigreturn
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_execve"
argument_list|,
name|SYS_execve
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_exit"
argument_list|,
name|SYS_exit
argument_list|)
expr_stmt|;
comment|/* errno */
name|def
argument_list|(
literal|"EFAULT"
argument_list|,
name|EFAULT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"ENAMETOOLONG"
argument_list|,
name|ENAMETOOLONG
argument_list|)
expr_stmt|;
comment|/* PCB fields */
name|off
argument_list|(
literal|"PCB_NSAVED"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_nsaved
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_ONFAULT"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_onfault
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_PSR"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_psr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_RW"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_rw
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_SP"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_sp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_PC"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_pc
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_UW"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_uw
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_WIM"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_wim
argument_list|)
expr_stmt|;
comment|/* interrupt enable register PTE */
name|def
argument_list|(
literal|"IE_REG_PTE"
argument_list|,
name|PG_V
operator||
name|PG_W
operator||
name|PG_S
operator||
name|PG_NC
operator||
name|PG_OBIO
operator||
operator|(
operator|(
name|u_int
operator|)
name|INT_ENABLE_REG_PHYSADR
operator|>>
name|PGSHIFT
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notyet
comment|/* ZSCC interrupt fields */
name|off
argument_list|(
literal|"ZSC_A"
argument_list|,
expr|struct
name|zs_softc
argument_list|,
name|sc_a
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"ZSC_B"
argument_list|,
expr|struct
name|zs_softc
argument_list|,
name|sc_b
argument_list|)
expr_stmt|;
comment|/*	off("ZL_WREG", struct zs_line, zl_wreg); */
name|off
argument_list|(
literal|"ZL_TBC"
argument_list|,
expr|struct
name|zs_line
argument_list|,
name|zl_tbc
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"ZL_TBA"
argument_list|,
expr|struct
name|zs_line
argument_list|,
name|zl_tba
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"ZL_RBPUT"
argument_list|,
expr|struct
name|zs_line
argument_list|,
name|zl_rbput
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"ZL_RBUF"
argument_list|,
expr|struct
name|zs_line
argument_list|,
name|zl_rbuf
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"ZSRR1_DO_bit"
argument_list|,
name|ffs
argument_list|(
name|ZSRR1_DO
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* audio trap handler fields */
name|def
argument_list|(
literal|"AUCB_SIZE"
argument_list|,
name|AUCB_SIZE
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_HEAD"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_head
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_TAIL"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_tail
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_PAUSE"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_pause
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_DATA"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_data
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_DROPS"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_drops
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_PDROPS"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_drops
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_THRESH"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_thresh
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"CB_WAKING"
argument_list|,
expr|struct
name|aucb
argument_list|,
name|cb_waking
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AU_AMD"
argument_list|,
expr|struct
name|auio
argument_list|,
name|au_amd
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AU_RB"
argument_list|,
expr|struct
name|auio
argument_list|,
name|au_rb
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AU_WB"
argument_list|,
expr|struct
name|auio
argument_list|,
name|au_wb
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AU_STAMP"
argument_list|,
expr|struct
name|auio
argument_list|,
name|au_stamp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AMD_IR"
argument_list|,
expr|struct
name|amd7930
argument_list|,
name|ir
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AMD_BBRB"
argument_list|,
expr|struct
name|amd7930
argument_list|,
name|bbrb
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"AMD_BBTB"
argument_list|,
expr|struct
name|amd7930
argument_list|,
name|bbtb
argument_list|)
expr_stmt|;
name|flush
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

