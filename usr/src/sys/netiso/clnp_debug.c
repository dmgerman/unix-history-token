begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1991 The Regents of the University of California.  * All rights reserved.  *  * %sccs.include.redist.c%  *  *	@(#)clnp_debug.c	7.11 (Berkeley) %G%  */
end_comment

begin_comment
comment|/*********************************************************** 		Copyright IBM Corporation 1987                        All Rights Reserved  Permission to use, copy, modify, and distribute this software and its  documentation for any purpose and without fee is hereby granted,  provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in  supporting documentation, and that the name of IBM not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission.    IBM DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL IBM BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.  ******************************************************************/
end_comment

begin_comment
comment|/*  * ARGO Project, Computer Sciences Dept., University of Wisconsin - Madison  */
end_comment

begin_comment
comment|/* $Header: clnp_debug.c,v 4.2 88/06/29 14:58:34 hagens Exp $ */
end_comment

begin_comment
comment|/* $Source: /usr/argo/sys/netargo/RCS/clnp_debug.c,v $ */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/domain.h>
end_include

begin_include
include|#
directive|include
file|<sys/protosw.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/socketvar.h>
end_include

begin_include
include|#
directive|include
file|<sys/errno.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/route.h>
end_include

begin_include
include|#
directive|include
file|<netiso/iso.h>
end_include

begin_include
include|#
directive|include
file|<netiso/clnp.h>
end_include

begin_include
include|#
directive|include
file|<netiso/clnp_stat.h>
end_include

begin_include
include|#
directive|include
file|<netiso/argo_debug.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ARGO_DEBUG
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|TESTDEBUG
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|notdef
end_ifdef

begin_decl_stmt
name|struct
name|addr_37
name|u_37
init|=
block|{
block|{
literal|0x00
block|,
literal|0x02
block|,
literal|0x00
block|,
literal|0x10
block|,
literal|0x20
block|,
literal|0x30
block|,
literal|0x35
block|}
block|,
block|{
literal|0x01
block|,
literal|0x02
block|,
literal|0x03
block|,
literal|0x04
block|,
literal|0x50
block|,
literal|0x60
block|,
literal|0x70
block|,
literal|0x80
block|,
literal|0x90
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|addr_osinet
name|u_osinet
init|=
block|{
block|{
literal|0x00
block|,
literal|0x04
block|}
block|,
block|{
literal|0x00
block|,
literal|0x02
block|,
literal|0x00
block|,
literal|0x01
block|,
literal|0x23
block|,
literal|0x42
block|,
literal|0x78
block|,
literal|0x20
block|,
literal|0x01
block|,
literal|0x05
block|,
literal|0x00
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* notdef */
end_comment

begin_decl_stmt
name|struct
name|addr_rfc986
name|u_rfc986
init|=
block|{
block|{
literal|0x00
block|,
literal|0x06
block|}
block|,
block|{
literal|0x01
block|,
literal|0xc0
block|,
literal|0x0c
block|,
literal|0x0c
block|,
literal|0xab
block|,
literal|0x11
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|addr_rfc986
name|u_bad
init|=
block|{
block|{
literal|0x00
block|,
literal|0x01
block|}
block|,
block|{
literal|0x01
block|,
literal|0xc0
block|,
literal|0x0c
block|,
literal|0x0c
block|,
literal|0xab
block|,
literal|0x11
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_function
name|main
parameter_list|()
block|{
name|struct
name|iso_addr
name|a
decl_stmt|;
name|a
operator|.
name|isoa_afi
operator|=
name|AFI_37
expr_stmt|;
name|a
operator|.
name|isoa_u
operator|.
name|addr_37
operator|=
name|u_37
expr_stmt|;
name|a
operator|.
name|isoa_len
operator|=
literal|17
expr_stmt|;
name|printf
argument_list|(
literal|"type 37: %s\n"
argument_list|,
name|clnp_iso_addrp
argument_list|(
operator|&
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|.
name|isoa_afi
operator|=
name|AFI_OSINET
expr_stmt|;
name|a
operator|.
name|isoa_u
operator|.
name|addr_osinet
operator|=
name|u_osinet
expr_stmt|;
name|a
operator|.
name|isoa_len
operator|=
literal|14
expr_stmt|;
name|printf
argument_list|(
literal|"type osinet: %s\n"
argument_list|,
name|clnp_iso_addrp
argument_list|(
operator|&
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|.
name|isoa_afi
operator|=
name|AFI_RFC986
expr_stmt|;
name|a
operator|.
name|isoa_u
operator|.
name|addr_rfc986
operator|=
name|u_rfc986
expr_stmt|;
name|a
operator|.
name|isoa_len
operator|=
literal|9
expr_stmt|;
name|printf
argument_list|(
literal|"type rfc986: %s\n"
argument_list|,
name|clnp_iso_addrp
argument_list|(
operator|&
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|.
name|isoa_afi
operator|=
literal|12
expr_stmt|;
name|a
operator|.
name|isoa_u
operator|.
name|addr_rfc986
operator|=
name|u_rfc986
expr_stmt|;
name|a
operator|.
name|isoa_len
operator|=
literal|9
expr_stmt|;
name|printf
argument_list|(
literal|"type bad afi: %s\n"
argument_list|,
name|clnp_iso_addrp
argument_list|(
operator|&
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|.
name|isoa_afi
operator|=
name|AFI_RFC986
expr_stmt|;
name|a
operator|.
name|isoa_u
operator|.
name|addr_rfc986
operator|=
name|u_bad
expr_stmt|;
name|a
operator|.
name|isoa_len
operator|=
literal|9
expr_stmt|;
name|printf
argument_list|(
literal|"type bad idi: %s\n"
argument_list|,
name|clnp_iso_addrp
argument_list|(
operator|&
name|a
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* TESTDEBUG */
end_comment

begin_decl_stmt
name|unsigned
name|int
name|clnp_debug
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|letters
index|[]
init|=
literal|"0123456789abcdef"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *	Print buffer in hex, return addr of where we left off.  *	Do not null terminate.  */
end_comment

begin_function
name|char
modifier|*
name|clnp_hexp
parameter_list|(
name|src
parameter_list|,
name|len
parameter_list|,
name|where
parameter_list|)
name|char
modifier|*
name|src
decl_stmt|;
comment|/* src of data to print */
name|int
name|len
decl_stmt|;
comment|/* lengthof src */
name|char
modifier|*
name|where
decl_stmt|;
comment|/* where to put data */
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
specifier|register
name|int
name|j
init|=
operator|(
operator|(
name|u_char
operator|*
operator|)
name|src
operator|)
index|[
name|i
index|]
decl_stmt|;
operator|*
name|where
operator|++
operator|=
name|letters
index|[
name|j
operator|>>
literal|4
index|]
expr_stmt|;
operator|*
name|where
operator|++
operator|=
name|letters
index|[
name|j
operator|&
literal|0x0f
index|]
expr_stmt|;
block|}
return|return
name|where
return|;
block|}
end_function

begin_comment
comment|/*  *	Return a ptr to a human readable form of an iso addr   */
end_comment

begin_decl_stmt
specifier|static
name|char
name|iso_addr_b
index|[
literal|50
index|]
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|DELIM
value|'.';
end_define

begin_function
name|char
modifier|*
name|clnp_iso_addrp
parameter_list|(
name|isoa
parameter_list|)
name|struct
name|iso_addr
modifier|*
name|isoa
decl_stmt|;
block|{
name|char
modifier|*
name|cp
decl_stmt|;
comment|/* print length */
name|sprintf
argument_list|(
name|iso_addr_b
argument_list|,
literal|"[%d] "
argument_list|,
name|isoa
operator|->
name|isoa_len
argument_list|)
expr_stmt|;
comment|/* set cp to end of what we have */
name|cp
operator|=
name|iso_addr_b
expr_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
name|cp
operator|++
expr_stmt|;
comment|/* print afi */
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|isoa
operator|->
name|isoa_genaddr
argument_list|,
operator|(
name|int
operator|)
name|isoa
operator|->
name|isoa_len
argument_list|,
name|cp
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notdef
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
comment|/* print type specific part */
switch|switch
condition|(
name|isoa
operator|->
name|isoa_afi
condition|)
block|{
case|case
name|AFI_37
case|:
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|isoa
operator|->
name|t37_idi
argument_list|,
name|ADDR37_IDI_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|isoa
operator|->
name|t37_dsp
argument_list|,
name|ADDR37_DSP_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
break|break;
comment|/* 		case AFI_OSINET:*/
case|case
name|AFI_RFC986
case|:
block|{
name|u_short
name|idi
decl_stmt|;
comment|/* osinet and rfc986 have idi in the same place */
comment|/* print idi */
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|isoa
operator|->
name|rfc986_idi
argument_list|,
name|ADDROSINET_IDI_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|CTOH
argument_list|(
name|isoa
operator|->
name|rfc986_idi
index|[
literal|0
index|]
argument_list|,
name|isoa
operator|->
name|rfc986_idi
index|[
literal|1
index|]
argument_list|,
name|idi
argument_list|)
expr_stmt|;
if|if
condition|(
name|idi
operator|==
name|IDI_OSINET
condition|)
block|{
name|struct
name|ovl_osinet
modifier|*
name|oosi
init|=
operator|(
expr|struct
name|ovl_osinet
operator|*
operator|)
name|isoa
decl_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|oosi
operator|->
name|oosi_orgid
argument_list|,
name|OVLOSINET_ORGID_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|oosi
operator|->
name|oosi_snetid
argument_list|,
name|OVLOSINET_SNETID_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|oosi
operator|->
name|oosi_snpa
argument_list|,
name|OVLOSINET_SNPA_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|oosi
operator|->
name|oosi_nsap
argument_list|,
name|OVLOSINET_NSAP_LEN
argument_list|,
name|cp
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|idi
operator|==
name|IDI_RFC986
condition|)
block|{
name|struct
name|ovl_rfc986
modifier|*
name|o986
init|=
operator|(
expr|struct
name|ovl_rfc986
operator|*
operator|)
name|isoa
decl_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_vers
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
ifdef|#
directive|ifdef
name|vax
name|sprintf
argument_list|(
name|cp
argument_list|,
literal|"%d.%d.%d.%d.%d"
argument_list|,
name|o986
operator|->
name|o986_inetaddr
index|[
literal|0
index|]
operator|&
literal|0xff
argument_list|,
name|o986
operator|->
name|o986_inetaddr
index|[
literal|1
index|]
operator|&
literal|0xff
argument_list|,
name|o986
operator|->
name|o986_inetaddr
index|[
literal|2
index|]
operator|&
literal|0xff
argument_list|,
name|o986
operator|->
name|o986_inetaddr
index|[
literal|3
index|]
operator|&
literal|0xff
argument_list|,
name|o986
operator|->
name|o986_upid
operator|&
literal|0xff
argument_list|)
expr_stmt|;
return|return
operator|(
name|iso_addr_b
operator|)
return|;
else|#
directive|else
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_inetaddr
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_inetaddr
index|[
literal|1
index|]
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_inetaddr
index|[
literal|2
index|]
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_inetaddr
index|[
literal|3
index|]
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
name|DELIM
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
operator|&
name|o986
operator|->
name|o986_upid
argument_list|,
literal|1
argument_list|,
name|cp
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* vax */
block|}
block|}
break|break;
default|default:
operator|*
name|cp
operator|++
operator|=
literal|'?'
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
comment|/* notdef */
operator|*
name|cp
operator|=
operator|(
name|char
operator|)
literal|0
expr_stmt|;
return|return
operator|(
name|iso_addr_b
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|clnp_saddr_isop
parameter_list|(
name|s
parameter_list|)
specifier|register
name|struct
name|sockaddr_iso
modifier|*
name|s
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|cp
init|=
name|clnp_iso_addrp
argument_list|(
operator|&
name|s
operator|->
name|siso_addr
argument_list|)
decl_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
name|cp
operator|++
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
literal|'('
expr_stmt|;
name|cp
operator|=
name|clnp_hexp
argument_list|(
name|TSEL
argument_list|(
name|s
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|s
operator|->
name|siso_tlen
argument_list|,
name|cp
argument_list|)
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
literal|')'
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|iso_addr_b
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ARGO_DEBUG */
end_comment

end_unit

