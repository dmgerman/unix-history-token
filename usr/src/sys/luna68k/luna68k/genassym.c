begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1992 OMRON Corporation.  * Copyright (c) 1982, 1990, 1992, 1993  *	The Regents of the University of California.  All rights reserved.  *  * %sccs.include.redist.c%  *  * from: hp300/hp300/genassym.c	7.14 (Berkeley) 12/30/92  *  *	@(#)genassym.c	8.2 (Berkeley) %G%  */
end_comment

begin_define
define|#
directive|define
name|KERNEL
end_define

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/buf.h>
end_include

begin_include
include|#
directive|include
file|<sys/map.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/msgbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/syscall.h>
end_include

begin_include
include|#
directive|include
file|<sys/user.h>
end_include

begin_include
include|#
directive|include
file|<machine/cpu.h>
end_include

begin_include
include|#
directive|include
file|<machine/trap.h>
end_include

begin_include
include|#
directive|include
file|<machine/psl.h>
end_include

begin_include
include|#
directive|include
file|<machine/reg.h>
end_include

begin_include
include|#
directive|include
file|<machine/stinger.h>
end_include

begin_include
include|#
directive|include
file|<luna68k/dev/pioreg.h>
end_include

begin_include
include|#
directive|include
file|<luna68k/luna68k/clockreg.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<luna68k/luna68k/pte.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stddef.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|def
parameter_list|(
name|what
parameter_list|,
name|val
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|;
name|int
name|val
decl_stmt|;
block|{
if|if
condition|(
name|printf
argument_list|(
literal|"#define\t%s\t%d\n"
argument_list|,
name|what
argument_list|,
name|val
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"genassym: printf: %s\n"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|flush
parameter_list|()
block|{
if|if
condition|(
name|fflush
argument_list|(
name|stdout
argument_list|)
operator|||
name|fsync
argument_list|(
name|fileno
argument_list|(
name|stdout
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"genassym: flush stdout: %s\n"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|off
parameter_list|(
name|what
parameter_list|,
name|s
parameter_list|,
name|m
parameter_list|)
value|def(what, (int)offsetof(s, m))
end_define

begin_function
name|main
parameter_list|()
block|{
name|struct
name|pio
modifier|*
name|pio
init|=
operator|(
expr|struct
name|pio
operator|*
operator|)
name|PIO0_ADDR
decl_stmt|;
specifier|register
name|unsigned
name|i
decl_stmt|;
name|def
argument_list|(
literal|"UPAGES"
argument_list|,
name|UPAGES
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"NBPG"
argument_list|,
name|NBPG
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PGSHIFT"
argument_list|,
name|PGSHIFT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"USRSTACK"
argument_list|,
name|USRSTACK
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"KERNELSTACK"
argument_list|,
name|KERNELSTACK
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"KIFF_SIZE"
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|KernInter
argument_list|)
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"KI_MAXADDR"
argument_list|,
expr|struct
name|KernInter
argument_list|,
name|maxaddr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_FORW"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_forw
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_BACK"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_back
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_VMSPACE"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_vmspace
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_ADDR"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_addr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_PRIORITY"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_priority
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_STAT"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_stat
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_WCHAN"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_wchan
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_FLAG"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_flag
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_MDFLAG"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_md
operator|.
name|md_flags
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SSLEEP"
argument_list|,
name|SSLEEP
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SRUN"
argument_list|,
name|SRUN
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"VM_PMAP"
argument_list|,
expr|struct
name|vmspace
argument_list|,
name|vm_pmap
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PM_STCHG"
argument_list|,
expr|struct
name|pmap
argument_list|,
name|pm_stchanged
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"V_SWTCH"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_swtch
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"V_INTR"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_intr
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_BUSERR"
argument_list|,
name|T_BUSERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ADDRERR"
argument_list|,
name|T_ADDRERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ILLINST"
argument_list|,
name|T_ILLINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ZERODIV"
argument_list|,
name|T_ZERODIV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_CHKINST"
argument_list|,
name|T_CHKINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRAPVINST"
argument_list|,
name|T_TRAPVINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_PRIVINST"
argument_list|,
name|T_PRIVINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRACE"
argument_list|,
name|T_TRACE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_MMUFLT"
argument_list|,
name|T_MMUFLT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_SSIR"
argument_list|,
name|T_SSIR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FMTERR"
argument_list|,
name|T_FMTERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_COPERR"
argument_list|,
name|T_COPERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPERR"
argument_list|,
name|T_FPERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ASTFLT"
argument_list|,
name|T_ASTFLT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRAP15"
argument_list|,
name|T_TRAP15
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPEMULI"
argument_list|,
name|T_FPEMULI
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPEMULD"
argument_list|,
name|T_FPEMULD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_S"
argument_list|,
name|PSL_S
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_IPL7"
argument_list|,
name|PSL_IPL7
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_LOWIPL"
argument_list|,
name|PSL_LOWIPL
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_HIGHIPL"
argument_list|,
name|PSL_HIGHIPL
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_USER"
argument_list|,
name|PSL_USER
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL1"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL1
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL2"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL2
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL3"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL3
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL4"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL4
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL5"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL5
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL6"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL6
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"FC_USERD"
argument_list|,
name|FC_USERD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"FC_PURGE"
argument_list|,
name|FC_PURGE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_ON"
argument_list|,
name|CACHE_ON
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_OFF"
argument_list|,
name|CACHE_OFF
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_CLR"
argument_list|,
name|CACHE_CLR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"IC_CLEAR"
argument_list|,
name|IC_CLEAR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"DC_CLEAR"
argument_list|,
name|DC_CLEAR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_V"
argument_list|,
name|PG_V
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_NV"
argument_list|,
name|PG_NV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_RO"
argument_list|,
name|PG_RO
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_RW"
argument_list|,
name|PG_RW
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_CI"
argument_list|,
name|PG_CI
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_PROT"
argument_list|,
name|PG_PROT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_FRAME"
argument_list|,
name|PG_FRAME
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_V"
argument_list|,
name|SG_V
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_NV"
argument_list|,
name|SG_NV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_RW"
argument_list|,
name|SG_RW
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_FRAME"
argument_list|,
name|SG_FRAME
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_ISHIFT"
argument_list|,
name|SG_ISHIFT
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_FLAGS"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_flags
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_PS"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_ps
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_USTP"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_ustp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_USP"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_usp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_REGS"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_regs
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_ONFAULT"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_onfault
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_FPCTX"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_fpregs
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SIZEOF_PCB"
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|pcb
argument_list|)
argument_list|)
expr_stmt|;
comment|/* exception frame offset/sizes */
name|off
argument_list|(
literal|"FR_SP"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_regs
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FR_HW"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_sr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FR_ADJ"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_stackadj
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_exit"
argument_list|,
name|SYS_exit
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_execve"
argument_list|,
name|SYS_execve
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_sigreturn"
argument_list|,
name|SYS_sigreturn
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"EFAULT"
argument_list|,
name|EFAULT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"ENAMETOOLONG"
argument_list|,
name|ENAMETOOLONG
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CLOCK_REG"
argument_list|,
name|CLOCK_REG
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CLK_INT"
argument_list|,
name|CLK_INT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CLK_CLR"
argument_list|,
name|CLK_CLR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PIO0_A"
argument_list|,
operator|&
name|pio
operator|->
name|a_port
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PIO0_B"
argument_list|,
operator|&
name|pio
operator|->
name|b_port
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PIO0_CTL"
argument_list|,
operator|&
name|pio
operator|->
name|control_port
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PIO_MODED"
argument_list|,
name|PIO_MODED
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|OLD_LUNA
name|def
argument_list|(
literal|"FLINE_VEC"
argument_list|,
literal|44
argument_list|)
expr_stmt|;
comment|/* F-Line excep vector offset */
name|def
argument_list|(
literal|"COPRO_VEC"
argument_list|,
literal|52
argument_list|)
expr_stmt|;
comment|/* Coprocessor prot. offset */
endif|#
directive|endif
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

