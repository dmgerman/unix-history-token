begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1982, 1990, 1993  *	The Regents of the University of California.  All rights reserved.  *  * %sccs.include.redist.c%  *  *	@(#)genassym.c	8.3 (Berkeley) %G%  */
end_comment

begin_define
define|#
directive|define
name|KERNEL
end_define

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/buf.h>
end_include

begin_include
include|#
directive|include
file|<sys/map.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/msgbuf.h>
end_include

begin_include
include|#
directive|include
file|<sys/syscall.h>
end_include

begin_include
include|#
directive|include
file|<sys/user.h>
end_include

begin_include
include|#
directive|include
file|<machine/cpu.h>
end_include

begin_include
include|#
directive|include
file|<machine/trap.h>
end_include

begin_include
include|#
directive|include
file|<machine/psl.h>
end_include

begin_include
include|#
directive|include
file|<machine/reg.h>
end_include

begin_include
include|#
directive|include
file|<hp300/hp300/clockreg.h>
end_include

begin_include
include|#
directive|include
file|<vm/vm.h>
end_include

begin_include
include|#
directive|include
file|<hp300/hp300/pte.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|USELEDS
end_ifdef

begin_include
include|#
directive|include
file|<hp300/hp300/led.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stddef.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|def
parameter_list|(
name|what
parameter_list|,
name|val
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|;
name|int
name|val
decl_stmt|;
block|{
if|if
condition|(
name|printf
argument_list|(
literal|"#define\t%s\t%d\n"
argument_list|,
name|what
argument_list|,
name|val
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"genassym: printf: %s\n"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|flush
parameter_list|()
block|{
if|if
condition|(
name|fflush
argument_list|(
name|stdout
argument_list|)
operator|||
name|fsync
argument_list|(
name|fileno
argument_list|(
name|stdout
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"genassym: flush stdout: %s\n"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|off
parameter_list|(
name|what
parameter_list|,
name|s
parameter_list|,
name|m
parameter_list|)
value|def(what, (int)offsetof(s, m))
end_define

begin_function
name|main
parameter_list|()
block|{
comment|/* general constants */
name|def
argument_list|(
literal|"UPAGES"
argument_list|,
name|UPAGES
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"NBPG"
argument_list|,
name|NBPG
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PGSHIFT"
argument_list|,
name|PGSHIFT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"USRSTACK"
argument_list|,
name|USRSTACK
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MAXADDR"
argument_list|,
name|MAXADDR
argument_list|)
expr_stmt|;
comment|/* proc fields and values */
name|off
argument_list|(
literal|"P_FORW"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_forw
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_BACK"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_back
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_VMSPACE"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_vmspace
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_ADDR"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_addr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_PRIORITY"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_priority
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_STAT"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_stat
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_WCHAN"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_wchan
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_FLAG"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_flag
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"P_MDFLAG"
argument_list|,
expr|struct
name|proc
argument_list|,
name|p_md
operator|.
name|md_flags
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SSLEEP"
argument_list|,
name|SSLEEP
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SRUN"
argument_list|,
name|SRUN
argument_list|)
expr_stmt|;
comment|/* VM structure fields */
name|off
argument_list|(
literal|"VM_PMAP"
argument_list|,
expr|struct
name|vmspace
argument_list|,
name|vm_pmap
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PM_STCHG"
argument_list|,
expr|struct
name|pmap
argument_list|,
name|pm_stchanged
argument_list|)
expr_stmt|;
comment|/* interrupt/fault metering */
name|off
argument_list|(
literal|"V_SWTCH"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_swtch
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"V_INTR"
argument_list|,
expr|struct
name|vmmeter
argument_list|,
name|v_intr
argument_list|)
expr_stmt|;
comment|/* trap types (should just include trap.h?) */
name|def
argument_list|(
literal|"T_BUSERR"
argument_list|,
name|T_BUSERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ADDRERR"
argument_list|,
name|T_ADDRERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ILLINST"
argument_list|,
name|T_ILLINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ZERODIV"
argument_list|,
name|T_ZERODIV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_CHKINST"
argument_list|,
name|T_CHKINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRAPVINST"
argument_list|,
name|T_TRAPVINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_PRIVINST"
argument_list|,
name|T_PRIVINST
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRACE"
argument_list|,
name|T_TRACE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_MMUFLT"
argument_list|,
name|T_MMUFLT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_SSIR"
argument_list|,
name|T_SSIR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FMTERR"
argument_list|,
name|T_FMTERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_COPERR"
argument_list|,
name|T_COPERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPERR"
argument_list|,
name|T_FPERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_ASTFLT"
argument_list|,
name|T_ASTFLT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_TRAP15"
argument_list|,
name|T_TRAP15
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPEMULI"
argument_list|,
name|T_FPEMULI
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"T_FPEMULD"
argument_list|,
name|T_FPEMULD
argument_list|)
expr_stmt|;
comment|/* PSL values (should just include psl.h?) */
name|def
argument_list|(
literal|"PSL_S"
argument_list|,
name|PSL_S
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_IPL7"
argument_list|,
name|PSL_IPL7
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_LOWIPL"
argument_list|,
name|PSL_LOWIPL
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_HIGHIPL"
argument_list|,
name|PSL_HIGHIPL
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PSL_USER"
argument_list|,
name|PSL_USER
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL1"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL1
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL2"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL2
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL3"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL3
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL4"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL4
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL5"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL5
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SPL6"
argument_list|,
name|PSL_S
operator||
name|PSL_IPL6
argument_list|)
expr_stmt|;
comment|/* magic */
name|def
argument_list|(
literal|"FC_USERD"
argument_list|,
name|FC_USERD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"FC_PURGE"
argument_list|,
name|FC_PURGE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"INTIOBASE"
argument_list|,
name|INTIOBASE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUBASE"
argument_list|,
name|MMUBASE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUSTAT"
argument_list|,
name|MMUSTAT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUCMD"
argument_list|,
name|MMUCMD
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUSSTP"
argument_list|,
name|MMUSSTP
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUUSTP"
argument_list|,
name|MMUUSTP
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMUTBINVAL"
argument_list|,
name|MMUTBINVAL
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_BERR"
argument_list|,
name|MMU_BERR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_ENAB"
argument_list|,
name|MMU_ENAB
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_FAULT"
argument_list|,
name|MMU_FAULT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_CEN"
argument_list|,
name|MMU_CEN
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_IEN"
argument_list|,
name|MMU_IEN
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"MMU_FPE"
argument_list|,
name|MMU_FPE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_ON"
argument_list|,
name|CACHE_ON
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_OFF"
argument_list|,
name|CACHE_OFF
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CACHE_CLR"
argument_list|,
name|CACHE_CLR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"IC_CLEAR"
argument_list|,
name|IC_CLEAR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"DC_CLEAR"
argument_list|,
name|DC_CLEAR
argument_list|)
expr_stmt|;
comment|/* pte/ste bits */
name|def
argument_list|(
literal|"PG_V"
argument_list|,
name|PG_V
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_NV"
argument_list|,
name|PG_NV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_RO"
argument_list|,
name|PG_RO
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_RW"
argument_list|,
name|PG_RW
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_CI"
argument_list|,
name|PG_CI
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_PROT"
argument_list|,
name|PG_PROT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"PG_FRAME"
argument_list|,
name|PG_FRAME
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_V"
argument_list|,
name|SG_V
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_NV"
argument_list|,
name|SG_NV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_RW"
argument_list|,
name|SG_RW
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_FRAME"
argument_list|,
name|SG_FRAME
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SG_ISHIFT"
argument_list|,
name|SG_ISHIFT
argument_list|)
expr_stmt|;
comment|/* pcb fields */
name|off
argument_list|(
literal|"PCB_PS"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_ps
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_USTP"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_ustp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_USP"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_usp
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_REGS"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_regs
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_ONFAULT"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_onfault
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"PCB_FPCTX"
argument_list|,
expr|struct
name|pcb
argument_list|,
name|pcb_fpregs
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SIZEOF_PCB"
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|pcb
argument_list|)
argument_list|)
expr_stmt|;
comment|/* exception frame offset/sizes */
name|off
argument_list|(
literal|"FR_SP"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_regs
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FR_HW"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_sr
argument_list|)
expr_stmt|;
name|off
argument_list|(
literal|"FR_ADJ"
argument_list|,
expr|struct
name|frame
argument_list|,
name|f_stackadj
argument_list|)
expr_stmt|;
comment|/* system calls */
name|def
argument_list|(
literal|"SYS_exit"
argument_list|,
name|SYS_exit
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_execve"
argument_list|,
name|SYS_execve
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"SYS_sigreturn"
argument_list|,
name|SYS_sigreturn
argument_list|)
expr_stmt|;
comment|/* errno */
name|def
argument_list|(
literal|"EFAULT"
argument_list|,
name|EFAULT
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"ENAMETOOLONG"
argument_list|,
name|ENAMETOOLONG
argument_list|)
expr_stmt|;
comment|/* clock registers */
name|def
argument_list|(
literal|"CLKSR"
argument_list|,
name|CLKSR
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CLKMSB1"
argument_list|,
name|CLKMSB1
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"CLKMSB3"
argument_list|,
name|CLKMSB3
argument_list|)
expr_stmt|;
comment|/* HP-UX trace bit */
name|def
argument_list|(
literal|"MDP_TRCB"
argument_list|,
name|ffs
argument_list|(
name|MDP_HPUXTRACE
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|USELEDS
comment|/* LEDs */
name|def
argument_list|(
literal|"LED_PULSE"
argument_list|,
name|LED_PULSE
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"LED_DISK"
argument_list|,
name|LED_DISK
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"LED_LANRCV"
argument_list|,
name|LED_LANRCV
argument_list|)
expr_stmt|;
name|def
argument_list|(
literal|"LED_LANXMT"
argument_list|,
name|LED_LANXMT
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

