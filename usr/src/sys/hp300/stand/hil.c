begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1988 University of Utah.  * Copyright (c) 1990 The Regents of the University of California.  * All rights reserved.  *  * This code is derived from software contributed to Berkeley by  * the Systems Programming Group of the University of Utah Computer  * Science Department.  *  * %sccs.include.redist.c%  *  * from: Utah $Hdr: hil.c 1.1 89/08/22$  *  *	@(#)hil.c	7.1 (Berkeley) %G%  */
end_comment

begin_comment
comment|/*  * Keyboard routines for the standalone ITE.  */
end_comment

begin_include
include|#
directive|include
file|"samachdep.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ITECONSOLE
end_ifdef

begin_include
include|#
directive|include
file|"param.h"
end_include

begin_include
include|#
directive|include
file|"../hpdev/hilreg.h"
end_include

begin_include
include|#
directive|include
file|"../hpdev/kbdmap.h"
end_include

begin_include
include|#
directive|include
file|"../hpdev/itevar.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|SMALL
end_ifndef

begin_comment
comment|/*  * HIL cooked keyboard keymaps.  * Supports only unshifted, shifted and control keys.  */
end_comment

begin_decl_stmt
name|char
name|us_keymap
index|[]
init|=
block|{
name|NULL
block|,
literal|'`'
block|,
literal|'\\'
block|,
name|ESC
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\b'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'E'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'^'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'0'
block|,
literal|'-'
block|,
literal|'='
block|,
literal|'['
block|,
literal|']'
block|,
literal|';'
block|,
literal|'\''
block|,
literal|','
block|,
literal|'.'
block|,
literal|'/'
block|,
literal|'\040'
block|,
literal|'o'
block|,
literal|'p'
block|,
literal|'k'
block|,
literal|'l'
block|,
literal|'q'
block|,
literal|'w'
block|,
literal|'e'
block|,
literal|'r'
block|,
literal|'t'
block|,
literal|'y'
block|,
literal|'u'
block|,
literal|'i'
block|,
literal|'a'
block|,
literal|'s'
block|,
literal|'d'
block|,
literal|'f'
block|,
literal|'g'
block|,
literal|'h'
block|,
literal|'j'
block|,
literal|'m'
block|,
literal|'z'
block|,
literal|'x'
block|,
literal|'c'
block|,
literal|'v'
block|,
literal|'b'
block|,
literal|'n'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|us_shiftmap
index|[]
init|=
block|{
name|NULL
block|,
literal|'~'
block|,
literal|'|'
block|,
name|DEL
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'`'
block|,
literal|'|'
block|,
literal|'\\'
block|,
literal|'~'
block|,
literal|'!'
block|,
literal|'@'
block|,
literal|'#'
block|,
literal|'$'
block|,
literal|'%'
block|,
literal|'^'
block|,
literal|'&'
block|,
literal|'*'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'_'
block|,
literal|'+'
block|,
literal|'{'
block|,
literal|'}'
block|,
literal|':'
block|,
literal|'\"'
block|,
literal|'<'
block|,
literal|'>'
block|,
literal|'?'
block|,
literal|'\040'
block|,
literal|'O'
block|,
literal|'P'
block|,
literal|'K'
block|,
literal|'L'
block|,
literal|'Q'
block|,
literal|'W'
block|,
literal|'E'
block|,
literal|'R'
block|,
literal|'T'
block|,
literal|'Y'
block|,
literal|'U'
block|,
literal|'I'
block|,
literal|'A'
block|,
literal|'S'
block|,
literal|'D'
block|,
literal|'F'
block|,
literal|'G'
block|,
literal|'H'
block|,
literal|'J'
block|,
literal|'M'
block|,
literal|'Z'
block|,
literal|'X'
block|,
literal|'C'
block|,
literal|'V'
block|,
literal|'B'
block|,
literal|'N'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|us_ctrlmap
index|[]
init|=
block|{
name|NULL
block|,
literal|'`'
block|,
literal|'\034'
block|,
name|ESC
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\b'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'E'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'\036'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'0'
block|,
literal|'-'
block|,
literal|'='
block|,
literal|'\033'
block|,
literal|'\035'
block|,
literal|';'
block|,
literal|'\''
block|,
literal|','
block|,
literal|'.'
block|,
literal|'/'
block|,
literal|'\040'
block|,
literal|'\017'
block|,
literal|'\020'
block|,
literal|'\013'
block|,
literal|'\014'
block|,
literal|'\021'
block|,
literal|'\027'
block|,
literal|'\005'
block|,
literal|'\022'
block|,
literal|'\024'
block|,
literal|'\031'
block|,
literal|'\025'
block|,
literal|'\011'
block|,
literal|'\001'
block|,
literal|'\023'
block|,
literal|'\004'
block|,
literal|'\006'
block|,
literal|'\007'
block|,
literal|'\010'
block|,
literal|'\012'
block|,
literal|'\015'
block|,
literal|'\032'
block|,
literal|'\030'
block|,
literal|'\003'
block|,
literal|'\026'
block|,
literal|'\002'
block|,
literal|'\016'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|UK_KEYBOARD
end_ifdef

begin_decl_stmt
name|char
name|uk_keymap
index|[]
init|=
block|{
name|NULL
block|,
literal|'`'
block|,
literal|'<'
block|,
name|ESC
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\b'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'E'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'^'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'0'
block|,
literal|'+'
block|,
literal|'\''
block|,
literal|'['
block|,
literal|']'
block|,
literal|'*'
block|,
literal|'\\'
block|,
literal|','
block|,
literal|'.'
block|,
literal|'-'
block|,
literal|'\040'
block|,
literal|'o'
block|,
literal|'p'
block|,
literal|'k'
block|,
literal|'l'
block|,
literal|'q'
block|,
literal|'w'
block|,
literal|'e'
block|,
literal|'r'
block|,
literal|'t'
block|,
literal|'y'
block|,
literal|'u'
block|,
literal|'i'
block|,
literal|'a'
block|,
literal|'s'
block|,
literal|'d'
block|,
literal|'f'
block|,
literal|'g'
block|,
literal|'h'
block|,
literal|'j'
block|,
literal|'m'
block|,
literal|'z'
block|,
literal|'x'
block|,
literal|'c'
block|,
literal|'v'
block|,
literal|'b'
block|,
literal|'n'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|uk_shiftmap
index|[]
init|=
block|{
name|NULL
block|,
literal|'~'
block|,
literal|'>'
block|,
name|DEL
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'`'
block|,
literal|'|'
block|,
literal|'\\'
block|,
literal|'~'
block|,
literal|'!'
block|,
literal|'\"'
block|,
literal|'#'
block|,
literal|'$'
block|,
literal|'%'
block|,
literal|'&'
block|,
literal|'^'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'='
block|,
literal|'?'
block|,
literal|'/'
block|,
literal|'{'
block|,
literal|'}'
block|,
literal|'@'
block|,
literal|'|'
block|,
literal|';'
block|,
literal|':'
block|,
literal|'_'
block|,
literal|'\040'
block|,
literal|'O'
block|,
literal|'P'
block|,
literal|'K'
block|,
literal|'L'
block|,
literal|'Q'
block|,
literal|'W'
block|,
literal|'E'
block|,
literal|'R'
block|,
literal|'T'
block|,
literal|'Y'
block|,
literal|'U'
block|,
literal|'I'
block|,
literal|'A'
block|,
literal|'S'
block|,
literal|'D'
block|,
literal|'F'
block|,
literal|'G'
block|,
literal|'H'
block|,
literal|'J'
block|,
literal|'M'
block|,
literal|'Z'
block|,
literal|'X'
block|,
literal|'C'
block|,
literal|'V'
block|,
literal|'B'
block|,
literal|'N'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|uk_ctrlmap
index|[]
init|=
block|{
name|NULL
block|,
literal|'`'
block|,
literal|'<'
block|,
name|ESC
block|,
name|NULL
block|,
name|DEL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\n'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\t'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|'\b'
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|ESC
block|,
literal|'\r'
block|,
name|NULL
block|,
literal|'\n'
block|,
literal|'0'
block|,
literal|'.'
block|,
literal|','
block|,
literal|'+'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'-'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'*'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'/'
block|,
literal|'E'
block|,
literal|'('
block|,
literal|')'
block|,
literal|'\036'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'0'
block|,
literal|'+'
block|,
literal|'\''
block|,
literal|'\033'
block|,
literal|'\035'
block|,
literal|'*'
block|,
literal|'\034'
block|,
literal|','
block|,
literal|'.'
block|,
literal|'/'
block|,
literal|'\040'
block|,
literal|'\017'
block|,
literal|'\020'
block|,
literal|'\013'
block|,
literal|'\014'
block|,
literal|'\021'
block|,
literal|'\027'
block|,
literal|'\005'
block|,
literal|'\022'
block|,
literal|'\024'
block|,
literal|'\031'
block|,
literal|'\025'
block|,
literal|'\011'
block|,
literal|'\001'
block|,
literal|'\023'
block|,
literal|'\004'
block|,
literal|'\006'
block|,
literal|'\007'
block|,
literal|'\010'
block|,
literal|'\012'
block|,
literal|'\015'
block|,
literal|'\032'
block|,
literal|'\030'
block|,
literal|'\003'
block|,
literal|'\026'
block|,
literal|'\002'
block|,
literal|'\016'
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * The keyboard map table.  * Lookup is by hardware returned language code.  */
end_comment

begin_decl_stmt
name|struct
name|kbdmap
name|kbd_map
index|[]
init|=
block|{
name|KBD_US
block|,
name|NULL
block|,
name|us_keymap
block|,
name|us_shiftmap
block|,
name|us_ctrlmap
block|,
name|NULL
block|,
name|NULL
block|,
ifdef|#
directive|ifdef
name|UK_KEYBOARD
name|KBD_UK
block|,
name|NULL
block|,
name|uk_keymap
block|,
name|uk_shiftmap
block|,
name|uk_ctrlmap
block|,
name|NULL
block|,
name|NULL
block|,
endif|#
directive|endif
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|kbd_keymap
init|=
name|us_keymap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|kbd_shiftmap
init|=
name|us_shiftmap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|kbd_ctrlmap
init|=
name|us_ctrlmap
decl_stmt|;
end_decl_stmt

begin_macro
name|kbdgetc
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|status
decl_stmt|,
name|c
decl_stmt|;
specifier|register
name|struct
name|hil_dev
modifier|*
name|hiladdr
init|=
name|HILADDR
decl_stmt|;
name|status
operator|=
name|hiladdr
operator|->
name|hil_stat
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|&
name|HIL_DATA_RDY
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|c
operator|=
name|hiladdr
operator|->
name|hil_data
expr_stmt|;
switch|switch
condition|(
operator|(
name|status
operator|>>
name|KBD_SSHIFT
operator|)
operator|&
name|KBD_SMASK
condition|)
block|{
case|case
name|KBD_SHIFT
case|:
name|c
operator|=
name|kbd_shiftmap
index|[
name|c
operator|&
name|KBD_CHARMASK
index|]
expr_stmt|;
break|break;
case|case
name|KBD_CTRL
case|:
name|c
operator|=
name|kbd_ctrlmap
index|[
name|c
operator|&
name|KBD_CHARMASK
index|]
expr_stmt|;
break|break;
case|case
name|KBD_KEY
case|:
name|c
operator|=
name|kbd_keymap
index|[
name|c
operator|&
name|KBD_CHARMASK
index|]
expr_stmt|;
break|break;
default|default:
name|c
operator|=
literal|0
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|c
operator|)
return|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_macro
name|kbdnmi
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|hil_dev
modifier|*
name|hiladdr
init|=
name|HILADDR
decl_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_cmd
operator|=
name|HIL_CNMT
expr_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_cmd
operator|=
name|HIL_CNMT
expr_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nboot interrupted\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|kbdinit
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|hil_dev
modifier|*
name|hiladdr
init|=
name|HILADDR
decl_stmt|;
specifier|register
name|struct
name|kbdmap
modifier|*
name|km
decl_stmt|;
name|u_char
name|lang
decl_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_cmd
operator|=
name|HIL_SETARR
expr_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_data
operator|=
name|ar_format
argument_list|(
name|KBD_ARR
argument_list|)
expr_stmt|;
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_cmd
operator|=
name|HIL_READKBDLANG
expr_stmt|;
name|HILDATAWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|lang
operator|=
name|hiladdr
operator|->
name|hil_data
expr_stmt|;
for|for
control|(
name|km
operator|=
name|kbd_map
init|;
name|km
operator|->
name|kbd_code
condition|;
name|km
operator|++
control|)
if|if
condition|(
name|km
operator|->
name|kbd_code
operator|==
name|lang
condition|)
block|{
name|kbd_keymap
operator|=
name|km
operator|->
name|kbd_keymap
expr_stmt|;
name|kbd_shiftmap
operator|=
name|km
operator|->
name|kbd_shiftmap
expr_stmt|;
name|kbd_ctrlmap
operator|=
name|km
operator|->
name|kbd_ctrlmap
expr_stmt|;
block|}
name|HILWAIT
argument_list|(
name|hiladdr
argument_list|)
expr_stmt|;
name|hiladdr
operator|->
name|hil_cmd
operator|=
name|HIL_INTON
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

