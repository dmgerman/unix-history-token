begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1980 Regents of the University of California.  * All rights reserved.  The Berkeley software License Agreement  * specifies the terms and conditions for redistribution.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)arc.c	5.1 (Berkeley) 5/7/85"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|not lint
end_endif

begin_include
include|#
directive|include
file|"hp7221.h"
end_include

begin_comment
comment|/*   * 7221 requires knowing the anlge of arc.  To do this, the triangle formula  *	c^2 = a^2 + b^2 - 2*a*b*cos(angle)  * is used where "a" and "b" are the radius of the circle and "c" is the  * distance between the beginning point and the end point.  *  * This gives us "angle" or angle - 180.  To find out which, draw a line from  * beg to center.  This splits the plane in half.  All points on one side of the  * plane will have the same sign when plugged into the equation for the line.  * Pick a point on the "right side" of the line (see program below).  If "end"  * has the same sign as this point does, then they are both on the same side  * of the line and so angle is< 180.  Otherwise, angle> 180.  */
end_comment

begin_define
define|#
directive|define
name|side
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|(a*(x)+b*(y)+c> 0.0 ? 1 : -1)
end_define

begin_macro
name|arc
argument_list|(
argument|xcent
argument_list|,
argument|ycent
argument_list|,
argument|xbeg
argument_list|,
argument|ybeg
argument_list|,
argument|xend
argument_list|,
argument|yend
argument_list|)
end_macro

begin_decl_stmt
name|int
name|xcent
decl_stmt|,
name|ycent
decl_stmt|,
name|xbeg
decl_stmt|,
name|ybeg
decl_stmt|,
name|xend
decl_stmt|,
name|yend
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|double
name|radius2
decl_stmt|,
name|c2
decl_stmt|;
name|double
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|;
name|int
name|angle
decl_stmt|;
comment|/* Probably should check that this is really a circular arc.  */
name|radius2
operator|=
operator|(
name|xcent
operator|-
name|xbeg
operator|)
operator|*
operator|(
name|xcent
operator|-
name|xbeg
operator|)
operator|+
operator|(
name|ycent
operator|-
name|ybeg
operator|)
operator|*
operator|(
name|ycent
operator|-
name|ybeg
operator|)
expr_stmt|;
name|c2
operator|=
operator|(
name|xend
operator|-
name|xbeg
operator|)
operator|*
operator|(
name|xend
operator|-
name|xbeg
operator|)
operator|+
operator|(
name|yend
operator|-
name|ybeg
operator|)
operator|*
operator|(
name|yend
operator|-
name|ybeg
operator|)
expr_stmt|;
name|angle
operator|=
call|(
name|int
call|)
argument_list|(
literal|180.0
operator|/
name|PI
operator|*
name|acos
argument_list|(
literal|1.0
operator|-
name|c2
operator|/
operator|(
literal|2.0
operator|*
name|radius2
operator|)
argument_list|)
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|a
operator|=
call|(
name|double
call|)
argument_list|(
name|ycent
operator|-
name|ybeg
argument_list|)
expr_stmt|;
name|b
operator|=
call|(
name|double
call|)
argument_list|(
name|xcent
operator|-
name|xbeg
argument_list|)
expr_stmt|;
name|c
operator|=
call|(
name|double
call|)
argument_list|(
name|ycent
operator|*
name|xbeg
operator|-
name|xcent
operator|*
name|ybeg
argument_list|)
expr_stmt|;
if|if
condition|(
name|side
argument_list|(
name|xbeg
operator|+
operator|(
name|ycent
operator|-
name|ybeg
operator|)
argument_list|,
name|ybeg
operator|-
operator|(
name|xcent
operator|-
name|xbeg
operator|)
argument_list|)
operator|!=
name|side
argument_list|(
name|xend
argument_list|,
name|yend
argument_list|)
condition|)
name|angle
operator|+=
literal|180
expr_stmt|;
name|move
argument_list|(
name|xcent
argument_list|,
name|ycent
argument_list|)
expr_stmt|;
comment|/* Not quite implemented... 	printf("C(A%d c)[%d,%d]", angle, xbeg, ybeg); 	*/
block|}
end_block

end_unit

