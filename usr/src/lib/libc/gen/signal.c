begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	signal.c	4.2	85/01/15	*/
end_comment

begin_comment
comment|/*  * Almost backwards compatible signal.  *	int (*signal(s, a))() int s, (*a)();  */
end_comment

begin_include
include|#
directive|include
file|<syscall.h>
end_include

begin_include
include|#
directive|include
file|"DEFS.h"
end_include

begin_macro
name|ENTRY
argument_list|(
argument|signal
argument_list|,
literal|0
argument_list|)
end_macro

begin_decl_stmt
name|subl2
name|$24
decl_stmt|,
name|sp
decl|# struct
name|sigvec
name|osv
decl_stmt|,
name|sv
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|movl
literal|8
operator|(
name|ap
operator|)
operator|,
operator|-
literal|24
operator|(
name|fp
operator|)
operator|#
name|sv
operator|.
name|sv_handler
operator|=
name|a
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|clrq
operator|-
literal|20
operator|(
name|fp
operator|)
operator|#
name|sv
operator|.
name|sv_mask
operator|=
name|sv
operator|.
name|sv_onstack
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|pushal
operator|-
literal|12
operator|(
name|fp
operator|)
operator|#
operator|&
name|osv
name|pushal
operator|-
literal|24
operator|(
name|fp
operator|)
operator|#
operator|&
name|sv
name|pushl
literal|4
operator|(
name|ap
operator|)
operator|#
name|s
name|moval
operator|-
literal|4
operator|(
name|sp
operator|)
operator|,
name|ap
name|chmk
name|$SYS_sigvec
operator|#
name|sigvec
argument_list|(
argument|s
argument_list|,
argument|&sv
argument_list|,
argument|&osv
argument_list|)
name|jcs
name|err
name|movl
operator|-
literal|12
operator|(
name|fp
operator|)
operator|,
name|r0
operator|#
end_expr_stmt

begin_return
return|return
name|osv
operator|.
name|sv_handler
return|;
end_return

begin_decl_stmt
name|ret
name|err
range|:
operator|.
name|globl
name|_errno
name|movl
name|r0
decl_stmt|,
name|_errno
name|mnegl
name|$1
decl_stmt|,
name|r0
name|ret
end_decl_stmt

end_unit

