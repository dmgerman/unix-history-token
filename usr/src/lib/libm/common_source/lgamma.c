begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1992 The Regents of the University of California.  * All rights reserved.  *  * %sccs.include.redist.c%  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)lgamma.c	5.6 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|"mathimpl.h"
end_include

begin_comment
comment|/* TRUNC sets trailing bits in a floating-point number to zero.  * ptrx points to the second half of the floating-point number.  * x1 is a temporary variable. */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|vax
argument_list|)
operator|||
name|defined
argument_list|(
name|tahoe
argument_list|)
end_if

begin_define
define|#
directive|define
name|LSHFT_PLUS_1
value|(134217728.+1.)
end_define

begin_define
define|#
directive|define
name|TRUNC
parameter_list|(
name|x
parameter_list|,
name|dummy
parameter_list|,
name|x1
parameter_list|)
value|x1 = x*LSHFT_PLUS_1, x -= x1, x += x1
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|MASK
value|0xf8000000
end_define

begin_define
define|#
directive|define
name|TRUNC
parameter_list|(
name|x
parameter_list|,
name|ptrx
parameter_list|,
name|dummy
parameter_list|)
value|*ptrx&= MASK
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|x0
value|0.461632144968362356785
end_define

begin_define
define|#
directive|define
name|x0_lo
value|-.000000000000000015522348162858676890521
end_define

begin_define
define|#
directive|define
name|a0_hi
value|-0.12148629053584961146
end_define

begin_define
define|#
directive|define
name|a0_lo
value|3.07435645275902737e-18
end_define

begin_define
define|#
directive|define
name|LEFT
value|(1.0 - (x0 + .25))
end_define

begin_define
define|#
directive|define
name|RIGHT
value|(x0 - .218)
end_define

begin_define
define|#
directive|define
name|lns2pi_hi
value|0.418945312500000
end_define

begin_define
define|#
directive|define
name|lns2pi_lo
value|-.000006779295327258219670263595
end_define

begin_define
define|#
directive|define
name|UNDERFL
value|(1e-1020 * 1e-1020)
end_define

begin_decl_stmt
name|int
name|signgam
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|r0
value|-0.02771227512955130520
end_define

begin_define
define|#
directive|define
name|r1
value|-0.2980729795228150847
end_define

begin_define
define|#
directive|define
name|r2
value|-0.3257411333183093394
end_define

begin_define
define|#
directive|define
name|r3
value|-0.1126814387531706041
end_define

begin_define
define|#
directive|define
name|r4
value|-0.01129130057170225562
end_define

begin_define
define|#
directive|define
name|r5
value|-2.259650588213369095e-05
end_define

begin_define
define|#
directive|define
name|s0
value|1.7144571600017144419
end_define

begin_define
define|#
directive|define
name|s1
value|2.7864695046181946481
end_define

begin_define
define|#
directive|define
name|s2
value|1.5645463655191798047
end_define

begin_define
define|#
directive|define
name|s3
value|0.34858463899811098496
end_define

begin_define
define|#
directive|define
name|s4
value|0.024677593453636563481
end_define

begin_define
define|#
directive|define
name|p0
value|-7.721566490153286087127140e-02
end_define

begin_define
define|#
directive|define
name|p1
value|2.077324848654884653970785e-01
end_define

begin_define
define|#
directive|define
name|p2
value|3.474331160945523535787194e-01
end_define

begin_define
define|#
directive|define
name|p3
value|1.724375677840324429295524e-01
end_define

begin_define
define|#
directive|define
name|p4
value|3.546181984297784658205969e-02
end_define

begin_define
define|#
directive|define
name|p5
value|2.866163630124151557532506e-03
end_define

begin_define
define|#
directive|define
name|p6
value|6.143168512963655570532770e-05
end_define

begin_define
define|#
directive|define
name|q0
value|1.000000000000000000000000e+00
end_define

begin_define
define|#
directive|define
name|q1
value|1.485897307300750567469226e+00
end_define

begin_define
define|#
directive|define
name|q2
value|8.336064915387758261556045e-01
end_define

begin_define
define|#
directive|define
name|q3
value|2.185469782512070977585556e-01
end_define

begin_define
define|#
directive|define
name|q4
value|2.671060746990048983840354e-02
end_define

begin_define
define|#
directive|define
name|q5
value|1.296631961305647947057711e-03
end_define

begin_define
define|#
directive|define
name|q6
value|1.484566091079246905938151e-05
end_define

begin_define
define|#
directive|define
name|NP2
value|8
end_define

begin_decl_stmt
name|double
name|P2
index|[]
init|=
block|{
literal|.0833333333333333148296162562474
block|,
operator|-
literal|.00277777777774548123579378966497
block|,
literal|.000793650778754435631476282786423
block|,
operator|-
literal|.000595235082566672847950717262222
block|,
literal|.000841428560346653702135821806252
block|,
operator|-
literal|.00189773526463879200348872089421
block|,
literal|.00569394463439411649408050664078
block|,
operator|-
literal|.0144705562421428915453880392761
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|double
name|neg_lgam
name|__P
argument_list|(
operator|(
name|double
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|double
name|small_lgam
name|__P
argument_list|(
operator|(
name|double
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|double
name|large_lgam
name|__P
argument_list|(
operator|(
name|double
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
name|double
name|lgamma
parameter_list|(
name|x
parameter_list|)
name|double
name|x
decl_stmt|;
block|{
name|double
name|zero
init|=
literal|0.0
decl_stmt|,
name|one
init|=
literal|1.0
decl_stmt|;
name|double
name|r
decl_stmt|;
name|signgam
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|finite
argument_list|(
name|x
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EDOM
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
name|x
operator|=
operator|-
name|x
expr_stmt|;
elseif|else
if|if
condition|(
name|x
operator|>
literal|0
condition|)
name|errno
operator|=
name|ERANGE
expr_stmt|;
return|return
operator|(
name|x
operator|)
return|;
block|}
if|if
condition|(
name|x
operator|>
literal|6
operator|+
name|RIGHT
condition|)
block|{
if|if
condition|(
name|x
operator|>
literal|1.0e20
condition|)
return|return
operator|(
name|x
operator|*
operator|(
name|log
argument_list|(
name|x
argument_list|)
operator|-
name|one
operator|)
operator|)
return|;
name|r
operator|=
name|large_lgam
argument_list|(
name|x
argument_list|)
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|x
operator|>
literal|1e-17
condition|)
return|return
operator|(
name|small_lgam
argument_list|(
name|x
argument_list|)
operator|)
return|;
elseif|else
if|if
condition|(
name|x
operator|>
operator|-
literal|1e-17
condition|)
block|{
if|if
condition|(
name|x
operator|<
literal|0
condition|)
name|signgam
operator|=
operator|-
literal|1
operator|,
name|x
operator|=
operator|-
name|x
expr_stmt|;
return|return
operator|(
operator|-
name|log
argument_list|(
name|x
argument_list|)
operator|)
return|;
block|}
else|else
return|return
operator|(
name|neg_lgam
argument_list|(
name|x
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Accurate to max(ulp(1/128) absolute, 2^-75 relative) error. */
end_comment

begin_function
specifier|static
name|double
name|large_lgam
parameter_list|(
name|x
parameter_list|)
name|double
name|x
decl_stmt|;
block|{
name|double
name|z
decl_stmt|,
name|p
decl_stmt|,
name|x1
decl_stmt|;
name|int
name|i
decl_stmt|;
name|long
modifier|*
name|pva
decl_stmt|,
modifier|*
name|pua
decl_stmt|;
name|struct
name|Double
name|t
decl_stmt|,
name|u
decl_stmt|,
name|v
decl_stmt|;
name|pua
operator|=
operator|(
name|long
operator|*
operator|)
operator|&
name|u
operator|.
name|a
operator|,
name|pua
operator|++
expr_stmt|;
name|pva
operator|=
operator|(
name|long
operator|*
operator|)
operator|&
name|v
operator|.
name|a
operator|,
name|pva
operator|++
expr_stmt|;
name|z
operator|=
literal|1.0
operator|/
operator|(
name|x
operator|*
name|x
operator|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|P2
index|[
name|i
operator|=
name|NP2
operator|-
literal|1
index|]
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
control|)
name|p
operator|=
name|P2
index|[
name|i
index|]
operator|+
name|p
operator|*
name|z
expr_stmt|;
comment|/* error in approximation = 2.8e-18 */
name|p
operator|=
name|p
operator|/
name|x
expr_stmt|;
comment|/* ulp = 1.7e-18; error< 1.6ulp */
comment|/* 0< frac< 1/64 (at x = 5.5) */
name|t
operator|=
name|log__D
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|t
operator|.
name|a
operator|-=
literal|1.0
expr_stmt|;
name|u
operator|.
name|a
operator|=
name|t
operator|.
name|a
operator|+
name|t
operator|.
name|b
expr_stmt|;
name|TRUNC
argument_list|(
name|u
operator|.
name|a
argument_list|,
name|pua
argument_list|,
name|x1
argument_list|)
expr_stmt|;
comment|/* truncate u.a */
name|u
operator|.
name|b
operator|=
operator|(
name|t
operator|.
name|a
operator|-
name|u
operator|.
name|a
operator|)
expr_stmt|;
name|u
operator|.
name|b
operator|+=
name|t
operator|.
name|b
expr_stmt|;
name|x
operator|-=
literal|.5
expr_stmt|;
name|v
operator|.
name|a
operator|=
name|x
expr_stmt|;
name|TRUNC
argument_list|(
name|v
operator|.
name|a
argument_list|,
name|pva
argument_list|,
name|x1
argument_list|)
expr_stmt|;
comment|/* truncate v.a */
name|v
operator|.
name|b
operator|=
name|x
operator|-
name|v
operator|.
name|a
expr_stmt|;
name|t
operator|.
name|a
operator|=
name|v
operator|.
name|a
operator|*
name|u
operator|.
name|a
expr_stmt|;
comment|/* t = (x-.5)*(log(x)-1) */
name|t
operator|.
name|b
operator|=
name|v
operator|.
name|b
operator|*
name|u
operator|.
name|a
operator|+
name|x
operator|*
name|u
operator|.
name|b
expr_stmt|;
name|z
operator|=
name|t
operator|.
name|b
operator|+
name|lns2pi_lo
expr_stmt|;
comment|/* return t + lns2pi + p */
name|z
operator|+=
name|p
expr_stmt|;
name|z
operator|+=
name|lns2pi_hi
expr_stmt|;
name|z
operator|+=
name|t
operator|.
name|a
expr_stmt|;
return|return
operator|(
name|z
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Good to< 1 ulp.  (provably .90 ulp; .87 ulp on 1,000,000 runs.)    It also has correct monotonicity.  */
end_comment

begin_function
specifier|static
name|double
name|small_lgam
parameter_list|(
name|x
parameter_list|)
name|double
name|x
decl_stmt|;
block|{
name|int
name|xi
decl_stmt|;
name|double
name|y
decl_stmt|,
name|z
decl_stmt|,
name|t
decl_stmt|,
name|r
init|=
literal|0
decl_stmt|,
name|p
decl_stmt|,
name|q
decl_stmt|;
name|struct
name|Double
name|rr
decl_stmt|;
comment|/* Do nasty area near the minimum.  No good for 1.25< x< 2.5 */
if|if
condition|(
name|x
operator|<
literal|2.0
operator|-
name|LEFT
operator|&&
name|x
operator|>
literal|1.0
operator|+
name|RIGHT
condition|)
block|{
name|t
operator|=
name|x
operator|-
literal|1.0
expr_stmt|;
name|t
operator|-=
name|x0
expr_stmt|;
name|z
operator|=
name|t
operator|-
name|x0_lo
expr_stmt|;
name|p
operator|=
name|r0
operator|+
name|z
operator|*
operator|(
name|r1
operator|+
name|z
operator|*
operator|(
name|r2
operator|+
name|z
operator|*
operator|(
name|r3
operator|+
name|z
operator|*
operator|(
name|r4
operator|+
name|z
operator|*
name|r5
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
name|q
operator|=
name|s0
operator|+
name|z
operator|*
operator|(
name|s1
operator|+
name|z
operator|*
operator|(
name|s2
operator|+
name|z
operator|*
operator|(
name|s3
operator|+
name|z
operator|*
name|s4
operator|)
operator|)
operator|)
expr_stmt|;
name|r
operator|=
name|t
operator|*
operator|(
name|z
operator|*
operator|(
name|p
operator|/
name|q
operator|)
operator|-
name|x0_lo
operator|)
operator|+
name|a0_lo
expr_stmt|;
name|r
operator|+=
literal|.5
operator|*
name|t
operator|*
name|t
expr_stmt|;
name|r
operator|+=
name|a0_hi
expr_stmt|;
return|return
operator|(
name|r
operator|)
return|;
block|}
name|xi
operator|=
operator|(
name|x
operator|+
literal|.5
operator|)
expr_stmt|;
name|y
operator|=
name|x
operator|-
name|xi
expr_stmt|;
name|rr
operator|.
name|a
operator|=
name|rr
operator|.
name|b
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|y
operator|<
operator|-
name|LEFT
condition|)
block|{
comment|/* necessary for 2.5< x< 2.72.. */
name|t
operator|=
name|y
operator|+
operator|(
literal|1.0
operator|-
name|x0
operator|)
expr_stmt|;
name|z
operator|=
name|t
operator|-
name|x0_lo
expr_stmt|;
name|p
operator|=
name|r0
operator|+
name|z
operator|*
operator|(
name|r1
operator|+
name|z
operator|*
operator|(
name|r2
operator|+
name|z
operator|*
operator|(
name|r3
operator|+
name|z
operator|*
operator|(
name|r4
operator|+
name|z
operator|*
name|r5
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
name|q
operator|=
name|s0
operator|+
name|z
operator|*
operator|(
name|s1
operator|+
name|z
operator|*
operator|(
name|s2
operator|+
name|z
operator|*
operator|(
name|s3
operator|+
name|z
operator|*
name|s4
operator|)
operator|)
operator|)
expr_stmt|;
name|r
operator|=
name|t
operator|*
operator|(
name|z
operator|*
operator|(
name|p
operator|/
name|q
operator|)
operator|-
name|x0_lo
operator|)
operator|+
name|a0_lo
expr_stmt|;
name|r
operator|+=
literal|.5
operator|*
name|t
operator|*
name|t
expr_stmt|;
name|q
operator|=
name|a0_hi
expr_stmt|;
name|printf
argument_list|(
literal|"(0)q = %.18lg r = %.18lg\n"
argument_list|,
name|q
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p
operator|=
name|y
operator|*
operator|(
name|p0
operator|+
name|y
operator|*
operator|(
name|p1
operator|+
name|y
operator|*
operator|(
name|p2
operator|+
name|y
operator|*
operator|(
name|p3
operator|+
name|y
operator|*
operator|(
name|p4
operator|+
name|y
operator|*
operator|(
name|p5
operator|+
name|y
operator|*
name|p6
operator|)
operator|)
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
name|q
operator|=
name|q0
operator|+
name|y
operator|*
operator|(
name|q1
operator|+
name|y
operator|*
operator|(
name|q2
operator|+
name|y
operator|*
operator|(
name|q3
operator|+
name|y
operator|*
operator|(
name|q4
operator|+
name|y
operator|*
operator|(
name|q5
operator|+
name|y
operator|*
name|q6
operator|)
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
name|r
operator|=
name|p
operator|/
name|q
expr_stmt|;
name|q
operator|=
literal|.5
operator|*
name|y
expr_stmt|;
name|printf
argument_list|(
literal|"(1)q = %.18lg r = %.18lg\n"
argument_list|,
name|q
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"y = %lg, r = %.18lg\n"
argument_list|,
name|y
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|z
operator|=
literal|1.0
expr_stmt|;
switch|switch
condition|(
name|xi
condition|)
block|{
case|case
literal|6
case|:
name|z
operator|=
operator|(
name|y
operator|+
literal|5
operator|)
expr_stmt|;
case|case
literal|5
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|4
operator|)
expr_stmt|;
case|case
literal|4
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|3
operator|)
expr_stmt|;
case|case
literal|3
case|:
name|z
operator|*=
operator|(
name|y
operator|+
literal|2
operator|)
expr_stmt|;
name|rr
operator|=
name|log__D
argument_list|(
name|z
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%.21lg, %lg\n"
argument_list|,
name|rr
operator|.
name|a
argument_list|,
name|rr
operator|.
name|b
argument_list|)
expr_stmt|;
name|r
operator|+=
name|rr
operator|.
name|b
expr_stmt|;
name|q
operator|+=
name|r
expr_stmt|;
return|return
operator|(
name|q
operator|+
name|rr
operator|.
name|a
operator|)
return|;
case|case
literal|2
case|:
return|return
operator|(
name|q
operator|+
name|r
operator|)
return|;
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"r = %lg\n"
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|r
operator|-=
name|log1p
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t%lg\n"
argument_list|,
name|r
argument_list|)
expr_stmt|;
default|default:
name|rr
operator|=
name|log__D
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|r
operator|-=
name|rr
operator|.
name|b
expr_stmt|;
name|printf
argument_list|(
literal|"\t%lg\n"
argument_list|,
name|r
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|>
literal|.5
operator|*
name|rr
operator|.
name|a
condition|)
block|{
name|printf
argument_list|(
literal|"q = %lg, rr = %lg, r = %lg\n"
argument_list|,
name|q
argument_list|,
name|rr
operator|.
name|a
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|q
operator|-=
name|rr
operator|.
name|a
expr_stmt|;
return|return
operator|(
name|r
operator|+
name|q
operator|)
return|;
block|}
else|else
name|printf
argument_list|(
literal|"q = %lg, rr = %lg, r = %lg\n"
argument_list|,
name|q
argument_list|,
name|rr
operator|.
name|a
argument_list|,
name|r
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|r
operator|+
name|q
operator|)
operator|-
name|rr
operator|.
name|a
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|lpi_hi
value|1.1447298858494001638
end_define

begin_define
define|#
directive|define
name|lpi_lo
value|.0000000000000000102659511627078262
end_define

begin_comment
comment|/* Error: within 3.5 ulp for x< 171.  For large x, see lgamma. */
end_comment

begin_function
specifier|static
name|double
name|neg_lgam
parameter_list|(
name|x
parameter_list|)
name|double
name|x
decl_stmt|;
block|{
name|struct
name|Double
name|lg
decl_stmt|,
name|lsine
decl_stmt|;
name|double
name|y
decl_stmt|,
name|z
decl_stmt|,
name|one
init|=
literal|1.0
decl_stmt|,
name|zero
init|=
literal|0.0
decl_stmt|;
name|z
operator|=
name|floor
argument_list|(
name|x
operator|+
literal|.5
argument_list|)
expr_stmt|;
if|if
condition|(
name|z
operator|==
name|x
condition|)
block|{
name|errno
operator|=
name|EDOM
expr_stmt|;
return|return
operator|(
name|one
operator|/
name|zero
operator|)
return|;
comment|/* convention: G(-(integer)) -> +oo */
block|}
name|y
operator|=
name|ceil
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|y
operator|*
literal|.5
operator|==
name|ceil
argument_list|(
literal|.5
operator|*
name|y
argument_list|)
condition|)
name|signgam
operator|=
operator|-
literal|1
expr_stmt|;
name|x
operator|=
operator|-
name|x
expr_stmt|;
name|z
operator|=
name|fabs
argument_list|(
name|x
operator|+
name|z
argument_list|)
expr_stmt|;
comment|/* 0< z<= .5 */
if|if
condition|(
name|z
operator|<
literal|.25
condition|)
name|z
operator|=
name|sin
argument_list|(
name|M_PI
operator|*
name|z
argument_list|)
expr_stmt|;
else|else
name|z
operator|=
name|cos
argument_list|(
name|M_PI
operator|*
operator|(
literal|.5
operator|-
name|z
operator|)
argument_list|)
expr_stmt|;
name|z
operator|=
operator|-
name|log
argument_list|(
name|z
operator|*
name|x
operator|/
name|M_PI
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|>
literal|6.5
condition|)
name|y
operator|-=
name|large_lgam
argument_list|(
name|x
argument_list|)
expr_stmt|;
else|else
name|y
operator|=
operator|-
name|small_lgam
argument_list|(
name|x
argument_list|)
expr_stmt|;
return|return
operator|(
name|y
operator|+
name|z
operator|)
return|;
block|}
end_function

end_unit

