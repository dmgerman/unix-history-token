begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)xclock.c	1.2 10/16/86"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright 1985 Massachusetts Institute of Technology */
end_comment

begin_comment
comment|/*  * xclock.c MIT Project Athena, X Window system clock.  *  *  This program provides the user with a small  * window contining a digital clock with day and date.  * Parameters are variable from the command line.  *  *  Author:	Tony Della Fera, DEC  *		September, 1984  * Hacked up by a cast of thousands....  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_define
define|#
directive|define
name|PI
value|3.141592
end_define

begin_define
define|#
directive|define
name|SEG_BUFF_SIZE
value|128
end_define

begin_define
define|#
directive|define
name|SECOND_HAND_FRACT
value|90
end_define

begin_define
define|#
directive|define
name|MINUTE_HAND_FRACT
value|70
end_define

begin_define
define|#
directive|define
name|HOUR_HAND_FRACT
value|40
end_define

begin_define
define|#
directive|define
name|SECOND_HAND_TIME
value|30
end_define

begin_define
define|#
directive|define
name|DEF_UPDATE
value|60
end_define

begin_define
define|#
directive|define
name|DEF_BORDER
value|2
end_define

begin_define
define|#
directive|define
name|DEF_VECTOR_HEIGHT
value|1
end_define

begin_define
define|#
directive|define
name|DEF_VECTOR_WIDTH
value|1
end_define

begin_define
define|#
directive|define
name|DEF_DIGITAL_PADDING
value|10
end_define

begin_define
define|#
directive|define
name|DEF_DIGITAL_FONT
value|"6x10"
end_define

begin_define
define|#
directive|define
name|DEF_ANALOG_PADDING
value|8
end_define

begin_define
define|#
directive|define
name|DEF_ANALOG_WIDTH
value|164
end_define

begin_define
define|#
directive|define
name|DEF_ANALOG_HEIGHT
value|164
end_define

begin_define
define|#
directive|define
name|DEF_BORDER_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_HIGH_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_FRGRND_COLOR
value|BlackPixel
end_define

begin_define
define|#
directive|define
name|DEF_BKGRND_COLOR
value|WhitePixel
end_define

begin_define
define|#
directive|define
name|UNINIT
value|-1
end_define

begin_define
define|#
directive|define
name|FAILURE
value|0
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|((a)> (b) ? (a) : (b))
end_define

begin_define
define|#
directive|define
name|min
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|((a)< (b) ? (a) : (b))
end_define

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|a
parameter_list|)
value|((a)< 0 ? -(a) : (a))
end_define

begin_typedef
typedef|typedef
enum|enum
name|_bool
block|{
name|FALSE
block|,
name|TRUE
block|}
name|Bool
typedef|;
end_typedef

begin_decl_stmt
name|Bool
name|XClockDebug
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Bool
name|AnalogClock
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Bool
name|ShowSecondHand
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Bool
name|Reverse
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|CenterX
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|CenterY
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|NumSegs
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|FrgrndColor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|BkgrndColor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|BorderColor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|HighColor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Vertex
name|SegBuff
index|[
name|SEG_BUFF_SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Vertex
modifier|*
name|SegBuffPtr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|ClockWindow
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|char
name|time_string
index|[
literal|26
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|time_ptr
init|=
name|time_string
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
specifier|register
name|Bool
name|debug
init|=
name|XClockDebug
decl_stmt|;
endif|#
directive|endif
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|int
name|radius
decl_stmt|;
specifier|register
name|int
name|padding
init|=
name|UNINIT
decl_stmt|;
comment|/* UNINIT = parameter uninitialized. */
name|int
name|border
init|=
name|UNINIT
decl_stmt|;
comment|/* UNINIT = parameter uninitialized. */
name|int
name|update
init|=
name|UNINIT
decl_stmt|;
comment|/* UNINIT = parameter uninitialized. */
name|int
name|win_width
init|=
name|UNINIT
decl_stmt|;
comment|/* UNINIT = parameter uninitialized. */
name|int
name|win_height
init|=
name|UNINIT
decl_stmt|;
comment|/* UNINIT = parameter uninitialized. */
name|int
name|second_hand_length
decl_stmt|;
name|int
name|minute_hand_length
decl_stmt|;
name|int
name|hour_hand_length
decl_stmt|;
name|int
name|readfds
init|=
literal|0
decl_stmt|;
name|int
name|maxfds
init|=
literal|0
decl_stmt|;
name|int
name|string_width
decl_stmt|;
name|int
name|status
decl_stmt|;
name|Bool
name|even_update
init|=
name|FALSE
decl_stmt|;
name|long
name|time_value
decl_stmt|;
name|char
modifier|*
name|index
parameter_list|()
function_decl|;
name|char
modifier|*
name|ctime
argument_list|()
decl_stmt|,
name|asctim
argument_list|()
decl_stmt|;
name|char
modifier|*
name|strind
decl_stmt|;
name|char
modifier|*
name|fn
init|=
name|DEF_DIGITAL_FONT
decl_stmt|;
name|char
modifier|*
name|fore_color
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|back_color
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|high_color
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|brdr_color
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|geom
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|display
init|=
name|NULL
decl_stmt|;
name|int
name|rvflag
init|=
literal|0
decl_stmt|;
name|Color
name|cdef
decl_stmt|;
name|struct
name|tm
modifier|*
name|localtime
parameter_list|()
function_decl|;
name|struct
name|timeval
name|timeout
decl_stmt|;
name|struct
name|tm
name|tm
decl_stmt|;
name|struct
name|tm
name|otm
decl_stmt|;
name|Font
name|font
decl_stmt|;
name|FontInfo
name|font_info
decl_stmt|;
name|XEvent
name|event
decl_stmt|;
name|char
modifier|*
name|def_val
decl_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"BorderWidth"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|border
operator|=
name|atoi
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"BodyFont"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|fn
operator|=
name|def_val
expr_stmt|;
name|fore_color
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Foreground"
argument_list|)
expr_stmt|;
name|back_color
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Background"
argument_list|)
expr_stmt|;
name|high_color
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Highlight"
argument_list|)
expr_stmt|;
name|brdr_color
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Border"
argument_list|)
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"ReverseVideo"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|rvflag
operator|++
expr_stmt|;
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"InternalBorder"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|padding
operator|=
name|atoi
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Mode"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"analog"
argument_list|)
operator|==
literal|0
condition|)
name|AnalogClock
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"digital"
argument_list|)
operator|==
literal|0
condition|)
name|AnalogClock
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"Analog"
argument_list|)
operator|==
literal|0
condition|)
name|AnalogClock
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|def_val
argument_list|,
literal|"Digital"
argument_list|)
operator|==
literal|0
condition|)
name|AnalogClock
operator|=
name|FALSE
expr_stmt|;
block|}
name|def_val
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Update"
argument_list|)
expr_stmt|;
if|if
condition|(
name|def_val
operator|!=
name|NULL
condition|)
name|update
operator|=
name|atoi
argument_list|(
name|def_val
argument_list|)
expr_stmt|;
name|geom
operator|=
name|XGetDefault
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"Geometry"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|argv
index|[
name|i
index|]
index|[
literal|0
index|]
operator|==
literal|'='
condition|)
block|{
name|geom
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
name|strind
operator|=
name|index
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|!=
name|NULL
condition|)
block|{
name|display
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
name|strind
operator|=
name|index
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
if|if
condition|(
name|strind
operator|==
name|NULL
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-a"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-analog"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|AnalogClock
operator|=
name|TRUE
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-d"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-digital"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|AnalogClock
operator|=
name|FALSE
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-bw"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-border"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|border
operator|=
name|atoi
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
ifdef|#
directive|ifdef
name|DEBUG
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-debug"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|XClockDebug
operator|=
name|TRUE
expr_stmt|;
name|debug
operator|=
name|TRUE
expr_stmt|;
continue|continue;
block|}
endif|#
directive|endif
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-fn"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-font"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|fn
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-fg"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-foreground"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|fore_color
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-bg"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-background"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|back_color
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-hl"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-highlight"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|high_color
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-bd"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-bordercolor"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|brdr_color
operator|=
name|argv
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-p"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-padding"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|padding
operator|=
name|atoi
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-rv"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-reverse"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|rvflag
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-u"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
literal|"-update"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|++
name|i
operator|>=
name|argc
condition|)
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|update
operator|=
name|atoi
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|Syntax
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
comment|/*      * Open up the display.      */
if|if
condition|(
name|XOpenDisplay
argument_list|(
name|display
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|XClockError
argument_list|(
literal|"Error while trying to open display"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rvflag
condition|)
name|Reverse
operator|=
name|TRUE
expr_stmt|;
comment|/*      * Set up colors and pixmaps.      */
if|if
condition|(
name|brdr_color
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|brdr_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|BorderColor
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
else|else
name|BorderColor
operator|=
name|DEF_BORDER_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|brdr_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|BorderColor
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|brdr_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|BorderColor
operator|=
name|WhitePixel
expr_stmt|;
else|else
name|BorderColor
operator|=
name|DEF_BORDER_COLOR
expr_stmt|;
block|}
else|else
name|BorderColor
operator|=
name|DEF_BORDER_COLOR
expr_stmt|;
if|if
condition|(
name|fore_color
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|fore_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|FrgrndColor
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
else|else
name|FrgrndColor
operator|=
name|DEF_FRGRND_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|fore_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|FrgrndColor
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|fore_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|FrgrndColor
operator|=
name|WhitePixel
expr_stmt|;
else|else
name|FrgrndColor
operator|=
name|DEF_FRGRND_COLOR
expr_stmt|;
block|}
else|else
name|FrgrndColor
operator|=
name|DEF_FRGRND_COLOR
expr_stmt|;
if|if
condition|(
name|back_color
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|back_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|BkgrndColor
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
else|else
name|BkgrndColor
operator|=
name|DEF_BKGRND_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|back_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|BkgrndColor
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|back_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|BkgrndColor
operator|=
name|WhitePixel
expr_stmt|;
else|else
name|BkgrndColor
operator|=
name|DEF_BKGRND_COLOR
expr_stmt|;
block|}
else|else
name|BkgrndColor
operator|=
name|DEF_BKGRND_COLOR
expr_stmt|;
if|if
condition|(
operator|(
name|high_color
operator|!=
name|NULL
operator|)
operator|&&
name|AnalogClock
condition|)
block|{
if|if
condition|(
name|DisplayCells
argument_list|()
operator|>
literal|2
condition|)
block|{
if|if
condition|(
name|XParseColor
argument_list|(
name|high_color
argument_list|,
operator|&
name|cdef
argument_list|)
operator|&&
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
name|HighColor
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
else|else
name|HighColor
operator|=
name|DEF_HIGH_COLOR
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|high_color
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
name|HighColor
operator|=
name|BlackPixel
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|high_color
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
name|HighColor
operator|=
name|WhitePixel
expr_stmt|;
else|else
name|HighColor
operator|=
name|DEF_HIGH_COLOR
expr_stmt|;
block|}
else|else
name|HighColor
operator|=
name|DEF_HIGH_COLOR
expr_stmt|;
if|if
condition|(
name|Reverse
condition|)
block|{
name|HighColor
operator|=
name|BorderColor
operator|=
name|BkgrndColor
expr_stmt|;
name|BkgrndColor
operator|=
name|FrgrndColor
expr_stmt|;
name|FrgrndColor
operator|=
name|HighColor
expr_stmt|;
block|}
comment|/*      * Set up analog and digital specific defaults.      */
if|if
condition|(
name|AnalogClock
operator|==
name|TRUE
condition|)
block|{
comment|/* 	 * Set analog defaults. 	 */
if|if
condition|(
name|padding
operator|==
name|UNINIT
condition|)
name|padding
operator|=
name|DEF_ANALOG_PADDING
expr_stmt|;
if|if
condition|(
name|update
operator|==
name|UNINIT
condition|)
name|update
operator|=
name|DEF_UPDATE
expr_stmt|;
if|if
condition|(
name|update
operator|<=
name|SECOND_HAND_TIME
condition|)
name|ShowSecondHand
operator|=
name|TRUE
expr_stmt|;
comment|/* 	 * Initialize the segment buffer and segment buffer pointer. 	 */
name|SegBuffPtr
operator|=
name|SegBuff
expr_stmt|;
comment|/* 	 * Initialize the number of "segments" in the buffer; each 	 * segment is one Vertex or 3 shorts, an x value, a y value 	 * and the flags as passed to XDraw. 	 */
name|NumSegs
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/*  	 * Set digital defaults. 	 */
if|if
condition|(
name|padding
operator|==
name|UNINIT
condition|)
name|padding
operator|=
name|DEF_DIGITAL_PADDING
expr_stmt|;
if|if
condition|(
name|update
operator|==
name|UNINIT
condition|)
name|update
operator|=
name|DEF_UPDATE
expr_stmt|;
comment|/* 	 * Get font dependent information and determine window 	 * size from a test string. 	 */
name|time
argument_list|(
operator|&
name|time_value
argument_list|)
expr_stmt|;
name|time_ptr
operator|=
name|ctime
argument_list|(
operator|&
name|time_value
argument_list|)
expr_stmt|;
name|time_ptr
index|[
name|strlen
argument_list|(
name|time_ptr
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|font
operator|=
name|XGetFont
argument_list|(
name|fn
argument_list|)
expr_stmt|;
if|if
condition|(
name|font
operator|==
name|FAILURE
condition|)
name|XClockError
argument_list|(
literal|"Can't get font"
argument_list|)
expr_stmt|;
name|status
operator|=
name|XQueryFont
argument_list|(
name|font
argument_list|,
operator|&
name|font_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|FAILURE
condition|)
name|XClockError
argument_list|(
literal|"Can't query font"
argument_list|)
expr_stmt|;
name|string_width
operator|=
name|XQueryWidth
argument_list|(
name|time_ptr
argument_list|,
name|font
argument_list|)
expr_stmt|;
block|}
comment|/*       * Now set analog and digital independent defaults.      */
if|if
condition|(
name|border
operator|==
name|UNINIT
condition|)
name|border
operator|=
name|DEF_BORDER
expr_stmt|;
if|if
condition|(
name|update
operator|>
literal|1
operator|&&
operator|(
operator|(
literal|60
operator|/
name|update
operator|)
operator|*
name|update
operator|==
literal|60
operator|)
condition|)
name|even_update
operator|=
name|TRUE
expr_stmt|;
comment|/*      * Open the main window.      */
block|{
name|int
name|min_width
decl_stmt|,
name|min_height
decl_stmt|;
name|char
name|default_geom
index|[
literal|20
index|]
decl_stmt|;
name|OpaqueFrame
name|frame
decl_stmt|;
if|if
condition|(
name|AnalogClock
condition|)
block|{
name|min_width
operator|=
name|DEF_ANALOG_WIDTH
operator|/
literal|3
expr_stmt|;
name|min_height
operator|=
name|DEF_ANALOG_HEIGHT
operator|/
literal|3
expr_stmt|;
name|sprintf
argument_list|(
name|default_geom
argument_list|,
literal|"%dx%d-0-0"
argument_list|,
name|DEF_ANALOG_WIDTH
argument_list|,
name|DEF_ANALOG_HEIGHT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|min_width
operator|=
name|string_width
operator|+
operator|(
literal|2
operator|*
name|padding
operator|)
expr_stmt|;
name|min_height
operator|=
name|font_info
operator|.
name|height
operator|+
operator|(
literal|2
operator|*
name|padding
operator|)
expr_stmt|;
name|sprintf
argument_list|(
name|default_geom
argument_list|,
literal|"%dx%d-0-0"
argument_list|,
name|min_width
argument_list|,
name|min_height
argument_list|)
expr_stmt|;
block|}
name|frame
operator|.
name|bdrwidth
operator|=
name|border
expr_stmt|;
name|frame
operator|.
name|border
operator|=
name|XMakeTile
argument_list|(
name|BorderColor
argument_list|)
expr_stmt|;
name|frame
operator|.
name|background
operator|=
name|XMakeTile
argument_list|(
name|BkgrndColor
argument_list|)
expr_stmt|;
name|ClockWindow
operator|=
name|XCreate
argument_list|(
name|AnalogClock
condition|?
literal|"Analog XClock"
else|:
literal|"Digital XClock"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|geom
argument_list|,
name|default_geom
argument_list|,
operator|&
name|frame
argument_list|,
name|min_width
argument_list|,
name|min_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|ClockWindow
operator|==
name|FAILURE
condition|)
name|XClockError
argument_list|(
literal|"Can't open clock window"
argument_list|)
expr_stmt|;
block|}
comment|/*      * Select window exposure events to see if the contents of      * the window have been erased or altered.  Select unmap events so      * we can stop output when iconified.      */
name|XSelectInput
argument_list|(
name|ClockWindow
argument_list|,
name|ExposeWindow
operator||
name|UnmapWindow
argument_list|)
expr_stmt|;
comment|/*      * Map clock window to screen.      */
name|XMapWindow
argument_list|(
name|ClockWindow
argument_list|)
expr_stmt|;
comment|/*      * Initialize the select system call's maximum file      * descriptor number to be one more than the file descriptor      * number of the X connection.      */
name|maxfds
operator|=
name|dpyno
argument_list|()
operator|+
literal|1
expr_stmt|;
comment|/*      * Initialize the select timeout structure.      */
name|timeout
operator|.
name|tv_sec
operator|=
name|update
expr_stmt|;
name|timeout
operator|.
name|tv_usec
operator|=
literal|0
expr_stmt|;
comment|/*      * Initialize the old-time structure.      */
name|otm
operator|=
operator|*
name|localtime
argument_list|(
operator|&
name|time_value
argument_list|)
expr_stmt|;
comment|/*      * Synchronize X before proceeding.      */
name|XSync
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
comment|/*      * Main clock loop.      */
while|while
condition|(
name|TRUE
condition|)
block|{
name|time
argument_list|(
operator|&
name|time_value
argument_list|)
expr_stmt|;
name|tm
operator|=
operator|*
name|localtime
argument_list|(
operator|&
name|time_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|even_update
condition|)
block|{
comment|/* Truncate to update interval, get new timeout */
name|timeout
operator|.
name|tv_sec
operator|=
name|update
operator|-
name|tm
operator|.
name|tm_sec
expr_stmt|;
name|tm
operator|.
name|tm_sec
operator|=
operator|(
name|tm
operator|.
name|tm_sec
operator|/
name|update
operator|)
operator|*
name|update
expr_stmt|;
name|timeout
operator|.
name|tv_sec
operator|+=
name|tm
operator|.
name|tm_sec
expr_stmt|;
block|}
if|if
condition|(
name|AnalogClock
operator|==
name|FALSE
condition|)
block|{
comment|/*  	     * See if there are any events pending that 	     * arn't supposed to be there. 	     */
if|if
condition|(
name|XPending
argument_list|()
operator|!=
literal|0
condition|)
block|{
comment|/* 		 * There is an event pending so we must 		 * check to see if it is an ExposeWindow 		 * event, if it is anything else somthing 		 * went wrong! 		 */
name|XNextEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|.
name|type
operator|==
name|UnmapWindow
condition|)
block|{
name|XPeekEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|event
operator|.
name|type
operator|!=
name|ExposeWindow
condition|)
block|{
name|XClockError
argument_list|(
literal|"Unexpected X_Event (digital mode)"
argument_list|)
expr_stmt|;
block|}
block|}
name|time_ptr
operator|=
name|asctime
argument_list|(
operator|&
name|tm
argument_list|)
expr_stmt|;
name|time_ptr
index|[
name|strlen
argument_list|(
name|time_ptr
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|XTextPad
argument_list|(
name|ClockWindow
argument_list|,
name|padding
argument_list|,
name|padding
argument_list|,
name|time_ptr
argument_list|,
name|strlen
argument_list|(
name|time_ptr
argument_list|)
argument_list|,
name|font
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FrgrndColor
argument_list|,
name|BkgrndColor
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*  	     * Look for an X_Event associated with xclock. 	     */
if|if
condition|(
name|XPending
argument_list|()
operator|!=
literal|0
condition|)
block|{
comment|/* 		 * There is an event pending so we must 		 * check to see if it is an ExposeWindow 		 * event, if it is anything else, somthing 		 * went wrong! 		 */
name|XNextEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|.
name|type
operator|==
name|UnmapWindow
condition|)
block|{
name|XPeekEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|event
operator|.
name|type
operator|==
name|ExposeWindow
condition|)
block|{
comment|/* 		     * Ok, we have a window exposure event, 		     * refresh the clock face.  Check to 		     * see if the window has changed size. 		     */
name|XExposeWindowEvent
modifier|*
name|exp_event
init|=
operator|(
name|XExposeWindowEvent
operator|*
operator|)
operator|&
name|event
decl_stmt|;
if|if
condition|(
operator|(
name|exp_event
operator|->
name|width
operator|!=
name|win_width
operator|)
operator|||
operator|(
name|exp_event
operator|->
name|height
operator|!=
name|win_height
operator|)
condition|)
block|{
name|win_width
operator|=
name|exp_event
operator|->
name|width
expr_stmt|;
name|win_height
operator|=
name|exp_event
operator|->
name|height
expr_stmt|;
name|radius
operator|=
operator|(
name|min
argument_list|(
name|win_width
argument_list|,
name|win_height
argument_list|)
operator|-
operator|(
literal|2
operator|*
name|padding
operator|)
operator|)
operator|/
literal|2
expr_stmt|;
name|second_hand_length
operator|=
operator|(
operator|(
name|SECOND_HAND_FRACT
operator|*
name|radius
operator|)
operator|/
literal|100
operator|)
expr_stmt|;
name|minute_hand_length
operator|=
operator|(
operator|(
name|MINUTE_HAND_FRACT
operator|*
name|radius
operator|)
operator|/
literal|100
operator|)
expr_stmt|;
name|hour_hand_length
operator|=
operator|(
operator|(
name|HOUR_HAND_FRACT
operator|*
name|radius
operator|)
operator|/
literal|100
operator|)
expr_stmt|;
name|CenterX
operator|=
name|win_width
operator|/
literal|2
expr_stmt|;
name|CenterY
operator|=
name|win_height
operator|/
literal|2
expr_stmt|;
block|}
name|DrawClockFace
argument_list|(
name|second_hand_length
argument_list|,
name|radius
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* 		     * We should never get here! 		     */
name|XClockError
argument_list|(
literal|"Unexpected X_Event (analog mode)"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 	     * The second (or minute) hand is sec (or min)  	     * sixtieths around the clock face. The hour hand is 	     * (hour + min/60) twelfths of the way around the 	     * clock-face.  The derivation is left as an excercise 	     * for the reader. 	     */
comment|/* 	     * Erase old hands. 	     */
if|if
condition|(
name|ShowSecondHand
operator|==
name|TRUE
condition|)
block|{
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|second_hand_length
argument_list|,
operator|(
operator|(
name|double
operator|)
name|otm
operator|.
name|tm_sec
operator|)
operator|/
literal|60.0
argument_list|)
expr_stmt|;
block|}
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|minute_hand_length
argument_list|,
operator|(
operator|(
name|double
operator|)
name|otm
operator|.
name|tm_min
operator|)
operator|/
literal|60.0
argument_list|)
expr_stmt|;
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|hour_hand_length
argument_list|,
operator|(
operator|(
operator|(
name|double
operator|)
name|otm
operator|.
name|tm_hour
operator|)
operator|+
operator|(
operator|(
operator|(
name|double
operator|)
name|otm
operator|.
name|tm_min
operator|)
operator|/
literal|60.0
operator|)
operator|)
operator|/
literal|12.0
argument_list|)
expr_stmt|;
name|Sync
argument_list|(
name|BkgrndColor
argument_list|)
expr_stmt|;
comment|/* 	     * 12 hour clock. 	     */
if|if
condition|(
name|tm
operator|.
name|tm_hour
operator|>
literal|12
condition|)
name|tm
operator|.
name|tm_hour
operator|-=
literal|12
expr_stmt|;
comment|/* 	     * Draw new hands. 	     */
if|if
condition|(
name|ShowSecondHand
operator|==
name|TRUE
condition|)
block|{
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|second_hand_length
argument_list|,
operator|(
operator|(
name|double
operator|)
name|tm
operator|.
name|tm_sec
operator|)
operator|/
literal|60.0
argument_list|)
expr_stmt|;
block|}
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|minute_hand_length
argument_list|,
operator|(
operator|(
name|double
operator|)
name|tm
operator|.
name|tm_min
operator|)
operator|/
literal|60.0
argument_list|)
expr_stmt|;
name|DrawHand
argument_list|(
literal|1
argument_list|,
name|hour_hand_length
argument_list|,
operator|(
operator|(
operator|(
name|double
operator|)
name|tm
operator|.
name|tm_hour
operator|)
operator|+
operator|(
operator|(
operator|(
name|double
operator|)
name|tm
operator|.
name|tm_min
operator|)
operator|/
literal|60.0
operator|)
operator|)
operator|/
literal|12.0
argument_list|)
expr_stmt|;
name|Sync
argument_list|(
name|HighColor
argument_list|)
expr_stmt|;
comment|/* 	     * Make the new time now be the old time. 	     */
name|otm
operator|=
name|tm
expr_stmt|;
block|}
name|XFlush
argument_list|()
expr_stmt|;
comment|/* 	 * Use the select system call on the file descriptor in 	 * the display structure to determine if there is work 	 * to be done.  If not block untill timeout.  Remember to 	 * reset the file descriptor before each select. 	 */
name|readfds
operator|=
literal|1
operator|<<
name|dpyno
argument_list|()
expr_stmt|;
if|if
condition|(
name|select
argument_list|(
name|maxfds
argument_list|,
operator|&
name|readfds
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|timeout
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|XClockError
argument_list|(
literal|"Error in select on display file descriptor"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * DrawHand - Draws (or erases) a hand.  Fraction_of_a_circle is a  * fraction between 0 and 1 (inclusive) indicating how far around the  * circle (clockwise) high noon.  *  * Blank_length is the distance from the center which the hand begins  * (logically 0, but I have the feature, I might as well use it).  * length is the maximum length of the hand.  *  * The blank_length feature is because I wanted to draw tick-marks around the  * circle (for seconds).  The obvious means of drawing lines from the center  * to the perimeter, then erasing all but the outside most pixels doesn't  * work because of round-off error (sigh).  */
end_comment

begin_macro
name|DrawHand
argument_list|(
argument|blank_length
argument_list|,
argument|length
argument_list|,
argument|fraction_of_a_circle
argument_list|)
end_macro

begin_decl_stmt
name|int
name|blank_length
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|length
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|fraction_of_a_circle
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|double
name|cos
parameter_list|()
function_decl|;
name|double
name|sin
parameter_list|()
function_decl|;
name|double
name|angle
decl_stmt|;
comment|/* 	 *  A full circle is 2 PI radians. 	 *  Angles are measured from 6 o'clock, not noon (or so it seems). 	 *  Thus, when fraction_of_a_circle is 0, we want angle to be PI, 	 *  and when fraction_of_a_circle is 1, we want angle to be 3 PI. 	 * 	 *  Also, angles increase counter-clockwise, not clockwise, so we 	 *  throw in a factor of -1 so our clock doesn't run backwards. 	 */
name|angle
operator|=
operator|(
operator|-
literal|2
operator|*
name|PI
operator|*
name|fraction_of_a_circle
operator|)
operator|+
name|PI
expr_stmt|;
comment|/* 	 * Add the move instruction to the segment buffer and increment 	 * the "next" pointer. 	 */
name|SegBuffPtr
operator|->
name|x
operator|=
name|CenterX
operator|+
call|(
name|int
call|)
argument_list|(
operator|(
name|float
operator|)
name|blank_length
operator|*
name|sin
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
name|SegBuffPtr
operator|->
name|y
operator|=
name|CenterY
operator|+
call|(
name|int
call|)
argument_list|(
operator|(
name|float
operator|)
name|blank_length
operator|*
name|cos
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
name|SegBuffPtr
operator|->
name|flags
operator|=
name|VertexDontDraw
expr_stmt|;
name|SegBuffPtr
operator|++
expr_stmt|;
name|NumSegs
operator|++
expr_stmt|;
comment|/* 	 * Add the new point to the buffer and increment the "next" pointer. 	 */
name|SegBuffPtr
operator|->
name|x
operator|=
name|CenterX
operator|+
call|(
name|int
call|)
argument_list|(
operator|(
name|float
operator|)
name|length
operator|*
name|sin
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
name|SegBuffPtr
operator|->
name|y
operator|=
name|CenterY
operator|+
call|(
name|int
call|)
argument_list|(
operator|(
name|float
operator|)
name|length
operator|*
name|cos
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
name|SegBuffPtr
operator|->
name|flags
operator|=
name|VertexDrawLastPoint
expr_stmt|;
name|SegBuffPtr
operator|++
expr_stmt|;
name|NumSegs
operator|++
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  *  Draw the clock face (every fifth tick-mark is longer  *  than the others).  */
end_comment

begin_macro
name|DrawClockFace
argument_list|(
argument|second_hand
argument_list|,
argument|radius
argument_list|)
end_macro

begin_decl_stmt
name|int
name|second_hand
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|radius
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|Bool
name|debug
init|=
name|XClockDebug
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|int
name|delta
init|=
operator|(
name|radius
operator|-
name|second_hand
operator|)
operator|/
literal|3
decl_stmt|;
name|XClear
argument_list|(
name|ClockWindow
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|60
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|%
literal|5
operator|)
operator|==
literal|0
condition|)
block|{
name|DrawHand
argument_list|(
name|second_hand
argument_list|,
name|radius
argument_list|,
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
literal|60.
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DrawHand
argument_list|(
operator|(
name|radius
operator|-
name|delta
operator|)
argument_list|,
name|radius
argument_list|,
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
literal|60.
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 	 * Flush the buffer to the VS100. 	 */
name|Sync
argument_list|(
name|FrgrndColor
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * This routine synchronizes the segment buffer contents with the  * VS100 screen.  In effect, it flushes the buffer contents to the  * screen.  */
end_comment

begin_macro
name|Sync
argument_list|(
argument|color
argument_list|)
end_macro

begin_decl_stmt
name|int
name|color
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* X drawing color. */
end_comment

begin_block
block|{
specifier|register
name|Bool
name|debug
init|=
name|XClockDebug
decl_stmt|;
comment|/* 	 * Call the X draw curve routine. 	 */
name|XDraw
argument_list|(
name|ClockWindow
argument_list|,
name|SegBuff
argument_list|,
name|NumSegs
argument_list|,
name|DEF_VECTOR_WIDTH
argument_list|,
name|DEF_VECTOR_HEIGHT
argument_list|,
name|color
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
comment|/* 	 * Reset the segment buffer pointer and the segment counter. 	 */
name|SegBuffPtr
operator|=
name|SegBuff
expr_stmt|;
name|NumSegs
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Report the syntax for calling xclock.  */
end_comment

begin_macro
name|Syntax
argument_list|(
argument|call
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|call
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"Usage: %s [-analog] [-bw<pixels>] [-digital]\n"
argument_list|,
name|call
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       [-fg<color>] [-bg<color>] [-hl<color>] [-bd<color>]\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       [-fn<font_name>] [-help] [-padding<pixels>]\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       [-rv] [-update<seconds>] [[<host>]:[<vs>]]\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       [=[<width>][x<height>][<+-><xoff>[<+-><yoff>]]]\n\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Default: %s -digital -bw %d -font %s -padding %d -update %d =-0-0\n\n"
argument_list|,
name|call
argument_list|,
name|DEF_BORDER
argument_list|,
name|DEF_DIGITAL_FONT
argument_list|,
name|DEF_DIGITAL_PADDING
argument_list|,
name|DEF_UPDATE
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Default: %s -analog -bw %d -padding %d -update %d =%dx%d-0-0\n\n"
argument_list|,
name|call
argument_list|,
name|DEF_BORDER
argument_list|,
name|DEF_DIGITAL_PADDING
argument_list|,
name|DEF_UPDATE
argument_list|,
name|DEF_ANALOG_WIDTH
argument_list|,
name|DEF_ANALOG_HEIGHT
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Notes: The order in which switches are specified is not significant.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       In analog mode the second hand only appears for update times\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"       less than or equal to %d seconds.\n"
argument_list|,
name|SECOND_HAND_TIME
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * XClockError - Fatal xclock error.  */
end_comment

begin_macro
name|XClockError
argument_list|(
argument|identifier
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|identifier
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|Bool
name|debug
init|=
name|XClockDebug
decl_stmt|;
if|if
condition|(
name|debug
condition|)
name|printf
argument_list|(
literal|"XClockError: Fatal xclock error encountered.\n"
argument_list|)
expr_stmt|;
name|perror
argument_list|(
literal|"xclock"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"xclock: %s\n"
argument_list|,
name|identifier
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * End of xclock.c  */
end_comment

end_unit

