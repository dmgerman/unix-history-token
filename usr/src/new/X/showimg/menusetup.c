begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* menu selection and setup */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<X/XMenu.h>
end_include

begin_include
include|#
directive|include
file|"shimg.h"
end_include

begin_comment
comment|/* This structure is mainly created to easily initialize and update the  * menu panes and selections. The null elements indicate to the initializing  * routine that that particular pane (and eventually the menu) are complete.  *  * When a menu selection is successful, it returns a pointer to the data  * array in the particular element. The first element contains the pane  * number in the upper word and the selection flag in the lower word. The  * second element contains the inverse of the mask to be applied to the  * corresponding flags location to remove the other panes' selection flags  * that are orthogonal to this one. The program can then `or' in this  * pane's selection flag (if desireable) and take the appropriate action.  */
end_comment

begin_struct
struct|struct
name|menupane
block|{
name|char
modifier|*
name|label
decl_stmt|;
name|int
name|active
decl_stmt|;
name|int
name|data
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
name|struct
name|menupane
name|menuset
index|[]
init|=
block|{
comment|/* View Ops pane */
block|{
literal|"View Ops"
block|,
literal|1
block|,
name|VOP
block|,
literal|0
block|}
block|,
block|{
literal|"gray scale"
block|,
literal|1
block|,
block|{
name|VOP
operator||
name|VOP_GrayScale
block|,
name|VOP_RGB
block|}
block|}
block|,
block|{
literal|"rgb"
block|,
literal|1
block|,
block|{
name|VOP
operator||
name|VOP_RGB
block|,
name|VOP_GrayScale
block|}
block|}
block|,
block|{
literal|"normal"
block|,
literal|1
block|,
block|{
name|VOP
operator||
name|VOP_Normal
block|,
name|VOP_Inverse
block|}
block|}
block|,
block|{
literal|"inverse"
block|,
literal|1
block|,
block|{
name|VOP
operator||
name|VOP_Inverse
block|,
name|VOP_Normal
block|}
block|}
block|,
block|{
literal|"initialize"
block|,
literal|1
block|,
block|{
name|VOP
operator||
name|VOP_Initialize
block|,
literal|0
block|}
block|}
block|,
block|{
literal|"EXIT"
block|,
literal|1
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Cursor Ops pane */
block|{
literal|"Cursor Ops"
block|,
literal|1
block|,
name|COP
block|,
literal|0
block|}
block|,
block|{
literal|"print"
block|,
literal|1
block|,
block|{
name|COP
operator||
name|COP_Print
block|,
name|COP_Pan
operator||
name|COP_Zoom2
operator||
name|COP_Zoom4
block|}
block|}
block|,
block|{
literal|"pan"
block|,
literal|1
block|,
block|{
name|COP
operator||
name|COP_Pan
block|,
name|COP_Print
operator||
name|COP_Zoom2
operator||
name|COP_Zoom4
block|}
block|}
block|,
block|{
literal|"zoom x2"
block|,
literal|1
block|,
block|{
name|COP
operator||
name|COP_Zoom2
block|,
name|COP_Print
operator||
name|COP_Pan
operator||
name|COP_Zoom4
block|}
block|}
block|,
block|{
literal|"zoom x4"
block|,
literal|1
block|,
block|{
name|COP
operator||
name|COP_Zoom4
block|,
name|COP_Print
operator||
name|COP_Pan
operator||
name|COP_Zoom2
block|}
block|}
block|,
comment|/*  { "set origin", 0, COP | COP_SetOrigin, 0 },     { "box",        0, COP | COP_Box, 0       }, */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Scaling Ops pane */
block|{
literal|"Scaling"
block|,
literal|1
block|,
name|SOP
block|,
literal|0
block|}
block|,
block|{
literal|"linear"
block|,
literal|1
block|,
block|{
name|SOP
operator||
name|SOP_Linear
block|,
name|SOP_Log
operator||
name|SOP_Sqrt
operator||
name|SOP_Histogram
block|}
block|}
block|,
block|{
literal|"sqrt"
block|,
literal|1
block|,
block|{
name|SOP
operator||
name|SOP_Sqrt
block|,
name|SOP_Linear
operator||
name|SOP_Sqrt
operator||
name|SOP_Histogram
block|}
block|}
block|,
comment|/*  { "log",       0, { SOP | SOP_Log, SOP_Linear|SOP_Log|SOP_Histogram }   },     { "histogram", 0, { SOP | SOP_Histogram, SOP_Linear|SOP_Log|SOP_Sqrt }  }, */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* File Ops pane */
comment|/*    { "I/O",        0, FOP, 0 },     { "read image", 0, FOP | FOP_Read, 0      },     { "flatfield",  0, FOP | FOP_Flatfield, 0 },     { "add image",  0, FOP | FOP_AddImage, 0  },     { 0, 0, 0, 0 }, */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|XMenu
modifier|*
name|menusetup
parameter_list|(
name|program
parameter_list|)
name|char
modifier|*
name|program
decl_stmt|;
block|{
name|XMenu
modifier|*
name|menu
decl_stmt|,
modifier|*
name|XMenuCreate
argument_list|()
decl_stmt|;
name|int
name|XMenuAddPane
argument_list|()
decl_stmt|,
name|XMenuAddSelection
argument_list|()
decl_stmt|,
name|XMenuRecompute
argument_list|()
decl_stmt|;
name|int
name|pane
init|=
literal|0
decl_stmt|,
name|sel
decl_stmt|;
specifier|register
name|struct
name|menupane
modifier|*
name|imenu
init|=
operator|&
name|menuset
index|[
literal|0
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|menu
operator|=
name|XMenuCreate
argument_list|(
name|RootWindow
argument_list|,
name|program
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Menu creation failed!\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* insert the panes& selections into the menu structure */
while|while
condition|(
name|imenu
operator|->
name|label
condition|)
block|{
name|sel
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|XMenuAddPane
argument_list|(
name|menu
argument_list|,
name|imenu
operator|->
name|label
argument_list|,
name|imenu
operator|->
name|active
argument_list|)
operator|)
operator|==
name|XM_FAILURE
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't add pane %d!\n"
argument_list|,
name|pane
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
operator|++
name|imenu
expr_stmt|;
while|while
condition|(
name|imenu
operator|->
name|label
condition|)
block|{
if|if
condition|(
operator|(
name|XMenuAddSelection
argument_list|(
name|menu
argument_list|,
name|pane
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|imenu
operator|->
name|data
index|[
literal|0
index|]
argument_list|,
name|imenu
operator|->
name|label
argument_list|,
name|imenu
operator|->
name|active
argument_list|)
operator|)
operator|==
name|XM_FAILURE
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't add selection %d to pane %d!\n"
argument_list|,
name|sel
argument_list|,
name|pane
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|sel
operator|++
expr_stmt|;
operator|++
name|imenu
expr_stmt|;
block|}
name|pane
operator|++
expr_stmt|;
operator|++
name|imenu
expr_stmt|;
block|}
name|XMenuRecompute
argument_list|(
name|menu
argument_list|)
expr_stmt|;
return|return
operator|(
name|menu
operator|)
return|;
block|}
end_function

end_unit

