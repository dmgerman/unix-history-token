begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Program to display images on uVax II/GPX under the X window system.  *  * Bill Wyatt and Jim Gettys, Feb. 12 1986 et. seq.  *  * 4/23/86 WFW  *     Added FITS file reading capability, selected via -fits option.  *  * 7/86  WFW  *     Added disk fits format via -dfits option, for not swapping bytes,  *     but file otherwise in disk format.  *  * 7/86  WFW  *     Added palette subwindow, zoomx4 window, independently resizeable.  *  * 8/11/86  WFW  *     If the palette window needs to be independent instead of a subwindow,  *     then compile with PALWIND defined.  *   * 8/13/86 WFW  *     Added  ifdef support from Eric Mandel for ROSAT& Einstein images  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<X/XMenu.h>
end_include

begin_include
include|#
directive|include
file|<X/Xkeyboard.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|MC68000
end_ifdef

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"show.icon.ic"
end_include

begin_include
include|#
directive|include
file|"shimg.h"
end_include

begin_include
include|#
directive|include
file|"shopt.h"
end_include

begin_define
define|#
directive|define
name|TESTDEFAULT
value|"=512x512+100+134"
end_define

begin_define
define|#
directive|define
name|PICTDEFAULT
value|"+50+100"
end_define

begin_define
define|#
directive|define
name|TESTNROWS
value|512
end_define

begin_define
define|#
directive|define
name|MIN
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(((a)< (b)) ? (a) : (b))
end_define

begin_define
define|#
directive|define
name|MAX
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(((a)> (b)) ? (a) : (b))
end_define

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|struct
name|windmain
name|maininfo
decl_stmt|;
name|struct
name|colorwind
name|colorinfo
decl_stmt|;
name|struct
name|imagewind
name|imageinfo
decl_stmt|;
name|Window
name|wind
decl_stmt|,
name|subwind
decl_stmt|,
name|palwind
decl_stmt|,
name|wzoom
decl_stmt|;
name|Window
name|iconwindow
decl_stmt|,
name|iconwzoom
decl_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|Window
name|iconpalwind
decl_stmt|;
comment|/* palette window is independent, needs icon */
endif|#
directive|endif
name|WindowInfo
name|winfo
decl_stmt|,
name|palwinfo
decl_stmt|,
name|wzoominfo
decl_stmt|;
name|Cursor
name|imcursor
decl_stmt|,
name|pancursor
decl_stmt|,
name|printcursor
decl_stmt|,
name|zoom2cursor
decl_stmt|,
name|zoom4cursor
decl_stmt|;
name|Cursor
name|palcursor
decl_stmt|;
name|int
name|xcenter
init|=
operator|-
literal|1
decl_stmt|;
name|int
name|ycenter
init|=
operator|-
literal|1
decl_stmt|;
comment|/* nominal center of displayed image  */
name|int
name|xtempzero
decl_stmt|,
name|ytempzero
decl_stmt|;
name|int
name|xzoomsize
init|=
literal|124
decl_stmt|,
name|yzoomsize
init|=
literal|124
decl_stmt|;
name|XMenu
modifier|*
name|showmenu
decl_stmt|,
modifier|*
name|menusetup
argument_list|()
decl_stmt|;
name|int
name|XMenuSetFreeze
argument_list|()
decl_stmt|,
name|XMenuActivate
argument_list|()
decl_stmt|;
name|int
modifier|*
name|currentflags
decl_stmt|;
name|int
name|pane
init|=
literal|0
decl_stmt|,
name|sel
init|=
literal|0
decl_stmt|;
name|int
name|lastpane
init|=
literal|0
decl_stmt|,
name|lastsel
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
name|palette
index|[
literal|2048
index|]
decl_stmt|;
comment|/* palette window array */
name|short
modifier|*
name|readheader
argument_list|()
decl_stmt|,
modifier|*
name|readpict
argument_list|()
decl_stmt|;
name|int
name|scalepict
parameter_list|()
function_decl|;
name|int
name|zoomfactor
init|=
literal|0
decl_stmt|;
comment|/* replication factor for pixel display */
name|int
name|oldzoomfactor
init|=
literal|0
decl_stmt|;
name|int
name|fd
decl_stmt|,
name|open
argument_list|()
decl_stmt|,
name|close
argument_list|()
decl_stmt|,
name|ipow
argument_list|()
decl_stmt|;
name|int
name|w_mapped
init|=
literal|1
decl_stmt|;
name|int
name|rshift
init|=
literal|0
decl_stmt|;
name|int
name|keycode
init|=
literal|0
decl_stmt|;
name|int
name|xbut
decl_stmt|,
name|ybut
decl_stmt|;
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
name|char
modifier|*
name|keystring
decl_stmt|;
name|int
name|j
decl_stmt|,
name|k
decl_stmt|,
name|l
decl_stmt|;
name|XEvent
name|event
decl_stmt|,
name|peekevent
decl_stmt|;
name|XExposeEvent
modifier|*
name|expw
init|=
operator|(
name|XExposeEvent
operator|*
operator|)
operator|&
name|event
decl_stmt|;
specifier|register
name|XKeyOrButtonEvent
modifier|*
name|but
init|=
operator|(
name|XButtonEvent
operator|*
operator|)
operator|&
name|event
decl_stmt|;
specifier|register
name|XMouseMovedEvent
modifier|*
name|mouse
init|=
operator|(
name|XMouseMovedEvent
operator|*
operator|)
operator|&
name|event
decl_stmt|;
specifier|register
name|int
name|downbutton
init|=
operator|-
literal|1
decl_stmt|;
comment|/* mouse button flag */
specifier|register
name|int
name|xzero
decl_stmt|,
name|yzero
decl_stmt|;
comment|/* image coordinates of window(0,0) */
specifier|register
name|int
name|i
decl_stmt|;
comment|/* **** MAIN EXECUTION CODE STARTS HERE  **** */
name|maininfo
operator|.
name|display
operator|=
name|NULL
expr_stmt|;
name|colorinfo
operator|.
name|nplanes
operator|=
operator|-
literal|1
expr_stmt|;
name|imageinfo
operator|.
name|pmin
operator|=
literal|70000
expr_stmt|;
name|imageinfo
operator|.
name|pmax
operator|=
operator|-
literal|3000
expr_stmt|;
name|imageinfo
operator|.
name|headskip
operator|=
literal|0
expr_stmt|;
name|imageinfo
operator|.
name|calibration
operator|=
literal|0
expr_stmt|;
name|imageinfo
operator|.
name|fitsflag
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|XRAY
name|imageinfo
operator|.
name|ein
operator|=
literal|0
expr_stmt|;
name|imageinfo
operator|.
name|ros
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|imageinfo
operator|.
name|VOP_Flags
operator|=
name|VOP_GrayScale
operator||
name|VOP_Initialize
expr_stmt|;
name|imageinfo
operator|.
name|SOP_Flags
operator|=
name|SOP_Linear
expr_stmt|;
name|imageinfo
operator|.
name|COP_Flags
operator|=
literal|0
expr_stmt|;
name|imageinfo
operator|.
name|FOP_Flags
operator|=
literal|0
expr_stmt|;
name|shgetopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
operator|&
name|maininfo
argument_list|,
operator|&
name|colorinfo
argument_list|,
operator|&
name|imageinfo
argument_list|)
expr_stmt|;
comment|/* create the cursors */
name|make_cursors
argument_list|(
operator|&
name|imcursor
argument_list|,
operator|&
name|pancursor
argument_list|,
operator|&
name|printcursor
argument_list|,
operator|&
name|zoom2cursor
argument_list|,
operator|&
name|zoom4cursor
argument_list|,
operator|&
name|palcursor
argument_list|)
expr_stmt|;
comment|/* try for 8 planes (probably only gets 6) */
if|if
condition|(
name|colorinfo
operator|.
name|nplanes
operator|<
literal|0
condition|)
name|colorinfo
operator|.
name|nplanes
operator|=
name|MAX
argument_list|(
name|DisplayPlanes
argument_list|()
operator|-
literal|4
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* iterate until cells allocated. Check if enough */
if|if
condition|(
name|XGetColorCells
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|colorinfo
operator|.
name|nplanes
argument_list|,
operator|&
name|colorinfo
operator|.
name|planes
argument_list|,
operator|&
operator|(
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
operator|)
argument_list|)
operator|==
literal|0
condition|)
block|{
while|while
condition|(
operator|--
name|colorinfo
operator|.
name|nplanes
operator|>
literal|2
condition|)
if|if
condition|(
name|XGetColorCells
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|colorinfo
operator|.
name|nplanes
argument_list|,
operator|&
name|colorinfo
operator|.
name|planes
argument_list|,
operator|&
operator|(
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
operator|)
argument_list|)
operator|!=
literal|0
condition|)
break|break;
if|if
condition|(
name|colorinfo
operator|.
name|nplanes
operator|<=
literal|2
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Insufficient color planes resource!\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|colorinfo
operator|.
name|nplanes
operator|<
literal|6
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Allocated %d planes\n"
argument_list|,
name|colorinfo
operator|.
name|nplanes
argument_list|)
expr_stmt|;
block|}
name|colorinfo
operator|.
name|ncolors
operator|=
name|ipow
argument_list|(
literal|2
argument_list|,
name|colorinfo
operator|.
name|nplanes
argument_list|)
expr_stmt|;
comment|/* figure out how many bits we have to left shift the pixels */
name|colorinfo
operator|.
name|shift
operator|=
literal|0
expr_stmt|;
name|i
operator|=
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
operator||
name|colorinfo
operator|.
name|planes
expr_stmt|;
while|while
condition|(
operator|(
operator|(
name|i
operator|>>=
literal|1
operator|)
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
name|colorinfo
operator|.
name|shift
operator|++
expr_stmt|;
comment|/* get the menu selections ready */
name|showmenu
operator|=
name|menusetup
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|imageinfo
operator|.
name|calibration
condition|)
block|{
comment|/** GENERATE TEST SCREEN */
name|imageinfo
operator|.
name|ncols
operator|=
name|imageinfo
operator|.
name|nrows
operator|=
name|TESTNROWS
expr_stmt|;
name|rshift
operator|=
name|DisplayPlanes
argument_list|()
operator|-
name|colorinfo
operator|.
name|nplanes
operator|-
name|colorinfo
operator|.
name|shift
expr_stmt|;
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|image
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|*
name|imageinfo
operator|.
name|ncols
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't allocate test image!\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|imageinfo
operator|.
name|nrows
condition|;
name|j
operator|++
control|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|imageinfo
operator|.
name|ncols
condition|;
name|i
operator|++
control|)
operator|*
operator|(
name|imageinfo
operator|.
name|image
operator|+
name|j
operator|*
name|imageinfo
operator|.
name|ncols
operator|+
name|i
operator|)
operator|=
operator|(
operator|(
operator|(
operator|(
name|i
operator|+
name|j
operator|)
operator|&
literal|255
operator|)
operator|>>
name|rshift
operator|)
operator|&
name|colorinfo
operator|.
name|planes
operator|)
operator|+
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
expr_stmt|;
name|wind
operator|=
name|XCreate
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|maininfo
operator|.
name|geometry
argument_list|,
name|TESTDEFAULT
argument_list|,
operator|&
name|maininfo
operator|.
name|frame
argument_list|,
literal|100
argument_list|,
literal|134
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/** READ IN IMAGE **/
ifdef|#
directive|ifdef
name|XRAY
comment|/* code and conditional added by egm */
if|if
condition|(
name|imageinfo
operator|.
name|ein
operator|==
literal|1
condition|)
block|{
name|eimgopen
argument_list|(
name|imageinfo
operator|.
name|ict
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|imageinfo
operator|.
name|ros
operator|==
literal|1
condition|)
block|{
name|strcpy
argument_list|(
name|imageinfo
operator|.
name|poename
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|imageinfo
operator|.
name|poename
argument_list|,
literal|".poe"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|imageinfo
operator|.
name|hdrname
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|imageinfo
operator|.
name|hdrname
argument_list|,
literal|".hdr"
argument_list|)
expr_stmt|;
name|openpoe
argument_list|(
name|imageinfo
operator|.
name|muthict
argument_list|,
name|imageinfo
operator|.
name|poename
argument_list|,
name|imageinfo
operator|.
name|hdrname
argument_list|)
expr_stmt|;
block|}
else|else
block|{
endif|#
directive|endif
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|imageinfo
operator|.
name|filename
argument_list|,
name|O_RDONLY
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error opening file %s\n"
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|header
operator|=
name|readheader
argument_list|(
name|fd
argument_list|,
name|imageinfo
operator|.
name|headskip
argument_list|,
operator|&
name|imageinfo
operator|.
name|nrows
argument_list|,
operator|&
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|fitsflag
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error reading header of file %s\n"
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|PALWIND
name|sprintf
argument_list|(
name|maininfo
operator|.
name|filegeometry
argument_list|,
literal|"=%dx%d%s"
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|PICTDEFAULT
argument_list|)
expr_stmt|;
else|#
directive|else
name|sprintf
argument_list|(
name|maininfo
operator|.
name|filegeometry
argument_list|,
literal|"=%dx%d%s"
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
operator|+
name|PALHEIGHT
operator|+
literal|2
operator|*
name|PALBORDER
argument_list|,
name|PICTDEFAULT
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|XRAY
block|}
comment|/* end of conditional code added by egm */
endif|#
directive|endif
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|image
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|malloc
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|*
name|imageinfo
operator|.
name|ncols
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't allocate byte image?\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|XRAY
comment|/* conditional added by egm */
if|if
condition|(
name|imageinfo
operator|.
name|ein
operator|==
literal|1
condition|)
block|{
comment|/* Einstein XRAY image */
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|picture
operator|=
operator|(
name|short
operator|*
operator|)
name|malloc
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|*
name|imageinfo
operator|.
name|ncols
operator|*
literal|2
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't allocate xray image?\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|eimgread
argument_list|(
name|imageinfo
operator|.
name|ict
argument_list|,
name|imageinfo
operator|.
name|picture
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|iy
argument_list|,
name|imageinfo
operator|.
name|iz
argument_list|,
name|imageinfo
operator|.
name|zoom
argument_list|,
name|imageinfo
operator|.
name|zoom
argument_list|,
name|imageinfo
operator|.
name|energy
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|imageinfo
operator|.
name|ros
operator|==
literal|1
condition|)
block|{
comment|/* ROSAT XRAY image */
name|selectcenter
argument_list|(
name|imageinfo
operator|.
name|muthict
argument_list|,
name|imageinfo
operator|.
name|iy
argument_list|,
name|imageinfo
operator|.
name|iz
argument_list|)
expr_stmt|;
name|selectres
argument_list|(
name|imageinfo
operator|.
name|muthict
argument_list|,
name|imageinfo
operator|.
name|zoom
argument_list|,
name|imageinfo
operator|.
name|zoom
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|picture
operator|=
operator|(
name|short
operator|*
operator|)
name|malloc
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|*
name|imageinfo
operator|.
name|ncols
operator|*
literal|2
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't allocate xray image?\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|readpoe
argument_list|(
name|imageinfo
operator|.
name|muthict
argument_list|,
name|imageinfo
operator|.
name|picture
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|)
expr_stmt|;
block|}
else|else
block|{
endif|#
directive|endif
comment|/* SAOCCD or FITS image */
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|picture
operator|=
name|readpict
argument_list|(
name|fd
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|fitsflag
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error reading file %s\n"
argument_list|,
name|imageinfo
operator|.
name|filename
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|close
argument_list|(
name|fd
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|XRAY
block|}
comment|/* end of conditional added by egm */
endif|#
directive|endif
if|if
condition|(
name|imageinfo
operator|.
name|pmin
operator|==
literal|70000
operator|&&
name|imageinfo
operator|.
name|pmax
operator|==
operator|-
literal|3000
condition|)
name|maxminpict
argument_list|(
name|imageinfo
operator|.
name|picture
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
operator|&
name|imageinfo
operator|.
name|pmax
argument_list|,
operator|&
name|imageinfo
operator|.
name|pmin
argument_list|)
expr_stmt|;
name|scalepict
argument_list|(
name|imageinfo
operator|.
name|image
argument_list|,
name|imageinfo
operator|.
name|picture
argument_list|,
name|imageinfo
operator|.
name|pmax
argument_list|,
name|imageinfo
operator|.
name|pmin
argument_list|,
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
argument_list|,
name|colorinfo
operator|.
name|shift
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|SOP_Flags
argument_list|)
expr_stmt|;
name|wind
operator|=
name|XCreate
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|maininfo
operator|.
name|geometry
argument_list|,
name|maininfo
operator|.
name|filegeometry
argument_list|,
operator|&
name|maininfo
operator|.
name|frame
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|wind
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreate on root failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* get current info so as to be ready for subwindow placing */
name|XQueryWindow
argument_list|(
name|wind
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|iconwindow
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on iconwindow failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XSetIconWindow
argument_list|(
name|wind
argument_list|,
name|iconwindow
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
if|if
condition|(
operator|(
name|palwind
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|winfo
operator|.
name|x
argument_list|,
name|winfo
operator|.
name|y
operator|+
name|winfo
operator|.
name|height
argument_list|,
name|winfo
operator|.
name|width
argument_list|,
name|PALHEIGHT
argument_list|,
name|border_width
argument_list|,
name|maininfo
operator|.
name|frame
operator|.
name|border
argument_list|,
name|BlackPixmap
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on palwind failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XStoreName
argument_list|(
name|palwind
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
if|if
condition|(
operator|(
name|palwind
operator|=
name|XCreateWindow
argument_list|(
name|wind
argument_list|,
literal|0
argument_list|,
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
argument_list|,
name|winfo
operator|.
name|width
operator|-
literal|2
operator|*
name|PALBORDER
argument_list|,
name|PALHEIGHT
argument_list|,
name|PALBORDER
argument_list|,
name|WhitePixmap
argument_list|,
name|BlackPixmap
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on palwind failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
operator|(
name|wzoom
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|winfo
operator|.
name|x
operator|+
name|winfo
operator|.
name|width
operator|+
name|maininfo
operator|.
name|frame
operator|.
name|bdrwidth
argument_list|,
name|winfo
operator|.
name|y
argument_list|,
name|xzoomsize
argument_list|,
name|yzoomsize
argument_list|,
name|maininfo
operator|.
name|frame
operator|.
name|bdrwidth
argument_list|,
name|maininfo
operator|.
name|frame
operator|.
name|border
argument_list|,
name|BlackPixmap
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on wzoom failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XStoreName
argument_list|(
name|wzoom
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|iconwzoom
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on iconwzoom failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XSetIconWindow
argument_list|(
name|wzoom
argument_list|,
name|iconwzoom
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
if|if
condition|(
operator|(
name|iconpalwind
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"XCreateWindow on iconpalwind failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|XSetIconWindow
argument_list|(
name|palwind
argument_list|,
name|iconpalwind
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* define the cursors */
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|imcursor
argument_list|)
expr_stmt|;
name|XUndefineCursor
argument_list|(
name|palwind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|palwind
argument_list|,
name|palcursor
argument_list|)
expr_stmt|;
comment|/* assume we display center of image in center of window */
if|if
condition|(
name|xcenter
operator|<
literal|0
condition|)
name|xcenter
operator|=
name|imageinfo
operator|.
name|ncols
operator|>>
literal|1
expr_stmt|;
if|if
condition|(
name|ycenter
operator|<
literal|0
condition|)
name|ycenter
operator|=
name|imageinfo
operator|.
name|nrows
operator|>>
literal|1
expr_stmt|;
name|XSelectInput
argument_list|(
name|wind
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|MouseMoved
operator||
name|KeyPressed
operator||
name|ExposeRegion
operator||
name|ExposeWindow
operator||
name|ExposeCopy
operator||
name|UnmapWindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|iconwindow
argument_list|,
name|ExposeWindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|wzoom
argument_list|,
name|ExposeWindow
operator||
name|UnmapWindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|iconwzoom
argument_list|,
name|ExposeWindow
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|XSelectInput
argument_list|(
name|palwind
argument_list|,
name|ExposeWindow
operator||
name|UnmapWindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|iconpalwind
argument_list|,
name|ExposeWindow
argument_list|)
expr_stmt|;
else|#
directive|else
name|XSelectInput
argument_list|(
name|palwind
argument_list|,
name|ExposeWindow
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|XMapWindow
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|wzoom
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|XMapWindow
argument_list|(
name|palwind
argument_list|)
expr_stmt|;
else|#
directive|else
name|XMapSubwindows
argument_list|(
name|wind
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|XFlush
argument_list|()
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
name|imageinfo
operator|.
name|VOP_Flags
operator|&
name|VOP_Initialize
condition|)
block|{
name|initcmap
argument_list|(
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|,
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
argument_list|,
name|colorinfo
operator|.
name|nplanes
argument_list|,
name|imageinfo
operator|.
name|VOP_Flags
argument_list|)
expr_stmt|;
name|XStoreColors
argument_list|(
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|)
expr_stmt|;
name|imageinfo
operator|.
name|VOP_Flags
operator|&=
operator|~
operator|(
name|VOP_Initialize
operator|)
expr_stmt|;
block|}
name|XNextEvent
argument_list|(
operator|&
name|event
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|GLOPEROO
name|describe_XEvent
argument_list|(
name|event
operator|.
name|type
argument_list|,
name|event
operator|.
name|window
argument_list|,
name|but
operator|->
name|detail
argument_list|,
name|wind
argument_list|,
name|palwind
argument_list|,
name|wzoom
argument_list|)
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
operator|(
name|int
operator|)
name|event
operator|.
name|type
condition|)
block|{
case|case
name|KeyPressed
case|:
ifdef|#
directive|ifdef
name|VAX
name|keycode
operator|=
name|but
operator|->
name|detail
operator|&
literal|0x00ff
expr_stmt|;
if|if
condition|(
name|IsCursorKey
argument_list|(
name|keycode
argument_list|)
condition|)
block|{
name|XUpdateMouse
argument_list|(
name|wind
argument_list|,
operator|&
name|mouse
operator|->
name|x
argument_list|,
operator|&
name|mouse
operator|->
name|y
argument_list|,
operator|&
name|subwind
argument_list|)
expr_stmt|;
name|i
operator|=
literal|1
operator|<<
name|zoomfactor
expr_stmt|;
if|if
condition|(
name|keycode
operator|==
name|KC_CURSOR_UP
condition|)
name|mouse
operator|->
name|y
operator|-=
name|i
expr_stmt|;
if|if
condition|(
name|keycode
operator|==
name|KC_CURSOR_DOWN
condition|)
name|mouse
operator|->
name|y
operator|+=
name|i
expr_stmt|;
if|if
condition|(
name|keycode
operator|==
name|KC_CURSOR_RIGHT
condition|)
name|mouse
operator|->
name|x
operator|+=
name|i
expr_stmt|;
if|if
condition|(
name|keycode
operator|==
name|KC_CURSOR_LEFT
condition|)
name|mouse
operator|->
name|x
operator|-=
name|i
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|x
operator|<
literal|0
condition|)
name|mouse
operator|->
name|x
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|y
operator|<
literal|0
condition|)
name|mouse
operator|->
name|y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|x
operator|>=
name|winfo
operator|.
name|width
condition|)
name|mouse
operator|->
name|x
operator|=
name|winfo
operator|.
name|width
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|y
operator|>=
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
condition|)
name|mouse
operator|->
name|y
operator|=
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
operator|-
literal|1
expr_stmt|;
name|XWarpMouse
argument_list|(
name|wind
argument_list|,
operator|(
name|int
operator|)
name|mouse
operator|->
name|x
argument_list|,
operator|(
name|int
operator|)
name|mouse
operator|->
name|y
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|keystring
operator|=
name|XLookupMapping
argument_list|(
name|but
argument_list|,
operator|&
name|j
argument_list|)
expr_stmt|;
comment|/* ANSI cursor keys are esc. seq. */
if|if
condition|(
name|j
operator|>
literal|0
operator|&&
operator|*
name|keystring
operator|==
literal|'\033'
condition|)
block|{
name|i
operator|=
literal|1
operator|<<
name|zoomfactor
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|keystring
argument_list|,
literal|"\033[A"
argument_list|)
operator|==
literal|0
condition|)
name|mouse
operator|->
name|y
operator|-=
name|i
expr_stmt|;
comment|/* up */
if|if
condition|(
name|strcmp
argument_list|(
name|keystring
argument_list|,
literal|"\033[B"
argument_list|)
operator|==
literal|0
condition|)
name|mouse
operator|->
name|y
operator|+=
name|i
expr_stmt|;
comment|/* down */
if|if
condition|(
name|strcmp
argument_list|(
name|keystring
argument_list|,
literal|"\033[C"
argument_list|)
operator|==
literal|0
condition|)
name|mouse
operator|->
name|x
operator|+=
name|i
expr_stmt|;
comment|/* right */
if|if
condition|(
name|strcmp
argument_list|(
name|keystring
argument_list|,
literal|"\033[D"
argument_list|)
operator|==
literal|0
condition|)
name|mouse
operator|->
name|x
operator|-=
name|i
expr_stmt|;
comment|/* left */
if|if
condition|(
name|mouse
operator|->
name|x
operator|<
literal|0
condition|)
name|mouse
operator|->
name|x
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|y
operator|<
literal|0
condition|)
name|mouse
operator|->
name|y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|x
operator|>=
name|winfo
operator|.
name|width
condition|)
name|mouse
operator|->
name|x
operator|=
name|winfo
operator|.
name|width
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|mouse
operator|->
name|y
operator|>=
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
condition|)
name|XWarpMouse
argument_list|(
name|wind
argument_list|,
operator|(
name|int
operator|)
name|mouse
operator|->
name|x
argument_list|,
operator|(
name|int
operator|)
name|mouse
operator|->
name|y
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
break|break;
case|case
name|ButtonPressed
case|:
comment|/* Activate Menu ? */
if|if
condition|(
operator|(
name|but
operator|->
name|detail
operator|&
operator|(
name|ControlMask
operator||
name|MetaMask
operator||
name|ShiftMask
operator||
name|ShiftLockMask
operator|)
operator|)
operator|==
name|ControlMask
condition|)
block|{
name|XQueryWindow
argument_list|(
name|wind
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
name|XMenuSetFreeze
argument_list|(
name|showmenu
argument_list|)
expr_stmt|;
name|pane
operator|=
name|lastpane
expr_stmt|;
name|sel
operator|=
name|lastsel
expr_stmt|;
if|if
condition|(
name|XMenuActivate
argument_list|(
name|showmenu
argument_list|,
operator|&
name|pane
argument_list|,
operator|&
name|sel
argument_list|,
name|but
operator|->
name|x
operator|+
name|winfo
operator|.
name|x
argument_list|,
name|but
operator|->
name|y
operator|+
name|winfo
operator|.
name|y
argument_list|,
name|ButtonReleased
argument_list|,
operator|&
name|currentflags
argument_list|)
operator|==
name|XM_SUCCESS
condition|)
block|{
comment|/* check out the selection */
name|lastpane
operator|=
name|pane
expr_stmt|;
name|lastsel
operator|=
name|sel
expr_stmt|;
switch|switch
condition|(
operator|*
name|currentflags
operator|&
name|PANEMASK
condition|)
block|{
comment|/* EXIT */
case|case
literal|0
case|:
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* normal exit */
comment|/* Set `viewing mode' - manipulation of color map */
case|case
name|VOP
case|:
name|imageinfo
operator|.
name|VOP_Flags
operator|&=
operator|~
operator|(
name|currentflags
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|imageinfo
operator|.
name|VOP_Flags
operator||=
operator|(
operator|*
name|currentflags
operator|&
name|SELMASK
operator|)
expr_stmt|;
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|imcursor
argument_list|)
expr_stmt|;
name|imageinfo
operator|.
name|COP_Flags
operator|=
literal|0
expr_stmt|;
break|break;
comment|/* Set cursor mode - other uses than above */
case|case
name|COP
case|:
comment|/* if in test mode, disable all but viewing */
if|if
condition|(
name|imageinfo
operator|.
name|calibration
condition|)
break|break;
name|imageinfo
operator|.
name|COP_Flags
operator|&=
operator|~
operator|(
name|currentflags
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|imageinfo
operator|.
name|COP_Flags
operator||=
operator|(
operator|*
name|currentflags
operator|&
name|SELMASK
operator|)
expr_stmt|;
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Print
condition|)
block|{
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|printcursor
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Pan
condition|)
block|{
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|pancursor
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Zoom2
condition|)
block|{
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|zoom2cursor
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Zoom4
condition|)
block|{
name|XUndefineCursor
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|wind
argument_list|,
name|zoom4cursor
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* set picture scaling mode */
case|case
name|SOP
case|:
comment|/* if in test mode, disable all but viewing */
if|if
condition|(
name|imageinfo
operator|.
name|calibration
condition|)
break|break;
comment|/* first, see if any different */
if|if
condition|(
operator|(
name|imageinfo
operator|.
name|SOP_Flags
operator|&
operator|(
operator|*
name|currentflags
operator|&
name|SELMASK
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|imageinfo
operator|.
name|SOP_Flags
operator|&=
operator|~
operator|(
name|currentflags
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|imageinfo
operator|.
name|SOP_Flags
operator||=
operator|(
operator|*
name|currentflags
operator|&
name|SELMASK
operator|)
expr_stmt|;
name|scalepict
argument_list|(
name|imageinfo
operator|.
name|image
argument_list|,
name|imageinfo
operator|.
name|picture
argument_list|,
name|imageinfo
operator|.
name|pmax
argument_list|,
name|imageinfo
operator|.
name|pmin
argument_list|,
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
argument_list|,
name|colorinfo
operator|.
name|shift
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|SOP_Flags
argument_list|)
expr_stmt|;
name|writepix
argument_list|(
name|wind
argument_list|,
name|imageinfo
operator|.
name|image
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|zoomfactor
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|winfo
operator|.
name|width
argument_list|,
name|winfo
operator|.
name|height
argument_list|,
name|xzero
argument_list|,
name|yzero
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|FOP
case|:
comment|/* if in test mode, disable all but viewing */
if|if
condition|(
name|imageinfo
operator|.
name|calibration
condition|)
break|break;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Unknown menu pane %d\n"
argument_list|,
operator|*
name|currentflags
operator|>>
literal|16
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
block|}
elseif|else
if|if
condition|(
operator|(
name|but
operator|->
name|detail
operator|&
operator|(
name|ControlMask
operator||
name|MetaMask
operator||
name|ShiftMask
operator||
name|ShiftLockMask
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
comment|/* check if viewing or cursor operation selected */
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
condition|)
break|break;
name|downbutton
operator|=
name|but
operator|->
name|detail
operator|&
operator|(
name|RightButton
operator||
name|MiddleButton
operator||
name|LeftButton
operator|)
expr_stmt|;
name|CalcMap
argument_list|(
operator|&
name|winfo
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|,
operator|(
name|int
operator|)
name|but
operator|->
name|x
argument_list|,
operator|(
name|int
operator|)
name|but
operator|->
name|y
argument_list|,
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|imageinfo
operator|.
name|VOP_Flags
argument_list|,
name|downbutton
argument_list|)
expr_stmt|;
name|XStoreColors
argument_list|(
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|ButtonReleased
case|:
comment|/* check if viewing or cursor operation selected */
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
condition|)
block|{
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Print
condition|)
block|{
comment|/* print 11x11 picture region */
name|prpict
argument_list|(
name|imageinfo
operator|.
name|picture
argument_list|,
name|but
operator|->
name|x
operator|>>
name|zoomfactor
argument_list|,
name|but
operator|->
name|y
operator|>>
name|zoomfactor
argument_list|,
name|xzero
argument_list|,
name|yzero
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
literal|11
argument_list|,
literal|11
argument_list|)
expr_stmt|;
block|}
comment|/* recenter (pan) on cursor position */
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
operator|(
name|COP_Pan
operator||
name|COP_Zoom2
operator||
name|COP_Zoom4
operator|)
condition|)
block|{
name|xcenter
operator|=
name|xzero
operator|+
operator|(
name|but
operator|->
name|x
operator|>>
name|zoomfactor
operator|)
expr_stmt|;
name|ycenter
operator|=
name|yzero
operator|+
operator|(
name|but
operator|->
name|y
operator|>>
name|zoomfactor
operator|)
expr_stmt|;
comment|/* alter zoomfactor to reflect new zoom */
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Pan
condition|)
name|zoomfactor
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Zoom2
condition|)
name|zoomfactor
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|imageinfo
operator|.
name|COP_Flags
operator|&
name|COP_Zoom4
condition|)
name|zoomfactor
operator|=
literal|2
expr_stmt|;
name|xtempzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|imageinfo
operator|.
name|ncols
operator|-
operator|(
name|winfo
operator|.
name|width
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|xcenter
operator|-
operator|(
name|winfo
operator|.
name|width
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|ytempzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|-
operator|(
name|winfo
operator|.
name|height
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|ycenter
operator|-
operator|(
name|winfo
operator|.
name|height
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|ytempzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|-
operator|(
operator|(
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
operator|)
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|ycenter
operator|-
operator|(
operator|(
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
operator|)
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|xzero
operator|!=
name|xtempzero
operator|||
name|yzero
operator|!=
name|ytempzero
operator|||
name|oldzoomfactor
operator|!=
name|zoomfactor
condition|)
block|{
name|xzero
operator|=
name|xtempzero
expr_stmt|;
name|yzero
operator|=
name|ytempzero
expr_stmt|;
name|writepix
argument_list|(
name|wind
argument_list|,
name|imageinfo
operator|.
name|image
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|zoomfactor
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|winfo
operator|.
name|width
argument_list|,
name|winfo
operator|.
name|height
argument_list|,
name|xzero
argument_list|,
name|yzero
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|XWarpMouse
argument_list|(
name|wind
argument_list|,
operator|(
name|xcenter
operator|-
name|xzero
operator|)
operator|<<
name|zoomfactor
argument_list|,
operator|(
name|ycenter
operator|-
name|yzero
operator|)
operator|<<
name|zoomfactor
argument_list|)
expr_stmt|;
block|}
comment|/* COP_OldFlags = imageinfo.COP_Flags;  */
name|oldzoomfactor
operator|=
name|zoomfactor
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|downbutton
operator|<
literal|0
condition|)
break|break;
name|CalcMap
argument_list|(
operator|&
name|winfo
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|,
operator|(
name|int
operator|)
name|but
operator|->
name|x
argument_list|,
operator|(
name|int
operator|)
name|but
operator|->
name|y
argument_list|,
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|imageinfo
operator|.
name|VOP_Flags
argument_list|,
name|downbutton
argument_list|)
expr_stmt|;
name|XStoreColors
argument_list|(
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|)
expr_stmt|;
name|downbutton
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
name|MouseMoved
case|:
name|XUpdateMouse
argument_list|(
name|wind
argument_list|,
operator|&
name|xbut
argument_list|,
operator|&
name|ybut
argument_list|,
operator|&
name|subwind
argument_list|)
expr_stmt|;
name|XQueryMouseButtons
argument_list|(
name|wind
argument_list|,
operator|&
name|xbut
argument_list|,
operator|&
name|ybut
argument_list|,
operator|&
name|subwind
argument_list|,
operator|&
name|mouse
operator|->
name|detail
argument_list|)
expr_stmt|;
if|if
condition|(
name|subwind
operator|==
literal|0
operator|&&
name|downbutton
operator|>=
literal|0
condition|)
block|{
name|CalcMap
argument_list|(
operator|&
name|winfo
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|,
name|xbut
argument_list|,
name|ybut
argument_list|,
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|imageinfo
operator|.
name|VOP_Flags
argument_list|,
name|downbutton
argument_list|)
expr_stmt|;
name|XStoreColors
argument_list|(
name|colorinfo
operator|.
name|ncolors
argument_list|,
name|colorinfo
operator|.
name|cmap
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|updatezoom
argument_list|(
name|wzoom
argument_list|,
name|xzoomsize
argument_list|,
name|yzoomsize
argument_list|,
operator|(
name|xzero
operator|+
operator|(
name|but
operator|->
name|x
operator|>>
name|zoomfactor
operator|)
operator|)
argument_list|,
operator|(
name|yzero
operator|+
operator|(
name|but
operator|->
name|y
operator|>>
name|zoomfactor
operator|)
operator|)
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|image
argument_list|,
operator|(
literal|1
operator|<<
name|zoomfactor
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* On ExposeWindow events, recalculate the image center and 	     * coordinates of upper left hand corner of window. 	     */
case|case
name|ExposeCopy
case|:
case|case
name|ExposeWindow
case|:
if|if
condition|(
name|QLength
argument_list|()
operator|>
literal|0
condition|)
block|{
name|XPeekEvent
argument_list|(
operator|&
name|peekevent
argument_list|)
expr_stmt|;
if|if
condition|(
name|peekevent
operator|.
name|type
operator|==
name|ExposeWindow
operator|&&
name|peekevent
operator|.
name|window
operator|==
name|expw
operator|->
name|window
condition|)
break|break;
block|}
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|iconwindow
condition|)
block|{
name|XBitmapBitsPut
argument_list|(
name|iconwindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
name|show_bits
argument_list|,
name|WhitePixel
argument_list|,
name|BlackPixel
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
break|break;
block|}
ifdef|#
directive|ifdef
name|PALWIND
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|iconpalwind
condition|)
block|{
name|XBitmapBitsPut
argument_list|(
name|iconpalwind
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
name|show_bits
argument_list|,
name|WhitePixel
argument_list|,
name|BlackPixel
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|iconwzoom
condition|)
block|{
name|XBitmapBitsPut
argument_list|(
name|iconwzoom
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|show_width
argument_list|,
name|show_height
argument_list|,
name|show_bits
argument_list|,
name|WhitePixel
argument_list|,
name|BlackPixel
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|w_mapped
operator|==
literal|0
condition|)
block|{
comment|/* check if to remap windows */
ifdef|#
directive|ifdef
name|PALWIND
if|if
condition|(
name|expw
operator|->
name|window
operator|!=
name|palwind
condition|)
name|XMapWindow
argument_list|(
name|palwind
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|expw
operator|->
name|window
operator|!=
name|wind
condition|)
name|XMapWindow
argument_list|(
name|wind
argument_list|)
expr_stmt|;
if|if
condition|(
name|expw
operator|->
name|window
operator|!=
name|wzoom
condition|)
name|XMapWindow
argument_list|(
name|wzoom
argument_list|)
expr_stmt|;
name|w_mapped
operator|++
expr_stmt|;
block|}
name|XQueryWindow
argument_list|(
name|wind
argument_list|,
operator|&
name|winfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|wind
condition|)
block|{
name|XQueryWindow
argument_list|(
name|palwind
argument_list|,
operator|&
name|palwinfo
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|XConfigureWindow
argument_list|(
name|palwind
argument_list|,
name|winfo
operator|.
name|x
argument_list|,
name|winfo
operator|.
name|y
operator|+
name|winfo
operator|.
name|height
operator|+
name|maininfo
operator|.
name|frame
operator|.
name|bdrwidth
argument_list|,
name|winfo
operator|.
name|width
argument_list|,
name|PALHEIGHT
argument_list|)
expr_stmt|;
else|#
directive|else
name|XConfigureWindow
argument_list|(
name|palwind
argument_list|,
literal|0
argument_list|,
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
argument_list|,
name|winfo
operator|.
name|width
operator|-
literal|2
operator|*
name|PALBORDER
argument_list|,
name|PALHEIGHT
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|XQueryWindow
argument_list|(
name|wzoom
argument_list|,
operator|&
name|wzoominfo
argument_list|)
expr_stmt|;
name|xzoomsize
operator|=
name|wzoominfo
operator|.
name|width
expr_stmt|;
name|yzoomsize
operator|=
name|wzoominfo
operator|.
name|height
expr_stmt|;
name|XConfigureWindow
argument_list|(
name|wzoom
argument_list|,
name|winfo
operator|.
name|x
operator|+
name|winfo
operator|.
name|width
operator|+
name|maininfo
operator|.
name|frame
operator|.
name|bdrwidth
argument_list|,
name|winfo
operator|.
name|y
argument_list|,
name|wzoominfo
operator|.
name|width
argument_list|,
name|wzoominfo
operator|.
name|height
argument_list|)
expr_stmt|;
name|xzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|imageinfo
operator|.
name|ncols
operator|-
operator|(
name|winfo
operator|.
name|width
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|xcenter
operator|-
operator|(
name|winfo
operator|.
name|width
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|PALWIND
name|yzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|nrows
operator|-
operator|(
name|winfo
operator|.
name|height
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|ycenter
operator|-
operator|(
name|winfo
operator|.
name|height
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|yzero
operator|=
name|MAX
argument_list|(
literal|0
argument_list|,
name|MIN
argument_list|(
name|imageinfo
operator|.
name|nrows
operator|-
operator|(
operator|(
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
operator|)
operator|>>
name|zoomfactor
operator|)
argument_list|,
name|ycenter
operator|-
operator|(
operator|(
name|winfo
operator|.
name|height
operator|-
name|PALHEIGHT
operator|-
literal|2
operator|*
name|PALBORDER
operator|)
operator|>>
operator|(
name|zoomfactor
operator|+
literal|1
operator|)
operator|)
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
if|if
condition|(
name|event
operator|.
name|type
operator|==
name|ExposeCopy
condition|)
break|break;
comment|/* drop through to ExposeRegion to draw the window, and 	     * redraw the supporting windows */
case|case
name|ExposeRegion
case|:
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|palwind
condition|)
block|{
name|XQueryWindow
argument_list|(
name|palwind
argument_list|,
operator|&
name|palwinfo
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|palwinfo
operator|.
name|width
condition|;
name|i
operator|++
control|)
name|palette
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|colorinfo
operator|.
name|ncolors
operator|*
name|i
operator|)
operator|/
name|palwinfo
operator|.
name|width
operator|)
operator|+
name|colorinfo
operator|.
name|pixels
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|palwinfo
operator|.
name|height
condition|;
name|i
operator|++
control|)
name|XPixmapBitsPutZ
argument_list|(
name|palwind
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|palwinfo
operator|.
name|width
argument_list|,
literal|1
argument_list|,
name|palette
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|expw
operator|->
name|window
operator|==
name|wzoom
condition|)
block|{
name|XQueryWindow
argument_list|(
name|wzoom
argument_list|,
operator|&
name|wzoominfo
argument_list|)
expr_stmt|;
name|xzoomsize
operator|=
name|wzoominfo
operator|.
name|width
expr_stmt|;
name|yzoomsize
operator|=
name|wzoominfo
operator|.
name|height
expr_stmt|;
name|updatezoom
argument_list|(
name|wzoom
argument_list|,
name|xzoomsize
argument_list|,
name|yzoomsize
argument_list|,
name|xcenter
argument_list|,
name|ycenter
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|imageinfo
operator|.
name|image
argument_list|,
operator|(
literal|1
operator|<<
name|zoomfactor
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|expw
operator|->
name|x
operator|>
name|imageinfo
operator|.
name|ncols
operator|<<
name|zoomfactor
operator|||
name|expw
operator|->
name|y
operator|>
name|imageinfo
operator|.
name|nrows
operator|<<
name|zoomfactor
condition|)
break|break;
name|writepix
argument_list|(
name|wind
argument_list|,
name|imageinfo
operator|.
name|image
argument_list|,
name|imageinfo
operator|.
name|ncols
argument_list|,
name|imageinfo
operator|.
name|nrows
argument_list|,
name|zoomfactor
argument_list|,
name|expw
operator|->
name|x
argument_list|,
name|expw
operator|->
name|y
argument_list|,
name|expw
operator|->
name|width
argument_list|,
name|expw
operator|->
name|height
argument_list|,
name|xzero
argument_list|,
name|yzero
argument_list|,
literal|0
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* If any window is unmapped, all three are unmapped */
case|case
name|UnmapWindow
case|:
ifdef|#
directive|ifdef
name|PALWIND
if|if
condition|(
name|event
operator|.
name|window
operator|!=
name|palwind
condition|)
name|XUnmapWindow
argument_list|(
name|palwind
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|event
operator|.
name|window
operator|!=
name|wzoom
condition|)
name|XUnmapWindow
argument_list|(
name|wzoom
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|.
name|window
operator|!=
name|wind
condition|)
name|XUnmapWindow
argument_list|(
name|wind
argument_list|)
expr_stmt|;
name|w_mapped
operator|=
literal|0
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|GLOPEROO
end_ifdef

begin_macro
name|describe_XEvent
argument_list|(
argument|etype
argument_list|,
argument|ewindow
argument_list|,
argument|detail
argument_list|,
argument|wind
argument_list|,
argument|palwind
argument_list|,
argument|wzoom
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|long
name|etype
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|short
name|detail
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|ewindow
decl_stmt|,
name|wind
decl_stmt|,
name|palwind
decl_stmt|,
name|wzoom
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Window "
argument_list|)
expr_stmt|;
if|if
condition|(
name|ewindow
operator|==
name|wind
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"wind, "
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ewindow
operator|==
name|palwind
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"palwind, "
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ewindow
operator|==
name|wzoom
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"wzoom, "
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
literal|"ERROR %d\n"
argument_list|,
name|ewindow
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
operator|(
name|int
operator|)
name|etype
condition|)
block|{
case|case
name|KeyPressed
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"KeyPressed"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|KeyReleased
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"KeyReleased"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|ButtonPressed
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ButtonPressed"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|ButtonReleased
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ButtonReleased"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|EnterWindow
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"EnterWindow"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|LeaveWindow
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"LeaveWindow"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|MouseMoved
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"MouseMoved"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" detail = %x"
argument_list|,
name|detail
argument_list|)
expr_stmt|;
break|break;
case|case
name|ExposeWindow
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ExposeWindow"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ExposeRegion
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ExposeRegion"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ExposeCopy
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ExposeCopy"
argument_list|)
expr_stmt|;
break|break;
case|case
name|UnmapWindow
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"UnmapWindow"
argument_list|)
expr_stmt|;
break|break;
case|case
name|FocusChange
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"FocusChange"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ERROR %d"
argument_list|,
name|etype
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

