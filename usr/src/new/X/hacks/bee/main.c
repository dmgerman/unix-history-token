begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"%G% hack (aps) %W%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"def.h"
end_include

begin_include
include|#
directive|include
file|"flying_bee.h"
end_include

begin_comment
comment|/*  *  hack  --  playing with windows.  *	This program puts up two windows, each with different  *	cursors.  *	This program was actually the beginnings of a window based  *	talk program.  *		aps.  */
end_comment

begin_define
define|#
directive|define
name|INCREMENT
value|1
end_define

begin_define
define|#
directive|define
name|DECREMENT
value|0
end_define

begin_define
define|#
directive|define
name|DEBUG
value|0
end_define

begin_decl_stmt
name|int
name|debug
init|=
name|DEBUG
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 10 or greater is painfully detailed */
end_comment

begin_decl_stmt
name|int
name|verbose
init|=
name|NO
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* print some stuff */
end_comment

begin_decl_stmt
name|int
name|myuid
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* my uid */
end_comment

begin_decl_stmt
name|char
name|me
index|[
name|UTMPNAMSIZ
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* my login name */
end_comment

begin_decl_stmt
name|char
name|mytty
index|[
name|NAMLEN
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* my dev node name */
end_comment

begin_comment
comment|/*  * X and window stuff.  */
end_comment

begin_define
define|#
directive|define
name|XLOC1
value|40
end_define

begin_comment
comment|/* x cordinate for window 1 */
end_comment

begin_define
define|#
directive|define
name|YLOC1
value|10
end_define

begin_comment
comment|/* y cordinate for window 1 */
end_comment

begin_define
define|#
directive|define
name|XLOC2
value|500
end_define

begin_comment
comment|/* x cordinate for window 2 */
end_comment

begin_define
define|#
directive|define
name|YLOC2
value|10
end_define

begin_comment
comment|/* y cordinate for window 2 */
end_comment

begin_define
define|#
directive|define
name|WIDTH
value|300
end_define

begin_comment
comment|/* width of window */
end_comment

begin_define
define|#
directive|define
name|HEIGHT
value|400
end_define

begin_comment
comment|/* height of window */
end_comment

begin_define
define|#
directive|define
name|BDRWDTH
value|6
end_define

begin_comment
comment|/* window border width */
end_comment

begin_define
define|#
directive|define
name|BORDER
value|WhitePixmap
end_define

begin_comment
comment|/* border pixmap */
end_comment

begin_define
define|#
directive|define
name|BCKGRND
value|BlackPixmap
end_define

begin_comment
comment|/* background pixmap */
end_comment

begin_decl_stmt
name|int
name|xloc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|yloc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Display
modifier|*
name|mydisp
decl_stmt|,
modifier|*
name|herdisp
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* descriptors for the displays */
end_comment

begin_decl_stmt
name|char
name|mydispname
index|[
name|NAMLEN
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* descriptors for the displays */
end_comment

begin_decl_stmt
name|char
name|herdispname
index|[
name|NAMLEN
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* descriptors for the displays */
end_comment

begin_decl_stmt
name|Window
name|mywin
decl_stmt|,
name|herwin
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* descriptors for the windows */
end_comment

begin_decl_stmt
name|Window
name|mywinparent
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* parent window */
end_comment

begin_decl_stmt
name|Window
name|herwinparent
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* parent window */
end_comment

begin_comment
comment|/*  * cursor bitmaps for window 1  */
end_comment

begin_define
define|#
directive|define
name|aps_width
value|24
end_define

begin_define
define|#
directive|define
name|aps_height
value|24
end_define

begin_decl_stmt
specifier|static
name|short
name|aps_bits
index|[]
init|=
block|{
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffe7
block|,
literal|0xffff
block|,
literal|0xffdb
block|,
literal|0xffff
block|,
literal|0xffbd
block|,
literal|0xff87
block|,
literal|0xffbd
block|,
literal|0xff33
block|,
literal|0xffbd
block|,
literal|0xff79
block|,
literal|0xffdb
block|,
literal|0xff7c
block|,
literal|0xffe7
block|,
literal|0x8f7e
block|,
literal|0xfff7
block|,
literal|0xb33e
block|,
literal|0xff31
block|,
literal|0xb93c
block|,
literal|0xffce
block|,
literal|0xb91d
block|,
literal|0xffd2
block|,
literal|0xbc49
block|,
literal|0xffdc
block|,
literal|0x3ce3
block|,
literal|0xffdd
block|,
literal|0x98ff
block|,
literal|0xffe3
block|,
literal|0xe6ff
block|,
literal|0xffff
block|,
literal|0xfe7f
block|,
literal|0xffff
block|,
literal|0xff7f
block|,
literal|0xffff
block|,
literal|0xff3f
block|,
literal|0xffff
block|,
literal|0xffbf
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Inverse bitmap */
end_comment

begin_define
define|#
directive|define
name|Iaps_width
value|24
end_define

begin_define
define|#
directive|define
name|Iaps_height
value|24
end_define

begin_decl_stmt
specifier|static
name|short
name|Iaps_bits
index|[]
init|=
block|{
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0018
block|,
literal|0x0000
block|,
literal|0x0024
block|,
literal|0x0000
block|,
literal|0x0042
block|,
literal|0x0078
block|,
literal|0x0042
block|,
literal|0x00cc
block|,
literal|0x0042
block|,
literal|0x0086
block|,
literal|0x0024
block|,
literal|0x0083
block|,
literal|0x0018
block|,
literal|0x7081
block|,
literal|0x0008
block|,
literal|0x4cc1
block|,
literal|0x00ce
block|,
literal|0x46c3
block|,
literal|0x0031
block|,
literal|0x46e2
block|,
literal|0x002d
block|,
literal|0x43b6
block|,
literal|0x0023
block|,
literal|0xc31c
block|,
literal|0x0022
block|,
literal|0x6700
block|,
literal|0x001c
block|,
literal|0x1900
block|,
literal|0x0000
block|,
literal|0x0180
block|,
literal|0x0000
block|,
literal|0x0080
block|,
literal|0x0000
block|,
literal|0x00c0
block|,
literal|0x0000
block|,
literal|0x0040
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|,
literal|0x0000
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * array to store bees in flight  */
end_comment

begin_define
define|#
directive|define
name|CUR_COUNT
value|4
end_define

begin_comment
comment|/* number of bee frames */
end_comment

begin_decl_stmt
name|Cursor
name|Bee
index|[
name|CUR_COUNT
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* cursor table */
end_comment

begin_comment
comment|/*  * main() -- What can one say about main...  *   it is where it's at!  *  *  xhack  */
end_comment

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|Cursor
name|curcur
decl_stmt|,
name|hackcur
decl_stmt|;
name|XEvent
name|herxevent
decl_stmt|,
name|myxevent
decl_stmt|;
name|struct
name|_XMouseOrCrossingEvent
modifier|*
name|mmevp
decl_stmt|;
name|char
modifier|*
name|rindex
argument_list|()
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|int
name|curp
decl_stmt|;
name|int
name|inc_or_dec
decl_stmt|;
comment|/* 	 * get what few options we allow.  (currently none) 	 */
while|while
condition|(
operator|--
name|argc
operator|>
literal|0
operator|&&
operator|(
operator|++
name|argv
operator|)
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
name|char
modifier|*
name|cp
init|=
name|argv
index|[
literal|0
index|]
operator|+
literal|1
decl_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|10
condition|)
name|printf
argument_list|(
literal|"argv=%s\n"
argument_list|,
operator|*
name|argv
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
switch|switch
condition|(
operator|*
name|cp
operator|++
condition|)
block|{
case|case
literal|'v'
case|:
comment|/* verbose flag */
comment|/* nothing yet */
name|verbose
operator|=
name|YES
expr_stmt|;
continue|continue;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Unknown flag %s\n"
argument_list|,
operator|*
name|argv
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"hack [-v] \n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
comment|/***** 	 * Create the windows. 	 *****/
comment|/* 	 * Open the display. 	 */
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"About to XOpenDisplay(NULL) my display.\n"
argument_list|)
expr_stmt|;
name|mydisp
operator|=
name|XOpenDisplay
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"XopenDisplay(NULL) returned %x.\n"
argument_list|,
name|mydisp
argument_list|)
expr_stmt|;
if|if
condition|(
name|mydisp
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"xhack: can't open my display.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* creat my window*/
name|xloc
operator|=
name|XLOC1
expr_stmt|;
name|yloc
operator|=
name|YLOC1
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"About to XCreateWindow().\n"
argument_list|)
expr_stmt|;
name|mywin
operator|=
name|XCreateWindow
argument_list|(
name|mydisp
operator|->
name|root
argument_list|,
name|xloc
argument_list|,
name|yloc
argument_list|,
name|WIDTH
argument_list|,
name|HEIGHT
argument_list|,
name|BDRWDTH
argument_list|,
name|BORDER
argument_list|,
name|BCKGRND
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"XCreatWindow() returned %x.\n"
argument_list|,
operator|(
name|int
operator|)
name|mywin
argument_list|)
expr_stmt|;
if|if
condition|(
name|mywin
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"hack: can't creat window.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|XStoreName
argument_list|(
name|mywin
argument_list|,
literal|"xhack_window-1"
argument_list|)
expr_stmt|;
comment|/* icon name */
comment|/* creat (describe) a cursor */
name|curcur
operator|=
name|XCreateCursor
argument_list|(
name|aps_width
argument_list|,
name|aps_height
argument_list|,
name|aps_bits
argument_list|,
name|Iaps_bits
argument_list|,
literal|9
argument_list|,
literal|10
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXxor
argument_list|)
expr_stmt|;
if|if
condition|(
name|curcur
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"xhack: can't creat cursor.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* define (set) the cursor */
name|XDefineCursor
argument_list|(
name|mywin
argument_list|,
name|curcur
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"About to XMapWindow().\n"
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|mywin
argument_list|)
expr_stmt|;
comment|/* 	 * Normally, a window is really made on the screen automatically 	 * the next time input is read.  Since we don't do any input, 	 * we have to do an explicit flush. 	 */
name|XFlush
argument_list|()
expr_stmt|;
comment|/* creat the second window */
name|xloc
operator|=
name|XLOC2
expr_stmt|;
name|yloc
operator|=
name|YLOC2
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"About to XCreateWindow().\n"
argument_list|)
expr_stmt|;
name|herwin
operator|=
name|XCreateWindow
argument_list|(
name|mydisp
operator|->
name|root
argument_list|,
name|xloc
argument_list|,
name|yloc
argument_list|,
name|WIDTH
argument_list|,
name|HEIGHT
argument_list|,
name|BDRWDTH
argument_list|,
name|BORDER
argument_list|,
name|BCKGRND
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"XCreatWindow() returned %x.\n"
argument_list|,
operator|(
name|int
operator|)
name|herwin
argument_list|)
expr_stmt|;
if|if
condition|(
name|herwin
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"hack: can't creat window.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|XStoreName
argument_list|(
name|herwin
argument_list|,
literal|"bee_window-2"
argument_list|)
expr_stmt|;
comment|/* icon name */
comment|/* creat (describe) some cursors */
name|Bee
index|[
literal|0
index|]
operator|=
name|XCreateCursor
argument_list|(
name|bee_wing1_width
argument_list|,
name|bee_wing1_height
argument_list|,
name|bee_wing1_bits
argument_list|,
name|Ibee_wing1_bits
argument_list|,
literal|46
argument_list|,
literal|16
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXxor
argument_list|)
expr_stmt|;
name|Bee
index|[
literal|1
index|]
operator|=
name|XCreateCursor
argument_list|(
name|bee_wing2_width
argument_list|,
name|bee_wing2_height
argument_list|,
name|bee_wing2_bits
argument_list|,
name|Ibee_wing2_bits
argument_list|,
literal|46
argument_list|,
literal|16
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXxor
argument_list|)
expr_stmt|;
name|Bee
index|[
literal|2
index|]
operator|=
name|XCreateCursor
argument_list|(
name|bee_wing3_width
argument_list|,
name|bee_wing3_height
argument_list|,
name|bee_wing3_bits
argument_list|,
name|Ibee_wing3_bits
argument_list|,
literal|46
argument_list|,
literal|16
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXxor
argument_list|)
expr_stmt|;
name|Bee
index|[
literal|3
index|]
operator|=
name|XCreateCursor
argument_list|(
name|bee_wing4_width
argument_list|,
name|bee_wing4_height
argument_list|,
name|bee_wing4_bits
argument_list|,
name|Ibee_wing4_bits
argument_list|,
literal|46
argument_list|,
literal|16
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXxor
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|Bee
index|[
literal|0
index|]
operator|==
literal|0
operator|)
operator|||
operator|(
name|Bee
index|[
literal|1
index|]
operator|==
literal|0
operator|)
operator|||
operator|(
name|Bee
index|[
literal|2
index|]
operator|==
literal|0
operator|)
operator|||
operator|(
name|Bee
index|[
literal|3
index|]
operator|==
literal|0
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"hack: can't creat bee cursors.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* define (set) the initial cursor */
name|XDefineCursor
argument_list|(
name|herwin
argument_list|,
name|Bee
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|/* initial cursor define */
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"About to XMapWindow().\n"
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|herwin
argument_list|)
expr_stmt|;
name|XFlush
argument_list|()
expr_stmt|;
comment|/* necessary because we don't get input */
name|inc_or_dec
operator|=
name|INCREMENT
expr_stmt|;
comment|/* set direction to traverse cursor table */
name|curp
operator|=
literal|0
expr_stmt|;
name|XSelectInput
argument_list|(
name|herwin
argument_list|,
name|MouseMoved
operator||
name|LeaveWindow
operator||
name|EnterWindow
argument_list|)
expr_stmt|;
for|for
control|(
name|EVER
control|)
block|{
name|XNextEvent
argument_list|(
operator|&
name|herxevent
argument_list|)
expr_stmt|;
operator|(
name|XEvent
operator|*
operator|)
name|mmevp
operator|=
operator|&
name|herxevent
expr_stmt|;
switch|switch
condition|(
name|mmevp
operator|->
name|type
condition|)
block|{
case|case
name|EnterWindow
case|:
if|if
condition|(
name|debug
operator|>=
literal|10
condition|)
name|printf
argument_list|(
literal|"Mouse entered.\n"
argument_list|)
expr_stmt|;
continue|continue;
case|case
name|LeaveWindow
case|:
if|if
condition|(
name|debug
operator|>=
literal|10
condition|)
name|printf
argument_list|(
literal|"Mouse left.\n"
argument_list|)
expr_stmt|;
continue|continue;
case|case
name|MouseMoved
case|:
if|if
condition|(
name|debug
operator|>=
literal|15
condition|)
name|printf
argument_list|(
literal|"rel %d, %d.\n"
argument_list|,
name|mmevp
operator|->
name|x
argument_list|,
name|mmevp
operator|->
name|y
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|herwin
argument_list|,
name|Bee
index|[
name|curp
index|]
argument_list|)
expr_stmt|;
comment|/* 				 * This little code allows smoother flight 				 * of the wings by moving forward then 				 * backwards through the different bitmaps 				 * in the table instead of recycling to 0. 				 * There are probably more straight forward 				 * ways to do this. 				 */
if|if
condition|(
name|inc_or_dec
operator|==
name|INCREMENT
condition|)
name|curp
operator|++
expr_stmt|;
else|else
name|curp
operator|--
expr_stmt|;
if|if
condition|(
operator|(
name|curp
operator|>=
name|CUR_COUNT
operator|)
operator|||
operator|(
name|curp
operator|<=
literal|0
operator|)
condition|)
comment|/* switch directions */
if|if
condition|(
name|inc_or_dec
operator|==
name|INCREMENT
condition|)
block|{
name|inc_or_dec
operator|=
name|DECREMENT
expr_stmt|;
name|curp
operator|--
expr_stmt|;
block|}
else|else
block|{
name|inc_or_dec
operator|=
name|INCREMENT
expr_stmt|;
name|curp
operator|++
expr_stmt|;
block|}
continue|continue;
default|default:
name|printf
argument_list|(
literal|"unknown event.\n"
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
comment|/* NOTREACHED */
block|}
end_function

end_unit

