begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_put_c
init|=
literal|"$Header: put.c,v 10.1 86/11/29 13:52:41 jg Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*      Copyright 1986 by the University of Utah      Permission to use, copy, modify, and distribute this     software and its documentation for any purpose and without     fee is hereby granted, provided that the above copyright     notice appear in all copies and that both that copyright     notice and this permission notice appear in supporting     documentation, and that the name of the University of Utah     not be used in advertising or publicity pertaining to      distribution of the software without specific, written      prior permission. The University of Utah makes no     representations about the suitability of this software for     any purpose.  It is provided "as is" without express or     implied warranty.      */
end_comment

begin_comment
comment|/* put.c	Perform a raster operation with a source bitmap  *  *	PixmapPut	Puts a pixmap up on the screen  *	PixmapBitsPut	Puts a pixmap up on the screen  *	BitmapBitsPut	Puts a pixmap up on the screen  *  */
end_comment

begin_comment
comment|/*  *	ToDo:  *		masks& XY format Pixmaps  */
end_comment

begin_include
include|#
directive|include
file|"Xapollo.h"
end_include

begin_define
define|#
directive|define
name|GPIXARY_SIZE
value|2048
end_define

begin_decl_stmt
name|status_$t
name|status
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|long
name|gpixary
index|[
name|GPIXARY_SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|Xalloc
parameter_list|()
function_decl|;
end_function_decl

begin_expr_stmt
name|PixmapPut
argument_list|(
name|src
argument_list|,
name|srcx
argument_list|,
name|srcy
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|clips
argument_list|,
name|clipcount
argument_list|,
name|op
argument_list|,
name|zmask
argument_list|)
specifier|register
name|PIXMAP
operator|*
name|src
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|srcx
decl_stmt|,
name|srcy
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|op
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|gpr_$position_t
name|dest
decl_stmt|;
name|gpr_$window_t
name|sou
decl_stmt|,
name|cwindow
decl_stmt|;
name|int
name|cleft
decl_stmt|,
name|ctop
decl_stmt|,
name|cwidth
decl_stmt|,
name|cheight
decl_stmt|;
name|int
name|i
decl_stmt|;
name|set_zmask
argument_list|(
name|zmask
argument_list|)
expr_stmt|;
name|set_op
argument_list|(
name|op
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PTYPE
argument_list|(
name|src
argument_list|)
condition|)
block|{
case|case
name|BitmapPixmap
case|:
block|{
name|BITMAP
modifier|*
name|bm
init|=
operator|(
name|BITMAP
operator|*
operator|)
name|src
operator|->
name|data
decl_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
if|if
condition|(
name|OverLap
argument_list|(
name|cwindow
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
condition|)
block|{
name|CheckCursor
argument_list|(
name|dstx
argument_list|,
name|dsty
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|sou
operator|.
name|x_coord
operator|=
name|srcx
expr_stmt|;
name|sou
operator|.
name|y_coord
operator|=
name|srcy
expr_stmt|;
name|sou
operator|.
name|x_size
operator|=
name|width
expr_stmt|;
name|sou
operator|.
name|y_size
operator|=
name|height
expr_stmt|;
name|dest
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
name|dest
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|gpr_$pixel_blt
argument_list|(
operator|(
name|gpr_$bitmap_desc_t
operator|)
name|bm
operator|->
name|data
argument_list|,
name|sou
argument_list|,
name|dest
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
block|}
break|break;
case|case
name|ConstantPixmap
case|:
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
if|if
condition|(
name|OverLap
argument_list|(
name|cwindow
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
condition|)
block|{
name|CheckCursor
argument_list|(
name|dstx
argument_list|,
name|dsty
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Not yet implemented */
block|}
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
break|break;
case|case
name|ZColorPixmap
case|:
name|gpr_$set_plane_mask
argument_list|(
call|(
name|gpr_$mask_t
call|)
argument_list|(
name|zmask
operator|&
name|Screen
operator|.
name|plane_mask
argument_list|)
argument_list|,
name|status
argument_list|)
expr_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
comment|/* Not yet implemented */
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
break|break;
case|case
name|XYColorPixmap
case|:
comment|/* Not yet implemented */
break|break;
block|}
name|RestoreCursor
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|PixmapBitsPut
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|format
argument_list|,
argument|data
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|format
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|Screen
operator|.
name|depth
operator|==
literal|1
condition|)
name|BitsPut
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|xymask
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|clips
argument_list|,
name|clipcount
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|,
literal|1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|Screen
operator|.
name|depth
operator|<=
literal|8
condition|)
switch|switch
condition|(
name|format
condition|)
block|{
case|case
name|ZFormat
case|:
block|{
name|gpr_$window_t
name|dstwin
decl_stmt|;
name|long
modifier|*
name|pixary
decl_stmt|,
modifier|*
name|p
decl_stmt|,
modifier|*
name|mask_ary
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|size
decl_stmt|;
name|dstwin
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
name|dstwin
operator|.
name|x_size
operator|=
name|width
expr_stmt|;
name|dstwin
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|dstwin
operator|.
name|y_size
operator|=
name|height
expr_stmt|;
if|if
condition|(
operator|(
name|size
operator|=
name|width
operator|*
name|height
operator|)
operator|>
name|GPIXARY_SIZE
condition|)
name|pixary
operator|=
operator|(
name|long
operator|*
operator|)
name|malloc
argument_list|(
name|size
operator|*
literal|4
argument_list|)
expr_stmt|;
else|else
name|pixary
operator|=
name|gpixary
expr_stmt|;
if|if
condition|(
name|xymask
condition|)
block|{
name|mask_ary
operator|=
name|malloc
argument_list|(
name|size
operator|*
literal|4
argument_list|)
expr_stmt|;
name|gpr_$set_bitmap
argument_list|(
name|xymask
operator|->
name|data
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$read_pixels
argument_list|(
operator|*
name|mask_ary
argument_list|,
name|dstwin
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$set_bitmap
argument_list|(
name|Screen
operator|.
name|bm
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$read_pixels
argument_list|(
operator|*
name|pixary
argument_list|,
name|dstwin
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
name|p
operator|=
name|pixary
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|width
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|height
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|xymask
operator|&&
operator|!
operator|(
operator|*
name|mask_ary
operator|++
operator|)
condition|)
continue|continue;
operator|*
name|p
operator|++
operator|=
operator|*
name|data
operator|++
expr_stmt|;
name|gpr_$write_pixels
argument_list|(
operator|*
name|pixary
argument_list|,
name|dstwin
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|check_status
argument_list|(
name|status
argument_list|,
literal|"PixmapBitsput"
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|>
name|GPIXARY_SIZE
condition|)
name|free
argument_list|(
name|pixary
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|XYFormat
case|:
comment|/* Not yet supported */
break|break;
block|}
block|}
end_block

begin_macro
name|BitmapBitsPut
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|data
argument_list|,
argument|fore
argument_list|,
argument|back
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|data
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|fore
decl_stmt|,
name|back
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|InvertPixelOrder
argument_list|(
operator|(
name|short
operator|*
operator|)
name|data
argument_list|,
name|BitmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
operator|>>
literal|1
argument_list|)
expr_stmt|;
name|BitsPut
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|data
argument_list|,
name|fore
argument_list|,
name|back
argument_list|,
name|xymask
argument_list|,
name|dstx
argument_list|,
name|dsty
argument_list|,
name|clips
argument_list|,
name|clipcount
argument_list|,
name|func
argument_list|,
name|zmask
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|BitsPut
argument_list|(
argument|width
argument_list|,
argument|height
argument_list|,
argument|data
argument_list|,
argument|fore
argument_list|,
argument|back
argument_list|,
argument|xymask
argument_list|,
argument|dstx
argument_list|,
argument|dsty
argument_list|,
argument|clips
argument_list|,
argument|clipcount
argument_list|,
argument|func
argument_list|,
argument|zmask
argument_list|,
argument|srcdepth
argument_list|)
name|char
operator|*
name|data
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|fore
decl_stmt|,
name|back
decl_stmt|,
name|dstx
decl_stmt|,
name|dsty
decl_stmt|,
name|clipcount
decl_stmt|,
name|zmask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|BITMAP
modifier|*
name|xymask
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CLIP
modifier|*
name|clips
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|func
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|srcdepth
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|extern
name|char
name|FBMap
index|[]
decl_stmt|;
specifier|extern
name|int
name|old_op
decl_stmt|;
name|gpr_$window_t
name|srcwin
decl_stmt|,
name|cwindow
decl_stmt|;
name|gpr_$position_t
name|dstorg
decl_stmt|;
name|gpr_$plane_t
name|dplane
init|=
literal|0
decl_stmt|;
name|BITMAP
modifier|*
name|bm
decl_stmt|;
name|int
name|op
decl_stmt|;
if|if
condition|(
operator|(
name|Screen
operator|.
name|depth
operator|==
literal|1
operator|)
operator|&&
operator|!
operator|(
name|zmask
operator|&
literal|1
operator|)
condition|)
return|return;
if|if
condition|(
name|fore
operator|&
literal|1
condition|)
name|func
operator|+=
literal|0x20
expr_stmt|;
if|if
condition|(
name|back
operator|&
literal|1
condition|)
name|func
operator|+=
literal|0x10
expr_stmt|;
name|srcwin
operator|.
name|x_coord
operator|=
literal|0
expr_stmt|;
name|srcwin
operator|.
name|y_coord
operator|=
literal|0
expr_stmt|;
name|srcwin
operator|.
name|x_size
operator|=
name|width
expr_stmt|;
name|srcwin
operator|.
name|y_size
operator|=
name|height
expr_stmt|;
name|dstorg
operator|.
name|x_coord
operator|=
name|dstx
expr_stmt|;
name|dstorg
operator|.
name|y_coord
operator|=
name|dsty
expr_stmt|;
name|bm
operator|=
name|make_bitmap
argument_list|(
name|data
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|func
operator|=
name|FBMap
index|[
name|func
index|]
expr_stmt|;
name|CheckCursor
argument_list|(
name|dstx
argument_list|,
name|dsty
argument_list|,
name|dstx
operator|+
name|width
argument_list|,
name|dsty
operator|+
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|xymask
operator|==
name|NULL
condition|)
block|{
name|gpr_$set_raster_op
argument_list|(
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
operator|(
name|gpr_$raster_op_t
operator|)
name|func
argument_list|,
name|status
argument_list|)
expr_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$bit_blt
argument_list|(
name|bm
operator|->
name|data
argument_list|,
name|srcwin
argument_list|,
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
name|dstorg
argument_list|,
operator|(
name|gpr_$plane_t
operator|)
name|dplane
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|check_status
argument_list|(
name|status
argument_list|,
literal|"BitsPut: "
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|clipcount
operator|>
literal|0
condition|)
do|;
name|old_op
operator|=
name|func
expr_stmt|;
block|}
else|else
block|{
comment|/* this is slightly bogus and doesn't work correctly, but without it icons are  * invisible  */
name|int
name|botop
init|=
operator|(
name|back
operator|==
literal|0
condition|?
literal|7
else|:
literal|4
operator|)
decl_stmt|;
name|int
name|topop
init|=
operator|(
name|fore
operator|==
literal|0
condition|?
literal|7
else|:
literal|4
operator|)
decl_stmt|;
do|do
block|{
name|GetNextClip
argument_list|(
name|clips
argument_list|,
name|cwindow
argument_list|)
expr_stmt|;
name|CheckCursor
argument_list|(
name|cwindow
operator|.
name|x_coord
argument_list|,
name|cwindow
operator|.
name|y_coord
argument_list|,
name|cwindow
operator|.
name|x_size
argument_list|,
name|cwindow
operator|.
name|y_size
argument_list|)
expr_stmt|;
name|gpr_$set_clip_window
argument_list|(
name|cwindow
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$set_raster_op
argument_list|(
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
name|botop
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$bit_blt
argument_list|(
name|xymask
operator|->
name|data
argument_list|,
name|srcwin
argument_list|,
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
name|dstorg
argument_list|,
name|dplane
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$set_raster_op
argument_list|(
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
operator|(
name|short
operator|)
literal|3
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|gpr_$bit_blt
argument_list|(
name|bm
operator|->
name|data
argument_list|,
name|srcwin
argument_list|,
operator|(
name|gpr_$plane_t
operator|)
literal|0
argument_list|,
name|dstorg
argument_list|,
operator|(
name|gpr_$plane_t
operator|)
name|dplane
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|--
name|clipcount
condition|)
do|;
name|old_op
operator|=
name|topop
expr_stmt|;
block|}
name|FreeBitmap
argument_list|(
name|bm
argument_list|)
expr_stmt|;
name|RestoreCursor
argument_list|()
expr_stmt|;
return|return;
block|}
end_block

end_unit

