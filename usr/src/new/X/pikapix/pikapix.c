begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<X/mit-copyright.h>
end_include

begin_comment
comment|/* Copyright    Massachusetts Institute of Technology    1985	*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_pikapix_c
init|=
literal|"$Header: pikapix.c,v 10.5 86/02/01 16:11:15 tony Rel $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_include
include|#
directive|include
file|<X/Xlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_include
include|#
directive|include
file|"../cursors/target.cursor"
end_include

begin_include
include|#
directive|include
file|"../cursors/target_mask.cursor"
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_define
define|#
directive|define
name|pik_width
value|15
end_define

begin_define
define|#
directive|define
name|pik_height
value|15
end_define

begin_decl_stmt
specifier|static
name|short
name|pik_bits
index|[]
init|=
block|{
literal|0x8080
block|,
literal|0x8080
block|,
literal|0x81c0
block|,
literal|0x83e0
block|,
literal|0x87f0
block|,
literal|0x8ff8
block|,
literal|0x9ffc
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0xbffe
block|,
literal|0x8000
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|short
name|pik_mask_bits
index|[]
init|=
block|{
literal|0x8080
block|,
literal|0x81c0
block|,
literal|0x83e0
block|,
literal|0x87f0
block|,
literal|0x8ff8
block|,
literal|0x9ffc
block|,
literal|0xbffe
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|,
literal|0xffff
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MIN
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(((a)< (b)) ? (a) : (b))
end_define

begin_define
define|#
directive|define
name|MAXIDX
value|200
end_define

begin_define
define|#
directive|define
name|PROMPT
value|"#ffffff -> "
end_define

begin_define
define|#
directive|define
name|ASKSIZE
value|(sizeof(PROMPT) + 25)
end_define

begin_define
define|#
directive|define
name|RGBSIDE
value|50
end_define

begin_define
define|#
directive|define
name|RGBWIDTH
value|(RGBSIDE * 3)
end_define

begin_define
define|#
directive|define
name|RGBHEIGHT
value|(RGBSIDE * 2)
end_define

begin_define
define|#
directive|define
name|BASEDELTA
value|(1<<8)
end_define

begin_function_decl
name|char
modifier|*
name|malloc
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|Window
name|win
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
modifier|*
name|buf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|transbuf
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pixels
index|[
literal|5
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Color
name|cdefs
index|[
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Color
name|origdefs
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|WindowInfo
name|rinfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Font
name|font
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Color
name|rgbdefs
index|[
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Window
name|rgb
decl_stmt|,
name|redw
decl_stmt|,
name|greenw
decl_stmt|,
name|bluew
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rgbx
decl_stmt|,
name|rgby
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|shared
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|Cursor
name|cursor
decl_stmt|;
name|XEvent
name|ev
decl_stmt|;
name|XExposeEvent
modifier|*
name|exp
init|=
operator|(
name|XExposeEvent
operator|*
operator|)
operator|&
name|ev
decl_stmt|;
name|XMouseMovedEvent
modifier|*
name|mot
init|=
operator|(
name|XMouseMovedEvent
operator|*
operator|)
operator|&
name|ev
decl_stmt|;
specifier|register
name|XButtonPressedEvent
modifier|*
name|but
init|=
operator|(
name|XButtonPressedEvent
operator|*
operator|)
operator|&
name|ev
decl_stmt|;
name|WindowInfo
name|winfo
decl_stmt|;
name|Window
name|ask
decl_stmt|;
name|int
name|asking
init|=
literal|0
decl_stmt|;
name|int
name|askwidth
decl_stmt|;
name|int
name|askheight
decl_stmt|;
name|char
name|colorbuf
index|[
name|MAXIDX
operator|+
sizeof|sizeof
argument_list|(
name|PROMPT
argument_list|)
operator|+
literal|1
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|colorname
init|=
operator|&
name|colorbuf
index|[
sizeof|sizeof
argument_list|(
name|PROMPT
argument_list|)
index|]
decl_stmt|;
name|int
name|coloridx
init|=
literal|0
decl_stmt|;
name|int
name|mixing
init|=
literal|0
decl_stmt|;
name|int
name|mixtrack
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
name|int
name|tpix
decl_stmt|,
name|cnt
decl_stmt|;
name|unsigned
name|char
name|pixel
decl_stmt|;
name|Color
name|cdef
decl_stmt|;
name|FontInfo
name|finfo
decl_stmt|;
name|int
name|xoff
decl_stmt|,
name|yoff
decl_stmt|;
name|char
modifier|*
name|display
init|=
name|NULL
decl_stmt|;
for|for
control|(
name|cnt
operator|=
literal|1
init|;
name|cnt
operator|<
name|argc
condition|;
name|cnt
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|*
name|argv
index|[
name|cnt
index|]
condition|)
continue|continue;
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|cnt
index|]
argument_list|,
literal|"-s"
argument_list|)
operator|==
literal|0
condition|)
name|shared
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|index
argument_list|(
name|argv
index|[
name|cnt
index|]
argument_list|,
literal|':'
argument_list|)
condition|)
name|display
operator|=
name|argv
index|[
name|cnt
index|]
expr_stmt|;
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage: pikapix [-s] [host:display]\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|XOpenDisplay
argument_list|(
name|display
argument_list|)
condition|)
block|{
name|perror
argument_list|(
literal|"pikapix"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|DisplayPlanes
argument_list|()
operator|<
literal|2
operator|||
name|DisplayPlanes
argument_list|()
operator|>
literal|8
condition|)
name|Error
argument_list|(
literal|"only works on displays with 2 to 8 planes"
argument_list|)
expr_stmt|;
name|cursor
operator|=
name|XCreateCursor
argument_list|(
name|target_width
argument_list|,
name|target_height
argument_list|,
name|target_bits
argument_list|,
name|target_mask_bits
argument_list|,
literal|8
argument_list|,
literal|8
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|XGrabMouse
argument_list|(
name|RootWindow
argument_list|,
name|cursor
argument_list|,
name|ButtonPressed
argument_list|)
condition|)
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|XNextEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
name|XUngrabMouse
argument_list|()
expr_stmt|;
name|win
operator|=
name|but
operator|->
name|subwindow
expr_stmt|;
if|if
condition|(
operator|!
name|win
condition|)
name|Error
argument_list|(
literal|"no window selected"
argument_list|)
expr_stmt|;
name|xoff
operator|=
literal|0
expr_stmt|;
name|yoff
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
condition|)
block|{
case|case
name|LeftButton
case|:
case|case
name|MiddleButton
case|:
do|do
block|{
name|XInterpretLocator
argument_list|(
name|win
argument_list|,
operator|&
name|but
operator|->
name|x
argument_list|,
operator|&
name|but
operator|->
name|y
argument_list|,
operator|&
name|but
operator|->
name|subwindow
argument_list|,
name|but
operator|->
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|but
operator|->
name|subwindow
condition|)
break|break;
if|if
condition|(
operator|!
name|XQueryWindow
argument_list|(
name|win
argument_list|,
operator|&
name|winfo
argument_list|)
condition|)
name|Error
argument_list|(
literal|"window disappeared"
argument_list|)
expr_stmt|;
name|xoff
operator|+=
name|winfo
operator|.
name|x
operator|+
name|winfo
operator|.
name|bdrwidth
expr_stmt|;
name|yoff
operator|+=
name|winfo
operator|.
name|y
operator|+
name|winfo
operator|.
name|bdrwidth
expr_stmt|;
name|but
operator|->
name|window
operator|=
name|win
expr_stmt|;
name|win
operator|=
name|but
operator|->
name|subwindow
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
operator|)
operator|==
name|LeftButton
condition|)
do|;
block|}
name|XFreeCursor
argument_list|(
name|cursor
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XGetColorCells
argument_list|(
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
operator|&
name|cnt
argument_list|,
name|pixels
argument_list|)
condition|)
name|Error
argument_list|(
literal|"not enough color map entries"
argument_list|)
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|0
index|]
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|=
operator|~
literal|0
expr_stmt|;
name|cdefs
index|[
literal|1
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|1
index|]
expr_stmt|;
name|cdefs
index|[
literal|1
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|XStoreColors
argument_list|(
literal|2
argument_list|,
name|cdefs
argument_list|)
expr_stmt|;
name|cursor
operator|=
name|XCreateCursor
argument_list|(
name|pik_width
argument_list|,
name|pik_height
argument_list|,
name|pik_bits
argument_list|,
name|pik_mask_bits
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|,
name|pixels
index|[
literal|0
index|]
argument_list|,
name|pixels
index|[
literal|1
index|]
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XQueryWindow
argument_list|(
name|win
argument_list|,
operator|&
name|winfo
argument_list|)
condition|)
name|Error
argument_list|(
literal|"window disappeared"
argument_list|)
expr_stmt|;
name|width
operator|=
name|winfo
operator|.
name|width
operator|+
operator|(
name|winfo
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
name|height
operator|=
name|winfo
operator|.
name|height
operator|+
operator|(
name|winfo
operator|.
name|bdrwidth
operator|<<
literal|1
operator|)
expr_stmt|;
name|nbytes
operator|=
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|buf
operator|=
operator|(
name|u_char
operator|*
operator|)
name|malloc
argument_list|(
name|nbytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
name|Error
argument_list|(
literal|"window too large"
argument_list|)
expr_stmt|;
name|XPixmapGetZ
argument_list|(
name|but
operator|->
name|window
argument_list|,
name|winfo
operator|.
name|x
argument_list|,
name|winfo
operator|.
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|shared
condition|)
block|{
for|for
control|(
name|cnt
operator|=
literal|256
init|;
operator|--
name|cnt
operator|>=
literal|0
condition|;
control|)
name|transbuf
index|[
name|cnt
index|]
operator|=
name|cnt
expr_stmt|;
while|while
condition|(
operator|--
name|nbytes
operator|>=
literal|0
condition|)
block|{
name|pixel
operator|=
name|buf
index|[
name|nbytes
index|]
expr_stmt|;
if|if
condition|(
name|transbuf
index|[
name|pixel
index|]
operator|!=
name|pixel
condition|)
continue|continue;
name|cdef
operator|.
name|pixel
operator|=
name|pixel
expr_stmt|;
name|XQueryColor
argument_list|(
operator|&
name|cdef
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|XGetColorCells
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
operator|&
name|cnt
argument_list|,
operator|&
name|cdef
operator|.
name|pixel
argument_list|)
condition|)
name|Error
argument_list|(
literal|"not enough color map entries, try -s option"
argument_list|)
expr_stmt|;
name|transbuf
index|[
name|pixel
index|]
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|origdefs
index|[
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|origdefs
index|[
name|pixel
index|]
operator|.
name|pixel
operator|=
name|pixel
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|transbuf
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|--
name|nbytes
operator|>=
literal|0
condition|)
block|{
name|pixel
operator|=
name|buf
index|[
name|nbytes
index|]
expr_stmt|;
if|if
condition|(
name|transbuf
index|[
name|pixel
index|]
operator|==
name|pixel
condition|)
continue|continue;
name|cdef
operator|.
name|pixel
operator|=
name|pixel
expr_stmt|;
name|XQueryColor
argument_list|(
operator|&
name|cdef
argument_list|)
expr_stmt|;
name|transbuf
index|[
name|pixel
index|]
operator|=
name|pixel
expr_stmt|;
name|origdefs
index|[
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
block|}
block|}
name|win
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
name|xoff
operator|+
name|winfo
operator|.
name|x
argument_list|,
name|yoff
operator|+
name|winfo
operator|.
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
literal|0
argument_list|,
operator|(
name|Pixmap
operator|)
literal|0
argument_list|,
operator|(
name|Pixmap
operator|)
literal|0
argument_list|)
expr_stmt|;
name|XStoreName
argument_list|(
name|win
argument_list|,
literal|"pikapix"
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|win
argument_list|,
name|cursor
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|win
argument_list|,
name|KeyPressed
operator||
name|ButtonPressed
operator||
name|ExposeRegion
operator||
name|MouseMoved
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|win
argument_list|)
expr_stmt|;
name|font
operator|=
name|XGetFont
argument_list|(
literal|"6x10"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|font
condition|)
name|Error
argument_list|(
literal|"couldn't open font"
argument_list|)
expr_stmt|;
name|XQueryFont
argument_list|(
name|font
argument_list|,
operator|&
name|finfo
argument_list|)
expr_stmt|;
name|askwidth
operator|=
name|finfo
operator|.
name|width
operator|*
name|ASKSIZE
operator|+
literal|2
expr_stmt|;
name|askheight
operator|=
name|finfo
operator|.
name|height
operator|+
literal|2
expr_stmt|;
name|ask
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|askwidth
argument_list|,
name|askheight
argument_list|,
literal|2
argument_list|,
name|BlackPixmap
argument_list|,
name|WhitePixmap
argument_list|)
expr_stmt|;
name|askwidth
operator|+=
literal|4
expr_stmt|;
name|askheight
operator|+=
literal|4
expr_stmt|;
name|XSelectInput
argument_list|(
name|ask
argument_list|,
name|KeyPressed
operator||
name|ExposeWindow
operator||
name|ButtonPressed
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|ask
argument_list|,
name|cursor
argument_list|)
expr_stmt|;
name|rgb
operator|=
name|XCreateWindow
argument_list|(
name|RootWindow
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|RGBWIDTH
argument_list|,
name|RGBHEIGHT
argument_list|,
literal|2
argument_list|,
name|XMakeTile
argument_list|(
name|pixels
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|XMakeTile
argument_list|(
name|pixels
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|redw
operator|=
name|XCreateWindow
argument_list|(
name|rgb
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|RGBSIDE
argument_list|,
name|RGBSIDE
argument_list|,
literal|0
argument_list|,
operator|(
name|Pixmap
operator|)
literal|0
argument_list|,
name|XMakeTile
argument_list|(
name|pixels
index|[
literal|2
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|2
index|]
expr_stmt|;
name|greenw
operator|=
name|XCreateWindow
argument_list|(
name|rgb
argument_list|,
name|RGBSIDE
argument_list|,
literal|0
argument_list|,
name|RGBSIDE
argument_list|,
name|RGBSIDE
argument_list|,
literal|0
argument_list|,
operator|(
name|Pixmap
operator|)
literal|0
argument_list|,
name|XMakeTile
argument_list|(
name|pixels
index|[
literal|3
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|3
index|]
expr_stmt|;
name|bluew
operator|=
name|XCreateWindow
argument_list|(
name|rgb
argument_list|,
name|RGBSIDE
operator|*
literal|2
argument_list|,
literal|0
argument_list|,
name|RGBSIDE
argument_list|,
name|RGBSIDE
argument_list|,
literal|0
argument_list|,
operator|(
name|Pixmap
operator|)
literal|0
argument_list|,
name|XMakeTile
argument_list|(
name|pixels
index|[
literal|4
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|4
index|]
expr_stmt|;
name|rgbx
operator|=
operator|(
name|RGBWIDTH
operator|-
operator|(
name|finfo
operator|.
name|width
operator|*
literal|6
operator|)
operator|)
operator|>>
literal|1
expr_stmt|;
name|rgby
operator|=
name|RGBSIDE
operator|+
operator|(
operator|(
name|RGBSIDE
operator|-
name|finfo
operator|.
name|height
operator|)
operator|>>
literal|1
operator|)
expr_stmt|;
name|XMapSubwindows
argument_list|(
name|rgb
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|rgb
argument_list|,
name|ButtonPressed
operator||
name|ExposeWindow
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|redw
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|MiddleDownMotion
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|greenw
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|MiddleDownMotion
argument_list|)
expr_stmt|;
name|XSelectInput
argument_list|(
name|bluew
argument_list|,
name|ButtonPressed
operator||
name|ButtonReleased
operator||
name|MiddleDownMotion
argument_list|)
expr_stmt|;
name|XDefineCursor
argument_list|(
name|rgb
argument_list|,
name|cursor
argument_list|)
expr_stmt|;
name|XQueryWindow
argument_list|(
name|RootWindow
argument_list|,
operator|&
name|rinfo
argument_list|)
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|XNextEvent
argument_list|(
operator|&
name|ev
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|ev
operator|.
name|type
condition|)
block|{
case|case
name|MouseMoved
case|:
if|if
condition|(
name|asking
operator|||
operator|(
name|mixing
operator|&&
operator|!
name|mixtrack
operator|)
condition|)
break|break;
if|if
condition|(
name|mixtrack
condition|)
block|{
name|XUpdateMouse
argument_list|(
name|mot
operator|->
name|window
argument_list|,
operator|&
name|xoff
argument_list|,
operator|&
name|yoff
argument_list|,
operator|&
name|mot
operator|->
name|subwindow
argument_list|)
expr_stmt|;
name|CalcRGB
argument_list|(
name|mot
operator|->
name|window
argument_list|,
name|pixel
argument_list|,
name|yoff
argument_list|)
expr_stmt|;
block|}
else|else
name|RedoCursor
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|KeyPressed
case|:
name|string
operator|=
name|XLookupMapping
argument_list|(
operator|&
name|ev
argument_list|,
operator|&
name|nbytes
argument_list|)
expr_stmt|;
if|if
condition|(
name|nbytes
operator|==
literal|1
operator|&&
operator|(
operator|*
name|string
operator|==
literal|'\003'
operator|||
operator|*
name|string
operator|==
literal|'\004'
operator|)
condition|)
block|{
if|if
condition|(
name|asking
condition|)
block|{
name|coloridx
operator|=
literal|0
expr_stmt|;
name|asking
operator|=
literal|0
expr_stmt|;
name|XUnmapWindow
argument_list|(
name|ask
argument_list|)
expr_stmt|;
name|RedoCursor
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mixing
condition|)
block|{
name|mixing
operator|=
literal|0
expr_stmt|;
name|XUnmapWindow
argument_list|(
name|rgb
argument_list|)
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|asking
operator|&&
name|ev
operator|.
name|window
operator|==
name|ask
condition|)
block|{
while|while
condition|(
operator|--
name|nbytes
operator|>=
literal|0
condition|)
name|colorname
index|[
name|coloridx
operator|++
index|]
operator|=
operator|*
name|string
operator|++
expr_stmt|;
if|if
condition|(
name|colorname
index|[
name|coloridx
operator|-
literal|1
index|]
operator|==
literal|'\r'
condition|)
block|{
name|coloridx
operator|--
expr_stmt|;
name|asking
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|colorname
index|[
name|coloridx
operator|-
literal|1
index|]
operator|==
literal|'\177'
condition|)
block|{
if|if
condition|(
operator|--
name|coloridx
condition|)
block|{
operator|--
name|coloridx
expr_stmt|;
name|XClear
argument_list|(
name|ask
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|colorname
index|[
name|coloridx
operator|-
literal|1
index|]
operator|==
literal|'\025'
condition|)
block|{
if|if
condition|(
operator|--
name|coloridx
condition|)
name|XClear
argument_list|(
name|ask
argument_list|)
expr_stmt|;
name|coloridx
operator|=
literal|0
expr_stmt|;
block|}
name|XText
argument_list|(
name|ask
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|colorbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|PROMPT
argument_list|)
operator|+
name|coloridx
argument_list|,
name|font
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|asking
condition|)
block|{
name|XUnmapWindow
argument_list|(
name|ask
argument_list|)
expr_stmt|;
if|if
condition|(
name|coloridx
condition|)
block|{
name|colorname
index|[
name|coloridx
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|XParseColor
argument_list|(
name|colorname
argument_list|,
operator|&
name|cdef
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdef
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
if|if
condition|(
name|transbuf
index|[
name|pixel
index|]
operator|!=
name|pixel
condition|)
block|{
name|tpix
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|XFreeColors
argument_list|(
operator|&
name|tpix
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|transbuf
index|[
name|pixel
index|]
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|BitsPut
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
else|else
name|XFeep
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
name|XFeep
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|coloridx
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|ButtonPressed
case|:
if|if
condition|(
name|asking
condition|)
block|{
name|coloridx
operator|=
literal|0
expr_stmt|;
name|asking
operator|=
literal|0
expr_stmt|;
name|XUnmapWindow
argument_list|(
name|ask
argument_list|)
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|mixing
operator|&&
name|but
operator|->
name|window
operator|==
name|rgb
condition|)
block|{
switch|switch
condition|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
condition|)
block|{
case|case
name|LeftButton
case|:
case|case
name|MiddleButton
case|:
if|if
condition|(
operator|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
operator|)
operator|==
name|LeftButton
condition|)
name|cdefs
index|[
literal|0
index|]
operator|=
name|origdefs
index|[
name|pixel
index|]
expr_stmt|;
else|else
name|cdefs
index|[
literal|0
index|]
operator|=
name|cdef
expr_stmt|;
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdefs
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|origdefs
index|[
name|cdefs
index|[
literal|0
index|]
operator|.
name|pixel
index|]
operator|=
name|cdefs
index|[
literal|0
index|]
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdefs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
name|cdefs
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|0
index|]
expr_stmt|;
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
expr_stmt|;
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
expr_stmt|;
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
expr_stmt|;
name|XStoreColors
argument_list|(
literal|3
argument_list|,
name|rgbdefs
argument_list|)
expr_stmt|;
name|ResetCursor
argument_list|()
expr_stmt|;
name|PrintRGB
argument_list|()
expr_stmt|;
break|break;
case|case
name|RightButton
case|:
name|XUnmapWindow
argument_list|(
name|rgb
argument_list|)
expr_stmt|;
if|if
condition|(
name|cdef
operator|.
name|red
operator|!=
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|||
name|cdef
operator|.
name|green
operator|!=
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|||
name|cdef
operator|.
name|blue
operator|!=
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
condition|)
block|{
name|cdef
operator|=
name|cdefs
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdef
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|XGetHardwareColor
argument_list|(
operator|&
name|cdef
argument_list|)
condition|)
block|{
if|if
condition|(
name|transbuf
index|[
name|pixel
index|]
operator|!=
name|pixel
condition|)
block|{
name|tpix
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|XFreeColors
argument_list|(
operator|&
name|tpix
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|transbuf
index|[
name|pixel
index|]
operator|=
name|cdef
operator|.
name|pixel
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|BitsPut
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
else|else
name|XFeep
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mixing
operator|=
literal|0
expr_stmt|;
name|mixtrack
operator|=
literal|0
expr_stmt|;
break|break;
block|}
break|break;
block|}
if|if
condition|(
name|mixing
operator|&&
name|but
operator|->
name|window
operator|==
name|win
condition|)
break|break;
if|if
condition|(
name|mixing
condition|)
block|{
switch|switch
condition|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
condition|)
block|{
case|case
name|MiddleButton
case|:
name|mixtrack
operator|=
literal|1
expr_stmt|;
name|CalcRGB
argument_list|(
name|but
operator|->
name|window
argument_list|,
name|pixel
argument_list|,
name|but
operator|->
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|LeftButton
case|:
name|UpdateRGB
argument_list|(
name|but
operator|->
name|window
argument_list|,
name|pixel
argument_list|,
operator|-
name|BASEDELTA
argument_list|)
expr_stmt|;
break|break;
case|case
name|RightButton
case|:
name|UpdateRGB
argument_list|(
name|but
operator|->
name|window
argument_list|,
name|pixel
argument_list|,
name|BASEDELTA
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
block|}
name|pixel
operator|=
name|buf
index|[
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|but
operator|->
name|y
argument_list|)
operator|+
name|BZPixmapSize
argument_list|(
name|but
operator|->
name|x
argument_list|,
literal|1
argument_list|)
index|]
expr_stmt|;
switch|switch
condition|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
condition|)
block|{
case|case
name|LeftButton
case|:
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdef
operator|=
name|origdefs
index|[
name|pixel
index|]
expr_stmt|;
name|cdef
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|transbuf
index|[
name|pixel
index|]
operator|!=
name|pixel
condition|)
block|{
name|tpix
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|XFreeColors
argument_list|(
operator|&
name|tpix
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|transbuf
index|[
name|pixel
index|]
operator|=
name|pixel
expr_stmt|;
name|RedoCursor
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|BitsPut
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|MiddleButton
case|:
name|PopWindow
argument_list|(
name|ask
argument_list|,
name|but
argument_list|,
name|askwidth
argument_list|,
name|askheight
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|colorbuf
argument_list|,
literal|"#%02x%02x%02x -> "
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|>>
literal|8
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|>>
literal|8
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|asking
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|RightButton
case|:
name|mixing
operator|=
literal|1
expr_stmt|;
name|cdef
operator|.
name|red
operator|=
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
expr_stmt|;
name|cdef
operator|.
name|green
operator|=
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
expr_stmt|;
name|cdef
operator|.
name|blue
operator|=
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
operator|=
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
expr_stmt|;
name|XStoreColors
argument_list|(
literal|3
argument_list|,
name|rgbdefs
argument_list|)
expr_stmt|;
name|PopWindow
argument_list|(
name|rgb
argument_list|,
name|but
argument_list|,
name|RGBWIDTH
operator|+
literal|4
argument_list|,
name|RGBHEIGHT
operator|+
literal|4
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|ButtonReleased
case|:
if|if
condition|(
name|mixtrack
operator|&&
operator|(
operator|(
name|but
operator|->
name|detail
operator|&
name|ValueMask
operator|)
operator|==
name|MiddleButton
operator|)
condition|)
block|{
name|CalcRGB
argument_list|(
name|but
operator|->
name|window
argument_list|,
name|pixel
argument_list|,
name|but
operator|->
name|y
argument_list|)
expr_stmt|;
name|mixtrack
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
name|ExposeWindow
case|:
case|case
name|ExposeRegion
case|:
if|if
condition|(
name|exp
operator|->
name|window
operator|==
name|ask
condition|)
block|{
name|XText
argument_list|(
name|ask
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|colorbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|PROMPT
argument_list|)
operator|+
name|coloridx
argument_list|,
name|font
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|exp
operator|->
name|window
operator|==
name|rgb
condition|)
block|{
if|if
condition|(
name|exp
operator|->
name|subwindow
operator|==
name|NULL
condition|)
name|PrintRGB
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|exp
operator|->
name|width
operator|=
name|MIN
argument_list|(
name|exp
operator|->
name|x
operator|+
name|exp
operator|->
name|width
argument_list|,
name|width
argument_list|)
operator|-
name|exp
operator|->
name|x
expr_stmt|;
name|exp
operator|->
name|height
operator|=
name|MIN
argument_list|(
name|exp
operator|->
name|y
operator|+
name|exp
operator|->
name|height
argument_list|,
name|height
argument_list|)
operator|-
name|exp
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|exp
operator|->
name|width
operator|>
literal|0
operator|&&
name|exp
operator|->
name|height
operator|>
literal|0
condition|)
name|BitsPut
argument_list|(
name|exp
operator|->
name|x
argument_list|,
name|exp
operator|->
name|y
argument_list|,
name|exp
operator|->
name|width
argument_list|,
name|exp
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
block|}
end_function

begin_macro
name|PopWindow
argument_list|(
argument|pop
argument_list|,
argument|but
argument_list|,
argument|w
argument_list|,
argument|h
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|pop
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|XButtonPressedEvent
modifier|*
name|but
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|x
operator|=
operator|(
operator|(
name|but
operator|->
name|location
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
operator|)
operator|-
operator|(
name|w
operator|>>
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
condition|)
name|x
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|x
operator|+
name|w
operator|>
name|rinfo
operator|.
name|width
condition|)
name|x
operator|=
name|rinfo
operator|.
name|width
operator|-
name|w
expr_stmt|;
name|y
operator|=
operator|(
name|but
operator|->
name|location
operator|&
literal|0xffff
operator|)
operator|-
operator|(
name|h
operator|>>
literal|1
operator|)
operator|-
literal|3
expr_stmt|;
if|if
condition|(
name|y
operator|<
literal|0
condition|)
name|y
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|y
operator|+
name|h
operator|>
name|rinfo
operator|.
name|height
condition|)
name|y
operator|=
name|rinfo
operator|.
name|height
operator|-
name|h
expr_stmt|;
name|XMoveWindow
argument_list|(
name|pop
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|XMapWindow
argument_list|(
name|pop
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|RedoCursor
argument_list|(
argument|force
argument_list|)
end_macro

begin_decl_stmt
name|int
name|force
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|Window
name|sub
decl_stmt|;
name|unsigned
name|char
name|pixel
decl_stmt|;
specifier|static
name|unsigned
name|short
name|curspix
init|=
operator|~
literal|0
decl_stmt|;
name|XUpdateMouse
argument_list|(
name|win
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|sub
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>=
name|width
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>=
name|height
condition|)
return|return;
name|pixel
operator|=
name|transbuf
index|[
name|buf
index|[
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
name|y
argument_list|)
operator|+
name|BZPixmapSize
argument_list|(
name|x
argument_list|,
literal|1
argument_list|)
index|]
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|force
operator|&&
operator|(
name|pixel
operator|==
name|curspix
operator|)
condition|)
return|return;
name|curspix
operator|=
name|pixel
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|=
name|origdefs
index|[
name|pixel
index|]
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|pixel
operator|=
name|pixels
index|[
literal|0
index|]
expr_stmt|;
name|ResetCursor
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ResetCursor
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|<=
literal|0x8000
operator|&&
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|<=
literal|0x8000
operator|&&
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|<=
literal|0x8000
condition|)
name|cdefs
index|[
literal|1
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|blue
operator|=
operator|~
literal|0
expr_stmt|;
else|else
name|cdefs
index|[
literal|1
index|]
operator|.
name|red
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|cdefs
index|[
literal|1
index|]
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|XStoreColors
argument_list|(
literal|2
argument_list|,
name|cdefs
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|UpdateRGB
argument_list|(
argument|ew
argument_list|,
argument|pixel
argument_list|,
argument|value
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|ew
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|pixel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|value
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
if|if
condition|(
name|ew
operator|==
name|redw
condition|)
block|{
name|value
operator|+=
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|value
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|value
operator|>
literal|0xffff
condition|)
name|value
operator|=
literal|0xffff
expr_stmt|;
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ew
operator|==
name|greenw
condition|)
block|{
name|value
operator|+=
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|value
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|value
operator|>
literal|0xffff
condition|)
name|value
operator|=
literal|0xffff
expr_stmt|;
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ew
operator|==
name|bluew
condition|)
block|{
name|value
operator|+=
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|value
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|value
operator|>
literal|0xffff
condition|)
name|value
operator|=
literal|0xffff
expr_stmt|;
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
else|else
return|return;
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|=
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|=
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
expr_stmt|;
name|ResetCursor
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdef
operator|=
name|cdefs
index|[
literal|0
index|]
expr_stmt|;
name|cdef
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
block|}
name|PrintRGB
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|CalcRGB
argument_list|(
argument|ew
argument_list|,
argument|pixel
argument_list|,
argument|value
argument_list|)
end_macro

begin_decl_stmt
name|Window
name|ew
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|pixel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|value
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|Color
name|cdef
decl_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|value
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|value
operator|>=
name|RGBSIDE
condition|)
name|value
operator|=
operator|(
name|RGBSIDE
operator|-
literal|1
operator|)
expr_stmt|;
name|value
operator|=
operator|(
literal|0xffff
operator|*
name|value
operator|)
operator|/
operator|(
name|RGBSIDE
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|ew
operator|==
name|redw
condition|)
block|{
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ew
operator|==
name|greenw
condition|)
block|{
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ew
operator|==
name|bluew
condition|)
block|{
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
operator|=
name|value
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|rgbdefs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
else|else
return|return;
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|=
name|rgbdefs
index|[
literal|0
index|]
operator|.
name|red
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|=
name|rgbdefs
index|[
literal|1
index|]
operator|.
name|green
expr_stmt|;
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|=
name|rgbdefs
index|[
literal|2
index|]
operator|.
name|blue
expr_stmt|;
name|ResetCursor
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|shared
condition|)
block|{
name|cdef
operator|=
name|cdefs
index|[
literal|0
index|]
expr_stmt|;
name|cdef
operator|.
name|pixel
operator|=
name|transbuf
index|[
name|pixel
index|]
expr_stmt|;
name|origdefs
index|[
name|cdef
operator|.
name|pixel
index|]
operator|=
name|cdef
expr_stmt|;
name|XStoreColors
argument_list|(
literal|1
argument_list|,
operator|&
name|cdef
argument_list|)
expr_stmt|;
block|}
name|PrintRGB
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|PrintRGB
argument_list|()
end_macro

begin_block
block|{
name|char
name|rgbbuf
index|[
literal|7
index|]
decl_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|rgbbuf
argument_list|,
literal|"%02x%02x%02x"
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|red
operator|>>
literal|8
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|green
operator|>>
literal|8
argument_list|,
name|cdefs
index|[
literal|0
index|]
operator|.
name|blue
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|XText
argument_list|(
name|rgb
argument_list|,
name|rgbx
argument_list|,
name|rgby
argument_list|,
name|rgbbuf
argument_list|,
literal|6
argument_list|,
name|font
argument_list|,
name|BlackPixel
argument_list|,
name|WhitePixel
argument_list|)
expr_stmt|;
block|}
end_block

begin_define
define|#
directive|define
name|CHUNKSIZE
value|2048
end_define

begin_decl_stmt
name|u_char
name|outbuf
index|[
name|CHUNKSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_macro
name|BitsPut
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|w
argument_list|,
argument|h
argument_list|)
end_macro

begin_decl_stmt
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|u_char
modifier|*
name|data
decl_stmt|,
modifier|*
name|ptr
decl_stmt|,
modifier|*
name|trans
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|per
decl_stmt|,
name|delta
decl_stmt|,
name|linesize
decl_stmt|;
name|trans
operator|=
name|transbuf
expr_stmt|;
name|linesize
operator|=
name|BZPixmapSize
argument_list|(
name|width
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|data
operator|=
operator|&
name|buf
index|[
name|y
operator|*
name|linesize
operator|+
name|BZPixmapSize
argument_list|(
name|x
argument_list|,
literal|1
argument_list|)
index|]
expr_stmt|;
name|per
operator|=
name|BZPixmapSize
argument_list|(
name|w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|delta
operator|=
name|CHUNKSIZE
operator|/
name|per
expr_stmt|;
name|linesize
operator|-=
name|per
expr_stmt|;
while|while
condition|(
name|h
condition|)
block|{
if|if
condition|(
name|h
operator|<
name|delta
condition|)
name|delta
operator|=
name|h
expr_stmt|;
for|for
control|(
name|ptr
operator|=
name|outbuf
operator|,
name|i
operator|=
name|delta
init|;
operator|--
name|i
operator|>=
literal|0
condition|;
name|data
operator|+=
name|linesize
control|)
block|{
for|for
control|(
name|j
operator|=
name|per
init|;
operator|--
name|j
operator|>=
literal|0
condition|;
control|)
operator|*
name|ptr
operator|++
operator|=
name|trans
index|[
operator|*
name|data
operator|++
index|]
expr_stmt|;
block|}
name|XPixmapBitsPutZ
argument_list|(
name|win
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|delta
argument_list|,
name|outbuf
argument_list|,
name|NULL
argument_list|,
name|GXcopy
argument_list|,
name|AllPlanes
argument_list|)
expr_stmt|;
name|y
operator|+=
name|delta
expr_stmt|;
name|h
operator|-=
name|delta
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|Error
argument_list|(
argument|why
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|why
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pikapix: %s\n"
argument_list|,
name|why
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

