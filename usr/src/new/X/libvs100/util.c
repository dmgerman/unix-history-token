begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $Header: util.c,v 10.4 86/11/30 16:45:52 jg Rel $ */
end_comment

begin_comment
comment|/* util.c		Various utilities  *  *	ErrorString	Interprets an error string  *	SoundBell	Generate audible bell  *	SetKeyClick	Control key click  *	SetAutoRepeat	Control auto repeat  *	SetLockLED	Control Lock LED  *	QueryShape	Determine shapes  *	SetVideo	Set video blanking  *	ResolveColors	does nothing  *	StoreColors	does nothing  *  */
end_comment

begin_comment
comment|/****************************************************************************  *									    *  *  Copyright (c) 1983, 1984 by						    *  *  DIGITAL EQUIPMENT CORPORATION, Maynard, Massachusetts.		    *  *  All rights reserved.						    *  * 									    *  *  This software is furnished on an as-is basis and may be used and copied *  *  only with inclusion of the above copyright notice. This software or any *  *  other copies thereof may be provided or otherwise made available to     *  *  others only for non-commercial purposes.  No title to or ownership of   *  *  the software is hereby transferred.					    *  * 									    *  *  The information in this software is  subject to change without notice   *  *  and  should  not  be  construed as  a commitment by DIGITAL EQUIPMENT   *  *  CORPORATION.							    *  * 									    *  *  DIGITAL assumes no responsibility for the use  or  reliability of its   *  *  software on equipment which is not supplied by DIGITAL.		    *  * 									    *  *									    *  ****************************************************************************/
end_comment

begin_include
include|#
directive|include
file|"vs100.h"
end_include

begin_include
include|#
directive|include
file|"reason.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|sys_nerr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|sys_errlist
index|[]
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|AllocateSpace
parameter_list|()
function_decl|;
end_function_decl

begin_struct
struct|struct
name|_ErrEntry
block|{
name|int
name|code
decl_stmt|;
name|char
modifier|*
name|reason
decl_stmt|;
block|}
name|errorList
index|[
name|NUM_ERR_CODES
index|]
init|=
block|{
block|{
name|IR_ID
block|,
name|IR_ID_MSG
block|}
block|,
block|{
name|IR_CD
block|,
name|IR_CD_MSG
block|}
block|,
block|{
name|IR_DCI
block|,
name|IR_DCI_MSG
block|}
block|,
block|{
name|IR_DE
block|,
name|IR_DE_MSG
block|}
block|,
block|{
name|IR_CM
block|,
name|IR_CM_MSG
block|}
block|,
block|{
name|IR_DPM
block|,
name|IR_DPM_MSG
block|}
block|,
block|{
name|IR_MM
block|,
name|IR_MM_MSG
block|}
block|,
block|{
name|IR_PD
block|,
name|IR_PD_MSG
block|}
block|,
block|{
name|IR_AB_ACK
block|,
name|IR_AB_ACK_MSG
block|}
block|,
block|{
name|IR_STAT_ACK
block|,
name|IR_STAT_ACK_MSG
block|}
block|,
block|{
name|IR_SAVE_ACK
block|,
name|IR_SAVE_ACK_MSG
block|}
block|,
block|{
name|ERR_NYI
block|,
name|ERR_NYI_MSG
block|}
block|,
block|{
name|ERR_IFC
block|,
name|ERR_IFC_MSG
block|}
block|,
block|{
name|ERR_ICC
block|,
name|ERR_ICC_MSG
block|}
block|,
block|{
name|ERR_BE_NXM_68K
block|,
name|ERR_BE_NXM_68K_MSG
block|}
block|,
block|{
name|ERR_BE_RO
block|,
name|ERR_BE_RO_MSG
block|}
block|,
block|{
name|ERR_BE_LD
block|,
name|ERR_BE_LD_MSG
block|}
block|,
block|{
name|ERR_BE_S
block|,
name|ERR_BE_S_MSG
block|}
block|,
block|{
name|ERR_AE
block|,
name|ERR_AE_MSG
block|}
block|,
block|{
name|ERR_ZD
block|,
name|ERR_ZD_MSG
block|}
block|,
block|{
name|ERR_II
block|,
name|ERR_II_MSG
block|}
block|,
block|{
name|ERR_NXM_BBA
block|,
name|ERR_NXM_BBA_MSG
block|}
block|,
block|{
name|ERR_BNI
block|,
name|ERR_BNI_MSG
block|}
block|,
block|{
name|ERR_KCQO
block|,
name|ERR_KCQO_MSG
block|}
block|,
block|{
name|ERR_DPCQO
block|,
name|ERR_DPCQO_MSG
block|}
block|,
block|{
name|ERR_MEQO
block|,
name|ERR_MEQO_MSG
block|}
block|,
block|{
name|ERR_DPEQO
block|,
name|ERR_DPEQO_MSG
block|}
block|,
block|{
name|ERR_AB_BBA
block|,
name|ERR_AB_BBA_MSG
block|}
block|,
block|{
name|ERR_KEQO
block|,
name|ERR_KEQO_MSG
block|}
block|,
block|{
name|ERR_KOR
block|,
name|ERR_KOR_MSG
block|}
block|,
block|{
name|ERR_DPOR
block|,
name|ERR_DPOR_MSG
block|}
block|,
block|{
name|ERR_KFE
block|,
name|ERR_KFE_MSG
block|}
block|,
block|{
name|ERR_DPFE
block|,
name|ERR_DPFE_MSG
block|}
block|,
block|{
name|ERR_ISRCM
block|,
name|ERR_ISRCM_MSG
block|}
block|,
block|{
name|ERR_ISRCBW
block|,
name|ERR_ISRCBW_MSG
block|}
block|,
block|{
name|ERR_ISRCBH
block|,
name|ERR_ISRCBH_MSG
block|}
block|,
block|{
name|ERR_ISRCC
block|,
name|ERR_ISRCC_MSG
block|}
block|,
block|{
name|ERR_ISRCBD
block|,
name|ERR_ISRCBD_MSG
block|}
block|,
block|{
name|ERR_IMSKM
block|,
name|ERR_IMSKM_MSG
block|}
block|,
block|{
name|ERR_IMSKBW
block|,
name|ERR_IMSKBW_MSG
block|}
block|,
block|{
name|ERR_IMSKBH
block|,
name|ERR_IMSKBH_MSG
block|}
block|,
block|{
name|ERR_IMSKBD
block|,
name|ERR_IMSKBD_MSG
block|}
block|,
block|{
name|ERR_IDSTM
block|,
name|ERR_IDSTM_MSG
block|}
block|,
block|{
name|ERR_IDSTBW
block|,
name|ERR_IDSTBW_MSG
block|}
block|,
block|{
name|ERR_IDSTBH
block|,
name|ERR_IDSTBH_MSG
block|}
block|,
block|{
name|ERR_IDSTBD
block|,
name|ERR_IDSTBD_MSG
block|}
block|,
block|{
name|ERR_IMAPM
block|,
name|ERR_IMAPM_MSG
block|}
block|,
block|{
name|ERR_ICLPM
block|,
name|ERR_ICLPM_MSG
block|}
block|,
block|{
name|ERR_ICLPC
block|,
name|ERR_ICLPC_MSG
block|}
block|,
block|{
name|ERR_SMC_ITC
block|,
name|ERR_SMC_ITC_MSG
block|}
block|,
block|{
name|ERR_SCL_CD
block|,
name|ERR_SCL_CD_MSG
block|}
block|,
block|{
name|ERR_AC_ICD
block|,
name|ERR_AC_ICD_MSG
block|}
block|,
block|{
name|ERR_MO_IBC
block|,
name|ERR_MO_IBC_MSG
block|}
block|,
block|{
name|ERR_MO_IOT
block|,
name|ERR_MO_IOT_MSG
block|}
block|,
block|{
name|ERR_MO_IDT
block|,
name|ERR_MO_IDT_MSG
block|}
block|,
block|{
name|ERR_IPC
block|,
name|ERR_IPC_MSG
block|}
block|,
block|{
name|ERR_DC_IPL
block|,
name|ERR_DC_IPL_MSG
block|}
block|,
block|{
name|ERR_DC_IPM
block|,
name|ERR_DC_IPM_MSG
block|}
block|,
block|{
name|ERR_DC_ICF
block|,
name|ERR_DC_ICF_MSG
block|}
block|,
block|{
name|ERR_DC_IPP
block|,
name|ERR_DC_IPP_MSG
block|}
block|,
block|{
name|ERR_DC_IPSM
block|,
name|ERR_DC_IPSM_MSG
block|}
block|,
block|{
name|ERR_DC_IPMM
block|,
name|ERR_DC_IPMM_MSG
block|}
block|,
block|{
name|ERR_DC_IPC
block|,
name|ERR_DC_IPC_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCBW
block|,
name|ERR_DC_ISSRCBW_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCBH
block|,
name|ERR_DC_ISSRCBH_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCBD
block|,
name|ERR_DC_ISSRCBD_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCC
block|,
name|ERR_DC_ISSRCC_MSG
block|}
block|,
block|{
name|ERR_DC_IDPM
block|,
name|ERR_DC_IDPM_MSG
block|}
block|,
block|{
name|ERR_DC_DXO
block|,
name|ERR_DC_DXO_MSG
block|}
block|,
block|{
name|ERR_DC_DYO
block|,
name|ERR_DC_DYO_MSG
block|}
block|,
block|{
name|ERR_DC_CRSO
block|,
name|ERR_DC_CRSO_MSG
block|}
block|,
block|{
name|ERR_PT_ICSL
block|,
name|ERR_PT_ICSL_MSG
block|}
block|,
block|{
name|ERR_PT_ICSO
block|,
name|ERR_PT_ICSO_MSG
block|}
block|,
block|{
name|ERR_PT_ICSP
block|,
name|ERR_PT_ICSP_MSG
block|}
block|,
block|{
name|ERR_PT_ITSL
block|,
name|ERR_PT_ITSL_MSG
block|}
block|,
block|{
name|ERR_PT_ICI
block|,
name|ERR_PT_ICI_MSG
block|}
block|,
block|{
name|ERR_PT_TSE
block|,
name|ERR_PT_TSE_MSG
block|}
block|,
block|{
name|ERR_PT_NFP
block|,
name|ERR_PT_NFP_MSG
block|}
block|,
block|{
name|ERR_PT_ISRCFW
block|,
name|ERR_PT_ISRCFW_MSG
block|}
block|,
block|{
name|ERR_PT_ISRCFH
block|,
name|ERR_PT_ISRCFH_MSG
block|}
block|,
block|{
name|ERR_PT_ISRCFD
block|,
name|ERR_PT_ISRCFD_MSG
block|}
block|,
block|{
name|ERR_PT_IMSKFW
block|,
name|ERR_PT_IMSKFW_MSG
block|}
block|,
block|{
name|ERR_PT_IMSKFH
block|,
name|ERR_PT_IMSKFH_MSG
block|}
block|,
block|{
name|ERR_PT_IMSKFD
block|,
name|ERR_PT_IMSKFD_MSG
block|}
block|,
block|{
name|ERR_PT_CSMF
block|,
name|ERR_PT_CSMF_MSG
block|}
block|,
block|{
name|ERR_PT_ILB
block|,
name|ERR_PT_ILB_MSG
block|}
block|,
block|{
name|ERR_PT_ILE
block|,
name|ERR_PT_ILE_MSG
block|}
block|,
block|{
name|ERR_FA_ISRCB
block|,
name|ERR_FA_ISRCB_MSG
block|}
block|,
block|{
name|ERR_FA_SO
block|,
name|ERR_FA_SO_MSG
block|}
block|,
block|{
name|ERR_FA_IBMM
block|,
name|ERR_FA_IBMM_MSG
block|}
block|,
block|{
name|ERR_FP_ISRCB
block|,
name|ERR_FP_ISRCB_MSG
block|}
block|,
block|{
name|ERR_FP_ICF
block|,
name|ERR_FP_ICF_MSG
block|}
block|,
block|{
name|ERR_FP_DXO
block|,
name|ERR_FP_DXO_MSG
block|}
block|,
block|{
name|ERR_FP_DYO
block|,
name|ERR_FP_DYO_MSG
block|}
block|,
block|{
name|ERR_CPU
block|,
name|ERR_CPU_MSG
block|}
block|,
block|{
name|ERR_RHB
block|,
name|ERR_RHB_MSG
block|}
block|,
block|{
name|ERR_PR
block|,
name|ERR_PR_MSG
block|}
block|,
block|{
name|ERR_CRTC
block|,
name|ERR_CRTC_MSG
block|}
block|,
block|{
name|ERR_DPE
block|,
name|ERR_DPE_MSG
block|}
block|,
block|{
name|ERR_KE
block|,
name|ERR_KE_MSG
block|}
block|,
block|{
name|ERR_FOE
block|,
name|ERR_FOE_MSG
block|}
block|,
block|{
name|ERR_F0
block|,
name|ERR_F0_MSG
block|}
block|,
block|{
name|ERR_BSR
block|,
name|ERR_BSR_MSG
block|}
block|,
block|{
name|ERR_BCC
block|,
name|ERR_BCC_MSG
block|}
block|,
block|{
name|ERR_DPTO
block|,
name|ERR_DPTO_MSG
block|}
block|,
block|{
name|ERR_FOO
block|,
name|ERR_FOO_MSG
block|}
block|,
block|{
name|ERR_KTO
block|,
name|ERR_KTO_MSG
block|}
block|,
block|{
name|ERR_KST
block|,
name|ERR_KST_MSG
block|}
block|,
block|{
name|ERR_VR
block|,
name|ERR_VR_MSG
block|}
block|,
block|{
name|ERR_F1
block|,
name|ERR_F1_MSG
block|}
block|,
block|{
name|ERR_F2
block|,
name|ERR_F2_MSG
block|}
block|,
block|{
name|ERR_F3
block|,
name|ERR_F3_MSG
block|}
block|,
block|{
name|ERR_DPP
block|,
name|ERR_DPP_MSG
block|}
block|,
block|{
name|ERR_KP
block|,
name|ERR_KP_MSG
block|}
block|,
block|{
name|ERR_FOED
block|,
name|ERR_FOED_MSG
block|}
block|,
block|{
name|ERR_FOOD
block|,
name|ERR_FOOD_MSG
block|}
block|,
block|{
name|ERR_BCTO
block|,
name|ERR_BCTO_MSG
block|}
block|,
block|{
name|ERR_RLB
block|,
name|ERR_RLB_MSG
block|}
block|,
block|{
name|ERR_KD
block|,
name|ERR_KD_MSG
block|}
block|,
block|{
name|ERR_BVC
block|,
name|ERR_BVC_MSG
block|}
block|,
block|{
name|ERR_ISRCHW
block|,
name|ERR_ISRCHW_MSG
block|}
block|,
block|{
name|ERR_ISRCHH
block|,
name|ERR_ISRCHH_MSG
block|}
block|,
block|{
name|ERR_ISRCHD
block|,
name|ERR_ISRCHD_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCHW
block|,
name|ERR_DC_ISSRCHW_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCHH
block|,
name|ERR_DC_ISSRCHH_MSG
block|}
block|,
block|{
name|ERR_DC_ISSRCHD
block|,
name|ERR_DC_ISSRCHD_MSG
block|}
block|,
block|{
name|ERR_LC_ICTX
block|,
name|ERR_LC_ICTX_MSG
block|}
block|,
block|{
name|ERR_LC_ICTY
block|,
name|ERR_LC_ICTY_MSG
block|}
block|,
block|{
name|ERR_LC_ICCX
block|,
name|ERR_LC_ICCX_MSG
block|}
block|,
block|{
name|ERR_LC_ICCY
block|,
name|ERR_LC_ICCY_MSG
block|}
block|,
block|{
name|ERR_LC_ICW
block|,
name|ERR_LC_ICW_MSG
block|}
block|,
block|{
name|ERR_LC_ICH
block|,
name|ERR_LC_ICH_MSG
block|}
block|,
block|{
name|ERR_PT_DXO
block|,
name|ERR_PT_DXO_MSG
block|}
block|,
block|{
name|ERR_PT_CRSO
block|,
name|ERR_PT_CRSO_MSG
block|}
block|, }
struct|;
end_struct

begin_comment
comment|/* Interpret a string corresponding to an error code.  This doesn't  * work very well since the driver can't return enough bits for the  * code, but we do our best */
end_comment

begin_function
name|char
modifier|*
name|ErrorString
parameter_list|(
name|error
parameter_list|)
name|int
name|error
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_ERR_CODES
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|errorList
index|[
name|i
index|]
operator|.
name|code
operator|==
name|error
condition|)
return|return
operator|(
name|errorList
index|[
name|i
index|]
operator|.
name|reason
operator|)
return|;
block|}
if|if
condition|(
name|error
operator|>
literal|0
operator|&&
name|error
operator|<
name|sys_nerr
condition|)
return|return
operator|(
name|sys_errlist
index|[
name|error
index|]
operator|)
return|;
return|return
operator|(
literal|"Unknown error"
operator|)
return|;
block|}
end_function

begin_macro
name|SoundBell
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|buf
decl_stmt|;
if|if
condition|(
operator|(
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|AllocateSpace
argument_list|(
literal|4
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return;
name|buf
index|[
literal|0
index|]
operator|=
literal|3
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
literal|0x23
expr_stmt|;
name|buf
index|[
literal|2
index|]
operator|=
literal|0x87
operator|-
name|volume
expr_stmt|;
name|buf
index|[
literal|3
index|]
operator|=
literal|0xa7
expr_stmt|;
name|SendToPeripheral
argument_list|(
name|buf
argument_list|,
literal|4
argument_list|,
name|VSE_DKB
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|SetKeyClick
argument_list|(
argument|volume
argument_list|)
end_macro

begin_decl_stmt
name|int
name|volume
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|buf
decl_stmt|;
if|if
condition|(
operator|(
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|AllocateSpace
argument_list|(
literal|3
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|volume
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|2
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
literal|0x1b
expr_stmt|;
name|buf
index|[
literal|2
index|]
operator|=
literal|0x88
operator|-
name|volume
expr_stmt|;
block|}
else|else
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
literal|0x99
expr_stmt|;
name|buf
index|[
literal|2
index|]
operator|=
literal|0x99
expr_stmt|;
block|}
name|SendToPeripheral
argument_list|(
name|buf
argument_list|,
literal|3
argument_list|,
name|VSE_DKB
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|QueryShape
argument_list|(
argument|shape
argument_list|,
argument|width
argument_list|,
argument|height
argument_list|)
end_macro

begin_decl_stmt
name|int
name|shape
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|short
modifier|*
name|width
decl_stmt|,
modifier|*
name|height
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|shape
condition|)
block|{
case|case
name|CursorShape
case|:
if|if
condition|(
operator|*
name|width
operator|>
literal|64
condition|)
operator|*
name|width
operator|=
literal|64
expr_stmt|;
if|if
condition|(
operator|*
name|height
operator|>
literal|64
condition|)
operator|*
name|height
operator|=
literal|64
expr_stmt|;
break|break;
case|case
name|TileShape
case|:
operator|*
name|width
operator|=
operator|*
name|height
operator|=
literal|16
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_macro
name|SetAutoRepeat
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
modifier|*
name|buf
decl_stmt|;
if|if
condition|(
operator|(
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|AllocateSpace
argument_list|(
literal|2
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return;
name|buf
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
name|onoff
condition|?
literal|0xe3
else|:
literal|0xe1
expr_stmt|;
name|SendToPeripheral
argument_list|(
name|buf
argument_list|,
literal|2
argument_list|,
name|VSE_DKB
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|SetLockLED
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

begin_macro
name|SetVideo
argument_list|(
argument|onoff
argument_list|)
end_macro

begin_decl_stmt
name|int
name|onoff
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
name|onoff
operator|-
literal|1
operator|)
return|;
block|}
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|ResolveColor
argument_list|(
argument|red
argument_list|,
argument|green
argument_list|,
argument|blue
argument_list|)
end_macro

begin_decl_stmt
name|unsigned
name|short
modifier|*
name|red
decl_stmt|,
modifier|*
name|green
decl_stmt|,
modifier|*
name|blue
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_macro
name|StoreColors
argument_list|(
argument|count
argument_list|,
argument|entries
argument_list|)
end_macro

begin_decl_stmt
name|int
name|count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ColorDef
modifier|*
name|entries
decl_stmt|;
end_decl_stmt

begin_block
block|{ }
end_block

end_unit

