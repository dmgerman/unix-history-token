begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"mh.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_define
define|#
directive|define
name|_FROM
value|1
end_define

begin_define
define|#
directive|define
name|_NOTFROM
value|0
end_define

begin_define
define|#
directive|define
name|FROM
value|13
end_define

begin_comment
comment|/* Start of From field          */
end_comment

begin_define
define|#
directive|define
name|SFROM
value|16
end_define

begin_comment
comment|/* Length of "        "         */
end_comment

begin_define
define|#
directive|define
name|DATE
value|5
end_define

begin_comment
comment|/* Start of Date field          */
end_comment

begin_define
define|#
directive|define
name|SDATE
value|7
end_define

begin_comment
comment|/* Length                       */
end_comment

begin_define
define|#
directive|define
name|SUBJ
value|31
end_define

begin_comment
comment|/* Start of Subject field       */
end_comment

begin_define
define|#
directive|define
name|SSUBJ
value|(79-SUBJ)
end_define

begin_comment
comment|/* Size of Subject field        */
end_comment

begin_define
define|#
directive|define
name|BSUBJ
value|20
end_define

begin_comment
comment|/* Room needed in Sub field to  */
end_comment

begin_comment
comment|/* add stuff from the body      */
end_comment

begin_define
define|#
directive|define
name|MSGN
value|0
end_define

begin_comment
comment|/* Start of msg name field      */
end_comment

begin_define
define|#
directive|define
name|SMSGN
value|3
end_define

begin_comment
comment|/* Length                       */
end_comment

begin_define
define|#
directive|define
name|FLGS
value|3
end_define

begin_comment
comment|/* Start of flags field         */
end_comment

begin_define
define|#
directive|define
name|SFLGS
value|2
end_define

begin_comment
comment|/* Width of flag field          */
end_comment

begin_decl_stmt
name|FILE
modifier|*
name|scnout
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|scanl
index|[
literal|82
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|local
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|hostseen
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|frmtok
parameter_list|()
function_decl|;
end_function_decl

begin_macro
name|scan
argument_list|(
argument|inb
argument_list|,
argument|innum
argument_list|,
argument|outnum
argument_list|,
argument|curflg
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|iobuf
modifier|*
name|inb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|outnum
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|,
name|name
index|[
name|NAMESZ
index|]
decl_stmt|,
name|tobuf
index|[
literal|32
index|]
decl_stmt|,
name|frombuf
index|[
literal|32
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
modifier|*
name|tok1
decl_stmt|;
name|int
name|state
decl_stmt|,
name|subsz
decl_stmt|,
name|first
decl_stmt|,
name|compnum
decl_stmt|;
specifier|static
name|char
modifier|*
name|myname
decl_stmt|;
name|local
operator|=
literal|0
expr_stmt|;
name|hostseen
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|myname
condition|)
name|myname
operator|=
name|getenv
argument_list|(
literal|"USER"
argument_list|)
expr_stmt|;
name|tobuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|frombuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|first
operator|=
literal|0
expr_stmt|;
name|state
operator|=
name|FLD
expr_stmt|;
name|compnum
operator|=
literal|1
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|state
operator|=
name|m_getfld
argument_list|(
name|state
argument_list|,
name|name
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|inb
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|first
operator|++
operator|&&
name|state
operator|!=
name|FILEEOF
condition|)
block|{
comment|/*##*/
if|if
condition|(
name|outnum
condition|)
block|{
if|if
condition|(
operator|(
name|scnout
operator|=
name|fopen
argument_list|(
name|cp
operator|=
name|m_name
argument_list|(
name|outnum
argument_list|)
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error creating msg "
argument_list|)
expr_stmt|;
name|perror
argument_list|(
name|cp
argument_list|)
expr_stmt|;
name|done
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|chmod
argument_list|(
name|cp
argument_list|,
name|m_gmprot
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|sfill
argument_list|(
name|scanl
argument_list|,
sizeof|sizeof
name|scanl
argument_list|)
expr_stmt|;
name|scanl
index|[
sizeof|sizeof
name|scanl
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|subsz
operator|=
literal|0
expr_stmt|;
name|tobuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
block|}
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|FLD
case|:
case|case
name|FLDEOF
case|:
case|case
name|FLDPLUS
case|:
name|compnum
operator|++
expr_stmt|;
if|if
condition|(
name|uleq
argument_list|(
name|name
argument_list|,
literal|"from"
argument_list|)
condition|)
name|frombuf
index|[
name|cpyfrm
argument_list|(
name|buf
argument_list|,
name|frombuf
argument_list|,
sizeof|sizeof
name|frombuf
argument_list|,
name|_FROM
argument_list|)
index|]
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|uleq
argument_list|(
name|name
argument_list|,
literal|"date"
argument_list|)
condition|)
name|cpydat
argument_list|(
name|buf
argument_list|,
name|scanl
operator|+
name|DATE
argument_list|,
name|SDATE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|uleq
argument_list|(
name|name
argument_list|,
literal|"subject"
argument_list|)
operator|&&
name|scanl
index|[
name|SUBJ
index|]
operator|==
literal|' '
condition|)
name|subsz
operator|=
name|cpy
argument_list|(
name|buf
argument_list|,
name|scanl
operator|+
name|SUBJ
argument_list|,
name|SSUBJ
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|uleq
argument_list|(
name|name
argument_list|,
literal|"to"
argument_list|)
operator|&&
operator|!
name|tobuf
index|[
literal|0
index|]
condition|)
name|tobuf
index|[
name|cpyfrm
argument_list|(
name|buf
argument_list|,
name|tobuf
argument_list|,
sizeof|sizeof
name|tobuf
operator|-
literal|1
argument_list|,
name|_NOTFROM
argument_list|)
index|]
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|uleq
argument_list|(
name|name
argument_list|,
literal|"replied"
argument_list|)
condition|)
name|cpy
argument_list|(
literal|"-"
argument_list|,
name|scanl
operator|+
name|FLGS
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|put
argument_list|(
name|name
argument_list|,
name|buf
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
while|while
condition|(
name|state
operator|==
name|FLDPLUS
condition|)
block|{
name|state
operator|=
name|m_getfld
argument_list|(
name|state
argument_list|,
name|name
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|inb
argument_list|)
expr_stmt|;
if|if
condition|(
name|scnout
condition|)
name|fputs
argument_list|(
name|buf
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|state
operator|==
name|FLDEOF
condition|)
goto|goto
name|putscan
goto|;
continue|continue;
case|case
name|BODY
case|:
case|case
name|BODYEOF
case|:
name|compnum
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|&&
name|subsz
operator|<
name|SSUBJ
operator|-
name|BSUBJ
condition|)
block|{
name|scanl
index|[
name|SUBJ
operator|+
name|subsz
operator|+
literal|1
index|]
operator|=
literal|'<'
expr_stmt|;
name|scanl
index|[
name|SUBJ
operator|+
name|subsz
operator|+
literal|2
index|]
operator|=
literal|'<'
expr_stmt|;
name|cpy
argument_list|(
name|buf
argument_list|,
name|scanl
operator|+
name|SUBJ
operator|+
name|subsz
operator|+
literal|3
argument_list|,
name|SSUBJ
operator|-
name|subsz
operator|-
literal|3
argument_list|)
expr_stmt|;
name|subsz
operator|=
name|SSUBJ
expr_stmt|;
block|}
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|&&
name|scnout
condition|)
block|{
name|putc
argument_list|(
literal|'\n'
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
name|buf
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|scnout
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Write error on "
argument_list|)
expr_stmt|;
name|perror
argument_list|(
name|m_name
argument_list|(
name|outnum
argument_list|)
argument_list|)
expr_stmt|;
name|done
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
name|body
label|:
while|while
condition|(
name|state
operator|==
name|BODY
condition|)
block|{
name|state
operator|=
name|m_getfld
argument_list|(
name|state
argument_list|,
name|name
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|inb
argument_list|)
expr_stmt|;
if|if
condition|(
name|scnout
condition|)
name|fputs
argument_list|(
name|buf
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|state
operator|==
name|BODYEOF
condition|)
block|{
name|putscan
label|:
name|cpymsgn
argument_list|(
name|m_name
argument_list|(
name|innum
argument_list|)
argument_list|,
name|scanl
operator|+
name|MSGN
argument_list|,
name|SMSGN
argument_list|)
expr_stmt|;
name|tok1
operator|=
name|brkstring
argument_list|(
name|getcpy
argument_list|(
name|frombuf
argument_list|)
argument_list|,
literal|" "
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|frombuf
index|[
literal|0
index|]
operator|||
name|uleq
argument_list|(
name|frombuf
argument_list|,
name|myname
argument_list|)
operator|||
operator|(
name|local
operator|&&
name|uleq
argument_list|(
operator|*
name|tok1
argument_list|,
name|myname
argument_list|)
operator|)
condition|)
block|{
name|cpy
argument_list|(
literal|"To:"
argument_list|,
name|scanl
operator|+
name|FROM
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|cpy
argument_list|(
name|tobuf
argument_list|,
name|scanl
operator|+
name|FROM
operator|+
literal|3
argument_list|,
name|SFROM
operator|-
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
name|cpy
argument_list|(
name|frombuf
argument_list|,
name|scanl
operator|+
name|FROM
argument_list|,
name|SFROM
argument_list|)
expr_stmt|;
if|if
condition|(
name|curflg
condition|)
name|cpy
argument_list|(
literal|"+"
argument_list|,
name|scanl
operator|+
name|FLGS
argument_list|,
name|SFLGS
argument_list|)
expr_stmt|;
name|trim
argument_list|(
name|scanl
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
name|scanl
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
name|scnout
condition|)
block|{
name|fflush
argument_list|(
name|scnout
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|scnout
argument_list|)
condition|)
block|{
name|perror
argument_list|(
literal|"Write error on "
argument_list|)
expr_stmt|;
name|perror
argument_list|(
name|m_name
argument_list|(
name|outnum
argument_list|)
argument_list|)
expr_stmt|;
name|done
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|scnout
argument_list|)
expr_stmt|;
name|scnout
operator|=
name|NULL
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|LENERR
case|:
case|case
name|FMTERR
case|:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"??Message Format Error "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"(Message %d) "
argument_list|,
name|outnum
condition|?
name|outnum
else|:
name|innum
argument_list|)
expr_stmt|;
comment|/*##*/
if|if
condition|(
name|compnum
operator|<
literal|0
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"in the Body.\n"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"in Component #%d.\n"
argument_list|,
name|compnum
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-----------------------------------------"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"-------------------------------------\n"
argument_list|)
expr_stmt|;
goto|goto
name|badret
goto|;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Getfld returned %d\n"
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|badret
label|:
if|if
condition|(
name|outnum
condition|)
block|{
name|fputs
argument_list|(
literal|"\n\nBAD MSG:\n"
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
if|if
condition|(
name|compnum
operator|<
literal|0
condition|)
name|fputs
argument_list|(
name|buf
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
else|else
name|fputs
argument_list|(
name|name
argument_list|,
name|scnout
argument_list|)
expr_stmt|;
comment|/***    ungetc(inb);    ***/
name|state
operator|=
name|BODY
expr_stmt|;
goto|goto
name|body
goto|;
block|}
if|if
condition|(
name|scnout
condition|)
name|fflush
argument_list|(
name|scnout
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
case|case
name|FILEEOF
case|:
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
block|}
end_block

begin_macro
name|trim
argument_list|(
argument|str
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|str
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|;
name|cp
operator|=
name|str
expr_stmt|;
while|while
condition|(
operator|*
name|cp
condition|)
name|cp
operator|++
expr_stmt|;
while|while
condition|(
operator|*
operator|--
name|cp
operator|==
literal|' '
condition|)
empty_stmt|;
name|cp
operator|++
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
literal|'\n'
expr_stmt|;
operator|*
name|cp
operator|++
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|sfill
argument_list|(
argument|str
argument_list|,
argument|cnt
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|str
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|cp
operator|=
name|str
expr_stmt|;
name|i
operator|=
name|cnt
expr_stmt|;
do|do
operator|*
name|cp
operator|++
operator|=
literal|' '
expr_stmt|;
do|while
condition|(
operator|--
name|i
condition|)
do|;
block|}
end_block

begin_expr_stmt
name|put
argument_list|(
name|name
argument_list|,
name|buf
argument_list|,
name|ip
argument_list|)
specifier|register
name|FILE
operator|*
name|ip
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|ip
condition|)
block|{
name|fputs
argument_list|(
name|name
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|':'
argument_list|,
name|ip
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
name|buf
argument_list|,
name|ip
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|ip
argument_list|)
condition|)
block|{
name|perror
argument_list|(
literal|"Write error"
argument_list|)
expr_stmt|;
name|done
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_expr_stmt
name|cpy
argument_list|(
name|from
argument_list|,
name|to
argument_list|,
name|cnt
argument_list|)
specifier|register
name|char
operator|*
name|from
operator|,
operator|*
name|to
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|cnt
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|;
name|char
modifier|*
name|sfrom
decl_stmt|;
name|sfrom
operator|=
name|from
expr_stmt|;
while|while
condition|(
operator|*
name|from
operator|==
literal|' '
operator|||
operator|*
name|from
operator|==
literal|'\t'
operator|||
operator|*
name|from
operator|==
literal|'\n'
condition|)
name|from
operator|++
expr_stmt|;
while|while
condition|(
name|cnt
operator|--
condition|)
if|if
condition|(
name|c
operator|=
operator|*
name|from
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'\t'
operator|||
name|c
operator|==
literal|' '
operator|||
name|c
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|to
operator|++
operator|=
literal|' '
expr_stmt|;
do|do
name|from
operator|++
expr_stmt|;
do|while
condition|(
operator|(
name|c
operator|=
operator|*
name|from
operator|)
operator|==
literal|' '
operator|||
name|c
operator|==
literal|'\t'
operator|||
name|c
operator|==
literal|'\n'
condition|)
do|;
continue|continue;
block|}
else|else
operator|*
name|to
operator|++
operator|=
name|c
expr_stmt|;
name|from
operator|++
expr_stmt|;
block|}
else|else
break|break;
return|return
operator|(
name|from
operator|-
name|sfrom
operator|-
literal|1
operator|)
return|;
block|}
end_block

begin_function_decl
name|int
modifier|*
name|localtime
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|findmonth
parameter_list|()
function_decl|;
end_function_decl

begin_macro
name|cpydat
argument_list|(
argument|sfrom
argument_list|,
argument|sto
argument_list|,
argument|cnt
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|sfrom
decl_stmt|,
modifier|*
name|sto
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|from
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
specifier|register
name|int
name|c
decl_stmt|;
specifier|static
name|int
modifier|*
name|locvec
decl_stmt|;
name|long
name|now
decl_stmt|;
name|char
modifier|*
name|to
decl_stmt|;
if|if
condition|(
operator|!
name|locvec
condition|)
block|{
name|time
argument_list|(
operator|&
name|now
argument_list|)
expr_stmt|;
name|locvec
operator|=
name|localtime
argument_list|(
operator|&
name|now
argument_list|)
expr_stmt|;
block|}
name|to
operator|=
name|sto
expr_stmt|;
for|for
control|(
name|from
operator|=
name|sfrom
init|;
operator|(
name|c
operator|=
operator|*
name|from
operator|)
operator|<
literal|'0'
operator|||
name|c
operator|>
literal|'9'
condition|;
name|from
operator|++
control|)
if|if
condition|(
operator|!
name|c
condition|)
return|return;
name|c
operator|=
name|cnt
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|from
init|;
operator|(
operator|*
name|cp
operator|>=
literal|'0'
operator|&&
operator|*
name|cp
operator|<=
literal|'9'
operator|)
operator|||
operator|*
name|cp
operator|==
literal|' '
condition|;
name|cp
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|cp
operator|=
name|findmonth
argument_list|(
name|cp
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|cp
index|[
literal|1
index|]
condition|)
block|{
operator|*
name|to
operator|++
operator|=
literal|' '
expr_stmt|;
name|c
operator|--
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|cp
operator|&&
name|c
operator|--
condition|)
operator|*
name|to
operator|++
operator|=
operator|*
name|cp
operator|++
expr_stmt|;
name|c
operator|--
expr_stmt|;
operator|*
name|to
operator|++
operator|=
literal|'/'
expr_stmt|;
if|if
condition|(
name|from
index|[
literal|1
index|]
operator|==
literal|' '
condition|)
block|{
operator|*
name|to
operator|++
operator|=
literal|' '
expr_stmt|;
name|c
operator|--
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|from
operator|>=
literal|'0'
operator|&&
operator|*
name|from
operator|<=
literal|'9'
operator|&&
name|c
operator|--
condition|)
operator|*
name|to
operator|++
operator|=
operator|*
name|from
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|>=
literal|2
condition|)
block|{
while|while
condition|(
operator|*
name|from
operator|<
literal|'0'
operator|||
operator|*
name|from
operator|>
literal|'9'
condition|)
name|from
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|c
operator|=
name|atoi
argument_list|(
name|from
argument_list|)
operator|)
operator|>
literal|1970
operator|&&
name|c
operator|-
literal|1900
operator|<
name|locvec
index|[
literal|5
index|]
operator|)
operator|||
name|c
operator|<
name|locvec
index|[
literal|5
index|]
condition|)
block|{
operator|*
name|to
operator|++
operator|=
literal|'/'
expr_stmt|;
operator|*
name|to
operator|++
operator|=
operator|(
name|c
operator|<
literal|100
operator|)
condition|?
operator|(
name|c
operator|-
literal|70
operator|+
literal|'0'
operator|)
else|:
operator|(
name|c
operator|-
literal|1970
operator|+
literal|'0'
operator|)
expr_stmt|;
block|}
block|}
return|return;
block|}
if|if
condition|(
name|from
index|[
literal|1
index|]
operator|==
literal|' '
condition|)
block|{
operator|*
name|to
operator|++
operator|=
literal|' '
expr_stmt|;
name|c
operator|--
expr_stmt|;
block|}
while|while
condition|(
operator|*
name|from
operator|&&
name|c
operator|--
condition|)
operator|*
name|to
operator|++
operator|=
operator|*
name|from
operator|++
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|char
modifier|*
name|fromp
decl_stmt|,
name|fromdlm
decl_stmt|,
name|pfromdlm
decl_stmt|;
end_decl_stmt

begin_macro
name|cpyfrm
argument_list|(
argument|sfrom
argument_list|,
argument|sto
argument_list|,
argument|cnt
argument_list|,
argument|fromcall
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|sfrom
decl_stmt|,
modifier|*
name|sto
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|to
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
specifier|register
name|int
name|c
decl_stmt|;
name|fromdlm
operator|=
literal|' '
expr_stmt|;
name|fromp
operator|=
name|sfrom
expr_stmt|;
name|to
operator|=
name|sto
expr_stmt|;
name|cp
operator|=
name|frmtok
argument_list|()
expr_stmt|;
do|do
if|if
condition|(
name|c
operator|=
operator|*
name|cp
operator|++
condition|)
operator|*
name|to
operator|++
operator|=
name|c
expr_stmt|;
else|else
break|break;
do|while
condition|(
operator|--
name|cnt
condition|)
do|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|cnt
operator|<
literal|3
condition|)
break|break;
if|if
condition|(
operator|*
operator|(
name|cp
operator|=
name|frmtok
argument_list|()
operator|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|*
name|cp
operator|==
literal|'@'
operator|||
name|uleq
argument_list|(
name|cp
argument_list|,
literal|"at"
argument_list|)
condition|)
block|{
name|cp
operator|=
name|frmtok
argument_list|()
expr_stmt|;
if|if
condition|(
name|uleq
argument_list|(
name|cp
argument_list|,
literal|"berkeley"
argument_list|)
condition|)
block|{
comment|/* if the first "From:" host is local */
if|if
condition|(
name|fromcall
operator|&&
operator|!
name|hostseen
operator|++
condition|)
name|local
operator|++
expr_stmt|;
block|}
else|else
block|{
operator|*
name|to
operator|++
operator|=
literal|'@'
expr_stmt|;
name|cnt
operator|--
expr_stmt|;
do|do
if|if
condition|(
name|c
operator|=
operator|*
name|cp
operator|++
condition|)
operator|*
name|to
operator|++
operator|=
name|c
expr_stmt|;
else|else
break|break;
do|while
condition|(
operator|--
name|cnt
condition|)
do|;
block|}
block|}
elseif|else
if|if
condition|(
name|cnt
operator|>
literal|4
condition|)
block|{
name|cnt
operator|--
expr_stmt|;
operator|*
name|to
operator|++
operator|=
name|pfromdlm
expr_stmt|;
do|do
if|if
condition|(
name|c
operator|=
operator|*
name|cp
operator|++
condition|)
operator|*
name|to
operator|++
operator|=
name|c
expr_stmt|;
else|else
break|break;
do|while
condition|(
operator|--
name|cnt
condition|)
do|;
block|}
block|}
if|if
condition|(
name|fromcall
condition|)
name|hostseen
operator|++
expr_stmt|;
return|return
operator|(
name|to
operator|-
name|sto
operator|)
return|;
block|}
end_block

begin_function
name|char
modifier|*
name|frmtok
parameter_list|()
block|{
specifier|static
name|char
name|tokbuf
index|[
literal|64
index|]
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|;
specifier|register
name|int
name|c
decl_stmt|;
name|pfromdlm
operator|=
name|fromdlm
expr_stmt|;
name|cp
operator|=
name|tokbuf
expr_stmt|;
operator|*
name|cp
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|c
operator|=
operator|*
name|fromp
operator|++
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
name|c
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|' '
operator|&&
name|cp
operator|==
name|tokbuf
condition|)
continue|continue;
if|if
condition|(
name|c
operator|==
literal|' '
operator|||
name|c
operator|==
literal|'\n'
operator|||
name|c
operator|==
literal|','
condition|)
break|break;
operator|*
name|cp
operator|++
operator|=
name|c
expr_stmt|;
operator|*
name|cp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'@'
operator|||
operator|*
name|fromp
operator|==
literal|'@'
operator|||
name|cp
operator|==
operator|&
name|tokbuf
index|[
literal|63
index|]
condition|)
break|break;
block|}
name|fromdlm
operator|=
name|c
expr_stmt|;
return|return
operator|(
name|tokbuf
operator|)
return|;
block|}
end_function

begin_comment
comment|/*      num specific!         */
end_comment

begin_macro
name|cpymsgn
argument_list|(
argument|msgnam
argument_list|,
argument|addr
argument_list|,
argument|len
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|msgnam
decl_stmt|,
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|sp
decl_stmt|;
name|sp
operator|=
name|msgnam
expr_stmt|;
name|cp
operator|=
name|addr
operator|+
operator|(
name|len
operator|-
name|strlen
argument_list|(
name|sp
argument_list|)
operator|)
expr_stmt|;
while|while
condition|(
operator|*
name|sp
condition|)
operator|*
name|cp
operator|++
operator|=
operator|*
name|sp
operator|++
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|char
modifier|*
name|monthtab
index|[]
init|=
block|{
literal|"jan"
block|,
literal|"feb"
block|,
literal|"mar"
block|,
literal|"apr"
block|,
literal|"may"
block|,
literal|"jun"
block|,
literal|"jul"
block|,
literal|"aug"
block|,
literal|"sep"
block|,
literal|"oct"
block|,
literal|"nov"
block|,
literal|"dec"
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|char
modifier|*
name|findmonth
parameter_list|(
name|str
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|sp
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|static
name|char
name|buf
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|locv
parameter_list|()
function_decl|;
for|for
control|(
name|cp
operator|=
name|str
operator|,
name|sp
operator|=
name|buf
init|;
operator|(
operator|*
name|sp
operator|++
operator|=
operator|*
name|cp
operator|++
operator|)
operator|&&
name|sp
operator|<
operator|&
name|buf
index|[
literal|3
index|]
operator|&&
operator|*
name|cp
operator|!=
literal|' '
condition|;
control|)
empty_stmt|;
operator|*
name|sp
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|12
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|uleq
argument_list|(
name|buf
argument_list|,
name|monthtab
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%2d"
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

