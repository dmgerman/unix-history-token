begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * Copyright (c) 1984, 1985, 1986 Xerox Corp.  *  * HISTORY  * 02-Sep-86  Lee Moore (lee) at Xerox Webster Research Center  *	Changed exit status to be 0 or 1.  *  * 07-Jul-86  Lee Moore (lee) at Xerox Webster Research Center  *	Converted for use with getopt.  *  * 25-Mar-86  Lee Moore (lee) at Xerox Webster Research Center  *	Fixed the "usage" message to be more helpful.  *  * 01-Dec-85  lee at Xerox, WRC  *	Modified to pass lint.  *  *	28-apr-85  ed flint	add conditional code for vax11-c (vms)  *				now use -s for point size and added -o for  *				output file  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|vax11c
end_ifdef

begin_include
include|#
directive|include
include|stdio
end_include

begin_include
include|#
directive|include
include|ctype
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"iptokens.h"
end_include

begin_include
include|#
directive|include
file|"literal.h"
end_include

begin_include
include|#
directive|include
file|"operator.h"
end_include

begin_comment
comment|/* frame buffer numbers */
end_comment

begin_define
define|#
directive|define
name|F_backgroundfont
value|1
end_define

begin_define
define|#
directive|define
name|F_font
value|2
end_define

begin_define
define|#
directive|define
name|F_transform
value|3
end_define

begin_define
define|#
directive|define
name|INCH
value|720
end_define

begin_define
define|#
directive|define
name|Top_margin
value|(10 * INCH)
end_define

begin_define
define|#
directive|define
name|Left_margin
value|(INCH * 2)
end_define

begin_define
define|#
directive|define
name|Left_table
value|(Left_margin + INCH/2)
end_define

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|char
name|u_fontname
index|[
literal|256
index|]
decl_stmt|,
name|buffer
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|outputname
init|=
literal|0
decl_stmt|;
name|int
name|c
decl_stmt|;
name|int
name|ipressfile
decl_stmt|;
name|int
name|point_size
init|=
literal|10
decl_stmt|;
name|int
name|char_spacing
decl_stmt|;
name|int
name|line_spacing
decl_stmt|;
name|int
name|x_pos
decl_stmt|;
name|int
name|y_pos
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|num
decl_stmt|;
name|int
name|prefix
init|=
literal|0
decl_stmt|;
specifier|extern
name|int
name|optind
decl_stmt|;
specifier|extern
name|char
modifier|*
name|optarg
decl_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"o:O:p:P:s:S:"
argument_list|)
operator|)
operator|!=
name|EOF
condition|)
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'o'
case|:
case|case
literal|'O'
case|:
name|outputname
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
case|case
literal|'P'
case|:
operator|(
name|void
operator|)
name|sscanf
argument_list|(
name|optarg
argument_list|,
literal|"%o"
argument_list|,
operator|&
name|prefix
argument_list|)
expr_stmt|;
break|break;
case|case
operator|(
literal|'s'
operator|)
case|:
case|case
operator|(
literal|'S'
operator|)
case|:
name|point_size
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|argc
operator|-
name|optind
operator|!=
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"charset: [-pcharSet] [-ooutput] [-sptSize] fontName\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|u_fontname
argument_list|,
literal|"Xerox/XC1-1-1/"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strcat
argument_list|(
name|u_fontname
argument_list|,
name|argv
index|[
name|optind
index|]
argument_list|)
expr_stmt|;
comment|/* set spacing parameters */
name|line_spacing
operator|=
operator|(
name|point_size
operator|+
literal|2
operator|)
operator|*
literal|15
expr_stmt|;
name|char_spacing
operator|=
name|point_size
operator|*
literal|30
expr_stmt|;
if|if
condition|(
name|outputname
operator|!=
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|vax11c
if|if
condition|(
operator|(
name|ipressfile
operator|=
name|creat
argument_list|(
name|outputname
argument_list|,
literal|0
argument_list|,
literal|"rfm=udf"
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
else|#
directive|else
if|if
condition|(
operator|(
name|ipressfile
operator|=
name|open
argument_list|(
name|outputname
argument_list|,
name|O_WRONLY
operator||
name|O_CREAT
argument_list|,
literal|0666
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
endif|#
directive|endif
block|{
name|perror
argument_list|(
name|outputname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
comment|/* default to stdout */
block|{
name|ipressfile
operator|=
literal|1
expr_stmt|;
block|}
name|ip_select
argument_list|(
name|ipressfile
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_beginBlock
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_beginBody
argument_list|)
expr_stmt|;
comment|/* set up the two fonts: the background and the font in question */
name|SetupFont
argument_list|(
literal|"Xerox/XC1-1-1/Classic"
argument_list|,
literal|100.
argument_list|,
name|F_backgroundfont
argument_list|)
expr_stmt|;
name|SetupFont
argument_list|(
name|u_fontname
argument_list|,
name|point_size
operator|*
literal|10.
argument_list|,
name|F_font
argument_list|)
expr_stmt|;
comment|/* set frame[2] to a scaling transform that uses 1/10 point */
comment|/* co-ordiate system */
name|AppendRational
argument_list|(
literal|353L
argument_list|,
literal|10000000
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_scale
argument_list|)
expr_stmt|;
name|AppendInteger
argument_list|(
operator|(
name|long
operator|)
name|F_transform
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_fset
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_endBody
argument_list|)
expr_stmt|;
comment|/* end preamble */
name|AppendOp
argument_list|(
name|OP_beginBody
argument_list|)
expr_stmt|;
comment|/* page 1 (and only) */
name|Fget
argument_list|(
name|F_transform
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_concatt
argument_list|)
expr_stmt|;
name|Setfont
argument_list|(
name|F_backgroundfont
argument_list|)
expr_stmt|;
name|Setxy
argument_list|(
operator|(
name|double
operator|)
name|Left_margin
argument_list|,
operator|(
name|double
operator|)
name|Top_margin
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"Xerox/XC1-1-1/%s at %d point, character set %o (octal)"
argument_list|,
name|argv
index|[
name|optind
index|]
argument_list|,
name|point_size
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
name|ShowString
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|buffer
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|x_pos
operator|=
name|Left_table
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|x_pos
operator|+=
name|char_spacing
operator|,
name|i
operator|++
control|)
block|{
name|Setxy
argument_list|(
operator|(
name|double
operator|)
name|x_pos
argument_list|,
call|(
name|double
call|)
argument_list|(
name|Top_margin
operator|-
literal|2
operator|*
name|line_spacing
argument_list|)
argument_list|)
expr_stmt|;
name|ShowString
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|buffer
index|[
literal|0
index|]
operator|+=
literal|1
expr_stmt|;
block|}
for|for
control|(
name|y_pos
operator|=
name|Top_margin
operator|-
literal|3
operator|*
name|line_spacing
operator|,
name|num
operator|=
literal|000
init|;
name|num
operator|<
literal|0377
condition|;
name|y_pos
operator|-=
name|line_spacing
control|)
block|{
name|Setxy
argument_list|(
operator|(
name|double
operator|)
name|Left_margin
argument_list|,
operator|(
name|double
operator|)
name|y_pos
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%03o"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|ShowString
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|Setfont
argument_list|(
name|F_font
argument_list|)
expr_stmt|;
for|for
control|(
name|x_pos
operator|=
name|Left_table
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|x_pos
operator|+=
name|char_spacing
operator|,
name|i
operator|++
operator|,
name|num
operator|++
control|)
block|{
name|Setxy
argument_list|(
operator|(
name|double
operator|)
name|x_pos
argument_list|,
operator|(
name|double
operator|)
name|y_pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|!=
literal|0377
condition|)
block|{
if|if
condition|(
name|prefix
operator|>
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"\377%c%c"
argument_list|,
name|prefix
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|AppendString
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|buffer
index|[
literal|0
index|]
operator|=
name|num
expr_stmt|;
name|buffer
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|AppendString
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
block|}
name|AppendOp
argument_list|(
name|OP_show
argument_list|)
expr_stmt|;
block|}
block|}
name|Setfont
argument_list|(
name|F_backgroundfont
argument_list|)
expr_stmt|;
block|}
comment|/* wrap it up */
name|AppendOp
argument_list|(
name|OP_endBody
argument_list|)
expr_stmt|;
name|AppendOp
argument_list|(
name|OP_endBlock
argument_list|)
expr_stmt|;
name|ip_flush
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

