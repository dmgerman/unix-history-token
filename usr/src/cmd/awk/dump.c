begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"awk.def"
end_include

begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_include
include|#
directive|include
file|"awk.h"
end_include

begin_define
define|#
directive|define
name|printit
parameter_list|(
name|n
parameter_list|)
value|printf(printname[n-FIRSTTOKEN]);
end_define

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|printname
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|cell
name|fldtab
index|[]
decl_stmt|;
end_decl_stmt

begin_macro
name|dump
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_decl_stmt
name|node
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
end_decl_stmt

begin_block
block|{
ifdef|#
directive|ifdef
name|DEBUG
name|node
modifier|*
name|x
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|nullstat
condition|)
return|return;
for|for
control|(
name|x
operator|=
name|a
init|;
name|x
operator|!=
name|NULL
condition|;
name|x
operator|=
name|x
operator|->
name|nnext
control|)
block|{
if|if
condition|(
name|x
operator|==
name|b
condition|)
name|printf
argument_list|(
literal|" *** "
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|ntype
operator|==
name|NVALUE
condition|)
block|{
switch|switch
condition|(
name|x
operator|->
name|subtype
condition|)
block|{
default|default:
name|runerror
argument_list|()
expr_stmt|;
case|case
name|CCON
case|:
case|case
name|CVAR
case|:
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|x
operator|->
name|nobj
operator|->
name|nval
argument_list|)
expr_stmt|;
continue|continue;
case|case
name|CFLD
case|:
if|if
condition|(
name|x
operator|->
name|nobj
operator|->
name|nval
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"$%d"
argument_list|,
name|x
operator|->
name|nobj
operator|-
name|fldtab
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"$0"
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
elseif|else
if|if
condition|(
name|x
operator|->
name|ntype
operator|==
name|PASTAT2
condition|)
block|{
name|pa2dump
argument_list|(
name|x
argument_list|,
name|b
argument_list|)
expr_stmt|;
continue|continue;
block|}
switch|switch
condition|(
name|x
operator|->
name|nobj
condition|)
block|{
default|default:
name|runerror
argument_list|()
expr_stmt|;
case|case
name|LE
case|:
case|case
name|LT
case|:
case|case
name|EQ
case|:
case|case
name|NE
case|:
case|case
name|GT
case|:
case|case
name|GE
case|:
case|case
name|MATCH
case|:
case|case
name|NOTMATCH
case|:
case|case
name|ADD
case|:
case|case
name|MINUS
case|:
case|case
name|MULT
case|:
case|case
name|DIVIDE
case|:
case|case
name|MOD
case|:
case|case
name|ASGNOP
case|:
case|case
name|BOR
case|:
case|case
name|AND
case|:
case|case
name|CAT
case|:
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|nobj
operator|!=
name|MATCH
operator|&&
name|x
operator|->
name|nobj
operator|!=
name|NOTMATCH
condition|)
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"regex"
argument_list|)
expr_stmt|;
break|break;
case|case
name|UMINUS
case|:
case|case
name|FNCN
case|:
case|case
name|INCR
case|:
case|case
name|DECR
case|:
case|case
name|INDIRECT
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|PRINT
case|:
case|case
name|PRINTF
case|:
case|case
name|SPRINTF
case|:
case|case
name|SPLIT
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|nobj
operator|==
name|SPLIT
operator|||
name|x
operator|->
name|nobj
operator|==
name|SPRINTF
condition|)
break|break;
if|if
condition|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
operator|==
literal|0
condition|)
break|break;
name|printit
argument_list|(
operator|(
name|int
operator|)
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|IF
case|:
case|case
name|WHILE
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") "
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
operator|==
name|NULL
condition|)
break|break;
name|printit
argument_list|(
name|ELSE
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|FOR
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|';'
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|';'
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") "
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|3
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|NEXT
case|:
case|case
name|EXIT
case|:
case|case
name|BREAK
case|:
case|case
name|CONTINUE
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROGRAM
case|:
if|if
condition|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"BEGIN {"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
block|}
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
operator|!=
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"END {"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|PASTAT
case|:
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"{"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ARRAY
case|:
name|printf
argument_list|(
name|x
operator|->
name|nval
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SUBSTR
case|:
name|printit
argument_list|(
name|x
operator|->
name|nobj
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|','
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
operator|!=
name|NULL
condition|)
block|{
name|putchar
argument_list|(
literal|','
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|x
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|')'
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|x
operator|->
name|ntype
operator|==
name|NSTAT
condition|)
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_block

begin_macro
name|pa2dump
argument_list|(
argument|a
argument_list|,
argument|b
argument_list|)
end_macro

begin_decl_stmt
name|node
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
end_decl_stmt

begin_block
block|{
ifdef|#
directive|ifdef
name|DEBUG
name|dump
argument_list|(
name|a
operator|->
name|narg
index|[
literal|0
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|a
operator|->
name|narg
index|[
literal|1
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" {"
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|a
operator|->
name|narg
index|[
literal|2
index|]
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"}\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_block

end_unit

