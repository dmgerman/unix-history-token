begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"awk.h"
end_include

begin_define
define|#
directive|define
name|NULL
value|0
end_define

begin_struct
struct|struct
name|xx
block|{
name|int
name|token
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|pname
decl_stmt|;
block|}
name|proc
index|[]
block|{
block|{
name|PROGRAM
operator|,
literal|"program"
operator|,
name|NULL
block|}
operator|,
block|{
name|BOR
operator|,
literal|"boolop"
operator|,
literal|" || "
block|}
operator|,
block|{
name|AND
operator|,
literal|"boolop"
operator|,
literal|"&& "
block|}
operator|,
block|{
name|NOT
operator|,
literal|"boolop"
operator|,
literal|" !"
block|}
operator|,
block|{
name|NE
operator|,
literal|"relop"
operator|,
literal|" != "
block|}
operator|,
block|{
name|EQ
operator|,
literal|"relop"
operator|,
literal|" == "
block|}
operator|,
block|{
name|LE
operator|,
literal|"relop"
operator|,
literal|"<= "
block|}
operator|,
block|{
name|LT
operator|,
literal|"relop"
operator|,
literal|"< "
block|}
operator|,
block|{
name|GE
operator|,
literal|"relop"
operator|,
literal|">= "
block|}
operator|,
block|{
name|GT
operator|,
literal|"relop"
operator|,
literal|"> "
block|}
operator|,
block|{
name|ARRAY
operator|,
literal|"array"
operator|,
name|NULL
block|}
operator|,
block|{
name|INDIRECT
operator|,
literal|"indirect"
operator|,
literal|"$("
block|}
operator|,
block|{
name|SUBSTR
operator|,
literal|"substr"
operator|,
literal|"substr"
block|}
operator|,
block|{
name|INDEX
operator|,
literal|"sindex"
operator|,
literal|"sindex"
block|}
operator|,
block|{
name|SPRINTF
operator|,
literal|"asprintf"
operator|,
literal|"sprintf "
block|}
operator|,
block|{
name|ADD
operator|,
literal|"arith"
operator|,
literal|" + "
block|}
operator|,
block|{
name|MINUS
operator|,
literal|"arith"
operator|,
literal|" - "
block|}
operator|,
block|{
name|MULT
operator|,
literal|"arith"
operator|,
literal|" * "
block|}
operator|,
block|{
name|DIVIDE
operator|,
literal|"arith"
operator|,
literal|" / "
block|}
operator|,
block|{
name|MOD
operator|,
literal|"arith"
operator|,
literal|" % "
block|}
operator|,
block|{
name|UMINUS
operator|,
literal|"arith"
operator|,
literal|" -"
block|}
operator|,
block|{
name|PREINCR
operator|,
literal|"incrdecr"
operator|,
literal|"++"
block|}
operator|,
block|{
name|POSTINCR
operator|,
literal|"incrdecr"
operator|,
literal|"++"
block|}
operator|,
block|{
name|PREDECR
operator|,
literal|"incrdecr"
operator|,
literal|"--"
block|}
operator|,
block|{
name|POSTDECR
operator|,
literal|"incrdecr"
operator|,
literal|"--"
block|}
operator|,
block|{
name|CAT
operator|,
literal|"cat"
operator|,
literal|" "
block|}
operator|,
block|{
name|PASTAT
operator|,
literal|"pastat"
operator|,
name|NULL
block|}
operator|,
block|{
name|PASTAT2
operator|,
literal|"dopa2"
operator|,
name|NULL
block|}
operator|,
block|{
name|MATCH
operator|,
literal|"matchop"
operator|,
literal|" ~ "
block|}
operator|,
block|{
name|NOTMATCH
operator|,
literal|"matchop"
operator|,
literal|" !~ "
block|}
operator|,
block|{
name|PRINTF
operator|,
literal|"aprintf"
operator|,
literal|"printf"
block|}
operator|,
block|{
name|PRINT
operator|,
literal|"print"
operator|,
literal|"print"
block|}
operator|,
block|{
name|SPLIT
operator|,
literal|"split"
operator|,
literal|"split"
block|}
operator|,
block|{
name|ASSIGN
operator|,
literal|"assign"
operator|,
literal|" = "
block|}
operator|,
block|{
name|ADDEQ
operator|,
literal|"assign"
operator|,
literal|" += "
block|}
operator|,
block|{
name|SUBEQ
operator|,
literal|"assign"
operator|,
literal|" -= "
block|}
operator|,
block|{
name|MULTEQ
operator|,
literal|"assign"
operator|,
literal|" *= "
block|}
operator|,
block|{
name|DIVEQ
operator|,
literal|"assign"
operator|,
literal|" /= "
block|}
operator|,
block|{
name|MODEQ
operator|,
literal|"assign"
operator|,
literal|" %= "
block|}
operator|,
block|{
name|IF
operator|,
literal|"ifstat"
operator|,
literal|"if("
block|}
operator|,
block|{
name|WHILE
operator|,
literal|"whilestat"
operator|,
literal|"while("
block|}
operator|,
block|{
name|FOR
operator|,
literal|"forstat"
operator|,
literal|"for("
block|}
operator|,
block|{
name|IN
operator|,
literal|"instat"
operator|,
literal|"instat"
block|}
operator|,
block|{
name|NEXT
operator|,
literal|"jump"
operator|,
literal|"next"
block|}
operator|,
block|{
name|EXIT
operator|,
literal|"jump"
operator|,
literal|"exit"
block|}
operator|,
block|{
name|BREAK
operator|,
literal|"jump"
operator|,
literal|"break"
block|}
operator|,
block|{
name|CONTINUE
operator|,
literal|"jump"
operator|,
literal|"continue"
block|}
operator|,
block|{
name|FNCN
operator|,
literal|"fncn"
operator|,
literal|"fncn"
block|}
operator|,
block|{
literal|0
operator|,
literal|""
block|}
operator|,
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|SIZE
value|LASTTOKEN - FIRSTTOKEN
end_define

begin_decl_stmt
name|char
modifier|*
name|table
index|[
name|SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|names
index|[
name|SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|()
block|{
name|struct
name|xx
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"#include \"awk.def\"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"obj nullproc();\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
if|if
condition|(
name|p
operator|==
name|proc
operator|||
name|strcmp
argument_list|(
name|p
operator|->
name|name
argument_list|,
operator|(
name|p
operator|-
literal|1
operator|)
operator|->
name|name
argument_list|)
condition|)
name|printf
argument_list|(
literal|"extern obj %s();\n"
argument_list|,
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
name|table
index|[
name|p
operator|->
name|token
operator|-
name|FIRSTTOKEN
index|]
operator|=
name|p
operator|->
name|name
expr_stmt|;
name|printf
argument_list|(
literal|"obj (*proctab[%d])() {\n"
argument_list|,
name|SIZE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|table
index|[
name|i
index|]
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"/*%s*/\tnullproc,\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"/*%s*/\t%s,\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|,
name|table
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"};\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"char *printname[%d] {\n"
argument_list|,
name|SIZE
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
name|names
index|[
name|p
operator|->
name|token
operator|-
name|FIRSTTOKEN
index|]
operator|=
name|p
operator|->
name|pname
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SIZE
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"/*%s*/\t\"%s\",\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|,
name|names
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"};\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

