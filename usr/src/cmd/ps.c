begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *	ps - process status  *	examine and print certain things about processes  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<a.out.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/proc.h>
end_include

begin_include
include|#
directive|include
file|<sys/tty.h>
end_include

begin_include
include|#
directive|include
file|<sys/dir.h>
end_include

begin_include
include|#
directive|include
file|<sys/user.h>
end_include

begin_decl_stmt
name|struct
name|nlist
name|nl
index|[]
init|=
block|{
block|{
literal|"_proc"
block|}
block|,
block|{
literal|"_swapdev"
block|}
block|,
block|{
literal|"_swplo"
block|}
block|,
block|{
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|proc
name|mproc
decl_stmt|;
end_decl_stmt

begin_union
union|union
block|{
name|struct
name|user
name|yy
decl_stmt|;
name|int
name|xx
index|[
literal|128
index|]
index|[
name|UPAGES
index|]
decl_stmt|;
block|}
name|zz
union|;
end_union

begin_define
define|#
directive|define
name|u
value|zz.yy
end_define

begin_decl_stmt
name|int
name|chkpid
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|retcode
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|kflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|xflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|tptr
decl_stmt|;
end_decl_stmt

begin_function_decl
name|char
modifier|*
name|gettty
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|aflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pagetbl
index|[
literal|128
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|mem
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|swmem
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|swap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|daddr_t
name|swplo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ndev
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|devl
block|{
name|char
name|dname
index|[
name|DIRSIZ
index|]
decl_stmt|;
name|dev_t
name|dev
decl_stmt|;
block|}
name|devl
index|[
literal|256
index|]
struct|;
end_struct

begin_decl_stmt
name|char
modifier|*
name|coref
decl_stmt|,
modifier|*
name|memf
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|ap
decl_stmt|;
name|int
name|uid
decl_stmt|,
name|puid
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|ap
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
while|while
condition|(
operator|*
name|ap
condition|)
switch|switch
condition|(
operator|*
name|ap
operator|++
condition|)
block|{
case|case
literal|'a'
case|:
name|aflg
operator|++
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
if|if
condition|(
operator|*
name|ap
condition|)
name|tptr
operator|=
name|ap
expr_stmt|;
name|aflg
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|tptr
operator|==
literal|'?'
condition|)
name|xflg
operator|++
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
name|xflg
operator|++
expr_stmt|;
break|break;
case|case
literal|'-'
case|:
break|break;
case|case
literal|'l'
case|:
name|lflg
operator|++
expr_stmt|;
break|break;
case|case
literal|'k'
case|:
name|kflg
operator|++
expr_stmt|;
break|break;
default|default:
name|chkpid
operator|=
name|atoi
argument_list|(
operator|--
name|ap
argument_list|)
expr_stmt|;
operator|*
name|ap
operator|=
literal|'\0'
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|chdir
argument_list|(
literal|"/dev"
argument_list|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't change to /dev\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|nlist
argument_list|(
name|argc
operator|>
literal|2
condition|?
name|argv
index|[
literal|2
index|]
else|:
literal|"/unix"
argument_list|,
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|nl
index|[
literal|0
index|]
operator|.
name|n_type
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"No namelist\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|coref
operator|=
literal|"/dev/kmem"
expr_stmt|;
name|memf
operator|=
literal|"/dev/mem"
expr_stmt|;
if|if
condition|(
name|kflg
condition|)
block|{
name|coref
operator|=
literal|"/usr/sys/core"
expr_stmt|;
name|memf
operator|=
name|coref
expr_stmt|;
name|nl
index|[
literal|0
index|]
operator|.
name|n_value
operator|=
operator|(
name|char
operator|*
operator|)
operator|(
operator|(
name|int
operator|)
name|nl
index|[
literal|0
index|]
operator|.
name|n_value
operator|&
literal|0x7fffffff
operator|)
expr_stmt|;
name|nl
index|[
literal|1
index|]
operator|.
name|n_value
operator|=
operator|(
name|char
operator|*
operator|)
operator|(
operator|(
name|int
operator|)
name|nl
index|[
literal|1
index|]
operator|.
name|n_value
operator|&
literal|0x7fffffff
operator|)
expr_stmt|;
name|nl
index|[
literal|2
index|]
operator|.
name|n_value
operator|=
operator|(
name|char
operator|*
operator|)
operator|(
operator|(
name|int
operator|)
name|nl
index|[
literal|2
index|]
operator|.
name|n_value
operator|&
literal|0x7fffffff
operator|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|mem
operator|=
name|open
argument_list|(
name|coref
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"No kmem\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|swmem
operator|=
name|open
argument_list|(
name|memf
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"No mem\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * read mem to find swap dev. 	 */
name|lseek
argument_list|(
name|mem
argument_list|,
operator|(
name|long
operator|)
name|nl
index|[
literal|1
index|]
operator|.
name|n_value
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|mem
argument_list|,
operator|&
name|nl
index|[
literal|1
index|]
operator|.
name|n_value
argument_list|,
sizeof|sizeof
argument_list|(
name|nl
index|[
literal|1
index|]
operator|.
name|n_value
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Find base of swap 	 */
name|lseek
argument_list|(
name|mem
argument_list|,
operator|(
name|long
operator|)
name|nl
index|[
literal|2
index|]
operator|.
name|n_value
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|read
argument_list|(
name|mem
argument_list|,
operator|&
name|swplo
argument_list|,
sizeof|sizeof
argument_list|(
name|swplo
argument_list|)
argument_list|)
expr_stmt|;
comment|/* 	 * Locate proc table 	 */
name|lseek
argument_list|(
name|mem
argument_list|,
operator|(
name|long
operator|)
name|nl
index|[
literal|0
index|]
operator|.
name|n_value
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|getdev
argument_list|()
expr_stmt|;
name|uid
operator|=
name|getuid
argument_list|()
expr_stmt|;
if|if
condition|(
name|lflg
condition|)
name|printf
argument_list|(
literal|"  F S UID   PID  PPID CPU PRI NICE   ADDR   SZ   WCHAN  TTY TIME COMMAND\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|chkpid
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"   PID TTY TIME COMMAND\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NPROC
condition|;
name|i
operator|++
control|)
block|{
name|read
argument_list|(
name|mem
argument_list|,
operator|&
name|mproc
argument_list|,
sizeof|sizeof
name|mproc
argument_list|)
expr_stmt|;
if|if
condition|(
name|mproc
operator|.
name|p_stat
operator|==
literal|0
condition|)
continue|continue;
if|if
condition|(
name|mproc
operator|.
name|p_pgrp
operator|==
literal|0
operator|&&
name|xflg
operator|==
literal|0
operator|&&
name|mproc
operator|.
name|p_uid
operator|==
literal|0
condition|)
continue|continue;
name|puid
operator|=
name|mproc
operator|.
name|p_uid
expr_stmt|;
if|if
condition|(
operator|(
name|uid
operator|!=
name|puid
operator|&&
name|aflg
operator|==
literal|0
operator|)
operator|||
operator|(
name|chkpid
operator|!=
literal|0
operator|&&
name|chkpid
operator|!=
name|mproc
operator|.
name|p_pid
operator|)
condition|)
continue|continue;
if|if
condition|(
name|prcom
argument_list|(
name|puid
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|retcode
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|done
argument_list|(
name|retcode
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|getdev
argument_list|()
end_macro

begin_block
block|{
include|#
directive|include
file|<sys/stat.h>
specifier|register
name|FILE
modifier|*
name|df
decl_stmt|;
name|struct
name|stat
name|sbuf
decl_stmt|;
name|struct
name|direct
name|dbuf
decl_stmt|;
if|if
condition|(
operator|(
name|df
operator|=
name|fopen
argument_list|(
literal|"/dev"
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't open /dev\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|ndev
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|fread
argument_list|(
operator|&
name|dbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|dbuf
argument_list|)
argument_list|,
literal|1
argument_list|,
name|df
argument_list|)
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|dbuf
operator|.
name|d_ino
operator|==
literal|0
condition|)
continue|continue;
if|if
condition|(
name|stat
argument_list|(
name|dbuf
operator|.
name|d_name
argument_list|,
operator|&
name|sbuf
argument_list|)
operator|<
literal|0
condition|)
continue|continue;
if|if
condition|(
operator|(
name|sbuf
operator|.
name|st_mode
operator|&
name|S_IFMT
operator|)
operator|!=
name|S_IFCHR
condition|)
continue|continue;
name|strcpy
argument_list|(
name|devl
index|[
name|ndev
index|]
operator|.
name|dname
argument_list|,
name|dbuf
operator|.
name|d_name
argument_list|)
expr_stmt|;
name|devl
index|[
name|ndev
index|]
operator|.
name|dev
operator|=
name|sbuf
operator|.
name|st_rdev
expr_stmt|;
name|ndev
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|df
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|swap
operator|=
name|open
argument_list|(
literal|"/dev/swap"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't open /dev/swap\n"
argument_list|)
expr_stmt|;
name|done
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|prcom
argument_list|(
argument|puid
argument_list|)
end_macro

begin_block
block|{
name|int
name|abuf
index|[
literal|128
index|]
decl_stmt|;
name|long
name|addr
decl_stmt|;
name|int
name|mf
decl_stmt|;
specifier|register
name|int
modifier|*
name|ip
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|cp1
decl_stmt|;
name|long
name|tm
decl_stmt|;
name|int
name|c
decl_stmt|,
name|nbad
decl_stmt|;
specifier|register
name|char
modifier|*
name|tp
decl_stmt|;
if|if
condition|(
operator|(
name|mproc
operator|.
name|p_flag
operator|&
operator|(
name|SLOAD
operator||
name|SSPART
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|addr
operator|=
operator|(
name|mproc
operator|.
name|p_swaddr
operator|+
name|swplo
operator|)
operator|<<
literal|9
expr_stmt|;
name|mf
operator|=
name|swap
expr_stmt|;
name|lseek
argument_list|(
name|mf
argument_list|,
name|addr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|mf
argument_list|,
operator|&
name|u
argument_list|,
sizeof|sizeof
argument_list|(
name|u
argument_list|)
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|u
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
block|{
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|UPAGES
condition|;
name|c
operator|++
control|)
block|{
name|lseek
argument_list|(
name|swmem
argument_list|,
name|mproc
operator|.
name|p_addr
index|[
name|c
index|]
operator|<<
literal|9
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|swmem
argument_list|,
operator|(
operator|(
name|int
operator|*
operator|)
operator|&
name|u
operator|)
operator|+
literal|128
operator|*
name|c
argument_list|,
literal|512
argument_list|)
operator|!=
literal|512
condition|)
comment|/* get u page */
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
name|tp
operator|=
name|gettty
argument_list|()
expr_stmt|;
if|if
condition|(
name|tptr
operator|&&
name|strcmpn
argument_list|(
name|tptr
argument_list|,
name|tp
argument_list|,
literal|2
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|lflg
condition|)
block|{
name|printf
argument_list|(
literal|"%3o %c%4d"
argument_list|,
literal|0377
operator|&
name|mproc
operator|.
name|p_flag
argument_list|,
literal|"0SWRIZT"
index|[
name|mproc
operator|.
name|p_stat
index|]
argument_list|,
name|puid
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%6u"
argument_list|,
name|mproc
operator|.
name|p_pid
argument_list|)
expr_stmt|;
if|if
condition|(
name|lflg
condition|)
block|{
name|printf
argument_list|(
literal|"%6u%4d%4d%5d%8x%4d"
argument_list|,
name|mproc
operator|.
name|p_ppid
argument_list|,
name|mproc
operator|.
name|p_cpu
operator|&
literal|0377
argument_list|,
name|mproc
operator|.
name|p_pri
argument_list|,
name|mproc
operator|.
name|p_nice
argument_list|,
name|mproc
operator|.
name|p_addr
index|[
literal|0
index|]
argument_list|,
name|mproc
operator|.
name|p_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|mproc
operator|.
name|p_wchan
condition|)
name|printf
argument_list|(
literal|"%9x"
argument_list|,
name|mproc
operator|.
name|p_wchan
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"         "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|" %-2.2s"
argument_list|,
name|tp
argument_list|)
expr_stmt|;
if|if
condition|(
name|mproc
operator|.
name|p_stat
operator|==
name|SZOMB
condition|)
block|{
name|printf
argument_list|(
literal|"<defunct>"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|tm
operator|=
operator|(
name|u
operator|.
name|u_utime
operator|+
name|u
operator|.
name|u_stime
operator|+
literal|30
operator|)
operator|/
literal|60
expr_stmt|;
name|printf
argument_list|(
literal|" %2ld:"
argument_list|,
name|tm
operator|/
literal|60
argument_list|)
expr_stmt|;
name|tm
operator|%=
literal|60
expr_stmt|;
name|printf
argument_list|(
name|tm
operator|<
literal|10
condition|?
literal|"0%ld"
else|:
literal|"%ld"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|&&
name|lflg
operator|==
literal|0
condition|)
block|{
comment|/* 0 == old tflg (print long times) */
name|tm
operator|=
operator|(
name|u
operator|.
name|u_cstime
operator|+
literal|30
operator|)
operator|/
literal|60
expr_stmt|;
name|printf
argument_list|(
literal|" %2ld:"
argument_list|,
name|tm
operator|/
literal|60
argument_list|)
expr_stmt|;
name|tm
operator|%=
literal|60
expr_stmt|;
name|printf
argument_list|(
name|tm
operator|<
literal|10
condition|?
literal|"0%ld"
else|:
literal|"%ld"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|tm
operator|=
operator|(
name|u
operator|.
name|u_cutime
operator|+
literal|30
operator|)
operator|/
literal|60
expr_stmt|;
name|printf
argument_list|(
literal|" %2ld:"
argument_list|,
name|tm
operator|/
literal|60
argument_list|)
expr_stmt|;
name|tm
operator|%=
literal|60
expr_stmt|;
name|printf
argument_list|(
name|tm
operator|<
literal|10
condition|?
literal|"0%ld"
else|:
literal|"%ld"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mproc
operator|.
name|p_pid
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|" swapper"
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|c
operator|=
name|mproc
operator|.
name|p_size
operator|-
name|btoc
argument_list|(
literal|512
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|mproc
operator|.
name|p_flag
operator|&
name|SLOAD
operator|)
operator|==
literal|0
condition|)
block|{
name|addr
operator|+=
name|ctob
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|mf
argument_list|,
name|addr
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|mf
argument_list|,
name|abuf
argument_list|,
sizeof|sizeof
argument_list|(
name|abuf
argument_list|)
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|abuf
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
else|else
block|{
if|if
condition|(
name|u
operator|.
name|u_pcb
operator|.
name|pcb_szpt
operator|<
literal|1
operator|||
name|u
operator|.
name|u_pcb
operator|.
name|pcb_szpt
operator|>
literal|20
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|c
operator|=
name|ctob
argument_list|(
operator|(
name|u
operator|.
name|u_ptable
index|[
name|u
operator|.
name|u_pcb
operator|.
name|pcb_szpt
operator|-
literal|1
index|]
operator|&
literal|0x1fffff
operator|)
argument_list|)
expr_stmt|;
name|lseek
argument_list|(
name|swmem
argument_list|,
name|c
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|swmem
argument_list|,
name|pagetbl
argument_list|,
literal|512
argument_list|)
operator|!=
literal|512
condition|)
comment|/* get last page table */
return|return
operator|(
literal|1
operator|)
return|;
name|lseek
argument_list|(
name|swmem
argument_list|,
name|ctob
argument_list|(
operator|(
name|pagetbl
index|[
literal|127
index|]
operator|&
literal|0x1fffff
operator|)
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|read
argument_list|(
name|swmem
argument_list|,
name|abuf
argument_list|,
sizeof|sizeof
argument_list|(
name|abuf
argument_list|)
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|abuf
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|abuf
index|[
literal|128
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|ip
operator|=
operator|&
name|abuf
index|[
literal|126
index|]
init|;
name|ip
operator|>
name|abuf
condition|;
control|)
block|{
if|if
condition|(
operator|*
operator|--
name|ip
operator|==
operator|-
literal|1
operator|||
operator|*
name|ip
operator|==
literal|0
condition|)
block|{
name|cp
operator|=
operator|(
name|char
operator|*
operator|)
operator|(
name|ip
operator|+
literal|1
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|0
condition|)
name|cp
operator|++
expr_stmt|;
name|nbad
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|cp1
operator|=
name|cp
init|;
name|cp1
operator|<
operator|(
name|char
operator|*
operator|)
operator|&
name|abuf
index|[
literal|128
index|]
condition|;
name|cp1
operator|++
control|)
block|{
name|c
operator|=
operator|*
name|cp1
operator|&
literal|0177
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|0
condition|)
operator|*
name|cp1
operator|=
literal|' '
expr_stmt|;
elseif|else
if|if
condition|(
name|c
operator|<
literal|' '
operator|||
name|c
operator|>
literal|0176
condition|)
block|{
if|if
condition|(
operator|++
name|nbad
operator|>=
literal|5
condition|)
block|{
operator|*
name|cp1
operator|++
operator|=
literal|' '
expr_stmt|;
break|break;
block|}
operator|*
name|cp1
operator|=
literal|'?'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|'='
condition|)
block|{
operator|*
name|cp1
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|cp1
operator|>
name|cp
operator|&&
operator|*
operator|--
name|cp1
operator|!=
literal|' '
condition|)
operator|*
name|cp1
operator|=
literal|0
expr_stmt|;
break|break;
block|}
block|}
while|while
condition|(
operator|*
operator|--
name|cp1
operator|==
literal|' '
condition|)
operator|*
name|cp1
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
name|lflg
condition|?
literal|" %.30s"
else|:
literal|" %.60s"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_function
name|char
modifier|*
name|gettty
parameter_list|()
block|{
specifier|register
name|i
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|u
operator|.
name|u_ttyp
operator|==
literal|0
condition|)
return|return
operator|(
literal|"?"
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ndev
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|devl
index|[
name|i
index|]
operator|.
name|dev
operator|==
name|u
operator|.
name|u_ttyd
condition|)
block|{
name|p
operator|=
name|devl
index|[
name|i
index|]
operator|.
name|dname
expr_stmt|;
if|if
condition|(
name|p
index|[
literal|0
index|]
operator|==
literal|'t'
operator|&&
name|p
index|[
literal|1
index|]
operator|==
literal|'t'
operator|&&
name|p
index|[
literal|2
index|]
operator|==
literal|'y'
condition|)
name|p
operator|+=
literal|3
expr_stmt|;
return|return
operator|(
name|p
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|"?"
operator|)
return|;
block|}
end_function

begin_macro
name|done
argument_list|(
argument|exitno
argument_list|)
end_macro

begin_block
block|{
name|exit
argument_list|(
name|exitno
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

