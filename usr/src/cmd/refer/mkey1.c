begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"stdio.h"
end_include

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|comname
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* "/usr/lib/eign" */
end_comment

begin_decl_stmt
name|int
name|wholefile
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|keycount
init|=
literal|100
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|labels
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|minlen
init|=
literal|3
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|comcount
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|iglist
init|=
literal|"XYZ"
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
comment|/* this program expects as its arguments a list of    files and generates a set of lines of the form      filename:byte-add,length (tab) key1 key2 key3    where the byte addresses give the position within    the file and the keys are the strings off the lines    which are alphabetic, first six characters only. */
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|,
name|qn
index|[
literal|200
index|]
decl_stmt|;
name|char
modifier|*
name|inlist
init|=
literal|0
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|,
modifier|*
name|ff
decl_stmt|;
while|while
condition|(
name|argc
operator|>
literal|1
operator|&&
name|argv
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|==
literal|'-'
condition|)
block|{
switch|switch
condition|(
name|argv
index|[
literal|1
index|]
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'c'
case|:
name|comname
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
name|wholefile
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
name|inlist
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
break|break;
case|case
literal|'i'
case|:
name|iglist
operator|=
name|argv
index|[
literal|2
index|]
expr_stmt|;
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|minlen
operator|=
name|atoi
argument_list|(
name|argv
index|[
literal|1
index|]
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|minlen
operator|<=
literal|0
condition|)
name|minlen
operator|=
literal|3
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
comment|/* number of common words to use */
name|comcount
operator|=
name|atoi
argument_list|(
name|argv
index|[
literal|1
index|]
operator|+
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'k'
case|:
comment|/* number  of keys per file max */
name|keycount
operator|=
name|atoi
argument_list|(
name|argv
index|[
literal|1
index|]
operator|+
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
comment|/* suppress labels, search only */
name|labels
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|argc
operator|--
expr_stmt|;
name|argv
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|inlist
condition|)
block|{
name|ff
operator|=
name|fopen
argument_list|(
name|inlist
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|qn
argument_list|,
literal|200
argument_list|,
name|ff
argument_list|)
condition|)
block|{
name|trimnl
argument_list|(
name|qn
argument_list|)
expr_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|qn
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|!=
name|NULL
condition|)
name|dofile
argument_list|(
name|f
argument_list|,
name|qn
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Can't read %s\n"
argument_list|,
name|qn
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|argc
operator|<=
literal|1
condition|)
name|dofile
argument_list|(
name|stdin
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|else
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
block|{
name|f
operator|=
name|fopen
argument_list|(
name|name
operator|=
name|argv
index|[
name|i
index|]
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|"No file %s"
argument_list|,
name|name
argument_list|)
expr_stmt|;
else|else
name|dofile
argument_list|(
name|f
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

