begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	ttyinit.c	4.1	83/03/09	*/
end_comment

begin_comment
comment|/*  * sgtty stuff  */
end_comment

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_decl_stmt
name|struct
name|sgttyb
name|_ttyb
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|tchars
name|_otch
decl_stmt|,
name|_ntch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|_normf
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Routines for dealing with the unix tty modes  */
end_comment

begin_include
include|#
directive|include
file|"2648.h"
end_include

begin_macro
name|ttyinit
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|getenv
argument_list|(
literal|"TERM"
argument_list|)
argument_list|,
literal|"hp2648"
argument_list|)
operator|==
literal|0
condition|)
name|_on2648
operator|=
literal|1
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCGETP
argument_list|,
operator|&
name|_ttyb
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCGETC
argument_list|,
operator|&
name|_otch
argument_list|)
expr_stmt|;
name|_ntch
operator|=
name|_otch
expr_stmt|;
name|_ntch
operator|.
name|t_quitc
operator|=
name|_ntch
operator|.
name|t_startc
operator|=
name|_ntch
operator|.
name|t_stopc
operator|=
operator|-
literal|1
expr_stmt|;
name|_normf
operator|=
name|_ttyb
operator|.
name|sg_flags
expr_stmt|;
name|_ttyb
operator|.
name|sg_flags
operator||=
name|CBREAK
expr_stmt|;
name|_ttyb
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|ECHO
operator||
name|CRMOD
operator|)
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|_ttyb
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|_ntch
argument_list|)
expr_stmt|;
name|gdefault
argument_list|()
expr_stmt|;
name|zoomn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|zoomon
argument_list|()
expr_stmt|;
name|kon
argument_list|()
expr_stmt|;
name|rboff
argument_list|()
expr_stmt|;
name|_cursoron
operator|=
literal|1
expr_stmt|;
comment|/* to force it off */
name|_escmode
operator|=
name|NONE
expr_stmt|;
name|curoff
argument_list|()
expr_stmt|;
name|clearg
argument_list|()
expr_stmt|;
name|gon
argument_list|()
expr_stmt|;
name|aoff
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|done
argument_list|()
end_macro

begin_block
block|{
name|goff
argument_list|()
expr_stmt|;
name|koff
argument_list|()
expr_stmt|;
name|aon
argument_list|()
expr_stmt|;
name|sync
argument_list|()
expr_stmt|;
name|escseq
argument_list|(
name|NONE
argument_list|)
expr_stmt|;
name|lowleft
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|_ttyb
operator|.
name|sg_flags
operator|=
name|_normf
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|_ttyb
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|_otch
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

