begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) 1982 Regents of the University of California */
end_comment

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)lists.c	1.4 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$Header: lists.c,v 1.5 84/12/26 10:40:00 linton Exp $"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * General list definitions.  *  * The assumption is that the elements in a list are words,  * usually pointers to the actual information.  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"lists.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|public
end_ifndef

begin_typedef
typedef|typedef
name|struct
name|List
modifier|*
name|List
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|struct
name|ListItem
modifier|*
name|ListItem
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|char
modifier|*
name|ListElement
typedef|;
end_typedef

begin_define
define|#
directive|define
name|list_item
parameter_list|(
name|element
parameter_list|)
value|generic_list_item((ListElement) (element))
end_define

begin_define
define|#
directive|define
name|list_element
parameter_list|(
name|type
parameter_list|,
name|item
parameter_list|)
value|((type) (item == nil ? nil : (item)->element))
end_define

begin_define
define|#
directive|define
name|list_head
parameter_list|(
name|list
parameter_list|)
value|((list == nil) ? nil : (list)->head)
end_define

begin_define
define|#
directive|define
name|list_tail
parameter_list|(
name|list
parameter_list|)
value|((list == nil) ? nil : (list)->tail)
end_define

begin_define
define|#
directive|define
name|list_next
parameter_list|(
name|item
parameter_list|)
value|((item == nil) ? nil : (item)->next)
end_define

begin_define
define|#
directive|define
name|list_prev
parameter_list|(
name|item
parameter_list|)
value|((item == nil) ? nil : (item)->prev)
end_define

begin_define
define|#
directive|define
name|list_size
parameter_list|(
name|list
parameter_list|)
value|(((list) == nil) ? 0 : (list)->nitems)
end_define

begin_define
define|#
directive|define
name|foreach
parameter_list|(
name|type
parameter_list|,
name|i
parameter_list|,
name|list
parameter_list|)
define|\
value|{ \     register ListItem _item; \  \     _item = list_head(list); \     while (_item != nil) { \ 	i = list_element(type, _item); \ 	_item = list_next(_item);
end_define

begin_define
define|#
directive|define
name|endfor
define|\
value|} \ }
end_define

begin_comment
comment|/*  * Iterate through two equal-sized lists.  */
end_comment

begin_define
define|#
directive|define
name|foreach2
parameter_list|(
name|type1
parameter_list|,
name|i
parameter_list|,
name|list1
parameter_list|,
name|type2
parameter_list|,
name|j
parameter_list|,
name|list2
parameter_list|)
define|\
value|{ \     register ListItem _item1, _item2; \  \     _item1 = list_head(list1); \     _item2 = list_head(list2); \     while (_item1 != nil) { \ 	i = list_element(type1, _item1); \ 	j = list_element(type2, _item2); \ 	_item1 = list_next(_item1); \ 	_item2 = list_next(_item2);
end_define

begin_define
define|#
directive|define
name|list_islast
parameter_list|()
value|(_item == nil)
end_define

begin_define
define|#
directive|define
name|list_curitem
parameter_list|(
name|list
parameter_list|)
value|(_item == nil ? list_tail(list) : list_prev(_item))
end_define

begin_comment
comment|/*  * Representation should not be used outside except through macros.  */
end_comment

begin_struct
struct|struct
name|List
block|{
name|Integer
name|nitems
decl_stmt|;
name|ListItem
name|head
decl_stmt|;
name|ListItem
name|tail
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|ListItem
block|{
name|ListElement
name|element
decl_stmt|;
name|ListItem
name|next
decl_stmt|;
name|ListItem
name|prev
decl_stmt|;
block|}
struct|;
end_struct

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Allocate and initialize a list.  */
end_comment

begin_function
name|public
name|List
name|list_alloc
parameter_list|()
block|{
name|List
name|list
decl_stmt|;
name|list
operator|=
name|new
argument_list|(
name|List
argument_list|)
expr_stmt|;
name|list
operator|->
name|nitems
operator|=
literal|0
expr_stmt|;
name|list
operator|->
name|head
operator|=
name|nil
expr_stmt|;
name|list
operator|->
name|tail
operator|=
name|nil
expr_stmt|;
return|return
name|list
return|;
block|}
end_function

begin_comment
comment|/*  * Create a list item from an object (represented as pointer or integer).  */
end_comment

begin_function
name|public
name|ListItem
name|generic_list_item
parameter_list|(
name|element
parameter_list|)
name|ListElement
name|element
decl_stmt|;
block|{
name|ListItem
name|i
decl_stmt|;
name|i
operator|=
name|new
argument_list|(
name|ListItem
argument_list|)
expr_stmt|;
name|i
operator|->
name|element
operator|=
name|element
expr_stmt|;
name|i
operator|->
name|next
operator|=
name|nil
expr_stmt|;
name|i
operator|->
name|prev
operator|=
name|nil
expr_stmt|;
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/*  * Insert an item before the item in a list.  */
end_comment

begin_function
name|public
name|list_insert
parameter_list|(
name|item
parameter_list|,
name|after
parameter_list|,
name|list
parameter_list|)
name|ListItem
name|item
decl_stmt|;
name|ListItem
name|after
decl_stmt|;
name|List
name|list
decl_stmt|;
block|{
name|ListItem
name|a
decl_stmt|;
name|checkref
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|list
operator|->
name|nitems
operator|=
name|list
operator|->
name|nitems
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|list
operator|->
name|head
operator|==
name|nil
condition|)
block|{
name|list
operator|->
name|head
operator|=
name|item
expr_stmt|;
name|list
operator|->
name|tail
operator|=
name|item
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|after
operator|==
name|nil
condition|)
block|{
name|a
operator|=
name|list
operator|->
name|head
expr_stmt|;
block|}
else|else
block|{
name|a
operator|=
name|after
expr_stmt|;
block|}
name|item
operator|->
name|next
operator|=
name|a
expr_stmt|;
name|item
operator|->
name|prev
operator|=
name|a
operator|->
name|prev
expr_stmt|;
if|if
condition|(
name|a
operator|->
name|prev
operator|!=
name|nil
condition|)
block|{
name|a
operator|->
name|prev
operator|->
name|next
operator|=
name|item
expr_stmt|;
block|}
else|else
block|{
name|list
operator|->
name|head
operator|=
name|item
expr_stmt|;
block|}
name|a
operator|->
name|prev
operator|=
name|item
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Append an item after the given item in a list.  */
end_comment

begin_function
name|public
name|list_append
parameter_list|(
name|item
parameter_list|,
name|before
parameter_list|,
name|list
parameter_list|)
name|ListItem
name|item
decl_stmt|;
name|ListItem
name|before
decl_stmt|;
name|List
name|list
decl_stmt|;
block|{
name|ListItem
name|b
decl_stmt|;
name|checkref
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|list
operator|->
name|nitems
operator|=
name|list
operator|->
name|nitems
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|list
operator|->
name|head
operator|==
name|nil
condition|)
block|{
name|list
operator|->
name|head
operator|=
name|item
expr_stmt|;
name|list
operator|->
name|tail
operator|=
name|item
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|before
operator|==
name|nil
condition|)
block|{
name|b
operator|=
name|list
operator|->
name|tail
expr_stmt|;
block|}
else|else
block|{
name|b
operator|=
name|before
expr_stmt|;
block|}
name|item
operator|->
name|next
operator|=
name|b
operator|->
name|next
expr_stmt|;
name|item
operator|->
name|prev
operator|=
name|b
expr_stmt|;
if|if
condition|(
name|b
operator|->
name|next
operator|!=
name|nil
condition|)
block|{
name|b
operator|->
name|next
operator|->
name|prev
operator|=
name|item
expr_stmt|;
block|}
else|else
block|{
name|list
operator|->
name|tail
operator|=
name|item
expr_stmt|;
block|}
name|b
operator|->
name|next
operator|=
name|item
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Delete an item from a list.  */
end_comment

begin_function
name|public
name|list_delete
parameter_list|(
name|item
parameter_list|,
name|list
parameter_list|)
name|ListItem
name|item
decl_stmt|;
name|List
name|list
decl_stmt|;
block|{
name|checkref
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|checkref
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|list
operator|->
name|nitems
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
operator|->
name|next
operator|==
name|nil
condition|)
block|{
name|list
operator|->
name|tail
operator|=
name|item
operator|->
name|prev
expr_stmt|;
block|}
else|else
block|{
name|item
operator|->
name|next
operator|->
name|prev
operator|=
name|item
operator|->
name|prev
expr_stmt|;
block|}
if|if
condition|(
name|item
operator|->
name|prev
operator|==
name|nil
condition|)
block|{
name|list
operator|->
name|head
operator|=
name|item
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|item
operator|->
name|prev
operator|->
name|next
operator|=
name|item
operator|->
name|next
expr_stmt|;
block|}
name|list
operator|->
name|nitems
operator|=
name|list
operator|->
name|nitems
operator|-
literal|1
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Concatenate one list onto the end of another.  */
end_comment

begin_function
name|public
name|List
name|list_concat
parameter_list|(
name|first
parameter_list|,
name|second
parameter_list|)
name|List
name|first
decl_stmt|,
name|second
decl_stmt|;
block|{
name|List
name|r
decl_stmt|;
if|if
condition|(
name|first
operator|==
name|nil
condition|)
block|{
name|r
operator|=
name|second
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|second
operator|==
name|nil
condition|)
block|{
name|r
operator|=
name|first
expr_stmt|;
block|}
else|else
block|{
name|second
operator|->
name|head
operator|->
name|prev
operator|=
name|first
operator|->
name|tail
expr_stmt|;
name|first
operator|->
name|tail
operator|->
name|next
operator|=
name|second
operator|->
name|head
expr_stmt|;
name|first
operator|->
name|tail
operator|=
name|second
operator|->
name|tail
expr_stmt|;
name|first
operator|->
name|nitems
operator|=
name|first
operator|->
name|nitems
operator|+
name|second
operator|->
name|nitems
expr_stmt|;
name|r
operator|=
name|first
expr_stmt|;
block|}
return|return
name|r
return|;
block|}
end_function

end_unit

