begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)docomm.c 4.2 8/17/82"
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|"head.h"
end_include

begin_include
include|#
directive|include
file|<a.out.h>
end_include

begin_include
include|#
directive|include
file|<stab.h>
end_include

begin_decl_stmt
name|struct
name|user
name|u
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|L_INT
name|cntval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|INT
name|signo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|INT
name|adrflg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|INT
name|pid
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|ADDR
name|userpc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_enum
enum|enum
block|{
name|NOCOM
block|,
name|PRCOM
block|,
name|DSCOM
block|,
name|DSICOM
block|}
name|lastcom
enum|;
end_enum

begin_comment
comment|/* last command: nothing noteworthy, print source, 			display variable, display instruction */
end_comment

begin_macro
name|docommand
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|ADDR
name|addr
decl_stmt|,
name|bkaddr
decl_stmt|;
name|struct
name|proct
modifier|*
name|procp
decl_stmt|;
name|char
name|s
index|[
literal|4
index|]
decl_stmt|;
name|cntval
operator|=
literal|1
expr_stmt|;
name|adrflg
operator|=
literal|0
expr_stmt|;
name|errflg
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|scallf
condition|)
block|{
name|doscall
argument_list|()
expr_stmt|;
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|reflag
condition|)
block|{
comment|/* search for regular expression */
name|dore
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|cmd
operator|==
literal|'\0'
condition|)
block|{
if|if
condition|(
name|integ
operator|!=
literal|0
operator|&&
name|var
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|error
argument_list|(
literal|"Invalid command (1)"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|integ
operator|!=
literal|0
condition|)
block|{
comment|/* print line number */
name|ffind
argument_list|(
name|integ
argument_list|)
expr_stmt|;
name|fprint
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|var
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Unexpected null command\n"
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
switch|switch
condition|(
name|cmd
condition|)
block|{
case|case
literal|'Y'
case|:
name|debug
operator|=
operator|!
name|debug
expr_stmt|;
break|break;
case|case
literal|'V'
case|:
name|version
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
if|if
condition|(
name|args
index|[
literal|0
index|]
condition|)
block|{
name|setmap
argument_list|(
name|args
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printmap
argument_list|(
literal|"? map"
argument_list|,
operator|&
name|txtmap
argument_list|)
expr_stmt|;
name|printmap
argument_list|(
literal|"/ map"
argument_list|,
operator|&
name|datmap
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'x'
case|:
name|printregs
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'X'
case|:
name|printpc
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'a'
case|:
if|if
condition|(
name|integ
condition|)
block|{
name|cpstr
argument_list|(
name|args
argument_list|,
literal|"l\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|proc
index|[
literal|0
index|]
condition|)
block|{
name|cpall
argument_list|(
name|args
argument_list|,
literal|"T\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|error
argument_list|(
literal|"Bad arguments"
argument_list|)
expr_stmt|;
break|break;
block|}
goto|goto
name|setbrk
goto|;
break|break;
case|case
literal|'l'
case|:
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|prfrx
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|prframe
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'e'
case|:
name|p
operator|=
name|args
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|==
literal|'\0'
condition|)
block|{
ifndef|#
directive|ifndef
name|FLEXNAMES
name|printf
argument_list|(
literal|"%.16s() in \"%s\"\n"
argument_list|,
name|curproc
argument_list|()
operator|->
name|pname
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"%s() in \"%s\"\n"
argument_list|,
name|curproc
argument_list|()
operator|->
name|pname
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
block|}
while|while
condition|(
operator|*
name|p
operator|!=
literal|'\0'
condition|)
if|if
condition|(
operator|*
name|p
operator|++
operator|==
literal|'.'
condition|)
goto|goto
name|l1
goto|;
comment|/* argument is procedure name */
name|procp
operator|=
name|findproc
argument_list|(
name|args
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|procp
operator|->
name|pname
index|[
literal|0
index|]
operator|!=
literal|'\0'
operator|)
operator|&&
operator|(
name|procp
operator|->
name|sfptr
operator|!=
name|badfile
operator|)
condition|)
block|{
name|finit
argument_list|(
name|adrtofilep
argument_list|(
name|procp
operator|->
name|paddr
argument_list|)
operator|->
name|sfilename
argument_list|)
expr_stmt|;
name|ffind
argument_list|(
name|procp
operator|->
name|lineno
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"Can't find %s\n"
argument_list|,
name|args
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|FLEXNAMES
name|printf
argument_list|(
literal|"%.16s() in \"%s\"\n"
argument_list|,
name|curproc
argument_list|()
operator|->
name|pname
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"%s() in \"%s\"\n"
argument_list|,
name|curproc
argument_list|()
operator|->
name|pname
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
name|l1
label|:
comment|/* argument is filename */
name|finit
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\"%s\"\n"
argument_list|,
name|curfile
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
if|if
condition|(
name|integ
condition|)
name|ffind
argument_list|(
name|integ
argument_list|)
expr_stmt|;
name|fprint
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'q'
case|:
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
case|case
literal|'w'
case|:
if|if
condition|(
name|integ
condition|)
name|ffind
argument_list|(
name|integ
argument_list|)
expr_stmt|;
name|i
operator|=
name|fline
expr_stmt|;
name|fback
argument_list|(
name|WINDOW
operator|/
literal|2
argument_list|)
expr_stmt|;
name|fprintn
argument_list|(
name|WINDOW
argument_list|)
expr_stmt|;
name|ffind
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'Q'
case|:
name|prdebug
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'z'
case|:
if|if
condition|(
name|integ
condition|)
name|ffind
argument_list|(
name|integ
argument_list|)
expr_stmt|;
name|fprintn
argument_list|(
name|WINDOW
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'-'
case|:
name|fback
argument_list|(
name|integ
condition|?
name|integ
else|:
literal|1
argument_list|)
expr_stmt|;
name|fpargs
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'+'
case|:
name|fforward
argument_list|(
name|integ
condition|?
name|integ
else|:
literal|1
argument_list|)
expr_stmt|;
name|fpargs
argument_list|()
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
literal|'\n'
case|:
switch|switch
condition|(
name|lastcom
condition|)
block|{
case|case
name|PRCOM
case|:
name|fforward
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|fprint
argument_list|()
expr_stmt|;
break|break;
case|case
name|DSCOM
case|:
name|oaddr
operator|+=
name|oincr
condition|?
name|oincr
else|:
name|typetosize
argument_list|(
name|otype
argument_list|,
name|WORDSIZE
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"0x%x/ "
argument_list|,
name|oaddr
argument_list|)
expr_stmt|;
name|dispf
argument_list|(
operator|(
name|ADDR
operator|)
name|oaddr
argument_list|,
name|odesc
argument_list|,
name|oclass
operator|==
name|N_RSYM
condition|?
name|oclass
else|:
name|N_GSYM
argument_list|,
name|otype
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DSP
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSICOM
case|:
name|dot
operator|+=
name|oincr
expr_stmt|;
name|prisploc
argument_list|()
expr_stmt|;
name|dispi
argument_list|(
name|dot
argument_list|,
name|odesc
argument_list|,
name|N_GSYM
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|'\004'
case|:
if|if
condition|(
operator|!
name|isatty
argument_list|(
literal|0
argument_list|)
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|lastcom
condition|)
block|{
case|case
name|PRCOM
case|:
name|fforward
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\b"
argument_list|)
expr_stmt|;
name|fprintn
argument_list|(
name|WINDOW
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|PRCOM
expr_stmt|;
break|break;
case|case
name|DSICOM
case|:
name|printf
argument_list|(
literal|"\b"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|WINDOW
condition|;
name|i
operator|++
control|)
block|{
name|dot
operator|+=
name|oincr
expr_stmt|;
name|prisploc
argument_list|()
expr_stmt|;
if|if
condition|(
name|dispi
argument_list|(
name|dot
argument_list|,
name|odesc
argument_list|,
name|N_GSYM
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|==
operator|-
literal|1
condition|)
break|break;
block|}
break|break;
case|case
name|DSCOM
case|:
name|printf
argument_list|(
literal|"\b"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|WINDOW
condition|;
name|i
operator|++
control|)
block|{
name|oaddr
operator|+=
name|oincr
condition|?
name|oincr
else|:
name|typetosize
argument_list|(
name|otype
argument_list|,
name|WORDSIZE
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"0x%x/ "
argument_list|,
name|oaddr
argument_list|)
expr_stmt|;
if|if
condition|(
name|dispf
argument_list|(
operator|(
name|ADDR
operator|)
name|oaddr
argument_list|,
name|odesc
argument_list|,
name|oclass
operator|==
name|N_RSYM
condition|?
name|oclass
else|:
name|N_GSYM
argument_list|,
name|otype
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DSP
argument_list|)
operator|==
operator|-
literal|1
condition|)
break|break;
block|}
break|break;
default|default:
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'r'
case|:
if|if
condition|(
name|args
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|getargs
argument_list|()
expr_stmt|;
case|case
literal|'R'
case|:
name|signo
operator|=
literal|0
expr_stmt|;
name|cpstr
argument_list|(
name|oldargs
argument_list|,
name|args
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
condition|)
name|error
argument_list|(
literal|"calling dopcs"
argument_list|)
expr_stmt|;
if|if
condition|(
name|integ
condition|)
name|cntval
operator|=
name|integ
expr_stmt|;
if|if
condition|(
operator|!
name|executing
condition|)
block|{
name|executing
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|integ
condition|)
name|cntval
operator|=
name|integ
expr_stmt|;
name|dopcs
argument_list|(
literal|'r'
argument_list|)
expr_stmt|;
name|executing
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|debug
condition|)
name|error
argument_list|(
literal|"exiting dopcs"
argument_list|)
expr_stmt|;
name|bkaddr
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|f1
goto|;
case|case
literal|'c'
case|:
name|signo
operator|=
literal|0
expr_stmt|;
case|case
literal|'C'
case|:
if|if
condition|(
name|proc
index|[
literal|0
index|]
operator|!=
literal|'\0'
operator|||
name|integ
operator|!=
literal|0
condition|)
block|{
name|setdot
argument_list|()
expr_stmt|;
if|if
condition|(
name|dot
operator|==
operator|-
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"Cannot set temporary breakpoint"
argument_list|)
expr_stmt|;
break|break;
block|}
name|dopcs
argument_list|(
literal|'b'
argument_list|)
expr_stmt|;
name|bkaddr
operator|=
name|dot
expr_stmt|;
block|}
else|else
name|bkaddr
operator|=
operator|-
literal|1
expr_stmt|;
name|integ
operator|=
name|atoi
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|f1
label|:
if|if
condition|(
name|debug
condition|)
name|error
argument_list|(
literal|"calling dopcs"
argument_list|)
expr_stmt|;
if|if
condition|(
name|integ
condition|)
name|cntval
operator|=
name|integ
expr_stmt|;
name|dopcs
argument_list|(
literal|'c'
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
condition|)
name|error
argument_list|(
literal|"exiting dopcs"
argument_list|)
expr_stmt|;
if|if
condition|(
name|bkaddr
operator|!=
operator|-
literal|1
condition|)
block|{
name|ADDR
name|dotsave
decl_stmt|;
name|dotsave
operator|=
name|dot
expr_stmt|;
name|dot
operator|=
name|bkaddr
expr_stmt|;
name|dopcs
argument_list|(
literal|'d'
argument_list|)
expr_stmt|;
name|dot
operator|=
name|dotsave
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|signo
condition|)
name|printf
argument_list|(
literal|"Breakpoint"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" at\n"
argument_list|)
expr_stmt|;
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'S'
case|:
case|case
literal|'s'
case|:
name|signo
operator|=
literal|0
expr_stmt|;
name|integ
operator|=
name|atoi
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|singstep
argument_list|(
name|integ
condition|?
name|integ
else|:
literal|1
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
if|if
condition|(
name|signo
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'g'
case|:
if|if
condition|(
name|pid
operator|==
literal|0
operator|||
name|signo
condition|)
block|{
name|error
argument_list|(
literal|"Not stopped at breakpoint"
argument_list|)
expr_stmt|;
break|break;
block|}
name|setdot
argument_list|()
expr_stmt|;
if|if
condition|(
name|dot
operator|==
operator|-
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"Bad address"
argument_list|)
expr_stmt|;
break|break;
block|}
name|adrflg
operator|=
literal|1
expr_stmt|;
name|integ
operator|=
name|atoi
argument_list|(
name|args
argument_list|)
expr_stmt|;
if|if
condition|(
name|integ
condition|)
name|cntval
operator|=
name|integ
expr_stmt|;
name|dopcs
argument_list|(
literal|'c'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|signo
condition|)
name|printf
argument_list|(
literal|"Breakpoint"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" at\n"
argument_list|)
expr_stmt|;
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'k'
case|:
if|if
condition|(
name|scallx
condition|)
block|{
name|userpc
operator|=
name|dot
operator|=
operator|*
operator|(
name|ADDR
operator|*
operator|)
operator|(
operator|(
operator|(
name|ADDR
operator|)
operator|&
name|u
operator|)
operator|+
name|PC
operator|)
operator|=
name|pcs
expr_stmt|;
operator|*
operator|(
name|ADDR
operator|*
operator|)
operator|(
operator|(
operator|(
name|ADDR
operator|)
operator|&
name|u
operator|)
operator|+
name|FP
operator|)
operator|=
name|fps
expr_stmt|;
operator|*
operator|(
name|ADDR
operator|*
operator|)
operator|(
operator|(
operator|(
name|ADDR
operator|)
operator|&
name|u
operator|)
operator|+
name|AP
operator|)
operator|=
name|aps
expr_stmt|;
if|if
condition|(
name|bkpts
condition|)
name|bkpts
operator|->
name|flag
operator|=
name|flagss
expr_stmt|;
name|scallx
operator|=
literal|0
expr_stmt|;
name|error
argument_list|(
literal|"Procedure killed"
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|env
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dopcs
argument_list|(
literal|'k'
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
block|}
case|case
literal|'B'
case|:
name|prbkpt
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'b'
case|:
name|setbrk
label|:
if|if
condition|(
name|proc
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|integ
operator|==
literal|0
condition|)
block|{
name|integ
operator|=
name|fline
expr_stmt|;
block|}
name|setdot
argument_list|()
expr_stmt|;
if|if
condition|(
name|dot
operator|==
operator|-
literal|1
operator|||
name|dot
operator|==
literal|0
condition|)
block|{
name|error
argument_list|(
literal|"Cannot set breakpoint"
argument_list|)
expr_stmt|;
break|break;
block|}
name|dopcs
argument_list|(
literal|'b'
argument_list|)
expr_stmt|;
name|s
index|[
literal|0
index|]
operator|=
literal|' '
expr_stmt|;
name|s
index|[
literal|1
index|]
operator|=
name|cmd
expr_stmt|;
name|s
index|[
literal|2
index|]
operator|=
literal|'\n'
expr_stmt|;
name|s
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|s
index|[
literal|1
index|]
operator|=
name|cmd
expr_stmt|;
name|printbkpt
argument_list|(
name|s
argument_list|,
name|adrtoprocp
argument_list|(
name|dot
argument_list|)
argument_list|,
name|dot
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
if|if
condition|(
name|proc
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|integ
operator|==
literal|0
condition|)
block|{
name|idbkpt
argument_list|()
expr_stmt|;
break|break;
block|}
name|setdot
argument_list|()
expr_stmt|;
if|if
condition|(
name|dot
operator|==
operator|-
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"Non existent breakpoint"
argument_list|)
expr_stmt|;
break|break;
block|}
name|dopcs
argument_list|(
literal|'d'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'D'
case|:
name|dabkpt
argument_list|()
expr_stmt|;
name|error
argument_list|(
literal|"All breakpoints deleted"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|addr
operator|=
name|varaddr
argument_list|(
name|proc
index|[
literal|0
index|]
condition|?
name|proc
else|:
name|curproc
argument_list|()
operator|->
name|pname
argument_list|,
name|var
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"stopped with value %d\n"
argument_list|,
name|monex
argument_list|(
name|addr
argument_list|,
literal|'d'
argument_list|)
argument_list|)
expr_stmt|;
name|setcur
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'?'
case|:
if|if
condition|(
operator|!
operator|(
name|var
index|[
literal|0
index|]
operator|==
literal|'.'
operator|&&
name|var
index|[
literal|1
index|]
operator|==
literal|'\0'
operator|)
condition|)
name|setdot
argument_list|()
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
block|{
name|error
argument_list|(
name|errflg
argument_list|)
expr_stmt|;
break|break;
block|}
name|prisploc
argument_list|()
expr_stmt|;
name|dispi
argument_list|(
name|dot
argument_list|,
name|args
index|[
literal|0
index|]
condition|?
name|args
else|:
literal|"i"
argument_list|,
name|N_GSYM
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|DSICOM
expr_stmt|;
break|break;
case|case
literal|'/'
case|:
if|if
condition|(
name|var
index|[
literal|0
index|]
operator|==
literal|'.'
operator|&&
name|var
index|[
literal|1
index|]
operator|==
literal|'\0'
condition|)
block|{
if|if
condition|(
name|integ
operator|==
literal|0
condition|)
name|integ
operator|=
name|oaddr
expr_stmt|;
name|dispf
argument_list|(
operator|(
name|ADDR
operator|)
name|integ
argument_list|,
name|args
index|[
literal|0
index|]
condition|?
name|args
else|:
name|odesc
argument_list|,
name|oclass
operator|==
name|N_RSYM
condition|?
name|oclass
else|:
name|N_GSYM
argument_list|,
name|otype
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DSP
argument_list|)
expr_stmt|;
name|oaddr
operator|=
name|integ
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|integ
operator|&&
operator|(
name|var
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|)
condition|)
block|{
name|dispf
argument_list|(
operator|(
name|ADDR
operator|)
name|integ
argument_list|,
name|args
argument_list|,
name|N_GSYM
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DSP
argument_list|)
expr_stmt|;
name|oaddr
operator|=
name|integ
expr_stmt|;
name|cpstr
argument_list|(
name|odesc
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|oclass
operator|=
name|N_GSYM
expr_stmt|;
name|otype
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|dispvar
argument_list|(
name|proc
argument_list|,
name|var
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|lastcom
operator|=
name|DSCOM
expr_stmt|;
break|break;
case|case
literal|'='
case|:
if|if
condition|(
name|var
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
block|{
if|if
condition|(
name|proc
index|[
literal|0
index|]
condition|)
block|{
name|addr
operator|=
name|getaddr
argument_list|(
name|proc
argument_list|,
name|integ
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr
operator|==
operator|-
literal|1
condition|)
block|{
name|error
argument_list|(
literal|"Unknown address"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
name|addr
operator|=
name|integ
expr_stmt|;
name|dispf
argument_list|(
name|addr
argument_list|,
name|args
index|[
literal|0
index|]
condition|?
name|args
else|:
literal|"x"
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|DSP
argument_list|)
expr_stmt|;
block|}
else|else
name|findvar
argument_list|(
name|proc
argument_list|,
name|var
argument_list|,
name|args
index|[
literal|0
index|]
condition|?
name|args
else|:
literal|"x"
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'!'
case|:
if|if
condition|(
name|var
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|addr
operator|=
name|getaddr
argument_list|(
name|proc
argument_list|,
name|integ
argument_list|)
expr_stmt|;
else|else
name|addr
operator|=
name|varaddr
argument_list|(
name|proc
argument_list|,
name|var
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr
operator|==
operator|-
literal|1
condition|)
name|error
argument_list|(
literal|"Unknown variable"
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|number
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
operator|||
name|eqany
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|,
literal|".-"
argument_list|)
condition|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|double
name|atof
parameter_list|()
function_decl|;
union|union
block|{
struct|struct
block|{
name|int
name|w1
decl_stmt|,
name|w2
decl_stmt|;
block|}
name|ww
struct|;
name|double
name|d
decl_stmt|;
block|}
name|dbl
union|;
name|p
operator|=
operator|(
name|args
index|[
literal|0
index|]
operator|==
literal|'-'
operator|)
condition|?
name|args
operator|+
literal|1
else|:
name|args
expr_stmt|;
for|for
control|(
init|;
operator|*
name|p
operator|!=
literal|'.'
operator|&&
operator|*
name|p
operator|!=
literal|'e'
condition|;
name|p
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|number
argument_list|(
operator|*
name|p
argument_list|)
condition|)
goto|goto
name|l2
goto|;
block|}
name|dbl
operator|.
name|d
operator|=
name|atof
argument_list|(
name|args
argument_list|)
expr_stmt|;
name|putval
argument_list|(
name|addr
argument_list|,
literal|'d'
argument_list|,
name|dbl
operator|.
name|ww
operator|.
name|w1
argument_list|)
expr_stmt|;
if|if
condition|(
name|typetodesc
argument_list|(
name|sl_type
argument_list|,
literal|0
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'g'
condition|)
name|putval
argument_list|(
name|addr
operator|+
name|WORDSIZE
argument_list|,
literal|'d'
argument_list|,
name|dbl
operator|.
name|ww
operator|.
name|w2
argument_list|)
expr_stmt|;
break|break;
block|}
name|l2
label|:
if|if
condition|(
name|percentflag
condition|)
operator|*
operator|(
name|ADDR
operator|*
operator|)
operator|(
operator|(
operator|(
name|ADDR
operator|)
operator|&
name|u
operator|)
operator|+
name|addr
operator|)
operator|=
name|argvalue
argument_list|(
name|args
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|sl_class
operator|==
name|N_RSYM
operator|&&
name|addr
operator|<
literal|16
condition|)
name|putreg
argument_list|(
name|addr
argument_list|,
name|typetodesc
argument_list|(
name|sl_type
argument_list|,
name|subflag
argument_list|)
index|[
literal|0
index|]
argument_list|,
name|argvalue
argument_list|(
name|args
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|putval
argument_list|(
name|addr
argument_list|,
name|typetodesc
argument_list|(
name|sl_type
argument_list|,
name|subflag
argument_list|)
index|[
literal|0
index|]
argument_list|,
name|argvalue
argument_list|(
name|args
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|lastcom
operator|=
name|NOCOM
expr_stmt|;
break|break;
case|case
literal|'"'
case|:
name|printf
argument_list|(
name|args
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_macro
name|fpargs
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
switch|switch
condition|(
name|args
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|'p'
case|:
case|case
literal|'\0'
case|:
name|fprint
argument_list|()
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
name|i
operator|=
name|fline
expr_stmt|;
name|fback
argument_list|(
name|WINDOW
operator|/
literal|2
argument_list|)
expr_stmt|;
name|fprintn
argument_list|(
name|WINDOW
argument_list|)
expr_stmt|;
name|ffind
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'z'
case|:
name|fprintn
argument_list|(
name|WINDOW
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_decl_stmt
name|MSG
name|BADTXT
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Used by a, b, c, C, d and g commands to find linenumber */
end_comment

begin_macro
name|setdot
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|ncolonflag
condition|)
block|{
name|dot
operator|=
name|integ
expr_stmt|;
name|get
argument_list|(
name|dot
argument_list|,
name|ISP
argument_list|)
expr_stmt|;
if|if
condition|(
name|errflg
condition|)
name|dot
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|dot
operator|=
name|getaddr
argument_list|(
name|proc
argument_list|,
name|integ
argument_list|)
expr_stmt|;
if|if
condition|(
name|dot
operator|==
operator|-
literal|1
condition|)
name|errflg
operator|=
literal|"Bad line number"
expr_stmt|;
block|}
block|}
end_block

end_unit

