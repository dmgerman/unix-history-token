begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"../hdr/macros.h"
end_include

begin_expr_stmt
name|SCCSID
argument_list|(
argument|@
operator|(
operator|#
operator|)
name|date_ab
operator|.
name|c
literal|4.3
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* 	Function to convert date in the form "yymmddhhmmss" to 	standard UNIX time (seconds since Jan. 1, 1970 GMT). 	Units left off of the right are replaced by their 	maximum possible values.  	The function corrects properly for leap year, 	daylight savings time, offset from Greenwich time, etc.  	Function returns -1 if bad time is given (i.e., "730229"). */
end_comment

begin_decl_stmt
name|char
modifier|*
name|Datep
decl_stmt|;
end_decl_stmt

begin_macro
name|date_ab
argument_list|(
argument|adt
argument_list|,
argument|bdt
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|adt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|long
modifier|*
name|bdt
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|y
decl_stmt|,
name|t
decl_stmt|,
name|d
decl_stmt|,
name|h
decl_stmt|,
name|m
decl_stmt|,
name|s
decl_stmt|,
name|i
decl_stmt|;
name|long
name|tim
decl_stmt|;
specifier|extern
name|int
modifier|*
name|localtime
parameter_list|()
function_decl|;
define|#
directive|define
name|time_t
value|long
include|#
directive|include
file|<sys/timeb.h>
name|struct
name|timeb
name|timeb
decl_stmt|;
name|ftime
argument_list|(
operator|&
name|timeb
argument_list|)
expr_stmt|;
name|Datep
operator|=
name|adt
expr_stmt|;
if|if
condition|(
operator|(
name|y
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|y
operator|=
literal|99
expr_stmt|;
if|if
condition|(
name|y
operator|<
literal|70
operator|||
name|y
operator|>
literal|99
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|t
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|t
operator|=
literal|12
expr_stmt|;
if|if
condition|(
name|t
operator|<
literal|1
operator|||
name|t
operator|>
literal|12
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|d
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|d
operator|=
name|mosize
argument_list|(
name|y
argument_list|,
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|<
literal|1
operator|||
name|d
operator|>
name|mosize
argument_list|(
name|y
argument_list|,
name|t
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|h
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|h
operator|=
literal|23
expr_stmt|;
if|if
condition|(
name|h
operator|<
literal|0
operator|||
name|h
operator|>
literal|23
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|m
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|m
operator|=
literal|59
expr_stmt|;
if|if
condition|(
name|m
operator|<
literal|0
operator|||
name|m
operator|>
literal|59
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|s
operator|=
name|g2
argument_list|()
operator|)
operator|==
operator|-
literal|2
condition|)
name|s
operator|=
literal|59
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
operator|||
name|s
operator|>
literal|59
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|tim
operator|=
literal|0L
expr_stmt|;
name|y
operator|=
operator|+
literal|1900
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1970
init|;
name|i
operator|<
name|y
condition|;
name|i
operator|++
control|)
name|tim
operator|=
operator|+
name|dysize
argument_list|(
name|i
argument_list|)
expr_stmt|;
while|while
condition|(
operator|--
name|t
condition|)
name|tim
operator|=
operator|+
name|mosize
argument_list|(
name|y
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|tim
operator|=
operator|+
name|d
operator|-
literal|1
expr_stmt|;
name|tim
operator|=
operator|*
literal|24
expr_stmt|;
name|tim
operator|=
operator|+
name|h
expr_stmt|;
name|tim
operator|=
operator|*
literal|60
expr_stmt|;
name|tim
operator|=
operator|+
name|m
expr_stmt|;
name|tim
operator|=
operator|+
name|timeb
operator|.
name|timezone
expr_stmt|;
comment|/* GMT correction */
name|tim
operator|=
operator|*
literal|60
expr_stmt|;
name|tim
operator|=
operator|+
name|s
expr_stmt|;
if|if
condition|(
name|localtime
argument_list|(
operator|&
name|tim
argument_list|)
index|[
literal|8
index|]
condition|)
name|tim
operator|=
operator|+
operator|-
literal|1
operator|*
literal|60
operator|*
literal|60
expr_stmt|;
comment|/* daylight savings */
operator|*
name|bdt
operator|=
name|tim
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|mosize
argument_list|(
argument|y
argument_list|,
argument|t
argument_list|)
end_macro

begin_decl_stmt
name|int
name|y
decl_stmt|,
name|t
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|int
name|dmsize
index|[
literal|12
index|]
init|=
block|{
literal|31
block|,
literal|28
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|,
literal|30
block|,
literal|31
block|}
decl_stmt|;
if|if
condition|(
name|t
operator|==
literal|2
operator|&&
name|dysize
argument_list|(
name|y
argument_list|)
operator|==
literal|366
condition|)
return|return
operator|(
literal|29
operator|)
return|;
return|return
operator|(
name|dmsize
index|[
name|t
operator|-
literal|1
index|]
operator|)
return|;
block|}
end_block

begin_macro
name|g2
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|c
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|Datep
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
if|if
condition|(
name|numeric
argument_list|(
operator|*
name|p
argument_list|)
condition|)
break|break;
if|if
condition|(
operator|*
name|p
condition|)
block|{
name|c
operator|=
operator|(
operator|*
name|p
operator|++
operator|-
literal|'0'
operator|)
operator|*
literal|10
expr_stmt|;
if|if
condition|(
operator|*
name|p
condition|)
name|c
operator|=
operator|+
operator|(
operator|*
name|p
operator|++
operator|-
literal|'0'
operator|)
expr_stmt|;
else|else
name|c
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
name|c
operator|=
operator|-
literal|2
expr_stmt|;
name|Datep
operator|=
name|p
expr_stmt|;
return|return
operator|(
name|c
operator|)
return|;
block|}
end_block

end_unit

