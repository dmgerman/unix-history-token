begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)n7.c	2.1 (CWI) 85/07/18"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_include
include|#
directive|include
file|"tdef.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|NROFF
end_ifdef

begin_include
include|#
directive|include
file|"tw.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|NROFF
end_ifdef

begin_define
define|#
directive|define
name|GETCH
value|gettch
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|NROFF
end_ifndef

begin_define
define|#
directive|define
name|GETCH
value|getch
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * troff7.c  *   * text  */
end_comment

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"ext.h"
end_include

begin_decl_stmt
name|int
name|brflg
decl_stmt|;
end_decl_stmt

begin_macro
name|tbreak
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|pad
operator|,
name|k
expr_stmt|;
specifier|register
name|tchar
modifier|*
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|register
name|int
name|resol
init|=
literal|0
decl_stmt|;
name|trap
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|nb
condition|)
return|return;
if|if
condition|(
name|dip
operator|==
name|d
operator|&&
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|==
operator|-
literal|1
condition|)
block|{
name|newline
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|nc
condition|)
block|{
name|setnel
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|wch
condition|)
return|return;
if|if
condition|(
name|pendw
condition|)
name|getword
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|movword
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pendw
operator|&&
operator|!
name|brflg
condition|)
block|{
name|getword
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|movword
argument_list|()
expr_stmt|;
block|}
operator|*
name|linep
operator|=
name|dip
operator|->
name|nls
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|NROFF
if|if
condition|(
name|dip
operator|==
name|d
condition|)
name|horiz
argument_list|(
name|po
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|lnmod
condition|)
name|donum
argument_list|()
expr_stmt|;
name|lastl
operator|=
name|ne
expr_stmt|;
if|if
condition|(
name|brflg
operator|!=
literal|1
condition|)
block|{
name|totout
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ad
condition|)
block|{
if|if
condition|(
operator|(
name|lastl
operator|=
name|ll
operator|-
name|un
operator|)
operator|<
name|ne
condition|)
name|lastl
operator|=
name|ne
expr_stmt|;
block|}
if|if
condition|(
name|admod
operator|&&
name|ad
operator|&&
operator|(
name|brflg
operator|!=
literal|2
operator|)
condition|)
block|{
name|lastl
operator|=
name|ne
expr_stmt|;
name|adsp
operator|=
name|adrem
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|admod
operator|==
literal|1
condition|)
name|un
operator|+=
name|quant
argument_list|(
name|nel
operator|/
literal|2
argument_list|,
name|HOR
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|admod
operator|==
literal|2
condition|)
name|un
operator|+=
name|nel
expr_stmt|;
block|}
name|totout
operator|++
expr_stmt|;
name|brflg
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|lastl
operator|+
name|un
operator|>
name|dip
operator|->
name|maxl
condition|)
name|dip
operator|->
name|maxl
operator|=
name|lastl
operator|+
name|un
expr_stmt|;
name|horiz
argument_list|(
name|un
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|NROFF
if|if
condition|(
name|adrem
operator|%
name|t
operator|.
name|Adj
condition|)
name|resol
operator|=
name|t
operator|.
name|Hor
expr_stmt|;
else|else
name|resol
operator|=
name|t
operator|.
name|Adj
expr_stmt|;
else|#
directive|else
name|resol
operator|=
name|HOR
expr_stmt|;
endif|#
directive|endif
for|for
control|(
name|i
operator|=
name|line
init|;
name|nc
operator|>
literal|0
condition|;
control|)
block|{
if|if
condition|(
operator|(
name|cbits
argument_list|(
name|j
operator|=
operator|*
name|i
operator|++
argument_list|)
operator|)
operator|==
literal|' '
condition|)
block|{
name|pad
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|pad
operator|+=
name|width
argument_list|(
name|j
argument_list|)
expr_stmt|;
name|nc
operator|--
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|cbits
argument_list|(
name|j
operator|=
operator|*
name|i
operator|++
argument_list|)
operator|)
operator|==
literal|' '
condition|)
do|;
name|i
operator|--
expr_stmt|;
name|pad
operator|+=
name|adsp
expr_stmt|;
operator|--
name|nwd
expr_stmt|;
if|if
condition|(
name|adrem
condition|)
block|{
if|if
condition|(
name|adrem
operator|<
literal|0
condition|)
block|{
name|pad
operator|-=
name|resol
expr_stmt|;
name|adrem
operator|+=
name|resol
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|totout
operator|&
literal|01
operator|)
operator|||
name|adrem
operator|/
name|resol
operator|>=
name|nwd
condition|)
block|{
name|pad
operator|+=
name|resol
expr_stmt|;
name|adrem
operator|-=
name|resol
expr_stmt|;
block|}
block|}
name|pchar
argument_list|(
operator|(
name|tchar
operator|)
name|WORDSP
argument_list|)
expr_stmt|;
name|horiz
argument_list|(
name|pad
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pchar
argument_list|(
name|j
argument_list|)
expr_stmt|;
name|nc
operator|--
expr_stmt|;
block|}
block|}
if|if
condition|(
name|ic
condition|)
block|{
if|if
condition|(
operator|(
name|k
operator|=
name|ll
operator|-
name|un
operator|-
name|lastl
operator|+
name|ics
operator|)
operator|>
literal|0
condition|)
name|horiz
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|pchar
argument_list|(
name|ic
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|icf
condition|)
name|icf
operator|++
expr_stmt|;
else|else
name|ic
operator|=
literal|0
expr_stmt|;
name|ne
operator|=
name|nwd
operator|=
literal|0
expr_stmt|;
name|un
operator|=
name|in
expr_stmt|;
name|setnel
argument_list|()
expr_stmt|;
name|newline
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|dip
operator|!=
name|d
condition|)
block|{
if|if
condition|(
name|dip
operator|->
name|dnl
operator|>
name|dip
operator|->
name|hnl
condition|)
name|dip
operator|->
name|hnl
operator|=
name|dip
operator|->
name|dnl
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|>
name|dip
operator|->
name|hnl
condition|)
name|dip
operator|->
name|hnl
operator|=
name|numtab
index|[
name|NL
index|]
operator|.
name|val
expr_stmt|;
block|}
for|for
control|(
name|k
operator|=
name|ls
operator|-
literal|1
init|;
name|k
operator|>
literal|0
operator|&&
operator|!
name|trap
condition|;
name|k
operator|--
control|)
name|newline
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|spread
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|donum
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
operator|,
name|nw
expr_stmt|;
extern|extern pchar(
block|)
end_block

begin_empty_stmt
empty_stmt|;
end_empty_stmt

begin_expr_stmt
name|nrbits
operator|=
name|nmbits
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|nw
operator|=
name|width
argument_list|(
literal|'1'
operator||
name|nrbits
argument_list|)
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|nn
condition|)
block|{
name|nn
operator|--
expr_stmt|;
goto|goto
name|d1
goto|;
block|}
end_if

begin_if
if|if
condition|(
name|numtab
index|[
name|LN
index|]
operator|.
name|val
operator|%
name|ndf
condition|)
block|{
name|numtab
index|[
name|LN
index|]
operator|.
name|val
operator|++
expr_stmt|;
name|d1
label|:
name|un
operator|+=
name|nw
operator|*
operator|(
literal|3
operator|+
name|nms
operator|+
name|ni
operator|)
expr_stmt|;
return|return;
block|}
end_if

begin_expr_stmt
name|i
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|numtab
index|[
name|LN
index|]
operator|.
name|val
operator|<
literal|100
condition|)
name|i
operator|++
expr_stmt|;
end_if

begin_if
if|if
condition|(
name|numtab
index|[
name|LN
index|]
operator|.
name|val
operator|<
literal|10
condition|)
name|i
operator|++
expr_stmt|;
end_if

begin_expr_stmt
name|horiz
argument_list|(
name|nw
operator|*
operator|(
name|ni
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|nform
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|fnumb
argument_list|(
name|numtab
index|[
name|LN
index|]
operator|.
name|val
argument_list|,
name|pchar
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|un
operator|+=
name|nw
operator|*
name|nms
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|numtab
index|[
name|LN
index|]
operator|.
name|val
operator|++
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|}   text
operator|(
operator|)
block|{
specifier|register
name|tchar
name|i
block|;
specifier|static
name|int
name|spcnt
block|;
name|nflush
operator|++
block|;
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|=
literal|0
block|;
if|if
condition|(
operator|(
name|dip
operator|==
name|d
operator|)
operator|&&
operator|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|==
operator|-
literal|1
operator|)
condition|)
block|{
name|newline
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return;
block|}
name|setnel
argument_list|()
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|ce
operator|||
operator|!
name|fi
condition|)
block|{
name|nofill
argument_list|()
expr_stmt|;
return|return;
block|}
end_if

begin_if
if|if
condition|(
name|pendw
condition|)
goto|goto
name|t4
goto|;
end_if

begin_if
if|if
condition|(
name|pendt
condition|)
if|if
condition|(
name|spcnt
condition|)
goto|goto
name|t2
goto|;
else|else
goto|goto
name|t3
goto|;
end_if

begin_expr_stmt
name|pendt
operator|++
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|spcnt
condition|)
goto|goto
name|t2
goto|;
end_if

begin_while
while|while
condition|(
operator|(
name|cbits
argument_list|(
name|i
operator|=
name|GETCH
argument_list|()
argument_list|)
operator|)
operator|==
literal|' '
condition|)
block|{
name|spcnt
operator|++
expr_stmt|;
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|+=
name|sps
expr_stmt|;
name|widthp
operator|=
name|sps
expr_stmt|;
block|}
end_while

begin_if
if|if
condition|(
name|nlflg
condition|)
block|{
name|t1
label|:
name|nflush
operator|=
name|pendt
operator|=
name|ch
operator|=
name|spcnt
operator|=
literal|0
expr_stmt|;
name|callsp
argument_list|()
expr_stmt|;
return|return;
block|}
end_if

begin_expr_stmt
name|ch
operator|=
name|i
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|spcnt
condition|)
block|{
name|t2
label|:
name|tbreak
argument_list|()
expr_stmt|;
if|if
condition|(
name|nc
operator|||
name|wch
condition|)
goto|goto
name|rtn
goto|;
name|un
operator|+=
name|spcnt
operator|*
name|sps
expr_stmt|;
name|spcnt
operator|=
literal|0
expr_stmt|;
name|setnel
argument_list|()
expr_stmt|;
if|if
condition|(
name|trap
condition|)
goto|goto
name|rtn
goto|;
if|if
condition|(
name|nlflg
condition|)
goto|goto
name|t1
goto|;
block|}
end_if

begin_label
name|t3
label|:
end_label

begin_if
if|if
condition|(
name|spread
condition|)
goto|goto
name|t5
goto|;
end_if

begin_if
if|if
condition|(
name|pendw
operator|||
operator|!
name|wch
condition|)
name|t4
label|:
if|if
condition|(
name|getword
argument_list|(
literal|0
argument_list|)
condition|)
goto|goto
name|t6
goto|;
end_if

begin_if
if|if
condition|(
operator|!
name|movword
argument_list|()
condition|)
goto|goto
name|t3
goto|;
end_if

begin_label
name|t5
label|:
end_label

begin_if
if|if
condition|(
name|nlflg
condition|)
name|pendt
operator|=
literal|0
expr_stmt|;
end_if

begin_expr_stmt
name|adsp
operator|=
name|adrem
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|ad
condition|)
block|{
if|if
condition|(
name|nwd
operator|==
literal|1
condition|)
name|adsp
operator|=
name|nel
expr_stmt|;
else|else
name|adsp
operator|=
name|nel
operator|/
operator|(
name|nwd
operator|-
literal|1
operator|)
expr_stmt|;
name|adsp
operator|=
operator|(
name|adsp
operator|/
name|HOR
operator|)
operator|*
name|HOR
expr_stmt|;
name|adrem
operator|=
name|nel
operator|-
name|adsp
operator|*
operator|(
name|nwd
operator|-
literal|1
operator|)
expr_stmt|;
block|}
end_if

begin_expr_stmt
name|brflg
operator|=
literal|1
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|tbreak
argument_list|()
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|spread
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
operator|!
name|trap
condition|)
goto|goto
name|t3
goto|;
end_if

begin_if
if|if
condition|(
operator|!
name|nlflg
condition|)
goto|goto
name|rtn
goto|;
end_if

begin_label
name|t6
label|:
end_label

begin_expr_stmt
name|pendt
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|ckul
argument_list|()
expr_stmt|;
end_expr_stmt

begin_label
name|rtn
label|:
end_label

begin_expr_stmt
name|nflush
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|}   nofill
operator|(
operator|)
block|{
specifier|register
name|j
block|;
specifier|register
name|tchar
name|i
block|;
if|if
condition|(
operator|!
name|pendnf
condition|)
block|{
name|over
operator|=
literal|0
expr_stmt|;
name|tbreak
argument_list|()
expr_stmt|;
if|if
condition|(
name|trap
condition|)
goto|goto
name|rtn
goto|;
if|if
condition|(
name|nlflg
condition|)
block|{
name|ch
operator|=
name|nflush
operator|=
literal|0
expr_stmt|;
name|callsp
argument_list|()
expr_stmt|;
return|return;
block|}
name|adsp
operator|=
name|adrem
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|nwd
operator|=
literal|10000
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|} 	while
operator|(
operator|(
name|j
operator|=
operator|(
name|cbits
argument_list|(
name|i
operator|=
name|GETCH
argument_list|()
argument_list|)
operator|)
operator|)
operator|!=
literal|'\n'
operator|)
block|{
if|if
condition|(
name|j
operator|==
name|ohc
condition|)
continue|continue;
end_expr_stmt

begin_if
if|if
condition|(
name|j
operator|==
name|CONT
condition|)
block|{
name|pendnf
operator|++
expr_stmt|;
name|nflush
operator|=
literal|0
expr_stmt|;
name|flushi
argument_list|()
expr_stmt|;
name|ckul
argument_list|()
expr_stmt|;
return|return;
block|}
end_if

begin_expr_stmt
name|j
operator|=
name|width
argument_list|(
name|i
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|widthp
operator|=
name|j
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|+=
name|j
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|storeline
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|} 	if
operator|(
name|ce
operator|)
block|{
name|ce
operator|--
block|;
if|if
condition|(
operator|(
name|i
operator|=
name|quant
argument_list|(
name|nel
operator|/
literal|2
argument_list|,
name|HOR
argument_list|)
operator|)
operator|>
literal|0
condition|)
name|un
operator|+=
name|i
expr_stmt|;
block|}
end_expr_stmt

begin_if
if|if
condition|(
operator|!
name|nc
condition|)
name|storeline
argument_list|(
operator|(
name|tchar
operator|)
name|FILLER
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_if

begin_expr_stmt
name|brflg
operator|=
literal|2
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|tbreak
argument_list|()
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|ckul
argument_list|()
expr_stmt|;
end_expr_stmt

begin_label
name|rtn
label|:
end_label

begin_expr_stmt
name|pendnf
operator|=
name|nflush
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|}   callsp
operator|(
operator|)
block|{
specifier|register
name|i
block|;
if|if
condition|(
name|flss
condition|)
name|i
operator|=
name|flss
expr_stmt|;
else|else
name|i
operator|=
name|lss
expr_stmt|;
name|flss
operator|=
literal|0
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|casesp
argument_list|(
name|i
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
unit|}   ckul
operator|(
operator|)
block|{
if|if
condition|(
name|ul
operator|&&
operator|(
operator|--
name|ul
operator|==
literal|0
operator|)
condition|)
block|{
name|cu
operator|=
literal|0
expr_stmt|;
name|font
operator|=
name|sfont
expr_stmt|;
name|mchbits
argument_list|()
expr_stmt|;
block|}
end_expr_stmt

begin_if
if|if
condition|(
name|it
operator|&&
operator|(
operator|--
name|it
operator|==
literal|0
operator|)
operator|&&
name|itmac
condition|)
name|control
argument_list|(
name|itmac
argument_list|,
literal|0
argument_list|)
expr_stmt|;
end_if

begin_expr_stmt
unit|}   storeline
operator|(
name|c
operator|,
name|w
operator|)
specifier|register
name|tchar
name|c
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|linep
operator|>=
name|line
operator|+
name|lnsize
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|over
condition|)
block|{
name|flusho
argument_list|()
expr_stmt|;
name|errprint
argument_list|(
literal|"Line overflow."
argument_list|)
expr_stmt|;
name|over
operator|++
expr_stmt|;
name|c
operator|=
name|LEFTHAND
expr_stmt|;
name|w
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|s1
goto|;
block|}
return|return;
block|}
name|s1
label|:
if|if
condition|(
name|w
operator|==
operator|-
literal|1
condition|)
name|w
operator|=
name|width
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|ne
operator|+=
name|w
expr_stmt|;
name|nel
operator|-=
name|w
expr_stmt|;
operator|*
name|linep
operator|++
operator|=
name|c
expr_stmt|;
name|nc
operator|++
expr_stmt|;
block|}
end_block

begin_macro
name|newline
argument_list|(
argument|a
argument_list|)
end_macro

begin_decl_stmt
name|int
name|a
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
operator|,
name|j
operator|,
name|nlss
expr_stmt|;
name|int
name|opn
decl_stmt|;
if|if
condition|(
name|a
condition|)
goto|goto
name|nl1
goto|;
if|if
condition|(
name|dip
operator|!=
name|d
condition|)
block|{
name|j
operator|=
name|lss
expr_stmt|;
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
name|FLSS
argument_list|)
expr_stmt|;
if|if
condition|(
name|flss
condition|)
name|lss
operator|=
name|flss
expr_stmt|;
name|i
operator|=
name|lss
operator|+
name|dip
operator|->
name|blss
expr_stmt|;
name|dip
operator|->
name|dnl
operator|+=
name|i
expr_stmt|;
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
name|i
argument_list|)
expr_stmt|;
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
literal|'\n'
argument_list|)
expr_stmt|;
name|lss
operator|=
name|j
expr_stmt|;
name|dip
operator|->
name|blss
operator|=
name|flss
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|dip
operator|->
name|alss
condition|)
block|{
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
name|FLSS
argument_list|)
expr_stmt|;
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
name|dip
operator|->
name|alss
argument_list|)
expr_stmt|;
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
literal|'\n'
argument_list|)
expr_stmt|;
name|dip
operator|->
name|dnl
operator|+=
name|dip
operator|->
name|alss
expr_stmt|;
name|dip
operator|->
name|alss
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|dip
operator|->
name|ditrap
operator|&&
operator|!
name|dip
operator|->
name|ditf
operator|&&
name|dip
operator|->
name|dnl
operator|>=
name|dip
operator|->
name|ditrap
operator|&&
name|dip
operator|->
name|dimac
condition|)
if|if
condition|(
name|control
argument_list|(
name|dip
operator|->
name|dimac
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|trap
operator|++
expr_stmt|;
name|dip
operator|->
name|ditf
operator|++
expr_stmt|;
block|}
return|return;
block|}
name|j
operator|=
name|lss
expr_stmt|;
if|if
condition|(
name|flss
condition|)
name|lss
operator|=
name|flss
expr_stmt|;
name|nlss
operator|=
name|dip
operator|->
name|alss
operator|+
name|dip
operator|->
name|blss
operator|+
name|lss
expr_stmt|;
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|+=
name|nlss
expr_stmt|;
ifndef|#
directive|ifndef
name|NROFF
if|if
condition|(
name|ascii
condition|)
block|{
name|dip
operator|->
name|alss
operator|=
name|dip
operator|->
name|blss
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
name|pchar1
argument_list|(
operator|(
name|tchar
operator|)
literal|'\n'
argument_list|)
expr_stmt|;
name|flss
operator|=
literal|0
expr_stmt|;
name|lss
operator|=
name|j
expr_stmt|;
if|if
condition|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|<
name|pl
condition|)
goto|goto
name|nl2
goto|;
name|nl1
label|:
name|ejf
operator|=
name|dip
operator|->
name|hnl
operator|=
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|=
literal|0
expr_stmt|;
name|ejl
operator|=
name|frame
expr_stmt|;
if|if
condition|(
name|donef
condition|)
block|{
if|if
condition|(
operator|(
operator|!
name|nc
operator|&&
operator|!
name|wch
operator|)
operator|||
name|ndone
condition|)
name|done1
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|ndone
operator|++
expr_stmt|;
name|donef
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|frame
operator|==
name|stk
condition|)
name|nflush
operator|++
expr_stmt|;
block|}
name|opn
operator|=
name|numtab
index|[
name|PN
index|]
operator|.
name|val
expr_stmt|;
name|numtab
index|[
name|PN
index|]
operator|.
name|val
operator|++
expr_stmt|;
if|if
condition|(
name|npnflg
condition|)
block|{
name|numtab
index|[
name|PN
index|]
operator|.
name|val
operator|=
name|npn
expr_stmt|;
name|npn
operator|=
name|npnflg
operator|=
literal|0
expr_stmt|;
block|}
name|nlpn
label|:
if|if
condition|(
name|numtab
index|[
name|PN
index|]
operator|.
name|val
operator|==
name|pfrom
condition|)
block|{
name|print
operator|++
expr_stmt|;
name|pfrom
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|opn
operator|==
name|pto
condition|)
block|{
name|print
operator|=
literal|0
expr_stmt|;
name|opn
operator|=
operator|-
literal|1
expr_stmt|;
name|chkpn
argument_list|()
expr_stmt|;
goto|goto
name|nlpn
goto|;
block|}
if|if
condition|(
name|print
condition|)
name|newpage
argument_list|(
name|numtab
index|[
name|PN
index|]
operator|.
name|val
argument_list|)
expr_stmt|;
comment|/* supposedly in a clean state so can pause */
if|if
condition|(
name|stop
operator|&&
name|print
condition|)
block|{
name|dpn
operator|++
expr_stmt|;
if|if
condition|(
name|dpn
operator|>=
name|stop
condition|)
block|{
name|dpn
operator|=
literal|0
expr_stmt|;
name|dostop
argument_list|()
expr_stmt|;
block|}
block|}
name|nl2
label|:
name|trap
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|=
name|findn
argument_list|(
literal|0
argument_list|)
operator|)
operator|!=
name|NTRAP
condition|)
name|trap
operator|=
name|control
argument_list|(
name|mlist
index|[
name|j
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|i
operator|=
name|findt
argument_list|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|-
name|nlss
argument_list|)
operator|)
operator|<=
name|nlss
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|=
name|findn1
argument_list|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|-
name|nlss
operator|+
name|i
argument_list|)
operator|)
operator|==
name|NTRAP
condition|)
block|{
name|flusho
argument_list|()
expr_stmt|;
name|errprint
argument_list|(
literal|"Trap botch."
argument_list|)
expr_stmt|;
name|done2
argument_list|(
operator|-
literal|5
argument_list|)
expr_stmt|;
block|}
name|trap
operator|=
name|control
argument_list|(
name|mlist
index|[
name|j
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|findn1
argument_list|(
argument|a
argument_list|)
end_macro

begin_decl_stmt
name|int
name|a
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
operator|,
name|j
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NTRAP
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|mlist
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|=
name|nlist
index|[
name|i
index|]
operator|)
operator|<
literal|0
condition|)
name|j
operator|+=
name|pl
expr_stmt|;
if|if
condition|(
name|j
operator|==
name|a
condition|)
break|break;
block|}
block|}
return|return
operator|(
name|i
operator|)
return|;
block|}
end_block

begin_macro
name|chkpn
argument_list|()
end_macro

begin_block
block|{
name|pto
operator|=
operator|*
operator|(
name|pnp
operator|++
operator|)
expr_stmt|;
name|pfrom
operator|=
name|pto
operator|>=
literal|0
condition|?
name|pto
else|:
operator|-
name|pto
expr_stmt|;
if|if
condition|(
name|pto
operator|==
operator|-
literal|32767
condition|)
block|{
name|flusho
argument_list|()
expr_stmt|;
name|done1
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pto
operator|<
literal|0
condition|)
block|{
name|pto
operator|=
operator|-
name|pto
expr_stmt|;
name|print
operator|++
expr_stmt|;
name|pfrom
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|findt
argument_list|(
argument|a
argument_list|)
end_macro

begin_decl_stmt
name|int
name|a
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|i
operator|,
name|j
operator|,
name|k
expr_stmt|;
name|k
operator|=
literal|32767
expr_stmt|;
if|if
condition|(
name|dip
operator|!=
name|d
condition|)
block|{
if|if
condition|(
name|dip
operator|->
name|dimac
operator|&&
operator|(
name|i
operator|=
name|dip
operator|->
name|ditrap
operator|-
name|a
operator|)
operator|>
literal|0
condition|)
name|k
operator|=
name|i
expr_stmt|;
return|return
operator|(
name|k
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NTRAP
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|mlist
index|[
name|i
index|]
condition|)
block|{
if|if
condition|(
operator|(
name|j
operator|=
name|nlist
index|[
name|i
index|]
operator|)
operator|<
literal|0
condition|)
name|j
operator|+=
name|pl
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|-=
name|a
operator|)
operator|<=
literal|0
condition|)
continue|continue;
if|if
condition|(
name|j
operator|<
name|k
condition|)
name|k
operator|=
name|j
expr_stmt|;
block|}
block|}
name|i
operator|=
name|pl
operator|-
name|a
expr_stmt|;
if|if
condition|(
name|k
operator|>
name|i
condition|)
name|k
operator|=
name|i
expr_stmt|;
return|return
operator|(
name|k
operator|)
return|;
block|}
end_block

begin_macro
name|findt1
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|i
expr_stmt|;
if|if
condition|(
name|dip
operator|!=
name|d
condition|)
name|i
operator|=
name|dip
operator|->
name|dnl
expr_stmt|;
else|else
name|i
operator|=
name|numtab
index|[
name|NL
index|]
operator|.
name|val
expr_stmt|;
return|return
operator|(
name|findt
argument_list|(
name|i
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|eject
argument_list|(
argument|a
argument_list|)
end_macro

begin_decl_stmt
name|struct
name|s
modifier|*
name|a
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|savlss
expr_stmt|;
if|if
condition|(
name|dip
operator|!=
name|d
condition|)
return|return;
name|ejf
operator|++
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|ejl
operator|=
name|a
expr_stmt|;
else|else
name|ejl
operator|=
name|frame
expr_stmt|;
if|if
condition|(
name|trap
condition|)
return|return;
name|e1
label|:
name|savlss
operator|=
name|lss
expr_stmt|;
name|lss
operator|=
name|findt
argument_list|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
argument_list|)
expr_stmt|;
name|newline
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|lss
operator|=
name|savlss
expr_stmt|;
if|if
condition|(
name|numtab
index|[
name|NL
index|]
operator|.
name|val
operator|&&
operator|!
name|trap
condition|)
goto|goto
name|e1
goto|;
block|}
end_block

begin_macro
name|movword
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|w
expr_stmt|;
specifier|register
name|tchar
name|i
decl_stmt|,
modifier|*
name|wp
decl_stmt|;
name|int
name|savwch
decl_stmt|,
name|hys
decl_stmt|;
name|over
operator|=
literal|0
expr_stmt|;
name|wp
operator|=
name|wordp
expr_stmt|;
if|if
condition|(
operator|!
name|nwd
condition|)
block|{
while|while
condition|(
name|cbits
argument_list|(
name|i
operator|=
operator|*
name|wp
operator|++
argument_list|)
operator|==
literal|' '
condition|)
block|{
name|wch
operator|--
expr_stmt|;
name|wne
operator|-=
name|sps
expr_stmt|;
block|}
name|wp
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|wne
operator|>
name|nel
operator|&&
operator|!
name|hyoff
operator|&&
name|hyf
operator|&&
operator|(
operator|!
name|nwd
operator|||
name|nel
operator|>
literal|3
operator|*
name|sps
operator|)
operator|&&
operator|(
operator|!
operator|(
name|hyf
operator|&
literal|02
operator|)
operator|||
operator|(
name|findt1
argument_list|()
operator|>
name|lss
operator|)
operator|)
condition|)
name|hyphen
argument_list|(
name|wp
argument_list|)
expr_stmt|;
name|savwch
operator|=
name|wch
expr_stmt|;
name|hyp
operator|=
name|hyptr
expr_stmt|;
name|nhyp
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|hyp
operator|&&
operator|*
name|hyp
operator|<=
name|wp
condition|)
name|hyp
operator|++
expr_stmt|;
while|while
condition|(
name|wch
condition|)
block|{
if|if
condition|(
name|hyoff
operator|!=
literal|1
operator|&&
operator|*
name|hyp
operator|==
name|wp
condition|)
block|{
name|hyp
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|wdstart
operator|||
operator|(
name|wp
operator|>
name|wdstart
operator|+
literal|1
operator|&&
name|wp
operator|<
name|wdend
operator|&&
operator|(
operator|!
operator|(
name|hyf
operator|&
literal|04
operator|)
operator|||
name|wp
operator|<
name|wdend
operator|-
literal|1
operator|)
operator|&&
comment|/* 04 => last 2 */
operator|(
operator|!
operator|(
name|hyf
operator|&
literal|010
operator|)
operator|||
name|wp
operator|>
name|wdstart
operator|+
literal|2
operator|)
operator|)
condition|)
block|{
comment|/* 010 => 1st 2 */
name|nhyp
operator|++
expr_stmt|;
name|storeline
argument_list|(
operator|(
name|tchar
operator|)
name|IMP
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
name|i
operator|=
operator|*
name|wp
operator|++
expr_stmt|;
name|w
operator|=
name|width
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|wne
operator|-=
name|w
expr_stmt|;
name|wch
operator|--
expr_stmt|;
name|storeline
argument_list|(
name|i
argument_list|,
name|w
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|nel
operator|>=
literal|0
condition|)
block|{
name|nwd
operator|++
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
comment|/* line didn't fill up */
block|}
ifndef|#
directive|ifndef
name|NROFF
name|xbits
argument_list|(
operator|(
name|tchar
operator|)
name|HYPHEN
argument_list|,
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|hys
operator|=
name|width
argument_list|(
operator|(
name|tchar
operator|)
name|HYPHEN
argument_list|)
expr_stmt|;
name|m1
label|:
if|if
condition|(
operator|!
name|nhyp
condition|)
block|{
if|if
condition|(
operator|!
name|nwd
condition|)
goto|goto
name|m3
goto|;
if|if
condition|(
name|wch
operator|==
name|savwch
condition|)
goto|goto
name|m4
goto|;
block|}
if|if
condition|(
operator|*
operator|--
name|linep
operator|!=
name|IMP
condition|)
goto|goto
name|m5
goto|;
if|if
condition|(
operator|!
operator|(
operator|--
name|nhyp
operator|)
condition|)
if|if
condition|(
operator|!
name|nwd
condition|)
goto|goto
name|m2
goto|;
if|if
condition|(
name|nel
operator|<
name|hys
condition|)
block|{
name|nc
operator|--
expr_stmt|;
goto|goto
name|m1
goto|;
block|}
name|m2
label|:
if|if
condition|(
operator|(
name|i
operator|=
name|cbits
argument_list|(
operator|*
operator|(
name|linep
operator|-
literal|1
operator|)
argument_list|)
operator|)
operator|!=
literal|'-'
operator|&&
name|i
operator|!=
name|EMDASH
condition|)
block|{
operator|*
name|linep
operator|=
operator|(
operator|*
operator|(
name|linep
operator|-
literal|1
operator|)
operator|&
name|SFMASK
operator|)
operator||
name|HYPHEN
expr_stmt|;
name|w
operator|=
name|width
argument_list|(
operator|*
name|linep
argument_list|)
expr_stmt|;
name|nel
operator|-=
name|w
expr_stmt|;
name|ne
operator|+=
name|w
expr_stmt|;
name|linep
operator|++
expr_stmt|;
block|}
name|m3
label|:
name|nwd
operator|++
expr_stmt|;
name|m4
label|:
name|wordp
operator|=
name|wp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
comment|/* line filled up */
name|m5
label|:
name|nc
operator|--
expr_stmt|;
name|w
operator|=
name|width
argument_list|(
operator|*
name|linep
argument_list|)
expr_stmt|;
name|ne
operator|-=
name|w
expr_stmt|;
name|nel
operator|+=
name|w
expr_stmt|;
name|wne
operator|+=
name|w
expr_stmt|;
name|wch
operator|++
expr_stmt|;
name|wp
operator|--
expr_stmt|;
goto|goto
name|m1
goto|;
block|}
end_block

begin_macro
name|horiz
argument_list|(
argument|i
argument_list|)
end_macro

begin_decl_stmt
name|int
name|i
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|vflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
condition|)
name|pchar
argument_list|(
name|makem
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|setnel
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|nc
condition|)
block|{
name|linep
operator|=
name|line
expr_stmt|;
if|if
condition|(
name|un1
operator|>=
literal|0
condition|)
block|{
name|un
operator|=
name|un1
expr_stmt|;
name|un1
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|nel
operator|=
name|ll
operator|-
name|un
expr_stmt|;
name|ne
operator|=
name|adsp
operator|=
name|adrem
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|getword
argument_list|(
argument|x
argument_list|)
end_macro

begin_decl_stmt
name|int
name|x
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|j
decl_stmt|,
name|k
decl_stmt|;
specifier|register
name|tchar
name|i
decl_stmt|,
modifier|*
name|wp
decl_stmt|;
name|int
name|noword
decl_stmt|;
name|noword
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|x
condition|)
if|if
condition|(
name|pendw
condition|)
block|{
operator|*
name|pendw
operator|=
literal|0
expr_stmt|;
goto|goto
name|rtn
goto|;
block|}
if|if
condition|(
name|wordp
operator|=
name|pendw
condition|)
goto|goto
name|g1
goto|;
name|hyp
operator|=
name|hyptr
expr_stmt|;
name|wordp
operator|=
name|word
expr_stmt|;
name|over
operator|=
name|wne
operator|=
name|wch
operator|=
literal|0
expr_stmt|;
name|hyoff
operator|=
literal|0
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
comment|/* picks up 1st char of word */
name|j
operator|=
name|cbits
argument_list|(
name|i
operator|=
name|GETCH
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|'\n'
condition|)
block|{
name|wne
operator|=
name|wch
operator|=
literal|0
expr_stmt|;
name|noword
operator|=
literal|1
expr_stmt|;
goto|goto
name|rtn
goto|;
block|}
if|if
condition|(
name|j
operator|==
name|ohc
condition|)
block|{
name|hyoff
operator|=
literal|1
expr_stmt|;
comment|/* 1 => don't hyphenate */
continue|continue;
block|}
if|if
condition|(
name|j
operator|==
literal|' '
condition|)
block|{
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|+=
name|sps
expr_stmt|;
name|widthp
operator|=
name|sps
expr_stmt|;
name|storeword
argument_list|(
name|i
argument_list|,
name|sps
argument_list|)
expr_stmt|;
continue|continue;
block|}
break|break;
block|}
name|storeword
argument_list|(
literal|' '
operator||
name|chbits
argument_list|,
name|sps
argument_list|)
expr_stmt|;
if|if
condition|(
name|spflg
condition|)
block|{
name|storeword
argument_list|(
literal|' '
operator||
name|chbits
argument_list|,
name|sps
argument_list|)
expr_stmt|;
name|spflg
operator|=
literal|0
expr_stmt|;
block|}
name|g0
label|:
if|if
condition|(
name|j
operator|==
name|CONT
condition|)
block|{
name|pendw
operator|=
name|wordp
expr_stmt|;
name|nflush
operator|=
literal|0
expr_stmt|;
name|flushi
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|hyoff
operator|!=
literal|1
condition|)
block|{
if|if
condition|(
name|j
operator|==
name|ohc
condition|)
block|{
name|hyoff
operator|=
literal|2
expr_stmt|;
operator|*
name|hyp
operator|++
operator|=
name|wordp
expr_stmt|;
if|if
condition|(
name|hyp
operator|>
operator|(
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
operator|)
condition|)
name|hyp
operator|=
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
expr_stmt|;
goto|goto
name|g1
goto|;
block|}
if|if
condition|(
name|j
operator|==
literal|'-'
operator|||
name|j
operator|==
name|EMDASH
condition|)
if|if
condition|(
name|wordp
operator|>
name|word
operator|+
literal|1
condition|)
block|{
name|hyoff
operator|=
literal|2
expr_stmt|;
operator|*
name|hyp
operator|++
operator|=
name|wordp
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|hyp
operator|>
operator|(
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
operator|)
condition|)
name|hyp
operator|=
name|hyptr
operator|+
name|NHYP
operator|-
literal|1
expr_stmt|;
block|}
block|}
name|j
operator|=
name|width
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|+=
name|j
expr_stmt|;
name|storeword
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|g1
label|:
name|j
operator|=
name|cbits
argument_list|(
name|i
operator|=
name|GETCH
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|!=
literal|' '
condition|)
block|{
specifier|static
name|char
modifier|*
name|sentchar
init|=
literal|".?!"
decl_stmt|;
comment|/* sentence terminators */
if|if
condition|(
name|j
operator|!=
literal|'\n'
condition|)
goto|goto
name|g0
goto|;
name|wp
operator|=
name|wordp
operator|-
literal|1
expr_stmt|;
comment|/* handle extra space at end of sentence */
while|while
condition|(
name|wp
operator|>=
name|word
condition|)
block|{
name|j
operator|=
name|cbits
argument_list|(
operator|*
name|wp
operator|--
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|'"'
operator|||
name|j
operator|==
literal|'\''
operator|||
name|j
operator|==
literal|')'
operator|||
name|j
operator|==
literal|']'
operator|||
name|j
operator|==
literal|'*'
operator|||
name|j
operator|==
name|DAGGER
condition|)
continue|continue;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|sentchar
index|[
name|k
index|]
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|j
operator|==
name|sentchar
index|[
name|k
index|]
condition|)
block|{
name|spflg
operator|++
expr_stmt|;
break|break;
block|}
break|break;
block|}
block|}
operator|*
name|wordp
operator|=
literal|0
expr_stmt|;
name|numtab
index|[
name|HP
index|]
operator|.
name|val
operator|+=
name|sps
expr_stmt|;
name|rtn
label|:
for|for
control|(
name|wp
operator|=
name|word
init|;
operator|*
name|wp
condition|;
name|wp
operator|++
control|)
block|{
name|j
operator|=
name|cbits
argument_list|(
operator|*
name|wp
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|' '
condition|)
continue|continue;
if|if
condition|(
operator|!
name|isdigit
argument_list|(
name|j
argument_list|)
operator|&&
name|j
operator|!=
literal|'-'
condition|)
break|break;
block|}
if|if
condition|(
operator|*
name|wp
operator|==
literal|0
condition|)
comment|/* all numbers, so don't hyphenate */
name|hyoff
operator|=
literal|1
expr_stmt|;
name|wdstart
operator|=
literal|0
expr_stmt|;
name|wordp
operator|=
name|word
expr_stmt|;
name|pendw
operator|=
literal|0
expr_stmt|;
operator|*
name|hyp
operator|++
operator|=
literal|0
expr_stmt|;
name|setnel
argument_list|()
expr_stmt|;
return|return
operator|(
name|noword
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|storeword
argument_list|(
name|c
argument_list|,
name|w
argument_list|)
specifier|register
name|tchar
name|c
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|w
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|wordp
operator|>=
operator|&
name|word
index|[
name|WDSIZE
operator|-
literal|3
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|over
condition|)
block|{
name|flusho
argument_list|()
expr_stmt|;
name|errprint
argument_list|(
literal|"Word overflow."
argument_list|)
expr_stmt|;
name|over
operator|++
expr_stmt|;
name|c
operator|=
name|LEFTHAND
expr_stmt|;
name|w
operator|=
operator|-
literal|1
expr_stmt|;
goto|goto
name|s1
goto|;
block|}
return|return;
block|}
name|s1
label|:
if|if
condition|(
name|w
operator|==
operator|-
literal|1
condition|)
name|w
operator|=
name|width
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|widthp
operator|=
name|w
expr_stmt|;
name|wne
operator|+=
name|w
expr_stmt|;
operator|*
name|wordp
operator|++
operator|=
name|c
expr_stmt|;
name|wch
operator|++
expr_stmt|;
block|}
end_block

begin_ifdef
ifdef|#
directive|ifdef
name|NROFF
end_ifdef

begin_function
name|tchar
name|gettch
parameter_list|()
block|{
specifier|extern
name|int
name|c_isalnum
decl_stmt|;
name|tchar
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|i
operator|=
name|getch
argument_list|()
expr_stmt|;
name|j
operator|=
name|cbits
argument_list|(
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|ismot
argument_list|(
name|i
argument_list|)
operator|||
name|fbits
argument_list|(
name|i
argument_list|)
operator|!=
name|ulfont
condition|)
return|return
operator|(
name|i
operator|)
return|;
if|if
condition|(
name|cu
condition|)
block|{
if|if
condition|(
name|trtab
index|[
name|j
index|]
operator|==
literal|' '
condition|)
block|{
name|setcbits
argument_list|(
name|i
argument_list|,
literal|'_'
argument_list|)
expr_stmt|;
name|setfbits
argument_list|(
name|i
argument_list|,
name|FT
argument_list|)
expr_stmt|;
comment|/* default */
block|}
return|return
operator|(
name|i
operator|)
return|;
block|}
comment|/* should test here for characters that ought to be underlined */
comment|/* in the old nroff, that was the 200 bit on the width! */
comment|/* for now, just do letters, digits and certain special chars */
if|if
condition|(
name|j
operator|<=
literal|127
condition|)
block|{
if|if
condition|(
operator|!
name|isalnum
argument_list|(
name|j
argument_list|)
condition|)
name|setfbits
argument_list|(
name|i
argument_list|,
name|FT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|j
operator|<
name|c_isalnum
condition|)
name|setfbits
argument_list|(
name|i
argument_list|,
name|FT
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|i
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

