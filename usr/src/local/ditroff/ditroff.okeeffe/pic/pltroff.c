begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)pltroff.c	3.2 (CWI) 85/08/15"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|"pic.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|dbg
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|abs
parameter_list|(
name|n
parameter_list|)
value|(n>= 0 ? n : -(n))
end_define

begin_define
define|#
directive|define
name|max
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|((x)>(y) ? (x) : (y))
end_define

begin_decl_stmt
name|char
modifier|*
name|textshift
init|=
literal|"\\v'.2m'"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* move text this far down */
end_comment

begin_comment
comment|/* scaling stuff defined by s command as X0,Y0 to X1,Y1 */
end_comment

begin_comment
comment|/* output dimensions set by -l,-w options to 0,0 to hmax, vmax */
end_comment

begin_comment
comment|/* default output is 6x6 inches */
end_comment

begin_decl_stmt
name|float
name|xscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|yscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|hpos
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current horizontal position in output coordinate system */
end_comment

begin_decl_stmt
name|float
name|vpos
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* current vertical position; 0 is top of page */
end_comment

begin_decl_stmt
name|float
name|htrue
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* where we really are */
end_comment

begin_decl_stmt
name|float
name|vtrue
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|X0
decl_stmt|,
name|Y0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* left bottom of input */
end_comment

begin_decl_stmt
name|float
name|X1
decl_stmt|,
name|Y1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* right top of input */
end_comment

begin_decl_stmt
name|float
name|hmax
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* right end of output */
end_comment

begin_decl_stmt
name|float
name|vmax
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* top of output (down is positive) */
end_comment

begin_decl_stmt
specifier|extern
name|float
name|deltx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|delty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|float
name|xmin
decl_stmt|,
name|ymin
decl_stmt|,
name|xmax
decl_stmt|,
name|ymax
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|xconv
argument_list|()
decl_stmt|,
name|yconv
argument_list|()
decl_stmt|,
name|xsc
argument_list|()
decl_stmt|,
name|ysc
argument_list|()
decl_stmt|;
end_decl_stmt

begin_macro
name|openpl
argument_list|(
argument|s
argument_list|)
end_macro

begin_comment
comment|/* initialize device */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* residue of .PS invocation line */
end_comment

begin_block
block|{
name|float
name|maxdelt
decl_stmt|;
name|hpos
operator|=
name|vpos
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|deltx
operator|>
literal|8.5
operator|||
name|delty
operator|>
literal|11
condition|)
block|{
comment|/* 8.5x11 inches max */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pic: %g X %g picture shrunk to"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
name|maxdelt
operator|=
name|max
argument_list|(
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
name|deltx
operator|*=
literal|7
operator|/
name|maxdelt
expr_stmt|;
name|delty
operator|*=
literal|7
operator|/
name|maxdelt
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|" %g X %g\n"
argument_list|,
name|deltx
argument_list|,
name|delty
argument_list|)
expr_stmt|;
block|}
name|space
argument_list|(
name|xmin
argument_list|,
name|ymin
argument_list|,
name|xmax
argument_list|,
name|ymax
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"... %g %g %g %g\n"
argument_list|,
name|xmin
argument_list|,
name|ymin
argument_list|,
name|xmax
argument_list|,
name|ymax
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"... %.3fi %.3fi %.3fi %.3fi\n"
argument_list|,
name|xconv
argument_list|(
name|xmin
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|xmax
argument_list|)
argument_list|,
name|yconv
argument_list|(
name|ymax
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".nr 00 \\n(.u\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".nf\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".PS %.3fi %.3fi %s"
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|,
name|xconv
argument_list|(
name|xmax
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
comment|/* assumes \n comes as part of s */
block|}
end_block

begin_macro
name|space
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_comment
comment|/* set limits of page */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|X0
operator|=
name|x0
expr_stmt|;
name|Y0
operator|=
name|y0
expr_stmt|;
name|X1
operator|=
name|x1
expr_stmt|;
name|Y1
operator|=
name|y1
expr_stmt|;
name|xscale
operator|=
name|deltx
operator|==
literal|0.0
condition|?
literal|1.0
else|:
name|deltx
operator|/
operator|(
name|X1
operator|-
name|X0
operator|)
expr_stmt|;
name|yscale
operator|=
name|delty
operator|==
literal|0.0
condition|?
literal|1.0
else|:
name|delty
operator|/
operator|(
name|Y1
operator|-
name|Y0
operator|)
expr_stmt|;
block|}
end_block

begin_function
name|float
name|xconv
parameter_list|(
name|x
parameter_list|)
comment|/* convert x from external to internal form */
name|float
name|x
decl_stmt|;
block|{
return|return
operator|(
name|x
operator|-
name|X0
operator|)
operator|*
name|xscale
return|;
block|}
end_function

begin_function
name|float
name|xsc
parameter_list|(
name|x
parameter_list|)
comment|/* convert x from external to internal form, scaling only */
name|float
name|x
decl_stmt|;
block|{
return|return
operator|(
name|x
operator|)
operator|*
name|xscale
return|;
block|}
end_function

begin_function
name|float
name|yconv
parameter_list|(
name|y
parameter_list|)
comment|/* convert y from external to internal form */
name|float
name|y
decl_stmt|;
block|{
return|return
operator|(
name|Y1
operator|-
name|y
operator|)
operator|*
name|yscale
return|;
block|}
end_function

begin_function
name|float
name|ysc
parameter_list|(
name|y
parameter_list|)
comment|/* convert y from external to internal form, scaling only */
name|float
name|y
decl_stmt|;
block|{
return|return
operator|(
name|y
operator|)
operator|*
name|yscale
return|;
block|}
end_function

begin_macro
name|closepl
argument_list|(
argument|type
argument_list|)
end_macro

begin_comment
comment|/* clean up after finished */
end_comment

begin_decl_stmt
name|int
name|type
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|movehv
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
comment|/* get back to where we started */
if|if
condition|(
name|type
operator|==
literal|'F'
condition|)
name|printf
argument_list|(
literal|".PF\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|".sp 1+%.3fi\n"
argument_list|,
name|yconv
argument_list|(
name|ymin
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".PE\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|".if \\n(00 .fi\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|move
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_comment
comment|/* go to position x, y in external coords */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hgoto
argument_list|(
name|xconv
argument_list|(
name|x
argument_list|)
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|yconv
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|movehv
argument_list|(
argument|h
argument_list|,
argument|v
argument_list|)
end_macro

begin_comment
comment|/* go to internal position h, v */
end_comment

begin_decl_stmt
name|float
name|h
decl_stmt|,
name|v
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hgoto
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|vgoto
argument_list|(
name|v
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|hmot
argument_list|(
argument|n
argument_list|)
end_macro

begin_comment
comment|/* generate n units of horizontal motion */
end_comment

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hpos
operator|+=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|vmot
argument_list|(
argument|n
argument_list|)
end_macro

begin_comment
comment|/* generate n units of vertical motion */
end_comment

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|vpos
operator|+=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|hgoto
argument_list|(
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|hpos
operator|=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|vgoto
argument_list|(
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|vpos
operator|=
name|n
expr_stmt|;
block|}
end_block

begin_macro
name|hvflush
argument_list|()
end_macro

begin_comment
comment|/* get to proper point for output */
end_comment

begin_block
block|{
if|if
condition|(
name|hpos
operator|!=
name|htrue
condition|)
block|{
name|printf
argument_list|(
literal|"\\h'%.3fi'"
argument_list|,
name|hpos
operator|-
name|htrue
argument_list|)
expr_stmt|;
name|htrue
operator|=
name|hpos
expr_stmt|;
block|}
if|if
condition|(
name|vpos
operator|!=
name|vtrue
condition|)
block|{
name|printf
argument_list|(
literal|"\\v'%.3fi'"
argument_list|,
name|vpos
operator|-
name|vtrue
argument_list|)
expr_stmt|;
name|vtrue
operator|=
name|vpos
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|flyback
argument_list|()
end_macro

begin_comment
comment|/* return to upper left corner (entry point) */
end_comment

begin_block
block|{
name|printf
argument_list|(
literal|".sp -1\n"
argument_list|)
expr_stmt|;
name|htrue
operator|=
name|vtrue
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|troff
argument_list|(
argument|s
argument_list|)
end_macro

begin_comment
comment|/* output troff right here */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|label
argument_list|(
argument|s
argument_list|,
argument|t
argument_list|,
argument|nh
argument_list|)
end_macro

begin_comment
comment|/* text s of type t nh half-lines up */
end_comment

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|t
decl_stmt|,
name|nh
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|q
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|dprintf
argument_list|(
literal|"label: %s %o %d\n"
argument_list|,
name|s
argument_list|,
name|t
argument_list|,
name|nh
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|textshift
argument_list|)
expr_stmt|;
comment|/* shift down and left */
if|if
condition|(
name|t
operator|&
name|ABOVE
condition|)
name|nh
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|t
operator|&
name|BELOW
condition|)
name|nh
operator|--
expr_stmt|;
if|if
condition|(
name|nh
condition|)
name|printf
argument_list|(
literal|"\\v'%du*\\n(.vu/2u'"
argument_list|,
operator|-
name|nh
argument_list|)
expr_stmt|;
comment|/* just in case the text contains a quote: */
name|q
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|p
operator|=
name|s
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
if|if
condition|(
operator|*
name|p
operator|==
literal|'\''
condition|)
block|{
name|q
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|t
operator|&=
operator|~
operator|(
name|ABOVE
operator||
name|BELOW
operator|)
expr_stmt|;
if|if
condition|(
name|t
operator|&
name|LJUST
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|t
operator|&
name|RJUST
condition|)
block|{
if|if
condition|(
name|q
condition|)
name|printf
argument_list|(
literal|"\\h\\(ts-\\w\\(ts%s\\(tsu\\(ts%s"
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\h'-\\w'%s'u'%s"
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* CENTER */
if|if
condition|(
name|q
condition|)
name|printf
argument_list|(
literal|"\\h\\(ts-\\w\\(ts%s\\(tsu/2u\\(ts%s\\h\\(ts-\\w\\(ts%s\\(tsu/2u\\(ts"
argument_list|,
name|s
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\h'-\\w'%s'u/2u'%s\\h'-\\w'%s'u/2u'"
argument_list|,
name|s
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|line
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_comment
comment|/* draw line from x0,y0 to x1,y1 */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|arrow
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|,
argument|w
argument_list|,
argument|h
argument_list|,
argument|ang
argument_list|,
argument|nhead
argument_list|)
end_macro

begin_comment
comment|/* draw arrow (without shaft) */
end_comment

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|,
name|ang
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* head wid w, len h, rotated ang */
end_comment

begin_decl_stmt
name|int
name|nhead
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* and drawn with nhead lines */
end_comment

begin_block
block|{
name|double
name|alpha
decl_stmt|,
name|rot
decl_stmt|,
name|drot
decl_stmt|,
name|hyp
decl_stmt|;
name|float
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
name|i
decl_stmt|;
name|rot
operator|=
name|atan2
argument_list|(
name|w
operator|/
literal|2
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|hyp
operator|=
name|sqrt
argument_list|(
name|w
operator|/
literal|2
operator|*
name|w
operator|/
literal|2
operator|+
name|h
operator|*
name|h
argument_list|)
expr_stmt|;
name|alpha
operator|=
name|atan2
argument_list|(
name|y1
operator|-
name|y0
argument_list|,
name|x1
operator|-
name|x0
argument_list|)
operator|+
name|ang
expr_stmt|;
if|if
condition|(
name|nhead
operator|<
literal|2
condition|)
name|nhead
operator|=
literal|2
expr_stmt|;
name|dprintf
argument_list|(
literal|"rot=%g, hyp=%g, alpha=%g\n"
argument_list|,
name|rot
argument_list|,
name|hyp
argument_list|,
name|alpha
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|nhead
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|drot
operator|=
literal|2
operator|*
name|rot
operator|/
call|(
name|float
call|)
argument_list|(
name|nhead
operator|-
literal|1
argument_list|)
operator|*
operator|(
name|float
operator|)
name|i
expr_stmt|;
name|dx
operator|=
name|hyp
operator|*
name|cos
argument_list|(
name|alpha
operator|+
name|PI
operator|-
name|rot
operator|+
name|drot
argument_list|)
expr_stmt|;
name|dy
operator|=
name|hyp
operator|*
name|sin
argument_list|(
name|alpha
operator|+
name|PI
operator|-
name|rot
operator|+
name|drot
argument_list|)
expr_stmt|;
name|dprintf
argument_list|(
literal|"dx,dy = %g,%g\n"
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|line
argument_list|(
name|x1
operator|+
name|dx
argument_list|,
name|y1
operator|+
name|dy
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|box
argument_list|(
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x0
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x1
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cont
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|cont
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_comment
comment|/* continue line from here to x,y */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|float
name|h1
decl_stmt|,
name|v1
decl_stmt|;
name|float
name|dh
decl_stmt|,
name|dv
decl_stmt|;
name|h1
operator|=
name|xconv
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|v1
operator|=
name|yconv
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|dh
operator|=
name|h1
operator|-
name|hpos
expr_stmt|;
name|dv
operator|=
name|v1
operator|-
name|vpos
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\D'l%.3fi %.3fi'\n"
argument_list|,
name|dh
argument_list|,
name|dv
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
comment|/* expensive */
name|hpos
operator|=
name|h1
expr_stmt|;
name|vpos
operator|=
name|v1
expr_stmt|;
block|}
end_block

begin_macro
name|circle
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|r
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|r
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x
operator|-
name|r
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\D'c%.3fi'\n"
argument_list|,
name|xsc
argument_list|(
literal|2
operator|*
name|r
argument_list|)
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|spline
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|n
argument_list|,
argument|p
argument_list|,
argument|dashed
argument_list|,
argument|ddval
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|n
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* sic */
end_comment

begin_decl_stmt
name|int
name|dashed
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|float
name|ddval
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
name|float
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|float
name|xerr
decl_stmt|,
name|yerr
decl_stmt|;
if|if
condition|(
name|dashed
operator|&&
name|ddval
condition|)
name|printf
argument_list|(
literal|".nr 99 %.3fi\n"
argument_list|,
name|ddval
argument_list|)
expr_stmt|;
name|move
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|xerr
operator|=
name|yerr
operator|=
literal|0.0
expr_stmt|;
if|if
condition|(
name|dashed
condition|)
block|{
if|if
condition|(
name|ddval
condition|)
name|printf
argument_list|(
literal|"\\X'Pd \\n(99'\\D'q 0 0"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\X'Pd'\\D'q 0 0"
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"\\D'~"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
operator|*
name|n
condition|;
name|i
operator|+=
literal|2
control|)
block|{
name|dx
operator|=
name|xsc
argument_list|(
name|xerr
operator|+=
name|p
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|xerr
operator|-=
name|dx
operator|/
name|xscale
expr_stmt|;
name|dy
operator|=
name|ysc
argument_list|(
name|yerr
operator|+=
name|p
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|yerr
operator|-=
name|dy
operator|/
name|yscale
expr_stmt|;
name|printf
argument_list|(
literal|" %.3fi %.3fi"
argument_list|,
name|dx
argument_list|,
operator|-
name|dy
argument_list|)
expr_stmt|;
comment|/* WATCH SIGN */
block|}
if|if
condition|(
name|dashed
condition|)
name|printf
argument_list|(
literal|" 0 0'\\X'Ps'\n"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"'\n"
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ellipse
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|r1
argument_list|,
argument|r2
argument_list|)
end_macro

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|r1
decl_stmt|,
name|r2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|float
name|ir1
decl_stmt|,
name|ir2
decl_stmt|;
name|move
argument_list|(
name|x
operator|-
name|r1
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|ir1
operator|=
name|xsc
argument_list|(
name|r1
argument_list|)
expr_stmt|;
name|ir2
operator|=
name|ysc
argument_list|(
name|r2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\\D'e%.3fi %.3fi'\n"
argument_list|,
literal|2
operator|*
name|ir1
argument_list|,
literal|2
operator|*
name|abs
argument_list|(
name|ir2
argument_list|)
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|arc
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|,
argument|x0
argument_list|,
argument|y0
argument_list|,
argument|x1
argument_list|,
argument|y1
argument_list|)
end_macro

begin_comment
comment|/* draw arc with center x,y */
end_comment

begin_decl_stmt
name|float
name|x
decl_stmt|,
name|y
decl_stmt|,
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|hvflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"\\D'a%.3fi %.3fi %.3fi %.3fi'\n"
argument_list|,
name|xsc
argument_list|(
name|x
operator|-
name|x0
argument_list|)
argument_list|,
operator|-
name|ysc
argument_list|(
name|y
operator|-
name|y0
argument_list|)
argument_list|,
name|xsc
argument_list|(
name|x1
operator|-
name|x
argument_list|)
argument_list|,
operator|-
name|ysc
argument_list|(
name|y1
operator|-
name|y
argument_list|)
argument_list|)
expr_stmt|;
comment|/* WATCH SIGNS */
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|dot
argument_list|()
end_macro

begin_block
block|{
name|hvflush
argument_list|()
expr_stmt|;
comment|/* what character to draw here depends on what's available. */
comment|/* on the 202, l. is good but small. */
comment|/* in general, use a smaller, shifted period and hope */
name|printf
argument_list|(
literal|"\\&\\f1\\h'-.05m'\\v'.03m'\\s-3.\\s+3\\fP\n"
argument_list|)
expr_stmt|;
name|flyback
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

