begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)write1line.c	1.1 (CWI) 85/10/01"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/* t8.c: write out one line of output table */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_include
include|#
directive|include
file|"ext.h"
end_include

begin_define
define|#
directive|define
name|realsplit
value|((ct == 'a' || ct == 'n')&& table[nl][c].rcol)
end_define

begin_decl_stmt
name|int
name|watchout
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|once
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|topat
index|[
name|MAXCOL
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * i is line number for deciding format  * nl is line number for finding data  * usually identical  */
end_comment

begin_macro
name|putline
argument_list|(
argument|i
argument_list|,
argument|nl
argument_list|)
end_macro

begin_block
block|{
name|int
name|c
decl_stmt|,
name|lf
decl_stmt|,
name|ct
decl_stmt|,
name|form
decl_stmt|,
name|lwid
decl_stmt|,
name|vspf
decl_stmt|,
name|ip
decl_stmt|,
name|cmidx
decl_stmt|,
name|exvspen
decl_stmt|,
name|vforml
decl_stmt|;
name|int
name|vct
decl_stmt|,
name|chfont
decl_stmt|,
name|uphalf
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|size
decl_stmt|,
modifier|*
name|fn
decl_stmt|;
name|printf
argument_list|(
literal|".\\\" -- putline( %d, %d)\n"
argument_list|,
name|i
argument_list|,
name|nl
argument_list|)
expr_stmt|;
name|watchout
operator|=
name|vspf
operator|=
name|exvspen
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|once
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
operator|&&
operator|(
name|allflg
operator|||
name|boxflg
operator|||
name|dboxflg
operator|)
condition|)
name|fullwide
argument_list|(
literal|0
argument_list|,
name|dboxflg
condition|?
literal|'='
else|:
literal|'-'
argument_list|)
expr_stmt|;
if|if
condition|(
name|instead
index|[
name|nl
index|]
operator|==
literal|0
operator|&&
name|fullbot
index|[
name|nl
index|]
operator|==
literal|0
condition|)
block|{
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
name|s
operator|=
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0
condition|)
continue|continue;
if|if
condition|(
name|vspen
argument_list|(
name|s
argument_list|)
condition|)
block|{
for|for
control|(
name|ip
operator|=
name|nl
init|;
name|ip
operator|<
name|nlin
condition|;
name|ip
operator|=
name|next
argument_list|(
name|ip
argument_list|)
control|)
if|if
condition|(
operator|!
name|vspen
argument_list|(
name|s
operator|=
name|table
index|[
name|ip
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
break|break;
if|if
condition|(
operator|(
name|int
operator|)
name|s
operator|>
literal|0
operator|&&
operator|(
name|int
operator|)
name|s
operator|<
literal|128
condition|)
name|printf
argument_list|(
literal|".ne \\n(%c|u+\\n(.Vu\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|point
argument_list|(
name|s
argument_list|)
condition|)
continue|continue;
name|printf
argument_list|(
literal|".ne \\n(%c|u+\\n(.Vu\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|watchout
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|linestop
index|[
name|nl
index|]
condition|)
name|printf
argument_list|(
literal|".mk #%c\n"
argument_list|,
name|linestop
index|[
name|nl
index|]
operator|+
literal|'a'
operator|-
literal|1
argument_list|)
expr_stmt|;
name|lf
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|instead
index|[
name|nl
index|]
condition|)
block|{
name|puts
argument_list|(
name|instead
index|[
name|nl
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|fullbot
index|[
name|nl
index|]
condition|)
block|{
switch|switch
condition|(
name|ct
operator|=
name|fullbot
index|[
name|nl
index|]
condition|)
block|{
case|case
literal|'='
case|:
case|case
literal|'-'
case|:
name|fullwide
argument_list|(
name|nl
argument_list|,
name|ct
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
if|if
condition|(
name|instead
index|[
name|nl
index|]
operator|==
literal|0
operator|&&
name|fullbot
index|[
name|nl
index|]
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
name|vspf
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|lf
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|lf
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
name|vspf
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|vspf
condition|)
block|{
name|printf
argument_list|(
literal|".nr #^ \\n(\\*(#du\n"
argument_list|)
expr_stmt|;
comment|/* 		 * current line position relative to bottom 		 */
name|printf
argument_list|(
literal|".nr #- \\n(#^\n"
argument_list|)
expr_stmt|;
block|}
name|vspf
operator|=
literal|0
expr_stmt|;
name|chfont
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
name|s
operator|=
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0
condition|)
continue|continue;
name|chfont
operator||=
call|(
name|int
call|)
argument_list|(
name|font
index|[
name|stynum
index|[
name|nl
index|]
index|]
index|[
name|c
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|point
argument_list|(
name|s
argument_list|)
condition|)
continue|continue;
name|lf
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|lf
operator|>=
literal|0
operator|&&
name|vspen
argument_list|(
name|table
index|[
name|lf
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
name|printf
argument_list|(
literal|".if (\\n(%c|+\\n(^%c-1v)>\\n(#- .nr #- +(\\n(%c|+\\n(^%c-\\n(#--1v)\n"
argument_list|,
name|s
argument_list|,
literal|'a'
operator|+
name|c
argument_list|,
name|s
argument_list|,
literal|'a'
operator|+
name|c
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|".if (\\n(%c|+\\n(#^-1v)>\\n(#- .nr #- +(\\n(%c|+\\n(#^-\\n(#--1v)\n"
argument_list|,
name|s
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|allflg
operator|&&
name|once
operator|>
literal|0
condition|)
name|fullwide
argument_list|(
name|i
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
name|once
operator|=
literal|1
expr_stmt|;
name|runtabs
argument_list|(
name|i
argument_list|,
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|allh
argument_list|(
name|i
argument_list|)
operator|&&
operator|!
name|pr1403
condition|)
block|{
name|printf
argument_list|(
literal|".nr %d \\n(.v\n"
argument_list|,
name|SVS
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".vs \\n(.vu-\\n(.sp\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|chfont
condition|)
name|printf
argument_list|(
literal|".nr %2d \\n(.f\n"
argument_list|,
name|S1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".nr 35 1m\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\\&"
argument_list|)
expr_stmt|;
name|vct
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
name|uphalf
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|watchout
operator|==
literal|0
operator|&&
name|i
operator|+
literal|1
operator|<
name|nlin
operator|&&
operator|(
name|lf
operator|=
name|left
argument_list|(
name|i
argument_list|,
name|c
argument_list|,
operator|&
name|lwid
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
name|tohcol
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|drawvert
argument_list|(
name|lf
argument_list|,
name|i
argument_list|,
name|c
argument_list|,
name|lwid
argument_list|)
expr_stmt|;
name|vct
operator|+=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|rightl
operator|&&
name|c
operator|+
literal|1
operator|==
name|ncol
condition|)
continue|continue;
name|vforml
operator|=
name|i
expr_stmt|;
for|for
control|(
name|lf
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
init|;
name|lf
operator|>=
literal|0
operator|&&
name|vspen
argument_list|(
name|table
index|[
name|lf
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|;
name|lf
operator|=
name|prev
argument_list|(
name|lf
argument_list|)
control|)
name|vforml
operator|=
name|lf
expr_stmt|;
name|form
operator|=
name|ctype
argument_list|(
name|vforml
argument_list|,
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|form
operator|!=
literal|'s'
condition|)
block|{
name|ct
operator|=
operator|(
name|int
operator|)
name|reg
argument_list|(
name|c
argument_list|,
name|CLEFT
argument_list|)
expr_stmt|;
if|if
condition|(
name|form
operator|==
literal|'a'
condition|)
name|ct
operator|=
operator|(
name|int
operator|)
name|reg
argument_list|(
name|c
argument_list|,
name|CMID
argument_list|)
expr_stmt|;
if|if
condition|(
name|form
operator|==
literal|'n'
operator|&&
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|rcol
operator|&&
name|lused
index|[
name|c
index|]
operator|==
literal|0
condition|)
name|ct
operator|=
operator|(
name|int
operator|)
name|reg
argument_list|(
name|c
argument_list|,
name|CMID
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\\h'|\\n(%2su'"
argument_list|,
name|ct
argument_list|)
expr_stmt|;
block|}
name|s
operator|=
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
expr_stmt|;
name|fn
operator|=
name|font
index|[
name|stynum
index|[
name|vforml
index|]
index|]
index|[
name|c
index|]
expr_stmt|;
name|size
operator|=
name|csize
index|[
name|stynum
index|[
name|vforml
index|]
index|]
index|[
name|c
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|size
operator|==
literal|0
condition|)
name|size
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|ctop
index|[
name|stynum
index|[
name|nl
index|]
index|]
index|[
name|c
index|]
operator|&
name|HALFUP
operator|)
operator|!=
literal|0
operator|&&
name|pr1403
operator|==
literal|0
condition|)
name|uphalf
operator|=
literal|1
expr_stmt|;
switch|switch
condition|(
name|ct
operator|=
name|ctype
argument_list|(
name|vforml
argument_list|,
name|c
argument_list|)
condition|)
block|{
case|case
literal|'n'
case|:
case|case
literal|'a'
case|:
if|if
condition|(
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|rcol
condition|)
block|{
if|if
condition|(
name|lused
index|[
name|c
index|]
condition|)
block|{
comment|/* 					 * Zero field width 					 */
name|ip
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|ip
operator|>=
literal|0
condition|)
block|{
comment|/*  * Indentation is getting complete out of hand here, let's shift to  * the left  */
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|ip
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
block|{
if|if
condition|(
name|exvspen
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\\v'-(\\n(\\*(#du-\\n(^%cu"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmidx
condition|)
name|printf
argument_list|(
literal|"-((\\n(#-u-\\n(^%cu)/2u)"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
name|vct
operator|++
expr_stmt|;
if|if
condition|(
name|pr1403
condition|)
block|{
comment|/* 			 * Must round to whole lines (bwk?) 			 */
name|printf
argument_list|(
literal|"/1v*1v"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
name|exvspen
operator|=
literal|1
expr_stmt|;
block|}
block|}
comment|/*  * Restore layout of this source  */
block|}
name|printf
argument_list|(
literal|"%c%c"
argument_list|,
name|F1
argument_list|,
name|F2
argument_list|)
expr_stmt|;
if|if
condition|(
name|uphalf
condition|)
name|printf
argument_list|(
literal|"\\u"
argument_list|)
expr_stmt|;
name|puttext
argument_list|(
name|s
argument_list|,
name|fn
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|uphalf
condition|)
name|printf
argument_list|(
literal|"\\d"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|F1
argument_list|)
expr_stmt|;
block|}
name|s
operator|=
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|rcol
expr_stmt|;
name|form
operator|=
literal|1
expr_stmt|;
break|break;
block|}
case|case
literal|'c'
case|:
name|form
operator|=
literal|3
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|form
operator|=
literal|2
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|form
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'-'
case|:
case|case
literal|'='
case|:
if|if
condition|(
name|real
argument_list|(
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: line %d: Data ignored on table line %d\n"
argument_list|,
name|ifile
argument_list|,
name|iline
operator|-
literal|1
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|makeline
argument_list|(
name|i
argument_list|,
name|c
argument_list|,
name|ct
argument_list|)
expr_stmt|;
continue|continue;
default|default:
continue|continue;
block|}
if|if
condition|(
name|realsplit
condition|?
name|rused
index|[
name|c
index|]
else|:
name|used
index|[
name|c
index|]
condition|)
block|{
comment|/* 			 * Zero field width 			 */
comment|/* 			 * form: 1 left, 2 right, 3 center adjust 			 */
if|if
condition|(
name|ifline
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|makeline
argument_list|(
name|i
argument_list|,
name|c
argument_list|,
name|ifline
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|filler
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"\\l'|\\n(%2su\\&%s'"
argument_list|,
name|reg
argument_list|(
name|c
argument_list|,
name|CRIGHT
argument_list|)
argument_list|,
name|s
operator|+
literal|2
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|ip
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
expr_stmt|;
name|cmidx
operator|=
operator|(
name|ctop
index|[
name|stynum
index|[
name|nl
index|]
index|]
index|[
name|c
index|]
operator|&
operator|(
name|CTOP
operator||
name|CDOWN
operator|)
operator|)
operator|==
literal|0
expr_stmt|;
if|if
condition|(
name|ip
operator|>=
literal|0
condition|)
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|ip
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
block|{
if|if
condition|(
name|exvspen
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\\v'-(\\n(\\*(#du-\\n(^%cu"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmidx
condition|)
name|printf
argument_list|(
literal|"-((\\n(#-u-\\n(^%cu)/2u)"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
name|vct
operator|++
expr_stmt|;
if|if
condition|(
name|pr1403
condition|)
block|{
comment|/* 							 * Round to 							 * whole lines 							 */
name|printf
argument_list|(
literal|"/1v*1v"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|F1
argument_list|)
expr_stmt|;
if|if
condition|(
name|form
operator|!=
literal|1
condition|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|F2
argument_list|)
expr_stmt|;
if|if
condition|(
name|vspen
argument_list|(
name|s
argument_list|)
condition|)
name|vspf
operator|=
literal|1
expr_stmt|;
else|else
name|puttext
argument_list|(
name|s
argument_list|,
name|fn
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|form
operator|!=
literal|2
condition|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|F2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|F1
argument_list|)
expr_stmt|;
block|}
name|ip
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
expr_stmt|;
comment|/* 				 * Julian Onion mod (system III) 				 */
if|if
condition|(
name|ip
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|ip
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
block|{
name|exvspen
operator|=
operator|(
name|c
operator|+
literal|1
operator|<
name|ncol
operator|)
operator|&&
name|vspen
argument_list|(
name|table
index|[
name|ip
index|]
index|[
name|c
operator|+
literal|1
index|]
operator|.
name|col
argument_list|)
operator|&&
operator|(
name|topat
index|[
name|c
index|]
operator|==
name|topat
index|[
name|c
operator|+
literal|1
index|]
operator|)
operator|&&
operator|(
name|cmidx
operator|==
operator|(
operator|(
name|ctop
index|[
name|stynum
index|[
name|nl
index|]
index|]
index|[
name|c
operator|+
literal|1
index|]
operator|&
operator|(
name|CTOP
operator||
name|CDOWN
operator|)
operator|)
operator|==
literal|0
operator|)
operator|)
operator|&&
operator|(
name|left
argument_list|(
name|i
argument_list|,
name|c
operator|+
literal|1
argument_list|,
operator|&
name|lwid
argument_list|)
operator|<
literal|0
operator|)
expr_stmt|;
comment|/*    * IS THIS WRONG? SHOULD IT BE    * (cmidx = ...&& (cmidx = (ctop[stynum[nl]][c+1]&(CTOP|CDOWN) == 0))    */
if|if
condition|(
name|exvspen
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"\\v'(\\n(\\*(#du-\\n(^%cu"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmidx
condition|)
name|printf
argument_list|(
literal|"-((\\n(#-u-\\n(^%cu)/2u)"
argument_list|,
name|c
operator|+
literal|'a'
argument_list|)
expr_stmt|;
name|vct
operator|++
expr_stmt|;
if|if
condition|(
name|pr1403
condition|)
block|{
comment|/* 						 * Round to 						 * whole lines 						 */
name|printf
argument_list|(
literal|"/1v*1v"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"'"
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|exvspen
operator|=
literal|0
expr_stmt|;
block|}
comment|/* 		 * if lines need to be split for gcos 		 * here is the place for a backslash 		 */
if|if
condition|(
name|vct
operator|>
literal|7
operator|&&
name|c
operator|<
name|ncol
condition|)
block|{
name|printf
argument_list|(
literal|"\n.sp-1\n\\&"
argument_list|)
expr_stmt|;
name|vct
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|allh
argument_list|(
name|i
argument_list|)
operator|&&
operator|!
name|pr1403
condition|)
name|printf
argument_list|(
literal|".vs \\n(%du\n"
argument_list|,
name|SVS
argument_list|)
expr_stmt|;
if|if
condition|(
name|watchout
condition|)
name|funnies
argument_list|(
name|i
argument_list|,
name|nl
argument_list|)
expr_stmt|;
if|if
condition|(
name|vspf
condition|)
block|{
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
if|if
condition|(
name|vspen
argument_list|(
name|table
index|[
name|nl
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
operator|&&
operator|(
name|nl
operator|==
literal|0
operator|||
operator|(
name|lf
operator|=
name|prev
argument_list|(
name|nl
argument_list|)
operator|)
operator|<
literal|0
operator|||
operator|!
name|vspen
argument_list|(
name|table
index|[
name|lf
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|".nr ^%c \\n(#^u\n"
argument_list|,
literal|'a'
operator|+
name|c
argument_list|)
expr_stmt|;
name|topat
index|[
name|c
index|]
operator|=
name|nl
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|puttext
argument_list|(
argument|s
argument_list|,
argument|fn
argument_list|,
argument|size
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|size
decl_stmt|,
modifier|*
name|fn
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|point
argument_list|(
name|s
argument_list|)
condition|)
block|{
name|putfont
argument_list|(
name|fn
argument_list|)
expr_stmt|;
name|putsize
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|fn
operator|>
literal|0
condition|)
name|printf
argument_list|(
literal|"\\f\\n(%2d"
argument_list|,
name|S1
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|!=
literal|0
condition|)
name|putsize
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*  * write out funny diverted things  */
end_comment

begin_macro
name|funnies
argument_list|(
argument|stl
argument_list|,
argument|lin
argument_list|)
end_macro

begin_block
block|{
name|int
name|c
decl_stmt|,
name|s
decl_stmt|,
name|pl
decl_stmt|,
name|lwid
decl_stmt|,
name|dv
decl_stmt|,
name|lf
decl_stmt|,
name|ct
decl_stmt|;
name|char
modifier|*
name|fn
decl_stmt|;
specifier|extern
name|char
modifier|*
name|reg
parameter_list|()
function_decl|;
name|printf
argument_list|(
literal|".\\\" -- funnies\n"
argument_list|)
expr_stmt|;
comment|/* 	 * remember current vertical position 	 */
name|printf
argument_list|(
literal|".mk ##\n"
argument_list|)
expr_stmt|;
comment|/* 	 * bottom position 	 */
name|printf
argument_list|(
literal|".nr %d \\n(##\n"
argument_list|,
name|S1
argument_list|)
expr_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
name|s
operator|=
operator|(
name|int
operator|)
name|table
index|[
name|lin
index|]
index|[
name|c
index|]
operator|.
name|col
expr_stmt|;
if|if
condition|(
name|point
argument_list|(
name|s
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|s
operator|==
literal|0
condition|)
continue|continue;
name|printf
argument_list|(
literal|".sp |\\n(##u-1v\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".nr %d "
argument_list|,
name|SIND
argument_list|)
expr_stmt|;
for|for
control|(
name|pl
operator|=
name|stl
init|;
name|pl
operator|>=
literal|0
operator|&&
operator|!
name|isalpha
argument_list|(
name|ct
operator|=
name|ctype
argument_list|(
name|pl
argument_list|,
name|c
argument_list|)
argument_list|)
condition|;
name|pl
operator|=
name|prev
argument_list|(
name|pl
argument_list|)
control|)
empty_stmt|;
switch|switch
condition|(
name|ct
condition|)
block|{
case|case
literal|'n'
case|:
case|case
literal|'c'
case|:
name|printf
argument_list|(
literal|"(\\n(%2su+\\n(%2su-\\n(%c-u)/2u\n"
argument_list|,
name|reg
argument_list|(
name|c
argument_list|,
name|CLEFT
argument_list|)
argument_list|,
name|reg
argument_list|(
name|c
operator|-
literal|1
operator|+
name|ctspan
argument_list|(
name|lin
argument_list|,
name|c
argument_list|)
argument_list|,
name|CRIGHT
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|printf
argument_list|(
literal|"\\n(%2su\n"
argument_list|,
name|reg
argument_list|(
name|c
argument_list|,
name|CLEFT
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'a'
case|:
name|printf
argument_list|(
literal|"\\n(%2su\n"
argument_list|,
name|reg
argument_list|(
name|c
argument_list|,
name|CMID
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|printf
argument_list|(
literal|"\\n(%2su-\\n(%c-u\n"
argument_list|,
name|reg
argument_list|(
name|c
argument_list|,
name|CRIGHT
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|".in +\\n(%du\n"
argument_list|,
name|SIND
argument_list|)
expr_stmt|;
name|fn
operator|=
name|font
index|[
name|stynum
index|[
name|stl
index|]
index|]
index|[
name|c
index|]
expr_stmt|;
name|putfont
argument_list|(
name|fn
argument_list|)
expr_stmt|;
name|pl
operator|=
name|prev
argument_list|(
name|stl
argument_list|)
expr_stmt|;
if|if
condition|(
name|stl
operator|>
literal|0
operator|&&
name|pl
operator|>=
literal|0
operator|&&
name|vspen
argument_list|(
name|table
index|[
name|pl
index|]
index|[
name|c
index|]
operator|.
name|col
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|".sp |\\n(^%cu\n"
argument_list|,
literal|'a'
operator|+
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ctop
index|[
name|stynum
index|[
name|stl
index|]
index|]
index|[
name|c
index|]
operator|&
operator|(
name|CTOP
operator||
name|CDOWN
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|".nr %d \\n(#-u-\\n(^%c-\\n(%c|+1v\n"
argument_list|,
name|TMP
argument_list|,
literal|'a'
operator|+
name|c
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".if \\n(%d>0 .sp \\n(%du/2u"
argument_list|,
name|TMP
argument_list|,
name|TMP
argument_list|)
expr_stmt|;
comment|/* 				 * Round 				 */
if|if
condition|(
name|pr1403
condition|)
name|printf
argument_list|(
literal|"/1v*1v"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
name|printf
argument_list|(
literal|".%c+\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".in -\\n(%du\n"
argument_list|,
name|SIND
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|fn
operator|>
literal|0
condition|)
name|putfont
argument_list|(
literal|"P"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".mk %d\n"
argument_list|,
name|S2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".if \\n(%d>\\n(%d .nr %d \\n(%d\n"
argument_list|,
name|S2
argument_list|,
name|S1
argument_list|,
name|S1
argument_list|,
name|S2
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|".sp |\\n(%du\n"
argument_list|,
name|S1
argument_list|)
expr_stmt|;
for|for
control|(
name|c
operator|=
name|dv
operator|=
literal|0
init|;
name|c
operator|<
name|ncol
condition|;
name|c
operator|++
control|)
block|{
if|if
condition|(
name|stl
operator|+
literal|1
operator|<
name|nlin
operator|&&
operator|(
name|lf
operator|=
name|left
argument_list|(
name|stl
argument_list|,
name|c
argument_list|,
operator|&
name|lwid
argument_list|)
operator|)
operator|>=
literal|0
condition|)
block|{
if|if
condition|(
name|dv
operator|++
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|".sp -1\n"
argument_list|)
expr_stmt|;
name|tohcol
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|dv
operator|++
expr_stmt|;
name|drawvert
argument_list|(
name|lf
argument_list|,
name|stl
argument_list|,
name|c
argument_list|,
name|lwid
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dv
condition|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|putfont
argument_list|(
argument|fn
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|fn
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|fn
operator|&&
operator|*
name|fn
condition|)
name|printf
argument_list|(
name|fn
index|[
literal|1
index|]
condition|?
literal|"\\f(%.2s"
else|:
literal|"\\f%.2s"
argument_list|,
name|fn
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|putsize
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|s
operator|&&
operator|*
name|s
condition|)
name|printf
argument_list|(
literal|"\\s%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

