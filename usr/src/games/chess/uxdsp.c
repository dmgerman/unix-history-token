begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*   ALPHA interface for CHESS       Revision: 4-25-88       Copyright (C) 1986, 1987, 1988 Free Software Foundation, Inc.   Copyright (c) 1988  John Stanback    This file is part of CHESS.    CHESS is distributed in the hope that it will be useful,   but WITHOUT ANY WARRANTY.  No author or distributor   accepts responsibility to anyone for the consequences of using it   or for whether it serves any particular purpose or works at all,   unless he says so in writing.  Refer to the CHESS General Public   License for full details.    Everyone is granted permission to copy, modify and redistribute   CHESS, but only under the conditions described in the   CHESS General Public License.   A copy of this license is   supposed to have been given to you along with CHESS so you   can know your rights and responsibilities.  It should be in a   file named COPYING.  Among other things, the copyright notice   and this notice must be preserved on all copies. */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/times.h>
end_include

begin_include
include|#
directive|include
file|<sys/file.h>
end_include

begin_include
include|#
directive|include
file|<curses.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|"gnuchess.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|NEWMOVE
end_ifdef

begin_include
include|#
directive|include
file|"move.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
name|struct
name|tms
name|tmbuf1
decl_stmt|,
name|tmbuf2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|TerminateSearch
argument_list|()
decl_stmt|,
name|Die
argument_list|()
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|scanz
value|fflush(stdout),scanw
end_define

begin_define
define|#
directive|define
name|printz
value|printw
end_define

begin_macro
name|Initialize
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
name|initscr
argument_list|()
expr_stmt|;
name|crmode
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ExitChess
argument_list|()
end_macro

begin_block
block|{
name|nocrmode
argument_list|()
expr_stmt|;
name|endwin
argument_list|()
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Die
argument_list|()
end_macro

begin_block
block|{
name|char
name|s
index|[
literal|80
index|]
decl_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|ShowMessage
argument_list|(
literal|"Abort? "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"yes"
argument_list|)
operator|==
literal|0
condition|)
name|ExitChess
argument_list|()
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|TerminateSearch
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|timeout
operator|=
name|true
expr_stmt|;
name|bothsides
operator|=
name|false
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|InputCommand
argument_list|()
end_macro

begin_comment
comment|/*    Process the users command. If easy mode is OFF (the computer is     thinking on opponents time) and the program is out of book, then make     the 'hint' move on the board and call SelectMove() to find a response.     The user terminates the search by entering ^C (quit siqnal) before     entering a command. If the opponent does not make the hint move, then     set Sdepth to zero.  */
end_comment

begin_block
block|{
name|short
name|ok
decl_stmt|,
name|i
decl_stmt|,
name|tmp
decl_stmt|;
name|long
name|cnt
decl_stmt|,
name|rate
decl_stmt|,
name|t1
decl_stmt|,
name|t2
decl_stmt|;
name|unsigned
name|short
name|mv
decl_stmt|;
name|char
name|s
index|[
literal|80
index|]
decl_stmt|;
name|ok
operator|=
name|quit
operator|=
name|false
expr_stmt|;
name|player
operator|=
name|opponent
expr_stmt|;
name|ShowSidetomove
argument_list|()
expr_stmt|;
name|ft
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|hint
operator|>
literal|0
operator|&&
operator|!
name|easy
operator|&&
name|Book
operator|==
name|NULL
condition|)
block|{
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|time0
operator|=
name|time
argument_list|(
operator|(
name|long
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|algbr
argument_list|(
name|hint
operator|>>
literal|8
argument_list|,
name|hint
operator|&
literal|0xFF
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|mvstr1
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|epsquare
expr_stmt|;
if|if
condition|(
name|VerifyMove
argument_list|(
name|s
argument_list|,
literal|1
argument_list|,
operator|&
name|mv
argument_list|)
condition|)
block|{
name|PromptForMove
argument_list|()
expr_stmt|;
name|SelectMove
argument_list|(
name|computer
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|VerifyMove
argument_list|(
name|mvstr1
argument_list|,
literal|2
argument_list|,
operator|&
name|mv
argument_list|)
expr_stmt|;
if|if
condition|(
name|Sdepth
operator|>
literal|0
condition|)
name|Sdepth
operator|--
expr_stmt|;
block|}
name|ft
operator|=
name|time
argument_list|(
operator|(
name|long
operator|*
operator|)
literal|0
argument_list|)
operator|-
name|time0
expr_stmt|;
name|epsquare
operator|=
name|tmp
expr_stmt|;
block|}
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|Die
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|ok
operator|||
name|quit
operator|)
condition|)
block|{
name|PromptForMove
argument_list|()
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|player
operator|=
name|opponent
expr_stmt|;
name|ok
operator|=
name|VerifyMove
argument_list|(
name|s
argument_list|,
literal|0
argument_list|,
operator|&
name|mv
argument_list|)
expr_stmt|;
if|if
condition|(
name|ok
operator|&&
name|mv
operator|!=
name|hint
condition|)
block|{
name|Sdepth
operator|=
literal|0
expr_stmt|;
name|ft
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"bd"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"quit"
argument_list|)
operator|==
literal|0
condition|)
name|quit
operator|=
name|true
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"post"
argument_list|)
operator|==
literal|0
condition|)
name|post
operator|=
operator|!
name|post
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"edit"
argument_list|)
operator|==
literal|0
condition|)
name|EditBoard
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"go"
argument_list|)
operator|==
literal|0
condition|)
name|ok
operator|=
name|true
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"help"
argument_list|)
operator|==
literal|0
condition|)
name|help
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"force"
argument_list|)
operator|==
literal|0
condition|)
name|force
operator|=
operator|!
name|force
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"book"
argument_list|)
operator|==
literal|0
condition|)
name|Book
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"undo"
argument_list|)
operator|==
literal|0
operator|&&
name|GameCnt
operator|>=
literal|0
condition|)
name|Undo
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"new"
argument_list|)
operator|==
literal|0
condition|)
name|NewGame
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"list"
argument_list|)
operator|==
literal|0
condition|)
name|ListGame
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"level"
argument_list|)
operator|==
literal|0
condition|)
name|SelectLevel
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"hash"
argument_list|)
operator|==
literal|0
condition|)
name|hashflag
operator|=
operator|!
name|hashflag
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"beep"
argument_list|)
operator|==
literal|0
condition|)
name|beep
operator|=
operator|!
name|beep
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"Awindow"
argument_list|)
operator|==
literal|0
condition|)
name|ChangeAlphaWindow
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"Bwindow"
argument_list|)
operator|==
literal|0
condition|)
name|ChangeBetaWindow
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"hint"
argument_list|)
operator|==
literal|0
condition|)
name|GiveHint
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"both"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|bothsides
operator|=
operator|!
name|bothsides
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
name|SelectMove
argument_list|(
name|opponent
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ok
operator|=
name|true
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"reverse"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|reverse
operator|=
operator|!
name|reverse
expr_stmt|;
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"switch"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|computer
operator|=
name|otherside
index|[
name|computer
index|]
expr_stmt|;
name|opponent
operator|=
name|otherside
index|[
name|opponent
index|]
expr_stmt|;
name|force
operator|=
name|false
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
name|ok
operator|=
name|true
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"white"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|computer
operator|=
name|white
expr_stmt|;
name|opponent
operator|=
name|black
expr_stmt|;
name|ok
operator|=
name|true
expr_stmt|;
name|force
operator|=
name|false
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|computer
operator|=
name|black
expr_stmt|;
name|opponent
operator|=
name|white
expr_stmt|;
name|ok
operator|=
name|true
expr_stmt|;
name|force
operator|=
name|false
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"remove"
argument_list|)
operator|==
literal|0
operator|&&
name|GameCnt
operator|>=
literal|1
condition|)
block|{
name|Undo
argument_list|()
expr_stmt|;
name|Undo
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"get"
argument_list|)
operator|==
literal|0
condition|)
name|GetGame
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"save"
argument_list|)
operator|==
literal|0
condition|)
name|SaveGame
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"depth"
argument_list|)
operator|==
literal|0
condition|)
name|ChangeSearchDepth
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"random"
argument_list|)
operator|==
literal|0
condition|)
name|dither
operator|=
literal|6
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"easy"
argument_list|)
operator|==
literal|0
condition|)
name|easy
operator|=
operator|!
name|easy
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"contempt"
argument_list|)
operator|==
literal|0
condition|)
name|SetContempt
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"xwndw"
argument_list|)
operator|==
literal|0
condition|)
name|ChangeXwindow
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"test"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|t1
operator|=
name|time
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cnt
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10000
condition|;
name|i
operator|++
control|)
block|{
name|MoveList
argument_list|(
name|opponent
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|cnt
operator|+=
name|TrPnt
index|[
literal|3
index|]
operator|-
name|TrPnt
index|[
literal|2
index|]
expr_stmt|;
block|}
name|t2
operator|=
name|time
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|rate
operator|=
name|cnt
operator|/
operator|(
name|t2
operator|-
name|t1
operator|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"cnt= %ld  rate= %ld"
argument_list|,
name|cnt
argument_list|,
name|rate
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"p"
argument_list|)
operator|==
literal|0
condition|)
name|ShowPostnValues
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"debug"
argument_list|)
operator|==
literal|0
condition|)
name|DoDebug
argument_list|()
expr_stmt|;
block|}
name|ClearMessage
argument_list|()
expr_stmt|;
name|ElapsedTime
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|force
condition|)
block|{
name|computer
operator|=
name|opponent
expr_stmt|;
name|opponent
operator|=
name|otherside
index|[
name|computer
index|]
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|times
argument_list|(
operator|&
name|tmbuf1
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|TerminateSearch
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|TerminateSearch
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|EditBoard
argument_list|()
end_macro

begin_comment
comment|/*     Set up a board position. Pieces are entered by typing the piece     followed by the location. For example, Nf3 will place a knight on     square f3.  */
end_comment

begin_block
block|{
name|short
name|a
decl_stmt|,
name|r
decl_stmt|,
name|c
decl_stmt|,
name|sq
decl_stmt|;
name|char
name|s
index|[
literal|80
index|]
decl_stmt|;
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|".   Exit to main"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"#   Clear board"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|49
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Enter piece& location: "
argument_list|)
expr_stmt|;
name|a
operator|=
name|white
expr_stmt|;
do|do
block|{
name|gotoXY
argument_list|(
literal|73
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
block|{
for|for
control|(
name|sq
operator|=
literal|0
init|;
name|sq
operator|<
literal|64
condition|;
name|sq
operator|++
control|)
block|{
name|board
index|[
name|sq
index|]
operator|=
name|no_piece
expr_stmt|;
name|color
index|[
name|sq
index|]
operator|=
name|neutral
expr_stmt|;
block|}
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'c'
operator|||
name|s
index|[
literal|0
index|]
operator|==
literal|'C'
condition|)
name|a
operator|=
name|otherside
index|[
name|a
index|]
expr_stmt|;
name|c
operator|=
name|s
index|[
literal|1
index|]
operator|-
literal|'a'
expr_stmt|;
name|r
operator|=
name|s
index|[
literal|2
index|]
operator|-
literal|'1'
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|c
operator|<
literal|8
operator|)
operator|&&
operator|(
name|r
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|r
operator|<
literal|8
operator|)
condition|)
block|{
name|sq
operator|=
name|locn
index|[
name|r
index|]
index|[
name|c
index|]
expr_stmt|;
name|color
index|[
name|sq
index|]
operator|=
name|a
expr_stmt|;
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'p'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|pawn
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'n'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|knight
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'b'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|bishop
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'r'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|rook
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'q'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|queen
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'k'
condition|)
name|board
index|[
name|sq
index|]
operator|=
name|king
expr_stmt|;
else|else
block|{
name|board
index|[
name|sq
index|]
operator|=
name|no_piece
expr_stmt|;
name|color
index|[
name|sq
index|]
operator|=
name|neutral
expr_stmt|;
block|}
name|DrawPiece
argument_list|(
name|sq
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
name|s
index|[
literal|0
index|]
operator|!=
literal|'.'
condition|)
do|;
if|if
condition|(
name|board
index|[
literal|4
index|]
operator|!=
name|king
condition|)
name|kingmoved
index|[
name|white
index|]
operator|=
literal|10
expr_stmt|;
if|if
condition|(
name|board
index|[
literal|60
index|]
operator|!=
name|king
condition|)
name|kingmoved
index|[
name|black
index|]
operator|=
literal|10
expr_stmt|;
name|GameCnt
operator|=
operator|-
literal|1
expr_stmt|;
name|Game50
operator|=
literal|0
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
name|InitializeStats
argument_list|()
expr_stmt|;
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|help
argument_list|()
end_macro

begin_block
block|{
name|ClrScreen
argument_list|()
expr_stmt|;
name|gotoXY
argument_list|(
literal|28
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"CHESS command summary"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"g1f3      move from g1 to f3"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"nf3       move knight to f3"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"o-o       castle king side"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"o-o-o     castle queen side"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"edit      edit board"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"switch    sides with computer"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"white     computer plays white"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"black     computer plays black"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"reverse   board display"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"both      computer match"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"random    randomize play"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|1
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"undo      undo last move"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"level     change level"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"depth     set search depth"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"post      principle variation"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"hint      suggest a move"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"bd        redraw board"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"force     enter game moves"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"list      game to chess.lst"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"save      game to file"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"get       game from file"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"new       start new game"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|42
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"quit      exit CHESS"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|10
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Computer: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|computer
operator|==
name|white
condition|)
name|printz
argument_list|(
literal|"WHITE"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"BLACK"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|10
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Opponent: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|opponent
operator|==
name|white
condition|)
name|printz
argument_list|(
literal|"WHITE"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"BLACK"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|10
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Level: %ld"
argument_list|,
name|Level
argument_list|,
literal|" sec."
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|10
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Easy mode: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|easy
condition|)
name|printz
argument_list|(
literal|"ON"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"OFF"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|40
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Depth: %d"
argument_list|,
name|MaxSearchDepth
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|40
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Random: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dither
condition|)
name|printz
argument_list|(
literal|"ON"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"OFF"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|40
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Transposition table: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|hashflag
condition|)
name|printz
argument_list|(
literal|"ON"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"OFF"
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
while|while
condition|(
name|getchar
argument_list|()
operator|!=
literal|27
condition|)
empty_stmt|;
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ShowDepth
argument_list|(
argument|ch
argument_list|)
end_macro

begin_decl_stmt
name|char
name|ch
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Depth= %d%c "
argument_list|,
name|Sdepth
argument_list|,
name|ch
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ShowResults
argument_list|(
argument|score
argument_list|,
argument|bstline
argument_list|,
argument|ch
argument_list|)
end_macro

begin_decl_stmt
name|short
name|score
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|short
name|bstline
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ch
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|short
name|d
decl_stmt|,
name|e
decl_stmt|,
name|ply
decl_stmt|;
if|if
condition|(
name|post
operator|&&
name|player
operator|==
name|computer
condition|)
block|{
name|e
operator|=
name|lpost
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Score= %d"
argument_list|,
name|score
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
name|d
operator|=
literal|8
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
for|for
control|(
name|ply
operator|=
literal|1
init|;
name|bstline
index|[
name|ply
index|]
operator|>
literal|0
condition|;
name|ply
operator|++
control|)
block|{
name|algbr
argument_list|(
name|bstline
index|[
name|ply
index|]
operator|>>
literal|8
argument_list|,
name|bstline
index|[
name|ply
index|]
operator|&
literal|0xFF
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
name|ply
operator|==
literal|5
operator|||
name|ply
operator|==
literal|9
operator|||
name|ply
operator|==
literal|13
operator|||
name|ply
operator|==
literal|17
condition|)
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
operator|++
name|d
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
name|printz
argument_list|(
literal|"%5s "
argument_list|,
name|mvstr1
argument_list|)
expr_stmt|;
block|}
name|ClrEoln
argument_list|()
expr_stmt|;
name|lpost
operator|=
name|d
expr_stmt|;
while|while
condition|(
operator|++
name|d
operator|<=
name|e
condition|)
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|SearchStartStuff
argument_list|(
argument|side
argument_list|)
end_macro

begin_decl_stmt
name|short
name|side
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|short
name|i
decl_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|TerminateSearch
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|TerminateSearch
argument_list|)
expr_stmt|;
if|if
condition|(
name|player
operator|==
name|computer
condition|)
for|for
control|(
name|i
operator|=
literal|5
init|;
name|i
operator|<
literal|14
condition|;
name|i
operator|++
control|)
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|OutputMove
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|root
operator|->
name|flags
operator|&
name|epmask
condition|)
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|UpdateDisplay
argument_list|(
name|root
operator|->
name|f
argument_list|,
name|root
operator|->
name|t
argument_list|,
literal|0
argument_list|,
name|root
operator|->
name|flags
operator|&
name|cstlmask
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"My move is: %s"
argument_list|,
name|mvstr1
argument_list|)
expr_stmt|;
if|if
condition|(
name|beep
condition|)
name|putchar
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
if|if
condition|(
name|root
operator|->
name|flags
operator|&
name|draw
condition|)
name|printz
argument_list|(
literal|"Draw game!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|root
operator|->
name|score
operator|==
operator|-
literal|9999
condition|)
name|printz
argument_list|(
literal|"opponent mates!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|root
operator|->
name|score
operator|==
literal|9998
condition|)
name|printz
argument_list|(
literal|"computer mates!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|root
operator|->
name|score
operator|<
operator|-
literal|9000
condition|)
name|printz
argument_list|(
literal|"opponent will soon mate!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|root
operator|->
name|score
operator|>
literal|9000
condition|)
name|printz
argument_list|(
literal|"computer will soon mate!"
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
if|if
condition|(
name|post
condition|)
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Nodes=   %6ld"
argument_list|,
name|NodeCnt
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Nodes/Sec= %4ld"
argument_list|,
name|evrate
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|ElapsedTime
argument_list|(
argument|iop
argument_list|)
end_macro

begin_comment
comment|/*     Determine the time that has passed since the search was started. If     the elapsed time exceeds the target (ResponseTime+ExtraTime) then set     timeout to true which will terminate the search.  */
end_comment

begin_decl_stmt
name|short
name|iop
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|et
operator|=
name|time
argument_list|(
operator|(
name|long
operator|*
operator|)
literal|0
argument_list|)
operator|-
name|time0
expr_stmt|;
if|if
condition|(
name|et
operator|<
literal|0
condition|)
name|et
operator|=
literal|0
expr_stmt|;
name|ETnodes
operator|+=
literal|50
expr_stmt|;
if|if
condition|(
name|et
operator|>
name|et0
operator|||
name|iop
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|et
operator|>
name|ResponseTime
operator|+
name|ExtraTime
operator|&&
name|Sdepth
operator|>
literal|1
condition|)
name|timeout
operator|=
name|true
expr_stmt|;
name|et0
operator|=
name|et
expr_stmt|;
if|if
condition|(
name|iop
operator|==
literal|1
condition|)
block|{
name|time0
operator|=
name|time
argument_list|(
operator|(
name|long
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|et0
operator|=
literal|0
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|times
argument_list|(
operator|&
name|tmbuf2
argument_list|)
expr_stmt|;
name|cputimer
operator|=
literal|100
operator|*
operator|(
name|tmbuf2
operator|.
name|tms_utime
operator|-
name|tmbuf1
operator|.
name|tms_utime
operator|)
operator|/
name|HZ
expr_stmt|;
if|if
condition|(
name|cputimer
operator|>
literal|0
condition|)
name|evrate
operator|=
operator|(
literal|100
operator|*
name|NodeCnt
operator|)
operator|/
operator|(
name|cputimer
operator|+
literal|100
operator|*
name|ft
operator|)
expr_stmt|;
else|else
name|evrate
operator|=
literal|0
expr_stmt|;
name|ETnodes
operator|=
name|NodeCnt
operator|+
literal|50
expr_stmt|;
name|UpdateClocks
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|UpdateClocks
argument_list|()
end_macro

begin_block
block|{
name|short
name|m
decl_stmt|,
name|s
decl_stmt|;
name|m
operator|=
name|et
operator|/
literal|60
expr_stmt|;
name|s
operator|=
operator|(
name|et
operator|-
literal|60
operator|*
name|m
operator|)
expr_stmt|;
if|if
condition|(
name|TCflag
condition|)
block|{
name|m
operator|=
operator|(
name|TimeControl
operator|.
name|clock
index|[
name|player
index|]
operator|-
name|et
operator|)
operator|/
literal|60
expr_stmt|;
name|s
operator|=
name|TimeControl
operator|.
name|clock
index|[
name|player
index|]
operator|-
name|et
operator|-
literal|60
operator|*
name|m
expr_stmt|;
block|}
if|if
condition|(
name|m
operator|<
literal|0
condition|)
name|m
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|s
operator|<
literal|0
condition|)
name|s
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|player
operator|==
name|white
condition|)
if|if
condition|(
name|reverse
condition|)
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|else
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|23
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|reverse
condition|)
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|23
argument_list|)
expr_stmt|;
else|else
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"%d:%2d   "
argument_list|,
name|m
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|post
condition|)
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|22
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Nodes=   %6ld"
argument_list|,
name|NodeCnt
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Nodes/Sec= %4ld"
argument_list|,
name|evrate
argument_list|)
expr_stmt|;
block|}
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|SetTimeControl
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|TCflag
condition|)
block|{
name|TimeControl
operator|.
name|moves
index|[
name|white
index|]
operator|=
name|TimeControl
operator|.
name|moves
index|[
name|black
index|]
operator|=
name|TCmoves
expr_stmt|;
name|TimeControl
operator|.
name|clock
index|[
name|white
index|]
operator|=
name|TimeControl
operator|.
name|clock
index|[
name|black
index|]
operator|=
literal|60
operator|*
operator|(
name|long
operator|)
name|TCminutes
expr_stmt|;
block|}
else|else
block|{
name|TimeControl
operator|.
name|moves
index|[
name|white
index|]
operator|=
name|TimeControl
operator|.
name|moves
index|[
name|black
index|]
operator|=
literal|0
expr_stmt|;
name|TimeControl
operator|.
name|clock
index|[
name|white
index|]
operator|=
name|TimeControl
operator|.
name|clock
index|[
name|black
index|]
operator|=
literal|0
expr_stmt|;
name|Level
operator|=
literal|60
operator|*
operator|(
name|long
operator|)
name|TCminutes
expr_stmt|;
block|}
name|et
operator|=
literal|0
expr_stmt|;
name|ElapsedTime
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|gotoXY
argument_list|(
argument|x
argument_list|,
argument|y
argument_list|)
end_macro

begin_decl_stmt
name|short
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|move
argument_list|(
name|y
operator|-
literal|1
argument_list|,
name|x
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ClrScreen
argument_list|()
end_macro

begin_block
block|{
name|clear
argument_list|()
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ClrEoln
argument_list|()
end_macro

begin_block
block|{
name|clrtoeol
argument_list|()
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|DrawPiece
argument_list|(
argument|sq
argument_list|)
end_macro

begin_decl_stmt
name|short
name|sq
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|short
name|r
decl_stmt|,
name|c
decl_stmt|;
name|char
name|x
decl_stmt|;
if|if
condition|(
name|reverse
condition|)
name|r
operator|=
literal|7
operator|-
name|row
index|[
name|sq
index|]
expr_stmt|;
else|else
name|r
operator|=
name|row
index|[
name|sq
index|]
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|c
operator|=
literal|7
operator|-
name|column
index|[
name|sq
index|]
expr_stmt|;
else|else
name|c
operator|=
name|column
index|[
name|sq
index|]
expr_stmt|;
if|if
condition|(
name|color
index|[
name|sq
index|]
operator|==
name|black
condition|)
name|x
operator|=
literal|'*'
expr_stmt|;
else|else
name|x
operator|=
literal|' '
expr_stmt|;
name|gotoXY
argument_list|(
literal|5
operator|+
literal|5
operator|*
name|c
argument_list|,
literal|5
operator|+
literal|2
operator|*
operator|(
literal|7
operator|-
name|r
operator|)
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"%c%c "
argument_list|,
name|x
argument_list|,
name|pxx
index|[
name|board
index|[
name|sq
index|]
index|]
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|UpdateDisplay
argument_list|(
argument|f
argument_list|,
argument|t
argument_list|,
argument|flag
argument_list|,
argument|iscastle
argument_list|)
end_macro

begin_decl_stmt
name|short
name|f
decl_stmt|,
name|t
decl_stmt|,
name|flag
decl_stmt|,
name|iscastle
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|short
name|i
decl_stmt|,
name|l
decl_stmt|,
name|z
decl_stmt|;
if|if
condition|(
name|flag
condition|)
block|{
name|gotoXY
argument_list|(
literal|56
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"CHESS"
argument_list|)
expr_stmt|;
name|i
operator|=
literal|3
expr_stmt|;
name|gotoXY
argument_list|(
literal|3
argument_list|,
operator|++
name|i
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"|----|----|----|----|----|----|----|----|"
argument_list|)
expr_stmt|;
while|while
condition|(
name|i
operator|<
literal|19
condition|)
block|{
name|gotoXY
argument_list|(
literal|1
argument_list|,
operator|++
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|z
operator|=
operator|(
name|i
operator|/
literal|2
operator|)
operator|-
literal|1
expr_stmt|;
else|else
name|z
operator|=
literal|10
operator|-
operator|(
name|i
operator|/
literal|2
operator|)
expr_stmt|;
name|printz
argument_list|(
literal|"%d |    |    |    |    |    |    |    |    |"
argument_list|,
name|z
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|3
argument_list|,
operator|++
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|19
condition|)
name|printz
argument_list|(
literal|"+----+----+----+----+----+----+----+----+"
argument_list|)
expr_stmt|;
block|}
name|printz
argument_list|(
literal|"|----|----|----|----|----|----|----|----|"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|3
argument_list|,
literal|21
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|printz
argument_list|(
literal|"  h    g    f    e    d    c    b    a"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"  a    b    c    d    e    f    g    h"
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|gotoXY
argument_list|(
literal|5
argument_list|,
literal|23
argument_list|)
expr_stmt|;
else|else
name|gotoXY
argument_list|(
literal|5
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|computer
operator|==
name|black
condition|)
name|printz
argument_list|(
literal|"Computer"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"Human   "
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|gotoXY
argument_list|(
literal|5
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|else
name|gotoXY
argument_list|(
literal|5
argument_list|,
literal|23
argument_list|)
expr_stmt|;
if|if
condition|(
name|computer
operator|==
name|white
condition|)
name|printz
argument_list|(
literal|"Computer"
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"Human   "
argument_list|)
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
literal|64
condition|;
name|l
operator|++
control|)
name|DrawPiece
argument_list|(
name|l
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DrawPiece
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|DrawPiece
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
name|iscastle
condition|)
if|if
condition|(
name|t
operator|>
name|f
condition|)
block|{
name|DrawPiece
argument_list|(
name|f
operator|+
literal|3
argument_list|)
expr_stmt|;
name|DrawPiece
argument_list|(
name|t
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DrawPiece
argument_list|(
name|f
operator|-
literal|4
argument_list|)
expr_stmt|;
name|DrawPiece
argument_list|(
name|t
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|GetOpenings
argument_list|()
end_macro

begin_comment
comment|/*    Read in the Opening Book file and parse the algebraic notation for a     move into an unsigned integer format indicating the from and to     square. Create a linked list of opening lines of play, with     entry->next pointing to the next line and entry->move pointing to a     chunk of memory containing the moves. More Opening lines of up to 256     half moves may be added to gnuchess.book.  */
end_comment

begin_block
block|{
name|FILE
modifier|*
name|fd
decl_stmt|;
name|int
name|c
decl_stmt|,
name|i
decl_stmt|,
name|j
decl_stmt|,
name|side
decl_stmt|;
name|struct
name|BookEntry
modifier|*
name|entry
decl_stmt|;
name|unsigned
name|short
name|mv
decl_stmt|,
modifier|*
name|mp
decl_stmt|,
name|tmp
index|[
literal|100
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|fopen
argument_list|(
literal|"gnuchess.book"
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|Book
operator|=
name|NULL
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|side
operator|=
name|white
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|parse
argument_list|(
name|fd
argument_list|,
operator|&
name|mv
argument_list|,
name|side
argument_list|)
operator|)
operator|>=
literal|0
condition|)
if|if
condition|(
name|c
operator|==
literal|1
condition|)
block|{
name|tmp
index|[
operator|++
name|i
index|]
operator|=
name|mv
expr_stmt|;
name|side
operator|=
name|otherside
index|[
name|side
index|]
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|c
operator|==
literal|0
operator|&&
name|i
operator|>
literal|0
condition|)
block|{
name|entry
operator|=
operator|(
expr|struct
name|BookEntry
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|BookEntry
argument_list|)
argument_list|)
expr_stmt|;
name|mp
operator|=
operator|(
name|unsigned
name|short
operator|*
operator|)
name|malloc
argument_list|(
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
expr|sizeof
operator|(
name|unsigned
name|short
operator|)
argument_list|)
expr_stmt|;
name|entry
operator|->
name|mv
operator|=
name|mp
expr_stmt|;
name|entry
operator|->
name|next
operator|=
name|Book
expr_stmt|;
name|Book
operator|=
name|entry
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<=
name|i
condition|;
name|j
operator|++
control|)
operator|*
operator|(
name|mp
operator|++
operator|)
operator|=
name|tmp
index|[
name|j
index|]
expr_stmt|;
operator|*
name|mp
operator|=
literal|0
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|side
operator|=
name|white
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
name|int
name|parse
parameter_list|(
name|fd
parameter_list|,
name|mv
parameter_list|,
name|side
parameter_list|)
name|FILE
modifier|*
name|fd
decl_stmt|;
name|unsigned
name|short
modifier|*
name|mv
decl_stmt|;
name|short
name|side
decl_stmt|;
block|{
name|int
name|c
decl_stmt|,
name|i
decl_stmt|,
name|r1
decl_stmt|,
name|r2
decl_stmt|,
name|c1
decl_stmt|,
name|c2
decl_stmt|;
name|char
name|s
index|[
literal|100
index|]
decl_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
name|s
index|[
literal|0
index|]
operator|=
name|c
expr_stmt|;
while|while
condition|(
name|c
operator|!=
literal|' '
operator|&&
name|c
operator|!=
literal|'\n'
operator|&&
name|c
operator|!=
name|EOF
condition|)
name|s
index|[
operator|++
name|i
index|]
operator|=
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
expr_stmt|;
name|s
index|[
operator|++
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'!'
operator|||
name|i
operator|<
literal|3
condition|)
block|{
while|while
condition|(
name|c
operator|!=
literal|'\n'
operator|&&
name|c
operator|!=
name|EOF
condition|)
name|c
operator|=
name|getc
argument_list|(
name|fd
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|s
index|[
literal|4
index|]
operator|==
literal|'o'
condition|)
if|if
condition|(
name|side
operator|==
name|black
condition|)
operator|*
name|mv
operator|=
literal|0x3C3A
expr_stmt|;
else|else
operator|*
name|mv
operator|=
literal|0x0402
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'o'
condition|)
if|if
condition|(
name|side
operator|==
name|black
condition|)
operator|*
name|mv
operator|=
literal|0x3C3E
expr_stmt|;
else|else
operator|*
name|mv
operator|=
literal|0x0406
expr_stmt|;
else|else
block|{
name|c1
operator|=
name|s
index|[
literal|0
index|]
operator|-
literal|'a'
expr_stmt|;
name|r1
operator|=
name|s
index|[
literal|1
index|]
operator|-
literal|'1'
expr_stmt|;
name|c2
operator|=
name|s
index|[
literal|2
index|]
operator|-
literal|'a'
expr_stmt|;
name|r2
operator|=
name|s
index|[
literal|3
index|]
operator|-
literal|'1'
expr_stmt|;
operator|*
name|mv
operator|=
operator|(
name|locn
index|[
name|r1
index|]
index|[
name|c1
index|]
operator|<<
literal|8
operator|)
operator|+
name|locn
index|[
name|r2
index|]
index|[
name|c2
index|]
expr_stmt|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_macro
name|GetGame
argument_list|()
end_macro

begin_block
block|{
name|FILE
modifier|*
name|fd
decl_stmt|;
name|char
name|fname
index|[
literal|40
index|]
decl_stmt|;
name|int
name|c
decl_stmt|;
name|short
name|sq
decl_stmt|;
name|unsigned
name|short
name|m
decl_stmt|;
name|ShowMessage
argument_list|(
literal|"File name: "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
if|if
condition|(
name|fname
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|strcpy
argument_list|(
name|fname
argument_list|,
literal|"chess.000"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%hd%hd%hd"
argument_list|,
operator|&
name|computer
argument_list|,
operator|&
name|opponent
argument_list|,
operator|&
name|Game50
argument_list|)
expr_stmt|;
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%hd%hd%hd%hd"
argument_list|,
operator|&
name|castld
index|[
name|white
index|]
argument_list|,
operator|&
name|castld
index|[
name|black
index|]
argument_list|,
operator|&
name|kingmoved
index|[
name|white
index|]
argument_list|,
operator|&
name|kingmoved
index|[
name|black
index|]
argument_list|)
expr_stmt|;
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%hd%hd"
argument_list|,
operator|&
name|TCflag
argument_list|,
operator|&
name|OperatorTime
argument_list|)
expr_stmt|;
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%ld%ld%hd%hd"
argument_list|,
operator|&
name|TimeControl
operator|.
name|clock
index|[
name|white
index|]
argument_list|,
operator|&
name|TimeControl
operator|.
name|clock
index|[
name|black
index|]
argument_list|,
operator|&
name|TimeControl
operator|.
name|moves
index|[
name|white
index|]
argument_list|,
operator|&
name|TimeControl
operator|.
name|moves
index|[
name|black
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|sq
operator|=
literal|0
init|;
name|sq
operator|<
literal|64
condition|;
name|sq
operator|++
control|)
block|{
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%hd"
argument_list|,
operator|&
name|m
argument_list|)
expr_stmt|;
name|board
index|[
name|sq
index|]
operator|=
operator|(
name|m
operator|>>
literal|8
operator|)
expr_stmt|;
name|color
index|[
name|sq
index|]
operator|=
operator|(
name|m
operator|&
literal|0xFF
operator|)
expr_stmt|;
if|if
condition|(
name|color
index|[
name|sq
index|]
operator|==
literal|0
condition|)
name|color
index|[
name|sq
index|]
operator|=
name|neutral
expr_stmt|;
else|else
operator|--
name|color
index|[
name|sq
index|]
expr_stmt|;
block|}
name|GameCnt
operator|=
operator|-
literal|1
expr_stmt|;
name|c
operator|=
literal|'?'
expr_stmt|;
while|while
condition|(
name|c
operator|!=
name|EOF
condition|)
block|{
operator|++
name|GameCnt
expr_stmt|;
name|c
operator|=
name|fscanf
argument_list|(
name|fd
argument_list|,
literal|"%hd%hd%hd%ld%hd%hd%hd"
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|gmove
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|score
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|depth
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|nodes
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|time
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|piece
argument_list|,
operator|&
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
operator|==
literal|0
condition|)
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
operator|=
name|neutral
expr_stmt|;
else|else
operator|--
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
expr_stmt|;
block|}
name|GameCnt
operator|--
expr_stmt|;
if|if
condition|(
name|TimeControl
operator|.
name|clock
index|[
name|white
index|]
operator|>
literal|0
condition|)
name|TCflag
operator|=
name|true
expr_stmt|;
name|computer
operator|--
expr_stmt|;
name|opponent
operator|--
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fd
argument_list|)
expr_stmt|;
name|InitializeStats
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
block|}
end_block

begin_macro
name|SaveGame
argument_list|()
end_macro

begin_block
block|{
name|FILE
modifier|*
name|fd
decl_stmt|;
name|char
name|fname
index|[
literal|40
index|]
decl_stmt|;
name|short
name|sq
decl_stmt|,
name|i
decl_stmt|,
name|c
decl_stmt|;
name|ShowMessage
argument_list|(
literal|"File name: "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
if|if
condition|(
name|fname
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|||
name|access
argument_list|(
name|fname
argument_list|,
name|W_OK
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|strcpy
argument_list|(
name|fname
argument_list|,
literal|"chess.000"
argument_list|)
expr_stmt|;
name|fd
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d %d %d\n"
argument_list|,
name|computer
operator|+
literal|1
argument_list|,
name|opponent
operator|+
literal|1
argument_list|,
name|Game50
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d %d %d %d\n"
argument_list|,
name|castld
index|[
name|white
index|]
argument_list|,
name|castld
index|[
name|black
index|]
argument_list|,
name|kingmoved
index|[
name|white
index|]
argument_list|,
name|kingmoved
index|[
name|black
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d %d\n"
argument_list|,
name|TCflag
argument_list|,
name|OperatorTime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%ld %ld %d %d\n"
argument_list|,
name|TimeControl
operator|.
name|clock
index|[
name|white
index|]
argument_list|,
name|TimeControl
operator|.
name|clock
index|[
name|black
index|]
argument_list|,
name|TimeControl
operator|.
name|moves
index|[
name|white
index|]
argument_list|,
name|TimeControl
operator|.
name|moves
index|[
name|black
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|sq
operator|=
literal|0
init|;
name|sq
operator|<
literal|64
condition|;
name|sq
operator|++
control|)
block|{
if|if
condition|(
name|color
index|[
name|sq
index|]
operator|==
name|neutral
condition|)
name|c
operator|=
literal|0
expr_stmt|;
else|else
name|c
operator|=
name|color
index|[
name|sq
index|]
operator|+
literal|1
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d\n"
argument_list|,
literal|256
operator|*
name|board
index|[
name|sq
index|]
operator|+
name|c
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|GameCnt
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|GameList
index|[
name|i
index|]
operator|.
name|color
operator|==
name|neutral
condition|)
name|c
operator|=
literal|0
expr_stmt|;
else|else
name|c
operator|=
name|GameList
index|[
name|i
index|]
operator|.
name|color
operator|+
literal|1
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d %d %d %ld %d %d %d\n"
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|gmove
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|score
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|depth
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|nodes
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|time
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|piece
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ListGame
argument_list|()
end_macro

begin_block
block|{
name|FILE
modifier|*
name|fd
decl_stmt|;
name|short
name|i
decl_stmt|,
name|f
decl_stmt|,
name|t
decl_stmt|;
name|fd
operator|=
name|fopen
argument_list|(
literal|"chess.lst"
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"       score  depth  nodes  time         "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"       score  depth  nodes  time\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|GameCnt
condition|;
name|i
operator|++
control|)
block|{
name|f
operator|=
name|GameList
index|[
name|i
index|]
operator|.
name|gmove
operator|>>
literal|8
expr_stmt|;
name|t
operator|=
operator|(
name|GameList
index|[
name|i
index|]
operator|.
name|gmove
operator|&
literal|0xFF
operator|)
expr_stmt|;
name|algbr
argument_list|(
name|f
argument_list|,
name|t
argument_list|,
name|false
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|%
literal|2
operator|)
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"         "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%5s  %5d     %2d %6ld %5d"
argument_list|,
name|mvstr1
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|score
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|depth
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|nodes
argument_list|,
name|GameList
index|[
name|i
index|]
operator|.
name|time
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fd
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|Undo
argument_list|()
end_macro

begin_comment
comment|/*    Undo the most recent half-move. */
end_comment

begin_block
block|{
name|short
name|f
decl_stmt|,
name|t
decl_stmt|;
name|f
operator|=
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|gmove
operator|>>
literal|8
expr_stmt|;
name|t
operator|=
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|gmove
operator|&
literal|0xFF
expr_stmt|;
if|if
condition|(
name|board
index|[
name|t
index|]
operator|==
name|king
operator|&&
name|distance
argument_list|(
name|t
argument_list|,
name|f
argument_list|)
operator|>
literal|1
condition|)
name|castle
argument_list|(
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
argument_list|,
name|f
argument_list|,
name|t
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|else
block|{
name|board
index|[
name|f
index|]
operator|=
name|board
index|[
name|t
index|]
expr_stmt|;
name|color
index|[
name|f
index|]
operator|=
name|color
index|[
name|t
index|]
expr_stmt|;
name|board
index|[
name|t
index|]
operator|=
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|piece
expr_stmt|;
name|color
index|[
name|t
index|]
operator|=
name|GameList
index|[
name|GameCnt
index|]
operator|.
name|color
expr_stmt|;
if|if
condition|(
name|board
index|[
name|f
index|]
operator|==
name|king
condition|)
operator|--
name|kingmoved
index|[
name|color
index|[
name|f
index|]
index|]
expr_stmt|;
block|}
if|if
condition|(
name|TCflag
condition|)
operator|++
name|TimeControl
operator|.
name|moves
index|[
name|color
index|[
name|f
index|]
index|]
expr_stmt|;
name|GameCnt
operator|--
expr_stmt|;
name|mate
operator|=
name|false
expr_stmt|;
name|Sdepth
operator|=
literal|0
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|InitializeStats
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ShowMessage
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ClearMessage
argument_list|()
end_macro

begin_block
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ShowSidetomove
argument_list|()
end_macro

begin_block
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|14
argument_list|)
expr_stmt|;
if|if
condition|(
name|player
operator|==
name|white
condition|)
name|printz
argument_list|(
literal|"%2d:   WHITE"
argument_list|,
literal|1
operator|+
operator|(
name|GameCnt
operator|+
literal|1
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"%2d:   BLACK"
argument_list|,
literal|1
operator|+
operator|(
name|GameCnt
operator|+
literal|1
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|PromptForMove
argument_list|()
end_macro

begin_block
block|{
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|19
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Your move is? "
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|ShowCurrentMove
argument_list|(
argument|pnt
argument_list|,
argument|f
argument_list|,
argument|t
argument_list|)
end_macro

begin_decl_stmt
name|short
name|pnt
decl_stmt|,
name|f
decl_stmt|,
name|t
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|algbr
argument_list|(
name|f
argument_list|,
name|t
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"(%2d) %4s"
argument_list|,
name|pnt
argument_list|,
name|mvstr1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ChangeAlphaWindow
argument_list|()
end_macro

begin_block
block|{
name|ShowMessage
argument_list|(
literal|"window: "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%hd"
argument_list|,
operator|&
name|Awindow
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ChangeBetaWindow
argument_list|()
end_macro

begin_block
block|{
name|ShowMessage
argument_list|(
literal|"window: "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%hd"
argument_list|,
operator|&
name|Bwindow
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|GiveHint
argument_list|()
end_macro

begin_block
block|{
name|char
name|s
index|[
literal|40
index|]
decl_stmt|;
name|algbr
argument_list|(
call|(
name|short
call|)
argument_list|(
name|hint
operator|>>
literal|8
argument_list|)
argument_list|,
call|(
name|short
call|)
argument_list|(
name|hint
operator|&
literal|0xFF
argument_list|)
argument_list|,
name|false
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|s
argument_list|,
literal|"try "
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|s
argument_list|,
name|mvstr1
argument_list|)
expr_stmt|;
name|ShowMessage
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ChangeSearchDepth
argument_list|()
end_macro

begin_block
block|{
name|ShowMessage
argument_list|(
literal|"depth= "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%hd"
argument_list|,
operator|&
name|MaxSearchDepth
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|SetContempt
argument_list|()
end_macro

begin_block
block|{
name|ShowMessage
argument_list|(
literal|"contempt= "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%hd"
argument_list|,
operator|&
name|contempt
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ChangeXwindow
argument_list|()
end_macro

begin_block
block|{
name|ShowMessage
argument_list|(
literal|"xwndw= "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%hd"
argument_list|,
operator|&
name|xwndw
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|SelectLevel
argument_list|()
end_macro

begin_block
block|{
name|ClrScreen
argument_list|()
expr_stmt|;
name|gotoXY
argument_list|(
literal|32
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"CHESS"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 1.   60 moves in   5 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 2.   60 moves in  15 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 3.   60 moves in  30 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 4.   40 moves in  30 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 5.   40 moves in  60 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 6.   40 moves in 120 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 7.   40 moves in 240 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 8.    1 move  in  15 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|" 9.    1 move  in  60 minutes"
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"10.    1 move  in 600 minutes"
argument_list|)
expr_stmt|;
name|OperatorTime
operator|=
literal|0
expr_stmt|;
name|TCmoves
operator|=
literal|60
expr_stmt|;
name|TCminutes
operator|=
literal|5
expr_stmt|;
name|gotoXY
argument_list|(
literal|20
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Enter Level: "
argument_list|)
expr_stmt|;
name|refresh
argument_list|()
expr_stmt|;
name|scanz
argument_list|(
literal|"%ld"
argument_list|,
operator|&
name|Level
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|Level
condition|)
block|{
case|case
literal|1
case|:
name|TCmoves
operator|=
literal|60
expr_stmt|;
name|TCminutes
operator|=
literal|5
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|TCmoves
operator|=
literal|60
expr_stmt|;
name|TCminutes
operator|=
literal|15
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|TCmoves
operator|=
literal|60
expr_stmt|;
name|TCminutes
operator|=
literal|30
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|TCmoves
operator|=
literal|40
expr_stmt|;
name|TCminutes
operator|=
literal|30
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|TCmoves
operator|=
literal|40
expr_stmt|;
name|TCminutes
operator|=
literal|60
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|TCmoves
operator|=
literal|40
expr_stmt|;
name|TCminutes
operator|=
literal|120
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|TCmoves
operator|=
literal|40
expr_stmt|;
name|TCminutes
operator|=
literal|240
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|TCmoves
operator|=
literal|1
expr_stmt|;
name|TCminutes
operator|=
literal|15
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|TCmoves
operator|=
literal|1
expr_stmt|;
name|TCminutes
operator|=
literal|60
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|TCmoves
operator|=
literal|1
expr_stmt|;
name|TCminutes
operator|=
literal|600
expr_stmt|;
break|break;
block|}
name|TCflag
operator|=
operator|(
name|TCmoves
operator|>
literal|1
operator|)
expr_stmt|;
name|SetTimeControl
argument_list|()
expr_stmt|;
name|ClrScreen
argument_list|()
expr_stmt|;
name|UpdateDisplay
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ShowPostnValues
argument_list|()
end_macro

begin_block
block|{
name|short
name|i
decl_stmt|,
name|r
decl_stmt|,
name|c
decl_stmt|;
name|ExaminePosition
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|reverse
condition|)
name|r
operator|=
literal|7
operator|-
name|row
index|[
name|i
index|]
expr_stmt|;
else|else
name|r
operator|=
name|row
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|c
operator|=
literal|7
operator|-
name|column
index|[
name|i
index|]
expr_stmt|;
else|else
name|c
operator|=
name|column
index|[
name|i
index|]
expr_stmt|;
name|gotoXY
argument_list|(
literal|4
operator|+
literal|5
operator|*
name|c
argument_list|,
literal|5
operator|+
literal|2
operator|*
operator|(
literal|7
operator|-
name|r
operator|)
argument_list|)
expr_stmt|;
name|c1
operator|=
name|color
index|[
name|i
index|]
expr_stmt|;
name|c2
operator|=
name|otherside
index|[
name|c1
index|]
expr_stmt|;
name|PC1
operator|=
name|PawnCnt
index|[
name|c1
index|]
expr_stmt|;
name|PC2
operator|=
name|PawnCnt
index|[
name|c2
index|]
expr_stmt|;
name|atk1
operator|=
name|atak
index|[
name|c1
index|]
expr_stmt|;
name|atk2
operator|=
name|atak
index|[
name|c2
index|]
expr_stmt|;
if|if
condition|(
name|color
index|[
name|i
index|]
operator|==
name|neutral
condition|)
name|printz
argument_list|(
literal|"   "
argument_list|)
expr_stmt|;
else|else
name|printz
argument_list|(
literal|"%3d "
argument_list|,
name|SqValue
argument_list|(
name|i
argument_list|,
name|opponent
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|ScorePosition
argument_list|(
name|opponent
argument_list|,
operator|&
name|i
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Score= %d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|DoDebug
argument_list|()
end_macro

begin_block
block|{
name|short
name|k
decl_stmt|,
name|p
decl_stmt|,
name|i
decl_stmt|,
name|r
decl_stmt|,
name|c
decl_stmt|,
name|tp
decl_stmt|,
name|tc
decl_stmt|;
name|char
name|s
index|[
literal|40
index|]
decl_stmt|;
name|ExaminePosition
argument_list|()
expr_stmt|;
name|ShowMessage
argument_list|(
literal|"Enter piece: "
argument_list|)
expr_stmt|;
name|scanz
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'w'
condition|)
name|k
operator|=
name|white
expr_stmt|;
else|else
name|k
operator|=
name|black
expr_stmt|;
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'p'
condition|)
name|p
operator|=
name|pawn
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'n'
condition|)
name|p
operator|=
name|knight
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'b'
condition|)
name|p
operator|=
name|bishop
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'r'
condition|)
name|p
operator|=
name|rook
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'q'
condition|)
name|p
operator|=
name|queen
expr_stmt|;
elseif|else
if|if
condition|(
name|s
index|[
literal|1
index|]
operator|==
literal|'k'
condition|)
name|p
operator|=
name|king
expr_stmt|;
else|else
name|p
operator|=
name|no_piece
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|reverse
condition|)
name|r
operator|=
literal|7
operator|-
name|row
index|[
name|i
index|]
expr_stmt|;
else|else
name|r
operator|=
name|row
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|c
operator|=
literal|7
operator|-
name|column
index|[
name|i
index|]
expr_stmt|;
else|else
name|c
operator|=
name|column
index|[
name|i
index|]
expr_stmt|;
name|gotoXY
argument_list|(
literal|4
operator|+
literal|5
operator|*
name|c
argument_list|,
literal|5
operator|+
literal|2
operator|*
operator|(
literal|7
operator|-
name|r
operator|)
argument_list|)
expr_stmt|;
name|tp
operator|=
name|board
index|[
name|i
index|]
expr_stmt|;
name|tc
operator|=
name|color
index|[
name|i
index|]
expr_stmt|;
name|board
index|[
name|i
index|]
operator|=
name|p
expr_stmt|;
name|color
index|[
name|i
index|]
operator|=
name|k
expr_stmt|;
name|c1
operator|=
name|k
expr_stmt|;
name|c2
operator|=
name|otherside
index|[
name|c1
index|]
expr_stmt|;
name|PC1
operator|=
name|PawnCnt
index|[
name|c1
index|]
expr_stmt|;
name|PC2
operator|=
name|PawnCnt
index|[
name|c2
index|]
expr_stmt|;
name|atk1
operator|=
name|atak
index|[
name|c1
index|]
expr_stmt|;
name|atk2
operator|=
name|atak
index|[
name|c2
index|]
expr_stmt|;
name|printz
argument_list|(
literal|"%3d "
argument_list|,
name|SqValue
argument_list|(
name|i
argument_list|,
name|opponent
argument_list|)
argument_list|)
expr_stmt|;
name|board
index|[
name|i
index|]
operator|=
name|tp
expr_stmt|;
name|color
index|[
name|i
index|]
operator|=
name|tc
expr_stmt|;
block|}
name|ScorePosition
argument_list|(
name|opponent
argument_list|,
operator|&
name|i
argument_list|)
expr_stmt|;
name|gotoXY
argument_list|(
literal|50
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printz
argument_list|(
literal|"Score= %d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ClrEoln
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

