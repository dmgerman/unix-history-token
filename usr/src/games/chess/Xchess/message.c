begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* This file contains code for X-CHESS.    Copyright (C) 1986 Free Software Foundation, Inc.  This file is part of X-CHESS.  X-CHESS is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY.  No author or distributor accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless he says so in writing.  Refer to the X-CHESS General Public License for full details.  Everyone is granted permission to copy, modify and redistribute X-CHESS, but only under the conditions described in the X-CHESS General Public License.   A copy of this license is supposed to have been given to you along with X-CHESS so you can know your rights and responsibilities.  It should be in a file named COPYING.  Among other things, the copyright notice and this notice must be preserved on all copies.  */
end_comment

begin_comment
comment|/* RCS Info: $Revision: 1.4 $ on $Date: 86/11/26 12:10:22 $  *           $Source: /users/faustus/xchess/RCS/message.c,v $  * Copyright (c) 1986 Wayne A. Christopher, U. C. Berkeley CAD Group  *	Permission is granted to do anything with this code except sell it  *	or remove this message.  *  * Do stuff with the message window.  Font 0 is the normal font, font 1  * is large, and font 2 is normal red.  */
end_comment

begin_include
include|#
directive|include
file|"xchess.h"
end_include

begin_define
define|#
directive|define
name|MESSAGE_HEADER
value|"\n
value|1  XChess Messages
value|0\n"
end_define

begin_function
name|void
name|message_init
parameter_list|(
name|win
parameter_list|)
name|windata
modifier|*
name|win
decl_stmt|;
block|{
name|TxtGrab
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|"xchess"
argument_list|,
name|win
operator|->
name|medium
argument_list|,
name|win
operator|->
name|textback
operator|.
name|pixel
argument_list|,
name|win
operator|->
name|textcolor
operator|.
name|pixel
argument_list|,
name|win
operator|->
name|cursorcolor
operator|.
name|pixel
argument_list|)
expr_stmt|;
name|TxtAddFont
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|1
argument_list|,
name|win
operator|->
name|large
argument_list|,
name|win
operator|->
name|textcolor
operator|.
name|pixel
argument_list|)
expr_stmt|;
name|TxtAddFont
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|2
argument_list|,
name|win
operator|->
name|medium
argument_list|,
name|win
operator|->
name|errortext
operator|.
name|pixel
argument_list|)
expr_stmt|;
name|TxtAddFont
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|3
argument_list|,
name|win
operator|->
name|medium
argument_list|,
name|win
operator|->
name|playertext
operator|.
name|pixel
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
name|MESSAGE_HEADER
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|message_add
parameter_list|(
name|win
parameter_list|,
name|string
parameter_list|,
name|err
parameter_list|)
name|windata
modifier|*
name|win
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|bool
name|err
decl_stmt|;
block|{
if|if
condition|(
name|err
condition|)
block|{
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|"
literal|2"
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
name|string
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|"
literal|0"
argument_list|)
expr_stmt|;
name|XBell
argument_list|(
name|win
operator|->
name|display
argument_list|,
literal|50
argument_list|)
expr_stmt|;
block|}
else|else
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
name|string
argument_list|)
expr_stmt|;
name|XSync
argument_list|(
name|win
operator|->
name|display
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
name|void
name|message_send
parameter_list|(
name|win
parameter_list|,
name|event
parameter_list|)
name|windata
modifier|*
name|win
decl_stmt|;
name|XEvent
modifier|*
name|event
decl_stmt|;
block|{
name|XKeyEvent
modifier|*
name|ev
init|=
operator|&
name|event
operator|->
name|xkey
decl_stmt|;
name|KeySym
name|keysym
decl_stmt|;
name|windata
modifier|*
name|ow
init|=
operator|(
name|win
operator|==
name|win1
operator|)
condition|?
name|win2
else|:
name|win1
decl_stmt|;
name|char
name|buf
index|[
name|BSIZE
index|]
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|int
name|i
decl_stmt|;
name|i
operator|=
name|XLookupString
argument_list|(
name|ev
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
operator|-
literal|1
argument_list|,
operator|&
name|keysym
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
name|buf
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|s
operator|=
name|buf
init|;
operator|*
name|s
condition|;
name|s
operator|++
control|)
if|if
condition|(
operator|*
name|s
operator|==
literal|'\r'
condition|)
operator|*
name|s
operator|=
literal|'\n'
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|==
literal|'\177'
condition|)
operator|*
name|s
operator|=
literal|'
literal|'
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|"
literal|3"
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|win
operator|->
name|display
argument_list|,
name|win
operator|->
name|messagewin
argument_list|,
literal|"
literal|0"
argument_list|)
expr_stmt|;
name|XSync
argument_list|(
name|win
operator|->
name|display
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ow
condition|)
block|{
name|TxtWriteStr
argument_list|(
name|ow
operator|->
name|display
argument_list|,
name|ow
operator|->
name|messagewin
argument_list|,
literal|"
literal|3"
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|ow
operator|->
name|display
argument_list|,
name|ow
operator|->
name|messagewin
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|TxtWriteStr
argument_list|(
name|ow
operator|->
name|display
argument_list|,
name|ow
operator|->
name|messagewin
argument_list|,
literal|"
literal|0"
argument_list|)
expr_stmt|;
name|XSync
argument_list|(
name|ow
operator|->
name|display
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

end_unit

