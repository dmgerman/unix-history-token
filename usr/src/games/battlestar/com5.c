begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1983, 1993  *	The Regents of the University of California.  All rights reserved.  *  * %sccs.include.redist.c%  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)com5.c	8.2 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|"extern.h"
end_include

begin_macro
name|kiss
argument_list|()
end_macro

begin_block
block|{
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|!=
name|NOUNS
operator|&&
name|wordnumber
operator|<=
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordtype
index|[
name|wordnumber
index|]
operator|==
name|NOUNS
operator|&&
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|wordvalue
index|[
name|wordnumber
index|]
argument_list|)
condition|)
block|{
name|pleasure
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"Kissed.\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
condition|)
block|{
case|case
name|NORMGOD
case|:
switch|switch
condition|(
name|godready
operator|++
condition|)
block|{
case|case
literal|0
case|:
name|puts
argument_list|(
literal|"She squirms and avoids your advances."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts
argument_list|(
literal|"She is coming around; she didn't fight it as much."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts
argument_list|(
literal|"She's begining to like it."
argument_list|)
expr_stmt|;
break|break;
default|default:
name|puts
argument_list|(
literal|"She's gone limp."
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|NATIVE
case|:
name|puts
argument_list|(
literal|"The lips are warm and her body robust.  She pulls you down to the ground."
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIMER
case|:
name|puts
argument_list|(
literal|"The old man blushes."
argument_list|)
expr_stmt|;
break|break;
case|case
name|MAN
case|:
name|puts
argument_list|(
literal|"The dwarf punches you in the kneecap."
argument_list|)
expr_stmt|;
break|break;
default|default:
name|pleasure
operator|--
expr_stmt|;
block|}
block|}
else|else
name|puts
argument_list|(
literal|"I'd prefer not to."
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|love
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|!=
name|NOUNS
operator|&&
name|wordnumber
operator|<=
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordtype
index|[
name|wordnumber
index|]
operator|==
name|NOUNS
operator|&&
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|wordvalue
index|[
name|wordnumber
index|]
argument_list|)
condition|)
block|{
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|NORMGOD
operator|&&
operator|!
name|loved
condition|)
if|if
condition|(
name|godready
operator|>=
literal|2
condition|)
block|{
name|puts
argument_list|(
literal|"She cuddles up to you, and her mouth starts to work:\n'That was my sister's amulet.  The lovely goddess, Purl, was she.  The Empire\ncaptured her just after the Darkness came.  My other sister, Vert, was killed\nby the Dark Lord himself.  He took her amulet and warped its power.\nYour quest was foretold by my father before he died, but to get the Dark Lord's\namulet you must use cunning and skill.  I will leave you my amulet."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"which you may use as you wish.  As for me, I am the last goddess of the\nwaters.  My father was the Island King, and the rule is rightfully mine.'\n\nShe pulls the throne out into a large bed."
argument_list|)
expr_stmt|;
name|power
operator|++
expr_stmt|;
name|pleasure
operator|+=
literal|15
expr_stmt|;
name|ego
operator|++
expr_stmt|;
if|if
condition|(
name|card
argument_list|(
name|injuries
argument_list|,
name|NUMOFINJURIES
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"Her kisses revive you; your wounds are healed.\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|NUMOFINJURIES
condition|;
name|n
operator|++
control|)
name|injuries
index|[
name|n
index|]
operator|=
literal|0
expr_stmt|;
name|WEIGHT
operator|=
name|MAXWEIGHT
expr_stmt|;
name|CUMBER
operator|=
name|MAXCUMBER
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Goddess:\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|loved
condition|)
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|MEDALION
argument_list|)
expr_stmt|;
name|loved
operator|=
literal|1
expr_stmt|;
name|time
operator|+=
literal|10
expr_stmt|;
name|zzz
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|puts
argument_list|(
literal|"You wish!"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|NATIVE
condition|)
block|{
name|puts
argument_list|(
literal|"The girl is easy prey.  She peals off her sarong and indulges you."
argument_list|)
expr_stmt|;
name|power
operator|++
expr_stmt|;
name|pleasure
operator|+=
literal|5
expr_stmt|;
name|printf
argument_list|(
literal|"Girl:\n"
argument_list|)
expr_stmt|;
name|time
operator|+=
literal|10
expr_stmt|;
name|zzz
argument_list|()
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Loved.\n"
argument_list|)
expr_stmt|;
block|}
else|else
name|puts
argument_list|(
literal|"I't doesn't seem to work."
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|zzz
argument_list|()
end_macro

begin_block
block|{
name|int
name|oldtime
decl_stmt|;
specifier|register
name|int
name|n
decl_stmt|;
name|oldtime
operator|=
name|time
expr_stmt|;
if|if
condition|(
operator|(
name|snooze
operator|-
name|time
operator|)
operator|<
operator|(
literal|0.75
operator|*
name|CYCLE
operator|)
condition|)
block|{
name|time
operator|+=
literal|0.75
operator|*
name|CYCLE
operator|-
operator|(
name|snooze
operator|-
name|time
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|"<zzz>"
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|time
operator|-
name|oldtime
condition|;
name|n
operator|++
control|)
name|printf
argument_list|(
literal|"."
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|snooze
operator|+=
literal|3
operator|*
operator|(
name|time
operator|-
name|oldtime
operator|)
expr_stmt|;
if|if
condition|(
name|notes
index|[
name|LAUNCHED
index|]
condition|)
block|{
name|fuel
operator|-=
operator|(
name|time
operator|-
name|oldtime
operator|)
expr_stmt|;
if|if
condition|(
name|location
index|[
name|position
index|]
operator|.
name|down
condition|)
block|{
name|position
operator|=
name|location
index|[
name|position
index|]
operator|.
name|down
expr_stmt|;
name|crash
argument_list|()
expr_stmt|;
block|}
else|else
name|notes
index|[
name|LAUNCHED
index|]
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|OUTSIDE
operator|&&
name|rnd
argument_list|(
literal|100
argument_list|)
operator|<
literal|50
condition|)
block|{
name|puts
argument_list|(
literal|"You are awakened abruptly by the sound of someone nearby."
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|rnd
argument_list|(
literal|4
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
if|if
condition|(
name|ucard
argument_list|(
name|inven
argument_list|)
condition|)
block|{
name|n
operator|=
name|rnd
argument_list|(
name|NUMOFOBJECTS
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|testbit
argument_list|(
name|inven
argument_list|,
name|n
argument_list|)
condition|)
name|n
operator|=
name|rnd
argument_list|(
name|NUMOFOBJECTS
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|inven
argument_list|,
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|!=
name|AMULET
operator|&&
name|n
operator|!=
name|MEDALION
operator|&&
name|n
operator|!=
name|TALISMAN
condition|)
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|carrying
operator|-=
name|objwt
index|[
name|n
index|]
expr_stmt|;
name|encumber
operator|-=
name|objcumber
index|[
name|n
index|]
expr_stmt|;
block|}
name|puts
argument_list|(
literal|"A fiendish little Elf is stealing your treasures!"
argument_list|)
expr_stmt|;
name|fight
argument_list|(
name|ELF
argument_list|,
literal|10
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|DEADWOOD
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|HALBERD
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
else|else
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|chime
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|(
name|time
operator|/
name|CYCLE
operator|+
literal|1
operator|)
operator|%
literal|2
operator|&&
name|OUTSIDE
condition|)
switch|switch
condition|(
operator|(
name|time
operator|%
name|CYCLE
operator|)
operator|/
operator|(
name|CYCLE
operator|/
literal|7
operator|)
condition|)
block|{
case|case
literal|0
case|:
name|puts
argument_list|(
literal|"It is just after sunrise."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts
argument_list|(
literal|"It is early morning."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts
argument_list|(
literal|"It is late morning."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts
argument_list|(
literal|"It is near noon."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|puts
argument_list|(
literal|"It is early afternoon."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|puts
argument_list|(
literal|"It is late afternoon."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|puts
argument_list|(
literal|"It is near sunset."
argument_list|)
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|OUTSIDE
condition|)
switch|switch
condition|(
operator|(
name|time
operator|%
name|CYCLE
operator|)
operator|/
operator|(
name|CYCLE
operator|/
literal|7
operator|)
condition|)
block|{
case|case
literal|0
case|:
name|puts
argument_list|(
literal|"It is just after sunset."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|puts
argument_list|(
literal|"It is early evening."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|puts
argument_list|(
literal|"The evening is getting old."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|puts
argument_list|(
literal|"It is near midnight."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|puts
argument_list|(
literal|"These are the wee hours of the morning."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|puts
argument_list|(
literal|"The night is waning."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|puts
argument_list|(
literal|"It is almost morning."
argument_list|)
expr_stmt|;
break|break;
block|}
else|else
name|puts
argument_list|(
literal|"I can't tell the time in here."
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|give
argument_list|()
end_macro

begin_block
block|{
name|int
name|obj
init|=
operator|-
literal|1
decl_stmt|,
name|result
init|=
operator|-
literal|1
decl_stmt|,
name|person
init|=
literal|0
decl_stmt|,
name|firstnumber
decl_stmt|,
name|last1
decl_stmt|,
name|last2
decl_stmt|;
name|firstnumber
operator|=
name|wordnumber
expr_stmt|;
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|!=
name|OBJECT
operator|&&
name|wordvalue
index|[
name|wordnumber
index|]
operator|!=
name|AMULET
operator|&&
name|wordvalue
index|[
name|wordnumber
index|]
operator|!=
name|MEDALION
operator|&&
name|wordvalue
index|[
name|wordnumber
index|]
operator|!=
name|TALISMAN
operator|&&
name|wordnumber
operator|<=
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordnumber
operator|<=
name|wordcount
condition|)
block|{
name|obj
operator|=
name|wordvalue
index|[
name|wordnumber
index|]
expr_stmt|;
if|if
condition|(
name|obj
operator|==
name|EVERYTHING
condition|)
name|wordtype
index|[
name|wordnumber
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|last1
operator|=
name|wordnumber
expr_stmt|;
block|}
name|wordnumber
operator|=
name|firstnumber
expr_stmt|;
while|while
condition|(
operator|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|!=
name|NOUNS
operator|||
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|obj
operator|)
operator|&&
name|wordnumber
operator|<=
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordtype
index|[
name|wordnumber
index|]
operator|==
name|NOUNS
condition|)
block|{
name|person
operator|=
name|wordvalue
index|[
name|wordnumber
index|]
expr_stmt|;
name|last2
operator|=
name|wordnumber
expr_stmt|;
block|}
name|wordnumber
operator|=
name|last1
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|person
operator|&&
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|person
argument_list|)
condition|)
if|if
condition|(
name|person
operator|==
name|NORMGOD
operator|&&
name|godready
operator|<
literal|2
operator|&&
operator|!
operator|(
name|obj
operator|==
name|RING
operator|||
name|obj
operator|==
name|BRACELET
operator|)
condition|)
name|puts
argument_list|(
literal|"The goddess won't look at you."
argument_list|)
expr_stmt|;
else|else
name|result
operator|=
name|drop
argument_list|(
literal|"Given"
argument_list|)
expr_stmt|;
else|else
block|{
name|puts
argument_list|(
literal|"I don't think that is possible."
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|result
operator|!=
operator|-
literal|1
operator|&&
operator|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|obj
argument_list|)
operator|||
name|obj
operator|==
name|AMULET
operator|||
name|obj
operator|==
name|MEDALION
operator|||
name|obj
operator|==
name|TALISMAN
operator|)
condition|)
block|{
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|time
operator|++
expr_stmt|;
name|ego
operator|++
expr_stmt|;
switch|switch
condition|(
name|person
condition|)
block|{
case|case
name|NATIVE
case|:
name|puts
argument_list|(
literal|"She accepts it shyly."
argument_list|)
expr_stmt|;
name|ego
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
name|NORMGOD
case|:
if|if
condition|(
name|obj
operator|==
name|RING
operator|||
name|obj
operator|==
name|BRACELET
condition|)
block|{
name|puts
argument_list|(
literal|"She takes the charm and puts it on.  A little kiss on the cheek is"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"your reward."
argument_list|)
expr_stmt|;
name|ego
operator|+=
literal|5
expr_stmt|;
name|godready
operator|+=
literal|3
expr_stmt|;
block|}
if|if
condition|(
name|obj
operator|==
name|AMULET
operator|||
name|obj
operator|==
name|MEDALION
operator|||
name|obj
operator|==
name|TALISMAN
condition|)
block|{
name|win
operator|++
expr_stmt|;
name|ego
operator|+=
literal|5
expr_stmt|;
name|power
operator|-=
literal|5
expr_stmt|;
if|if
condition|(
name|win
operator|>=
literal|3
condition|)
block|{
name|puts
argument_list|(
literal|"The powers of the earth are now legitimate.  You have destroyed the Darkness"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"and restored the goddess to her thrown.  The entire island celebrates with"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"dancing and spring feasts.  As a measure of her gratitude, the goddess weds you"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"in the late summer and crowns you Prince Liverwort, Lord of Fungus."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"\nBut, as the year wears on and autumn comes along, you become restless and"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"yearn for adventure.  The goddess, too, realizes that the marriage can't last."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"She becomes bored and takes several more natives as husbands.  One evening,"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"after having been out drinking with the girls, she kicks the throne particulary"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"hard and wakes you up.  (If you want to win this game, you're going to have to\nshoot her!)"
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|MEDALION
argument_list|)
expr_stmt|;
name|wintime
operator|=
name|time
expr_stmt|;
block|}
block|}
break|break;
case|case
name|TIMER
case|:
if|if
condition|(
name|obj
operator|==
name|COINS
condition|)
block|{
name|puts
argument_list|(
literal|"He fingers the coins for a moment and then looks up agape.  `Kind you are and"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"I mean to repay you as best I can.'  Grabbing a pencil and cocktail napkin...\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"+-----------------------------------------------------------------------------+\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				   xxxxxxxx\\				      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				       xxxxx\\	CLIFFS			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|		FOREST			  xxx\\				      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				\\\\	     x\\        	OCEAN		      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				||	       x\\			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				||  ROAD	x\\			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				||		x\\			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|		SECRET		||	  .........			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|		 - + -		||	   ........			      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|		ENTRANCE	||		...      BEACH		      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				||		...		  E	      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				||		...		  |	      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|				//		...	    N<-- + --- S     |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|		PALM GROVE     //		...		  |	      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"|			      //		...		  W	      |\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"+-----------------------------------------------------------------------------+\n"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"\n`This map shows a secret entrance to the catacombs."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"You will know when you arrive because I left an old pair of shoes there.'"
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
name|wordnumber
operator|=
name|max
argument_list|(
name|last1
argument_list|,
name|last2
argument_list|)
expr_stmt|;
return|return
operator|(
name|firstnumber
operator|)
return|;
block|}
end_block

end_unit

