begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)com2.c	1.1 %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"externs.h"
end_include

begin_macro
name|wearit
argument_list|()
end_macro

begin_comment
comment|/* synonyms = {sheathe, sheath} */
end_comment

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
name|int
name|firstnumber
decl_stmt|,
name|value
decl_stmt|;
name|firstnumber
operator|=
name|wordnumber
expr_stmt|;
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|==
name|ADJS
condition|)
empty_stmt|;
while|while
condition|(
name|wordnumber
operator|<=
name|wordcount
condition|)
block|{
name|value
operator|=
name|wordvalue
index|[
name|wordnumber
index|]
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|objsht
index|[
name|value
index|]
index|[
name|n
index|]
condition|;
name|n
operator|++
control|)
empty_stmt|;
switch|switch
condition|(
name|value
condition|)
block|{
case|case
operator|-
literal|1
case|:
name|puts
argument_list|(
literal|"Wear what?"
argument_list|)
expr_stmt|;
return|return
operator|(
name|firstnumber
operator|)
return|;
default|default:
name|printf
argument_list|(
literal|"You can't wear%s%s!\n"
argument_list|,
operator|(
name|objsht
index|[
name|value
index|]
index|[
name|n
operator|-
literal|1
index|]
operator|==
literal|'s'
condition|?
literal|" "
else|:
literal|" a "
operator|)
argument_list|,
name|objsht
index|[
name|value
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|firstnumber
operator|)
return|;
case|case
name|KNIFE
case|:
comment|/*	case SHIRT:	*/
case|case
name|ROBE
case|:
case|case
name|LEVIS
case|:
comment|/* wearable things */
case|case
name|SWORD
case|:
case|case
name|MAIL
case|:
case|case
name|HELM
case|:
case|case
name|SHOES
case|:
case|case
name|PAJAMAS
case|:
case|case
name|COMPASS
case|:
case|case
name|LASER
case|:
case|case
name|AMULET
case|:
case|case
name|TALISMAN
case|:
case|case
name|MEDALION
case|:
case|case
name|ROPE
case|:
case|case
name|RING
case|:
case|case
name|BRACELET
case|:
case|case
name|GRENADE
case|:
if|if
condition|(
name|testbit
argument_list|(
name|inven
argument_list|,
name|value
argument_list|)
condition|)
block|{
name|clearbit
argument_list|(
name|inven
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|wear
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|carrying
operator|-=
name|objwt
index|[
name|value
index|]
expr_stmt|;
name|encumber
operator|-=
name|objcumber
index|[
name|value
index|]
expr_stmt|;
name|time
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"You are now wearing %s %s.\n"
argument_list|,
operator|(
name|objsht
index|[
name|value
index|]
index|[
name|n
operator|-
literal|1
index|]
operator|==
literal|'s'
condition|?
literal|"the"
else|:
literal|"a"
operator|)
argument_list|,
name|objsht
index|[
name|value
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|testbit
argument_list|(
name|wear
argument_list|,
name|value
argument_list|)
condition|)
name|printf
argument_list|(
literal|"You are already wearing the %s.\n"
argument_list|,
name|objsht
index|[
name|value
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"You aren't holding the %s.\n"
argument_list|,
name|objsht
index|[
name|value
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|wordnumber
operator|<
name|wordcount
operator|-
literal|1
operator|&&
name|wordvalue
index|[
operator|++
name|wordnumber
index|]
operator|==
name|AND
condition|)
name|wordnumber
operator|++
expr_stmt|;
else|else
return|return
operator|(
name|firstnumber
operator|)
return|;
block|}
comment|/* end switch */
block|}
comment|/* end while */
name|puts
argument_list|(
literal|"Don't be ridiculous."
argument_list|)
expr_stmt|;
return|return
operator|(
name|firstnumber
operator|)
return|;
block|}
end_block

begin_macro
name|put
argument_list|()
end_macro

begin_comment
comment|/* synonyms = {buckle, strap, tie} */
end_comment

begin_block
block|{
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
operator|+
literal|1
index|]
operator|==
name|ON
condition|)
block|{
name|wordvalue
index|[
operator|++
name|wordnumber
index|]
operator|=
name|PUTON
expr_stmt|;
return|return
operator|(
name|cypher
argument_list|()
operator|)
return|;
block|}
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
operator|+
literal|1
index|]
operator|==
name|DOWN
condition|)
block|{
name|wordvalue
index|[
operator|++
name|wordnumber
index|]
operator|=
name|DROP
expr_stmt|;
return|return
operator|(
name|cypher
argument_list|()
operator|)
return|;
block|}
name|puts
argument_list|(
literal|"I don't understand what you want to put."
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|draw
argument_list|()
end_macro

begin_comment
comment|/* synonyms = {pull, carry} */
end_comment

begin_block
block|{
return|return
operator|(
name|take
argument_list|(
name|wear
argument_list|)
operator|)
return|;
block|}
end_block

begin_macro
name|use
argument_list|()
end_macro

begin_block
block|{
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|==
name|ADJS
operator|&&
name|wordnumber
operator|<
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|AMULET
operator|&&
name|testbit
argument_list|(
name|inven
argument_list|,
name|AMULET
argument_list|)
operator|&&
name|position
operator|!=
name|FINAL
condition|)
block|{
name|puts
argument_list|(
literal|"The amulet begins to glow."
argument_list|)
expr_stmt|;
if|if
condition|(
name|testbit
argument_list|(
name|inven
argument_list|,
name|MEDALION
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"The medallion comes to life too."
argument_list|)
expr_stmt|;
if|if
condition|(
name|position
operator|==
literal|114
condition|)
block|{
name|location
index|[
name|position
index|]
operator|.
name|down
operator|=
literal|160
expr_stmt|;
name|whichway
argument_list|(
name|location
index|[
name|position
index|]
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"The waves subside and it is possible to descend to the sea cave now."
argument_list|)
expr_stmt|;
name|time
operator|++
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
name|puts
argument_list|(
literal|"A light mist falls over your eyes and the sound of purling water trickles in"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"your ears.   When the mist lifts you are standing beside a cool stream."
argument_list|)
expr_stmt|;
if|if
condition|(
name|position
operator|==
literal|229
condition|)
name|position
operator|=
literal|224
expr_stmt|;
else|else
name|position
operator|=
literal|229
expr_stmt|;
name|time
operator|++
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|position
operator|==
name|FINAL
condition|)
name|puts
argument_list|(
literal|"The amulet won't work in here."
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|COMPASS
operator|&&
name|testbit
argument_list|(
name|inven
argument_list|,
name|COMPASS
argument_list|)
condition|)
name|printf
argument_list|(
literal|"Your compass points %s.\n"
argument_list|,
name|truedirec
argument_list|(
name|NORTH
argument_list|,
literal|'-'
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|COMPASS
condition|)
name|puts
argument_list|(
literal|"You aren't holding the compass."
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
operator|==
name|AMULET
condition|)
name|puts
argument_list|(
literal|"You aren't holding the amulet."
argument_list|)
expr_stmt|;
else|else
name|puts
argument_list|(
literal|"There is no apparent use."
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_block

begin_macro
name|murder
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
operator|!
operator|(
operator|(
name|n
operator|==
name|SWORD
operator|||
name|n
operator|==
name|KNIFE
operator|||
name|n
operator|==
name|TWO_HANDED
operator|||
name|n
operator|==
name|MACE
operator|||
name|n
operator|==
name|CLEAVER
operator|||
name|n
operator|==
name|BROAD
operator|||
name|n
operator|==
name|CHAIN
operator|||
name|n
operator|==
name|SHOVEL
operator|||
name|n
operator|==
name|HALBERD
operator|)
operator|&&
name|testbit
argument_list|(
name|inven
argument_list|,
name|n
argument_list|)
operator|)
operator|&&
name|n
operator|<
name|NUMOFOBJECTS
condition|;
name|n
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|n
operator|==
name|NUMOFOBJECTS
condition|)
name|puts
argument_list|(
literal|"You don't have suitable weapons to kill."
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"Your %s should do the trick.\n"
argument_list|,
name|objsht
index|[
name|n
index|]
argument_list|)
expr_stmt|;
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|==
name|ADJS
condition|)
empty_stmt|;
switch|switch
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
condition|)
block|{
case|case
name|NORMGOD
case|:
if|if
condition|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|BATHGOD
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"The goddess's head slices off.  Her corpse floats in the water."
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|BATHGOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|DEADGOD
argument_list|)
expr_stmt|;
name|power
operator|+=
literal|5
expr_stmt|;
name|notes
index|[
name|JINXED
index|]
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|NORMGOD
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"The goddess pleads but you strike her mercilessly.  Her broken body lies in a\npool of blood."
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|NORMGOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|DEADGOD
argument_list|)
expr_stmt|;
name|power
operator|+=
literal|5
expr_stmt|;
name|notes
index|[
name|JINXED
index|]
operator|++
expr_stmt|;
if|if
condition|(
name|wintime
condition|)
name|live
argument_list|()
expr_stmt|;
block|}
else|else
name|puts
argument_list|(
literal|"I dont see her anywhere."
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIMER
case|:
if|if
condition|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|TIMER
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"The old man offers no resistance."
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|TIMER
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|DEADTIME
argument_list|)
expr_stmt|;
name|power
operator|++
expr_stmt|;
name|notes
index|[
name|JINXED
index|]
operator|++
expr_stmt|;
block|}
else|else
name|puts
argument_list|(
literal|"Who?"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NATIVE
case|:
if|if
condition|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|NATIVE
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"The girl screams as you cut her body to shreds.  She is dead."
argument_list|)
expr_stmt|;
name|clearbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|NATIVE
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|DEADNATIVE
argument_list|)
expr_stmt|;
name|power
operator|+=
literal|5
expr_stmt|;
name|notes
index|[
name|JINXED
index|]
operator|++
expr_stmt|;
block|}
else|else
name|puts
argument_list|(
literal|"What girl?"
argument_list|)
expr_stmt|;
break|break;
case|case
name|MAN
case|:
if|if
condition|(
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|MAN
argument_list|)
condition|)
block|{
name|puts
argument_list|(
literal|"You strike him to the ground and he coughs up blood."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"Your fantasy is over."
argument_list|)
expr_stmt|;
name|die
argument_list|()
expr_stmt|;
block|}
case|case
operator|-
literal|1
case|:
name|puts
argument_list|(
literal|"Kill what?"
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|wordtype
index|[
name|wordnumber
index|]
operator|!=
name|NOUNS
condition|)
name|puts
argument_list|(
literal|"Kill what?"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"You can't kill the %s!\n"
argument_list|,
name|objsht
index|[
name|wordvalue
index|[
name|wordnumber
index|]
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|ravage
argument_list|()
end_macro

begin_block
block|{
while|while
condition|(
name|wordtype
index|[
operator|++
name|wordnumber
index|]
operator|!=
name|NOUNS
operator|&&
name|wordnumber
operator|<=
name|wordcount
condition|)
empty_stmt|;
if|if
condition|(
name|wordtype
index|[
name|wordnumber
index|]
operator|==
name|NOUNS
operator|&&
name|testbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|wordvalue
index|[
name|wordnumber
index|]
argument_list|)
condition|)
block|{
name|time
operator|++
expr_stmt|;
switch|switch
condition|(
name|wordvalue
index|[
name|wordnumber
index|]
condition|)
block|{
case|case
name|NORMGOD
case|:
name|puts
argument_list|(
literal|"You attack the goddess and she screams as you beat her.  She falls down"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"crying and tries to hold her torn and bloodied dress around her."
argument_list|)
expr_stmt|;
name|power
operator|+=
literal|5
expr_stmt|;
name|pleasure
operator|+=
literal|8
expr_stmt|;
name|ego
operator|-=
literal|10
expr_stmt|;
name|wordnumber
operator|--
expr_stmt|;
name|godready
operator|=
operator|-
literal|30000
expr_stmt|;
name|murder
argument_list|()
expr_stmt|;
name|win
operator|=
operator|-
literal|30000
expr_stmt|;
break|break;
case|case
name|NATIVE
case|:
name|puts
argument_list|(
literal|"The girl tries to run but you catch her and throw her down.  Her face is"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"bleeding and she screams as you tear off her clothes."
argument_list|)
expr_stmt|;
name|power
operator|+=
literal|3
expr_stmt|;
name|pleasure
operator|+=
literal|5
expr_stmt|;
name|ego
operator|-=
literal|10
expr_stmt|;
name|wordnumber
operator|--
expr_stmt|;
name|murder
argument_list|()
expr_stmt|;
if|if
condition|(
name|rnd
argument_list|(
literal|100
argument_list|)
operator|<
literal|20
condition|)
block|{
name|puts
argument_list|(
literal|"Her screams have attracted attention.  I think we are surrounded."
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|ahead
index|]
operator|.
name|objects
argument_list|,
name|WOODSMAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|ahead
index|]
operator|.
name|objects
argument_list|,
name|DEADWOOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|ahead
index|]
operator|.
name|objects
argument_list|,
name|MALLET
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|back
index|]
operator|.
name|objects
argument_list|,
name|WOODSMAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|back
index|]
operator|.
name|objects
argument_list|,
name|DEADWOOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|back
index|]
operator|.
name|objects
argument_list|,
name|MALLET
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|left
index|]
operator|.
name|objects
argument_list|,
name|WOODSMAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|left
index|]
operator|.
name|objects
argument_list|,
name|DEADWOOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|left
index|]
operator|.
name|objects
argument_list|,
name|MALLET
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|right
index|]
operator|.
name|objects
argument_list|,
name|WOODSMAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|right
index|]
operator|.
name|objects
argument_list|,
name|DEADWOOD
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|right
index|]
operator|.
name|objects
argument_list|,
name|MALLET
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|puts
argument_list|(
literal|"You are perverted."
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|puts
argument_list|(
literal|"Who?"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|follow
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|followfight
operator|==
name|time
condition|)
block|{
name|puts
argument_list|(
literal|"The Dark Lord leaps and runs down secret tunnels and corridoors.  You chase"
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"him through the darkness and splash in pools of water.  You have cornered him."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"His laser sword extends as he steps forward."
argument_list|)
expr_stmt|;
name|position
operator|=
name|FINAL
expr_stmt|;
name|fight
argument_list|(
name|DARK
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|TALISMAN
argument_list|)
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|AMULET
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|followgod
operator|==
name|time
condition|)
block|{
name|puts
argument_list|(
literal|"The goddess leads you down a steamy tunnel and into a high, wide chamber."
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"She sits down on a throne."
argument_list|)
expr_stmt|;
name|position
operator|=
literal|268
expr_stmt|;
name|setbit
argument_list|(
name|location
index|[
name|position
index|]
operator|.
name|objects
argument_list|,
name|NORMGOD
argument_list|)
expr_stmt|;
name|notes
index|[
name|CANTSEE
index|]
operator|=
literal|1
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
else|else
name|puts
argument_list|(
literal|"There is no one to follow."
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_block

end_unit

