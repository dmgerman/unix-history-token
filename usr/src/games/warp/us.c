begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $Header: us.c,v 7.0.1.3 87/01/13 17:13:21 lwall Exp $ */
end_comment

begin_comment
comment|/* $Log:	us.c,v $  * Revision 7.0.1.3  87/01/13  17:13:21  lwall  * Partially fixed ^S behavior.  It now just ignores ^S.  *   * Revision 7.0.1.2  86/12/12  17:06:09  lwall  * Baseline for net release.  *   * Revision 7.0.1.1  86/10/16  10:53:50  lwall  * Added Damage.  Fixed random bugs.  *   * Revision 7.0  86/10/08  15:14:21  lwall  * Split into separate files.  Added amoebas and pirates.  *   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"warp.h"
end_include

begin_include
include|#
directive|include
file|"bang.h"
end_include

begin_include
include|#
directive|include
file|"object.h"
end_include

begin_include
include|#
directive|include
file|"play.h"
end_include

begin_include
include|#
directive|include
file|"sig.h"
end_include

begin_include
include|#
directive|include
file|"term.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_include
include|#
directive|include
file|"weapon.h"
end_include

begin_include
include|#
directive|include
file|"INTERN.h"
end_include

begin_include
include|#
directive|include
file|"us.h"
end_include

begin_function
name|void
name|us_init
parameter_list|()
block|{
empty_stmt|;
block|}
end_function

begin_function
name|void
name|do_direction
parameter_list|(
name|dy
parameter_list|,
name|dx
parameter_list|)
name|int
name|dy
decl_stmt|,
name|dx
decl_stmt|;
block|{
name|Reg1
name|int
name|decr
decl_stmt|;
name|Reg2
name|OBJECT
modifier|*
name|obj
decl_stmt|;
if|if
condition|(
name|status
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|cloaking
condition|)
block|{
name|char
name|ch
decl_stmt|;
name|cloaked
operator|=
name|FALSE
expr_stmt|;
name|ch
operator|=
operator|(
name|ent
operator|->
name|energy
operator|>=
literal|500
condition|?
literal|'E'
else|:
literal|'e'
operator|)
expr_stmt|;
if|if
condition|(
name|ch
operator|!=
name|ent
operator|->
name|image
condition|)
block|{
name|setimage
argument_list|(
name|ent
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
block|}
name|decr
operator|=
literal|5
operator|+
name|abs
argument_list|(
name|evely
argument_list|)
operator|+
name|abs
argument_list|(
name|evelx
argument_list|)
operator|+
name|tractor
operator|*
name|tractor
expr_stmt|;
if|if
condition|(
name|ent
operator|->
name|energy
operator|>=
name|decr
condition|)
block|{
name|ent
operator|->
name|energy
operator|-=
name|decr
expr_stmt|;
if|if
condition|(
name|tractor
condition|)
block|{
if|if
condition|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOTRACTORS
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|50
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NOTRACTORS
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|tract
argument_list|(
name|ent
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|,
name|tractor
argument_list|)
condition|)
block|{
name|evely
operator|+=
name|tractor
operator|*
name|dy
expr_stmt|;
name|evelx
operator|+=
name|tractor
operator|*
name|dx
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|damage
operator|||
operator|(
operator|!
name|entmode
operator|&&
operator|!
name|damflag
index|[
name|NOIMPULSE
index|]
operator|)
operator|||
operator|(
name|entmode
operator|&&
operator|!
name|damflag
index|[
name|NOWARP
index|]
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|30
operator|+
literal|500
operator|/
operator|(
name|abs
argument_list|(
name|evely
argument_list|)
operator|+
name|abs
argument_list|(
name|evelx
argument_list|)
operator|+
literal|1
operator|)
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|entmode
condition|?
name|NOWARP
else|:
name|NOIMPULSE
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
name|evely
operator|+=
name|dy
expr_stmt|;
name|evelx
operator|+=
name|dx
expr_stmt|;
block|}
if|if
condition|(
name|inumthols
operator|&&
operator|(
name|obj
operator|=
name|occupant
index|[
operator|(
name|ent
operator|->
name|posy
operator|+
name|evely
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
index|]
index|[
operator|(
name|ent
operator|->
name|posx
operator|+
name|evelx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|Web
condition|)
name|evely
operator|=
name|evelx
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|status
operator|==
literal|2
condition|)
block|{
name|decr
operator|=
literal|500
operator|+
name|abs
argument_list|(
name|bvely
argument_list|)
operator|*
literal|5
operator|+
name|abs
argument_list|(
name|bvelx
argument_list|)
operator|*
literal|5
operator|+
name|tractor
operator|*
name|tractor
operator|*
literal|100
expr_stmt|;
if|if
condition|(
name|base
operator|->
name|energy
operator|>=
name|decr
condition|)
block|{
name|base
operator|->
name|energy
operator|-=
name|decr
expr_stmt|;
if|if
condition|(
name|tractor
condition|)
block|{
if|if
condition|(
name|tract
argument_list|(
name|base
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|,
name|tractor
argument_list|)
condition|)
block|{
name|bvely
operator|+=
name|tractor
operator|*
name|dy
expr_stmt|;
name|bvelx
operator|+=
name|tractor
operator|*
name|dx
expr_stmt|;
block|}
block|}
else|else
block|{
name|bvely
operator|+=
name|dy
expr_stmt|;
name|bvelx
operator|+=
name|dx
expr_stmt|;
block|}
if|if
condition|(
name|inumthols
operator|&&
operator|(
name|obj
operator|=
name|occupant
index|[
operator|(
name|base
operator|->
name|posy
operator|+
name|bvely
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
index|]
index|[
operator|(
name|base
operator|->
name|posx
operator|+
name|bvelx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|Web
condition|)
name|bvely
operator|=
name|bvelx
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|tractor
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ctrl_direction
parameter_list|(
name|dy
parameter_list|,
name|dx
parameter_list|)
name|int
name|dy
decl_stmt|,
name|dx
decl_stmt|;
block|{
if|if
condition|(
name|status
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|cloaking
condition|)
block|{
name|char
name|ch
decl_stmt|;
name|cloaked
operator|=
name|FALSE
expr_stmt|;
name|ch
operator|=
operator|(
name|ent
operator|->
name|energy
operator|>=
literal|500
condition|?
literal|'E'
else|:
literal|'e'
operator|)
expr_stmt|;
if|if
condition|(
name|ch
operator|!=
name|ent
operator|->
name|image
condition|)
block|{
name|setimage
argument_list|(
name|ent
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOPHASERS
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|200
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NOPHASERS
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
name|fire_phaser
argument_list|(
name|ent
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|status
operator|==
literal|2
condition|)
name|fire_phaser
argument_list|(
name|base
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|shift_direction
parameter_list|(
name|dy
parameter_list|,
name|dx
parameter_list|)
name|int
name|dy
decl_stmt|,
name|dx
decl_stmt|;
block|{
if|if
condition|(
name|status
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|cloaking
condition|)
block|{
name|char
name|ch
decl_stmt|;
name|cloaked
operator|=
name|FALSE
expr_stmt|;
name|ch
operator|=
operator|(
name|ent
operator|->
name|energy
operator|>=
literal|500
condition|?
literal|'E'
else|:
literal|'e'
operator|)
expr_stmt|;
if|if
condition|(
name|ch
operator|!=
name|ent
operator|->
name|image
condition|)
block|{
name|setimage
argument_list|(
name|ent
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOTORPS
index|]
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|300
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NOTORPS
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
name|fire_torp
argument_list|(
name|ent
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|status
operator|==
literal|2
condition|)
name|fire_torp
argument_list|(
name|base
argument_list|,
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|get_commands
parameter_list|(
name|done
parameter_list|)
name|bool
modifier|*
name|done
decl_stmt|;
block|{
specifier|static
name|char
name|ch
index|[
literal|80
index|]
decl_stmt|;
name|Reg1
name|int
name|i
decl_stmt|;
name|Reg2
name|int
name|count
decl_stmt|;
name|Reg3
name|bool
name|ctrla
init|=
name|FALSE
decl_stmt|;
name|char
name|numdestructs
init|=
literal|0
decl_stmt|,
name|numzaps
init|=
literal|0
decl_stmt|;
name|top
label|:
while|while
condition|(
name|count
operator|=
name|read_nd
argument_list|(
name|ch
argument_list|,
operator|(
sizeof|sizeof
name|ch
operator|)
argument_list|)
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ch
index|[
name|i
index|]
operator|==
literal|'Q'
condition|)
block|{
name|bombed_out
operator|=
name|TRUE
expr_stmt|;
operator|*
name|done
operator|=
name|TRUE
expr_stmt|;
name|keepgoing
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|ch
index|[
name|i
index|]
operator|==
literal|'q'
operator|||
name|ch
index|[
name|i
index|]
operator|==
name|BREAKCH
operator|||
name|ch
index|[
name|i
index|]
operator|==
name|INTRCH
condition|)
block|{
name|int
name|x
decl_stmt|;
specifier|static
name|char
name|quest
index|[]
init|=
literal|"Do you wish to escape from reality? "
decl_stmt|;
if|if
condition|(
name|timer
operator|>=
name|whenok
condition|)
block|{
name|mvaddstr
argument_list|(
literal|12
argument_list|,
literal|22
argument_list|,
name|quest
argument_list|)
expr_stmt|;
do|do
block|{
name|getcmd
argument_list|(
operator|&
name|ch
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|ch
index|[
name|i
index|]
operator|!=
literal|'y'
operator|&&
name|ch
index|[
name|i
index|]
operator|!=
literal|'n'
condition|)
do|;
if|if
condition|(
name|ch
index|[
name|i
index|]
operator|==
literal|'y'
condition|)
block|{
name|bombed_out
operator|=
name|TRUE
expr_stmt|;
operator|*
name|done
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
else|else
block|{
for|for
control|(
name|x
operator|=
literal|11
init|;
name|x
operator|<=
literal|28
condition|;
name|x
operator|++
control|)
block|{
name|mvaddch
argument_list|(
literal|12
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|occupant
index|[
literal|11
index|]
index|[
name|x
index|]
condition|?
name|occupant
index|[
literal|11
index|]
index|[
name|x
index|]
operator|->
name|image
else|:
name|numamoebas
condition|?
name|amb
index|[
literal|11
index|]
index|[
name|x
index|]
else|:
literal|' '
argument_list|)
expr_stmt|;
name|addspace
argument_list|()
expr_stmt|;
block|}
name|roundsleep
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|whenok
operator|=
name|timer
operator|+
literal|10
expr_stmt|;
goto|goto
name|top
goto|;
block|}
block|}
else|else
block|{
name|write
argument_list|(
literal|1
argument_list|,
literal|"\07"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
goto|goto
name|top
goto|;
block|}
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ctrla
condition|)
block|{
switch|switch
condition|(
name|ch
index|[
name|i
index|]
condition|)
block|{
case|case
literal|'1'
case|:
case|case
literal|'b'
case|:
name|ctrl_direction
argument_list|(
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'2'
case|:
case|case
literal|'j'
case|:
name|ctrl_direction
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'3'
case|:
case|case
literal|'n'
case|:
name|ctrl_direction
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'4'
case|:
case|case
literal|'h'
case|:
name|ctrl_direction
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'6'
case|:
case|case
literal|'l'
case|:
name|ctrl_direction
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'7'
case|:
case|case
literal|'y'
case|:
name|ctrl_direction
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'8'
case|:
case|case
literal|'k'
case|:
name|ctrl_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'9'
case|:
case|case
literal|'u'
case|:
name|ctrl_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|rewrite
argument_list|()
expr_stmt|;
name|roundsleep
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|ctrla
operator|=
name|FALSE
expr_stmt|;
goto|goto
name|top
goto|;
case|case
literal|'w'
case|:
name|clear
argument_list|()
expr_stmt|;
while|while
condition|(
operator|!
name|input_pending
argument_list|()
condition|)
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|rewrite
argument_list|()
expr_stmt|;
name|roundsleep
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|ctrla
operator|=
name|FALSE
expr_stmt|;
goto|goto
name|top
goto|;
ifdef|#
directive|ifdef
name|SIGTSTP
case|case
literal|'z'
case|:
name|clear
argument_list|()
expr_stmt|;
name|mytstp
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|ctrla
operator|=
name|FALSE
expr_stmt|;
goto|goto
name|top
goto|;
endif|#
directive|endif
default|default:
break|break;
block|}
name|ctrla
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
switch|switch
condition|(
name|ch
index|[
name|i
index|]
condition|)
block|{
case|case
literal|'Z'
case|:
name|clear
argument_list|()
expr_stmt|;
name|mytstp
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|4
argument_list|)
expr_stmt|;
goto|goto
name|top
goto|;
case|case
literal|'i'
case|:
if|if
condition|(
name|ent
operator|&&
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOIMPULSE
index|]
operator|)
condition|)
block|{
name|entmode
operator|=
literal|0
expr_stmt|;
name|status
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
literal|'w'
case|:
if|if
condition|(
name|ent
operator|&&
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOWARP
index|]
operator|)
condition|)
block|{
name|entmode
operator|=
literal|1
expr_stmt|;
name|status
operator|=
literal|1
expr_stmt|;
block|}
break|break;
case|case
literal|'p'
case|:
if|if
condition|(
name|base
condition|)
block|{
name|status
operator|=
literal|2
expr_stmt|;
block|}
break|break;
case|case
literal|'o'
case|:
if|if
condition|(
name|status
operator|<
literal|2
condition|)
block|{
if|if
condition|(
name|base
condition|)
name|status
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|status
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|ent
condition|)
name|status
operator|=
name|entmode
expr_stmt|;
block|}
break|break;
case|case
literal|'v'
case|:
if|if
condition|(
name|ent
condition|)
block|{
name|status
operator|=
name|entmode
expr_stmt|;
block|}
name|cloaking
operator|=
name|FALSE
expr_stmt|;
name|cloaked
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
if|if
condition|(
name|ent
condition|)
block|{
name|status
operator|=
name|entmode
expr_stmt|;
if|if
condition|(
name|ent
operator|->
name|energy
operator|>=
literal|250
condition|)
name|cloaking
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
case|case
literal|'z'
case|:
if|if
condition|(
name|ent
operator|&&
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOZAPPER
index|]
operator|)
condition|)
block|{
operator|++
name|numzaps
expr_stmt|;
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|100
operator|/
name|numzaps
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NOZAPPER
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|nxtbang
operator|&&
name|bangm
index|[
name|nxtbang
operator|-
literal|1
index|]
operator|<
literal|0
condition|)
operator|--
name|nxtbang
expr_stmt|;
comment|/* consolidate zaps */
name|make_blast
argument_list|(
name|evely
operator|*
literal|2
operator|+
name|ent
operator|->
name|posy
argument_list|,
name|evelx
operator|*
literal|2
operator|+
name|ent
operator|->
name|posx
argument_list|,
operator|-
literal|5000000L
argument_list|,
literal|3
operator|*
name|numzaps
argument_list|)
expr_stmt|;
name|ent
operator|->
name|energy
operator|/=
literal|2
expr_stmt|;
block|}
break|break;
case|case
literal|'D'
case|:
if|if
condition|(
name|status
operator|<
literal|2
operator|&&
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NODESTRUCT
index|]
operator|)
condition|)
block|{
if|if
condition|(
name|ent
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|10
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NODESTRUCT
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
if|if
condition|(
operator|++
name|numdestructs
operator|<=
literal|2
condition|)
name|make_blast
argument_list|(
name|evely
operator|*
literal|2
operator|+
name|ent
operator|->
name|posy
argument_list|,
name|evelx
operator|*
literal|2
operator|+
name|ent
operator|->
name|posx
argument_list|,
literal|15000L
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|ent
operator|->
name|energy
operator|/=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|status
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|numdestructs
condition|)
name|base
operator|->
name|energy
operator|=
name|base
operator|->
name|energy
operator|/
literal|2
expr_stmt|;
if|if
condition|(
operator|++
name|numdestructs
operator|<=
literal|2
condition|)
name|make_blast
argument_list|(
name|base
operator|->
name|posy
argument_list|,
name|base
operator|->
name|posx
argument_list|,
literal|15000L
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'d'
case|:
if|if
condition|(
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NODESTRUCT
index|]
operator|)
operator|&&
operator|(
name|base
operator|||
name|ent
operator|)
condition|)
block|{
name|Reg4
name|OBJECT
modifier|*
name|obj
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|ent
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|200
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NODESTRUCT
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
for|for
control|(
name|obj
operator|=
name|root
operator|.
name|prev
init|;
name|obj
operator|!=
operator|&
name|root
condition|;
name|obj
operator|=
name|obj
operator|->
name|prev
control|)
block|{
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'+'
condition|)
block|{
name|blast
index|[
name|y
operator|=
operator|(
name|obj
operator|->
name|posy
operator|+
name|obj
operator|->
name|vely
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
index|]
index|[
name|x
operator|=
operator|(
name|obj
operator|->
name|posx
operator|+
name|obj
operator|->
name|velx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
index|]
operator|+=
literal|1
expr_stmt|;
name|yblasted
index|[
name|y
index|]
operator||=
literal|1
expr_stmt|;
name|xblasted
index|[
name|x
index|]
operator||=
literal|1
expr_stmt|;
name|blasted
operator|=
name|TRUE
expr_stmt|;
name|obj
operator|->
name|mass
operator|=
operator|(
name|massacre
condition|?
literal|3000
else|:
literal|4000
operator|)
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
literal|'s'
case|:
if|if
condition|(
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NODESTRUCT
index|]
operator|)
operator|&&
operator|(
name|base
operator|||
name|ent
operator|)
condition|)
block|{
name|Reg4
name|OBJECT
modifier|*
name|obj
decl_stmt|;
if|if
condition|(
name|ent
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|200
argument_list|)
condition|)
block|{
name|damage
operator|++
expr_stmt|;
name|damflag
index|[
name|NODESTRUCT
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
block|}
for|for
control|(
name|obj
operator|=
name|root
operator|.
name|prev
init|;
name|obj
operator|->
name|type
operator|==
name|Torp
operator|||
name|obj
operator|->
name|type
operator|==
name|Web
operator|||
name|obj
operator|->
name|type
operator|==
name|Star
condition|;
name|obj
operator|=
name|obj
operator|->
name|prev
control|)
block|{
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'+'
condition|)
name|obj
operator|->
name|vely
operator|=
name|obj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
block|}
block|}
break|break;
case|case
literal|'\001'
case|:
name|ctrla
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
literal|'\002'
case|:
case|case
literal|'\003'
case|:
case|case
literal|'\004'
case|:
case|case
literal|'\005'
case|:
case|case
literal|'\006'
case|:
case|case
literal|'\007'
case|:
case|case
literal|'\010'
case|:
case|case
literal|'\011'
case|:
case|case
literal|'\012'
case|:
case|case
literal|'\013'
case|:
case|case
literal|'\014'
case|:
case|case
literal|'\015'
case|:
case|case
literal|'\016'
case|:
case|case
literal|'\017'
case|:
case|case
literal|'\020'
case|:
case|case
literal|'\021'
case|:
case|case
literal|'\022'
case|:
case|case
literal|'\023'
case|:
case|case
literal|'\024'
case|:
case|case
literal|'\025'
case|:
case|case
literal|'\026'
case|:
case|case
literal|'\027'
case|:
case|case
literal|'\030'
case|:
case|case
literal|'\031'
case|:
case|case
literal|'\032'
case|:
name|ch
index|[
name|i
index|]
operator|+=
literal|96
expr_stmt|;
name|i
operator|--
expr_stmt|;
name|ctrla
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
literal|'\033'
case|:
name|tractor
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'a'
case|:
name|tractor
operator|++
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|tractor
operator|--
expr_stmt|;
break|break;
case|case
literal|'1'
case|:
case|case
literal|'b'
case|:
name|do_direction
argument_list|(
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'2'
case|:
case|case
literal|'j'
case|:
name|do_direction
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'3'
case|:
case|case
literal|'n'
case|:
name|do_direction
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'4'
case|:
case|case
literal|'h'
case|:
name|do_direction
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'6'
case|:
case|case
literal|'l'
case|:
name|do_direction
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'7'
case|:
case|case
literal|'y'
case|:
name|do_direction
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'8'
case|:
case|case
literal|'k'
case|:
name|do_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'9'
case|:
case|case
literal|'u'
case|:
name|do_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'0'
case|:
case|case
literal|'S'
case|:
if|if
condition|(
name|status
operator|<
literal|2
condition|)
block|{
name|evely
operator|=
literal|0
expr_stmt|;
name|evelx
operator|=
literal|0
expr_stmt|;
block|}
break|break;
case|case
literal|'-'
case|:
if|if
condition|(
name|status
operator|<
literal|2
operator|&&
name|ent
operator|->
name|energy
operator|>=
literal|10
condition|)
block|{
name|evely
operator|*=
operator|-
literal|1
expr_stmt|;
name|evelx
operator|*=
operator|-
literal|1
expr_stmt|;
name|ent
operator|->
name|energy
operator|-=
literal|10
expr_stmt|;
block|}
break|break;
case|case
literal|'%'
case|:
case|case
literal|'\177'
case|:
case|case
literal|'_'
case|:
name|shift_direction
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|shift_direction
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'!'
case|:
case|case
literal|'B'
case|:
name|shift_direction
argument_list|(
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'@'
case|:
case|case
literal|'J'
case|:
name|shift_direction
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'#'
case|:
case|case
literal|'N'
case|:
name|shift_direction
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'$'
case|:
case|case
literal|'H'
case|:
name|shift_direction
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'^'
case|:
case|case
literal|'L'
case|:
name|shift_direction
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'&'
case|:
case|case
literal|'Y'
case|:
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'*'
case|:
case|case
literal|'K'
case|:
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'('
case|:
case|case
literal|'U'
case|:
name|shift_direction
argument_list|(
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'?'
case|:
name|helper
argument_list|()
expr_stmt|;
name|roundsleep
argument_list|(
literal|3
argument_list|)
expr_stmt|;
goto|goto
name|top
goto|;
default|default:
break|break;
block|}
block|}
block|}
block|}
block|}
end_function

end_unit

