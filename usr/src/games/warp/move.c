begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $Header: move.c,v 7.0.1.2 86/10/20 14:37:06 lwall Exp $ */
end_comment

begin_comment
comment|/* $Log:	move.c,v $  * Revision 7.0.1.2  86/10/20  14:37:06  lwall  * Picked some lint.  *   * Revision 7.0.1.1  86/10/16  10:52:09  lwall  * Added Damage.  Fixed random bugs.  *   * Revision 7.0  86/10/08  15:12:40  lwall  * Split into separate files.  Added amoebas and pirates.  *   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"warp.h"
end_include

begin_include
include|#
directive|include
file|"bang.h"
end_include

begin_include
include|#
directive|include
file|"object.h"
end_include

begin_include
include|#
directive|include
file|"move.h"
end_include

begin_include
include|#
directive|include
file|"play.h"
end_include

begin_include
include|#
directive|include
file|"score.h"
end_include

begin_include
include|#
directive|include
file|"term.h"
end_include

begin_include
include|#
directive|include
file|"them.h"
end_include

begin_include
include|#
directive|include
file|"us.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_include
include|#
directive|include
file|"weapon.h"
end_include

begin_include
include|#
directive|include
file|"INTERN.h"
end_include

begin_include
include|#
directive|include
file|"move.h"
end_include

begin_function
name|void
name|move_init
parameter_list|()
block|{
empty_stmt|;
block|}
end_function

begin_function
name|void
name|bounce
parameter_list|(
name|obj
parameter_list|)
name|Reg4
name|OBJECT
modifier|*
name|obj
decl_stmt|;
block|{
name|Reg1
name|int
name|x
decl_stmt|;
name|Reg2
name|int
name|y
decl_stmt|;
name|Reg3
name|int
name|count
init|=
literal|0
decl_stmt|;
name|y
operator|=
operator|(
name|obj
operator|->
name|posy
operator|-
name|sgn
argument_list|(
name|obj
operator|->
name|vely
argument_list|)
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|obj
operator|->
name|posx
operator|-
name|sgn
argument_list|(
name|obj
operator|->
name|velx
argument_list|)
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
while|while
condition|(
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
condition|)
block|{
name|y
operator|=
operator|(
name|y
operator|+
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|+
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
if|if
condition|(
operator|++
name|count
operator|>
literal|10000
condition|)
block|{
comment|/* if universe full, get out of it fast */
name|unmake_object
argument_list|(
name|obj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ent
condition|)
name|unmake_object
argument_list|(
name|ent
argument_list|)
expr_stmt|;
if|if
condition|(
name|base
condition|)
name|unmake_object
argument_list|(
name|base
argument_list|)
expr_stmt|;
name|finish
operator|=
literal|1
expr_stmt|;
return|return;
block|}
block|}
name|obj
operator|->
name|posy
operator|=
name|y
expr_stmt|;
name|obj
operator|->
name|posx
operator|=
name|x
expr_stmt|;
name|obj
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
name|obj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|obj
expr_stmt|;
if|if
condition|(
name|numamoebas
operator|&&
name|obj
operator|->
name|image
operator|==
literal|' '
condition|)
name|mvaddc
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
argument_list|)
expr_stmt|;
else|else
name|mvaddc
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|obj
operator|->
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|move_universe
parameter_list|()
block|{
name|Reg1
name|OBJECT
modifier|*
name|curobj
decl_stmt|;
name|Reg2
name|int
name|x
decl_stmt|;
name|Reg3
name|int
name|y
decl_stmt|;
name|Reg4
name|OBJECT
modifier|*
name|temp
decl_stmt|;
name|OBJECT
modifier|*
name|thenext
decl_stmt|;
for|for
control|(
name|curobj
operator|=
name|movers
init|;
name|curobj
operator|!=
operator|&
name|root
condition|;
name|curobj
operator|=
name|curobj
operator|->
name|next
control|)
block|{
name|x
operator|=
name|curobj
operator|->
name|posx
expr_stmt|;
name|y
operator|=
name|curobj
operator|->
name|posy
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
condition|)
block|{
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curobj
operator|->
name|type
operator|!=
name|Torp
operator|&&
name|curobj
operator|->
name|type
operator|!=
name|Web
condition|)
block|{
name|resetty
argument_list|()
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
for|for
control|(
name|curobj
operator|=
name|movers
init|;
name|curobj
operator|!=
operator|&
name|root
condition|;
name|curobj
operator|=
name|thenext
control|)
block|{
name|thenext
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|vely
operator|||
name|curobj
operator|->
name|velx
condition|)
block|{
name|y
operator|=
name|curobj
operator|->
name|posy
expr_stmt|;
name|x
operator|=
name|curobj
operator|->
name|posx
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|image
operator|!=
literal|' '
operator|&&
operator|(
operator|!
operator|(
name|temp
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|||
name|temp
operator|->
name|image
operator|==
literal|' '
operator|)
condition|)
block|{
name|move
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|numamoebas
condition|?
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
else|:
literal|' '
argument_list|)
expr_stmt|;
block|}
name|y
operator|=
operator|(
name|y
operator|+
name|curobj
operator|->
name|vely
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|+
name|curobj
operator|->
name|velx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|temp
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|||
name|temp
operator|->
name|type
operator|!=
name|Star
operator|||
name|curobj
operator|->
name|type
operator|!=
name|Torp
operator|||
name|curobj
operator|->
name|image
operator|==
literal|'+'
operator|||
name|curobj
operator|->
name|image
operator|==
literal|'x'
condition|)
block|{
name|curobj
operator|->
name|posy
operator|=
name|y
expr_stmt|;
name|curobj
operator|->
name|posx
operator|=
name|x
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|curobj
operator|->
name|image
operator|==
literal|'0'
condition|)
block|{
name|curobj
operator|->
name|vely
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
name|curobj
operator|->
name|velx
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
block|}
else|else
name|curobj
operator|->
name|vely
operator|=
name|curobj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
name|y
operator|=
name|curobj
operator|->
name|posy
expr_stmt|;
name|x
operator|=
name|curobj
operator|->
name|posx
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* not moving */
name|y
operator|=
name|curobj
operator|->
name|posy
expr_stmt|;
name|x
operator|=
name|curobj
operator|->
name|posx
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|type
operator|==
name|Torp
operator|||
name|curobj
operator|->
name|type
operator|==
name|Star
operator|||
name|curobj
operator|->
name|type
operator|==
name|Web
condition|)
block|{
name|curobj
operator|->
name|flags
operator||=
name|STATIC
expr_stmt|;
name|curobj
operator|->
name|next
operator|->
name|prev
operator|=
name|curobj
operator|->
name|prev
expr_stmt|;
name|curobj
operator|->
name|prev
operator|->
name|next
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|curobj
operator|->
name|prev
operator|=
name|movers
operator|->
name|prev
expr_stmt|;
name|curobj
operator|->
name|next
operator|=
name|movers
expr_stmt|;
name|movers
operator|->
name|prev
operator|->
name|next
operator|=
name|curobj
expr_stmt|;
name|movers
operator|->
name|prev
operator|=
name|curobj
expr_stmt|;
block|}
block|}
if|if
condition|(
name|temp
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
condition|)
block|{
comment|/* already occupied? */
if|if
condition|(
operator|!
name|temp
operator|->
name|contend
condition|)
block|{
if|if
condition|(
name|temp
operator|->
name|type
operator|==
name|Torp
condition|)
block|{
if|if
condition|(
name|temp
operator|->
name|image
operator|==
literal|'+'
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|1250
expr_stmt|;
elseif|else
if|if
condition|(
name|temp
operator|->
name|image
operator|==
literal|'o'
operator|&&
operator|(
name|base
operator|||
name|ent
operator|)
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|500
operator|+
name|super
operator|*
literal|20
expr_stmt|;
elseif|else
if|if
condition|(
name|temp
operator|->
name|image
operator|==
literal|'O'
operator|&&
operator|(
name|base
operator|||
name|ent
operator|)
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|5000
operator|+
name|super
operator|*
literal|100
expr_stmt|;
block|}
block|}
name|yblasted
index|[
name|y
index|]
operator||=
literal|1
expr_stmt|;
name|xblasted
index|[
name|x
index|]
operator||=
literal|1
expr_stmt|;
name|blasted
operator|=
name|TRUE
expr_stmt|;
name|curobj
operator|->
name|contend
operator|=
name|temp
expr_stmt|;
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|curobj
expr_stmt|;
switch|switch
condition|(
name|curobj
operator|->
name|type
condition|)
block|{
case|case
name|Enemy
case|:
if|if
condition|(
name|numamoebas
operator|&&
name|curobj
operator|==
name|nuke
operator|&&
name|temp
operator|->
name|image
operator|==
literal|'+'
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|80000
expr_stmt|;
elseif|else
if|if
condition|(
name|temp
operator|->
name|type
operator|==
name|Enemy
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|10
expr_stmt|;
else|else
goto|goto
name|defblast
goto|;
break|break;
case|case
name|Crusher
case|:
if|if
condition|(
name|curobj
operator|->
name|velx
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|100000
expr_stmt|;
else|else
goto|goto
name|defblast
goto|;
break|break;
case|case
name|Torp
case|:
if|if
condition|(
name|curobj
operator|->
name|image
operator|==
literal|'+'
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
operator|(
name|temp
operator|==
name|nuke
condition|?
literal|80000
else|:
literal|1250
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|curobj
operator|->
name|image
operator|==
literal|'o'
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|500
operator|+
name|super
operator|*
literal|20
expr_stmt|;
elseif|else
if|if
condition|(
name|curobj
operator|->
name|image
operator|==
literal|'O'
condition|)
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|5000
operator|+
name|super
operator|*
literal|100
expr_stmt|;
goto|goto
name|defblast
goto|;
case|case
name|Star
case|:
if|if
condition|(
name|temp
operator|==
name|ent
condition|)
goto|goto
name|damshield
goto|;
goto|goto
name|defblast
goto|;
case|case
name|Enterprise
case|:
if|if
condition|(
name|temp
operator|->
name|type
operator|==
name|Star
condition|)
block|{
name|damshield
label|:
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|10
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|damflag
index|[
name|NOSHIELDS
index|]
condition|)
name|damage
operator|++
expr_stmt|;
if|if
condition|(
name|damflag
index|[
name|NOSHIELDS
index|]
operator|<
literal|100
condition|)
name|damflag
index|[
name|NOSHIELDS
index|]
operator|+=
name|rand_mod
argument_list|(
name|smarts
argument_list|)
operator|/
literal|5
operator|+
literal|2
expr_stmt|;
block|}
block|}
goto|goto
name|defblast
goto|;
default|default:
name|defblast
label|:
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
name|rand_mod
argument_list|(
literal|751
argument_list|)
operator|+
literal|1
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|curobj
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|image
operator|!=
literal|' '
operator|&&
operator|(
name|curobj
operator|->
name|velx
operator|||
name|curobj
operator|->
name|vely
operator|||
name|curobj
operator|->
name|type
operator|==
name|Torp
operator|||
name|curobj
operator|->
name|type
operator|==
name|Web
operator|)
condition|)
block|{
name|mvaddc
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|curobj
operator|->
name|image
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|curobj
operator|->
name|type
operator|==
name|Crusher
operator|&&
name|curobj
operator|->
name|velx
condition|)
block|{
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|+=
literal|100000
expr_stmt|;
name|yblasted
index|[
name|y
index|]
operator||=
literal|1
expr_stmt|;
name|xblasted
index|[
name|x
index|]
operator||=
literal|1
expr_stmt|;
name|blasted
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|blasted
condition|)
block|{
name|Reg7
name|int
name|minxblast
init|=
operator|-
literal|1
decl_stmt|;
name|Reg8
name|int
name|maxxblast
init|=
operator|-
literal|2
decl_stmt|;
name|Reg5
name|long
name|tmpblast
decl_stmt|;
name|blasted
operator|=
name|numamoebas
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|XSIZE
condition|;
name|x
operator|++
control|)
block|{
if|if
condition|(
name|xblasted
index|[
name|x
index|]
condition|)
block|{
name|xblasted
index|[
name|x
index|]
operator|=
literal|0
expr_stmt|;
name|maxxblast
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|minxblast
operator|<
literal|0
condition|)
name|minxblast
operator|=
name|x
expr_stmt|;
block|}
block|}
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|YSIZE
condition|;
name|y
operator|++
control|)
block|{
if|if
condition|(
name|yblasted
index|[
name|y
index|]
condition|)
block|{
name|yblasted
index|[
name|y
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|x
operator|=
name|minxblast
init|;
name|x
operator|<=
name|maxxblast
condition|;
name|x
operator|++
control|)
block|{
name|tmpblast
operator|=
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
expr_stmt|;
if|if
condition|(
name|numamoebas
operator|&&
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
literal|'~'
condition|)
block|{
if|if
condition|(
name|temp
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
condition|)
block|{
if|if
condition|(
name|temp
operator|->
name|image
operator|==
literal|'&'
condition|)
name|tmpblast
operator|>>=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|temp
operator|->
name|type
operator|==
name|Web
condition|)
name|tmpblast
operator|=
literal|100000
expr_stmt|;
else|else
name|tmpblast
operator|+=
literal|50
operator|+
name|temp
operator|->
name|energy
operator|/
literal|100
expr_stmt|;
if|if
condition|(
name|tmpblast
operator|>
literal|250
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|5
operator|+
operator|(
name|inumstars
operator|>>
literal|4
operator|)
argument_list|)
condition|)
name|modify_amoeba
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
literal|'~'
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
name|xblasted
index|[
name|x
index|]
operator|=
literal|2
expr_stmt|;
name|yblasted
index|[
name|y
index|]
operator|=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|tmpblast
condition|)
block|{
name|Reg6
name|OBJECT
modifier|*
name|biggie
init|=
literal|0
decl_stmt|;
name|blast
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
literal|0
expr_stmt|;
name|temp
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
expr_stmt|;
if|if
condition|(
name|tmpblast
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|numamoebas
operator|&&
name|tmpblast
operator|<
operator|-
literal|1000000
operator|&&
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
literal|'~'
operator|&&
name|temp
operator|!=
name|nuke
condition|)
block|{
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
operator|!
name|temp
condition|)
name|make_plink
argument_list|(
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|ambsize
operator|--
expr_stmt|;
block|}
name|tmpblast
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|temp
condition|)
block|{
if|if
condition|(
operator|(
operator|!
name|numamoebas
operator|||
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
literal|' '
operator|)
operator|&&
name|tmpblast
operator|<
literal|100000
condition|)
name|make_plink
argument_list|(
name|y
argument_list|,
name|x
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|temp
condition|;
name|temp
operator|=
name|curobj
operator|->
name|contend
operator|,
name|curobj
operator|->
name|contend
operator|=
literal|0
control|)
block|{
name|curobj
operator|=
name|temp
expr_stmt|;
switch|switch
condition|(
name|curobj
operator|->
name|type
condition|)
block|{
case|case
name|Enterprise
case|:
block|{
name|long
name|tmp
init|=
name|curobj
operator|->
name|energy
decl_stmt|;
if|if
condition|(
name|ent
operator|->
name|energy
operator|>
literal|500
operator|||
name|apolloflag
operator|&
literal|1
condition|)
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
operator|/
operator|(
operator|(
name|apolloflag
operator|&
literal|1
operator|)
condition|?
literal|20
else|:
operator|(
literal|5
operator|+
name|abs
argument_list|(
name|ent
operator|->
name|velx
argument_list|)
operator|+
name|abs
argument_list|(
name|ent
operator|->
name|vely
argument_list|)
operator|)
operator|/
operator|(
operator|(
name|damflag
index|[
name|NOSHIELDS
index|]
operator|>>
literal|3
operator|)
operator|+
literal|1
operator|)
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
expr_stmt|;
if|if
condition|(
name|rand_mod
argument_list|(
literal|1
operator|+
name|tmp
operator|-
name|curobj
operator|->
name|energy
argument_list|)
operator|>
literal|100
operator|||
name|ent
operator|->
name|energy
operator|<
operator|(
name|entmax
operator|>>
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|debug
operator|&
literal|128
operator|||
operator|(
name|damage
operator|<=
name|smarts
operator|/
literal|10
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|6
operator|-
name|smarts
operator|/
literal|20
operator|-
name|massacre
argument_list|)
operator|)
condition|)
block|{
name|tmp
operator|=
name|rand_mod
argument_list|(
name|MAXDAMAGE
argument_list|)
expr_stmt|;
if|if
condition|(
name|damflag
index|[
name|tmp
index|]
condition|)
block|{
if|if
condition|(
name|damflag
index|[
name|tmp
index|]
operator|<
literal|60
condition|)
name|damflag
index|[
name|tmp
index|]
operator|+=
name|rand_mod
argument_list|(
literal|60
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|damflag
index|[
name|tmp
index|]
operator|=
name|rand_mod
argument_list|(
name|smarts
operator|+
literal|10
argument_list|)
operator|+
literal|2
expr_stmt|;
name|damage
operator|++
expr_stmt|;
block|}
block|}
block|}
break|break;
block|}
case|case
name|Base
case|:
if|if
condition|(
name|base
operator|->
name|energy
operator|>
literal|1000
operator|||
name|apolloflag
operator|&
literal|2
condition|)
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
operator|/
operator|(
operator|(
name|apolloflag
operator|&
literal|2
operator|)
condition|?
literal|20
else|:
literal|5
operator|)
expr_stmt|;
else|else
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
expr_stmt|;
break|break;
case|case
name|Crusher
case|:
if|if
condition|(
name|tmpblast
operator|>
literal|132767
condition|)
name|curobj
operator|->
name|energy
operator|-=
operator|(
name|tmpblast
operator|-
literal|100000
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|tmpblast
operator|>=
literal|100000
condition|)
block|{
name|curobj
operator|->
name|energy
operator|+=
operator|(
name|tmpblast
operator|-
literal|100000
operator|)
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|energy
operator|>
literal|32767
condition|)
name|curobj
operator|->
name|energy
operator|=
literal|32767
expr_stmt|;
block|}
else|else
comment|/* vulnerable while feeding */
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
expr_stmt|;
break|break;
case|case
name|Enemy
case|:
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
operator|*
literal|10
operator|/
name|enemshields
expr_stmt|;
break|break;
default|default:
name|curobj
operator|->
name|energy
operator|-=
name|tmpblast
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|curobj
operator|->
name|energy
operator|<
literal|0
condition|)
block|{
comment|/* killed it? */
switch|switch
condition|(
name|curobj
operator|->
name|image
condition|)
block|{
case|case
literal|'A'
case|:
name|tmpblast
operator|=
literal|100000
expr_stmt|;
name|make_blast
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
literal|8192L
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|numapollos
operator|=
name|apolloflag
operator|=
literal|0
expr_stmt|;
name|numstars
operator|--
expr_stmt|;
name|numenemies
operator|--
expr_stmt|;
name|curscore
operator|+=
literal|5000
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'E'
case|:
case|case
literal|'e'
case|:
case|case
literal|'C'
case|:
case|case
literal|'c'
case|:
name|ent
operator|=
literal|0
expr_stmt|;
name|numents
operator|--
expr_stmt|;
if|if
condition|(
name|base
condition|)
name|status
operator|=
literal|2
expr_stmt|;
else|else
name|status
operator|=
literal|3
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'B'
case|:
case|case
literal|'b'
case|:
name|base
operator|=
literal|0
expr_stmt|;
name|numbases
operator|--
expr_stmt|;
if|if
condition|(
name|ent
condition|)
name|status
operator|=
name|entmode
expr_stmt|;
else|else
name|status
operator|=
literal|3
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'&'
case|:
block|{
name|int
name|i
decl_stmt|,
name|xxx
decl_stmt|,
name|yyy
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|YSIZE
condition|;
name|i
operator|++
control|)
name|yblasted
index|[
name|i
index|]
operator|&=
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XSIZE
condition|;
name|i
operator|++
control|)
name|xblasted
index|[
name|i
index|]
operator|&=
literal|1
expr_stmt|;
name|numamoebas
operator|=
literal|0
expr_stmt|;
comment|/* ignore amb[][] now */
for|for
control|(
name|yyy
operator|=
literal|0
init|;
name|yyy
operator|<
name|YSIZE
condition|;
name|yyy
operator|++
control|)
block|{
for|for
control|(
name|xxx
operator|=
literal|0
init|;
name|xxx
operator|<
name|XSIZE
condition|;
name|xxx
operator|++
control|)
block|{
if|if
condition|(
name|amb
index|[
name|yyy
index|]
index|[
name|xxx
index|]
operator|==
literal|'~'
operator|&&
operator|!
name|occupant
index|[
name|yyy
index|]
index|[
name|xxx
index|]
condition|)
block|{
name|mvaddch
argument_list|(
name|yyy
operator|+
literal|1
argument_list|,
name|xxx
operator|*
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|numenemies
operator|--
expr_stmt|;
name|curscore
operator|+=
literal|10000
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
block|}
case|case
literal|'<'
case|:
case|case
literal|'>'
case|:
block|{
name|int
name|i
decl_stmt|;
name|numenemies
operator|--
expr_stmt|;
name|numcrushes
operator|=
literal|0
expr_stmt|;
name|curscore
operator|+=
literal|10000
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|movers
condition|)
name|movers
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
name|tmpblast
operator|=
literal|100000
expr_stmt|;
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|image
operator|==
literal|'<'
condition|)
block|{
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|<=
name|XSIZE01
condition|;
name|i
operator|++
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|<=
name|XSIZE02
condition|;
name|i
operator|++
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|XSIZE03
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|<=
name|XSIZE08
condition|;
name|i
operator|++
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|>=
name|XSIZE99
condition|;
name|i
operator|--
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|>=
name|XSIZE98
condition|;
name|i
operator|--
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|XSIZE97
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|XSIZE00
init|;
name|i
operator|>=
name|XSIZE92
condition|;
name|i
operator|--
control|)
name|make_blast
argument_list|(
name|y
argument_list|,
operator|(
name|x
operator|+
name|i
operator|)
operator|%
name|XSIZE
argument_list|,
literal|10000L
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
literal|'K'
case|:
name|numenemies
operator|--
expr_stmt|;
name|curscore
operator|+=
name|curobj
operator|->
name|mass
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|numenemies
operator|--
expr_stmt|;
name|curscore
operator|+=
name|curobj
operator|->
name|mass
operator|*
literal|3
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'R'
case|:
case|case
literal|' '
case|:
case|case
literal|'P'
case|:
name|numenemies
operator|--
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|flags
operator|&
name|PIRATE
condition|)
name|curscore
operator|+=
name|curobj
operator|->
name|mass
expr_stmt|;
else|else
name|curscore
operator|+=
name|curobj
operator|->
name|mass
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'G'
case|:
name|numenemies
operator|--
expr_stmt|;
name|numgorns
operator|--
expr_stmt|;
name|tmpblast
operator|=
literal|100000
expr_stmt|;
if|if
condition|(
name|madgorns
condition|)
name|curscore
operator|+=
name|curobj
operator|->
name|mass
operator|/
literal|2
expr_stmt|;
else|else
name|curscore
operator|+=
name|curobj
operator|->
name|mass
operator|*
literal|2
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
block|{
name|int
name|xxx
decl_stmt|,
name|yyy
decl_stmt|;
for|for
control|(
name|xxx
operator|=
operator|-
literal|1
init|;
name|xxx
operator|<=
literal|1
condition|;
name|xxx
operator|++
control|)
for|for
control|(
name|yyy
operator|=
operator|-
literal|1
init|;
name|yyy
operator|<=
literal|1
condition|;
name|yyy
operator|++
control|)
if|if
condition|(
name|rand_mod
argument_list|(
literal|2
operator|+
name|massacre
argument_list|)
condition|)
name|fire_torp
argument_list|(
name|curobj
argument_list|,
name|yyy
argument_list|,
name|xxx
argument_list|)
expr_stmt|;
block|}
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'@'
case|:
name|numinhab
operator|--
expr_stmt|;
comment|/* FALL THROUGH */
case|case
literal|'*'
case|:
name|banging
operator|=
name|TRUE
expr_stmt|;
name|numstars
operator|--
expr_stmt|;
break|break;
case|case
literal|'|'
case|:
case|case
literal|'-'
case|:
case|case
literal|'/'
case|:
case|case
literal|'\\'
case|:
name|tmpblast
operator|=
literal|100000
expr_stmt|;
name|make_blast
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
name|curobj
operator|->
name|mass
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|banging
operator|=
name|TRUE
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
name|curscore
operator|+=
literal|10
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'X'
case|:
name|curscore
operator|+=
literal|100
expr_stmt|;
name|numxes
operator|--
expr_stmt|;
name|deados
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'0'
case|:
name|curscore
operator|+=
literal|35
expr_stmt|;
name|numos
operator|--
expr_stmt|;
name|deados
operator|+=
literal|3
expr_stmt|;
break|break;
case|case
literal|'o'
case|:
name|curscore
operator|+=
literal|100
expr_stmt|;
name|numos
operator|--
expr_stmt|;
name|deados
operator|++
expr_stmt|;
break|break;
case|case
literal|'O'
case|:
name|curscore
operator|+=
literal|200
expr_stmt|;
name|numos
operator|--
expr_stmt|;
name|deados
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
name|deadmudds
operator|++
expr_stmt|;
name|inumfriends
operator|--
expr_stmt|;
name|numfriends
operator|--
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
break|break;
case|case
literal|'Q'
case|:
case|case
literal|'W'
case|:
case|case
literal|'Y'
case|:
case|case
literal|'U'
case|:
case|case
literal|'I'
case|:
case|case
literal|'S'
case|:
case|case
literal|'D'
case|:
case|case
literal|'H'
case|:
case|case
literal|'J'
case|:
case|case
literal|'L'
case|:
case|case
literal|'Z'
case|:
case|case
literal|'V'
case|:
case|case
literal|'F'
case|:
name|numfriends
operator|--
expr_stmt|;
if|if
condition|(
name|curobj
operator|==
name|enemies
condition|)
name|enemies
operator|=
name|curobj
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|inumfriends
operator|<
literal|10
condition|)
name|madfriends
operator|+=
literal|500
expr_stmt|;
else|else
name|madfriends
operator|+=
literal|10000
operator|/
name|inumfriends
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|tmpblast
operator|<
literal|100000
condition|)
name|make_blast
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
name|curobj
operator|->
name|mass
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|unmake_object
argument_list|(
name|curobj
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* didn't kill anything */
if|if
condition|(
operator|!
name|biggie
condition|)
name|biggie
operator|=
name|curobj
expr_stmt|;
else|else
block|{
if|if
condition|(
name|biggie
operator|->
name|mass
operator|>
name|curobj
operator|->
name|mass
condition|)
name|bounce
argument_list|(
name|curobj
argument_list|)
expr_stmt|;
else|else
block|{
name|bounce
argument_list|(
name|biggie
argument_list|)
expr_stmt|;
name|biggie
operator|=
name|curobj
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
name|biggie
condition|)
block|{
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|biggie
expr_stmt|;
if|if
condition|(
name|numamoebas
operator|&&
name|biggie
operator|->
name|image
operator|==
literal|' '
condition|)
name|mvaddch
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
argument_list|)
expr_stmt|;
else|else
name|mvaddch
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|biggie
operator|->
name|image
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
literal|0
expr_stmt|;
name|mvaddch
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|numamoebas
condition|?
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
else|:
literal|' '
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
block|}
block|}
name|do_bangs
argument_list|()
expr_stmt|;
if|if
condition|(
name|numcrushes
operator|&&
name|movers
operator|->
name|type
operator|==
name|Crusher
condition|)
name|movers
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|curobj
operator|=
name|base
condition|)
block|{
name|char
name|ch
decl_stmt|;
name|curobj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
name|curobj
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
name|curobj
operator|->
name|energy
operator|+=
literal|25
operator|*
name|lookaround
argument_list|(
name|curobj
operator|->
name|posy
argument_list|,
name|curobj
operator|->
name|posx
argument_list|,
name|Star
argument_list|)
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|energy
operator|>
name|basemax
condition|)
name|curobj
operator|->
name|energy
operator|=
name|basemax
expr_stmt|;
if|if
condition|(
name|curobj
operator|->
name|energy
operator|>=
literal|1000
condition|)
name|ch
operator|=
literal|'B'
expr_stmt|;
else|else
name|ch
operator|=
literal|'b'
expr_stmt|;
if|if
condition|(
name|ch
operator|!=
name|curobj
operator|->
name|image
condition|)
block|{
name|setimage
argument_list|(
name|curobj
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|curobj
operator|=
name|ent
condition|)
block|{
name|char
name|ch
decl_stmt|;
if|if
condition|(
name|entmode
operator|==
literal|0
condition|)
block|{
name|curobj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
name|curobj
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|base
operator|&&
operator|!
name|cloaking
operator|&&
operator|!
name|curobj
operator|->
name|velx
operator|&&
operator|!
name|curobj
operator|->
name|vely
operator|&&
name|lookfor
argument_list|(
name|curobj
operator|->
name|posy
argument_list|,
name|curobj
operator|->
name|posx
argument_list|,
name|Base
argument_list|)
condition|)
block|{
name|int
name|tmp
decl_stmt|;
ifdef|#
directive|ifdef
name|lint
name|tmp
operator|=
literal|0
expr_stmt|;
else|#
directive|else
name|tmp
operator|=
call|(
name|int
call|)
argument_list|(
name|base
operator|->
name|energy
operator|-
literal|1000
operator|<
name|entmax
operator|-
name|curobj
operator|->
name|energy
condition|?
name|base
operator|->
name|energy
operator|-
literal|1000
else|:
name|entmax
operator|-
name|curobj
operator|->
name|energy
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|tmp
operator|<
literal|0
condition|)
name|tmp
operator|=
literal|0
expr_stmt|;
name|curobj
operator|->
name|energy
operator|+=
name|tmp
expr_stmt|;
name|base
operator|->
name|energy
operator|-=
name|tmp
expr_stmt|;
name|tmp
operator|=
operator|(
name|btorp
operator|<
literal|50
operator|-
name|etorp
condition|?
name|btorp
else|:
literal|50
operator|-
name|etorp
operator|)
expr_stmt|;
name|etorp
operator|+=
name|tmp
expr_stmt|;
name|btorp
operator|-=
name|tmp
expr_stmt|;
if|if
condition|(
name|damage
condition|)
block|{
name|tmp
operator|=
name|rand_mod
argument_list|(
name|MAXDAMAGE
argument_list|)
expr_stmt|;
if|if
condition|(
name|damflag
index|[
name|tmp
index|]
operator|>
literal|5
condition|)
block|{
name|damflag
index|[
name|tmp
index|]
operator|=
name|rand_mod
argument_list|(
literal|5
argument_list|)
operator|+
literal|1
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|curobj
operator|->
name|energy
operator|>=
literal|500
operator|&&
operator|(
operator|!
name|damage
operator|||
operator|!
name|damflag
index|[
name|NOSHIELDS
index|]
operator|)
condition|)
name|ch
operator|=
name|cloaked
condition|?
literal|'C'
else|:
literal|'E'
expr_stmt|;
else|else
name|ch
operator|=
name|cloaked
condition|?
literal|'c'
else|:
literal|'e'
expr_stmt|;
if|if
condition|(
name|ch
operator|!=
name|curobj
operator|->
name|image
condition|)
block|{
name|setimage
argument_list|(
name|curobj
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|int
name|lookaround
parameter_list|(
name|y
parameter_list|,
name|x
parameter_list|,
name|what
parameter_list|)
name|Reg1
name|int
name|y
decl_stmt|;
name|Reg2
name|int
name|x
decl_stmt|;
name|Reg4
name|char
name|what
decl_stmt|;
block|{
name|Reg3
name|OBJECT
modifier|*
name|obj
decl_stmt|;
name|Reg5
name|int
name|count
init|=
literal|0
decl_stmt|;
name|Reg6
name|int
name|xp
decl_stmt|;
name|Reg7
name|int
name|xm
decl_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xp
operator|=
operator|(
name|x
operator|+
name|XSIZE01
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 0, 1 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
operator|=
operator|(
name|x
operator|+
name|XSIZE99
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 0, -1 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
name|YSIZE99
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* -1, 1 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* -1, 0 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* -1, -1 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
literal|2
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 1, 1 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 1, 0 */
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 1, -1 */
name|count
operator|++
expr_stmt|;
return|return
operator|(
name|count
operator|)
return|;
block|}
end_function

begin_function
name|int
name|lookfor
parameter_list|(
name|y
parameter_list|,
name|x
parameter_list|,
name|what
parameter_list|)
name|Reg1
name|int
name|y
decl_stmt|;
name|Reg2
name|int
name|x
decl_stmt|;
name|Reg4
name|char
name|what
decl_stmt|;
block|{
name|Reg3
name|OBJECT
modifier|*
name|obj
decl_stmt|;
name|Reg5
name|int
name|xp
decl_stmt|;
name|Reg6
name|int
name|xm
decl_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xp
operator|=
operator|(
name|x
operator|+
name|XSIZE01
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* 0, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
operator|=
operator|(
name|x
operator|+
name|XSIZE99
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* 0, -1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
name|YSIZE99
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* -1, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* -1, 0 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* -1,-1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
literal|2
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* 1, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
operator|||
comment|/* 1, 0 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|type
operator|==
name|what
condition|)
comment|/* 1, -1 */
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|OBJECT
modifier|*
name|lookimg
parameter_list|(
name|y
parameter_list|,
name|x
parameter_list|,
name|what
parameter_list|)
name|Reg1
name|int
name|y
decl_stmt|;
name|Reg2
name|int
name|x
decl_stmt|;
name|Reg4
name|char
name|what
decl_stmt|;
block|{
name|Reg3
name|OBJECT
modifier|*
name|obj
decl_stmt|;
name|Reg5
name|int
name|xp
decl_stmt|;
name|Reg6
name|int
name|xm
decl_stmt|;
if|if
condition|(
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xp
operator|=
operator|(
name|x
operator|+
name|XSIZE01
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* 0, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
operator|=
operator|(
name|x
operator|+
name|XSIZE99
operator|)
operator|%
name|XSIZE
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* 0, -1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
name|YSIZE99
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* -1, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* -1, 0 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* -1,-1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
operator|=
operator|(
name|y
operator|+
literal|2
operator|)
operator|%
name|YSIZE
index|]
index|[
name|xp
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* 1, 1 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
operator|||
comment|/* 1, 0 */
operator|(
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|xm
index|]
operator|)
operator|&&
name|obj
operator|->
name|image
operator|==
name|what
condition|)
comment|/* 1, -1 */
return|return
name|obj
return|;
return|return
name|Null
argument_list|(
name|OBJECT
operator|*
argument_list|)
return|;
block|}
end_function

end_unit

