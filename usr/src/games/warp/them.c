begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* $Header: them.c,v 7.0.1.5 86/12/12 17:05:41 lwall Exp $ */
end_comment

begin_comment
comment|/* $Log:	them.c,v $  * Revision 7.0.1.5  86/12/12  17:05:41  lwall  * Baseline for net release.  *   * Revision 7.0.1.4  86/10/20  12:32:38  lwall  * Wasn't clearing FRIENDLY flag on pirate creation.  *   * Revision 7.0.1.3  86/10/20  12:15:33  lwall  * Was trying to create pirates from cloaked pirates.  *   * Revision 7.0.1.2  86/10/17  10:03:44  lwall  * Fixed Romulan writing spaces while cloaked.  *   * Revision 7.0.1.1  86/10/16  10:53:39  lwall  * Added Damage.  Fixed random bugs.  *   * Revision 7.0  86/10/08  15:14:15  lwall  * Split into separate files.  Added amoebas and pirates.  *   */
end_comment

begin_include
include|#
directive|include
file|"EXTERN.h"
end_include

begin_include
include|#
directive|include
file|"warp.h"
end_include

begin_include
include|#
directive|include
file|"bang.h"
end_include

begin_include
include|#
directive|include
file|"object.h"
end_include

begin_include
include|#
directive|include
file|"move.h"
end_include

begin_include
include|#
directive|include
file|"score.h"
end_include

begin_include
include|#
directive|include
file|"term.h"
end_include

begin_include
include|#
directive|include
file|"us.h"
end_include

begin_include
include|#
directive|include
file|"util.h"
end_include

begin_include
include|#
directive|include
file|"weapon.h"
end_include

begin_include
include|#
directive|include
file|"INTERN.h"
end_include

begin_include
include|#
directive|include
file|"them.h"
end_include

begin_function
name|void
name|them_init
parameter_list|()
block|{
empty_stmt|;
block|}
end_function

begin_function
name|void
name|their_smarts
parameter_list|()
block|{
name|Reg1
name|OBJECT
modifier|*
name|curkl
decl_stmt|;
name|Reg2
name|OBJECT
modifier|*
name|obj
decl_stmt|;
name|Reg3
name|int
name|prob
decl_stmt|;
name|Reg4
name|int
name|count
decl_stmt|;
name|Reg5
name|int
name|y
decl_stmt|;
name|Reg6
name|int
name|x
decl_stmt|;
if|if
condition|(
name|numcrushes
operator|&&
operator|(
name|obj
operator|=
name|movers
operator|)
operator|->
name|type
operator|==
name|Crusher
condition|)
block|{
if|if
condition|(
name|numamoebas
condition|)
block|{
name|y
operator|=
name|obj
operator|->
name|posy
expr_stmt|;
name|x
operator|=
operator|(
name|obj
operator|->
name|posx
operator|+
operator|(
name|obj
operator|->
name|image
operator|==
literal|'<'
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
if|if
condition|(
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
literal|'~'
condition|)
block|{
name|obj
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
comment|/* stop and munch amoeba */
name|modify_amoeba
argument_list|(
name|y
argument_list|,
name|x
argument_list|,
literal|1
argument_list|,
literal|' '
argument_list|,
operator|(
name|int
operator|)
name|rand_mod
argument_list|(
literal|5
operator|+
name|ambsize
operator|/
literal|10
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
name|nuke
condition|)
comment|/* except go for nucleus */
name|obj
operator|->
name|velx
operator|=
operator|(
name|obj
operator|->
name|image
operator|==
literal|'<'
condition|?
literal|1
else|:
operator|-
literal|1
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|obj
operator|->
name|velx
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|4
argument_list|)
condition|)
name|obj
operator|->
name|image
operator|=
name|rand_mod
argument_list|(
literal|2
argument_list|)
condition|?
literal|'<'
else|:
literal|'>'
expr_stmt|;
name|obj
operator|->
name|velx
operator|=
name|obj
operator|->
name|image
operator|==
literal|'<'
condition|?
literal|1
else|:
operator|-
literal|1
expr_stmt|;
block|}
block|}
name|obj
operator|->
name|vely
operator|+=
operator|(
name|rand_mod
argument_list|(
literal|222
argument_list|)
operator|-
literal|111
operator|)
operator|/
literal|100
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|rand_mod
argument_list|(
literal|100
argument_list|)
operator|)
condition|)
block|{
name|setimage
argument_list|(
name|obj
argument_list|,
operator|(
name|obj
operator|->
name|velx
operator|*=
operator|-
literal|1
operator|)
operator|<
literal|0
condition|?
literal|'>'
else|:
literal|'<'
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|numamoebas
condition|)
block|{
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|3
argument_list|)
condition|)
name|nuke
operator|->
name|velx
operator|=
name|nuke
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|nuke
operator|->
name|strategy
operator|&&
name|ambsize
operator|<
literal|90
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|200
operator|-
name|smarts
argument_list|)
condition|)
name|modify_amoeba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|'~'
argument_list|,
operator|(
name|int
operator|)
name|rand_mod
argument_list|(
literal|10
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ambsize
operator|>
literal|200
operator|||
operator|(
name|ambsize
operator|>
literal|100
operator|&&
operator|!
name|rand_mod
argument_list|(
literal|15
argument_list|)
operator|)
condition|)
name|modify_amoeba
argument_list|(
name|yamblast
argument_list|,
name|xamblast
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|,
operator|(
name|ambsize
operator|-
literal|100
operator|)
operator|/
literal|5
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|curkl
operator|=
name|enemies
init|;
name|curkl
operator|->
name|type
operator|==
name|Enemy
condition|;
name|curkl
operator|=
name|curkl
operator|->
name|next
control|)
block|{
if|if
condition|(
operator|(
name|curkl
operator|->
name|flags
operator|&
operator|(
name|CLOAKS
operator||
name|FRIENDLY
operator|)
operator|)
operator|==
name|CLOAKS
operator|&&
operator|(
name|curkl
operator|->
name|image
operator|!=
literal|' '
operator|)
operator|&&
operator|(
name|curkl
operator|->
name|energy
operator|>
literal|300
operator|||
name|massacre
operator|)
condition|)
block|{
name|setimage
argument_list|(
name|curkl
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|madgorns
condition|)
name|prob
operator|=
literal|3
expr_stmt|;
elseif|else
if|if
condition|(
name|curkl
operator|->
name|vely
operator|||
name|curkl
operator|->
name|velx
condition|)
name|prob
operator|=
name|massacre
condition|?
literal|10
else|:
literal|20
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|curkl
operator|->
name|flags
operator|&
operator|(
name|PIRATE
operator||
name|FRIENDLY
operator|)
operator|)
operator|==
name|PIRATE
condition|)
block|{
comment|/* pirates want to sit sometimes */
if|if
condition|(
name|curkl
operator|->
name|strategy
condition|)
block|{
if|if
condition|(
operator|(
name|obj
operator|=
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'@'
argument_list|)
operator|)
operator|||
operator|(
name|obj
operator|=
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'B'
argument_list|)
operator|)
condition|)
block|{
name|make_plink
argument_list|(
name|obj
operator|->
name|posy
argument_list|,
name|obj
operator|->
name|posx
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|--
name|curkl
operator|->
name|strategy
condition|)
block|{
comment|/* clock ran down */
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'@'
condition|)
block|{
name|obj
operator|->
name|image
operator|=
literal|'*'
expr_stmt|;
name|numinhab
operator|--
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|flags
operator|&
name|STATIC
condition|)
name|mvaddch
argument_list|(
name|obj
operator|->
name|posy
operator|+
literal|1
argument_list|,
name|obj
operator|->
name|posx
operator|*
literal|2
argument_list|,
name|obj
operator|->
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|curkl
operator|->
name|energy
operator|<
literal|20000
condition|)
name|curkl
operator|->
name|energy
operator|+=
literal|5000
expr_stmt|;
block|}
name|prob
operator|=
literal|2
expr_stmt|;
comment|/* our work here is done */
block|}
elseif|else
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'B'
condition|)
block|{
name|btorp
operator|-=
name|rand_mod
argument_list|(
literal|50
argument_list|)
expr_stmt|;
if|if
condition|(
name|btorp
operator|<
literal|0
condition|)
name|btorp
operator|=
literal|0
expr_stmt|;
name|obj
operator|->
name|energy
operator|-=
name|rand_mod
argument_list|(
literal|500
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|energy
operator|<
literal|0
condition|)
name|obj
operator|->
name|energy
operator|=
literal|0
expr_stmt|;
name|prob
operator|=
literal|10000
expr_stmt|;
comment|/* stay here */
block|}
else|else
name|prob
operator|=
literal|10000
expr_stmt|;
block|}
else|else
block|{
comment|/* it went away--go elsewhere */
name|prob
operator|=
literal|4
expr_stmt|;
name|curkl
operator|->
name|strategy
operator|=
literal|0
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'@'
argument_list|)
operator|||
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'B'
argument_list|)
condition|)
block|{
name|curkl
operator|->
name|strategy
operator|=
name|rand_mod
argument_list|(
literal|15
argument_list|)
operator|+
literal|5
expr_stmt|;
name|prob
operator|=
literal|10000
expr_stmt|;
block|}
else|else
name|prob
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|'M'
condition|)
block|{
comment|/* Mudd wants to sit sometimes */
if|if
condition|(
operator|(
name|obj
operator|=
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'E'
argument_list|)
operator|)
operator|||
operator|(
name|obj
operator|=
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'B'
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'B'
condition|)
block|{
name|btorp
operator|-=
name|rand_mod
argument_list|(
literal|40
argument_list|)
expr_stmt|;
if|if
condition|(
name|btorp
operator|<
literal|0
condition|)
name|btorp
operator|=
literal|0
expr_stmt|;
name|obj
operator|->
name|energy
operator|-=
name|rand_mod
argument_list|(
literal|100
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|energy
operator|<
literal|0
condition|)
name|obj
operator|->
name|energy
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|obj
operator|->
name|vely
operator|&&
operator|!
name|obj
operator|->
name|velx
condition|)
block|{
name|etorp
operator|-=
name|rand_mod
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|etorp
operator|<
literal|0
condition|)
name|etorp
operator|=
literal|0
expr_stmt|;
name|obj
operator|->
name|energy
operator|-=
name|rand_mod
argument_list|(
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|energy
operator|<
literal|0
condition|)
name|obj
operator|->
name|energy
operator|=
literal|0
expr_stmt|;
block|}
name|prob
operator|=
literal|10000
expr_stmt|;
comment|/* stay here */
block|}
else|else
comment|/* it went away--go elsewhere */
name|prob
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|flags
operator|&
name|FRIENDLY
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|energy
operator|<
literal|10000
operator|&&
name|lookimg
argument_list|(
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|'@'
argument_list|)
condition|)
block|{
name|curkl
operator|->
name|energy
operator|+=
literal|100
expr_stmt|;
name|prob
operator|=
literal|20
expr_stmt|;
comment|/* do some loading */
block|}
else|else
name|prob
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|'&'
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|flags
operator|&
name|COUNTDOWN
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|strategy
condition|)
name|curkl
operator|->
name|strategy
operator|--
expr_stmt|;
else|else
name|curkl
operator|->
name|flags
operator|&=
operator|~
name|COUNTDOWN
expr_stmt|;
name|prob
operator|=
literal|100
expr_stmt|;
comment|/* someone's feeding us, so sit still */
block|}
else|else
name|prob
operator|=
literal|4
expr_stmt|;
block|}
else|else
name|prob
operator|=
literal|4
expr_stmt|;
comment|/* don't sit still too long */
name|count
operator|=
literal|11
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|--
name|count
operator|<=
literal|0
condition|)
comment|/* no opening, just ram something */
break|break;
ifdef|#
directive|ifdef
name|lint
name|prob
operator|=
name|prob
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
operator|(
name|rand_mod
argument_list|(
name|prob
argument_list|)
operator|)
condition|)
comment|/* turn randomly occasionally */
goto|goto
name|accell
goto|;
name|y
operator|=
operator|(
name|curkl
operator|->
name|posy
operator|+
name|curkl
operator|->
name|vely
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
comment|/* find prospective */
name|x
operator|=
operator|(
name|curkl
operator|->
name|posx
operator|+
name|curkl
operator|->
name|velx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
comment|/*   new position */
if|if
condition|(
name|numamoebas
condition|)
block|{
if|if
condition|(
name|curkl
operator|==
name|nuke
condition|)
block|{
if|if
condition|(
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|!=
literal|'~'
condition|)
goto|goto
name|accell
goto|;
comment|/* never move nucleus from protoplasm */
block|}
else|else
block|{
if|if
condition|(
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|==
literal|'~'
operator|&&
name|rand_mod
argument_list|(
literal|2
argument_list|)
condition|)
block|{
name|yamblast
operator|=
name|y
expr_stmt|;
name|xamblast
operator|=
name|x
expr_stmt|;
goto|goto
name|accell
goto|;
block|}
block|}
block|}
name|obj
operator|=
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|obj
condition|)
break|break;
comment|/* is anyone there? */
switch|switch
condition|(
name|obj
operator|->
name|type
condition|)
block|{
case|case
name|Star
case|:
if|if
condition|(
name|obj
operator|->
name|image
operator|==
literal|'@'
operator|&&
operator|(
name|curkl
operator|->
name|flags
operator|&
name|PIRATE
operator|)
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|image
operator|!=
literal|'P'
operator|&&
name|curkl
operator|->
name|image
operator|!=
literal|' '
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|flags
operator|&
name|FRIENDLY
condition|)
block|{
name|curkl
operator|->
name|flags
operator|&=
operator|~
name|FRIENDLY
expr_stmt|;
name|curkl
operator|->
name|energy
operator|+=
literal|1000
expr_stmt|;
name|possiblescore
operator|+=
name|curkl
operator|->
name|mass
expr_stmt|;
name|inumfriends
operator|--
expr_stmt|;
name|numfriends
operator|--
expr_stmt|;
name|inumenemies
operator|++
expr_stmt|;
name|numenemies
operator|++
expr_stmt|;
block|}
name|curkl
operator|->
name|image
operator|=
literal|'P'
expr_stmt|;
block|}
break|break;
comment|/* go ahead and ram the star */
block|}
goto|goto
name|accell
goto|;
comment|/* try not to ram stars */
case|case
name|Torp
case|:
if|if
condition|(
operator|!
name|obj
operator|->
name|vely
operator|&&
operator|!
name|obj
operator|->
name|velx
operator|&&
operator|(
name|rand_mod
argument_list|(
literal|100
argument_list|)
operator|<=
name|smarts
operator|)
operator|&&
operator|(
name|obj
operator|->
name|image
operator|==
literal|'o'
operator|||
name|obj
operator|->
name|image
operator|==
literal|'O'
operator|||
name|obj
operator|->
name|image
operator|==
literal|'X'
operator|)
condition|)
goto|goto
name|accell
goto|;
comment|/* try not to ram "friendly" torps */
break|break;
case|case
name|Web
case|:
if|if
condition|(
name|curkl
operator|->
name|image
operator|!=
literal|'T'
condition|)
goto|goto
name|accell
goto|;
comment|/* non-Tholians shouldn't ram web */
if|if
condition|(
name|count
operator|<=
literal|5
condition|)
break|break;
comment|/* Tholians retrace web if desperate */
if|if
condition|(
name|obj
operator|->
name|image
operator|==
operator|(
name|curkl
operator|->
name|vely
condition|?
operator|(
name|curkl
operator|->
name|velx
condition|?
operator|(
name|curkl
operator|->
name|velx
operator|==
name|curkl
operator|->
name|vely
condition|?
literal|'\\'
else|:
literal|'/'
operator|)
else|:
literal|'|'
operator|)
else|:
literal|'-'
operator|)
condition|)
goto|goto
name|accell
goto|;
comment|/* Tholians try not to retrace web */
break|break;
comment|/* No problem with crossing web */
block|}
break|break;
comment|/* okay to move over object */
name|accell
label|:
comment|/* determine maximum velocity */
if|if
condition|(
name|massacre
operator|&&
name|curkl
operator|->
name|image
operator|!=
literal|'T'
condition|)
block|{
name|curkl
operator|->
name|vely
operator|=
name|rand_mod
argument_list|(
literal|7
argument_list|)
operator|-
literal|3
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
name|rand_mod
argument_list|(
literal|7
argument_list|)
operator|-
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|'&'
condition|)
block|{
if|if
condition|(
name|rand_mod
argument_list|(
literal|2
argument_list|)
condition|)
block|{
name|curkl
operator|->
name|vely
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|curkl
operator|->
name|vely
operator|=
name|curkl
operator|->
name|strategy
operator|&
literal|3
expr_stmt|;
if|if
condition|(
name|curkl
operator|->
name|vely
operator|&
literal|2
condition|)
name|curkl
operator|->
name|vely
operator|=
operator|-
literal|1
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
operator|(
name|curkl
operator|->
name|strategy
operator|>>
literal|2
operator|)
operator|&
literal|3
expr_stmt|;
if|if
condition|(
name|curkl
operator|->
name|velx
operator|&
literal|2
condition|)
name|curkl
operator|->
name|velx
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|energy
operator|>=
literal|2500
operator|&&
name|curkl
operator|->
name|image
operator|!=
literal|'T'
condition|)
block|{
name|curkl
operator|->
name|vely
operator|=
name|rand_mod
argument_list|(
literal|5
argument_list|)
operator|-
literal|2
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
name|rand_mod
argument_list|(
literal|5
argument_list|)
operator|-
literal|2
expr_stmt|;
block|}
else|else
block|{
name|curkl
operator|->
name|vely
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|count
operator|!=
literal|10
condition|)
block|{
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|' '
condition|)
block|{
name|setimage
argument_list|(
name|curkl
argument_list|,
name|curkl
operator|->
name|flags
operator|&
name|PIRATE
condition|?
literal|'P'
else|:
literal|'R'
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|count
condition|)
block|{
name|curkl
operator|->
name|vely
operator|=
literal|0
expr_stmt|;
name|curkl
operator|->
name|velx
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|'G'
operator|&&
operator|(
name|base
operator|||
name|ent
operator|)
operator|&&
operator|!
name|rand_mod
argument_list|(
operator|(
literal|103
operator|-
name|smarts
operator|)
operator|*
literal|10
argument_list|)
condition|)
block|{
name|int
name|xxx
decl_stmt|,
name|yyy
decl_stmt|;
for|for
control|(
name|xxx
operator|=
operator|-
literal|1
init|;
name|xxx
operator|<=
literal|1
condition|;
name|xxx
operator|++
control|)
for|for
control|(
name|yyy
operator|=
operator|-
literal|1
init|;
name|yyy
operator|<=
literal|1
condition|;
name|yyy
operator|++
control|)
if|if
condition|(
operator|(
name|xxx
operator|||
name|yyy
operator|)
operator|&&
name|rand_mod
argument_list|(
literal|2
argument_list|)
condition|)
name|fire_torp
argument_list|(
name|curkl
argument_list|,
name|yyy
argument_list|,
name|xxx
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|curkl
operator|->
name|image
operator|==
literal|'T'
operator|&&
operator|(
name|curkl
operator|->
name|velx
operator|||
name|curkl
operator|->
name|vely
operator|)
condition|)
block|{
name|Make_object
argument_list|(
name|Web
argument_list|,
name|curkl
operator|->
name|vely
condition|?
operator|(
name|curkl
operator|->
name|velx
condition|?
operator|(
name|curkl
operator|->
name|velx
operator|==
name|curkl
operator|->
name|vely
condition|?
literal|'\\'
else|:
literal|'/'
operator|)
else|:
literal|'|'
operator|)
else|:
literal|'-'
argument_list|,
name|curkl
operator|->
name|posy
argument_list|,
name|curkl
operator|->
name|posx
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|32767L
argument_list|,
literal|32767L
argument_list|,
operator|&
name|root
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|&&
name|obj
operator|->
name|type
operator|==
name|Web
condition|)
block|{
name|unmake_object
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|Null
argument_list|(
name|OBJECT
operator|*
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/* klingon-style fighting */
if|if
condition|(
name|numamoebas
condition|)
name|attack
argument_list|(
name|nuke
argument_list|)
expr_stmt|;
name|attack
argument_list|(
name|base
argument_list|)
expr_stmt|;
if|if
condition|(
name|ent
operator|&&
operator|(
operator|!
name|cloaked
operator|||
name|ent
operator|->
name|image
operator|==
literal|'E'
operator|||
name|ent
operator|->
name|image
operator|==
literal|'e'
operator|)
condition|)
name|attack
argument_list|(
name|ent
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|modify_amoeba
parameter_list|(
name|y
parameter_list|,
name|x
parameter_list|,
name|where
parameter_list|,
name|ch
parameter_list|,
name|quant
parameter_list|)
name|Reg1
name|int
name|y
decl_stmt|;
name|Reg2
name|int
name|x
decl_stmt|;
name|int
name|where
decl_stmt|;
name|Reg6
name|int
name|ch
decl_stmt|;
name|Reg7
name|int
name|quant
decl_stmt|;
block|{
name|Reg3
name|int
name|dy
decl_stmt|;
name|Reg4
name|int
name|dx
decl_stmt|;
name|Reg5
name|int
name|count
init|=
literal|15
decl_stmt|;
if|if
condition|(
operator|!
name|numamoebas
condition|)
return|return;
if|if
condition|(
operator|!
name|where
operator|||
operator|(
name|where
operator|==
literal|1
operator|&&
name|rand_mod
argument_list|(
literal|2
argument_list|)
operator|)
condition|)
block|{
name|y
operator|=
name|nuke
operator|->
name|posy
expr_stmt|;
name|x
operator|=
name|nuke
operator|->
name|posx
expr_stmt|;
block|}
if|if
condition|(
name|nuke
operator|->
name|strategy
operator|&&
name|rand_mod
argument_list|(
literal|3
argument_list|)
condition|)
block|{
name|dy
operator|=
name|nuke
operator|->
name|strategy
operator|&
literal|3
expr_stmt|;
if|if
condition|(
name|dy
operator|&
literal|2
condition|)
name|dy
operator|=
operator|-
literal|1
expr_stmt|;
name|dx
operator|=
operator|(
name|nuke
operator|->
name|strategy
operator|>>
literal|2
operator|)
operator|&
literal|3
expr_stmt|;
if|if
condition|(
name|dx
operator|&
literal|2
condition|)
name|dx
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|ch
operator|==
literal|' '
condition|)
block|{
comment|/* take from the tail */
name|dy
operator|=
operator|-
name|dy
expr_stmt|;
name|dx
operator|=
operator|-
name|dx
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|rand_mod
argument_list|(
literal|100
argument_list|)
condition|)
name|nuke
operator|->
name|strategy
operator|=
name|rand_mod
argument_list|(
literal|256
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dy
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
name|dx
operator|=
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dy
operator|&&
operator|!
name|dx
condition|)
return|return;
do|do
block|{
if|if
condition|(
operator|--
name|count
operator|<
literal|0
condition|)
return|return;
name|y
operator|=
operator|(
name|y
operator|+
name|dy
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|+
name|dx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
block|}
do|while
condition|(
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|!=
literal|' '
condition|)
do|;
if|if
condition|(
name|ch
operator|==
literal|' '
condition|)
block|{
name|y
operator|=
operator|(
name|y
operator|-
name|dy
operator|+
name|YSIZE00
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|-
name|dx
operator|+
name|XSIZE00
operator|)
operator|%
name|XSIZE
expr_stmt|;
block|}
if|if
condition|(
name|ambsize
operator|>
literal|100
operator|&&
name|quant
operator|>
literal|2
condition|)
block|{
name|quant
operator|>>=
operator|(
name|ambsize
operator|/
literal|100
operator|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|nuke
operator|->
name|energy
operator|+=
name|quant
operator|<<
literal|6
operator|)
operator|>
literal|32767
condition|)
name|nuke
operator|->
name|energy
operator|=
literal|32767
expr_stmt|;
name|count
operator|=
name|quant
operator|<<
literal|3
expr_stmt|;
comment|/* endless loop catcher */
while|while
condition|(
name|count
operator|--
operator|>
literal|0
operator|&&
name|quant
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|!=
name|ch
condition|)
block|{
name|quant
operator|--
expr_stmt|;
name|amb
index|[
name|y
index|]
index|[
name|x
index|]
operator|=
name|ch
expr_stmt|;
if|if
condition|(
name|ch
operator|==
literal|'~'
condition|)
block|{
name|ambsize
operator|++
expr_stmt|;
name|yblasted
index|[
name|y
index|]
operator||=
literal|2
expr_stmt|;
name|xblasted
index|[
name|x
index|]
operator||=
literal|2
expr_stmt|;
name|blasted
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
name|ambsize
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|occupant
index|[
name|y
index|]
index|[
name|x
index|]
condition|)
name|mvaddch
argument_list|(
name|y
operator|+
literal|1
argument_list|,
name|x
operator|*
literal|2
argument_list|,
name|ch
argument_list|)
expr_stmt|;
block|}
name|y
operator|=
operator|(
name|y
operator|+
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|+
name|YSIZE99
operator|)
operator|%
name|YSIZE
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|+
name|rand_mod
argument_list|(
literal|3
argument_list|)
operator|+
name|XSIZE99
operator|)
operator|%
name|XSIZE
expr_stmt|;
block|}
block|}
end_function

end_unit

