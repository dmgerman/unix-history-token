begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_comment
comment|/*  * Dungeon - open UP dungeon  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|CHECKUID
end_ifdef

begin_decl_stmt
name|int
name|users
index|[]
init|=
block|{
literal|522
block|,
comment|/* sa */
literal|164
block|,
comment|/* Leiby */
literal|229
block|,
comment|/* richards */
literal|264
block|,
comment|/* marshall */
literal|1099
block|,
comment|/* wizard */
literal|425
block|,
comment|/* clm */
literal|15
block|,
comment|/* mowle */
literal|32
block|,
comment|/* ghg */
literal|27
block|,
comment|/* qtip (zager) */
literal|530
block|,
comment|/* mike */
literal|16
block|,
comment|/* bc */
literal|333
block|,
comment|/* pdh */
literal|230
block|,
comment|/* wa1yyn */
literal|19
block|,
comment|/* joe 	43,	/* bruner */
literal|308
block|,
comment|/* gedeon (watch him closely!) */
literal|429
block|,
comment|/* mayhew */
literal|743
block|,
comment|/* alicia */
literal|367
block|,
comment|/* feather */
literal|85
block|,
comment|/* clark bar */
literal|382
block|,
comment|/* malcolm */
literal|99
block|,
comment|/* jones */
literal|636
block|,
comment|/* gfg */
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|main
parameter_list|()
block|{
specifier|register
name|int
modifier|*
name|up
decl_stmt|;
specifier|register
name|uid
expr_stmt|;
name|int
name|fd3
decl_stmt|,
name|fd4
decl_stmt|,
name|fd5
decl_stmt|;
ifdef|#
directive|ifdef
name|CHECKUID
name|uid
operator|=
name|getuid
argument_list|()
expr_stmt|;
for|for
control|(
name|up
operator|=
name|users
init|;
operator|*
name|up
condition|;
name|up
operator|++
control|)
if|if
condition|(
operator|*
name|up
operator|==
name|uid
condition|)
goto|goto
name|ok
goto|;
name|printf
argument_list|(
literal|"You are not a Wizard!\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|()
expr_stmt|;
endif|#
directive|endif
comment|/* 	 * open up files needed by program 	 * look in current directory first, then try default names 	 * The following files must be as follows: 	 * "dtext.dat" open read-only on fd 3 	 * "dindex.dat open read-only on fd 4 (maybe this file isn't used) 	 * "doverlay" open read-only on fd 5 (put this file on fast disk) 	 */
name|close
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fd3
operator|=
name|open
argument_list|(
literal|"dtext.dat"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
if|if
condition|(
operator|(
name|fd3
operator|=
name|open
argument_list|(
literal|"/usr/games/lib/dtext.dat"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|error
argument_list|(
literal|"Can't open dtext.dat\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fd4
operator|=
name|open
argument_list|(
literal|"dindex.dat"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
if|if
condition|(
operator|(
name|fd4
operator|=
name|open
argument_list|(
literal|"/usr/games/lib/dindex.dat"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|error
argument_list|(
literal|"Can' open dindex.dat\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fd5
operator|=
name|open
argument_list|(
literal|"doverlay"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
if|if
condition|(
operator|(
name|fd5
operator|=
name|open
argument_list|(
literal|"/tmp/nedtmp/doverlay"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
if|if
condition|(
operator|(
name|fd5
operator|=
name|open
argument_list|(
literal|"/usr/games/lib/doverlay"
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|error
argument_list|(
literal|"Can't open doverlay\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd3
operator|!=
literal|3
operator|||
name|fd4
operator|!=
literal|4
operator|||
name|fd5
operator|!=
literal|5
condition|)
name|error
argument_list|(
literal|"Files opened on wrong descriptors\n"
argument_list|)
expr_stmt|;
name|signal
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"You are in an open field west of a big white house with a boarded\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"front door.\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"There is a small mailbox here.\n>"
argument_list|)
expr_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|pdp11
name|execl
argument_list|(
literal|"dungeon"
argument_list|,
literal|"zork"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|execl
argument_list|(
literal|"/usr/games/lib/dungeon"
argument_list|,
literal|"zork"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|#
directive|else
if|if
condition|(
operator|(
name|uid
operator|=
name|open
argument_list|(
literal|"dungeon"
argument_list|,
literal|0
argument_list|)
operator|)
operator|>
literal|0
condition|)
block|{
name|close
argument_list|(
name|uid
argument_list|)
expr_stmt|;
name|execlp
argument_list|(
literal|"compat"
argument_list|,
literal|"zork"
argument_list|,
literal|"dungeon"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|execlp
argument_list|(
literal|"/usr/games/lib/compat"
argument_list|,
literal|"zork"
argument_list|,
literal|"dungeon"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|execlp
argument_list|(
literal|"compat"
argument_list|,
literal|"zork"
argument_list|,
literal|"/usr/games/lib/dungeon"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|execlp
argument_list|(
literal|"/usr/games/lib/compat"
argument_list|,
literal|"zork"
argument_list|,
literal|"/usr/games/lib/dungeon"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|printf
argument_list|(
literal|"Can't start dungeons.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|error
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

