begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"@(#)driver2.c	1.1 83/03/17"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|EXPLODE
value|5
end_define

begin_include
include|#
directive|include
file|"externs.h"
end_include

begin_define
define|#
directive|define
name|couldwin
parameter_list|(
name|from
parameter_list|,
name|to
parameter_list|)
value|(specs[scene[game].ship[from].shipnum].crew2> specs[scene[game].ship[to].shipnum].crew2 * 1.5)
end_define

begin_macro
name|thinkofgrapples
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|,
name|l
decl_stmt|,
name|friendly
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|n
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|captain
index|[
literal|0
index|]
operator|&&
name|pos
index|[
name|n
index|]
operator|.
name|dir
condition|)
block|{
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|l
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|friendly
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|l
index|]
operator|.
name|file
operator|->
name|captured
operator|)
operator|<
literal|0
condition|)
name|friendly
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|nationality
operator|==
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|l
index|]
operator|.
name|nationality
expr_stmt|;
else|else
name|friendly
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|nationality
operator|==
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|friendly
index|]
operator|.
name|nationality
expr_stmt|;
if|if
condition|(
operator|!
name|friendly
condition|)
block|{
if|if
condition|(
name|range
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
operator|==
literal|1
operator|&&
operator|!
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|struck
operator|&&
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|captured
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|grapple
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
condition|)
if|if
condition|(
name|toughmelee
argument_list|(
name|n
argument_list|,
name|l
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
name|ungrap
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
expr_stmt|;
else|else
name|grap
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|couldwin
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
condition|)
block|{
name|grap
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
expr_stmt|;
name|loadwith
index|[
name|n
index|]
operator|=
name|GRAPE
expr_stmt|;
block|}
block|}
block|}
else|else
name|ungrap
argument_list|(
name|n
argument_list|,
name|l
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|checkup
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|k
decl_stmt|,
name|n
decl_stmt|,
name|explode
decl_stmt|,
name|sink
decl_stmt|;
name|readpos
argument_list|()
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|n
operator|++
control|)
block|{
name|explode
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|explode
expr_stmt|;
name|sink
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|sink
expr_stmt|;
if|if
condition|(
name|die
argument_list|()
operator|>=
literal|5
operator|&&
operator|(
name|explode
operator|==
literal|1
operator|||
name|sink
operator|==
literal|1
operator|)
condition|)
block|{
name|explode
operator|=
literal|2
expr_stmt|;
if|if
condition|(
name|sink
operator|!=
literal|1
condition|)
name|Write
argument_list|(
name|FILES
operator|+
name|n
argument_list|,
literal|0
argument_list|,
literal|232
argument_list|,
name|explode
argument_list|)
expr_stmt|;
else|else
name|Write
argument_list|(
name|FILES
operator|+
name|n
argument_list|,
literal|0
argument_list|,
literal|234
argument_list|,
name|explode
argument_list|)
expr_stmt|;
name|pos
index|[
name|n
index|]
operator|.
name|dir
operator|=
literal|0
expr_stmt|;
comment|/* hopefully enough to kill ship */
name|Write
argument_list|(
name|n
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|fouled
argument_list|(
name|n
argument_list|)
operator|||
name|grappled
argument_list|(
name|n
argument_list|)
condition|)
block|{
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
literal|10
condition|;
name|k
operator|++
control|)
block|{
if|if
condition|(
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|fouls
index|[
name|k
index|]
operator|.
name|turnfoul
condition|)
name|cleanfoul
argument_list|(
name|n
argument_list|,
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|fouls
index|[
name|k
index|]
operator|.
name|toship
argument_list|,
name|k
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
literal|10
condition|;
name|k
operator|++
control|)
block|{
if|if
condition|(
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|grapples
index|[
name|k
index|]
operator|.
name|turnfoul
condition|)
name|cleangrapple
argument_list|(
name|n
argument_list|,
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|grapples
index|[
name|k
index|]
operator|.
name|toship
argument_list|,
name|k
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|sink
operator|!=
literal|1
condition|)
block|{
name|makesignal
argument_list|(
literal|"exploding!"
argument_list|,
literal|0
argument_list|,
name|n
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|k
operator|!=
name|n
operator|&&
name|pos
index|[
name|k
index|]
operator|.
name|dir
operator|&&
name|range
argument_list|(
name|n
argument_list|,
name|k
argument_list|)
operator|<
literal|4
condition|)
name|table
argument_list|(
name|RIGGING
argument_list|,
name|EXPLODE
argument_list|,
name|specs
index|[
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|shipnum
index|]
operator|.
name|guns
operator|/
literal|13
argument_list|,
name|k
argument_list|,
name|n
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|makesignal
argument_list|(
literal|"sinking!"
argument_list|,
literal|0
argument_list|,
name|n
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_macro
name|prizecheck
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|,
name|captured
decl_stmt|,
name|pc
decl_stmt|,
name|prisoners
decl_stmt|,
name|points
decl_stmt|;
name|struct
name|shipspecs
modifier|*
name|ptr
decl_stmt|;
name|struct
name|File
modifier|*
name|ptr1
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|n
operator|++
control|)
block|{
name|ptr1
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
expr_stmt|;
if|if
condition|(
operator|(
name|captured
operator|=
name|ptr1
operator|->
name|captured
operator|)
operator|>
operator|-
literal|1
operator|&&
operator|!
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|struck
operator|&&
name|pos
index|[
name|n
index|]
operator|.
name|dir
condition|)
block|{
name|ptr
operator|=
operator|&
name|specs
index|[
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|shipnum
index|]
expr_stmt|;
name|points
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|captured
index|]
operator|.
name|file
operator|->
name|points
expr_stmt|;
name|prisoners
operator|=
name|ptr
operator|->
name|crew1
operator|+
name|ptr
operator|->
name|crew2
operator|+
name|ptr
operator|->
name|crew3
expr_stmt|;
if|if
condition|(
name|prisoners
operator|>
name|ptr1
operator|->
name|pcrew
operator|*
literal|6
condition|)
block|{
name|Write
argument_list|(
name|FILES
operator|+
name|n
argument_list|,
literal|0
argument_list|,
literal|68
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|points
operator|-=
literal|2
operator|*
name|ptr
operator|->
name|pts
expr_stmt|;
name|Write
argument_list|(
name|FILES
operator|+
name|n
argument_list|,
literal|1
argument_list|,
literal|164
argument_list|,
literal|"prize crew overthrown"
argument_list|)
expr_stmt|;
name|Write
argument_list|(
name|FILES
operator|+
name|captured
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
name|points
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_block

begin_function
name|char
name|strend
parameter_list|(
name|str
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
block|{
specifier|register
name|int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
operator|*
operator|(
name|str
operator|+
name|n
operator|)
condition|;
name|n
operator|++
control|)
empty_stmt|;
return|return
operator|(
name|n
condition|?
operator|*
operator|(
name|str
operator|+
name|n
operator|-
literal|1
operator|)
else|:
literal|0
operator|)
return|;
block|}
end_function

begin_macro
name|closeon
argument_list|(
argument|fromship
argument_list|,
argument|toship
argument_list|,
argument|command
argument_list|,
argument|ta
argument_list|,
argument|ma
argument_list|,
argument|af
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fromship
decl_stmt|,
name|toship
decl_stmt|,
name|ma
decl_stmt|,
name|ta
decl_stmt|,
name|af
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|command
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|high
decl_stmt|;
name|char
name|temp
index|[
literal|10
index|]
decl_stmt|;
name|temp
index|[
literal|0
index|]
operator|=
name|command
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|high
operator|=
operator|-
literal|30000
expr_stmt|;
name|try
argument_list|(
name|command
argument_list|,
name|temp
argument_list|,
name|ma
argument_list|,
name|ta
argument_list|,
name|af
argument_list|,
name|ma
argument_list|,
name|pos
index|[
name|fromship
index|]
operator|.
name|dir
argument_list|,
name|fromship
argument_list|,
name|toship
argument_list|,
operator|&
name|high
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|int
name|dtab
index|[
literal|8
index|]
init|=
block|{
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* diagonal distances in x==y */
end_comment

begin_macro
name|score
argument_list|(
argument|movement
argument_list|,
argument|shipnum
argument_list|,
argument|toship
argument_list|,
argument|permanent
argument_list|,
argument|onlytemp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|shipnum
decl_stmt|,
name|toship
decl_stmt|,
name|permanent
decl_stmt|,
name|onlytemp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|movement
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|drift
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|,
name|dir
decl_stmt|,
name|n
decl_stmt|,
name|dist
decl_stmt|,
name|total
decl_stmt|,
name|ran
decl_stmt|;
name|int
name|dr
init|=
literal|0
decl_stmt|,
name|dc
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|dir
operator|=
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
condition|)
block|{
name|row
operator|=
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
expr_stmt|;
name|col
operator|=
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|movement
index|[
name|n
index|]
condition|;
name|n
operator|++
control|)
switch|switch
condition|(
name|movement
index|[
name|n
index|]
condition|)
block|{
case|case
literal|'r'
case|:
if|if
condition|(
operator|(
operator|++
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|)
operator|==
literal|9
condition|)
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
if|if
condition|(
operator|!
operator|(
operator|--
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|)
condition|)
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|=
literal|8
expr_stmt|;
break|break;
case|case
literal|'1'
case|:
case|case
literal|'2'
case|:
case|case
literal|'3'
case|:
case|case
literal|'4'
case|:
case|case
literal|'5'
case|:
case|case
literal|'6'
case|:
case|case
literal|'7'
case|:
name|drdc
argument_list|(
operator|&
name|dr
argument_list|,
operator|&
name|dc
argument_list|,
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|%
literal|2
operator|)
condition|)
name|dist
operator|=
name|dtab
index|[
name|movement
index|[
name|n
index|]
operator|-
literal|'0'
index|]
expr_stmt|;
else|else
name|dist
operator|=
name|movement
index|[
name|n
index|]
operator|-
literal|'0'
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
operator|-=
name|dr
operator|*
name|dist
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
operator|-=
name|dc
operator|*
name|dist
expr_stmt|;
name|dr
operator|=
name|dc
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|drift
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|file
operator|->
name|drift
expr_stmt|;
if|if
condition|(
operator|!
name|windspeed
condition|)
name|drift
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|row
operator|==
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
operator|&&
name|col
operator|==
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
condition|)
block|{
name|drift
operator|++
expr_stmt|;
if|if
condition|(
name|drift
operator|>
literal|2
condition|)
block|{
name|drdc
argument_list|(
operator|&
name|dr
argument_list|,
operator|&
name|dc
argument_list|,
name|winddir
argument_list|)
expr_stmt|;
name|dist
operator|=
literal|1
operator|-
operator|(
operator|(
name|specs
index|[
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|shipnum
index|]
operator|.
name|class
operator|<
literal|3
operator|||
name|fouled
argument_list|(
name|shipnum
argument_list|)
operator|||
name|grappled
argument_list|(
name|shipnum
argument_list|)
operator|)
operator|&&
name|turn
operator|%
literal|2
operator|)
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
operator|-=
name|dr
operator|*
name|dist
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
operator|-=
name|dc
operator|*
name|dist
expr_stmt|;
if|if
condition|(
name|permanent
condition|)
name|strcat
argument_list|(
name|movement
argument_list|,
literal|"d"
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|drift
operator|=
literal|0
expr_stmt|;
name|ran
operator|=
name|range
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|)
expr_stmt|;
name|total
operator|=
operator|-
literal|50
operator|*
name|ran
expr_stmt|;
if|if
condition|(
name|ran
operator|<
literal|4
operator|&&
name|gunsbear
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|)
condition|)
name|total
operator|+=
literal|60
expr_stmt|;
if|if
condition|(
operator|(
name|ran
operator|=
name|portside
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|,
literal|1
argument_list|)
operator|-
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|)
operator|==
literal|4
operator|||
name|ran
operator|==
operator|-
literal|4
condition|)
name|total
operator|=
operator|-
literal|30000
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|movement
condition|)
name|strcpy
argument_list|(
name|movement
argument_list|,
literal|"d"
argument_list|)
expr_stmt|;
if|if
condition|(
name|permanent
condition|)
block|{
if|if
condition|(
name|drift
operator|!=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|file
operator|->
name|drift
condition|)
name|Write
argument_list|(
name|FILES
operator|+
name|shipnum
argument_list|,
literal|0
argument_list|,
literal|82
argument_list|,
name|drift
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
operator|!=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|shiprow
condition|)
name|Write
argument_list|(
name|shipnum
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
operator|!=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|shipcol
condition|)
name|Write
argument_list|(
name|shipnum
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|!=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|shipnum
index|]
operator|.
name|shipdir
condition|)
name|Write
argument_list|(
name|shipnum
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|onlytemp
condition|)
block|{
name|pos
index|[
name|shipnum
index|]
operator|.
name|row
operator|=
name|row
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|col
operator|=
name|col
expr_stmt|;
name|pos
index|[
name|shipnum
index|]
operator|.
name|dir
operator|=
name|dir
expr_stmt|;
block|}
return|return
operator|(
name|total
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|try
argument_list|(
argument|command
argument_list|,
argument|temp
argument_list|,
argument|ma
argument_list|,
argument|ta
argument_list|,
argument|af
argument_list|,
argument|vma
argument_list|,
argument|dir
argument_list|,
argument|shipnum
argument_list|,
argument|toship
argument_list|,
argument|high
argument_list|,
argument|rakeme
argument_list|)
end_macro

begin_decl_stmt
name|int
name|ma
decl_stmt|,
name|ta
decl_stmt|,
name|af
decl_stmt|,
name|shipnum
decl_stmt|,
name|toship
decl_stmt|,
modifier|*
name|high
decl_stmt|,
name|rakeme
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|command
index|[
literal|10
index|]
decl_stmt|,
name|temp
index|[
literal|10
index|]
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|new
decl_stmt|,
name|n
decl_stmt|;
name|char
name|st
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|n
operator|=
name|strend
argument_list|(
name|temp
argument_list|)
operator|)
operator|<
literal|'1'
operator|||
name|n
operator|>
literal|'9'
condition|)
for|for
control|(
name|n
operator|=
literal|1
init|;
name|vma
operator|-
name|n
operator|>=
literal|0
condition|;
name|n
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|st
argument_list|,
literal|"%d"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|temp
argument_list|,
name|st
argument_list|)
expr_stmt|;
name|new
operator|=
name|score
argument_list|(
name|temp
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
literal|0
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
if|if
condition|(
name|new
operator|>
operator|*
name|high
operator|&&
operator|(
operator|!
name|rakeme
operator|||
operator|(
name|gunsbear
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|)
operator|&&
operator|!
name|gunsbear
argument_list|(
name|toship
argument_list|,
name|shipnum
argument_list|)
operator|)
operator|)
condition|)
block|{
operator|*
name|high
operator|=
name|new
expr_stmt|;
name|strcpy
argument_list|(
name|command
argument_list|,
name|temp
argument_list|)
expr_stmt|;
block|}
name|try
argument_list|(
name|command
argument_list|,
name|temp
argument_list|,
name|ma
operator|-
name|n
argument_list|,
name|ta
argument_list|,
name|af
argument_list|,
name|vma
operator|-
name|n
argument_list|,
name|dir
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
name|high
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
name|rmend
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|ma
operator|>
literal|0
operator|&&
name|ta
operator|>
literal|0
operator|&&
operator|(
name|n
operator|=
name|strend
argument_list|(
name|temp
argument_list|)
operator|)
operator|!=
literal|'l'
operator|&&
name|n
operator|!=
literal|'r'
operator|)
operator|||
operator|!
name|lengthof
argument_list|(
name|temp
argument_list|)
condition|)
block|{
name|strcat
argument_list|(
name|temp
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
name|new
operator|=
name|score
argument_list|(
name|temp
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
literal|0
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
if|if
condition|(
name|new
operator|>
operator|*
name|high
operator|&&
operator|(
operator|!
name|rakeme
operator|||
operator|(
name|gunsbear
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|)
operator|&&
operator|!
name|gunsbear
argument_list|(
name|toship
argument_list|,
name|shipnum
argument_list|)
operator|)
operator|)
condition|)
block|{
operator|*
name|high
operator|=
name|new
expr_stmt|;
name|strcpy
argument_list|(
name|command
argument_list|,
name|temp
argument_list|)
expr_stmt|;
block|}
name|try
argument_list|(
name|command
argument_list|,
name|temp
argument_list|,
name|ma
operator|-
literal|1
argument_list|,
name|ta
operator|-
literal|1
argument_list|,
name|af
argument_list|,
operator|(
name|min
argument_list|(
name|ma
operator|-
literal|1
argument_list|,
name|maxmove
argument_list|(
name|shipnum
argument_list|,
operator|(
name|dir
operator|==
literal|8
condition|?
literal|1
else|:
name|dir
operator|+
literal|1
operator|)
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|)
argument_list|,
operator|(
name|dir
operator|==
literal|8
condition|?
literal|1
else|:
name|dir
operator|+
literal|1
operator|)
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
name|high
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
name|rmend
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|ma
operator|>
literal|0
operator|&&
name|ta
operator|>
literal|0
operator|&&
operator|(
name|n
operator|=
name|strend
argument_list|(
name|temp
argument_list|)
operator|)
operator|!=
literal|'l'
operator|&&
name|n
operator|!=
literal|'r'
operator|)
operator|||
operator|!
name|lengthof
argument_list|(
name|temp
argument_list|)
condition|)
block|{
name|strcat
argument_list|(
name|temp
argument_list|,
literal|"l"
argument_list|)
expr_stmt|;
name|new
operator|=
name|score
argument_list|(
name|temp
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
literal|0
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
if|if
condition|(
name|new
operator|>
operator|*
name|high
operator|&&
operator|(
operator|!
name|rakeme
operator|||
operator|(
name|gunsbear
argument_list|(
name|shipnum
argument_list|,
name|toship
argument_list|)
operator|&&
operator|!
name|gunsbear
argument_list|(
name|toship
argument_list|,
name|shipnum
argument_list|)
operator|)
operator|)
condition|)
block|{
operator|*
name|high
operator|=
name|new
expr_stmt|;
name|strcpy
argument_list|(
name|command
argument_list|,
name|temp
argument_list|)
expr_stmt|;
block|}
name|try
argument_list|(
name|command
argument_list|,
name|temp
argument_list|,
name|ma
operator|-
literal|1
argument_list|,
name|ta
operator|-
literal|1
argument_list|,
name|af
argument_list|,
operator|(
name|min
argument_list|(
name|ma
operator|-
literal|1
argument_list|,
name|maxmove
argument_list|(
name|shipnum
argument_list|,
operator|(
name|dir
operator|-
literal|1
condition|?
name|dir
operator|-
literal|1
else|:
literal|8
operator|)
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|)
argument_list|,
operator|(
name|dir
operator|-
literal|1
condition|?
name|dir
operator|-
literal|1
else|:
literal|8
operator|)
argument_list|,
name|shipnum
argument_list|,
name|toship
argument_list|,
name|high
argument_list|,
name|rakeme
argument_list|)
expr_stmt|;
name|rmend
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|closestenemy
argument_list|(
argument|fromship
argument_list|,
argument|side
argument_list|,
argument|anyship
argument_list|)
end_macro

begin_comment
comment|/*returns the NUMBER of the closest ship*/
end_comment

begin_decl_stmt
name|int
name|fromship
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|side
decl_stmt|,
name|anyship
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|n
decl_stmt|,
name|olddist
init|=
literal|30000
decl_stmt|,
name|ident
decl_stmt|,
name|captured
decl_stmt|;
specifier|register
name|int
name|dist
decl_stmt|,
name|eclosest
init|=
literal|30000
decl_stmt|;
if|if
condition|(
operator|(
name|ident
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|fromship
index|]
operator|.
name|file
operator|->
name|captured
operator|)
operator|<
literal|0
condition|)
name|ident
operator|=
name|fromship
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|scene
index|[
name|game
index|]
operator|.
name|vessels
condition|;
name|n
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|captured
operator|=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|n
index|]
operator|.
name|file
operator|->
name|captured
operator|)
operator|<
literal|0
condition|)
name|captured
operator|=
name|n
expr_stmt|;
if|if
condition|(
name|n
operator|!=
name|fromship
operator|&&
name|pos
index|[
name|n
index|]
operator|.
name|dir
operator|&&
operator|(
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|ident
index|]
operator|.
name|nationality
operator|!=
name|scene
index|[
name|game
index|]
operator|.
name|ship
index|[
name|captured
index|]
operator|.
name|nationality
operator|||
name|anyship
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|side
operator|||
name|gunsbear
argument_list|(
name|fromship
argument_list|,
name|n
argument_list|)
operator|==
name|side
condition|)
block|{
name|dist
operator|=
name|range
argument_list|(
name|fromship
argument_list|,
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
name|dist
operator|<
name|olddist
condition|)
block|{
name|eclosest
operator|=
name|n
expr_stmt|;
name|olddist
operator|=
name|dist
expr_stmt|;
block|}
block|}
block|}
block|}
return|return
operator|(
name|eclosest
operator|)
return|;
block|}
end_block

begin_macro
name|choke
argument_list|()
end_macro

begin_block
block|{ }
end_block

end_unit

