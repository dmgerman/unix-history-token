begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (c) 1982, Regents, University of California */
end_comment

begin_define
define|#
directive|define
name|ADDQ
value|5
end_define

begin_define
define|#
directive|define
name|ADD
value|13
end_define

begin_define
define|#
directive|define
name|IMMED
value|074
end_define

begin_comment
comment|/* These structures are here for looks, only */
end_comment

begin_struct
struct|struct
name|add
block|{
name|short
name|op
range|:
literal|4
decl_stmt|,
name|reg
range|:
literal|3
decl_stmt|,
name|mode
range|:
literal|3
decl_stmt|,
name|ea
range|:
literal|6
decl_stmt|;
block|}
name|x
struct|;
end_struct

begin_struct
struct|struct
name|addq
block|{
name|short
name|op
range|:
literal|4
decl_stmt|,
name|data
range|:
literal|3
decl_stmt|,
name|size
range|:
literal|3
decl_stmt|,
name|ea
range|:
literal|6
decl_stmt|;
block|}
name|y
struct|;
end_struct

begin_macro
name|nargs
argument_list|(
argument|arg
argument_list|)
end_macro

begin_decl_stmt
name|long
name|arg
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* this is only here for address calculation */
end_comment

begin_block
block|{
specifier|register
name|long
modifier|*
name|a5
decl_stmt|;
specifier|register
name|handy
expr_stmt|;
specifier|register
name|char
name|reg
decl_stmt|,
name|mode
decl_stmt|,
name|ea
decl_stmt|;
define|#
directive|define
name|size
value|mode
define|#
directive|define
name|data
value|reg
name|a5
operator|=
operator|(
operator|&
name|arg
operator|)
operator|-
literal|2
expr_stmt|;
comment|/* this points to old a6 */
name|a5
operator|=
operator|(
name|long
operator|*
operator|)
operator|*
name|a5
expr_stmt|;
comment|/* a5 now = my parents a6 */
name|a5
operator|=
operator|(
name|long
operator|*
operator|)
name|a5
index|[
literal|1
index|]
expr_stmt|;
comment|/* pick up return address into a5 */
name|handy
operator|=
operator|*
operator|(
name|short
operator|*
operator|)
name|a5
expr_stmt|;
name|ea
operator|=
name|handy
operator|&
literal|077
expr_stmt|;
name|handy
operator|>>=
literal|6
expr_stmt|;
name|mode
operator|=
name|handy
operator|&
literal|07
expr_stmt|;
name|handy
operator|>>=
literal|3
expr_stmt|;
name|reg
operator|=
name|handy
operator|&
literal|07
expr_stmt|;
name|handy
operator|>>=
literal|3
expr_stmt|;
comment|/* op = handy& 017; */
switch|switch
condition|(
name|handy
operator|&
literal|017
condition|)
block|{
case|case
name|ADD
case|:
if|if
condition|(
name|reg
operator|!=
literal|7
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* this instruction doesn't adjust the sp */
if|if
condition|(
name|ea
operator|!=
name|IMMED
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* too hard to decode adjustment */
name|handy
operator|=
call|(
name|long
call|)
argument_list|(
literal|1
operator|+
operator|(
name|short
operator|*
operator|)
name|a5
argument_list|)
expr_stmt|;
if|if
condition|(
name|mode
operator|==
literal|03
condition|)
block|{
comment|/* addw #n,a7 */
name|handy
operator|=
operator|*
operator|(
name|short
operator|*
operator|)
name|handy
expr_stmt|;
return|return
operator|(
name|handy
operator|>>
literal|2
operator|)
return|;
block|}
if|if
condition|(
name|mode
operator|==
literal|07
condition|)
block|{
comment|/* addl #n,a7 */
name|handy
operator|=
operator|*
operator|(
name|long
operator|*
operator|)
name|handy
expr_stmt|;
return|return
operator|(
name|handy
operator|>>
literal|2
operator|)
return|;
block|}
else|else
return|return
operator|(
literal|0
operator|)
return|;
comment|/* this was doing something to d7 */
case|case
name|ADDQ
case|:
if|if
condition|(
name|ea
operator|!=
literal|017
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* this doesn't adjust a7 */
if|if
condition|(
name|size
operator|!=
literal|02
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* should complain -- we are doing 				      addq[bw] something,a7 */
switch|switch
condition|(
name|data
condition|)
block|{
case|case
literal|0
case|:
return|return
operator|(
literal|2
operator|)
return|;
case|case
literal|4
case|:
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

