begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *	$Source: /usr/src/kerberosIV/src/lib/krb/RCS/krbglue.c,v $  *	$Author: kfall $  *	$Header: /usr/src/kerberosIV/src/lib/krb/RCS/krbglue.c,v 4.2 90/05/12 00:58:22 kfall Exp $  *  * Copyright 1988 by the Massachusetts Institute of Technology.  *  * For copying and distribution information, please see the file  *<mit-copyright.h>.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|NCOMPAT
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid_krbglue_c
init|=
literal|"$Header: /usr/src/kerberosIV/src/lib/krb/RCS/krbglue.c,v 4.2 90/05/12 00:58:22 kfall Exp $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
endif|lint
end_endif

begin_comment
comment|/*  * glue together new libraries and old clients  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|"des.h"
end_include

begin_include
include|#
directive|include
file|"krb.h"
end_include

begin_comment
comment|/* These definitions should be in krb.h, no? */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__HIGHC__
argument_list|)
end_if

begin_undef
undef|#
directive|undef
name|__STDC__
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__STDC__
end_ifdef

begin_function_decl
specifier|extern
name|int
name|krb_mk_req
parameter_list|(
name|KTEXT
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|long
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_rd_req
parameter_list|(
name|KTEXT
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|long
parameter_list|,
name|AUTH_DAT
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_kntoln
parameter_list|(
name|AUTH_DAT
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_set_key
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_cred
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|CREDENTIALS
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_priv
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|u_char
modifier|*
parameter_list|,
name|u_long
parameter_list|,
name|Key_schedule
parameter_list|,
name|C_Block
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_rd_priv
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|u_long
parameter_list|,
name|Key_schedule
parameter_list|,
name|C_Block
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|MSG_DAT
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_safe
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|u_char
modifier|*
parameter_list|,
name|u_long
parameter_list|,
name|C_Block
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_rd_safe
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|u_long
parameter_list|,
name|C_Block
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|struct
name|sockaddr_in
modifier|*
parameter_list|,
name|MSG_DAT
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_err
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|long
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_rd_err
parameter_list|(
name|u_char
modifier|*
parameter_list|,
name|u_long
parameter_list|,
name|long
modifier|*
parameter_list|,
name|MSG_DAT
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_pw_in_tkt
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_svc_in_tkt
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_pw_tkt
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_lrealm
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_realmofhost
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|krb_get_phost
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_krbhst
parameter_list|(
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_function_decl
specifier|extern
name|KTEXT
name|krb_create_death_packet
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG */
end_comment

begin_else
else|#
directive|else
end_else

begin_function_decl
specifier|extern
name|int
name|krb_mk_req
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_rd_req
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_kntoln
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_set_key
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_cred
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_priv
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_rd_priv
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_safe
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_rd_safe
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|long
name|krb_mk_err
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_rd_err
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_pw_in_tkt
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_svc_in_tkt
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_pw_tkt
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_lrealm
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_realmofhost
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|char
modifier|*
name|krb_get_phost
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|int
name|krb_get_krbhst
parameter_list|()
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_function_decl
specifier|extern
name|KTEXT
name|krb_create_death_packet
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* STDC */
end_comment

begin_function
name|int
name|mk_ap_req
parameter_list|(
name|authent
parameter_list|,
name|service
parameter_list|,
name|instance
parameter_list|,
name|realm
parameter_list|,
name|checksum
parameter_list|)
name|KTEXT
name|authent
decl_stmt|;
name|char
modifier|*
name|service
decl_stmt|,
decl|*
name|instance
decl_stmt|,
modifier|*
name|realm
decl_stmt|;
end_function

begin_decl_stmt
name|u_long
name|checksum
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_mk_req
argument_list|(
name|authent
argument_list|,
name|service
argument_list|,
name|instance
argument_list|,
name|realm
argument_list|,
name|checksum
argument_list|)
return|;
block|}
end_block

begin_function
name|int
name|rd_ap_req
parameter_list|(
name|authent
parameter_list|,
name|service
parameter_list|,
name|instance
parameter_list|,
name|from_addr
parameter_list|,
name|ad
parameter_list|,
name|fn
parameter_list|)
name|KTEXT
name|authent
decl_stmt|;
name|char
modifier|*
name|service
decl_stmt|,
decl|*
name|instance
decl_stmt|;
end_function

begin_decl_stmt
name|u_long
name|from_addr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|AUTH_DAT
modifier|*
name|ad
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|fn
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_rd_req
argument_list|(
name|authent
argument_list|,
name|service
argument_list|,
name|instance
argument_list|,
name|from_addr
argument_list|,
name|ad
argument_list|,
name|fn
argument_list|)
return|;
block|}
end_block

begin_function
name|int
name|an_to_ln
parameter_list|(
name|ad
parameter_list|,
name|lname
parameter_list|)
name|AUTH_DAT
modifier|*
name|ad
decl_stmt|;
name|char
modifier|*
name|lname
decl_stmt|;
block|{
return|return
name|krb_kntoln
argument_list|(
name|ad
argument_list|,
name|lname
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|set_serv_key
parameter_list|(
name|key
parameter_list|,
name|cvt
parameter_list|)
name|char
modifier|*
name|key
decl_stmt|;
name|int
name|cvt
decl_stmt|;
block|{
return|return
name|krb_set_key
argument_list|(
name|key
argument_list|,
name|cvt
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|get_credentials
parameter_list|(
name|svc
parameter_list|,
name|inst
parameter_list|,
name|rlm
parameter_list|,
name|cred
parameter_list|)
name|char
modifier|*
name|svc
decl_stmt|,
decl|*
name|inst
decl_stmt|,
modifier|*
name|rlm
decl_stmt|;
end_function

begin_decl_stmt
name|CREDENTIALS
modifier|*
name|cred
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_get_cred
argument_list|(
name|svc
argument_list|,
name|inst
argument_list|,
name|rlm
argument_list|,
name|cred
argument_list|)
return|;
block|}
end_block

begin_function
name|long
name|mk_private_msg
parameter_list|(
name|in
parameter_list|,
name|out
parameter_list|,
name|in_length
parameter_list|,
name|schedule
parameter_list|,
name|key
parameter_list|,
name|sender
parameter_list|,
name|receiver
parameter_list|)
name|u_char
modifier|*
name|in
decl_stmt|,
decl|*
name|out
decl_stmt|;
end_function

begin_decl_stmt
name|u_long
name|in_length
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Key_schedule
name|schedule
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|C_Block
name|key
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|sockaddr_in
modifier|*
name|sender
decl_stmt|,
modifier|*
name|receiver
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_mk_priv
argument_list|(
name|in
argument_list|,
name|out
argument_list|,
name|in_length
argument_list|,
name|schedule
argument_list|,
name|key
argument_list|,
name|sender
argument_list|,
name|receiver
argument_list|)
return|;
block|}
end_block

begin_function
name|long
name|rd_private_msg
parameter_list|(
name|in
parameter_list|,
name|in_length
parameter_list|,
name|schedule
parameter_list|,
name|key
parameter_list|,
name|sender
parameter_list|,
name|receiver
parameter_list|,
name|msg_data
parameter_list|)
name|u_char
modifier|*
name|in
decl_stmt|;
name|u_long
name|in_length
decl_stmt|;
name|Key_schedule
name|schedule
decl_stmt|;
name|C_Block
name|key
decl_stmt|;
name|struct
name|sockaddr_in
modifier|*
name|sender
decl_stmt|,
decl|*
name|receiver
decl_stmt|;
end_function

begin_decl_stmt
name|MSG_DAT
modifier|*
name|msg_data
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_rd_priv
argument_list|(
name|in
argument_list|,
name|in_length
argument_list|,
name|schedule
argument_list|,
name|key
argument_list|,
name|sender
argument_list|,
name|receiver
argument_list|,
name|msg_data
argument_list|)
return|;
block|}
end_block

begin_function
name|long
name|mk_safe_msg
parameter_list|(
name|in
parameter_list|,
name|out
parameter_list|,
name|in_length
parameter_list|,
name|key
parameter_list|,
name|sender
parameter_list|,
name|receiver
parameter_list|)
name|u_char
modifier|*
name|in
decl_stmt|,
decl|*
name|out
decl_stmt|;
end_function

begin_decl_stmt
name|u_long
name|in_length
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|C_Block
modifier|*
name|key
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|sockaddr_in
modifier|*
name|sender
decl_stmt|,
modifier|*
name|receiver
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_mk_safe
argument_list|(
name|in
argument_list|,
name|out
argument_list|,
name|in_length
argument_list|,
name|key
argument_list|,
name|sender
argument_list|,
name|receiver
argument_list|)
return|;
block|}
end_block

begin_function
name|long
name|rd_safe_msg
parameter_list|(
name|in
parameter_list|,
name|length
parameter_list|,
name|key
parameter_list|,
name|sender
parameter_list|,
name|receiver
parameter_list|,
name|msg_data
parameter_list|)
name|u_char
modifier|*
name|in
decl_stmt|;
name|u_long
name|length
decl_stmt|;
name|C_Block
modifier|*
name|key
decl_stmt|;
name|struct
name|sockaddr_in
modifier|*
name|sender
decl_stmt|,
decl|*
name|receiver
decl_stmt|;
end_function

begin_decl_stmt
name|MSG_DAT
modifier|*
name|msg_data
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_rd_safe
argument_list|(
name|in
argument_list|,
name|length
argument_list|,
name|key
argument_list|,
name|sender
argument_list|,
name|receiver
argument_list|,
name|msg_data
argument_list|)
return|;
block|}
end_block

begin_function
name|long
name|mk_appl_err_msg
parameter_list|(
name|out
parameter_list|,
name|code
parameter_list|,
name|string
parameter_list|)
name|u_char
modifier|*
name|out
decl_stmt|;
name|long
name|code
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
block|{
return|return
name|krb_mk_err
argument_list|(
name|out
argument_list|,
name|code
argument_list|,
name|string
argument_list|)
return|;
block|}
end_function

begin_function
name|long
name|rd_appl_err_msg
parameter_list|(
name|in
parameter_list|,
name|length
parameter_list|,
name|code
parameter_list|,
name|msg_data
parameter_list|)
name|u_char
modifier|*
name|in
decl_stmt|;
name|u_long
name|length
decl_stmt|;
name|long
modifier|*
name|code
decl_stmt|;
name|MSG_DAT
modifier|*
name|msg_data
decl_stmt|;
block|{
return|return
name|krb_rd_err
argument_list|(
name|in
argument_list|,
name|length
argument_list|,
name|code
argument_list|,
name|msg_data
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|get_in_tkt
parameter_list|(
name|user
parameter_list|,
name|instance
parameter_list|,
name|realm
parameter_list|,
name|service
parameter_list|,
name|sinstance
parameter_list|,
name|life
parameter_list|,
name|password
parameter_list|)
name|char
modifier|*
name|user
decl_stmt|,
decl|*
name|instance
decl_stmt|,
modifier|*
name|realm
decl_stmt|,
modifier|*
name|service
decl_stmt|,
modifier|*
name|sinstance
decl_stmt|;
end_function

begin_decl_stmt
name|int
name|life
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|password
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_get_pw_in_tkt
argument_list|(
name|user
argument_list|,
name|instance
argument_list|,
name|realm
argument_list|,
name|service
argument_list|,
name|sinstance
argument_list|,
name|life
argument_list|,
name|password
argument_list|)
return|;
block|}
end_block

begin_function
name|int
name|get_svc_in_tkt
parameter_list|(
name|user
parameter_list|,
name|instance
parameter_list|,
name|realm
parameter_list|,
name|service
parameter_list|,
name|sinstance
parameter_list|,
name|life
parameter_list|,
name|srvtab
parameter_list|)
name|char
modifier|*
name|user
decl_stmt|,
decl|*
name|instance
decl_stmt|,
modifier|*
name|realm
decl_stmt|,
modifier|*
name|service
decl_stmt|,
modifier|*
name|sinstance
decl_stmt|;
end_function

begin_decl_stmt
name|int
name|life
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|srvtab
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
name|krb_get_svc_in_tkt
argument_list|(
name|user
argument_list|,
name|instance
argument_list|,
name|realm
argument_list|,
name|service
argument_list|,
name|sinstance
argument_list|,
name|life
argument_list|,
name|srvtab
argument_list|)
return|;
block|}
end_block

begin_function
name|int
name|get_pw_tkt
parameter_list|(
name|user
parameter_list|,
name|instance
parameter_list|,
name|realm
parameter_list|,
name|cpw
parameter_list|)
name|char
modifier|*
name|user
decl_stmt|;
name|char
modifier|*
name|instance
decl_stmt|;
name|char
modifier|*
name|realm
decl_stmt|;
name|char
modifier|*
name|cpw
decl_stmt|;
block|{
return|return
name|krb_get_pw_tkt
argument_list|(
name|user
argument_list|,
name|instance
argument_list|,
name|realm
argument_list|,
name|cpw
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|get_krbrlm
parameter_list|(
name|r
parameter_list|,
name|n
parameter_list|)
name|char
modifier|*
name|r
decl_stmt|;
name|int
name|n
decl_stmt|;
block|{
return|return
name|krb_get_lream
argument_list|(
name|r
argument_list|,
name|n
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|krb_getrealm
parameter_list|(
name|host
parameter_list|)
block|{
return|return
name|krb_realmofhost
argument_list|(
name|host
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
name|char
modifier|*
name|get_phost
argument_list|(
name|host
argument_list|)
name|char
modifier|*
name|host
block|{
return|return
name|krb_get_phost
argument_list|(
name|host
argument_list|)
return|;
block|}
end_decl_stmt

begin_function
name|int
name|get_krbhst
parameter_list|(
name|h
parameter_list|,
name|r
parameter_list|,
name|n
parameter_list|)
name|char
modifier|*
name|h
decl_stmt|;
name|char
modifier|*
name|r
decl_stmt|;
name|int
name|n
decl_stmt|;
block|{
return|return
name|krb_get_krbhst
argument_list|(
name|h
argument_list|,
name|r
argument_list|,
name|n
argument_list|)
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_function
name|struct
name|ktext
modifier|*
name|create_death_packet
parameter_list|(
name|a_name
parameter_list|)
name|char
modifier|*
name|a_name
decl_stmt|;
block|{
return|return
name|krb_create_death_packet
argument_list|(
name|a_name
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* DEBUG */
end_comment

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|extern int krb_ck_repl ();  int check_replay () {     return krb_ck_repl (); }
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NCOMPAT */
end_comment

end_unit

