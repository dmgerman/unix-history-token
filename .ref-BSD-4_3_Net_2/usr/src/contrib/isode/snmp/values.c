begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* values.c - encode values */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/snmp/RCS/values.c,v 7.8 91/02/22 09:44:57 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/snmp/RCS/values.c,v 7.8 91/02/22 09:44:57 mrose Interim $  *  * Contributed by NYSERNet Inc.  This work was partially supported by the  * U.S. Defense Advanced Research Projects Agency and the Rome Air Development  * Center of the U.S. Air Force Systems Command under contract number  * F30602-88-C-0016.  *  *  * $Log:	values.c,v $  * Revision 7.8  91/02/22  09:44:57  mrose  * Interim 6.8  *   * Revision 7.7  91/01/11  15:35:44  mrose  * sets  *   * Revision 7.6  90/12/18  10:14:25  mrose  * update  *   * Revision 7.5  90/10/29  18:39:14  mrose  * updates  *   * Revision 7.4  90/10/23  20:37:26  mrose  * update  *   * Revision 7.3  90/07/09  14:49:51  mrose  * sync  *   * Revision 7.2  90/04/18  08:52:12  mrose  * oid_normalize  *   * Revision 7.1  90/02/19  15:39:11  mrose  * one more time  *   * Revision 7.0  90/02/17  10:36:50  mrose  * *** empty log message ***  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"SNMP-types.h"
end_include

begin_include
include|#
directive|include
file|"objects.h"
end_include

begin_include
include|#
directive|include
file|"logger.h"
end_include

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|ADVISE
value|if (o_advise) (*o_advise)
end_define

begin_decl_stmt
name|IFP
name|o_advise
init|=
name|NULLIFP
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|o_generic
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_get__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|!=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
literal|1
operator|||
name|oid
operator|->
name|oid_elements
index|[
name|oid
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
case|case
name|type_SNMP_PDUs_get__next__request
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|==
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
condition|)
block|{
name|OID
name|new
decl_stmt|;
if|if
condition|(
operator|(
name|new
operator|=
name|oid_extend
argument_list|(
name|oid
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NOTOK
return|;
name|new
operator|->
name|oid_elements
index|[
name|new
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|name
condition|)
name|free_SNMP_ObjectName
argument_list|(
name|v
operator|->
name|name
argument_list|)
expr_stmt|;
name|v
operator|->
name|name
operator|=
name|new
expr_stmt|;
block|}
else|else
return|return
name|NOTOK
return|;
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
operator|(
name|offset
operator|==
name|type_SNMP_PDUs_get__next__request
condition|?
name|NOTOK
else|:
name|int_SNMP_error__status_genErr
operator|)
return|;
block|}
if|if
condition|(
name|ot
operator|->
name|ot_info
operator|==
name|NULL
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no value defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
operator|(
name|offset
operator|==
name|type_SNMP_PDUs_get__next__request
condition|?
name|NOTOK
else|:
name|int_SNMP_error__status_noSuchName
operator|)
return|;
block|}
if|if
condition|(
name|v
operator|->
name|value
condition|)
name|free_SNMP_ObjectSyntax
argument_list|(
name|v
operator|->
name|value
argument_list|)
operator|,
name|v
operator|->
name|value
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|os
operator|->
name|os_encode
call|)
argument_list|(
name|ot
operator|->
name|ot_info
argument_list|,
operator|&
name|v
operator|->
name|value
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"encoding error for variable \"%s\""
argument_list|,
name|oid2ode
argument_list|(
name|oi
operator|->
name|oi_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|offset
operator|==
name|type_SNMP_PDUs_get__next__request
condition|?
name|NOTOK
else|:
name|int_SNMP_error__status_genErr
operator|)
return|;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|s_generic
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|offset
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|int
name|offset
decl_stmt|;
block|{
specifier|register
name|OID
name|oid
init|=
name|oi
operator|->
name|oi_name
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_set__request
case|:
case|case
name|type_SNMP_PDUs_commit
case|:
case|case
name|type_SNMP_PDUs_rollback
case|:
if|if
condition|(
name|oid
operator|->
name|oid_nelem
operator|!=
name|ot
operator|->
name|ot_name
operator|->
name|oid_nelem
operator|+
literal|1
operator|||
name|oid
operator|->
name|oid_elements
index|[
name|oid
operator|->
name|oid_nelem
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
return|return
name|int_SNMP_error__status_noSuchName
return|;
break|break;
default|default:
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
switch|switch
condition|(
name|offset
condition|)
block|{
case|case
name|type_SNMP_PDUs_set__request
case|:
if|if
condition|(
name|ot
operator|->
name|ot_save
condition|)
call|(
modifier|*
name|os
operator|->
name|os_free
call|)
argument_list|(
name|ot
operator|->
name|ot_save
argument_list|)
operator|,
name|ot
operator|->
name|ot_save
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|os
operator|->
name|os_decode
call|)
argument_list|(
operator|&
name|ot
operator|->
name|ot_save
argument_list|,
name|v
operator|->
name|value
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|int_SNMP_error__status_badValue
return|;
break|break;
case|case
name|type_SNMP_PDUs_commit
case|:
if|if
condition|(
name|ot
operator|->
name|ot_info
condition|)
call|(
modifier|*
name|os
operator|->
name|os_free
call|)
argument_list|(
name|ot
operator|->
name|ot_info
argument_list|)
expr_stmt|;
name|ot
operator|->
name|ot_info
operator|=
name|ot
operator|->
name|ot_save
operator|,
name|ot
operator|->
name|ot_save
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|type_SNMP_PDUs_rollback
case|:
if|if
condition|(
name|ot
operator|->
name|ot_save
condition|)
call|(
modifier|*
name|os
operator|->
name|os_free
call|)
argument_list|(
name|ot
operator|->
name|ot_save
argument_list|)
operator|,
name|ot
operator|->
name|ot_save
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|o_longword
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|number
parameter_list|)
name|OI
name|oi
decl_stmt|;
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|integer
name|number
decl_stmt|;
comment|/* actual param: often a constant */
block|{
return|return
name|o_number
argument_list|(
name|oi
argument_list|,
name|v
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|number
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|o_number
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|number
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|caddr_t
name|number
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|v
operator|->
name|value
condition|)
name|free_SNMP_ObjectSyntax
argument_list|(
name|v
operator|->
name|value
argument_list|)
operator|,
name|v
operator|->
name|value
operator|=
name|NULL
expr_stmt|;
name|result
operator|=
call|(
modifier|*
name|os
operator|->
name|os_encode
call|)
argument_list|(
name|number
argument_list|,
operator|&
name|v
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"encoding error for variable \"%s\""
argument_list|,
name|oid2ode
argument_list|(
name|oi
operator|->
name|oi_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|o_string
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|base
parameter_list|,
name|len
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|char
modifier|*
name|base
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
name|struct
name|qbuf
modifier|*
name|value
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
operator|(
name|value
operator|=
name|str2qb
argument_list|(
name|base
argument_list|,
name|len
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"out of memory"
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|v
operator|->
name|value
condition|)
name|free_SNMP_ObjectSyntax
argument_list|(
name|v
operator|->
name|value
argument_list|)
operator|,
name|v
operator|->
name|value
operator|=
name|NULL
expr_stmt|;
name|result
operator|=
call|(
modifier|*
name|os
operator|->
name|os_encode
call|)
argument_list|(
name|value
argument_list|,
operator|&
name|v
operator|->
name|value
argument_list|)
expr_stmt|;
name|qb_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"encoding error for variable \"%s\""
argument_list|,
name|oid2ode
argument_list|(
name|oi
operator|->
name|oi_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|o_qbstring
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|value
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|struct
name|qbuf
modifier|*
name|value
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|v
operator|->
name|value
condition|)
name|free_SNMP_ObjectSyntax
argument_list|(
name|v
operator|->
name|value
argument_list|)
operator|,
name|v
operator|->
name|value
operator|=
name|NULL
expr_stmt|;
name|result
operator|=
call|(
modifier|*
name|os
operator|->
name|os_encode
call|)
argument_list|(
name|value
argument_list|,
operator|&
name|v
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"encoding error for variable \"%s\""
argument_list|,
name|oid2ode
argument_list|(
name|oi
operator|->
name|oi_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|o_specific
parameter_list|(
name|oi
parameter_list|,
name|v
parameter_list|,
name|value
parameter_list|)
name|OI
name|oi
decl_stmt|;
specifier|register
name|struct
name|type_SNMP_VarBind
modifier|*
name|v
decl_stmt|;
name|caddr_t
name|value
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
specifier|register
name|OT
name|ot
init|=
name|oi
operator|->
name|oi_type
decl_stmt|;
specifier|register
name|OS
name|os
init|=
name|ot
operator|->
name|ot_syntax
decl_stmt|;
if|if
condition|(
name|os
operator|==
name|NULLOS
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"no syntax defined for object \"%s\""
argument_list|,
name|ot
operator|->
name|ot_text
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
if|if
condition|(
name|v
operator|->
name|value
condition|)
name|free_SNMP_ObjectSyntax
argument_list|(
name|v
operator|->
name|value
argument_list|)
operator|,
name|v
operator|->
name|value
operator|=
name|NULL
expr_stmt|;
name|result
operator|=
call|(
modifier|*
name|os
operator|->
name|os_encode
call|)
argument_list|(
name|value
argument_list|,
operator|&
name|v
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
block|{
name|ADVISE
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"encoding error for variable \"%s\""
argument_list|,
name|oid2ode
argument_list|(
name|oi
operator|->
name|oi_name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|int_SNMP_error__status_genErr
return|;
block|}
return|return
name|int_SNMP_error__status_noError
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|mediaddr2oid
parameter_list|(
name|ip
parameter_list|,
name|addr
parameter_list|,
name|len
parameter_list|,
name|islen
parameter_list|)
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|;
specifier|register
name|u_char
modifier|*
name|addr
decl_stmt|;
name|int
name|len
decl_stmt|,
name|islen
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
if|if
condition|(
name|islen
condition|)
operator|*
name|ip
operator|++
operator|=
name|len
operator|&
literal|0xff
expr_stmt|;
for|for
control|(
name|i
operator|=
name|len
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|addr
operator|++
operator|&
literal|0xff
expr_stmt|;
return|return
operator|(
name|len
operator|+
operator|(
name|islen
condition|?
literal|1
else|:
literal|0
operator|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|OID
name|oid_extend
parameter_list|(
name|q
parameter_list|,
name|howmuch
parameter_list|)
specifier|register
name|OID
name|q
decl_stmt|;
name|int
name|howmuch
decl_stmt|;
block|{
specifier|register
name|unsigned
name|int
name|i
decl_stmt|,
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|;
name|OID
name|oid
decl_stmt|;
if|if
condition|(
name|q
operator|==
name|NULLOID
condition|)
return|return
name|NULLOID
return|;
if|if
condition|(
operator|(
name|i
operator|=
name|q
operator|->
name|oid_nelem
operator|)
operator|<
literal|1
condition|)
return|return
name|NULLOID
return|;
if|if
condition|(
operator|(
name|oid
operator|=
operator|(
name|OID
operator|)
name|malloc
argument_list|(
sizeof|sizeof
expr|*
name|oid
argument_list|)
operator|)
operator|==
name|NULLOID
condition|)
return|return
name|NULLOID
return|;
if|if
condition|(
operator|(
name|ip
operator|=
operator|(
name|unsigned
name|int
operator|*
operator|)
name|calloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|i
operator|+
name|howmuch
operator|+
literal|1
argument_list|)
argument_list|,
sizeof|sizeof
expr|*
name|ip
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|oid
argument_list|)
expr_stmt|;
return|return
name|NULLOID
return|;
block|}
name|oid
operator|->
name|oid_elements
operator|=
name|ip
operator|,
name|oid
operator|->
name|oid_nelem
operator|=
name|i
operator|+
name|howmuch
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|jp
operator|=
name|q
operator|->
name|oid_elements
init|;
name|i
operator|<
name|oid
operator|->
name|oid_nelem
condition|;
name|i
operator|++
operator|,
name|jp
operator|++
control|)
operator|*
name|ip
operator|++
operator|=
operator|*
name|jp
expr_stmt|;
return|return
name|oid
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|OID
name|oid_normalize
parameter_list|(
name|q
parameter_list|,
name|howmuch
parameter_list|,
name|bigvalue
parameter_list|)
specifier|register
name|OID
name|q
decl_stmt|;
name|int
name|howmuch
decl_stmt|,
name|bigvalue
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|unsigned
name|int
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|;
name|OID
name|oid
decl_stmt|;
if|if
condition|(
operator|(
name|oid
operator|=
name|oid_extend
argument_list|(
name|q
argument_list|,
name|howmuch
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
name|NULLOID
return|;
for|for
control|(
name|jp
operator|=
operator|(
name|ip
operator|=
name|oid
operator|->
name|oid_elements
operator|+
name|q
operator|->
name|oid_nelem
operator|)
operator|-
literal|1
init|;
name|jp
operator|>=
name|oid
operator|->
name|oid_elements
condition|;
name|jp
operator|--
control|)
if|if
condition|(
operator|*
name|jp
operator|>
literal|0
condition|)
block|{
operator|*
name|jp
operator|-=
literal|1
expr_stmt|;
break|break;
block|}
for|for
control|(
name|i
operator|=
name|howmuch
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
operator|*
name|ip
operator|++
operator|=
operator|(
name|unsigned
name|int
operator|)
name|bigvalue
expr_stmt|;
return|return
name|oid
return|;
block|}
end_function

end_unit

