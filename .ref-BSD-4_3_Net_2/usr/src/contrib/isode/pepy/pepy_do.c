begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* pepy_do.c - PE parser (yacc-based) building routines */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/pepy/RCS/pepy_do.c,v 7.3 91/02/22 09:35:04 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * $Header: /f/osi/pepy/RCS/pepy_do.c,v 7.3 91/02/22 09:35:04 mrose Interim $  *  *  * $Log:	pepy_do.c,v $  * Revision 7.3  91/02/22  09:35:04  mrose  * Interim 6.8  *   * Revision 7.2  90/10/29  18:38:20  mrose  * updates  *   * Revision 7.1  90/10/23  20:42:42  mrose  * update  *   * Revision 7.0  89/11/23  22:11:49  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|"pepy.h"
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_decl_stmt
specifier|extern
name|struct
name|tuple
name|tuples
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|rflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|gensym
argument_list|()
decl_stmt|,
modifier|*
name|modsym
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|YP
name|lookup_type
argument_list|()
decl_stmt|,
name|lookup_binding
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|YT
name|lookup_tag
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|add_point
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
name|do_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|arg
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|arg
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|char
modifier|*
name|narg
decl_stmt|;
name|char
modifier|*
name|narg2
decl_stmt|,
modifier|*
name|narg3
decl_stmt|;
specifier|register
name|struct
name|tuple
modifier|*
name|t
decl_stmt|;
specifier|register
name|YP
name|y
decl_stmt|;
specifier|register
name|YV
name|yv
decl_stmt|;
name|char
modifier|*
name|class
decl_stmt|,
modifier|*
name|value
decl_stmt|,
modifier|*
name|form
decl_stmt|;
name|char
name|tbuf1
index|[
literal|32
index|]
decl_stmt|,
name|tbuf2
index|[
literal|32
index|]
decl_stmt|;
name|int
name|pushdown
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
block|{
name|warning
argument_list|(
literal|"I shouldn't be here!"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|level
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"(pe, explicit, len, buffer, parm)\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%sPE     *pe;\nint\texplicit;\n"
argument_list|,
name|yp
operator|->
name|yp_code
operator|!=
name|YP_ANY
operator|&&
name|yp
operator|->
name|yp_code
operator|!=
name|YP_NULL
operator|&&
operator|(
name|yp
operator|->
name|yp_code
operator|!=
name|YP_CHOICE
operator|||
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_CONTROLLED
operator|)
operator|)
condition|?
literal|"register "
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"int\tlen;\nchar   *buffer;\n%s parm;\n{\n"
argument_list|,
name|yp
operator|->
name|yp_param_type
condition|?
name|yp
operator|->
name|yp_param_type
else|:
literal|"PEPYPARM"
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_action0
condition|)
block|{
if|if
condition|(
operator|!
name|Pflag
operator|&&
operator|*
name|sysin
condition|)
name|printf
argument_list|(
literal|"# line %d \"%s\"\n"
argument_list|,
name|yp
operator|->
name|yp_act0_lineno
argument_list|,
name|sysin
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_action0
argument_list|)
expr_stmt|;
block|}
block|}
name|pushdown
operator|=
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
operator|)
operator|==
name|YP_TAG
expr_stmt|;
for|for
control|(
name|t
operator|=
name|tuples
init|;
name|t
operator|->
name|t_type
operator|!=
name|YP_UNDF
condition|;
name|t
operator|++
control|)
if|if
condition|(
name|t
operator|->
name|t_type
operator|==
name|yp
operator|->
name|yp_code
condition|)
block|{
name|class
operator|=
name|t
operator|->
name|t_class
expr_stmt|;
name|value
operator|=
name|t
operator|->
name|t_id
expr_stmt|;
if|if
condition|(
operator|(
name|form
operator|=
name|t
operator|->
name|t_form
operator|)
operator|==
name|NULL
condition|)
name|form
operator|=
literal|"PE_FORM_PRIM"
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
operator|)
operator|==
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|tbuf2
argument_list|,
literal|"PE_CLASS_%s"
argument_list|,
name|pe_classlist
index|[
name|yp
operator|->
name|yp_tag
operator|->
name|yt_class
index|]
argument_list|)
expr_stmt|;
name|class
operator|=
name|tbuf2
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|tbuf1
argument_list|,
literal|"%d"
argument_list|,
name|val2int
argument_list|(
name|yp
operator|->
name|yp_tag
operator|->
name|yt_value
argument_list|)
argument_list|)
expr_stmt|;
name|value
operator|=
name|tbuf1
expr_stmt|;
block|}
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BOOL
case|:
name|printf
argument_list|(
literal|"%*sregister int %s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|,
name|yp
operator|->
name|yp_intexp
condition|?
name|yp
operator|->
name|yp_intexp
else|:
name|level
operator|==
literal|1
condition|?
literal|"len"
else|:
literal|"0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_INT
case|:
case|case
name|YP_INTLIST
case|:
case|case
name|YP_ENUMLIST
case|:
name|printf
argument_list|(
literal|"%*sregister integer %s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|,
name|yp
operator|->
name|yp_intexp
condition|?
name|yp
operator|->
name|yp_intexp
else|:
name|level
operator|==
literal|1
condition|?
literal|"len"
else|:
literal|"0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_REAL
case|:
name|printf
argument_list|(
literal|"%*sregister double %s = 0.0;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_BIT
case|:
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"%*sPE\t%s_z = NULLPE;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sregister PE *%s =&%s_z;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|narg
operator|=
name|add_point
argument_list|(
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*schar *%s;\n%*sint %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg3
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg3
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"%*s%s = buffer;\n%*s%s = len;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg3
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*s%s = NULLCP;\n%*s%s = 0;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg3
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s ? strb2bitstr (%s, %s, %s, %s) : NULLPE;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg2
argument_list|,
name|narg2
argument_list|,
name|narg3
argument_list|,
name|class
argument_list|,
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_OCT
case|:
name|narg
operator|=
name|gensym
argument_list|()
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_prfexp
operator|!=
literal|'q'
condition|)
block|{
name|printf
argument_list|(
literal|"%*sregister char *%s;\n%*sint %s_len;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
block|{
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"%*s%s_len = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*s%s_len = strlen (%s);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"%*s%s = buffer;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif ((%s_len = len) == 0)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s_len = strlen (%s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"%*s%s = NULLCP;\n%*s%s_len = 0;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%*sregister struct qbuf *%s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_SEQ
case|:
case|case
name|YP_SET
case|:
case|case
name|YP_ANY
case|:
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
block|{
name|printf
argument_list|(
literal|"%*sPE\t%s = %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* else fall */
case|case
name|YP_NULL
case|:
case|case
name|YP_IDEFINED
case|:
name|narg
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|YP_CHOICE
case|:
if|if
condition|(
name|yp
operator|->
name|yp_type
operator|&&
name|yp
operator|->
name|yp_control
condition|)
name|printf
argument_list|(
literal|"%*sint\t%s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
name|narg
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|YP_OID
case|:
name|printf
argument_list|(
literal|"%*sregister OID %s;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%*s%s = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"%*s%s = buffer ? str2oid (buffer) : NULLOID;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%*s%s = NULLOID;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQTYPE
case|:
case|case
name|YP_SETTYPE
case|:
name|printf
argument_list|(
literal|"%*sPE\t%s = NULLPE;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
comment|/* and fall ... */
case|case
name|YP_SEQLIST
case|:
case|case
name|YP_SETLIST
case|:
name|printf
argument_list|(
literal|"%*sPE\t%s_z = NULLPE;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
operator|=
name|gensym
argument_list|()
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sregister PE *%s =&%s_z;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|narg
operator|=
name|add_point
argument_list|(
name|narg
argument_list|)
expr_stmt|;
break|break;
default|default:
name|myyerror
argument_list|(
literal|"unknown type: %d"
argument_list|,
name|yp
operator|->
name|yp_code
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_SEQ
case|:
case|case
name|YP_SET
case|:
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
break|break;
comment|/* else fall */
case|case
name|YP_SEQTYPE
case|:
case|case
name|YP_SETTYPE
case|:
case|case
name|YP_SEQLIST
case|:
case|case
name|YP_SETLIST
case|:
case|case
name|YP_NULL
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = pe_alloc (%s, %s, %s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|class
argument_list|,
name|form
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action05
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action05
argument_list|,
name|level
argument_list|,
name|narg
condition|?
name|narg
else|:
name|arg
argument_list|,
name|yp
operator|->
name|yp_act05_lineno
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action1
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action1
argument_list|,
name|level
argument_list|,
name|narg
condition|?
name|narg
else|:
name|arg
argument_list|,
name|yp
operator|->
name|yp_act1_lineno
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BOOL
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = flag2prim (%s, %s, "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|class
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s)) == NULLPE) {\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_INT
case|:
case|case
name|YP_INTLIST
case|:
case|case
name|YP_ENUMLIST
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = %snum2prim (%s, %s, "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_code
operator|==
name|YP_ENUMLIST
condition|?
literal|"e"
else|:
literal|""
argument_list|,
name|narg
argument_list|,
name|class
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s)) == NULLPE) {\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_code
operator|==
name|YP_INT
condition|)
break|break;
name|uniqint
argument_list|(
name|yp
operator|->
name|yp_value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sswitch (%s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
block|{
name|printf
argument_list|(
literal|"%*scase %d:"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yv
operator|->
name|yv_action
condition|)
name|do_action
argument_list|(
name|yv
operator|->
name|yv_action
argument_list|,
name|level
operator|+
literal|2
argument_list|,
name|narg
argument_list|,
name|yv
operator|->
name|yv_act_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sbreak;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|rflag
operator|&&
name|yp
operator|->
name|yp_code
operator|==
name|YP_ENUMLIST
condition|)
block|{
name|printf
argument_list|(
literal|"%*sdefault:\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%d\", PEPY_ERR_UNK_COMP, %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_REAL
case|:
name|printf
argument_list|(
literal|"%*sif ((%s = real2prim (%s, %s, "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|class
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s)) == NULLPE) {\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_BIT
case|:
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"%*sif (%s == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s\", PEPY_ERR_INIT_FAILED);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|yp
operator|->
name|yp_strexp
operator|&&
name|level
operator|!=
literal|1
condition|)
name|printf
argument_list|(
literal|"%*s%s -> pe_class = %s;\n%*s%s -> pe_id = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|class
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_code
operator|==
name|YP_BITLIST
condition|)
block|{
specifier|register
name|int
name|j
decl_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
operator|,
name|i
operator|=
operator|-
literal|1
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
if|if
condition|(
operator|(
name|j
operator|=
name|val2int
argument_list|(
name|yv
argument_list|)
operator|)
operator|>
name|i
condition|)
name|i
operator|=
name|j
expr_stmt|;
if|if
condition|(
name|i
operator|>=
literal|0
condition|)
name|printf
argument_list|(
literal|"%*sif (bit_test (%s, %d) == NOTOK)\n%*s(void) bit_off (%s, %d);\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|i
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"%*sif ((%s = bit2prim (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_code
operator|==
name|YP_BIT
condition|)
break|break;
name|printf
argument_list|(
literal|"#define\tBITS\t\"\\020"
argument_list|)
expr_stmt|;
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\\0%o%s"
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
operator|+
literal|1
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\\0%oBIT%d"
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
operator|+
literal|1
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\"\n"
argument_list|)
expr_stmt|;
name|uniqint
argument_list|(
name|yp
operator|->
name|yp_value
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
condition|)
for|for
control|(
name|yv
operator|=
name|yp
operator|->
name|yp_value
init|;
name|yv
condition|;
name|yv
operator|=
name|yv
operator|->
name|yv_next
control|)
block|{
if|if
condition|(
operator|!
name|yv
operator|->
name|yv_action
condition|)
continue|continue;
name|printf
argument_list|(
literal|"%*sif (bit_test (%s, %d)> OK) {"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|val2int
argument_list|(
name|yv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yv
operator|->
name|yv_flags
operator|&
name|YV_NAMED
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yv
operator|->
name|yv_named
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|do_action
argument_list|(
name|yv
operator|->
name|yv_action
argument_list|,
name|level
operator|+
literal|1
argument_list|,
name|narg
argument_list|,
name|yv
operator|->
name|yv_act_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_OCT
case|:
name|printf
argument_list|(
literal|"%*sif (%s == %s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|,
name|yp
operator|->
name|yp_prfexp
operator|!=
literal|'q'
condition|?
literal|"NULLCP"
else|:
literal|"((struct qbuf *) 0)"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s\", PEPY_ERR_INIT_FAILED);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif ((%s = "
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_prfexp
operator|!=
literal|'q'
condition|)
name|printf
argument_list|(
literal|"str2prim (%s, %s_len,"
argument_list|,
name|narg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"qb2prim (%s,"
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %s, %s)) == NULLPE) {\n"
argument_list|,
name|class
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_NULL
case|:
break|break;
case|case
name|YP_ANY
case|:
case|case
name|YP_SEQ
case|:
case|case
name|YP_SET
case|:
if|if
condition|(
operator|!
name|yp
operator|->
name|yp_strexp
condition|)
break|break;
name|printf
argument_list|(
literal|"%*sif (%s == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s\", PEPY_ERR_INIT_FAILED);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notdef
name|printf
argument_list|(
literal|"%*sif ((%s = pe_cpy (%s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"%*s(%s = %s) -> pe_refcnt++;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
name|YP_OID
case|:
name|printf
argument_list|(
literal|"%*sif (%s == NULLOID) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s\", PEPY_ERR_INIT_FAILED);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif ((%s = obj2prim (%s, %s, %s)) == NULLPE) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|,
name|class
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s: %%s\", PEPY_ERR_NOMEM);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|YP_SEQTYPE
case|:
if|if
condition|(
name|yp
operator|->
name|yp_type
operator|&&
name|yp
operator|->
name|yp_control
condition|)
block|{
name|printf
argument_list|(
literal|"%*sfor (%s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_control
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
block|{
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action3
argument_list|,
operator|++
name|level
argument_list|,
name|narg
condition|?
name|narg
else|:
name|arg
argument_list|,
name|yp
operator|->
name|yp_act3_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|do_type
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|level
operator|+
literal|1
argument_list|,
literal|"element"
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|--
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|notdef
name|printf
argument_list|(
literal|"%*sseq_addon (%s, %s, %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg2
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|narg
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"%*sif (seq_add (%s, %s, -1) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s: %%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
break|break;
case|case
name|YP_SEQLIST
case|:
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
operator|,
name|i
operator|=
literal|0
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
operator|,
name|i
operator|++
control|)
block|{
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|do_components_seq
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
block|{
name|do_type_element
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (%s != NULLPE)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (seq_add (%s, %s, -1) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
specifier|register
name|YP
name|z
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|y
argument_list|)
operator|==
name|NULLYT
condition|)
continue|continue;
for|for
control|(
name|z
operator|=
name|y
operator|->
name|yp_next
init|;
name|z
condition|;
name|z
operator|=
name|z
operator|->
name|yp_next
control|)
if|if
condition|(
operator|!
operator|(
name|z
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|z
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
name|uniqtag
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|z
operator|==
name|NULLYP
condition|)
break|break;
name|y
operator|=
name|z
expr_stmt|;
block|}
break|break;
case|case
name|YP_SETTYPE
case|:
if|if
condition|(
name|yp
operator|->
name|yp_type
operator|&&
name|yp
operator|->
name|yp_control
condition|)
block|{
name|printf
argument_list|(
literal|"%*sfor (%s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_control
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
block|{
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action3
argument_list|,
operator|++
name|level
argument_list|,
name|narg
condition|?
name|narg
else|:
name|arg
argument_list|,
name|yp
operator|->
name|yp_act3_lineno
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|do_type
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|level
operator|+
literal|1
argument_list|,
literal|"member"
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action3
condition|)
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|--
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|notdef
name|printf
argument_list|(
literal|"%*sset_addon (%s, %s, %s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg2
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s = %s;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|narg
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"%*sif (seq_add (%s, %s, -1) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
break|break;
case|case
name|YP_SETLIST
case|:
if|if
condition|(
name|yp
operator|->
name|yp_type
condition|)
block|{
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|do_components_set
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
block|{
name|do_type_member
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (%s != NULLPE)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (set_add (%s, %s) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* now pull up fully to check uniqueness */
name|choice_pullup
argument_list|(
name|y
operator|=
name|copy_type
argument_list|(
name|yp
argument_list|)
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
name|uniqtag
argument_list|(
name|y
operator|->
name|yp_type
argument_list|,
name|NULLYP
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_CHOICE
case|:
if|if
condition|(
name|yp
operator|->
name|yp_type
operator|&&
name|yp
operator|->
name|yp_control
condition|)
block|{
name|printf
argument_list|(
literal|"%*sswitch (%s = (%s)) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|,
name|yp
operator|->
name|yp_control
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|yp
operator|->
name|yp_type
operator|,
name|i
operator|=
literal|0
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
name|do_type_choice
argument_list|(
name|y
argument_list|,
operator|++
name|i
argument_list|,
name|level
operator|+
literal|1
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|choice_pullup
argument_list|(
name|yp
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
name|uniqtag
argument_list|(
name|yp
operator|->
name|yp_type
argument_list|,
name|NULLYP
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n%*sdefault:\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%d\", PEPY_ERR_INVALID_CHOICE, \n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s);\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|&&
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_PULLEDUP
operator|)
condition|)
name|tag_pushdown
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
literal|"choice"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|YP_IDEFINED
case|:
name|printf
argument_list|(
literal|"%*sif (%s ("
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|modsym
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|,
name|YP_ENCODER
argument_list|)
argument_list|)
expr_stmt|;
name|i
operator|=
name|strlen
argument_list|(
name|arg
argument_list|)
operator|-
literal|3
expr_stmt|;
name|printf
argument_list|(
literal|"%*.*s, 0, "
argument_list|,
name|i
argument_list|,
name|i
argument_list|,
name|arg
operator|+
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_intexp
condition|)
name|printf
argument_list|(
literal|"%s, "
argument_list|,
name|yp
operator|->
name|yp_intexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"len, "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"NULL, "
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_strexp
condition|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|yp
operator|->
name|yp_strexp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"buffer"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"NULLCP"
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_PARMVAL
condition|)
name|printf
argument_list|(
literal|", %s"
argument_list|,
name|yp
operator|->
name|yp_parm
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|", NullParm"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|") == NOTOK)\n%*sreturn NOTOK;\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
operator|)
operator|==
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
condition|)
block|{
if|if
condition|(
name|is_nonimplicit_type
argument_list|(
name|yp
argument_list|)
condition|)
name|pushdown
operator|=
literal|1
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|"%*s%s -> pe_class = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|class
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*s%s -> pe_id = %s;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
name|myyerror
argument_list|(
literal|"unknown type: %d"
argument_list|,
name|yp
operator|->
name|yp_code
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pushdown
operator|&&
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_PULLEDUP
operator|)
condition|)
block|{
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
comment|/* sets& seqs are implicit implicit's? */
case|case
name|YP_CHOICE
case|:
break|break;
default|default:
name|tag_pushdown
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|id
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|printf
argument_list|(
literal|"\n#ifdef DEBUG\n%*s(void) testdebug (%s, \""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|level
operator|==
literal|1
condition|)
name|printf
argument_list|(
literal|"%s."
argument_list|,
name|mymodule
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s\");\n#endif\n\n"
argument_list|,
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dflag
operator|&&
name|yp
operator|->
name|yp_action2
condition|)
name|do_action
argument_list|(
name|yp
operator|->
name|yp_action2
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|yp
operator|->
name|yp_act2_lineno
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_BITLIST
case|:
name|printf
argument_list|(
literal|"#undef\tBITS\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_block

begin_function
specifier|static
name|char
modifier|*
name|add_point
parameter_list|(
name|arg
parameter_list|)
name|char
modifier|*
name|arg
decl_stmt|;
block|{
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"(*%s)"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
return|return
name|new_string
argument_list|(
name|buffer
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
specifier|static
name|do_type_member
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|pushdown
init|=
operator|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_TAG
operator||
name|YP_IMPLICIT
operator|)
operator|)
operator|==
name|YP_TAG
decl_stmt|;
name|char
modifier|*
name|id
init|=
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"member"
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
condition|)
block|{
switch|switch
condition|(
name|yp
operator|->
name|yp_code
condition|)
block|{
case|case
name|YP_CHOICE
case|:
break|break;
case|case
name|YP_IDEFINED
case|:
if|if
condition|(
name|lookup_tag
argument_list|(
name|yp
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
comment|/* else drop ... */
default|default:
name|tag_type
argument_list|(
name|yp
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|printf
argument_list|(
literal|"%*s%s = NULLPE;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
condition|)
block|{
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_OPTCONTROL
condition|)
name|printf
argument_list|(
literal|"%*sif (%s) {\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_optcontrol
argument_list|)
expr_stmt|;
else|else
return|return;
block|}
else|else
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|yp
operator|->
name|yp_flags
operator||=
name|YP_PULLEDUP
expr_stmt|;
name|do_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|pushdown
condition|)
name|tag_pushdown
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
specifier|static
name|do_type_choice
argument_list|(
name|yp
argument_list|,
name|caseindex
argument_list|,
name|level
argument_list|,
name|narg
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|caseindex
decl_stmt|,
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|pushdown
init|=
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_TAG
operator|)
operator|&&
operator|!
operator|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_IMPLICIT
operator|)
decl_stmt|;
name|char
modifier|*
name|id
init|=
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"member"
decl_stmt|;
name|printf
argument_list|(
literal|"%*scase %d:"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|caseindex
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|level
operator|++
expr_stmt|;
name|yp
operator|->
name|yp_flags
operator||=
name|YP_PULLEDUP
expr_stmt|;
name|do_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|pushdown
condition|)
block|{
name|tag_pushdown
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|narg
argument_list|,
name|id
argument_list|)
expr_stmt|;
block|}
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n%*sbreak;\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_expr_stmt
name|do_action
argument_list|(
name|action
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|lineno
argument_list|)
specifier|register
name|char
operator|*
name|action
operator|,
operator|*
name|arg
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lineno
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
name|c
decl_stmt|,
name|d
decl_stmt|;
name|printf
argument_list|(
literal|"%*s{\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Pflag
operator|&&
operator|*
name|sysin
condition|)
name|printf
argument_list|(
literal|"# line %d \"%s\"\n"
argument_list|,
name|lineno
argument_list|,
name|sysin
argument_list|)
expr_stmt|;
for|for
control|(
name|d
operator|=
name|NULL
init|;
name|c
operator|=
operator|*
name|action
operator|++
condition|;
name|d
operator|=
name|c
control|)
switch|switch
condition|(
name|d
condition|)
block|{
case|case
literal|'$'
case|:
if|if
condition|(
name|c
operator|==
literal|'$'
condition|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|c
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
name|putchar
argument_list|(
literal|'$'
argument_list|)
expr_stmt|;
comment|/* fall */
default|default:
if|if
condition|(
name|c
operator|!=
literal|'$'
condition|)
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|d
condition|)
block|{
case|case
literal|'\n'
case|:
break|break;
case|case
literal|'$'
case|:
name|putchar
argument_list|(
literal|'$'
argument_list|)
expr_stmt|;
comment|/* fall */
default|default:
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"%*s}\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_expr_stmt
specifier|static
name|do_type_element
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|last
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|last
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|id
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|printf
argument_list|(
literal|"%*s%s = NULLPE;\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
condition|)
block|{
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_OPTCONTROL
condition|)
name|printf
argument_list|(
literal|"%*sif (%s) {"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|yp
operator|->
name|yp_optcontrol
argument_list|)
expr_stmt|;
else|else
return|return;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%*s{"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
name|level
operator|++
expr_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|)
name|printf
argument_list|(
literal|"\t/* %s */"
argument_list|,
name|yp
operator|->
name|yp_id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|do_type
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|yp
operator|->
name|yp_flags
operator|&
name|YP_ID
condition|?
name|yp
operator|->
name|yp_id
else|:
literal|"element"
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|level
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"%*s}\n\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|do_components_seq
argument_list|(
argument|yp
argument_list|,
argument|level
argument_list|,
argument|last
argument_list|,
argument|id
argument_list|,
argument|arg
argument_list|,
argument|narg
argument_list|)
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|arg
decl_stmt|,
modifier|*
name|narg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|YP
name|newyp
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_module
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't do COMPONENTS OF with external types for %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|newyp
operator|=
name|lookup_type
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
operator|)
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't find refernced COMPONENTS OF"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|newyp
operator|->
name|yp_code
operator|!=
name|YP_SEQLIST
condition|)
block|{
name|yyerror_aux
argument_list|(
literal|"COMPONENTS OF type is not a SEQUENCE"
argument_list|)
expr_stmt|;
name|print_type
argument_list|(
name|yp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|y
operator|=
name|newyp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|do_components_seq
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|last
operator|&&
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
block|{
name|do_type_element
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|last
operator|&&
name|y
operator|->
name|yp_next
operator|==
name|NULLYP
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (%s != NULLPE)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (seq_add (%s, %s, -1) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SEQ,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|y
operator|=
name|newyp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
specifier|register
name|YP
name|z
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|y
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|y
argument_list|)
operator|==
name|NULLYT
condition|)
continue|continue;
for|for
control|(
name|z
operator|=
name|y
operator|->
name|yp_next
init|;
name|z
condition|;
name|z
operator|=
name|z
operator|->
name|yp_next
control|)
if|if
condition|(
operator|!
operator|(
name|z
operator|->
name|yp_flags
operator|&
operator|(
name|YP_OPTIONAL
operator||
name|YP_DEFAULT
operator|)
operator|)
operator|||
name|lookup_tag
argument_list|(
name|z
argument_list|)
operator|==
name|NULLYT
condition|)
break|break;
name|uniqtag
argument_list|(
name|y
argument_list|,
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|z
operator|==
name|NULLYP
condition|)
break|break;
name|y
operator|=
name|z
expr_stmt|;
block|}
return|return;
block|}
end_block

begin_expr_stmt
specifier|static
name|do_components_set
argument_list|(
name|yp
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
specifier|register
name|YP
name|yp
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|int
name|level
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|narg
decl_stmt|,
modifier|*
name|arg
decl_stmt|,
modifier|*
name|id
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|YP
name|newyp
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|yp
operator|->
name|yp_module
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't do COMPONENTS OF with external types for %s"
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|newyp
operator|=
name|lookup_type
argument_list|(
name|yp
operator|->
name|yp_module
argument_list|,
name|yp
operator|->
name|yp_identifier
argument_list|)
operator|)
condition|)
block|{
name|pyyerror
argument_list|(
name|yp
argument_list|,
literal|"Can't find refernced COMPONENTS OF"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|newyp
operator|->
name|yp_code
operator|!=
name|YP_SETLIST
condition|)
block|{
name|yyerror_aux
argument_list|(
literal|"COMPONENTS OF type is not a SET"
argument_list|)
expr_stmt|;
name|print_type
argument_list|(
name|yp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|y
operator|=
name|newyp
operator|->
name|yp_type
init|;
name|y
condition|;
name|y
operator|=
name|y
operator|->
name|yp_next
control|)
block|{
if|if
condition|(
name|y
operator|->
name|yp_flags
operator|&
name|YP_COMPONENTS
condition|)
name|do_components_set
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|arg
argument_list|,
name|id
argument_list|,
name|narg
argument_list|)
expr_stmt|;
else|else
block|{
name|do_type_member
argument_list|(
name|y
argument_list|,
name|level
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (%s != NULLPE)\n"
argument_list|,
name|level
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sif (set_add (%s, %s) == NOTOK) {\n"
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|,
name|narg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sadvise (NULLCP, \"%s %%s%%s\", PEPY_ERR_BAD_SET,\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|id
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*spe_error (%s -> pe_errno));\n"
argument_list|,
operator|(
name|level
operator|+
literal|4
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
name|arg
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%*sreturn NOTOK;\n%*s}\n"
argument_list|,
operator|(
name|level
operator|+
literal|2
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|,
operator|(
name|level
operator|+
literal|1
operator|)
operator|*
literal|4
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
name|choice_pullup
argument_list|(
name|newyp
argument_list|,
name|CH_FULLY
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

