begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* miscellany.c - fred miscellaneous functions */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/others/quipu/uips/fred/RCS/miscellany.c,v 7.18 91/02/22 09:30:52 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/others/quipu/uips/fred/RCS/miscellany.c,v 7.18 91/02/22 09:30:52 mrose Interim $  *  *  * $Log:	miscellany.c,v $  * Revision 7.18  91/02/22  09:30:52  mrose  * Interim 6.8  *   * Revision 7.17  91/02/12  18:25:36  mrose  * update  *   * Revision 7.16  91/01/07  12:43:24  mrose  * update  *   * Revision 7.15  90/12/17  22:14:50  mrose  * DA-edit  *   * Revision 7.14  90/10/29  11:50:15  mrose  * more stuff  *   * Revision 7.13  90/10/29  08:10:11  mrose  * touch-up  *   * Revision 7.12  90/10/28  23:21:08  mrose  * server  *   * Revision 7.11  90/09/13  17:46:03  mrose  * thisis-botched  *   * Revision 7.10  90/08/29  15:06:37  mrose  * update  *   * Revision 7.9  90/07/27  08:45:28  mrose  * update  *   * Revision 7.8  90/06/11  10:55:27  mrose  * UFN  *   * Revision 7.7  90/05/12  17:03:22  mrose  * sync  *   * Revision 7.6  90/02/19  13:10:39  mrose  * update  *   * Revision 7.5  90/01/16  21:22:42  mrose  * one more time  *   * Revision 7.4  90/01/16  20:43:35  mrose  * last check-out  *   * Revision 7.3  90/01/11  18:36:37  mrose  * real-sync  *   * Revision 7.2  89/12/01  10:45:09  mrose  * touch-up  *   * Revision 7.1  89/11/27  10:32:24  mrose  * sync  *   * Revision 7.0  89/11/23  22:09:01  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"fred.h"
end_include

begin_comment
comment|/*
comment|DATA */
end_comment

begin_decl_stmt
name|int
name|area_quantum
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|area_guide
name|areas
index|[]
init|=
block|{
name|W_ORGANIZATION
block|,
literal|"organization"
block|,
literal|"-singlelevel"
block|,
literal|"organization"
block|,
literal|"o"
block|,
name|NULL
block|,
name|W_UNIT
block|,
literal|"unit"
block|,
literal|"-subtree"
block|,
literal|"organizationalUnit"
block|,
literal|"ou"
block|,
name|NULL
block|,
name|W_LOCALITY
block|,
literal|"locality"
block|,
literal|"-singlelevel"
block|,
literal|"locality"
block|,
literal|"l"
block|,
name|NULL
block|,
name|W_PERSON
block|,
literal|"person"
block|,
literal|"-subtree"
block|,
literal|"person"
block|,
literal|"cn"
block|,
name|NULL
block|,
name|W_DSA
block|,
literal|"dsa"
block|,
literal|"-singlelevel"
block|,
literal|"dsa"
block|,
literal|"cn"
block|,
name|NULL
block|,
name|W_ROLE
block|,
literal|"role"
block|,
literal|"-subtree"
block|,
literal|"organizationalRole"
block|,
literal|"cn"
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|ALIAS */
end_comment

begin_comment
comment|/* ARGSUSED */
end_comment

begin_function
name|int
name|f_alias
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
name|char
modifier|*
name|cp
decl_stmt|,
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
operator|*
operator|++
name|vec
operator|)
operator|==
name|NULL
condition|)
return|return
name|dish
argument_list|(
literal|"squid -fred -sequence default"
argument_list|,
literal|0
argument_list|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"alias [name]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with no arguments, reports on active aliases\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with one argument, defines an alias for the given name\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"squid -fred -alias \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
return|return
name|dish
argument_list|(
name|buffer
argument_list|,
name|runcom
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*
comment|AREA */
end_comment

begin_function
name|int
name|f_area
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
name|int
name|status
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|dp
decl_stmt|,
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
specifier|register
name|struct
name|area_guide
modifier|*
name|ag
decl_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
operator|*
operator|++
name|vec
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|myarea
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|dish
argument_list|(
literal|"moveto -pwd"
argument_list|,
literal|0
argument_list|)
operator|==
name|NOTOK
condition|)
return|return
name|NOTOK
return|;
block|}
else|else
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"                     default area %s\n"
argument_list|,
name|myarea
argument_list|)
expr_stmt|;
for|for
control|(
name|ag
operator|=
name|areas
init|;
name|ag
operator|->
name|ag_record
condition|;
name|ag
operator|++
control|)
if|if
condition|(
name|ag
operator|->
name|ag_area
condition|)
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"area for record-type %-12.12s %s\n"
argument_list|,
name|ag
operator|->
name|ag_key
argument_list|,
name|ag
operator|->
name|ag_area
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"area [[record] location]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with no arguments, lists areas current defined for various searches\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with one argument, sets the default area for general searches\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with two arguments, sets the default area for the given record type\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
operator|(
name|dp
operator|=
operator|*
operator|++
name|vec
operator|)
operator|==
name|NULL
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"moveto -pwd \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|dish
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"bad area: \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
if|if
condition|(
operator|!
name|runcom
condition|)
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"%s\n"
argument_list|,
name|myarea
argument_list|)
expr_stmt|;
name|area_quantum
operator|++
expr_stmt|;
return|return
name|OK
return|;
block|}
for|for
control|(
name|ag
operator|=
name|areas
init|;
name|ag
operator|->
name|ag_record
condition|;
name|ag
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|ag
operator|->
name|ag_key
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|!
name|ag
operator|->
name|ag_record
condition|)
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"invalid record-type: \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
if|if
condition|(
name|cp
operator|=
name|myarea
condition|)
name|myarea
operator|=
name|NULL
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"moveto -pwd \"%s\""
argument_list|,
name|dp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|status
operator|=
name|dish
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
name|OK
condition|)
block|{
if|if
condition|(
name|ag
operator|->
name|ag_area
condition|)
name|free
argument_list|(
name|ag
operator|->
name|ag_area
argument_list|)
expr_stmt|;
name|ag
operator|->
name|ag_area
operator|=
name|myarea
expr_stmt|;
if|if
condition|(
operator|!
name|runcom
condition|)
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"area for record-type %s: %s\n"
argument_list|,
name|ag
operator|->
name|ag_key
argument_list|,
name|ag
operator|->
name|ag_area
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"bad area: \"%s\""
argument_list|,
name|dp
argument_list|)
expr_stmt|;
if|if
condition|(
name|myarea
condition|)
name|free
argument_list|(
name|myarea
argument_list|)
operator|,
name|myarea
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|myarea
operator|=
name|cp
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"moveto -pwd \"%s\""
argument_list|,
name|myarea
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|dish
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|area_quantum
operator|++
expr_stmt|;
return|return
name|status
return|;
block|}
end_function

begin_comment
comment|/*
comment|DISH */
end_comment

begin_function
name|int
name|f_dish
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
operator|*
operator|++
name|vec
operator|)
operator|==
name|NULL
condition|)
return|return
name|dish
argument_list|(
literal|"squid -fred"
argument_list|,
literal|0
argument_list|)
return|;
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"dish [command [arguments ...]]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with no arguments, reports on status of dish\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with arguments, passes those directly to dish\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|bp
operator|=
name|buffer
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
operator|++
name|vec
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|" \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
return|return
name|dish
argument_list|(
name|buffer
argument_list|,
name|runcom
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*
comment|EDIT */
end_comment

begin_function
name|int
name|f_edit
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
operator|*
operator|++
name|vec
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
operator|*
name|vec
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"edit\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    edit entry in the white pages\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
name|mydn
operator|==
name|NULL
condition|)
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"who are you?  use the \"thisis\" command first..."
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"modify -nocache -dontusecopy -newdraft \"%s\""
argument_list|,
name|mydn
argument_list|)
expr_stmt|;
name|dontpage
operator|=
literal|1
expr_stmt|;
name|result
operator|=
name|dish
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|dontpage
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|result
operator|!=
name|OK
condition|)
return|return
name|result
return|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"showentry \"%s\" -fred -nocache -dontusecopy"
argument_list|,
name|mydn
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|dish
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_comment
comment|/*
comment|MANUAL */
end_comment

begin_function
name|int
name|f_manual
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
if|if
condition|(
operator|*
operator|++
name|vec
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
operator|*
name|vec
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"manual\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    print detailed information\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|isodefile
argument_list|(
literal|"fred.0"
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|=
name|fopen
argument_list|(
name|buffer
argument_list|,
literal|"r"
argument_list|)
condition|)
block|{
while|while
condition|(
name|fgets
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
name|buffer
argument_list|,
name|fp
argument_list|)
condition|)
name|paginate
argument_list|(
name|stdfp
argument_list|,
name|buffer
argument_list|,
name|strlen
argument_list|(
name|buffer
argument_list|)
argument_list|)
expr_stmt|;
name|paginate
argument_list|(
name|stdfp
argument_list|,
name|NULLCP
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
else|else
name|advise
argument_list|(
name|buffer
argument_list|,
literal|"unable to open"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_comment
comment|/*
comment|REPORT */
end_comment

begin_function
name|int
name|f_report
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
operator|*
operator|++
name|vec
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
operator|*
name|vec
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"report [subject]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    send report to white pages manager\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
name|readonly
condition|)
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|_isodefile
argument_list|(
name|isodebinpath
argument_list|,
literal|"mhmail"
argument_list|)
argument_list|)
expr_stmt|;
name|bp
operator|=
name|buffer
expr_stmt|;
name|cp
operator|=
name|strcmp
argument_list|(
name|manager
argument_list|,
literal|"internal"
argument_list|)
condition|?
name|manager
else|:
literal|"wpp-manager@psi.com"
expr_stmt|;
if|if
condition|(
operator|!
name|readonly
operator|||
name|access
argument_list|(
name|buffer
argument_list|,
literal|0x01
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|bp
argument_list|,
literal|"/usr/ucb/Mail "
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"-v "
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|readonly
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"-r \"%s\" "
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"-s"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|" -subject"
argument_list|)
expr_stmt|;
block|}
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|" \"%s\" \"%s\""
argument_list|,
operator|*
name|vec
condition|?
operator|*
name|vec
else|:
literal|"White Pages report"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"End report with CTRL-D%s.\n"
argument_list|,
name|readonly
condition|?
literal|", it will then take 30 seconds to post message"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|readonly
condition|)
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"In the message please specify your e-mail address, so a reply may be made.\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|stdfp
argument_list|)
expr_stmt|;
if|if
condition|(
name|watch
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s\n"
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|system
argument_list|(
name|buffer
argument_list|)
condition|)
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"problem sending report"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_comment
comment|/*
comment|THISIS */
end_comment

begin_function
name|int
name|f_thisis
parameter_list|(
name|vec
parameter_list|)
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|;
name|char
modifier|*
name|cp
decl_stmt|,
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|again
label|:
empty_stmt|;
if|if
condition|(
operator|(
name|cp
operator|=
operator|*
operator|++
name|vec
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mydn
operator|==
name|NULL
condition|)
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"who are you?"
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
name|printf
argument_list|(
literal|"you are \"%s\"\n"
argument_list|,
name|mydn
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"-help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"thisis [name]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with no arguments, lists your name in the white pages\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdfp
argument_list|,
literal|"    with one argument, identifies you in the white pages\n"
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"is"
argument_list|)
operator|==
literal|0
condition|)
goto|goto
name|again
goto|;
if|if
condition|(
operator|*
name|cp
operator|==
literal|'!'
condition|)
name|cp
operator|++
expr_stmt|;
for|for
control|(
name|bp
operator|=
name|cp
init|;
name|isdigit
argument_list|(
operator|*
name|bp
argument_list|)
condition|;
name|bp
operator|++
control|)
continue|continue;
if|if
condition|(
operator|*
name|bp
operator|&&
operator|(
name|index
argument_list|(
name|cp
argument_list|,
literal|'@'
argument_list|)
operator|==
name|NULL
operator|||
name|index
argument_list|(
name|cp
argument_list|,
literal|'='
argument_list|)
operator|==
name|NULL
operator|)
condition|)
block|{
name|advise
argument_list|(
name|NULLCP
argument_list|,
literal|"expecting a distinguished name (if you don't know what this is, punt)"
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
name|bp
operator|=
name|buffer
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|"bind -simple -user \"%s\""
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
operator|++
name|vec
condition|)
block|{
if|if
condition|(
name|runcom
operator|&&
operator|(
name|rcmode
operator|&
literal|077
operator|)
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"incorrect mode for runcom file -- use \"chmod 0600 $HOME/.fredrc\""
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|bp
argument_list|,
literal|" -password \"%s\""
argument_list|,
operator|*
name|vec
argument_list|)
expr_stmt|;
name|bp
operator|+=
name|strlen
argument_list|(
name|bp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dish
argument_list|(
name|buffer
argument_list|,
literal|0
argument_list|)
operator|!=
name|OK
condition|)
block|{
operator|(
name|void
operator|)
name|f_quit
argument_list|(
name|NULLVP
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* NOT REACHED */
block|}
if|if
condition|(
name|runcom
condition|)
name|didbind
operator|=
literal|1
expr_stmt|;
operator|(
name|void
operator|)
name|dish
argument_list|(
literal|"squid -user"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

end_unit

