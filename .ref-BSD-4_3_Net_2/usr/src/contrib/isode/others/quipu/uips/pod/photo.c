begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/others/quipu/uips/pod/RCS/photo.c,v 7.2 91/02/22 09:31:38 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * $Header: /f/osi/others/quipu/uips/pod/RCS/photo.c,v 7.2 91/02/22 09:31:38 mrose Interim $  */
end_comment

begin_include
include|#
directive|include
file|"quipu/photo.h"
end_include

begin_include
include|#
directive|include
file|"pod.h"
end_include

begin_decl_stmt
specifier|extern
name|Widget
name|toplevel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|Widget
name|PhotoWindow
decl_stmt|;
end_decl_stmt

begin_function_decl
name|GC
name|XCreateGC
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|void
name|make_photo_widget
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|GC
name|gc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|photo_name
index|[
literal|1024
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Pixmap
name|photo_pixmap
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Display
modifier|*
name|dpy
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Screen
modifier|*
name|scr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|winX
decl_stmt|,
name|winY
decl_stmt|,
name|winW
decl_stmt|,
name|winH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|NUMLINES
decl_stmt|,
name|PIC_LINESIZE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|unsigned
name|position
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|long
name|XorVal
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|passno
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|px
decl_stmt|,
name|py
decl_stmt|,
name|maxx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|two_passes
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
name|int
name|photo_start
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
block|{
name|x
operator|=
name|y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|passno
operator|==
literal|1
condition|)
name|maxx
operator|=
literal|0
operator|,
name|two_passes
operator|=
literal|1
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|photo_end
parameter_list|(
name|name
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|;
block|{
if|if
condition|(
name|passno
operator|==
literal|1
condition|)
block|{
name|passno
operator|=
literal|2
expr_stmt|;
name|px
operator|=
name|x
operator|=
name|maxx
expr_stmt|;
name|py
operator|=
operator|--
name|y
expr_stmt|;
name|make_photo_widget
argument_list|()
expr_stmt|;
name|dpy
operator|=
name|XtDisplay
argument_list|(
name|toplevel
argument_list|)
expr_stmt|;
name|scr
operator|=
name|DefaultScreenOfDisplay
argument_list|(
name|dpy
argument_list|)
expr_stmt|;
name|winW
operator|=
name|x
expr_stmt|;
name|winH
operator|=
name|y
expr_stmt|;
name|photo_pixmap
operator|=
name|XCreatePixmap
argument_list|(
name|dpy
argument_list|,
name|XtWindow
argument_list|(
name|PhotoWindow
argument_list|)
argument_list|,
operator|(
name|Dimension
operator|)
name|x
argument_list|,
operator|(
name|Dimension
operator|)
name|y
argument_list|,
name|DefaultDepthOfScreen
argument_list|(
name|scr
argument_list|)
argument_list|)
expr_stmt|;
name|gc
operator|=
name|XCreateGC
argument_list|(
name|dpy
argument_list|,
name|photo_pixmap
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|XSetLineAttributes
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
name|LineSolid
argument_list|,
name|CapButt
argument_list|,
name|JoinBevel
argument_list|)
expr_stmt|;
name|XSetFunction
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|GXclear
argument_list|)
expr_stmt|;
name|XSetBackground
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|WhitePixelOfScreen
argument_list|(
name|scr
argument_list|)
argument_list|)
expr_stmt|;
name|XSetForeground
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|BlackPixelOfScreen
argument_list|(
name|scr
argument_list|)
argument_list|)
expr_stmt|;
name|XFillRectangle
argument_list|(
name|dpy
argument_list|,
name|photo_pixmap
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|winW
argument_list|,
name|winH
argument_list|)
expr_stmt|;
name|XSetFunction
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|GXcopy
argument_list|)
expr_stmt|;
name|XSetForeground
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|BlackPixelOfScreen
argument_list|(
name|scr
argument_list|)
argument_list|)
expr_stmt|;
name|XSetBackground
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|WhitePixelOfScreen
argument_list|(
name|scr
argument_list|)
argument_list|)
expr_stmt|;
name|XFillRectangle
argument_list|(
name|dpy
argument_list|,
name|photo_pixmap
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|winW
argument_list|,
name|winH
argument_list|)
expr_stmt|;
name|XSetFunction
argument_list|(
name|dpy
argument_list|,
name|gc
argument_list|,
name|GXclear
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|name
operator|&&
operator|*
name|name
condition|)
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|photo_name
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|passno
operator|=
literal|1
expr_stmt|;
name|x
operator|=
name|y
operator|=
name|maxx
operator|=
literal|0
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
name|int
name|photo_line_end
parameter_list|(
name|line
parameter_list|)
name|bit_string
modifier|*
name|line
decl_stmt|;
block|{
comment|/* the end of a line has been reached */
comment|/* A bit string is stored in line->dbuf_top */
if|if
condition|(
name|passno
operator|==
literal|1
operator|&&
name|x
operator|>
name|maxx
condition|)
name|maxx
operator|=
name|x
expr_stmt|;
name|x
operator|=
literal|0
operator|,
name|y
operator|++
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|photo_black
parameter_list|(
name|length
parameter_list|)
name|int
name|length
decl_stmt|;
block|{
if|if
condition|(
name|passno
operator|==
literal|1
condition|)
block|{
name|x
operator|+=
name|length
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* draw a black line of 'length' pixels */
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|photo_white
parameter_list|(
name|length
parameter_list|)
name|int
name|length
decl_stmt|;
block|{
if|if
condition|(
name|passno
operator|==
literal|1
condition|)
block|{
name|x
operator|+=
name|length
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* draw a white line of 'length' pixels */
name|XDrawLine
argument_list|(
name|dpy
argument_list|,
name|photo_pixmap
argument_list|,
name|gc
argument_list|,
name|position
argument_list|,
name|NUMLINES
argument_list|,
name|length
operator|+
name|position
operator|-
literal|1
argument_list|,
name|NUMLINES
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

