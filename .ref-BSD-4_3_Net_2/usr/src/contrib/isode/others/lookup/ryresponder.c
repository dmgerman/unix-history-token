begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ryresponder.c - generic idempotent responder */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/others/lookup/RCS/ryresponder.c,v 7.3 91/02/22 09:27:40 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/others/lookup/RCS/ryresponder.c,v 7.3 91/02/22 09:27:40 mrose Interim $  *  *  * $Log:	ryresponder.c,v $  * Revision 7.3  91/02/22  09:27:40  mrose  * Interim 6.8  *   * Revision 7.2  90/12/11  10:40:05  mrose  * sync  *   * Revision 7.1  90/07/09  14:39:56  mrose  * sync  *   * Revision 7.0  89/11/23  22:56:44  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<setjmp.h>
end_include

begin_include
include|#
directive|include
file|<varargs.h>
end_include

begin_include
include|#
directive|include
file|"ryresponder.h"
end_include

begin_include
include|#
directive|include
file|"tsap.h"
end_include

begin_comment
comment|/* for listening */
end_comment

begin_comment
comment|/*
comment|DATA */
end_comment

begin_decl_stmt
name|int
name|debug
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|LLog
name|_pgm_log
init|=
block|{
literal|"responder.log"
block|,
name|NULLCP
block|,
name|NULLCP
block|,
name|LLOG_FATAL
operator||
name|LLOG_EXCEPTIONS
operator||
name|LLOG_NOTICE
block|,
name|LLOG_FATAL
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|pgm_log
init|=
operator|&
name|_pgm_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|myname
init|=
literal|"ryresponder"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|jmp_buf
name|toplevel
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|IFP
name|startfnx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|IFP
name|stopfnx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ros_init
argument_list|()
decl_stmt|,
name|ros_work
argument_list|()
decl_stmt|,
name|ros_indication
argument_list|()
decl_stmt|,
name|ros_lose
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|errno
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|RESPONDER */
end_comment

begin_function
name|int
name|ryresponder
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|,
name|host
parameter_list|,
name|myservice
parameter_list|,
name|mycontext
parameter_list|,
name|dispatches
parameter_list|,
name|ops
parameter_list|,
name|start
parameter_list|,
name|stop
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|,
decl|*
name|host
decl_stmt|,
modifier|*
name|myservice
decl_stmt|,
modifier|*
name|mycontext
decl_stmt|;
end_function

begin_decl_stmt
name|struct
name|dispatch
modifier|*
name|dispatches
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|RyOperation
modifier|*
name|ops
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|IFP
name|start
decl_stmt|,
name|stop
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|dispatch
modifier|*
name|ds
decl_stmt|;
name|AEI
name|aei
decl_stmt|;
name|struct
name|TSAPdisconnect
name|tds
decl_stmt|;
name|struct
name|TSAPdisconnect
modifier|*
name|td
init|=
operator|&
name|tds
decl_stmt|;
name|struct
name|RoSAPindication
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPindication
modifier|*
name|roi
init|=
operator|&
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
init|=
operator|&
name|roi
operator|->
name|roi_preject
decl_stmt|;
if|if
condition|(
name|myname
operator|=
name|rindex
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|'/'
argument_list|)
condition|)
name|myname
operator|++
expr_stmt|;
if|if
condition|(
name|myname
operator|==
name|NULL
operator|||
operator|*
name|myname
operator|==
name|NULL
condition|)
name|myname
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|isodetailor
argument_list|(
name|myname
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|debug
operator|=
name|isatty
argument_list|(
name|fileno
argument_list|(
name|stderr
argument_list|)
argument_list|)
condition|)
name|ll_dbinit
argument_list|(
name|pgm_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
else|else
block|{
specifier|static
name|char
name|myfile
index|[
name|BUFSIZ
index|]
decl_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|myfile
argument_list|,
literal|"%s.log"
argument_list|,
operator|(
name|strncmp
argument_list|(
name|myname
argument_list|,
literal|"ros."
argument_list|,
literal|4
argument_list|)
operator|&&
name|strncmp
argument_list|(
name|myname
argument_list|,
literal|"lpp."
argument_list|,
literal|4
argument_list|)
operator|)
operator|||
name|myname
index|[
literal|4
index|]
operator|==
name|NULL
condition|?
name|myname
else|:
name|myname
operator|+
literal|4
argument_list|)
expr_stmt|;
name|pgm_log
operator|->
name|ll_file
operator|=
name|myfile
expr_stmt|;
name|ll_hdinit
argument_list|(
name|pgm_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
block|}
name|advise
argument_list|(
name|LLOG_NOTICE
argument_list|,
name|NULLCP
argument_list|,
literal|"starting"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|aei
operator|=
name|str2aei
argument_list|(
name|host
argument_list|,
name|myservice
argument_list|,
name|mycontext
argument_list|,
literal|0
argument_list|)
operator|)
operator|==
name|NULLAEI
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"unable to resolve service: %s"
argument_list|,
name|PY_pepy
argument_list|)
expr_stmt|;
for|for
control|(
name|ds
operator|=
name|dispatches
init|;
name|ds
operator|->
name|ds_name
condition|;
name|ds
operator|++
control|)
if|if
condition|(
name|RyDispatch
argument_list|(
name|NOTOK
argument_list|,
name|ops
argument_list|,
name|ds
operator|->
name|ds_operation
argument_list|,
name|ds
operator|->
name|ds_vector
argument_list|,
name|roi
argument_list|)
operator|==
name|NOTOK
condition|)
name|ros_adios
argument_list|(
name|rop
argument_list|,
name|ds
operator|->
name|ds_name
argument_list|)
expr_stmt|;
name|startfnx
operator|=
name|start
expr_stmt|;
name|stopfnx
operator|=
name|stop
expr_stmt|;
if|if
condition|(
name|isodeserver
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|aei
argument_list|,
name|ros_init
argument_list|,
name|ros_work
argument_list|,
name|ros_lose
argument_list|,
name|td
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
if|if
condition|(
name|td
operator|->
name|td_cc
operator|>
literal|0
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"isodeserver: [%s] %*.*s"
argument_list|,
name|TErrString
argument_list|(
name|td
operator|->
name|td_reason
argument_list|)
argument_list|,
name|td
operator|->
name|td_cc
argument_list|,
name|td
operator|->
name|td_cc
argument_list|,
name|td
operator|->
name|td_data
argument_list|)
expr_stmt|;
else|else
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"isodeserver: [%s]"
argument_list|,
name|TErrString
argument_list|(
name|td
operator|->
name|td_reason
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|ros_init
parameter_list|(
name|vecp
parameter_list|,
name|vec
parameter_list|)
name|int
name|vecp
decl_stmt|;
name|char
modifier|*
modifier|*
name|vec
decl_stmt|;
block|{
name|int
name|reply
decl_stmt|,
name|result
decl_stmt|,
name|sd
decl_stmt|;
name|struct
name|AcSAPstart
name|acss
decl_stmt|;
specifier|register
name|struct
name|AcSAPstart
modifier|*
name|acs
init|=
operator|&
name|acss
decl_stmt|;
name|struct
name|AcSAPindication
name|acis
decl_stmt|;
specifier|register
name|struct
name|AcSAPindication
modifier|*
name|aci
init|=
operator|&
name|acis
decl_stmt|;
specifier|register
name|struct
name|AcSAPabort
modifier|*
name|aca
init|=
operator|&
name|aci
operator|->
name|aci_abort
decl_stmt|;
specifier|register
name|struct
name|PSAPstart
modifier|*
name|ps
init|=
operator|&
name|acs
operator|->
name|acs_start
decl_stmt|;
name|struct
name|RoSAPindication
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPindication
modifier|*
name|roi
init|=
operator|&
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
init|=
operator|&
name|roi
operator|->
name|roi_preject
decl_stmt|;
if|if
condition|(
name|AcInit
argument_list|(
name|vecp
argument_list|,
name|vec
argument_list|,
name|acs
argument_list|,
name|aci
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
name|acs_advise
argument_list|(
name|aca
argument_list|,
literal|"initialization fails"
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
name|advise
argument_list|(
name|LLOG_NOTICE
argument_list|,
name|NULLCP
argument_list|,
literal|"A-ASSOCIATE.INDICATION:<%d, %s, %s, %s, %d>"
argument_list|,
name|acs
operator|->
name|acs_sd
argument_list|,
name|oid2ode
argument_list|(
name|acs
operator|->
name|acs_context
argument_list|)
argument_list|,
name|sprintaei
argument_list|(
operator|&
name|acs
operator|->
name|acs_callingtitle
argument_list|)
argument_list|,
name|sprintaei
argument_list|(
operator|&
name|acs
operator|->
name|acs_calledtitle
argument_list|)
argument_list|,
name|acs
operator|->
name|acs_ninfo
argument_list|)
expr_stmt|;
name|sd
operator|=
name|acs
operator|->
name|acs_sd
expr_stmt|;
for|for
control|(
name|vec
operator|++
init|;
operator|*
name|vec
condition|;
name|vec
operator|++
control|)
name|advise
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"unknown argument \"%s\""
argument_list|,
operator|*
name|vec
argument_list|)
expr_stmt|;
name|reply
operator|=
name|startfnx
condition|?
call|(
modifier|*
name|startfnx
call|)
argument_list|(
name|sd
argument_list|,
name|acs
argument_list|)
else|:
name|ACS_ACCEPT
expr_stmt|;
name|result
operator|=
name|AcAssocResponse
argument_list|(
name|sd
argument_list|,
name|reply
argument_list|,
name|reply
operator|!=
name|ACS_ACCEPT
condition|?
name|ACS_USER_NOREASON
else|:
name|ACS_USER_NULL
argument_list|,
name|NULLOID
argument_list|,
name|NULLAEI
argument_list|,
name|NULLPA
argument_list|,
name|NULLPC
argument_list|,
name|ps
operator|->
name|ps_defctxresult
argument_list|,
name|ps
operator|->
name|ps_prequirements
argument_list|,
name|ps
operator|->
name|ps_srequirements
argument_list|,
name|SERIAL_NONE
argument_list|,
name|ps
operator|->
name|ps_settings
argument_list|,
operator|&
name|ps
operator|->
name|ps_connect
argument_list|,
name|NULLPEP
argument_list|,
literal|0
argument_list|,
name|aci
argument_list|)
expr_stmt|;
name|ACSFREE
argument_list|(
name|acs
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
block|{
name|acs_advise
argument_list|(
name|aca
argument_list|,
literal|"A-ASSOCIATE.RESPONSE"
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
if|if
condition|(
name|reply
operator|!=
name|ACS_ACCEPT
condition|)
return|return
name|NOTOK
return|;
if|if
condition|(
name|RoSetService
argument_list|(
name|sd
argument_list|,
name|RoPService
argument_list|,
name|roi
argument_list|)
operator|==
name|NOTOK
condition|)
name|ros_adios
argument_list|(
name|rop
argument_list|,
literal|"set RO/PS fails"
argument_list|)
expr_stmt|;
return|return
name|sd
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|ros_work
parameter_list|(
name|fd
parameter_list|)
name|int
name|fd
decl_stmt|;
block|{
name|int
name|result
decl_stmt|;
name|caddr_t
name|out
decl_stmt|;
name|struct
name|AcSAPindication
name|acis
decl_stmt|;
name|struct
name|RoSAPindication
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPindication
modifier|*
name|roi
init|=
operator|&
name|rois
decl_stmt|;
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
init|=
operator|&
name|roi
operator|->
name|roi_preject
decl_stmt|;
switch|switch
condition|(
name|setjmp
argument_list|(
name|toplevel
argument_list|)
condition|)
block|{
case|case
name|OK
case|:
break|break;
default|default:
if|if
condition|(
name|stopfnx
condition|)
call|(
modifier|*
name|stopfnx
call|)
argument_list|(
name|fd
argument_list|,
operator|(
expr|struct
name|AcSAPfinish
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
case|case
name|DONE
case|:
operator|(
name|void
operator|)
name|AcUAbortRequest
argument_list|(
name|fd
argument_list|,
name|NULLPEP
argument_list|,
literal|0
argument_list|,
operator|&
name|acis
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|RyLose
argument_list|(
name|fd
argument_list|,
name|roi
argument_list|)
expr_stmt|;
return|return
name|NOTOK
return|;
block|}
switch|switch
condition|(
name|result
operator|=
name|RyWait
argument_list|(
name|fd
argument_list|,
name|NULLIP
argument_list|,
operator|&
name|out
argument_list|,
name|OK
argument_list|,
name|roi
argument_list|)
condition|)
block|{
case|case
name|NOTOK
case|:
if|if
condition|(
name|rop
operator|->
name|rop_reason
operator|==
name|ROS_TIMER
condition|)
break|break;
case|case
name|OK
case|:
case|case
name|DONE
case|:
name|ros_indication
argument_list|(
name|fd
argument_list|,
name|roi
argument_list|)
expr_stmt|;
break|break;
default|default:
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"unknown return from RoWaitRequest=%d"
argument_list|,
name|result
argument_list|)
expr_stmt|;
block|}
return|return
name|OK
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|ros_indication
parameter_list|(
name|sd
parameter_list|,
name|roi
parameter_list|)
name|int
name|sd
decl_stmt|;
specifier|register
name|struct
name|RoSAPindication
modifier|*
name|roi
decl_stmt|;
block|{
name|int
name|reply
decl_stmt|,
name|result
decl_stmt|;
switch|switch
condition|(
name|roi
operator|->
name|roi_type
condition|)
block|{
case|case
name|ROI_INVOKE
case|:
case|case
name|ROI_RESULT
case|:
case|case
name|ROI_ERROR
case|:
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"unexpected indication type=%d"
argument_list|,
name|roi
operator|->
name|roi_type
argument_list|)
expr_stmt|;
break|break;
case|case
name|ROI_UREJECT
case|:
block|{
specifier|register
name|struct
name|RoSAPureject
modifier|*
name|rou
init|=
operator|&
name|roi
operator|->
name|roi_ureject
decl_stmt|;
if|if
condition|(
name|rou
operator|->
name|rou_noid
condition|)
name|advise
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"RO-REJECT-U.INDICATION/%d: %s"
argument_list|,
name|sd
argument_list|,
name|RoErrString
argument_list|(
name|rou
operator|->
name|rou_reason
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|advise
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"RO-REJECT-U.INDICATION/%d: %s (id=%d)"
argument_list|,
name|sd
argument_list|,
name|RoErrString
argument_list|(
name|rou
operator|->
name|rou_reason
argument_list|)
argument_list|,
name|rou
operator|->
name|rou_id
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ROI_PREJECT
case|:
block|{
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
init|=
operator|&
name|roi
operator|->
name|roi_preject
decl_stmt|;
if|if
condition|(
name|ROS_FATAL
argument_list|(
name|rop
operator|->
name|rop_reason
argument_list|)
condition|)
name|ros_adios
argument_list|(
name|rop
argument_list|,
literal|"RO-REJECT-P.INDICATION"
argument_list|)
expr_stmt|;
name|ros_advise
argument_list|(
name|rop
argument_list|,
literal|"RO-REJECT-P.INDICATION"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ROI_FINISH
case|:
block|{
specifier|register
name|struct
name|AcSAPfinish
modifier|*
name|acf
init|=
operator|&
name|roi
operator|->
name|roi_finish
decl_stmt|;
name|struct
name|AcSAPindication
name|acis
decl_stmt|;
specifier|register
name|struct
name|AcSAPabort
modifier|*
name|aca
init|=
operator|&
name|acis
operator|.
name|aci_abort
decl_stmt|;
name|advise
argument_list|(
name|LLOG_NOTICE
argument_list|,
name|NULLCP
argument_list|,
literal|"A-RELEASE.INDICATION/%d: %d"
argument_list|,
name|sd
argument_list|,
name|acf
operator|->
name|acf_reason
argument_list|)
expr_stmt|;
name|reply
operator|=
name|stopfnx
condition|?
call|(
modifier|*
name|stopfnx
call|)
argument_list|(
name|sd
argument_list|,
name|acf
argument_list|)
else|:
name|ACS_ACCEPT
expr_stmt|;
name|result
operator|=
name|AcRelResponse
argument_list|(
name|sd
argument_list|,
name|reply
argument_list|,
name|ACR_NORMAL
argument_list|,
name|NULLPEP
argument_list|,
literal|0
argument_list|,
operator|&
name|acis
argument_list|)
expr_stmt|;
name|ACFFREE
argument_list|(
name|acf
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|==
name|NOTOK
condition|)
name|acs_advise
argument_list|(
name|aca
argument_list|,
literal|"A-RELEASE.RESPONSE"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|reply
operator|!=
name|ACS_ACCEPT
condition|)
break|break;
name|longjmp
argument_list|(
name|toplevel
argument_list|,
name|DONE
argument_list|)
expr_stmt|;
block|}
comment|/* NOTREACHED */
default|default:
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"unknown indication type=%d"
argument_list|,
name|roi
operator|->
name|roi_type
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|ros_lose
parameter_list|(
name|td
parameter_list|)
name|struct
name|TSAPdisconnect
modifier|*
name|td
decl_stmt|;
block|{
if|if
condition|(
name|td
operator|->
name|td_cc
operator|>
literal|0
condition|)
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"TNetAccept: [%s] %*.*s"
argument_list|,
name|TErrString
argument_list|(
name|td
operator|->
name|td_reason
argument_list|)
argument_list|,
name|td
operator|->
name|td_cc
argument_list|,
name|td
operator|->
name|td_cc
argument_list|,
name|td
operator|->
name|td_data
argument_list|)
expr_stmt|;
else|else
name|adios
argument_list|(
name|NULLCP
argument_list|,
literal|"TNetAccept: [%s]"
argument_list|,
name|TErrString
argument_list|(
name|td
operator|->
name|td_reason
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*
comment|ERRORS */
end_comment

begin_function
name|void
name|ros_adios
parameter_list|(
name|rop
parameter_list|,
name|event
parameter_list|)
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
decl_stmt|;
name|char
modifier|*
name|event
decl_stmt|;
block|{
name|ros_advise
argument_list|(
name|rop
argument_list|,
name|event
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|toplevel
argument_list|,
name|NOTOK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|ros_advise
parameter_list|(
name|rop
parameter_list|,
name|event
parameter_list|)
specifier|register
name|struct
name|RoSAPpreject
modifier|*
name|rop
decl_stmt|;
name|char
modifier|*
name|event
decl_stmt|;
block|{
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
name|rop
operator|->
name|rop_cc
operator|>
literal|0
condition|)
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"[%s] %*.*s"
argument_list|,
name|RoErrString
argument_list|(
name|rop
operator|->
name|rop_reason
argument_list|)
argument_list|,
name|rop
operator|->
name|rop_cc
argument_list|,
name|rop
operator|->
name|rop_cc
argument_list|,
name|rop
operator|->
name|rop_data
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"[%s]"
argument_list|,
name|RoErrString
argument_list|(
name|rop
operator|->
name|rop_reason
argument_list|)
argument_list|)
expr_stmt|;
name|advise
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"%s: %s"
argument_list|,
name|event
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|void
name|acs_advise
parameter_list|(
name|aca
parameter_list|,
name|event
parameter_list|)
specifier|register
name|struct
name|AcSAPabort
modifier|*
name|aca
decl_stmt|;
name|char
modifier|*
name|event
decl_stmt|;
block|{
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
if|if
condition|(
name|aca
operator|->
name|aca_cc
operator|>
literal|0
condition|)
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"[%s] %*.*s"
argument_list|,
name|AcErrString
argument_list|(
name|aca
operator|->
name|aca_reason
argument_list|)
argument_list|,
name|aca
operator|->
name|aca_cc
argument_list|,
name|aca
operator|->
name|aca_cc
argument_list|,
name|aca
operator|->
name|aca_data
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"[%s]"
argument_list|,
name|AcErrString
argument_list|(
name|aca
operator|->
name|aca_reason
argument_list|)
argument_list|)
expr_stmt|;
name|advise
argument_list|(
name|LLOG_EXCEPTIONS
argument_list|,
name|NULLCP
argument_list|,
literal|"%s: %s (source %d)"
argument_list|,
name|event
argument_list|,
name|buffer
argument_list|,
name|aca
operator|->
name|aca_source
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_function
name|void
name|adios
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|_ll_log
argument_list|(
name|pgm_log
argument_list|,
name|LLOG_FATAL
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* VARARGS2 */
end_comment

begin_function
name|void
name|adios
parameter_list|(
name|what
parameter_list|,
name|fmt
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|,
decl|*
name|fmt
decl_stmt|;
end_function

begin_block
block|{
name|adios
argument_list|(
name|what
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_function
name|void
name|advise
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|int
name|code
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|code
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|int
argument_list|)
expr_stmt|;
name|_ll_log
argument_list|(
name|pgm_log
argument_list|,
name|code
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* VARARGS3 */
end_comment

begin_function
name|void
name|advise
parameter_list|(
name|code
parameter_list|,
name|what
parameter_list|,
name|fmt
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|,
decl|*
name|fmt
decl_stmt|;
end_function

begin_decl_stmt
name|int
name|code
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|advise
argument_list|(
name|code
argument_list|,
name|what
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_function
name|void
name|ryr_advise
parameter_list|(
name|va_alist
parameter_list|)
function|va_dcl
block|{
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|)
expr_stmt|;
name|_ll_log
argument_list|(
name|pgm_log
argument_list|,
name|LLOG_NOTICE
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* VARARGS2 */
end_comment

begin_function
name|void
name|ryr_advise
parameter_list|(
name|what
parameter_list|,
name|fmt
parameter_list|)
name|char
modifier|*
name|what
decl_stmt|,
decl|*
name|fmt
decl_stmt|;
end_function

begin_block
block|{
name|ryr_advise
argument_list|(
name|what
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

