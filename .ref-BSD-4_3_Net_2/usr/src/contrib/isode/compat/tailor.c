begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* tailor.c - ISODE tailoring */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rcsid
init|=
literal|"$Header: /f/osi/compat/RCS/tailor.c,v 7.9 91/02/22 09:16:09 mrose Interim $"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*   * $Header: /f/osi/compat/RCS/tailor.c,v 7.9 91/02/22 09:16:09 mrose Interim $  *  *  * $Log:	tailor.c,v $  * Revision 7.9  91/02/22  09:16:09  mrose  * Interim 6.8  *   * Revision 7.8  90/11/21  11:35:35  mrose  * update  *   * Revision 7.7  90/10/15  18:19:40  mrose  * sync  *   * Revision 7.6  90/07/09  14:32:25  mrose  * sync  *   * Revision 7.5  90/03/08  08:01:12  mrose  * ending  *   * Revision 7.4  90/02/19  13:07:20  mrose  * update  *   * Revision 7.3  90/01/11  18:35:16  mrose  * real-sync  *   * Revision 7.2  89/12/12  16:14:57  mrose  * localHost  *   * Revision 7.1  89/11/30  23:53:32  mrose  * touch-up  *   * Revision 7.0  89/11/23  21:23:45  mrose  * Release 6.0  *   */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_comment
comment|/* LINTLIBRARY */
end_comment

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"manifest.h"
end_include

begin_include
include|#
directive|include
file|"isoaddrs.h"
end_include

begin_include
include|#
directive|include
file|"tailor.h"
end_include

begin_define
define|#
directive|define
name|SUBNET_MAX
value|(6 + 10)
end_define

begin_comment
comment|/* maximum number of subnet entries */
end_comment

begin_comment
comment|/*
comment|DATA */
end_comment

begin_struct
struct|struct
name|pair
block|{
name|char
modifier|*
name|p_name
decl_stmt|;
name|int
name|p_value
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|char
modifier|*
name|isotailor
init|=
literal|"isotailor"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|isodename
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|isodebinpath
init|=
name|BINPATH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|isodesbinpath
init|=
name|SBINPATH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|isodetcpath
init|=
name|ETCPATH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|isodelogpath
init|=
name|LOGPATH
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|pair
name|ll_pairs
index|[]
init|=
block|{
literal|"none"
block|,
name|LLOG_NONE
block|,
literal|"fatal"
block|,
name|LLOG_FATAL
block|,
literal|"exceptions"
block|,
name|LLOG_EXCEPTIONS
block|,
literal|"notice"
block|,
name|LLOG_NOTICE
block|,
literal|"pdus"
block|,
name|LLOG_PDUS
block|,
literal|"trace"
block|,
name|LLOG_TRACE
block|,
literal|"debug"
block|,
name|LLOG_DEBUG
block|,
literal|"all"
block|,
name|LLOG_ALL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|compatdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_compat_log
init|=
block|{
literal|"%d.log"
block|,
name|NULLCP
block|,
literal|"compat"
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|compat_log
init|=
operator|&
name|_compat_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|addrdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_addr_log
init|=
block|{
literal|"%d.log"
block|,
literal|"addr"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|addr_log
init|=
operator|&
name|_addr_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|tsapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_tsap_log
init|=
block|{
literal|"%d.tpkt"
block|,
literal|"tsap"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|tsap_log
init|=
operator|&
name|_tsap_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|ssapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_ssap_log
init|=
block|{
literal|"%d.spkt"
block|,
literal|"ssap"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|ssap_log
init|=
operator|&
name|_ssap_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|psapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_psap_log
init|=
block|{
literal|"%d.pe"
block|,
name|NULLCP
block|,
literal|"psap"
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|psap_log
init|=
operator|&
name|_psap_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|psap2debug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_psap2_log
init|=
block|{
literal|"%d.ppkt"
block|,
literal|"psap2"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|psap2_log
init|=
operator|&
name|_psap2_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|acsapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_acsap_log
init|=
block|{
literal|"%d.acpkt"
block|,
literal|"acsap"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|acsap_log
init|=
operator|&
name|_acsap_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rtsapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_rtsap_log
init|=
block|{
literal|"%d.rtpkt"
block|,
literal|"rtsap"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|rtsap_log
init|=
operator|&
name|_rtsap_log
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rosapdebug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
name|_rosap_log
init|=
block|{
literal|"%d.ropkt"
block|,
literal|"rosap"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|rosap_log
init|=
operator|&
name|_rosap_log
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|TS_MASK
value|"\020\01TCP\02X25\03BRG\04TP4"
end_define

begin_decl_stmt
specifier|static
name|struct
name|pair
name|ts_pairs
index|[]
init|=
block|{
literal|"tcp"
block|,
name|TS_TCP
block|,
literal|"x25"
block|,
name|TS_X25
block|,
literal|"bridge"
block|,
name|TS_BRG
block|,
literal|"tp4"
block|,
name|TS_TP4
block|,
literal|"all"
block|,
name|TS_ALL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_stacks
init|=
literal|"all"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ts_stacks
init|=
name|TS_ALL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_interim
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ts_interim
name|ts_interim
index|[
name|SUBNET_MAX
operator|+
literal|1
index|]
init|=
block|{
literal|"realNS"
block|,
name|NULL
block|,
name|SUBNET_REALNS
block|,
name|NA_NSAP
block|,
literal|""
block|,
literal|0
block|,
literal|"Int-X25"
block|,
name|NULL
block|,
name|SUBNET_INT_X25
block|,
name|NA_X25
block|,
literal|""
block|,
literal|0
block|,
literal|"Internet"
block|,
name|NULL
block|,
name|SUBNET_INTERNET
block|,
name|NA_TCP
block|,
literal|""
block|,
literal|0
block|,
literal|"Janet"
block|,
name|NULL
block|,
name|SUBNET_DYNAMIC
operator|-
literal|1
block|,
name|NA_X25
block|,
literal|""
block|,
literal|0
block|,
literal|"localTCP"
block|,
name|NULL
block|,
name|SUBNET_DYNAMIC
operator|-
literal|2
block|,
name|NA_TCP
block|,
literal|""
block|,
literal|0
block|,
literal|"IXI"
block|,
name|NULL
block|,
name|SUBNET_DYNAMIC
operator|-
literal|3
block|,
name|NA_X25
block|,
literal|""
block|,
literal|0
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_communities
init|=
literal|"all"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ts_communities
index|[
name|SUBNET_MAX
operator|+
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_comm_nsap_default
init|=
literal|"realNS"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ts_comm_nsap_default
init|=
name|SUBNET_REALNS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_comm_x25_default
init|=
literal|"Int-X25"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ts_comm_x25_default
init|=
name|SUBNET_INT_X25
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ts_comm_tcp_default
init|=
literal|"Internet"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ts_comm_tcp_default
init|=
name|SUBNET_INTERNET
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tsb_communities
index|[
name|SUBNET_MAX
operator|+
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|tsb_addresses
index|[
name|SUBNET_MAX
operator|+
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_tsb_config
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|tsb_default_address
init|=
literal|"undefined"
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|X25
end_ifdef

begin_decl_stmt
name|char
modifier|*
name|x25_local_dte
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_local_pid
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|x25_intl_zero_str
init|=
literal|"off"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|x25_intl_zero
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|x25_strip_dnic_str
init|=
literal|"off"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|x25_strip_dnic
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_dnic_prefix
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0 = don't request/allow reverse charging 		 * 1 = reverse charge request/allowed 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|reverse_charge_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|reverse_charge
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0= default recv packet size. 		 * 16, 32, 64, 128, 		 * 256, 512, 1024 		 * ( octets in decimal ) 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|recvpktsize_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_short
name|recvpktsize
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* same as above, but for send packet size */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sendpktsize_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_short
name|sendpktsize
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0= default recv window size. 		 * 7, 127 ( in decimal ) 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|recvwndsize_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|recvwndsize
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* same as above, but for send window size */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sendwndsize_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|sendwndsize
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0= default recv throughtput. 		 * 3= 75    8= 2400 		 * 4= 150   9= 4800 		 * 5= 300  10= 9600 		 * 6= 600  11= 19200 		 * 7= 1200 12= 48000 		 * ( bps in decimal ) 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|recvthruput_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|recvthruput
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* same as above, but for send throughput */
end_comment

begin_comment
comment|/* 1 = use closed user group in cug_index */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sendthruput_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|sendthruput
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0 = no closed user group. */
end_comment

begin_comment
comment|/* 1 = use closed user group in cug_index */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cug_req_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|cug_req
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* valid when cug_req= 1. 		 * 0x00 ~ 0x99 ( closed user group in BCD) 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cug_index_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|cug_index
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0= don't use fast select 		 * 1= clear is fast select response 		 * 2= clear or call accepted 		 *    is fast select response 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|fast_select_type_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|fast_select_type
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 0= no RPOA transit request 		 * 1= use RPOA transit request in rpoa 		 */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rpoa_req_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
name|rpoa_req
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* valid when rpoa_req= 1 */
end_comment

begin_comment
comment|/* 0x0000 ~ 0x9999 (RPOA transit group in BCD) */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rpoa_default
init|=
literal|"0"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_short
name|rpoa
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|x25debug
init|=
literal|"none"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|LLog
name|_x25_log
init|=
block|{
literal|"x25log"
block|,
literal|"x25"
block|,
name|NULLCP
block|,
name|LLOG_NONE
block|,
name|LLOG_NONE
block|,
operator|-
literal|1
block|,
name|LLOGCLS
operator||
name|LLOGCRT
operator||
name|LLOGZER
block|,
name|NOTOK
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|LLog
modifier|*
name|x25_log
init|=
operator|&
name|_x25_log
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|CAMTEC_CCL
end_ifdef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|x25_outgoing_port_str
init|=
literal|"A"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|x25_outgoing_port
init|=
literal|'A'
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|BRIDGE_X25
end_ifdef

begin_decl_stmt
name|char
modifier|*
name|x25_bridge_host
init|=
literal|"x25bridge"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_bridge_addr
init|=
literal|"000021000018"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_bridge_listen
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_bridge_pid
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|x25_bridge_discrim
init|=
literal|"0000"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|BRIDGE_X25
argument_list|)
operator|||
name|defined
argument_list|(
name|X25
argument_list|)
end_if

begin_decl_stmt
specifier|static
name|char
modifier|*
name|x25_bridge_port_default
init|=
literal|"146"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_short
name|x25_bridge_port
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ses_ab_timer
init|=
literal|"30"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* drain for 30 seconds on ABORTs */
end_comment

begin_decl_stmt
name|int
name|ses_ab_timer
init|=
literal|30
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ses_dn_timer
init|=
literal|"30"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* drain for 30 seconds on DISCONNECTs */
end_comment

begin_decl_stmt
name|int
name|ses_dn_timer
init|=
literal|30
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|_ses_rf_timer
init|=
literal|"30"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* drain for 30 seconds on REFUSEs */
end_comment

begin_decl_stmt
name|int
name|ses_rf_timer
init|=
literal|30
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ns_enabled
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|usens
init|=
literal|"off"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|ns_address
init|=
literal|"undefined"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*
comment|*/
end_comment

begin_struct
specifier|static
struct|struct
name|bind
block|{
name|char
modifier|*
name|b_key
decl_stmt|;
name|char
modifier|*
modifier|*
name|b_value
decl_stmt|;
name|int
name|b_dynamic
decl_stmt|;
block|}
name|binds
index|[]
init|=
block|{
literal|"localname"
block|,
operator|&
name|isodename
block|,
literal|0
block|,
literal|"binpath"
block|,
operator|&
name|isodebinpath
block|,
literal|0
block|,
literal|"sbinpath"
block|,
operator|&
name|isodesbinpath
block|,
literal|0
block|,
literal|"etcpath"
block|,
operator|&
name|isodetcpath
block|,
literal|0
block|,
literal|"logpath"
block|,
operator|&
name|isodelogpath
block|,
literal|0
block|,
literal|"compatlevel"
block|,
operator|&
name|compatdebug
block|,
literal|0
block|,
literal|"compatfile"
block|,
operator|&
name|_compat_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"addrlevel"
block|,
operator|&
name|addrdebug
block|,
literal|0
block|,
literal|"addrfile"
block|,
operator|&
name|_addr_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"tsaplevel"
block|,
operator|&
name|tsapdebug
block|,
literal|0
block|,
literal|"tsapfile"
block|,
operator|&
name|_tsap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"ssaplevel"
block|,
operator|&
name|ssapdebug
block|,
literal|0
block|,
literal|"ssapfile"
block|,
operator|&
name|_ssap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"psaplevel"
block|,
operator|&
name|psapdebug
block|,
literal|0
block|,
literal|"psapfile"
block|,
operator|&
name|_psap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"psap2level"
block|,
operator|&
name|psap2debug
block|,
literal|0
block|,
literal|"psap2file"
block|,
operator|&
name|_psap2_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"acsaplevel"
block|,
operator|&
name|acsapdebug
block|,
literal|0
block|,
literal|"acsapfile"
block|,
operator|&
name|_acsap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"rtsaplevel"
block|,
operator|&
name|rtsapdebug
block|,
literal|0
block|,
literal|"rtsapfile"
block|,
operator|&
name|_rtsap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"rosaplevel"
block|,
operator|&
name|rosapdebug
block|,
literal|0
block|,
literal|"rosapfile"
block|,
operator|&
name|_rosap_log
operator|.
name|ll_file
block|,
literal|0
block|,
literal|"ts_stacks"
block|,
operator|&
name|_ts_stacks
block|,
literal|0
block|,
literal|"ts_interim"
block|,
operator|&
name|_ts_interim
block|,
literal|0
block|,
literal|"ts_communities"
block|,
operator|&
name|_ts_communities
block|,
literal|0
block|,
literal|"default_nsap_community"
block|,
operator|&
name|_ts_comm_nsap_default
block|,
literal|0
block|,
literal|"default_x25_community"
block|,
operator|&
name|_ts_comm_x25_default
block|,
literal|0
block|,
literal|"default_tcp_community"
block|,
operator|&
name|_ts_comm_tcp_default
block|,
literal|0
block|,
literal|"tsb_communities"
block|,
operator|&
name|_tsb_config
block|,
literal|0
block|,
literal|"tsb_default_address"
block|,
operator|&
name|tsb_default_address
block|,
literal|0
block|,
ifdef|#
directive|ifdef
name|X25
literal|"x25_local_dte"
block|,
operator|&
name|x25_local_dte
block|,
literal|0
block|,
literal|"x25_local_pid"
block|,
operator|&
name|x25_local_pid
block|,
literal|0
block|,
literal|"x25_dnic_prefix"
block|,
operator|&
name|x25_dnic_prefix
block|,
literal|0
block|,
literal|"x25_intl_zero"
block|,
operator|&
name|x25_intl_zero_str
block|,
literal|0
block|,
literal|"x25_strip_dnic"
block|,
operator|&
name|x25_strip_dnic_str
block|,
literal|0
block|,
literal|"reverse_charge"
block|,
operator|&
name|reverse_charge_default
block|,
literal|0
block|,
literal|"recvpktsize"
block|,
operator|&
name|recvpktsize_default
block|,
literal|0
block|,
literal|"sendpktsize"
block|,
operator|&
name|sendpktsize_default
block|,
literal|0
block|,
literal|"recvwndsize"
block|,
operator|&
name|recvwndsize_default
block|,
literal|0
block|,
literal|"sendwndsize"
block|,
operator|&
name|sendwndsize_default
block|,
literal|0
block|,
literal|"recvthruput"
block|,
operator|&
name|recvthruput_default
block|,
literal|0
block|,
literal|"sendthruput"
block|,
operator|&
name|sendthruput_default
block|,
literal|0
block|,
literal|"cug_req"
block|,
operator|&
name|cug_req_default
block|,
literal|0
block|,
literal|"cug_index"
block|,
operator|&
name|cug_index_default
block|,
literal|0
block|,
literal|"fast_select_type"
block|,
operator|&
name|fast_select_type_default
block|,
literal|0
block|,
literal|"rpoa_req"
block|,
operator|&
name|rpoa_req_default
block|,
literal|0
block|,
literal|"rpoa"
block|,
operator|&
name|rpoa_default
block|,
literal|0
block|,
literal|"x25level"
block|,
operator|&
name|x25debug
block|,
literal|0
block|,
literal|"x25file"
block|,
operator|&
name|_x25_log
operator|.
name|ll_file
block|,
literal|0
block|,
ifdef|#
directive|ifdef
name|CAMTEC_CCL
literal|"x25_outgoing_port"
block|,
operator|&
name|x25_outgoing_port_str
block|,
literal|0
block|,
endif|#
directive|endif
endif|#
directive|endif
ifdef|#
directive|ifdef
name|BRIDGE_X25
literal|"x25_bridge_host"
block|,
operator|&
name|x25_bridge_host
block|,
literal|0
block|,
literal|"x25_bridge_addr"
block|,
operator|&
name|x25_bridge_addr
block|,
literal|0
block|,
literal|"x25_bridge_listen"
block|,
operator|&
name|x25_bridge_listen
block|,
literal|0
block|,
literal|"x25_bridge_pid"
block|,
operator|&
name|x25_bridge_pid
block|,
literal|0
block|,
literal|"x25_bridge_discrim"
block|,
operator|&
name|x25_bridge_discrim
block|,
literal|0
block|,
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|BRIDGE_X25
argument_list|)
operator|||
name|defined
argument_list|(
name|X25
argument_list|)
literal|"x25_bridge_port"
block|,
operator|&
name|x25_bridge_port_default
block|,
literal|0
block|,
endif|#
directive|endif
literal|"ses_abort_timer"
block|,
operator|&
name|_ses_ab_timer
block|,
literal|0
block|,
literal|"ses_disconnect_timer"
block|,
operator|&
name|_ses_dn_timer
block|,
literal|0
block|,
literal|"ses_refuse_timer"
block|,
operator|&
name|_ses_rf_timer
block|,
literal|0
block|,
literal|"ns_enable"
block|,
operator|&
name|usens
block|,
literal|0
block|,
literal|"ns_address"
block|,
operator|&
name|ns_address
block|,
literal|0
block|,
name|NULL
block|}
struct|;
end_struct

begin_function_decl
name|int
name|tailor_read
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|tailor_value
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|char
modifier|*
name|isodesetailor
parameter_list|(
name|file
parameter_list|)
name|char
modifier|*
name|file
decl_stmt|;
block|{
name|char
modifier|*
name|ofile
init|=
name|isotailor
decl_stmt|;
if|if
condition|(
operator|(
name|isotailor
operator|=
name|file
operator|)
operator|==
name|NULLCP
condition|)
name|isotailor
operator|=
literal|"isotailor"
expr_stmt|;
return|return
name|ofile
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|void
name|isodetailor
parameter_list|(
name|myname
parameter_list|,
name|wantuser
parameter_list|)
name|char
modifier|*
name|myname
decl_stmt|;
name|int
name|wantuser
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|hp
decl_stmt|,
modifier|*
name|mp
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
specifier|static
name|int
name|inited
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|inited
condition|)
return|return;
name|inited
operator|=
literal|1
expr_stmt|;
name|tsb_addresses
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|tailor_read
argument_list|(
name|isodefile
argument_list|(
name|isotailor
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wantuser
condition|)
block|{
if|if
condition|(
operator|(
name|hp
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|hp
operator|=
literal|"."
expr_stmt|;
if|if
condition|(
name|myname
condition|)
block|{
if|if
condition|(
name|mp
operator|=
name|rindex
argument_list|(
name|myname
argument_list|,
literal|'/'
argument_list|)
condition|)
name|mp
operator|++
expr_stmt|;
if|if
condition|(
name|mp
operator|==
name|NULL
operator|||
operator|*
name|mp
operator|==
name|NULL
condition|)
name|mp
operator|=
name|myname
expr_stmt|;
block|}
else|else
name|mp
operator|=
literal|"isode"
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%s/.%s_tailor"
argument_list|,
name|hp
argument_list|,
name|mp
argument_list|)
expr_stmt|;
name|tailor_read
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
block|}
name|isodexport
argument_list|(
name|myname
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|tailor_read
parameter_list|(
name|file
parameter_list|)
name|char
modifier|*
name|file
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
specifier|register
name|FILE
modifier|*
name|fp
decl_stmt|;
if|if
condition|(
name|fp
operator|=
name|fopen
argument_list|(
name|file
argument_list|,
literal|"r"
argument_list|)
condition|)
block|{
while|while
condition|(
name|fgets
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
name|buffer
argument_list|,
name|fp
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|cp
operator|=
name|index
argument_list|(
name|buffer
argument_list|,
literal|'\n'
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: line too long\n"
argument_list|,
name|file
argument_list|)
expr_stmt|;
break|break;
block|}
operator|*
name|cp
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
operator|*
name|buffer
operator|==
literal|'#'
operator|||
operator|*
name|buffer
operator|==
name|NULL
condition|)
continue|continue;
if|if
condition|(
operator|(
name|bp
operator|=
name|index
argument_list|(
name|buffer
argument_list|,
literal|':'
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s: invalid syntax in \"%s\"\n"
argument_list|,
name|file
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|cp
operator|=
name|bp
operator|-
literal|1
init|;
name|cp
operator|>=
name|buffer
condition|;
name|cp
operator|--
control|)
if|if
condition|(
name|isspace
argument_list|(
operator|(
name|u_char
operator|)
operator|*
name|cp
argument_list|)
condition|)
operator|*
name|cp
operator|=
name|NULL
expr_stmt|;
else|else
break|break;
operator|*
name|bp
operator|++
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|isspace
argument_list|(
operator|(
name|u_char
operator|)
operator|*
name|bp
argument_list|)
condition|)
operator|*
name|bp
operator|++
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|bp
operator|+
name|strlen
argument_list|(
name|bp
argument_list|)
operator|-
literal|1
init|;
name|cp
operator|>=
name|bp
condition|;
name|cp
operator|--
control|)
if|if
condition|(
name|isspace
argument_list|(
operator|(
name|u_char
operator|)
operator|*
name|cp
argument_list|)
condition|)
operator|*
name|cp
operator|=
name|NULL
expr_stmt|;
else|else
break|break;
if|if
condition|(
operator|(
name|cp
operator|=
name|tailor_value
argument_list|(
name|bp
argument_list|)
operator|)
operator|&&
name|isodesetvar
argument_list|(
name|buffer
argument_list|,
name|cp
argument_list|,
literal|1
argument_list|)
operator|==
name|NOTOK
condition|)
name|free
argument_list|(
name|cp
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|int
name|isodesetvar
parameter_list|(
name|name
parameter_list|,
name|value
parameter_list|,
name|dynamic
parameter_list|)
name|char
modifier|*
name|name
decl_stmt|,
decl|*
name|value
decl_stmt|;
end_function

begin_decl_stmt
name|int
name|dynamic
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|struct
name|bind
modifier|*
name|b
decl_stmt|;
for|for
control|(
name|b
operator|=
name|binds
init|;
name|b
operator|->
name|b_key
condition|;
name|b
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|b
operator|->
name|b_key
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|b
operator|->
name|b_dynamic
operator|&&
operator|*
name|b
operator|->
name|b_value
condition|)
name|free
argument_list|(
operator|*
name|b
operator|->
name|b_value
argument_list|)
expr_stmt|;
operator|*
name|b
operator|->
name|b_value
operator|=
name|value
operator|,
name|b
operator|->
name|b_dynamic
operator|=
name|dynamic
expr_stmt|;
return|return
name|OK
return|;
block|}
return|return
name|NOTOK
return|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_function
name|void
name|isodexport
parameter_list|(
name|myname
parameter_list|)
name|char
modifier|*
name|myname
decl_stmt|;
block|{
name|compat_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|compatdebug
argument_list|,
literal|"compatlevel"
argument_list|)
expr_stmt|;
name|addr_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|addrdebug
argument_list|,
literal|"addrlevel"
argument_list|)
expr_stmt|;
name|tsap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|tsapdebug
argument_list|,
literal|"tsaplevel"
argument_list|)
expr_stmt|;
name|ssap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|ssapdebug
argument_list|,
literal|"ssaplevel"
argument_list|)
expr_stmt|;
name|psap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|psapdebug
argument_list|,
literal|"psaplevel"
argument_list|)
expr_stmt|;
name|psap2_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|psap2debug
argument_list|,
literal|"psap2level"
argument_list|)
expr_stmt|;
name|acsap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|acsapdebug
argument_list|,
literal|"acsaplevel"
argument_list|)
expr_stmt|;
name|rtsap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|rtsapdebug
argument_list|,
literal|"rtsaplevel"
argument_list|)
expr_stmt|;
name|rosap_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|rosapdebug
argument_list|,
literal|"rosaplevel"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|X25
name|x25_log
operator|->
name|ll_events
operator|=
name|events_value
argument_list|(
name|ll_pairs
argument_list|,
name|x25debug
argument_list|,
literal|"x25level"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ll_hdinit
argument_list|(
name|compat_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|addr_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|tsap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|ssap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|psap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|psap2_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|acsap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|rtsap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
name|ll_hdinit
argument_list|(
name|rosap_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|X25
name|ll_hdinit
argument_list|(
name|x25_log
argument_list|,
name|myname
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ts_stacks
operator|=
name|events_value
argument_list|(
name|ts_pairs
argument_list|,
name|_ts_stacks
argument_list|,
literal|"ts_stacks"
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|TCP
name|ts_stacks
operator|&=
operator|~
name|TS_TCP
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|X25
name|ts_stacks
operator|&=
operator|~
name|TS_X25
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|BRIDGE_X25
name|ts_stacks
operator|&=
operator|~
name|TS_BRG
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|TP4
name|ts_stacks
operator|&=
operator|~
name|TS_TP4
expr_stmt|;
endif|#
directive|endif
block|{
specifier|register
name|int
modifier|*
name|ip
decl_stmt|,
modifier|*
name|jp
decl_stmt|,
modifier|*
name|kp
decl_stmt|;
name|int
name|j
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
name|adrp
decl_stmt|,
modifier|*
modifier|*
name|ap
decl_stmt|,
modifier|*
modifier|*
name|cpp
decl_stmt|;
specifier|register
name|struct
name|ts_interim
modifier|*
name|ts
decl_stmt|;
specifier|static
name|struct
name|ts_interim
modifier|*
name|te
init|=
name|NULL
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|,
modifier|*
name|vec
index|[
name|NVEC
operator|+
name|NSLACK
operator|+
literal|1
index|]
decl_stmt|;
if|if
condition|(
name|te
condition|)
name|te
operator|->
name|ts_name
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|macro2comm
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|ts
argument_list|)
operator|==
name|NOTOK
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"internal error for community \"%s\"\n"
argument_list|,
name|ts
operator|->
name|ts_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|te
operator|==
name|NULL
condition|)
name|te
operator|=
name|ts
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|_ts_interim
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|str2vec
argument_list|(
name|buffer
argument_list|,
name|ap
operator|=
name|vec
argument_list|)
expr_stmt|;
name|j
operator|=
name|SUBNET_DYNAMIC
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
name|ap
operator|++
condition|)
block|{
specifier|register
name|struct
name|ts_interim
modifier|*
name|tp
decl_stmt|;
name|ts
operator|->
name|ts_subnet
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|macro2comm
argument_list|(
name|cp
argument_list|,
name|ts
argument_list|)
operator|==
name|NOTOK
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"invalid community name \"%s\"\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|tp
operator|=
name|ts_interim
init|;
name|tp
operator|<
name|ts
condition|;
name|tp
operator|++
control|)
if|if
condition|(
name|tp
operator|->
name|ts_length
operator|==
name|ts
operator|->
name|ts_length
operator|&&
name|bcmp
argument_list|(
name|tp
operator|->
name|ts_prefix
argument_list|,
name|ts
operator|->
name|ts_prefix
argument_list|,
name|tp
operator|->
name|ts_length
argument_list|)
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"duplicate prefixes for communities \"%s\" and \"%s\"\n"
argument_list|,
name|tp
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|tp
operator|<
name|ts
condition|)
continue|continue;
name|ts
operator|->
name|ts_name
operator|=
name|strdup
argument_list|(
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ts
operator|->
name|ts_subnet
operator|==
literal|0
condition|)
name|ts
operator|->
name|ts_subnet
operator|=
name|j
operator|++
expr_stmt|;
name|ts
operator|++
expr_stmt|;
block|}
name|ts
operator|->
name|ts_name
operator|=
name|NULL
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|_ts_communities
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|str2vec
argument_list|(
name|buffer
argument_list|,
name|ap
operator|=
name|vec
argument_list|)
expr_stmt|;
name|ip
operator|=
name|ts_communities
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
name|ap
operator|++
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|cp
argument_list|,
literal|"all"
argument_list|)
operator|==
literal|0
condition|)
block|{
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
block|{
for|for
control|(
name|jp
operator|=
name|ts_communities
init|;
name|jp
operator|<
name|ip
condition|;
name|jp
operator|++
control|)
if|if
condition|(
operator|*
name|jp
operator|==
name|ts
operator|->
name|ts_subnet
condition|)
break|break;
if|if
condition|(
name|jp
operator|>=
name|ip
condition|)
operator|*
name|ip
operator|++
operator|=
name|ts
operator|->
name|ts_subnet
expr_stmt|;
block|}
break|break;
block|}
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|lexequ
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|!
name|ts
operator|->
name|ts_name
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unknown community name \"%s\" for variable ts_communities\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|jp
operator|=
name|ts_communities
init|;
name|jp
operator|<
name|ip
condition|;
name|jp
operator|++
control|)
if|if
condition|(
operator|*
name|jp
operator|==
name|ts
operator|->
name|ts_subnet
condition|)
break|break;
if|if
condition|(
name|jp
operator|>=
name|ip
condition|)
operator|*
name|ip
operator|++
operator|=
name|ts
operator|->
name|ts_subnet
expr_stmt|;
block|}
operator|*
name|ip
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|ap
operator|=
name|tsb_addresses
init|;
operator|*
name|ap
condition|;
name|ap
operator|++
control|)
name|free
argument_list|(
operator|*
name|ap
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|_tsb_config
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|str2vec
argument_list|(
name|buffer
argument_list|,
name|ap
operator|=
name|vec
argument_list|)
expr_stmt|;
name|ip
operator|=
name|tsb_communities
operator|,
name|cpp
operator|=
name|tsb_addresses
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
name|ap
operator|++
condition|)
block|{
if|if
condition|(
operator|(
name|adrp
operator|=
operator|*
name|ap
operator|++
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"missing address for tsb_community \"%s\"\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|lexequ
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
operator|!
name|ts
operator|->
name|ts_name
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unknown community name \"%s\" for variable tsb_communities\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|jp
operator|=
name|tsb_communities
init|;
name|jp
operator|<
name|ip
condition|;
name|jp
operator|++
control|)
if|if
condition|(
operator|*
name|jp
operator|==
name|ts
operator|->
name|ts_subnet
condition|)
break|break;
if|if
condition|(
name|jp
operator|>=
name|ip
condition|)
block|{
operator|*
name|ip
operator|++
operator|=
name|ts
operator|->
name|ts_subnet
operator|,
operator|*
name|cpp
operator|++
operator|=
name|strdup
argument_list|(
name|adrp
argument_list|)
expr_stmt|;
for|for
control|(
name|kp
operator|=
name|ts_communities
init|;
operator|*
name|kp
condition|;
name|kp
operator|++
control|)
if|if
condition|(
operator|*
name|kp
operator|==
name|ts
operator|->
name|ts_subnet
condition|)
break|break;
if|if
condition|(
operator|!
operator|*
name|kp
condition|)
operator|*
name|kp
operator|++
operator|=
name|ts
operator|->
name|ts_subnet
operator|,
operator|*
name|kp
operator|=
name|NULL
expr_stmt|;
block|}
block|}
operator|*
name|ip
operator|=
name|NULL
operator|,
operator|*
name|cpp
operator|=
name|NULLCP
expr_stmt|;
name|cp
operator|=
name|_ts_comm_nsap_default
expr_stmt|;
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|lexequ
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|ts
operator|->
name|ts_name
operator|&&
name|ts
operator|->
name|ts_syntax
operator|==
name|NA_NSAP
condition|)
name|ts_comm_nsap_default
operator|=
name|ts
operator|->
name|ts_subnet
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad community name \"%s\" for variable default_nsap_community\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|cp
operator|=
name|_ts_comm_x25_default
expr_stmt|;
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|lexequ
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|ts
operator|->
name|ts_name
operator|&&
name|ts
operator|->
name|ts_syntax
operator|==
name|NA_X25
condition|)
name|ts_comm_x25_default
operator|=
name|ts
operator|->
name|ts_subnet
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad community name \"%s\" for variable default_x25_community\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|cp
operator|=
name|_ts_comm_tcp_default
expr_stmt|;
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
if|if
condition|(
name|lexequ
argument_list|(
name|ts
operator|->
name|ts_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|ts
operator|->
name|ts_name
operator|&&
name|ts
operator|->
name|ts_syntax
operator|==
name|NA_TCP
condition|)
name|ts_comm_tcp_default
operator|=
name|ts
operator|->
name|ts_subnet
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bad community name \"%s\" for variable default_tcp_community\n"
argument_list|,
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr_log
operator|->
name|ll_events
operator|&
name|LLOG_DEBUG
condition|)
block|{
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"ts_stacks: %s"
operator|,
name|sprintb
argument_list|(
name|ts_stacks
argument_list|,
name|TS_MASK
argument_list|)
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|ts
operator|=
name|ts_interim
init|;
name|ts
operator|->
name|ts_name
condition|;
name|ts
operator|++
control|)
block|{
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"community %s value \"%s\" subnet %d syntax %d"
operator|,
name|ts
operator|->
name|ts_name
operator|,
name|ts
operator|->
name|ts_value
condition|?
name|ts
operator|->
name|ts_value
else|:
literal|""
operator|,
name|ts
operator|->
name|ts_subnet
operator|,
name|ts
operator|->
name|ts_syntax
operator|)
argument_list|)
expr_stmt|;
name|buffer
index|[
name|explode
argument_list|(
name|buffer
argument_list|,
operator|(
name|u_char
operator|*
operator|)
name|ts
operator|->
name|ts_prefix
argument_list|,
name|ts
operator|->
name|ts_length
argument_list|)
index|]
operator|=
name|NULL
expr_stmt|;
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"    prefix \"%s\" (%d octets)"
operator|,
name|buffer
operator|,
name|ts
operator|->
name|ts_length
operator|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|ip
operator|=
name|ts_communities
init|;
operator|*
name|ip
condition|;
name|ip
operator|++
control|)
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"community %d enabled"
operator|,
operator|*
name|ip
operator|)
argument_list|)
expr_stmt|;
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"default communities: nsap=%d x25=%d tcp=%d"
operator|,
name|ts_comm_nsap_default
operator|,
name|ts_comm_x25_default
operator|,
name|ts_comm_tcp_default
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|ip
operator|=
name|tsb_communities
operator|,
name|cpp
operator|=
name|tsb_addresses
init|;
operator|*
name|ip
condition|;
name|ip
operator|++
operator|,
name|cpp
operator|++
control|)
block|{
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_DEBUG
argument_list|,
operator|(
literal|"TSB for community %d residing at %s"
operator|,
operator|*
name|ip
operator|,
operator|*
name|cpp
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|str2taddr
argument_list|(
operator|*
name|cpp
argument_list|)
operator|==
name|NULLTA
condition|)
name|LLOG
argument_list|(
name|addr_log
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"invalid address for TSB to community %d: %s"
operator|,
operator|*
name|ip
operator|,
operator|*
name|cpp
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|X25
name|reverse_charge
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|reverse_charge_default
argument_list|)
expr_stmt|;
name|recvpktsize
operator|=
operator|(
name|u_short
operator|)
name|atoi
argument_list|(
name|recvpktsize_default
argument_list|)
expr_stmt|;
name|sendpktsize
operator|=
operator|(
name|u_short
operator|)
name|atoi
argument_list|(
name|sendpktsize_default
argument_list|)
expr_stmt|;
name|recvwndsize
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|recvwndsize_default
argument_list|)
expr_stmt|;
name|sendwndsize
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|sendwndsize_default
argument_list|)
expr_stmt|;
name|recvthruput
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|recvthruput_default
argument_list|)
expr_stmt|;
name|sendthruput
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|sendthruput_default
argument_list|)
expr_stmt|;
name|cug_req
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|cug_req_default
argument_list|)
expr_stmt|;
name|cug_index
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|cug_index_default
argument_list|)
expr_stmt|;
name|fast_select_type
operator|=
operator|(
name|u_char
operator|)
name|atoi
argument_list|(
name|fast_select_type_default
argument_list|)
expr_stmt|;
name|rpoa_req
operator|=
name|atoi
argument_list|(
name|rpoa_req_default
argument_list|)
expr_stmt|;
name|rpoa
operator|=
operator|(
name|u_short
operator|)
name|atoi
argument_list|(
name|rpoa_default
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CAMTEC_CCL
name|x25_outgoing_port
operator|=
operator|*
name|x25_outgoing_port_str
expr_stmt|;
endif|#
directive|endif
name|x25_intl_zero
operator|=
operator|!
name|strcmp
argument_list|(
name|x25_intl_zero_str
argument_list|,
literal|"on"
argument_list|)
expr_stmt|;
name|x25_strip_dnic
operator|=
operator|!
name|strcmp
argument_list|(
name|x25_strip_dnic_str
argument_list|,
literal|"on"
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|BRIDGE_X25
argument_list|)
operator|||
name|defined
argument_list|(
name|X25
argument_list|)
name|x25_bridge_port
operator|=
name|htons
argument_list|(
operator|(
name|u_short
operator|)
name|atoi
argument_list|(
name|x25_bridge_port_default
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ns_enabled
operator|=
operator|!
name|strcmp
argument_list|(
name|usens
argument_list|,
literal|"on"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_define
define|#
directive|define
name|QUOTE
value|'\\'
end_define

begin_function
specifier|static
name|char
modifier|*
name|tailor_value
parameter_list|(
name|s
parameter_list|)
specifier|register
name|char
modifier|*
name|s
decl_stmt|;
block|{
specifier|register
name|int
name|i
decl_stmt|,
name|r
decl_stmt|;
specifier|register
name|char
modifier|*
name|bp
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|;
for|for
control|(
name|bp
operator|=
name|buffer
init|;
operator|*
name|s
condition|;
name|bp
operator|++
operator|,
name|s
operator|++
control|)
if|if
condition|(
operator|*
name|s
operator|!=
name|QUOTE
condition|)
operator|*
name|bp
operator|=
operator|*
name|s
expr_stmt|;
else|else
switch|switch
condition|(
operator|*
operator|++
name|s
condition|)
block|{
case|case
literal|'0'
case|:
operator|*
name|bp
operator|=
literal|'\0'
expr_stmt|;
break|break;
case|case
literal|'b'
case|:
operator|*
name|bp
operator|=
literal|'\b'
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
operator|*
name|bp
operator|=
literal|'\f'
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
operator|*
name|bp
operator|=
literal|'\n'
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
operator|*
name|bp
operator|=
literal|'\r'
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
operator|*
name|bp
operator|=
literal|'\t'
expr_stmt|;
break|break;
case|case
name|NULL
case|:
name|s
operator|--
expr_stmt|;
case|case
name|QUOTE
case|:
operator|*
name|bp
operator|=
name|QUOTE
expr_stmt|;
break|break;
default|default:
if|if
condition|(
operator|!
name|isdigit
argument_list|(
operator|(
name|u_char
operator|)
operator|*
name|s
argument_list|)
condition|)
block|{
operator|*
name|bp
operator|++
operator|=
name|QUOTE
expr_stmt|;
operator|*
name|bp
operator|=
operator|*
name|s
expr_stmt|;
break|break;
block|}
name|r
operator|=
operator|*
name|s
operator|!=
literal|'0'
condition|?
literal|10
else|:
literal|8
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|isdigit
argument_list|(
operator|(
name|u_char
operator|)
operator|*
name|s
argument_list|)
condition|;
name|s
operator|++
control|)
name|i
operator|=
name|i
operator|*
name|r
operator|+
operator|*
name|s
operator|-
literal|'0'
expr_stmt|;
name|s
operator|--
expr_stmt|;
operator|*
name|bp
operator|=
name|toascii
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
block|}
operator|*
name|bp
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
operator|(
name|bp
operator|=
name|malloc
argument_list|(
call|(
name|unsigned
call|)
argument_list|(
name|strlen
argument_list|(
name|buffer
argument_list|)
operator|+
literal|1
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|bp
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
return|return
name|bp
return|;
block|}
end_function

begin_comment
comment|/*
comment|*/
end_comment

begin_function
specifier|static
name|int
name|events_value
parameter_list|(
name|pairs
parameter_list|,
name|s
parameter_list|,
name|var
parameter_list|)
name|struct
name|pair
modifier|*
name|pairs
decl_stmt|;
name|char
modifier|*
name|s
decl_stmt|,
decl|*
name|var
decl_stmt|;
end_function

begin_block
block|{
name|int
name|value
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
decl_stmt|,
modifier|*
modifier|*
name|ap
decl_stmt|;
specifier|register
name|struct
name|pair
modifier|*
name|pp
decl_stmt|;
name|char
name|buffer
index|[
name|BUFSIZ
index|]
decl_stmt|,
modifier|*
name|vec
index|[
name|NVEC
operator|+
name|NSLACK
operator|+
literal|1
index|]
decl_stmt|;
name|value
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|buffer
argument_list|,
name|s
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|str2vec
argument_list|(
name|buffer
argument_list|,
name|ap
operator|=
name|vec
argument_list|)
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
name|ap
operator|++
condition|)
block|{
for|for
control|(
name|pp
operator|=
name|pairs
init|;
name|pp
operator|->
name|p_name
condition|;
name|pp
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|pp
operator|->
name|p_name
argument_list|,
name|cp
argument_list|)
operator|==
literal|0
condition|)
block|{
name|value
operator||=
name|pp
operator|->
name|p_value
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|pp
operator|->
name|p_name
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"unknown value \"%s\" for variable %s\n"
argument_list|,
name|cp
argument_list|,
name|var
argument_list|)
expr_stmt|;
block|}
return|return
name|value
return|;
block|}
end_block

begin_comment
comment|/*
comment|*/
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|PEP_TEST
end_ifdef

begin_macro
name|tailorfree
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|struct
name|bind
modifier|*
name|b
decl_stmt|;
for|for
control|(
name|b
operator|=
name|binds
init|;
name|b
operator|->
name|b_key
condition|;
name|b
operator|++
control|)
if|if
condition|(
name|b
operator|->
name|b_dynamic
operator|&&
operator|*
name|b
operator|->
name|b_value
condition|)
block|{
name|free
argument_list|(
operator|*
name|b
operator|->
name|b_value
argument_list|)
expr_stmt|;
operator|*
name|b
operator|->
name|b_value
operator|=
name|NULL
expr_stmt|;
block|}
name|ll_hdfree
argument_list|(
name|compat_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|addr_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|tsap_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|ssap_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|psap_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|psap2_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|acsap_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|rtsap_log
argument_list|)
expr_stmt|;
name|ll_hdfree
argument_list|(
name|rosap_log
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|X25
name|ll_hdfree
argument_list|(
name|x25_log
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|free_macros
argument_list|()
expr_stmt|;
name|free_bp
argument_list|()
expr_stmt|;
name|free_oid
argument_list|()
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|ll_hdfree
argument_list|(
name|lp
argument_list|)
specifier|register
name|LLog
operator|*
name|lp
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|lp
operator|->
name|ll_stat
operator|&
name|LLOGHDR
condition|)
name|free
argument_list|(
name|lp
operator|->
name|ll_hdr
argument_list|)
expr_stmt|;
name|lp
operator|->
name|ll_stat
operator|&=
operator|~
name|LLOGHDR
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

end_unit

