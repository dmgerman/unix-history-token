begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* nrs_info.c - nRSInformation attribute */
end_comment

begin_comment
comment|/*  *				  NOTICE  *  *    Acquisition, use, and distribution of this module and related  *    materials are subject to the restrictions of a license agreement.  *    Consult the Preface in the User's Manual for the full terms of  *    this agreement.  *  */
end_comment

begin_comment
comment|/* 	SYNTAX 	nrs_info ::=<context> "$"<addr_sp_id> "$"<routes> 	context ::=<integer> |<context_str> 	context_str ::= "x29" | "ts29" | "niftp" | "mail-niftp" | "mail-telex" 		| "jtmp" | "jtmp-files" | "jtmp-reg" | "ybts-node" | "ybts" 		| "ftam" | "jtm" | "jtm-reg" | "vt" | "motis" 	addr_sp_id ::=<integer> |<addr_sp_id_str> 	addr_sp_id_str ::= "pss" | "janet" | "telex" | "osi-cons" 	routes ::=<route> "|"<routes> | empty 	route ::=<cost> "#"<addressing_info> 	cost ::=<asn> | empty	-- empty implies cost is ASN.1 NULL 	addressing_info ::= 		  "dte_only" ":"<dte_number> 		| "dte_applic_info" ":"<dte_number> "#"<applic_info> 		| "dte_cudf" ":"<dte_number> "#"<cudf> 		| "dte_cudf_applic_info" ":"<dte_number> "#"<cudf> "#"<applic_info> 		| "dte_ybts" ":"<dte_number> "#"<ybts_string> 		| "dte_ybts_applic_info" ":"<dte_number> "#"<ybts_string> "#"<applic_info> 		| "dte_ybts_applic_relay" ":"<dte_number> "#"<ybts_string> "#"<applic_relay> 		| "none_needed" ":" 		| "osi_addressing" ":"<nsap> "#"<tsel> "#"<ssel> "#"<psel> "#"<place_holder> "#"<application_title> "#"<per_app_context_info> 		| "osi_nsap_only" ":"<nsap> 		| "osi_nsap_applic_info" ":"<nsap> "#"<applic_info> 		| "osi_nsap_applic_relay" ":"<nsap> "#"<applic_relay> 		| "dte_ybts_osi_addressing" ":"<dte_number> "#"<ybts_string> 			"#"<tsel> "#"<ssel> "#"<psel> "#"<place_holder> 			"#"<application_title> "#"<per_app_context_info>  	dte_number ::=<numeric_string> 	cudf ::=<octet_string> 	ybts ::=<visible_string> 	nsap ::=<numeric_string> 	tselector ::=<octet_string> 	sselector ::=<octet_string> 	pselector ::=<octet_string> 	place_holder ::=<asn> 	application_title ::=<asn> 	per_app_context_info ::=<asn> 	applic_info ::=<vis_str_seq> 	applic_relay ::=<vis_str_seq> 	vis_str_seq ::=<visible_string> |<str_seq> "$"<visible_string> 	 	EXAMPLES */
end_comment

begin_comment
comment|/* LINTLIBRARY */
end_comment

begin_include
include|#
directive|include
file|"quipu/util.h"
end_include

begin_include
include|#
directive|include
file|"quipu/attr.h"
end_include

begin_comment
comment|/* Def.s for READOUT etc */
end_comment

begin_include
include|#
directive|include
file|"quipu/nrs_info.h"
end_include

begin_decl_stmt
specifier|extern
name|LLog
modifier|*
name|log_dsap
decl_stmt|;
end_decl_stmt

begin_function_decl
name|PE
name|asn2pe
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|PE
name|asnstr2pe
parameter_list|(
name|orig
parameter_list|)
name|char
modifier|*
name|orig
decl_stmt|;
block|{
name|PE
name|result
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
if|if
condition|(
name|orig
operator|==
name|NULLCP
condition|)
return|return
operator|(
name|NULLPE
operator|)
return|;
name|str
operator|=
name|SkipSpace
argument_list|(
name|orig
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|str
operator|)
operator|==
literal|'\0'
condition|)
return|return
operator|(
name|NULLPE
operator|)
return|;
if|if
condition|(
name|strncmp
argument_list|(
name|str
argument_list|,
literal|"{ASN}"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|=
name|asn2pe
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|(
name|orig
operator|+
literal|5
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|parse_error
argument_list|(
literal|"Malformed ASN string '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|result
operator|=
name|NULLPE
expr_stmt|;
block|}
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|str_seq_free
argument_list|(
argument|arg
argument_list|)
expr|struct
name|str_seq
operator|*
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|)
return|return;
if|if
condition|(
name|arg
operator|->
name|ss_str
condition|)
name|free
argument_list|(
name|arg
operator|->
name|ss_str
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|ss_next
condition|)
name|str_seq_free
argument_list|(
name|arg
operator|->
name|ss_next
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|struct
name|str_seq
modifier|*
name|str_seq_cpy
parameter_list|(
name|arg
parameter_list|)
name|struct
name|str_seq
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|str_seq
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
operator|)
return|;
name|ret
operator|=
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|str_seq
argument_list|)
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ss_str
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|ss_str
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ss_next
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|ss_next
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|str_seq_cmp
argument_list|(
argument|arg1
argument_list|,
argument|arg2
argument_list|)
expr|struct
name|str_seq
operator|*
name|arg1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|str_seq
modifier|*
name|arg2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|arg1
operator|==
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|)
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|ss_str
argument_list|,
name|arg2
operator|->
name|ss_str
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
return|return
operator|(
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|ss_next
argument_list|,
name|arg2
operator|->
name|ss_next
argument_list|)
operator|)
return|;
block|}
end_block

begin_expr_stmt
specifier|static
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|strseq
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|str_seq
modifier|*
name|strseq
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|str_seq
modifier|*
name|ss
decl_stmt|;
for|for
control|(
name|ss
operator|=
name|strseq
init|;
name|ss
operator|!=
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
condition|;
name|ss
operator|=
name|ss
operator|->
name|ss_next
control|)
block|{
if|if
condition|(
name|ss
operator|!=
name|strseq
condition|)
if|if
condition|(
name|format
operator|==
name|READOUT
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"//"
argument_list|)
expr_stmt|;
else|else
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"$"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|ss
operator|->
name|ss_str
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
specifier|static
name|struct
name|str_seq
modifier|*
name|str2str_seq
parameter_list|(
name|orig
parameter_list|)
name|char
modifier|*
name|orig
decl_stmt|;
block|{
name|struct
name|str_seq
modifier|*
name|result
decl_stmt|;
name|struct
name|str_seq
modifier|*
modifier|*
name|ss
decl_stmt|;
name|char
modifier|*
name|ptr_prev
decl_stmt|;
name|char
modifier|*
name|ptr_next
decl_stmt|;
if|if
condition|(
operator|(
operator|(
name|ptr_prev
operator|=
name|orig
operator|)
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|ptr_prev
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
return|return
operator|(
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|ss
operator|=
operator|&
operator|(
name|result
operator|)
expr_stmt|;
while|while
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'$'
argument_list|)
operator|)
operator|!=
name|NULLCP
condition|)
block|{
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
operator|(
operator|*
name|ss
operator|)
operator|=
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|str_seq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|ss
operator|)
operator|->
name|ss_str
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ss
operator|=
operator|&
operator|(
operator|(
operator|*
name|ss
operator|)
operator|->
name|ss_next
operator|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
block|}
operator|(
operator|*
name|ss
operator|)
operator|=
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|str_seq
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|ss
operator|)
operator|->
name|ss_str
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
operator|(
operator|*
name|ss
operator|)
operator|->
name|ss_next
operator|=
operator|(
expr|struct
name|str_seq
operator|*
operator|)
name|NULL
expr_stmt|;
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|addr_info_free
argument_list|(
argument|arg
argument_list|)
expr|struct
name|addr_info
operator|*
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
condition|)
return|return;
if|if
condition|(
name|arg
operator|->
name|dte_number
condition|)
name|free
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|cudf
condition|)
name|free
argument_list|(
name|arg
operator|->
name|cudf
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|ybts_string
condition|)
name|free
argument_list|(
name|arg
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|nsap
condition|)
name|free
argument_list|(
name|arg
operator|->
name|nsap
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|tselector
condition|)
name|free
argument_list|(
name|arg
operator|->
name|tselector
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|sselector
condition|)
name|free
argument_list|(
name|arg
operator|->
name|sselector
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|pselector
condition|)
name|free
argument_list|(
name|arg
operator|->
name|pselector
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|place_holder
condition|)
name|pe_free
argument_list|(
name|arg
operator|->
name|place_holder
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|application_title
condition|)
name|pe_free
argument_list|(
name|arg
operator|->
name|application_title
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|per_app_context_info
condition|)
name|pe_free
argument_list|(
name|arg
operator|->
name|per_app_context_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|applic_info
condition|)
name|str_seq_free
argument_list|(
name|arg
operator|->
name|applic_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|applic_relay
condition|)
name|str_seq_free
argument_list|(
name|arg
operator|->
name|applic_relay
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|struct
name|addr_info
modifier|*
name|addr_info_cpy
parameter_list|(
name|arg
parameter_list|)
name|struct
name|addr_info
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|addr_info
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
name|ret
operator|=
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|addr_info
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ret
operator|->
name|addr_info_type
operator|=
name|arg
operator|->
name|addr_info_type
condition|)
block|{
case|case
name|ADDR_INFO_DTE_ONLY
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_APPLIC_INFO
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_info
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_info
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|cudf
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|cudf
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF_APPLIC_INFO
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|cudf
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|cudf
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_info
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_info
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_INFO
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_info
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_info
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_RELAY
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_relay
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_relay
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_NONE_NEEDED
case|:
break|break;
case|case
name|ADDR_INFO_OSI_ADDRESSING
case|:
name|ret
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ret
operator|->
name|tselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|tselector
argument_list|)
expr_stmt|;
name|ret
operator|->
name|sselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|sselector
argument_list|)
expr_stmt|;
name|ret
operator|->
name|pselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|pselector
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|place_holder
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|place_holder
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|place_holder
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|place_holder
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|application_title
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|application_title
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|application_title
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|application_title
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|per_app_context_info
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|per_app_context_info
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|per_app_context_info
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|per_app_context_info
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_ONLY
case|:
name|ret
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|nsap
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_INFO
case|:
name|ret
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_info
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_info
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_RELAY
case|:
name|ret
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ret
operator|->
name|applic_relay
operator|=
name|str_seq_cpy
argument_list|(
name|arg
operator|->
name|applic_relay
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_OSI_ADDRESSING
case|:
name|ret
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ret
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ret
operator|->
name|tselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|tselector
argument_list|)
expr_stmt|;
name|ret
operator|->
name|sselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|sselector
argument_list|)
expr_stmt|;
name|ret
operator|->
name|pselector
operator|=
name|strdup
argument_list|(
name|arg
operator|->
name|pselector
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|place_holder
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|place_holder
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|place_holder
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|place_holder
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|application_title
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|application_title
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|application_title
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|application_title
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|per_app_context_info
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|per_app_context_info
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|per_app_context_info
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|per_app_context_info
argument_list|)
expr_stmt|;
break|break;
default|default:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"addr_info_cpy(): Unknown addressing info type %d"
operator|,
name|arg
operator|->
name|addr_info_type
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|addr_info_cmp
argument_list|(
argument|arg1
argument_list|,
argument|arg2
argument_list|)
expr|struct
name|addr_info
operator|*
name|arg1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|addr_info
modifier|*
name|arg2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|arg1
operator|==
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
condition|)
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|addr_info_type
operator|<
name|arg2
operator|->
name|addr_info_type
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|addr_info_type
operator|>
name|arg2
operator|->
name|addr_info_type
condition|)
return|return
operator|(
literal|1
operator|)
return|;
switch|switch
condition|(
name|arg1
operator|->
name|addr_info_type
condition|)
block|{
case|case
name|ADDR_INFO_DTE_ONLY
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_APPLIC_INFO
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_info
argument_list|,
name|arg2
operator|->
name|applic_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|cudf
argument_list|,
name|arg2
operator|->
name|cudf
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF_APPLIC_INFO
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|cudf
argument_list|,
name|arg2
operator|->
name|cudf
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_info
argument_list|,
name|arg2
operator|->
name|applic_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|ybts_string
argument_list|,
name|arg2
operator|->
name|ybts_string
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_INFO
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|ybts_string
argument_list|,
name|arg2
operator|->
name|ybts_string
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_info
argument_list|,
name|arg2
operator|->
name|applic_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_RELAY
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|ybts_string
argument_list|,
name|arg2
operator|->
name|ybts_string
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_relay
argument_list|,
name|arg2
operator|->
name|applic_relay
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_NONE_NEEDED
case|:
break|break;
case|case
name|ADDR_INFO_OSI_ADDRESSING
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|nsap
argument_list|,
name|arg2
operator|->
name|nsap
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|tselector
argument_list|,
name|arg2
operator|->
name|tselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|sselector
argument_list|,
name|arg2
operator|->
name|sselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|pselector
argument_list|,
name|arg2
operator|->
name|pselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|place_holder
argument_list|,
name|arg2
operator|->
name|place_holder
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|application_title
argument_list|,
name|arg2
operator|->
name|application_title
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|per_app_context_info
argument_list|,
name|arg2
operator|->
name|per_app_context_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_ONLY
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|nsap
argument_list|,
name|arg2
operator|->
name|nsap
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_INFO
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|nsap
argument_list|,
name|arg2
operator|->
name|nsap
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_info
argument_list|,
name|arg2
operator|->
name|applic_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_RELAY
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|nsap
argument_list|,
name|arg2
operator|->
name|nsap
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|str_seq_cmp
argument_list|(
name|arg1
operator|->
name|applic_relay
argument_list|,
name|arg2
operator|->
name|applic_relay
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_OSI_ADDRESSING
case|:
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|dte_number
argument_list|,
name|arg2
operator|->
name|dte_number
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|ybts_string
argument_list|,
name|arg2
operator|->
name|ybts_string
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|tselector
argument_list|,
name|arg2
operator|->
name|tselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|sselector
argument_list|,
name|arg2
operator|->
name|sselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|lexequ
argument_list|(
name|arg1
operator|->
name|pselector
argument_list|,
name|arg2
operator|->
name|pselector
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|place_holder
argument_list|,
name|arg2
operator|->
name|place_holder
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|application_title
argument_list|,
name|arg2
operator|->
name|application_title
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|quipu_pe_cmp
argument_list|(
name|arg1
operator|->
name|per_app_context_info
argument_list|,
name|arg2
operator|->
name|per_app_context_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
break|break;
default|default:
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"addr_info_cmp(): Unknown addressing info type %d"
operator|,
name|arg1
operator|->
name|addr_info_type
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_expr_stmt
specifier|static
name|addr_info_print
argument_list|(
name|ps
argument_list|,
name|info
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|addr_info
modifier|*
name|info
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|info
operator|->
name|addr_info_type
condition|)
block|{
case|case
name|ADDR_INFO_DTE_ONLY
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_only"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_APPLIC_INFO
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_applic_info"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_cudf"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|cudf
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_CUDF_APPLIC_INFO
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_cudf_applic_info"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|cudf
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_ybts"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_INFO
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_ybts_applic_info"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_APPLIC_RELAY
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_ybts_applic_relay"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_relay
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_NONE_NEEDED
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"none_needed"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_ADDRESSING
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"osi_addressing"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|tselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|tselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|sselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|sselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|pselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|pselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|place_holder
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|place_holder
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|application_title
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|application_title
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|per_app_context_info
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|per_app_context_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_ONLY
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"osi_nsap_only"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|nsap
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_INFO
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"osi_nsap_applic_info"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_OSI_NSAP_APPLIC_RELAY
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"osi_nsap_applic_relay"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|nsap
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|str_seq_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|applic_relay
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
case|case
name|ADDR_INFO_DTE_YBTS_OSI_ADDRESSING
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"dte_ybts_osi_addressing"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|dte_number
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|ybts_string
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|tselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|tselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|sselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|sselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|pselector
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
name|info
operator|->
name|pselector
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|place_holder
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|place_holder
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|application_title
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|application_title
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|per_app_context_info
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|info
operator|->
name|per_app_context_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%s"
argument_list|,
literal|"addr_info print error"
argument_list|)
expr_stmt|;
name|LLOG
argument_list|(
name|log_dsap
argument_list|,
name|LLOG_EXCEPTIONS
argument_list|,
operator|(
literal|"addr_info_print(): Unknown addressing info type %d"
operator|,
name|info
operator|->
name|addr_info_type
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_function
specifier|static
name|struct
name|addr_info
modifier|*
name|str2addr_info
parameter_list|(
name|orig
parameter_list|)
name|char
modifier|*
name|orig
decl_stmt|;
block|{
name|struct
name|addr_info
modifier|*
name|result
decl_stmt|;
name|char
modifier|*
name|copy
decl_stmt|;
name|char
modifier|*
name|ptr_prev
decl_stmt|;
name|char
modifier|*
name|ptr_next
decl_stmt|;
name|char
modifier|*
name|eraser
decl_stmt|;
name|result
operator|=
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|addr_info
argument_list|)
argument_list|)
expr_stmt|;
name|copy
operator|=
name|strdup
argument_list|(
name|orig
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|copy
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|':'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"first separator(:) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
comment|/* Eliminate trailing spaces so that strcmp succeeds */
name|eraser
operator|=
name|ptr_next
expr_stmt|;
for|for
control|(
name|eraser
operator|--
init|;
operator|(
operator|*
name|eraser
operator|)
operator|==
literal|' '
condition|;
name|eraser
operator|--
control|)
block|{
operator|(
operator|*
name|eraser
operator|)
operator|=
literal|'\0'
expr_stmt|;
block|}
name|ptr_next
operator|++
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_only"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_ONLY
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_applic_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_APPLIC_INFO
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_info
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_cudf"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_CUDF
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|cudf
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_cudf_applic_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_CUDF_APPLIC_INFO
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"third separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|cudf
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_info
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_ybts"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_YBTS
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_ybts_applic_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_YBTS_APPLIC_INFO
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"third separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_info
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_ybts_applic_relay"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_YBTS_APPLIC_RELAY
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"third separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_relay
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"none_needed"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_NONE_NEEDED
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"osi_addressing"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_OSI_ADDRESSING
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"third separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|tselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"fourth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|sselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"fifth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|pselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"sixth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|place_holder
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"seventh separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|application_title
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
name|result
operator|->
name|per_app_context_info
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"osi_nsap_only"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_OSI_NSAP_ONLY
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"osi_nsap_applic_info"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_OSI_NSAP_APPLIC_INFO
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_info
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"osi_nsap_applic_relay"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_OSI_NSAP_APPLIC_RELAY
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|nsap
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
name|result
operator|->
name|applic_relay
operator|=
name|str2str_seq
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|ptr_prev
argument_list|,
literal|"dte_ybts_osi_addressing"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|->
name|addr_info_type
operator|=
name|ADDR_INFO_DTE_YBTS_OSI_ADDRESSING
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|dte_number
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"third separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|ybts_string
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"fourth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|tselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"fifth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|sselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"sixth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|pselector
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"seventh separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|place_holder
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"eighth separator(#) missing in addr_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
name|result
operator|->
name|application_title
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
name|result
operator|->
name|per_app_context_info
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|parse_error
argument_list|(
literal|"unknown addr_info type: '%s'"
argument_list|,
name|ptr_prev
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|addr_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|nrs_routes_free
argument_list|(
argument|arg
argument_list|)
expr|struct
name|nrs_routes
operator|*
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
return|return;
if|if
condition|(
name|arg
operator|->
name|cost
condition|)
name|pe_free
argument_list|(
name|arg
operator|->
name|cost
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|addr_info
condition|)
name|addr_info_free
argument_list|(
name|arg
operator|->
name|addr_info
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|next
condition|)
name|nrs_routes_free
argument_list|(
name|arg
operator|->
name|next
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|struct
name|nrs_routes
modifier|*
name|nrs_routes_cpy
parameter_list|(
name|arg
parameter_list|)
name|struct
name|nrs_routes
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|nrs_routes
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
name|ret
operator|=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_routes
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|arg
operator|->
name|cost
operator|==
name|NULLPE
condition|)
name|ret
operator|->
name|cost
operator|=
name|NULLPE
expr_stmt|;
else|else
name|ret
operator|->
name|cost
operator|=
name|pe_cpy
argument_list|(
name|arg
operator|->
name|cost
argument_list|)
expr_stmt|;
name|ret
operator|->
name|addr_info
operator|=
name|addr_info_cpy
argument_list|(
name|arg
operator|->
name|addr_info
argument_list|)
expr_stmt|;
name|ret
operator|->
name|next
operator|=
name|nrs_routes_cpy
argument_list|(
name|arg
operator|->
name|next
argument_list|)
expr_stmt|;
return|return
operator|(
name|ret
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|nrs_routes_cmp
argument_list|(
argument|arg1
argument_list|,
argument|arg2
argument_list|)
expr|struct
name|nrs_routes
operator|*
name|arg1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|nrs_routes
modifier|*
name|arg2
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|arg1
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|pe_cmp
argument_list|(
name|arg1
operator|->
name|cost
argument_list|,
name|arg2
operator|->
name|cost
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
if|if
condition|(
operator|(
name|ret
operator|=
name|addr_info_cmp
argument_list|(
name|arg1
operator|->
name|addr_info
argument_list|,
name|arg2
operator|->
name|addr_info
argument_list|)
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|ret
operator|)
return|;
return|return
operator|(
name|nrs_routes_cmp
argument_list|(
name|arg1
operator|->
name|next
argument_list|,
name|arg2
operator|->
name|next
argument_list|)
operator|)
return|;
block|}
end_block

begin_expr_stmt
specifier|static
name|nrs_routes_print
argument_list|(
name|ps
argument_list|,
name|routes
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|nrs_routes
modifier|*
name|routes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|nrs_routes
modifier|*
name|rt
decl_stmt|;
for|for
control|(
name|rt
operator|=
name|routes
init|;
name|rt
operator|!=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|;
name|rt
operator|=
name|rt
operator|->
name|next
control|)
block|{
if|if
condition|(
name|format
operator|==
name|READOUT
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"\n---> "
argument_list|)
expr_stmt|;
if|if
condition|(
name|rt
operator|->
name|cost
condition|)
name|pe_print
argument_list|(
name|ps
argument_list|,
name|rt
operator|->
name|cost
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"#"
argument_list|)
expr_stmt|;
if|if
condition|(
name|rt
operator|->
name|addr_info
condition|)
name|addr_info_print
argument_list|(
name|ps
argument_list|,
name|rt
operator|->
name|addr_info
argument_list|,
name|format
argument_list|)
expr_stmt|;
if|if
condition|(
name|rt
operator|->
name|next
operator|!=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"|"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
specifier|static
name|struct
name|nrs_routes
modifier|*
name|str2nrs_routes
parameter_list|(
name|orig
parameter_list|)
name|char
modifier|*
name|orig
decl_stmt|;
block|{
name|struct
name|nrs_routes
modifier|*
name|result
decl_stmt|;
name|struct
name|nrs_routes
modifier|*
modifier|*
name|rt
decl_stmt|;
name|char
modifier|*
name|copy
decl_stmt|;
name|char
modifier|*
name|ptr_prev
decl_stmt|;
name|char
modifier|*
name|ptr_next
decl_stmt|;
name|char
modifier|*
name|ptr_mid
decl_stmt|;
name|result
operator|=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_routes
argument_list|)
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|orig
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_prev
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|ptr_prev
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|rt
operator|=
operator|&
operator|(
name|result
operator|)
expr_stmt|;
while|while
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'|'
argument_list|)
operator|)
operator|!=
name|NULLCP
condition|)
block|{
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
operator|(
operator|*
name|rt
operator|)
operator|=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_routes
argument_list|)
argument_list|)
expr_stmt|;
name|copy
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_mid
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"separator(#) missing in nrs_route '%s'"
argument_list|,
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_mid
operator|=
literal|'\0'
expr_stmt|;
name|ptr_mid
operator|++
expr_stmt|;
comment|/* 		* route-cost is not optional - use encoding of NULL 		* when this element is absent 		*/
if|if
condition|(
operator|(
operator|*
name|ptr_prev
operator|)
operator|==
literal|'\0'
condition|)
block|{
operator|(
operator|*
name|rt
operator|)
operator|->
name|cost
operator|=
name|pe_alloc
argument_list|(
name|PE_CLASS_UNIV
argument_list|,
name|PE_FORM_PRIM
argument_list|,
name|PE_PRIM_NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
operator|*
name|rt
operator|)
operator|->
name|cost
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
operator|)
operator|==
name|NULLPE
condition|)
block|{
name|parse_error
argument_list|(
literal|"route-cost ASN malformed in nrs_route '%s'"
argument_list|,
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_mid
argument_list|)
expr_stmt|;
operator|(
operator|*
name|rt
operator|)
operator|->
name|addr_info
operator|=
name|str2addr_info
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
name|rt
operator|=
operator|&
operator|(
operator|(
operator|*
name|rt
operator|)
operator|->
name|next
operator|)
expr_stmt|;
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
expr_stmt|;
block|}
operator|(
operator|*
name|rt
operator|)
operator|=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_routes
argument_list|)
argument_list|)
expr_stmt|;
name|copy
operator|=
name|strdup
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_mid
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'#'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"separator(#) missing in nrs_route '%s'"
argument_list|,
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_mid
operator|=
literal|'\0'
expr_stmt|;
name|ptr_mid
operator|++
expr_stmt|;
comment|/* 	* route-cost is not optional - use encoding of NULL 	* when this element is absent 	*/
if|if
condition|(
operator|(
name|ptr_prev
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|ptr_prev
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
operator|(
operator|*
name|rt
operator|)
operator|->
name|cost
operator|=
name|pe_alloc
argument_list|(
name|PE_CLASS_UNIV
argument_list|,
name|PE_FORM_PRIM
argument_list|,
name|PE_PRIM_NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
operator|(
operator|*
name|rt
operator|)
operator|->
name|cost
operator|=
name|asnstr2pe
argument_list|(
name|ptr_prev
argument_list|)
operator|)
operator|==
name|NULLPE
condition|)
block|{
name|parse_error
argument_list|(
literal|"route-cost ASN malformed in nrs_route '%s'"
argument_list|,
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_mid
argument_list|)
expr_stmt|;
operator|(
operator|*
name|rt
operator|)
operator|->
name|addr_info
operator|=
name|str2addr_info
argument_list|(
name|ptr_prev
argument_list|)
expr_stmt|;
operator|(
operator|*
name|rt
operator|)
operator|->
name|next
operator|=
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
expr_stmt|;
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|nrs_info_free
argument_list|(
argument|arg
argument_list|)
expr|struct
name|nrs_info
operator|*
name|arg
expr_stmt|;
end_expr_stmt

begin_block
block|{
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
condition|)
return|return;
if|if
condition|(
name|arg
operator|->
name|routes
condition|)
name|nrs_routes_free
argument_list|(
name|arg
operator|->
name|routes
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
specifier|static
name|struct
name|nrs_info
modifier|*
name|nrs_info_cpy
parameter_list|(
name|arg
parameter_list|)
name|struct
name|nrs_info
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|nrs_info
modifier|*
name|result
decl_stmt|;
if|if
condition|(
name|arg
operator|==
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
name|result
operator|=
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_info
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|->
name|context
operator|=
name|arg
operator|->
name|context
expr_stmt|;
name|result
operator|->
name|addr_sp_id
operator|=
name|arg
operator|->
name|addr_sp_id
expr_stmt|;
name|result
operator|->
name|routes
operator|=
name|nrs_routes_cpy
argument_list|(
name|arg
operator|->
name|routes
argument_list|)
expr_stmt|;
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_expr_stmt
specifier|static
name|nrs_info_cmp
argument_list|(
argument|arg1
argument_list|,
argument|arg2
argument_list|)
expr|struct
name|nrs_info
operator|*
name|arg1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|nrs_info
modifier|*
name|arg2
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|arg1
operator|==
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
condition|)
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg2
operator|==
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|context
operator|<
name|arg2
operator|->
name|context
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|context
operator|>
name|arg2
operator|->
name|context
condition|)
return|return
operator|(
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|addr_sp_id
operator|<
name|arg2
operator|->
name|addr_sp_id
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|arg1
operator|->
name|addr_sp_id
operator|>
name|arg2
operator|->
name|addr_sp_id
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
name|nrs_routes_cmp
argument_list|(
name|arg1
operator|->
name|routes
argument_list|,
name|arg2
operator|->
name|routes
argument_list|)
operator|)
return|;
block|}
end_block

begin_expr_stmt
specifier|static
name|context_print
argument_list|(
name|ps
argument_list|,
name|ctx
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|ctx
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|format
operator|!=
name|READOUT
condition|)
block|{
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%d"
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|ctx
condition|)
block|{
case|case
name|NRS_Context_X29
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"x29"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_TS29
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"ts29"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_NIFTP
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"niftp"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_MAIL_NIFTP
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"mail-niftp"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_MAIL_TELEX
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"mail-telex"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_JTMP
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"jtmp"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_JTMP_FILES
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"jtmp-files"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_JTMP_REG
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"jtmp-reg"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_YBTS_NODE
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"ybts-node"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_YBTS
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"ybts"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_FTAM
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"ftam"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_JTM
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"jtm"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_JTM_REG
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"jtm-reg"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_VT
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"vt"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Context_MOTIS
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"motis"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%d"
argument_list|,
name|ctx
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_expr_stmt
specifier|static
name|addr_sp_id_print
argument_list|(
name|ps
argument_list|,
name|asi
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|asi
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|format
operator|!=
name|READOUT
condition|)
block|{
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%d"
argument_list|,
name|asi
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|asi
condition|)
block|{
case|case
name|NRS_Address_Space_Id_PSS
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"pss"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Address_Space_Id_JANET
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"janet"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Address_Space_Id_TELEX
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"telex"
argument_list|)
expr_stmt|;
break|break;
case|case
name|NRS_Address_Space_Id_OSI_CONS
case|:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"osi-cons"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"%d"
argument_list|,
name|asi
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_expr_stmt
specifier|static
name|nrs_info_print
argument_list|(
name|ps
argument_list|,
name|nrs
argument_list|,
name|format
argument_list|)
specifier|register
name|PS
name|ps
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|struct
name|nrs_info
modifier|*
name|nrs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|format
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|context_print
argument_list|(
name|ps
argument_list|,
name|nrs
operator|->
name|context
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"$"
argument_list|)
expr_stmt|;
name|addr_sp_id_print
argument_list|(
name|ps
argument_list|,
name|nrs
operator|->
name|addr_sp_id
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|ps_printf
argument_list|(
name|ps
argument_list|,
literal|"$"
argument_list|)
expr_stmt|;
if|if
condition|(
name|nrs
operator|->
name|routes
condition|)
name|nrs_routes_print
argument_list|(
name|ps
argument_list|,
name|nrs
operator|->
name|routes
argument_list|,
name|format
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
specifier|static
name|str2context
argument_list|(
argument|orig
argument_list|)
name|char
operator|*
name|orig
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|char
modifier|*
name|cc
decl_stmt|;
name|int
name|its_all_digits
decl_stmt|;
name|str
operator|=
name|SkipSpace
argument_list|(
name|orig
argument_list|)
expr_stmt|;
name|its_all_digits
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|str
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|str
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
name|parse_error
argument_list|(
literal|"no context string"
argument_list|,
name|NULLCP
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
comment|/* Check for numeric-ness and strip trailing spaces */
for|for
control|(
name|cc
operator|=
name|str
init|;
operator|(
operator|*
name|cc
operator|)
operator|!=
literal|'\0'
condition|;
name|cc
operator|++
control|)
block|{
if|if
condition|(
name|isspace
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
block|{
operator|(
operator|*
name|cc
operator|)
operator|=
literal|'\0'
expr_stmt|;
name|cc
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|isdigit
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
block|{
name|its_all_digits
operator|=
literal|0
expr_stmt|;
block|}
block|}
while|while
condition|(
name|isspace
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
name|cc
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|cc
operator|)
operator|!=
literal|'\0'
condition|)
block|{
name|parse_error
argument_list|(
literal|"malformed context string"
argument_list|,
name|NULLCP
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|its_all_digits
condition|)
block|{
return|return
operator|(
name|atoi
argument_list|(
name|str
argument_list|)
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"x29"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_X29
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"ts29"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_TS29
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"niftp"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_NIFTP
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"mail-niftp"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_MAIL_NIFTP
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"mail-telex"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_MAIL_TELEX
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"jtmp"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_JTMP
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"jtmp-files"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_JTMP_FILES
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"jtmp-reg"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_JTMP_REG
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"ybts-node"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_YBTS_NODE
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"ybts"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_YBTS
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"ftam"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_FTAM
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"jtm"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_JTM
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"jtm-reg"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_JTM_REG
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"vt"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_VT
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"motis"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Context_MOTIS
operator|)
return|;
block|}
else|else
block|{
name|parse_error
argument_list|(
literal|"unknown context string '%s'"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
end_block

begin_expr_stmt
specifier|static
name|str2addr_sp_id
argument_list|(
argument|orig
argument_list|)
name|char
operator|*
name|orig
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|char
modifier|*
name|cc
decl_stmt|;
name|int
name|its_all_digits
decl_stmt|;
name|str
operator|=
name|SkipSpace
argument_list|(
name|orig
argument_list|)
expr_stmt|;
name|its_all_digits
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|str
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|str
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
name|parse_error
argument_list|(
literal|"no address space string"
argument_list|,
name|NULLCP
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
comment|/* Check for numeric-ness and strip trailing spaces */
for|for
control|(
name|cc
operator|=
name|str
init|;
operator|(
operator|*
name|cc
operator|)
operator|!=
literal|'\0'
condition|;
name|cc
operator|++
control|)
block|{
if|if
condition|(
name|isspace
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
block|{
operator|(
operator|*
name|cc
operator|)
operator|=
literal|'\0'
expr_stmt|;
name|cc
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|isdigit
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
block|{
name|its_all_digits
operator|=
literal|0
expr_stmt|;
block|}
block|}
while|while
condition|(
name|isspace
argument_list|(
operator|*
name|cc
argument_list|)
condition|)
name|cc
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|cc
operator|)
operator|!=
literal|'\0'
condition|)
block|{
name|parse_error
argument_list|(
literal|"malformed address space string"
argument_list|,
name|NULLCP
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|its_all_digits
condition|)
block|{
return|return
operator|(
name|atoi
argument_list|(
name|str
argument_list|)
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"pss"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Address_Space_Id_PSS
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"janet"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Address_Space_Id_JANET
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"telex"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Address_Space_Id_TELEX
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|str
argument_list|,
literal|"osi-cons"
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|NRS_Address_Space_Id_OSI_CONS
operator|)
return|;
block|}
else|else
block|{
name|parse_error
argument_list|(
literal|"unknown address space string '%s'"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
end_block

begin_function
specifier|static
name|struct
name|nrs_info
modifier|*
name|str2nrs_info
parameter_list|(
name|orig
parameter_list|)
name|char
modifier|*
name|orig
decl_stmt|;
block|{
name|struct
name|nrs_info
modifier|*
name|result
decl_stmt|;
name|char
modifier|*
name|copy
decl_stmt|;
name|char
modifier|*
name|ptr_prev
decl_stmt|;
name|char
modifier|*
name|ptr_next
decl_stmt|;
name|result
operator|=
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|smalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|nrs_info
argument_list|)
argument_list|)
expr_stmt|;
name|copy
operator|=
name|strdup
argument_list|(
name|orig
argument_list|)
expr_stmt|;
name|ptr_prev
operator|=
name|copy
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'$'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"first separator($) missing in nrs_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|result
operator|->
name|context
operator|=
name|str2context
argument_list|(
name|ptr_prev
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
name|parse_error
argument_list|(
literal|"malformed context '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
name|ptr_prev
operator|=
name|ptr_next
expr_stmt|;
if|if
condition|(
operator|(
name|ptr_next
operator|=
name|index
argument_list|(
name|ptr_prev
argument_list|,
literal|'$'
argument_list|)
operator|)
operator|==
name|NULLCP
condition|)
block|{
name|parse_error
argument_list|(
literal|"second separator($) missing in nrs_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
operator|*
name|ptr_next
operator|=
literal|'\0'
expr_stmt|;
name|ptr_next
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|result
operator|->
name|addr_sp_id
operator|=
name|str2addr_sp_id
argument_list|(
name|ptr_prev
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
name|parse_error
argument_list|(
literal|"malformed context '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|(
operator|(
name|ptr_prev
operator|=
name|SkipSpace
argument_list|(
name|ptr_next
argument_list|)
operator|)
operator|==
name|NULLCP
operator|)
operator|||
operator|(
operator|(
operator|*
name|ptr_prev
operator|)
operator|==
literal|'\0'
operator|)
condition|)
block|{
name|result
operator|->
name|routes
operator|=
operator|(
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
operator|)
expr_stmt|;
return|return
operator|(
name|result
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|result
operator|->
name|routes
operator|=
name|str2nrs_routes
argument_list|(
name|ptr_prev
argument_list|)
operator|)
operator|==
operator|(
expr|struct
name|nrs_routes
operator|*
operator|)
name|NULL
condition|)
block|{
name|parse_error
argument_list|(
literal|"unparseable routes in nrs_info '%s'"
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|free
argument_list|(
operator|(
name|char
operator|*
operator|)
name|result
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|PE
name|nrs_info_enc
parameter_list|(
name|nrs
parameter_list|)
name|struct
name|nrs_info
modifier|*
name|nrs
decl_stmt|;
block|{
name|PE
name|ret_pe
decl_stmt|;
if|if
condition|(
name|encode_QuipuNRS_NRSInformation
argument_list|(
operator|&
name|ret_pe
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|NULLCP
argument_list|,
name|nrs
argument_list|)
operator|!=
name|OK
condition|)
return|return
operator|(
name|NULLPE
operator|)
return|;
return|return
operator|(
name|ret_pe
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|nrs_info
modifier|*
name|nrs_info_dec
parameter_list|(
name|pe
parameter_list|)
name|PE
name|pe
decl_stmt|;
block|{
name|struct
name|nrs_info
modifier|*
name|nrs
decl_stmt|;
if|if
condition|(
name|decode_QuipuNRS_NRSInformation
argument_list|(
name|pe
argument_list|,
literal|1
argument_list|,
name|NULLIP
argument_list|,
name|NULLVP
argument_list|,
operator|&
name|nrs
argument_list|)
operator|!=
name|OK
condition|)
block|{
return|return
operator|(
operator|(
expr|struct
name|nrs_info
operator|*
operator|)
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|nrs
operator|)
return|;
block|}
end_function

begin_macro
name|nrs_info_syntax
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|add_attribute_syntax
argument_list|(
literal|"NRSInformation"
argument_list|,
operator|(
name|IFP
operator|)
name|nrs_info_enc
argument_list|,
operator|(
name|IFP
operator|)
name|nrs_info_dec
argument_list|,
operator|(
name|IFP
operator|)
name|str2nrs_info
argument_list|,
name|nrs_info_print
argument_list|,
operator|(
name|IFP
operator|)
name|nrs_info_cpy
argument_list|,
name|nrs_info_cmp
argument_list|,
name|nrs_info_free
argument_list|,
name|NULLCP
argument_list|,
name|NULLIFP
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

