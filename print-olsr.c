begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1998-2007 The TCPDUMP project  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that: (1) source code  * distributions retain the above copyright notice and this paragraph  * in its entirety, and (2) distributions including binary code include  * the above copyright notice and this paragraph in its entirety in  * the documentation or other materials provided with the distribution.  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND  * WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT  * LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE.  *  * Optimized Link State Protocl (OLSR) as per rfc3626  *  * Original code by Hannes Gredler<hannes@juniper.net>  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<tcpdump-stdinc.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"addrtoname.h"
end_include

begin_include
include|#
directive|include
file|"extract.h"
end_include

begin_include
include|#
directive|include
file|"ip.h"
end_include

begin_comment
comment|/*  * RFC 3626 common header  *  *  0                   1                   2                   3  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |         Packet Length         |    Packet Sequence Number     |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Message Type |     Vtime     |         Message Size          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Originator Address                       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Time To Live |   Hop Count   |    Message Sequence Number    |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                                                               |  * :                            MESSAGE                            :  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Message Type |     Vtime     |         Message Size          |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                      Originator Address                       |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |  Time To Live |   Hop Count   |    Message Sequence Number    |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * |                                                               |  * :                            MESSAGE                            :  * |                                                               |  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  * :                                                               :  */
end_comment

begin_struct
struct|struct
name|olsr_common
block|{
name|u_int8_t
name|packet_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|packet_seq
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|OLSR_HELLO_MSG
value|1
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_TC_MSG
value|2
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_MID_MSG
value|3
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_HNA_MSG
value|4
end_define

begin_comment
comment|/* rfc3626 */
end_comment

begin_define
define|#
directive|define
name|OLSR_POWERINFO_MSG
value|128
end_define

begin_define
define|#
directive|define
name|OLSR_NAMESERVICE_MSG
value|130
end_define

begin_define
define|#
directive|define
name|OLSR_HELLO_LQ_MSG
value|201
end_define

begin_comment
comment|/* LQ extensions olsr.org */
end_comment

begin_define
define|#
directive|define
name|OLSR_TC_LQ_MSG
value|202
end_define

begin_comment
comment|/* LQ extensions olsr.org */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tok
name|olsr_msg_values
index|[]
init|=
block|{
block|{
name|OLSR_HELLO_MSG
block|,
literal|"Hello"
block|}
block|,
block|{
name|OLSR_TC_MSG
block|,
literal|"TC"
block|}
block|,
block|{
name|OLSR_MID_MSG
block|,
literal|"MID"
block|}
block|,
block|{
name|OLSR_HNA_MSG
block|,
literal|"HNA"
block|}
block|,
block|{
name|OLSR_POWERINFO_MSG
block|,
literal|"Powerinfo"
block|}
block|,
block|{
name|OLSR_NAMESERVICE_MSG
block|,
literal|"Nameservice"
block|}
block|,
block|{
name|OLSR_HELLO_LQ_MSG
block|,
literal|"Hello-LQ"
block|}
block|,
block|{
name|OLSR_TC_LQ_MSG
block|,
literal|"TC-LQ"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|olsr_msg
block|{
name|u_int8_t
name|msg_type
decl_stmt|;
name|u_int8_t
name|vtime
decl_stmt|;
name|u_int8_t
name|msg_len
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|originator
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|ttl
decl_stmt|;
name|u_int8_t
name|hopcount
decl_stmt|;
name|u_int8_t
name|msg_seq
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hello
block|{
name|u_int8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|htime
decl_stmt|;
name|u_int8_t
name|will
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hello_link
block|{
name|u_int8_t
name|link_code
decl_stmt|;
name|u_int8_t
name|res
decl_stmt|;
name|u_int8_t
name|len
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_tc
block|{
name|u_int8_t
name|ans_seq
index|[
literal|2
index|]
decl_stmt|;
name|u_int8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|olsr_hna
block|{
name|u_int8_t
name|network
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|mask
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|OLSR_EXTRACT_LINK_TYPE
parameter_list|(
name|link_code
parameter_list|)
value|(link_code& 0x3)
end_define

begin_define
define|#
directive|define
name|OLSR_EXTRACT_NEIGHBOR_TYPE
parameter_list|(
name|link_code
parameter_list|)
value|(link_code>> 2)
end_define

begin_decl_stmt
specifier|static
name|struct
name|tok
name|olsr_link_type_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Unspecified"
block|}
block|,
block|{
literal|1
block|,
literal|"Asymmetric"
block|}
block|,
block|{
literal|2
block|,
literal|"Symmetric"
block|}
block|,
block|{
literal|3
block|,
literal|"Lost"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|tok
name|olsr_neighbor_type_values
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"Not-Neighbor"
block|}
block|,
block|{
literal|1
block|,
literal|"Symmetric"
block|}
block|,
block|{
literal|2
block|,
literal|"Symmetric-MPR"
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|olsr_lq_neighbor
block|{
name|u_int8_t
name|neighbor
index|[
literal|4
index|]
decl_stmt|;
name|u_int8_t
name|link_quality
decl_stmt|;
name|u_int8_t
name|neighbor_link_quality
decl_stmt|;
name|u_int8_t
name|res
index|[
literal|2
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  * macro to convert the 8-bit mantissa/exponent to a double float  * taken from olsr.org.  */
end_comment

begin_define
define|#
directive|define
name|VTIME_SCALE_FACTOR
value|0.0625
end_define

begin_define
define|#
directive|define
name|ME_TO_DOUBLE
parameter_list|(
name|me
parameter_list|)
define|\
value|(double)(VTIME_SCALE_FACTOR*(1+(double)(me>>4)/16)*(double)(1<<(me&0x0F)))
end_define

begin_comment
comment|/*  * print a neighbor list with LQ extensions.  */
end_comment

begin_function
specifier|static
name|void
name|olsr_print_lq_neighbor
parameter_list|(
specifier|const
name|u_char
modifier|*
name|msg_data
parameter_list|,
name|u_int
name|hello_len
parameter_list|)
block|{
name|struct
name|olsr_lq_neighbor
modifier|*
name|lq_neighbor
decl_stmt|;
while|while
condition|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor
argument_list|)
condition|)
block|{
name|lq_neighbor
operator|=
operator|(
expr|struct
name|olsr_lq_neighbor
operator|*
operator|)
name|msg_data
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t      neighbor %s, link-quality %.2lf%%"
literal|", neighbor-link-quality %.2lf%%"
argument_list|,
name|ipaddr_string
argument_list|(
name|lq_neighbor
operator|->
name|neighbor
argument_list|)
argument_list|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|link_quality
operator|/
literal|2.55
operator|)
argument_list|,
operator|(
operator|(
name|double
operator|)
name|lq_neighbor
operator|->
name|neighbor_link_quality
operator|/
literal|2.55
operator|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_lq_neighbor
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * print a neighbor list.  */
end_comment

begin_function
specifier|static
name|void
name|olsr_print_neighbor
parameter_list|(
specifier|const
name|u_char
modifier|*
name|msg_data
parameter_list|,
name|u_int
name|hello_len
parameter_list|)
block|{
name|int
name|neighbor
decl_stmt|;
name|printf
argument_list|(
literal|"\n\t      neighbor\n\t\t"
argument_list|)
expr_stmt|;
name|neighbor
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|hello_len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
condition|)
block|{
comment|/* print 4 neighbors per line */
name|printf
argument_list|(
literal|"%s%s"
argument_list|,
name|ipaddr_string
argument_list|(
name|msg_data
argument_list|)
argument_list|,
name|neighbor
operator|%
literal|4
operator|==
literal|0
condition|?
literal|"\n\t\t"
else|:
literal|" "
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|olsr_print
parameter_list|(
specifier|const
name|u_char
modifier|*
name|pptr
parameter_list|,
name|u_int
name|length
parameter_list|)
block|{
union|union
block|{
specifier|const
name|struct
name|olsr_common
modifier|*
name|common
decl_stmt|;
specifier|const
name|struct
name|olsr_msg
modifier|*
name|msg
decl_stmt|;
specifier|const
name|struct
name|olsr_hello
modifier|*
name|hello
decl_stmt|;
specifier|const
name|struct
name|olsr_hello_link
modifier|*
name|hello_link
decl_stmt|;
specifier|const
name|struct
name|olsr_lq_neighbor
modifier|*
name|lq_neighbor
decl_stmt|;
specifier|const
name|struct
name|olsr_tc
modifier|*
name|tc
decl_stmt|;
specifier|const
name|struct
name|olsr_hna
modifier|*
name|hna
decl_stmt|;
block|}
name|ptr
union|;
name|u_int
name|msg_type
decl_stmt|,
name|msg_len
decl_stmt|,
name|msg_tlen
decl_stmt|,
name|hello_len
decl_stmt|,
name|prefix
decl_stmt|;
name|u_int8_t
name|link_type
decl_stmt|,
name|neighbor_type
decl_stmt|;
specifier|const
name|u_char
modifier|*
name|tptr
decl_stmt|,
modifier|*
name|msg_data
decl_stmt|;
name|tptr
operator|=
name|pptr
expr_stmt|;
if|if
condition|(
name|length
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
condition|)
block|{
goto|goto
name|trunc
goto|;
block|}
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
argument_list|)
condition|)
block|{
goto|goto
name|trunc
goto|;
block|}
name|ptr
operator|.
name|common
operator|=
operator|(
expr|struct
name|olsr_common
operator|*
operator|)
name|tptr
expr_stmt|;
name|length
operator|=
name|MIN
argument_list|(
name|length
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|common
operator|->
name|packet_len
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"OLSR, seq 0x%04x, length %u"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|common
operator|->
name|packet_seq
argument_list|)
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|tptr
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_common
argument_list|)
expr_stmt|;
comment|/*      * In non-verbose mode, just print version.      */
if|if
condition|(
name|vflag
operator|<
literal|1
condition|)
block|{
return|return;
block|}
while|while
condition|(
name|tptr
operator|<
operator|(
name|pptr
operator|+
name|length
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|tptr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ptr
operator|.
name|msg
operator|=
operator|(
expr|struct
name|olsr_msg
operator|*
operator|)
name|tptr
expr_stmt|;
name|msg_type
operator|=
name|ptr
operator|.
name|msg
operator|->
name|msg_type
expr_stmt|;
name|msg_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|msg
operator|->
name|msg_len
argument_list|)
expr_stmt|;
comment|/* infinite loop check */
if|if
condition|(
name|msg_type
operator|==
literal|0
operator|||
name|msg_len
operator|==
literal|0
condition|)
block|{
return|return;
block|}
name|printf
argument_list|(
literal|"\n\t%s Message (%u), originator %s, ttl %u, hop %u"
literal|"\n\t  vtime %.3lfs, msg-seq 0x%04x, length %u"
argument_list|,
name|tok2str
argument_list|(
name|olsr_msg_values
argument_list|,
literal|"Unknown"
argument_list|,
name|msg_type
argument_list|)
argument_list|,
name|msg_type
argument_list|,
name|ipaddr_string
argument_list|(
name|ptr
operator|.
name|msg
operator|->
name|originator
argument_list|)
argument_list|,
name|ptr
operator|.
name|msg
operator|->
name|ttl
argument_list|,
name|ptr
operator|.
name|msg
operator|->
name|hopcount
argument_list|,
name|ME_TO_DOUBLE
argument_list|(
name|ptr
operator|.
name|msg
operator|->
name|vtime
argument_list|)
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|msg
operator|->
name|msg_seq
argument_list|)
argument_list|,
name|msg_len
argument_list|)
expr_stmt|;
name|msg_tlen
operator|=
name|msg_len
operator|-
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg
argument_list|)
expr_stmt|;
name|msg_data
operator|=
name|tptr
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_msg
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|msg_type
condition|)
block|{
case|case
name|OLSR_HELLO_MSG
case|:
case|case
name|OLSR_HELLO_LQ_MSG
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ptr
operator|.
name|hello
operator|=
operator|(
expr|struct
name|olsr_hello
operator|*
operator|)
name|msg_data
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  hello-time %.3lfs, MPR willingness %u"
argument_list|,
name|ME_TO_DOUBLE
argument_list|(
name|ptr
operator|.
name|hello
operator|->
name|htime
argument_list|)
argument_list|,
name|ptr
operator|.
name|hello
operator|->
name|will
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
condition|)
block|{
comment|/*                  * link-type.                  */
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ptr
operator|.
name|hello_link
operator|=
operator|(
expr|struct
name|olsr_hello_link
operator|*
operator|)
name|msg_data
expr_stmt|;
name|hello_len
operator|=
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|len
argument_list|)
expr_stmt|;
name|link_type
operator|=
name|OLSR_EXTRACT_LINK_TYPE
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|link_code
argument_list|)
expr_stmt|;
name|neighbor_type
operator|=
name|OLSR_EXTRACT_NEIGHBOR_TYPE
argument_list|(
name|ptr
operator|.
name|hello_link
operator|->
name|link_code
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    link-type %s, neighbor-type %s, len %u"
argument_list|,
name|tok2str
argument_list|(
name|olsr_link_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|link_type
argument_list|)
argument_list|,
name|tok2str
argument_list|(
name|olsr_neighbor_type_values
argument_list|,
literal|"Unknown"
argument_list|,
name|neighbor_type
argument_list|)
argument_list|,
name|hello_len
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
name|hello_len
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hello_link
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg_type
operator|==
name|OLSR_HELLO_MSG
condition|)
block|{
name|olsr_print_neighbor
argument_list|(
name|msg_data
argument_list|,
name|hello_len
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|olsr_print_lq_neighbor
argument_list|(
name|msg_data
argument_list|,
name|hello_len
argument_list|)
expr_stmt|;
block|}
name|msg_data
operator|+=
name|hello_len
expr_stmt|;
name|msg_tlen
operator|-=
name|hello_len
expr_stmt|;
block|}
break|break;
case|case
name|OLSR_TC_MSG
case|:
case|case
name|OLSR_TC_LQ_MSG
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ptr
operator|.
name|tc
operator|=
operator|(
expr|struct
name|olsr_tc
operator|*
operator|)
name|msg_data
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t    advertised neighbor seq 0x%04x"
argument_list|,
name|EXTRACT_16BITS
argument_list|(
name|ptr
operator|.
name|tc
operator|->
name|ans_seq
argument_list|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_tc
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg_type
operator|==
name|OLSR_TC_MSG
condition|)
block|{
name|olsr_print_neighbor
argument_list|(
name|msg_data
argument_list|,
name|msg_tlen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|olsr_print_lq_neighbor
argument_list|(
name|msg_data
argument_list|,
name|msg_tlen
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OLSR_MID_MSG
case|:
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"\n\t  interface address %s"
argument_list|,
name|ipaddr_string
argument_list|(
name|msg_data
argument_list|)
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|in_addr
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|OLSR_HNA_MSG
case|:
name|prefix
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"\n\t  advertised networks\n\t    "
argument_list|)
expr_stmt|;
while|while
condition|(
name|msg_tlen
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|TTEST2
argument_list|(
operator|*
name|msg_data
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna
argument_list|)
argument_list|)
condition|)
goto|goto
name|trunc
goto|;
name|ptr
operator|.
name|hna
operator|=
operator|(
expr|struct
name|olsr_hna
operator|*
operator|)
name|msg_data
expr_stmt|;
comment|/* print 4 prefixes per line */
name|printf
argument_list|(
literal|"%s/%u%s"
argument_list|,
name|ipaddr_string
argument_list|(
name|ptr
operator|.
name|hna
operator|->
name|network
argument_list|)
argument_list|,
name|mask2plen
argument_list|(
name|EXTRACT_32BITS
argument_list|(
name|ptr
operator|.
name|hna
operator|->
name|mask
argument_list|)
argument_list|)
argument_list|,
name|prefix
operator|%
literal|4
operator|==
literal|0
condition|?
literal|"\n\t    "
else|:
literal|" "
argument_list|)
expr_stmt|;
name|msg_data
operator|+=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna
argument_list|)
expr_stmt|;
name|msg_tlen
operator|-=
sizeof|sizeof
argument_list|(
expr|struct
name|olsr_hna
argument_list|)
expr_stmt|;
name|prefix
operator|++
expr_stmt|;
block|}
break|break;
comment|/*              * FIXME those are the defined messages that lack a decoder              * you are welcome to contribute code ;-)              */
case|case
name|OLSR_POWERINFO_MSG
case|:
case|case
name|OLSR_NAMESERVICE_MSG
case|:
default|default:
name|print_unknown_data
argument_list|(
name|msg_data
argument_list|,
literal|"\n\t    "
argument_list|,
name|msg_tlen
argument_list|)
expr_stmt|;
break|break;
block|}
name|tptr
operator|+=
name|msg_len
expr_stmt|;
block|}
return|return;
name|trunc
label|:
name|printf
argument_list|(
literal|"[|olsr]"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * c-style: whitesmith  * c-basic-offset: 4  * End:  */
end_comment

end_unit

