begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * CDDL HEADER START  *  * The contents of this file are subject to the terms of the  * Common Development and Distribution License, Version 1.0 only  * (the "License").  You may not use this file except in compliance  * with the License.  *  * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE  * or http://www.opensolaris.org/os/licensing.  * See the License for the specific language governing permissions  * and limitations under the License.  *  * When distributing Covered Code, include this CDDL HEADER in each  * file and include the License file at usr/src/OPENSOLARIS.LICENSE.  * If applicable, add the following below this CDDL HEADER, with the  * fields enclosed by brackets "[]" replaced with your own identifying  * information: Portions Copyright [yyyy] [name of copyright owner]  *  * CDDL HEADER END  */
end_comment

begin_comment
comment|/*  * Copyright 2005 Sun Microsystems, Inc.  All rights reserved.  * Use is subject to license terms.  */
end_comment

begin_comment
comment|/*  * Copyright (c) 2013 by Delphix. All rights reserved.  * Copyright (c) 2013 Joyent, Inc. All rights reserved.  */
end_comment

begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<dt_impl.h>
end_include

begin_include
include|#
directive|include
file|<dt_ident.h>
end_include

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_log
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u, %%r%u, %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_R2
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_branch
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_LABEL
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_load
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s [%%r%u], %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_store
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u, [%%r%u]"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_str
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_r1rd
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u, %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_cmp
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u, %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_R2
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_tst
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|dt_dis_varname
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
name|uint_t
name|id
parameter_list|,
name|uint_t
name|scope
parameter_list|)
block|{
specifier|const
name|dtrace_difv_t
modifier|*
name|dvp
init|=
name|dp
operator|->
name|dtdo_vartab
decl_stmt|;
name|uint_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dp
operator|->
name|dtdo_varlen
condition|;
name|i
operator|++
operator|,
name|dvp
operator|++
control|)
block|{
if|if
condition|(
name|dvp
operator|->
name|dtdv_id
operator|==
name|id
operator|&&
name|dvp
operator|->
name|dtdv_scope
operator|==
name|scope
condition|)
block|{
if|if
condition|(
name|dvp
operator|->
name|dtdv_name
operator|<
name|dp
operator|->
name|dtdo_strlen
condition|)
return|return
operator|(
name|dp
operator|->
name|dtdo_strtab
operator|+
name|dvp
operator|->
name|dtdv_name
operator|)
return|;
break|break;
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint_t
name|dt_dis_scope
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
switch|switch
condition|(
name|name
index|[
literal|2
index|]
condition|)
block|{
case|case
literal|'l'
case|:
return|return
operator|(
name|DIFV_SCOPE_LOCAL
operator|)
return|;
case|case
literal|'t'
case|:
return|return
operator|(
name|DIFV_SCOPE_THREAD
operator|)
return|;
case|case
literal|'g'
case|:
return|return
operator|(
name|DIFV_SCOPE_GLOBAL
operator|)
return|;
default|default:
return|return
operator|(
operator|-
literal|1u
operator|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_lda
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|var
init|=
name|DIF_INSTR_R1
argument_list|(
name|in
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|vname
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_VAR(%u), %%r%u, %%r%u"
argument_list|,
name|name
argument_list|,
name|var
argument_list|,
name|DIF_INSTR_R2
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|vname
operator|=
name|dt_dis_varname
argument_list|(
name|dp
argument_list|,
name|var
argument_list|,
name|dt_dis_scope
argument_list|(
name|name
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! DT_VAR(%u) = \"%s\""
argument_list|,
name|var
argument_list|,
name|vname
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_ldv
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|var
init|=
name|DIF_INSTR_VAR
argument_list|(
name|in
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|vname
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_VAR(%u), %%r%u"
argument_list|,
name|name
argument_list|,
name|var
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|vname
operator|=
name|dt_dis_varname
argument_list|(
name|dp
argument_list|,
name|var
argument_list|,
name|dt_dis_scope
argument_list|(
name|name
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! DT_VAR(%u) = \"%s\""
argument_list|,
name|var
argument_list|,
name|vname
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_stv
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|var
init|=
name|DIF_INSTR_VAR
argument_list|(
name|in
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|vname
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u, DT_VAR(%u)"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_RS
argument_list|(
name|in
argument_list|)
argument_list|,
name|var
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|vname
operator|=
name|dt_dis_varname
argument_list|(
name|dp
argument_list|,
name|var
argument_list|,
name|dt_dis_scope
argument_list|(
name|name
argument_list|)
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! DT_VAR(%u) = \"%s\""
argument_list|,
name|var
argument_list|,
name|vname
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_setx
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|intptr
init|=
name|DIF_INSTR_INTEGER
argument_list|(
name|in
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_INTEGER[%u], %%r%u"
argument_list|,
name|name
argument_list|,
name|intptr
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|intptr
operator|<
name|dp
operator|->
name|dtdo_intlen
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! 0x%llx"
argument_list|,
operator|(
name|u_longlong_t
operator|)
name|dp
operator|->
name|dtdo_inttab
index|[
name|intptr
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_sets
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|strptr
init|=
name|DIF_INSTR_STRING
argument_list|(
name|in
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_STRING[%u], %%r%u"
argument_list|,
name|name
argument_list|,
name|strptr
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|strptr
operator|<
name|dp
operator|->
name|dtdo_strlen
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! \"%s\""
argument_list|,
name|dp
operator|->
name|dtdo_strtab
operator|+
name|strptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_ret
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s %%r%u"
argument_list|,
name|name
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_call
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|subr
init|=
name|DIF_INSTR_SUBR
argument_list|(
name|in
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DIF_SUBR(%u), %%r%u\t\t! %s"
argument_list|,
name|name
argument_list|,
name|subr
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|,
name|dtrace_subrstr
argument_list|(
name|NULL
argument_list|,
name|subr
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*ARGSUSED*/
end_comment

begin_function
specifier|static
name|void
name|dt_dis_pushts
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|tnames
index|[]
init|=
block|{
literal|"D type"
block|,
literal|"string"
block|}
decl_stmt|;
name|uint_t
name|type
init|=
name|DIF_INSTR_TYPE
argument_list|(
name|in
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|pad
decl_stmt|;
if|if
condition|(
name|DIF_INSTR_OP
argument_list|(
name|in
argument_list|)
operator|==
name|DIF_OP_PUSHTV
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_TYPE(%u), %%r%u"
argument_list|,
name|name
argument_list|,
name|type
argument_list|,
name|DIF_INSTR_RS
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
name|pad
operator|=
literal|"\t\t"
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_TYPE(%u), %%r%u, %%r%u"
argument_list|,
name|name
argument_list|,
name|type
argument_list|,
name|DIF_INSTR_R2
argument_list|(
name|in
argument_list|)
argument_list|,
name|DIF_INSTR_RS
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
name|pad
operator|=
literal|"\t"
expr_stmt|;
block|}
if|if
condition|(
name|type
operator|<
sizeof|sizeof
argument_list|(
name|tnames
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|tnames
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s! DT_TYPE(%u) = %s"
argument_list|,
name|pad
argument_list|,
name|type
argument_list|,
name|tnames
index|[
name|type
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_xlate
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|dif_instr_t
name|in
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|uint_t
name|xlr
init|=
name|DIF_INSTR_XLREF
argument_list|(
name|in
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4s DT_XLREF[%u], %%r%u"
argument_list|,
name|name
argument_list|,
name|xlr
argument_list|,
name|DIF_INSTR_RD
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|xlr
operator|<
name|dp
operator|->
name|dtdo_xlmlen
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\t\t! DT_XLREF[%u] = %u.%s"
argument_list|,
name|xlr
argument_list|,
operator|(
name|uint_t
operator|)
name|dp
operator|->
name|dtdo_xlmtab
index|[
name|xlr
index|]
operator|->
name|dn_membexpr
operator|->
name|dn_xlator
operator|->
name|dx_id
argument_list|,
name|dp
operator|->
name|dtdo_xlmtab
index|[
name|xlr
index|]
operator|->
name|dn_membname
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|dt_dis_typestr
parameter_list|(
specifier|const
name|dtrace_diftype_t
modifier|*
name|t
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|char
name|kind
index|[
literal|16
index|]
decl_stmt|,
name|ckind
index|[
literal|16
index|]
decl_stmt|;
switch|switch
condition|(
name|t
operator|->
name|dtdt_kind
condition|)
block|{
case|case
name|DIF_TYPE_CTF
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|kind
argument_list|,
literal|"D type"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIF_TYPE_STRING
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|kind
argument_list|,
literal|"string"
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|kind
argument_list|,
sizeof|sizeof
argument_list|(
name|kind
argument_list|)
argument_list|,
literal|"0x%x"
argument_list|,
name|t
operator|->
name|dtdt_kind
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|t
operator|->
name|dtdt_ckind
condition|)
block|{
case|case
name|CTF_K_UNKNOWN
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"unknown"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_INTEGER
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"integer"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_FLOAT
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"float"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_POINTER
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"pointer"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_ARRAY
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"array"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_FUNCTION
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"function"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_STRUCT
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"struct"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_UNION
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"union"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_ENUM
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"enum"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_FORWARD
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"forward"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_TYPEDEF
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"typedef"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_VOLATILE
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"volatile"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_CONST
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"const"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CTF_K_RESTRICT
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|ckind
argument_list|,
literal|"restrict"
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|ckind
argument_list|,
sizeof|sizeof
argument_list|(
name|ckind
argument_list|)
argument_list|,
literal|"0x%x"
argument_list|,
name|t
operator|->
name|dtdt_ckind
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|t
operator|->
name|dtdt_flags
operator|&
operator|(
name|DIF_TF_BYREF
operator||
name|DIF_TF_BYUREF
operator|)
condition|)
block|{
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
literal|"%s (%s) by %sref (size %lu)"
argument_list|,
name|kind
argument_list|,
name|ckind
argument_list|,
operator|(
name|t
operator|->
name|dtdt_flags
operator|&
name|DIF_TF_BYUREF
operator|)
condition|?
literal|"user "
else|:
literal|""
argument_list|,
operator|(
name|ulong_t
operator|)
name|t
operator|->
name|dtdt_size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|buf
argument_list|,
name|len
argument_list|,
literal|"%s (%s) (size %lu)"
argument_list|,
name|kind
argument_list|,
name|ckind
argument_list|,
operator|(
name|ulong_t
operator|)
name|t
operator|->
name|dtdt_size
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|dt_dis_rtab
parameter_list|(
specifier|const
name|char
modifier|*
name|rtag
parameter_list|,
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|,
specifier|const
name|dof_relodesc_t
modifier|*
name|rp
parameter_list|,
name|uint32_t
name|len
parameter_list|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%-4s %-8s %-8s %s\n"
argument_list|,
name|rtag
argument_list|,
literal|"OFFSET"
argument_list|,
literal|"DATA"
argument_list|,
literal|"NAME"
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|len
operator|!=
literal|0
condition|;
name|len
operator|--
operator|,
name|rp
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4u %-8llu %-8llu %s\n"
argument_list|,
name|rp
operator|->
name|dofr_type
argument_list|,
operator|(
name|u_longlong_t
operator|)
name|rp
operator|->
name|dofr_offset
argument_list|,
operator|(
name|u_longlong_t
operator|)
name|rp
operator|->
name|dofr_data
argument_list|,
operator|&
name|dp
operator|->
name|dtdo_strtab
index|[
name|rp
operator|->
name|dofr_name
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|dt_dis
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
name|dp
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
specifier|static
specifier|const
struct|struct
name|opent
block|{
specifier|const
name|char
modifier|*
name|op_name
decl_stmt|;
name|void
function_decl|(
modifier|*
name|op_func
function_decl|)
parameter_list|(
specifier|const
name|dtrace_difo_t
modifier|*
parameter_list|,
specifier|const
name|char
modifier|*
parameter_list|,
name|dif_instr_t
parameter_list|,
name|FILE
modifier|*
parameter_list|)
function_decl|;
block|}
name|optab
index|[]
init|=
block|{
block|{
literal|"(illegal opcode)"
block|,
name|dt_dis_str
block|}
block|,
block|{
literal|"or"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_OR */
block|{
literal|"xor"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_XOR */
block|{
literal|"and"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_AND */
block|{
literal|"sll"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SLL */
block|{
literal|"srl"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SRL */
block|{
literal|"sub"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SUB */
block|{
literal|"add"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_ADD */
block|{
literal|"mul"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_MUL */
block|{
literal|"sdiv"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SDIV */
block|{
literal|"udiv"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_UDIV */
block|{
literal|"srem"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SREM */
block|{
literal|"urem"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_UREM */
block|{
literal|"not"
block|,
name|dt_dis_r1rd
block|}
block|,
comment|/* DIF_OP_NOT */
block|{
literal|"mov"
block|,
name|dt_dis_r1rd
block|}
block|,
comment|/* DIF_OP_MOV */
block|{
literal|"cmp"
block|,
name|dt_dis_cmp
block|}
block|,
comment|/* DIF_OP_CMP */
block|{
literal|"tst"
block|,
name|dt_dis_tst
block|}
block|,
comment|/* DIF_OP_TST */
block|{
literal|"ba"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BA */
block|{
literal|"be"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BE */
block|{
literal|"bne"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BNE */
block|{
literal|"bg"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BG */
block|{
literal|"bgu"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BGU */
block|{
literal|"bge"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BGE */
block|{
literal|"bgeu"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BGEU */
block|{
literal|"bl"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BL */
block|{
literal|"blu"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BLU */
block|{
literal|"ble"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BLE */
block|{
literal|"bleu"
block|,
name|dt_dis_branch
block|}
block|,
comment|/* DIF_OP_BLEU */
block|{
literal|"ldsb"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDSB */
block|{
literal|"ldsh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDSH */
block|{
literal|"ldsw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDSW */
block|{
literal|"ldub"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDUB */
block|{
literal|"lduh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDUH */
block|{
literal|"lduw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDUW */
block|{
literal|"ldx"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_LDX */
block|{
literal|"ret"
block|,
name|dt_dis_ret
block|}
block|,
comment|/* DIF_OP_RET */
block|{
literal|"nop"
block|,
name|dt_dis_str
block|}
block|,
comment|/* DIF_OP_NOP */
block|{
literal|"setx"
block|,
name|dt_dis_setx
block|}
block|,
comment|/* DIF_OP_SETX */
block|{
literal|"sets"
block|,
name|dt_dis_sets
block|}
block|,
comment|/* DIF_OP_SETS */
block|{
literal|"scmp"
block|,
name|dt_dis_cmp
block|}
block|,
comment|/* DIF_OP_SCMP */
block|{
literal|"ldga"
block|,
name|dt_dis_lda
block|}
block|,
comment|/* DIF_OP_LDGA */
block|{
literal|"ldgs"
block|,
name|dt_dis_ldv
block|}
block|,
comment|/* DIF_OP_LDGS */
block|{
literal|"stgs"
block|,
name|dt_dis_stv
block|}
block|,
comment|/* DIF_OP_STGS */
block|{
literal|"ldta"
block|,
name|dt_dis_lda
block|}
block|,
comment|/* DIF_OP_LDTA */
block|{
literal|"ldts"
block|,
name|dt_dis_ldv
block|}
block|,
comment|/* DIF_OP_LDTS */
block|{
literal|"stts"
block|,
name|dt_dis_stv
block|}
block|,
comment|/* DIF_OP_STTS */
block|{
literal|"sra"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_SRA */
block|{
literal|"call"
block|,
name|dt_dis_call
block|}
block|,
comment|/* DIF_OP_CALL */
block|{
literal|"pushtr"
block|,
name|dt_dis_pushts
block|}
block|,
comment|/* DIF_OP_PUSHTR */
block|{
literal|"pushtv"
block|,
name|dt_dis_pushts
block|}
block|,
comment|/* DIF_OP_PUSHTV */
block|{
literal|"popts"
block|,
name|dt_dis_str
block|}
block|,
comment|/* DIF_OP_POPTS */
block|{
literal|"flushts"
block|,
name|dt_dis_str
block|}
block|,
comment|/* DIF_OP_FLUSHTS */
block|{
literal|"ldgaa"
block|,
name|dt_dis_ldv
block|}
block|,
comment|/* DIF_OP_LDGAA */
block|{
literal|"ldtaa"
block|,
name|dt_dis_ldv
block|}
block|,
comment|/* DIF_OP_LDTAA */
block|{
literal|"stgaa"
block|,
name|dt_dis_stv
block|}
block|,
comment|/* DIF_OP_STGAA */
block|{
literal|"sttaa"
block|,
name|dt_dis_stv
block|}
block|,
comment|/* DIF_OP_STTAA */
block|{
literal|"ldls"
block|,
name|dt_dis_ldv
block|}
block|,
comment|/* DIF_OP_LDLS */
block|{
literal|"stls"
block|,
name|dt_dis_stv
block|}
block|,
comment|/* DIF_OP_STLS */
block|{
literal|"allocs"
block|,
name|dt_dis_r1rd
block|}
block|,
comment|/* DIF_OP_ALLOCS */
block|{
literal|"copys"
block|,
name|dt_dis_log
block|}
block|,
comment|/* DIF_OP_COPYS */
block|{
literal|"stb"
block|,
name|dt_dis_store
block|}
block|,
comment|/* DIF_OP_STB */
block|{
literal|"sth"
block|,
name|dt_dis_store
block|}
block|,
comment|/* DIF_OP_STH */
block|{
literal|"stw"
block|,
name|dt_dis_store
block|}
block|,
comment|/* DIF_OP_STW */
block|{
literal|"stx"
block|,
name|dt_dis_store
block|}
block|,
comment|/* DIF_OP_STX */
block|{
literal|"uldsb"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDSB */
block|{
literal|"uldsh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDSH */
block|{
literal|"uldsw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDSW */
block|{
literal|"uldub"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDUB */
block|{
literal|"ulduh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDUH */
block|{
literal|"ulduw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDUW */
block|{
literal|"uldx"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_ULDX */
block|{
literal|"rldsb"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDSB */
block|{
literal|"rldsh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDSH */
block|{
literal|"rldsw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDSW */
block|{
literal|"rldub"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDUB */
block|{
literal|"rlduh"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDUH */
block|{
literal|"rlduw"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDUW */
block|{
literal|"rldx"
block|,
name|dt_dis_load
block|}
block|,
comment|/* DIF_OP_RLDX */
block|{
literal|"xlate"
block|,
name|dt_dis_xlate
block|}
block|,
comment|/* DIF_OP_XLATE */
block|{
literal|"xlarg"
block|,
name|dt_dis_xlate
block|}
block|,
comment|/* DIF_OP_XLARG */
block|}
struct|;
specifier|const
name|struct
name|opent
modifier|*
name|op
decl_stmt|;
name|ulong_t
name|i
init|=
literal|0
decl_stmt|;
name|char
name|type
index|[
name|DT_TYPE_NAMELEN
index|]
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\nDIFO 0x%p returns %s\n"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|dp
argument_list|,
name|dt_dis_typestr
argument_list|(
operator|&
name|dp
operator|->
name|dtdo_rtype
argument_list|,
name|type
argument_list|,
sizeof|sizeof
argument_list|(
name|type
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-3s %-8s    %s\n"
argument_list|,
literal|"OFF"
argument_list|,
literal|"OPCODE"
argument_list|,
literal|"INSTRUCTION"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dp
operator|->
name|dtdo_len
condition|;
name|i
operator|++
control|)
block|{
name|dif_instr_t
name|instr
init|=
name|dp
operator|->
name|dtdo_buf
index|[
name|i
index|]
decl_stmt|;
name|dif_instr_t
name|opcode
init|=
name|DIF_INSTR_OP
argument_list|(
name|instr
argument_list|)
decl_stmt|;
if|if
condition|(
name|opcode
operator|>=
sizeof|sizeof
argument_list|(
name|optab
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|optab
index|[
literal|0
index|]
argument_list|)
condition|)
name|opcode
operator|=
literal|0
expr_stmt|;
comment|/* force invalid opcode message */
name|op
operator|=
operator|&
name|optab
index|[
name|opcode
index|]
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%02lu: %08x    "
argument_list|,
name|i
argument_list|,
name|instr
argument_list|)
expr_stmt|;
name|op
operator|->
name|op_func
argument_list|(
name|dp
argument_list|,
name|op
operator|->
name|op_name
argument_list|,
name|instr
argument_list|,
name|fp
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dp
operator|->
name|dtdo_varlen
operator|!=
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%-16s %-4s %-3s %-3s %-4s %s\n"
argument_list|,
literal|"NAME"
argument_list|,
literal|"ID"
argument_list|,
literal|"KND"
argument_list|,
literal|"SCP"
argument_list|,
literal|"FLAG"
argument_list|,
literal|"TYPE"
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dp
operator|->
name|dtdo_varlen
condition|;
name|i
operator|++
control|)
block|{
name|dtrace_difv_t
modifier|*
name|v
init|=
operator|&
name|dp
operator|->
name|dtdo_vartab
index|[
name|i
index|]
decl_stmt|;
name|char
name|kind
index|[
literal|4
index|]
decl_stmt|,
name|scope
index|[
literal|4
index|]
decl_stmt|,
name|flags
index|[
literal|16
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
switch|switch
condition|(
name|v
operator|->
name|dtdv_kind
condition|)
block|{
case|case
name|DIFV_KIND_ARRAY
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|kind
argument_list|,
literal|"arr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIFV_KIND_SCALAR
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|kind
argument_list|,
literal|"scl"
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|kind
argument_list|,
sizeof|sizeof
argument_list|(
name|kind
argument_list|)
argument_list|,
literal|"%u"
argument_list|,
name|v
operator|->
name|dtdv_kind
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|v
operator|->
name|dtdv_scope
condition|)
block|{
case|case
name|DIFV_SCOPE_GLOBAL
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|scope
argument_list|,
literal|"glb"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIFV_SCOPE_THREAD
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|scope
argument_list|,
literal|"tls"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIFV_SCOPE_LOCAL
case|:
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|scope
argument_list|,
literal|"loc"
argument_list|)
expr_stmt|;
break|break;
default|default:
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|scope
argument_list|,
sizeof|sizeof
argument_list|(
name|scope
argument_list|)
argument_list|,
literal|"%u"
argument_list|,
name|v
operator|->
name|dtdv_scope
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|->
name|dtdv_flags
operator|&
operator|~
operator|(
name|DIFV_F_REF
operator||
name|DIFV_F_MOD
operator|)
condition|)
block|{
operator|(
name|void
operator|)
name|snprintf
argument_list|(
name|flags
argument_list|,
sizeof|sizeof
argument_list|(
name|flags
argument_list|)
argument_list|,
literal|"/0x%x"
argument_list|,
name|v
operator|->
name|dtdv_flags
operator|&
operator|~
operator|(
name|DIFV_F_REF
operator||
name|DIFV_F_MOD
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|v
operator|->
name|dtdv_flags
operator|&
name|DIFV_F_REF
condition|)
operator|(
name|void
operator|)
name|strcat
argument_list|(
name|flags
argument_list|,
literal|"/r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|->
name|dtdv_flags
operator|&
name|DIFV_F_MOD
condition|)
operator|(
name|void
operator|)
name|strcat
argument_list|(
name|flags
argument_list|,
literal|"/w"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-16s %-4x %-3s %-3s %-4s %s\n"
argument_list|,
operator|&
name|dp
operator|->
name|dtdo_strtab
index|[
name|v
operator|->
name|dtdv_name
index|]
argument_list|,
name|v
operator|->
name|dtdv_id
argument_list|,
name|kind
argument_list|,
name|scope
argument_list|,
name|flags
operator|+
literal|1
argument_list|,
name|dt_dis_typestr
argument_list|(
operator|&
name|v
operator|->
name|dtdv_type
argument_list|,
name|type
argument_list|,
sizeof|sizeof
argument_list|(
name|type
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dp
operator|->
name|dtdo_xlmlen
operator|!=
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%-4s %-3s %-12s %s\n"
argument_list|,
literal|"XLID"
argument_list|,
literal|"ARG"
argument_list|,
literal|"MEMBER"
argument_list|,
literal|"TYPE"
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|dp
operator|->
name|dtdo_xlmlen
condition|;
name|i
operator|++
control|)
block|{
name|dt_node_t
modifier|*
name|dnp
init|=
name|dp
operator|->
name|dtdo_xlmtab
index|[
name|i
index|]
decl_stmt|;
name|dt_xlator_t
modifier|*
name|dxp
init|=
name|dnp
operator|->
name|dn_membexpr
operator|->
name|dn_xlator
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%-4u %-3d %-12s %s\n"
argument_list|,
operator|(
name|uint_t
operator|)
name|dxp
operator|->
name|dx_id
argument_list|,
name|dxp
operator|->
name|dx_arg
argument_list|,
name|dnp
operator|->
name|dn_membname
argument_list|,
name|dt_node_type_name
argument_list|(
name|dnp
argument_list|,
name|type
argument_list|,
sizeof|sizeof
argument_list|(
name|type
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|dp
operator|->
name|dtdo_krelen
operator|!=
literal|0
condition|)
name|dt_dis_rtab
argument_list|(
literal|"KREL"
argument_list|,
name|dp
argument_list|,
name|fp
argument_list|,
name|dp
operator|->
name|dtdo_kreltab
argument_list|,
name|dp
operator|->
name|dtdo_krelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|dp
operator|->
name|dtdo_urelen
operator|!=
literal|0
condition|)
name|dt_dis_rtab
argument_list|(
literal|"UREL"
argument_list|,
name|dp
argument_list|,
name|fp
argument_list|,
name|dp
operator|->
name|dtdo_ureltab
argument_list|,
name|dp
operator|->
name|dtdo_urelen
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

