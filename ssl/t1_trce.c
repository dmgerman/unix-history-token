begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* ssl/t1_trce.c */
end_comment

begin_comment
comment|/*  * Written by Dr Stephen N Henson (steve@openssl.org) for the OpenSSL  * project.  */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright (c) 2012 The OpenSSL Project.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  *  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *  * 3. All advertising materials mentioning features or use of this  *    software must display the following acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit. (http://www.OpenSSL.org/)"  *  * 4. The names "OpenSSL Toolkit" and "OpenSSL Project" must not be used to  *    endorse or promote products derived from this software without  *    prior written permission. For written permission, please contact  *    licensing@OpenSSL.org.  *  * 5. Products derived from this software may not be called "OpenSSL"  *    nor may "OpenSSL" appear in their names without prior written  *    permission of the OpenSSL Project.  *  * 6. Redistributions of any form whatsoever must retain the following  *    acknowledgment:  *    "This product includes software developed by the OpenSSL Project  *    for use in the OpenSSL Toolkit (http://www.OpenSSL.org/)"  *  * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS'' AND ANY  * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED  * OF THE POSSIBILITY OF SUCH DAMAGE.  * ====================================================================  *  */
end_comment

begin_include
include|#
directive|include
file|"ssl_locl.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|OPENSSL_NO_SSL_TRACE
end_ifndef

begin_comment
comment|/* Packet trace support for OpenSSL */
end_comment

begin_typedef
typedef|typedef
struct|struct
block|{
name|int
name|num
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
block|}
name|ssl_trace_tbl
typedef|;
end_typedef

begin_define
define|#
directive|define
name|ssl_trace_str
parameter_list|(
name|val
parameter_list|,
name|tbl
parameter_list|)
define|\
value|do_ssl_trace_str(val, tbl, sizeof(tbl)/sizeof(ssl_trace_tbl))
end_define

begin_define
define|#
directive|define
name|ssl_trace_list
parameter_list|(
name|bio
parameter_list|,
name|indent
parameter_list|,
name|msg
parameter_list|,
name|msglen
parameter_list|,
name|value
parameter_list|,
name|table
parameter_list|)
define|\
value|do_ssl_trace_list(bio, indent, msg, msglen, value, \          table, sizeof(table)/sizeof(ssl_trace_tbl))
end_define

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|do_ssl_trace_str
parameter_list|(
name|int
name|val
parameter_list|,
name|ssl_trace_tbl
modifier|*
name|tbl
parameter_list|,
name|size_t
name|ntbl
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ntbl
condition|;
name|i
operator|++
operator|,
name|tbl
operator|++
control|)
block|{
if|if
condition|(
name|tbl
operator|->
name|num
operator|==
name|val
condition|)
return|return
name|tbl
operator|->
name|name
return|;
block|}
return|return
literal|"UNKNOWN"
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|do_ssl_trace_list
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|,
name|size_t
name|vlen
parameter_list|,
name|ssl_trace_tbl
modifier|*
name|tbl
parameter_list|,
name|size_t
name|ntbl
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
if|if
condition|(
name|msglen
operator|%
name|vlen
condition|)
return|return
literal|0
return|;
while|while
condition|(
name|msglen
condition|)
block|{
name|val
operator|=
name|msg
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|vlen
operator|==
literal|2
condition|)
name|val
operator|=
operator|(
name|val
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s (%d)\n"
argument_list|,
name|do_ssl_trace_str
argument_list|(
name|val
argument_list|,
name|tbl
argument_list|,
name|ntbl
argument_list|)
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|msg
operator|+=
name|vlen
expr_stmt|;
name|msglen
operator|-=
name|vlen
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* Version number */
end_comment

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_version_tbl
index|[]
init|=
block|{
block|{
name|SSL2_VERSION
block|,
literal|"SSL 2.0"
block|}
block|,
block|{
name|SSL3_VERSION
block|,
literal|"SSL 3.0"
block|}
block|,
block|{
name|TLS1_VERSION
block|,
literal|"TLS 1.0"
block|}
block|,
block|{
name|TLS1_1_VERSION
block|,
literal|"TLS 1.1"
block|}
block|,
block|{
name|TLS1_2_VERSION
block|,
literal|"TLS 1.2"
block|}
block|,
block|{
name|DTLS1_VERSION
block|,
literal|"DTLS 1.0"
block|}
block|,
block|{
name|DTLS1_2_VERSION
block|,
literal|"DTLS 1.2"
block|}
block|,
block|{
name|DTLS1_BAD_VER
block|,
literal|"DTLS 1.0 (bad)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_content_tbl
index|[]
init|=
block|{
block|{
name|SSL3_RT_CHANGE_CIPHER_SPEC
block|,
literal|"ChangeCipherSpec"
block|}
block|,
block|{
name|SSL3_RT_ALERT
block|,
literal|"Alert"
block|}
block|,
block|{
name|SSL3_RT_HANDSHAKE
block|,
literal|"Handshake"
block|}
block|,
block|{
name|SSL3_RT_APPLICATION_DATA
block|,
literal|"ApplicationData"
block|}
block|,
block|{
name|TLS1_RT_HEARTBEAT
block|,
literal|"HeartBeat"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Handshake types */
end_comment

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_handshake_tbl
index|[]
init|=
block|{
block|{
name|SSL3_MT_HELLO_REQUEST
block|,
literal|"HelloRequest"
block|}
block|,
block|{
name|SSL3_MT_CLIENT_HELLO
block|,
literal|"ClientHello"
block|}
block|,
block|{
name|SSL3_MT_SERVER_HELLO
block|,
literal|"ServerHello"
block|}
block|,
block|{
name|DTLS1_MT_HELLO_VERIFY_REQUEST
block|,
literal|"HelloVerifyRequest"
block|}
block|,
block|{
name|SSL3_MT_NEWSESSION_TICKET
block|,
literal|"NewSessionTicket"
block|}
block|,
block|{
name|SSL3_MT_CERTIFICATE
block|,
literal|"Certificate"
block|}
block|,
block|{
name|SSL3_MT_SERVER_KEY_EXCHANGE
block|,
literal|"ServerKeyExchange"
block|}
block|,
block|{
name|SSL3_MT_CERTIFICATE_REQUEST
block|,
literal|"CertificateRequest"
block|}
block|,
block|{
name|SSL3_MT_CLIENT_KEY_EXCHANGE
block|,
literal|"ClientKeyExchange"
block|}
block|,
block|{
name|SSL3_MT_CERTIFICATE_STATUS
block|,
literal|"CertificateStatus"
block|}
block|,
block|{
name|SSL3_MT_SERVER_DONE
block|,
literal|"ServerHelloDone"
block|}
block|,
block|{
name|SSL3_MT_CERTIFICATE_VERIFY
block|,
literal|"CertificateVerify"
block|}
block|,
block|{
name|SSL3_MT_CLIENT_KEY_EXCHANGE
block|,
literal|"ClientKeyExchange"
block|}
block|,
block|{
name|SSL3_MT_FINISHED
block|,
literal|"Finished"
block|}
block|,
block|{
name|SSL3_MT_CERTIFICATE_STATUS
block|,
literal|"CertificateStatus"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Cipher suites */
end_comment

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_ciphers_tbl
index|[]
init|=
block|{
block|{
literal|0x0000
block|,
literal|"SSL_NULL_WITH_NULL_NULL"
block|}
block|,
block|{
literal|0x0001
block|,
literal|"SSL_RSA_WITH_NULL_MD5"
block|}
block|,
block|{
literal|0x0002
block|,
literal|"SSL_RSA_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0x0003
block|,
literal|"SSL_RSA_EXPORT_WITH_RC4_40_MD5"
block|}
block|,
block|{
literal|0x0004
block|,
literal|"SSL_RSA_WITH_RC4_128_MD5"
block|}
block|,
block|{
literal|0x0005
block|,
literal|"SSL_RSA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x0006
block|,
literal|"SSL_RSA_EXPORT_WITH_RC2_CBC_40_MD5"
block|}
block|,
block|{
literal|0x0007
block|,
literal|"SSL_RSA_WITH_IDEA_CBC_SHA"
block|}
block|,
block|{
literal|0x0008
block|,
literal|"SSL_RSA_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x0009
block|,
literal|"SSL_RSA_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x000A
block|,
literal|"SSL_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x000B
block|,
literal|"SSL_DH_DSS_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x000C
block|,
literal|"SSL_DH_DSS_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x000D
block|,
literal|"SSL_DH_DSS_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x000E
block|,
literal|"SSL_DH_RSA_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x000F
block|,
literal|"SSL_DH_RSA_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x0010
block|,
literal|"SSL_DH_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0011
block|,
literal|"SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x0012
block|,
literal|"SSL_DHE_DSS_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x0013
block|,
literal|"SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0014
block|,
literal|"SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x0015
block|,
literal|"SSL_DHE_RSA_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x0016
block|,
literal|"SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0017
block|,
literal|"SSL_DH_anon_EXPORT_WITH_RC4_40_MD5"
block|}
block|,
block|{
literal|0x0018
block|,
literal|"SSL_DH_anon_WITH_RC4_128_MD5"
block|}
block|,
block|{
literal|0x0019
block|,
literal|"SSL_DH_anon_EXPORT_WITH_DES40_CBC_SHA"
block|}
block|,
block|{
literal|0x001A
block|,
literal|"SSL_DH_anon_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0x001B
block|,
literal|"SSL_DH_anon_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x001D
block|,
literal|"SSL_FORTEZZA_KEA_WITH_FORTEZZA_CBC_SHA"
block|}
block|,
block|{
literal|0x001E
block|,
literal|"SSL_FORTEZZA_KEA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x001F
block|,
literal|"TLS_KRB5_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0020
block|,
literal|"TLS_KRB5_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x0021
block|,
literal|"TLS_KRB5_WITH_IDEA_CBC_SHA"
block|}
block|,
block|{
literal|0x0022
block|,
literal|"TLS_KRB5_WITH_DES_CBC_MD5"
block|}
block|,
block|{
literal|0x0023
block|,
literal|"TLS_KRB5_WITH_3DES_EDE_CBC_MD5"
block|}
block|,
block|{
literal|0x0024
block|,
literal|"TLS_KRB5_WITH_RC4_128_MD5"
block|}
block|,
block|{
literal|0x0025
block|,
literal|"TLS_KRB5_WITH_IDEA_CBC_MD5"
block|}
block|,
block|{
literal|0x0026
block|,
literal|"TLS_KRB5_EXPORT_WITH_DES_CBC_40_SHA"
block|}
block|,
block|{
literal|0x0027
block|,
literal|"TLS_KRB5_EXPORT_WITH_RC2_CBC_40_SHA"
block|}
block|,
block|{
literal|0x0028
block|,
literal|"TLS_KRB5_EXPORT_WITH_RC4_40_SHA"
block|}
block|,
block|{
literal|0x0029
block|,
literal|"TLS_KRB5_EXPORT_WITH_DES_CBC_40_MD5"
block|}
block|,
block|{
literal|0x002A
block|,
literal|"TLS_KRB5_EXPORT_WITH_RC2_CBC_40_MD5"
block|}
block|,
block|{
literal|0x002B
block|,
literal|"TLS_KRB5_EXPORT_WITH_RC4_40_MD5"
block|}
block|,
block|{
literal|0x002F
block|,
literal|"TLS_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0030
block|,
literal|"TLS_DH_DSS_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0031
block|,
literal|"TLS_DH_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0032
block|,
literal|"TLS_DHE_DSS_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0033
block|,
literal|"TLS_DHE_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0034
block|,
literal|"TLS_DH_anon_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0035
block|,
literal|"TLS_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0036
block|,
literal|"TLS_DH_DSS_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0037
block|,
literal|"TLS_DH_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0038
block|,
literal|"TLS_DHE_DSS_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0039
block|,
literal|"TLS_DHE_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x003A
block|,
literal|"TLS_DH_anon_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x003B
block|,
literal|"TLS_RSA_WITH_NULL_SHA256"
block|}
block|,
block|{
literal|0x003C
block|,
literal|"TLS_RSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x003D
block|,
literal|"TLS_RSA_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x003E
block|,
literal|"TLS_DH_DSS_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x003F
block|,
literal|"TLS_DH_RSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x0040
block|,
literal|"TLS_DHE_DSS_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x0041
block|,
literal|"TLS_RSA_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0042
block|,
literal|"TLS_DH_DSS_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0043
block|,
literal|"TLS_DH_RSA_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0044
block|,
literal|"TLS_DHE_DSS_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0045
block|,
literal|"TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0046
block|,
literal|"TLS_DH_anon_WITH_CAMELLIA_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0067
block|,
literal|"TLS_DHE_RSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x0068
block|,
literal|"TLS_DH_DSS_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x0069
block|,
literal|"TLS_DH_RSA_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x006A
block|,
literal|"TLS_DHE_DSS_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x006B
block|,
literal|"TLS_DHE_RSA_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x006C
block|,
literal|"TLS_DH_anon_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x006D
block|,
literal|"TLS_DH_anon_WITH_AES_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x0084
block|,
literal|"TLS_RSA_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0085
block|,
literal|"TLS_DH_DSS_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0086
block|,
literal|"TLS_DH_RSA_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0087
block|,
literal|"TLS_DHE_DSS_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0088
block|,
literal|"TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0089
block|,
literal|"TLS_DH_anon_WITH_CAMELLIA_256_CBC_SHA"
block|}
block|,
block|{
literal|0x008A
block|,
literal|"TLS_PSK_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x008B
block|,
literal|"TLS_PSK_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x008C
block|,
literal|"TLS_PSK_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x008D
block|,
literal|"TLS_PSK_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x008E
block|,
literal|"TLS_DHE_PSK_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x008F
block|,
literal|"TLS_DHE_PSK_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0090
block|,
literal|"TLS_DHE_PSK_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0091
block|,
literal|"TLS_DHE_PSK_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0092
block|,
literal|"TLS_RSA_PSK_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0x0093
block|,
literal|"TLS_RSA_PSK_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0x0094
block|,
literal|"TLS_RSA_PSK_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0x0095
block|,
literal|"TLS_RSA_PSK_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0x0096
block|,
literal|"TLS_RSA_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x0097
block|,
literal|"TLS_DH_DSS_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x0098
block|,
literal|"TLS_DH_RSA_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x0099
block|,
literal|"TLS_DHE_DSS_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x009A
block|,
literal|"TLS_DHE_RSA_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x009B
block|,
literal|"TLS_DH_anon_WITH_SEED_CBC_SHA"
block|}
block|,
block|{
literal|0x009C
block|,
literal|"TLS_RSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x009D
block|,
literal|"TLS_RSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x009E
block|,
literal|"TLS_DHE_RSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x009F
block|,
literal|"TLS_DHE_RSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00A0
block|,
literal|"TLS_DH_RSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00A1
block|,
literal|"TLS_DH_RSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00A2
block|,
literal|"TLS_DHE_DSS_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00A3
block|,
literal|"TLS_DHE_DSS_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00A4
block|,
literal|"TLS_DH_DSS_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00A5
block|,
literal|"TLS_DH_DSS_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00A6
block|,
literal|"TLS_DH_anon_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00A7
block|,
literal|"TLS_DH_anon_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00A8
block|,
literal|"TLS_PSK_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00A9
block|,
literal|"TLS_PSK_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00AA
block|,
literal|"TLS_DHE_PSK_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00AB
block|,
literal|"TLS_DHE_PSK_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00AC
block|,
literal|"TLS_RSA_PSK_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0x00AD
block|,
literal|"TLS_RSA_PSK_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0x00AE
block|,
literal|"TLS_PSK_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00AF
block|,
literal|"TLS_PSK_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0x00B0
block|,
literal|"TLS_PSK_WITH_NULL_SHA256"
block|}
block|,
block|{
literal|0x00B1
block|,
literal|"TLS_PSK_WITH_NULL_SHA384"
block|}
block|,
block|{
literal|0x00B2
block|,
literal|"TLS_DHE_PSK_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00B3
block|,
literal|"TLS_DHE_PSK_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0x00B4
block|,
literal|"TLS_DHE_PSK_WITH_NULL_SHA256"
block|}
block|,
block|{
literal|0x00B5
block|,
literal|"TLS_DHE_PSK_WITH_NULL_SHA384"
block|}
block|,
block|{
literal|0x00B6
block|,
literal|"TLS_RSA_PSK_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00B7
block|,
literal|"TLS_RSA_PSK_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0x00B8
block|,
literal|"TLS_RSA_PSK_WITH_NULL_SHA256"
block|}
block|,
block|{
literal|0x00B9
block|,
literal|"TLS_RSA_PSK_WITH_NULL_SHA384"
block|}
block|,
block|{
literal|0x00BA
block|,
literal|"TLS_RSA_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00BB
block|,
literal|"TLS_DH_DSS_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00BC
block|,
literal|"TLS_DH_RSA_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00BD
block|,
literal|"TLS_DHE_DSS_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00BE
block|,
literal|"TLS_DHE_RSA_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00BF
block|,
literal|"TLS_DH_anon_WITH_CAMELLIA_128_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C0
block|,
literal|"TLS_RSA_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C1
block|,
literal|"TLS_DH_DSS_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C2
block|,
literal|"TLS_DH_RSA_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C3
block|,
literal|"TLS_DHE_DSS_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C4
block|,
literal|"TLS_DHE_RSA_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00C5
block|,
literal|"TLS_DH_anon_WITH_CAMELLIA_256_CBC_SHA256"
block|}
block|,
block|{
literal|0x00FF
block|,
literal|"TLS_EMPTY_RENEGOTIATION_INFO_SCSV"
block|}
block|,
block|{
literal|0xC001
block|,
literal|"TLS_ECDH_ECDSA_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0xC002
block|,
literal|"TLS_ECDH_ECDSA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0xC003
block|,
literal|"TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC004
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC005
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC006
block|,
literal|"TLS_ECDHE_ECDSA_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0xC007
block|,
literal|"TLS_ECDHE_ECDSA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0xC008
block|,
literal|"TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC009
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC00A
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC00B
block|,
literal|"TLS_ECDH_RSA_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0xC00C
block|,
literal|"TLS_ECDH_RSA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0xC00D
block|,
literal|"TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC00E
block|,
literal|"TLS_ECDH_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC00F
block|,
literal|"TLS_ECDH_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC010
block|,
literal|"TLS_ECDHE_RSA_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0xC011
block|,
literal|"TLS_ECDHE_RSA_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0xC012
block|,
literal|"TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC013
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC014
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC015
block|,
literal|"TLS_ECDH_anon_WITH_NULL_SHA"
block|}
block|,
block|{
literal|0xC016
block|,
literal|"TLS_ECDH_anon_WITH_RC4_128_SHA"
block|}
block|,
block|{
literal|0xC017
block|,
literal|"TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC018
block|,
literal|"TLS_ECDH_anon_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC019
block|,
literal|"TLS_ECDH_anon_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC01A
block|,
literal|"TLS_SRP_SHA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC01B
block|,
literal|"TLS_SRP_SHA_RSA_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC01C
block|,
literal|"TLS_SRP_SHA_DSS_WITH_3DES_EDE_CBC_SHA"
block|}
block|,
block|{
literal|0xC01D
block|,
literal|"TLS_SRP_SHA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC01E
block|,
literal|"TLS_SRP_SHA_RSA_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC01F
block|,
literal|"TLS_SRP_SHA_DSS_WITH_AES_128_CBC_SHA"
block|}
block|,
block|{
literal|0xC020
block|,
literal|"TLS_SRP_SHA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC021
block|,
literal|"TLS_SRP_SHA_RSA_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC022
block|,
literal|"TLS_SRP_SHA_DSS_WITH_AES_256_CBC_SHA"
block|}
block|,
block|{
literal|0xC023
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0xC024
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0xC025
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0xC026
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0xC027
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0xC028
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0xC029
block|,
literal|"TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256"
block|}
block|,
block|{
literal|0xC02A
block|,
literal|"TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384"
block|}
block|,
block|{
literal|0xC02B
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0xC02C
block|,
literal|"TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0xC02D
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0xC02E
block|,
literal|"TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0xC02F
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0xC030
block|,
literal|"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0xC031
block|,
literal|"TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256"
block|}
block|,
block|{
literal|0xC032
block|,
literal|"TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384"
block|}
block|,
block|{
literal|0xFEFE
block|,
literal|"SSL_RSA_FIPS_WITH_DES_CBC_SHA"
block|}
block|,
block|{
literal|0xFEFF
block|,
literal|"SSL_RSA_FIPS_WITH_3DES_EDE_CBC_SHA"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Compression methods */
end_comment

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_comp_tbl
index|[]
init|=
block|{
block|{
literal|0x0000
block|,
literal|"No Compression"
block|}
block|,
block|{
literal|0x0001
block|,
literal|"Zlib Compression"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Extensions */
end_comment

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_exts_tbl
index|[]
init|=
block|{
block|{
name|TLSEXT_TYPE_server_name
block|,
literal|"server_name"
block|}
block|,
block|{
name|TLSEXT_TYPE_max_fragment_length
block|,
literal|"max_fragment_length"
block|}
block|,
block|{
name|TLSEXT_TYPE_client_certificate_url
block|,
literal|"client_certificate_url"
block|}
block|,
block|{
name|TLSEXT_TYPE_trusted_ca_keys
block|,
literal|"trusted_ca_keys"
block|}
block|,
block|{
name|TLSEXT_TYPE_truncated_hmac
block|,
literal|"truncated_hmac"
block|}
block|,
block|{
name|TLSEXT_TYPE_status_request
block|,
literal|"status_request"
block|}
block|,
block|{
name|TLSEXT_TYPE_user_mapping
block|,
literal|"user_mapping"
block|}
block|,
block|{
name|TLSEXT_TYPE_client_authz
block|,
literal|"client_authz"
block|}
block|,
block|{
name|TLSEXT_TYPE_server_authz
block|,
literal|"server_authz"
block|}
block|,
block|{
name|TLSEXT_TYPE_cert_type
block|,
literal|"cert_type"
block|}
block|,
block|{
name|TLSEXT_TYPE_elliptic_curves
block|,
literal|"elliptic_curves"
block|}
block|,
block|{
name|TLSEXT_TYPE_ec_point_formats
block|,
literal|"ec_point_formats"
block|}
block|,
block|{
name|TLSEXT_TYPE_srp
block|,
literal|"srp"
block|}
block|,
block|{
name|TLSEXT_TYPE_signature_algorithms
block|,
literal|"signature_algorithms"
block|}
block|,
block|{
name|TLSEXT_TYPE_use_srtp
block|,
literal|"use_srtp"
block|}
block|,
block|{
name|TLSEXT_TYPE_heartbeat
block|,
literal|"heartbeat"
block|}
block|,
block|{
name|TLSEXT_TYPE_session_ticket
block|,
literal|"session_ticket"
block|}
block|,
ifdef|#
directive|ifdef
name|TLSEXT_TYPE_opaque_prf_input
block|{
name|TLSEXT_TYPE_opaque_prf_input
block|,
literal|"opaque_prf_input"
block|}
block|,
endif|#
directive|endif
block|{
name|TLSEXT_TYPE_renegotiate
block|,
literal|"renegotiate"
block|}
block|,
block|{
name|TLSEXT_TYPE_next_proto_neg
block|,
literal|"next_proto_neg"
block|}
block|,
block|{
name|TLSEXT_TYPE_padding
block|,
literal|"padding"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_curve_tbl
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"sect163k1 (K-163)"
block|}
block|,
block|{
literal|2
block|,
literal|"sect163r1"
block|}
block|,
block|{
literal|3
block|,
literal|"sect163r2 (B-163)"
block|}
block|,
block|{
literal|4
block|,
literal|"sect193r1"
block|}
block|,
block|{
literal|5
block|,
literal|"sect193r2"
block|}
block|,
block|{
literal|6
block|,
literal|"sect233k1 (K-233)"
block|}
block|,
block|{
literal|7
block|,
literal|"sect233r1 (B-233)"
block|}
block|,
block|{
literal|8
block|,
literal|"sect239k1"
block|}
block|,
block|{
literal|9
block|,
literal|"sect283k1 (K-283)"
block|}
block|,
block|{
literal|10
block|,
literal|"sect283r1 (B-283)"
block|}
block|,
block|{
literal|11
block|,
literal|"sect409k1 (K-409)"
block|}
block|,
block|{
literal|12
block|,
literal|"sect409r1 (B-409)"
block|}
block|,
block|{
literal|13
block|,
literal|"sect571k1 (K-571)"
block|}
block|,
block|{
literal|14
block|,
literal|"sect571r1 (B-571)"
block|}
block|,
block|{
literal|15
block|,
literal|"secp160k1"
block|}
block|,
block|{
literal|16
block|,
literal|"secp160r1"
block|}
block|,
block|{
literal|17
block|,
literal|"secp160r2"
block|}
block|,
block|{
literal|18
block|,
literal|"secp192k1"
block|}
block|,
block|{
literal|19
block|,
literal|"secp192r1 (P-192)"
block|}
block|,
block|{
literal|20
block|,
literal|"secp224k1"
block|}
block|,
block|{
literal|21
block|,
literal|"secp224r1 (P-224)"
block|}
block|,
block|{
literal|22
block|,
literal|"secp256k1"
block|}
block|,
block|{
literal|23
block|,
literal|"secp256r1 (P-256)"
block|}
block|,
block|{
literal|24
block|,
literal|"secp384r1 (P-384)"
block|}
block|,
block|{
literal|25
block|,
literal|"secp521r1 (P-521)"
block|}
block|,
block|{
literal|26
block|,
literal|"brainpoolP256r1"
block|}
block|,
block|{
literal|27
block|,
literal|"brainpoolP384r1"
block|}
block|,
block|{
literal|28
block|,
literal|"brainpoolP512r1"
block|}
block|,
block|{
literal|0xFF01
block|,
literal|"arbitrary_explicit_prime_curves"
block|}
block|,
block|{
literal|0xFF02
block|,
literal|"arbitrary_explicit_char2_curves"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_point_tbl
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"uncompressed"
block|}
block|,
block|{
literal|1
block|,
literal|"ansiX962_compressed_prime"
block|}
block|,
block|{
literal|2
block|,
literal|"ansiX962_compressed_char2"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_md_tbl
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"none"
block|}
block|,
block|{
literal|1
block|,
literal|"md5"
block|}
block|,
block|{
literal|2
block|,
literal|"sha1"
block|}
block|,
block|{
literal|3
block|,
literal|"sha224"
block|}
block|,
block|{
literal|4
block|,
literal|"sha256"
block|}
block|,
block|{
literal|5
block|,
literal|"sha384"
block|}
block|,
block|{
literal|6
block|,
literal|"sha512"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_sig_tbl
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"anonymous"
block|}
block|,
block|{
literal|1
block|,
literal|"rsa"
block|}
block|,
block|{
literal|2
block|,
literal|"dsa"
block|}
block|,
block|{
literal|3
block|,
literal|"ecdsa"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_hb_tbl
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"peer_allowed_to_send"
block|}
block|,
block|{
literal|2
block|,
literal|"peer_not_allowed_to_send"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_hb_type_tbl
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"heartbeat_request"
block|}
block|,
block|{
literal|2
block|,
literal|"heartbeat_response"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_ctype_tbl
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"rsa_sign"
block|}
block|,
block|{
literal|2
block|,
literal|"dss_sign"
block|}
block|,
block|{
literal|3
block|,
literal|"rsa_fixed_dh"
block|}
block|,
block|{
literal|4
block|,
literal|"dss_fixed_dh"
block|}
block|,
block|{
literal|5
block|,
literal|"rsa_ephemeral_dh"
block|}
block|,
block|{
literal|6
block|,
literal|"dss_ephemeral_dh"
block|}
block|,
block|{
literal|20
block|,
literal|"fortezza_dms"
block|}
block|,
block|{
literal|64
block|,
literal|"ecdsa_sign"
block|}
block|,
block|{
literal|65
block|,
literal|"rsa_fixed_ecdh"
block|}
block|,
block|{
literal|66
block|,
literal|"ecdsa_fixed_ecdh"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|ssl_trace_tbl
name|ssl_crypto_tbl
index|[]
init|=
block|{
block|{
name|TLS1_RT_CRYPTO_PREMASTER
block|,
literal|"Premaster Secret"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_CLIENT_RANDOM
block|,
literal|"Client Random"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_SERVER_RANDOM
block|,
literal|"Server Random"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_MASTER
block|,
literal|"Master Secret"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_MAC
operator||
name|TLS1_RT_CRYPTO_WRITE
block|,
literal|"Write Mac Secret"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_MAC
operator||
name|TLS1_RT_CRYPTO_READ
block|,
literal|"Read Mac Secret"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_KEY
operator||
name|TLS1_RT_CRYPTO_WRITE
block|,
literal|"Write Key"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_KEY
operator||
name|TLS1_RT_CRYPTO_READ
block|,
literal|"Read Key"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_IV
operator||
name|TLS1_RT_CRYPTO_WRITE
block|,
literal|"Write IV"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_IV
operator||
name|TLS1_RT_CRYPTO_READ
block|,
literal|"Read IV"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_FIXED_IV
operator||
name|TLS1_RT_CRYPTO_WRITE
block|,
literal|"Write IV (fixed part)"
block|}
block|,
block|{
name|TLS1_RT_CRYPTO_FIXED_IV
operator||
name|TLS1_RT_CRYPTO_READ
block|,
literal|"Read IV (fixed part)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|ssl_print_hex
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s (len=%d): "
argument_list|,
name|name
argument_list|,
operator|(
name|int
operator|)
name|msglen
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|msglen
condition|;
name|i
operator|++
control|)
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%02X"
argument_list|,
name|msg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_hexbuf
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|size_t
name|nlen
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
modifier|*
name|pmsg
parameter_list|,
name|size_t
modifier|*
name|pmsglen
parameter_list|)
block|{
name|size_t
name|blen
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|p
init|=
operator|*
name|pmsg
decl_stmt|;
if|if
condition|(
operator|*
name|pmsglen
operator|<
name|nlen
condition|)
return|return
literal|0
return|;
name|blen
operator|=
name|p
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|nlen
operator|>
literal|1
condition|)
name|blen
operator|=
operator|(
name|blen
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
operator|*
name|pmsglen
operator|<
name|nlen
operator|+
name|blen
condition|)
return|return
literal|0
return|;
name|p
operator|+=
name|nlen
expr_stmt|;
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
name|name
argument_list|,
name|p
argument_list|,
name|blen
argument_list|)
expr_stmt|;
operator|*
name|pmsg
operator|+=
name|blen
operator|+
name|nlen
expr_stmt|;
operator|*
name|pmsglen
operator|-=
name|blen
operator|+
name|nlen
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_version
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
modifier|*
name|pmsg
parameter_list|,
name|size_t
modifier|*
name|pmsglen
parameter_list|)
block|{
name|int
name|vers
decl_stmt|;
if|if
condition|(
operator|*
name|pmsglen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|vers
operator|=
operator|(
operator|(
operator|*
name|pmsg
operator|)
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
operator|*
name|pmsg
operator|)
index|[
literal|1
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s=0x%x (%s)\n"
argument_list|,
name|name
argument_list|,
name|vers
argument_list|,
name|ssl_trace_str
argument_list|(
name|vers
argument_list|,
name|ssl_version_tbl
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|pmsg
operator|+=
literal|2
expr_stmt|;
operator|*
name|pmsglen
operator|-=
literal|2
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_random
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
modifier|*
name|pmsg
parameter_list|,
name|size_t
modifier|*
name|pmsglen
parameter_list|)
block|{
name|unsigned
name|int
name|tm
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|p
init|=
operator|*
name|pmsg
decl_stmt|;
if|if
condition|(
operator|*
name|pmsglen
operator|<
literal|32
condition|)
return|return
literal|0
return|;
name|tm
operator|=
operator|(
name|p
index|[
literal|0
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|3
index|]
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"Random:\n"
argument_list|)
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"gmt_unix_time=0x%08X\n"
argument_list|,
name|tm
argument_list|)
expr_stmt|;
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"random_bytes"
argument_list|,
name|p
argument_list|,
literal|28
argument_list|)
expr_stmt|;
operator|*
name|pmsg
operator|+=
literal|32
expr_stmt|;
operator|*
name|pmsglen
operator|-=
literal|32
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_signature
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|SSL
modifier|*
name|s
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
modifier|*
name|pmsg
parameter_list|,
name|size_t
modifier|*
name|pmsglen
parameter_list|)
block|{
if|if
condition|(
operator|*
name|pmsglen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|SSL_USE_SIGALGS
argument_list|(
name|s
argument_list|)
condition|)
block|{
specifier|const
name|unsigned
name|char
modifier|*
name|p
init|=
operator|*
name|pmsg
decl_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"Signature Algorithm %s+%s (%d+%d)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|p
index|[
literal|0
index|]
argument_list|,
name|ssl_md_tbl
argument_list|)
argument_list|,
name|ssl_trace_str
argument_list|(
name|p
index|[
literal|1
index|]
argument_list|,
name|ssl_sig_tbl
argument_list|)
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|pmsg
operator|+=
literal|2
expr_stmt|;
operator|*
name|pmsglen
operator|-=
literal|2
expr_stmt|;
block|}
return|return
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"Signature"
argument_list|,
literal|2
argument_list|,
name|pmsg
argument_list|,
name|pmsglen
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_extension
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|int
name|server
parameter_list|,
name|int
name|extype
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|ext
parameter_list|,
name|size_t
name|extlen
parameter_list|)
block|{
name|size_t
name|xlen
decl_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"extension_type=%s(%d), length=%d\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|extype
argument_list|,
name|ssl_exts_tbl
argument_list|)
argument_list|,
name|extype
argument_list|,
operator|(
name|int
operator|)
name|extlen
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|extype
condition|)
block|{
case|case
name|TLSEXT_TYPE_ec_point_formats
case|:
if|if
condition|(
name|extlen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
name|ext
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|extlen
operator|!=
name|xlen
operator|+
literal|1
condition|)
return|return
literal|0
return|;
return|return
name|ssl_trace_list
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ext
operator|+
literal|1
argument_list|,
name|xlen
argument_list|,
literal|1
argument_list|,
name|ssl_point_tbl
argument_list|)
return|;
case|case
name|TLSEXT_TYPE_elliptic_curves
case|:
if|if
condition|(
name|extlen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
operator|(
name|ext
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|ext
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|extlen
operator|!=
name|xlen
operator|+
literal|2
condition|)
return|return
literal|0
return|;
return|return
name|ssl_trace_list
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ext
operator|+
literal|2
argument_list|,
name|xlen
argument_list|,
literal|2
argument_list|,
name|ssl_curve_tbl
argument_list|)
return|;
case|case
name|TLSEXT_TYPE_signature_algorithms
case|:
if|if
condition|(
name|extlen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
operator|(
name|ext
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|ext
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|extlen
operator|!=
name|xlen
operator|+
literal|2
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|xlen
operator|&
literal|1
condition|)
return|return
literal|0
return|;
name|ext
operator|+=
literal|2
expr_stmt|;
while|while
condition|(
name|xlen
operator|>
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s+%s (%d+%d)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|ext
index|[
literal|0
index|]
argument_list|,
name|ssl_md_tbl
argument_list|)
argument_list|,
name|ssl_trace_str
argument_list|(
name|ext
index|[
literal|1
index|]
argument_list|,
name|ssl_sig_tbl
argument_list|)
argument_list|,
name|ext
index|[
literal|0
index|]
argument_list|,
name|ext
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|xlen
operator|-=
literal|2
expr_stmt|;
name|ext
operator|+=
literal|2
expr_stmt|;
block|}
break|break;
case|case
name|TLSEXT_TYPE_renegotiate
case|:
if|if
condition|(
name|extlen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
name|ext
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|xlen
operator|+
literal|1
operator|!=
name|extlen
condition|)
return|return
literal|0
return|;
name|ext
operator|++
expr_stmt|;
if|if
condition|(
name|xlen
condition|)
block|{
if|if
condition|(
name|server
condition|)
block|{
if|if
condition|(
name|xlen
operator|&
literal|1
condition|)
return|return
literal|0
return|;
name|xlen
operator|>>=
literal|1
expr_stmt|;
block|}
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|4
argument_list|,
literal|"client_verify_data"
argument_list|,
name|ext
argument_list|,
name|xlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|server
condition|)
block|{
name|ext
operator|+=
name|xlen
expr_stmt|;
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|4
argument_list|,
literal|"server_verify_data"
argument_list|,
name|ext
argument_list|,
name|xlen
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|4
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"<EMPTY>\n"
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TLSEXT_TYPE_heartbeat
case|:
if|if
condition|(
name|extlen
operator|!=
literal|1
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"HeartbeatMode: %s\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|ext
index|[
literal|0
index|]
argument_list|,
name|ssl_hb_tbl
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TLSEXT_TYPE_session_ticket
case|:
if|if
condition|(
name|extlen
operator|!=
literal|0
condition|)
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|4
argument_list|,
literal|"ticket"
argument_list|,
name|ext
argument_list|,
name|extlen
argument_list|)
expr_stmt|;
break|break;
default|default:
name|BIO_dump_indent
argument_list|(
name|bio
argument_list|,
operator|(
name|char
operator|*
operator|)
name|ext
argument_list|,
name|extlen
argument_list|,
name|indent
operator|+
literal|2
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_extensions
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|int
name|server
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|size_t
name|extslen
decl_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
operator|==
literal|0
condition|)
block|{
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"No Extensions\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|extslen
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|extslen
operator|!=
name|msglen
operator|-
literal|2
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|msglen
operator|=
name|extslen
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"extensions, length = %d\n"
argument_list|,
operator|(
name|int
operator|)
name|msglen
argument_list|)
expr_stmt|;
while|while
condition|(
name|msglen
operator|>
literal|0
condition|)
block|{
name|int
name|extype
decl_stmt|;
name|size_t
name|extlen
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|4
condition|)
return|return
literal|0
return|;
name|extype
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|extlen
operator|=
operator|(
name|msg
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|3
index|]
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|extlen
operator|+
literal|4
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_print_extension
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|server
argument_list|,
name|extype
argument_list|,
name|msg
argument_list|,
name|extlen
argument_list|)
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
name|extlen
expr_stmt|;
name|msglen
operator|-=
name|extlen
operator|+
literal|4
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_client_hello
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
name|unsigned
name|int
name|cs
decl_stmt|;
if|if
condition|(
operator|!
name|ssl_print_version
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"client_version"
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_random
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"session_id"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|SSL_IS_DTLS
argument_list|(
name|ssl
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"cookie"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|msglen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|len
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|msglen
operator|-=
literal|2
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"cipher_suites (len=%d)\n"
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|len
operator|||
name|len
operator|&
literal|1
condition|)
return|return
literal|0
return|;
while|while
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|cs
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"{0x%02X, 0x%02X} %s\n"
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|,
name|msg
index|[
literal|1
index|]
argument_list|,
name|ssl_trace_str
argument_list|(
name|cs
argument_list|,
name|ssl_ciphers_tbl
argument_list|)
argument_list|)
expr_stmt|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|msglen
operator|-=
literal|2
expr_stmt|;
name|len
operator|-=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|msglen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|len
operator|=
name|msg
index|[
literal|0
index|]
expr_stmt|;
name|msg
operator|++
expr_stmt|;
name|msglen
operator|--
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|len
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"compression_methods (len=%d)\n"
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s (0x%02X)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|0
index|]
argument_list|,
name|ssl_comp_tbl
argument_list|)
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|msg
operator|++
expr_stmt|;
name|msglen
operator|--
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ssl_print_extensions
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|0
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dtls_print_hello_vfyrequest
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
if|if
condition|(
operator|!
name|ssl_print_version
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"server_version"
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"cookie"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_server_hello
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|unsigned
name|int
name|cs
decl_stmt|;
if|if
condition|(
operator|!
name|ssl_print_version
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"server_version"
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_random
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"session_id"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|msglen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|cs
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"cipher_suite {0x%02X, 0x%02X} %s\n"
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|,
name|msg
index|[
literal|1
index|]
argument_list|,
name|ssl_trace_str
argument_list|(
name|cs
argument_list|,
name|ssl_ciphers_tbl
argument_list|)
argument_list|)
expr_stmt|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|msglen
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"compression_method: %s (0x%02X)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|0
index|]
argument_list|,
name|ssl_comp_tbl
argument_list|)
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|msg
operator|++
expr_stmt|;
name|msglen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_print_extensions
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|1
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_get_keyex
parameter_list|(
specifier|const
name|char
modifier|*
modifier|*
name|pname
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|)
block|{
name|unsigned
name|long
name|alg_k
init|=
name|ssl
operator|->
name|s3
operator|->
name|tmp
operator|.
name|new_cipher
operator|->
name|algorithm_mkey
decl_stmt|;
if|if
condition|(
name|alg_k
operator|&
name|SSL_kRSA
condition|)
block|{
operator|*
name|pname
operator|=
literal|"rsa"
expr_stmt|;
return|return
name|SSL_kRSA
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kDHr
condition|)
block|{
operator|*
name|pname
operator|=
literal|"dh_rsa"
expr_stmt|;
return|return
name|SSL_kDHr
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kDHd
condition|)
block|{
operator|*
name|pname
operator|=
literal|"dh_dss"
expr_stmt|;
return|return
name|SSL_kDHd
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kKRB5
condition|)
block|{
operator|*
name|pname
operator|=
literal|"krb5"
expr_stmt|;
return|return
name|SSL_kKRB5
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kEDH
condition|)
block|{
operator|*
name|pname
operator|=
literal|"edh"
expr_stmt|;
return|return
name|SSL_kEDH
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kEECDH
condition|)
block|{
operator|*
name|pname
operator|=
literal|"EECDH"
expr_stmt|;
return|return
name|SSL_kEECDH
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kECDHr
condition|)
block|{
operator|*
name|pname
operator|=
literal|"ECDH RSA"
expr_stmt|;
return|return
name|SSL_kECDHr
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kECDHe
condition|)
block|{
operator|*
name|pname
operator|=
literal|"ECDH ECDSA"
expr_stmt|;
return|return
name|SSL_kECDHe
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kPSK
condition|)
block|{
operator|*
name|pname
operator|=
literal|"PSK"
expr_stmt|;
return|return
name|SSL_kPSK
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kSRP
condition|)
block|{
operator|*
name|pname
operator|=
literal|"SRP"
expr_stmt|;
return|return
name|SSL_kSRP
return|;
block|}
if|if
condition|(
name|alg_k
operator|&
name|SSL_kGOST
condition|)
block|{
operator|*
name|pname
operator|=
literal|"GOST"
expr_stmt|;
return|return
name|SSL_kGOST
return|;
block|}
operator|*
name|pname
operator|=
literal|"UNKNOWN"
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_client_keyex
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|algname
decl_stmt|;
name|int
name|id
decl_stmt|;
name|id
operator|=
name|ssl_get_keyex
argument_list|(
operator|&
name|algname
argument_list|,
name|ssl
argument_list|)
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"KeyExchangeAlgorithm=%s\n"
argument_list|,
name|algname
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
case|case
name|SSL_kRSA
case|:
if|if
condition|(
name|TLS1_get_version
argument_list|(
name|ssl
argument_list|)
operator|==
name|SSL3_VERSION
condition|)
block|{
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"EncyptedPreMasterSecret"
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"EncyptedPreMasterSecret"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
break|break;
comment|/* Implicit parameters only allowed for static DH */
case|case
name|SSL_kDHd
case|:
case|case
name|SSL_kDHr
case|:
if|if
condition|(
name|msglen
operator|==
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"implicit\n"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|SSL_kEDH
case|:
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"dh_Yc"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL_kECDHr
case|:
case|case
name|SSL_kECDHe
case|:
if|if
condition|(
name|msglen
operator|==
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"implicit\n"
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|SSL_kEECDH
case|:
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"ecdh_Yc"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_server_keyex
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|algname
decl_stmt|;
name|int
name|id
decl_stmt|;
name|id
operator|=
name|ssl_get_keyex
argument_list|(
operator|&
name|algname
argument_list|,
name|ssl
argument_list|)
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"KeyExchangeAlgorithm=%s\n"
argument_list|,
name|algname
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|id
condition|)
block|{
comment|/* Should never happen */
case|case
name|SSL_kDHd
case|:
case|case
name|SSL_kDHr
case|:
case|case
name|SSL_kECDHr
case|:
case|case
name|SSL_kECDHe
case|:
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"Unexpected Message\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSL_kRSA
case|:
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"rsa_modulus"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"rsa_exponent"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL_kEDH
case|:
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"dh_p"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"dh_g"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"dh_Ys"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL_kEECDH
case|:
if|if
condition|(
name|msglen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
if|if
condition|(
name|msg
index|[
literal|0
index|]
operator|==
name|EXPLICIT_PRIME_CURVE_TYPE
condition|)
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"explicit_prime\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|msg
index|[
literal|0
index|]
operator|==
name|EXPLICIT_CHAR2_CURVE_TYPE
condition|)
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"explicit_char2\n"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|msg
index|[
literal|0
index|]
operator|==
name|NAMED_CURVE_TYPE
condition|)
block|{
name|int
name|curve
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|3
condition|)
return|return
literal|0
return|;
name|curve
operator|=
operator|(
name|msg
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|2
index|]
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"named_curve: %s (%d)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|curve
argument_list|,
name|ssl_curve_tbl
argument_list|)
argument_list|,
name|curve
argument_list|)
expr_stmt|;
name|msg
operator|+=
literal|3
expr_stmt|;
name|msglen
operator|-=
literal|3
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"point"
argument_list|,
literal|1
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
break|break;
block|}
return|return
name|ssl_print_signature
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
name|ssl
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_certificate
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
modifier|*
name|pmsg
parameter_list|,
name|size_t
modifier|*
name|pmsglen
parameter_list|)
block|{
name|size_t
name|msglen
init|=
operator|*
name|pmsglen
decl_stmt|;
name|size_t
name|clen
decl_stmt|;
name|X509
modifier|*
name|x
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|p
init|=
operator|*
name|pmsg
decl_stmt|,
modifier|*
name|q
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|3
condition|)
return|return
literal|0
return|;
name|clen
operator|=
operator|(
name|p
index|[
literal|0
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|clen
operator|+
literal|3
condition|)
return|return
literal|0
return|;
name|q
operator|=
name|p
operator|+
literal|3
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"ASN.1Cert, length=%d"
argument_list|,
operator|(
name|int
operator|)
name|clen
argument_list|)
expr_stmt|;
name|x
operator|=
name|d2i_X509
argument_list|(
name|NULL
argument_list|,
operator|&
name|q
argument_list|,
name|clen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|x
condition|)
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"<UNPARSEABLE CERTIFICATE>\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"\n------details-----\n"
argument_list|)
expr_stmt|;
name|X509_print_ex
argument_list|(
name|bio
argument_list|,
name|x
argument_list|,
name|XN_FLAG_ONELINE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|PEM_write_bio_X509
argument_list|(
name|bio
argument_list|,
name|x
argument_list|)
expr_stmt|;
comment|/* Print certificate stuff */
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"------------------\n"
argument_list|)
expr_stmt|;
name|X509_free
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|q
operator|!=
name|p
operator|+
literal|3
operator|+
name|clen
condition|)
block|{
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"<TRAILING GARBAGE AFTER CERTIFICATE>\n"
argument_list|)
expr_stmt|;
block|}
operator|*
name|pmsg
operator|+=
name|clen
operator|+
literal|3
expr_stmt|;
operator|*
name|pmsglen
operator|-=
name|clen
operator|+
literal|3
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_certificates
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|size_t
name|clen
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|3
condition|)
return|return
literal|0
return|;
name|clen
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|msg
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|msglen
operator|!=
name|clen
operator|+
literal|3
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|3
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"certificate_list, length=%d\n"
argument_list|,
operator|(
name|int
operator|)
name|clen
argument_list|)
expr_stmt|;
while|while
condition|(
name|clen
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|ssl_print_certificate
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|clen
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_cert_request
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
name|SSL
modifier|*
name|s
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|size_t
name|xlen
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|1
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
name|msg
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|xlen
operator|+
literal|1
condition|)
return|return
literal|0
return|;
name|msg
operator|++
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"certificate_types (len=%d)\n"
argument_list|,
operator|(
name|int
operator|)
name|xlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_trace_list
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|xlen
argument_list|,
literal|1
argument_list|,
name|ssl_ctype_tbl
argument_list|)
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
name|xlen
expr_stmt|;
name|msglen
operator|-=
name|xlen
operator|+
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|SSL_USE_SIGALGS
argument_list|(
name|s
argument_list|)
condition|)
goto|goto
name|skip_sig
goto|;
if|if
condition|(
name|msglen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|xlen
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|xlen
operator|+
literal|2
operator|||
operator|(
name|xlen
operator|&
literal|1
operator|)
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"signature_algorithms (len=%d)\n"
argument_list|,
operator|(
name|int
operator|)
name|xlen
argument_list|)
expr_stmt|;
while|while
condition|(
name|xlen
operator|>
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s+%s (%d+%d)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|0
index|]
argument_list|,
name|ssl_md_tbl
argument_list|)
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|1
index|]
argument_list|,
name|ssl_sig_tbl
argument_list|)
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|,
name|msg
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|xlen
operator|-=
literal|2
expr_stmt|;
name|msg
operator|+=
literal|2
expr_stmt|;
block|}
name|msg
operator|+=
name|xlen
expr_stmt|;
name|msglen
operator|-=
name|xlen
operator|+
literal|2
expr_stmt|;
name|skip_sig
label|:
name|xlen
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
if|if
condition|(
name|msglen
operator|<
name|xlen
operator|+
literal|2
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|msglen
operator|-=
literal|2
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"certificate_authorities (len=%d)\n"
argument_list|,
operator|(
name|int
operator|)
name|xlen
argument_list|)
expr_stmt|;
while|while
condition|(
name|xlen
operator|>
literal|0
condition|)
block|{
name|size_t
name|dlen
decl_stmt|;
name|X509_NAME
modifier|*
name|nm
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|xlen
operator|<
literal|2
condition|)
return|return
literal|0
return|;
name|dlen
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|xlen
operator|<
name|dlen
operator|+
literal|2
condition|)
return|return
literal|0
return|;
name|msg
operator|+=
literal|2
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"DistinguishedName (len=%d): "
argument_list|,
operator|(
name|int
operator|)
name|dlen
argument_list|)
expr_stmt|;
name|p
operator|=
name|msg
expr_stmt|;
name|nm
operator|=
name|d2i_X509_NAME
argument_list|(
name|NULL
argument_list|,
operator|&
name|p
argument_list|,
name|dlen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|nm
condition|)
block|{
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"<UNPARSEABLE DN>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|X509_NAME_print_ex
argument_list|(
name|bio
argument_list|,
name|nm
argument_list|,
literal|0
argument_list|,
name|XN_FLAG_ONELINE
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|X509_NAME_free
argument_list|(
name|nm
argument_list|)
expr_stmt|;
block|}
name|xlen
operator|-=
name|dlen
operator|+
literal|2
expr_stmt|;
name|msg
operator|+=
name|dlen
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_ticket
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
name|unsigned
name|int
name|tick_life
decl_stmt|;
if|if
condition|(
name|msglen
operator|==
literal|0
condition|)
block|{
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"No Ticket\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|msglen
operator|<
literal|4
condition|)
return|return
literal|0
return|;
name|tick_life
operator|=
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|msg
index|[
literal|1
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|msg
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|3
index|]
expr_stmt|;
name|msglen
operator|-=
literal|4
expr_stmt|;
name|msg
operator|+=
literal|4
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"ticket_lifetime_hint=%u\n"
argument_list|,
name|tick_life
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"ticket"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|msglen
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_handshake
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|size_t
name|hlen
decl_stmt|;
name|unsigned
name|char
name|htype
decl_stmt|;
if|if
condition|(
name|msglen
operator|<
literal|4
condition|)
return|return
literal|0
return|;
name|htype
operator|=
name|msg
index|[
literal|0
index|]
expr_stmt|;
name|hlen
operator|=
operator|(
name|msg
index|[
literal|1
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|msg
index|[
literal|2
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|3
index|]
expr_stmt|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"%s, Length=%d\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|htype
argument_list|,
name|ssl_handshake_tbl
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|hlen
argument_list|)
expr_stmt|;
name|msg
operator|+=
literal|4
expr_stmt|;
name|msglen
operator|-=
literal|4
expr_stmt|;
if|if
condition|(
name|SSL_IS_DTLS
argument_list|(
name|ssl
argument_list|)
condition|)
block|{
if|if
condition|(
name|msglen
operator|<
literal|8
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"message_seq=%d, fragment_offset=%d, "
literal|"fragment_length=%d\n"
argument_list|,
operator|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|1
index|]
argument_list|,
operator|(
name|msg
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|msg
index|[
literal|3
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|4
index|]
argument_list|,
operator|(
name|msg
index|[
literal|5
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|msg
index|[
literal|6
index|]
operator|<<
literal|8
operator|)
operator||
name|msg
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|msg
operator|+=
literal|8
expr_stmt|;
name|msglen
operator|-=
literal|8
expr_stmt|;
block|}
if|if
condition|(
name|msglen
operator|<
name|hlen
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|htype
condition|)
block|{
case|case
name|SSL3_MT_CLIENT_HELLO
case|:
if|if
condition|(
operator|!
name|ssl_print_client_hello
argument_list|(
name|bio
argument_list|,
name|ssl
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|DTLS1_MT_HELLO_VERIFY_REQUEST
case|:
if|if
condition|(
operator|!
name|dtls_print_hello_vfyrequest
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_SERVER_HELLO
case|:
if|if
condition|(
operator|!
name|ssl_print_server_hello
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_SERVER_KEY_EXCHANGE
case|:
if|if
condition|(
operator|!
name|ssl_print_server_keyex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ssl
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_CLIENT_KEY_EXCHANGE
case|:
if|if
condition|(
operator|!
name|ssl_print_client_keyex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ssl
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_CERTIFICATE
case|:
if|if
condition|(
operator|!
name|ssl_print_certificates
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_CERTIFICATE_VERIFY
case|:
if|if
condition|(
operator|!
name|ssl_print_signature
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ssl
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_CERTIFICATE_REQUEST
case|:
if|if
condition|(
operator|!
name|ssl_print_cert_request
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|ssl
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
name|SSL3_MT_FINISHED
case|:
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"verify_data"
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSL3_MT_SERVER_DONE
case|:
if|if
condition|(
name|msglen
operator|!=
literal|0
condition|)
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|"unexpected value"
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSL3_MT_NEWSESSION_TICKET
case|:
if|if
condition|(
operator|!
name|ssl_print_ticket
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
default|default:
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
operator|+
literal|2
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"Unsupported, hex dump follows:\n"
argument_list|)
expr_stmt|;
name|BIO_dump_indent
argument_list|(
name|bio
argument_list|,
operator|(
name|char
operator|*
operator|)
name|msg
argument_list|,
name|msglen
argument_list|,
name|indent
operator|+
literal|4
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ssl_print_heartbeat
parameter_list|(
name|BIO
modifier|*
name|bio
parameter_list|,
name|int
name|indent
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|msg
parameter_list|,
name|size_t
name|msglen
parameter_list|)
block|{
if|if
condition|(
name|msglen
operator|<
literal|3
condition|)
return|return
literal|0
return|;
name|BIO_indent
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"HeartBeatMessageType: %s\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|0
index|]
argument_list|,
name|ssl_hb_type_tbl
argument_list|)
argument_list|)
expr_stmt|;
name|msg
operator|++
expr_stmt|;
name|msglen
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|ssl_print_hexbuf
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"payload"
argument_list|,
literal|2
argument_list|,
operator|&
name|msg
argument_list|,
operator|&
name|msglen
argument_list|)
condition|)
return|return
literal|0
return|;
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
name|indent
argument_list|,
literal|"padding"
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
name|SSL_CIPHER_standard_name
parameter_list|(
specifier|const
name|SSL_CIPHER
modifier|*
name|c
parameter_list|)
block|{
if|if
condition|(
name|c
operator|->
name|algorithm_ssl
operator|&
name|SSL_SSLV2
condition|)
return|return
name|NULL
return|;
return|return
name|ssl_trace_str
argument_list|(
name|c
operator|->
name|id
operator|&
literal|0xFFFF
argument_list|,
name|ssl_ciphers_tbl
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|SSL_trace
parameter_list|(
name|int
name|write_p
parameter_list|,
name|int
name|version
parameter_list|,
name|int
name|content_type
parameter_list|,
specifier|const
name|void
modifier|*
name|buf
parameter_list|,
name|size_t
name|msglen
parameter_list|,
name|SSL
modifier|*
name|ssl
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|)
block|{
specifier|const
name|unsigned
name|char
modifier|*
name|msg
init|=
name|buf
decl_stmt|;
name|BIO
modifier|*
name|bio
init|=
name|arg
decl_stmt|;
if|if
condition|(
name|write_p
operator|==
literal|2
condition|)
block|{
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"Session "
argument_list|)
expr_stmt|;
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
literal|0
argument_list|,
name|ssl_trace_str
argument_list|(
name|content_type
argument_list|,
name|ssl_crypto_tbl
argument_list|)
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|content_type
condition|)
block|{
case|case
name|SSL3_RT_HEADER
case|:
block|{
name|int
name|hvers
init|=
name|msg
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|msg
index|[
literal|2
index|]
decl_stmt|;
name|BIO_puts
argument_list|(
name|bio
argument_list|,
name|write_p
condition|?
literal|"Sent"
else|:
literal|"Received"
argument_list|)
expr_stmt|;
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|" Record\nHeader:\n  Version = %s (0x%x)\n"
argument_list|,
name|ssl_trace_str
argument_list|(
name|hvers
argument_list|,
name|ssl_version_tbl
argument_list|)
argument_list|,
name|hvers
argument_list|)
expr_stmt|;
if|if
condition|(
name|SSL_IS_DTLS
argument_list|(
name|ssl
argument_list|)
condition|)
block|{
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"  epoch=%d, sequence_number=%04x%04x%04x\n"
argument_list|,
operator|(
name|msg
index|[
literal|3
index|]
operator|<<
literal|8
operator||
name|msg
index|[
literal|4
index|]
operator|)
argument_list|,
operator|(
name|msg
index|[
literal|5
index|]
operator|<<
literal|8
operator||
name|msg
index|[
literal|6
index|]
operator|)
argument_list|,
operator|(
name|msg
index|[
literal|7
index|]
operator|<<
literal|8
operator||
name|msg
index|[
literal|8
index|]
operator|)
argument_list|,
operator|(
name|msg
index|[
literal|9
index|]
operator|<<
literal|8
operator||
name|msg
index|[
literal|10
index|]
operator|)
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/*                  * Just print handshake type so we can see what is going on                  * during fragmentation.                  */
block|BIO_printf(bio, "(%s)\n",                            ssl_trace_str(msg[msglen], ssl_handshake_tbl));
endif|#
directive|endif
block|}
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"  Content Type = %s (%d)\n  Length = %d"
argument_list|,
name|ssl_trace_str
argument_list|(
name|msg
index|[
literal|0
index|]
argument_list|,
name|ssl_content_tbl
argument_list|)
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|,
name|msg
index|[
name|msglen
operator|-
literal|2
index|]
operator|<<
literal|8
operator||
name|msg
index|[
name|msglen
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SSL3_RT_HANDSHAKE
case|:
if|if
condition|(
operator|!
name|ssl_print_handshake
argument_list|(
name|bio
argument_list|,
name|ssl
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|,
literal|4
argument_list|)
condition|)
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"Message length parse error!\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSL3_RT_CHANGE_CIPHER_SPEC
case|:
if|if
condition|(
name|msglen
operator|==
literal|1
operator|&&
name|msg
index|[
literal|0
index|]
operator|==
literal|1
condition|)
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"    change_cipher_spec (1)\n"
argument_list|)
expr_stmt|;
else|else
name|ssl_print_hex
argument_list|(
name|bio
argument_list|,
literal|4
argument_list|,
literal|"unknown value"
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
break|break;
case|case
name|SSL3_RT_ALERT
case|:
if|if
condition|(
name|msglen
operator|!=
literal|2
condition|)
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"    Illegal Alert Length\n"
argument_list|)
expr_stmt|;
else|else
block|{
name|BIO_printf
argument_list|(
name|bio
argument_list|,
literal|"    Level=%s(%d), description=%s(%d)\n"
argument_list|,
name|SSL_alert_type_string_long
argument_list|(
name|msg
index|[
literal|0
index|]
operator|<<
literal|8
argument_list|)
argument_list|,
name|msg
index|[
literal|0
index|]
argument_list|,
name|SSL_alert_desc_string_long
argument_list|(
name|msg
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|msg
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
case|case
name|TLS1_RT_HEARTBEAT
case|:
name|ssl_print_heartbeat
argument_list|(
name|bio
argument_list|,
literal|4
argument_list|,
name|msg
argument_list|,
name|msglen
argument_list|)
expr_stmt|;
break|break;
block|}
name|BIO_puts
argument_list|(
name|bio
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

