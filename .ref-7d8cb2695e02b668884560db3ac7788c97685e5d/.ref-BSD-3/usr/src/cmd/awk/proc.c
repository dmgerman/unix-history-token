begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"awk.h"
end_include

begin_define
define|#
directive|define
name|NULL
value|0
end_define

begin_struct
struct|struct
name|xx
block|{
name|int
name|token
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|pname
decl_stmt|;
block|}
name|proc
index|[]
init|=
block|{
block|{
name|PROGRAM
block|,
literal|"program"
block|,
name|NULL
block|}
block|,
block|{
name|BOR
block|,
literal|"boolop"
block|,
literal|" || "
block|}
block|,
block|{
name|AND
block|,
literal|"boolop"
block|,
literal|"&& "
block|}
block|,
block|{
name|NOT
block|,
literal|"boolop"
block|,
literal|" !"
block|}
block|,
block|{
name|NE
block|,
literal|"relop"
block|,
literal|" != "
block|}
block|,
block|{
name|EQ
block|,
literal|"relop"
block|,
literal|" == "
block|}
block|,
block|{
name|LE
block|,
literal|"relop"
block|,
literal|"<= "
block|}
block|,
block|{
name|LT
block|,
literal|"relop"
block|,
literal|"< "
block|}
block|,
block|{
name|GE
block|,
literal|"relop"
block|,
literal|">= "
block|}
block|,
block|{
name|GT
block|,
literal|"relop"
block|,
literal|"> "
block|}
block|,
block|{
name|ARRAY
block|,
literal|"array"
block|,
name|NULL
block|}
block|,
block|{
name|INDIRECT
block|,
literal|"indirect"
block|,
literal|"$("
block|}
block|,
block|{
name|SUBSTR
block|,
literal|"substr"
block|,
literal|"substr"
block|}
block|,
block|{
name|INDEX
block|,
literal|"index"
block|,
literal|"index"
block|}
block|,
block|{
name|SPRINTF
block|,
literal|"asprintf"
block|,
literal|"sprintf "
block|}
block|,
block|{
name|ADD
block|,
literal|"arith"
block|,
literal|" + "
block|}
block|,
block|{
name|MINUS
block|,
literal|"arith"
block|,
literal|" - "
block|}
block|,
block|{
name|MULT
block|,
literal|"arith"
block|,
literal|" * "
block|}
block|,
block|{
name|DIVIDE
block|,
literal|"arith"
block|,
literal|" / "
block|}
block|,
block|{
name|MOD
block|,
literal|"arith"
block|,
literal|" % "
block|}
block|,
block|{
name|UMINUS
block|,
literal|"arith"
block|,
literal|" -"
block|}
block|,
block|{
name|PREINCR
block|,
literal|"incrdecr"
block|,
literal|"++"
block|}
block|,
block|{
name|POSTINCR
block|,
literal|"incrdecr"
block|,
literal|"++"
block|}
block|,
block|{
name|PREDECR
block|,
literal|"incrdecr"
block|,
literal|"--"
block|}
block|,
block|{
name|POSTDECR
block|,
literal|"incrdecr"
block|,
literal|"--"
block|}
block|,
block|{
name|CAT
block|,
literal|"cat"
block|,
literal|" "
block|}
block|,
block|{
name|PASTAT
block|,
literal|"pastat"
block|,
name|NULL
block|}
block|,
block|{
name|PASTAT2
block|,
literal|"dopa2"
block|,
name|NULL
block|}
block|,
block|{
name|MATCH
block|,
literal|"matchop"
block|,
literal|" ~ "
block|}
block|,
block|{
name|NOTMATCH
block|,
literal|"matchop"
block|,
literal|" !~ "
block|}
block|,
block|{
name|PRINTF
block|,
literal|"aprintf"
block|,
literal|"printf"
block|}
block|,
block|{
name|PRINT
block|,
literal|"print"
block|,
literal|"print"
block|}
block|,
block|{
name|SPLIT
block|,
literal|"split"
block|,
literal|"split"
block|}
block|,
block|{
name|ASSIGN
block|,
literal|"assign"
block|,
literal|" = "
block|}
block|,
block|{
name|ADDEQ
block|,
literal|"assign"
block|,
literal|" += "
block|}
block|,
block|{
name|SUBEQ
block|,
literal|"assign"
block|,
literal|" -= "
block|}
block|,
block|{
name|MULTEQ
block|,
literal|"assign"
block|,
literal|" *= "
block|}
block|,
block|{
name|DIVEQ
block|,
literal|"assign"
block|,
literal|" /= "
block|}
block|,
block|{
name|MODEQ
block|,
literal|"assign"
block|,
literal|" %= "
block|}
block|,
block|{
name|IF
block|,
literal|"ifstat"
block|,
literal|"if("
block|}
block|,
block|{
name|WHILE
block|,
literal|"whilestat"
block|,
literal|"while("
block|}
block|,
block|{
name|FOR
block|,
literal|"forstat"
block|,
literal|"for("
block|}
block|,
block|{
name|IN
block|,
literal|"instat"
block|,
literal|"instat"
block|}
block|,
block|{
name|NEXT
block|,
literal|"jump"
block|,
literal|"next"
block|}
block|,
block|{
name|EXIT
block|,
literal|"jump"
block|,
literal|"exit"
block|}
block|,
block|{
name|BREAK
block|,
literal|"jump"
block|,
literal|"break"
block|}
block|,
block|{
name|CONTINUE
block|,
literal|"jump"
block|,
literal|"continue"
block|}
block|,
block|{
name|FNCN
block|,
literal|"fncn"
block|,
literal|"fncn"
block|}
block|,
block|{
literal|0
block|,
literal|""
block|}
block|, }
struct|;
end_struct

begin_define
define|#
directive|define
name|SIZE
value|LASTTOKEN - FIRSTTOKEN
end_define

begin_decl_stmt
name|char
modifier|*
name|table
index|[
name|SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|names
index|[
name|SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|()
block|{
name|struct
name|xx
modifier|*
name|p
decl_stmt|;
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"#include \"awk.def\"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"obj nullproc();\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
if|if
condition|(
name|p
operator|==
name|proc
operator|||
name|strcmp
argument_list|(
name|p
operator|->
name|name
argument_list|,
operator|(
name|p
operator|-
literal|1
operator|)
operator|->
name|name
argument_list|)
condition|)
name|printf
argument_list|(
literal|"extern obj %s();\n"
argument_list|,
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
name|table
index|[
name|p
operator|->
name|token
operator|-
name|FIRSTTOKEN
index|]
operator|=
name|p
operator|->
name|name
expr_stmt|;
name|printf
argument_list|(
literal|"obj (*proctab[%d])() = {\n"
argument_list|,
name|SIZE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SIZE
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|table
index|[
name|i
index|]
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"/*%s*/\tnullproc,\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"/*%s*/\t%s,\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|,
name|table
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"};\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"char *printname[%d] = {\n"
argument_list|,
name|SIZE
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|proc
init|;
name|p
operator|->
name|token
operator|!=
literal|0
condition|;
name|p
operator|++
control|)
name|names
index|[
name|p
operator|->
name|token
operator|-
name|FIRSTTOKEN
index|]
operator|=
name|p
operator|->
name|pname
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SIZE
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"/*%s*/\t\"%s\",\n"
argument_list|,
name|tokname
argument_list|(
name|i
operator|+
name|FIRSTTOKEN
argument_list|)
argument_list|,
name|names
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"};\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

