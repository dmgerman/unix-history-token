begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_comment
comment|/*  * Vfontedpr.  *  * Bill Joy, Apr. 1979.  */
end_comment

begin_function_decl
name|char
modifier|*
name|ctime
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|incomm
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|instr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nokeyw
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|index
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|margin
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|lineno
decl_stmt|;
name|char
modifier|*
name|fname
init|=
literal|""
decl_stmt|;
name|struct
name|stat
name|stbuf
decl_stmt|;
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|int
name|needbp
init|=
literal|0
decl_stmt|;
name|argc
operator|--
operator|,
name|argv
operator|++
expr_stmt|;
do|do
block|{
name|char
modifier|*
name|cp
decl_stmt|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"-h"
argument_list|)
condition|)
block|{
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"'ds =H\n"
argument_list|)
expr_stmt|;
name|argc
operator|=
literal|0
expr_stmt|;
goto|goto
name|rest
goto|;
block|}
name|printf
argument_list|(
literal|"'ds =H %s\n"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|argc
operator|-=
literal|2
expr_stmt|;
name|argv
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
continue|continue;
goto|goto
name|rest
goto|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"-x"
argument_list|)
condition|)
block|{
name|index
operator|++
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
literal|"-n"
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"-n"
argument_list|)
condition|)
block|{
name|nokeyw
operator|++
expr_stmt|;
name|argc
operator|--
operator|,
name|argv
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|freopen
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"r"
argument_list|,
name|stdin
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|perror
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|index
condition|)
name|printf
argument_list|(
literal|"'ta 4i 4.25i 5.5iR\n'in .5i\n"
argument_list|)
expr_stmt|;
name|fname
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
name|argc
operator|--
operator|,
name|argv
operator|++
expr_stmt|;
block|}
name|rest
label|:
name|incomm
operator|=
literal|0
expr_stmt|;
name|instr
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|".ds =F %s\n"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fstat
argument_list|(
name|fileno
argument_list|(
name|stdin
argument_list|)
argument_list|,
operator|&
name|stbuf
argument_list|)
expr_stmt|;
name|cp
operator|=
name|ctime
argument_list|(
operator|&
name|stbuf
operator|.
name|st_mtime
argument_list|)
expr_stmt|;
name|cp
index|[
literal|16
index|]
operator|=
literal|'\0'
expr_stmt|;
name|cp
index|[
literal|24
index|]
operator|=
literal|'\0'
expr_stmt|;
name|printf
argument_list|(
literal|".ds =M %s %s\n"
argument_list|,
name|cp
operator|+
literal|4
argument_list|,
name|cp
operator|+
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|needbp
condition|)
block|{
name|needbp
operator|=
literal|0
expr_stmt|;
name|printf
argument_list|(
literal|".()\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|".bp\n"
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|stdin
argument_list|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|buf
index|[
literal|0
index|]
operator|==
literal|'\f'
condition|)
block|{
name|printf
argument_list|(
literal|".bp\n"
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|putScp
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
index|[
name|strlen
argument_list|(
name|buf
argument_list|)
operator|-
literal|2
index|]
operator|!=
literal|'\\'
condition|)
name|instr
operator|=
literal|0
expr_stmt|;
name|margin
operator|=
literal|0
expr_stmt|;
block|}
name|needbp
operator|=
literal|1
expr_stmt|;
block|}
do|while
condition|(
name|argc
operator|>
literal|0
condition|)
do|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|ps
parameter_list|(
name|x
parameter_list|)
value|printf("%s", x)
end_define

begin_define
define|#
directive|define
name|isidchr
parameter_list|(
name|c
parameter_list|)
value|(isalnum(c) || (c) == '_')
end_define

begin_macro
name|putScp
argument_list|(
argument|os
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|os
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|s
init|=
name|os
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
name|int
name|xfld
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|nokeyw
condition|)
goto|goto
name|skip
goto|;
if|if
condition|(
operator|(
operator|*
name|s
operator|==
literal|'_'
operator|||
name|isalpha
argument_list|(
operator|*
name|s
argument_list|)
operator|)
operator|&&
name|s
index|[
name|strlen
argument_list|(
name|s
argument_list|)
operator|-
literal|2
index|]
operator|==
literal|')'
condition|)
block|{
specifier|register
name|char
modifier|*
name|t
init|=
name|s
operator|+
literal|1
decl_stmt|;
while|while
condition|(
name|isidchr
argument_list|(
operator|*
name|t
argument_list|)
condition|)
name|t
operator|++
expr_stmt|;
name|ps
argument_list|(
literal|"'FN "
argument_list|)
expr_stmt|;
while|while
condition|(
name|s
operator|<
name|t
condition|)
name|putchar
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
name|ps
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|s
argument_list|,
literal|"}\n"
argument_list|)
condition|)
name|ps
argument_list|(
literal|"'-F\n"
argument_list|)
expr_stmt|;
name|skip
label|:
while|while
condition|(
operator|*
name|s
condition|)
block|{
if|if
condition|(
name|index
condition|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
literal|'\t'
condition|)
block|{
if|if
condition|(
name|xfld
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"
literal|"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
name|xfld
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|*
name|s
operator|==
literal|' '
operator|||
operator|*
name|s
operator|==
literal|'\t'
condition|)
name|s
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
if|if
condition|(
operator|!
name|nokeyw
operator|&&
operator|!
name|incomm
operator|&&
operator|*
name|s
operator|==
literal|'"'
condition|)
block|{
if|if
condition|(
name|instr
condition|)
block|{
if|if
condition|(
name|s
index|[
operator|-
literal|1
index|]
operator|!=
literal|'\\'
condition|)
name|instr
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|s
index|[
operator|-
literal|1
index|]
operator|!=
literal|'\''
condition|)
name|instr
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|incomm
operator|&&
name|s
operator|-
name|os
operator|>=
literal|2
operator|&&
operator|!
name|strncmp
argument_list|(
literal|"*/"
argument_list|,
name|s
operator|-
literal|2
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|incomm
operator|=
literal|0
expr_stmt|;
name|ps
argument_list|(
literal|"\\c\n'-C\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|nokeyw
operator|&&
operator|!
name|incomm
operator|&&
operator|!
name|strncmp
argument_list|(
literal|"/*"
argument_list|,
name|s
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|incomm
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|s
operator|!=
name|os
condition|)
name|ps
argument_list|(
literal|"\\c"
argument_list|)
expr_stmt|;
name|ps
argument_list|(
literal|"\\c\n'+C\n"
argument_list|)
expr_stmt|;
name|margin
operator|=
name|width
argument_list|(
name|os
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|ps
argument_list|(
literal|"\\*(/*"
argument_list|)
expr_stmt|;
name|s
operator|+=
literal|2
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|*
name|s
operator|==
literal|'\t'
condition|)
block|{
while|while
condition|(
operator|*
name|s
operator|==
literal|'\t'
condition|)
name|s
operator|++
expr_stmt|;
name|i
operator|=
name|tabs
argument_list|(
name|os
argument_list|,
name|s
argument_list|)
operator|-
name|margin
operator|/
literal|8
expr_stmt|;
name|printf
argument_list|(
literal|"\\h'|%dn'"
argument_list|,
name|i
operator|*
literal|10
operator|+
literal|1
operator|-
name|margin
operator|%
literal|8
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* 		if (*s == '-'&& s[1] == '>') { 			s += 2; 			ps("\\(->"); 			continue; 		} */
if|if
condition|(
operator|!
name|nokeyw
operator|&&
operator|!
name|instr
operator|&&
operator|(
operator|*
name|s
operator|==
literal|'#'
operator|||
name|isalpha
argument_list|(
operator|*
name|s
argument_list|)
operator|)
operator|&&
operator|(
name|s
operator|==
name|os
operator|||
operator|!
name|isidchr
argument_list|(
name|s
index|[
operator|-
literal|1
index|]
argument_list|)
operator|)
condition|)
block|{
name|i
operator|=
name|iskw
argument_list|(
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|0
condition|)
block|{
name|ps
argument_list|(
literal|"\\*(+K"
argument_list|)
expr_stmt|;
do|do
name|putcp
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
do|while
condition|(
operator|--
name|i
operator|>
literal|0
condition|)
do|;
name|ps
argument_list|(
literal|"\\*(-K"
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
name|putcp
argument_list|(
operator|*
name|s
operator|++
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|tabs
argument_list|(
argument|s
argument_list|,
argument|os
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|,
modifier|*
name|os
decl_stmt|;
end_decl_stmt

begin_block
block|{
return|return
operator|(
name|width
argument_list|(
name|s
argument_list|,
name|os
argument_list|)
operator|/
literal|8
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|width
argument_list|(
name|s
argument_list|,
name|os
argument_list|)
specifier|register
name|char
operator|*
name|s
operator|,
operator|*
name|os
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|int
name|i
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|s
operator|<
name|os
condition|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'\t'
condition|)
block|{
name|i
operator|=
operator|(
name|i
operator|+
literal|8
operator|)
operator|&
operator|~
literal|7
expr_stmt|;
name|s
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|*
name|s
operator|<
literal|' '
condition|)
name|i
operator|+=
literal|2
expr_stmt|;
else|else
name|i
operator|++
expr_stmt|;
name|s
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|i
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|putcp
argument_list|(
name|c
argument_list|)
specifier|register
name|int
name|c
expr_stmt|;
end_expr_stmt

begin_block
block|{
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'{'
case|:
name|ps
argument_list|(
literal|"\\*(+K{\\*(-K"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'}'
case|:
name|ps
argument_list|(
literal|"\\*(+K}\\*(-K"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'\\'
case|:
name|ps
argument_list|(
literal|"\\e"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'_'
case|:
name|ps
argument_list|(
literal|"\\*_"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'-'
case|:
name|ps
argument_list|(
literal|"\\*-"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'`'
case|:
name|ps
argument_list|(
literal|"\\`"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'\''
case|:
name|ps
argument_list|(
literal|"\\'"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'.'
case|:
name|ps
argument_list|(
literal|"\\&."
argument_list|)
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|c
operator|<
literal|040
condition|)
name|putchar
argument_list|(
literal|'^'
argument_list|)
operator|,
name|c
operator||=
literal|'@'
expr_stmt|;
case|case
literal|'\t'
case|:
case|case
literal|'\n'
case|:
name|putchar
argument_list|(
name|c
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_decl_stmt
name|char
modifier|*
name|ckw
index|[]
init|=
block|{
literal|"asm"
block|,
literal|"auto"
block|,
literal|"break"
block|,
literal|"case"
block|,
literal|"char"
block|,
literal|"continue"
block|,
literal|"default"
block|,
literal|"do"
block|,
literal|"double"
block|,
literal|"else"
block|,
literal|"enum"
block|,
literal|"extern"
block|,
literal|"float"
block|,
literal|"for"
block|,
literal|"fortran"
block|,
literal|"goto"
block|,
literal|"if"
block|,
literal|"int"
block|,
literal|"long"
block|,
literal|"register"
block|,
literal|"return"
block|,
literal|"short"
block|,
literal|"sizeof"
block|,
literal|"static"
block|,
literal|"struct"
block|,
literal|"switch"
block|,
literal|"typedef"
block|,
literal|"union"
block|,
literal|"unsigned"
block|,
literal|"while"
block|,
literal|"#define"
block|,
literal|"#else"
block|,
literal|"#endif"
block|,
literal|"#if"
block|,
literal|"#ifdef"
block|,
literal|"#ifndef"
block|,
literal|"#include"
block|,
literal|"#undef"
block|,
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|iskw
argument_list|(
name|s
argument_list|)
specifier|register
name|char
operator|*
name|s
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
modifier|*
name|ss
init|=
name|ckw
decl_stmt|;
specifier|register
name|int
name|i
init|=
literal|1
decl_stmt|;
specifier|register
name|char
modifier|*
name|cp
init|=
name|s
decl_stmt|;
while|while
condition|(
operator|++
name|cp
operator|,
name|isidchr
argument_list|(
operator|*
name|cp
argument_list|)
condition|)
name|i
operator|++
expr_stmt|;
while|while
condition|(
name|cp
operator|=
operator|*
name|ss
operator|++
condition|)
if|if
condition|(
operator|*
name|s
operator|==
operator|*
name|cp
operator|&&
operator|!
name|strncmp
argument_list|(
name|s
argument_list|,
name|cp
argument_list|,
name|i
argument_list|)
operator|&&
operator|!
name|isidchr
argument_list|(
name|cp
index|[
name|i
index|]
argument_list|)
condition|)
return|return
operator|(
name|i
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

end_unit

