begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* snprintf - compatibility implementation of snprintf, vsnprintf  *  * Copyright (c) 2013, NLnet Labs. All rights reserved.  *  * This software is open source.  *   * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *   * Redistributions of source code must retain the above copyright notice,  * this list of conditions and the following disclaimer.  *   * Redistributions in binary form must reproduce the above copyright notice,  * this list of conditions and the following disclaimer in the documentation  * and/or other materials provided with the distribution.  *   * Neither the name of the NLNET LABS nor the names of its contributors may  * be used to endorse or promote products derived from this software without  * specific prior written permission.  *   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED  * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<ldns/config.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_STDINT_H
end_ifdef

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* for test */
end_comment

begin_comment
comment|/* #define SNPRINTF_TEST 1 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|SNPRINTF_TEST
end_ifdef

begin_define
define|#
directive|define
name|snprintf
value|my_snprintf
end_define

begin_define
define|#
directive|define
name|vsnprintf
value|my_vsnprintf
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SNPRINTF_TEST */
end_comment

begin_function_decl
name|int
name|snprintf
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|vsnprintf
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|arg
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  * Very portable snprintf implementation, limited in functionality,  * esp. for %[capital] %[nonportable] and so on.  Reduced float functionality,  * mostly in formatting and range (e+-16), for %f and %g.  *  * %s, %d, %u, %i, %x, %c, %n and %% are fully supported.  *   This includes width, precision, flags 0- +, and *(arg for wid,prec).  * %f, %g, %m, %p have reduced support, support for wid,prec,flags,*, but  *   less floating point range, no %e formatting for %g.  */
end_comment

begin_function
name|int
name|snprintf
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
block|{
name|int
name|r
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|r
operator|=
name|vsnprintf
argument_list|(
name|str
argument_list|,
name|size
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|r
return|;
block|}
end_function

begin_comment
comment|/** add padding to string */
end_comment

begin_function
specifier|static
name|void
name|print_pad
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|char
name|p
parameter_list|,
name|int
name|num
parameter_list|)
block|{
while|while
condition|(
name|num
operator|--
condition|)
block|{
if|if
condition|(
operator|*
name|left
operator|>
literal|1
condition|)
block|{
operator|*
operator|(
operator|*
name|at
operator|)
operator|++
operator|=
name|p
expr_stmt|;
operator|(
operator|*
name|left
operator|)
operator|--
expr_stmt|;
block|}
operator|(
operator|*
name|ret
operator|)
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** get negative symbol, 0 if none */
end_comment

begin_function
specifier|static
name|char
name|get_negsign
parameter_list|(
name|int
name|negative
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
if|if
condition|(
name|negative
condition|)
return|return
literal|'-'
return|;
if|if
condition|(
name|plus
condition|)
return|return
literal|'+'
return|;
if|if
condition|(
name|space
condition|)
return|return
literal|' '
return|;
return|return
literal|0
return|;
block|}
end_function

begin_define
define|#
directive|define
name|PRINT_DEC_BUFSZ
value|32
end_define

begin_comment
comment|/* 20 is enough for 64 bit decimals */
end_comment

begin_comment
comment|/** print decimal into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_dec
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|int
name|value
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
literal|'0'
operator|+
name|value
operator|%
literal|10
expr_stmt|;
name|value
operator|/=
literal|10
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** print long decimal into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_dec_l
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|long
name|value
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
literal|'0'
operator|+
name|value
operator|%
literal|10
expr_stmt|;
name|value
operator|/=
literal|10
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** print long decimal into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_dec_ll
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|long
name|long
name|value
parameter_list|)
block|{
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
literal|'0'
operator|+
name|value
operator|%
literal|10
expr_stmt|;
name|value
operator|/=
literal|10
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** print hex into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_hex
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|int
name|value
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|h
init|=
literal|"0123456789abcdef"
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
name|h
index|[
name|value
operator|&
literal|0x0f
index|]
expr_stmt|;
name|value
operator|>>=
literal|4
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** print long hex into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_hex_l
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|long
name|value
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|h
init|=
literal|"0123456789abcdef"
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
name|h
index|[
name|value
operator|&
literal|0x0f
index|]
expr_stmt|;
name|value
operator|>>=
literal|4
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** print long long hex into buffer, returns length */
end_comment

begin_function
specifier|static
name|int
name|print_hex_ll
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|unsigned
name|long
name|long
name|value
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|h
init|=
literal|"0123456789abcdef"
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|value
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|max
operator|>
literal|0
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|i
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
name|value
operator|&&
name|i
operator|<
name|max
condition|)
block|{
name|buf
index|[
name|i
operator|++
index|]
operator|=
name|h
index|[
name|value
operator|&
literal|0x0f
index|]
expr_stmt|;
name|value
operator|>>=
literal|4
expr_stmt|;
block|}
return|return
name|i
return|;
block|}
end_function

begin_comment
comment|/** copy string into result, reversed */
end_comment

begin_function
specifier|static
name|void
name|spool_str_rev
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
specifier|const
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|i
init|=
name|len
decl_stmt|;
while|while
condition|(
name|i
condition|)
block|{
if|if
condition|(
operator|*
name|left
operator|>
literal|1
condition|)
block|{
operator|*
operator|(
operator|*
name|at
operator|)
operator|++
operator|=
name|buf
index|[
operator|--
name|i
index|]
expr_stmt|;
operator|(
operator|*
name|left
operator|)
operator|--
expr_stmt|;
block|}
else|else
operator|--
name|i
expr_stmt|;
operator|(
operator|*
name|ret
operator|)
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** copy string into result */
end_comment

begin_function
specifier|static
name|void
name|spool_str
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
specifier|const
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|left
operator|>
literal|1
condition|)
block|{
operator|*
operator|(
operator|*
name|at
operator|)
operator|++
operator|=
name|buf
index|[
name|i
index|]
expr_stmt|;
operator|(
operator|*
name|left
operator|)
operator|--
expr_stmt|;
block|}
operator|(
operator|*
name|ret
operator|)
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** print number formatted */
end_comment

begin_function
specifier|static
name|void
name|print_num
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|,
name|int
name|zero
parameter_list|,
name|int
name|negative
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|w
init|=
name|len
decl_stmt|;
comment|/* excludes minus sign */
name|char
name|s
init|=
name|get_negsign
argument_list|(
name|negative
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
decl_stmt|;
if|if
condition|(
name|minus
condition|)
block|{
comment|/* left adjust the number into the field, space padding */
comment|/* calc numw = [sign][zeroes][number] */
name|int
name|numw
init|=
name|w
decl_stmt|;
if|if
condition|(
name|precision
operator|==
literal|0
operator|&&
name|zero
condition|)
name|numw
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|numw
operator|<
name|precision
condition|)
name|numw
operator|=
name|precision
expr_stmt|;
if|if
condition|(
name|s
condition|)
name|numw
operator|++
expr_stmt|;
comment|/* sign */
if|if
condition|(
name|s
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|s
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* number */
if|if
condition|(
name|precision
operator|==
literal|0
operator|&&
name|zero
condition|)
block|{
comment|/* "" for the number */
block|}
else|else
block|{
if|if
condition|(
name|w
operator|<
name|precision
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|'0'
argument_list|,
name|precision
operator|-
name|w
argument_list|)
expr_stmt|;
name|spool_str_rev
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
comment|/* spaces */
if|if
condition|(
name|numw
operator|<
name|minw
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
name|numw
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* pad on the left of the number */
comment|/* calculate numw has width of [sign][zeroes][number] */
name|int
name|numw
init|=
name|w
decl_stmt|;
if|if
condition|(
name|precision
operator|==
literal|0
operator|&&
name|zero
condition|)
name|numw
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|numw
operator|<
name|precision
condition|)
name|numw
operator|=
name|precision
expr_stmt|;
if|if
condition|(
operator|!
name|prgiven
operator|&&
name|zeropad
operator|&&
name|numw
operator|<
name|minw
condition|)
name|numw
operator|=
name|minw
expr_stmt|;
elseif|else
if|if
condition|(
name|s
condition|)
name|numw
operator|++
expr_stmt|;
comment|/* pad with spaces */
if|if
condition|(
name|numw
operator|<
name|minw
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
name|numw
argument_list|)
expr_stmt|;
comment|/* print sign (and one less zeropad if so) */
if|if
condition|(
name|s
condition|)
block|{
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|s
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|numw
operator|--
expr_stmt|;
block|}
comment|/* pad with zeroes */
if|if
condition|(
name|w
operator|<
name|numw
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|'0'
argument_list|,
name|numw
operator|-
name|w
argument_list|)
expr_stmt|;
if|if
condition|(
name|precision
operator|==
literal|0
operator|&&
name|zero
condition|)
return|return;
comment|/* print the characters for the value */
name|spool_str_rev
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/** print %d and %i */
end_comment

begin_function
specifier|static
name|void
name|print_num_d
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|int
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
operator|(
name|value
operator|<
literal|0
operator|)
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
call|(
name|unsigned
name|int
call|)
argument_list|(
name|negative
condition|?
operator|-
name|value
else|:
name|value
argument_list|)
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %ld and %li */
end_comment

begin_function
specifier|static
name|void
name|print_num_ld
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
operator|(
name|value
operator|<
literal|0
operator|)
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec_l
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
name|negative
condition|?
operator|-
name|value
else|:
name|value
argument_list|)
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %lld and %lli */
end_comment

begin_function
specifier|static
name|void
name|print_num_lld
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|long
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
operator|(
name|value
operator|<
literal|0
operator|)
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec_ll
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
name|negative
condition|?
operator|-
name|value
else|:
name|value
argument_list|)
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %u */
end_comment

begin_function
specifier|static
name|void
name|print_num_u
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|int
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %lu */
end_comment

begin_function
specifier|static
name|void
name|print_num_lu
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec_l
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %llu */
end_comment

begin_function
specifier|static
name|void
name|print_num_llu
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|long
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_dec_ll
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %x */
end_comment

begin_function
specifier|static
name|void
name|print_num_x
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|int
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_hex
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %lx */
end_comment

begin_function
specifier|static
name|void
name|print_num_lx
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_hex_l
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %llx */
end_comment

begin_function
specifier|static
name|void
name|print_num_llx
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|unsigned
name|long
name|long
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
name|int
name|len
init|=
name|print_hex_ll
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|value
argument_list|)
decl_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %llp */
end_comment

begin_function
specifier|static
name|void
name|print_num_llp
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|void
modifier|*
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_DEC_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
literal|0
decl_stmt|;
name|int
name|zero
init|=
operator|(
name|value
operator|==
literal|0
operator|)
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|UINTPTR_MAX
argument_list|)
operator|&&
name|defined
argument_list|(
name|UINT32_MAX
argument_list|)
operator|&&
operator|(
name|UINTPTR_MAX
operator|==
name|UINT32_MAX
operator|)
comment|/* avoid warning about upcast on 32bit systems */
name|unsigned
name|long
name|long
name|llvalue
init|=
operator|(
name|unsigned
name|long
operator|)
name|value
decl_stmt|;
else|#
directive|else
name|unsigned
name|long
name|long
name|llvalue
init|=
operator|(
name|unsigned
name|long
name|long
operator|)
name|value
decl_stmt|;
endif|#
directive|endif
name|int
name|len
init|=
name|print_hex_ll
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|llvalue
argument_list|)
decl_stmt|;
if|if
condition|(
name|zero
condition|)
block|{
name|buf
index|[
literal|0
index|]
operator|=
literal|')'
expr_stmt|;
name|buf
index|[
literal|1
index|]
operator|=
literal|'l'
expr_stmt|;
name|buf
index|[
literal|2
index|]
operator|=
literal|'i'
expr_stmt|;
name|buf
index|[
literal|3
index|]
operator|=
literal|'n'
expr_stmt|;
name|buf
index|[
literal|4
index|]
operator|=
literal|'('
expr_stmt|;
name|len
operator|=
literal|5
expr_stmt|;
block|}
else|else
block|{
comment|/* put '0x' in front of the (reversed) buffer result */
if|if
condition|(
name|len
operator|<
name|PRINT_DEC_BUFSZ
condition|)
name|buf
index|[
name|len
operator|++
index|]
operator|=
literal|'x'
expr_stmt|;
if|if
condition|(
name|len
operator|<
name|PRINT_DEC_BUFSZ
condition|)
name|buf
index|[
name|len
operator|++
index|]
operator|=
literal|'0'
expr_stmt|;
block|}
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|PRINT_FLOAT_BUFSZ
value|64
end_define

begin_comment
comment|/* xx.yy with 20.20 about the max */
end_comment

begin_comment
comment|/** spool remainder after the decimal point to buffer, in reverse */
end_comment

begin_function
specifier|static
name|int
name|print_remainder
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|double
name|r
parameter_list|,
name|int
name|prec
parameter_list|)
block|{
name|unsigned
name|long
name|long
name|cap
init|=
literal|1
decl_stmt|;
name|unsigned
name|long
name|long
name|value
decl_stmt|;
name|int
name|len
decl_stmt|,
name|i
decl_stmt|;
if|if
condition|(
name|prec
operator|>
literal|19
condition|)
name|prec
operator|=
literal|19
expr_stmt|;
comment|/* max we can do */
if|if
condition|(
name|max
operator|<
name|prec
condition|)
return|return
literal|0
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|prec
condition|;
name|i
operator|++
control|)
block|{
name|cap
operator|*=
literal|10
expr_stmt|;
block|}
name|r
operator|*=
operator|(
name|double
operator|)
name|cap
expr_stmt|;
name|value
operator|=
operator|(
name|unsigned
name|long
name|long
operator|)
name|r
expr_stmt|;
comment|/* see if we need to round up */
if|if
condition|(
operator|(
call|(
name|unsigned
name|long
name|long
call|)
argument_list|(
operator|(
name|r
operator|-
operator|(
name|double
operator|)
name|value
operator|)
operator|*
literal|10.0
argument_list|)
operator|)
operator|>=
literal|5
condition|)
block|{
name|value
operator|++
expr_stmt|;
comment|/* that might carry to numbers before the comma, if so, 		 * just ignore that rounding. failure because 64bitprintout */
if|if
condition|(
name|value
operator|>=
name|cap
condition|)
name|value
operator|=
name|cap
operator|-
literal|1
expr_stmt|;
block|}
name|len
operator|=
name|print_dec_ll
argument_list|(
name|buf
argument_list|,
name|max
argument_list|,
name|value
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
operator|<
name|prec
condition|)
block|{
comment|/* pad with zeroes, e.g. if 0.0012 */
name|buf
index|[
name|len
operator|++
index|]
operator|=
literal|'0'
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|<
name|max
condition|)
name|buf
index|[
name|len
operator|++
index|]
operator|=
literal|'.'
expr_stmt|;
return|return
name|len
return|;
block|}
end_function

begin_comment
comment|/** spool floating point to buffer */
end_comment

begin_function
specifier|static
name|int
name|print_float
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|double
name|value
parameter_list|,
name|int
name|prec
parameter_list|)
block|{
comment|/* as xxx.xxx  if prec==0, no '.', with prec decimals after . */
comment|/* no conversion for NAN and INF, because we do not want to require 	   linking with -lm. */
comment|/* Thus, the conversions use 64bit integers to convert the numbers, 	 * which makes 19 digits before and after the decimal point the max */
name|unsigned
name|long
name|long
name|whole
init|=
operator|(
name|unsigned
name|long
name|long
operator|)
name|value
decl_stmt|;
name|double
name|remain
init|=
name|value
operator|-
operator|(
name|double
operator|)
name|whole
decl_stmt|;
name|int
name|len
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|prec
operator|!=
literal|0
condition|)
name|len
operator|=
name|print_remainder
argument_list|(
name|buf
argument_list|,
name|max
argument_list|,
name|remain
argument_list|,
name|prec
argument_list|)
expr_stmt|;
name|len
operator|+=
name|print_dec_ll
argument_list|(
name|buf
operator|+
name|len
argument_list|,
name|max
operator|-
name|len
argument_list|,
name|whole
argument_list|)
expr_stmt|;
return|return
name|len
return|;
block|}
end_function

begin_comment
comment|/** print %f */
end_comment

begin_function
specifier|static
name|void
name|print_num_f
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|double
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_FLOAT_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
operator|(
name|value
operator|<
literal|0
operator|)
decl_stmt|;
name|int
name|zero
init|=
literal|0
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
operator|!
name|prgiven
condition|)
name|precision
operator|=
literal|6
expr_stmt|;
name|len
operator|=
name|print_float
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|negative
condition|?
operator|-
name|value
else|:
name|value
argument_list|,
name|precision
argument_list|)
expr_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* rudimentary %g support */
end_comment

begin_function
specifier|static
name|int
name|print_float_g
parameter_list|(
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|max
parameter_list|,
name|double
name|value
parameter_list|,
name|int
name|prec
parameter_list|)
block|{
name|unsigned
name|long
name|long
name|whole
init|=
operator|(
name|unsigned
name|long
name|long
operator|)
name|value
decl_stmt|;
name|double
name|remain
init|=
name|value
operator|-
operator|(
name|double
operator|)
name|whole
decl_stmt|;
name|int
name|before
init|=
literal|0
decl_stmt|;
name|int
name|len
init|=
literal|0
decl_stmt|;
comment|/* number of digits before the decimal point */
while|while
condition|(
name|whole
operator|>
literal|0
condition|)
block|{
name|before
operator|++
expr_stmt|;
name|whole
operator|/=
literal|10
expr_stmt|;
block|}
name|whole
operator|=
operator|(
name|unsigned
name|long
name|long
operator|)
name|value
expr_stmt|;
if|if
condition|(
name|prec
operator|>
name|before
operator|&&
name|remain
operator|!=
literal|0.0
condition|)
block|{
comment|/* see if the last decimals are zero, if so, skip them */
name|len
operator|=
name|print_remainder
argument_list|(
name|buf
argument_list|,
name|max
argument_list|,
name|remain
argument_list|,
name|prec
operator|-
name|before
argument_list|)
expr_stmt|;
while|while
condition|(
name|len
operator|>
literal|0
operator|&&
name|buf
index|[
literal|0
index|]
operator|==
literal|'0'
condition|)
block|{
name|memmove
argument_list|(
name|buf
argument_list|,
name|buf
operator|+
literal|1
argument_list|,
operator|--
name|len
argument_list|)
expr_stmt|;
block|}
block|}
name|len
operator|+=
name|print_dec_ll
argument_list|(
name|buf
operator|+
name|len
argument_list|,
name|max
operator|-
name|len
argument_list|,
name|whole
argument_list|)
expr_stmt|;
return|return
name|len
return|;
block|}
end_function

begin_comment
comment|/** print %g */
end_comment

begin_function
specifier|static
name|void
name|print_num_g
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|double
name|value
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|zeropad
parameter_list|,
name|int
name|minus
parameter_list|,
name|int
name|plus
parameter_list|,
name|int
name|space
parameter_list|)
block|{
name|char
name|buf
index|[
name|PRINT_FLOAT_BUFSZ
index|]
decl_stmt|;
name|int
name|negative
init|=
operator|(
name|value
operator|<
literal|0
operator|)
decl_stmt|;
name|int
name|zero
init|=
literal|0
decl_stmt|;
name|int
name|len
decl_stmt|;
if|if
condition|(
operator|!
name|prgiven
condition|)
name|precision
operator|=
literal|6
expr_stmt|;
if|if
condition|(
name|precision
operator|==
literal|0
condition|)
name|precision
operator|=
literal|1
expr_stmt|;
name|len
operator|=
name|print_float_g
argument_list|(
name|buf
argument_list|,
operator|(
name|int
operator|)
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|negative
condition|?
operator|-
name|value
else|:
name|value
argument_list|,
name|precision
argument_list|)
expr_stmt|;
name|print_num
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|minw
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|,
name|zero
argument_list|,
name|negative
argument_list|,
name|buf
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** strnlen (compat implementation) */
end_comment

begin_function
specifier|static
name|int
name|my_strnlen
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|int
name|max
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|max
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|s
index|[
name|i
index|]
operator|==
literal|0
condition|)
return|return
name|i
return|;
return|return
name|max
return|;
block|}
end_function

begin_comment
comment|/** print %s */
end_comment

begin_function
specifier|static
name|void
name|print_str
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|char
modifier|*
name|s
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|precision
parameter_list|,
name|int
name|prgiven
parameter_list|,
name|int
name|minus
parameter_list|)
block|{
name|int
name|w
decl_stmt|;
comment|/* with prec: no more than x characters from this string, stop at 0 */
if|if
condition|(
name|prgiven
condition|)
name|w
operator|=
name|my_strnlen
argument_list|(
name|s
argument_list|,
name|precision
argument_list|)
expr_stmt|;
else|else
name|w
operator|=
operator|(
name|int
operator|)
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
comment|/* up to the nul */
if|if
condition|(
name|w
operator|<
name|minw
operator|&&
operator|!
name|minus
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
name|w
argument_list|)
expr_stmt|;
name|spool_str
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|s
argument_list|,
name|w
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|<
name|minw
operator|&&
name|minus
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
name|w
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** print %c */
end_comment

begin_function
specifier|static
name|void
name|print_char
parameter_list|(
name|char
modifier|*
modifier|*
name|at
parameter_list|,
name|size_t
modifier|*
name|left
parameter_list|,
name|int
modifier|*
name|ret
parameter_list|,
name|int
name|c
parameter_list|,
name|int
name|minw
parameter_list|,
name|int
name|minus
parameter_list|)
block|{
if|if
condition|(
literal|1
operator|<
name|minw
operator|&&
operator|!
name|minus
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
literal|1
argument_list|)
expr_stmt|;
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
name|c
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
literal|1
operator|<
name|minw
operator|&&
name|minus
condition|)
name|print_pad
argument_list|(
name|at
argument_list|,
name|left
argument_list|,
name|ret
argument_list|,
literal|' '
argument_list|,
name|minw
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**   * Print to string.  * str: string buffer for result. result will be null terminated.  * size: size of the buffer. null is put inside buffer.  * format: printf format string.  * arg: '...' arguments to print.  * returns number of characters. a null is printed after this.  * return number of bytes that would have been written  *	   if the buffer had been large enough.  *   * supported format specifiers:  * 	%s, %u, %d, %x, %i, %f, %g, %c, %p, %n.  * 	length: l, ll (for d, u, x).  * 	precision: 6.6d (for d, u, x)  * 		%f, %g precisions, 0.3f  * 		%20s, '.*s'  * 	and %%.  */
end_comment

begin_function
name|int
name|vsnprintf
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|size_t
name|size
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
name|va_list
name|arg
parameter_list|)
block|{
name|char
modifier|*
name|at
init|=
name|str
decl_stmt|;
name|size_t
name|left
init|=
name|size
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
specifier|const
name|char
modifier|*
name|fmt
init|=
name|format
decl_stmt|;
name|int
name|conv
decl_stmt|,
name|minw
decl_stmt|,
name|precision
decl_stmt|,
name|prgiven
decl_stmt|,
name|zeropad
decl_stmt|,
name|minus
decl_stmt|,
name|plus
decl_stmt|,
name|space
decl_stmt|,
name|length
decl_stmt|;
while|while
condition|(
operator|*
name|fmt
condition|)
block|{
comment|/* copy string before % */
while|while
condition|(
operator|*
name|fmt
operator|&&
operator|*
name|fmt
operator|!=
literal|'%'
condition|)
block|{
if|if
condition|(
name|left
operator|>
literal|1
condition|)
block|{
operator|*
name|at
operator|++
operator|=
operator|*
name|fmt
operator|++
expr_stmt|;
name|left
operator|--
expr_stmt|;
block|}
else|else
name|fmt
operator|++
expr_stmt|;
name|ret
operator|++
expr_stmt|;
block|}
comment|/* see if we are at end */
if|if
condition|(
operator|!
operator|*
name|fmt
condition|)
break|break;
comment|/* fetch next argument % designation from format string */
name|fmt
operator|++
expr_stmt|;
comment|/* skip the '%' */
comment|/********************************/
comment|/* get the argument designation */
comment|/********************************/
comment|/* we must do this vararg stuff inside this function for 		 * portability.  Hence, get_designation, and print_designation 		 * are not their own functions. */
comment|/* printout designation: 		 * conversion specifier: x, d, u, s, c, n, m, p 		 * flags: # not supported 		 *        0 zeropad (on the left) 		 *	  - left adjust (right by default) 		 *	  ' ' printspace for positive number (in - position). 		 *	  + alwayssign 		 * fieldwidth: [1-9][0-9]* minimum field width. 		 * 	if this is * then type int next argument specifies the minwidth. 		 * 	if this is negative, the - flag is set (with positive width). 		 * precision: period[digits]*, %.2x. 		 * 	if this is * then type int next argument specifies the precision. 		 *	just '.' or negative value means precision=0. 		 *		this is mindigits to print for d, i, u, x 		 *		this is aftercomma digits for f 		 *		this is max number significant digits for g 		 *		maxnumber characters to be printed for s 		 * length: 0-none (int), 1-l (long), 2-ll (long long) 		 * 	notsupported: hh (char), h (short), L (long double), q, j, z, t 		 * Does not support %m$ and *m$ argument designation as array indices. 		 * Does not support %#x 		 * 		 */
name|minw
operator|=
literal|0
expr_stmt|;
name|precision
operator|=
literal|1
expr_stmt|;
name|prgiven
operator|=
literal|0
expr_stmt|;
name|zeropad
operator|=
literal|0
expr_stmt|;
name|minus
operator|=
literal|0
expr_stmt|;
name|plus
operator|=
literal|0
expr_stmt|;
name|space
operator|=
literal|0
expr_stmt|;
name|length
operator|=
literal|0
expr_stmt|;
comment|/* get flags in any order */
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'0'
condition|)
name|zeropad
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'-'
condition|)
name|minus
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'+'
condition|)
name|plus
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|fmt
operator|==
literal|' '
condition|)
name|space
operator|=
literal|1
expr_stmt|;
else|else
break|break;
name|fmt
operator|++
expr_stmt|;
block|}
comment|/* field width */
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'*'
condition|)
block|{
name|fmt
operator|++
expr_stmt|;
comment|/* skip char */
name|minw
operator|=
name|va_arg
argument_list|(
name|arg
argument_list|,
name|int
argument_list|)
expr_stmt|;
if|if
condition|(
name|minw
operator|<
literal|0
condition|)
block|{
name|minus
operator|=
literal|1
expr_stmt|;
name|minw
operator|=
operator|-
name|minw
expr_stmt|;
block|}
block|}
else|else
while|while
condition|(
operator|*
name|fmt
operator|>=
literal|'0'
operator|&&
operator|*
name|fmt
operator|<=
literal|'9'
condition|)
block|{
name|minw
operator|=
name|minw
operator|*
literal|10
operator|+
operator|(
operator|*
name|fmt
operator|++
operator|)
operator|-
literal|'0'
expr_stmt|;
block|}
comment|/* precision */
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'.'
condition|)
block|{
name|fmt
operator|++
expr_stmt|;
comment|/* skip period */
name|prgiven
operator|=
literal|1
expr_stmt|;
name|precision
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'*'
condition|)
block|{
name|fmt
operator|++
expr_stmt|;
comment|/* skip char */
name|precision
operator|=
name|va_arg
argument_list|(
name|arg
argument_list|,
name|int
argument_list|)
expr_stmt|;
if|if
condition|(
name|precision
operator|<
literal|0
condition|)
name|precision
operator|=
literal|0
expr_stmt|;
block|}
else|else
while|while
condition|(
operator|*
name|fmt
operator|>=
literal|'0'
operator|&&
operator|*
name|fmt
operator|<=
literal|'9'
condition|)
block|{
name|precision
operator|=
name|precision
operator|*
literal|10
operator|+
operator|(
operator|*
name|fmt
operator|++
operator|)
operator|-
literal|'0'
expr_stmt|;
block|}
block|}
comment|/* length */
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'l'
condition|)
block|{
name|fmt
operator|++
expr_stmt|;
comment|/* skip char */
name|length
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'l'
condition|)
block|{
name|fmt
operator|++
expr_stmt|;
comment|/* skip char */
name|length
operator|=
literal|2
expr_stmt|;
block|}
block|}
comment|/* get the conversion */
if|if
condition|(
operator|!
operator|*
name|fmt
condition|)
name|conv
operator|=
literal|0
expr_stmt|;
else|else
name|conv
operator|=
operator|*
name|fmt
operator|++
expr_stmt|;
comment|/***********************************/
comment|/* print that argument designation */
comment|/***********************************/
switch|switch
condition|(
name|conv
condition|)
block|{
case|case
literal|'i'
case|:
case|case
literal|'d'
case|:
if|if
condition|(
name|length
operator|==
literal|0
condition|)
name|print_num_d
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|int
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|1
condition|)
name|print_num_ld
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|2
condition|)
name|print_num_lld
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|long long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'u'
case|:
if|if
condition|(
name|length
operator|==
literal|0
condition|)
name|print_num_u
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned int
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|1
condition|)
name|print_num_lu
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|2
condition|)
name|print_num_llu
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned long long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'x'
case|:
if|if
condition|(
name|length
operator|==
literal|0
condition|)
name|print_num_x
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned int
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|1
condition|)
name|print_num_lx
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|length
operator|==
literal|2
condition|)
name|print_num_llx
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
argument|arg
argument_list|,
argument|unsigned long long
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|print_str
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|char
operator|*
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|minus
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|print_char
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|int
argument_list|)
argument_list|,
name|minw
argument_list|,
name|minus
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
operator|*
name|va_arg
argument_list|(
name|arg
argument_list|,
name|int
operator|*
argument_list|)
operator|=
name|ret
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|print_str
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|minus
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|print_num_llp
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|void
operator|*
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'%'
case|:
name|print_pad
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
literal|'%'
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
name|print_num_f
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|double
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'g'
case|:
name|print_num_g
argument_list|(
operator|&
name|at
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|ret
argument_list|,
name|va_arg
argument_list|(
name|arg
argument_list|,
name|double
argument_list|)
argument_list|,
name|minw
argument_list|,
name|precision
argument_list|,
name|prgiven
argument_list|,
name|zeropad
argument_list|,
name|minus
argument_list|,
name|plus
argument_list|,
name|space
argument_list|)
expr_stmt|;
break|break;
comment|/* unknown */
default|default:
case|case
literal|0
case|:
break|break;
block|}
block|}
comment|/* zero terminate */
if|if
condition|(
name|left
operator|>
literal|0
condition|)
operator|*
name|at
operator|=
literal|0
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|SNPRINTF_TEST
end_ifdef

begin_comment
comment|/** do tests */
end_comment

begin_undef
undef|#
directive|undef
name|snprintf
end_undef

begin_define
define|#
directive|define
name|DOTEST
parameter_list|(
name|bufsz
parameter_list|,
name|result
parameter_list|,
name|retval
parameter_list|,
modifier|...
parameter_list|)
value|do { \ 	char buf[bufsz]; \ 	printf("now test %s\n", #__VA_ARGS__); \ 	int r=my_snprintf(buf, sizeof(buf), __VA_ARGS__); \ 	if(r != retval || strcmp(buf, result) != 0) { \ 		printf("error test(%s) was \"%s\":%d\n", \ 			""#bufsz", "#result", "#retval", "#__VA_ARGS__, \ 			buf, r); \ 		exit(1); \ 		} \ 	r=snprintf(buf, sizeof(buf), __VA_ARGS__); \ 	if(r != retval || strcmp(buf, result) != 0) { \ 		printf("error test(%s) differs with system, \"%s\":%d\n", \ 			""#bufsz", "#result", "#retval", "#__VA_ARGS__, \ 			buf, r); \ 		exit(1); \ 		} \ 	printf("test(\"%s\":%d) passed\n", buf, r); \ 	} while(0);
end_define

begin_comment
comment|/** test program */
end_comment

begin_function
name|int
name|main
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|x
init|=
literal|0
decl_stmt|;
comment|/* bufsize, expectedstring, expectedretval, snprintf arguments */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello"
argument_list|,
literal|5
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"h"
argument_list|,
literal|1
argument_list|,
literal|"h"
argument_list|)
expr_stmt|;
comment|/* warning from gcc for format string, but it does work 	 * DOTEST(1024, "", 0, ""); */
name|DOTEST
argument_list|(
literal|3
argument_list|,
literal|"he"
argument_list|,
literal|5
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1
argument_list|,
literal|""
argument_list|,
literal|7
argument_list|,
literal|"%d"
argument_list|,
literal|7823089
argument_list|)
expr_stmt|;
comment|/* test positive numbers */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0"
argument_list|,
literal|1
argument_list|,
literal|"%d"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"1"
argument_list|,
literal|1
argument_list|,
literal|"%d"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"9"
argument_list|,
literal|1
argument_list|,
literal|"%d"
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"15"
argument_list|,
literal|2
argument_list|,
literal|"%d"
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"ab15cd"
argument_list|,
literal|6
argument_list|,
literal|"ab%dcd"
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"167"
argument_list|,
literal|3
argument_list|,
literal|"%d"
argument_list|,
literal|167
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"7823089"
argument_list|,
literal|7
argument_list|,
literal|"%d"
argument_list|,
literal|7823089
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" 12"
argument_list|,
literal|3
argument_list|,
literal|"%3d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012"
argument_list|,
literal|3
argument_list|,
literal|"%.3d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012"
argument_list|,
literal|3
argument_list|,
literal|"%3.3d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012"
argument_list|,
literal|3
argument_list|,
literal|"%03d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" 012"
argument_list|,
literal|4
argument_list|,
literal|"%4.3d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|""
argument_list|,
literal|0
argument_list|,
literal|"%.0d"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* test negative numbers */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-1"
argument_list|,
literal|2
argument_list|,
literal|"%d"
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-12"
argument_list|,
literal|3
argument_list|,
literal|"%3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" -2"
argument_list|,
literal|3
argument_list|,
literal|"%3d"
argument_list|,
operator|-
literal|2
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-012"
argument_list|,
literal|4
argument_list|,
literal|"%.3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-012"
argument_list|,
literal|4
argument_list|,
literal|"%3.3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-012"
argument_list|,
literal|4
argument_list|,
literal|"%4.3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" -012"
argument_list|,
literal|5
argument_list|,
literal|"%5.3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-12"
argument_list|,
literal|3
argument_list|,
literal|"%03d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-02"
argument_list|,
literal|3
argument_list|,
literal|"%03d"
argument_list|,
operator|-
literal|2
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-15"
argument_list|,
literal|3
argument_list|,
literal|"%d"
argument_list|,
operator|-
literal|15
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-7307"
argument_list|,
literal|5
argument_list|,
literal|"%d"
argument_list|,
operator|-
literal|7307
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-12  "
argument_list|,
literal|5
argument_list|,
literal|"%-5d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-00012"
argument_list|,
literal|6
argument_list|,
literal|"%-.5d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
comment|/* test + and space flags */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"+12"
argument_list|,
literal|3
argument_list|,
literal|"%+d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" 12"
argument_list|,
literal|3
argument_list|,
literal|"% d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
comment|/* test %u */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12"
argument_list|,
literal|2
argument_list|,
literal|"%u"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0"
argument_list|,
literal|1
argument_list|,
literal|"%u"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"4294967295"
argument_list|,
literal|10
argument_list|,
literal|"%u"
argument_list|,
literal|0xffffffff
argument_list|)
expr_stmt|;
comment|/* test %x */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0"
argument_list|,
literal|1
argument_list|,
literal|"%x"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"c"
argument_list|,
literal|1
argument_list|,
literal|"%x"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12ab34cd"
argument_list|,
literal|8
argument_list|,
literal|"%x"
argument_list|,
literal|0x12ab34cd
argument_list|)
expr_stmt|;
comment|/* test %llu, %lld */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"18446744073709551615"
argument_list|,
literal|20
argument_list|,
literal|"%llu"
argument_list|,
operator|(
name|long
name|long
operator|)
literal|0xffffffffffffffff
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-9223372036854775808"
argument_list|,
literal|20
argument_list|,
literal|"%lld"
argument_list|,
operator|(
name|long
name|long
operator|)
literal|0x8000000000000000
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"9223372036854775808"
argument_list|,
literal|19
argument_list|,
literal|"%llu"
argument_list|,
operator|(
name|long
name|long
operator|)
literal|0x8000000000000000
argument_list|)
expr_stmt|;
comment|/* test %s */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello"
argument_list|,
literal|5
argument_list|,
literal|"%s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"     hello"
argument_list|,
literal|10
argument_list|,
literal|"%10s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello     "
argument_list|,
literal|10
argument_list|,
literal|"%-10s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"he"
argument_list|,
literal|2
argument_list|,
literal|"%.2s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"  he"
argument_list|,
literal|4
argument_list|,
literal|"%4.2s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"   h"
argument_list|,
literal|4
argument_list|,
literal|"%4.2s"
argument_list|,
literal|"h"
argument_list|)
expr_stmt|;
comment|/* test %c */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"a"
argument_list|,
literal|1
argument_list|,
literal|"%c"
argument_list|,
literal|'a'
argument_list|)
expr_stmt|;
comment|/* warning from gcc for format string, but it does work 	   DOTEST(1024, "    a", 5, "%5c", 'a'); 	   DOTEST(1024, "a", 1, "%.0c", 'a'); */
comment|/* test %n */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello"
argument_list|,
literal|5
argument_list|,
literal|"hello%n"
argument_list|,
operator|&
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|!=
literal|5
condition|)
block|{
name|printf
argument_list|(
literal|"the %%n failed\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* test %m */
name|errno
operator|=
literal|0
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"Success"
argument_list|,
literal|7
argument_list|,
literal|"%m"
argument_list|)
expr_stmt|;
comment|/* test %p */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0x10"
argument_list|,
literal|4
argument_list|,
literal|"%p"
argument_list|,
operator|(
name|void
operator|*
operator|)
literal|0x10
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"(nil)"
argument_list|,
literal|5
argument_list|,
literal|"%p"
argument_list|,
operator|(
name|void
operator|*
operator|)
literal|0x0
argument_list|)
expr_stmt|;
comment|/* test %% */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"%"
argument_list|,
literal|1
argument_list|,
literal|"%%"
argument_list|)
expr_stmt|;
comment|/* test %f */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0.000000"
argument_list|,
literal|8
argument_list|,
literal|"%f"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0.00"
argument_list|,
literal|4
argument_list|,
literal|"%.2f"
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
comment|/* differs, "-0.00" DOTEST(1024, "0.00", 4, "%.2f", -0.0); */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"234.00"
argument_list|,
literal|6
argument_list|,
literal|"%.2f"
argument_list|,
literal|234.005
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"8973497.1246"
argument_list|,
literal|12
argument_list|,
literal|"%.4f"
argument_list|,
literal|8973497.12456
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-12.000000"
argument_list|,
literal|10
argument_list|,
literal|"%f"
argument_list|,
operator|-
literal|12.0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"6"
argument_list|,
literal|1
argument_list|,
literal|"%.0f"
argument_list|,
literal|6.0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"6"
argument_list|,
literal|1
argument_list|,
literal|"%g"
argument_list|,
literal|6.0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"6.1"
argument_list|,
literal|3
argument_list|,
literal|"%g"
argument_list|,
literal|6.1
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"6.15"
argument_list|,
literal|4
argument_list|,
literal|"%g"
argument_list|,
literal|6.15
argument_list|)
expr_stmt|;
comment|/* These format strings are from the code of NSD, Unbound, ldns */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"abcdef"
argument_list|,
literal|6
argument_list|,
literal|"%s"
argument_list|,
literal|"abcdef"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"005"
argument_list|,
literal|3
argument_list|,
literal|"%03u"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%03u"
argument_list|,
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"5"
argument_list|,
literal|1
argument_list|,
literal|"%d"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"(nil)"
argument_list|,
literal|5
argument_list|,
literal|"%p"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%ld"
argument_list|,
operator|(
name|long
operator|)
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%lu"
argument_list|,
operator|(
name|long
operator|)
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"       12345"
argument_list|,
literal|12
argument_list|,
literal|"%12u"
argument_list|,
operator|(
name|unsigned
operator|)
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%u"
argument_list|,
operator|(
name|unsigned
operator|)
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%llu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%x"
argument_list|,
literal|0x12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%llx"
argument_list|,
operator|(
name|long
name|long
operator|)
literal|0x12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012345"
argument_list|,
literal|6
argument_list|,
literal|"%6.6d"
argument_list|,
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012345"
argument_list|,
literal|6
argument_list|,
literal|"%6.6u"
argument_list|,
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"1234.54"
argument_list|,
literal|7
argument_list|,
literal|"%g"
argument_list|,
literal|1234.54
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"123456789.54"
argument_list|,
literal|12
argument_list|,
literal|"%.12g"
argument_list|,
literal|123456789.54
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"3456789123456.54"
argument_list|,
literal|16
argument_list|,
literal|"%.16g"
argument_list|,
literal|3456789123456.54
argument_list|)
expr_stmt|;
comment|/* %24g does not work with 24 digits, not enough accuracy, 	 * the first 16 digits are correct */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12345"
argument_list|,
literal|5
argument_list|,
literal|"%3.3d"
argument_list|,
literal|12345
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"000"
argument_list|,
literal|3
argument_list|,
literal|"%3.3d"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"001"
argument_list|,
literal|3
argument_list|,
literal|"%3.3d"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"012"
argument_list|,
literal|3
argument_list|,
literal|"%3.3d"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-012"
argument_list|,
literal|4
argument_list|,
literal|"%3.3d"
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"he"
argument_list|,
literal|2
argument_list|,
literal|"%.2s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"helloworld"
argument_list|,
literal|10
argument_list|,
literal|"%s%s"
argument_list|,
literal|"hello"
argument_list|,
literal|"world"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"he"
argument_list|,
literal|2
argument_list|,
literal|"%.*s"
argument_list|,
literal|2
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"  hello"
argument_list|,
literal|7
argument_list|,
literal|"%*s"
argument_list|,
literal|7
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello  "
argument_list|,
literal|7
argument_list|,
literal|"%*s"
argument_list|,
operator|-
literal|7
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0"
argument_list|,
literal|1
argument_list|,
literal|"%c"
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"A"
argument_list|,
literal|1
argument_list|,
literal|"%c"
argument_list|,
literal|'A'
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|""
argument_list|,
literal|1
argument_list|,
literal|"%c"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"\010"
argument_list|,
literal|1
argument_list|,
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"%"
argument_list|,
literal|1
argument_list|,
literal|"%%"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0a"
argument_list|,
literal|2
argument_list|,
literal|"%02x"
argument_list|,
literal|0x0a
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"bd"
argument_list|,
literal|2
argument_list|,
literal|"%02x"
argument_list|,
literal|0xbd
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"12"
argument_list|,
literal|2
argument_list|,
literal|"%02ld"
argument_list|,
operator|(
name|long
operator|)
literal|12
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"02"
argument_list|,
literal|2
argument_list|,
literal|"%02ld"
argument_list|,
operator|(
name|long
operator|)
literal|2
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"02"
argument_list|,
literal|2
argument_list|,
literal|"%02u"
argument_list|,
operator|(
name|unsigned
operator|)
literal|2
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"765432"
argument_list|,
literal|6
argument_list|,
literal|"%05u"
argument_list|,
operator|(
name|unsigned
operator|)
literal|765432
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"10.234"
argument_list|,
literal|6
argument_list|,
literal|"%0.3f"
argument_list|,
literal|10.23421
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"123456.234"
argument_list|,
literal|10
argument_list|,
literal|"%0.3f"
argument_list|,
literal|123456.23421
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"123456789.234"
argument_list|,
literal|13
argument_list|,
literal|"%0.3f"
argument_list|,
literal|123456789.23421
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"123456.23"
argument_list|,
literal|9
argument_list|,
literal|"%.2f"
argument_list|,
literal|123456.23421
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"123456"
argument_list|,
literal|6
argument_list|,
literal|"%.0f"
argument_list|,
literal|123456.23421
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"0123"
argument_list|,
literal|4
argument_list|,
literal|"%.4x"
argument_list|,
literal|0x0123
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"00000123"
argument_list|,
literal|8
argument_list|,
literal|"%.8x"
argument_list|,
literal|0x0123
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"ffeb0cde"
argument_list|,
literal|8
argument_list|,
literal|"%.8x"
argument_list|,
literal|0xffeb0cde
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|" 987654321"
argument_list|,
literal|10
argument_list|,
literal|"%10lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
literal|987654321
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"   987654321"
argument_list|,
literal|12
argument_list|,
literal|"%12lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
literal|987654321
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"987654321"
argument_list|,
literal|9
argument_list|,
literal|"%i"
argument_list|,
literal|987654321
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"-87654321"
argument_list|,
literal|9
argument_list|,
literal|"%i"
argument_list|,
operator|-
literal|87654321
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"hello           "
argument_list|,
literal|16
argument_list|,
literal|"%-16s"
argument_list|,
literal|"hello"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"                "
argument_list|,
literal|16
argument_list|,
literal|"%-16s"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"a               "
argument_list|,
literal|16
argument_list|,
literal|"%-16s"
argument_list|,
literal|"a"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"foobarfoobar    "
argument_list|,
literal|16
argument_list|,
literal|"%-16s"
argument_list|,
literal|"foobarfoobar"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"foobarfoobarfoobar"
argument_list|,
literal|18
argument_list|,
literal|"%-16s"
argument_list|,
literal|"foobarfoobarfoobar"
argument_list|)
expr_stmt|;
comment|/* combined expressions */
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"foo 1.0 size 512 edns"
argument_list|,
literal|21
argument_list|,
literal|"foo %s size %d %s%s"
argument_list|,
literal|"1.0"
argument_list|,
literal|512
argument_list|,
literal|""
argument_list|,
literal|"edns"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|15
argument_list|,
literal|"foo 1.0 size 5"
argument_list|,
literal|21
argument_list|,
literal|"foo %s size %d %s%s"
argument_list|,
literal|"1.0"
argument_list|,
literal|512
argument_list|,
literal|""
argument_list|,
literal|"edns"
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"packet 1203ceff id"
argument_list|,
literal|18
argument_list|,
literal|"packet %2.2x%2.2x%2.2x%2.2x id"
argument_list|,
literal|0x12
argument_list|,
literal|0x03
argument_list|,
literal|0xce
argument_list|,
literal|0xff
argument_list|)
expr_stmt|;
name|DOTEST
argument_list|(
literal|1024
argument_list|,
literal|"/tmp/testbound_123abcd.tmp"
argument_list|,
literal|26
argument_list|,
literal|"/tmp/testbound_%u%s%s.tmp"
argument_list|,
literal|123
argument_list|,
literal|"ab"
argument_list|,
literal|"cd"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SNPRINTF_TEST */
end_comment

end_unit

