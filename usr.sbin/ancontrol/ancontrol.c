begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright 1997, 1998, 1999  *	Bill Paul<wpaul@ee.columbia.edu>.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by Bill Paul.  * 4. Neither the name of the author nor the names of any co-contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY Bill Paul AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL Bill Paul OR THE VOICES IN HIS HEAD  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF  * THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|char
name|copyright
index|[]
init|=
literal|"@(#) Copyright (c) 1997, 1998, 1999\ 	Bill Paul. All rights reserved."
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<net/ethernet.h>
end_include

begin_include
include|#
directive|include
file|<dev/an/if_aironet_ieee.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<md4.h>
end_include

begin_function_decl
specifier|static
name|void
name|an_getval
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|struct
name|an_req
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setval
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|struct
name|an_req
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_printwords
parameter_list|(
name|u_int16_t
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_printspeeds
parameter_list|(
name|u_int8_t
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_printbool
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_printhex
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_printstr
parameter_list|(
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpstatus
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpstats
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpconfig
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpcaps
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpssid
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_dumpap
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setconfig
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setssid
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setap
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setspeed
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_readkeyinfo
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|ANCACHE
end_ifdef

begin_function_decl
specifier|static
name|void
name|an_zerocache
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_readcache
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|int
name|an_hex2int
parameter_list|(
name|char
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_str2key
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|an_ltv_key
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_setkeys
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_enable_tx_key
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|an_enable_leap_mode
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|usage
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|main
parameter_list|(
name|int
parameter_list|,
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_define
define|#
directive|define
name|ACT_DUMPSTATS
value|1
end_define

begin_define
define|#
directive|define
name|ACT_DUMPCONFIG
value|2
end_define

begin_define
define|#
directive|define
name|ACT_DUMPSTATUS
value|3
end_define

begin_define
define|#
directive|define
name|ACT_DUMPCAPS
value|4
end_define

begin_define
define|#
directive|define
name|ACT_DUMPSSID
value|5
end_define

begin_define
define|#
directive|define
name|ACT_DUMPAP
value|6
end_define

begin_define
define|#
directive|define
name|ACT_SET_OPMODE
value|7
end_define

begin_define
define|#
directive|define
name|ACT_SET_SSID1
value|8
end_define

begin_define
define|#
directive|define
name|ACT_SET_SSID2
value|9
end_define

begin_define
define|#
directive|define
name|ACT_SET_SSID3
value|10
end_define

begin_define
define|#
directive|define
name|ACT_SET_FREQ
value|11
end_define

begin_define
define|#
directive|define
name|ACT_SET_AP1
value|12
end_define

begin_define
define|#
directive|define
name|ACT_SET_AP2
value|13
end_define

begin_define
define|#
directive|define
name|ACT_SET_AP3
value|14
end_define

begin_define
define|#
directive|define
name|ACT_SET_AP4
value|15
end_define

begin_define
define|#
directive|define
name|ACT_SET_DRIVERNAME
value|16
end_define

begin_define
define|#
directive|define
name|ACT_SET_SCANMODE
value|17
end_define

begin_define
define|#
directive|define
name|ACT_SET_TXRATE
value|18
end_define

begin_define
define|#
directive|define
name|ACT_SET_RTS_THRESH
value|19
end_define

begin_define
define|#
directive|define
name|ACT_SET_PWRSAVE
value|20
end_define

begin_define
define|#
directive|define
name|ACT_SET_DIVERSITY_RX
value|21
end_define

begin_define
define|#
directive|define
name|ACT_SET_DIVERSITY_TX
value|22
end_define

begin_define
define|#
directive|define
name|ACT_SET_RTS_RETRYLIM
value|23
end_define

begin_define
define|#
directive|define
name|ACT_SET_WAKE_DURATION
value|24
end_define

begin_define
define|#
directive|define
name|ACT_SET_BEACON_PERIOD
value|25
end_define

begin_define
define|#
directive|define
name|ACT_SET_TXPWR
value|26
end_define

begin_define
define|#
directive|define
name|ACT_SET_FRAG_THRESH
value|27
end_define

begin_define
define|#
directive|define
name|ACT_SET_NETJOIN
value|28
end_define

begin_define
define|#
directive|define
name|ACT_SET_MYNAME
value|29
end_define

begin_define
define|#
directive|define
name|ACT_SET_MAC
value|30
end_define

begin_define
define|#
directive|define
name|ACT_DUMPCACHE
value|31
end_define

begin_define
define|#
directive|define
name|ACT_ZEROCACHE
value|32
end_define

begin_define
define|#
directive|define
name|ACT_ENABLE_WEP
value|33
end_define

begin_define
define|#
directive|define
name|ACT_SET_KEY_TYPE
value|34
end_define

begin_define
define|#
directive|define
name|ACT_SET_KEYS
value|35
end_define

begin_define
define|#
directive|define
name|ACT_ENABLE_TX_KEY
value|36
end_define

begin_define
define|#
directive|define
name|ACT_SET_MONITOR_MODE
value|37
end_define

begin_define
define|#
directive|define
name|ACT_SET_LEAP_MODE
value|38
end_define

begin_function
specifier|static
name|void
name|an_getval
parameter_list|(
name|iface
parameter_list|,
name|areq
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|struct
name|an_req
modifier|*
name|areq
decl_stmt|;
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|int
name|s
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ifr
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|iface
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|)
expr_stmt|;
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
name|areq
expr_stmt|;
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGAIRONET
argument_list|,
operator|&
name|ifr
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"SIOCGAIRONET"
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setval
parameter_list|(
name|iface
parameter_list|,
name|areq
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|struct
name|an_req
modifier|*
name|areq
decl_stmt|;
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|int
name|s
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ifr
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|iface
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|)
expr_stmt|;
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
name|areq
expr_stmt|;
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"socket"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCSAIRONET
argument_list|,
operator|&
name|ifr
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"SIOCSAIRONET"
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_printstr
parameter_list|(
name|str
parameter_list|,
name|len
parameter_list|)
name|char
modifier|*
name|str
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|str
index|[
name|i
index|]
operator|==
literal|'\0'
condition|)
name|str
index|[
name|i
index|]
operator|=
literal|' '
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"[ %.*s ]"
argument_list|,
name|len
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_printwords
parameter_list|(
name|w
parameter_list|,
name|len
parameter_list|)
name|u_int16_t
modifier|*
name|w
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"[ "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%d "
argument_list|,
name|w
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_printspeeds
parameter_list|(
name|w
parameter_list|,
name|len
parameter_list|)
name|u_int8_t
modifier|*
name|w
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"[ "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
operator|&&
name|w
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%2.1fMbps "
argument_list|,
name|w
index|[
name|i
index|]
operator|*
literal|0.500
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_printbool
parameter_list|(
name|val
parameter_list|)
name|int
name|val
decl_stmt|;
block|{
if|if
condition|(
name|val
condition|)
name|printf
argument_list|(
literal|"[ On ]"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"[ Off ]"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_printhex
parameter_list|(
name|ptr
parameter_list|,
name|len
parameter_list|)
name|char
modifier|*
name|ptr
decl_stmt|;
name|int
name|len
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"[ "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%02x"
argument_list|,
name|ptr
index|[
name|i
index|]
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
operator|(
name|len
operator|-
literal|1
operator|)
condition|)
name|printf
argument_list|(
literal|":"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpstatus
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_status
modifier|*
name|sts
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_STATUS
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|sts
operator|=
operator|(
expr|struct
name|an_ltv_status
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"MAC address:\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_macaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOperating mode:\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_CONFIGURED
condition|)
name|printf
argument_list|(
literal|"configured "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_MAC_ENABLED
condition|)
name|printf
argument_list|(
literal|"MAC ON "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_RX_ENABLED
condition|)
name|printf
argument_list|(
literal|"RX ON "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_IN_SYNC
condition|)
name|printf
argument_list|(
literal|"synced "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_ASSOCIATED
condition|)
name|printf
argument_list|(
literal|"associated "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_LEAP
condition|)
name|printf
argument_list|(
literal|"LEAP "
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_ERROR
condition|)
name|printf
argument_list|(
literal|"error "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"]\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Error code:\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_errcode
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSignal quality:\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_cur_signal_quality
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSignal strength:\t[ %d%% ]"
argument_list|,
name|sts
operator|->
name|an_normalized_rssi
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nMax Noise:\t\t[ %d%% ]"
argument_list|,
name|sts
operator|->
name|an_avg_noise_prev_min
argument_list|)
expr_stmt|;
comment|/* 	 * XXX: This uses the old definition of the rate field (units of 	 * 500kbps).  Technically the new definition is that this field 	 * contains arbitrary values, but no devices which need this 	 * support exist and the IEEE seems to intend to use the old 	 * definition until they get something big so we'll keep using 	 * it as well because this will work with new cards with 	 * rate<= 63.5Mbps. 	 */
name|printf
argument_list|(
literal|"\nCurrent TX rate:\t[ %d%s ]"
argument_list|,
name|sts
operator|->
name|an_current_tx_rate
operator|/
literal|2
argument_list|,
operator|(
name|sts
operator|->
name|an_current_tx_rate
operator|%
literal|2
operator|)
condition|?
literal|".5"
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nCurrent SSID:\t\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_ssid
argument_list|,
name|sts
operator|->
name|an_ssidlen
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nCurrent AP name:\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_ap_name
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nCurrent BSSID:\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|sts
operator|->
name|an_cur_bssid
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nBeacon period:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_beacon_period
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nDTIM period:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_dtim_period
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nATIM duration:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_atim_duration
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nHOP period:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_hop_period
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nChannel set:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_channel_set
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nCurrent channel:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_cur_channel
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nHops to backbone:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_hops_to_backbone
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nTotal AP load:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_ap_total_load
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOur generated load:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_our_generated_load
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAccumulated ARL:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|sts
operator|->
name|an_accumulated_arl
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpcaps
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_caps
modifier|*
name|caps
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|u_int16_t
name|tmp
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_CAPABILITIES
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|caps
operator|=
operator|(
expr|struct
name|an_ltv_caps
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"OUI:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_oui
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nProduct number:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|caps
operator|->
name|an_prodnum
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nManufacturer name:\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_manufname
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nProduce name:\t\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_prodname
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nFirmware version:\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_prodvers
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOEM MAC address:\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_oemaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAironet MAC address:\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_aironetaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRadio type:\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|caps
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_80211_FH
condition|)
name|printf
argument_list|(
literal|"802.11 FH"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_80211_DS
condition|)
name|printf
argument_list|(
literal|"802.11 DS"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_LM2000_DS
condition|)
name|printf
argument_list|(
literal|"LM2000 DS"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"unknown (%x)"
argument_list|,
name|caps
operator|->
name|an_radiotype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRegulatory domain:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|caps
operator|->
name|an_regdomain
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAssigned CallID:\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|caps
operator|->
name|an_callid
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSupported speeds:\t"
argument_list|)
expr_stmt|;
name|an_printspeeds
argument_list|(
name|caps
operator|->
name|an_rates
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRX Diversity:\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 1 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_2_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 2 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_AND_2
condition|)
name|printf
argument_list|(
literal|"antenna 1 and 2"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nTX Diversity:\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 1 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_2_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 2 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|caps
operator|->
name|an_rx_diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_AND_2
condition|)
name|printf
argument_list|(
literal|"antenna 1 and 2"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSupported power levels:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
name|caps
operator|->
name|an_tx_powerlevels
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nHardware revision:\t"
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|ntohs
argument_list|(
name|caps
operator|->
name|an_hwrev
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSoftware revision:\t"
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|ntohs
argument_list|(
name|caps
operator|->
name|an_fwrev
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSoftware subrevision:\t"
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|ntohs
argument_list|(
name|caps
operator|->
name|an_fwsubrev
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nInterface revision:\t"
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|ntohs
argument_list|(
name|caps
operator|->
name|an_ifacerev
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nBootblock revision:\t"
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|ntohs
argument_list|(
name|caps
operator|->
name|an_bootblockrev
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|tmp
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpstats
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_stats
modifier|*
name|stats
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|caddr_t
name|ptr
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_32BITS_CUM
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|ptr
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|areq
expr_stmt|;
name|ptr
operator|-=
literal|2
expr_stmt|;
name|stats
operator|=
operator|(
expr|struct
name|an_ltv_stats
operator|*
operator|)
name|ptr
expr_stmt|;
name|printf
argument_list|(
literal|"RX overruns:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_overruns
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX PLCP CSUM errors:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_plcp_csum_errs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX PLCP format errors:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_plcp_format_errs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX PLCP length errors:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_plcp_len_errs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX MAC CRC errors:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_mac_crc_errs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX MAC CRC OK:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_mac_crc_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX WEP errors:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_wep_errs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX WEP OK:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_wep_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Long retries:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_retry_long
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Short retries:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_retry_short
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Retries exhausted:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_retry_max
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Bad ACK:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_no_ack
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Bad CTS:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_no_cts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX good ACKs:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_ack_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX good CTSs:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_cts_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TX good ACKs:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_ack_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TX good RTSs:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_rts_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TX good CTSs:\t\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_cts_ok
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"LMAC multicasts transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_lmac_mcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"LMAC broadcasts transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_lmac_bcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"LMAC unicast frags transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_lmac_ucast_frags
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"LMAC unicasts transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_lmac_ucasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Beacons transmitted:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_beacons
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Beacons received:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_beacons
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Single transmit collisions:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_single_cols
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Multiple transmit collisions:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_multi_cols
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Transmits without deferrals:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_defers_no
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Transmits deferred due to protocol:\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_defers_prot
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Transmits deferred due to energy detect:\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_defers_energy
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX duplicate frames/frags:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_dups
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX partial frames:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_partial
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TX max lifetime exceeded:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_too_old
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"RX max lifetime exceeded:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_too_old
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to too many missed beacons:\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_missed_beacons
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to ARL exceeded:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_arl_exceeded
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to deauthentication:\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_deauthed
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to disassociation:\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_disassociated
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to excess change in TSF timing:\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_tsf_timing
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host transmitted multicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_host_mcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host transmitted broadcasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_host_bcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host transmitted unicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_host_ucasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host transmission failures:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_host_failed
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host received multicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_host_mcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host received broadcasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_host_bcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host received unicasts:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_host_ucasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host receive discards:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_host_discarded
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC transmitted multicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_hmac_mcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC transmitted broadcasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_hmac_bcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC transmitted unicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_hmac_ucasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC transmissions failed:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_hmac_failed
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC received multicasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_hmac_mcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC received broadcasts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_hmac_bcasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC received unicasts:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_hmac_ucasts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC receive discards:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_hmac_discarded
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"HMAC transmits accepted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_hmac_accepted
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"SSID mismatches:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_ssid_mismatches
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Access point mismatches:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_ap_mismatches
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Speed mismatches:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rates_mismatches
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Authentication rejects:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_auth_rejects
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Authentication timeouts:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_auth_timeouts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Association rejects:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_assoc_rejects
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Association timeouts:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_assoc_timeouts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Management frames received:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_mgmt_pkts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Management frames transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_mgmt_pkts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Refresh frames received:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_refresh_pkts
argument_list|)
operator|,
name|printf
argument_list|(
literal|"Refresh frames transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_refresh_pkts
argument_list|)
operator|,
name|printf
argument_list|(
literal|"Poll frames received:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_rx_poll_pkts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Poll frames transmitted:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_tx_poll_pkts
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host requested sync losses:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_hostreq
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host transmitted bytes:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_host_tx_bytes
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Host received bytes:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_host_rx_bytes
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Uptime in microseconds:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_uptime_usecs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Uptime in seconds:\t\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_uptime_secs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Sync lost due to better AP:\t\t\t[ %d ]\n"
argument_list|,
name|stats
operator|->
name|an_lostsync_better_ap
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpap
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_aplist
modifier|*
name|ap
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_APLIST
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|ap
operator|=
operator|(
expr|struct
name|an_ltv_aplist
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"Access point 1:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap1
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAccess point 2:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap2
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAccess point 3:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap3
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAccess point 4:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap4
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpssid
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_ssidlist
modifier|*
name|ssid
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_SSIDLIST
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|ssid
operator|=
operator|(
expr|struct
name|an_ltv_ssidlist
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"SSID 1:\t\t\t[ %.*s ]\n"
argument_list|,
name|ssid
operator|->
name|an_ssid1_len
argument_list|,
name|ssid
operator|->
name|an_ssid1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"SSID 2:\t\t\t[ %.*s ]\n"
argument_list|,
name|ssid
operator|->
name|an_ssid2_len
argument_list|,
name|ssid
operator|->
name|an_ssid2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"SSID 3:\t\t\t[ %.*s ]\n"
argument_list|,
name|ssid
operator|->
name|an_ssid3_len
argument_list|,
name|ssid
operator|->
name|an_ssid3
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_dumpconfig
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_ltv_genconfig
modifier|*
name|cfg
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|unsigned
name|char
name|diversity
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_ACTUALCFG
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|cfg
operator|=
operator|(
expr|struct
name|an_ltv_genconfig
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"Operating mode:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_opmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_OPMODE_IBSS_ADHOC
condition|)
name|printf
argument_list|(
literal|"ad-hoc"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_opmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_OPMODE_INFRASTRUCTURE_STATION
condition|)
name|printf
argument_list|(
literal|"infrastructure"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_opmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_OPMODE_AP
condition|)
name|printf
argument_list|(
literal|"access point"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_opmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_OPMODE_AP_REPEATER
condition|)
name|printf
argument_list|(
literal|"access point repeater"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nReceive mode:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_BC_MC_ADDR
condition|)
name|printf
argument_list|(
literal|"broadcast/multicast/unicast"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_BC_ADDR
condition|)
name|printf
argument_list|(
literal|"broadcast/unicast"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_ADDR
condition|)
name|printf
argument_list|(
literal|"unicast"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_80211_MONITOR_CURBSS
condition|)
name|printf
argument_list|(
literal|"802.11 monitor, current BSSID"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_80211_MONITOR_ANYBSS
condition|)
name|printf
argument_list|(
literal|"802.11 monitor, any BSSID"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_rxmode
operator|&
literal|0x7
operator|)
operator|==
name|AN_RXMODE_LAN_MONITOR_CURBSS
condition|)
name|printf
argument_list|(
literal|"LAN monitor, current BSSID"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nFragment threshold:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_fragthresh
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRTS threshold:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_rtsthresh
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nMAC address:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printhex
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|cfg
operator|->
name|an_macaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSupported rates:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printspeeds
argument_list|(
name|cfg
operator|->
name|an_rates
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nShort retry limit:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_shortretry_limit
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nLong retry limit:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_longretry_limit
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nTX MSDU lifetime:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_tx_msdu_lifetime
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRX MSDU lifetime:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_rx_msdu_lifetime
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nStationary:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printbool
argument_list|(
name|cfg
operator|->
name|an_stationary
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOrdering:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printbool
argument_list|(
name|cfg
operator|->
name|an_ordering
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nDevice type:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_devtype
operator|==
name|AN_DEVTYPE_PC4500
condition|)
name|printf
argument_list|(
literal|"PC4500"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cfg
operator|->
name|an_devtype
operator|==
name|AN_DEVTYPE_PC4800
condition|)
name|printf
argument_list|(
literal|"PC4800"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"unknown (%x)"
argument_list|,
name|cfg
operator|->
name|an_devtype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nScanning mode:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_scanmode
operator|==
name|AN_SCANMODE_ACTIVE
condition|)
name|printf
argument_list|(
literal|"active"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_scanmode
operator|==
name|AN_SCANMODE_PASSIVE
condition|)
name|printf
argument_list|(
literal|"passive"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_scanmode
operator|==
name|AN_SCANMODE_AIRONET_ACTIVE
condition|)
name|printf
argument_list|(
literal|"Aironet active"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nProbe delay:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_probedelay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nProbe energy timeout:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_probe_energy_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nProbe response timeout:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_probe_response_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nBeacon listen timeout:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_beacon_listen_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nIBSS join network timeout:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_ibss_join_net_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAuthentication timeout:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_auth_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nWEP enabled:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_PRIVACY_IN_USE
condition|)
block|{
if|if
condition|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_LEAP
condition|)
name|printf
argument_list|(
literal|"LEAP"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_ALLOW_UNENCRYPTED
condition|)
name|printf
argument_list|(
literal|"mixed cell"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"full"
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"no"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAuthentication type:\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_MASK
operator|)
operator|==
name|AN_AUTHTYPE_NONE
condition|)
name|printf
argument_list|(
literal|"none"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_MASK
operator|)
operator|==
name|AN_AUTHTYPE_OPEN
condition|)
name|printf
argument_list|(
literal|"open"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cfg
operator|->
name|an_authtype
operator|&
name|AN_AUTHTYPE_MASK
operator|)
operator|==
name|AN_AUTHTYPE_SHAREDKEY
condition|)
name|printf
argument_list|(
literal|"shared key"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAssociation timeout:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_assoc_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSpecified AP association timeout:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_specified_ap_timeout
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOffline scan interval:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_offline_scan_interval
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOffline scan duration:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_offline_scan_duration
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nLink loss delay:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_link_loss_delay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nMax beacon loss time:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_max_beacon_lost_time
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRefresh interval:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_refresh_interval
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPower save mode:\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_psave_mode
operator|==
name|AN_PSAVE_NONE
condition|)
name|printf
argument_list|(
literal|"none"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_psave_mode
operator|==
name|AN_PSAVE_CAM
condition|)
name|printf
argument_list|(
literal|"constantly awake mode"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_psave_mode
operator|==
name|AN_PSAVE_PSP
condition|)
name|printf
argument_list|(
literal|"PSP"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_psave_mode
operator|==
name|AN_PSAVE_PSP_CAM
condition|)
name|printf
argument_list|(
literal|"PSP-CAM (fast PSP)"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nSleep through DTIMs:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printbool
argument_list|(
name|cfg
operator|->
name|an_sleep_for_dtims
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPower save listen interval:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_listen_interval
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPower save fast listen interval:\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_fast_listen_interval
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPower save listen decay:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_listen_decay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPower save fast listen decay:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_fast_listen_decay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAP/ad-hoc Beacon period:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_beacon_period
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAP/ad-hoc ATIM duration:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_atim_duration
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAP/ad-hoc current channel:\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_ds_channel
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nAP/ad-hoc DTIM period:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_dtim_period
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRadio type:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_80211_FH
condition|)
name|printf
argument_list|(
literal|"802.11 FH"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cfg
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_80211_DS
condition|)
name|printf
argument_list|(
literal|"802.11 DS"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cfg
operator|->
name|an_radiotype
operator|&
name|AN_RADIOTYPE_LM2000_DS
condition|)
name|printf
argument_list|(
literal|"LM2000 DS"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"unknown (%x)"
argument_list|,
name|cfg
operator|->
name|an_radiotype
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRX Diversity:\t\t\t\t[ "
argument_list|)
expr_stmt|;
name|diversity
operator|=
name|cfg
operator|->
name|an_diversity
operator|&
literal|0xFF
expr_stmt|;
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 1 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_2_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 2 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_AND_2
condition|)
name|printf
argument_list|(
literal|"antenna 1 and 2"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nTX Diversity:\t\t\t\t[ "
argument_list|)
expr_stmt|;
name|diversity
operator|=
operator|(
name|cfg
operator|->
name|an_diversity
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
expr_stmt|;
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 1 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_2_ONLY
condition|)
name|printf
argument_list|(
literal|"antenna 2 only"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|diversity
operator|==
name|AN_DIVERSITY_ANTENNA_1_AND_2
condition|)
name|printf
argument_list|(
literal|"antenna 1 and 2"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nTransmit power level:\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_tx_power
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nRSS threshold:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_rss_thresh
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nNode name:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printstr
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|cfg
operator|->
name|an_nodename
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nARL threshold:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_arl_thresh
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nARL decay:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_arl_decay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nARL delay:\t\t\t\t"
argument_list|)
expr_stmt|;
name|an_printwords
argument_list|(
operator|&
name|cfg
operator|->
name|an_arl_delay
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nConfiguration:\t\t\t\t[ "
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_home_product
operator|&
name|AN_HOME_NETWORK
condition|)
name|printf
argument_list|(
literal|"Home Configuration"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"Enterprise Configuration"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" ]"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|an_readkeyinfo
argument_list|(
name|iface
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|p
parameter_list|)
name|char
modifier|*
name|p
decl_stmt|;
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"usage:  %s -i iface -A (show specified APs)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -N (show specified SSIDss)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -S (show NIC status)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -I (show NIC capabilities)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -T (show stats counters)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -C (show current config)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -t 0-4 (set TX speed)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -s 0-3 (set power save mode)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface [-v 1-4] -a AP (specify AP)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -b val (set beacon period)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface [-v 0|1] -d val (set diversity)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -j val (set netjoin timeout)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -e 0-4 (enable transmit key)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface [-v 0-8] -k key (set key)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -K 0-2 (no auth/open/shared secret)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -W 0-2 (no WEP/full WEP/mixed cell)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -l val (set station name)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -m val (set MAC address)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface [-v 1-3] -n SSID "
literal|"(specify SSID)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -o 0|1 (set operating mode)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -c val (set ad-hoc channel)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -f val (set frag threshold)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -r val (set RTS threshold)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -M 0-15 (set monitor mode)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -L user (enter LEAP authentication mode)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|ANCACHE
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -Q print signal quality cache\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -i iface -Z zero out signal cache\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t%s -h (display this message)\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setconfig
parameter_list|(
name|iface
parameter_list|,
name|act
parameter_list|,
name|arg
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|int
name|act
decl_stmt|;
name|void
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|an_ltv_genconfig
modifier|*
name|cfg
decl_stmt|;
name|struct
name|an_ltv_caps
modifier|*
name|caps
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_req
name|areq_caps
decl_stmt|;
name|u_int16_t
name|diversity
init|=
literal|0
decl_stmt|;
name|struct
name|ether_addr
modifier|*
name|addr
decl_stmt|;
name|int
name|i
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_GENCONFIG
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|cfg
operator|=
operator|(
expr|struct
name|an_ltv_genconfig
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|areq_caps
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq_caps
operator|.
name|an_type
operator|=
name|AN_RID_CAPABILITIES
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq_caps
argument_list|)
expr_stmt|;
name|caps
operator|=
operator|(
expr|struct
name|an_ltv_caps
operator|*
operator|)
operator|&
name|areq_caps
expr_stmt|;
switch|switch
condition|(
name|act
condition|)
block|{
case|case
name|ACT_SET_OPMODE
case|:
name|cfg
operator|->
name|an_opmode
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_FREQ
case|:
name|cfg
operator|->
name|an_ds_channel
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_PWRSAVE
case|:
name|cfg
operator|->
name|an_psave_mode
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_SCANMODE
case|:
name|cfg
operator|->
name|an_scanmode
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_DIVERSITY_RX
case|:
case|case
name|ACT_SET_DIVERSITY_TX
case|:
switch|switch
condition|(
name|atoi
argument_list|(
name|arg
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|diversity
operator|=
name|AN_DIVERSITY_FACTORY_DEFAULT
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|diversity
operator|=
name|AN_DIVERSITY_ANTENNA_1_ONLY
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|diversity
operator|=
name|AN_DIVERSITY_ANTENNA_2_ONLY
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|diversity
operator|=
name|AN_DIVERSITY_ANTENNA_1_AND_2
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad diversity setting: %d"
argument_list|,
name|diversity
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|atoi
argument_list|(
name|arg
argument_list|)
operator|==
name|ACT_SET_DIVERSITY_RX
condition|)
block|{
name|cfg
operator|->
name|an_diversity
operator|&=
literal|0x00FF
expr_stmt|;
name|cfg
operator|->
name|an_diversity
operator||=
operator|(
name|diversity
operator|<<
literal|8
operator|)
expr_stmt|;
block|}
else|else
block|{
name|cfg
operator|->
name|an_diversity
operator|&=
literal|0xFF00
expr_stmt|;
name|cfg
operator|->
name|an_diversity
operator||=
name|diversity
expr_stmt|;
block|}
break|break;
case|case
name|ACT_SET_TXPWR
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|caps
operator|->
name|an_tx_powerlevels
index|[
name|i
index|]
operator|==
name|atoi
argument_list|(
name|arg
argument_list|)
condition|)
break|break;
block|}
if|if
condition|(
name|i
operator|==
literal|8
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unsupported power level: %dmW"
argument_list|,
name|atoi
argument_list|(
name|arg
argument_list|)
argument_list|)
expr_stmt|;
name|cfg
operator|->
name|an_tx_power
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_RTS_THRESH
case|:
name|cfg
operator|->
name|an_rtsthresh
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_RTS_RETRYLIM
case|:
name|cfg
operator|->
name|an_shortretry_limit
operator|=
name|cfg
operator|->
name|an_longretry_limit
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_BEACON_PERIOD
case|:
name|cfg
operator|->
name|an_beacon_period
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_WAKE_DURATION
case|:
name|cfg
operator|->
name|an_atim_duration
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_FRAG_THRESH
case|:
name|cfg
operator|->
name|an_fragthresh
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_NETJOIN
case|:
name|cfg
operator|->
name|an_ibss_join_net_timeout
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_MYNAME
case|:
name|bzero
argument_list|(
name|cfg
operator|->
name|an_nodename
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|cfg
operator|->
name|an_nodename
argument_list|,
name|optarg
argument_list|,
literal|16
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_MAC
case|:
name|addr
operator|=
name|ether_aton
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"badly formatted address"
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
name|cfg
operator|->
name|an_macaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|cfg
operator|->
name|an_macaddr
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_ENABLE_WEP
case|:
switch|switch
condition|(
name|atoi
argument_list|(
name|arg
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
comment|/* no WEP */
name|cfg
operator|->
name|an_authtype
operator|&=
operator|~
operator|(
name|AN_AUTHTYPE_PRIVACY_IN_USE
operator||
name|AN_AUTHTYPE_ALLOW_UNENCRYPTED
operator||
name|AN_AUTHTYPE_LEAP
operator|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* full WEP */
name|cfg
operator|->
name|an_authtype
operator||=
name|AN_AUTHTYPE_PRIVACY_IN_USE
expr_stmt|;
name|cfg
operator|->
name|an_authtype
operator|&=
operator|~
name|AN_AUTHTYPE_ALLOW_UNENCRYPTED
expr_stmt|;
name|cfg
operator|->
name|an_authtype
operator|&=
operator|~
name|AN_AUTHTYPE_LEAP
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* mixed cell */
name|cfg
operator|->
name|an_authtype
operator|=
name|AN_AUTHTYPE_PRIVACY_IN_USE
operator||
name|AN_AUTHTYPE_ALLOW_UNENCRYPTED
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|ACT_SET_KEY_TYPE
case|:
name|cfg
operator|->
name|an_authtype
operator|=
operator|(
name|cfg
operator|->
name|an_authtype
operator|&
operator|~
name|AN_AUTHTYPE_MASK
operator|)
operator||
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_MONITOR_MODE
case|:
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_MONITOR_MODE
expr_stmt|;
name|cfg
operator|->
name|an_len
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
comment|/* mode is put in length */
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown action"
argument_list|)
expr_stmt|;
break|break;
block|}
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setspeed
parameter_list|(
name|iface
parameter_list|,
name|act
parameter_list|,
name|arg
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|int
name|act
name|__unused
decl_stmt|;
name|void
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_ltv_caps
modifier|*
name|caps
decl_stmt|;
name|u_int16_t
name|speed
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_CAPABILITIES
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|caps
operator|=
operator|(
expr|struct
name|an_ltv_caps
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
switch|switch
condition|(
name|atoi
argument_list|(
name|arg
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|speed
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|speed
operator|=
name|AN_RATE_1MBPS
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|speed
operator|=
name|AN_RATE_2MBPS
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|caps
operator|->
name|an_rates
index|[
literal|2
index|]
operator|!=
name|AN_RATE_5_5MBPS
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"5.5Mbps not supported on this card"
argument_list|)
expr_stmt|;
name|speed
operator|=
name|AN_RATE_5_5MBPS
expr_stmt|;
break|break;
case|case
literal|4
case|:
if|if
condition|(
name|caps
operator|->
name|an_rates
index|[
literal|3
index|]
operator|!=
name|AN_RATE_11MBPS
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"11Mbps not supported on this card"
argument_list|)
expr_stmt|;
name|speed
operator|=
name|AN_RATE_11MBPS
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unsupported speed"
argument_list|)
expr_stmt|;
break|break;
block|}
name|areq
operator|.
name|an_len
operator|=
literal|6
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_TX_SPEED
expr_stmt|;
name|areq
operator|.
name|an_val
index|[
literal|0
index|]
operator|=
name|speed
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setap
parameter_list|(
name|iface
parameter_list|,
name|act
parameter_list|,
name|arg
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|int
name|act
decl_stmt|;
name|void
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|an_ltv_aplist
modifier|*
name|ap
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|ether_addr
modifier|*
name|addr
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_APLIST
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|ap
operator|=
operator|(
expr|struct
name|an_ltv_aplist
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|addr
operator|=
name|ether_aton
argument_list|(
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|)
expr_stmt|;
if|if
condition|(
name|addr
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"badly formatted address"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|act
condition|)
block|{
case|case
name|ACT_SET_AP1
case|:
name|bzero
argument_list|(
name|ap
operator|->
name|an_ap1
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap1
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_AP2
case|:
name|bzero
argument_list|(
name|ap
operator|->
name|an_ap2
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap2
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_AP3
case|:
name|bzero
argument_list|(
name|ap
operator|->
name|an_ap3
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap3
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_AP4
case|:
name|bzero
argument_list|(
name|ap
operator|->
name|an_ap4
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|addr
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|ap
operator|->
name|an_ap4
argument_list|,
name|ETHER_ADDR_LEN
argument_list|)
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown action"
argument_list|)
expr_stmt|;
break|break;
block|}
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setssid
parameter_list|(
name|iface
parameter_list|,
name|act
parameter_list|,
name|arg
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|int
name|act
decl_stmt|;
name|void
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|an_ltv_ssidlist
modifier|*
name|ssid
decl_stmt|;
name|struct
name|an_req
name|areq
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_SSIDLIST
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|ssid
operator|=
operator|(
expr|struct
name|an_ltv_ssidlist
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
switch|switch
condition|(
name|act
condition|)
block|{
case|case
name|ACT_SET_SSID1
case|:
name|bzero
argument_list|(
name|ssid
operator|->
name|an_ssid1
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid1
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ssid
operator|->
name|an_ssid1
argument_list|,
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid1
argument_list|)
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|an_ssid1_len
operator|=
name|strlen
argument_list|(
name|ssid
operator|->
name|an_ssid1
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_SSID2
case|:
name|bzero
argument_list|(
name|ssid
operator|->
name|an_ssid2
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid2
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ssid
operator|->
name|an_ssid2
argument_list|,
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid2
argument_list|)
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|an_ssid2_len
operator|=
name|strlen
argument_list|(
name|ssid
operator|->
name|an_ssid2
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_SSID3
case|:
name|bzero
argument_list|(
name|ssid
operator|->
name|an_ssid3
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid3
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ssid
operator|->
name|an_ssid3
argument_list|,
operator|(
name|char
operator|*
operator|)
name|arg
argument_list|,
sizeof|sizeof
argument_list|(
name|ssid
operator|->
name|an_ssid3
argument_list|)
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|an_ssid3_len
operator|=
name|strlen
argument_list|(
name|ssid
operator|->
name|an_ssid3
argument_list|)
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown action"
argument_list|)
expr_stmt|;
break|break;
block|}
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|ANCACHE
end_ifdef

begin_function
specifier|static
name|void
name|an_zerocache
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_len
operator|=
literal|0
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_ZERO_CACHE
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_readcache
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|int
modifier|*
name|an_sigitems
decl_stmt|;
name|struct
name|an_sigcache
modifier|*
name|sc
decl_stmt|;
name|char
modifier|*
name|pt
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|iface
operator|==
name|NULL
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"must specify interface name"
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_len
operator|=
name|AN_MAX_DATALEN
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_READ_CACHE
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|an_sigitems
operator|=
operator|(
name|int
operator|*
operator|)
operator|&
name|areq
operator|.
name|an_val
expr_stmt|;
name|pt
operator|=
operator|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
operator|.
name|an_val
operator|)
expr_stmt|;
name|pt
operator|+=
sizeof|sizeof
argument_list|(
name|int
argument_list|)
expr_stmt|;
name|sc
operator|=
operator|(
expr|struct
name|an_sigcache
operator|*
operator|)
name|pt
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|*
name|an_sigitems
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"[%d/%d]:"
argument_list|,
name|i
operator|+
literal|1
argument_list|,
operator|*
name|an_sigitems
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %02x:%02x:%02x:%02x:%02x:%02x,"
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|0
index|]
operator|&
literal|0xff
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|1
index|]
operator|&
literal|0xff
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|2
index|]
operator|&
literal|0xff
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|3
index|]
operator|&
literal|0xff
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|4
index|]
operator|&
literal|0xff
argument_list|,
name|sc
operator|->
name|macsrc
index|[
literal|5
index|]
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %d.%d.%d.%d,"
argument_list|,
operator|(
operator|(
name|sc
operator|->
name|ipsrc
operator|>>
literal|0
operator|)
operator|&
literal|0xff
operator|)
argument_list|,
operator|(
operator|(
name|sc
operator|->
name|ipsrc
operator|>>
literal|8
operator|)
operator|&
literal|0xff
operator|)
argument_list|,
operator|(
operator|(
name|sc
operator|->
name|ipsrc
operator|>>
literal|16
operator|)
operator|&
literal|0xff
operator|)
argument_list|,
operator|(
operator|(
name|sc
operator|->
name|ipsrc
operator|>>
literal|24
operator|)
operator|&
literal|0xff
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" sig: %d, noise: %d, qual: %d\n"
argument_list|,
name|sc
operator|->
name|signal
argument_list|,
name|sc
operator|->
name|noise
argument_list|,
name|sc
operator|->
name|quality
argument_list|)
expr_stmt|;
name|sc
operator|++
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|an_hex2int
parameter_list|(
name|c
parameter_list|)
name|char
name|c
decl_stmt|;
block|{
if|if
condition|(
name|c
operator|>=
literal|'0'
operator|&&
name|c
operator|<=
literal|'9'
condition|)
return|return
operator|(
name|c
operator|-
literal|'0'
operator|)
return|;
if|if
condition|(
name|c
operator|>=
literal|'A'
operator|&&
name|c
operator|<=
literal|'F'
condition|)
return|return
operator|(
name|c
operator|-
literal|'A'
operator|+
literal|10
operator|)
return|;
if|if
condition|(
name|c
operator|>=
literal|'a'
operator|&&
name|c
operator|<=
literal|'f'
condition|)
return|return
operator|(
name|c
operator|-
literal|'a'
operator|+
literal|10
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|an_str2key
parameter_list|(
name|s
parameter_list|,
name|k
parameter_list|)
name|char
modifier|*
name|s
decl_stmt|;
name|struct
name|an_ltv_key
modifier|*
name|k
decl_stmt|;
block|{
name|int
name|n
decl_stmt|,
name|i
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
comment|/* Is this a hex string? */
if|if
condition|(
name|s
index|[
literal|0
index|]
operator|==
literal|'0'
operator|&&
operator|(
name|s
index|[
literal|1
index|]
operator|==
literal|'x'
operator|||
name|s
index|[
literal|1
index|]
operator|==
literal|'X'
operator|)
condition|)
block|{
comment|/* Yes, convert to int. */
name|n
operator|=
literal|0
expr_stmt|;
name|p
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|k
operator|->
name|key
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|s
index|[
name|i
index|]
operator|!=
literal|'\0'
operator|&&
name|s
index|[
name|i
operator|+
literal|1
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|+=
literal|2
control|)
block|{
operator|*
name|p
operator|++
operator|=
operator|(
name|an_hex2int
argument_list|(
name|s
index|[
name|i
index|]
argument_list|)
operator|<<
literal|4
operator|)
operator|+
name|an_hex2int
argument_list|(
name|s
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|s
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"hex strings must be of even length"
argument_list|)
expr_stmt|;
name|k
operator|->
name|klen
operator|=
name|n
expr_stmt|;
block|}
else|else
block|{
comment|/* No, just copy it in. */
name|bcopy
argument_list|(
name|s
argument_list|,
name|k
operator|->
name|key
argument_list|,
name|strlen
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|k
operator|->
name|klen
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_setkeys
parameter_list|(
name|iface
parameter_list|,
name|key
parameter_list|,
name|keytype
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|char
modifier|*
name|key
decl_stmt|;
name|int
name|keytype
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_ltv_key
modifier|*
name|k
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
name|k
operator|=
operator|(
expr|struct
name|an_ltv_key
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|key
argument_list|)
operator|>
literal|28
condition|)
block|{
name|err
argument_list|(
literal|1
argument_list|,
literal|"encryption key must be no "
literal|"more than 18 characters long"
argument_list|)
expr_stmt|;
block|}
name|an_str2key
argument_list|(
name|key
argument_list|,
name|k
argument_list|)
expr_stmt|;
name|k
operator|->
name|kindex
operator|=
name|keytype
operator|/
literal|2
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|k
operator|->
name|klen
operator|==
literal|0
operator|||
name|k
operator|->
name|klen
operator|==
literal|5
operator|||
name|k
operator|->
name|klen
operator|==
literal|13
operator|)
condition|)
block|{
name|err
argument_list|(
literal|1
argument_list|,
literal|"encryption key must be 0, 5 or 13 bytes long"
argument_list|)
expr_stmt|;
block|}
comment|/* default mac and only valid one (from manual) 1.0.0.0.0.0 */
name|k
operator|->
name|mac
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|4
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|5
index|]
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|keytype
operator|&
literal|1
condition|)
block|{
case|case
literal|0
case|:
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_key
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_WEP_PERM
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_key
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_WEP_TEMP
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
break|break;
block|}
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_readkeyinfo
parameter_list|(
name|iface
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_ltv_genconfig
modifier|*
name|cfg
decl_stmt|;
name|struct
name|an_ltv_key
modifier|*
name|k
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|home
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_ACTUALCFG
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|cfg
operator|=
operator|(
expr|struct
name|an_ltv_genconfig
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
if|if
condition|(
name|cfg
operator|->
name|an_home_product
operator|&
name|AN_HOME_NETWORK
condition|)
name|home
operator|=
literal|1
expr_stmt|;
else|else
name|home
operator|=
literal|0
expr_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
name|k
operator|=
operator|(
expr|struct
name|an_ltv_key
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|printf
argument_list|(
literal|"WEP Key status:\n"
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_WEP_TEMP
expr_stmt|;
comment|/* read first key */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_key
argument_list|)
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|->
name|kindex
operator|==
literal|0xffff
condition|)
break|break;
switch|switch
condition|(
name|k
operator|->
name|klen
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"\tKey %d is unset\n"
argument_list|,
name|k
operator|->
name|kindex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|printf
argument_list|(
literal|"\tKey %d is set  40 bits\n"
argument_list|,
name|k
operator|->
name|kindex
argument_list|)
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|printf
argument_list|(
literal|"\tKey %d is set 128 bits\n"
argument_list|,
name|k
operator|->
name|kindex
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"\tWEP Key %d has an unknown size %d\n"
argument_list|,
name|i
argument_list|,
name|k
operator|->
name|klen
argument_list|)
expr_stmt|;
block|}
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_WEP_PERM
expr_stmt|;
comment|/* read next key */
block|}
name|k
operator|->
name|kindex
operator|=
literal|0xffff
expr_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_key
argument_list|)
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tThe active transmit key is %d\n"
argument_list|,
literal|4
operator|*
name|home
operator|+
name|k
operator|->
name|mac
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_enable_tx_key
parameter_list|(
name|iface
parameter_list|,
name|arg
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|char
modifier|*
name|arg
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_ltv_key
modifier|*
name|k
decl_stmt|;
name|struct
name|an_ltv_genconfig
modifier|*
name|config
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
comment|/* set home or not home mode */
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_genconfig
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_GENCONFIG
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|config
operator|=
operator|(
expr|struct
name|an_ltv_genconfig
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
if|if
condition|(
name|atoi
argument_list|(
name|arg
argument_list|)
operator|==
literal|4
condition|)
block|{
name|config
operator|->
name|an_home_product
operator||=
name|AN_HOME_NETWORK
expr_stmt|;
block|}
else|else
block|{
name|config
operator|->
name|an_home_product
operator|&=
operator|~
name|AN_HOME_NETWORK
expr_stmt|;
block|}
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|areq
argument_list|,
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
argument_list|)
expr_stmt|;
name|k
operator|=
operator|(
expr|struct
name|an_ltv_key
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
comment|/* From a Cisco engineer write the transmit key to use in the 	   first MAC, index is FFFF*/
name|k
operator|->
name|kindex
operator|=
literal|0xffff
expr_stmt|;
name|k
operator|->
name|klen
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|0
index|]
operator|=
name|atoi
argument_list|(
name|arg
argument_list|)
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|4
index|]
operator|=
literal|0
expr_stmt|;
name|k
operator|->
name|mac
index|[
literal|5
index|]
operator|=
literal|0
expr_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|an_ltv_key
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_WEP_PERM
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
name|an_enable_leap_mode
parameter_list|(
name|iface
parameter_list|,
name|username
parameter_list|)
specifier|const
name|char
modifier|*
name|iface
decl_stmt|;
name|char
modifier|*
name|username
decl_stmt|;
block|{
name|struct
name|an_req
name|areq
decl_stmt|;
name|struct
name|an_ltv_status
modifier|*
name|sts
decl_stmt|;
name|struct
name|an_ltv_genconfig
modifier|*
name|cfg
decl_stmt|;
name|struct
name|an_ltv_caps
modifier|*
name|caps
decl_stmt|;
name|struct
name|an_ltv_leap_username
name|an_username
decl_stmt|;
name|struct
name|an_ltv_leap_password
name|an_password
decl_stmt|;
name|char
modifier|*
name|password
decl_stmt|;
name|MD4_CTX
name|context
decl_stmt|;
name|int
name|len
decl_stmt|;
name|int
name|i
decl_stmt|;
name|char
name|unicode_password
index|[
name|LEAP_PASSWORD_MAX
operator|*
literal|2
index|]
decl_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_CAPABILITIES
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|caps
operator|=
operator|(
expr|struct
name|an_ltv_caps
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
if|if
condition|(
operator|!
name|caps
operator|->
name|an_softcaps
operator|&
name|AN_AUTHTYPE_LEAP
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Firmware does not support LEAP\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|bzero
argument_list|(
operator|&
name|an_username
argument_list|,
sizeof|sizeof
argument_list|(
name|an_username
argument_list|)
argument_list|)
expr_stmt|;
name|bzero
argument_list|(
operator|&
name|an_password
argument_list|,
sizeof|sizeof
argument_list|(
name|an_password
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|username
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|LEAP_USERNAME_MAX
condition|)
block|{
name|printf
argument_list|(
literal|"Username too long (max %d)\n"
argument_list|,
name|LEAP_USERNAME_MAX
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strncpy
argument_list|(
name|an_username
operator|.
name|an_username
argument_list|,
name|username
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|an_username
operator|.
name|an_username_len
operator|=
name|len
expr_stmt|;
name|an_username
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|an_username
argument_list|)
expr_stmt|;
name|an_username
operator|.
name|an_type
operator|=
name|AN_RID_LEAPUSERNAME
expr_stmt|;
name|password
operator|=
name|getpass
argument_list|(
literal|"Enter LEAP password:"
argument_list|)
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|password
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|LEAP_PASSWORD_MAX
condition|)
block|{
name|printf
argument_list|(
literal|"Password too long (max %d)\n"
argument_list|,
name|LEAP_PASSWORD_MAX
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|bzero
argument_list|(
operator|&
name|unicode_password
argument_list|,
sizeof|sizeof
argument_list|(
name|unicode_password
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|unicode_password
index|[
name|i
operator|*
literal|2
index|]
operator|=
operator|*
name|password
operator|++
expr_stmt|;
block|}
comment|/* First half */
name|MD4Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
name|MD4Update
argument_list|(
operator|&
name|context
argument_list|,
name|unicode_password
argument_list|,
name|len
operator|*
literal|2
argument_list|)
expr_stmt|;
name|MD4Final
argument_list|(
operator|&
name|an_password
operator|.
name|an_password
index|[
literal|0
index|]
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
comment|/* Second half */
name|MD4Init
argument_list|(
operator|&
name|context
argument_list|)
expr_stmt|;
name|MD4Update
argument_list|(
operator|&
name|context
argument_list|,
operator|&
name|an_password
operator|.
name|an_password
index|[
literal|0
index|]
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|MD4Final
argument_list|(
operator|&
name|an_password
operator|.
name|an_password
index|[
literal|16
index|]
argument_list|,
operator|&
name|context
argument_list|)
expr_stmt|;
name|an_password
operator|.
name|an_password_len
operator|=
literal|32
expr_stmt|;
name|an_password
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|an_password
argument_list|)
expr_stmt|;
name|an_password
operator|.
name|an_type
operator|=
name|AN_RID_LEAPPASSWORD
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|(
expr|struct
name|an_req
operator|*
operator|)
operator|&
name|an_username
argument_list|)
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|(
expr|struct
name|an_req
operator|*
operator|)
operator|&
name|an_password
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_len
operator|=
sizeof|sizeof
argument_list|(
name|areq
argument_list|)
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_GENCONFIG
expr_stmt|;
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|cfg
operator|=
operator|(
expr|struct
name|an_ltv_genconfig
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|cfg
operator|->
name|an_authtype
operator|=
operator|(
name|AN_AUTHTYPE_PRIVACY_IN_USE
operator||
name|AN_AUTHTYPE_LEAP
operator|)
expr_stmt|;
name|an_setval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
name|sts
operator|=
operator|(
expr|struct
name|an_ltv_status
operator|*
operator|)
operator|&
name|areq
expr_stmt|;
name|areq
operator|.
name|an_type
operator|=
name|AN_RID_STATUS
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|60
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|an_getval
argument_list|(
name|iface
argument_list|,
operator|&
name|areq
argument_list|)
expr_stmt|;
if|if
condition|(
name|sts
operator|->
name|an_opmode
operator|&
name|AN_STATUS_OPMODE_LEAP
condition|)
block|{
name|printf
argument_list|(
literal|"Authenticated\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|sleep
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Failed LEAP authentication\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
name|argv
index|[]
decl_stmt|;
block|{
name|int
name|ch
decl_stmt|;
name|int
name|act
init|=
literal|0
decl_stmt|;
specifier|const
name|char
modifier|*
name|iface
init|=
name|NULL
decl_stmt|;
name|int
name|modifier
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|key
init|=
name|NULL
decl_stmt|;
name|void
modifier|*
name|arg
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|p
init|=
name|argv
index|[
literal|0
index|]
decl_stmt|;
comment|/* Get the interface name */
name|opterr
operator|=
literal|0
expr_stmt|;
name|ch
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"i:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ch
operator|==
literal|'i'
condition|)
block|{
name|iface
operator|=
name|optarg
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|argc
operator|>
literal|1
operator|&&
operator|*
name|argv
index|[
literal|1
index|]
operator|!=
literal|'-'
condition|)
block|{
name|iface
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
name|optind
operator|=
literal|2
expr_stmt|;
block|}
else|else
block|{
name|iface
operator|=
literal|"an0"
expr_stmt|;
name|optind
operator|=
literal|1
expr_stmt|;
block|}
name|optreset
operator|=
literal|1
expr_stmt|;
block|}
name|opterr
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|ch
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"ANISCTht:a:e:o:s:n:v:d:j:b:c:r:p:w:m:l:k:K:W:QZM:L:"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
block|{
switch|switch
condition|(
name|ch
condition|)
block|{
case|case
literal|'Z'
case|:
ifdef|#
directive|ifdef
name|ANCACHE
name|act
operator|=
name|ACT_ZEROCACHE
expr_stmt|;
else|#
directive|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"ANCACHE not available"
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
literal|'Q'
case|:
ifdef|#
directive|ifdef
name|ANCACHE
name|act
operator|=
name|ACT_DUMPCACHE
expr_stmt|;
else|#
directive|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"ANCACHE not available"
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
literal|'A'
case|:
name|act
operator|=
name|ACT_DUMPAP
expr_stmt|;
break|break;
case|case
literal|'N'
case|:
name|act
operator|=
name|ACT_DUMPSSID
expr_stmt|;
break|break;
case|case
literal|'S'
case|:
name|act
operator|=
name|ACT_DUMPSTATUS
expr_stmt|;
break|break;
case|case
literal|'I'
case|:
name|act
operator|=
name|ACT_DUMPCAPS
expr_stmt|;
break|break;
case|case
literal|'T'
case|:
name|act
operator|=
name|ACT_DUMPSTATS
expr_stmt|;
break|break;
case|case
literal|'C'
case|:
name|act
operator|=
name|ACT_DUMPCONFIG
expr_stmt|;
break|break;
case|case
literal|'t'
case|:
name|act
operator|=
name|ACT_SET_TXRATE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|act
operator|=
name|ACT_SET_PWRSAVE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'p'
case|:
name|act
operator|=
name|ACT_SET_TXPWR
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'v'
case|:
name|modifier
operator|=
name|atoi
argument_list|(
name|optarg
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'a'
case|:
switch|switch
condition|(
name|modifier
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|1
case|:
name|act
operator|=
name|ACT_SET_AP1
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|act
operator|=
name|ACT_SET_AP2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|act
operator|=
name|ACT_SET_AP3
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|act
operator|=
name|ACT_SET_AP4
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad modifier %d: there "
literal|"are only 4 access point settings"
argument_list|,
name|modifier
argument_list|)
expr_stmt|;
name|usage
argument_list|(
name|p
argument_list|)
expr_stmt|;
break|break;
block|}
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'b'
case|:
name|act
operator|=
name|ACT_SET_BEACON_PERIOD
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
switch|switch
condition|(
name|modifier
condition|)
block|{
case|case
literal|0
case|:
name|act
operator|=
name|ACT_SET_DIVERSITY_RX
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|act
operator|=
name|ACT_SET_DIVERSITY_TX
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"must specift RX or TX diversity"
argument_list|)
expr_stmt|;
break|break;
block|}
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'j'
case|:
name|act
operator|=
name|ACT_SET_NETJOIN
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'l'
case|:
name|act
operator|=
name|ACT_SET_MYNAME
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'m'
case|:
name|act
operator|=
name|ACT_SET_MAC
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
switch|switch
condition|(
name|modifier
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|1
case|:
name|act
operator|=
name|ACT_SET_SSID1
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|act
operator|=
name|ACT_SET_SSID2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|act
operator|=
name|ACT_SET_SSID3
expr_stmt|;
break|break;
default|default:
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad modifier %d: there"
literal|"are only 3 SSID settings"
argument_list|,
name|modifier
argument_list|)
expr_stmt|;
name|usage
argument_list|(
name|p
argument_list|)
expr_stmt|;
break|break;
block|}
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'o'
case|:
name|act
operator|=
name|ACT_SET_OPMODE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|act
operator|=
name|ACT_SET_FREQ
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'f'
case|:
name|act
operator|=
name|ACT_SET_FRAG_THRESH
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'W'
case|:
name|act
operator|=
name|ACT_ENABLE_WEP
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'K'
case|:
name|act
operator|=
name|ACT_SET_KEY_TYPE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'k'
case|:
name|act
operator|=
name|ACT_SET_KEYS
expr_stmt|;
name|key
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'e'
case|:
name|act
operator|=
name|ACT_ENABLE_TX_KEY
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'q'
case|:
name|act
operator|=
name|ACT_SET_RTS_RETRYLIM
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'r'
case|:
name|act
operator|=
name|ACT_SET_RTS_THRESH
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
name|act
operator|=
name|ACT_SET_WAKE_DURATION
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'M'
case|:
name|act
operator|=
name|ACT_SET_MONITOR_MODE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'L'
case|:
name|act
operator|=
name|ACT_SET_LEAP_MODE
expr_stmt|;
name|arg
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'h'
case|:
default|default:
name|usage
argument_list|(
name|p
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|iface
operator|==
name|NULL
operator|||
operator|(
operator|!
name|act
operator|&&
operator|!
name|key
operator|)
condition|)
name|usage
argument_list|(
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|act
condition|)
block|{
case|case
name|ACT_DUMPSTATUS
case|:
name|an_dumpstatus
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPCAPS
case|:
name|an_dumpcaps
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPSTATS
case|:
name|an_dumpstats
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPCONFIG
case|:
name|an_dumpconfig
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPSSID
case|:
name|an_dumpssid
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPAP
case|:
name|an_dumpap
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_SSID1
case|:
case|case
name|ACT_SET_SSID2
case|:
case|case
name|ACT_SET_SSID3
case|:
name|an_setssid
argument_list|(
name|iface
argument_list|,
name|act
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_AP1
case|:
case|case
name|ACT_SET_AP2
case|:
case|case
name|ACT_SET_AP3
case|:
case|case
name|ACT_SET_AP4
case|:
name|an_setap
argument_list|(
name|iface
argument_list|,
name|act
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_TXRATE
case|:
name|an_setspeed
argument_list|(
name|iface
argument_list|,
name|act
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|ANCACHE
case|case
name|ACT_ZEROCACHE
case|:
name|an_zerocache
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_DUMPCACHE
case|:
name|an_readcache
argument_list|(
name|iface
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
case|case
name|ACT_SET_KEYS
case|:
name|an_setkeys
argument_list|(
name|iface
argument_list|,
name|key
argument_list|,
name|modifier
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_ENABLE_TX_KEY
case|:
name|an_enable_tx_key
argument_list|(
name|iface
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACT_SET_LEAP_MODE
case|:
name|an_enable_leap_mode
argument_list|(
name|iface
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
default|default:
name|an_setconfig
argument_list|(
name|iface
argument_list|,
name|act
argument_list|,
name|arg
argument_list|)
expr_stmt|;
break|break;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

