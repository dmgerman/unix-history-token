begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * host_controller_baseband.c  *  * Copyright (c) 2001-2002 Maksim Yevmenkin<m_evmenkin@yahoo.com>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $Id: host_controller_baseband.c,v 1.4 2003/08/18 19:19:53 max Exp $  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<bluetooth.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"hccontrol.h"
end_include

begin_comment
comment|/* Convert hex ASCII to int4 */
end_comment

begin_function
specifier|static
name|int
name|hci_hexa2int4
parameter_list|(
specifier|const
name|char
modifier|*
name|a
parameter_list|)
block|{
if|if
condition|(
literal|'0'
operator|<=
operator|*
name|a
operator|&&
operator|*
name|a
operator|<=
literal|'9'
condition|)
return|return
operator|(
operator|*
name|a
operator|-
literal|'0'
operator|)
return|;
if|if
condition|(
literal|'A'
operator|<=
operator|*
name|a
operator|&&
operator|*
name|a
operator|<=
literal|'F'
condition|)
return|return
operator|(
operator|*
name|a
operator|-
literal|'A'
operator|+
literal|0xa
operator|)
return|;
if|if
condition|(
literal|'a'
operator|<=
operator|*
name|a
operator|&&
operator|*
name|a
operator|<=
literal|'f'
condition|)
return|return
operator|(
operator|*
name|a
operator|-
literal|'a'
operator|+
literal|0xa
operator|)
return|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Convert hex ASCII to int8 */
end_comment

begin_function
specifier|static
name|int
name|hci_hexa2int8
parameter_list|(
specifier|const
name|char
modifier|*
name|a
parameter_list|)
block|{
name|int
name|hi
init|=
name|hci_hexa2int4
argument_list|(
name|a
argument_list|)
decl_stmt|;
name|int
name|lo
init|=
name|hci_hexa2int4
argument_list|(
name|a
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
name|hi
operator|<
literal|0
operator|||
name|lo
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
operator|(
name|hi
operator|<<
literal|4
operator|)
operator||
name|lo
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Convert ascii hex string to the uint8_t[] */
end_comment

begin_function
specifier|static
name|int
name|hci_hexstring2array
parameter_list|(
name|char
specifier|const
modifier|*
name|s
parameter_list|,
name|uint8_t
modifier|*
name|a
parameter_list|,
name|int
name|asize
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|l
decl_stmt|,
name|b
decl_stmt|;
name|l
operator|=
name|strlen
argument_list|(
name|s
argument_list|)
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|l
operator|>
name|asize
condition|)
name|l
operator|=
name|asize
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|l
condition|;
name|i
operator|++
control|)
block|{
name|b
operator|=
name|hci_hexa2int8
argument_list|(
name|s
operator|+
name|i
operator|*
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|a
index|[
name|i
index|]
operator|=
operator|(
name|b
operator|&
literal|0xff
operator|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Send RESET to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_reset
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_status_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_RESET
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_reset */
end_comment

begin_comment
comment|/* Send Read_PIN_Type command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_pin_type
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_pin_type_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_PIN_TYPE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PIN type: %s [%#02x]\n"
argument_list|,
name|hci_pin2str
argument_list|(
name|rp
operator|.
name|pin_type
argument_list|)
argument_list|,
name|rp
operator|.
name|pin_type
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_pin_type */
end_comment

begin_comment
comment|/* Send Write_PIN_Type command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_pin_type
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_pin_type_cp
name|cp
decl_stmt|;
name|ng_hci_write_pin_type_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|1
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|pin_type
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_PIN_TYPE
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_pin_type */
end_comment

begin_comment
comment|/* Send Read_Stored_Link_Key command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_stored_link_key
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
struct|struct
block|{
name|ng_hci_cmd_pkt_t
name|hdr
decl_stmt|;
name|ng_hci_read_stored_link_key_cp
name|cp
decl_stmt|;
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
name|cmd
struct|;
struct|struct
block|{
name|ng_hci_event_pkt_t
name|hdr
decl_stmt|;
union|union
block|{
name|ng_hci_command_compl_ep
name|cc
decl_stmt|;
name|ng_hci_return_link_keys_ep
name|key
decl_stmt|;
name|uint8_t
name|b
index|[
name|NG_HCI_EVENT_PKT_SIZE
index|]
decl_stmt|;
block|}
name|ep
union|;
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
name|event
struct|;
name|int
name|n
decl_stmt|,
name|n1
decl_stmt|;
comment|/* Send command */
name|memset
argument_list|(
operator|&
name|cmd
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|cmd
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|.
name|hdr
operator|.
name|type
operator|=
name|NG_HCI_CMD_PKT
expr_stmt|;
name|cmd
operator|.
name|hdr
operator|.
name|opcode
operator|=
name|htole16
argument_list|(
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_STORED_LINK_KEY
argument_list|)
argument_list|)
expr_stmt|;
name|cmd
operator|.
name|hdr
operator|.
name|length
operator|=
sizeof|sizeof
argument_list|(
name|cmd
operator|.
name|cp
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
comment|/* parse BD_ADDR */
if|if
condition|(
operator|!
name|bt_aton
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
operator|&
name|cmd
operator|.
name|cp
operator|.
name|bdaddr
argument_list|)
condition|)
block|{
name|struct
name|hostent
modifier|*
name|he
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|(
name|he
operator|=
name|bt_gethostbyname
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|memcpy
argument_list|(
operator|&
name|cmd
operator|.
name|cp
operator|.
name|bdaddr
argument_list|,
name|he
operator|->
name|h_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|cmd
operator|.
name|cp
operator|.
name|bdaddr
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|cmd
operator|.
name|cp
operator|.
name|read_all
operator|=
literal|1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|hci_send
argument_list|(
name|s
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cmd
argument_list|,
sizeof|sizeof
argument_list|(
name|cmd
argument_list|)
argument_list|)
operator|!=
name|OK
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
comment|/* Receive events */
name|again
label|:
name|memset
argument_list|(
operator|&
name|event
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|event
argument_list|)
argument_list|)
expr_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_recv
argument_list|(
name|s
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|event
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
name|OK
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|n
operator|<=
sizeof|sizeof
argument_list|(
name|event
operator|.
name|hdr
argument_list|)
condition|)
block|{
name|errno
operator|=
name|EMSGSIZE
expr_stmt|;
return|return
operator|(
name|ERROR
operator|)
return|;
block|}
if|if
condition|(
name|event
operator|.
name|hdr
operator|.
name|type
operator|!=
name|NG_HCI_EVENT_PKT
condition|)
block|{
name|errno
operator|=
name|EIO
expr_stmt|;
return|return
operator|(
name|ERROR
operator|)
return|;
block|}
comment|/* Parse event */
switch|switch
condition|(
name|event
operator|.
name|hdr
operator|.
name|event
condition|)
block|{
case|case
name|NG_HCI_EVENT_COMMAND_COMPL
case|:
block|{
name|ng_hci_read_stored_link_key_rp
modifier|*
name|rp
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|event
operator|.
name|ep
operator|.
name|cc
operator|.
name|opcode
operator|==
literal|0x0000
operator|||
name|event
operator|.
name|ep
operator|.
name|cc
operator|.
name|opcode
operator|!=
name|cmd
operator|.
name|hdr
operator|.
name|opcode
condition|)
goto|goto
name|again
goto|;
name|rp
operator|=
operator|(
name|ng_hci_read_stored_link_key_rp
operator|*
operator|)
operator|(
name|event
operator|.
name|ep
operator|.
name|b
operator|+
sizeof|sizeof
argument_list|(
name|event
operator|.
name|ep
operator|.
name|cc
argument_list|)
operator|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Complete: Status: %s [%#x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|->
name|status
argument_list|)
argument_list|,
name|rp
operator|->
name|status
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Maximum Number of keys: %d\n"
argument_list|,
name|le16toh
argument_list|(
name|rp
operator|->
name|max_num_keys
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Number of keys read: %d\n"
argument_list|,
name|le16toh
argument_list|(
name|rp
operator|->
name|num_keys_read
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|NG_HCI_EVENT_RETURN_LINK_KEYS
case|:
block|{
struct|struct
name|_key
block|{
name|bdaddr_t
name|bdaddr
decl_stmt|;
name|uint8_t
name|key
index|[
name|NG_HCI_KEY_SIZE
index|]
decl_stmt|;
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
modifier|*
name|k
init|=
name|NULL
struct|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Event: Number of keys: %d\n"
argument_list|,
name|event
operator|.
name|ep
operator|.
name|key
operator|.
name|num_keys
argument_list|)
expr_stmt|;
name|k
operator|=
operator|(
expr|struct
name|_key
operator|*
operator|)
operator|(
name|event
operator|.
name|ep
operator|.
name|b
operator|+
sizeof|sizeof
argument_list|(
name|event
operator|.
name|ep
operator|.
name|key
argument_list|)
operator|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|event
operator|.
name|ep
operator|.
name|key
operator|.
name|num_keys
condition|;
name|n
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\t%d: %s "
argument_list|,
name|n
operator|+
literal|1
argument_list|,
name|hci_bdaddr2str
argument_list|(
operator|&
name|k
operator|->
name|bdaddr
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|n1
operator|=
literal|0
init|;
name|n1
operator|<
sizeof|sizeof
argument_list|(
name|k
operator|->
name|key
argument_list|)
condition|;
name|n1
operator|++
control|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02x"
argument_list|,
name|k
operator|->
name|key
index|[
name|n1
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|k
operator|++
expr_stmt|;
block|}
goto|goto
name|again
goto|;
block|}
break|break;
default|default:
goto|goto
name|again
goto|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_store_link_key */
end_comment

begin_comment
comment|/* Send Write_Stored_Link_Key command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_stored_link_key
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
struct|struct
block|{
name|ng_hci_write_stored_link_key_cp
name|p
decl_stmt|;
name|bdaddr_t
name|bdaddr
decl_stmt|;
name|uint8_t
name|key
index|[
name|NG_HCI_KEY_SIZE
index|]
decl_stmt|;
block|}
name|cp
struct|;
name|ng_hci_write_stored_link_key_rp
name|rp
decl_stmt|;
name|int32_t
name|n
decl_stmt|;
name|memset
argument_list|(
operator|&
name|cp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|2
case|:
name|cp
operator|.
name|p
operator|.
name|num_keys_write
operator|=
literal|1
expr_stmt|;
comment|/* parse BD_ADDR */
if|if
condition|(
operator|!
name|bt_aton
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
operator|&
name|cp
operator|.
name|bdaddr
argument_list|)
condition|)
block|{
name|struct
name|hostent
modifier|*
name|he
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|(
name|he
operator|=
name|bt_gethostbyname
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|memcpy
argument_list|(
operator|&
name|cp
operator|.
name|bdaddr
argument_list|,
name|he
operator|->
name|h_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
operator|.
name|bdaddr
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* parse key */
if|if
condition|(
name|hci_hexstring2array
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
name|cp
operator|.
name|key
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
operator|.
name|key
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_STORED_LINK_KEY
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Number of keys written: %d\n"
argument_list|,
name|rp
operator|.
name|num_keys_written
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_stored_link_key */
end_comment

begin_comment
comment|/* Send Delete_Stored_Link_Key command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_delete_stored_link_key
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_delete_stored_link_key_cp
name|cp
decl_stmt|;
name|ng_hci_delete_stored_link_key_rp
name|rp
decl_stmt|;
name|int32_t
name|n
decl_stmt|;
name|memset
argument_list|(
operator|&
name|cp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
comment|/* parse BD_ADDR */
if|if
condition|(
operator|!
name|bt_aton
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
operator|&
name|cp
operator|.
name|bdaddr
argument_list|)
condition|)
block|{
name|struct
name|hostent
modifier|*
name|he
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|(
name|he
operator|=
name|bt_gethostbyname
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|memcpy
argument_list|(
operator|&
name|cp
operator|.
name|bdaddr
argument_list|,
name|he
operator|->
name|h_addr
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
operator|.
name|bdaddr
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|cp
operator|.
name|delete_all
operator|=
literal|1
expr_stmt|;
break|break;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_DELETE_STORED_LINK_KEY
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Number of keys deleted: %d\n"
argument_list|,
name|rp
operator|.
name|num_keys_deleted
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_delete_stored_link_key */
end_comment

begin_comment
comment|/* Send Change_Local_Name command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_change_local_name
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_change_local_name_cp
name|cp
decl_stmt|;
name|ng_hci_change_local_name_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
name|snprintf
argument_list|(
name|cp
operator|.
name|name
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
operator|.
name|name
argument_list|)
argument_list|,
literal|"%s"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_CHANGE_LOCAL_NAME
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_change_local_name */
end_comment

begin_comment
comment|/* Send Read_Local_Name command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_local_name
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_local_name_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_LOCAL_NAME
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Local name: %s\n"
argument_list|,
name|rp
operator|.
name|name
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_local_name */
end_comment

begin_comment
comment|/* Send Read_Connection_Accept_Timeout to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_connection_accept_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_con_accept_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_CON_ACCEPT_TIMO
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|timeout
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Connection accept timeout: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|timeout
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_connection_accept_timeout */
end_comment

begin_comment
comment|/* Send Write_Connection_Accept_Timeout to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_connection_accept_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_con_accept_timo_cp
name|cp
decl_stmt|;
name|ng_hci_write_con_accept_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|1
operator|||
name|n
operator|>
literal|0xb540
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|timeout
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
name|cp
operator|.
name|timeout
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|timeout
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_CON_ACCEPT_TIMO
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_connection_accept_timeout */
end_comment

begin_comment
comment|/* Send Read_Page_Timeout command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_page_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_page_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_PAGE_TIMO
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|timeout
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Page timeout: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|timeout
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_page_timeoout */
end_comment

begin_comment
comment|/* Send Write_Page_Timeout command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_page_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_page_timo_cp
name|cp
decl_stmt|;
name|ng_hci_write_page_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|1
operator|||
name|n
operator|>
literal|0xffff
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|timeout
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
name|cp
operator|.
name|timeout
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|timeout
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_PAGE_TIMO
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_page_timeout */
end_comment

begin_comment
comment|/* Send Read_Scan_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_scan_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_scan_enable_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_SCAN_ENABLE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Scan enable: %s [%#02x]\n"
argument_list|,
name|hci_scan2str
argument_list|(
name|rp
operator|.
name|scan_enable
argument_list|)
argument_list|,
name|rp
operator|.
name|scan_enable
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_scan_enable */
end_comment

begin_comment
comment|/* Send Write_Scan_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_scan_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_scan_enable_cp
name|cp
decl_stmt|;
name|ng_hci_write_scan_enable_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|3
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|scan_enable
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_SCAN_ENABLE
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_scan_enable */
end_comment

begin_comment
comment|/* Send Read_Page_Scan_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_page_scan_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_page_scan_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_PAGE_SCAN_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|page_scan_interval
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|page_scan_interval
argument_list|)
expr_stmt|;
name|rp
operator|.
name|page_scan_window
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|page_scan_window
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Page Scan Interval: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|page_scan_interval
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|page_scan_interval
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Page Scan Window: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|page_scan_window
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|page_scan_window
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_page_scan_activity */
end_comment

begin_comment
comment|/* Send Write_Page_Scan_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_page_scan_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_page_scan_activity_cp
name|cp
decl_stmt|;
name|ng_hci_write_page_scan_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|2
case|:
comment|/* page scan interval */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0x12
operator|||
name|n
operator|>
literal|0x1000
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|page_scan_interval
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
comment|/* page scan window */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0x12
operator|||
name|n
operator|>
literal|0x1000
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|page_scan_window
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
if|if
condition|(
name|cp
operator|.
name|page_scan_window
operator|>
name|cp
operator|.
name|page_scan_interval
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|page_scan_interval
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|page_scan_interval
argument_list|)
expr_stmt|;
name|cp
operator|.
name|page_scan_window
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|page_scan_window
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_PAGE_SCAN_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_page_scan_activity */
end_comment

begin_comment
comment|/* Send Read_Inquiry_Scan_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_inquiry_scan_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_inquiry_scan_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_INQUIRY_SCAN_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|inquiry_scan_interval
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|inquiry_scan_interval
argument_list|)
expr_stmt|;
name|rp
operator|.
name|inquiry_scan_window
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|inquiry_scan_window
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Inquiry Scan Interval: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|inquiry_scan_interval
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|inquiry_scan_interval
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Inquiry Scan Window: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|inquiry_scan_window
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|inquiry_scan_interval
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_inquiry_scan_activity */
end_comment

begin_comment
comment|/* Send Write_Inquiry_Scan_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_inquiry_scan_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_inquiry_scan_activity_cp
name|cp
decl_stmt|;
name|ng_hci_write_inquiry_scan_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|2
case|:
comment|/* inquiry scan interval */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0x12
operator|||
name|n
operator|>
literal|0x1000
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|inquiry_scan_interval
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
comment|/* inquiry scan window */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0x12
operator|||
name|n
operator|>
literal|0x1000
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|inquiry_scan_window
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
if|if
condition|(
name|cp
operator|.
name|inquiry_scan_window
operator|>
name|cp
operator|.
name|inquiry_scan_interval
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|inquiry_scan_interval
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|inquiry_scan_interval
argument_list|)
expr_stmt|;
name|cp
operator|.
name|inquiry_scan_window
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|inquiry_scan_window
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_INQUIRY_SCAN_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_inquiry_scan_activity */
end_comment

begin_comment
comment|/* Send Read_Authentication_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_authentication_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_auth_enable_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_AUTH_ENABLE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Authentication Enable: %s [%d]\n"
argument_list|,
name|rp
operator|.
name|auth_enable
condition|?
literal|"Enabled"
else|:
literal|"Disabled"
argument_list|,
name|rp
operator|.
name|auth_enable
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_authentication_enable */
end_comment

begin_comment
comment|/* Send Write_Authentication_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_authentication_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_auth_enable_cp
name|cp
decl_stmt|;
name|ng_hci_write_auth_enable_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|1
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|auth_enable
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_AUTH_ENABLE
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_authentication_enable */
end_comment

begin_comment
comment|/* Send Read_Encryption_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_encryption_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_encryption_mode_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_ENCRYPTION_MODE
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Encryption mode: %s [%#02x]\n"
argument_list|,
name|hci_encrypt2str
argument_list|(
name|rp
operator|.
name|encryption_mode
argument_list|,
literal|0
argument_list|)
argument_list|,
name|rp
operator|.
name|encryption_mode
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_encryption_mode */
end_comment

begin_comment
comment|/* Send Write_Encryption_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_encryption_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_encryption_mode_cp
name|cp
decl_stmt|;
name|ng_hci_write_encryption_mode_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|2
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|encryption_mode
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_ENCRYPTION_MODE
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_encryption_mode */
end_comment

begin_comment
comment|/* Send Read_Class_Of_Device command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_class_of_device
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_unit_class_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_UNIT_CLASS
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Class: %02x:%02x:%02x\n"
argument_list|,
name|rp
operator|.
name|uclass
index|[
literal|2
index|]
argument_list|,
name|rp
operator|.
name|uclass
index|[
literal|1
index|]
argument_list|,
name|rp
operator|.
name|uclass
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_class_of_device */
end_comment

begin_comment
comment|/* Send Write_Class_Of_Device command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_class_of_device
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_unit_class_cp
name|cp
decl_stmt|;
name|ng_hci_write_unit_class_rp
name|rp
decl_stmt|;
name|int
name|n0
decl_stmt|,
name|n1
decl_stmt|,
name|n2
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%x:%x:%x"
argument_list|,
operator|&
name|n2
argument_list|,
operator|&
name|n1
argument_list|,
operator|&
name|n0
argument_list|)
operator|!=
literal|3
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|uclass
index|[
literal|0
index|]
operator|=
operator|(
name|n0
operator|&
literal|0xff
operator|)
expr_stmt|;
name|cp
operator|.
name|uclass
index|[
literal|1
index|]
operator|=
operator|(
name|n1
operator|&
literal|0xff
operator|)
expr_stmt|;
name|cp
operator|.
name|uclass
index|[
literal|2
index|]
operator|=
operator|(
name|n2
operator|&
literal|0xff
operator|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n0
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_UNIT_CLASS
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n0
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_class_of_device */
end_comment

begin_comment
comment|/* Send Read_Voice_Settings command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_voice_settings
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_voice_settings_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|,
name|input_coding
decl_stmt|,
name|input_data_format
decl_stmt|,
name|input_sample_size
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_VOICE_SETTINGS
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|settings
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|settings
argument_list|)
expr_stmt|;
name|input_coding
operator|=
operator|(
name|rp
operator|.
name|settings
operator|&
literal|0x0300
operator|)
operator|>>
literal|8
expr_stmt|;
name|input_data_format
operator|=
operator|(
name|rp
operator|.
name|settings
operator|&
literal|0x00c0
operator|)
operator|>>
literal|6
expr_stmt|;
name|input_sample_size
operator|=
operator|(
name|rp
operator|.
name|settings
operator|&
literal|0x0020
operator|)
operator|>>
literal|5
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Voice settings: %#04x\n"
argument_list|,
name|rp
operator|.
name|settings
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Input coding: %s [%d]\n"
argument_list|,
name|hci_coding2str
argument_list|(
name|input_coding
argument_list|)
argument_list|,
name|input_coding
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Input data format: %s [%d]\n"
argument_list|,
name|hci_vdata2str
argument_list|(
name|input_data_format
argument_list|)
argument_list|,
name|input_data_format
argument_list|)
expr_stmt|;
if|if
condition|(
name|input_coding
operator|==
literal|0x00
condition|)
comment|/* Only for Linear PCM */
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Input sample size: %d bit [%d]\n"
argument_list|,
name|input_sample_size
condition|?
literal|16
else|:
literal|8
argument_list|,
name|input_sample_size
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_voice_settings */
end_comment

begin_comment
comment|/* Send Write_Voice_Settings command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_voice_settings
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_voice_settings_cp
name|cp
decl_stmt|;
name|ng_hci_write_voice_settings_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%x"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|settings
operator|=
operator|(
name|uint16_t
operator|)
name|n
expr_stmt|;
name|cp
operator|.
name|settings
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|settings
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_VOICE_SETTINGS
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_voice_settings */
end_comment

begin_comment
comment|/* Send Read_Number_Broadcast_Restransmissions */
end_comment

begin_function
specifier|static
name|int
name|hci_read_number_broadcast_retransmissions
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_num_broadcast_retrans_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_NUM_BROADCAST_RETRANS
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Number of broadcast retransmissions: %d\n"
argument_list|,
name|rp
operator|.
name|counter
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_number_broadcast_retransmissions */
end_comment

begin_comment
comment|/* Send Write_Number_Broadcast_Restransmissions */
end_comment

begin_function
specifier|static
name|int
name|hci_write_number_broadcast_retransmissions
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_num_broadcast_retrans_cp
name|cp
decl_stmt|;
name|ng_hci_write_num_broadcast_retrans_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|0xff
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|counter
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_NUM_BROADCAST_RETRANS
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_number_broadcast_retransmissions */
end_comment

begin_comment
comment|/* Send Read_Hold_Mode_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_hold_mode_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_hold_mode_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|char
name|buffer
index|[
literal|1024
index|]
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_HOLD_MODE_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Hold Mode Activities: %#02x\n"
argument_list|,
name|rp
operator|.
name|hold_mode_activity
argument_list|)
expr_stmt|;
if|if
condition|(
name|rp
operator|.
name|hold_mode_activity
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Maintain current Power State"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%s"
argument_list|,
name|hci_hmode2str
argument_list|(
name|rp
operator|.
name|hold_mode_activity
argument_list|,
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_hold_mode_activity */
end_comment

begin_comment
comment|/* Send Write_Hold_Mode_Activity command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_hold_mode_activity
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_hold_mode_activity_cp
name|cp
decl_stmt|;
name|ng_hci_write_hold_mode_activity_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|4
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|hold_mode_activity
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_HOLD_MODE_ACTIVITY
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_hold_mode_activity */
end_comment

begin_comment
comment|/* Send Read_SCO_Flow_Control_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_sco_flow_control_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_sco_flow_control_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_SCO_FLOW_CONTROL
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SCO flow control %s [%d]\n"
argument_list|,
name|rp
operator|.
name|flow_control
condition|?
literal|"enabled"
else|:
literal|"disabled"
argument_list|,
name|rp
operator|.
name|flow_control
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_sco_flow_control_enable */
end_comment

begin_comment
comment|/* Send Write_SCO_Flow_Control_Enable command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_sco_flow_control_enable
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_sco_flow_control_cp
name|cp
decl_stmt|;
name|ng_hci_write_sco_flow_control_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command parameters */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|1
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|flow_control
operator|=
operator|(
name|uint8_t
operator|)
name|n
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_SCO_FLOW_CONTROL
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_sco_flow_control_enable */
end_comment

begin_comment
comment|/* Send Read_Link_Supervision_Timeout command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_link_supervision_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_link_supervision_timo_cp
name|cp
decl_stmt|;
name|ng_hci_read_link_supervision_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
comment|/* connection handle */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<=
literal|0
operator|||
name|n
operator|>
literal|0x0eff
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|con_handle
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|n
operator|&
literal|0x0fff
argument_list|)
expr_stmt|;
name|cp
operator|.
name|con_handle
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|con_handle
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_LINK_SUPERVISION_TIMO
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|rp
operator|.
name|timeout
operator|=
name|le16toh
argument_list|(
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Connection handle: %d\n"
argument_list|,
name|le16toh
argument_list|(
name|rp
operator|.
name|con_handle
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Link supervision timeout: %.2f msec [%d slots]\n"
argument_list|,
name|rp
operator|.
name|timeout
operator|*
literal|0.625
argument_list|,
name|rp
operator|.
name|timeout
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_link_supervision_timeout */
end_comment

begin_comment
comment|/* Send Write_Link_Supervision_Timeout command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_link_supervision_timeout
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_link_supervision_timo_cp
name|cp
decl_stmt|;
name|ng_hci_write_link_supervision_timo_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|2
case|:
comment|/* connection handle */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<=
literal|0
operator|||
name|n
operator|>
literal|0x0eff
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|con_handle
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|n
operator|&
literal|0x0fff
argument_list|)
expr_stmt|;
name|cp
operator|.
name|con_handle
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|con_handle
argument_list|)
expr_stmt|;
comment|/* link supervision timeout */
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|0xffff
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|timeout
operator|=
call|(
name|uint16_t
call|)
argument_list|(
name|n
operator|&
literal|0x0fff
argument_list|)
expr_stmt|;
name|cp
operator|.
name|timeout
operator|=
name|htole16
argument_list|(
name|cp
operator|.
name|timeout
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_LINK_SUPERVISION_TIMO
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_link_supervision_timeout */
end_comment

begin_comment
comment|/* Send Read_Page_Scan_Period_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_page_scan_period_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_page_scan_period_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_PAGE_SCAN_PERIOD
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Page scan period mode: %#02x\n"
argument_list|,
name|rp
operator|.
name|page_scan_period_mode
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_page_scan_period_mode */
end_comment

begin_comment
comment|/* Send Write_Page_Scan_Period_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_page_scan_period_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_page_scan_period_cp
name|cp
decl_stmt|;
name|ng_hci_write_page_scan_period_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command arguments */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|2
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|page_scan_period_mode
operator|=
operator|(
name|n
operator|&
literal|0xff
operator|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_PAGE_SCAN_PERIOD
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_page_scan_period_mode */
end_comment

begin_comment
comment|/* Send Read_Page_Scan_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_read_page_scan_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_read_page_scan_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_simple_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_READ_PAGE_SCAN
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Page scan mode: %#02x\n"
argument_list|,
name|rp
operator|.
name|page_scan_mode
argument_list|)
expr_stmt|;
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_read_page_scan_mode */
end_comment

begin_comment
comment|/* Send Write_Page_Scan_Mode command to the unit */
end_comment

begin_function
specifier|static
name|int
name|hci_write_page_scan_mode
parameter_list|(
name|int
name|s
parameter_list|,
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|ng_hci_write_page_scan_cp
name|cp
decl_stmt|;
name|ng_hci_write_page_scan_rp
name|rp
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* parse command arguments */
switch|switch
condition|(
name|argc
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
name|sscanf
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
literal|"%d"
argument_list|,
operator|&
name|n
argument_list|)
operator|!=
literal|1
operator|||
name|n
operator|<
literal|0
operator|||
name|n
operator|>
literal|3
condition|)
return|return
operator|(
name|USAGE
operator|)
return|;
name|cp
operator|.
name|page_scan_mode
operator|=
operator|(
name|n
operator|&
literal|0xff
operator|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|USAGE
operator|)
return|;
block|}
comment|/* send command */
name|n
operator|=
sizeof|sizeof
argument_list|(
name|rp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hci_request
argument_list|(
name|s
argument_list|,
name|NG_HCI_OPCODE
argument_list|(
name|NG_HCI_OGF_HC_BASEBAND
argument_list|,
name|NG_HCI_OCF_WRITE_PAGE_SCAN
argument_list|)
argument_list|,
operator|(
name|char
specifier|const
operator|*
operator|)
operator|&
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
name|cp
argument_list|)
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|&
name|rp
argument_list|,
operator|&
name|n
argument_list|)
operator|==
name|ERROR
condition|)
return|return
operator|(
name|ERROR
operator|)
return|;
if|if
condition|(
name|rp
operator|.
name|status
operator|!=
literal|0x00
condition|)
block|{
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Status: %s [%#02x]\n"
argument_list|,
name|hci_status2str
argument_list|(
name|rp
operator|.
name|status
argument_list|)
argument_list|,
name|rp
operator|.
name|status
argument_list|)
expr_stmt|;
return|return
operator|(
name|FAILED
operator|)
return|;
block|}
return|return
operator|(
name|OK
operator|)
return|;
block|}
end_function

begin_comment
comment|/* hci_write_page_scan_mode */
end_comment

begin_decl_stmt
name|struct
name|hci_command
name|host_controller_baseband_commands
index|[]
init|=
block|{
block|{
literal|"reset"
block|,
literal|"\nThe Reset command will reset the Host Controller and the Link Manager.\n"
expr|\
literal|"After the reset is completed, the current operational state will be lost,\n"
expr|\
literal|"the Bluetooth unit will enter standby mode and the Host Controller will\n"
expr|\
literal|"automatically revert to the default values for the parameters for which\n"
expr|\
literal|"default values are defined in the specification."
block|,
operator|&
name|hci_reset
block|}
block|,
block|{
literal|"read_pin_type"
block|,
literal|"\nThe Read_PIN_Type command is used for the Host to read whether the Link\n"
expr|\
literal|"Manager assumes that the Host supports variable PIN codes only a fixed PIN\n"
expr|\
literal|"code."
block|,
operator|&
name|hci_read_pin_type
block|}
block|,
block|{
literal|"write_pin_type<pin_type>"
block|,
literal|"\nThe Write_PIN_Type command is used for the Host to write to the Host\n"
expr|\
literal|"Controller whether the Host supports variable PIN codes or only a fixed PIN\n"
expr|\
literal|"code.\n\n"
expr|\
literal|"\t<pin_type> - dd; 0 - Variable; 1 - Fixed"
block|,
operator|&
name|hci_write_pin_type
block|}
block|,
block|{
literal|"read_stored_link_key [<BD_ADDR>]"
block|,
literal|"\nThe Read_Stored_Link_Key command provides the ability to read one or\n"
expr|\
literal|"more link keys stored in the Bluetooth Host Controller. The Bluetooth Host\n"
expr|\
literal|"Controller can store a limited number of link keys for other Bluetooth\n"
expr|\
literal|"devices.\n\n"
expr|\
literal|"\t<BD_ADDR> - xx:xx:xx:xx:xx:xx BD_ADDR or name"
block|,
operator|&
name|hci_read_stored_link_key
block|}
block|,
block|{
literal|"write_stored_link_key<BD_ADDR><key>"
block|,
literal|"\nThe Write_Stored_Link_Key command provides the ability to write one\n"
expr|\
literal|"or more link keys to be stored in the Bluetooth Host Controller. The\n"
expr|\
literal|"Bluetooth Host Controller can store a limited number of link keys for other\n"
expr|\
literal|"Bluetooth devices. If no additional space is available in the Bluetooth\n"
expr|\
literal|"Host Controller then no additional link keys will be stored.\n\n"
expr|\
literal|"\t<BD_ADDR> - xx:xx:xx:xx:xx:xx BD_ADDR or name\n"
expr|\
literal|"\t<key>     - xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx up to 16 bytes link key"
block|,
operator|&
name|hci_write_stored_link_key
block|}
block|,
block|{
literal|"delete_stored_link_key [<BD_ADDR>]"
block|,
literal|"\nThe Delete_Stored_Link_Key command provides the ability to remove one\n"
expr|\
literal|"or more of the link keys stored in the Bluetooth Host Controller. The\n"
expr|\
literal|"Bluetooth Host Controller can store a limited number of link keys for other\n"
expr|\
literal|"Bluetooth devices.\n\n"
expr|\
literal|"\t<BD_ADDR> - xx:xx:xx:xx:xx:xx BD_ADDR or name"
block|,
operator|&
name|hci_delete_stored_link_key
block|}
block|,
block|{
literal|"change_local_name<name>"
block|,
literal|"\nThe Change_Local_Name command provides the ability to modify the user\n"
expr|\
literal|"friendly name for the Bluetooth unit.\n\n"
expr|\
literal|"\t<name> - string"
block|,
operator|&
name|hci_change_local_name
block|}
block|,
block|{
literal|"read_local_name"
block|,
literal|"\nThe Read_Local_Name command provides the ability to read the\n"
expr|\
literal|"stored user-friendly name for the Bluetooth unit."
block|,
operator|&
name|hci_read_local_name
block|}
block|,
block|{
literal|"read_connection_accept_timeout"
block|,
literal|"\nThis command will read the value for the Connection_Accept_Timeout\n"
expr|\
literal|"configuration parameter. The Connection_Accept_Timeout configuration\n"
expr|\
literal|"parameter allows the Bluetooth hardware to automatically deny a\n"
expr|\
literal|"connection request after a specified time period has occurred and\n"
expr|\
literal|"the new connection is not accepted. Connection Accept Timeout\n"
expr|\
literal|"measured in Number of Baseband slots."
block|,
operator|&
name|hci_read_connection_accept_timeout
block|}
block|,
block|{
literal|"write_connection_accept_timeout<timeout>"
block|,
literal|"\nThis command will write the value for the Connection_Accept_Timeout\n"
expr|\
literal|"configuration parameter.\n\n"
expr|\
literal|"\t<timeout> - dddd; measured in number of baseband slots."
block|,
operator|&
name|hci_write_connection_accept_timeout
block|}
block|,
block|{
literal|"read_page_timeout"
block|,
literal|"\nThis command will read the value for the Page_Timeout configuration\n"
expr|\
literal|"parameter. The Page_Timeout configuration parameter defines the\n"
expr|\
literal|"maximum time the local Link Manager will wait for a baseband page\n"
expr|\
literal|"response from the remote unit at a locally initiated connection\n"
expr|\
literal|"attempt. Page Timeout measured in Number of Baseband slots."
block|,
operator|&
name|hci_read_page_timeout
block|}
block|,
block|{
literal|"write_page_timeout<timeout>"
block|,
literal|"\nThis command will write the value for the Page_Timeout configuration\n"
expr|\
literal|"parameter.\n\n"
expr|\
literal|"\t<timeout> - dddd; measured in number of baseband slots."
block|,
operator|&
name|hci_write_page_timeout
block|}
block|,
block|{
literal|"read_scan_enable"
block|,
literal|"\nThis command will read the value for the Scan_Enable parameter. The\n"
expr|\
literal|"Scan_Enable parameter controls whether or not the Bluetooth uint\n"
expr|\
literal|"will periodically scan for page attempts and/or inquiry requests\n"
expr|\
literal|"from other Bluetooth unit.\n\n"
expr|\
literal|"\t0x00 - No Scans enabled.\n"
expr|\
literal|"\t0x01 - Inquiry Scan enabled. Page Scan disabled.\n"
expr|\
literal|"\t0x02 - Inquiry Scan disabled. Page Scan enabled.\n"
expr|\
literal|"\t0x03 - Inquiry Scan enabled. Page Scan enabled."
block|,
operator|&
name|hci_read_scan_enable
block|}
block|,
block|{
literal|"write_scan_enable<scan_enable>"
block|,
literal|"\nThis command will write the value for the Scan_Enable parameter.\n"
expr|\
literal|"The Scan_Enable parameter controls whether or not the Bluetooth\n"
expr|\
literal|"unit will periodically scan for page attempts and/or inquiry\n"
expr|\
literal|"requests from other Bluetooth unit.\n\n"
expr|\
literal|"\t<scan_enable> - dd;\n"
expr|\
literal|"\t0 - No Scans enabled.\n"
expr|\
literal|"\t1 - Inquiry Scan enabled. Page Scan disabled.\n"
expr|\
literal|"\t2 - Inquiry Scan disabled. Page Scan enabled.\n"
expr|\
literal|"\t3 - Inquiry Scan enabled. Page Scan enabled."
block|,
operator|&
name|hci_write_scan_enable
block|}
block|,
block|{
literal|"read_page_scan_activity"
block|,
literal|"\nThis command will read the value for Page_Scan_Activity configuration\n"
expr|\
literal|"parameters. The Page_Scan_Interval configuration parameter defines the\n"
expr|\
literal|"amount of time between consecutive page scans. This time interval is \n"
expr|\
literal|"defined from when the Host Controller started its last page scan until\n"
expr|\
literal|"it begins the next page scan. The Page_Scan_Window configuration parameter\n"
expr|\
literal|"defines the amount of time for the duration of the page scan. The\n"
expr|\
literal|"Page_Scan_Window can only be less than or equal to the Page_Scan_Interval."
block|,
operator|&
name|hci_read_page_scan_activity
block|}
block|,
block|{
literal|"write_page_scan_activity interval(dddd) window(dddd)"
block|,
literal|"\nThis command will write the value for Page_Scan_Activity configuration\n"
expr|\
literal|"parameter. The Page_Scan_Interval configuration parameter defines the\n"
expr|\
literal|"amount of time between consecutive page scans. This is defined as the time\n"
expr|\
literal|"interval from when the Host Controller started its last page scan until it\n"
expr|\
literal|"begins the next page scan. The Page_Scan_Window configuration parameter\n"
expr|\
literal|"defines the amount of time for the duration of the page scan. \n"
expr|\
literal|"The Page_Scan_Window can only be less than or equal to the Page_Scan_Interval.\n\n"
expr|\
literal|"\t<interval> - Range: 0x0012 - 0x100, Time = N * 0.625 msec\n"
expr|\
literal|"\t<window>   - Range: 0x0012 - 0x100, Time = N * 0.625 msen"
block|,
operator|&
name|hci_write_page_scan_activity
block|}
block|,
block|{
literal|"read_inquiry_scan_activity"
block|,
literal|"\nThis command will read the value for Inquiry_Scan_Activity configuration\n"
expr|\
literal|"parameter. The Inquiry_Scan_Interval configuration parameter defines the\n"
expr|\
literal|"amount of time between consecutive inquiry scans. This is defined as the\n"
expr|\
literal|"time interval from when the Host Controller started its last inquiry scan\n"
expr|\
literal|"until it begins the next inquiry scan."
block|,
operator|&
name|hci_read_inquiry_scan_activity
block|}
block|,
block|{
literal|"write_inquiry_scan_activity interval(dddd) window(dddd)"
block|,
literal|"\nThis command will write the value for Inquiry_Scan_Activity configuration\n"
expr|\
literal|"parameter. The Inquiry_Scan_Interval configuration parameter defines the\n"
expr|\
literal|"amount of time between consecutive inquiry scans. This is defined as the\n"
expr|\
literal|"time interval from when the Host Controller started its last inquiry scan\n"
expr|\
literal|"until it begins the next inquiry scan. The Inquiry_Scan_Window configuration\n"
expr|\
literal|"parameter defines the amount of time for the duration of the inquiry scan.\n"
expr|\
literal|"The Inquiry_Scan_Window can only be less than or equal to the Inquiry_Scan_Interval.\n\n"
expr|\
literal|"\t<interval> - Range: 0x0012 - 0x100, Time = N * 0.625 msec\n"
expr|\
literal|"\t<window>   - Range: 0x0012 - 0x100, Time = N * 0.625 msen"
block|,
operator|&
name|hci_write_inquiry_scan_activity
block|}
block|,
block|{
literal|"read_authentication_enable"
block|,
literal|"\nThis command will read the value for the Authentication_Enable parameter.\n"
expr|\
literal|"The Authentication_Enable parameter controls if the local unit requires\n"
expr|\
literal|"to authenticate the remote unit at connection setup (between the\n"
expr|\
literal|"Create_Connection command or acceptance of an incoming ACL connection\n"
expr|\
literal|"and the corresponding Connection Complete event). At connection setup, only\n"
expr|\
literal|"the unit(s) with the Authentication_Enable parameter enabled will try to\n"
expr|\
literal|"authenticate the other unit."
block|,
operator|&
name|hci_read_authentication_enable
block|}
block|,
block|{
literal|"write_authentication_enable enable(0|1)"
block|,
literal|"\nThis command will write the value for the Authentication_Enable parameter.\n"
expr|\
literal|"The Authentication_Enable parameter controls if the local unit requires to\n"
expr|\
literal|"authenticate the remote unit at connection setup (between the\n"
expr|\
literal|"Create_Connection command or acceptance of an incoming ACL connection\n"
expr|\
literal|"and the corresponding Connection Complete event). At connection setup, only\n"
expr|\
literal|"the unit(s) with the Authentication_Enable parameter enabled will try to\n"
expr|\
literal|"authenticate the other unit."
block|,
operator|&
name|hci_write_authentication_enable
block|}
block|,
block|{
literal|"read_encryption_mode"
block|,
literal|"\nThis command will read the value for the Encryption_Mode parameter. The\n"
expr|\
literal|"Encryption_Mode parameter controls if the local unit requires encryption\n"
expr|\
literal|"to the remote unit at connection setup (between the Create_Connection\n"
expr|\
literal|"command or acceptance of an incoming ACL connection and the corresponding\n"
expr|\
literal|"Connection Complete event). At connection setup, only the unit(s) with\n"
expr|\
literal|"the Authentication_Enable parameter enabled and Encryption_Mode parameter\n"
expr|\
literal|"enabled will try to encrypt the connection to the other unit.\n\n"
expr|\
literal|"\t<encryption_mode>:\n"
expr|\
literal|"\t0x00 - Encryption disabled.\n"
expr|\
literal|"\t0x01 - Encryption only for point-to-point packets.\n"
expr|\
literal|"\t0x02 - Encryption for both point-to-point and broadcast packets."
block|,
operator|&
name|hci_read_encryption_mode
block|}
block|,
block|{
literal|"write_encryption_mode mode(0|1|2)"
block|,
literal|"\tThis command will write the value for the Encryption_Mode parameter.\n"
expr|\
literal|"The Encryption_Mode parameter controls if the local unit requires\n"
expr|\
literal|"encryption to the remote unit at connection setup (between the\n"
expr|\
literal|"Create_Connection command or acceptance of an incoming ACL connection\n"
expr|\
literal|"and the corresponding Connection Complete event). At connection setup,\n"
expr|\
literal|"only the unit(s) with the Authentication_Enable parameter enabled and\n"
expr|\
literal|"Encryption_Mode parameter enabled will try to encrypt the connection to\n"
expr|\
literal|"the other unit.\n\n"
expr|\
literal|"\t<encryption_mode> (dd)\n"
expr|\
literal|"\t0 - Encryption disabled.\n"
expr|\
literal|"\t1 - Encryption only for point-to-point packets.\n"
expr|\
literal|"\t2 - Encryption for both point-to-point and broadcast packets."
block|,
operator|&
name|hci_write_encryption_mode
block|}
block|,
block|{
literal|"read_class_of_device"
block|,
literal|"\nThis command will read the value for the Class_of_Device parameter.\n"
expr|\
literal|"The Class_of_Device parameter is used to indicate the capabilities of\n"
expr|\
literal|"the local unit to other units."
block|,
operator|&
name|hci_read_class_of_device
block|}
block|,
block|{
literal|"write_class_of_device class(xx:xx:xx)"
block|,
literal|"\nThis command will write the value for the Class_of_Device parameter.\n"
expr|\
literal|"The Class_of_Device parameter is used to indicate the capabilities of \n"
expr|\
literal|"the local unit to other units.\n\n"
expr|\
literal|"\t<class> (xx:xx:xx) - class of device"
block|,
operator|&
name|hci_write_class_of_device
block|}
block|,
block|{
literal|"read_voice_settings"
block|,
literal|"\nThis command will read the values for the Voice_Setting parameter.\n"
expr|\
literal|"The Voice_Setting parameter controls all the various settings for voice\n"
expr|\
literal|"connections. These settings apply to all voice connections, and cannot be\n"
expr|\
literal|"set for individual voice connections. The Voice_Setting parameter controls\n"
expr|\
literal|"the configuration for voice connections: Input Coding, Air coding format,\n"
expr|\
literal|"input data format, Input sample size, and linear PCM parameter."
block|,
operator|&
name|hci_read_voice_settings
block|}
block|,
block|{
literal|"write_voice_settings settings(xxxx)"
block|,
literal|"\nThis command will write the values for the Voice_Setting parameter.\n"
expr|\
literal|"The Voice_Setting parameter controls all the various settings for voice\n"
expr|\
literal|"connections. These settings apply to all voice connections, and cannot be\n"
expr|\
literal|"set for individual voice connections. The Voice_Setting parameter controls\n"
expr|\
literal|"the configuration for voice connections: Input Coding, Air coding format,\n"
expr|\
literal|"input data format, Input sample size, and linear PCM parameter.\n\n"
expr|\
literal|"\t<voice_settings> (xxxx) - voice settings"
block|,
operator|&
name|hci_write_voice_settings
block|}
block|,
block|{
literal|"read_number_broadcast_retransmissions"
block|,
literal|"\nThis command will read the unit's parameter value for the Number of\n"
expr|\
literal|"Broadcast Retransmissions. Broadcast packets are not acknowledged and are\n"
expr|\
literal|"unreliable."
block|,
operator|&
name|hci_read_number_broadcast_retransmissions
block|}
block|,
block|{
literal|"write_number_broadcast_retransmissions count(dd)"
block|,
literal|"\nThis command will write the unit's parameter value for the Number of\n"
expr|\
literal|"Broadcast Retransmissions. Broadcast packets are not acknowledged and are\n"
expr|\
literal|"unreliable.\n\n"
expr|\
literal|"\t<count> (dd) - number of broadcast retransimissions"
block|,
operator|&
name|hci_write_number_broadcast_retransmissions
block|}
block|,
block|{
literal|"read_hold_mode_activity"
block|,
literal|"\nThis command will read the value for the Hold_Mode_Activity parameter.\n"
expr|\
literal|"The Hold_Mode_Activity value is used to determine what activities should\n"
expr|\
literal|"be suspended when the unit is in hold mode."
block|,
operator|&
name|hci_read_hold_mode_activity
block|}
block|,
block|{
literal|"write_hold_mode_activity settings(0|1|2|4)"
block|,
literal|"\nThis command will write the value for the Hold_Mode_Activity parameter.\n"
expr|\
literal|"The Hold_Mode_Activity value is used to determine what activities should\n"
expr|\
literal|"be suspended when the unit is in hold mode.\n\n"
expr|\
literal|"\t<settings> (dd) - bit mask:\n"
expr|\
literal|"\t0 - Maintain current Power State. Default\n"
expr|\
literal|"\t1 - Suspend Page Scan.\n"
expr|\
literal|"\t2 - Suspend Inquiry Scan.\n"
expr|\
literal|"\t4 - Suspend Periodic Inquiries."
block|,
operator|&
name|hci_write_hold_mode_activity
block|}
block|,
block|{
literal|"read_sco_flow_control_enable"
block|,
literal|"\nThe Read_SCO_Flow_Control_Enable command provides the ability to read\n"
expr|\
literal|"the SCO_Flow_Control_Enable setting. By using this setting, the Host can\n"
expr|\
literal|"decide if the Host Controller will send Number Of Completed Packets events\n"
expr|\
literal|"for SCO Connection Handles. This setting allows the Host to enable and\n"
expr|\
literal|"disable SCO flow control."
block|,
operator|&
name|hci_read_sco_flow_control_enable
block|}
block|,
block|{
literal|"write_sco_flow_control_enable enable(0|1)"
block|,
literal|"\nThe Write_SCO_Flow_Control_Enable command provides the ability to write\n"
expr|\
literal|"the SCO_Flow_Control_Enable setting. By using this setting, the Host can\n"
expr|\
literal|"decide if the Host Controller will send Number Of Completed Packets events\n"
expr|\
literal|"for SCO Connection Handles. This setting allows the Host to enable and\n"
expr|\
literal|"disable SCO flow control. The SCO_Flow_Control_Enable setting can only be\n"
expr|\
literal|"changed if no connections exist."
block|,
operator|&
name|hci_write_sco_flow_control_enable
block|}
block|,
block|{
literal|"read_link_supervision_timeout<connection_handle>"
block|,
literal|"\nThis command will read the value for the Link_Supervision_Timeout\n"
expr|\
literal|"parameter for the device. The Link_Supervision_Timeout parameter is used\n"
expr|\
literal|"by the master or slave Bluetooth device to monitor link loss. If, for any\n"
expr|\
literal|"reason, no Baseband packets are received from that Connection Handle for a\n"
expr|\
literal|"duration longer than the Link_Supervision_Timeout, the connection is\n"
literal|"disconnected.\n\n"
expr|\
literal|"\t<connection_handle> - dddd; connection handle\n"
block|,
operator|&
name|hci_read_link_supervision_timeout
block|}
block|,
block|{
literal|"write_link_supervision_timeout<connection_handle><timeout>"
block|,
literal|"\nThis command will write the value for the Link_Supervision_Timeout\n"
expr|\
literal|"parameter for the device. The Link_Supervision_Timeout parameter is used\n"
expr|\
literal|"by the master or slave Bluetooth device to monitor link loss. If, for any\n"
expr|\
literal|"reason, no Baseband packets are received from that connection handle for a\n"
expr|\
literal|"duration longer than the Link_Supervision_Timeout, the connection is\n"
expr|\
literal|"disconnected.\n\n"
expr|\
literal|"\t<connection_handle> - dddd; connection handle\n"
expr|\
literal|"\t<timeout>           - dddd; timeout measured in number of baseband slots\n"
block|,
operator|&
name|hci_write_link_supervision_timeout
block|}
block|,
block|{
literal|"read_page_scan_period_mode"
block|,
literal|"\nThis command is used to read the mandatory Page_Scan_Period_Mode of the\n"
expr|\
literal|"local Bluetooth device. Every time an inquiry response message is sent, the\n"
expr|\
literal|"Bluetooth device will start a timer (T_mandatory_pscan), the value of which\n"
expr|\
literal|"is dependent on the Page_Scan_Period_Mode. As long as this timer has not\n"
expr|\
literal|"expired, the Bluetooth device will use the Page_Scan_Period_Mode for all\n"
expr|\
literal|"following page scans."
block|,
operator|&
name|hci_read_page_scan_period_mode
block|}
block|,
block|{
literal|"write_page_scan_period_mode<page_scan_period_mode>"
block|,
literal|"\nThis command is used to write the mandatory Page_Scan_Period_Mode of the\n"
expr|\
literal|"local Bluetooth device. Every time an inquiry response message is sent, the\n"
expr|\
literal|"Bluetooth device will start a timer (T_mandatory_pscan), the value of which\n"
expr|\
literal|"is dependent on the Page_Scan_Period_Mode. As long as this timer has not\n"
expr|\
literal|"expired, the Bluetooth device will use the Page_Scan_Period_Mode for all\n"
expr|\
literal|"following page scans.\n\n"
expr|\
literal|"\t<page_scan_period_mode> - dd; page scan period mode:\n"
expr|\
literal|"\t0x00 - P0 (Default)\n"
expr|\
literal|"\t0x01 - P1\n"
expr|\
literal|"\t0x02 - P2"
block|,
operator|&
name|hci_write_page_scan_period_mode
block|}
block|,
block|{
literal|"read_page_scan_mode"
block|,
literal|"\nThis command is used to read the default page scan mode of the local\n"
expr|\
literal|"Bluetooth device. The Page_Scan_Mode parameter indicates the page scan mode\n"
expr|\
literal|"that is used for the default page scan. Currently one mandatory page scan\n"
expr|\
literal|"mode and three optional page scan modes are defined. Following an inquiry\n"
expr|\
literal|"response, if the Baseband timer T_mandatory_pscan has not expired, the\n"
expr|\
literal|"mandatory page scan mode must be applied."
block|,
operator|&
name|hci_read_page_scan_mode
block|}
block|,
block|{
literal|"write_page_scan_mode<page_scan_mode>"
block|,
literal|"\nThis command is used to write the default page scan mode of the local\n"
expr|\
literal|"Bluetooth device. The Page_Scan_Mode parameter indicates the page scan mode\n"
expr|\
literal|"that is used for the default page scan. Currently, one mandatory page scan\n"
expr|\
literal|"mode and three optional page scan modes are defined. Following an inquiry\n"
expr|\
literal|"response, if the Baseband timer T_mandatory_pscan has not expired, the\n"
expr|\
literal|"mandatory page scan mode must be applied.\n\n"
expr|\
literal|"\t<page_scan_mode> - dd; page scan mode:\n"
expr|\
literal|"\t0x00 - Mandatory Page Scan Mode (Default)\n"
expr|\
literal|"\t0x01 - Optional Page Scan Mode I\n"
expr|\
literal|"\t0x02 - Optional Page Scan Mode II\n"
expr|\
literal|"\t0x03 - Optional Page Scan Mode III"
block|,
operator|&
name|hci_write_page_scan_mode
block|}
block|,
block|{
name|NULL
block|, }
block|}
decl_stmt|;
end_decl_stmt

end_unit

