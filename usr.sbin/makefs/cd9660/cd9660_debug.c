begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD: cd9660_debug.c,v 1.11 2010/10/27 18:51:35 christos Exp $	*/
end_comment

begin_comment
comment|/*  * Copyright (c) 2005 Daniel Watt, Walter Deignan, Ryan Gabrys, Alan  * Perez-Rathke and Ram Vedam.  All rights reserved.  *  * This code was written by Daniel Watt, Walter Deignan, Ryan Gabrys,  * Alan Perez-Rathke and Ram Vedam.  *  * Redistribution and use in source and binary forms, with or  * without modification, are permitted provided that the following  * conditions are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above  *    copyright notice, this list of conditions and the following  *    disclaimer in the documentation and/or other materials provided  *    with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY DANIEL WATT, WALTER DEIGNAN, RYAN  * GABRYS, ALAN PEREZ-RATHKE AND RAM VEDAM ``AS IS'' AND ANY EXPRESS OR  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  * DISCLAIMED.  IN NO EVENT SHALL DANIEL WATT, WALTER DEIGNAN, RYAN  * GABRYS, ALAN PEREZ-RATHKE AND RAM VEDAM BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF  * USE,DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY  * OF SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/mount.h>
end_include

begin_include
include|#
directive|include
file|"makefs.h"
end_include

begin_include
include|#
directive|include
file|"cd9660.h"
end_include

begin_include
include|#
directive|include
file|"iso9660_rrip.h"
end_include

begin_function_decl
specifier|static
name|void
name|debug_print_susp_attrs
parameter_list|(
name|cd9660node
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|debug_dump_to_xml_padded_hex_output
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
specifier|inline
name|void
name|print_n_tabs
parameter_list|(
name|int
name|n
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|n
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|void debug_print_rrip_info(n) cd9660node *n; { 	struct ISO_SUSP_ATTRIBUTES *t; 	TAILQ_FOREACH(t,&node->head, rr_ll) {  	} }
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|debug_print_susp_attrs
parameter_list|(
name|cd9660node
modifier|*
name|n
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|struct
name|ISO_SUSP_ATTRIBUTES
modifier|*
name|t
decl_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|t
argument_list|,
argument|&n->head
argument_list|,
argument|rr_ll
argument_list|)
block|{
name|print_n_tabs
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c%c: L:%i"
argument_list|,
name|t
operator|->
name|attr
operator|.
name|su_entry
operator|.
name|SP
operator|.
name|h
operator|.
name|type
index|[
literal|0
index|]
argument_list|,
name|t
operator|->
name|attr
operator|.
name|su_entry
operator|.
name|SP
operator|.
name|h
operator|.
name|type
index|[
literal|1
index|]
argument_list|,
operator|(
name|int
operator|)
name|t
operator|->
name|attr
operator|.
name|su_entry
operator|.
name|SP
operator|.
name|h
operator|.
name|length
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|debug_print_tree
parameter_list|(
name|cd9660node
modifier|*
name|node
parameter_list|,
name|int
name|level
parameter_list|)
block|{
if|#
directive|if
operator|!
name|HAVE_NBTOOL_CONFIG_H
name|cd9660node
modifier|*
name|cn
decl_stmt|;
name|print_n_tabs
argument_list|(
name|level
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|type
operator|&
name|CD9660_TYPE_DOT
condition|)
block|{
name|printf
argument_list|(
literal|". (%i)\n"
argument_list|,
name|isonum_733
argument_list|(
name|node
operator|->
name|isoDirRecord
operator|->
name|extent
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|node
operator|->
name|type
operator|&
name|CD9660_TYPE_DOTDOT
condition|)
block|{
name|printf
argument_list|(
literal|"..(%i)\n"
argument_list|,
name|isonum_733
argument_list|(
name|node
operator|->
name|isoDirRecord
operator|->
name|extent
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|node
operator|->
name|isoDirRecord
operator|->
name|name
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
block|{
name|printf
argument_list|(
literal|"(ROOT) (%"
name|PRIu32
literal|" to %"
name|PRId64
literal|")\n"
argument_list|,
name|node
operator|->
name|fileDataSector
argument_list|,
name|node
operator|->
name|fileDataSector
operator|+
name|node
operator|->
name|fileSectorsUsed
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"%s (%s) (%"
name|PRIu32
literal|" to %"
name|PRId64
literal|")\n"
argument_list|,
name|node
operator|->
name|isoDirRecord
operator|->
name|name
argument_list|,
operator|(
name|node
operator|->
name|isoDirRecord
operator|->
name|flags
index|[
literal|0
index|]
operator|&
name|ISO_FLAG_DIRECTORY
operator|)
condition|?
literal|"DIR"
else|:
literal|"FILE"
argument_list|,
name|node
operator|->
name|fileDataSector
argument_list|,
operator|(
name|node
operator|->
name|fileSectorsUsed
operator|==
literal|0
operator|)
condition|?
name|node
operator|->
name|fileDataSector
else|:
name|node
operator|->
name|fileDataSector
operator|+
name|node
operator|->
name|fileSectorsUsed
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|diskStructure
operator|.
name|rock_ridge_enabled
condition|)
name|debug_print_susp_attrs
argument_list|(
name|node
argument_list|,
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|cn
argument_list|,
argument|&node->cn_children
argument_list|,
argument|cn_next_child
argument_list|)
name|debug_print_tree
argument_list|(
name|cn
argument_list|,
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
else|#
directive|else
name|printf
argument_list|(
literal|"Sorry, debugging is not supported in host-tools mode.\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
name|void
name|debug_print_path_tree
parameter_list|(
name|cd9660node
modifier|*
name|n
parameter_list|)
block|{
name|cd9660node
modifier|*
name|iterator
init|=
name|n
decl_stmt|;
comment|/* Only display this message when called with the root node */
if|if
condition|(
name|n
operator|->
name|parent
operator|==
name|NULL
condition|)
name|printf
argument_list|(
literal|"debug_print_path_table: Dumping path table contents\n"
argument_list|)
expr_stmt|;
while|while
condition|(
name|iterator
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|iterator
operator|->
name|isoDirRecord
operator|->
name|name
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|printf
argument_list|(
literal|"0) (ROOT)\n"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%i) %s\n"
argument_list|,
name|iterator
operator|->
name|level
argument_list|,
name|iterator
operator|->
name|isoDirRecord
operator|->
name|name
argument_list|)
expr_stmt|;
name|iterator
operator|=
name|iterator
operator|->
name|ptnext
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|debug_print_volume_descriptor_information
parameter_list|(
name|void
parameter_list|)
block|{
name|volume_descriptor
modifier|*
name|tmp
init|=
name|diskStructure
operator|.
name|firstVolumeDescriptor
decl_stmt|;
name|char
name|temp
index|[
name|CD9660_SECTOR_SIZE
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"==Listing Volume Descriptors==\n"
argument_list|)
expr_stmt|;
while|while
condition|(
name|tmp
operator|!=
name|NULL
condition|)
block|{
name|memset
argument_list|(
name|temp
argument_list|,
literal|0
argument_list|,
name|CD9660_SECTOR_SIZE
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|temp
argument_list|,
name|tmp
operator|->
name|volumeDescriptorData
operator|+
literal|1
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Volume descriptor in sector %"
name|PRId64
literal|": type %i, ID %s\n"
argument_list|,
name|tmp
operator|->
name|sector
argument_list|,
name|tmp
operator|->
name|volumeDescriptorData
index|[
literal|0
index|]
argument_list|,
name|temp
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tmp
operator|->
name|volumeDescriptorData
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|0
case|:
comment|/*boot record*/
break|break;
case|case
literal|1
case|:
comment|/* PVD */
break|break;
case|case
literal|2
case|:
comment|/* SVD */
break|break;
case|case
literal|3
case|:
comment|/* Volume Partition Descriptor */
break|break;
case|case
literal|255
case|:
comment|/* terminator */
break|break;
block|}
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"==Done Listing Volume Descriptors==\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|debug_dump_to_xml_ptentry
parameter_list|(
name|path_table_entry
modifier|*
name|pttemp
parameter_list|,
name|int
name|num
parameter_list|,
name|int
name|mode
parameter_list|)
block|{
name|printf
argument_list|(
literal|"<ptentry num=\"%i\">\n"
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<length>%i</length>\n"
argument_list|,
name|pttemp
operator|->
name|length
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<extended_attribute_length>%i</extended_attribute_length>\n"
argument_list|,
name|pttemp
operator|->
name|extended_attribute_length
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<parent_number>%i</parent_number>\n"
argument_list|,
name|debug_get_encoded_number
argument_list|(
name|pttemp
operator|->
name|parent_number
argument_list|,
name|mode
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"name"
argument_list|,
name|pttemp
operator|->
name|name
argument_list|,
name|pttemp
operator|->
name|length
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"</ptentry>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|debug_dump_to_xml_path_table
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
name|off_t
name|sector
parameter_list|,
name|int
name|size
parameter_list|,
name|int
name|mode
parameter_list|)
block|{
name|path_table_entry
name|pttemp
decl_stmt|;
name|int
name|t
init|=
literal|0
decl_stmt|;
name|int
name|n
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|fseeko
argument_list|(
name|fd
argument_list|,
name|CD9660_SECTOR_SIZE
operator|*
name|sector
argument_list|,
name|SEEK_SET
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"fseeko"
argument_list|)
expr_stmt|;
while|while
condition|(
name|t
operator|<
name|size
condition|)
block|{
comment|/* Read fixed data first */
name|fread
argument_list|(
operator|&
name|pttemp
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|t
operator|+=
literal|8
expr_stmt|;
comment|/* Read variable */
name|fread
argument_list|(
operator|(
operator|(
name|unsigned
name|char
operator|*
operator|)
operator|&
name|pttemp
operator|)
operator|+
literal|8
argument_list|,
literal|1
argument_list|,
name|pttemp
operator|.
name|length
index|[
literal|0
index|]
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|t
operator|+=
name|pttemp
operator|.
name|length
index|[
literal|0
index|]
expr_stmt|;
name|debug_dump_to_xml_ptentry
argument_list|(
operator|&
name|pttemp
argument_list|,
name|n
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * XML Debug output functions  * Dump hierarchy of CD, as well as volume info, to XML  * Can be used later to diff against a standard,  * or just provide easy to read detailed debug output  */
end_comment

begin_function
name|void
name|debug_dump_to_xml
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|)
block|{
name|unsigned
name|char
name|buf
index|[
name|CD9660_SECTOR_SIZE
index|]
decl_stmt|;
name|off_t
name|sector
decl_stmt|;
name|int
name|t
decl_stmt|,
name|t2
decl_stmt|;
name|struct
name|iso_primary_descriptor
name|primaryVD
decl_stmt|;
name|struct
name|_boot_volume_descriptor
name|bootVD
decl_stmt|;
name|printf
argument_list|(
literal|"<cd9660dump>\n"
argument_list|)
expr_stmt|;
comment|/* Display Volume Descriptors */
name|sector
operator|=
literal|16
expr_stmt|;
do|do
block|{
if|if
condition|(
name|fseeko
argument_list|(
name|fd
argument_list|,
name|CD9660_SECTOR_SIZE
operator|*
name|sector
argument_list|,
name|SEEK_SET
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"fseeko"
argument_list|)
expr_stmt|;
name|fread
argument_list|(
name|buf
argument_list|,
literal|1
argument_list|,
name|CD9660_SECTOR_SIZE
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|t
operator|=
call|(
name|int
call|)
argument_list|(
operator|(
name|unsigned
name|char
operator|)
name|buf
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|t
condition|)
block|{
case|case
literal|0
case|:
name|memcpy
argument_list|(
operator|&
name|bootVD
argument_list|,
name|buf
argument_list|,
name|CD9660_SECTOR_SIZE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|memcpy
argument_list|(
operator|&
name|primaryVD
argument_list|,
name|buf
argument_list|,
name|CD9660_SECTOR_SIZE
argument_list|)
expr_stmt|;
break|break;
block|}
name|debug_dump_to_xml_volume_descriptor
argument_list|(
name|buf
argument_list|,
name|sector
argument_list|)
expr_stmt|;
name|sector
operator|++
expr_stmt|;
block|}
do|while
condition|(
name|t
operator|!=
literal|255
condition|)
do|;
name|t
operator|=
name|debug_get_encoded_number
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|primaryVD
operator|.
name|type_l_path_table
argument_list|,
literal|731
argument_list|)
expr_stmt|;
name|t2
operator|=
name|debug_get_encoded_number
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|primaryVD
operator|.
name|path_table_size
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Path table 1 located at sector %i and is %i bytes long\n"
argument_list|,
name|t
argument_list|,
name|t2
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_path_table
argument_list|(
name|fd
argument_list|,
name|t
argument_list|,
name|t2
argument_list|,
literal|721
argument_list|)
expr_stmt|;
name|t
operator|=
name|debug_get_encoded_number
argument_list|(
operator|(
name|u_char
operator|*
operator|)
name|primaryVD
operator|.
name|type_m_path_table
argument_list|,
literal|731
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_path_table
argument_list|(
name|fd
argument_list|,
name|t
argument_list|,
name|t2
argument_list|,
literal|722
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"</cd9660dump>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|debug_dump_to_xml_padded_hex_output
parameter_list|(
specifier|const
name|char
modifier|*
name|element
parameter_list|,
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|t
decl_stmt|;
name|printf
argument_list|(
literal|"<%s>"
argument_list|,
name|element
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|t
operator|=
operator|(
name|unsigned
name|char
operator|)
name|buf
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|t
operator|>=
literal|32
operator|&&
name|t
operator|<
literal|127
condition|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"</%s>\n"
argument_list|,
name|element
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<%s:hex>"
argument_list|,
name|element
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|t
operator|=
operator|(
name|unsigned
name|char
operator|)
name|buf
index|[
name|i
index|]
expr_stmt|;
name|printf
argument_list|(
literal|" %x"
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"</%s:hex>\n"
argument_list|,
name|element
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|debug_get_encoded_number
parameter_list|(
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|mode
parameter_list|)
block|{
if|#
directive|if
operator|!
name|HAVE_NBTOOL_CONFIG_H
switch|switch
condition|(
name|mode
condition|)
block|{
comment|/* 711: Single bite */
case|case
literal|711
case|:
return|return
name|isonum_711
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 712: Single signed byte */
case|case
literal|712
case|:
return|return
name|isonum_712
argument_list|(
operator|(
name|signed
name|char
operator|*
operator|)
name|buf
argument_list|)
return|;
comment|/* 721: 16 bit LE */
case|case
literal|721
case|:
return|return
name|isonum_721
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 731: 32 bit LE */
case|case
literal|731
case|:
return|return
name|isonum_731
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 722: 16 bit BE */
case|case
literal|722
case|:
return|return
name|isonum_722
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 732: 32 bit BE */
case|case
literal|732
case|:
return|return
name|isonum_732
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 723: 16 bit bothE */
case|case
literal|723
case|:
return|return
name|isonum_723
argument_list|(
name|buf
argument_list|)
return|;
comment|/* 733: 32 bit bothE */
case|case
literal|733
case|:
return|return
name|isonum_733
argument_list|(
name|buf
argument_list|)
return|;
block|}
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|debug_dump_integer
parameter_list|(
specifier|const
name|char
modifier|*
name|element
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|mode
parameter_list|)
block|{
name|printf
argument_list|(
literal|"<%s>%i</%s>\n"
argument_list|,
name|element
argument_list|,
name|debug_get_encoded_number
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
argument_list|,
name|mode
argument_list|)
argument_list|,
name|element
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|debug_dump_string
parameter_list|(
specifier|const
name|char
modifier|*
name|element
name|__unused
parameter_list|,
name|unsigned
name|char
modifier|*
name|buf
name|__unused
parameter_list|,
name|int
name|len
name|__unused
parameter_list|)
block|{  }
end_function

begin_function
name|void
name|debug_dump_directory_record_9_1
parameter_list|(
name|unsigned
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|printf
argument_list|(
literal|"<directoryrecord>\n"
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"length"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|length
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"ext_attr_length"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|ext_attr_length
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"extent"
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|extent
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"size"
argument_list|,
operator|(
name|char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|size
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"flags"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|flags
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"file_unit_size"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|file_unit_size
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"interleave"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|interleave
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"volume_sequence_number"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_sequence_number
argument_list|,
literal|723
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"name_len"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|name_len
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"name"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|name
argument_list|,
name|debug_get_encoded_number
argument_list|(
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_directory_record
operator|*
operator|)
name|buf
operator|)
operator|->
name|length
argument_list|,
literal|711
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"</directoryrecord>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|debug_dump_to_xml_volume_descriptor
parameter_list|(
name|unsigned
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|sector
parameter_list|)
block|{
name|printf
argument_list|(
literal|"<volumedescriptor sector=\"%i\">\n"
argument_list|,
name|sector
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<vdtype>"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|buf
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"boot"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"primary"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"supplementary"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"volume partition descriptor"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|255
case|:
name|printf
argument_list|(
literal|"terminator"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"</vdtype>\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|buf
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|1
case|:
name|debug_dump_integer
argument_list|(
literal|"type"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|type
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|id
argument_list|,
name|ISODCL
argument_list|(
literal|2
argument_list|,
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"version"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|version
argument_list|,
literal|711
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"system_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|system_id
argument_list|,
name|ISODCL
argument_list|(
literal|9
argument_list|,
literal|40
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"volume_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_id
argument_list|,
name|ISODCL
argument_list|(
literal|41
argument_list|,
literal|72
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"volume_space_size"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_space_size
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"volume_set_size"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_set_size
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"volume_sequence_number"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_sequence_number
argument_list|,
literal|723
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"logical_block_size"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|logical_block_size
argument_list|,
literal|723
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"path_table_size"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|path_table_size
argument_list|,
literal|733
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"type_l_path_table"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|type_l_path_table
argument_list|,
literal|731
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"opt_type_l_path_table"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|opt_type_l_path_table
argument_list|,
literal|731
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"type_m_path_table"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|type_m_path_table
argument_list|,
literal|732
argument_list|)
expr_stmt|;
name|debug_dump_integer
argument_list|(
literal|"opt_type_m_path_table"
argument_list|,
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|opt_type_m_path_table
argument_list|,
literal|732
argument_list|)
expr_stmt|;
name|debug_dump_directory_record_9_1
argument_list|(
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|root_directory_record
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"volume_set_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|volume_set_id
argument_list|,
name|ISODCL
argument_list|(
literal|191
argument_list|,
literal|318
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"publisher_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|publisher_id
argument_list|,
name|ISODCL
argument_list|(
literal|319
argument_list|,
literal|446
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"preparer_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|preparer_id
argument_list|,
name|ISODCL
argument_list|(
literal|447
argument_list|,
literal|574
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"application_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|application_id
argument_list|,
name|ISODCL
argument_list|(
literal|575
argument_list|,
literal|702
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"copyright_file_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|copyright_file_id
argument_list|,
name|ISODCL
argument_list|(
literal|703
argument_list|,
literal|739
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"abstract_file_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|abstract_file_id
argument_list|,
name|ISODCL
argument_list|(
literal|740
argument_list|,
literal|776
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"bibliographic_file_id"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|bibliographic_file_id
argument_list|,
name|ISODCL
argument_list|(
literal|777
argument_list|,
literal|813
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"creation_date"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|creation_date
argument_list|,
name|ISODCL
argument_list|(
literal|814
argument_list|,
literal|830
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"modification_date"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|modification_date
argument_list|,
name|ISODCL
argument_list|(
literal|831
argument_list|,
literal|847
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"expiration_date"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|expiration_date
argument_list|,
name|ISODCL
argument_list|(
literal|848
argument_list|,
literal|864
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"effective_date"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|effective_date
argument_list|,
name|ISODCL
argument_list|(
literal|865
argument_list|,
literal|881
argument_list|)
argument_list|)
expr_stmt|;
name|debug_dump_to_xml_padded_hex_output
argument_list|(
literal|"file_structure_version"
argument_list|,
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
expr|struct
name|iso_primary_descriptor
operator|*
operator|)
name|buf
operator|)
operator|->
name|file_structure_version
argument_list|,
name|ISODCL
argument_list|(
literal|882
argument_list|,
literal|882
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"</volumedescriptor>\n"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

