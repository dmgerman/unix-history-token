begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2010 The FreeBSD Foundation  * All rights reserved.  *  * This software was developed by Shteryana Sotirova Shopova under  * sponsorship from the FreeBSD Foundation.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_mib.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/snmpmod.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/snmp_mibII.h>
end_include

begin_include
include|#
directive|include
file|"wlan_tree.h"
end_include

begin_include
include|#
directive|include
file|"wlan_snmp.h"
end_include

begin_include
include|#
directive|include
file|"wlan_oid.h"
end_include

begin_decl_stmt
specifier|static
name|struct
name|lmodule
modifier|*
name|wlan_module
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* For the registration. */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|asn_oid
name|oid_wlan
init|=
name|OIDX_begemotWlan
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* The registration. */
end_comment

begin_decl_stmt
specifier|static
name|uint
name|reg_wlan
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Periodic timer for polling the module's data. */
end_comment

begin_decl_stmt
specifier|static
name|void
modifier|*
name|wlan_data_timer
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Poll data from kernel every 15 minutes unless explicitly requested by an  * SNMP client.  * XXX: make that configurable.  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|wlan_poll_ticks
init|=
operator|(
literal|15
operator|*
literal|60
operator|)
operator|*
literal|100
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* The age of each table. */
end_comment

begin_define
define|#
directive|define
name|WLAN_LIST_MAXAGE
value|5
end_define

begin_decl_stmt
specifier|static
name|time_t
name|wlan_iflist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_peerlist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_chanlist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_roamlist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_tx_paramlist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_scanlist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_maclist_age
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|wlan_mrlist_age
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * The list of all virtual wireless interfaces - sorted by name.  */
end_comment

begin_expr_stmt
name|SLIST_HEAD
argument_list|(
name|wlan_ifaces
argument_list|,
name|wlan_iface
argument_list|)
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|static
name|struct
name|wlan_ifaces
name|wlan_ifaces
init|=
name|SLIST_HEAD_INITIALIZER
argument_list|(
name|wlan_ifaces
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|struct
name|wlan_config
name|wlan_config
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Forward declarations */
end_comment

begin_function_decl
specifier|static
name|int
name|bits_get
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
specifier|const
name|u_char
modifier|*
parameter_list|,
name|ssize_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_add_wif
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_delete_wif
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_attach_newif
parameter_list|(
name|struct
name|mibif
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_iface_create
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_iface_destroy
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_new_wif
parameter_list|(
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_free_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_free_iflist
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_free_peerlist
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_scan_free_results
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_mac_free_maclist
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_mesh_free_routes
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_update_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_update_interface_list
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_update_peers
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_update_channels
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_update_roam_params
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_update_tx_params
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_scan_update_results
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_mac_update_aclmacs
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_mesh_update_routes
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_find_interface
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_find_peer
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_find_channel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_scan_find_result
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_mac_find_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_find_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_first_interface
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_next_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_first_interface
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_next_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_snmp_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_get_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_get_channel
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_roamparam
modifier|*
name|wlan_get_roam_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_txparam
modifier|*
name|wlan_get_tx_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_get_scanr
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_get_acl_mac
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_get_iface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_mesh_get_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_get_route
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_next_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_next_snmp_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_get_next_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_get_next_channel
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_roamparam
modifier|*
name|wlan_get_next_roam_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|ieee80211_txparam
modifier|*
name|wlan_get_next_tx_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_get_next_scanr
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_get_next_acl_mac
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_get_next_iface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_mesh_get_next_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_get_next_route
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint8_t
modifier|*
name|wlan_get_ifname
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_mac_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_channel_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_phy_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint32_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_scanr_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint8_t
modifier|*
name|ssid
parameter_list|,
name|uint8_t
modifier|*
name|bssid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_append_ifindex
parameter_list|(
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
specifier|const
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_append_mac_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_append_channel_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
specifier|const
name|struct
name|wlan_iface
modifier|*
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_append_phy_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_append_scanr_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
parameter_list|,
name|uint
parameter_list|,
name|char
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_acl_mac_set_status
parameter_list|(
name|struct
name|snmp_context
modifier|*
parameter_list|,
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_mesh_route_set_status
parameter_list|(
name|struct
name|snmp_context
modifier|*
parameter_list|,
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|uint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int32_t
name|wlan_get_channel_type
parameter_list|(
name|struct
name|ieee80211_channel
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_scan_compare_result
parameter_list|(
name|struct
name|wlan_scan_result
modifier|*
parameter_list|,
name|struct
name|wlan_scan_result
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_mac_delete_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|struct
name|wlan_mac_mac
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_mesh_delete_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|struct
name|wlan_mesh_route
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * The module's GET/SET data hooks per each table or group of objects as  * required by bsnmpd(1).  */
end_comment

begin_function
name|int
name|op_wlan_iface
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int
name|rc
decl_stmt|;
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_snmp_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_snmp_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_snmp_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanIfaceName
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|wlan_get_ifname
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_new_wif
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|wif
operator|->
name|internal
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
operator|&&
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanIfaceStatus
operator|&&
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanIfaceState
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceIndex
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|LEAF_wlanIfaceName
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
if|if
condition|(
operator|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|IFNAMSIZ
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|strlcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
argument_list|)
expr_stmt|;
name|wif
operator|->
name|wname
index|[
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanParentIfName
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
if|if
condition|(
operator|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|IFNAMSIZ
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|strlcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|wif
operator|->
name|pname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|pname
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
argument_list|)
expr_stmt|;
name|wif
operator|->
name|pname
index|[
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceOperatingMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mode
expr_stmt|;
name|wif
operator|->
name|mode
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceFlags
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|>
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|memcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|flags
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|flags
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceBssid
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|memcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|wif
operator|->
name|dbssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|dbssid
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceLocalAddress
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|memcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|wif
operator|->
name|dlmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|dlmac
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceStatus
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|status
expr_stmt|;
name|wif
operator|->
name|status
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
block|{
name|rc
operator|=
name|wlan_iface_create
argument_list|(
name|wif
argument_list|)
expr_stmt|;
comment|/* XXX */
if|if
condition|(
name|rc
operator|!=
name|SNMP_ERR_NOERROR
condition|)
block|{
name|wif
operator|->
name|status
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_destroy
condition|)
return|return
operator|(
name|wlan_iface_destroy
argument_list|(
name|wif
argument_list|)
operator|)
return|;
else|else
name|wif
operator|->
name|status
operator|=
name|RowStatus_notReady
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceState
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|state
expr_stmt|;
name|wif
operator|->
name|state
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
if|if
condition|(
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
name|abort
argument_list|()
expr_stmt|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_snmp_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceName
case|:
name|strlcpy
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanParentIfName
case|:
name|strlcpy
argument_list|(
name|wif
operator|->
name|pname
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceOperatingMode
case|:
name|wif
operator|->
name|mode
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFlags
case|:
name|memcpy
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|flags
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBssid
case|:
name|memcpy
argument_list|(
name|wif
operator|->
name|dbssid
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceLocalAddress
case|:
name|memcpy
argument_list|(
name|wif
operator|->
name|dlmac
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceStatus
case|:
name|wif
operator|->
name|status
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|==
name|RowStatus_active
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
comment|/* XXX: FIXME */
elseif|else
if|if
condition|(
name|wif
operator|->
name|internal
operator|!=
literal|0
condition|)
return|return
operator|(
name|wlan_iface_destroy
argument_list|(
name|wif
argument_list|)
operator|)
return|;
break|break;
case|case
name|LEAF_wlanIfaceState
case|:
name|wif
operator|->
name|state
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
if|if
condition|(
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceName
case|:
case|case
name|LEAF_wlanParentIfName
case|:
case|case
name|LEAF_wlanIfaceFlags
case|:
case|case
name|LEAF_wlanIfaceBssid
case|:
case|case
name|LEAF_wlanIfaceLocalAddress
case|:
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
comment|/* FALLTHROUGH */
default|default:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceIndex
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|index
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceName
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
operator|-
literal|1
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanParentIfName
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|pname
argument_list|,
operator|-
literal|1
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceOperatingMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mode
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceFlags
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|flags
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|flags
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceBssid
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|dbssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceLocalAddress
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|dlmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceStatus
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|status
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|LEAF_wlanIfaceState
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|state
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|int
name|op_wlan_if_parent
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfParentDriverCapabilities
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|drivercaps
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|drivercaps
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfParentCryptoCapabilities
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|cryptocaps
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|cryptocaps
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfParentHTCapabilities
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wif
operator|->
name|htcaps
argument_list|,
sizeof|sizeof
argument_list|(
name|wif
operator|->
name|htcaps
argument_list|)
argument_list|)
operator|)
return|;
block|}
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|int
name|op_wlan_iface_config
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int
name|intval
decl_stmt|,
name|vlen
decl_stmt|,
name|rc
decl_stmt|;
name|char
modifier|*
name|strval
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
goto|goto
name|get_config
goto|;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
goto|goto
name|get_config
goto|;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|intval
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
name|strval
operator|=
name|NULL
expr_stmt|;
name|vlen
operator|=
literal|0
expr_stmt|;
comment|/* Simple sanity checks& save old data. */
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|!=
name|WLAN_COUNTRY_CODE_SIZE
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|>
name|IEEE80211_NWID_LEN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|LEAF_wlanIfacePacketBurst
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|packet_burst
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRegDomain
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|reg_domain
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredChannel
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|desired_channel
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicFreqSelection
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dyn_frequency
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFastFrames
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|fast_frames
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDturbo
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dturbo
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTxPower
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|tx_power
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFragmentThreshold
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|frag_threshold
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRTSThreshold
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|rts_threshold
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceWlanPrivacySubscribe
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|priv_subscribe
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScan
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|bg_scan
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanIdle
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|bg_scan_idle
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanInterval
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|bg_scan_interval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconMissedThreshold
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|beacons_missed
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRoamingMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|roam_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11d
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dot11d
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11h
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dot11h
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicWds
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dynamic_wds
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePowerSave
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|power_save
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceApBridge
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ap_bridge
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconInterval
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|beacon_interval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDtimPeriod
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dtim_period
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceHideSsid
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|hide_ssid
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceInactivityProccess
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|inact_process
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gProtMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|do11g_protect
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gPureMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dot11g_pure
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nPureMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|dot11n_pure
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpdu
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ampdu
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduDensity
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ampdu_density
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduLimit
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ampdu_limit
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsdu
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|amsdu
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsduLimit
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|amsdu_limit
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHighThroughput
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ht_enabled
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTCompatible
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ht_compatible
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTProtMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|ht_prot_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nRIFS
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|rifs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nShortGI
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|short_gi
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nSMPSMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|smps_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlot
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|tdma_slot
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotCount
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|tdma_slot_count
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotLength
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|tdma_slot_length
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaBeaconInterval
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|tdma_binterval
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|val
operator|->
name|syntax
operator|!=
name|SNMP_SYNTAX_OCTETSTRING
condition|)
goto|goto
name|set_config
goto|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
expr_stmt|;
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
comment|/* XXX */
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanIfaceDesiredSsid
condition|)
name|strlcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
else|else
name|memcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
argument_list|)
expr_stmt|;
name|strval
operator|=
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
expr_stmt|;
name|vlen
operator|=
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
expr_stmt|;
goto|goto
name|set_config
goto|;
case|case
name|SNMP_OP_ROLLBACK
case|:
name|intval
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
name|strval
operator|=
name|NULL
expr_stmt|;
name|vlen
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
name|strval
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
expr_stmt|;
name|vlen
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
default|default:
break|break;
block|}
goto|goto
name|set_config
goto|;
case|case
name|SNMP_OP_COMMIT
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
comment|/* FALLTHROUGH */
default|default:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
block|}
name|abort
argument_list|()
expr_stmt|;
name|get_config
label|:
if|if
condition|(
name|wlan_config_get_ioctl
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfacePacketBurst
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|packet_burst
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceCountryCode
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|country_code
argument_list|,
name|WLAN_COUNTRY_CODE_SIZE
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceRegDomain
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|reg_domain
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|desired_ssid
argument_list|,
operator|-
literal|1
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredChannel
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|desired_channel
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicFreqSelection
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dyn_frequency
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFastFrames
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|fast_frames
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDturbo
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dturbo
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTxPower
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|tx_power
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFragmentThreshold
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|frag_threshold
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRTSThreshold
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|rts_threshold
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceWlanPrivacySubscribe
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|priv_subscribe
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScan
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|bg_scan
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanIdle
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|bg_scan_idle
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|bg_scan_interval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconMissedThreshold
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|beacons_missed
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|desired_bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceRoamingMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|roam_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11d
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dot11d
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11h
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dot11h
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicWds
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dynamic_wds
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePowerSave
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|power_save
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceApBridge
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ap_bridge
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|beacon_interval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDtimPeriod
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dtim_period
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceHideSsid
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|hide_ssid
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceInactivityProccess
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|inact_process
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gProtMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|do11g_protect
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gPureMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dot11g_pure
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nPureMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|dot11n_pure
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpdu
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ampdu
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduDensity
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ampdu_density
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduLimit
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ampdu_limit
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsdu
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|amsdu
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsduLimit
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|amsdu_limit
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHighThroughput
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ht_enabled
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTCompatible
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ht_compatible
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTProtMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|ht_prot_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nRIFS
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|rifs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nShortGI
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|short_gi
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nSMPSMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|smps_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlot
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|tdma_slot
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotCount
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|tdma_slot_count
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotLength
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|tdma_slot_length
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaBeaconInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|tdma_binterval
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
name|set_config
label|:
name|rc
operator|=
name|wlan_config_set_ioctl
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|,
name|intval
argument_list|,
name|strval
argument_list|,
name|vlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|op
operator|==
name|SNMP_OP_ROLLBACK
condition|)
block|{
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
comment|/* FALLTHROUGH */
default|default:
break|break;
block|}
block|}
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_if_peer
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_update_peers
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_get_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_get_next_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_mac_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|wip
operator|->
name|pmac
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_get_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanIfacePeerVlanTag
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wip
operator|->
name|vlan
expr_stmt|;
if|if
condition|(
name|wlan_peer_set_vlan
argument_list|(
name|wif
argument_list|,
name|wip
argument_list|,
name|val
operator|->
name|v
operator|.
name|integer
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_get_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanIfacePeerVlanTag
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
if|if
condition|(
name|wlan_peer_set_vlan
argument_list|(
name|wif
argument_list|,
name|wip
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|int1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfacePeerAddress
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wip
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfacePeerAssociationId
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|associd
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerVlanTag
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|vlan
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerFrequency
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|frequency
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerCurrentTXRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|txrate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerRxSignalStrength
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|rssi
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerIdleTimer
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|idle
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerTxSequenceNo
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|txseqs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerRxSequenceNo
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|rxseqs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerTxPower
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|txpower
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePeerCapabilities
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wip
operator|->
name|capinfo
argument_list|,
sizeof|sizeof
argument_list|(
name|wip
operator|->
name|capinfo
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfacePeerFlags
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wip
operator|->
name|state
argument_list|,
sizeof|sizeof
argument_list|(
name|wip
operator|->
name|state
argument_list|)
argument_list|)
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_channels
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int32_t
name|bits
decl_stmt|;
name|struct
name|ieee80211_channel
modifier|*
name|channel
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_update_channels
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|channel
operator|=
name|wlan_get_channel
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|channel
operator|=
name|wlan_get_next_channel
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|==
name|NULL
operator|||
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_channel_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|,
name|channel
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfaceChannelIeeeId
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_ieee
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelType
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_get_channel_type
argument_list|(
name|channel
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelFlags
case|:
name|bits
operator|=
name|wlan_channel_flags_to_snmp
argument_list|(
name|channel
operator|->
name|ic_flags
argument_list|)
expr_stmt|;
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|bits
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceChannelFrequency
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_freq
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelMaxRegPower
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_maxregpower
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelMaxTxPower
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_maxpower
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelMinTxPower
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_minpower
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelState
case|:
name|bits
operator|=
name|wlan_channel_state_to_snmp
argument_list|(
name|channel
operator|->
name|ic_state
argument_list|)
expr_stmt|;
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|bits
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceChannelHTExtension
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_extieee
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceChannelMaxAntennaGain
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|channel
operator|->
name|ic_maxantgain
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_roam_params
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|uint32_t
name|phy
decl_stmt|;
name|struct
name|ieee80211_roamparam
modifier|*
name|rparam
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_update_roam_params
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
name|rparam
operator|=
name|wlan_get_roam_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|rparam
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|rparam
operator|=
name|wlan_get_next_roam_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|,
operator|&
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|rparam
operator|==
name|NULL
operator|||
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_phy_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|phy
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfRoamRxSignalStrength
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|rparam
operator|->
name|rssi
operator|/
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfRoamTxRateThreshold
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|rparam
operator|->
name|rate
operator|/
literal|2
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_tx_params
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|uint32_t
name|phy
decl_stmt|;
name|struct
name|ieee80211_txparam
modifier|*
name|txparam
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_update_tx_params
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
name|txparam
operator|=
name|wlan_get_tx_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|,
operator|&
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|txparam
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
goto|goto
name|get_txparams
goto|;
case|case
name|SNMP_OP_GETNEXT
case|:
name|txparam
operator|=
name|wlan_get_next_tx_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|,
operator|&
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|txparam
operator|==
name|NULL
operator|||
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_phy_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|phy
argument_list|)
expr_stmt|;
goto|goto
name|get_txparams
goto|;
case|case
name|SNMP_OP_SET
case|:
name|txparam
operator|=
name|wlan_get_tx_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|,
operator|&
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|txparam
operator|==
name|NULL
operator|||
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfTxUnicastRate
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|txparam
operator|->
name|ucastrate
expr_stmt|;
name|txparam
operator|->
name|ucastrate
operator|=
name|val
operator|->
name|v
operator|.
name|integer
operator|*
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMcastRate
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|txparam
operator|->
name|mcastrate
expr_stmt|;
name|txparam
operator|->
name|mcastrate
operator|=
name|val
operator|->
name|v
operator|.
name|integer
operator|*
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMgmtRate
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|txparam
operator|->
name|mgmtrate
expr_stmt|;
name|txparam
operator|->
name|mgmtrate
operator|=
name|val
operator|->
name|v
operator|.
name|integer
operator|*
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMaxRetryCount
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|txparam
operator|->
name|maxretry
expr_stmt|;
name|txparam
operator|->
name|maxretry
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_set_tx_params
argument_list|(
name|wif
argument_list|,
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
name|txparam
operator|=
name|wlan_get_tx_param
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|,
operator|&
name|phy
argument_list|)
expr_stmt|;
if|if
condition|(
name|txparam
operator|==
name|NULL
operator|||
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfTxUnicastRate
case|:
name|txparam
operator|->
name|ucastrate
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMcastRate
case|:
name|txparam
operator|->
name|mcastrate
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMgmtRate
case|:
name|txparam
operator|->
name|mgmtrate
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMaxRetryCount
case|:
name|txparam
operator|->
name|maxretry
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_set_tx_params
argument_list|(
name|wif
argument_list|,
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
name|get_txparams
label|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanIfTxUnicastRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|txparam
operator|->
name|ucastrate
operator|/
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMcastRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|txparam
operator|->
name|mcastrate
operator|/
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMgmtRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|txparam
operator|->
name|mgmtrate
operator|/
literal|2
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfTxMaxRetryCount
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|txparam
operator|->
name|maxretry
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_scan_config
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|scan_status
operator|==
name|wlanScanConfigStatus_running
operator|&&
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|!=
name|LEAF_wlanScanConfigStatus
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanScanFlags
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|scan_flags
expr_stmt|;
name|wif
operator|->
name|scan_flags
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanDuration
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|scan_duration
expr_stmt|;
name|wif
operator|->
name|scan_duration
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMinChannelDwellTime
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|scan_mindwell
expr_stmt|;
name|wif
operator|->
name|scan_mindwell
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMaxChannelDwellTime
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|scan_maxdwell
expr_stmt|;
name|wif
operator|->
name|scan_maxdwell
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanConfigStatus
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|==
name|wlanScanConfigStatus_running
operator|||
name|val
operator|->
name|v
operator|.
name|integer
operator|==
name|wlanScanConfigStatus_cancel
condition|)
block|{
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|scan_status
expr_stmt|;
name|wif
operator|->
name|scan_status
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanScanConfigStatus
condition|)
if|if
condition|(
name|wif
operator|->
name|scan_status
operator|==
name|wlanScanConfigStatus_running
condition|)
operator|(
name|void
operator|)
name|wlan_set_scan_config
argument_list|(
name|wif
argument_list|)
expr_stmt|;
comment|/* XXX */
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanScanFlags
case|:
name|wif
operator|->
name|scan_flags
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanDuration
case|:
name|wif
operator|->
name|scan_duration
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMinChannelDwellTime
case|:
name|wif
operator|->
name|scan_mindwell
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMaxChannelDwellTime
case|:
name|wif
operator|->
name|scan_maxdwell
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanConfigStatus
case|:
name|wif
operator|->
name|scan_status
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanScanFlags
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|scan_flags
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanDuration
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|scan_duration
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMinChannelDwellTime
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|scan_mindwell
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanMaxChannelDwellTime
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|scan_maxdwell
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanConfigStatus
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|scan_status
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_scan_results
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_scan_update_results
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|sr
operator|=
name|wlan_get_scanr
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|sr
operator|=
name|wlan_get_next_scanr
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_scanr_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|sr
operator|->
name|ssid
argument_list|,
name|sr
operator|->
name|bssid
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanScanResultID
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|sr
operator|->
name|ssid
argument_list|,
operator|-
literal|1
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanScanResultBssid
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|sr
operator|->
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanScanResultChannel
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|sr
operator|->
name|opchannel
expr_stmt|;
comment|/* XXX */
break|break;
case|case
name|LEAF_wlanScanResultRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|sr
operator|->
name|rssi
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanResultNoise
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|sr
operator|->
name|noise
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanResultBeaconInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|sr
operator|->
name|bintval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanScanResultCapabilities
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|&
name|sr
operator|->
name|capinfo
argument_list|,
sizeof|sizeof
argument_list|(
name|sr
operator|->
name|capinfo
argument_list|)
argument_list|)
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_iface_stats
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
comment|/* XXX: LEAF_wlanStatsReset */
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_get_stats
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanStatsRxBadVersion
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badversion
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxTooShort
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_tooshort
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxWrongBssid
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_wrongbss
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardedDups
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_dup
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxWrongDir
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_wrongdir
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardMcastEcho
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_mcastecho
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardNoAssoc
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_notassoc
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxWepNoPrivacy
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_noprivacy
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxWepUnencrypted
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_unencrypted
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxWepFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_wepfail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDecapsulationFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_decap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardMgmt
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_mgtdiscard
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxControl
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_ctl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxBeacon
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_beacon
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxRateSetTooBig
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_rstoobig
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxElemMissing
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_elem_missing
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxElemTooBig
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_elem_toobig
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxElemTooSmall
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_elem_toosmall
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxElemUnknown
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_elem_unknown
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxChannelMismatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_chanmismatch
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDropped
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_nodealloc
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxSsidMismatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_ssidmismatch
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAuthNotSupported
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_auth_unsupported
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAuthFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_auth_fail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAuthCM
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_auth_countermeasures
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAssocWrongBssid
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_assoc_bss
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAssocNoAuth
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_assoc_notauth
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAssocCapMismatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_assoc_capmismatch
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAssocNoRateMatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_assoc_norate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxBadWpaIE
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_assoc_badwpaie
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDeauthenticate
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_deauth
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDisassociate
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_disassoc
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxUnknownSubtype
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badsubtype
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxFailedNoBuf
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_nobuf
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxBadAuthRequest
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_bad_auth
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxUnAuthorized
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_unauth
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxBadKeyId
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badkeyid
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxCCMPSeqViolation
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_ccmpreplay
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxCCMPBadFormat
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_ccmpformat
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxCCMPFailedMIC
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_ccmpmic
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxTKIPSeqViolation
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_tkipreplay
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxTKIPBadFormat
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_tkipformat
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxTKIPFailedMIC
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_tkipmic
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxTKIPFailedICV
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_tkipicv
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardACL
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_acl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFailedNoBuf
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_nobuf
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFailedNoNode
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_nonode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxUnknownMgmt
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_unknownmgt
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxBadCipher
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_badcipher
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxNoDefKey
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_nodefkey
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFragmented
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_fragframes
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFragmentsCreated
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_frags
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsActiveScans
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_scan_active
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsPassiveScans
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_scan_passive
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTimeoutInactivity
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_node_timeout
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoNoMem
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_nomem
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsSwCryptoTKIP
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_tkip
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsSwCryptoTKIPEnMIC
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_tkipenmic
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsSwCryptoTKIPDeMIC
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_tkipdemic
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoTKIPCM
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_tkipcm
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsSwCryptoCCMP
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_ccmp
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsSwCryptoWEP
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_wep
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoCipherKeyRejected
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_setkey_cipher
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoNoKey
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_setkey_nokey
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoDeleteKeyFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_delkey
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoUnknownCipher
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_badcipher
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoAttachFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_attachfail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoKeyFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_keyfail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsCryptoEnMICFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_crypto_enmicfail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsIBSSCapMismatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ibss_capmismatch
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsUnassocStaPSPoll
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ps_unassoc
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsBadAidPSPoll
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ps_badaid
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsEmptyPSPoll
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ps_qempty
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxFFBadHdr
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_badhdr
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxFFTooShort
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_tooshort
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxFFSplitError
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_split
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxFFDecap
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_decap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFFEncap
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_encap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxBadBintval
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badbintval
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDemicFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_demicfail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDefragFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_defrag
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxMgmt
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_mgmt
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxActionMgmt
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_action
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAMSDUTooShort
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_amsdu_tooshort
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAMSDUSplitError
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_amsdu_split
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxAMSDUDecap
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_amsdu_decap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxAMSDUEncap
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_amsdu_encap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUBadBAR
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_bar_bad
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUOowBar
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_bar_oow
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUMovedBAR
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_bar_move
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxBAR
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_bar_rx
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxOor
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_oor
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxCopied
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_copy
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxDropped
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_drop
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxDiscardBadState
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_badstate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxFailedNoAssoc
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_notassoc
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxClassifyFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_classify
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsDwdsMcastDiscard
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_dwds_mcast
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsHTAssocRejectNoHT
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ht_assoc_nohtcap
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsHTAssocDowngrade
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ht_assoc_downgrade
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsHTAssocRateMismatch
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ht_assoc_norate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxAge
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_age
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUMoved
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_move
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsADDBADisabledReject
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_addba_reject
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsADDBANoRequest
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_addba_norequest
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsADDBABadToken
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_addba_badtoken
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsADDBABadPolicy
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_addba_badpolicy
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUStopped
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_stop
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDUStopFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_stop_failed
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURxReorder
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rx_reorder
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsScansBackground
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_scan_bg
expr_stmt|;
break|break;
case|case
name|LEAF_wlanLastDeauthReason
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_deauth_code
expr_stmt|;
break|break;
case|case
name|LEAF_wlanLastDissasocReason
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_disassoc_code
expr_stmt|;
break|break;
case|case
name|LEAF_wlanLastAuthFailReason
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_authfail_code
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsBeaconMissedEvents
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_beacon_miss
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsRxDiscardBadStates
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badstate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsFFFlushed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ff_flush
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsTxControlFrames
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_tx_ctl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURexmt
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rexmt
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsAMPDURexmtFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_ampdu_rexmt_fail
expr_stmt|;
break|break;
case|case
name|LEAF_wlanStatsReset
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wlanStatsReset_no_op
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_wep_iface
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|!
name|wif
operator|->
name|wepsupported
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
comment|/* XXX: filter wif->wepsupported */
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|!
name|wif
operator|->
name|wepsupported
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanWepMode
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|<
name|wlanWepMode_off
operator|||
name|val
operator|->
name|v
operator|.
name|integer
operator|>
name|wlanWepMode_mixed
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|wepmode
expr_stmt|;
name|wif
operator|->
name|wepmode
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
if|if
condition|(
name|wlan_set_wepmode
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wif
operator|->
name|wepmode
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
break|break;
case|case
name|LEAF_wlanWepDefTxKey
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|<
literal|0
operator|||
name|val
operator|->
name|v
operator|.
name|integer
operator|>
name|IEEE80211_WEP_NKID
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|weptxkey
expr_stmt|;
name|wif
operator|->
name|weptxkey
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
if|if
condition|(
name|wlan_set_weptxkey
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wif
operator|->
name|weptxkey
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanWepMode
case|:
name|wif
operator|->
name|wepmode
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
if|if
condition|(
name|wlan_set_wepmode
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
case|case
name|LEAF_wlanWepDefTxKey
case|:
name|wif
operator|->
name|weptxkey
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
if|if
condition|(
name|wlan_set_weptxkey
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanWepMode
case|:
if|if
condition|(
name|wlan_get_wepmode
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|wepmode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanWepDefTxKey
case|:
if|if
condition|(
name|wlan_get_weptxkey
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|weptxkey
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_wep_key
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
name|__unused
parameter_list|,
name|uint32_t
name|sub
name|__unused
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
name|__unused
parameter_list|)
block|{
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mac_access_control
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|!
name|wif
operator|->
name|macsupported
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
comment|/* XXX: filter wif->macsupported */
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_next_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|!
name|wif
operator|->
name|macsupported
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMACAccessControlPolicy
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mac_policy
expr_stmt|;
name|wif
operator|->
name|mac_policy
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMACAccessControlNacl
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|LEAF_wlanMACAccessControlFlush
case|:
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMACAccessControlPolicy
case|:
if|if
condition|(
name|wlan_set_mac_policy
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wif
operator|->
name|mac_policy
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
break|break;
case|case
name|LEAF_wlanMACAccessControlFlush
case|:
if|if
condition|(
name|wlan_flush_mac_mac
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMACAccessControlPolicy
condition|)
name|wif
operator|->
name|mac_policy
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_get_mac_policy
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMACAccessControlPolicy
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mac_policy
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMACAccessControlNacl
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mac_nacls
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMACAccessControlFlush
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlanMACAccessControlFlush_no_op
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mac_acl_mac
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|struct
name|wlan_mac_mac
modifier|*
name|macl
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_mac_update_aclmacs
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|macl
operator|=
name|wlan_get_acl_mac
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|macl
operator|=
name|wlan_get_next_acl_mac
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_mac_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|macl
operator|->
name|mac
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMACAccessControlMAC
case|:
return|return
operator|(
name|SNMP_ERR_INCONS_NAME
operator|)
return|;
case|case
name|LEAF_wlanMACAccessControlMACStatus
case|:
return|return
operator|(
name|wlan_acl_mac_set_status
argument_list|(
name|ctx
argument_list|,
name|val
argument_list|,
name|sub
argument_list|)
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
case|case
name|SNMP_OP_COMMIT
case|:
if|if
condition|(
operator|(
name|macl
operator|=
name|wlan_get_acl_mac
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|==
name|RowStatus_destroy
operator|&&
name|wlan_mac_delete_mac
argument_list|(
name|wif
argument_list|,
name|macl
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|macl
operator|=
name|wlan_get_acl_mac
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|==
name|RowStatus_destroy
operator|&&
name|wlan_mac_delete_mac
argument_list|(
name|wif
argument_list|,
name|macl
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMACAccessControlMAC
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|macl
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMACAccessControlMACStatus
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|macl
operator|->
name|mac_status
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mesh_config
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int
name|which
decl_stmt|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshMaxRetries
case|:
name|which
operator|=
name|WLAN_MESH_MAX_RETRIES
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHoldingTimeout
case|:
name|which
operator|=
name|WLAN_MESH_HOLDING_TO
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshConfirmTimeout
case|:
name|which
operator|=
name|WLAN_MESH_CONFIRM_TO
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRetryTimeout
case|:
name|which
operator|=
name|WLAN_MESH_RETRY_TO
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|abort
argument_list|()
expr_stmt|;
case|case
name|SNMP_OP_SET
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshRetryTimeout
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|mesh_retryto
expr_stmt|;
name|wlan_config
operator|.
name|mesh_retryto
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHoldingTimeout
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|mesh_holdingto
expr_stmt|;
name|wlan_config
operator|.
name|mesh_holdingto
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshConfirmTimeout
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|mesh_confirmto
expr_stmt|;
name|wlan_config
operator|.
name|mesh_confirmto
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMaxRetries
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|mesh_maxretries
expr_stmt|;
name|wlan_config
operator|.
name|mesh_maxretries
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshRetryTimeout
case|:
name|wlan_config
operator|.
name|mesh_retryto
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshConfirmTimeout
case|:
name|wlan_config
operator|.
name|mesh_confirmto
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHoldingTimeout
case|:
name|wlan_config
operator|.
name|mesh_holdingto
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMaxRetries
case|:
name|wlan_config
operator|.
name|mesh_maxretries
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshRetryTimeout
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|mesh_retryto
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHoldingTimeout
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|mesh_holdingto
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshConfirmTimeout
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|mesh_confirmto
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMaxRetries
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|mesh_maxretries
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mesh_iface
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int
name|rc
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_next_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshId
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|>
name|IEEE80211_NWID_LEN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|=
name|malloc
argument_list|(
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|strlcpy
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|wif
operator|->
name|desired_ssid
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|+
literal|1
argument_list|)
expr_stmt|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|strlen
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
argument_list|)
expr_stmt|;
name|wif
operator|->
name|desired_ssid
index|[
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
index|]
operator|=
literal|'\0'
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshTTL
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mesh_ttl
expr_stmt|;
name|wif
operator|->
name|mesh_ttl
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mesh_peering
expr_stmt|;
name|wif
operator|->
name|mesh_peering
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mesh_forwarding
expr_stmt|;
name|wif
operator|->
name|mesh_forwarding
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mesh_metric
expr_stmt|;
name|wif
operator|->
name|mesh_metric
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|mesh_path
expr_stmt|;
name|wif
operator|->
name|mesh_path
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRoutesFlush
case|:
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|!=
name|wlanMeshRoutesFlush_flush
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMeshId
condition|)
name|rc
operator|=
name|wlan_config_set_dssid
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|wlan_mesh_config_set
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMeshRoutesFlush
operator|&&
name|wlan_mesh_flush_routes
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMeshId
condition|)
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshId
case|:
name|strlcpy
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|,
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|,
name|IEEE80211_NWID_LEN
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|ctx
operator|->
name|scratch
operator|->
name|ptr1
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshTTL
case|:
name|wif
operator|->
name|mesh_ttl
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
name|wif
operator|->
name|mesh_peering
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
name|wif
operator|->
name|mesh_forwarding
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|wif
operator|->
name|mesh_metric
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|wif
operator|->
name|mesh_path
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRoutesFlush
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMeshId
condition|)
name|rc
operator|=
name|wlan_config_set_dssid
argument_list|(
name|wif
argument_list|,
name|wif
operator|->
name|desired_ssid
argument_list|,
name|strlen
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|wlan_mesh_config_set
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
operator|==
name|LEAF_wlanMeshId
condition|)
name|rc
operator|=
name|wlan_config_get_dssid
argument_list|(
name|wif
argument_list|)
expr_stmt|;
else|else
name|rc
operator|=
name|wlan_mesh_config_get
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshId
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wif
operator|->
name|desired_ssid
argument_list|,
operator|-
literal|1
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshTTL
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mesh_ttl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mesh_peering
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mesh_forwarding
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mesh_metric
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|mesh_path
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRoutesFlush
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlanMeshRoutesFlush_no_op
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mesh_neighbor
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_update_peers
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_mesh_get_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|wip
operator|=
name|wlan_mesh_get_next_peer
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|wip
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_mac_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|wip
operator|->
name|pmac
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshNeighborAddress
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wip
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshNeighborFrequency
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|frequency
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborLocalId
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|local_id
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborPeerId
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|peer_id
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborPeerState
case|:
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|wip
operator|->
name|state
argument_list|,
sizeof|sizeof
argument_list|(
name|wip
operator|->
name|state
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshNeighborCurrentTXRate
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|txrate
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborRxSignalStrength
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|rssi
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborIdleTimer
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|idle
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborTxSequenceNo
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|txseqs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNeighborRxSequenceNo
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wip
operator|->
name|rxseqs
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mesh_route
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
name|wlan_mesh_update_routes
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wmr
operator|=
name|wlan_mesh_get_route
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|wmr
operator|=
name|wlan_mesh_get_next_route
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|wmr
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_mac_index
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshRouteDestination
case|:
return|return
operator|(
name|SNMP_ERR_INCONS_NAME
operator|)
return|;
case|case
name|LEAF_wlanMeshRouteStatus
case|:
return|return
operator|(
name|wlan_mesh_route_set_status
argument_list|(
name|ctx
argument_list|,
name|val
argument_list|,
name|sub
argument_list|)
operator|)
return|;
default|default:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
block|}
name|abort
argument_list|()
expr_stmt|;
case|case
name|SNMP_OP_COMMIT
case|:
if|if
condition|(
operator|(
name|wmr
operator|=
name|wlan_mesh_get_route
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|val
operator|->
name|v
operator|.
name|integer
operator|==
name|RowStatus_destroy
operator|&&
name|wlan_mesh_delete_route
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wmr
operator|=
name|wlan_mesh_get_route
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
if|if
condition|(
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|==
name|RowStatus_destroy
operator|&&
name|wlan_mesh_delete_route
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshRouteDestination
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshRouteNextHop
case|:
return|return
operator|(
name|string_get
argument_list|(
name|val
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_nexthop
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshRouteHops
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wmr
operator|->
name|imroute
operator|.
name|imr_nhops
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRouteMetric
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wmr
operator|->
name|imroute
operator|.
name|imr_metric
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRouteLifeTime
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wmr
operator|->
name|imroute
operator|.
name|imr_lifetime
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRouteLastMseq
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wmr
operator|->
name|imroute
operator|.
name|imr_lastmseq
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRouteFlags
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_flags
operator|&
name|IEEE80211_MESHRT_FLAGS_VALID
operator|)
operator|!=
literal|0
condition|)
name|val
operator|->
name|v
operator|.
name|integer
operator||=
operator|(
literal|0x1
operator|<<
name|wlanMeshRouteFlags_valid
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_flags
operator|&
name|IEEE80211_MESHRT_FLAGS_PROXY
operator|)
operator|!=
literal|0
condition|)
name|val
operator|->
name|v
operator|.
name|integer
operator||=
operator|(
literal|0x1
operator|<<
name|wlanMeshRouteFlags_proxy
operator|)
expr_stmt|;
return|return
operator|(
name|bits_get
argument_list|(
name|val
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
operator|&
name|val
operator|->
name|v
operator|.
name|integer
argument_list|,
sizeof|sizeof
argument_list|(
name|val
operator|->
name|v
operator|.
name|integer
argument_list|)
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanMeshRouteStatus
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wmr
operator|->
name|mroute_status
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_mesh_stats
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_next_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_get_stats
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshDroppedBadSta
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_wrongmesh
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshDroppedNoLink
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_nolink
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNoFwdTtl
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_fwd_ttl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNoFwdBuf
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_fwd_nobuf
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNoFwdTooShort
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_fwd_tooshort
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNoFwdDisabled
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_fwd_disabled
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshNoFwdPathUnknown
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_fwd_nopath
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshDroppedBadAE
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_badae
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRouteAddFailed
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_rtaddfailed
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshDroppedNoProxy
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_mesh_notproxy
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshDroppedMisaligned
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_rx_badalign
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_hwmp_config
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|int
name|which
decl_stmt|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRouteInactiveTimeout
case|:
name|which
operator|=
name|WLAN_HWMP_INACTIVITY_TO
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootAnnounceInterval
case|:
name|which
operator|=
name|WLAN_HWMP_RANN_INT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootInterval
case|:
name|which
operator|=
name|WLAN_HWMP_ROOT_INT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootTimeout
case|:
name|which
operator|=
name|WLAN_HWMP_ROOT_TO
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPPathLifetime
case|:
name|which
operator|=
name|WLAN_HWMP_PATH_LIFETIME
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPReplyForwardBit
case|:
name|which
operator|=
name|WLAN_HWMP_REPLY_FORWARD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPTargetOnlyBit
case|:
name|which
operator|=
name|WLAN_HWMP_TARGET_ONLY
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
name|abort
argument_list|()
expr_stmt|;
case|case
name|SNMP_OP_SET
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRouteInactiveTimeout
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_inact
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_inact
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootAnnounceInterval
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_rannint
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_rannint
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootInterval
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_rootint
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_rootint
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootTimeout
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_roottimeout
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_roottimeout
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPPathLifetime
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_pathlifetime
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_pathlifetime
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPReplyForwardBit
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_replyforward
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_replyforward
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPTargetOnlyBit
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wlan_config
operator|.
name|hwmp_targetonly
expr_stmt|;
name|wlan_config
operator|.
name|hwmp_targetonly
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRouteInactiveTimeout
case|:
name|wlan_config
operator|.
name|hwmp_inact
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootAnnounceInterval
case|:
name|wlan_config
operator|.
name|hwmp_rannint
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootInterval
case|:
name|wlan_config
operator|.
name|hwmp_rootint
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootTimeout
case|:
name|wlan_config
operator|.
name|hwmp_roottimeout
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPPathLifetime
case|:
name|wlan_config
operator|.
name|hwmp_pathlifetime
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPReplyForwardBit
case|:
name|wlan_config
operator|.
name|hwmp_replyforward
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPTargetOnlyBit
case|:
name|wlan_config
operator|.
name|hwmp_targetonly
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|wlan_do_sysctl
argument_list|(
operator|&
name|wlan_config
argument_list|,
name|which
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRouteInactiveTimeout
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_inact
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootAnnounceInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_rannint
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootInterval
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_rootint
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPRootTimeout
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_roottimeout
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPPathLifetime
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_pathlifetime
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPReplyForwardBit
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_replyforward
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPTargetOnlyBit
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wlan_config
operator|.
name|hwmp_targetonly
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_hwmp_iface
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_next_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|hwmp_root_mode
expr_stmt|;
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|wif
operator|->
name|hwmp_max_hops
expr_stmt|;
name|wif
operator|->
name|hwmp_max_hops
operator|=
name|val
operator|->
name|v
operator|.
name|integer
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_hwmp_config_set
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
case|case
name|SNMP_OP_ROLLBACK
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|wif
operator|->
name|hwmp_max_hops
operator|=
name|ctx
operator|->
name|scratch
operator|->
name|int1
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_hwmp_config_set
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_hwmp_config_get
argument_list|(
name|wif
argument_list|,
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|hwmp_root_mode
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|val
operator|->
name|v
operator|.
name|integer
operator|=
name|wif
operator|->
name|hwmp_max_hops
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|op_wlan_hwmp_stats
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
name|__unused
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint32_t
name|sub
parameter_list|,
name|uint32_t
name|iidx
name|__unused
parameter_list|,
name|enum
name|snmp_op
name|op
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|wlan_update_interface_list
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SNMP_OP_GET
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
break|break;
case|case
name|SNMP_OP_GETNEXT
case|:
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_mesh_get_next_iface
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|wlan_append_ifindex
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SNMP_OP_SET
case|:
return|return
operator|(
name|SNMP_ERR_NOT_WRITEABLE
operator|)
return|;
case|case
name|SNMP_OP_COMMIT
case|:
comment|/* FALLTHROUGH */
case|case
name|SNMP_OP_ROLLBACK
case|:
comment|/* FALLTHROUGH */
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|wlan_get_stats
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
switch|switch
condition|(
name|val
operator|->
name|var
operator|.
name|subs
index|[
name|sub
operator|-
literal|1
index|]
condition|)
block|{
case|case
name|LEAF_wlanMeshHWMPWrongSeqNo
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_hwmp_wrongseq
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHWMPTxRootPREQ
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_hwmp_rootreqs
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHWMPTxRootRANN
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_hwmp_rootrann
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshHWMPProxy
case|:
name|val
operator|->
name|v
operator|.
name|uint32
operator|=
name|wif
operator|->
name|stats
operator|.
name|is_hwmp_proxy
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Encode BITS type for a response packet - XXX: this belongs to the snmp lib.  */
end_comment

begin_function
specifier|static
name|int
name|bits_get
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
specifier|const
name|u_char
modifier|*
name|ptr
parameter_list|,
name|ssize_t
name|len
parameter_list|)
block|{
name|int
name|size
decl_stmt|;
if|if
condition|(
name|ptr
operator|==
name|NULL
condition|)
block|{
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
comment|/* Determine length - up to 8 octets supported so far. */
for|for
control|(
name|size
operator|=
name|len
init|;
name|size
operator|>
literal|0
condition|;
name|size
operator|--
control|)
if|if
condition|(
name|ptr
index|[
name|size
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
break|break;
if|if
condition|(
name|size
operator|==
literal|0
condition|)
name|size
operator|=
literal|1
expr_stmt|;
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
operator|(
name|u_long
operator|)
name|size
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
operator|(
name|size_t
operator|)
name|size
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_RES_UNAVAIL
operator|)
return|;
name|memcpy
argument_list|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|ptr
argument_list|,
operator|(
name|size_t
operator|)
name|size
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Calls for adding/updating/freeing/etc of wireless interfaces.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_free_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|wlan_free_peerlist
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wif
operator|->
name|chanlist
argument_list|)
expr_stmt|;
name|wlan_scan_free_results
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|wlan_mac_free_maclist
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|wlan_mesh_free_routes
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_free_iflist
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|w
decl_stmt|;
while|while
condition|(
operator|(
name|w
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wlan_ifaces
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|SLIST_REMOVE_HEAD
argument_list|(
operator|&
name|wlan_ifaces
argument_list|,
name|w_if
argument_list|)
expr_stmt|;
name|wlan_free_interface
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_find_interface
parameter_list|(
specifier|const
name|char
modifier|*
name|wname
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|wif
argument_list|,
argument|&wlan_ifaces
argument_list|,
argument|w_if
argument_list|)
if|if
condition|(
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|wname
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
break|break;
block|}
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_first_interface
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|(
name|SLIST_FIRST
argument_list|(
operator|&
name|wlan_ifaces
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_next_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
if|if
condition|(
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|SLIST_NEXT
argument_list|(
name|wif
argument_list|,
name|w_if
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Add a new interface to the list - sorted by name.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_add_wif
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|cmp
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|temp
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
if|if
condition|(
operator|(
name|prev
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wlan_ifaces
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|prev
operator|->
name|wname
argument_list|)
operator|<
literal|0
condition|)
block|{
name|SLIST_INSERT_HEAD
argument_list|(
operator|&
name|wlan_ifaces
argument_list|,
name|wif
argument_list|,
name|w_if
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wlan_ifaces
argument_list|,
argument|w_if
argument_list|)
block|{
if|if
condition|(
operator|(
name|cmp
operator|=
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|temp
operator|->
name|wname
argument_list|)
operator|)
operator|<=
literal|0
condition|)
break|break;
name|prev
operator|=
name|temp
expr_stmt|;
block|}
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
name|SLIST_INSERT_AFTER
argument_list|(
name|prev
argument_list|,
name|wif
argument_list|,
name|w_if
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|cmp
operator|>
literal|0
condition|)
name|SLIST_INSERT_AFTER
argument_list|(
name|temp
argument_list|,
name|wif
argument_list|,
name|w_if
argument_list|)
expr_stmt|;
else|else
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"Wlan iface %s already in list"
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_new_wif
parameter_list|(
name|char
modifier|*
name|wname
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
comment|/* Make sure it's not in the list. */
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|wname
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|internal
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|wif
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|wif
operator|=
operator|(
expr|struct
name|wlan_iface
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|wif
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wif
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wlan_iface
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|wif
operator|->
name|status
operator|=
name|RowStatus_notReady
expr_stmt|;
name|wif
operator|->
name|state
operator|=
name|wlanIfaceState_down
expr_stmt|;
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_station
expr_stmt|;
if|if
condition|(
name|wlan_add_wif
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
block|{
name|free
argument_list|(
name|wif
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_delete_wif
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|SLIST_REMOVE
argument_list|(
operator|&
name|wlan_ifaces
argument_list|,
name|wif
argument_list|,
name|wlan_iface
argument_list|,
name|w_if
argument_list|)
expr_stmt|;
name|wlan_free_interface
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_attach_newif
parameter_list|(
name|struct
name|mibif
modifier|*
name|mif
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|mif
operator|->
name|mib
operator|.
name|ifmd_data
operator|.
name|ifi_type
operator|!=
name|IFT_ETHER
operator|||
name|wlan_check_media
argument_list|(
name|mif
operator|->
name|name
argument_list|)
operator|!=
name|IFM_IEEE80211
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_new_wif
argument_list|(
name|mif
operator|->
name|name
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
operator|(
name|void
operator|)
name|wlan_get_opmode
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|wif
operator|->
name|index
operator|=
name|mif
operator|->
name|index
expr_stmt|;
name|wif
operator|->
name|status
operator|=
name|RowStatus_active
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_update_interface
argument_list|(
name|wif
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_iface_create
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|rc
decl_stmt|;
if|if
condition|(
operator|(
name|rc
operator|=
name|wlan_clone_create
argument_list|(
name|wif
argument_list|)
operator|)
operator|==
name|SNMP_ERR_NOERROR
condition|)
block|{
comment|/* 		 * The rest of the info will be updated once the 		 * snmp_mibII module notifies us of the interface. 		 */
name|wif
operator|->
name|status
operator|=
name|RowStatus_active
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|state
operator|==
name|wlanIfaceState_up
condition|)
operator|(
name|void
operator|)
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_iface_destroy
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|rc
init|=
name|SNMP_ERR_NOERROR
decl_stmt|;
if|if
condition|(
name|wif
operator|->
name|internal
operator|==
literal|0
condition|)
name|rc
operator|=
name|wlan_clone_destroy
argument_list|(
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|==
name|SNMP_ERR_NOERROR
condition|)
name|wlan_delete_wif
argument_list|(
name|wif
argument_list|)
expr_stmt|;
return|return
operator|(
name|rc
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_update_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
operator|(
name|void
operator|)
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_driver_caps
argument_list|(
name|wif
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|LEAF_wlanIfacePacketBurst
init|;
name|i
operator|<=
name|LEAF_wlanIfaceTdmaBeaconInterval
condition|;
name|i
operator|++
control|)
operator|(
name|void
operator|)
name|wlan_config_get_ioctl
argument_list|(
name|wif
argument_list|,
name|i
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_stats
argument_list|(
name|wif
argument_list|)
expr_stmt|;
comment|/* 	 * XXX: wlan_get_channel_list() not needed - 	 * fetched with wlan_get_driver_caps() 	 */
operator|(
name|void
operator|)
name|wlan_get_channel_list
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_roam_params
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_tx_params
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_scan_results
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_wepmode
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_weptxkey
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_mac_policy
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_mac_acl_macs
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_peerinfo
argument_list|(
name|wif
argument_list|)
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
condition|)
block|{
for|for
control|(
name|i
operator|=
name|LEAF_wlanMeshTTL
init|;
name|i
operator|<=
name|LEAF_wlanMeshPath
condition|;
name|i
operator|++
control|)
operator|(
name|void
operator|)
name|wlan_mesh_config_get
argument_list|(
name|wif
argument_list|,
name|i
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_mesh_get_routelist
argument_list|(
name|wif
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|LEAF_wlanHWMPRootMode
init|;
name|i
operator|<=
name|LEAF_wlanHWMPMaxHops
condition|;
name|i
operator|++
control|)
operator|(
name|void
operator|)
name|wlan_hwmp_config_get
argument_list|(
name|wif
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_update_interface_list
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|,
modifier|*
name|twif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_iflist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
comment|/* 	 * The snmp_mibII module would have notified us for new interfaces, 	 * so only check if any have been deleted. 	 */
name|SLIST_FOREACH_SAFE
argument_list|(
argument|wif
argument_list|,
argument|&wlan_ifaces
argument_list|,
argument|w_if
argument_list|,
argument|twif
argument_list|)
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
operator|&&
name|wlan_get_opmode
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
name|wlan_delete_wif
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|wlan_iflist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_append_ifindex
parameter_list|(
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
specifier|const
name|struct
name|wlan_iface
modifier|*
name|w
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|oid
operator|->
name|len
operator|=
name|sub
operator|+
name|strlen
argument_list|(
name|w
operator|->
name|wname
argument_list|)
operator|+
literal|1
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|w
operator|->
name|wname
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|w
operator|->
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|w
operator|->
name|wname
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|uint8_t
modifier|*
name|wlan_get_ifname
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|uint8_t
modifier|*
name|wname
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|memset
argument_list|(
name|wname
argument_list|,
literal|0
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
name|wname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|uint8_t
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|wlan_get_ifname
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_next_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|uint8_t
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
break|break;
return|return
operator|(
name|wif
operator|)
return|;
block|}
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wname
argument_list|,
literal|0
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
while|while
condition|(
operator|(
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
break|break;
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_snmp_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|uint8_t
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|wlan_get_ifname
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|wname
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_get_next_snmp_interface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|uint8_t
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
return|return
operator|(
name|wlan_first_interface
argument_list|()
operator|)
return|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wname
argument_list|,
literal|0
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|wname
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Decode/Append an index for tables indexed by the wireless interface  * name and a MAC address - ACL MACs and Mesh Routes.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_mac_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|int
name|mac_off
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|2
operator|+
name|IEEE80211_ADDR_LEN
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
name|mac_off
operator|=
name|sub
operator|+
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|oid
operator|->
name|subs
index|[
name|mac_off
index|]
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_ADDR_LEN
condition|;
name|i
operator|++
control|)
name|mac
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|mac_off
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_append_mac_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|oid
operator|->
name|len
operator|=
name|sub
operator|+
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
name|IEEE80211_ADDR_LEN
operator|+
literal|2
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|wname
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|wname
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
name|sub
operator|+=
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
literal|1
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|IEEE80211_ADDR_LEN
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|IEEE80211_ADDR_LEN
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|mac
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Decode/Append an index for tables indexed by the wireless interface  * name and the PHY mode - Roam and TX params.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_phy_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint32_t
modifier|*
name|phy
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|2
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|*
name|phy
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
index|]
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_append_phy_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint32_t
name|phy
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|oid
operator|->
name|len
operator|=
name|sub
operator|+
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
literal|2
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|wname
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|wname
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
literal|1
index|]
operator|=
name|phy
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Calls for manipulating the peerlist of a wireless interface.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_free_peerlist
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
while|while
condition|(
operator|(
name|wip
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|peerlist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|SLIST_REMOVE_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|peerlist
argument_list|,
name|wp
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wip
argument_list|)
expr_stmt|;
block|}
name|SLIST_INIT
argument_list|(
operator|&
name|wif
operator|->
name|peerlist
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_find_peer
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
modifier|*
name|peermac
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|wip
argument_list|,
argument|&wif->peerlist
argument_list|,
argument|wp
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|wip
operator|->
name|pmac
argument_list|,
name|peermac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|wip
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|wlan_peer
modifier|*
name|wlan_new_peer
parameter_list|(
specifier|const
name|uint8_t
modifier|*
name|pmac
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
if|if
condition|(
operator|(
name|wip
operator|=
operator|(
expr|struct
name|wlan_peer
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|wip
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wip
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|wlan_peer
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wip
operator|->
name|pmac
argument_list|,
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|wip
operator|)
return|;
block|}
end_function

begin_function
name|void
name|wlan_free_peer
parameter_list|(
name|struct
name|wlan_peer
modifier|*
name|wip
parameter_list|)
block|{
name|free
argument_list|(
name|wip
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|wlan_add_peer
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_peer
modifier|*
name|wip
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|temp
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->peerlist
argument_list|,
argument|wp
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|temp
operator|->
name|pmac
argument_list|,
name|wip
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|prev
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|peerlist
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|memcmp
argument_list|(
name|wip
operator|->
name|pmac
argument_list|,
name|prev
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
block|{
name|SLIST_INSERT_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|peerlist
argument_list|,
name|wip
argument_list|,
name|wp
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->peerlist
argument_list|,
argument|wp
argument_list|)
block|{
if|if
condition|(
name|memcmp
argument_list|(
name|wip
operator|->
name|pmac
argument_list|,
name|temp
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
break|break;
name|prev
operator|=
name|temp
expr_stmt|;
block|}
name|SLIST_INSERT_AFTER
argument_list|(
name|prev
argument_list|,
name|wip
argument_list|,
name|wp
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_update_peers
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_peerlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
name|wlan_free_peerlist
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_peerinfo
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_peerlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_get_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|uint8_t
name|pmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|pmac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_find_peer
argument_list|(
operator|*
name|wif
argument_list|,
name|pmac
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_get_next_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|pmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
condition|)
continue|continue;
name|wip
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|peerlist
argument_list|)
expr_stmt|;
if|if
condition|(
name|wip
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wip
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|pmac
argument_list|)
operator|<
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
name|wip
operator|=
name|wlan_find_peer
argument_list|(
operator|*
name|wif
argument_list|,
name|pmac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|wip
operator|=
name|SLIST_NEXT
argument_list|(
name|wip
argument_list|,
name|wp
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wip
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
condition|)
continue|continue;
if|if
condition|(
operator|(
name|wip
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|peerlist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
break|break;
block|}
return|return
operator|(
name|wip
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Calls for manipulating the active channel list of a wireless interface.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_update_channels
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_chanlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
operator|(
name|void
operator|)
name|wlan_get_channel_list
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_chanlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_channel_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint32_t
modifier|*
name|cindex
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|2
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|*
name|cindex
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
index|]
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_append_channel_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
specifier|const
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|channel
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|oid
operator|->
name|len
operator|=
name|sub
operator|+
name|strlen
argument_list|(
name|wif
operator|->
name|wname
argument_list|)
operator|+
literal|2
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|wif
operator|->
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|wif
operator|->
name|wname
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|strlen
argument_list|(
name|wif
operator|->
name|wname
argument_list|)
operator|+
literal|1
index|]
operator|=
operator|(
name|channel
operator|-
name|wif
operator|->
name|chanlist
operator|)
operator|+
literal|1
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|wlan_get_channel_type
parameter_list|(
name|struct
name|ieee80211_channel
modifier|*
name|c
parameter_list|)
block|{
if|if
condition|(
name|IEEE80211_IS_CHAN_FHSS
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_fhss
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_A
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_dot11a
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_B
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_dot11b
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_ANYG
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_dot11g
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_HALF
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_tenMHz
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_QUARTER
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_fiveMHz
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_TURBO
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_turbo
operator|)
return|;
if|if
condition|(
name|IEEE80211_IS_CHAN_HT
argument_list|(
name|c
argument_list|)
condition|)
return|return
operator|(
name|WlanChannelType_ht
operator|)
return|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_find_channel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint32_t
name|cindex
parameter_list|)
block|{
if|if
condition|(
name|wif
operator|->
name|chanlist
operator|==
name|NULL
operator|||
name|cindex
operator|>
name|wif
operator|->
name|nchannels
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wif
operator|->
name|chanlist
operator|+
name|cindex
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_get_channel
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|uint32_t
name|cindex
decl_stmt|;
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|wlan_channel_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
operator|&
name|cindex
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_find_channel
argument_list|(
operator|*
name|wif
argument_list|,
name|cindex
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_channel
modifier|*
name|wlan_get_next_channel
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|uint32_t
name|cindex
decl_stmt|;
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|nchannels
operator|!=
literal|0
operator|&&
operator|(
operator|*
name|wif
operator|)
operator|->
name|chanlist
operator|!=
name|NULL
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|chanlist
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_channel_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
operator|&
name|cindex
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|cindex
operator|<
operator|(
operator|*
name|wif
operator|)
operator|->
name|nchannels
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|chanlist
operator|+
name|cindex
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|nchannels
operator|!=
literal|0
operator|&&
operator|(
operator|*
name|wif
operator|)
operator|->
name|chanlist
operator|!=
name|NULL
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|chanlist
operator|)
return|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Calls for manipulating the roam params of a wireless interface.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_update_roam_params
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_roamlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
operator|(
name|void
operator|)
name|wlan_get_roam_params
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_roamlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_roamparam
modifier|*
name|wlan_get_roam_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|uint32_t
name|phy
decl_stmt|;
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|wlan_phy_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
operator|&
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|phy
operator|==
literal|0
operator|||
name|phy
operator|>
name|IEEE80211_MODE_MAX
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|roamparams
operator|.
name|params
operator|+
name|phy
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_roamparam
modifier|*
name|wlan_get_next_roam_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|,
name|uint32_t
modifier|*
name|phy
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
operator|*
name|phy
operator|=
literal|1
expr_stmt|;
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|roamparams
operator|.
name|params
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_phy_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|*
name|phy
operator|==
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|++
operator|(
operator|*
name|phy
operator|)
operator|<=
name|IEEE80211_MODE_MAX
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|roamparams
operator|.
name|params
operator|+
operator|*
name|phy
operator|-
literal|1
operator|)
return|;
operator|*
name|phy
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|roamparams
operator|.
name|params
operator|)
return|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Calls for manipulating the tx params of a wireless interface.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_update_tx_params
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_tx_paramlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
operator|(
name|void
operator|)
name|wlan_get_tx_params
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_tx_paramlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_txparam
modifier|*
name|wlan_get_tx_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|,
name|uint32_t
modifier|*
name|phy
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|wlan_phy_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|*
name|phy
operator|==
literal|0
operator|||
operator|*
name|phy
operator|>
name|IEEE80211_MODE_MAX
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|txparams
operator|.
name|params
operator|+
operator|*
name|phy
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|ieee80211_txparam
modifier|*
name|wlan_get_next_tx_param
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|,
name|uint32_t
modifier|*
name|phy
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
operator|*
name|phy
operator|=
literal|1
expr_stmt|;
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|txparams
operator|.
name|params
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_phy_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|phy
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|*
name|phy
operator|==
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|++
operator|(
operator|*
name|phy
operator|)
operator|<=
name|IEEE80211_MODE_MAX
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|txparams
operator|.
name|params
operator|+
operator|*
name|phy
operator|-
literal|1
operator|)
return|;
operator|*
name|phy
operator|=
literal|1
expr_stmt|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
return|return
operator|(
operator|(
operator|*
name|wif
operator|)
operator|->
name|txparams
operator|.
name|params
operator|)
return|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Calls for manipulating the scan results for a wireless interface.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_scan_free_results
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
while|while
condition|(
operator|(
name|sr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|scanlist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|SLIST_REMOVE_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|scanlist
argument_list|,
name|wsr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|sr
argument_list|)
expr_stmt|;
block|}
name|SLIST_INIT
argument_list|(
operator|&
name|wif
operator|->
name|scanlist
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_scan_find_result
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
modifier|*
name|ssid
parameter_list|,
name|uint8_t
modifier|*
name|bssid
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|sr
argument_list|,
argument|&wif->scanlist
argument_list|,
argument|wsr
argument_list|)
if|if
condition|(
name|strlen
argument_list|(
name|ssid
argument_list|)
operator|==
name|strlen
argument_list|(
name|sr
operator|->
name|ssid
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|sr
operator|->
name|ssid
argument_list|,
name|ssid
argument_list|)
operator|==
literal|0
operator|&&
name|memcmp
argument_list|(
name|sr
operator|->
name|bssid
argument_list|,
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|sr
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|wlan_scan_result
modifier|*
name|wlan_scan_new_result
parameter_list|(
specifier|const
name|uint8_t
modifier|*
name|ssid
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|bssid
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
name|sr
operator|=
operator|(
expr|struct
name|wlan_scan_result
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|sr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|sr
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|sr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|sr
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssid
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|strlcpy
argument_list|(
name|sr
operator|->
name|ssid
argument_list|,
name|ssid
argument_list|,
name|IEEE80211_NWID_LEN
operator|+
literal|1
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|sr
operator|->
name|bssid
argument_list|,
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
name|sr
operator|)
return|;
block|}
end_function

begin_function
name|void
name|wlan_scan_free_result
parameter_list|(
name|struct
name|wlan_scan_result
modifier|*
name|sr
parameter_list|)
block|{
name|free
argument_list|(
name|sr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_scan_compare_result
parameter_list|(
name|struct
name|wlan_scan_result
modifier|*
name|sr1
parameter_list|,
name|struct
name|wlan_scan_result
modifier|*
name|sr2
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|sr1
operator|->
name|ssid
argument_list|)
operator|<
name|strlen
argument_list|(
name|sr2
operator|->
name|ssid
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|strlen
argument_list|(
name|sr1
operator|->
name|ssid
argument_list|)
operator|>
name|strlen
argument_list|(
name|sr2
operator|->
name|ssid
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|strlen
argument_list|(
name|sr1
operator|->
name|ssid
argument_list|)
operator|&&
name|i
operator|<
name|strlen
argument_list|(
name|sr2
operator|->
name|ssid
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|sr1
operator|->
name|ssid
index|[
name|i
index|]
operator|<
name|sr2
operator|->
name|ssid
index|[
name|i
index|]
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|sr1
operator|->
name|ssid
index|[
name|i
index|]
operator|>
name|sr2
operator|->
name|ssid
index|[
name|i
index|]
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_ADDR_LEN
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|sr1
operator|->
name|bssid
index|[
name|i
index|]
operator|<
name|sr2
operator|->
name|bssid
index|[
name|i
index|]
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|sr1
operator|->
name|bssid
index|[
name|i
index|]
operator|>
name|sr2
operator|->
name|bssid
index|[
name|i
index|]
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_scan_add_result
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_scan_result
modifier|*
name|sr
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|prev
decl_stmt|,
modifier|*
name|temp
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->scanlist
argument_list|,
argument|wsr
argument_list|)
if|if
condition|(
name|strlen
argument_list|(
name|temp
operator|->
name|ssid
argument_list|)
operator|==
name|strlen
argument_list|(
name|sr
operator|->
name|ssid
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|sr
operator|->
name|ssid
argument_list|,
name|temp
operator|->
name|ssid
argument_list|)
operator|==
literal|0
operator|&&
name|memcmp
argument_list|(
name|sr
operator|->
name|bssid
argument_list|,
name|temp
operator|->
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|prev
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|scanlist
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|wlan_scan_compare_result
argument_list|(
name|sr
argument_list|,
name|prev
argument_list|)
operator|<
literal|0
condition|)
block|{
name|SLIST_INSERT_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|scanlist
argument_list|,
name|sr
argument_list|,
name|wsr
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->scanlist
argument_list|,
argument|wsr
argument_list|)
block|{
if|if
condition|(
name|wlan_scan_compare_result
argument_list|(
name|sr
argument_list|,
name|temp
argument_list|)
operator|<
literal|0
condition|)
break|break;
name|prev
operator|=
name|temp
expr_stmt|;
block|}
name|SLIST_INSERT_AFTER
argument_list|(
name|prev
argument_list|,
name|sr
argument_list|,
name|wsr
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_scan_update_results
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_scanlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
name|wlan_scan_free_results
argument_list|(
name|wif
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_get_scan_results
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_scanlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_scanr_index_decode
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint8_t
modifier|*
name|ssid
parameter_list|,
name|uint8_t
modifier|*
name|bssid
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|int
name|offset
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|oid
operator|->
name|subs
index|[
name|sub
index|]
index|]
operator|=
literal|'\0'
expr_stmt|;
name|offset
operator|=
name|sub
operator|+
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|oid
operator|->
name|subs
index|[
name|offset
index|]
operator|>
name|IEEE80211_NWID_LEN
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|offset
index|]
condition|;
name|i
operator|++
control|)
name|ssid
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|offset
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|ssid
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
name|offset
operator|=
name|sub
operator|+
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
name|oid
operator|->
name|subs
index|[
name|offset
index|]
operator|+
literal|2
expr_stmt|;
if|if
condition|(
name|oid
operator|->
name|subs
index|[
name|offset
index|]
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|IEEE80211_ADDR_LEN
condition|;
name|i
operator|++
control|)
name|bssid
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|offset
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_append_scanr_index
parameter_list|(
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|char
modifier|*
name|wname
parameter_list|,
name|uint8_t
modifier|*
name|ssid
parameter_list|,
name|uint8_t
modifier|*
name|bssid
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|oid
operator|->
name|len
operator|=
name|sub
operator|+
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
name|strlen
argument_list|(
name|ssid
argument_list|)
operator|+
name|IEEE80211_ADDR_LEN
operator|+
literal|3
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|wname
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|wname
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|wname
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
name|sub
operator|+=
name|strlen
argument_list|(
name|wname
argument_list|)
operator|+
literal|1
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|strlen
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|strlen
argument_list|(
name|ssid
argument_list|)
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|ssid
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
name|sub
operator|+=
name|strlen
argument_list|(
name|ssid
argument_list|)
operator|+
literal|1
expr_stmt|;
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|=
name|IEEE80211_ADDR_LEN
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|IEEE80211_ADDR_LEN
condition|;
name|i
operator|++
control|)
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
index|]
operator|=
name|bssid
index|[
name|i
operator|-
literal|1
index|]
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_get_scanr
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|uint8_t
name|ssid
index|[
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|uint8_t
name|bssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wlan_scanr_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|ssid
argument_list|,
name|bssid
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_scan_find_result
argument_list|(
operator|*
name|wif
argument_list|,
name|ssid
argument_list|,
name|bssid
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_scan_result
modifier|*
name|wlan_get_next_scanr
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|uint8_t
name|ssid
index|[
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|uint8_t
name|bssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
name|sr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|scanlist
argument_list|)
expr_stmt|;
if|if
condition|(
name|sr
operator|!=
name|NULL
condition|)
return|return
operator|(
name|sr
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_scanr_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|ssid
argument_list|,
name|bssid
argument_list|)
operator|<
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
name|sr
operator|=
name|wlan_scan_find_result
argument_list|(
operator|*
name|wif
argument_list|,
name|ssid
argument_list|,
name|bssid
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|sr
operator|=
name|SLIST_NEXT
argument_list|(
name|sr
argument_list|,
name|wsr
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
return|return
operator|(
name|sr
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
name|sr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|scanlist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
break|break;
return|return
operator|(
name|sr
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * MAC Access Control.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_mac_free_maclist
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
decl_stmt|;
while|while
condition|(
operator|(
name|wmm
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|SLIST_REMOVE_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|,
name|wm
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wmm
argument_list|)
expr_stmt|;
block|}
name|SLIST_INIT
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_mac_find_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|wmm
argument_list|,
argument|&wif->mac_maclist
argument_list|,
argument|wm
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|wmm
operator|->
name|mac
argument_list|,
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|wmm
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_mac_new_mac
parameter_list|(
specifier|const
name|uint8_t
modifier|*
name|mac
parameter_list|)
block|{
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
decl_stmt|;
if|if
condition|(
operator|(
name|wmm
operator|=
operator|(
expr|struct
name|wlan_mac_mac
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|wmm
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wmm
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|wmm
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wmm
operator|->
name|mac
argument_list|,
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|wmm
operator|->
name|mac_status
operator|=
name|RowStatus_notReady
expr_stmt|;
return|return
operator|(
name|wmm
operator|)
return|;
block|}
end_function

begin_function
name|void
name|wlan_mac_free_mac
parameter_list|(
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
parameter_list|)
block|{
name|free
argument_list|(
name|wmm
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|wlan_mac_add_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
parameter_list|)
block|{
name|struct
name|wlan_mac_mac
modifier|*
name|temp
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->mac_maclist
argument_list|,
argument|wm
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|temp
operator|->
name|mac
argument_list|,
name|wmm
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|prev
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|memcmp
argument_list|(
name|wmm
operator|->
name|mac
argument_list|,
name|prev
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
block|{
name|SLIST_INSERT_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|,
name|wmm
argument_list|,
name|wm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->mac_maclist
argument_list|,
argument|wm
argument_list|)
block|{
if|if
condition|(
name|memcmp
argument_list|(
name|wmm
operator|->
name|mac
argument_list|,
name|temp
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
break|break;
name|prev
operator|=
name|temp
expr_stmt|;
block|}
name|SLIST_INSERT_AFTER
argument_list|(
name|prev
argument_list|,
name|wmm
argument_list|,
name|wm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_mac_delete_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
parameter_list|)
block|{
if|if
condition|(
name|wmm
operator|->
name|mac_status
operator|==
name|RowStatus_active
operator|&&
name|wlan_del_mac_acl_mac
argument_list|(
name|wif
argument_list|,
name|wmm
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SLIST_REMOVE
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|,
name|wmm
argument_list|,
name|wlan_mac_mac
argument_list|,
name|wm
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wmm
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_mac_update_aclmacs
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
decl_stmt|,
modifier|*
name|twmm
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_maclist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
if|if
condition|(
name|wif
operator|->
name|status
operator|!=
name|RowStatus_active
condition|)
continue|continue;
comment|/* 		 * Nuke old entries - XXX - they are likely not to 		 * change often - reconsider. 		 */
name|SLIST_FOREACH_SAFE
argument_list|(
argument|wmm
argument_list|,
argument|&wif->mac_maclist
argument_list|,
argument|wm
argument_list|,
argument|twmm
argument_list|)
if|if
condition|(
name|wmm
operator|->
name|mac_status
operator|==
name|RowStatus_active
condition|)
block|{
name|SLIST_REMOVE
argument_list|(
operator|&
name|wif
operator|->
name|mac_maclist
argument_list|,
name|wmm
argument_list|,
name|wlan_mac_mac
argument_list|,
name|wm
argument_list|)
expr_stmt|;
name|wlan_mac_free_mac
argument_list|(
name|wmm
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|wlan_get_mac_acl_macs
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_maclist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_get_acl_mac
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|mac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_mac_find_mac
argument_list|(
operator|*
name|wif
argument_list|,
name|mac
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mac_mac
modifier|*
name|wlan_get_next_acl_mac
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_mac_mac
modifier|*
name|wmm
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
name|wmm
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|mac_maclist
argument_list|)
expr_stmt|;
if|if
condition|(
name|wmm
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wmm
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|mac
argument_list|)
operator|<
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
name|wmm
operator|=
name|wlan_mac_find_mac
argument_list|(
operator|*
name|wif
argument_list|,
name|mac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|wmm
operator|=
name|SLIST_NEXT
argument_list|(
name|wmm
argument_list|,
name|wm
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wmm
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
name|wmm
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|mac_maclist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
break|break;
return|return
operator|(
name|wmm
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_acl_mac_set_status
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|uint8_t
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|struct
name|wlan_mac_mac
modifier|*
name|macl
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|mac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|macl
operator|=
name|wlan_get_acl_mac
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|val
operator|->
name|v
operator|.
name|integer
condition|)
block|{
case|case
name|RowStatus_createAndGo
case|:
if|if
condition|(
name|macl
operator|!=
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_NAME
operator|)
return|;
break|break;
case|case
name|RowStatus_destroy
case|:
if|if
condition|(
name|macl
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|RowStatus_active
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
if|if
condition|(
name|wif
operator|==
name|NULL
operator|||
operator|!
name|wif
operator|->
name|macsupported
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
if|if
condition|(
operator|(
name|macl
operator|=
name|wlan_mac_new_mac
argument_list|(
operator|(
specifier|const
name|uint8_t
operator|*
operator|)
name|mac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|RowStatus_destroy
expr_stmt|;
if|if
condition|(
name|wlan_mac_add_mac
argument_list|(
name|wif
argument_list|,
name|macl
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wlan_mac_free_mac
argument_list|(
name|macl
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|RowStatus_destroy
expr_stmt|;
if|if
condition|(
name|wlan_add_mac_acl_mac
argument_list|(
name|wif
argument_list|,
name|macl
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|wlan_mac_delete_mac
argument_list|(
name|wif
argument_list|,
name|macl
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Wireless interfaces operating as mesh points.  */
end_comment

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_first_interface
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|wif
argument_list|,
argument|&wlan_ifaces
argument_list|,
argument|w_if
argument_list|)
if|if
condition|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
operator|&&
name|wif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
break|break;
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_next_interface
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|nwif
decl_stmt|;
while|while
condition|(
operator|(
name|nwif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|nwif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
operator|&&
name|nwif
operator|->
name|status
operator|==
name|RowStatus_active
condition|)
break|break;
name|wif
operator|=
name|nwif
expr_stmt|;
block|}
return|return
operator|(
name|nwif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_get_iface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_get_interface
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wif
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_iface
modifier|*
name|wlan_mesh_get_next_iface
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|;
name|uint8_t
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
return|return
operator|(
name|wlan_mesh_first_interface
argument_list|()
operator|)
return|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|!=
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|+
literal|1
operator|||
name|oid
operator|->
name|subs
index|[
name|sub
index|]
operator|>=
name|IFNAMSIZ
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wname
argument_list|,
literal|0
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|oid
operator|->
name|subs
index|[
name|sub
index|]
condition|;
name|i
operator|++
control|)
name|wname
index|[
name|i
index|]
operator|=
name|oid
operator|->
name|subs
index|[
name|sub
operator|+
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|wname
index|[
name|i
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_mesh_next_interface
argument_list|(
name|wif
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * The neighbors of wireless interfaces operating as mesh points.  */
end_comment

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_mesh_get_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|uint8_t
name|pmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|pmac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
operator|*
name|wif
operator|)
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_find_peer
argument_list|(
operator|*
name|wif
argument_list|,
name|pmac
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_mesh_get_next_peer
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|pmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_mesh_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_mesh_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
name|wip
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|peerlist
argument_list|)
expr_stmt|;
if|if
condition|(
name|wip
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wip
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|pmac
argument_list|)
operator|<
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
operator|*
name|wif
operator|)
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
operator|||
operator|(
name|wip
operator|=
name|wlan_find_peer
argument_list|(
operator|*
name|wif
argument_list|,
name|pmac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|wip
operator|=
name|SLIST_NEXT
argument_list|(
name|wip
argument_list|,
name|wp
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wip
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_mesh_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
name|wip
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|peerlist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
break|break;
return|return
operator|(
name|wip
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Mesh routing table.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_mesh_free_routes
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
while|while
condition|(
operator|(
name|wmr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|SLIST_REMOVE_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|,
name|wr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
block|}
name|SLIST_INIT
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_find_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
modifier|*
name|dstmac
parameter_list|)
block|{
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
if|if
condition|(
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|SLIST_FOREACH
argument_list|(
argument|wmr
argument_list|,
argument|&wif->mesh_routelist
argument_list|,
argument|wr
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|dstmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
break|break;
return|return
operator|(
name|wmr
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_new_route
parameter_list|(
specifier|const
name|uint8_t
modifier|*
name|dstmac
parameter_list|)
block|{
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
if|if
condition|(
operator|(
name|wmr
operator|=
operator|(
expr|struct
name|wlan_mesh_route
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|wmr
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|memset
argument_list|(
name|wmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|wmr
argument_list|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|dstmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|wmr
operator|->
name|mroute_status
operator|=
name|RowStatus_notReady
expr_stmt|;
return|return
operator|(
name|wmr
operator|)
return|;
block|}
end_function

begin_function
name|void
name|wlan_mesh_free_route
parameter_list|(
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
parameter_list|)
block|{
name|free
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_add_rtentry
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
parameter_list|)
block|{
name|struct
name|wlan_mesh_route
modifier|*
name|temp
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->mesh_routelist
argument_list|,
argument|wr
argument_list|)
if|if
condition|(
name|memcmp
argument_list|(
name|temp
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
operator|(
name|prev
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|)
operator|)
operator|==
name|NULL
operator|||
name|memcmp
argument_list|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|prev
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
block|{
name|SLIST_INSERT_HEAD
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|,
name|wmr
argument_list|,
name|wr
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|SLIST_FOREACH
argument_list|(
argument|temp
argument_list|,
argument|&wif->mesh_routelist
argument_list|,
argument|wr
argument_list|)
block|{
if|if
condition|(
name|memcmp
argument_list|(
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|temp
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|<
literal|0
condition|)
break|break;
name|prev
operator|=
name|temp
expr_stmt|;
block|}
name|SLIST_INSERT_AFTER
argument_list|(
name|prev
argument_list|,
name|wmr
argument_list|,
name|wr
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_mesh_delete_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
parameter_list|)
block|{
if|if
condition|(
name|wmr
operator|->
name|mroute_status
operator|==
name|RowStatus_active
operator|&&
name|wlan_mesh_del_route
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|SLIST_REMOVE
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|,
name|wmr
argument_list|,
name|wlan_mesh_route
argument_list|,
name|wr
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|wlan_mesh_update_routes
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|,
modifier|*
name|twmr
decl_stmt|;
if|if
condition|(
operator|(
name|time
argument_list|(
name|NULL
argument_list|)
operator|-
name|wlan_mrlist_age
operator|)
operator|<=
name|WLAN_LIST_MAXAGE
condition|)
return|return;
for|for
control|(
name|wif
operator|=
name|wlan_mesh_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_mesh_next_interface
argument_list|(
name|wif
argument_list|)
control|)
block|{
comment|/* 		 * Nuke old entries - XXX - they are likely not to 		 * change often - reconsider. 		 */
name|SLIST_FOREACH_SAFE
argument_list|(
argument|wmr
argument_list|,
argument|&wif->mesh_routelist
argument_list|,
argument|wr
argument_list|,
argument|twmr
argument_list|)
if|if
condition|(
name|wmr
operator|->
name|mroute_status
operator|==
name|RowStatus_active
condition|)
block|{
name|SLIST_REMOVE
argument_list|(
operator|&
name|wif
operator|->
name|mesh_routelist
argument_list|,
name|wmr
argument_list|,
name|wlan_mesh_route
argument_list|,
name|wr
argument_list|)
expr_stmt|;
name|wlan_mesh_free_route
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|wlan_mesh_get_routelist
argument_list|(
name|wif
argument_list|)
expr_stmt|;
block|}
name|wlan_mrlist_age
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_get_route
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|dstmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|dstmac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|wlan_mesh_find_route
argument_list|(
operator|*
name|wif
argument_list|,
name|dstmac
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_mesh_route
modifier|*
name|wlan_mesh_get_next_route
parameter_list|(
specifier|const
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|,
name|uint
name|sub
parameter_list|,
name|struct
name|wlan_iface
modifier|*
modifier|*
name|wif
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|dstmac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
if|if
condition|(
name|oid
operator|->
name|len
operator|-
name|sub
operator|==
literal|0
condition|)
block|{
for|for
control|(
operator|*
name|wif
operator|=
name|wlan_mesh_first_interface
argument_list|()
init|;
operator|*
name|wif
operator|!=
name|NULL
condition|;
operator|*
name|wif
operator|=
name|wlan_mesh_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
control|)
block|{
name|wmr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|mesh_routelist
argument_list|)
expr_stmt|;
if|if
condition|(
name|wmr
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wmr
operator|)
return|;
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
name|oid
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|dstmac
argument_list|)
operator|<
literal|0
operator|||
operator|(
operator|*
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
operator|||
operator|(
name|wmr
operator|=
name|wlan_mesh_find_route
argument_list|(
operator|*
name|wif
argument_list|,
name|dstmac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
operator|(
name|wmr
operator|=
name|SLIST_NEXT
argument_list|(
name|wmr
argument_list|,
name|wr
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
return|return
operator|(
name|wmr
operator|)
return|;
while|while
condition|(
operator|(
operator|*
name|wif
operator|=
name|wlan_mesh_next_interface
argument_list|(
operator|*
name|wif
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
if|if
condition|(
operator|(
name|wmr
operator|=
name|SLIST_FIRST
argument_list|(
operator|&
operator|(
operator|*
name|wif
operator|)
operator|->
name|mesh_routelist
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
break|break;
return|return
operator|(
name|wmr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_mesh_route_set_status
parameter_list|(
name|struct
name|snmp_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|val
parameter_list|,
name|uint
name|sub
parameter_list|)
block|{
name|char
name|wname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|char
name|mac
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
if|if
condition|(
name|wlan_mac_index_decode
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
name|wname
argument_list|,
name|mac
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
name|wmr
operator|=
name|wlan_mesh_get_route
argument_list|(
operator|&
name|val
operator|->
name|var
argument_list|,
name|sub
argument_list|,
operator|&
name|wif
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|val
operator|->
name|v
operator|.
name|integer
condition|)
block|{
case|case
name|RowStatus_createAndGo
case|:
if|if
condition|(
name|wmr
operator|!=
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_NAME
operator|)
return|;
break|break;
case|case
name|RowStatus_destroy
case|:
if|if
condition|(
name|wmr
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_NOSUCHNAME
operator|)
return|;
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|RowStatus_active
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|wif
operator|=
name|wlan_find_interface
argument_list|(
name|wname
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_NAME
operator|)
return|;
if|if
condition|(
operator|(
name|wmr
operator|=
name|wlan_mesh_new_route
argument_list|(
name|mac
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
if|if
condition|(
name|wlan_mesh_add_rtentry
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wlan_mesh_free_route
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
name|ctx
operator|->
name|scratch
operator|->
name|int1
operator|=
name|RowStatus_destroy
expr_stmt|;
if|if
condition|(
name|wlan_mesh_add_route
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|wlan_mesh_delete_route
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Wlan snmp module initialization hook.  * Returns 0 on success,< 0 on error.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_init
parameter_list|(
name|struct
name|lmodule
modifier|*
name|mod
name|__unused
parameter_list|,
name|int
name|argc
name|__unused
parameter_list|,
name|char
modifier|*
name|argv
index|[]
name|__unused
parameter_list|)
block|{
if|if
condition|(
name|wlan_kmodules_load
argument_list|()
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_ioctl_init
argument_list|()
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* Register for new interface creation notifications. */
if|if
condition|(
name|mib_register_newif
argument_list|(
name|wlan_attach_newif
argument_list|,
name|wlan_module
argument_list|)
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"Cannot register newif function: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Wlan snmp module finalization hook.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_fini
parameter_list|(
name|void
parameter_list|)
block|{
name|mib_unregister_newif
argument_list|(
name|wlan_module
argument_list|)
expr_stmt|;
name|or_unregister
argument_list|(
name|reg_wlan
argument_list|)
expr_stmt|;
comment|/* XXX: Cleanup! */
name|wlan_free_iflist
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Refetch all available data from the kernel.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_update_data
parameter_list|(
name|void
modifier|*
name|arg
name|__unused
parameter_list|)
block|{ }
end_function

begin_comment
comment|/*  * Wlan snmp module start operation.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_start
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|mibif
modifier|*
name|ifp
decl_stmt|;
name|reg_wlan
operator|=
name|or_register
argument_list|(
operator|&
name|oid_wlan
argument_list|,
literal|"The MIB module for managing wireless networking."
argument_list|,
name|wlan_module
argument_list|)
expr_stmt|;
comment|/* Add the existing wlan interfaces. */
for|for
control|(
name|ifp
operator|=
name|mib_first_if
argument_list|()
init|;
name|ifp
operator|!=
name|NULL
condition|;
name|ifp
operator|=
name|mib_next_if
argument_list|(
name|ifp
argument_list|)
control|)
name|wlan_attach_newif
argument_list|(
name|ifp
argument_list|)
expr_stmt|;
name|wlan_data_timer
operator|=
name|timer_start_repeat
argument_list|(
name|wlan_poll_ticks
argument_list|,
name|wlan_poll_ticks
argument_list|,
name|wlan_update_data
argument_list|,
name|NULL
argument_list|,
name|wlan_module
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Dump the Wlan snmp module data on SIGUSR1.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_dump
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* XXX: Print some debug info to syslog. */
name|struct
name|wlan_iface
modifier|*
name|wif
decl_stmt|;
for|for
control|(
name|wif
operator|=
name|wlan_first_interface
argument_list|()
init|;
name|wif
operator|!=
name|NULL
condition|;
name|wif
operator|=
name|wlan_next_interface
argument_list|(
name|wif
argument_list|)
control|)
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"wlan iface %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|const
name|char
name|wlan_comment
index|[]
init|= \
literal|"This module implements the BEGEMOT MIB for wireless networking."
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|struct
name|snmp_module
name|config
init|=
block|{
operator|.
name|comment
operator|=
name|wlan_comment
block|,
operator|.
name|init
operator|=
name|wlan_init
block|,
operator|.
name|fini
operator|=
name|wlan_fini
block|,
operator|.
name|start
operator|=
name|wlan_start
block|,
operator|.
name|tree
operator|=
name|wlan_ctree
block|,
operator|.
name|dump
operator|=
name|wlan_dump
block|,
operator|.
name|tree_size
operator|=
name|wlan_CTREE_SIZE
block|, }
decl_stmt|;
end_decl_stmt

end_unit

