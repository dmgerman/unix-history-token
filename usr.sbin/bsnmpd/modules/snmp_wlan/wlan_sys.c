begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2010 The FreeBSD Foundation  * All rights reserved.   * This software was developed by Shteryana Sotirova Shopova under  * sponsorship from the FreeBSD Foundation.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/module.h>
end_include

begin_include
include|#
directive|include
file|<sys/linker.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/sysctl.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_dl.h>
end_include

begin_include
include|#
directive|include
file|<net/if_media.h>
end_include

begin_include
include|#
directive|include
file|<net/if_mib.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<net80211/ieee80211_regdomain.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<ifaddrs.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/snmpmod.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/snmp_mibII.h>
end_include

begin_include
include|#
directive|include
file|"wlan_tree.h"
end_include

begin_include
include|#
directive|include
file|"wlan_snmp.h"
end_include

begin_decl_stmt
specifier|static
name|int
name|sock
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|int
name|wlan_ioctl
parameter_list|(
name|char
modifier|*
parameter_list|,
name|uint16_t
parameter_list|,
name|int
modifier|*
parameter_list|,
name|void
modifier|*
parameter_list|,
name|size_t
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_kmod_load
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_drivercaps_to_snmp
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_cryptocaps_to_snmp
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_htcaps_to_snmp
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_peerstate_to_snmp
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_peercaps_to_snmp
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_channel_flags_to_snmp_phy
parameter_list|(
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_regdomain_to_snmp
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|uint32_t
name|wlan_snmp_to_scan_flags
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_snmp2ioctl
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_snmp_to_regdomain
parameter_list|(
name|enum
name|WlanRegDomainCode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_get_country
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_set_country
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_get_dchannel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_set_dchannel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint32_t
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_get_bssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_set_bssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|wlan_config_set_snmp_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_snmp2value
parameter_list|(
name|int
parameter_list|,
name|int
parameter_list|,
name|int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_check
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_get_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_config_set_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_add_new_scan_result
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
specifier|const
name|struct
name|ieee80211req_scan_result
modifier|*
parameter_list|,
name|uint8_t
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|wlan_add_mac_macinfo
parameter_list|(
name|struct
name|wlan_iface
modifier|*
parameter_list|,
specifier|const
name|struct
name|ieee80211req_maclist
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_add_peerinfo
parameter_list|(
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|int
name|wlan_ioctl_init
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
operator|(
name|sock
operator|=
name|socket
argument_list|(
name|PF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"cannot open socket : %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Load the needed modules in kernel if not already there.  */
end_comment

begin_enum
enum|enum
name|wlan_kmodules
block|{
name|WLAN_KMOD
init|=
literal|0
block|,
name|WLAN_KMOD_ACL
block|,
name|WLAN_KMOD_WEP
block|,
name|WLAN_KMODS_MAX
block|}
enum|;
end_enum

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|wmod_names
index|[]
init|=
block|{
literal|"wlan"
block|,
literal|"wlan_wlan_acl"
block|,
literal|"wlan_wep"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|wlan_kmod_load
parameter_list|(
specifier|const
name|char
modifier|*
name|modname
parameter_list|)
block|{
name|int
name|fileid
decl_stmt|,
name|modid
decl_stmt|;
name|struct
name|module_stat
name|mstat
decl_stmt|;
name|mstat
operator|.
name|version
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|module_stat
argument_list|)
expr_stmt|;
for|for
control|(
name|fileid
operator|=
name|kldnext
argument_list|(
literal|0
argument_list|)
init|;
name|fileid
operator|>
literal|0
condition|;
name|fileid
operator|=
name|kldnext
argument_list|(
name|fileid
argument_list|)
control|)
block|{
for|for
control|(
name|modid
operator|=
name|kldfirstmod
argument_list|(
name|fileid
argument_list|)
init|;
name|modid
operator|>
literal|0
condition|;
name|modid
operator|=
name|modfnext
argument_list|(
name|modid
argument_list|)
control|)
block|{
if|if
condition|(
name|modstat
argument_list|(
name|modid
argument_list|,
operator|&
name|mstat
argument_list|)
operator|<
literal|0
condition|)
continue|continue;
if|if
condition|(
name|strcmp
argument_list|(
name|modname
argument_list|,
name|mstat
operator|.
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
comment|/* Not present - load it. */
if|if
condition|(
name|kldload
argument_list|(
name|modname
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"failed to load %s kernel module - %s"
argument_list|,
name|modname
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_kmodules_load
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|wlan_kmod_load
argument_list|(
name|wmod_names
index|[
name|WLAN_KMOD
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_kmod_load
argument_list|(
name|wmod_names
index|[
name|WLAN_KMOD_ACL
index|]
argument_list|)
operator|>
literal|0
condition|)
name|syslog
argument_list|(
name|LOG_NOTICE
argument_list|,
literal|"SNMP wlan loaded %s module"
argument_list|,
name|wmod_names
index|[
name|WLAN_KMOD_ACL
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_kmod_load
argument_list|(
name|wmod_names
index|[
name|WLAN_KMOD_WEP
index|]
argument_list|)
operator|>
literal|0
condition|)
name|syslog
argument_list|(
name|LOG_NOTICE
argument_list|,
literal|"SNMP wlan loaded %s module"
argument_list|,
name|wmod_names
index|[
name|WLAN_KMOD_WEP
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* XXX: FIXME */
end_comment

begin_function
specifier|static
name|int
name|wlan_ioctl
parameter_list|(
name|char
modifier|*
name|wif_name
parameter_list|,
name|uint16_t
name|req_type
parameter_list|,
name|int
modifier|*
name|val
parameter_list|,
name|void
modifier|*
name|arg
parameter_list|,
name|size_t
modifier|*
name|argsize
parameter_list|,
name|int
name|set
parameter_list|)
block|{
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|wif_name
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|req_type
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
operator|*
name|val
expr_stmt|;
name|ireq
operator|.
name|i_len
operator|=
operator|*
name|argsize
expr_stmt|;
name|ireq
operator|.
name|i_data
operator|=
name|arg
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|set
condition|?
name|SIOCS80211
else|:
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"iface %s - %s param: ioctl(%d) "
literal|"failed: %s"
argument_list|,
name|wif_name
argument_list|,
name|set
condition|?
literal|"set"
else|:
literal|"get"
argument_list|,
name|req_type
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
operator|*
name|argsize
operator|=
name|ireq
operator|.
name|i_len
expr_stmt|;
operator|*
name|val
operator|=
name|ireq
operator|.
name|i_val
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_check_media
parameter_list|(
name|char
modifier|*
name|ifname
parameter_list|)
block|{
name|struct
name|ifmediareq
name|ifmr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ifmediareq
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|,
name|ifname
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCGIFMEDIA
argument_list|,
operator|&
name|ifmr
argument_list|)
operator|<
literal|0
operator|||
name|ifmr
operator|.
name|ifm_count
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
comment|/* Interface doesn't support SIOCGIFMEDIA. */
if|if
condition|(
operator|(
name|ifmr
operator|.
name|ifm_status
operator|&
name|IFM_AVALID
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
return|return
operator|(
name|IFM_TYPE
argument_list|(
name|ifmr
operator|.
name|ifm_active
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_opmode
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|ifmediareq
name|ifmr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifmr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ifmediareq
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
sizeof|sizeof
argument_list|(
name|ifmr
operator|.
name|ifm_name
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCGIFMEDIA
argument_list|,
operator|&
name|ifmr
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|==
name|ENXIO
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_station
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_ADHOC
condition|)
block|{
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_FLAG0
condition|)
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_adhocDemo
expr_stmt|;
else|else
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_ibss
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_HOSTAP
condition|)
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_hostAp
expr_stmt|;
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_MONITOR
condition|)
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_monitor
expr_stmt|;
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_MBSS
condition|)
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_meshPoint
expr_stmt|;
elseif|else
if|if
condition|(
name|ifmr
operator|.
name|ifm_current
operator|&
name|IFM_IEEE80211_WDS
condition|)
name|wif
operator|->
name|mode
operator|=
name|WlanIfaceOperatingModeType_wds
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_config_state
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
name|set
parameter_list|)
block|{
name|int
name|flags
decl_stmt|;
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
argument_list|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCGIFFLAGS
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"set %s status: ioctl(SIOCGIFFLAGS) "
literal|"failed: %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|set
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|ifr
operator|.
name|ifr_flags
operator|&
name|IFF_UP
operator|)
operator|!=
literal|0
condition|)
name|wif
operator|->
name|state
operator|=
name|wlanIfaceState_up
expr_stmt|;
else|else
name|wif
operator|->
name|state
operator|=
name|wlanIfaceState_down
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|flags
operator|=
operator|(
name|ifr
operator|.
name|ifr_flags
operator|&
literal|0xffff
operator|)
operator||
operator|(
name|ifr
operator|.
name|ifr_flagshigh
operator|<<
literal|16
operator|)
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|state
operator|==
name|wlanIfaceState_up
condition|)
name|flags
operator||=
name|IFF_UP
expr_stmt|;
else|else
name|flags
operator|&=
operator|~
name|IFF_UP
expr_stmt|;
name|ifr
operator|.
name|ifr_flags
operator|=
name|flags
operator|&
literal|0xffff
expr_stmt|;
name|ifr
operator|.
name|ifr_flagshigh
operator|=
name|flags
operator|>>
literal|16
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCSIFFLAGS
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"set %s %s: ioctl(SIOCSIFFLAGS) failed: %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|wif
operator|->
name|state
operator|==
name|wlanIfaceState_up
condition|?
literal|"up"
else|:
literal|"down"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_local_addr
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|len
decl_stmt|;
name|char
name|ifname
index|[
name|IFNAMSIZ
index|]
decl_stmt|;
name|struct
name|ifaddrs
modifier|*
name|ifap
decl_stmt|,
modifier|*
name|ifa
decl_stmt|;
name|struct
name|sockaddr_dl
name|sdl
decl_stmt|;
if|if
condition|(
name|getifaddrs
argument_list|(
operator|&
name|ifap
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"wlan get mac: getifaddrs() failed - %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
for|for
control|(
name|ifa
operator|=
name|ifap
init|;
name|ifa
operator|!=
name|NULL
condition|;
name|ifa
operator|=
name|ifa
operator|->
name|ifa_next
control|)
block|{
if|if
condition|(
name|ifa
operator|->
name|ifa_addr
operator|->
name|sa_family
operator|!=
name|AF_LINK
condition|)
continue|continue;
name|memcpy
argument_list|(
operator|&
name|sdl
argument_list|,
name|ifa
operator|->
name|ifa_addr
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|sockaddr_dl
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|sdl
operator|.
name|sdl_alen
operator|>
name|IEEE80211_ADDR_LEN
condition|)
continue|continue;
if|if
condition|(
operator|(
name|len
operator|=
name|sdl
operator|.
name|sdl_nlen
operator|)
operator|>=
name|IFNAMSIZ
condition|)
name|len
operator|=
name|IFNAMSIZ
operator|-
literal|1
expr_stmt|;
name|memcpy
argument_list|(
name|ifname
argument_list|,
name|sdl
operator|.
name|sdl_data
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|ifname
index|[
name|len
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|ifname
argument_list|)
operator|==
literal|0
condition|)
break|break;
block|}
name|freeifaddrs
argument_list|(
name|ifap
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_parent
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
name|__unused
parameter_list|)
block|{
comment|/* XXX: There's no way to fetch this from the kernel. */
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* XXX */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_STA
value|0x00000001
end_define

begin_comment
comment|/* CAPABILITY: STA available */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_8023ENCAP
value|0x00000002
end_define

begin_comment
comment|/* CAPABILITY: 802.3 encap */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_FF
value|0x00000040
end_define

begin_comment
comment|/* CAPABILITY: ATH FF avail */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_TURBOP
value|0x00000080
end_define

begin_comment
comment|/* CAPABILITY: ATH Turbo avail*/
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_IBSS
value|0x00000100
end_define

begin_comment
comment|/* CAPABILITY: IBSS available */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_PMGT
value|0x00000200
end_define

begin_comment
comment|/* CAPABILITY: Power mgmt */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_HOSTAP
value|0x00000400
end_define

begin_comment
comment|/* CAPABILITY: HOSTAP avail */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_AHDEMO
value|0x00000800
end_define

begin_comment
comment|/* CAPABILITY: Old Adhoc Demo */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_SWRETRY
value|0x00001000
end_define

begin_comment
comment|/* CAPABILITY: sw tx retry */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_TXPMGT
value|0x00002000
end_define

begin_comment
comment|/* CAPABILITY: tx power mgmt */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_SHSLOT
value|0x00004000
end_define

begin_comment
comment|/* CAPABILITY: short slottime */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_SHPREAMBLE
value|0x00008000
end_define

begin_comment
comment|/* CAPABILITY: short preamble */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_MONITOR
value|0x00010000
end_define

begin_comment
comment|/* CAPABILITY: monitor mode */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_DFS
value|0x00020000
end_define

begin_comment
comment|/* CAPABILITY: DFS/radar avail*/
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_MBSS
value|0x00040000
end_define

begin_comment
comment|/* CAPABILITY: MBSS available */
end_comment

begin_comment
comment|/* 0x7c0000 available */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_WPA1
value|0x00800000
end_define

begin_comment
comment|/* CAPABILITY: WPA1 avail */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_WPA2
value|0x01000000
end_define

begin_comment
comment|/* CAPABILITY: WPA2 avail */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_WPA
value|0x01800000
end_define

begin_comment
comment|/* CAPABILITY: WPA1+WPA2 avail*/
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_BURST
value|0x02000000
end_define

begin_comment
comment|/* CAPABILITY: frame bursting */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_WME
value|0x04000000
end_define

begin_comment
comment|/* CAPABILITY: WME avail */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_WDS
value|0x08000000
end_define

begin_comment
comment|/* CAPABILITY: 4-addr support */
end_comment

begin_comment
comment|/* 0x10000000 reserved */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_BGSCAN
value|0x20000000
end_define

begin_comment
comment|/* CAPABILITY: bg scanning */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_TXFRAG
value|0x40000000
end_define

begin_comment
comment|/* CAPABILITY: tx fragments */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_C_TDMA
value|0x80000000
end_define

begin_comment
comment|/* CAPABILITY: TDMA avail */
end_comment

begin_function
specifier|static
name|uint32_t
name|wlan_drivercaps_to_snmp
parameter_list|(
name|uint32_t
name|dcaps
parameter_list|)
block|{
name|uint32_t
name|scaps
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_STA
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_station
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_8023ENCAP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_ieee8023encap
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_FF
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_athFastFrames
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_TURBOP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_athTurbo
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_IBSS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_ibss
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_PMGT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_pmgt
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_HOSTAP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_hostAp
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_AHDEMO
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_ahDemo
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_SWRETRY
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_swRetry
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_TXPMGT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_txPmgt
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_SHSLOT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_shortSlot
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_SHPREAMBLE
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_shortPreamble
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_MONITOR
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_monitor
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_DFS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_dfs
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_MBSS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_mbss
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_WPA1
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_wpa1
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_WPA2
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_wpa2
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_BURST
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_burst
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_WME
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_wme
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_WDS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_wds
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_BGSCAN
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_bgScan
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_TXFRAG
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_txFrag
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|dcaps
operator|&
name|IEEE80211_C_TDMA
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_tdma
operator|)
expr_stmt|;
return|return
operator|(
name|scaps
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint32_t
name|wlan_cryptocaps_to_snmp
parameter_list|(
name|uint32_t
name|ccaps
parameter_list|)
block|{
name|uint32_t
name|scaps
init|=
literal|0
decl_stmt|;
if|#
directive|if
name|NOT_YET
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_WEP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_wep
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_TKIP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_tkip
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_AES_OCB
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_aes
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_AES_CCM
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_aesCcm
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_TKIPMIC
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_tkipMic
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|ccaps
operator|&
name|IEEE80211_CRYPTO_CKIP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|wlanCryptoCaps_ckip
operator|)
expr_stmt|;
else|#
directive|else
comment|/* !NOT_YET */
name|scaps
operator|=
name|ccaps
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
name|scaps
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|IEEE80211_HTC_AMPDU
value|0x00010000
end_define

begin_comment
comment|/* CAPABILITY: A-MPDU tx */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_HTC_AMSDU
value|0x00020000
end_define

begin_comment
comment|/* CAPABILITY: A-MSDU tx */
end_comment

begin_comment
comment|/* NB: HT40 is implied by IEEE80211_HTCAP_CHWIDTH40 */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_HTC_HT
value|0x00040000
end_define

begin_comment
comment|/* CAPABILITY: HT operation */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_HTC_SMPS
value|0x00080000
end_define

begin_comment
comment|/* CAPABILITY: MIMO power save*/
end_comment

begin_define
define|#
directive|define
name|IEEE80211_HTC_RIFS
value|0x00100000
end_define

begin_comment
comment|/* CAPABILITY: RIFS support */
end_comment

begin_function
specifier|static
name|uint32_t
name|wlan_htcaps_to_snmp
parameter_list|(
name|uint32_t
name|hcaps
parameter_list|)
block|{
name|uint32_t
name|scaps
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_LDPC
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_ldpc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_CHWIDTH40
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_chwidth40
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_GREENFIELD
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_greenField
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_SHORTGI20
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_shortGi20
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_SHORTGI40
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_shortGi40
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_TXSTBC
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_txStbc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_DELBA
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_delba
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_MAXAMSDU_7935
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_amsdu7935
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_DSSSCCK40
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_dssscck40
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_PSMP
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_psmp
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_40INTOLERANT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_fortyMHzIntolerant
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTCAP_LSIGTXOPPROT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_lsigTxOpProt
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTC_AMPDU
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcAmpdu
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTC_AMSDU
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcAmsdu
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTC_HT
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcHt
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTC_SMPS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcSmps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|hcaps
operator|&
name|IEEE80211_HTC_RIFS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcRifs
operator|)
expr_stmt|;
return|return
operator|(
name|scaps
operator|)
return|;
block|}
end_function

begin_comment
comment|/* XXX: Not here? */
end_comment

begin_define
define|#
directive|define
name|WLAN_SET_TDMA_OPMODE
parameter_list|(
name|w
parameter_list|)
value|do {						\ 	if ((w)->mode == WlanIfaceOperatingModeType_adhocDemo&&		\ 	    ((w)->drivercaps& WlanDriverCaps_tdma) != 0)			\ 		(w)->mode = WlanIfaceOperatingModeType_tdma;			\ } while (0)
end_define

begin_function
name|int
name|wlan_get_driver_caps
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211_devcaps_req
name|dc
decl_stmt|;
name|memset
argument_list|(
operator|&
name|dc
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_devcaps_req
argument_list|)
argument_list|)
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_devcaps_req
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_DEVCAPS
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|dc
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|drivercaps
operator|=
name|wlan_drivercaps_to_snmp
argument_list|(
name|dc
operator|.
name|dc_drivercaps
argument_list|)
expr_stmt|;
name|wif
operator|->
name|cryptocaps
operator|=
name|wlan_cryptocaps_to_snmp
argument_list|(
name|dc
operator|.
name|dc_cryptocaps
argument_list|)
expr_stmt|;
name|wif
operator|->
name|htcaps
operator|=
name|wlan_htcaps_to_snmp
argument_list|(
name|dc
operator|.
name|dc_htcaps
argument_list|)
expr_stmt|;
name|WLAN_SET_TDMA_OPMODE
argument_list|(
name|wif
argument_list|)
expr_stmt|;
name|argsize
operator|=
name|dc
operator|.
name|dc_chaninfo
operator|.
name|ic_nchans
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_channel
argument_list|)
expr_stmt|;
name|wif
operator|->
name|chanlist
operator|=
operator|(
expr|struct
name|ieee80211_channel
operator|*
operator|)
name|malloc
argument_list|(
name|argsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|chanlist
operator|==
name|NULL
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|memcpy
argument_list|(
name|wif
operator|->
name|chanlist
argument_list|,
name|dc
operator|.
name|dc_chaninfo
operator|.
name|ic_chans
argument_list|,
name|argsize
argument_list|)
expr_stmt|;
name|wif
operator|->
name|nchannels
operator|=
name|dc
operator|.
name|dc_chaninfo
operator|.
name|ic_nchans
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|uint8_t
name|wlan_channel_state_to_snmp
parameter_list|(
name|uint8_t
name|cstate
parameter_list|)
block|{
name|uint8_t
name|cs
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|cstate
operator|&
name|IEEE80211_CHANSTATE_RADAR
operator|)
operator|!=
literal|0
condition|)
name|cs
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelStateType_radar
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cstate
operator|&
name|IEEE80211_CHANSTATE_CACDONE
operator|)
operator|!=
literal|0
condition|)
name|cs
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelStateType_cacDone
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cstate
operator|&
name|IEEE80211_CHANSTATE_CWINT
operator|)
operator|!=
literal|0
condition|)
name|cs
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelStateType_interferenceDetected
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cstate
operator|&
name|IEEE80211_CHANSTATE_NORADAR
operator|)
operator|!=
literal|0
condition|)
name|cs
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelStateType_radarClear
operator|)
expr_stmt|;
return|return
operator|(
name|cs
operator|)
return|;
block|}
end_function

begin_function
name|uint32_t
name|wlan_channel_flags_to_snmp
parameter_list|(
name|uint32_t
name|cflags
parameter_list|)
block|{
name|uint32_t
name|cf
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_TURBO
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_turbo
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_CCK
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_cck
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_OFDM
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_ofdm
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_2GHZ
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_spectrum2Ghz
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_5GHZ
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_spectrum5Ghz
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_PASSIVE
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_passiveScan
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_DYN
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_dynamicCckOfdm
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_GFSK
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_gfsk
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_GSM
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_spectrum900Mhz
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_STURBO
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_dot11aStaticTurbo
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_HALF
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_halfRate
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_QUARTER
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_quarterRate
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_HT20
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_ht20
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_HT40U
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_ht40u
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_HT40D
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_ht40d
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_DFS
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_dfs
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_4MSXMIT
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_xmit4ms
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_NOADHOC
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_noAdhoc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_NOHOSTAP
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_noHostAp
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_11D
operator|)
operator|!=
literal|0
condition|)
name|cf
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfaceChannelFlagsType_dot11d
operator|)
expr_stmt|;
return|return
operator|(
name|cf
operator|)
return|;
block|}
end_function

begin_comment
comment|/* XXX: */
end_comment

begin_define
define|#
directive|define
name|WLAN_SNMP_MAX_CHANS
value|256
end_define

begin_function
name|int
name|wlan_get_channel_list
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|uint32_t
name|i
decl_stmt|,
name|nchans
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211req_chaninfo
modifier|*
name|chaninfo
decl_stmt|;
name|struct
name|ieee80211req_chanlist
name|active
decl_stmt|;
specifier|const
name|struct
name|ieee80211_channel
modifier|*
name|c
decl_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_chaninfo
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_channel
argument_list|)
operator|*
name|WLAN_SNMP_MAX_CHANS
expr_stmt|;
name|chaninfo
operator|=
operator|(
expr|struct
name|ieee80211req_chaninfo
operator|*
operator|)
name|malloc
argument_list|(
name|argsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|chaninfo
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_CHANINFO
argument_list|,
operator|&
name|val
argument_list|,
name|chaninfo
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|active
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_CHANLIST
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|active
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|nchans
operator|=
literal|0
init|;
name|i
operator|<
name|chaninfo
operator|->
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
operator|&
name|chaninfo
operator|->
name|ic_chans
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|isset
argument_list|(
name|active
operator|.
name|ic_channels
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
condition|)
continue|continue;
name|nchans
operator|++
expr_stmt|;
block|}
name|wif
operator|->
name|chanlist
operator|=
operator|(
expr|struct
name|ieee80211_channel
operator|*
operator|)
name|reallocf
argument_list|(
name|wif
operator|->
name|chanlist
argument_list|,
name|nchans
operator|*
sizeof|sizeof
argument_list|(
operator|*
name|c
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|chanlist
operator|==
name|NULL
condition|)
goto|goto
name|error
goto|;
name|wif
operator|->
name|nchannels
operator|=
name|nchans
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|nchans
operator|=
literal|0
init|;
name|i
operator|<
name|chaninfo
operator|->
name|ic_nchans
condition|;
name|i
operator|++
control|)
block|{
name|c
operator|=
operator|&
name|chaninfo
operator|->
name|ic_chans
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|isset
argument_list|(
name|active
operator|.
name|ic_channels
argument_list|,
name|c
operator|->
name|ic_ieee
argument_list|)
condition|)
continue|continue;
name|memcpy
argument_list|(
name|wif
operator|->
name|chanlist
operator|+
name|nchans
argument_list|,
name|c
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|nchans
operator|++
expr_stmt|;
block|}
name|free
argument_list|(
name|chaninfo
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
name|error
label|:
name|wif
operator|->
name|nchannels
operator|=
literal|0
expr_stmt|;
name|free
argument_list|(
name|chaninfo
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|enum
name|WlanIfPhyMode
name|wlan_channel_flags_to_snmp_phy
parameter_list|(
name|uint32_t
name|cflags
parameter_list|)
block|{
comment|/* XXX: recheck */
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_A
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_dot11a
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_B
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_dot11b
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_G
operator|)
operator|!=
literal|0
operator|||
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_PUREG
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_dot11g
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_FHSS
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_fh
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_TURBO
operator|)
operator|!=
literal|0
operator|&&
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_A
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_turboA
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_TURBO
operator|)
operator|!=
literal|0
operator|&&
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_G
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_turboG
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_STURBO
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_sturboA
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_HALF
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_ofdmHalf
operator|)
return|;
if|if
condition|(
operator|(
name|cflags
operator|&
name|IEEE80211_CHAN_QUARTER
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|WlanIfPhyMode_ofdmQuarter
operator|)
return|;
return|return
operator|(
name|WlanIfPhyMode_auto
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_roam_params
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_roamparams_req
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_ROAM
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|wif
operator|->
name|roamparams
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_tx_params
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
comment|/* 	 * XXX: Reset IEEE80211_RATE_MCS bit on IEEE80211_MODE_11NA 	 * and IEEE80211_MODE_11NG modes. 	 */
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_txparams_req
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_TXPARAMS
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|wif
operator|->
name|txparams
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_tx_params
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int32_t
name|pmode
name|__unused
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
comment|/* 	 * XXX: Set IEEE80211_RATE_MCS bit on IEEE80211_MODE_11NA 	 * and IEEE80211_MODE_11NG modes. 	 */
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_txparams_req
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_TXPARAMS
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|wif
operator|->
name|txparams
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_clone_create
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|ieee80211_clone_params
name|wcp
decl_stmt|;
specifier|static
specifier|const
name|uint8_t
name|zerobssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|memset
argument_list|(
operator|&
name|wcp
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|wcp
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
operator|&
name|ifr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Sanity checks. */
if|if
condition|(
name|wif
operator|==
name|NULL
operator|||
name|wif
operator|->
name|pname
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|||
name|wif
operator|->
name|mode
operator|>
name|WLAN_IFMODE_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_wds
operator|&&
name|memcmp
argument_list|(
name|wif
operator|->
name|dbssid
argument_list|,
name|zerobssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|strlcpy
argument_list|(
name|wcp
operator|.
name|icp_parent
argument_list|,
name|wif
operator|->
name|pname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|wif
operator|->
name|flags
operator|&
name|WlanIfaceFlagsType_uniqueBssid
operator|)
operator|!=
literal|0
condition|)
name|wcp
operator|.
name|icp_flags
operator||=
name|IEEE80211_CLONE_BSSID
expr_stmt|;
if|if
condition|(
operator|(
name|wif
operator|->
name|flags
operator|&
name|WlanIfaceFlagsType_noBeacons
operator|)
operator|!=
literal|0
condition|)
name|wcp
operator|.
name|icp_flags
operator||=
name|IEEE80211_CLONE_NOBEACONS
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_wds
operator|&&
operator|(
name|wif
operator|->
name|flags
operator|&
name|WlanIfaceFlagsType_wdsLegacy
operator|)
operator|!=
literal|0
condition|)
name|wcp
operator|.
name|icp_flags
operator||=
name|IEEE80211_CLONE_WDSLEGACY
expr_stmt|;
switch|switch
condition|(
name|wif
operator|->
name|mode
condition|)
block|{
case|case
name|WlanIfaceOperatingModeType_ibss
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_IBSS
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_station
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_STA
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_wds
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_WDS
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_adhocDemo
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_AHDEMO
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_hostAp
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_HOSTAP
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_monitor
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_MONITOR
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_meshPoint
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_MBSS
expr_stmt|;
break|break;
case|case
name|WlanIfaceOperatingModeType_tdma
case|:
name|wcp
operator|.
name|icp_opmode
operator|=
name|IEEE80211_M_AHDEMO
expr_stmt|;
name|wcp
operator|.
name|icp_flags
operator||=
name|IEEE80211_CLONE_TDMA
expr_stmt|;
break|break;
block|}
name|memcpy
argument_list|(
name|wcp
operator|.
name|icp_bssid
argument_list|,
name|wif
operator|->
name|dbssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|wif
operator|->
name|dlmac
argument_list|,
name|zerobssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|memcpy
argument_list|(
name|wcp
operator|.
name|icp_macaddr
argument_list|,
name|wif
operator|->
name|dlmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|wcp
operator|.
name|icp_flags
operator||=
name|IEEE80211_CLONE_MACADDR
expr_stmt|;
block|}
name|strlcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|wcp
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCIFCREATE2
argument_list|,
operator|(
name|caddr_t
operator|)
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"wlan clone create: ioctl(SIOCIFCREATE2) "
literal|"failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_clone_destroy
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
if|if
condition|(
name|wif
operator|==
name|NULL
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
name|memset
argument_list|(
operator|&
name|ifr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
argument_list|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCIFDESTROY
argument_list|,
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"wlan clone destroy: ioctl(SIOCIFDESTROY) "
literal|"failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|SNMP_ERR_GENERR
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_snmp2ioctl
parameter_list|(
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanIfacePacketBurst
case|:
name|op
operator|=
name|IEEE80211_IOC_BURST
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceCountryCode
case|:
name|op
operator|=
name|IEEE80211_IOC_REGDOMAIN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRegDomain
case|:
name|op
operator|=
name|IEEE80211_IOC_REGDOMAIN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
name|op
operator|=
name|IEEE80211_IOC_SSID
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredChannel
case|:
name|op
operator|=
name|IEEE80211_IOC_CURCHAN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicFreqSelection
case|:
name|op
operator|=
name|IEEE80211_IOC_DFS
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFastFrames
case|:
name|op
operator|=
name|IEEE80211_IOC_FF
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDturbo
case|:
name|op
operator|=
name|IEEE80211_IOC_TURBOP
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTxPower
case|:
name|op
operator|=
name|IEEE80211_IOC_TXPOWER
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceFragmentThreshold
case|:
name|op
operator|=
name|IEEE80211_IOC_FRAGTHRESHOLD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRTSThreshold
case|:
name|op
operator|=
name|IEEE80211_IOC_RTSTHRESHOLD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceWlanPrivacySubscribe
case|:
name|op
operator|=
name|IEEE80211_IOC_WPS
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScan
case|:
name|op
operator|=
name|IEEE80211_IOC_BGSCAN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanIdle
case|:
name|op
operator|=
name|IEEE80211_IOC_BGSCAN_IDLE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBgScanInterval
case|:
name|op
operator|=
name|IEEE80211_IOC_BGSCAN_INTERVAL
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconMissedThreshold
case|:
name|op
operator|=
name|IEEE80211_IOC_BMISSTHRESHOLD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
name|op
operator|=
name|IEEE80211_IOC_BSSID
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceRoamingMode
case|:
name|op
operator|=
name|IEEE80211_IOC_ROAMING
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11d
case|:
name|op
operator|=
name|IEEE80211_IOC_DOTD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11h
case|:
name|op
operator|=
name|IEEE80211_IOC_DOTH
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDynamicWds
case|:
name|op
operator|=
name|IEEE80211_IOC_DWDS
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfacePowerSave
case|:
name|op
operator|=
name|IEEE80211_IOC_POWERSAVE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceApBridge
case|:
name|op
operator|=
name|IEEE80211_IOC_APBRIDGE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceBeaconInterval
case|:
name|op
operator|=
name|IEEE80211_IOC_BEACON_INTERVAL
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDtimPeriod
case|:
name|op
operator|=
name|IEEE80211_IOC_DTIM_PERIOD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceHideSsid
case|:
name|op
operator|=
name|IEEE80211_IOC_HIDESSID
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceInactivityProccess
case|:
name|op
operator|=
name|IEEE80211_IOC_INACTIVITY
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gProtMode
case|:
name|op
operator|=
name|IEEE80211_IOC_PROTMODE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11gPureMode
case|:
name|op
operator|=
name|IEEE80211_IOC_PUREG
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nPureMode
case|:
name|op
operator|=
name|IEEE80211_IOC_PUREN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpdu
case|:
name|op
operator|=
name|IEEE80211_IOC_AMPDU
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduDensity
case|:
name|op
operator|=
name|IEEE80211_IOC_AMPDU_DENSITY
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmpduLimit
case|:
name|op
operator|=
name|IEEE80211_IOC_AMPDU_LIMIT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsdu
case|:
name|op
operator|=
name|IEEE80211_IOC_AMSDU
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nAmsduLimit
case|:
name|op
operator|=
name|IEEE80211_IOC_AMSDU_LIMIT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHighThroughput
case|:
name|op
operator|=
name|IEEE80211_IOC_HTCONF
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTCompatible
case|:
name|op
operator|=
name|IEEE80211_IOC_HTCOMPAT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nHTProtMode
case|:
name|op
operator|=
name|IEEE80211_IOC_HTPROTMODE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nRIFS
case|:
name|op
operator|=
name|IEEE80211_IOC_RIFS
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nShortGI
case|:
name|op
operator|=
name|IEEE80211_IOC_SHORTGI
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceDot11nSMPSMode
case|:
name|op
operator|=
name|IEEE80211_IOC_SMPS
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlot
case|:
name|op
operator|=
name|IEEE80211_IOC_TDMA_SLOT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotCount
case|:
name|op
operator|=
name|IEEE80211_IOC_TDMA_SLOTCNT
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaSlotLength
case|:
name|op
operator|=
name|IEEE80211_IOC_TDMA_SLOTLEN
expr_stmt|;
break|break;
case|case
name|LEAF_wlanIfaceTdmaBeaconInterval
case|:
name|op
operator|=
name|IEEE80211_IOC_TDMA_BINTERVAL
expr_stmt|;
break|break;
default|default:
name|op
operator|=
operator|-
literal|1
expr_stmt|;
block|}
return|return
operator|(
name|op
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|enum
name|WlanRegDomainCode
name|wlan_regdomain_to_snmp
parameter_list|(
name|int
name|which
parameter_list|)
block|{
name|enum
name|WlanRegDomainCode
name|reg_domain
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|SKU_FCC
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_fcc
expr_stmt|;
break|break;
case|case
name|SKU_CA
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_ca
expr_stmt|;
break|break;
case|case
name|SKU_ETSI
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_etsi
expr_stmt|;
break|break;
case|case
name|SKU_ETSI2
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_etsi2
expr_stmt|;
break|break;
case|case
name|SKU_ETSI3
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_etsi3
expr_stmt|;
break|break;
case|case
name|SKU_FCC3
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_fcc3
expr_stmt|;
break|break;
case|case
name|SKU_JAPAN
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_japan
expr_stmt|;
break|break;
case|case
name|SKU_KOREA
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_korea
expr_stmt|;
break|break;
case|case
name|SKU_APAC
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_apac
expr_stmt|;
break|break;
case|case
name|SKU_APAC2
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_apac2
expr_stmt|;
break|break;
case|case
name|SKU_APAC3
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_apac3
expr_stmt|;
break|break;
case|case
name|SKU_ROW
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_row
expr_stmt|;
break|break;
case|case
name|SKU_NONE
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_none
expr_stmt|;
break|break;
case|case
name|SKU_DEBUG
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_debug
expr_stmt|;
break|break;
case|case
name|SKU_SR9
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_sr9
expr_stmt|;
break|break;
case|case
name|SKU_XR9
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_xr9
expr_stmt|;
break|break;
case|case
name|SKU_GZ901
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_gz901
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|reg_domain
operator|=
name|WlanRegDomainCode_none
expr_stmt|;
break|break;
default|default:
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"unknown regdomain (0x%x) "
argument_list|,
name|which
argument_list|)
expr_stmt|;
name|reg_domain
operator|=
name|WlanRegDomainCode_none
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|reg_domain
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_snmp_to_regdomain
parameter_list|(
name|enum
name|WlanRegDomainCode
name|regdomain
parameter_list|)
block|{
name|int
name|which
decl_stmt|;
switch|switch
condition|(
name|regdomain
condition|)
block|{
case|case
name|WlanRegDomainCode_fcc
case|:
name|which
operator|=
name|SKU_FCC
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_ca
case|:
name|which
operator|=
name|SKU_CA
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_etsi
case|:
name|which
operator|=
name|SKU_ETSI
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_etsi2
case|:
name|which
operator|=
name|SKU_ETSI2
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_etsi3
case|:
name|which
operator|=
name|SKU_ETSI3
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_fcc3
case|:
name|which
operator|=
name|SKU_FCC3
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_japan
case|:
name|which
operator|=
name|SKU_JAPAN
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_korea
case|:
name|which
operator|=
name|SKU_KOREA
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_apac
case|:
name|which
operator|=
name|SKU_APAC
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_apac2
case|:
name|which
operator|=
name|SKU_APAC2
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_apac3
case|:
name|which
operator|=
name|SKU_APAC3
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_row
case|:
name|which
operator|=
name|SKU_ROW
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_none
case|:
name|which
operator|=
name|SKU_NONE
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_debug
case|:
name|which
operator|=
name|SKU_DEBUG
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_sr9
case|:
name|which
operator|=
name|SKU_SR9
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_xr9
case|:
name|which
operator|=
name|SKU_XR9
expr_stmt|;
break|break;
case|case
name|WlanRegDomainCode_gz901
case|:
name|which
operator|=
name|SKU_GZ901
expr_stmt|;
break|break;
default|default:
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"unknown snmp regdomain (0x%x) "
argument_list|,
name|regdomain
argument_list|)
expr_stmt|;
name|which
operator|=
name|SKU_NONE
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|which
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_get_country
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211_regdomain
name|regdomain
decl_stmt|;
name|memset
argument_list|(
operator|&
name|regdomain
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|regdomain
argument_list|)
argument_list|)
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|regdomain
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_REGDOMAIN
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|regdomain
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|reg_domain
operator|=
name|wlan_regdomain_to_snmp
argument_list|(
name|regdomain
operator|.
name|regdomain
argument_list|)
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|0
index|]
operator|=
name|regdomain
operator|.
name|isocc
index|[
literal|0
index|]
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|1
index|]
operator|=
name|regdomain
operator|.
name|isocc
index|[
literal|1
index|]
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|2
index|]
operator|=
name|regdomain
operator|.
name|location
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_set_country
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|char
modifier|*
name|ccode
parameter_list|,
name|int
name|rdomain
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|,
name|txpowermax
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|struct
name|ieee80211_regdomain_req
modifier|*
name|regdomain
decl_stmt|;
if|if
condition|(
name|wlan_get_channel_list
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|nchannels
operator|==
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"iface %s - set regdomain failed"
argument_list|,
name|wif
operator|->
name|wname
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_TXPOWMAX
argument_list|,
operator|&
name|txpowermax
argument_list|,
literal|0
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|regdomain
operator|=
name|malloc
argument_list|(
name|IEEE80211_REGDOMAIN_SIZE
argument_list|(
name|wif
operator|->
name|nchannels
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|regdomain
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memset
argument_list|(
name|regdomain
argument_list|,
literal|0
argument_list|,
name|IEEE80211_REGDOMAIN_SIZE
argument_list|(
name|wif
operator|->
name|nchannels
argument_list|)
argument_list|)
expr_stmt|;
name|argsize
operator|=
name|IEEE80211_REGDOMAIN_SIZE
argument_list|(
name|wif
operator|->
name|nchannels
argument_list|)
expr_stmt|;
comment|/* XXX: recheck with how this is done by ifconfig(8) */
name|regdomain
operator|->
name|rd
operator|.
name|regdomain
operator|=
name|wlan_snmp_to_regdomain
argument_list|(
name|rdomain
argument_list|)
expr_stmt|;
name|regdomain
operator|->
name|rd
operator|.
name|isocc
index|[
literal|0
index|]
operator|=
name|ccode
index|[
literal|0
index|]
expr_stmt|;
name|regdomain
operator|->
name|rd
operator|.
name|isocc
index|[
literal|1
index|]
operator|=
name|ccode
index|[
literal|1
index|]
expr_stmt|;
name|regdomain
operator|->
name|rd
operator|.
name|location
operator|=
name|ccode
index|[
literal|2
index|]
expr_stmt|;
comment|/* XXX: fill the channel list properly */
name|regdomain
operator|->
name|chaninfo
operator|.
name|ic_nchans
operator|=
name|wif
operator|->
name|nchannels
expr_stmt|;
name|memcpy
argument_list|(
name|regdomain
operator|->
name|chaninfo
operator|.
name|ic_chans
argument_list|,
name|wif
operator|->
name|chanlist
argument_list|,
name|wif
operator|->
name|nchannels
operator|*
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_channel
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|wif
operator|->
name|nchannels
condition|;
name|i
operator|++
control|)
name|regdomain
operator|->
name|chaninfo
operator|.
name|ic_chans
index|[
name|i
index|]
operator|.
name|ic_maxregpower
operator|=
name|txpowermax
expr_stmt|;
name|wif
operator|->
name|state
operator|=
name|wlanIfaceState_down
expr_stmt|;
if|if
condition|(
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
operator|||
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_REGDOMAIN
argument_list|,
operator|&
name|val
argument_list|,
name|regdomain
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
block|{
name|free
argument_list|(
name|regdomain
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|wif
operator|->
name|state
operator|=
name|wlanIfaceState_up
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_config_state
argument_list|(
name|wif
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|wif
operator|->
name|reg_domain
operator|=
name|wlan_regdomain_to_snmp
argument_list|(
name|regdomain
operator|->
name|rd
operator|.
name|regdomain
argument_list|)
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|0
index|]
operator|=
name|regdomain
operator|->
name|rd
operator|.
name|isocc
index|[
literal|0
index|]
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|1
index|]
operator|=
name|regdomain
operator|->
name|rd
operator|.
name|isocc
index|[
literal|1
index|]
expr_stmt|;
name|wif
operator|->
name|country_code
index|[
literal|2
index|]
operator|=
name|regdomain
operator|->
name|rd
operator|.
name|location
expr_stmt|;
name|free
argument_list|(
name|regdomain
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_config_get_dssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
operator|-
literal|1
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_NWID_LEN
operator|+
literal|1
decl_stmt|;
name|char
name|ssid
index|[
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|memset
argument_list|(
name|ssid
argument_list|,
literal|0
argument_list|,
name|IEEE80211_NWID_LEN
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
operator|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
operator|)
condition|?
name|IEEE80211_IOC_MESH_ID
else|:
name|IEEE80211_IOC_SSID
argument_list|,
operator|&
name|val
argument_list|,
name|ssid
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|argsize
operator|>
name|IEEE80211_NWID_LEN
condition|)
name|argsize
operator|=
name|IEEE80211_NWID_LEN
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|,
name|ssid
argument_list|,
name|argsize
argument_list|)
expr_stmt|;
name|wif
operator|->
name|desired_ssid
index|[
name|argsize
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_config_set_dssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|char
modifier|*
name|ssid
parameter_list|,
name|int
name|slen
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
name|slen
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
operator|(
name|wif
operator|->
name|mode
operator|==
name|WlanIfaceOperatingModeType_meshPoint
operator|)
condition|?
name|IEEE80211_IOC_MESH_ID
else|:
name|IEEE80211_IOC_SSID
argument_list|,
operator|&
name|val
argument_list|,
name|ssid
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|argsize
operator|>
name|IEEE80211_NWID_LEN
condition|)
name|argsize
operator|=
name|IEEE80211_NWID_LEN
expr_stmt|;
name|memcpy
argument_list|(
name|wif
operator|->
name|desired_ssid
argument_list|,
name|ssid
argument_list|,
name|argsize
argument_list|)
expr_stmt|;
name|wif
operator|->
name|desired_ssid
index|[
name|argsize
index|]
operator|=
literal|'\0'
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_get_dchannel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|uint32_t
name|i
init|=
literal|0
decl_stmt|;
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_channel
argument_list|)
decl_stmt|;
name|struct
name|ieee80211_channel
name|chan
decl_stmt|;
if|if
condition|(
name|wlan_get_channel_list
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memset
argument_list|(
operator|&
name|chan
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|chan
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_CURCHAN
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|chan
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|wif
operator|->
name|nchannels
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|chan
operator|.
name|ic_ieee
operator|==
name|wif
operator|->
name|chanlist
index|[
name|i
index|]
operator|.
name|ic_ieee
operator|&&
name|chan
operator|.
name|ic_flags
operator|==
name|wif
operator|->
name|chanlist
index|[
name|i
index|]
operator|.
name|ic_flags
condition|)
block|{
name|wif
operator|->
name|desired_channel
operator|=
name|i
operator|+
literal|1
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_set_dchannel
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint32_t
name|dchannel
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_channel
argument_list|)
decl_stmt|;
name|struct
name|ieee80211_channel
name|chan
decl_stmt|;
if|if
condition|(
name|wlan_get_channel_list
argument_list|(
name|wif
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|dchannel
operator|>
name|wif
operator|->
name|nchannels
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memcpy
argument_list|(
operator|&
name|chan
argument_list|,
name|wif
operator|->
name|chanlist
operator|+
name|dchannel
operator|-
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|chan
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_CURCHAN
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|chan
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|desired_channel
operator|=
name|dchannel
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_get_bssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
name|char
name|bssid
index|[
name|IEEE80211_ADDR_LEN
index|]
decl_stmt|;
name|memset
argument_list|(
name|bssid
argument_list|,
literal|0
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
operator|&
name|val
argument_list|,
name|bssid
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
operator|||
name|argsize
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memcpy
argument_list|(
name|wif
operator|->
name|desired_bssid
argument_list|,
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_set_bssid
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|uint8_t
modifier|*
name|bssid
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_BSSID
argument_list|,
operator|&
name|val
argument_list|,
name|bssid
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
operator|||
name|argsize
operator|!=
name|IEEE80211_ADDR_LEN
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memcpy
argument_list|(
name|wif
operator|->
name|desired_bssid
argument_list|,
name|bssid
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Convert the value returned by the kernel to the appropriate SNMP  * representation and set the corresponding interface member accordingly.  */
end_comment

begin_function
specifier|static
name|void
name|wlan_config_set_snmp_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|op
parameter_list|,
name|int
name|val
parameter_list|)
block|{
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|IEEE80211_IOC_BURST
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|packet_burst
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|packet_burst
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_DFS
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dyn_frequency
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dyn_frequency
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_FF
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|fast_frames
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|fast_frames
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TURBOP
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dturbo
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dturbo
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TXPOWER
case|:
name|wif
operator|->
name|tx_power
operator|=
name|val
operator|/
literal|2
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_FRAGTHRESHOLD
case|:
name|wif
operator|->
name|frag_threshold
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_RTSTHRESHOLD
case|:
name|wif
operator|->
name|rts_threshold
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_WPS
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|priv_subscribe
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|priv_subscribe
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BGSCAN
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|bg_scan
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|bg_scan
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BGSCAN_IDLE
case|:
name|wif
operator|->
name|bg_scan_idle
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BGSCAN_INTERVAL
case|:
name|wif
operator|->
name|bg_scan_interval
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BMISSTHRESHOLD
case|:
name|wif
operator|->
name|beacons_missed
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_ROAMING
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_ROAMING_DEVICE
case|:
name|wif
operator|->
name|roam_mode
operator|=
name|wlanIfaceRoamingMode_device
expr_stmt|;
break|break;
case|case
name|IEEE80211_ROAMING_MANUAL
case|:
name|wif
operator|->
name|roam_mode
operator|=
name|wlanIfaceRoamingMode_manual
expr_stmt|;
break|break;
case|case
name|IEEE80211_ROAMING_AUTO
case|:
comment|/* FALTHROUGH */
default|default:
name|wif
operator|->
name|roam_mode
operator|=
name|wlanIfaceRoamingMode_auto
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_DOTD
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dot11d
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dot11d
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_DOTH
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dot11h
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dot11h
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_DWDS
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dynamic_wds
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dynamic_wds
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_POWERSAVE
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|power_save
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|power_save
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_APBRIDGE
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|ap_bridge
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|ap_bridge
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BEACON_INTERVAL
case|:
name|wif
operator|->
name|beacon_interval
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_DTIM_PERIOD
case|:
name|wif
operator|->
name|dtim_period
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_HIDESSID
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|hide_ssid
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|hide_ssid
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_INACTIVITY
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|inact_process
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|inact_process
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_PROTMODE
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_PROTMODE_CTS
case|:
name|wif
operator|->
name|do11g_protect
operator|=
name|wlanIfaceDot11gProtMode_cts
expr_stmt|;
break|break;
case|case
name|IEEE80211_PROTMODE_RTSCTS
case|:
name|wif
operator|->
name|do11g_protect
operator|=
name|wlanIfaceDot11gProtMode_rtscts
expr_stmt|;
break|break;
case|case
name|IEEE80211_PROTMODE_OFF
case|:
comment|/* FALLTHROUGH */
default|default:
name|wif
operator|->
name|do11g_protect
operator|=
name|wlanIfaceDot11gProtMode_off
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_PUREG
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dot11g_pure
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dot11g_pure
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_PUREN
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|dot11n_pure
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|dot11n_pure
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_AMPDU
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
literal|0
case|:
name|wif
operator|->
name|ampdu
operator|=
name|WlanIfaceDot11nPduType_disabled
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|wif
operator|->
name|ampdu
operator|=
name|WlanIfaceDot11nPduType_txOnly
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|wif
operator|->
name|ampdu
operator|=
name|WlanIfaceDot11nPduType_rxOnly
expr_stmt|;
break|break;
case|case
literal|3
case|:
comment|/* FALLTHROUGH */
default|default:
name|wif
operator|->
name|ampdu
operator|=
name|WlanIfaceDot11nPduType_txAndRx
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU_DENSITY
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_025
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|25
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_05
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|50
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_1
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|100
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_2
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|200
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_4
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|400
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_8
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|800
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_16
case|:
name|wif
operator|->
name|ampdu_density
operator|=
literal|1600
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MPDUDENSITY_NA
case|:
default|default:
name|wif
operator|->
name|ampdu_density
operator|=
literal|0
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU_LIMIT
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_8K
case|:
name|wif
operator|->
name|ampdu_limit
operator|=
literal|8192
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_16K
case|:
name|wif
operator|->
name|ampdu_limit
operator|=
literal|16384
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_32K
case|:
name|wif
operator|->
name|ampdu_limit
operator|=
literal|32768
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_MAXRXAMPDU_64K
case|:
default|default:
name|wif
operator|->
name|ampdu_limit
operator|=
literal|65536
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMSDU
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
literal|0
case|:
name|wif
operator|->
name|amsdu
operator|=
name|WlanIfaceDot11nPduType_disabled
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|wif
operator|->
name|amsdu
operator|=
name|WlanIfaceDot11nPduType_txOnly
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|wif
operator|->
name|amsdu
operator|=
name|WlanIfaceDot11nPduType_txAndRx
expr_stmt|;
break|break;
case|case
literal|2
case|:
default|default:
comment|/* FALLTHROUGH */
name|wif
operator|->
name|amsdu
operator|=
name|WlanIfaceDot11nPduType_rxOnly
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMSDU_LIMIT
case|:
name|wif
operator|->
name|amsdu_limit
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_HTCONF
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
comment|/* XXX */
name|wif
operator|->
name|ht_enabled
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|ht_enabled
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_HTCOMPAT
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|ht_compatible
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|ht_compatible
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_HTPROTMODE
case|:
if|if
condition|(
name|val
operator|==
name|IEEE80211_PROTMODE_RTSCTS
condition|)
name|wif
operator|->
name|ht_prot_mode
operator|=
name|wlanIfaceDot11nHTProtMode_rts
expr_stmt|;
else|else
name|wif
operator|->
name|ht_prot_mode
operator|=
name|wlanIfaceDot11nHTProtMode_off
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_RIFS
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|rifs
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|rifs
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_SHORTGI
case|:
if|if
condition|(
name|val
operator|==
literal|0
condition|)
name|wif
operator|->
name|short_gi
operator|=
name|TruthValue_false
expr_stmt|;
else|else
name|wif
operator|->
name|short_gi
operator|=
name|TruthValue_true
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_SMPS
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HTCAP_SMPS_DYNAMIC
case|:
name|wif
operator|->
name|smps_mode
operator|=
name|wlanIfaceDot11nSMPSMode_dynamic
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_SMPS_ENA
case|:
name|wif
operator|->
name|smps_mode
operator|=
name|wlanIfaceDot11nSMPSMode_static
expr_stmt|;
break|break;
case|case
name|IEEE80211_HTCAP_SMPS_OFF
case|:
comment|/* FALLTHROUGH */
default|default:
name|wif
operator|->
name|smps_mode
operator|=
name|wlanIfaceDot11nSMPSMode_disabled
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOT
case|:
name|wif
operator|->
name|tdma_slot
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTCNT
case|:
name|wif
operator|->
name|tdma_slot_count
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTLEN
case|:
name|wif
operator|->
name|tdma_slot_length
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_BINTERVAL
case|:
name|wif
operator|->
name|tdma_binterval
operator|=
name|val
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_comment
comment|/*  * Convert an SNMP value to the kernel equivalent and also do sanity check  * for each specific type.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_config_snmp2value
parameter_list|(
name|int
name|which
parameter_list|,
name|int
name|sval
parameter_list|,
name|int
modifier|*
name|value
parameter_list|)
block|{
operator|*
name|value
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|IEEE80211_IOC_BURST
case|:
case|case
name|IEEE80211_IOC_DFS
case|:
case|case
name|IEEE80211_IOC_FF
case|:
case|case
name|IEEE80211_IOC_TURBOP
case|:
case|case
name|IEEE80211_IOC_WPS
case|:
case|case
name|IEEE80211_IOC_BGSCAN
case|:
case|case
name|IEEE80211_IOC_DOTD
case|:
case|case
name|IEEE80211_IOC_DOTH
case|:
case|case
name|IEEE80211_IOC_DWDS
case|:
case|case
name|IEEE80211_IOC_POWERSAVE
case|:
case|case
name|IEEE80211_IOC_APBRIDGE
case|:
case|case
name|IEEE80211_IOC_HIDESSID
case|:
case|case
name|IEEE80211_IOC_INACTIVITY
case|:
case|case
name|IEEE80211_IOC_PUREG
case|:
case|case
name|IEEE80211_IOC_PUREN
case|:
case|case
name|IEEE80211_IOC_HTCONF
case|:
case|case
name|IEEE80211_IOC_HTCOMPAT
case|:
case|case
name|IEEE80211_IOC_RIFS
case|:
if|if
condition|(
name|sval
operator|==
name|TruthValue_true
condition|)
operator|*
name|value
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|sval
operator|!=
name|TruthValue_false
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|IEEE80211_IOC_REGDOMAIN
case|:
break|break;
case|case
name|IEEE80211_IOC_SSID
case|:
break|break;
case|case
name|IEEE80211_IOC_CURCHAN
case|:
break|break;
case|case
name|IEEE80211_IOC_TXPOWER
case|:
operator|*
name|value
operator|=
name|sval
operator|*
literal|2
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_FRAGTHRESHOLD
case|:
if|if
condition|(
name|sval
operator|<
name|IEEE80211_FRAG_MIN
operator|||
name|sval
operator|>
name|IEEE80211_FRAG_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_RTSTHRESHOLD
case|:
if|if
condition|(
name|sval
operator|<
name|IEEE80211_RTS_MIN
operator|||
name|sval
operator|>
name|IEEE80211_RTS_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BGSCAN_IDLE
case|:
if|if
condition|(
name|sval
operator|<
name|WLAN_BGSCAN_IDLE_MIN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BGSCAN_INTERVAL
case|:
if|if
condition|(
name|sval
operator|<
name|WLAN_SCAN_VALID_MIN
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BMISSTHRESHOLD
case|:
if|if
condition|(
name|sval
operator|<
name|IEEE80211_HWBMISS_MIN
operator|||
name|sval
operator|>
name|IEEE80211_HWBMISS_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_BSSID
case|:
break|break;
case|case
name|IEEE80211_IOC_ROAMING
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|wlanIfaceRoamingMode_device
case|:
operator|*
name|value
operator|=
name|IEEE80211_ROAMING_DEVICE
expr_stmt|;
break|break;
case|case
name|wlanIfaceRoamingMode_manual
case|:
operator|*
name|value
operator|=
name|IEEE80211_ROAMING_MANUAL
expr_stmt|;
break|break;
case|case
name|wlanIfaceRoamingMode_auto
case|:
operator|*
name|value
operator|=
name|IEEE80211_ROAMING_AUTO
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_BEACON_INTERVAL
case|:
if|if
condition|(
name|sval
operator|<
name|IEEE80211_BINTVAL_MIN
operator|||
name|sval
operator|>
name|IEEE80211_BINTVAL_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_DTIM_PERIOD
case|:
if|if
condition|(
name|sval
operator|<
name|IEEE80211_DTIM_MIN
operator|||
name|sval
operator|>
name|IEEE80211_DTIM_MAX
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_PROTMODE
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|wlanIfaceDot11gProtMode_cts
case|:
operator|*
name|value
operator|=
name|IEEE80211_PROTMODE_CTS
expr_stmt|;
break|break;
case|case
name|wlanIfaceDot11gProtMode_rtscts
case|:
operator|*
name|value
operator|=
name|IEEE80211_PROTMODE_RTSCTS
expr_stmt|;
break|break;
case|case
name|wlanIfaceDot11gProtMode_off
case|:
operator|*
name|value
operator|=
name|IEEE80211_PROTMODE_OFF
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|WlanIfaceDot11nPduType_disabled
case|:
break|break;
case|case
name|WlanIfaceDot11nPduType_txOnly
case|:
operator|*
name|value
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|WlanIfaceDot11nPduType_rxOnly
case|:
operator|*
name|value
operator|=
literal|2
expr_stmt|;
break|break;
case|case
name|WlanIfaceDot11nPduType_txAndRx
case|:
operator|*
name|value
operator|=
literal|3
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU_DENSITY
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
literal|0
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_NA
expr_stmt|;
break|break;
case|case
literal|25
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_025
expr_stmt|;
break|break;
case|case
literal|50
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_05
expr_stmt|;
break|break;
case|case
literal|100
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_1
expr_stmt|;
break|break;
case|case
literal|200
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_2
expr_stmt|;
break|break;
case|case
literal|400
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_4
expr_stmt|;
break|break;
case|case
literal|800
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_8
expr_stmt|;
break|break;
case|case
literal|1600
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MPDUDENSITY_16
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU_LIMIT
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
literal|8192
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_8K
expr_stmt|;
break|break;
case|case
literal|16384
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_16K
expr_stmt|;
break|break;
case|case
literal|32768
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_32K
expr_stmt|;
break|break;
case|case
literal|65536
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXRXAMPDU_64K
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMSDU
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|WlanIfaceDot11nPduType_disabled
case|:
break|break;
case|case
name|WlanIfaceDot11nPduType_txOnly
case|:
operator|*
name|value
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|WlanIfaceDot11nPduType_rxOnly
case|:
operator|*
name|value
operator|=
literal|2
expr_stmt|;
break|break;
case|case
name|WlanIfaceDot11nPduType_txAndRx
case|:
operator|*
name|value
operator|=
literal|3
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMSDU_LIMIT
case|:
if|if
condition|(
name|sval
operator|==
literal|3839
operator|||
name|sval
operator|==
literal|0
condition|)
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXAMSDU_3839
expr_stmt|;
elseif|else
if|if
condition|(
name|sval
operator|==
literal|7935
condition|)
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_MAXAMSDU_7935
expr_stmt|;
else|else
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|IEEE80211_IOC_HTPROTMODE
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|wlanIfaceDot11nHTProtMode_rts
case|:
operator|*
name|value
operator|=
name|IEEE80211_PROTMODE_RTSCTS
expr_stmt|;
break|break;
case|case
name|wlanIfaceDot11nHTProtMode_off
case|:
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_SHORTGI
case|:
if|if
condition|(
name|sval
operator|==
name|TruthValue_true
condition|)
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_SHORTGI20
operator||
name|IEEE80211_HTCAP_SHORTGI40
expr_stmt|;
elseif|else
if|if
condition|(
name|sval
operator|!=
name|TruthValue_false
condition|)
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
break|break;
case|case
name|IEEE80211_IOC_SMPS
case|:
switch|switch
condition|(
name|sval
condition|)
block|{
case|case
name|wlanIfaceDot11nSMPSMode_disabled
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_SMPS_OFF
expr_stmt|;
break|break;
case|case
name|wlanIfaceDot11nSMPSMode_static
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_SMPS_ENA
expr_stmt|;
break|break;
case|case
name|wlanIfaceDot11nSMPSMode_dynamic
case|:
operator|*
name|value
operator|=
name|IEEE80211_HTCAP_SMPS_DYNAMIC
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOT
case|:
if|if
condition|(
name|sval
operator|<
literal|0
operator|||
name|sval
operator|>
name|WLAN_TDMA_MAXSLOTS
condition|)
comment|/* XXX */
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTCNT
case|:
if|if
condition|(
name|sval
operator|<
literal|0
operator|||
name|sval
operator|>
name|WLAN_TDMA_MAXSLOTS
condition|)
comment|/* XXX */
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTLEN
case|:
if|if
condition|(
name|sval
operator|<
literal|2
operator|*
literal|100
operator|||
name|sval
operator|>
literal|0xfffff
condition|)
comment|/* XXX */
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
case|case
name|IEEE80211_IOC_TDMA_BINTERVAL
case|:
if|if
condition|(
name|sval
operator|<
literal|1
condition|)
comment|/* XXX */
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
operator|*
name|value
operator|=
name|sval
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|SNMP_ERR_INCONS_VALUE
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_ERR_NOERROR
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Sanity checks for the wlanIfaceConfigTable.  */
end_comment

begin_function
specifier|static
name|int
name|wlan_config_check
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|op
parameter_list|)
block|{
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|IEEE80211_IOC_BURST
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_burst
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|packet_burst
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_DFS
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_dfs
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|dyn_frequency
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_FF
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_athFastFrames
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|fast_frames
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TURBOP
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_athTurbo
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|dturbo
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TXPOWER
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_txPmgt
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|tx_power
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_FRAGTHRESHOLD
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_txFrag
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|frag_threshold
operator|=
name|IEEE80211_FRAG_MAX
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_DWDS
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_wds
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|dynamic_wds
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_POWERSAVE
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_pmgt
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|power_save
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_BEACON_INTERVAL
case|:
if|if
condition|(
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_hostAp
operator|&&
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
operator|&&
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_ibss
condition|)
block|{
name|wif
operator|->
name|beacon_interval
operator|=
literal|100
expr_stmt|;
comment|/* XXX */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_DTIM_PERIOD
case|:
if|if
condition|(
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_hostAp
operator|&&
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_meshPoint
operator|&&
name|wif
operator|->
name|mode
operator|!=
name|WlanIfaceOperatingModeType_ibss
condition|)
block|{
name|wif
operator|->
name|dtim_period
operator|=
literal|1
expr_stmt|;
comment|/* XXX */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_PUREN
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcHt
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|dot11n_pure
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMPDU
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcAmpdu
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|ampdu
operator|=
name|WlanIfaceDot11nPduType_disabled
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_AMSDU
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcAmsdu
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|amsdu
operator|=
name|WlanIfaceDot11nPduType_disabled
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_RIFS
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcRifs
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|rifs
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_SHORTGI
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_shortGi20
operator||
literal|0x1
operator|<<
name|WlanHTCaps_shortGi40
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|short_gi
operator|=
name|TruthValue_false
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_SMPS
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|htcaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanHTCaps_htcSmps
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|smps_mode
operator|=
name|wlanIfaceDot11nSMPSMode_disabled
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOT
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_tdma
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|tdma_slot
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTCNT
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_tdma
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|tdma_slot_count
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_SLOTLEN
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_tdma
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|tdma_slot_length
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|IEEE80211_IOC_TDMA_BINTERVAL
case|:
if|if
condition|(
operator|(
name|wif
operator|->
name|drivercaps
operator|&
operator|(
literal|0x1
operator|<<
name|WlanDriverCaps_tdma
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|tdma_binterval
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
default|default:
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_get_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|wlan_config_check
argument_list|(
name|wif
argument_list|,
name|op
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wlan_config_set_snmp_intval
argument_list|(
name|wif
argument_list|,
name|op
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_config_set_intval
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|op
parameter_list|,
name|int
name|sval
parameter_list|)
block|{
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|int
name|val
decl_stmt|;
if|if
condition|(
name|wlan_config_check
argument_list|(
name|wif
argument_list|,
name|op
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_config_snmp2value
argument_list|(
name|op
argument_list|,
name|sval
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
name|SNMP_ERR_NOERROR
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wlan_config_set_snmp_intval
argument_list|(
name|wif
argument_list|,
name|op
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_config_get_ioctl
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
comment|/* FALLTHROUGH */
case|case
name|LEAF_wlanIfaceRegDomain
case|:
return|return
operator|(
name|wlan_config_get_country
argument_list|(
name|wif
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
return|return
operator|(
name|wlan_config_get_dssid
argument_list|(
name|wif
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredChannel
case|:
return|return
operator|(
name|wlan_config_get_dchannel
argument_list|(
name|wif
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
return|return
operator|(
name|wlan_config_get_bssid
argument_list|(
name|wif
argument_list|)
operator|)
return|;
default|default:
name|op
operator|=
name|wlan_config_snmp2ioctl
argument_list|(
name|which
argument_list|)
expr_stmt|;
return|return
operator|(
name|wlan_config_get_intval
argument_list|(
name|wif
argument_list|,
name|op
argument_list|)
operator|)
return|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_config_set_ioctl
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|,
name|int
name|val
parameter_list|,
name|char
modifier|*
name|strval
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|int
name|op
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanIfaceCountryCode
case|:
return|return
operator|(
name|wlan_config_set_country
argument_list|(
name|wif
argument_list|,
name|strval
argument_list|,
name|wif
operator|->
name|reg_domain
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceRegDomain
case|:
return|return
operator|(
name|wlan_config_set_country
argument_list|(
name|wif
argument_list|,
name|wif
operator|->
name|country_code
argument_list|,
name|val
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredSsid
case|:
return|return
operator|(
name|wlan_config_set_dssid
argument_list|(
name|wif
argument_list|,
name|strval
argument_list|,
name|len
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredChannel
case|:
return|return
operator|(
name|wlan_config_set_dchannel
argument_list|(
name|wif
argument_list|,
name|val
argument_list|)
operator|)
return|;
case|case
name|LEAF_wlanIfaceDesiredBssid
case|:
return|return
operator|(
name|wlan_config_set_bssid
argument_list|(
name|wif
argument_list|,
name|strval
argument_list|)
operator|)
return|;
default|default:
name|op
operator|=
name|wlan_config_snmp2ioctl
argument_list|(
name|which
argument_list|)
expr_stmt|;
return|return
operator|(
name|wlan_config_set_intval
argument_list|(
name|wif
argument_list|,
name|op
argument_list|,
name|val
argument_list|)
operator|)
return|;
block|}
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint32_t
name|wlan_snmp_to_scan_flags
parameter_list|(
name|int
name|flags
parameter_list|)
block|{
name|int
name|sr_flags
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_noSelection
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_NOPICK
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_activeScan
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_ACTIVE
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_pickFirst
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_PICK1ST
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_backgroundScan
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_BGSCAN
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_once
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_ONCE
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_noBroadcast
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_NOBCAST
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_noAutoSequencing
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_NOJOIN
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_flushCashe
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_FLUSH
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
literal|0x1
operator|<<
name|WlanScanFlagsType_chechCashe
operator|)
operator|)
operator|!=
literal|0
condition|)
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_CHECK
expr_stmt|;
return|return
operator|(
name|sr_flags
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_scan_config
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211_scan_req
name|sr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|sr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|sr
argument_list|)
argument_list|)
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211_scan_req
argument_list|)
expr_stmt|;
name|sr
operator|.
name|sr_flags
operator|=
name|wlan_snmp_to_scan_flags
argument_list|(
name|wif
operator|->
name|scan_flags
argument_list|)
expr_stmt|;
name|sr
operator|.
name|sr_flags
operator||=
name|IEEE80211_IOC_SCAN_BGSCAN
expr_stmt|;
name|sr
operator|.
name|sr_duration
operator|=
name|wif
operator|->
name|scan_duration
expr_stmt|;
name|sr
operator|.
name|sr_mindwell
operator|=
name|wif
operator|->
name|scan_mindwell
expr_stmt|;
name|sr
operator|.
name|sr_maxdwell
operator|=
name|wif
operator|->
name|scan_maxdwell
expr_stmt|;
name|sr
operator|.
name|sr_nssid
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_SCAN_REQ
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|sr
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|scan_status
operator|=
name|wlanScanConfigStatus_running
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|uint32_t
name|wlan_peercaps_to_snmp
parameter_list|(
name|uint32_t
name|pcaps
parameter_list|)
block|{
name|uint32_t
name|scaps
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_ESS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_ess
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_IBSS
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_ibss
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_CF_POLLABLE
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_cfPollable
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_CF_POLLREQ
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_cfPollRequest
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_PRIVACY
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_privacy
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_SHORT_PREAMBLE
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_shortPreamble
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_PBCC
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_pbcc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_CHNL_AGILITY
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_channelAgility
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_SHORT_SLOTTIME
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_shortSlotTime
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_RSN
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_rsn
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pcaps
operator|&
name|IEEE80211_CAPINFO_DSSSOFDM
operator|)
operator|!=
literal|0
condition|)
name|scaps
operator||=
operator|(
literal|0x1
operator|<<
name|WlanPeerCapabilityFlags_dsssofdm
operator|)
expr_stmt|;
return|return
operator|(
name|scaps
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_add_new_scan_result
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
specifier|const
name|struct
name|ieee80211req_scan_result
modifier|*
name|isr
parameter_list|,
name|uint8_t
modifier|*
name|ssid
parameter_list|)
block|{
name|struct
name|wlan_scan_result
modifier|*
name|sr
decl_stmt|;
if|if
condition|(
operator|(
name|sr
operator|=
name|wlan_scan_new_result
argument_list|(
name|ssid
argument_list|,
name|isr
operator|->
name|isr_bssid
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|sr
operator|->
name|opchannel
operator|=
name|wlan_channel_flags_to_snmp_phy
argument_list|(
name|isr
operator|->
name|isr_flags
argument_list|)
expr_stmt|;
name|sr
operator|->
name|rssi
operator|=
name|isr
operator|->
name|isr_rssi
expr_stmt|;
name|sr
operator|->
name|frequency
operator|=
name|isr
operator|->
name|isr_freq
expr_stmt|;
name|sr
operator|->
name|noise
operator|=
name|isr
operator|->
name|isr_noise
expr_stmt|;
name|sr
operator|->
name|bintval
operator|=
name|isr
operator|->
name|isr_intval
expr_stmt|;
name|sr
operator|->
name|capinfo
operator|=
name|wlan_peercaps_to_snmp
argument_list|(
name|isr
operator|->
name|isr_capinfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_scan_add_result
argument_list|(
name|wif
argument_list|,
name|sr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wlan_scan_free_result
argument_list|(
name|sr
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_scan_results
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|ssidlen
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|;
name|uint8_t
name|buf
index|[
literal|24
operator|*
literal|1024
index|]
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
specifier|const
name|uint8_t
modifier|*
name|cp
decl_stmt|,
modifier|*
name|idp
decl_stmt|;
name|uint8_t
name|ssid
index|[
name|IEEE80211_NWID_LEN
operator|+
literal|1
index|]
decl_stmt|;
name|struct
name|ieee80211req_scan_result
name|isr
decl_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_SCAN_RESULTS
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|buf
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|argsize
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_scan_result
argument_list|)
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|cp
operator|=
name|buf
expr_stmt|;
do|do
block|{
name|memcpy
argument_list|(
operator|&
name|isr
argument_list|,
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_scan_result
argument_list|)
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|ssid
argument_list|,
literal|0
argument_list|,
name|IEEE80211_NWID_LEN
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|isr
operator|.
name|isr_meshid_len
condition|)
block|{
name|idp
operator|=
name|cp
operator|+
name|isr
operator|.
name|isr_ie_off
operator|+
name|isr
operator|.
name|isr_ssid_len
expr_stmt|;
name|ssidlen
operator|=
name|isr
operator|.
name|isr_meshid_len
expr_stmt|;
block|}
else|else
block|{
name|idp
operator|=
name|cp
operator|+
name|isr
operator|.
name|isr_ie_off
expr_stmt|;
name|ssidlen
operator|=
name|isr
operator|.
name|isr_ssid_len
expr_stmt|;
block|}
if|if
condition|(
name|ssidlen
operator|>
name|IEEE80211_NWID_LEN
condition|)
name|ssidlen
operator|=
name|IEEE80211_NWID_LEN
expr_stmt|;
name|memcpy
argument_list|(
name|ssid
argument_list|,
name|idp
argument_list|,
name|ssidlen
argument_list|)
expr_stmt|;
name|ssid
index|[
name|IEEE80211_NWID_LEN
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|(
name|void
operator|)
name|wlan_add_new_scan_result
argument_list|(
name|wif
argument_list|,
operator|&
name|isr
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|cp
operator|+=
name|isr
operator|.
name|isr_len
expr_stmt|;
name|argsize
operator|-=
name|isr
operator|.
name|isr_len
expr_stmt|;
block|}
do|while
condition|(
name|argsize
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_scan_result
argument_list|)
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_stats
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ifr
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ifreq
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|wif
operator|->
name|stats
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCG80211STATS
argument_list|,
operator|&
name|ifr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"iface %s - ioctl(SIOCG80211STATS) failed: %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_wepmode
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
operator|||
name|val
operator|==
name|IEEE80211_WEP_NOSUP
condition|)
block|{
name|wif
operator|->
name|wepsupported
operator|=
literal|0
expr_stmt|;
comment|/* XXX */
name|wif
operator|->
name|wepmode
operator|=
name|wlanWepMode_off
expr_stmt|;
name|wif
operator|->
name|weptxkey
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|wif
operator|->
name|wepsupported
operator|=
literal|1
expr_stmt|;
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_WEP_ON
case|:
name|wif
operator|->
name|wepmode
operator|=
name|wlanWepMode_on
expr_stmt|;
break|break;
case|case
name|IEEE80211_WEP_MIXED
case|:
name|wif
operator|->
name|wepmode
operator|=
name|wlanWepMode_mixed
expr_stmt|;
break|break;
case|case
name|IEEE80211_WEP_OFF
case|:
comment|/* FALLTHROUGH */
default|default:
name|wif
operator|->
name|wepmode
operator|=
name|wlanWepMode_off
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_wepmode
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|wif
operator|->
name|wepsupported
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
switch|switch
condition|(
name|wif
operator|->
name|wepmode
condition|)
block|{
case|case
name|wlanWepMode_off
case|:
name|val
operator|=
name|IEEE80211_WEP_OFF
expr_stmt|;
break|break;
case|case
name|wlanWepMode_on
case|:
name|val
operator|=
name|IEEE80211_WEP_ON
expr_stmt|;
break|break;
case|case
name|wlanWepMode_mixed
case|:
name|val
operator|=
name|IEEE80211_WEP_MIXED
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_WEP
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_weptxkey
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|wif
operator|->
name|wepsupported
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|val
operator|==
name|IEEE80211_KEYIX_NONE
condition|)
name|wif
operator|->
name|weptxkey
operator|=
literal|0
expr_stmt|;
else|else
name|wif
operator|->
name|weptxkey
operator|=
name|val
operator|+
literal|1
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_weptxkey
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|wif
operator|->
name|wepsupported
condition|)
return|return
operator|(
literal|0
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|weptxkey
operator|>=
name|IEEE80211_WEP_NKID
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wif
operator|->
name|weptxkey
operator|==
literal|0
condition|)
name|val
operator|=
name|IEEE80211_KEYIX_NONE
expr_stmt|;
else|else
name|val
operator|=
name|wif
operator|->
name|weptxkey
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_WEPTXKEY
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_wepkeys
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
name|__unused
parameter_list|)
block|{
comment|/* XXX: should they be visible via SNMP */
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_wepkeys
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
name|__unused
parameter_list|)
block|{
comment|/* XXX: should they be configurable via SNMP */
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_mac_policy
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
name|IEEE80211_MACCMD_POLICY
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_MACCMD
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
name|IEEE80211_MACCMD_POLICY
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|!=
name|EINVAL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"iface %s - get param: ioctl(%d) "
literal|"failed: %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|ireq
operator|.
name|i_type
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|wif
operator|->
name|macsupported
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
block|{
name|wif
operator|->
name|macsupported
operator|=
literal|1
expr_stmt|;
name|wif
operator|->
name|mac_policy
operator|=
name|wlanMACAccessControlPolicy_open
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
block|}
name|wif
operator|->
name|macsupported
operator|=
literal|1
expr_stmt|;
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_MACCMD_POLICY_ALLOW
case|:
name|wif
operator|->
name|mac_policy
operator|=
name|wlanMACAccessControlPolicy_allow
expr_stmt|;
break|break;
case|case
name|IEEE80211_MACCMD_POLICY_DENY
case|:
name|wif
operator|->
name|mac_policy
operator|=
name|wlanMACAccessControlPolicy_deny
expr_stmt|;
break|break;
case|case
name|IEEE80211_MACCMD_POLICY_RADIUS
case|:
name|wif
operator|->
name|mac_policy
operator|=
name|wlanMACAccessControlPolicy_radius
expr_stmt|;
break|break;
case|case
name|IEEE80211_MACCMD_POLICY_OPEN
case|:
comment|/* FALLTHROUGH */
default|default:
name|wif
operator|->
name|mac_policy
operator|=
name|wlanMACAccessControlPolicy_open
expr_stmt|;
break|break;
block|}
name|argsize
operator|=
literal|0
expr_stmt|;
name|val
operator|=
name|IEEE80211_MACCMD_LIST
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MACCMD
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wif
operator|->
name|mac_nacls
operator|=
name|argsize
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_maclist
operator|*
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_set_mac_policy
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|wif
operator|->
name|macsupported
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
switch|switch
condition|(
name|wif
operator|->
name|mac_policy
condition|)
block|{
case|case
name|wlanMACAccessControlPolicy_allow
case|:
name|val
operator|=
name|IEEE80211_MACCMD_POLICY_ALLOW
expr_stmt|;
break|break;
case|case
name|wlanMACAccessControlPolicy_deny
case|:
name|val
operator|=
name|IEEE80211_MACCMD_POLICY_DENY
expr_stmt|;
break|break;
case|case
name|wlanMACAccessControlPolicy_radius
case|:
name|val
operator|=
name|IEEE80211_MACCMD_POLICY_RADIUS
expr_stmt|;
break|break;
case|case
name|wlanMACAccessControlPolicy_open
case|:
name|val
operator|=
name|IEEE80211_MACCMD_POLICY_OPEN
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MACCMD
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_flush_mac_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
name|IEEE80211_MACCMD_FLUSH
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MACCMD
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wlan_add_mac_macinfo
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
specifier|const
name|struct
name|ieee80211req_maclist
modifier|*
name|ml
parameter_list|)
block|{
name|struct
name|wlan_mac_mac
modifier|*
name|mmac
decl_stmt|;
if|if
condition|(
operator|(
name|mmac
operator|=
name|wlan_mac_new_mac
argument_list|(
name|ml
operator|->
name|ml_macaddr
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|mmac
operator|->
name|mac_status
operator|=
name|RowStatus_active
expr_stmt|;
if|if
condition|(
name|wlan_mac_add_mac
argument_list|(
name|wif
argument_list|,
name|mmac
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wlan_mac_free_mac
argument_list|(
name|mmac
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_mac_acl_macs
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|nacls
decl_stmt|,
name|val
init|=
name|IEEE80211_MACCMD_LIST
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|uint8_t
modifier|*
name|data
decl_stmt|;
name|struct
name|ieee80211req
name|ireq
decl_stmt|;
specifier|const
name|struct
name|ieee80211req_maclist
modifier|*
name|acllist
decl_stmt|;
if|if
condition|(
name|wif
operator|->
name|mac_policy
operator|==
name|wlanMACAccessControlPolicy_radius
condition|)
block|{
name|wif
operator|->
name|mac_nacls
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|memset
argument_list|(
operator|&
name|ireq
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req
argument_list|)
argument_list|)
expr_stmt|;
name|strlcpy
argument_list|(
name|ireq
operator|.
name|i_name
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|IFNAMSIZ
argument_list|)
expr_stmt|;
name|ireq
operator|.
name|i_type
operator|=
name|IEEE80211_IOC_MACCMD
expr_stmt|;
name|ireq
operator|.
name|i_val
operator|=
name|IEEE80211_MACCMD_LIST
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|sock
argument_list|,
name|SIOCG80211
argument_list|,
operator|&
name|ireq
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|!=
name|EINVAL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"iface %s - get param: ioctl(%d) "
literal|"failed: %s"
argument_list|,
name|wif
operator|->
name|wname
argument_list|,
name|ireq
operator|.
name|i_type
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|wif
operator|->
name|macsupported
operator|=
literal|0
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
if|if
condition|(
name|argsize
operator|==
literal|0
condition|)
block|{
name|wif
operator|->
name|mac_nacls
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|data
operator|=
operator|(
name|uint8_t
operator|*
operator|)
name|malloc
argument_list|(
name|argsize
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MACCMD
argument_list|,
operator|&
name|val
argument_list|,
name|data
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|nacls
operator|=
name|argsize
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|acllist
argument_list|)
expr_stmt|;
name|acllist
operator|=
operator|(
expr|struct
name|ieee80211req_maclist
operator|*
operator|)
name|data
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nacls
condition|;
name|i
operator|++
control|)
operator|(
name|void
operator|)
name|wlan_add_mac_macinfo
argument_list|(
name|wif
argument_list|,
name|acllist
operator|+
name|i
argument_list|)
expr_stmt|;
name|wif
operator|->
name|mac_nacls
operator|=
name|nacls
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_add_mac_acl_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mac_mac
modifier|*
name|mmac
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
name|struct
name|ieee80211req_mlme
name|mlme
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_ADDMAC
argument_list|,
operator|&
name|val
argument_list|,
name|mmac
operator|->
name|mac
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|mmac
operator|->
name|mac_status
operator|=
name|RowStatus_active
expr_stmt|;
comment|/* If policy is deny, try to kick the station just in case. */
if|if
condition|(
name|wif
operator|->
name|mac_policy
operator|!=
name|wlanMACAccessControlPolicy_deny
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|memset
argument_list|(
operator|&
name|mlme
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|mlme
argument_list|)
argument_list|)
expr_stmt|;
name|mlme
operator|.
name|im_op
operator|=
name|IEEE80211_MLME_DEAUTH
expr_stmt|;
name|mlme
operator|.
name|im_reason
operator|=
name|IEEE80211_REASON_AUTH_EXPIRE
expr_stmt|;
name|memcpy
argument_list|(
name|mlme
operator|.
name|im_macaddr
argument_list|,
name|mmac
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_mlme
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MLME
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|mlme
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
operator|&&
name|errno
operator|!=
name|ENOENT
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_del_mac_acl_mac
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mac_mac
modifier|*
name|mmac
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
name|struct
name|ieee80211req_mlme
name|mlme
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_DELMAC
argument_list|,
operator|&
name|val
argument_list|,
name|mmac
operator|->
name|mac
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|mmac
operator|->
name|mac_status
operator|=
name|RowStatus_active
expr_stmt|;
comment|/* If policy is allow, try to kick the station just in case. */
if|if
condition|(
name|wif
operator|->
name|mac_policy
operator|!=
name|wlanMACAccessControlPolicy_allow
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|memset
argument_list|(
operator|&
name|mlme
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|mlme
argument_list|)
argument_list|)
expr_stmt|;
name|mlme
operator|.
name|im_op
operator|=
name|IEEE80211_MLME_DEAUTH
expr_stmt|;
name|mlme
operator|.
name|im_reason
operator|=
name|IEEE80211_REASON_AUTH_EXPIRE
expr_stmt|;
name|memcpy
argument_list|(
name|mlme
operator|.
name|im_macaddr
argument_list|,
name|mmac
operator|->
name|mac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_mlme
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MLME
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|mlme
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
operator|&&
name|errno
operator|!=
name|ENOENT
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_peer_set_vlan
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_peer
modifier|*
name|wip
parameter_list|,
name|int
name|vlan
parameter_list|)
block|{
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211req_sta_vlan
name|vreq
decl_stmt|;
name|memcpy
argument_list|(
name|vreq
operator|.
name|sv_macaddr
argument_list|,
name|wip
operator|->
name|pmac
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|vreq
operator|.
name|sv_vlan
operator|=
name|vlan
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_vlan
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_STA_VLAN
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|vreq
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wip
operator|->
name|vlan
operator|=
name|vlan
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* XXX */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|IEEE80211_NODE_AUTH
end_ifndef

begin_define
define|#
directive|define
name|IEEE80211_NODE_AUTH
value|0x000001
end_define

begin_comment
comment|/* authorized for data */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_QOS
value|0x000002
end_define

begin_comment
comment|/* QoS enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_ERP
value|0x000004
end_define

begin_comment
comment|/* ERP enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_PWR_MGT
value|0x000010
end_define

begin_comment
comment|/* power save mode enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_AREF
value|0x000020
end_define

begin_comment
comment|/* authentication ref held */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_HT
value|0x000040
end_define

begin_comment
comment|/* HT enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_HTCOMPAT
value|0x000080
end_define

begin_comment
comment|/* HT setup w/ vendor OUI's */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_WPS
value|0x000100
end_define

begin_comment
comment|/* WPS association */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_TSN
value|0x000200
end_define

begin_comment
comment|/* TSN association */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_AMPDU_RX
value|0x000400
end_define

begin_comment
comment|/* AMPDU rx enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_AMPDU_TX
value|0x000800
end_define

begin_comment
comment|/* AMPDU tx enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_MIMO_PS
value|0x001000
end_define

begin_comment
comment|/* MIMO power save enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_MIMO_RTS
value|0x002000
end_define

begin_comment
comment|/* send RTS in MIMO PS */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_RIFS
value|0x004000
end_define

begin_comment
comment|/* RIFS enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_SGI20
value|0x008000
end_define

begin_comment
comment|/* Short GI in HT20 enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_SGI40
value|0x010000
end_define

begin_comment
comment|/* Short GI in HT40 enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_ASSOCID
value|0x020000
end_define

begin_comment
comment|/* xmit requires associd */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_AMSDU_RX
value|0x040000
end_define

begin_comment
comment|/* AMSDU rx enabled */
end_comment

begin_define
define|#
directive|define
name|IEEE80211_NODE_AMSDU_TX
value|0x080000
end_define

begin_comment
comment|/* AMSDU tx enabled */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|uint32_t
name|wlan_peerstate_to_snmp
parameter_list|(
name|uint32_t
name|pstate
parameter_list|)
block|{
name|uint32_t
name|sstate
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AUTH
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_authorizedForData
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_QOS
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_qosEnabled
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_ERP
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_erpEnabled
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_PWR_MGT
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_powerSaveMode
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AREF
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_authRefHeld
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_HT
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_htEnabled
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_HTCOMPAT
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_htCompat
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_WPS
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_wpsAssoc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_TSN
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_tsnAssoc
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AMPDU_RX
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_ampduRx
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AMPDU_TX
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_ampduTx
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_MIMO_PS
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_mimoPowerSave
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_MIMO_RTS
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_sendRts
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_RIFS
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_rifs
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_SGI20
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_shortGiHT20
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_SGI40
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_shortGiHT40
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AMSDU_RX
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_amsduRx
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pstate
operator|&
name|IEEE80211_NODE_AMSDU_TX
operator|)
operator|!=
literal|0
condition|)
name|sstate
operator||=
operator|(
literal|0x1
operator|<<
name|WlanIfacePeerFlagsType_amsduTx
operator|)
expr_stmt|;
return|return
operator|(
name|sstate
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wlan_peer
modifier|*
name|wlan_add_peerinfo
parameter_list|(
specifier|const
name|struct
name|ieee80211req_sta_info
modifier|*
name|si
parameter_list|)
block|{
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_new_peer
argument_list|(
name|si
operator|->
name|isi_macaddr
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|wip
operator|->
name|associd
operator|=
name|IEEE80211_AID
argument_list|(
name|si
operator|->
name|isi_associd
argument_list|)
expr_stmt|;
name|wip
operator|->
name|vlan
operator|=
name|si
operator|->
name|isi_vlan
expr_stmt|;
name|wip
operator|->
name|frequency
operator|=
name|si
operator|->
name|isi_freq
expr_stmt|;
name|wip
operator|->
name|fflags
operator|=
name|si
operator|->
name|isi_flags
expr_stmt|;
name|wip
operator|->
name|txrate
operator|=
name|si
operator|->
name|isi_txrate
expr_stmt|;
name|wip
operator|->
name|rssi
operator|=
name|si
operator|->
name|isi_rssi
expr_stmt|;
name|wip
operator|->
name|idle
operator|=
name|si
operator|->
name|isi_inact
expr_stmt|;
name|wip
operator|->
name|txseqs
operator|=
name|si
operator|->
name|isi_txseqs
index|[
literal|0
index|]
expr_stmt|;
comment|/* XXX */
name|wip
operator|->
name|rxseqs
operator|=
name|si
operator|->
name|isi_rxseqs
index|[
literal|0
index|]
expr_stmt|;
comment|/* XXX */
name|wip
operator|->
name|txpower
operator|=
name|si
operator|->
name|isi_txpower
expr_stmt|;
name|wip
operator|->
name|capinfo
operator|=
name|wlan_peercaps_to_snmp
argument_list|(
name|si
operator|->
name|isi_capinfo
argument_list|)
expr_stmt|;
name|wip
operator|->
name|state
operator|=
name|wlan_peerstate_to_snmp
argument_list|(
name|si
operator|->
name|isi_state
argument_list|)
expr_stmt|;
name|wip
operator|->
name|local_id
operator|=
name|si
operator|->
name|isi_localid
expr_stmt|;
name|wip
operator|->
name|peer_id
operator|=
name|si
operator|->
name|isi_peerid
expr_stmt|;
return|return
operator|(
name|wip
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_get_peerinfo
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
union|union
block|{
name|struct
name|ieee80211req_sta_req
name|req
decl_stmt|;
name|uint8_t
name|buf
index|[
literal|24
operator|*
literal|1024
index|]
decl_stmt|;
block|}
name|u
union|;
specifier|const
name|uint8_t
modifier|*
name|cp
decl_stmt|;
name|int
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|struct
name|ieee80211req_sta_info
name|si
decl_stmt|;
name|struct
name|wlan_peer
modifier|*
name|wip
decl_stmt|;
comment|/* Get all stations - broadcast address */
operator|(
name|void
operator|)
name|memset
argument_list|(
name|u
operator|.
name|req
operator|.
name|is_u
operator|.
name|macaddr
argument_list|,
literal|0xff
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|u
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_STA_INFO
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|u
argument_list|,
operator|&
name|len
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
if|if
condition|(
name|len
operator|<
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_info
argument_list|)
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|cp
operator|=
operator|(
specifier|const
name|uint8_t
operator|*
operator|)
name|u
operator|.
name|req
operator|.
name|info
expr_stmt|;
do|do
block|{
name|memcpy
argument_list|(
operator|&
name|si
argument_list|,
name|cp
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_info
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|wip
operator|=
name|wlan_add_peerinfo
argument_list|(
operator|&
name|si
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
name|wlan_add_peer
argument_list|(
name|wif
argument_list|,
name|wip
argument_list|)
operator|<
literal|0
condition|)
name|wlan_free_peer
argument_list|(
name|wip
argument_list|)
expr_stmt|;
name|cp
operator|+=
name|si
operator|.
name|isi_len
operator|,
name|len
operator|-=
name|si
operator|.
name|isi_len
expr_stmt|;
block|}
do|while
condition|(
name|len
operator|>=
sizeof|sizeof
argument_list|(
expr|struct
name|ieee80211req_sta_info
argument_list|)
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/************************************************************************  * Wireless MESH& HWMP sysctl config.  */
end_comment

begin_decl_stmt
specifier|const
name|char
name|wlan_sysctl_name
index|[]
init|=
literal|"net.wlan."
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|wlan_sysctl
index|[]
init|=
block|{
literal|"mesh.retrytimeout"
block|,
literal|"mesh.holdingtimeout"
block|,
literal|"mesh.confirmtimeout"
block|,
literal|"mesh.maxretries"
block|,
literal|"hwmp.targetonly"
block|,
literal|"hwmp.replyforward"
block|,
literal|"hwmp.pathlifetime"
block|,
literal|"hwmp.roottimeout"
block|,
literal|"hwmp.rootint"
block|,
literal|"hwmp.rannint"
block|,
literal|"hwmp.inact"
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|int32_t
name|wlan_do_sysctl
parameter_list|(
name|struct
name|wlan_config
modifier|*
name|cfg
parameter_list|,
name|enum
name|wlan_syscl
name|which
parameter_list|,
name|int
name|set
parameter_list|)
block|{
name|char
name|mib_name
index|[
literal|100
index|]
decl_stmt|;
name|int
name|val
decl_stmt|,
name|sval
decl_stmt|;
name|size_t
name|len
decl_stmt|,
name|vlen
decl_stmt|;
if|if
condition|(
name|set
condition|)
block|{
name|vlen
operator|=
sizeof|sizeof
argument_list|(
name|sval
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|WLAN_MESH_RETRY_TO
case|:
name|sval
operator|=
name|cfg
operator|->
name|mesh_retryto
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_HOLDING_TO
case|:
name|sval
operator|=
name|cfg
operator|->
name|mesh_holdingto
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_CONFIRM_TO
case|:
name|sval
operator|=
name|cfg
operator|->
name|mesh_confirmto
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_MAX_RETRIES
case|:
name|sval
operator|=
name|cfg
operator|->
name|mesh_maxretries
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_TARGET_ONLY
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_targetonly
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_REPLY_FORWARD
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_replyforward
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_PATH_LIFETIME
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_pathlifetime
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_ROOT_TO
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_roottimeout
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_ROOT_INT
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_rootint
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_RANN_INT
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_rannint
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_INACTIVITY_TO
case|:
name|sval
operator|=
name|cfg
operator|->
name|hwmp_inact
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|which
operator|>=
name|WLAN_SYSCTL_MAX
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|vlen
operator|=
literal|0
expr_stmt|;
block|}
name|strlcpy
argument_list|(
name|mib_name
argument_list|,
name|wlan_sysctl_name
argument_list|,
sizeof|sizeof
argument_list|(
name|mib_name
argument_list|)
argument_list|)
expr_stmt|;
name|strlcat
argument_list|(
name|mib_name
argument_list|,
name|wlan_sysctl
index|[
name|which
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|mib_name
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
sizeof|sizeof
argument_list|(
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|sysctlbyname
argument_list|(
name|mib_name
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|len
argument_list|,
operator|(
name|set
condition|?
operator|&
name|sval
else|:
name|NULL
operator|)
argument_list|,
name|vlen
argument_list|)
operator|<
literal|0
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"sysctl(%s) failed - %s"
argument_list|,
name|mib_name
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|WLAN_MESH_RETRY_TO
case|:
name|cfg
operator|->
name|mesh_retryto
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_HOLDING_TO
case|:
name|cfg
operator|->
name|mesh_holdingto
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_CONFIRM_TO
case|:
name|cfg
operator|->
name|mesh_confirmto
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_MESH_MAX_RETRIES
case|:
name|cfg
operator|->
name|mesh_maxretries
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_TARGET_ONLY
case|:
name|cfg
operator|->
name|hwmp_targetonly
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_REPLY_FORWARD
case|:
name|cfg
operator|->
name|hwmp_replyforward
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_PATH_LIFETIME
case|:
name|cfg
operator|->
name|hwmp_pathlifetime
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_ROOT_TO
case|:
name|cfg
operator|->
name|hwmp_roottimeout
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_ROOT_INT
case|:
name|cfg
operator|->
name|hwmp_rootint
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_RANN_INT
case|:
name|cfg
operator|->
name|hwmp_rannint
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|WLAN_HWMP_INACTIVITY_TO
case|:
name|cfg
operator|->
name|hwmp_inact
operator|=
name|val
expr_stmt|;
break|break;
default|default:
comment|/* NOTREACHED */
name|abort
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_config_get
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|uint8_t
name|data
index|[
literal|32
index|]
decl_stmt|,
modifier|*
name|pd
init|=
name|NULL
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanMeshTTL
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_TTL
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_AP
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_FWRD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_PR_METRIC
expr_stmt|;
name|pd
operator|=
name|data
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_PR_PATH
expr_stmt|;
name|pd
operator|=
name|data
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshRoutesFlush
case|:
return|return
operator|(
literal|0
operator|)
return|;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|pd
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanMeshTTL
case|:
name|wif
operator|->
name|mesh_ttl
operator|=
name|val
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
if|if
condition|(
name|val
condition|)
name|wif
operator|->
name|mesh_peering
operator|=
name|wlanMeshPeeringEnabled_true
expr_stmt|;
else|else
name|wif
operator|->
name|mesh_peering
operator|=
name|wlanMeshPeeringEnabled_false
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
if|if
condition|(
name|val
condition|)
name|wif
operator|->
name|mesh_forwarding
operator|=
name|wlanMeshForwardingEnabled_true
expr_stmt|;
else|else
name|wif
operator|->
name|mesh_forwarding
operator|=
name|wlanMeshForwardingEnabled_false
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|data
index|[
name|argsize
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|data
argument_list|,
literal|"AIRTIME"
argument_list|)
operator|==
literal|0
condition|)
name|wif
operator|->
name|mesh_metric
operator|=
name|wlanMeshMetric_airtime
expr_stmt|;
else|else
name|wif
operator|->
name|mesh_metric
operator|=
name|wlanMeshMetric_unknown
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|data
index|[
name|argsize
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|data
argument_list|,
literal|"HWMP"
argument_list|)
operator|==
literal|0
condition|)
name|wif
operator|->
name|mesh_path
operator|=
name|wlanMeshPath_hwmp
expr_stmt|;
else|else
name|wif
operator|->
name|mesh_path
operator|=
name|wlanMeshPath_unknown
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_config_set
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
name|uint8_t
name|data
index|[
literal|32
index|]
decl_stmt|,
modifier|*
name|pd
init|=
name|NULL
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanMeshTTL
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_TTL
expr_stmt|;
name|val
operator|=
name|wif
operator|->
name|mesh_ttl
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPeeringEnabled
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_AP
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|mesh_peering
operator|==
name|wlanMeshPeeringEnabled_true
condition|)
name|val
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshForwardingEnabled
case|:
if|if
condition|(
name|wif
operator|->
name|mesh_forwarding
operator|==
name|wlanMeshForwardingEnabled_true
condition|)
name|val
operator|=
literal|1
expr_stmt|;
name|op
operator|=
name|IEEE80211_IOC_MESH_FWRD
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshMetric
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_PR_METRIC
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|mesh_metric
operator|==
name|wlanMeshMetric_airtime
condition|)
name|strcpy
argument_list|(
name|data
argument_list|,
literal|"AIRTIME"
argument_list|)
expr_stmt|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|pd
operator|=
name|data
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|LEAF_wlanMeshPath
case|:
name|op
operator|=
name|IEEE80211_IOC_MESH_PR_PATH
expr_stmt|;
if|if
condition|(
name|wif
operator|->
name|mesh_path
operator|==
name|wlanMeshPath_hwmp
condition|)
name|strcpy
argument_list|(
name|data
argument_list|,
literal|"HWMP"
argument_list|)
expr_stmt|;
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|pd
operator|=
name|data
expr_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|data
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|pd
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_flush_routes
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|val
init|=
name|IEEE80211_MESH_RTCMD_FLUSH
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MESH_RTCMD
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_add_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
parameter_list|)
block|{
name|int
name|val
init|=
name|IEEE80211_MESH_RTCMD_ADD
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MESH_RTCMD
argument_list|,
operator|&
name|val
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wmr
operator|->
name|mroute_status
operator|=
name|RowStatus_active
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_del_route
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
parameter_list|)
block|{
name|int
name|val
init|=
name|IEEE80211_MESH_RTCMD_DELETE
decl_stmt|;
name|size_t
name|argsize
init|=
name|IEEE80211_ADDR_LEN
decl_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MESH_RTCMD
argument_list|,
operator|&
name|val
argument_list|,
name|wmr
operator|->
name|imroute
operator|.
name|imr_dest
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|wmr
operator|->
name|mroute_status
operator|=
name|RowStatus_destroy
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_mesh_get_routelist
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|nroutes
decl_stmt|,
name|val
init|=
name|IEEE80211_MESH_RTCMD_LIST
decl_stmt|;
name|size_t
name|argsize
decl_stmt|;
name|struct
name|ieee80211req_mesh_route
name|routes
index|[
literal|128
index|]
decl_stmt|;
name|struct
name|ieee80211req_mesh_route
modifier|*
name|rt
decl_stmt|;
name|struct
name|wlan_mesh_route
modifier|*
name|wmr
decl_stmt|;
name|argsize
operator|=
sizeof|sizeof
argument_list|(
name|routes
argument_list|)
expr_stmt|;
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|IEEE80211_IOC_MESH_RTCMD
argument_list|,
operator|&
name|val
argument_list|,
name|routes
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
comment|/* XXX: ENOMEM? */
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|nroutes
operator|=
name|argsize
operator|/
sizeof|sizeof
argument_list|(
operator|*
name|rt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nroutes
condition|;
name|i
operator|++
control|)
block|{
name|rt
operator|=
name|routes
operator|+
name|i
expr_stmt|;
if|if
condition|(
operator|(
name|wmr
operator|=
name|wlan_mesh_new_route
argument_list|(
name|rt
operator|->
name|imr_dest
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
name|memcpy
argument_list|(
operator|&
name|wmr
operator|->
name|imroute
argument_list|,
name|rt
argument_list|,
sizeof|sizeof
argument_list|(
operator|*
name|rt
argument_list|)
argument_list|)
expr_stmt|;
name|wmr
operator|->
name|mroute_status
operator|=
name|RowStatus_active
expr_stmt|;
if|if
condition|(
name|wlan_mesh_add_rtentry
argument_list|(
name|wif
argument_list|,
name|wmr
argument_list|)
operator|<
literal|0
condition|)
name|wlan_mesh_free_route
argument_list|(
name|wmr
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_hwmp_config_get
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
name|op
operator|=
name|IEEE80211_IOC_HWMP_ROOTMODE
expr_stmt|;
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|op
operator|=
name|IEEE80211_IOC_HWMP_MAXHOPS
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
switch|switch
condition|(
name|val
condition|)
block|{
case|case
name|IEEE80211_HWMP_ROOTMODE_NORMAL
case|:
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|wlanHWMPRootMode_normal
expr_stmt|;
break|break;
case|case
name|IEEE80211_HWMP_ROOTMODE_PROACTIVE
case|:
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|wlanHWMPRootMode_proactive
expr_stmt|;
break|break;
case|case
name|IEEE80211_HWMP_ROOTMODE_RANN
case|:
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|wlanHWMPRootMode_rann
expr_stmt|;
break|break;
case|case
name|IEEE80211_HWMP_ROOTMODE_DISABLED
case|:
default|default:
name|wif
operator|->
name|hwmp_root_mode
operator|=
name|wlanHWMPRootMode_disabled
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|wif
operator|->
name|hwmp_max_hops
operator|=
name|val
expr_stmt|;
break|break;
block|}
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_function
name|int
name|wlan_hwmp_config_set
parameter_list|(
name|struct
name|wlan_iface
modifier|*
name|wif
parameter_list|,
name|int
name|which
parameter_list|)
block|{
name|int
name|op
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|;
name|size_t
name|argsize
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|LEAF_wlanHWMPRootMode
case|:
name|op
operator|=
name|IEEE80211_IOC_HWMP_ROOTMODE
expr_stmt|;
switch|switch
condition|(
name|wif
operator|->
name|hwmp_root_mode
condition|)
block|{
case|case
name|wlanHWMPRootMode_disabled
case|:
name|val
operator|=
name|IEEE80211_HWMP_ROOTMODE_DISABLED
expr_stmt|;
break|break;
case|case
name|wlanHWMPRootMode_normal
case|:
name|val
operator|=
name|IEEE80211_HWMP_ROOTMODE_NORMAL
expr_stmt|;
break|break;
case|case
name|wlanHWMPRootMode_proactive
case|:
name|val
operator|=
name|IEEE80211_HWMP_ROOTMODE_PROACTIVE
expr_stmt|;
break|break;
case|case
name|wlanHWMPRootMode_rann
case|:
name|val
operator|=
name|IEEE80211_HWMP_ROOTMODE_RANN
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
break|break;
case|case
name|LEAF_wlanHWMPMaxHops
case|:
name|op
operator|=
name|IEEE80211_IOC_HWMP_MAXHOPS
expr_stmt|;
name|val
operator|=
name|wif
operator|->
name|hwmp_max_hops
expr_stmt|;
break|break;
default|default:
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
name|wlan_ioctl
argument_list|(
name|wif
operator|->
name|wname
argument_list|,
name|op
argument_list|,
operator|&
name|val
argument_list|,
name|NULL
argument_list|,
operator|&
name|argsize
argument_list|,
literal|1
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
operator|-
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

