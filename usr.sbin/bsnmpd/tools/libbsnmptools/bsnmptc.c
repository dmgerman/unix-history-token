begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 2006 The FreeBSD Project  * All rights reserved.  *  * Author: Shteryana Shopova<syrinx@FreeBSD.org>  *  * Redistribution of this software and documentation and use in source and  * binary forms, with or without modification, are permitted provided that  * the following conditions are met:  *  * 1. Redistributions of source code or documentation must retain the above  *    copyright notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  * Textual conventions for OctetStrings  *  * $FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<sys/uio.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/asn1.h>
end_include

begin_include
include|#
directive|include
file|<bsnmp/snmp.h>
end_include

begin_include
include|#
directive|include
file|"bsnmptc.h"
end_include

begin_include
include|#
directive|include
file|"bsnmptools.h"
end_include

begin_comment
comment|/* OctetString, DisplayString */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2str
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_str2asn_oid
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_octetstring
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* DateAndTime */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_octstr2date
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_date2asn_oid
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_dateandtime
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* PhysAddress */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2physAddr
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_addr2asn_oid
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_physaddress
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* NTPTimeStamp */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2ntp_ts
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_ntp_ts2asn_oid
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_ntp_ts
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* BridgeId */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2bridgeid
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_bridgeid2oct
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_bridge_id
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* BridgePortId */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2bport_id
parameter_list|(
name|uint32_t
parameter_list|,
name|char
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_bport_id2oct
parameter_list|(
name|char
modifier|*
parameter_list|,
name|struct
name|asn_oid
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_bport_id
parameter_list|(
name|struct
name|snmp_value
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* InetAddress */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2inetaddr
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_inetaddr2oct
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int32_t
name|parse_inetaddr
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_oct2bits
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|snmp_bits2oct
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int32_t
name|parse_bits
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_struct
specifier|static
struct|struct
name|snmp_text_conv
block|{
name|enum
name|snmp_tc
name|tc
decl_stmt|;
specifier|const
name|char
modifier|*
name|tc_str
decl_stmt|;
name|int32_t
name|len
decl_stmt|;
name|snmp_oct2tc_f
name|oct2tc
decl_stmt|;
name|snmp_tc2oid_f
name|tc2oid
decl_stmt|;
name|snmp_tc2oct_f
name|tc2oct
decl_stmt|;
block|}
name|text_convs
index|[]
init|=
block|{
block|{
name|SNMP_STRING
block|,
literal|"OctetString"
block|,
name|SNMP_VAR_STRSZ
block|,
name|snmp_oct2str
block|,
name|snmp_str2asn_oid
block|,
name|parse_octetstring
block|}
block|,
block|{
name|SNMP_DISPLAYSTRING
block|,
literal|"DisplayString"
block|,
name|SNMP_VAR_STRSZ
block|,
name|snmp_oct2str
block|,
name|snmp_str2asn_oid
block|,
name|parse_octetstring
block|}
block|,
block|{
name|SNMP_DATEANDTIME
block|,
literal|"DateAndTime"
block|,
name|SNMP_DATETIME_STRSZ
block|,
name|snmp_octstr2date
block|,
name|snmp_date2asn_oid
block|,
name|parse_dateandtime
block|}
block|,
block|{
name|SNMP_PHYSADDR
block|,
literal|"PhysAddress"
block|,
name|SNMP_PHYSADDR_STRSZ
block|,
name|snmp_oct2physAddr
block|,
name|snmp_addr2asn_oid
block|,
name|parse_physaddress
block|}
block|,
block|{
name|SNMP_ATMESI
block|,
literal|"AtmESI"
block|,
name|SNMP_PHYSADDR_STRSZ
block|,
name|snmp_oct2physAddr
block|,
name|snmp_addr2asn_oid
block|,
name|parse_physaddress
block|}
block|,
block|{
name|SNMP_NTP_TIMESTAMP
block|,
literal|"NTPTimeStamp"
block|,
name|SNMP_NTP_TS_STRSZ
block|,
name|snmp_oct2ntp_ts
block|,
name|snmp_ntp_ts2asn_oid
block|,
name|parse_ntp_ts
block|}
block|,
block|{
name|SNMP_MACADDRESS
block|,
literal|"MacAddress"
block|,
name|SNMP_PHYSADDR_STRSZ
block|,
name|snmp_oct2physAddr
block|,
name|snmp_addr2asn_oid
block|,
name|parse_physaddress
block|}
block|,
block|{
name|SNMP_BRIDGE_ID
block|,
literal|"BridgeId"
block|,
name|SNMP_BRIDGEID_STRSZ
block|,
name|snmp_oct2bridgeid
block|,
name|snmp_bridgeid2oct
block|,
name|parse_bridge_id
block|}
block|,
block|{
name|SNMP_BPORT_ID
block|,
literal|"BridgePortId"
block|,
name|SNMP_BPORT_STRSZ
block|,
name|snmp_oct2bport_id
block|,
name|snmp_bport_id2oct
block|,
name|parse_bport_id
block|}
block|,
block|{
name|SNMP_INETADDRESS
block|,
literal|"InetAddress"
block|,
name|SNMP_INADDRS_STRSZ
block|,
name|snmp_oct2inetaddr
block|,
name|snmp_inetaddr2oct
block|,
name|parse_inetaddr
block|}
block|,
block|{
name|SNMP_TC_OWN
block|,
literal|"BITS"
block|,
name|SNMP_VAR_STRSZ
block|,
name|snmp_oct2bits
block|,
name|snmp_bits2oct
block|,
name|parse_bits
block|}
block|,
block|{
name|SNMP_UNKNOWN
block|,
literal|"Unknown"
block|,
name|SNMP_VAR_STRSZ
block|,
name|snmp_oct2str
block|,
name|snmp_str2asn_oid
block|,
name|parse_octetstring
block|}
comment|/* keep last */
block|}
struct|;
end_struct

begin_comment
comment|/* Common API */
end_comment

begin_function
name|enum
name|snmp_tc
name|snmp_get_tc
parameter_list|(
name|char
modifier|*
name|str
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SNMP_UNKNOWN
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strncmp
argument_list|(
name|text_convs
index|[
name|i
index|]
operator|.
name|tc_str
argument_list|,
name|str
argument_list|,
name|strlen
argument_list|(
name|text_convs
index|[
name|i
index|]
operator|.
name|tc_str
argument_list|)
argument_list|)
condition|)
return|return
operator|(
name|text_convs
index|[
name|i
index|]
operator|.
name|tc
operator|)
return|;
block|}
return|return
operator|(
name|SNMP_STRING
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|snmp_oct2tc
parameter_list|(
name|enum
name|snmp_tc
name|tc
parameter_list|,
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|)
block|{
name|uint32_t
name|tc_len
decl_stmt|;
name|char
modifier|*
name|buf
decl_stmt|;
if|if
condition|(
name|tc
operator|>
name|SNMP_UNKNOWN
condition|)
name|tc
operator|=
name|SNMP_UNKNOWN
expr_stmt|;
if|if
condition|(
name|text_convs
index|[
name|tc
index|]
operator|.
name|len
operator|>
literal|0
condition|)
name|tc_len
operator|=
name|text_convs
index|[
name|tc
index|]
operator|.
name|len
expr_stmt|;
else|else
name|tc_len
operator|=
literal|2
operator|*
name|len
operator|+
literal|3
expr_stmt|;
if|if
condition|(
operator|(
name|buf
operator|=
name|malloc
argument_list|(
name|tc_len
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed - %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|memset
argument_list|(
name|buf
argument_list|,
literal|0
argument_list|,
name|tc_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|text_convs
index|[
name|tc
index|]
operator|.
name|oct2tc
argument_list|(
name|len
argument_list|,
name|octets
argument_list|,
name|buf
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|snmp_tc2oid
parameter_list|(
name|enum
name|snmp_tc
name|tc
parameter_list|,
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
if|if
condition|(
name|tc
operator|>
name|SNMP_UNKNOWN
condition|)
name|tc
operator|=
name|SNMP_UNKNOWN
expr_stmt|;
return|return
operator|(
name|text_convs
index|[
name|tc
index|]
operator|.
name|tc2oid
argument_list|(
name|str
argument_list|,
name|oid
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
name|int32_t
name|snmp_tc2oct
parameter_list|(
name|enum
name|snmp_tc
name|tc
parameter_list|,
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
block|{
if|if
condition|(
name|tc
operator|>
name|SNMP_UNKNOWN
condition|)
name|tc
operator|=
name|SNMP_UNKNOWN
expr_stmt|;
return|return
operator|(
name|text_convs
index|[
name|tc
index|]
operator|.
name|tc2oct
argument_list|(
name|value
argument_list|,
name|string
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/***************************************************** * Basic OctetString type. */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2str
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|uint8_t
name|binary
init|=
literal|0
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|len
operator|>
name|MAX_OCTSTRING_LEN
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|ptr
operator|=
name|buf
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|isprint
argument_list|(
name|octets
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|binary
operator|=
literal|1
expr_stmt|;
name|buf
operator|+=
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"0x"
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|ptr
operator|=
name|buf
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|binary
condition|)
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%c"
argument_list|,
name|octets
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%2.2x"
argument_list|,
operator|(
name|u_char
operator|)
name|octets
index|[
name|i
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_str2asn_oid
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|uint32_t
name|i
decl_stmt|,
name|len
init|=
literal|0
decl_stmt|;
comment|/* 	 * OctetStrings are allowed max length of ASN_MAXOCTETSTRING, 	 * but trying to index an entry with such a long OctetString 	 * will fail anyway. 	 */
for|for
control|(
name|len
operator|=
literal|0
init|;
name|len
operator|<
name|ASN_MAXOIDLEN
condition|;
name|len
operator|++
control|)
block|{
if|if
condition|(
name|strchr
argument_list|(
literal|",]"
argument_list|,
operator|*
operator|(
name|str
operator|+
name|len
operator|)
argument_list|)
operator|!=
name|NULL
condition|)
break|break;
block|}
if|if
condition|(
name|len
operator|>=
name|ASN_MAXOIDLEN
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|len
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
operator|*
operator|(
name|str
operator|+
name|i
operator|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|str
operator|+
name|len
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_octetstring
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
if|if
condition|(
operator|(
name|len
operator|=
name|strlen
argument_list|(
name|val
argument_list|)
operator|)
operator|>=
name|MAX_OCTSTRING_LEN
condition|)
block|{
name|warnx
argument_list|(
literal|"Octetstring too long - %d is max allowed"
argument_list|,
name|MAX_OCTSTRING_LEN
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|len
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|len
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|memcpy
argument_list|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|val
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|value
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

begin_comment
comment|/*************************************************************  * DateAndTime  *************************************************************  * rfc 2579 specification:  * DateAndTime ::= TEXTUAL-CONVENTION  *   DISPLAY-HINT "2d-1d-1d,1d:1d:1d.1d,1a1d:1d"  *   STATUS	  current  *   DESCRIPTION  *	"A date-time specification.  *  *	field	octets	contents		range  *	-----	------	--------		-----  *	1	1-2	year*			0..65536  *	2	3	month			1..12  *	3	4	day			1..31  *	4	5	hour			0..23  *	5	6	minutes			0..59  *	6	7	seconds			0..60  *			(use 60 for leap-second)  *	7	8	deci-seconds		0..9  *	8	9	direction from UTC	'+' / '-'  *	9	10	hours from UTC*		0..13  *	10	11	minutes from UTC	0..59  *  *	* Notes:  *	    - the value of year is in network-byte order  *	    - daylight saving time in New Zealand is +13  *  *	For example, Tuesday May 26, 1992 at 1:30:15 PM EDT would be  *	displayed as:  *  *		1992-5-26,13:30:15.0,-4:0  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_octstr2date
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|year
decl_stmt|;
name|char
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|len
operator|!=
name|SNMP_DATETIME_OCTETS
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|year
operator|=
operator|(
name|octets
index|[
literal|0
index|]
operator|<<
literal|8
operator|)
expr_stmt|;
name|year
operator|+=
operator|(
name|octets
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|ptr
operator|=
name|buf
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%4.4d-%.2d-%.2d, "
argument_list|,
name|year
argument_list|,
name|octets
index|[
literal|2
index|]
argument_list|,
name|octets
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%2.2d:%2.2d:%2.2d.%.2d, "
argument_list|,
name|octets
index|[
literal|4
index|]
argument_list|,
name|octets
index|[
literal|5
index|]
argument_list|,
name|octets
index|[
literal|6
index|]
argument_list|,
name|octets
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%c%.2d:%.2d"
argument_list|,
name|octets
index|[
literal|8
index|]
argument_list|,
name|octets
index|[
literal|9
index|]
argument_list|,
name|octets
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_date2asn_oid
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
specifier|static
specifier|const
name|char
name|UTC
index|[
literal|3
index|]
init|=
literal|"UTC"
decl_stmt|;
name|int32_t
name|saved_errno
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|SNMP_DATETIME_OCTETS
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* Read 'YYYY-' and write it in two subs. */
name|ptr
operator|=
name|str
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xffff
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'-'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
operator|(
name|v
operator|&
literal|0xff00
operator|)
operator|>>
literal|8
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
name|v
operator|&
literal|0xff
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'MM-' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'-'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'DD,' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'-'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'HH:' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'MM:' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'SS.' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'M(mseconds),' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|','
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'UTC' - optional */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|ptr
argument_list|,
name|UTC
argument_list|,
sizeof|sizeof
argument_list|(
name|UTC
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|ptr
operator|+=
sizeof|sizeof
argument_list|(
name|UTC
argument_list|)
expr_stmt|;
comment|/* '+/-' */
if|if
condition|(
operator|*
name|ptr
operator|==
literal|'-'
operator|||
operator|*
name|ptr
operator|==
literal|'+'
condition|)
block|{
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
operator|*
name|ptr
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
goto|goto
name|error1
goto|;
comment|/* 'HH:' */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error1
goto|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
comment|/* 'MM' - last one - ignore endptr here. */
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
goto|goto
name|error
goto|;
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|endptr
operator|)
return|;
name|error
label|:
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|error1
label|:
name|warnx
argument_list|(
literal|"Date value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Read a DateAndTime string eg. 1992-5-26,13:30:15.0,-4:0. */
end_comment

begin_function
specifier|static
name|int32_t
name|parse_dateandtime
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|sv
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|uint8_t
name|date
index|[
name|SNMP_DATETIME_OCTETS
index|]
decl_stmt|;
comment|/* 'YYYY-' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xffff
operator|||
operator|*
name|endptr
operator|!=
literal|'-'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|v
operator|&
literal|0xff00
operator|)
operator|>>
literal|8
operator|)
expr_stmt|;
name|date
index|[
literal|1
index|]
operator|=
operator|(
name|v
operator|&
literal|0xff
operator|)
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'MM-' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|==
literal|0
operator|||
name|v
operator|>
literal|12
operator|||
operator|*
name|endptr
operator|!=
literal|'-'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|2
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'DD,' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|==
literal|0
operator|||
name|v
operator|>
literal|31
operator|||
operator|*
name|endptr
operator|!=
literal|','
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|3
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'HH:' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|23
operator|||
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|4
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'MM:' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|59
operator|||
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|5
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'SS.' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|60
operator|||
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|6
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* '(deci-)s,' */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|9
operator|||
operator|*
name|endptr
operator|!=
literal|','
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|7
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* offset - '+/-' */
if|if
condition|(
operator|*
name|val
operator|!=
literal|'-'
operator|&&
operator|*
name|val
operator|!=
literal|'+'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|8
index|]
operator|=
operator|(
name|uint8_t
operator|)
operator|*
name|val
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'HH:' - offset from UTC */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|13
operator|||
operator|*
name|endptr
operator|!=
literal|':'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|9
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
comment|/* 'MM'\0''  offset from UTC */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|59
operator|||
operator|*
name|endptr
operator|!=
literal|'\0'
condition|)
goto|goto
name|error
goto|;
name|date
index|[
literal|10
index|]
operator|=
name|v
expr_stmt|;
if|if
condition|(
operator|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|SNMP_DATETIME_OCTETS
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|warnx
argument_list|(
literal|"malloc() failed - %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|SNMP_DATETIME_OCTETS
expr_stmt|;
name|memcpy
argument_list|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|date
argument_list|,
name|SNMP_DATETIME_OCTETS
argument_list|)
expr_stmt|;
name|sv
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
name|error
label|:
name|warnx
argument_list|(
literal|"Date value %s not supported"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * PhysAddress  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2physAddr
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|char
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
if|if
condition|(
name|len
operator|!=
name|SNMP_PHYSADDR_OCTETS
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ptr
operator|=
name|buf
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%2.2x"
argument_list|,
name|octets
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|":%2.2x"
argument_list|,
name|octets
index|[
name|i
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_addr2asn_oid
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|v
decl_stmt|,
name|i
decl_stmt|;
name|int
name|saved_errno
decl_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|SNMP_PHYSADDR_OCTETS
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|str
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed adding oid - %s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
block|}
comment|/* The last one - don't check the ending char here. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|endptr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_physaddress
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|sv
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int32_t
name|i
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|uint8_t
name|phys_addr
index|[
name|SNMP_PHYSADDR_OCTETS
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed reading octet - %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|phys_addr
index|[
name|i
index|]
operator|=
name|v
expr_stmt|;
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
block|}
comment|/* The last one - don't check the ending char here. */
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|phys_addr
index|[
literal|5
index|]
operator|=
name|v
expr_stmt|;
if|if
condition|(
operator|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|SNMP_PHYSADDR_OCTETS
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|SNMP_PHYSADDR_OCTETS
expr_stmt|;
name|memcpy
argument_list|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|phys_addr
argument_list|,
name|SNMP_PHYSADDR_OCTETS
argument_list|)
expr_stmt|;
name|sv
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * NTPTimeStamp  **************************************************************  * NTP MIB, Revision 0.2, 7/25/97:  * NTPTimeStamp ::= TEXTUAL-CONVENTION  *    DISPLAY-HINT "4x.4x"  *    STATUS	current  *    DESCRIPTION  *	""  *    SYNTAX	OCTET STRING (SIZE(8))  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2ntp_ts
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|char
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|i
decl_stmt|;
if|if
condition|(
name|len
operator|!=
name|SNMP_NTP_TS_OCTETS
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ptr
operator|=
name|buf
expr_stmt|;
name|i
operator|=
name|octets
index|[
literal|0
index|]
operator|*
literal|1000
operator|+
name|octets
index|[
literal|1
index|]
operator|*
literal|100
operator|+
name|octets
index|[
literal|2
index|]
operator|*
literal|10
operator|+
name|octets
index|[
literal|3
index|]
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%4.4d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|i
operator|=
name|octets
index|[
literal|4
index|]
operator|*
literal|1000
operator|+
name|octets
index|[
literal|5
index|]
operator|*
literal|100
operator|+
name|octets
index|[
literal|6
index|]
operator|*
literal|10
operator|+
name|octets
index|[
literal|7
index|]
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|".%4.4d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_ntp_ts2asn_oid
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|v
decl_stmt|,
name|i
decl_stmt|,
name|d
decl_stmt|;
name|struct
name|asn_oid
name|suboid
decl_stmt|;
name|int
name|saved_errno
decl_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|SNMP_NTP_TS_OCTETS
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|str
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
operator|||
operator|(
name|v
operator|/
literal|1000
operator|)
operator|>
literal|9
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed adding oid - %s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|memset
argument_list|(
operator|&
name|suboid
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|asn_oid
argument_list|)
argument_list|)
expr_stmt|;
name|suboid
operator|.
name|len
operator|=
name|SNMP_NTP_TS_OCTETS
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|d
operator|=
literal|1000
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|suboid
operator|.
name|subs
index|[
name|i
index|]
operator|=
name|v
operator|/
name|d
expr_stmt|;
name|v
operator|=
name|v
operator|%
name|d
expr_stmt|;
name|d
operator|=
name|d
operator|/
literal|10
expr_stmt|;
block|}
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
operator|||
operator|(
name|v
operator|/
literal|1000
operator|)
operator|>
literal|9
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|d
operator|=
literal|1000
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|suboid
operator|.
name|subs
index|[
name|i
operator|+
literal|4
index|]
operator|=
name|v
operator|/
name|d
expr_stmt|;
name|v
operator|=
name|v
operator|%
name|d
expr_stmt|;
name|d
operator|=
name|d
operator|/
literal|10
expr_stmt|;
block|}
name|asn_append_oid
argument_list|(
name|oid
argument_list|,
operator|&
name|suboid
argument_list|)
expr_stmt|;
return|return
operator|(
name|endptr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_ntp_ts
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|sv
parameter_list|,
name|char
modifier|*
name|val
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int32_t
name|i
decl_stmt|,
name|d
decl_stmt|,
name|saved_errno
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|uint8_t
name|ntp_ts
index|[
name|SNMP_NTP_TS_OCTETS
index|]
decl_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
operator|||
operator|(
name|v
operator|/
literal|1000
operator|)
operator|>
literal|9
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed reading octet - %s"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|d
operator|=
literal|1000
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ntp_ts
index|[
name|i
index|]
operator|=
name|v
operator|/
name|d
expr_stmt|;
name|v
operator|=
name|v
operator|%
name|d
expr_stmt|;
name|d
operator|=
name|d
operator|/
literal|10
expr_stmt|;
block|}
name|val
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|val
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
operator|||
operator|(
name|v
operator|/
literal|1000
operator|)
operator|>
literal|9
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
else|else
name|errno
operator|=
name|saved_errno
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|d
operator|=
literal|1000
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|ntp_ts
index|[
name|i
operator|+
literal|4
index|]
operator|=
name|v
operator|/
name|d
expr_stmt|;
name|v
operator|=
name|v
operator|%
name|d
expr_stmt|;
name|d
operator|=
name|d
operator|/
literal|10
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|SNMP_NTP_TS_OCTETS
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|SNMP_NTP_TS_OCTETS
expr_stmt|;
name|memcpy
argument_list|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|ntp_ts
argument_list|,
name|SNMP_NTP_TS_OCTETS
argument_list|)
expr_stmt|;
name|sv
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * BridgeId  **************************************************************  * BRIDGE-MIB, REVISION		"200509190000Z"  * BridgeId ::= TEXTUAL-CONVENTION  *    STATUS	current  *    DESCRIPTION  *	"The Bridge-Identifier, as used in the Spanning Tree  *	Protocol, to uniquely identify a bridge.  Its first two  *	octets (in network byte order) contain a priority value,  *	and its last 6 octets contain the MAC address used to  *	refer to a bridge in a unique fashion (typically, the  *	numerically smallest MAC address of all ports on the  *	bridge)."  *    SYNTAX	OCTET STRING (SIZE (8))  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2bridgeid
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|char
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|i
decl_stmt|,
name|priority
decl_stmt|;
if|if
condition|(
name|len
operator|!=
name|SNMP_BRIDGEID_OCTETS
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ptr
operator|=
name|buf
expr_stmt|;
name|priority
operator|=
name|octets
index|[
literal|0
index|]
operator|<<
literal|8
expr_stmt|;
name|priority
operator|+=
name|octets
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|priority
operator|>
name|SNMP_MAX_BRIDGE_PRIORITY
condition|)
block|{
name|warnx
argument_list|(
literal|"Invalid bridge priority %d"
argument_list|,
name|priority
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%d."
argument_list|,
name|octets
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%2.2x"
argument_list|,
name|octets
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|":%2.2x"
argument_list|,
name|octets
index|[
name|i
operator|+
literal|2
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_bridgeid2oct
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|v
decl_stmt|,
name|i
decl_stmt|;
name|int32_t
name|saved_errno
decl_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|SNMP_BRIDGEID_OCTETS
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|str
expr_stmt|;
comment|/* Read the priority. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
name|SNMP_MAX_BRIDGE_PRIORITY
operator|||
name|errno
operator|!=
literal|0
operator|||
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Bad bridge priority value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
name|v
operator|&
literal|0xff00
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
name|v
operator|&
literal|0xff
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed adding oid - %s"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
block|}
comment|/* The last one - don't check the ending char here. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|str
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|endptr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_bridge_id
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|sv
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int32_t
name|i
decl_stmt|,
name|saved_errno
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|uint8_t
name|bridge_id
index|[
name|SNMP_BRIDGEID_OCTETS
index|]
decl_stmt|;
comment|/* Read the priority. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
name|SNMP_MAX_BRIDGE_PRIORITY
operator|||
name|errno
operator|!=
literal|0
operator|||
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Bad bridge priority value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bridge_id
index|[
literal|0
index|]
operator|=
operator|(
name|v
operator|&
literal|0xff00
operator|)
expr_stmt|;
name|bridge_id
index|[
literal|1
index|]
operator|=
operator|(
name|v
operator|&
literal|0xff
operator|)
expr_stmt|;
name|string
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|v
operator|=
name|strtoul
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|string
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
if|if
condition|(
operator|*
name|endptr
operator|!=
literal|':'
condition|)
block|{
name|warnx
argument_list|(
literal|"Failed reading octet - %s"
argument_list|,
name|string
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bridge_id
index|[
name|i
operator|+
literal|2
index|]
operator|=
name|v
expr_stmt|;
name|string
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
block|}
comment|/* The last one - don't check the ending char here. */
name|v
operator|=
name|strtoul
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Integer value %s not supported"
argument_list|,
name|string
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bridge_id
index|[
literal|7
index|]
operator|=
name|v
expr_stmt|;
if|if
condition|(
operator|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|SNMP_BRIDGEID_OCTETS
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|SNMP_BRIDGEID_OCTETS
expr_stmt|;
name|memcpy
argument_list|(
name|sv
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|bridge_id
argument_list|,
name|SNMP_BRIDGEID_OCTETS
argument_list|)
expr_stmt|;
name|sv
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * BridgePortId  **************************************************************  * BEGEMOT-BRIDGE-MIB, LAST-UPDATED "200608100000Z"  * BridgePortId ::= TEXTUAL-CONVENTION  *    DISPLAY-HINT "1x.1x"  *    STATUS	current  *    DESCRIPTION  *	"A port identifier that contains a bridge port's STP priority  *	in the first octet and the port number in the second octet."  *    SYNTAX	OCTET STRING (SIZE(2))  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2bport_id
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|char
modifier|*
name|ptr
decl_stmt|;
if|if
condition|(
name|len
operator|!=
name|SNMP_BPORT_OCTETS
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|ptr
operator|=
name|buf
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%d."
argument_list|,
name|octets
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|sprintf
argument_list|(
name|ptr
argument_list|,
literal|"%d"
argument_list|,
name|octets
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_bport_id2oct
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|,
modifier|*
name|ptr
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|int
name|saved_errno
decl_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|SNMP_BPORT_OCTETS
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|ptr
operator|=
name|str
expr_stmt|;
comment|/* Read the priority. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
name|SNMP_MAX_BPORT_PRIORITY
operator|||
name|errno
operator|!=
literal|0
operator|||
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Bad bridge port priority value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|ptr
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Bad port number - %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|v
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|endptr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_bport_id
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int
name|saved_errno
decl_stmt|;
name|uint32_t
name|v
decl_stmt|;
name|uint8_t
name|bport_id
index|[
name|SNMP_BPORT_OCTETS
index|]
decl_stmt|;
comment|/* Read the priority. */
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
name|SNMP_MAX_BPORT_PRIORITY
operator|||
name|errno
operator|!=
literal|0
operator|||
operator|*
name|endptr
operator|!=
literal|'.'
condition|)
block|{
name|errno
operator|=
name|saved_errno
expr_stmt|;
name|warnx
argument_list|(
literal|"Bad bridge port priority value %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bport_id
index|[
literal|0
index|]
operator|=
name|v
expr_stmt|;
name|string
operator|=
name|endptr
operator|+
literal|1
expr_stmt|;
name|v
operator|=
name|strtoul
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|0xff
condition|)
block|{
name|warnx
argument_list|(
literal|"Bad port number - %d"
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bport_id
index|[
literal|1
index|]
operator|=
name|v
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|SNMP_BPORT_OCTETS
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|SNMP_BPORT_OCTETS
expr_stmt|;
name|memcpy
argument_list|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
argument_list|,
name|bport_id
argument_list|,
name|SNMP_BPORT_OCTETS
argument_list|)
expr_stmt|;
name|value
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * InetAddress  **************************************************************  * INET-ADDRESS-MIB, REVISION     "200502040000Z"  * InetAddress ::= TEXTUAL-CONVENTION  *   STATUS      current  *   DESCRIPTION  *       "Denotes a generic Internet address.  *  *        An InetAddress value is always interpreted within the context  *        of an InetAddressType value.  Every usage of the InetAddress  *        textual convention is required to specify the InetAddressType  *        object that provides the context.  It is suggested that the  *        InetAddressType object be logically registered before the  *        object(s) that use the InetAddress textual convention, if  *        they appear in the same logical row.  *  *        The value of an InetAddress object must always be  *        consistent with the value of the associated InetAddressType  *        object.  Attempts to set an InetAddress object to a value  *        inconsistent with the associated InetAddressType  *        must fail with an inconsistentValue error.  *  *        When this textual convention is used as the syntax of an  *        index object, there may be issues with the limit of 128  *        sub-identifiers specified in SMIv2, STD 58.  In this case,  *        the object definition MUST include a 'SIZE' clause to  *        limit the number of potential instance sub-identifiers;  *        otherwise the applicable constraints MUST be stated in  *        the appropriate conceptual row DESCRIPTION clauses, or  *        in the surrounding documentation if there is no single  *        DESCRIPTION clause that is appropriate."  *   SYNTAX       OCTET STRING (SIZE (0..255))  **************************************************************  * TODO: FIXME!!! syrinx: Since we do not support checking the  * consistency of a varbinding based on the value of a previous  * one, try to guess the type of address based on the  * OctetString SIZE - 4 for IPv4, 16 for IPv6, others currently  * not supported.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2inetaddr
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|af
decl_stmt|;
name|void
modifier|*
name|ip
decl_stmt|;
name|struct
name|in_addr
name|ipv4
decl_stmt|;
name|struct
name|in6_addr
name|ipv6
decl_stmt|;
if|if
condition|(
name|len
operator|>
name|MAX_OCTSTRING_LEN
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
switch|switch
condition|(
name|len
condition|)
block|{
comment|/* XXX: FIXME - IPv4*/
case|case
literal|4
case|:
name|memcpy
argument_list|(
operator|&
name|ipv4
operator|.
name|s_addr
argument_list|,
name|octets
argument_list|,
sizeof|sizeof
argument_list|(
name|ipv4
operator|.
name|s_addr
argument_list|)
argument_list|)
expr_stmt|;
name|af
operator|=
name|AF_INET
expr_stmt|;
name|ip
operator|=
operator|&
name|ipv4
expr_stmt|;
break|break;
comment|/* XXX: FIXME - IPv4*/
case|case
literal|16
case|:
name|memcpy
argument_list|(
name|ipv6
operator|.
name|s6_addr
argument_list|,
name|octets
argument_list|,
sizeof|sizeof
argument_list|(
name|ipv6
operator|.
name|s6_addr
argument_list|)
argument_list|)
expr_stmt|;
name|af
operator|=
name|AF_INET6
expr_stmt|;
name|ip
operator|=
operator|&
name|ipv6
expr_stmt|;
break|break;
default|default:
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|inet_ntop
argument_list|(
name|af
argument_list|,
name|ip
argument_list|,
name|buf
argument_list|,
name|SNMP_INADDRS_STRSZ
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|warnx
argument_list|(
literal|"inet_ntop failed - %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_inetaddr2oct
parameter_list|(
name|char
modifier|*
name|str
name|__unused
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
name|__unused
parameter_list|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_inetaddr
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
name|__unused
parameter_list|,
name|char
modifier|*
name|string
name|__unused
parameter_list|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************************  * SNMP BITS type - XXX: FIXME  **************************************************************/
end_comment

begin_function
specifier|static
name|char
modifier|*
name|snmp_oct2bits
parameter_list|(
name|uint32_t
name|len
parameter_list|,
name|char
modifier|*
name|octets
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|bits
decl_stmt|;
name|uint64_t
name|value
decl_stmt|;
if|if
condition|(
name|len
operator|>
sizeof|sizeof
argument_list|(
name|value
argument_list|)
operator|||
name|octets
operator|==
name|NULL
operator|||
name|buf
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|i
operator|=
name|len
operator|,
name|value
operator|=
literal|0
operator|,
name|bits
operator|=
literal|0
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
operator|,
name|bits
operator|+=
literal|8
control|)
name|value
operator|+=
name|octets
index|[
name|i
index|]
operator|<<
name|bits
expr_stmt|;
name|buf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"0x%llx."
argument_list|,
operator|(
name|long
name|long
name|unsigned
operator|)
name|value
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
name|snmp_bits2oct
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|struct
name|asn_oid
modifier|*
name|oid
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int
name|i
decl_stmt|,
name|size
decl_stmt|,
name|bits
decl_stmt|,
name|saved_errno
decl_stmt|;
name|uint64_t
name|v
decl_stmt|,
name|mask
init|=
literal|0xFF00000000000000
decl_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoull
argument_list|(
name|str
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
block|{
name|warnx
argument_list|(
literal|"Bad BITS value %s - %s"
argument_list|,
name|str
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|bits
operator|=
literal|8
expr_stmt|;
comment|/* Determine length - up to 8 octets supported so far. */
for|for
control|(
name|size
operator|=
sizeof|sizeof
argument_list|(
name|v
argument_list|)
init|;
name|size
operator|>
literal|0
condition|;
name|size
operator|--
control|)
block|{
if|if
condition|(
operator|(
name|v
operator|&
name|mask
operator|)
operator|!=
literal|0
condition|)
break|break;
name|mask
operator|=
name|mask
operator|>>
name|bits
expr_stmt|;
block|}
if|if
condition|(
name|size
operator|==
literal|0
condition|)
name|size
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
operator|(
name|asn_subid_t
operator|)
name|size
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|bits
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
operator|,
name|bits
operator|+=
literal|8
control|)
if|if
condition|(
name|snmp_suboid_append
argument_list|(
name|oid
argument_list|,
call|(
name|asn_subid_t
call|)
argument_list|(
operator|(
name|v
operator|&
name|mask
operator|)
operator|>>
name|bits
argument_list|)
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
operator|(
name|endptr
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int32_t
name|parse_bits
parameter_list|(
name|struct
name|snmp_value
modifier|*
name|value
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
block|{
name|char
modifier|*
name|endptr
decl_stmt|;
name|int
name|i
decl_stmt|,
name|size
decl_stmt|,
name|bits
decl_stmt|,
name|saved_errno
decl_stmt|;
name|uint64_t
name|v
decl_stmt|,
name|mask
init|=
literal|0xFF00000000000000
decl_stmt|;
name|saved_errno
operator|=
name|errno
expr_stmt|;
name|errno
operator|=
literal|0
expr_stmt|;
name|v
operator|=
name|strtoull
argument_list|(
name|string
argument_list|,
operator|&
name|endptr
argument_list|,
literal|16
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|!=
literal|0
condition|)
block|{
name|warnx
argument_list|(
literal|"Bad BITS value %s - %s"
argument_list|,
name|string
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|errno
operator|=
name|saved_errno
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|bits
operator|=
literal|8
expr_stmt|;
comment|/* Determine length - up to 8 octets supported so far. */
for|for
control|(
name|size
operator|=
sizeof|sizeof
argument_list|(
name|v
argument_list|)
init|;
name|size
operator|>
literal|0
condition|;
name|size
operator|--
control|)
block|{
if|if
condition|(
operator|(
name|v
operator|&
name|mask
operator|)
operator|!=
literal|0
condition|)
break|break;
name|mask
operator|=
name|mask
operator|>>
name|bits
expr_stmt|;
block|}
if|if
condition|(
name|size
operator|==
literal|0
condition|)
name|size
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
operator|=
name|malloc
argument_list|(
name|size
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|syslog
argument_list|(
name|LOG_ERR
argument_list|,
literal|"malloc failed: %s"
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|len
operator|=
name|size
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|bits
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
operator|,
name|bits
operator|+=
literal|8
control|)
name|value
operator|->
name|v
operator|.
name|octetstring
operator|.
name|octets
index|[
name|i
index|]
operator|=
operator|(
name|v
operator|&
name|mask
operator|)
operator|>>
name|bits
expr_stmt|;
name|value
operator|->
name|syntax
operator|=
name|SNMP_SYNTAX_OCTETSTRING
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function

end_unit

