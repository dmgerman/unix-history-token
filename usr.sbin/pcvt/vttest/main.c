begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*                                VTTEST.C           Written Novemeber 1983 - July 1984 by Per Lindberg,          Stockholm University Computer Center (QZ), Sweden.                    THE MAD PROGRAMMER STRIKES AGAIN!                     This software is (c) 1984 by QZ                Non-commercial use and copying allowed.  If you are developing a commercial product, and use this program to do it, and that product is successful, please send a sum of money of your choice to the address below.  */
end_comment

begin_comment
comment|/* $FreeBSD$ */
end_comment

begin_include
include|#
directive|include
file|"header.h"
end_include

begin_decl_stmt
name|char
name|inchar
argument_list|()
decl_stmt|,
modifier|*
name|instr
argument_list|()
decl_stmt|,
modifier|*
name|lookup
argument_list|()
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|table
block|{
name|int
name|key
decl_stmt|;
name|char
modifier|*
name|msg
decl_stmt|;
block|}
name|paritytable
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"NONE"
block|}
block|,
block|{
literal|4
block|,
literal|"ODD"
block|}
block|,
block|{
literal|5
block|,
literal|"EVEN"
block|}
block|,
block|{
operator|-
literal|1
block|,
literal|""
block|}
block|}
struct|,
name|nbitstable
index|[]
init|=
block|{
block|{
literal|1
block|,
literal|"8"
block|}
block|,
block|{
literal|2
block|,
literal|"7"
block|}
block|,
block|{
operator|-
literal|1
block|,
literal|""
block|}
block|}
struct|,
name|speedtable
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"50"
block|}
block|,
block|{
literal|8
block|,
literal|"75"
block|}
block|,
block|{
literal|16
block|,
literal|"110"
block|}
block|,
block|{
literal|24
block|,
literal|"132.5"
block|}
block|,
block|{
literal|32
block|,
literal|"150"
block|}
block|,
block|{
literal|40
block|,
literal|"200"
block|}
block|,
block|{
literal|48
block|,
literal|"300"
block|}
block|,
block|{
literal|56
block|,
literal|"600"
block|}
block|,
block|{
literal|64
block|,
literal|"1200"
block|}
block|,
block|{
literal|72
block|,
literal|"1800"
block|}
block|,
block|{
literal|80
block|,
literal|"2000"
block|}
block|,
block|{
literal|88
block|,
literal|"2400"
block|}
block|,
block|{
literal|96
block|,
literal|"3600"
block|}
block|,
block|{
literal|104
block|,
literal|"4800"
block|}
block|,
block|{
literal|112
block|,
literal|"9600"
block|}
block|,
block|{
literal|120
block|,
literal|"19200"
block|}
block|,
block|{
operator|-
literal|1
block|,
literal|""
block|}
block|}
struct|;
end_struct

begin_ifdef
ifdef|#
directive|ifdef
name|USEMYSTTY
end_ifdef

begin_ifndef
ifndef|#
directive|ifndef
name|stty
end_ifndef

begin_function
name|int
name|stty
parameter_list|(
name|fd
parameter_list|,
name|ptr
parameter_list|)
name|int
name|fd
decl_stmt|;
name|struct
name|sgttyb
modifier|*
name|ptr
decl_stmt|;
block|{
return|return
operator|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|TIOCSETP
argument_list|,
name|ptr
argument_list|)
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|gtty
end_ifndef

begin_function
name|int
name|gtty
parameter_list|(
name|fd
parameter_list|,
name|ptr
parameter_list|)
name|int
name|fd
decl_stmt|;
name|struct
name|sgttyb
modifier|*
name|ptr
decl_stmt|;
block|{
return|return
operator|(
name|ioctl
argument_list|(
name|fd
argument_list|,
name|TIOCGETP
argument_list|,
name|ptr
argument_list|)
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|main
parameter_list|()
block|{
name|int
name|menuchoice
decl_stmt|;
specifier|static
name|char
modifier|*
name|mainmenu
index|[]
init|=
block|{
literal|"Exit"
block|,
literal|"Test of cursor movements"
block|,
literal|"Test of screen features"
block|,
literal|"Test of character sets"
block|,
literal|"Test of double-sized characters"
block|,
literal|"Test of keyboard"
block|,
literal|"Test of terminal reports"
block|,
literal|"Test of VT52 mode"
block|,
literal|"Test of VT102 features (Insert/Delete Char/Line)"
block|,
literal|"Test of known bugs"
block|,
literal|"Test of reset and self-test"
block|,
literal|""
block|}
decl_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|initterminal
argument_list|(
name|setjmp
argument_list|(
name|intrenv
argument_list|)
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
operator|(
name|void
operator|*
operator|)
name|onbrk
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGTERM
argument_list|,
operator|(
name|void
operator|*
operator|)
name|onterm
argument_list|)
expr_stmt|;
name|reading
operator|=
literal|0
expr_stmt|;
else|#
directive|else
name|initterminal
argument_list|(
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
do|do
block|{
ifdef|#
directive|ifdef
name|SARG20
name|ttybin
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* set line to binary mode again. It's reset somehow!! */
endif|#
directive|endif
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"VT100 test program, version %s"
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|7
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Choose test type:"
argument_list|)
expr_stmt|;
name|menuchoice
operator|=
name|menu
argument_list|(
name|mainmenu
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|menuchoice
condition|)
block|{
case|case
literal|1
case|:
name|tst_movements
argument_list|()
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|tst_screen
argument_list|()
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|tst_characters
argument_list|()
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|tst_doublesize
argument_list|()
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|tst_keyboard
argument_list|()
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|tst_reports
argument_list|()
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|tst_vt52
argument_list|()
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|tst_insdel
argument_list|()
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|tst_bugs
argument_list|()
expr_stmt|;
break|break;
case|case
literal|10
case|:
name|tst_rst
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
do|while
condition|(
name|menuchoice
condition|)
do|;
name|bye
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|tst_movements
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:      CUF (Cursor Forward)      CUB (Cursor Backward)      CUD (Cursor Down)      IND (Index)  NEL (Next Line)      CUU (Cursor Up)        RI  (Reverse Index)      CUP (Cursor Position)  HVP (Horizontal and Vertical Position)      ED  (Erase in Display)      EL  (Erase in Line)      DECALN (Screen Alignment Display)<CR><BS>      Cursor control characters inside CSI sequences   */
name|int
name|i
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|,
name|pass
decl_stmt|,
name|width
decl_stmt|,
name|hlfxtra
decl_stmt|;
name|char
name|c
decl_stmt|,
modifier|*
name|ctext
init|=
literal|"This is a correct sentence"
decl_stmt|;
for|for
control|(
name|pass
operator|=
literal|0
init|;
name|pass
operator|<=
literal|1
condition|;
name|pass
operator|++
control|)
block|{
if|if
condition|(
name|pass
operator|==
literal|0
condition|)
block|{
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|width
operator|=
literal|80
expr_stmt|;
name|hlfxtra
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|width
operator|=
literal|132
expr_stmt|;
name|hlfxtra
operator|=
literal|26
expr_stmt|;
block|}
name|decaln
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|9
argument_list|,
literal|10
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|18
argument_list|,
literal|60
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|9
argument_list|,
literal|71
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|10
init|;
name|row
operator|<=
literal|16
condition|;
name|row
operator|++
control|)
block|{
name|cup
argument_list|(
name|row
argument_list|,
literal|10
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cup
argument_list|(
name|row
argument_list|,
literal|71
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|17
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
name|width
condition|;
name|col
operator|++
control|)
block|{
name|hvp
argument_list|(
literal|24
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|hvp
argument_list|(
literal|1
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|2
init|;
name|row
operator|<=
literal|23
condition|;
name|row
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|ind
argument_list|()
expr_stmt|;
block|}
name|cup
argument_list|(
literal|23
argument_list|,
name|width
operator|-
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|23
init|;
name|row
operator|>=
literal|2
condition|;
name|row
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|ri
argument_list|()
expr_stmt|;
block|}
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|2
init|;
name|row
operator|<=
literal|23
condition|;
name|row
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
name|row
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|row
operator|<
literal|10
condition|)
name|nel
argument_list|()
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|2
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|42
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|3
init|;
name|col
operator|<=
name|width
operator|-
literal|2
condition|;
name|col
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|23
argument_list|,
literal|70
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|42
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
name|width
operator|-
literal|2
init|;
name|col
operator|>=
literal|3
condition|;
name|col
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|cuu
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|cuu
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cuu
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|24
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|cud
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|cud
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cud
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|12
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|10
init|;
name|row
operator|<=
literal|15
condition|;
name|row
operator|++
control|)
block|{
for|for
control|(
name|col
operator|=
literal|12
operator|+
name|hlfxtra
init|;
name|col
operator|<=
literal|69
operator|+
name|hlfxtra
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
name|cud
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|58
argument_list|)
expr_stmt|;
block|}
name|cuu
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"The screen should be cleared,  and have an unbroken bor-"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|13
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"der of *'s and +'s around the edge,   and exactly in the"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|13
argument_list|,
literal|13
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"middle  there should be a frame of E's around this  text"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|13
operator|+
name|hlfxtra
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"with  one (1) free position around it.    "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of cursor-control characters inside ESC sequences."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Below should be two identical lines:"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"A B C D E F G H I J K L M N O P Q R S"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|20
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|64
operator|+
name|i
argument_list|)
expr_stmt|;
name|brcstr
argument_list|(
literal|"2\010"
argument_list|,
literal|'C'
argument_list|)
expr_stmt|;
comment|/* Two forward, one backspace */
block|}
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of leading zeros in ESC sequences."
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Two lines below you should see the sentence \"%s\"."
argument_list|,
name|ctext
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
operator|*
name|ctext
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"\033[00000000004;00000000%dH%c"
argument_list|,
name|col
argument_list|,
operator|*
name|ctext
operator|++
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|20
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_screen
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:      - DECSTBM (Set Top and Bottom Margins)      - TBC     (Tabulation Clear)      - HTS     (Horizontal Tabulation Set)      - SM RM   (Set/Reset mode): - 80/132 chars                                  - Origin: Realtive/absolute 				 - Scroll: Smooth/jump 				 - Wraparound      - SGR     (Select Graphic Rendition)      - SM RM   (Set/Reset Mode) - Inverse      - DECSC   (Save Cursor)      - DECRC   (Restore Cursor)   */
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|cset
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|,
name|down
decl_stmt|,
name|soft
decl_stmt|,
name|background
decl_stmt|;
specifier|static
name|char
modifier|*
name|tststr
init|=
literal|"*qx`"
decl_stmt|;
specifier|static
name|char
modifier|*
name|attr
index|[
literal|5
index|]
init|=
block|{
literal|";0"
block|,
literal|";1"
block|,
literal|";4"
block|,
literal|";5"
block|,
literal|";7"
block|}
decl_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?7"
argument_list|)
expr_stmt|;
comment|/* Wrap Around ON */
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|160
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?7"
argument_list|)
expr_stmt|;
comment|/* Wrap Around OFF */
name|cup
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|160
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?7"
argument_list|)
expr_stmt|;
comment|/* Wrap Around ON */
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"This should be three identical lines of *'s completely filling"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"the top of the screen without any empty lines between."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"(Test of WRAP AROUND mode setting.)"
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|tbc
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|78
condition|;
name|col
operator|+=
literal|3
control|)
block|{
name|cuf
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|hts
argument_list|()
expr_stmt|;
block|}
name|cup
argument_list|(
literal|1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|4
init|;
name|col
operator|<=
literal|78
condition|;
name|col
operator|+=
literal|6
control|)
block|{
name|tbc
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cuf
argument_list|(
literal|6
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|1
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|tbc
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|tbc
argument_list|(
literal|2
argument_list|)
expr_stmt|;
comment|/* no-op */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|78
condition|;
name|col
operator|+=
literal|6
control|)
name|printf
argument_list|(
literal|"\t*"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|2
init|;
name|col
operator|<=
literal|78
condition|;
name|col
operator|+=
literal|6
control|)
name|printf
argument_list|(
literal|"     *"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of TAB setting/resetting. These two lines"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"should look the same. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
for|for
control|(
name|background
operator|=
literal|0
init|;
name|background
operator|<=
literal|1
condition|;
name|background
operator|++
control|)
block|{
if|if
condition|(
name|background
condition|)
name|rm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
else|else
name|sm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* 132 cols */
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
comment|/* VT100 clears screen on SM3/RM3, but not obviously, so... */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tbc
argument_list|(
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|132
condition|;
name|col
operator|+=
literal|8
control|)
block|{
name|cuf
argument_list|(
literal|8
argument_list|)
expr_stmt|;
name|hts
argument_list|()
expr_stmt|;
block|}
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|130
condition|;
name|col
operator|+=
literal|10
control|)
name|printf
argument_list|(
literal|"1234567890"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"12"
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|3
init|;
name|row
operator|<=
literal|20
condition|;
name|row
operator|++
control|)
block|{
name|cup
argument_list|(
name|row
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is 132 column mode, %s background."
argument_list|,
name|background
condition|?
literal|"dark"
else|:
literal|"light"
argument_list|)
expr_stmt|;
block|}
name|holdit
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* 80 cols */
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
comment|/* VT100 clears screen on SM3/RM3, but not obviously, so... */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|80
condition|;
name|col
operator|+=
literal|10
control|)
name|printf
argument_list|(
literal|"1234567890"
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|3
init|;
name|row
operator|<=
literal|20
condition|;
name|row
operator|++
control|)
block|{
name|cup
argument_list|(
name|row
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is 80 column mode, %s background."
argument_list|,
name|background
condition|?
literal|"dark"
else|:
literal|"light"
argument_list|)
expr_stmt|;
block|}
name|holdit
argument_list|()
expr_stmt|;
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
comment|/* Origin mode (relative) */
for|for
control|(
name|soft
operator|=
operator|-
literal|1
init|;
name|soft
operator|<=
literal|0
condition|;
name|soft
operator|++
control|)
block|{
if|if
condition|(
name|soft
condition|)
name|sm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
else|else
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|12
init|;
name|row
operator|>=
literal|1
condition|;
name|row
operator|-=
literal|11
control|)
block|{
name|decstbm
argument_list|(
name|row
argument_list|,
literal|24
operator|-
name|row
operator|+
literal|1
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|down
operator|=
literal|0
init|;
name|down
operator|>=
operator|-
literal|1
condition|;
name|down
operator|--
control|)
block|{
if|if
condition|(
name|down
condition|)
name|cuu
argument_list|(
literal|24
argument_list|)
expr_stmt|;
else|else
name|cud
argument_list|(
literal|24
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|30
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s scroll %s region %d Line %d\n"
argument_list|,
name|soft
condition|?
literal|"Soft"
else|:
literal|"Jump"
argument_list|,
name|down
condition|?
literal|"down"
else|:
literal|"up"
argument_list|,
literal|2
operator|*
operator|(
literal|13
operator|-
name|row
operator|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|down
condition|)
block|{
name|ri
argument_list|()
expr_stmt|;
name|ri
argument_list|()
expr_stmt|;
block|}
block|}
block|}
name|holdit
argument_list|()
expr_stmt|;
block|}
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|decstbm
argument_list|(
literal|23
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nOrigin mode test. This line should be at the bottom of the screen."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"This line should be the one above the bottom of the screeen. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
comment|/* Origin mode (absolute) */
name|cup
argument_list|(
literal|24
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Origin mode test. This line should be at the bottom of the screen."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"This line should be at the top if the screen. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|1
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Graphic rendition test pattern:"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"vanilla"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|6
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|";4"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"underline"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|6
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|";1"
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"4"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold underline"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;5"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"blink"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;5;1"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold blink"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;4;5"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"underline blink"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1;4;5"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold underline blink"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"1;4;5;0;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;4;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"underline negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1;4;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold underline negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|16
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"1;4;;5;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"blink negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|16
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1;5;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold blink negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|18
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;4;5;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"underline blink negative"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|18
argument_list|,
literal|45
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0;1;4;5;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold underline blink negative"
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
comment|/* Inverse video off */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Dark background. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|sm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
comment|/* Inverse video */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Light background. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"normal"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bold"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|36
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"underscored"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|48
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"blinking"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"reversed"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"stars:"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"line:"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x'es:"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|16
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"diamonds:"
argument_list|)
expr_stmt|;
for|for
control|(
name|cset
operator|=
literal|0
init|;
name|cset
operator|<=
literal|3
condition|;
name|cset
operator|++
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|10
operator|+
literal|2
operator|*
name|cset
argument_list|,
literal|12
operator|+
literal|12
operator|*
name|i
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
name|attr
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|cset
operator|==
literal|0
operator|||
name|cset
operator|==
literal|2
condition|)
name|scs
argument_list|(
literal|0
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
else|else
name|scs
argument_list|(
literal|0
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|4
condition|;
name|j
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|tststr
index|[
name|cset
index|]
argument_list|)
expr_stmt|;
block|}
name|decsc
argument_list|()
expr_stmt|;
name|cup
argument_list|(
name|cset
operator|+
literal|1
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|scs
argument_list|(
literal|0
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
name|decrc
argument_list|()
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|4
condition|;
name|j
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|tststr
index|[
name|cset
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
name|scs
argument_list|(
literal|0
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|21
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of the SAVE/RESTORE CURSOR feature. There should"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"be ten characters of each flavour, and a rectangle"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"of 5 x 4 A's filling the top left of the screen."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_characters
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:      SCS    (Select character Set)   */
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|g
decl_stmt|,
name|cset
decl_stmt|;
name|char
name|chcode
index|[
literal|5
index|]
decl_stmt|,
modifier|*
name|setmsg
index|[
literal|5
index|]
decl_stmt|;
name|chcode
index|[
literal|0
index|]
operator|=
literal|'A'
expr_stmt|;
name|chcode
index|[
literal|1
index|]
operator|=
literal|'B'
expr_stmt|;
name|chcode
index|[
literal|2
index|]
operator|=
literal|'0'
expr_stmt|;
name|chcode
index|[
literal|3
index|]
operator|=
literal|'1'
expr_stmt|;
name|chcode
index|[
literal|4
index|]
operator|=
literal|'2'
expr_stmt|;
name|setmsg
index|[
literal|0
index|]
operator|=
literal|"UK / national"
expr_stmt|;
name|setmsg
index|[
literal|1
index|]
operator|=
literal|"US ASCII"
expr_stmt|;
name|setmsg
index|[
literal|2
index|]
operator|=
literal|"Special graphics and line drawing"
expr_stmt|;
name|setmsg
index|[
literal|3
index|]
operator|=
literal|"Alternate character ROM standard characters"
expr_stmt|;
name|setmsg
index|[
literal|4
index|]
operator|=
literal|"Alternate character ROM special graphics"
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Selected as G0 (with SI)"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|48
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Selected as G1 (with SO)"
argument_list|)
expr_stmt|;
for|for
control|(
name|cset
operator|=
literal|0
init|;
name|cset
operator|<=
literal|4
condition|;
name|cset
operator|++
control|)
block|{
name|scs
argument_list|(
literal|1
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|3
operator|+
literal|4
operator|*
name|cset
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Character set %c (%s)"
argument_list|,
name|chcode
index|[
name|cset
index|]
argument_list|,
name|setmsg
index|[
name|cset
index|]
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
for|for
control|(
name|g
operator|=
literal|0
init|;
name|g
operator|<=
literal|1
condition|;
name|g
operator|++
control|)
block|{
name|scs
argument_list|(
name|g
argument_list|,
name|chcode
index|[
name|cset
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|3
operator|+
literal|4
operator|*
name|cset
operator|+
name|i
argument_list|,
literal|10
operator|+
literal|38
operator|*
name|g
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|31
condition|;
name|j
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|i
operator|*
literal|32
operator|+
name|j
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
name|scs
argument_list|(
literal|1
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|24
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"These are the installed character sets. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_doublesize
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:      DECSWL  (Single Width Line)      DECDWL  (Double Width Line)      DECDHL  (Double Height Line) (also implicit double width)   */
name|int
name|col
decl_stmt|,
name|i
decl_stmt|,
name|w
decl_stmt|,
name|w1
decl_stmt|;
comment|/* Print the test pattern in both 80 and 132 character width  */
for|for
control|(
name|w
operator|=
literal|0
init|;
name|w
operator|<=
literal|1
condition|;
name|w
operator|++
control|)
block|{
name|w1
operator|=
literal|13
operator|*
name|w
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
condition|)
block|{
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"132 column mode"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" 80 column mode"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|5
argument_list|,
literal|3
operator|+
literal|2
operator|*
name|w1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"v------- left margin"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|7
argument_list|,
literal|3
operator|+
literal|2
operator|*
name|w1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is a normal-sized line"
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|9
argument_list|,
literal|2
operator|+
name|w1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is a Double-width line"
argument_list|)
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|11
argument_list|,
literal|2
operator|+
name|w1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is a Double-width-and-height line"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|2
operator|+
name|w1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is a Double-width-and-height line"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|2
operator|+
name|w1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is another such line"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|2
operator|+
name|w1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is another such line"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|17
argument_list|,
literal|3
operator|+
literal|2
operator|*
name|w1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"^------- left margin"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|21
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is not a double-width line"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|21
argument_list|,
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
name|printf
argument_list|(
literal|"**is**"
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"is not"
argument_list|)
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
block|}
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
block|}
comment|/* Set vanilla tabs for next test */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tbc
argument_list|(
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|132
condition|;
name|col
operator|+=
literal|8
control|)
block|{
name|cuf
argument_list|(
literal|8
argument_list|)
expr_stmt|;
name|hts
argument_list|()
expr_stmt|;
block|}
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scs
argument_list|(
literal|0
argument_list|,
literal|'0'
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|9
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"lqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x%c%c%c%c%cx"
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|11
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x%c%c%c%c%cx"
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x%c%c%c%c%cx"
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|13
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x%c%c%c%c%cx"
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|14
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x                                      x"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"x                                      x"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|16
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|17
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdhl
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"mqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj"
argument_list|)
expr_stmt|;
name|scs
argument_list|(
literal|0
argument_list|,
literal|'B'
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"1;5"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"* The mad programmer strikes again * "
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|13
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"* The mad programmer strikes again *"
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Another test pattern...  a frame with blinking bold text,"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"all in double-height double-width size. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|8
argument_list|,
literal|24
argument_list|)
expr_stmt|;
comment|/* Absolute origin mode, so cursor is set at (1,1) */
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|12
condition|;
name|i
operator|++
control|)
name|ri
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* No scroll region	*/
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Exactly half of the box should remain. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_keyboard
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:      - DECLL   (Load LEDs)      - Keyboard return messages      - SM RM   (Set/Reset Mode) - Cursor Keys                                 - Auto repeat      - DECKPAM (Keypad Application Mode)      - DECKPNM (Keypad Numeric Mode)  The standard VT100 keayboard layout:                                                          UP   DN   LE  RI  ESC   1!   2@   3#   4$   5%   6^   7&   8*   9(   0)   -_   =+   `~  BS  TAB*    qQ   wW   eE   rR   tT   yY   uU   iI   oO   pP   [{   ]}      DEL  **   **   aA   sS   dD   fF   gG   hH   jJ   kK   lL   ;:   ,"   RETN  \|  **   ****   zZ   xX   cC   vV   bB   nN   mM   ,<   .>   /?   ****   LF               ****************SPACE BAR****************                                                             PF1 PF2 PF3 PF4                                                             *7* *8* *9* *-*                                                             *4* *5* *6* *,*                                                             *1* *2* *3*                                                             ***0*** *.* ENT */
name|char
modifier|*
name|ledmsg
index|[
literal|6
index|]
decl_stmt|,
modifier|*
name|ledseq
index|[
literal|6
index|]
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|okflag
decl_stmt|;
name|int
name|kblayout
decl_stmt|;
name|int
name|ckeymode
decl_stmt|;
name|int
name|fkeymode
decl_stmt|;
name|char
name|kbdc
decl_stmt|;
name|char
modifier|*
name|kbds
init|=
literal|" "
decl_stmt|;
name|char
modifier|*
name|curkeystr
decl_stmt|,
modifier|*
name|fnkeystr
decl_stmt|,
modifier|*
name|abmstr
decl_stmt|;
name|char
name|arptstring
index|[
literal|500
index|]
decl_stmt|;
specifier|static
struct|struct
name|key
block|{
name|char
name|c
decl_stmt|;
name|int
name|row
decl_stmt|;
name|int
name|col
decl_stmt|;
name|char
modifier|*
name|symbol
decl_stmt|;
block|}
name|keytab
index|[]
init|=
block|{
block|{
literal|27
block|,
literal|1
block|,
literal|0
block|,
literal|"ESC"
block|}
block|,
block|{
literal|'1'
block|,
literal|1
block|,
literal|6
block|,
literal|"1"
block|}
block|,
block|{
literal|'!'
block|,
literal|1
block|,
literal|7
block|,
literal|"!"
block|}
block|,
block|{
literal|'2'
block|,
literal|1
block|,
literal|11
block|,
literal|"2"
block|}
block|,
block|{
literal|'@'
block|,
literal|1
block|,
literal|12
block|,
literal|"@"
block|}
block|,
block|{
literal|'3'
block|,
literal|1
block|,
literal|16
block|,
literal|"3"
block|}
block|,
block|{
literal|'#'
block|,
literal|1
block|,
literal|17
block|,
literal|"#"
block|}
block|,
block|{
literal|'4'
block|,
literal|1
block|,
literal|21
block|,
literal|"4"
block|}
block|,
block|{
literal|'$'
block|,
literal|1
block|,
literal|22
block|,
literal|"$"
block|}
block|,
block|{
literal|'5'
block|,
literal|1
block|,
literal|26
block|,
literal|"5"
block|}
block|,
block|{
literal|'%'
block|,
literal|1
block|,
literal|27
block|,
literal|"%"
block|}
block|,
block|{
literal|'6'
block|,
literal|1
block|,
literal|31
block|,
literal|"6"
block|}
block|,
block|{
literal|'^'
block|,
literal|1
block|,
literal|32
block|,
literal|"^"
block|}
block|,
block|{
literal|'7'
block|,
literal|1
block|,
literal|36
block|,
literal|"7"
block|}
block|,
block|{
literal|'&'
block|,
literal|1
block|,
literal|37
block|,
literal|"&"
block|}
block|,
block|{
literal|'8'
block|,
literal|1
block|,
literal|41
block|,
literal|"8"
block|}
block|,
block|{
literal|'*'
block|,
literal|1
block|,
literal|42
block|,
literal|"*"
block|}
block|,
block|{
literal|'9'
block|,
literal|1
block|,
literal|46
block|,
literal|"9"
block|}
block|,
block|{
literal|'('
block|,
literal|1
block|,
literal|47
block|,
literal|"("
block|}
block|,
block|{
literal|'0'
block|,
literal|1
block|,
literal|51
block|,
literal|"0"
block|}
block|,
block|{
literal|')'
block|,
literal|1
block|,
literal|52
block|,
literal|")"
block|}
block|,
block|{
literal|'-'
block|,
literal|1
block|,
literal|56
block|,
literal|"-"
block|}
block|,
block|{
literal|'_'
block|,
literal|1
block|,
literal|57
block|,
literal|"_"
block|}
block|,
block|{
literal|'='
block|,
literal|1
block|,
literal|61
block|,
literal|"="
block|}
block|,
block|{
literal|'+'
block|,
literal|1
block|,
literal|62
block|,
literal|"+"
block|}
block|,
block|{
literal|'`'
block|,
literal|1
block|,
literal|66
block|,
literal|"`"
block|}
block|,
block|{
literal|'~'
block|,
literal|1
block|,
literal|67
block|,
literal|"~"
block|}
block|,
block|{
literal|8
block|,
literal|1
block|,
literal|70
block|,
literal|"BS"
block|}
block|,
block|{
literal|9
block|,
literal|2
block|,
literal|0
block|,
literal|" TAB "
block|}
block|,
block|{
literal|'q'
block|,
literal|2
block|,
literal|8
block|,
literal|"q"
block|}
block|,
block|{
literal|'Q'
block|,
literal|2
block|,
literal|9
block|,
literal|"Q"
block|}
block|,
block|{
literal|'w'
block|,
literal|2
block|,
literal|13
block|,
literal|"w"
block|}
block|,
block|{
literal|'W'
block|,
literal|2
block|,
literal|14
block|,
literal|"W"
block|}
block|,
block|{
literal|'e'
block|,
literal|2
block|,
literal|18
block|,
literal|"e"
block|}
block|,
block|{
literal|'E'
block|,
literal|2
block|,
literal|19
block|,
literal|"E"
block|}
block|,
block|{
literal|'r'
block|,
literal|2
block|,
literal|23
block|,
literal|"r"
block|}
block|,
block|{
literal|'R'
block|,
literal|2
block|,
literal|24
block|,
literal|"R"
block|}
block|,
block|{
literal|'t'
block|,
literal|2
block|,
literal|28
block|,
literal|"t"
block|}
block|,
block|{
literal|'T'
block|,
literal|2
block|,
literal|29
block|,
literal|"T"
block|}
block|,
block|{
literal|'y'
block|,
literal|2
block|,
literal|33
block|,
literal|"y"
block|}
block|,
block|{
literal|'Y'
block|,
literal|2
block|,
literal|34
block|,
literal|"Y"
block|}
block|,
block|{
literal|'u'
block|,
literal|2
block|,
literal|38
block|,
literal|"u"
block|}
block|,
block|{
literal|'U'
block|,
literal|2
block|,
literal|39
block|,
literal|"U"
block|}
block|,
block|{
literal|'i'
block|,
literal|2
block|,
literal|43
block|,
literal|"i"
block|}
block|,
block|{
literal|'I'
block|,
literal|2
block|,
literal|44
block|,
literal|"I"
block|}
block|,
block|{
literal|'o'
block|,
literal|2
block|,
literal|48
block|,
literal|"o"
block|}
block|,
block|{
literal|'O'
block|,
literal|2
block|,
literal|49
block|,
literal|"O"
block|}
block|,
block|{
literal|'p'
block|,
literal|2
block|,
literal|53
block|,
literal|"p"
block|}
block|,
block|{
literal|'P'
block|,
literal|2
block|,
literal|54
block|,
literal|"P"
block|}
block|,
block|{
literal|'['
block|,
literal|2
block|,
literal|58
block|,
literal|"["
block|}
block|,
block|{
literal|'{'
block|,
literal|2
block|,
literal|59
block|,
literal|"{"
block|}
block|,
block|{
literal|']'
block|,
literal|2
block|,
literal|63
block|,
literal|"]"
block|}
block|,
block|{
literal|'}'
block|,
literal|2
block|,
literal|64
block|,
literal|"}"
block|}
block|,
block|{
literal|127
block|,
literal|2
block|,
literal|71
block|,
literal|"DEL"
block|}
block|,
block|{
literal|'a'
block|,
literal|3
block|,
literal|10
block|,
literal|"a"
block|}
block|,
block|{
literal|'A'
block|,
literal|3
block|,
literal|11
block|,
literal|"A"
block|}
block|,
block|{
literal|'s'
block|,
literal|3
block|,
literal|15
block|,
literal|"s"
block|}
block|,
block|{
literal|'S'
block|,
literal|3
block|,
literal|16
block|,
literal|"S"
block|}
block|,
block|{
literal|'d'
block|,
literal|3
block|,
literal|20
block|,
literal|"d"
block|}
block|,
block|{
literal|'D'
block|,
literal|3
block|,
literal|21
block|,
literal|"D"
block|}
block|,
block|{
literal|'f'
block|,
literal|3
block|,
literal|25
block|,
literal|"f"
block|}
block|,
block|{
literal|'F'
block|,
literal|3
block|,
literal|26
block|,
literal|"F"
block|}
block|,
block|{
literal|'g'
block|,
literal|3
block|,
literal|30
block|,
literal|"g"
block|}
block|,
block|{
literal|'G'
block|,
literal|3
block|,
literal|31
block|,
literal|"G"
block|}
block|,
block|{
literal|'h'
block|,
literal|3
block|,
literal|35
block|,
literal|"h"
block|}
block|,
block|{
literal|'H'
block|,
literal|3
block|,
literal|36
block|,
literal|"H"
block|}
block|,
block|{
literal|'j'
block|,
literal|3
block|,
literal|40
block|,
literal|"j"
block|}
block|,
block|{
literal|'J'
block|,
literal|3
block|,
literal|41
block|,
literal|"J"
block|}
block|,
block|{
literal|'k'
block|,
literal|3
block|,
literal|45
block|,
literal|"k"
block|}
block|,
block|{
literal|'K'
block|,
literal|3
block|,
literal|46
block|,
literal|"K"
block|}
block|,
block|{
literal|'l'
block|,
literal|3
block|,
literal|50
block|,
literal|"l"
block|}
block|,
block|{
literal|'L'
block|,
literal|3
block|,
literal|51
block|,
literal|"L"
block|}
block|,
block|{
literal|';'
block|,
literal|3
block|,
literal|55
block|,
literal|";"
block|}
block|,
block|{
literal|':'
block|,
literal|3
block|,
literal|56
block|,
literal|":"
block|}
block|,
block|{
literal|'\''
block|,
literal|3
block|,
literal|60
block|,
literal|"'"
block|}
block|,
block|{
literal|'"'
block|,
literal|3
block|,
literal|61
block|,
literal|"\""
block|}
block|,
block|{
literal|13
block|,
literal|3
block|,
literal|65
block|,
literal|"RETN"
block|}
block|,
block|{
literal|'\\'
block|,
literal|3
block|,
literal|71
block|,
literal|"\\"
block|}
block|,
block|{
literal|'|'
block|,
literal|3
block|,
literal|72
block|,
literal|"|"
block|}
block|,
block|{
literal|'z'
block|,
literal|4
block|,
literal|12
block|,
literal|"z"
block|}
block|,
block|{
literal|'Z'
block|,
literal|4
block|,
literal|13
block|,
literal|"Z"
block|}
block|,
block|{
literal|'x'
block|,
literal|4
block|,
literal|17
block|,
literal|"x"
block|}
block|,
block|{
literal|'X'
block|,
literal|4
block|,
literal|18
block|,
literal|"X"
block|}
block|,
block|{
literal|'c'
block|,
literal|4
block|,
literal|22
block|,
literal|"c"
block|}
block|,
block|{
literal|'C'
block|,
literal|4
block|,
literal|23
block|,
literal|"C"
block|}
block|,
block|{
literal|'v'
block|,
literal|4
block|,
literal|27
block|,
literal|"v"
block|}
block|,
block|{
literal|'V'
block|,
literal|4
block|,
literal|28
block|,
literal|"V"
block|}
block|,
block|{
literal|'b'
block|,
literal|4
block|,
literal|32
block|,
literal|"b"
block|}
block|,
block|{
literal|'B'
block|,
literal|4
block|,
literal|33
block|,
literal|"B"
block|}
block|,
block|{
literal|'n'
block|,
literal|4
block|,
literal|37
block|,
literal|"n"
block|}
block|,
block|{
literal|'N'
block|,
literal|4
block|,
literal|38
block|,
literal|"N"
block|}
block|,
block|{
literal|'m'
block|,
literal|4
block|,
literal|42
block|,
literal|"m"
block|}
block|,
block|{
literal|'M'
block|,
literal|4
block|,
literal|43
block|,
literal|"M"
block|}
block|,
block|{
literal|','
block|,
literal|4
block|,
literal|47
block|,
literal|","
block|}
block|,
block|{
literal|'<'
block|,
literal|4
block|,
literal|48
block|,
literal|"<"
block|}
block|,
block|{
literal|'.'
block|,
literal|4
block|,
literal|52
block|,
literal|"."
block|}
block|,
block|{
literal|'>'
block|,
literal|4
block|,
literal|53
block|,
literal|">"
block|}
block|,
block|{
literal|'/'
block|,
literal|4
block|,
literal|57
block|,
literal|"/"
block|}
block|,
block|{
literal|'?'
block|,
literal|4
block|,
literal|58
block|,
literal|"?"
block|}
block|,
block|{
literal|10
block|,
literal|4
block|,
literal|69
block|,
literal|"LF"
block|}
block|,
block|{
literal|' '
block|,
literal|5
block|,
literal|13
block|,
literal|"                SPACE BAR                "
block|}
block|,
block|{
literal|'\0'
block|,
literal|0
block|,
literal|0
block|,
literal|""
block|}
block|}
struct|;
specifier|static
struct|struct
name|natkey
block|{
name|char
name|natc
decl_stmt|;
name|int
name|natrow
decl_stmt|;
name|int
name|natcol
decl_stmt|;
name|char
modifier|*
name|natsymbol
decl_stmt|;
block|}
name|natkeytab
index|[]
index|[
literal|29
index|]
init|=
block|{
block|{
block|{
literal|'"'
block|,
literal|1
block|,
literal|12
block|,
literal|"\""
block|}
block|,
block|{
literal|'&'
block|,
literal|1
block|,
literal|32
block|,
literal|"&"
block|}
block|,
block|{
literal|'/'
block|,
literal|1
block|,
literal|37
block|,
literal|"/"
block|}
block|,
block|{
literal|'('
block|,
literal|1
block|,
literal|42
block|,
literal|"("
block|}
block|,
block|{
literal|')'
block|,
literal|1
block|,
literal|47
block|,
literal|")"
block|}
block|,
block|{
literal|'='
block|,
literal|1
block|,
literal|52
block|,
literal|"="
block|}
block|,
block|{
literal|'+'
block|,
literal|1
block|,
literal|56
block|,
literal|"+"
block|}
block|,
block|{
literal|'?'
block|,
literal|1
block|,
literal|57
block|,
literal|"?"
block|}
block|,
block|{
literal|'`'
block|,
literal|1
block|,
literal|61
block|,
literal|"`"
block|}
block|,
block|{
literal|'@'
block|,
literal|1
block|,
literal|62
block|,
literal|"@"
block|}
block|,
block|{
literal|'<'
block|,
literal|1
block|,
literal|66
block|,
literal|"<"
block|}
block|,
block|{
literal|'>'
block|,
literal|1
block|,
literal|67
block|,
literal|">"
block|}
block|,
block|{
literal|'}'
block|,
literal|2
block|,
literal|58
block|,
literal|"}"
block|}
block|,
block|{
literal|']'
block|,
literal|2
block|,
literal|59
block|,
literal|"]"
block|}
block|,
block|{
literal|'^'
block|,
literal|2
block|,
literal|63
block|,
literal|"^"
block|}
block|,
block|{
literal|'~'
block|,
literal|2
block|,
literal|64
block|,
literal|"~"
block|}
block|,
block|{
literal|'|'
block|,
literal|3
block|,
literal|55
block|,
literal|"|"
block|}
block|,
block|{
literal|'\\'
block|,
literal|3
block|,
literal|56
block|,
literal|"\\"
block|}
block|,
block|{
literal|'{'
block|,
literal|3
block|,
literal|60
block|,
literal|"{"
block|}
block|,
block|{
literal|'['
block|,
literal|3
block|,
literal|61
block|,
literal|"["
block|}
block|,
block|{
literal|'\''
block|,
literal|3
block|,
literal|71
block|,
literal|"'"
block|}
block|,
block|{
literal|'*'
block|,
literal|3
block|,
literal|72
block|,
literal|"*"
block|}
block|,
block|{
literal|','
block|,
literal|4
block|,
literal|47
block|,
literal|","
block|}
block|,
block|{
literal|';'
block|,
literal|4
block|,
literal|48
block|,
literal|";"
block|}
block|,
block|{
literal|'.'
block|,
literal|4
block|,
literal|52
block|,
literal|"."
block|}
block|,
block|{
literal|':'
block|,
literal|4
block|,
literal|53
block|,
literal|":"
block|}
block|,
block|{
literal|'-'
block|,
literal|4
block|,
literal|57
block|,
literal|"-"
block|}
block|,
block|{
literal|'_'
block|,
literal|4
block|,
literal|58
block|,
literal|"_"
block|}
block|,
block|{
literal|'\0'
block|,
literal|0
block|,
literal|0
block|,
literal|""
block|}
block|}
block|,
block|{
block|{
literal|'"'
block|,
literal|1
block|,
literal|12
block|,
literal|"\""
block|}
block|,
block|{
literal|'&'
block|,
literal|1
block|,
literal|32
block|,
literal|"&"
block|}
block|,
block|{
literal|'/'
block|,
literal|1
block|,
literal|37
block|,
literal|"/"
block|}
block|,
block|{
literal|'('
block|,
literal|1
block|,
literal|42
block|,
literal|"("
block|}
block|,
block|{
literal|')'
block|,
literal|1
block|,
literal|47
block|,
literal|")"
block|}
block|,
block|{
literal|'='
block|,
literal|1
block|,
literal|52
block|,
literal|"="
block|}
block|,
block|{
literal|'+'
block|,
literal|1
block|,
literal|56
block|,
literal|"+"
block|}
block|,
block|{
literal|'?'
block|,
literal|1
block|,
literal|57
block|,
literal|"?"
block|}
block|,
block|{
literal|'`'
block|,
literal|1
block|,
literal|61
block|,
literal|"`"
block|}
block|,
block|{
literal|'@'
block|,
literal|1
block|,
literal|62
block|,
literal|"@"
block|}
block|,
block|{
literal|'<'
block|,
literal|1
block|,
literal|66
block|,
literal|"<"
block|}
block|,
block|{
literal|'>'
block|,
literal|1
block|,
literal|67
block|,
literal|">"
block|}
block|,
block|{
literal|'}'
block|,
literal|2
block|,
literal|58
block|,
literal|"}"
block|}
block|,
block|{
literal|']'
block|,
literal|2
block|,
literal|59
block|,
literal|"]"
block|}
block|,
block|{
literal|'~'
block|,
literal|2
block|,
literal|63
block|,
literal|"~"
block|}
block|,
block|{
literal|'^'
block|,
literal|2
block|,
literal|64
block|,
literal|"^"
block|}
block|,
block|{
literal|'|'
block|,
literal|3
block|,
literal|55
block|,
literal|"|"
block|}
block|,
block|{
literal|'\\'
block|,
literal|3
block|,
literal|56
block|,
literal|"\\"
block|}
block|,
block|{
literal|'{'
block|,
literal|3
block|,
literal|60
block|,
literal|"{"
block|}
block|,
block|{
literal|'['
block|,
literal|3
block|,
literal|61
block|,
literal|"["
block|}
block|,
block|{
literal|'\''
block|,
literal|3
block|,
literal|71
block|,
literal|"'"
block|}
block|,
block|{
literal|'*'
block|,
literal|3
block|,
literal|72
block|,
literal|"*"
block|}
block|,
block|{
literal|','
block|,
literal|4
block|,
literal|47
block|,
literal|","
block|}
block|,
block|{
literal|';'
block|,
literal|4
block|,
literal|48
block|,
literal|";"
block|}
block|,
block|{
literal|'.'
block|,
literal|4
block|,
literal|52
block|,
literal|"."
block|}
block|,
block|{
literal|':'
block|,
literal|4
block|,
literal|53
block|,
literal|":"
block|}
block|,
block|{
literal|'-'
block|,
literal|4
block|,
literal|57
block|,
literal|"-"
block|}
block|,
block|{
literal|'_'
block|,
literal|4
block|,
literal|58
block|,
literal|"_"
block|}
block|,
block|{
literal|'\0'
block|,
literal|0
block|,
literal|0
block|,
literal|""
block|}
block|}
block|}
struct|;
specifier|static
struct|struct
name|curkey
block|{
name|char
modifier|*
name|curkeymsg
index|[
literal|3
index|]
decl_stmt|;
name|int
name|curkeyrow
decl_stmt|;
name|int
name|curkeycol
decl_stmt|;
name|char
modifier|*
name|curkeysymbol
decl_stmt|;
name|char
modifier|*
name|curkeyname
decl_stmt|;
block|}
name|curkeytab
index|[]
init|=
block|{
comment|/* A Reset, A Set,  VT52  */
block|{
block|{
literal|"\033[A"
block|,
literal|"\033OA"
block|,
literal|"\033A"
block|}
block|,
literal|0
block|,
literal|56
block|,
literal|"UP"
block|,
literal|"Up arrow"
block|}
block|,
block|{
block|{
literal|"\033[B"
block|,
literal|"\033OB"
block|,
literal|"\033B"
block|}
block|,
literal|0
block|,
literal|61
block|,
literal|"DN"
block|,
literal|"Down arrow"
block|}
block|,
block|{
block|{
literal|"\033[D"
block|,
literal|"\033OD"
block|,
literal|"\033D"
block|}
block|,
literal|0
block|,
literal|66
block|,
literal|"LT"
block|,
literal|"Left arrow"
block|}
block|,
block|{
block|{
literal|"\033[C"
block|,
literal|"\033OC"
block|,
literal|"\033C"
block|}
block|,
literal|0
block|,
literal|71
block|,
literal|"RT"
block|,
literal|"Right arrow"
block|}
block|,
block|{
block|{
literal|""
block|,
literal|""
block|,
literal|""
block|}
block|,
literal|0
block|,
literal|0
block|,
literal|""
block|,
literal|""
block|}
block|}
struct|;
specifier|static
struct|struct
name|fnkey
block|{
name|char
modifier|*
name|fnkeymsg
index|[
literal|4
index|]
decl_stmt|;
name|int
name|fnkeyrow
decl_stmt|;
name|int
name|fnkeycol
decl_stmt|;
name|char
modifier|*
name|fnkeysymbol
decl_stmt|;
name|char
modifier|*
name|fnkeyname
decl_stmt|;
block|}
name|fnkeytab
index|[]
init|=
block|{
comment|/* ANSI-num,ANSI-app,VT52-nu,VT52-ap,  r, c,  symb   name         */
block|{
block|{
literal|"\033OP"
block|,
literal|"\033OP"
block|,
literal|"\033P"
block|,
literal|"\033P"
block|}
block|,
literal|6
block|,
literal|59
block|,
literal|"PF1"
block|,
literal|"PF1"
block|}
block|,
block|{
block|{
literal|"\033OQ"
block|,
literal|"\033OQ"
block|,
literal|"\033Q"
block|,
literal|"\033Q"
block|}
block|,
literal|6
block|,
literal|63
block|,
literal|"PF2"
block|,
literal|"PF2"
block|}
block|,
block|{
block|{
literal|"\033OR"
block|,
literal|"\033OR"
block|,
literal|"\033R"
block|,
literal|"\033R"
block|}
block|,
literal|6
block|,
literal|67
block|,
literal|"PF3"
block|,
literal|"PF3"
block|}
block|,
block|{
block|{
literal|"\033OS"
block|,
literal|"\033OS"
block|,
literal|"\033S"
block|,
literal|"\033S"
block|}
block|,
literal|6
block|,
literal|71
block|,
literal|"PF4"
block|,
literal|"PF4"
block|}
block|,
block|{
block|{
literal|"7"
block|,
literal|"\033Ow"
block|,
literal|"7"
block|,
literal|"\033?w"
block|}
block|,
literal|7
block|,
literal|59
block|,
literal|" 7 "
block|,
literal|"Numeric 7"
block|}
block|,
block|{
block|{
literal|"8"
block|,
literal|"\033Ox"
block|,
literal|"8"
block|,
literal|"\033?x"
block|}
block|,
literal|7
block|,
literal|63
block|,
literal|" 8 "
block|,
literal|"Numeric 8"
block|}
block|,
block|{
block|{
literal|"9"
block|,
literal|"\033Oy"
block|,
literal|"9"
block|,
literal|"\033?y"
block|}
block|,
literal|7
block|,
literal|67
block|,
literal|" 9 "
block|,
literal|"Numeric 9"
block|}
block|,
block|{
block|{
literal|"-"
block|,
literal|"\033Om"
block|,
literal|"-"
block|,
literal|"\033?m"
block|}
block|,
literal|7
block|,
literal|71
block|,
literal|" - "
block|,
literal|"Minus"
block|}
block|,
block|{
block|{
literal|"4"
block|,
literal|"\033Ot"
block|,
literal|"4"
block|,
literal|"\033?t"
block|}
block|,
literal|8
block|,
literal|59
block|,
literal|" 4 "
block|,
literal|"Numeric 4"
block|}
block|,
block|{
block|{
literal|"5"
block|,
literal|"\033Ou"
block|,
literal|"5"
block|,
literal|"\033?u"
block|}
block|,
literal|8
block|,
literal|63
block|,
literal|" 5 "
block|,
literal|"Numeric 5"
block|}
block|,
block|{
block|{
literal|"6"
block|,
literal|"\033Ov"
block|,
literal|"6"
block|,
literal|"\033?v"
block|}
block|,
literal|8
block|,
literal|67
block|,
literal|" 6 "
block|,
literal|"Numeric 6"
block|}
block|,
block|{
block|{
literal|","
block|,
literal|"\033Ol"
block|,
literal|","
block|,
literal|"\033?l"
block|}
block|,
literal|8
block|,
literal|71
block|,
literal|" , "
block|,
literal|"Comma"
block|}
block|,
block|{
block|{
literal|"1"
block|,
literal|"\033Oq"
block|,
literal|"1"
block|,
literal|"\033?q"
block|}
block|,
literal|9
block|,
literal|59
block|,
literal|" 1 "
block|,
literal|"Numeric 1"
block|}
block|,
block|{
block|{
literal|"2"
block|,
literal|"\033Or"
block|,
literal|"2"
block|,
literal|"\033?r"
block|}
block|,
literal|9
block|,
literal|63
block|,
literal|" 2 "
block|,
literal|"Numeric 2"
block|}
block|,
block|{
block|{
literal|"3"
block|,
literal|"\033Os"
block|,
literal|"3"
block|,
literal|"\033?s"
block|}
block|,
literal|9
block|,
literal|67
block|,
literal|" 3 "
block|,
literal|"Numeric 3"
block|}
block|,
block|{
block|{
literal|"0"
block|,
literal|"\033Op"
block|,
literal|"0"
block|,
literal|"\033?p"
block|}
block|,
literal|10
block|,
literal|59
block|,
literal|"   O   "
block|,
literal|"Numeric 0"
block|}
block|,
block|{
block|{
literal|"."
block|,
literal|"\033On"
block|,
literal|"."
block|,
literal|"\033?n"
block|}
block|,
literal|10
block|,
literal|67
block|,
literal|" . "
block|,
literal|"Point"
block|}
block|,
block|{
block|{
literal|"\015"
block|,
literal|"\033OM"
block|,
literal|"\015"
block|,
literal|"\033?M"
block|}
block|,
literal|10
block|,
literal|71
block|,
literal|"ENT"
block|,
literal|"ENTER"
block|}
block|,
block|{
block|{
literal|""
block|,
literal|""
block|,
literal|""
block|,
literal|""
block|}
block|,
literal|0
block|,
literal|0
block|,
literal|""
block|,
literal|""
block|}
block|}
struct|;
specifier|static
struct|struct
name|ckey
block|{
name|int
name|ccount
decl_stmt|;
name|char
modifier|*
name|csymbol
decl_stmt|;
block|}
name|ckeytab
index|[]
init|=
block|{
block|{
literal|0
block|,
literal|"NUL (CTRL-@ or CTRL-Space)"
block|}
block|,
block|{
literal|0
block|,
literal|"SOH (CTRL-A)"
block|}
block|,
block|{
literal|0
block|,
literal|"STX (CTRL-B)"
block|}
block|,
block|{
literal|0
block|,
literal|"ETX (CTRL-C)"
block|}
block|,
block|{
literal|0
block|,
literal|"EOT (CTRL-D)"
block|}
block|,
block|{
literal|0
block|,
literal|"ENQ (CTRL-E)"
block|}
block|,
block|{
literal|0
block|,
literal|"ACK (CTRL-F)"
block|}
block|,
block|{
literal|0
block|,
literal|"BEL (CTRL-G)"
block|}
block|,
block|{
literal|0
block|,
literal|"BS  (CTRL-H) (BACK SPACE)"
block|}
block|,
block|{
literal|0
block|,
literal|"HT  (CTRL-I) (TAB)"
block|}
block|,
block|{
literal|0
block|,
literal|"LF  (CTRL-J) (LINE FEED)"
block|}
block|,
block|{
literal|0
block|,
literal|"VT  (CTRL-K)"
block|}
block|,
block|{
literal|0
block|,
literal|"FF  (CTRL-L)"
block|}
block|,
block|{
literal|0
block|,
literal|"CR  (CTRL-M) (RETURN)"
block|}
block|,
block|{
literal|0
block|,
literal|"SO  (CTRL-N)"
block|}
block|,
block|{
literal|0
block|,
literal|"SI  (CTRL-O)"
block|}
block|,
block|{
literal|0
block|,
literal|"DLE (CTRL-P)"
block|}
block|,
block|{
literal|0
block|,
literal|"DC1 (CTRL-Q) (X-On)"
block|}
block|,
block|{
literal|0
block|,
literal|"DC2 (CTRL-R)"
block|}
block|,
block|{
literal|0
block|,
literal|"DC3 (CTRL-S) (X-Off)"
block|}
block|,
block|{
literal|0
block|,
literal|"DC4 (CTRL-T)"
block|}
block|,
block|{
literal|0
block|,
literal|"NAK (CTRL-U)"
block|}
block|,
block|{
literal|0
block|,
literal|"SYN (CTRL-V)"
block|}
block|,
block|{
literal|0
block|,
literal|"ETB (CTRL-W)"
block|}
block|,
block|{
literal|0
block|,
literal|"CAN (CTRL-X)"
block|}
block|,
block|{
literal|0
block|,
literal|"EM  (CTRL-Y)"
block|}
block|,
block|{
literal|0
block|,
literal|"SUB (CTRL-Z)"
block|}
block|,
block|{
literal|0
block|,
literal|"ESC (CTRL-[) (ESCAPE)"
block|}
block|,
block|{
literal|0
block|,
literal|"FS  (CTRL-\\ or CTRL-? or CTRL-_)"
block|}
block|,
block|{
literal|0
block|,
literal|"GS  (CTRL-])"
block|}
block|,
block|{
literal|0
block|,
literal|"RS  (CTRL-^ or CTRL-~ or CTRL-`)"
block|}
block|,
block|{
literal|0
block|,
literal|"US  (CTRL-_ or CTRL-?)"
block|}
block|}
struct|;
specifier|static
name|char
modifier|*
name|keyboardmenu
index|[]
init|=
block|{
literal|"Standard American ASCII layout"
block|,
literal|"Swedish national layout D47"
block|,
literal|"Swedish national layout E47"
block|,
comment|/* add new keyboard layouts here */
literal|""
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|curkeymodes
index|[
literal|3
index|]
init|=
block|{
literal|"ANSI / Cursor key mode RESET"
block|,
literal|"ANSI / Cursor key mode SET"
block|,
literal|"VT52 Mode"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|fnkeymodes
index|[
literal|4
index|]
init|=
block|{
literal|"ANSI Numeric mode"
block|,
literal|"ANSI Application mode"
block|,
literal|"VT52 Numeric mode"
block|,
literal|"VT52 Application mode"
block|}
decl_stmt|;
name|ledmsg
index|[
literal|0
index|]
operator|=
literal|"L1 L2 L3 L4"
expr_stmt|;
name|ledseq
index|[
literal|0
index|]
operator|=
literal|"1;2;3;4"
expr_stmt|;
name|ledmsg
index|[
literal|1
index|]
operator|=
literal|"   L2 L3 L4"
expr_stmt|;
name|ledseq
index|[
literal|1
index|]
operator|=
literal|"1;0;4;3;2"
expr_stmt|;
name|ledmsg
index|[
literal|2
index|]
operator|=
literal|"   L2 L3"
expr_stmt|;
name|ledseq
index|[
literal|2
index|]
operator|=
literal|"1;4;;2;3"
expr_stmt|;
name|ledmsg
index|[
literal|3
index|]
operator|=
literal|"L1 L2"
expr_stmt|;
name|ledseq
index|[
literal|3
index|]
operator|=
literal|";;2;1"
expr_stmt|;
name|ledmsg
index|[
literal|4
index|]
operator|=
literal|"L1"
expr_stmt|;
name|ledseq
index|[
literal|4
index|]
operator|=
literal|"1"
expr_stmt|;
name|ledmsg
index|[
literal|5
index|]
operator|=
literal|""
expr_stmt|;
name|ledseq
index|[
literal|5
index|]
operator|=
literal|""
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"These LEDs (\"lamps\") on the keyboard should be on:"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|10
argument_list|,
literal|52
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ledmsg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|decll
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
name|decll
argument_list|(
name|ledseq
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of the AUTO REPEAT feature"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Hold down an alphanumeric key for a while, then push RETURN."
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Auto Repeat OFF: "
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?8"
argument_list|)
expr_stmt|;
name|inputline
argument_list|(
name|arptstring
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|arptstring
argument_list|)
operator|==
literal|0
condition|)
name|println
argument_list|(
literal|"No characters read!??"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strlen
argument_list|(
name|arptstring
argument_list|)
operator|==
literal|1
condition|)
name|println
argument_list|(
literal|"OK."
argument_list|)
expr_stmt|;
else|else
name|println
argument_list|(
literal|"Too many characters read."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Hold down an alphanumeric key for a while, then push RETURN."
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Auto Repeat ON: "
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?8"
argument_list|)
expr_stmt|;
name|inputline
argument_list|(
name|arptstring
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|arptstring
argument_list|)
operator|==
literal|0
condition|)
name|println
argument_list|(
literal|"No characters read!??"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strlen
argument_list|(
name|arptstring
argument_list|)
operator|==
literal|1
condition|)
name|println
argument_list|(
literal|"Not enough characters read."
argument_list|)
expr_stmt|;
else|else
name|println
argument_list|(
literal|"OK."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Choose keyboard layout:"
argument_list|)
expr_stmt|;
name|kblayout
operator|=
name|menu
argument_list|(
name|keyboardmenu
argument_list|)
expr_stmt|;
if|if
condition|(
name|kblayout
condition|)
block|{
name|kblayout
operator|--
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|natkeytab
index|[
name|kblayout
index|]
index|[
name|j
index|]
operator|.
name|natc
operator|!=
literal|'\0'
condition|;
name|j
operator|++
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|keytab
index|[
name|i
index|]
operator|.
name|c
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|keytab
index|[
name|i
index|]
operator|.
name|row
operator|==
name|natkeytab
index|[
name|kblayout
index|]
index|[
name|j
index|]
operator|.
name|natrow
operator|&&
name|keytab
index|[
name|i
index|]
operator|.
name|col
operator|==
name|natkeytab
index|[
name|kblayout
index|]
index|[
name|j
index|]
operator|.
name|natcol
condition|)
block|{
name|keytab
index|[
name|i
index|]
operator|.
name|c
operator|=
name|natkeytab
index|[
name|kblayout
index|]
index|[
name|j
index|]
operator|.
name|natc
expr_stmt|;
name|keytab
index|[
name|i
index|]
operator|.
name|symbol
operator|=
name|natkeytab
index|[
name|kblayout
index|]
index|[
name|j
index|]
operator|.
name|natsymbol
expr_stmt|;
break|break;
block|}
block|}
block|}
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|keytab
index|[
name|i
index|]
operator|.
name|c
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|keytab
index|[
name|i
index|]
operator|.
name|row
argument_list|,
literal|1
operator|+
name|keytab
index|[
name|i
index|]
operator|.
name|col
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|keytab
index|[
name|i
index|]
operator|.
name|symbol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|CRMOD
expr_stmt|;
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|ECHO
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|inflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"Press each key, both shifted and unshifted. Finish with RETURN:"
argument_list|)
expr_stmt|;
do|do
block|{
comment|/* while (kbdc != 13) */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|kbdc
operator|=
name|inchar
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|kbds
argument_list|,
literal|"%c"
argument_list|,
name|kbdc
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|kbds
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|keytab
index|[
name|i
index|]
operator|.
name|c
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|keytab
index|[
name|i
index|]
operator|.
name|c
operator|==
name|kbdc
condition|)
block|{
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|keytab
index|[
name|i
index|]
operator|.
name|row
argument_list|,
literal|1
operator|+
name|keytab
index|[
name|i
index|]
operator|.
name|col
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|keytab
index|[
name|i
index|]
operator|.
name|symbol
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
do|while
condition|(
name|kbdc
operator|!=
literal|13
condition|)
do|;
ifdef|#
directive|ifdef
name|SARG10
name|inchar
argument_list|()
expr_stmt|;
comment|/* Local hack: Read LF that TOPS-10 adds to CR */
endif|#
directive|endif
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|ckeymode
operator|=
literal|0
init|;
name|ckeymode
operator|<=
literal|2
condition|;
name|ckeymode
operator|++
control|)
block|{
if|if
condition|(
name|ckeymode
condition|)
name|sm
argument_list|(
literal|"?1"
argument_list|)
expr_stmt|;
else|else
name|rm
argument_list|(
literal|"?1"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeysymbol
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeyrow
argument_list|,
literal|1
operator|+
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeycol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeysymbol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|20
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<%s>%20s"
argument_list|,
name|curkeymodes
index|[
name|ckeymode
index|]
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Press each cursor key. Finish with TAB."
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|ckeymode
operator|==
literal|2
condition|)
name|rm
argument_list|(
literal|"?2"
argument_list|)
expr_stmt|;
comment|/* VT52 mode */
name|curkeystr
operator|=
name|instr
argument_list|()
expr_stmt|;
name|esc
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
comment|/* ANSI mode */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|curkeystr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|curkeystr
argument_list|,
literal|"\t"
argument_list|)
condition|)
break|break;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeysymbol
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|curkeystr
argument_list|,
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeymsg
index|[
name|ckeymode
index|]
argument_list|)
condition|)
block|{
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" (%s key) "
argument_list|,
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeyname
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeyrow
argument_list|,
literal|1
operator|+
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeycol
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|curkeytab
index|[
name|i
index|]
operator|.
name|curkeysymbol
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
sizeof|sizeof
argument_list|(
name|curkeytab
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|curkey
argument_list|)
operator|-
literal|1
condition|)
block|{
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|" (Unknown cursor key) "
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|fkeymode
operator|=
literal|0
init|;
name|fkeymode
operator|<=
literal|3
condition|;
name|fkeymode
operator|++
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeysymbol
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeyrow
argument_list|,
literal|1
operator|+
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeycol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeysymbol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|20
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"<%s>%20s"
argument_list|,
name|fnkeymodes
index|[
name|fkeymode
index|]
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|22
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Press each function key. Finish with TAB."
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|fkeymode
operator|>=
literal|2
condition|)
name|rm
argument_list|(
literal|"?2"
argument_list|)
expr_stmt|;
comment|/* VT52 mode */
if|if
condition|(
name|fkeymode
operator|%
literal|2
condition|)
name|deckpam
argument_list|()
expr_stmt|;
comment|/* Application mode */
else|else
name|deckpnm
argument_list|()
expr_stmt|;
comment|/* Numeric mode     */
name|fnkeystr
operator|=
name|instr
argument_list|()
expr_stmt|;
name|esc
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
comment|/* ANSI mode */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|fnkeystr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|fnkeystr
argument_list|,
literal|"\t"
argument_list|)
condition|)
break|break;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeysymbol
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|fnkeystr
argument_list|,
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeymsg
index|[
name|fkeymode
index|]
argument_list|)
condition|)
block|{
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" (%s key) "
argument_list|,
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeyname
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
operator|+
literal|2
operator|*
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeyrow
argument_list|,
literal|1
operator|+
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeycol
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|fnkeytab
index|[
name|i
index|]
operator|.
name|fnkeysymbol
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
sizeof|sizeof
argument_list|(
name|fnkeytab
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
expr|struct
name|fnkey
argument_list|)
operator|-
literal|1
condition|)
block|{
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|" (Unknown function key) "
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Finally, a check of the ANSWERBACK MESSAGE, which can be sent"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"by pressing CTRL-BREAK. The answerback message can be loaded"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"in SET-UP B by pressing SHIFT-A and typing e.g."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"         \" H e l l o , w o r l d Return \""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"(the double-quote characters included).  Do that, and then try"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"to send an answerback message with CTRL-BREAK.  If it works,"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"the answerback message should be displayed in reverse mode."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Finish with a single RETURN."
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
do|do
block|{
name|cup
argument_list|(
literal|17
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|inflush
argument_list|()
expr_stmt|;
name|abmstr
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|17
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|abmstr
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|strcmp
argument_list|(
name|abmstr
argument_list|,
literal|"\r"
argument_list|)
condition|)
do|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|cup
argument_list|(
literal|1
operator|+
operator|(
name|i
operator|%
literal|16
operator|)
argument_list|,
literal|1
operator|+
literal|40
operator|*
operator|(
name|i
operator|/
literal|16
operator|)
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ckeytab
index|[
name|i
index|]
operator|.
name|csymbol
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|19
argument_list|,
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|println
argument_list|(
literal|"Push each CTRL-key TWICE. Note that you should be able to send *all*"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"CTRL-codes twice, including CTRL-S (X-Off) and CTRL-Q (X-Off)!"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Finish with DEL (also called DELETE or RUB OUT), or wait 1 minute."
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
ifdef|#
directive|ifdef
name|SIII
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|CBREAK
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|RAW
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|ttybin
argument_list|(
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SARG20
name|page
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* Turn off all character processing at input */
name|superbin
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Turn off ^C (among others). Keep your fingers crossed!! */
endif|#
directive|endif
do|do
block|{
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|kbdc
operator|=
name|inchar
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|kbdc
operator|<
literal|32
condition|)
name|printf
argument_list|(
literal|"  %s"
argument_list|,
name|ckeytab
index|[
name|kbdc
index|]
operator|.
name|csymbol
argument_list|)
expr_stmt|;
else|else
block|{
name|sprintf
argument_list|(
name|kbds
argument_list|,
literal|"%c"
argument_list|,
name|kbdc
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|kbds
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|" -- not a CTRL key"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|kbdc
operator|<
literal|32
condition|)
name|ckeytab
index|[
name|kbdc
index|]
operator|.
name|ccount
operator|++
expr_stmt|;
if|if
condition|(
name|ckeytab
index|[
name|kbdc
index|]
operator|.
name|ccount
operator|==
literal|2
condition|)
block|{
name|cup
argument_list|(
literal|1
operator|+
operator|(
name|kbdc
operator|%
literal|16
operator|)
argument_list|,
literal|1
operator|+
literal|40
operator|*
operator|(
name|kbdc
operator|/
literal|16
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|ckeytab
index|[
name|kbdc
index|]
operator|.
name|csymbol
argument_list|)
expr_stmt|;
block|}
block|}
do|while
condition|(
name|kbdc
operator|!=
literal|'\177'
condition|)
do|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|RAW
expr_stmt|;
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|ECHO
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SIII
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|CBREAK
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
name|ttybin
argument_list|(
literal|0
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SARG20
name|superbin
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* Puuuh! We made it!? */
name|page
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Back to normal input processing */
name|ttybin
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* This must be the mode for DEC20 */
endif|#
directive|endif
name|cup
argument_list|(
literal|24
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|okflag
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|ckeytab
index|[
name|i
index|]
operator|.
name|ccount
operator|<
literal|2
condition|)
name|okflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|okflag
condition|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"OK. "
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"You have not been able to send all CTRL keys! "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_reports
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:<ENQ>       (AnswerBack Message)        SM RM       (Set/Reset Mode) - LineFeed / Newline        DSR         (Device Status Report)        DA          (Device Attributes)        DECREQTPARM (Request Terminal Parameters)   */
name|int
name|parity
decl_stmt|,
name|nbits
decl_stmt|,
name|xspeed
decl_stmt|,
name|rspeed
decl_stmt|,
name|clkmul
decl_stmt|,
name|flags
decl_stmt|;
name|int
name|i
decl_stmt|,
name|reportpos
decl_stmt|;
name|char
modifier|*
name|report
decl_stmt|,
modifier|*
name|report2
decl_stmt|;
specifier|static
name|char
modifier|*
name|attributes
index|[]
index|[
literal|2
index|]
init|=
block|{
block|{
literal|"\033[?1;0c"
block|,
literal|"No options (vanilla VT100)"
block|}
block|,
block|{
literal|"\033[?1;1c"
block|,
literal|"VT100 with STP"
block|}
block|,
block|{
literal|"\033[?1;2c"
block|,
literal|"VT100 with AVO (could be a VT102)"
block|}
block|,
block|{
literal|"\033[?1;3c"
block|,
literal|"VT100 with STP and AVO"
block|}
block|,
block|{
literal|"\033[?1;4c"
block|,
literal|"VT100 with GPO"
block|}
block|,
block|{
literal|"\033[?1;5c"
block|,
literal|"VT100 with STP and GPO"
block|}
block|,
block|{
literal|"\033[?1;6c"
block|,
literal|"VT100 with AVO and GPO"
block|}
block|,
block|{
literal|"\033[?1;7c"
block|,
literal|"VT100 with STP, AVO and GPO"
block|}
block|,
block|{
literal|"\033[?1;11c"
block|,
literal|"VT100 with PP and AVO"
block|}
block|,
block|{
literal|"\033[?1;15c"
block|,
literal|"VT100 with PP, GPO and AVO"
block|}
block|,
block|{
literal|"\033[?4;2c"
block|,
literal|"VT132 with AVO"
block|}
block|,
block|{
literal|"\033[?4;3c"
block|,
literal|"VT132 with AVO and STP"
block|}
block|,
block|{
literal|"\033[?4;6c"
block|,
literal|"VT132 with GPO and AVO"
block|}
block|,
block|{
literal|"\033[?4;7c"
block|,
literal|"VT132 with GPO, AVO, and STP"
block|}
block|,
block|{
literal|"\033[?4;11c"
block|,
literal|"VT132 with PP and AVO"
block|}
block|,
block|{
literal|"\033[?4;15c"
block|,
literal|"VT132 with PP, GPO and AVO"
block|}
block|,
block|{
literal|"\033[?7c"
block|,
literal|"VT131"
block|}
block|,
block|{
literal|"\033[?12;5c"
block|,
literal|"VT125"
block|}
block|,
comment|/* VT125 also has ROM version */
block|{
literal|"\033[?12;7c"
block|,
literal|"VT125 with AVO"
block|}
block|,
comment|/* number, so this won't work */
block|{
literal|"\033[?5;0c"
block|,
literal|"VK100 (GIGI)"
block|}
block|,
block|{
literal|"\033[?5c"
block|,
literal|"VK100 (GIGI)"
block|}
block|,
block|{
literal|""
block|,
literal|""
block|}
block|}
decl_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|ECHO
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"This is a test of the ANSWERBACK MESSAGE. (To load the A.B.M."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"see the TEST KEYBOARD part of this program). Below here, the"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"current answerback message in your terminal should be"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"displayed. Finish this test with RETURN."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|inflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* ENQ */
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of LineFeed/NewLine mode."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"20"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator|&=
operator|~
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|printf
argument_list|(
literal|"NewLine mode set. Push the RETURN key: "
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
literal|"\015\012"
argument_list|)
condition|)
name|printf
argument_list|(
literal|" -- OK"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" -- Not expected"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|6
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"20"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"NewLine mode reset. Push the RETURN key: "
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|7
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
literal|"\015"
argument_list|)
condition|)
name|printf
argument_list|(
literal|" -- OK"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" -- Not expected"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|9
argument_list|,
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|CRMOD
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Test of Device Status Report 5 (report terminal status)."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dsr
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Report is: "
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
literal|"\033[0n"
argument_list|)
condition|)
name|printf
argument_list|(
literal|" -- means \"TERMINAL OK\""
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
literal|"\033[3n"
argument_list|)
condition|)
name|printf
argument_list|(
literal|" -- means \"TERMINAL OK\""
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" -- Unknown response!"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of Device Status Report 6 (report cursor position)."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dsr
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Report is: "
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
literal|"\033[5;1R"
argument_list|)
condition|)
name|printf
argument_list|(
literal|" -- OK"
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|" -- Unknown response!"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|7
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of Device Attributes report (what are you)"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|da
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Report is: "
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|*
name|attributes
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
name|attributes
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
condition|)
break|break;
block|}
if|if
condition|(
operator|*
name|attributes
index|[
name|i
index|]
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|printf
argument_list|(
literal|" -- Unknown response, refer to the manual"
argument_list|)
expr_stmt|;
else|else
block|{
name|printf
argument_list|(
literal|" -- means %s"
argument_list|,
name|attributes
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
condition|)
block|{
name|cup
argument_list|(
literal|9
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Legend: STP = Processor Option"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"        AVO = Advanced Video Option"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"        GPO = Graphics Processor Option"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"        PP  = Printer Port"
argument_list|)
expr_stmt|;
block|}
block|}
name|cup
argument_list|(
literal|14
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of the \"Request Terminal Parameters\" feature, argument 0."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decreqtparm
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|report
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Report is: "
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|report
argument_list|)
operator|<
literal|16
operator|||
name|report
index|[
literal|0
index|]
operator|!=
literal|'\033'
operator|||
name|report
index|[
literal|1
index|]
operator|!=
literal|'['
operator|||
name|report
index|[
literal|2
index|]
operator|!=
literal|'2'
operator|||
name|report
index|[
literal|3
index|]
operator|!=
literal|';'
condition|)
name|println
argument_list|(
literal|" -- Bad format"
argument_list|)
expr_stmt|;
else|else
block|{
name|reportpos
operator|=
literal|4
expr_stmt|;
name|parity
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
name|nbits
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
name|xspeed
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
name|rspeed
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
name|clkmul
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|';'
argument_list|)
expr_stmt|;
name|flags
operator|=
name|scanto
argument_list|(
name|report
argument_list|,
operator|&
name|reportpos
argument_list|,
literal|'x'
argument_list|)
expr_stmt|;
if|if
condition|(
name|parity
operator|==
literal|0
operator|||
name|nbits
operator|==
literal|0
operator|||
name|clkmul
operator|==
literal|0
condition|)
name|println
argument_list|(
literal|" -- Bad format"
argument_list|)
expr_stmt|;
else|else
name|println
argument_list|(
literal|" -- OK"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This means: Parity %s, %s bits, xmitspeed %s, recvspeed %s.\n"
argument_list|,
name|lookup
argument_list|(
name|paritytable
argument_list|,
name|parity
argument_list|)
argument_list|,
name|lookup
argument_list|(
name|nbitstable
argument_list|,
name|nbits
argument_list|)
argument_list|,
name|lookup
argument_list|(
name|speedtable
argument_list|,
name|xspeed
argument_list|)
argument_list|,
name|lookup
argument_list|(
name|speedtable
argument_list|,
name|rspeed
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"(CLoCk MULtiplier = %d, STP option flags = %d)\n"
argument_list|,
name|clkmul
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|19
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Test of the \"Request Terminal Parameters\" feature, argument 1."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|20
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decreqtparm
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Does the same as decreqtparm(0), reports "3" */
name|report2
operator|=
name|instr
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|20
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Report is: "
argument_list|)
expr_stmt|;
name|chrprint
argument_list|(
name|report2
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|report2
argument_list|)
operator|<
literal|3
operator|||
name|report2
index|[
literal|2
index|]
operator|!=
literal|'3'
condition|)
name|println
argument_list|(
literal|" -- Bad format"
argument_list|)
expr_stmt|;
else|else
block|{
name|report2
index|[
literal|2
index|]
operator|=
literal|'2'
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|report
argument_list|,
name|report2
argument_list|)
condition|)
name|println
argument_list|(
literal|" -- OK"
argument_list|)
expr_stmt|;
else|else
name|println
argument_list|(
literal|" -- Bad format"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|24
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|ECHO
expr_stmt|;
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_block

begin_macro
name|tst_vt52
argument_list|()
end_macro

begin_block
block|{
specifier|static
struct|struct
name|rtabl
block|{
name|char
modifier|*
name|rcode
decl_stmt|;
name|char
modifier|*
name|rmsg
decl_stmt|;
block|}
name|resptable
index|[]
init|=
block|{
block|{
literal|"\033/K"
block|,
literal|" -- OK (means Standard VT52)"
block|}
block|,
block|{
literal|"\033/Z"
block|,
literal|" -- OK (means VT100 emulating VT52)"
block|}
block|,
block|{
literal|""
block|,
literal|" -- Unknown response"
block|}
block|}
struct|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|char
modifier|*
name|response
decl_stmt|;
name|rm
argument_list|(
literal|"?2"
argument_list|)
expr_stmt|;
comment|/* Reset ANSI (VT100) mode, Set VT52 mode	*/
name|esc
argument_list|(
literal|"H"
argument_list|)
expr_stmt|;
comment|/* Cursor home	*/
name|esc
argument_list|(
literal|"J"
argument_list|)
expr_stmt|;
comment|/* Erase to end of screen	*/
name|esc
argument_list|(
literal|"H"
argument_list|)
expr_stmt|;
comment|/* Cursor home	*/
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|23
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|9
condition|;
name|j
operator|++
control|)
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"FooBar "
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Bletch"
argument_list|)
expr_stmt|;
block|}
name|esc
argument_list|(
literal|"H"
argument_list|)
expr_stmt|;
comment|/* Cursor home	*/
name|esc
argument_list|(
literal|"J"
argument_list|)
expr_stmt|;
comment|/* Erase to end of screen	*/
name|vt52cup
argument_list|(
literal|7
argument_list|,
literal|47
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"nothing more."
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|10
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"THIS SHOULD GO AWAY! "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|vt52cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"Back scroll (this should go away)"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"I"
argument_list|)
expr_stmt|;
comment|/* Reverse LineFeed (with backscroll!)	*/
block|}
name|vt52cup
argument_list|(
literal|12
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"J"
argument_list|)
expr_stmt|;
comment|/* Erase to end of screen	*/
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|vt52cup
argument_list|(
name|i
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"K"
argument_list|)
expr_stmt|;
comment|/* Erase to end of line	*/
block|}
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
literal|23
condition|;
name|i
operator|++
control|)
block|{
name|vt52cup
argument_list|(
name|i
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"**Foobar"
argument_list|)
expr_stmt|;
block|}
name|vt52cup
argument_list|(
literal|23
argument_list|,
literal|10
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|23
init|;
name|i
operator|>=
literal|2
condition|;
name|i
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* BS */
name|esc
argument_list|(
literal|"I"
argument_list|)
expr_stmt|;
comment|/* Reverse LineFeed (LineStarve)	*/
block|}
name|vt52cup
argument_list|(
literal|1
argument_list|,
literal|70
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|70
init|;
name|i
operator|>=
literal|10
condition|;
name|i
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"D"
argument_list|)
expr_stmt|;
comment|/* Cursor Left */
block|}
name|vt52cup
argument_list|(
literal|24
argument_list|,
literal|10
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|10
init|;
name|i
operator|<=
literal|70
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* BS */
name|esc
argument_list|(
literal|"C"
argument_list|)
expr_stmt|;
comment|/* Cursor Right	*/
block|}
name|vt52cup
argument_list|(
literal|2
argument_list|,
literal|11
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
literal|23
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* BS */
name|esc
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
comment|/* Cursor Down	*/
block|}
name|vt52cup
argument_list|(
literal|23
argument_list|,
literal|69
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|23
init|;
name|i
operator|>=
literal|2
condition|;
name|i
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"!"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* BS */
name|esc
argument_list|(
literal|"A"
argument_list|)
expr_stmt|;
comment|/* Cursor Up	*/
block|}
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|<=
literal|23
condition|;
name|i
operator|++
control|)
block|{
name|vt52cup
argument_list|(
name|i
argument_list|,
literal|71
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"K"
argument_list|)
expr_stmt|;
comment|/* Erase to end of line	*/
block|}
name|vt52cup
argument_list|(
literal|10
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"The screen should be cleared, and have a centered"
argument_list|)
expr_stmt|;
name|vt52cup
argument_list|(
literal|11
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"rectangle of \"*\"s with \"!\"s on the inside to the"
argument_list|)
expr_stmt|;
name|vt52cup
argument_list|(
literal|12
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"left and right. Only this, and"
argument_list|)
expr_stmt|;
name|vt52cup
argument_list|(
literal|13
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|esc
argument_list|(
literal|"H"
argument_list|)
expr_stmt|;
comment|/* Cursor home	*/
name|esc
argument_list|(
literal|"J"
argument_list|)
expr_stmt|;
comment|/* Erase to end of screen	*/
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"This is the normal character set:"
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|1
condition|;
name|j
operator|++
control|)
block|{
name|vt52cup
argument_list|(
literal|3
operator|+
name|j
argument_list|,
literal|16
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|47
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|32
operator|+
name|i
operator|+
literal|48
operator|*
name|j
argument_list|)
expr_stmt|;
block|}
name|vt52cup
argument_list|(
literal|6
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"This is the special graphics character set:"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"F"
argument_list|)
expr_stmt|;
comment|/* Select Special Graphics character set	*/
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<=
literal|1
condition|;
name|j
operator|++
control|)
block|{
name|vt52cup
argument_list|(
literal|8
operator|+
name|j
argument_list|,
literal|16
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|47
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|32
operator|+
name|i
operator|+
literal|48
operator|*
name|j
argument_list|)
expr_stmt|;
block|}
name|esc
argument_list|(
literal|"G"
argument_list|)
expr_stmt|;
comment|/* Select ASCII character set	*/
name|vt52cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|esc
argument_list|(
literal|"H"
argument_list|)
expr_stmt|;
comment|/* Cursor home	*/
name|esc
argument_list|(
literal|"J"
argument_list|)
expr_stmt|;
comment|/* Erase to end of screen	*/
name|println
argument_list|(
literal|"Test of terminal response to IDENTIFY command"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"Z"
argument_list|)
expr_stmt|;
comment|/* Identify	*/
name|response
operator|=
name|instr
argument_list|()
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Response was"
argument_list|)
expr_stmt|;
name|esc
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
comment|/* Enter ANSI mode (VT100 mode) */
name|chrprint
argument_list|(
name|response
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|resptable
index|[
name|i
index|]
operator|.
name|rcode
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|response
argument_list|,
name|resptable
index|[
name|i
index|]
operator|.
name|rcode
argument_list|)
condition|)
break|break;
name|printf
argument_list|(
literal|"%s"
argument_list|,
name|resptable
index|[
name|i
index|]
operator|.
name|rmsg
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|tst_insdel
argument_list|()
end_macro

begin_block
block|{
comment|/* Test of:        SM/RM(4) (= IRM (Insertion/replacement mode))        ICH (Insert Character)        DCH (Delete character)        IL  (Insert line)        DL  (Delete line)     */
name|int
name|i
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|,
name|sw
decl_stmt|,
name|dblchr
decl_stmt|,
name|scr132
decl_stmt|;
for|for
control|(
name|scr132
operator|=
literal|0
init|;
name|scr132
operator|<=
literal|1
condition|;
name|scr132
operator|++
control|)
block|{
if|if
condition|(
name|scr132
condition|)
block|{
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|sw
operator|=
literal|132
expr_stmt|;
block|}
else|else
block|{
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|sw
operator|=
literal|80
expr_stmt|;
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|1
init|;
name|row
operator|<=
literal|24
condition|;
name|row
operator|++
control|)
block|{
name|cup
argument_list|(
name|row
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
name|sw
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|'A'
operator|-
literal|1
operator|+
name|row
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Screen accordion test (Insert& Delete Line). "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ri
argument_list|()
expr_stmt|;
name|el
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|decstbm
argument_list|(
literal|2
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|1
init|;
name|row
operator|<=
literal|24
condition|;
name|row
operator|++
control|)
block|{
name|il
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|dl
argument_list|(
name|row
argument_list|)
expr_stmt|;
block|}
name|rm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Top line: A's, bottom line: X's, this line, nothing more. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"B"
argument_list|)
expr_stmt|;
name|cub
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"4"
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|2
init|;
name|col
operator|<=
name|sw
operator|-
literal|1
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"4"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Test of 'Insert Mode'. The top line should be 'A*** ... ***B'. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ri
argument_list|()
expr_stmt|;
name|el
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|dch
argument_list|(
name|sw
operator|-
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Test of 'Delete Character'. The top line should be 'AB'. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
for|for
control|(
name|dblchr
operator|=
literal|1
init|;
name|dblchr
operator|<=
literal|2
condition|;
name|dblchr
operator|++
control|)
block|{
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|1
init|;
name|row
operator|<=
literal|24
condition|;
name|row
operator|++
control|)
block|{
name|cup
argument_list|(
name|row
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|dblchr
operator|==
literal|2
condition|)
name|decdwl
argument_list|()
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
name|sw
operator|/
name|dblchr
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
literal|'A'
operator|-
literal|1
operator|+
name|row
argument_list|)
expr_stmt|;
name|cup
argument_list|(
name|row
argument_list|,
name|sw
operator|/
name|dblchr
operator|-
name|row
argument_list|)
expr_stmt|;
name|dch
argument_list|(
name|row
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"The right column should be staggered "
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"by one.  "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"If your terminal has the ANSI 'Insert Character' function"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"(the VT102 does not), then you should see a line like this"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"  A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"below:"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|'Z'
init|;
name|i
operator|>=
literal|'A'
condition|;
name|i
operator|--
control|)
block|{
name|printf
argument_list|(
literal|"%c\010"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|ich
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
if|if
condition|(
name|sw
operator|==
literal|132
condition|)
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|dch
argument_list|(
argument|pn
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pn
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|brc
argument_list|(
name|pn
argument_list|,
literal|'P'
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Delete character */
end_comment

begin_macro
name|ich
argument_list|(
argument|pn
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pn
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|brc
argument_list|(
name|pn
argument_list|,
literal|'@'
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Insert character -- not in VT102 */
end_comment

begin_macro
name|dl
argument_list|(
argument|pn
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pn
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|brc
argument_list|(
name|pn
argument_list|,
literal|'M'
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Delete line */
end_comment

begin_macro
name|il
argument_list|(
argument|pn
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pn
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|brc
argument_list|(
name|pn
argument_list|,
literal|'L'
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* Insert line */
end_comment

begin_comment
comment|/*  Test of some known VT100 bugs and misfeatures  */
end_comment

begin_macro
name|tst_bugs
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|,
name|menuchoice
decl_stmt|;
specifier|static
name|char
modifier|*
name|menutable
index|[]
init|=
block|{
literal|"Exit to main menu"
block|,
literal|"Bug A: Smooth scroll to jump scroll"
block|,
literal|"Bug B: Scrolling region"
block|,
literal|"Bug C: Wide to narrow screen"
block|,
literal|"Bug D: Narrow to wide screen"
block|,
literal|"Bug E: Cursor move from double- to single-wide line"
block|,
literal|"Bug F: Column mode escape sequence"
block|,
literal|"Wrap around with cursor addressing"
block|,
literal|"Erase right half of double width lines"
block|,
literal|"Funny scroll regions"
block|,
comment|/* Add more here */
literal|""
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|hmsg
index|[]
init|=
block|{
literal|"Test of known bugs in the DEC VT100 series. The numbering of some of"
block|,
literal|"the bugs (A-F) refers to the article 'VT100 MAGIC' by Sami Tabih in"
block|,
literal|"the 'Proceedings of the DEC Users Society' at St. Louis, Missouri, May"
block|,
literal|"1983. To understand some of the tests, you have to look at the source"
block|,
literal|"code or the article. Of course, a good VT100-compatible terminal"
block|,
literal|"should not have these bugs (or have some means of disabling them)! If"
block|,
literal|"a bug appears, you might want to RESET the terminal before continuing"
block|,
literal|"the test. There is a test of the RESET function in the main menu."
block|,
literal|""
block|}
decl_stmt|;
do|do
block|{
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|*
name|hmsg
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
name|println
argument_list|(
name|hmsg
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"          Choose bug test number:"
argument_list|)
expr_stmt|;
name|menuchoice
operator|=
name|menu
argument_list|(
name|menutable
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|menuchoice
condition|)
block|{
case|case
literal|1
case|:
name|bug_a
argument_list|()
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|bug_b
argument_list|()
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|bug_c
argument_list|()
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|bug_d
argument_list|()
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|bug_e
argument_list|()
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|bug_f
argument_list|()
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|bug_w
argument_list|()
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|bug_l
argument_list|()
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|bug_s
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
do|while
condition|(
name|menuchoice
condition|)
do|;
block|}
end_block

begin_comment
comment|/* Bug A: Smooth scroll to jump scroll */
end_comment

begin_macro
name|bug_a
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"This is a test of the VT100 'Scroll while toggle softscroll'"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"bug.  The cursor may disappear, or move UP the screen, or"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"multiple copies of some lines may appear."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
comment|/*  Invoke the bug  */
name|esc
argument_list|(
literal|"[24H"
argument_list|)
expr_stmt|;
comment|/* Simplified cursor movement	*/
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|20
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|sm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|10
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|5
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* That should be enough to show the bug. But we'll try another way:	*/
name|sm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
comment|/* Set soft scroll		*/
name|nel
argument_list|()
expr_stmt|;
comment|/* "NextLine", move down	*/
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
comment|/* Reset soft scroll		*/
name|nel
argument_list|()
expr_stmt|;
comment|/* "NextLine", move down	*/
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|10
condition|;
name|i
operator|++
control|)
block|{
comment|/* Show the bug			*/
name|printf
argument_list|(
literal|"Softscroll bug test, line %d.  "
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
name|println
argument_list|(
literal|"That should have been enough to show the bug, if present."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  Bug B: Scrolling region  */
end_comment

begin_macro
name|bug_b
argument_list|()
end_macro

begin_block
block|{
name|char
name|c
decl_stmt|;
name|decaln
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Line 11 should be double-wide, line 12 should be cleared."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Then, the letters A-P should be written at the beginning"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"of lines 12-24, and the empty line and A-E are scrolled away."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"If the bug is present, some lines are confused, look at K-P."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|11
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|12
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|el
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Here we go... "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ri
argument_list|()
expr_stmt|;
comment|/* Bug comes here */
for|for
control|(
name|c
operator|=
literal|'A'
init|;
name|c
operator|<=
literal|'P'
condition|;
name|c
operator|++
control|)
name|printf
argument_list|(
literal|"%c\n"
argument_list|,
name|c
argument_list|)
expr_stmt|;
comment|/* Bug shows here */
name|holdit
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* No scr. region */
block|}
end_block

begin_comment
comment|/*  Bug C: Wide to narrow screen  */
end_comment

begin_macro
name|bug_c
argument_list|()
end_macro

begin_block
block|{
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* 132 column mode */
name|cup
argument_list|(
literal|1
argument_list|,
literal|81
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/*  80 column mode */
name|cup
argument_list|(
literal|12
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Except for this line, the screen should be blank. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  Bug D: Narrow to wide screen  */
end_comment

begin_macro
name|bug_d
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
name|char
name|result
decl_stmt|;
comment|/* Make the bug appear */
do|do
block|{
name|cup
argument_list|(
literal|14
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* The original code in the article says      * PRINT ESC$; "[13;1H"; CHR$(10%);      * but I guess a cup(14,1); would do.      * (To output a pure LF might be tricky).      */
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* Make the bug visible */
name|cup
argument_list|(
literal|1
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|println
argument_list|(
literal|"You should see blinking text at the bottom line."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|3
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|println
argument_list|(
literal|"Enter 0 to exit, 1 to try to invoke the bug again."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|24
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|sgr
argument_list|(
literal|"1;5;7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"If you can see this then the bug did not appear."
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|result
operator|=
name|inchar
argument_list|()
expr_stmt|;
name|readnl
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|result
operator|==
literal|'1'
condition|)
do|;
name|sm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
comment|/* Syrup scroll */
name|cup
argument_list|(
literal|23
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|5
condition|;
name|i
operator|++
control|)
name|println
argument_list|(
literal|"If the bug is present, this should make things much worse!"
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
comment|/* Jump scroll */
block|}
end_block

begin_comment
comment|/*  Bug E: Cursor move from double- to single-wide line  */
end_comment

begin_macro
name|bug_e
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
specifier|static
name|char
modifier|*
name|rend
index|[
literal|2
index|]
init|=
block|{
literal|"\033[m"
block|,
literal|"\033[7m"
block|}
decl_stmt|;
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|println
argument_list|(
literal|"This test should put an 'X' at line 3 column 100."
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|12
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"1234567890%s"
argument_list|,
name|rend
index|[
name|i
operator|&
literal|1
index|]
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* The bug appears when we jump from a dobule-wide line */
name|cup
argument_list|(
literal|3
argument_list|,
literal|100
argument_list|)
expr_stmt|;
comment|/* to a single-wide line, column> 66.                  */
name|printf
argument_list|(
literal|"X"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|4
argument_list|,
literal|66
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"!                                 !"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"--------------------------- The 'X' should NOT be above here -"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"---+------------ but above here -----+"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  Bug F: Column mode escape sequence  */
end_comment

begin_macro
name|bug_f
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|;
comment|/*   *  VT100 "toggle origin mode, forget rest" bug.  If you try to set   *	(or clear) parameters and one of them is the "origin mode"   *	("?6") parameter, parameters that appear after the "?6"   *	remain unaffected.  This is also true on CIT-101 terminals.   */
name|sm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
comment|/* Set reverse mode		*/
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* Set 132 column mode		*/
name|println
argument_list|(
literal|"Test VT100 'Toggle origin mode, forget rest' bug, part 1."
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"The screen should be in reverse, 132 column mode."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|rm
argument_list|(
literal|"?6;5;3"
argument_list|)
expr_stmt|;
comment|/* Reset (origin, reverse, 132 col)	*/
name|println
argument_list|(
literal|"Test VT100 'Toggle origin mode, forget rest' bug, part 2.\n"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"The screen should be in non-reverse, 80 column mode."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/*	Bug W:    *	The dreaded "wraparound" bug!  You CUP to col 80, write a char,    *	CUP to another line in col 80, write a char. And the brain-damaged    *	terminal thinks that "Hokay, so he's written a char in col 80, so    *	I stay in col 80 and wait for next character. Let's see now, here    *	comes another character, and I'm still in col 80, so I must make    *	a NewLine first." -- It doesn't clear that "still in col 80" flag    *	on a CUP. Argh!    */
end_comment

begin_macro
name|bug_w
argument_list|()
end_macro

begin_block
block|{
name|int
name|row
decl_stmt|,
name|col
decl_stmt|;
name|cup
argument_list|(
literal|16
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   This illustrates the \"wrap around bug\" which exists on a"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   standard VT100. At the top of the screen there should be"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   a row of +'s, and the rightmost column should be filled"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   with *'s. But if the bug is present, some of the *'s may"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   be placed in other places, e.g. in the leftmost column,"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"   and the top line of +'s may be scrolled away."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|1
init|;
name|col
operator|<=
literal|79
condition|;
name|col
operator|++
control|)
name|printf
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|1
init|;
name|row
operator|<=
literal|24
condition|;
name|row
operator|++
control|)
block|{
name|hvp
argument_list|(
name|row
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"*"
argument_list|)
expr_stmt|;
block|}
name|cup
argument_list|(
literal|24
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/*	Bug L:    *	Check if the right half of double-width lines comes back    *	when a line is first set to single-width, filled with stuff,    *	set to double-width, and finally reset to single-width.    *    *	A VT100 has this misfeature, and many others. Foo!    */
end_comment

begin_macro
name|bug_l
argument_list|()
end_macro

begin_block
block|{
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This-is-a-long-line-This-is-a-long-line-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This-is-a-long-line-This-is-a-long-line-"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is a test of what happens to the right half of double-width"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|" lines."
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"A common misfeature is that the right half does not come back"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|" when a long"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"single-width line is set to double-width and then reset to"
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|" single-width."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 80 characters in single width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 40 characters in double width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|11
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 80 characters in single width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
comment|/* ...and in 132 column mode  */
name|sm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This-is-a-long-line-This-is-a-long-line-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This-is-a-long-line-This-is-a-long-line-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This-is-a-long-line-This-is-a-long-line-"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ending-here-"
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"This is the same test in 132 column mode."
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|5
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 132 characters in single width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decdwl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 66 characters in double width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|15
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|decswl
argument_list|()
expr_stmt|;
name|cup
argument_list|(
literal|11
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Now the line below should contain 132 characters in single width."
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|bug_s
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
name|decstbm
argument_list|(
literal|20
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|/* 20-10=-10,< 2, so no scroll region. */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|20
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"This is 20 lines of text (line %d), no scroll region.\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Should be interpreted as decstbm(1,1) = none */
name|cup
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
literal|20
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"This is 20 lines of text (line %d), no scroll region.\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* No scroll region (just in case...)	*/
block|}
end_block

begin_macro
name|tst_rst
argument_list|()
end_macro

begin_block
block|{
comment|/*    * Test of    *	- RIS    (Reset to Initial State)    *	- DECTST (invoke terminal test)    */
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"The terminal will now be RESET. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ris
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|zleep
argument_list|(
literal|5000
argument_list|)
expr_stmt|;
comment|/* Wait 5.0 seconds */
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"The terminal is now RESET. Next, the built-in confidence test"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"will be invoked. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|dectst
argument_list|(
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|UNIX
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|zleep
argument_list|(
literal|5000
argument_list|)
expr_stmt|;
comment|/* Wait 5.0 seconds */
name|cup
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"If the built-in confidence test found any errors, a code"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s"
argument_list|,
literal|"is visible above. "
argument_list|)
expr_stmt|;
name|holdit
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|initterminal
argument_list|(
argument|pn
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pn
decl_stmt|;
end_decl_stmt

begin_block
block|{
ifdef|#
directive|ifdef
name|UNIX
if|if
condition|(
name|pn
operator|==
literal|0
condition|)
block|{
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|gtty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyOrg
argument_list|)
expr_stmt|;
name|gtty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
name|sgttyNew
operator|.
name|sg_flags
operator||=
name|CBREAK
expr_stmt|;
block|}
else|else
block|{
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|inflush
argument_list|()
expr_stmt|;
name|sleep
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|sgttyNew
operator|.
name|sg_flags
operator|=
name|sgttyOrg
operator|.
name|sg_flags
operator||
name|CBREAK
expr_stmt|;
block|}
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyNew
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SIII
name|close
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|open
argument_list|(
name|_PATH_TTY
argument_list|,
name|O_RDWR
operator||
name|O_NDELAY
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SARG10
comment|/* Set up neccesary TOPS-10 terminal parameters	*/
name|trmop
argument_list|(
literal|02041
argument_list|,
operator|`
name|VT100
operator|`
argument_list|)
expr_stmt|;
comment|/* tty type vt100	*/
name|trmop
argument_list|(
literal|02002
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* tty no tape	*/
name|trmop
argument_list|(
literal|02003
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* tty lc	*/
name|trmop
argument_list|(
literal|02005
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* tty tab	*/
name|trmop
argument_list|(
literal|02010
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* tty no crlf	*/
name|trmop
argument_list|(
literal|02020
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* tty no tape	*/
name|trmop
argument_list|(
literal|02021
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* tty page	*/
name|trmop
argument_list|(
literal|02025
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* tty blanks	*/
name|trmop
argument_list|(
literal|02026
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* tty no alt	*/
name|trmop
argument_list|(
literal|02040
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* tty defer	*/
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SARG20
name|ttybin
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* set line to binary mode */
endif|#
directive|endif
comment|/* Set up my personal prejudices	*/
name|esc
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
comment|/* Enter ANSI mode (if in VT52 mode)	*/
name|rm
argument_list|(
literal|"?1"
argument_list|)
expr_stmt|;
comment|/* cursor keys normal   */
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* 80 col mode		*/
name|rm
argument_list|(
literal|"?4"
argument_list|)
expr_stmt|;
comment|/* Jump scroll          */
name|rm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
comment|/* Normal screen        */
name|rm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
comment|/* Absolute origin mode	*/
name|sm
argument_list|(
literal|"?7"
argument_list|)
expr_stmt|;
comment|/* Wrap around on	*/
name|rm
argument_list|(
literal|"?8"
argument_list|)
expr_stmt|;
comment|/* Auto repeat off	*/
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* No scroll region	*/
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
comment|/* Normal character attributes  */
block|}
end_block

begin_macro
name|bye
argument_list|()
end_macro

begin_block
block|{
comment|/* Force my personal prejudices upon the poor luser	*/
name|esc
argument_list|(
literal|"<"
argument_list|)
expr_stmt|;
comment|/* Enter ANSI mode (if in VT52 mode)	*/
name|rm
argument_list|(
literal|"?1"
argument_list|)
expr_stmt|;
comment|/* cursor keys normal   */
name|rm
argument_list|(
literal|"?3"
argument_list|)
expr_stmt|;
comment|/* 80 col mode		*/
name|rm
argument_list|(
literal|"?5"
argument_list|)
expr_stmt|;
comment|/* Normal screen        */
name|rm
argument_list|(
literal|"?6"
argument_list|)
expr_stmt|;
comment|/* Absolute origin mode	*/
name|sm
argument_list|(
literal|"?7"
argument_list|)
expr_stmt|;
comment|/* Wrap around on	*/
name|sm
argument_list|(
literal|"?8"
argument_list|)
expr_stmt|;
comment|/* Auto repeat on	*/
name|decstbm
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* No scroll region	*/
name|sgr
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
comment|/* Normal character attributes  */
comment|/* Say goodbye */
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cup
argument_list|(
literal|12
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"That's all, folks!\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n\n\n"
argument_list|)
expr_stmt|;
name|inflush
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|SARG20
name|ttybin
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|/* reset line to normal mode */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|UNIX
name|stty
argument_list|(
literal|0
argument_list|,
operator|&
name|sgttyOrg
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|exit
argument_list|()
expr_stmt|;
block|}
end_block

begin_ifdef
ifdef|#
directive|ifdef
name|UNIX
end_ifdef

begin_macro
name|onbrk
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINT
argument_list|,
operator|(
name|void
operator|*
operator|)
name|onbrk
argument_list|)
expr_stmt|;
if|if
condition|(
name|reading
condition|)
name|brkrd
operator|=
literal|1
expr_stmt|;
else|else
name|longjmp
argument_list|(
name|intrenv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|onterm
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGTERM
argument_list|,
operator|(
name|void
operator|*
operator|)
name|onterm
argument_list|)
expr_stmt|;
name|longjmp
argument_list|(
name|intrenv
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_endif
endif|#
directive|endif
end_endif

begin_macro
name|holdit
argument_list|()
end_macro

begin_block
block|{
name|inflush
argument_list|()
expr_stmt|;
name|printf
argument_list|(
literal|"Push<RETURN>"
argument_list|)
expr_stmt|;
name|readnl
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|readnl
argument_list|()
end_macro

begin_block
block|{
ifdef|#
directive|ifdef
name|UNIX
name|char
name|ch
decl_stmt|;
name|fflush
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|brkrd
operator|=
literal|0
expr_stmt|;
name|reading
operator|=
literal|1
expr_stmt|;
do|do
block|{
name|read
argument_list|(
name|STDIN_FILENO
argument_list|,
operator|&
name|ch
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|ch
operator|!=
literal|'\n'
operator|&&
operator|!
name|brkrd
condition|)
do|;
if|if
condition|(
name|brkrd
condition|)
name|kill
argument_list|(
name|getpid
argument_list|()
argument_list|,
name|SIGTERM
argument_list|)
expr_stmt|;
name|reading
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SARG10
while|while
condition|(
name|getchar
argument_list|()
operator|!=
literal|'\n'
condition|)
empty_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|SARG20
while|while
condition|(
name|getchar
argument_list|()
operator|!=
literal|'\n'
condition|)
empty_stmt|;
endif|#
directive|endif
block|}
end_block

begin_macro
name|scanto
argument_list|(
argument|str
argument_list|,
argument|pos
argument_list|,
argument|toc
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|str
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|pos
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|toc
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|char
name|c
decl_stmt|;
name|int
name|result
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|toc
operator|!=
operator|(
name|c
operator|=
name|str
index|[
operator|(
operator|*
name|pos
operator|)
operator|++
index|]
operator|)
condition|)
block|{
if|if
condition|(
name|isdigit
argument_list|(
name|c
argument_list|)
condition|)
name|result
operator|=
name|result
operator|*
literal|10
operator|+
name|c
operator|-
literal|'0'
expr_stmt|;
else|else
break|break;
block|}
if|if
condition|(
name|c
operator|==
name|toc
condition|)
return|return
operator|(
name|result
operator|)
return|;
else|else
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_function
name|char
modifier|*
name|lookup
parameter_list|(
name|t
parameter_list|,
name|k
parameter_list|)
name|struct
name|table
name|t
index|[]
decl_stmt|;
name|int
name|k
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|t
index|[
name|i
index|]
operator|.
name|key
operator|!=
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|t
index|[
name|i
index|]
operator|.
name|key
operator|==
name|k
condition|)
return|return
operator|(
name|t
index|[
name|i
index|]
operator|.
name|msg
operator|)
return|;
block|}
return|return
operator|(
literal|"BAD VALUE"
operator|)
return|;
block|}
end_function

begin_macro
name|menu
argument_list|(
argument|table
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|table
index|[]
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|tablesize
decl_stmt|,
name|choice
decl_stmt|;
name|char
name|c
decl_stmt|;
name|char
name|storage
index|[
literal|80
index|]
decl_stmt|;
name|char
modifier|*
name|s
init|=
name|storage
decl_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|tablesize
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|*
name|table
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"          %d. %s\n"
argument_list|,
name|i
argument_list|,
name|table
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|tablesize
operator|++
expr_stmt|;
block|}
name|tablesize
operator|--
expr_stmt|;
name|printf
argument_list|(
literal|"\n          Enter choice number (0 - %d): "
argument_list|,
name|tablesize
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|inputline
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|choice
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|c
operator|=
operator|*
name|s
operator|++
condition|)
name|choice
operator|=
literal|10
operator|*
name|choice
operator|+
name|c
operator|-
literal|'0'
expr_stmt|;
if|if
condition|(
name|choice
operator|>=
literal|0
operator|&&
name|choice
operator|<=
name|tablesize
condition|)
block|{
name|ed
argument_list|(
literal|2
argument_list|)
expr_stmt|;
return|return
operator|(
name|choice
operator|)
return|;
block|}
name|printf
argument_list|(
literal|"          Bad choice, try again: "
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|chrprint
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"  "
argument_list|)
expr_stmt|;
name|sgr
argument_list|(
literal|"7"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|s
index|[
name|i
index|]
operator|!=
literal|'\0'
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|s
index|[
name|i
index|]
operator|<=
literal|' '
operator|||
name|s
index|[
name|i
index|]
operator|==
literal|'\177'
condition|)
name|printf
argument_list|(
literal|"<%d> "
argument_list|,
name|s
index|[
name|i
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"%c "
argument_list|,
name|s
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|sgr
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

