begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static char sccsid[] = "from: @(#)nlm_prot.x 1.8 87/09/21 Copyr 1987 Sun Micro"; static char sccsid[] = "from: * @(#)nlm_prot.x	2.1 88/08/01 4.0 RPCSRC";
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<rpc/rpc.h>
end_include

begin_include
include|#
directive|include
file|<rpcsvc/nlm_prot.h>
end_include

begin_comment
comment|/* Default timeout can be changed using clnt_control() */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|timeval
name|TIMEOUT
init|=
block|{
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|nlm_testres
modifier|*
name|nlm_test_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_testargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_testres
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_TEST
argument_list|,
name|xdr_nlm_testargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_testres
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_res
modifier|*
name|nlm_lock_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_lockargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
name|enum
name|clnt_stat
name|st
decl_stmt|;
specifier|static
name|nlm_res
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|st
operator|=
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_LOCK
argument_list|,
name|xdr_nlm_lockargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_res
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
name|printf
argument_list|(
literal|"clnt_call returns %d\n"
argument_list|,
name|st
argument_list|)
expr_stmt|;
name|clnt_perror
argument_list|(
name|clnt
argument_list|,
literal|"humbug"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_res
modifier|*
name|nlm_cancel_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_cancargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_res
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_CANCEL
argument_list|,
name|xdr_nlm_cancargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_res
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_res
modifier|*
name|nlm_unlock_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_unlockargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_res
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_UNLOCK
argument_list|,
name|xdr_nlm_unlockargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_res
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_res
modifier|*
name|nlm_granted_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_testargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_res
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_GRANTED
argument_list|,
name|xdr_nlm_testargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_res
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_test_msg_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_testargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_TEST_MSG
argument_list|,
name|xdr_nlm_testargs
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_lock_msg_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_lockargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_LOCK_MSG
argument_list|,
name|xdr_nlm_lockargs
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
name|NULL
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
name|clnt_perror
argument_list|(
name|clnt
argument_list|,
literal|"nlm_lock_msg_1"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_cancel_msg_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_cancargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_CANCEL_MSG
argument_list|,
name|xdr_nlm_cancargs
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_unlock_msg_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_unlockargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_UNLOCK_MSG
argument_list|,
name|xdr_nlm_unlockargs
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_granted_msg_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|struct
name|nlm_testargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_GRANTED_MSG
argument_list|,
name|xdr_nlm_testargs
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_test_res_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_testres
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_TEST_RES
argument_list|,
name|xdr_nlm_testres
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_lock_res_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_res
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_LOCK_RES
argument_list|,
name|xdr_nlm_res
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_cancel_res_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_res
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_CANCEL_RES
argument_list|,
name|xdr_nlm_res
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_unlock_res_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_res
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_UNLOCK_RES
argument_list|,
name|xdr_nlm_res
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_granted_res_1
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_res
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_GRANTED_RES
argument_list|,
name|xdr_nlm_res
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_shareres
modifier|*
name|nlm_share_3
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_shareargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_shareres
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_SHARE
argument_list|,
name|xdr_nlm_shareargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_shareres
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_shareres
modifier|*
name|nlm_unshare_3
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_shareargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_shareres
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_UNSHARE
argument_list|,
name|xdr_nlm_shareargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_shareres
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|nlm_res
modifier|*
name|nlm_nm_lock_3
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_lockargs
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|nlm_res
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_NM_LOCK
argument_list|,
name|xdr_nlm_lockargs
argument_list|,
name|argp
argument_list|,
name|xdr_nlm_res
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|void
modifier|*
name|nlm_free_all_3
parameter_list|(
name|argp
parameter_list|,
name|clnt
parameter_list|)
name|nlm_notify
modifier|*
name|argp
decl_stmt|;
name|CLIENT
modifier|*
name|clnt
decl_stmt|;
block|{
specifier|static
name|char
name|res
decl_stmt|;
name|bzero
argument_list|(
operator|(
name|char
operator|*
operator|)
operator|&
name|res
argument_list|,
sizeof|sizeof
argument_list|(
name|res
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|clnt_call
argument_list|(
name|clnt
argument_list|,
name|NLM_FREE_ALL
argument_list|,
name|xdr_nlm_notify
argument_list|,
name|argp
argument_list|,
name|xdr_void
argument_list|,
operator|&
name|res
argument_list|,
name|TIMEOUT
argument_list|)
operator|!=
name|RPC_SUCCESS
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
return|return
operator|(
operator|(
name|void
operator|*
operator|)
operator|&
name|res
operator|)
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|CLIENT
modifier|*
name|cli
decl_stmt|;
name|nlm_res
name|res_block
decl_stmt|;
name|nlm_res
modifier|*
name|out
decl_stmt|;
name|nlm_lockargs
name|arg
decl_stmt|;
name|struct
name|timeval
name|tim
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
literal|2
condition|)
block|{
name|printf
argument_list|(
literal|"usage: %s<lockd hostname>\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"Creating client for host %s\n"
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|cli
operator|=
name|clnt_create
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
name|NLM_PROG
argument_list|,
name|NLM_VERS
argument_list|,
literal|"udp"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|cli
condition|)
block|{
name|printf
argument_list|(
literal|"Failed to create client\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|clnt_control
argument_list|(
name|cli
argument_list|,
name|CLGET_TIMEOUT
argument_list|,
operator|&
name|tim
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Default timeout was %d.%d\n"
argument_list|,
name|tim
operator|.
name|tv_sec
argument_list|,
name|tim
operator|.
name|tv_usec
argument_list|)
expr_stmt|;
name|tim
operator|.
name|tv_usec
operator|=
operator|-
literal|1
expr_stmt|;
name|tim
operator|.
name|tv_sec
operator|=
operator|-
literal|1
expr_stmt|;
name|clnt_control
argument_list|(
name|cli
argument_list|,
name|CLSET_TIMEOUT
argument_list|,
operator|&
name|tim
argument_list|)
expr_stmt|;
name|clnt_control
argument_list|(
name|cli
argument_list|,
name|CLGET_TIMEOUT
argument_list|,
operator|&
name|tim
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"timeout now %d.%d\n"
argument_list|,
name|tim
operator|.
name|tv_sec
argument_list|,
name|tim
operator|.
name|tv_usec
argument_list|)
expr_stmt|;
name|arg
operator|.
name|cookie
operator|.
name|n_len
operator|=
literal|4
expr_stmt|;
name|arg
operator|.
name|cookie
operator|.
name|n_bytes
operator|=
literal|"hello"
expr_stmt|;
name|arg
operator|.
name|block
operator|=
literal|0
expr_stmt|;
name|arg
operator|.
name|exclusive
operator|=
literal|0
expr_stmt|;
name|arg
operator|.
name|reclaim
operator|=
literal|0
expr_stmt|;
name|arg
operator|.
name|state
operator|=
literal|0x1234
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|caller_name
operator|=
literal|"localhost"
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|fh
operator|.
name|n_len
operator|=
literal|32
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|fh
operator|.
name|n_bytes
operator|=
literal|"\x04\x04\x02\x00\x01\x00\x00\x00\x0c\x00\x00\x00\xff\xff\xff\xd0\x16\x00\x00\x5b\x7c\xff\xff\xff\xec\x2f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x19\x54\xef\xbf\xd7\x94"
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|oh
operator|.
name|n_len
operator|=
literal|8
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|oh
operator|.
name|n_bytes
operator|=
literal|"\x00\x00\x02\xff\xff\xff\xd3"
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|svid
operator|=
literal|0x5678
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|l_offset
operator|=
literal|0
expr_stmt|;
name|arg
operator|.
name|alock
operator|.
name|l_len
operator|=
literal|100
expr_stmt|;
name|res_block
operator|.
name|stat
operator|.
name|stat
operator|=
name|nlm_granted
expr_stmt|;
name|res_block
operator|.
name|cookie
operator|.
name|n_bytes
operator|=
literal|"hello"
expr_stmt|;
name|res_block
operator|.
name|cookie
operator|.
name|n_len
operator|=
literal|5
expr_stmt|;
if|#
directive|if
literal|0
block|if (nlm_lock_res_1(&res_block, cli)) printf("Success!\n");   else printf("Fail\n");
else|#
directive|else
if|if
condition|(
name|out
operator|=
name|nlm_lock_msg_1
argument_list|(
operator|&
name|arg
argument_list|,
name|cli
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"Success!\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"out->stat = %d"
argument_list|,
name|out
operator|->
name|stat
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"Fail\n"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

end_unit

