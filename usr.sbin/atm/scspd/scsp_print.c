begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  * ===================================  * HARP  |  Host ATM Research Platform  * ===================================  *  *  * This Host ATM Research Platform ("HARP") file (the "Software") is  * made available by Network Computing Services, Inc. ("NetworkCS")  * "AS IS".  NetworkCS does not provide maintenance, improvements or  * support of any kind.  *  * NETWORKCS MAKES NO WARRANTIES OR REPRESENTATIONS, EXPRESS OR IMPLIED,  * INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS FOR A PARTICULAR PURPOSE, AS TO ANY ELEMENT OF THE  * SOFTWARE OR ANY SUPPORT PROVIDED IN CONNECTION WITH THIS SOFTWARE.  * In no event shall NetworkCS be responsible for any damages, including  * but not limited to consequential damages, arising from or relating to  * any use of the Software or related support.  *  * Copyright 1994-1998 Network Computing Services, Inc.  *  * Copies of this Software may be made, however, the above copyright  * notice must be reproduced on all copies.  *  *	@(#) $FreeBSD$  *  */
end_comment

begin_comment
comment|/*  * Server Cache Synchronization Protocol (SCSP) Support  * ----------------------------------------------------  *  * Print routines  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<netatm/port.h>
end_include

begin_include
include|#
directive|include
file|<netatm/queue.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_if.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_sap.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_sys.h>
end_include

begin_include
include|#
directive|include
file|<netatm/atm_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<libatm.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<syslog.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"scsp_msg.h"
end_include

begin_include
include|#
directive|include
file|"scsp_if.h"
end_include

begin_include
include|#
directive|include
file|"scsp_var.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_expr_stmt
name|__RCSID
argument_list|(
literal|"@(#) $FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Indent string  */
end_comment

begin_define
define|#
directive|define
name|MIN_INDENT
value|2
end_define

begin_define
define|#
directive|define
name|MAX_INDENT
value|64
end_define

begin_decl_stmt
specifier|static
name|char
name|indent
index|[
name|MAX_INDENT
operator|+
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Value-name translation table entry  */
end_comment

begin_struct
struct|struct
name|type_name
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|u_char
name|type
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|type_name
name|Type_name
typedef|;
end_typedef

begin_comment
comment|/*  * SCSP name-type tables  */
end_comment

begin_decl_stmt
specifier|static
name|Type_name
name|if_msg_types
index|[]
init|=
block|{
block|{
literal|"Config Request"
block|,
name|SCSP_CFG_REQ
block|}
block|,
block|{
literal|"Config Response"
block|,
name|SCSP_CFG_RSP
block|}
block|,
block|{
literal|"Cache Indication"
block|,
name|SCSP_CACHE_IND
block|}
block|,
block|{
literal|"Cache Response"
block|,
name|SCSP_CACHE_RSP
block|}
block|,
block|{
literal|"Solicit Indication"
block|,
name|SCSP_SOLICIT_IND
block|}
block|,
block|{
literal|"Solicit Response"
block|,
name|SCSP_SOLICIT_RSP
block|}
block|,
block|{
literal|"Cache Update Indication"
block|,
name|SCSP_UPDATE_IND
block|}
block|,
block|{
literal|"Cache Update Request"
block|,
name|SCSP_UPDATE_REQ
block|}
block|,
block|{
literal|"Cache Update Response"
block|,
name|SCSP_UPDATE_RSP
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|msg_types
index|[]
init|=
block|{
block|{
literal|"Cache Alignment"
block|,
name|SCSP_CA_MSG
block|}
block|,
block|{
literal|"CSU Request"
block|,
name|SCSP_CSU_REQ_MSG
block|}
block|,
block|{
literal|"CSU Reply"
block|,
name|SCSP_CSU_REPLY_MSG
block|}
block|,
block|{
literal|"CSU Solicit"
block|,
name|SCSP_CSUS_MSG
block|}
block|,
block|{
literal|"Hello"
block|,
name|SCSP_HELLO_MSG
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|proto_types
index|[]
init|=
block|{
block|{
literal|"ATMARP"
block|,
name|SCSP_PROTO_ATMARP
block|}
block|,
block|{
literal|"NHRP"
block|,
name|SCSP_PROTO_NHRP
block|}
block|,
block|{
literal|"MARS"
block|,
name|SCSP_PROTO_MARS
block|}
block|,
block|{
literal|"DHCP"
block|,
name|SCSP_PROTO_DHCP
block|}
block|,
block|{
literal|"LNNI"
block|,
name|SCSP_PROTO_LNNI
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|ext_types
index|[]
init|=
block|{
block|{
literal|"End of Extensions"
block|,
name|SCSP_EXT_END
block|}
block|,
block|{
literal|"Authentication"
block|,
name|SCSP_EXT_AUTH
block|}
block|,
block|{
literal|"Vendor Private"
block|,
name|SCSP_EXT_VENDOR
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|hfsm_state_names
index|[]
init|=
block|{
block|{
literal|"Down"
block|,
name|SCSP_HFSM_DOWN
block|}
block|,
block|{
literal|"Waiting"
block|,
name|SCSP_HFSM_WAITING
block|}
block|,
block|{
literal|"Unidirectional"
block|,
name|SCSP_HFSM_UNI_DIR
block|}
block|,
block|{
literal|"Bidirectional"
block|,
name|SCSP_HFSM_BI_DIR
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|hfsm_event_names
index|[]
init|=
block|{
block|{
literal|"VC open"
block|,
name|SCSP_HFSM_VC_ESTAB
block|}
block|,
block|{
literal|"VC closed"
block|,
name|SCSP_HFSM_VC_CLOSED
block|}
block|,
block|{
literal|"Hello timer"
block|,
name|SCSP_HFSM_HELLO_T
block|}
block|,
block|{
literal|"Receive timer"
block|,
name|SCSP_HFSM_RCV_T
block|}
block|,
block|{
literal|"Msg received"
block|,
name|SCSP_HFSM_RCVD
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|cafsm_state_names
index|[]
init|=
block|{
block|{
literal|"Down"
block|,
name|SCSP_CAFSM_DOWN
block|}
block|,
block|{
literal|"Master/Slave negotiation"
block|,
name|SCSP_CAFSM_NEG
block|}
block|,
block|{
literal|"Master"
block|,
name|SCSP_CAFSM_MASTER
block|}
block|,
block|{
literal|"Slave"
block|,
name|SCSP_CAFSM_SLAVE
block|}
block|,
block|{
literal|"Update cache"
block|,
name|SCSP_CAFSM_UPDATE
block|}
block|,
block|{
literal|"Aligned"
block|,
name|SCSP_CAFSM_ALIGNED
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|cafsm_event_names
index|[]
init|=
block|{
block|{
literal|"Hello FSM up"
block|,
name|SCSP_CAFSM_HELLO_UP
block|}
block|,
block|{
literal|"Hello FSM down"
block|,
name|SCSP_CAFSM_HELLO_DOWN
block|}
block|,
block|{
literal|"CA received"
block|,
name|SCSP_CAFSM_CA_MSG
block|}
block|,
block|{
literal|"CSU Solicit received"
block|,
name|SCSP_CAFSM_CSUS_MSG
block|}
block|,
block|{
literal|"CSU Request received"
block|,
name|SCSP_CAFSM_CSU_REQ
block|}
block|,
block|{
literal|"CSU Reply received"
block|,
name|SCSP_CAFSM_CSU_REPLY
block|}
block|,
block|{
literal|"CA timer"
block|,
name|SCSP_CAFSM_CA_T
block|}
block|,
block|{
literal|"CSUS timer"
block|,
name|SCSP_CAFSM_CSUS_T
block|}
block|,
block|{
literal|"CSU timer"
block|,
name|SCSP_CAFSM_CSU_T
block|}
block|,
block|{
literal|"Cache Update"
block|,
name|SCSP_CAFSM_CACHE_UPD
block|}
block|,
block|{
literal|"Cache Response"
block|,
name|SCSP_CAFSM_CACHE_RSP
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|cifsm_state_names
index|[]
init|=
block|{
block|{
literal|"Null"
block|,
name|SCSP_CIFSM_NULL
block|}
block|,
block|{
literal|"Summarize"
block|,
name|SCSP_CIFSM_SUM
block|}
block|,
block|{
literal|"Update"
block|,
name|SCSP_CIFSM_UPD
block|}
block|,
block|{
literal|"Aligned"
block|,
name|SCSP_CIFSM_ALIGN
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|cifsm_event_names
index|[]
init|=
block|{
block|{
literal|"CA FSM down"
block|,
name|SCSP_CIFSM_CA_DOWN
block|}
block|,
block|{
literal|"CA FSM to Summarize"
block|,
name|SCSP_CIFSM_CA_SUMM
block|}
block|,
block|{
literal|"CA FSM to Update"
block|,
name|SCSP_CIFSM_CA_UPD
block|}
block|,
block|{
literal|"CA FSM to Aligned"
block|,
name|SCSP_CIFSM_CA_ALIGN
block|}
block|,
block|{
literal|"Solicit Rsp"
block|,
name|SCSP_CIFSM_SOL_RSP
block|}
block|,
block|{
literal|"Update Req"
block|,
name|SCSP_CIFSM_UPD_REQ
block|}
block|,
block|{
literal|"Update Rsp"
block|,
name|SCSP_CIFSM_UPD_RSP
block|}
block|,
block|{
literal|"CSU Request"
block|,
name|SCSP_CIFSM_CSU_REQ
block|}
block|,
block|{
literal|"CSU Reply"
block|,
name|SCSP_CIFSM_CSU_REPLY
block|}
block|,
block|{
literal|"CSU Solicit"
block|,
name|SCSP_CIFSM_CSU_SOL
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|Type_name
name|atmarp_state_names
index|[]
init|=
block|{
block|{
literal|"New"
block|,
name|SCSP_ASTATE_NEW
block|}
block|,
block|{
literal|"Updated"
block|,
name|SCSP_ASTATE_UPD
block|}
block|,
block|{
literal|"Deleted"
block|,
name|SCSP_ASTATE_DEL
block|}
block|,
block|{
operator|(
name|char
operator|*
operator|)
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Initialize the indent string  *  * Arguments:  *	none  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|init_indent
parameter_list|()
block|{
name|indent
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Increment the indent string  *  * Arguments:  *	none  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|inc_indent
parameter_list|()
block|{
if|if
condition|(
name|strlen
argument_list|(
name|indent
argument_list|)
operator|>=
name|MAX_INDENT
condition|)
return|return;
name|strcat
argument_list|(
name|indent
argument_list|,
literal|"  "
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Decrement the indent string  *  * Arguments:  *	none  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|dec_indent
parameter_list|()
block|{
if|if
condition|(
name|strlen
argument_list|(
name|indent
argument_list|)
operator|<
name|MIN_INDENT
condition|)
return|return;
name|indent
index|[
name|strlen
argument_list|(
name|indent
argument_list|)
operator|-
literal|2
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Search for a type in a name-type table  *  * Arguments:  *	type	the value being searched for  *	tbl	pointer to the table to search  *  * Returns:  *	pointer to a string identifying the type  *  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|scsp_type_name
parameter_list|(
name|type
parameter_list|,
name|tbl
parameter_list|)
name|u_char
name|type
decl_stmt|;
name|Type_name
modifier|*
name|tbl
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
comment|/* 	 * Search the table 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|tbl
index|[
name|i
index|]
operator|.
name|name
operator|!=
operator|(
name|char
operator|*
operator|)
literal|0
operator|&&
name|tbl
index|[
name|i
index|]
operator|.
name|type
operator|!=
name|type
condition|;
name|i
operator|++
control|)
empty_stmt|;
comment|/* 	 * Check the result and return the appropriate value 	 */
if|if
condition|(
name|tbl
index|[
name|i
index|]
operator|.
name|name
condition|)
return|return
operator|(
name|tbl
index|[
name|i
index|]
operator|.
name|name
operator|)
return|;
else|else
return|return
operator|(
literal|"-"
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a Hello FSM state name  *  * Arguments:  *	state	the state  *  * Returns:  *	pointer to a string identifying the state  *  */
end_comment

begin_function
name|char
modifier|*
name|format_hfsm_state
parameter_list|(
name|state
parameter_list|)
name|int
name|state
decl_stmt|;
block|{
return|return
operator|(
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|state
argument_list|,
name|hfsm_state_names
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a Hello FSM event name  *  * Arguments:  *	event	the event  *  * Returns:  *	pointer to a string identifying the event  *  */
end_comment

begin_function
name|char
modifier|*
name|format_hfsm_event
parameter_list|(
name|event
parameter_list|)
name|int
name|event
decl_stmt|;
block|{
name|char
modifier|*
name|cp
decl_stmt|;
name|cp
operator|=
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|event
argument_list|,
name|hfsm_event_names
argument_list|)
expr_stmt|;
return|return
operator|(
name|cp
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a CA FSM state name  *  * Arguments:  *	state	the state  *  * Returns:  *	pointer to a string identifying the state  *  */
end_comment

begin_function
name|char
modifier|*
name|format_cafsm_state
parameter_list|(
name|state
parameter_list|)
name|int
name|state
decl_stmt|;
block|{
return|return
operator|(
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|state
argument_list|,
name|cafsm_state_names
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a CA FSM event name  *  * Arguments:  *	event	the event  *  * Returns:  *	pointer to a string identifying the event  *  */
end_comment

begin_function
name|char
modifier|*
name|format_cafsm_event
parameter_list|(
name|event
parameter_list|)
name|int
name|event
decl_stmt|;
block|{
return|return
operator|(
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|event
argument_list|,
name|cafsm_event_names
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a client interface FSM state name  *  * Arguments:  *	state	the state  *  * Returns:  *	pointer to a string identifying the state  *  */
end_comment

begin_function
name|char
modifier|*
name|format_cifsm_state
parameter_list|(
name|state
parameter_list|)
name|int
name|state
decl_stmt|;
block|{
return|return
operator|(
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|state
argument_list|,
name|cifsm_state_names
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Format a client interface FSM event name  *  * Arguments:  *	event	the event  *  * Returns:  *	pointer to a string identifying the event  *  */
end_comment

begin_function
name|char
modifier|*
name|format_cifsm_event
parameter_list|(
name|event
parameter_list|)
name|int
name|event
decl_stmt|;
block|{
return|return
operator|(
name|scsp_type_name
argument_list|(
operator|(
name|u_char
operator|)
name|event
argument_list|,
name|cifsm_event_names
argument_list|)
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Print a Sender or Receiver ID structure  *  * Arguments:  *	fp	file to print message to  *	idp	pointer to ID to be printed  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_id
parameter_list|(
name|fp
parameter_list|,
name|idp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_id
modifier|*
name|idp
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext:                 %p\n"
argument_list|,
name|indent
argument_list|,
name|idp
operator|->
name|next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sLength:               %d\n"
argument_list|,
name|indent
argument_list|,
name|idp
operator|->
name|id_len
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sID:                   0x"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|idp
operator|->
name|id_len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%02x "
argument_list|,
name|idp
operator|->
name|id
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a Cache Key structure  *  * Arguments:  *	fp	file to print message to  *	ckp	pointer to cache key structure  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_cache_key
parameter_list|(
name|fp
parameter_list|,
name|ckp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_ckey
modifier|*
name|ckp
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sLength:               %d\n"
argument_list|,
name|indent
argument_list|,
name|ckp
operator|->
name|key_len
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sKey:                  0x"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ckp
operator|->
name|key_len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%02x "
argument_list|,
name|ckp
operator|->
name|key
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print the mandatory common part of a message  *  * Arguments:  *	fp	file to print message to  *	mcp	pointer to mandatory common part structure  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_mcp
parameter_list|(
name|fp
parameter_list|,
name|mcp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_mcp
modifier|*
name|mcp
decl_stmt|;
block|{
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sProtocol ID:          %s (0x%02x)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|mcp
operator|->
name|pid
argument_list|,
name|proto_types
argument_list|)
argument_list|,
name|mcp
operator|->
name|pid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sServer Group ID:      %d\n"
argument_list|,
name|indent
argument_list|,
name|mcp
operator|->
name|sgid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sFlags:                0x%04x\n"
argument_list|,
name|indent
argument_list|,
name|mcp
operator|->
name|flags
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sRecord Count:         %d\n"
argument_list|,
name|indent
argument_list|,
name|mcp
operator|->
name|rec_cnt
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSender ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|mcp
operator|->
name|sid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sReceiver ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|mcp
operator|->
name|rid
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an extension  *  * Arguments:  *	fp	file to print message to  *	exp	pointer to extension  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_ext
parameter_list|(
name|fp
parameter_list|,
name|exp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_ext
modifier|*
name|exp
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|u_char
modifier|*
name|cp
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext:                 %p\n"
argument_list|,
name|indent
argument_list|,
name|exp
operator|->
name|next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sType:                 %s (0x%02x)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|exp
operator|->
name|type
argument_list|,
name|ext_types
argument_list|)
argument_list|,
name|exp
operator|->
name|type
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sLength:               %d\n"
argument_list|,
name|indent
argument_list|,
name|exp
operator|->
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|exp
operator|->
name|len
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sValue:                0x"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|cp
operator|=
operator|(
name|u_char
operator|*
operator|)
operator|(
operator|(
name|caddr_t
operator|)
name|exp
operator|+
sizeof|sizeof
argument_list|(
name|Scsp_ext
argument_list|)
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|exp
operator|->
name|len
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%02x "
argument_list|,
operator|*
name|cp
operator|++
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an ATMARP Cache State Advertisement record  *  * Arguments:  *	fp	file to print message to  *	acsp	pointer to extension  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_atmarp_csa
parameter_list|(
name|fp
parameter_list|,
name|acsp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_atmarp_csa
modifier|*
name|acsp
decl_stmt|;
block|{
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sState:                 %s (%d)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|acsp
operator|->
name|sa_state
argument_list|,
name|atmarp_state_names
argument_list|)
argument_list|,
name|acsp
operator|->
name|sa_state
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSource ATM addr:       %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_sha
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSource ATM subaddr:    %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_ssa
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSource IP addr:        %s\n"
argument_list|,
name|indent
argument_list|,
name|format_ip_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_spa
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sTarget ATM addr:       %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_tha
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sTarget ATM subaddr:    %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_tsa
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sTarget IP addr:        %s\n"
argument_list|,
name|indent
argument_list|,
name|format_ip_addr
argument_list|(
operator|&
name|acsp
operator|->
name|sa_tpa
argument_list|)
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a Cache State Advertisement record or  * Cache State Advertisement Summary record  *  * Arguments:  *	fp	file to print message to  *	csap	pointer to CSA or CSAS  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_csa
parameter_list|(
name|fp
parameter_list|,
name|csap
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_csa
modifier|*
name|csap
decl_stmt|;
block|{
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext:                 %p\n"
argument_list|,
name|indent
argument_list|,
name|csap
operator|->
name|next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHops:                 %d\n"
argument_list|,
name|indent
argument_list|,
name|csap
operator|->
name|hops
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNull Flag:            %s\n"
argument_list|,
name|indent
argument_list|,
name|csap
operator|->
name|null
condition|?
literal|"True"
else|:
literal|"False"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSequence no.:         %ld (0x%lx)\n"
argument_list|,
name|indent
argument_list|,
name|csap
operator|->
name|seq
argument_list|,
name|csap
operator|->
name|seq
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache Key:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_cache_key
argument_list|(
name|fp
argument_list|,
operator|&
name|csap
operator|->
name|key
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sOriginator ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|csap
operator|->
name|oid
argument_list|)
expr_stmt|;
if|if
condition|(
name|csap
operator|->
name|atmarp_data
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sATMARP data:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_atmarp_csa
argument_list|(
name|fp
argument_list|,
name|csap
operator|->
name|atmarp_data
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a Cache Alignment message  *  * Arguments:  *	fp	file to print message to  *	cap	pointer to extension  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_ca
parameter_list|(
name|fp
parameter_list|,
name|cap
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_ca
modifier|*
name|cap
decl_stmt|;
block|{
name|int
name|n
decl_stmt|;
name|Scsp_csa
modifier|*
name|csap
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCA Seq. No.:          %ld\n"
argument_list|,
name|indent
argument_list|,
name|cap
operator|->
name|ca_seq
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sM bit:                %s\n"
argument_list|,
name|indent
argument_list|,
name|cap
operator|->
name|ca_m
condition|?
literal|"True"
else|:
literal|"False"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sI bit:                %s\n"
argument_list|,
name|indent
argument_list|,
name|cap
operator|->
name|ca_i
condition|?
literal|"True"
else|:
literal|"False"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sO bit:                %s\n"
argument_list|,
name|indent
argument_list|,
name|cap
operator|->
name|ca_o
condition|?
literal|"True"
else|:
literal|"False"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMandatory Common Part:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_mcp
argument_list|(
name|fp
argument_list|,
operator|&
name|cap
operator|->
name|ca_mcp
argument_list|)
expr_stmt|;
for|for
control|(
name|csap
operator|=
name|cap
operator|->
name|ca_csa_rec
operator|,
name|n
operator|=
literal|1
init|;
name|csap
condition|;
name|csap
operator|=
name|csap
operator|->
name|next
operator|,
name|n
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA Record %d (%p):\n"
argument_list|,
name|indent
argument_list|,
name|n
argument_list|,
name|csap
argument_list|)
expr_stmt|;
name|print_scsp_csa
argument_list|(
name|fp
argument_list|,
name|csap
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a Cache State Update Request, Cache State Update Reply, or  * Cache State Update Solicit message  *  * Arguments:  *	fp	file to print message to  *	csup	pointer to CSU message  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_csu
parameter_list|(
name|fp
parameter_list|,
name|csup
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_csu_msg
modifier|*
name|csup
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|Scsp_csa
modifier|*
name|csap
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMandatory Common Part:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_mcp
argument_list|(
name|fp
argument_list|,
operator|&
name|csup
operator|->
name|csu_mcp
argument_list|)
expr_stmt|;
for|for
control|(
name|csap
operator|=
name|csup
operator|->
name|csu_csa_rec
operator|,
name|i
operator|=
literal|1
init|;
name|csap
condition|;
name|csap
operator|=
name|csap
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA Record %d:\n"
argument_list|,
name|indent
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|print_scsp_csa
argument_list|(
name|fp
argument_list|,
name|csap
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print a Hello message  *  * Arguments:  *	fp	file to print message to  *	hp	pointer to hello message  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_hello
parameter_list|(
name|fp
parameter_list|,
name|hp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_hello
modifier|*
name|hp
decl_stmt|;
block|{
name|Scsp_id
modifier|*
name|ridp
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHello Interval:       %d\n"
argument_list|,
name|indent
argument_list|,
name|hp
operator|->
name|hello_int
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDead Factor:          %d\n"
argument_list|,
name|indent
argument_list|,
name|hp
operator|->
name|dead_factor
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sFamily ID:            %d\n"
argument_list|,
name|indent
argument_list|,
name|hp
operator|->
name|family_id
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMandatory Common Part:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_mcp
argument_list|(
name|fp
argument_list|,
operator|&
name|hp
operator|->
name|hello_mcp
argument_list|)
expr_stmt|;
name|ridp
operator|=
name|hp
operator|->
name|hello_mcp
operator|.
name|rid
operator|.
name|next
expr_stmt|;
if|if
condition|(
name|ridp
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sAdditional Receiver IDs:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|ridp
condition|;
name|ridp
operator|=
name|ridp
operator|->
name|next
control|)
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
name|ridp
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|NOTDEF
end_ifdef

begin_comment
comment|/*  * NHRP-specific Cache State Advertisement record  */
end_comment

begin_struct
struct|struct
name|scsp_nhrp_csa
block|{
name|u_char
name|req_id
decl_stmt|;
comment|/* Request ID */
name|u_char
name|state
decl_stmt|;
comment|/* State */
name|u_char
name|pref_len
decl_stmt|;
comment|/* Prefix length */
name|u_short
name|flags
decl_stmt|;
comment|/* See below */
name|u_short
name|mtu
decl_stmt|;
comment|/* Maximim transmission unit */
name|u_short
name|hold_time
decl_stmt|;
comment|/* Entry holding time */
name|u_char
name|caddr_tlen
decl_stmt|;
comment|/* Client addr type/length */
name|u_char
name|csaddr_tlen
decl_stmt|;
comment|/* Client subaddr type/length */
name|u_char
name|cproto_len
decl_stmt|;
comment|/* Client proto addr length */
name|u_char
name|pref
decl_stmt|;
comment|/* Preference */
name|Atm_addr
name|caddr
decl_stmt|;
comment|/* Client address */
name|Atm_addr
name|csaddr
decl_stmt|;
comment|/* Client subaddress */
name|struct
name|in_addr
name|cproto_addr
decl_stmt|;
comment|/* Client protocol address */
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|scsp_nhrp
name|Scsp_nhrp
typedef|;
end_typedef

begin_define
define|#
directive|define
name|SCSP_NHRP_UNIQ
value|0x8000
end_define

begin_define
define|#
directive|define
name|SCSP_NHRP_ARP
value|0x4000
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * Print an SCSP message  *  * Arguments:  *	fp	file to print message to  *	msg	pointer to message to be printed  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_msg
parameter_list|(
name|fp
parameter_list|,
name|msg
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_msg
modifier|*
name|msg
decl_stmt|;
block|{
name|int
name|n
decl_stmt|;
name|Scsp_ext
modifier|*
name|exp
decl_stmt|;
comment|/* 	 * Initialize 	 */
name|init_indent
argument_list|()
expr_stmt|;
comment|/* 	 * Print the message type 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMessage type:         %s (0x%02x)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|msg
operator|->
name|sc_msg_type
argument_list|,
name|msg_types
argument_list|)
argument_list|,
name|msg
operator|->
name|sc_msg_type
argument_list|)
expr_stmt|;
comment|/* 	 * Print the body of the message 	 */
switch|switch
condition|(
name|msg
operator|->
name|sc_msg_type
condition|)
block|{
case|case
name|SCSP_CA_MSG
case|:
name|print_scsp_ca
argument_list|(
name|fp
argument_list|,
name|msg
operator|->
name|sc_ca
argument_list|)
expr_stmt|;
break|break;
case|case
name|SCSP_CSU_REQ_MSG
case|:
case|case
name|SCSP_CSU_REPLY_MSG
case|:
case|case
name|SCSP_CSUS_MSG
case|:
name|print_scsp_csu
argument_list|(
name|fp
argument_list|,
name|msg
operator|->
name|sc_csu_msg
argument_list|)
expr_stmt|;
break|break;
case|case
name|SCSP_HELLO_MSG
case|:
name|print_scsp_hello
argument_list|(
name|fp
argument_list|,
name|msg
operator|->
name|sc_hello
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* 	 * Print any extensions 	 */
for|for
control|(
name|exp
operator|=
name|msg
operator|->
name|sc_ext
operator|,
name|n
operator|=
literal|1
init|;
name|exp
condition|;
name|exp
operator|=
name|exp
operator|->
name|next
operator|,
name|n
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sExtension %d:\n"
argument_list|,
name|indent
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|print_scsp_ext
argument_list|(
name|fp
argument_list|,
name|exp
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP ATMARP message  *  * Arguments:  *	fp	file to print message to  *	acp	pointer to ATMARP message  *  * Returns:  *	none  *  */
end_comment

begin_function
specifier|static
name|void
name|print_scsp_if_atmarp
parameter_list|(
name|fp
parameter_list|,
name|amp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_atmarp_msg
modifier|*
name|amp
decl_stmt|;
block|{
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sState:                %s (%d)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|amp
operator|->
name|sa_state
argument_list|,
name|atmarp_state_names
argument_list|)
argument_list|,
name|amp
operator|->
name|sa_state
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCached protocol addr: %s\n"
argument_list|,
name|indent
argument_list|,
name|format_ip_addr
argument_list|(
operator|&
name|amp
operator|->
name|sa_cpa
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCached ATM addr:      %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|amp
operator|->
name|sa_cha
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCached ATM subaddr:      %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|amp
operator|->
name|sa_csa
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache key:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_cache_key
argument_list|(
name|fp
argument_list|,
operator|&
name|amp
operator|->
name|sa_key
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sOriginator ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|amp
operator|->
name|sa_oid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSequence number:         %ld (0x%08lx)\n"
argument_list|,
name|indent
argument_list|,
name|amp
operator|->
name|sa_seq
argument_list|,
operator|(
name|u_long
operator|)
name|amp
operator|->
name|sa_seq
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP client interface message  *  * Arguments:  *	fp	file to print message to  *	imsg	pointer to message to be printed  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_if_msg
parameter_list|(
name|fp
parameter_list|,
name|imsg
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_if_msg
modifier|*
name|imsg
decl_stmt|;
block|{
name|int
name|len
decl_stmt|;
name|Scsp_atmarp_msg
modifier|*
name|ap
decl_stmt|;
comment|/* 	 * Initialize 	 */
name|init_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"SCSP Client Interface Message at %p\n"
argument_list|,
name|imsg
argument_list|)
expr_stmt|;
comment|/* 	 * Print the message header 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMessage type:         %s (0x%02x)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|imsg
operator|->
name|si_type
argument_list|,
name|if_msg_types
argument_list|)
argument_list|,
name|imsg
operator|->
name|si_type
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sResponse code:        %d\n"
argument_list|,
name|indent
argument_list|,
name|imsg
operator|->
name|si_rc
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sProtocol type:        %s (%d)\n"
argument_list|,
name|indent
argument_list|,
name|scsp_type_name
argument_list|(
name|imsg
operator|->
name|si_proto
argument_list|,
name|proto_types
argument_list|)
argument_list|,
name|imsg
operator|->
name|si_proto
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sLength:               %d\n"
argument_list|,
name|indent
argument_list|,
name|imsg
operator|->
name|si_len
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sToken:                0x%lx\n"
argument_list|,
name|indent
argument_list|,
name|imsg
operator|->
name|si_tok
argument_list|)
expr_stmt|;
comment|/* 	 * Print the body of the message 	 */
switch|switch
condition|(
name|imsg
operator|->
name|si_type
condition|)
block|{
case|case
name|SCSP_CFG_REQ
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sInterface:            %s\n"
argument_list|,
name|indent
argument_list|,
name|imsg
operator|->
name|si_cfg
operator|.
name|atmarp_netif
argument_list|)
expr_stmt|;
break|break;
case|case
name|SCSP_CACHE_RSP
case|:
case|case
name|SCSP_UPDATE_IND
case|:
case|case
name|SCSP_UPDATE_REQ
case|:
name|len
operator|=
name|imsg
operator|->
name|si_len
operator|-
sizeof|sizeof
argument_list|(
name|Scsp_if_msg_hdr
argument_list|)
expr_stmt|;
name|ap
operator|=
operator|&
name|imsg
operator|->
name|si_atmarp
expr_stmt|;
while|while
condition|(
name|len
condition|)
block|{
switch|switch
condition|(
name|imsg
operator|->
name|si_proto
condition|)
block|{
case|case
name|SCSP_PROTO_ATMARP
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sATMARP CSA:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_if_atmarp
argument_list|(
name|fp
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|Scsp_atmarp_msg
argument_list|)
expr_stmt|;
name|ap
operator|++
expr_stmt|;
break|break;
case|case
name|SCSP_PROTO_NHRP
case|:
case|case
name|SCSP_PROTO_MARS
case|:
case|case
name|SCSP_PROTO_DHCP
case|:
case|case
name|SCSP_PROTO_LNNI
case|:
default|default:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Protocol type not implemented\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
break|break;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|fflush
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP pending connection block  *  * Arguments:  *	fp	file to print message to  *	pp	pointer to pending control block  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_pending
parameter_list|(
name|fp
parameter_list|,
name|pp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_pending
modifier|*
name|pp
decl_stmt|;
block|{
comment|/* 	 * Initialize 	 */
name|init_indent
argument_list|()
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Pending control block at %p\n"
argument_list|,
name|pp
argument_list|)
expr_stmt|;
comment|/* 	 * Print the fields of the control block 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext:                 %p\n"
argument_list|,
name|indent
argument_list|,
name|pp
operator|->
name|sp_next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSocket:               %d\n"
argument_list|,
name|indent
argument_list|,
name|pp
operator|->
name|sp_sock
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP server control block  *  * Arguments:  *	fp	file to print message to  *	ssp	pointer to server control block  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_server
parameter_list|(
name|fp
parameter_list|,
name|ssp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_server
modifier|*
name|ssp
decl_stmt|;
block|{
comment|/* 	 * Initialize 	 */
name|init_indent
argument_list|()
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Server control block at %p\n"
argument_list|,
name|ssp
argument_list|)
expr_stmt|;
comment|/* 	 * Print the fields of the client control block 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext:                 %p\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sName:                 %s\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNetwork Interface:    %s\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_intf
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sState:                %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_state
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sProtocol ID:          0x%lx\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_pid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sID length:            %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_id_len
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache key length:     %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_ckey_len
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sServer Group ID:      0x%lx\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_sgid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sFamily ID:            0x%lx\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_fid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSocket:               %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_sock
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDCS Listen Socket:    %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_dcs_lsock
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sLocal Server ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|ssp
operator|->
name|ss_lsid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sATM address:          %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|ssp
operator|->
name|ss_addr
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sATM subaddress:       %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|ssp
operator|->
name|ss_subaddr
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sInterface MTU:        %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_mtu
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sMark:                 %d\n"
argument_list|,
name|indent
argument_list|,
name|ssp
operator|->
name|ss_mark
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP client cache summary entry control block  *  * Arguments:  *	fp	file to print message to  *	csep	pointer to summary entry  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_cse
parameter_list|(
name|fp
parameter_list|,
name|csep
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_cse
modifier|*
name|csep
decl_stmt|;
block|{
comment|/* 	 * Print the fields of the cache summary entry 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext CSE:             %p\n"
argument_list|,
name|indent
argument_list|,
name|csep
operator|->
name|sc_next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA sequence no.:     %ld (0x%lx)\n"
argument_list|,
name|indent
argument_list|,
name|csep
operator|->
name|sc_seq
argument_list|,
name|csep
operator|->
name|sc_seq
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache key:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_cache_key
argument_list|(
name|fp
argument_list|,
operator|&
name|csep
operator|->
name|sc_key
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sOrigin ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|csep
operator|->
name|sc_oid
argument_list|)
expr_stmt|;
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP CSU Request retransmission control block  *  * Arguments:  *	fp	file to print message to  *	csurp	pointer to retransmission entry  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_csu_rexmt
parameter_list|(
name|fp
parameter_list|,
name|rxp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_csu_rexmt
modifier|*
name|rxp
decl_stmt|;
block|{
name|int
name|i
decl_stmt|;
name|Scsp_csa
modifier|*
name|csap
decl_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext CSU Req rexmt:   %p\n"
argument_list|,
name|indent
argument_list|,
name|rxp
operator|->
name|sr_next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDCS address:          %p\n"
argument_list|,
name|indent
argument_list|,
name|rxp
operator|->
name|sr_dcs
argument_list|)
expr_stmt|;
for|for
control|(
name|csap
operator|=
name|rxp
operator|->
name|sr_csa
operator|,
name|i
operator|=
literal|1
init|;
name|csap
condition|;
name|csap
operator|=
name|csap
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA %d:\n"
argument_list|,
name|indent
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|print_scsp_csa
argument_list|(
name|fp
argument_list|,
name|csap
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print an SCSP DCS control block  *  * Arguments:  *	fp	file to print message to  *	dcsp	pointer to DCS control block  *  * Returns:  *	none  *  */
end_comment

begin_function
name|void
name|print_scsp_dcs
parameter_list|(
name|fp
parameter_list|,
name|dcsp
parameter_list|)
name|FILE
modifier|*
name|fp
decl_stmt|;
name|Scsp_dcs
modifier|*
name|dcsp
decl_stmt|;
block|{
name|Scsp_csa
modifier|*
name|csap
decl_stmt|;
name|Scsp_cse
modifier|*
name|csep
decl_stmt|;
name|Scsp_csu_rexmt
modifier|*
name|rxp
decl_stmt|;
comment|/* 	 * Initialize 	 */
name|init_indent
argument_list|()
expr_stmt|;
comment|/* 	 * Print a header 	 */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"DCS control block at %p\n"
argument_list|,
name|dcsp
argument_list|)
expr_stmt|;
comment|/* 	 * Print the fields of the DCS control block 	 */
name|inc_indent
argument_list|()
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sNext DCS block:       %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_next
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sServer control block: %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_server
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDCS ID:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|print_scsp_id
argument_list|(
name|fp
argument_list|,
operator|&
name|dcsp
operator|->
name|sd_dcsid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDCS address:          %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|dcsp
operator|->
name|sd_addr
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sDCS subaddress        %s\n"
argument_list|,
name|indent
argument_list|,
name|format_atm_addr
argument_list|(
operator|&
name|dcsp
operator|->
name|sd_subaddr
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sSocket:               %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_sock
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sOpen VCC Retry Timer:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHello FSM State:      %s\n"
argument_list|,
name|indent
argument_list|,
name|format_hfsm_state
argument_list|(
name|dcsp
operator|->
name|sd_hello_state
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHello Interval:       %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_hello_int
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHello Dead Factor:    %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_hello_df
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sHello Rcvd:           %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_hello_rcvd
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCA FSM State:         %s\n"
argument_list|,
name|indent
argument_list|,
name|format_cafsm_state
argument_list|(
name|dcsp
operator|->
name|sd_ca_state
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCA Seq. No.:          0x%lx\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_ca_seq
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCA Rexmit Int:        %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_ca_rexmt_int
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCA Retransmit Msg:    %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_ca_rexmt_msg
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSASs to send:        "
argument_list|,
name|indent
argument_list|)
expr_stmt|;
if|if
condition|(
name|dcsp
operator|->
name|sd_ca_csas
operator|==
operator|(
name|Scsp_cse
operator|*
operator|)
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Empty\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%p\n"
argument_list|,
name|dcsp
operator|->
name|sd_ca_csas
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSUS Rexmit Int:      %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csus_rexmt_int
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache Request List:   "
argument_list|,
name|indent
argument_list|)
expr_stmt|;
if|if
condition|(
name|dcsp
operator|->
name|sd_crl
operator|==
operator|(
name|Scsp_csa
operator|*
operator|)
literal|0
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Empty\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%p\n"
argument_list|,
name|dcsp
operator|->
name|sd_crl
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSUS Rexmit Msg:      %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csus_rexmt_msg
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA Hop count:        %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_hops
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSAs Pending ACK:     %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csu_ack_pend
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSAs ACKed:           %p\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csu_ack
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSU Req Rexmit Int:   %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csu_rexmt_int
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSU Req Rexmit Max:   %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_csu_rexmt_max
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSU Req Rexmit Queue  "
argument_list|,
name|indent
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dcsp
operator|->
name|sd_csu_rexmt
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Empty\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%p\n"
argument_list|,
name|dcsp
operator|->
name|sd_csu_rexmt
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sClient I/F state:     %d\n"
argument_list|,
name|indent
argument_list|,
name|dcsp
operator|->
name|sd_client_state
argument_list|)
expr_stmt|;
comment|/* 	 * Print the list of CSASs waiting to be sent 	 */
if|if
condition|(
name|dcsp
operator|->
name|sd_ca_csas
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%sCSASs to send:"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
for|for
control|(
name|csep
operator|=
name|dcsp
operator|->
name|sd_ca_csas
init|;
name|csep
condition|;
name|csep
operator|=
name|csep
operator|->
name|sc_next
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCache summary entry at %p\n"
argument_list|,
name|indent
argument_list|,
name|csep
argument_list|)
expr_stmt|;
name|print_scsp_cse
argument_list|(
name|fp
argument_list|,
name|csep
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
comment|/* 	 * Print the Cache Request List 	 */
if|if
condition|(
name|dcsp
operator|->
name|sd_crl
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%sCache Request List:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
for|for
control|(
name|csap
operator|=
name|dcsp
operator|->
name|sd_crl
init|;
name|csap
condition|;
name|csap
operator|=
name|csap
operator|->
name|next
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSA at %p\n"
argument_list|,
name|indent
argument_list|,
name|csap
argument_list|)
expr_stmt|;
name|print_scsp_csa
argument_list|(
name|fp
argument_list|,
name|csap
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
comment|/* 	 * Print the CSU retransmit queue 	 */
if|if
condition|(
name|dcsp
operator|->
name|sd_csu_rexmt
condition|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n%sCSU Req Rexmit Queue:\n"
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|inc_indent
argument_list|()
expr_stmt|;
for|for
control|(
name|rxp
operator|=
name|dcsp
operator|->
name|sd_csu_rexmt
init|;
name|rxp
condition|;
name|rxp
operator|=
name|rxp
operator|->
name|sr_next
control|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%sCSU Rexmit Block at %p\n"
argument_list|,
name|indent
argument_list|,
name|rxp
argument_list|)
expr_stmt|;
name|print_scsp_csu_rexmt
argument_list|(
name|fp
argument_list|,
name|rxp
argument_list|)
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
name|dec_indent
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Print SCSP's control blocks  *  * Arguments:  *	none  *  * Returns:  *	None  *  */
end_comment

begin_function
name|void
name|print_scsp_dump
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
name|Scsp_server
modifier|*
name|ssp
decl_stmt|;
name|Scsp_dcs
modifier|*
name|dcsp
decl_stmt|;
name|Scsp_cse
modifier|*
name|scp
decl_stmt|;
name|Scsp_pending
modifier|*
name|pp
decl_stmt|;
name|FILE
modifier|*
name|df
decl_stmt|;
name|char
name|fname
index|[
literal|64
index|]
decl_stmt|;
specifier|static
name|int
name|dump_no
init|=
literal|0
decl_stmt|;
comment|/* 	 * Build a file name 	 */
name|bzero
argument_list|(
name|fname
argument_list|,
sizeof|sizeof
argument_list|(
name|fname
argument_list|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|fname
argument_list|,
literal|"/tmp/scspd.%d.%03d.out"
argument_list|,
name|getpid
argument_list|()
argument_list|,
name|dump_no
operator|++
argument_list|)
expr_stmt|;
comment|/* 	 * Open the output file 	 */
name|df
operator|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|df
operator|==
operator|(
name|FILE
operator|*
operator|)
literal|0
condition|)
return|return;
comment|/* 	 * Dump the server control blocks 	 */
for|for
control|(
name|ssp
operator|=
name|scsp_server_head
init|;
name|ssp
condition|;
name|ssp
operator|=
name|ssp
operator|->
name|ss_next
control|)
block|{
name|print_scsp_server
argument_list|(
name|df
argument_list|,
name|ssp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|df
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
comment|/* 		 * Print the client's cache summary 		 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SCSP_HASHSZ
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|scp
operator|=
name|ssp
operator|->
name|ss_cache
index|[
name|i
index|]
init|;
name|scp
condition|;
name|scp
operator|=
name|scp
operator|->
name|sc_next
control|)
block|{
name|print_scsp_cse
argument_list|(
name|df
argument_list|,
name|scp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|df
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* 		 * Print the client's DCS control blocks 		 */
for|for
control|(
name|dcsp
operator|=
name|ssp
operator|->
name|ss_dcs
init|;
name|dcsp
condition|;
name|dcsp
operator|=
name|dcsp
operator|->
name|sd_next
control|)
block|{
name|print_scsp_dcs
argument_list|(
name|df
argument_list|,
name|dcsp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|df
argument_list|,
literal|"\n\n"
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|df
argument_list|,
literal|"\n\n"
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Print the pending connection blocks 	 */
for|for
control|(
name|pp
operator|=
name|scsp_pending_head
init|;
name|pp
condition|;
name|pp
operator|=
name|pp
operator|->
name|sp_next
control|)
block|{
name|print_scsp_pending
argument_list|(
name|df
argument_list|,
name|pp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|df
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Close the output file 	 */
operator|(
name|void
operator|)
name|fclose
argument_list|(
name|df
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

