begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1999 Doug Rabson  * Copyright (c) 1999, 2000 Mitsuru IWASAKI<iwasaki@FreeBSD.org>  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *	$Id: aml_parse.c,v 1.32 2000/08/12 15:20:45 iwasaki Exp $  *	$FreeBSD$  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_amlmem.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_common.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_env.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_evalobj.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_name.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_obj.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_parse.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_status.h>
end_include

begin_include
include|#
directive|include
file|<aml/aml_store.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|_KERNEL
end_ifndef

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/mman.h>
end_include

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"debug.h"
end_include

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* _KERNEL */
end_comment

begin_include
include|#
directive|include
file|<sys/systm.h>
end_include

begin_include
include|#
directive|include
file|<sys/bus.h>
end_include

begin_include
include|#
directive|include
file|<machine/bus.h>
end_include

begin_include
include|#
directive|include
file|<dev/acpi/acpireg.h>
end_include

begin_include
include|#
directive|include
file|<dev/acpi/acpivar.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|ACPI_NO_OSDFUNC_INLINE
end_ifndef

begin_include
include|#
directive|include
file|<machine/acpica_osd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* !_KERNEL */
end_comment

begin_function_decl
specifier|static
name|int
name|findsetleftbit
parameter_list|(
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|findsetrightbit
parameter_list|(
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|frombcd
parameter_list|(
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|tobcd
parameter_list|(
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int32_t
name|aml_parse_pkglength
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int8_t
name|aml_parse_bytedata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int16_t
name|aml_parse_worddata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int32_t
name|aml_parse_dworddata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|u_int8_t
modifier|*
name|aml_parse_namestring
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defscope
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|union
name|aml_object
modifier|*
name|aml_parse_defbuffer
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_number
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|num1
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_buffer
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|obj
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_string
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|obj
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concatop
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|union
name|aml_object
modifier|*
name|aml_parse_defpackage
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defmethod
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defopregion
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|aml_parse_field
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|struct
name|aml_field
modifier|*
name|template
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_fieldlist
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|struct
name|aml_field
modifier|*
name|template
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_deffield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defindexfield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defbankfield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defdevice
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defprocessor
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defpowerres
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defthermalzone
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defelse
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|,
name|int
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defif
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defwhile
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defmutex
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_createfield_generic
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|srcbuf
parameter_list|,
name|int
name|index
parameter_list|,
name|int
name|len
parameter_list|,
name|char
modifier|*
name|newname
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|aml_parse_defcreatefield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|int
name|findsetleftbit
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|filter
decl_stmt|;
name|filter
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|filter
operator|=
name|filter
operator|>>
literal|1
expr_stmt|;
name|filter
operator||=
literal|1
operator|<<
literal|31
expr_stmt|;
if|if
condition|(
name|filter
operator|&
name|num
condition|)
block|{
break|break;
block|}
block|}
name|i
operator|=
operator|(
name|i
operator|==
literal|32
operator|)
condition|?
literal|0
else|:
name|i
operator|+
literal|1
expr_stmt|;
return|return
operator|(
name|i
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|findsetrightbit
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|filter
decl_stmt|;
name|filter
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|filter
operator|=
name|filter
operator|<<
literal|1
expr_stmt|;
name|filter
operator||=
literal|1
expr_stmt|;
if|if
condition|(
name|filter
operator|&
name|num
condition|)
block|{
break|break;
block|}
block|}
name|i
operator|=
operator|(
name|i
operator|==
literal|32
operator|)
condition|?
literal|0
else|:
name|i
operator|+
literal|1
expr_stmt|;
return|return
operator|(
name|i
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|frombcd
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|int
name|res
decl_stmt|,
name|factor
decl_stmt|;
name|res
operator|=
literal|0
expr_stmt|;
name|factor
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|num
operator|!=
literal|0
condition|)
block|{
name|res
operator|+=
operator|(
operator|(
name|num
operator|&
literal|0xf
operator|)
operator|*
name|factor
operator|)
expr_stmt|;
name|num
operator|=
name|num
operator|/
literal|16
expr_stmt|;
name|factor
operator|*=
literal|10
expr_stmt|;
block|}
return|return
operator|(
name|res
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|tobcd
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|int
name|res
decl_stmt|,
name|factor
decl_stmt|;
name|res
operator|=
literal|0
expr_stmt|;
name|factor
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|num
operator|!=
literal|0
condition|)
block|{
name|res
operator|+=
operator|(
operator|(
name|num
operator|%
literal|10
operator|)
operator|*
name|factor
operator|)
expr_stmt|;
name|num
operator|=
name|num
operator|/
literal|10
expr_stmt|;
name|factor
operator|*=
literal|16
expr_stmt|;
block|}
return|return
operator|(
name|res
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|u_int32_t
name|aml_parse_pkglength
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|dp
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|dp
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
operator|*
name|dp
operator|++
expr_stmt|;
switch|switch
condition|(
name|pkglength
operator|>>
literal|6
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|pkglength
operator|=
operator|(
name|pkglength
operator|&
literal|0xf
operator|)
operator|+
operator|(
name|dp
index|[
literal|0
index|]
operator|<<
literal|4
operator|)
expr_stmt|;
name|dp
operator|+=
literal|1
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|pkglength
operator|=
operator|(
name|pkglength
operator|&
literal|0xf
operator|)
operator|+
operator|(
name|dp
index|[
literal|0
index|]
operator|<<
literal|4
operator|)
operator|+
operator|(
name|dp
index|[
literal|1
index|]
operator|<<
literal|12
operator|)
expr_stmt|;
name|dp
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|pkglength
operator|=
operator|(
name|pkglength
operator|&
literal|0xf
operator|)
operator|+
operator|(
name|dp
index|[
literal|0
index|]
operator|<<
literal|4
operator|)
operator|+
operator|(
name|dp
index|[
literal|1
index|]
operator|<<
literal|12
operator|)
operator|+
operator|(
name|dp
index|[
literal|2
index|]
operator|<<
literal|20
operator|)
expr_stmt|;
name|dp
operator|+=
literal|3
expr_stmt|;
break|break;
block|}
name|env
operator|->
name|dp
operator|=
name|dp
expr_stmt|;
return|return
operator|(
name|pkglength
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|u_int8_t
name|aml_parse_bytedata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
block|{
name|u_int8_t
name|data
decl_stmt|;
name|data
operator|=
name|env
operator|->
name|dp
index|[
literal|0
index|]
expr_stmt|;
name|env
operator|->
name|dp
operator|++
expr_stmt|;
return|return
operator|(
name|data
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|u_int16_t
name|aml_parse_worddata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
block|{
name|u_int16_t
name|data
decl_stmt|;
name|data
operator|=
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|+
operator|(
name|env
operator|->
name|dp
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
expr_stmt|;
name|env
operator|->
name|dp
operator|+=
literal|2
expr_stmt|;
return|return
operator|(
name|data
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|u_int32_t
name|aml_parse_dworddata
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
block|{
name|u_int32_t
name|data
decl_stmt|;
name|data
operator|=
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|+
operator|(
name|env
operator|->
name|dp
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator|+
operator|(
name|env
operator|->
name|dp
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator|+
operator|(
name|env
operator|->
name|dp
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
name|env
operator|->
name|dp
operator|+=
literal|4
expr_stmt|;
return|return
operator|(
name|data
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|u_int8_t
modifier|*
name|aml_parse_namestring
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|int
name|segcount
decl_stmt|;
name|name
operator|=
name|env
operator|->
name|dp
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|'\\'
condition|)
name|env
operator|->
name|dp
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|'^'
condition|)
while|while
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|'^'
condition|)
name|env
operator|->
name|dp
operator|++
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|0x00
condition|)
comment|/* NullName */
name|env
operator|->
name|dp
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|0x2e
condition|)
comment|/* DualNamePrefix */
name|env
operator|->
name|dp
operator|+=
literal|1
operator|+
literal|4
operator|+
literal|4
expr_stmt|;
comment|/* NameSeg, NameSeg */
elseif|else
if|if
condition|(
name|env
operator|->
name|dp
index|[
literal|0
index|]
operator|==
literal|0x2f
condition|)
block|{
comment|/* MultiNamePrefix */
name|segcount
operator|=
name|env
operator|->
name|dp
index|[
literal|1
index|]
expr_stmt|;
name|env
operator|->
name|dp
operator|+=
literal|1
operator|+
literal|1
operator|+
name|segcount
operator|*
literal|4
expr_stmt|;
comment|/* segcount * NameSeg */
block|}
else|else
name|env
operator|->
name|dp
operator|+=
literal|4
expr_stmt|;
comment|/* NameSeg */
return|return
operator|(
name|name
operator|)
return|;
block|}
end_function

begin_function
name|struct
name|aml_name
modifier|*
name|aml_parse_objectlist
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|obj
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|env
operator|->
name|dp
operator|<
name|env
operator|->
name|end
condition|)
block|{
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_step
condition|)
block|{
name|AML_DEBUGGER
argument_list|(
name|env
argument_list|,
name|env
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|env
operator|->
name|stat
operator|!=
name|aml_stat_none
condition|)
block|{
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|obj
expr_stmt|;
return|return
operator|(
operator|&
name|env
operator|->
name|tempname
operator|)
return|;
block|}
block|}
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|AML_CREATE_NAME
parameter_list|(
name|amlname
parameter_list|,
name|env
parameter_list|,
name|namestr
parameter_list|,
name|ret
parameter_list|)
value|do {		\ 	amlname = aml_create_name(env, namestr);			\ 	if (env->stat == aml_stat_panic)				\ 		return ret;						\ } while(0)
end_define

begin_define
define|#
directive|define
name|AML_COPY_OBJECT
parameter_list|(
name|dest
parameter_list|,
name|env
parameter_list|,
name|src
parameter_list|,
name|ret
parameter_list|)
value|do {			\ 	dest = aml_copy_object(env, src);				\ 	if (dest == NULL) {						\ 		env->stat = aml_stat_panic;				\ 		return ret;						\ 	}								\ } while(0)
end_define

begin_define
define|#
directive|define
name|AML_ALLOC_OBJECT
parameter_list|(
name|dest
parameter_list|,
name|env
parameter_list|,
name|type
parameter_list|,
name|ret
parameter_list|)
value|do {			\ 	dest = aml_alloc_object(type, NULL);				\ 	if (dest == NULL) {						\ 		env->stat= aml_stat_panic;				\ 		return ret;						\ 	}								\ } while(0)
end_define

begin_function
specifier|static
name|void
name|aml_parse_defscope
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|oend
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|oname
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Scope("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|") {\n"
argument_list|)
expr_stmt|;
name|oname
operator|=
name|env
operator|->
name|curname
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|env
operator|->
name|curname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
name|oend
operator|=
name|env
operator|->
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_objectlist
argument_list|(
name|env
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|env
operator|->
name|dp
operator|==
name|env
operator|->
name|end
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|oend
expr_stmt|;
name|env
operator|->
name|curname
operator|=
name|oname
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_none
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|union
name|aml_object
modifier|*
name|aml_parse_defbuffer
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int8_t
modifier|*
name|end
decl_stmt|;
name|u_int8_t
modifier|*
name|buffer
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|int
name|size1
decl_stmt|,
name|size2
decl_stmt|,
name|size
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Buffer("
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|size1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|size2
operator|=
name|end
operator|-
name|env
operator|->
name|dp
expr_stmt|;
name|size
operator|=
operator|(
name|size1
operator|<
name|size2
operator|)
condition|?
name|size1
else|:
name|size2
expr_stmt|;
if|if
condition|(
name|size1
operator|>
literal|0
condition|)
block|{
name|buffer
operator|=
name|memman_alloc_flexsize
argument_list|(
name|aml_memman
argument_list|,
name|size1
argument_list|)
expr_stmt|;
if|if
condition|(
name|buffer
operator|==
name|NULL
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"NO MEMORY\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|bzero
argument_list|(
name|buffer
argument_list|,
name|size1
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|env
operator|->
name|dp
argument_list|,
name|buffer
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|buffer
operator|=
name|NULL
expr_stmt|;
block|}
name|obj
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|obj
operator|->
name|type
operator|=
name|aml_t_buffer
expr_stmt|;
name|obj
operator|->
name|buffer
operator|.
name|size
operator|=
name|size1
expr_stmt|;
name|obj
operator|->
name|buffer
operator|.
name|data
operator|=
name|buffer
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|") "
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|end
expr_stmt|;
return|return
operator|(
name|obj
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_number
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|num1
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|int
name|num2
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|destname
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|num2
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|destname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|obj
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|obj
operator|->
name|type
operator|=
name|aml_t_buffer
expr_stmt|;
name|obj
operator|->
name|buffer
operator|.
name|size
operator|=
literal|2
expr_stmt|;
name|obj
operator|->
name|buffer
operator|.
name|data
operator|=
name|memman_alloc_flexsize
argument_list|(
name|aml_memman
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|buffer
operator|.
name|data
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|obj
operator|->
name|buffer
operator|.
name|data
index|[
literal|0
index|]
operator|=
name|num1
operator|&
literal|0xff
expr_stmt|;
name|obj
operator|->
name|buffer
operator|.
name|data
index|[
literal|1
index|]
operator|=
name|num2
operator|&
literal|0xff
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|obj
argument_list|,
name|destname
argument_list|)
expr_stmt|;
return|return
operator|(
operator|&
name|env
operator|->
name|tempname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_buffer
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|obj
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|union
name|aml_object
modifier|*
name|tmpobj
decl_stmt|,
modifier|*
name|tmpobj2
decl_stmt|,
modifier|*
name|resobj
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|destname
decl_stmt|;
name|tmpobj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpobj
operator|->
name|type
operator|!=
name|aml_t_buffer
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj2
argument_list|,
name|env
argument_list|,
name|tmpobj
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|destname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|resobj
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|resobj
expr_stmt|;
name|resobj
operator|->
name|buffer
operator|.
name|type
operator|=
name|aml_t_buffer
expr_stmt|;
name|resobj
operator|->
name|buffer
operator|.
name|size
operator|=
name|tmpobj2
operator|->
name|buffer
operator|.
name|size
operator|+
name|obj
operator|->
name|buffer
operator|.
name|size
expr_stmt|;
if|if
condition|(
name|resobj
operator|->
name|buffer
operator|.
name|size
operator|>
literal|0
condition|)
block|{
name|resobj
operator|->
name|buffer
operator|.
name|data
operator|=
name|memman_alloc_flexsize
argument_list|(
name|aml_memman
argument_list|,
name|resobj
operator|->
name|buffer
operator|.
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|resobj
operator|->
name|buffer
operator|.
name|data
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|bcopy
argument_list|(
name|obj
operator|->
name|buffer
operator|.
name|data
argument_list|,
name|resobj
operator|->
name|buffer
operator|.
name|data
argument_list|,
name|obj
operator|->
name|buffer
operator|.
name|size
argument_list|)
expr_stmt|;
name|bcopy
argument_list|(
name|tmpobj2
operator|->
name|buffer
operator|.
name|data
argument_list|,
name|resobj
operator|->
name|buffer
operator|.
name|data
operator|+
name|obj
operator|->
name|buffer
operator|.
name|size
argument_list|,
name|tmpobj2
operator|->
name|buffer
operator|.
name|size
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|resobj
operator|->
name|buffer
operator|.
name|data
operator|=
name|NULL
expr_stmt|;
block|}
name|aml_free_object
argument_list|(
operator|&
name|tmpobj2
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|resobj
argument_list|,
name|destname
argument_list|)
expr_stmt|;
return|return
operator|(
operator|&
name|env
operator|->
name|tempname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concat_string
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|obj
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|int
name|len
decl_stmt|;
name|union
name|aml_object
modifier|*
name|tmpobj
decl_stmt|,
modifier|*
name|tmpobj2
decl_stmt|,
modifier|*
name|resobj
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|destname
decl_stmt|;
name|tmpobj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpobj
operator|->
name|type
operator|!=
name|aml_t_string
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj2
argument_list|,
name|env
argument_list|,
name|tmpobj
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|destname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|resobj
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|resobj
expr_stmt|;
name|resobj
operator|->
name|type
operator|=
name|aml_t_buffer
expr_stmt|;
name|resobj
operator|->
name|str
operator|.
name|needfree
operator|=
literal|1
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|obj
operator|->
name|str
operator|.
name|string
argument_list|)
operator|+
name|strlen
argument_list|(
name|tmpobj2
operator|->
name|str
operator|.
name|string
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|len
operator|>
literal|0
condition|)
block|{
name|resobj
operator|->
name|str
operator|.
name|string
operator|=
name|memman_alloc_flexsize
argument_list|(
name|aml_memman
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|resobj
operator|->
name|str
operator|.
name|string
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|strncpy
argument_list|(
name|resobj
operator|->
name|str
operator|.
name|string
argument_list|,
name|obj
operator|->
name|str
operator|.
name|string
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|strcat
argument_list|(
name|resobj
operator|->
name|str
operator|.
name|string
argument_list|,
name|tmpobj
operator|->
name|str
operator|.
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|resobj
operator|->
name|str
operator|.
name|string
operator|=
name|NULL
expr_stmt|;
block|}
name|aml_free_object
argument_list|(
operator|&
name|tmpobj2
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|resobj
argument_list|,
name|destname
argument_list|)
expr_stmt|;
return|return
operator|(
operator|&
name|env
operator|->
name|tempname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_concatop
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|,
modifier|*
name|tmpobj
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Concat("
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|obj
operator|->
name|type
condition|)
block|{
case|case
name|aml_t_num
case|:
name|aname
operator|=
name|aml_parse_concat_number
argument_list|(
name|env
argument_list|,
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
name|aml_t_buffer
case|:
comment|/* obj may be temporal object */
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj
argument_list|,
name|env
argument_list|,
name|obj
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_concat_buffer
argument_list|(
name|env
argument_list|,
name|obj
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|aml_free_object
argument_list|(
operator|&
name|tmpobj
argument_list|)
expr_stmt|;
break|break;
case|case
name|aml_t_string
case|:
comment|/* obj may be temporal object */
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj
argument_list|,
name|env
argument_list|,
name|obj
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_concat_string
argument_list|(
name|env
argument_list|,
name|obj
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|aml_free_object
argument_list|(
operator|&
name|tmpobj
argument_list|)
expr_stmt|;
break|break;
default|default:
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|aname
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|aname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|union
name|aml_object
modifier|*
name|aml_parse_defpackage
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|numelements
decl_stmt|;
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|int
name|i
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|tmpname
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|,
modifier|*
modifier|*
name|objects
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|numelements
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|numelements
operator|>
literal|0
condition|)
block|{
name|objects
operator|=
name|memman_alloc_flexsize
argument_list|(
name|aml_memman
argument_list|,
name|numelements
operator|*
sizeof|sizeof
argument_list|(
expr|union
name|aml_object
operator|*
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|objects
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
block|{
name|bzero
argument_list|(
name|objects
argument_list|,
name|numelements
operator|*
sizeof|sizeof
argument_list|(
expr|union
name|aml_object
operator|*
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|objects
operator|=
name|NULL
expr_stmt|;
block|}
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Package() {\n"
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|copy
operator|->
name|dp
operator|<
name|copy
operator|->
name|end
operator|)
operator|&&
operator|(
name|i
operator|<
name|numelements
operator|)
condition|)
block|{
name|aml_print_indent
argument_list|(
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmpname
operator|=
name|aml_parse_termobj
argument_list|(
name|copy
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmpname
operator|!=
name|NULL
condition|)
block|{
name|objects
index|[
name|i
index|]
operator|=
name|aml_copy_object
argument_list|(
name|copy
argument_list|,
name|tmpname
operator|->
name|property
argument_list|)
expr_stmt|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|",\n"
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|obj
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|obj
operator|->
name|type
operator|=
name|aml_t_package
expr_stmt|;
name|obj
operator|->
name|package
operator|.
name|elements
operator|=
name|numelements
expr_stmt|;
name|obj
operator|->
name|package
operator|.
name|objects
operator|=
name|objects
expr_stmt|;
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
return|return
operator|(
name|obj
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defmethod
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|flags
decl_stmt|;
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_method
modifier|*
name|meth
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|union
name|aml_object
modifier|*
name|aobj
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"Method("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aobj
argument_list|,
name|env
argument_list|,
name|aml_t_method
argument_list|,)
expr_stmt|;
name|meth
operator|=
operator|&
name|aobj
operator|->
name|meth
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|aobj
expr_stmt|;
name|flags
operator|=
operator|*
name|env
operator|->
name|dp
operator|++
expr_stmt|;
if|if
condition|(
name|flags
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|", %d"
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|") {\n"
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|meth
operator|->
name|argnum
operator|=
name|flags
expr_stmt|;
name|meth
operator|->
name|from
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|meth
operator|->
name|to
operator|=
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|out
label|:
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defopregion
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|struct
name|aml_opregion
modifier|*
name|opregion
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
specifier|const
name|char
modifier|*
name|regions
index|[]
init|=
block|{
literal|"SystemMemory"
block|,
literal|"SystemIO"
block|,
literal|"PCI_Config"
block|,
literal|"EmbeddedControl"
block|,
literal|"SMBus"
block|, 	}
decl_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"OperationRegion("
argument_list|)
expr_stmt|;
comment|/* Name */
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_opregion
argument_list|,)
expr_stmt|;
name|opregion
operator|=
operator|&
name|aname
operator|->
name|property
operator|->
name|opregion
expr_stmt|;
name|opregion
operator|->
name|space
operator|=
operator|*
name|env
operator|->
name|dp
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %s, "
argument_list|,
name|regions
index|[
operator|*
name|env
operator|->
name|dp
index|]
argument_list|)
expr_stmt|;
comment|/* Space */
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Offset */
name|opregion
operator|->
name|offset
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Length */
name|opregion
operator|->
name|length
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|accessnames
index|[]
init|=
block|{
literal|"AnyAcc"
block|,
literal|"ByteAcc"
block|,
literal|"WordAcc"
block|,
literal|"DWordAcc"
block|,
literal|"BlockAcc"
block|,
literal|"SMBSendRecvAcc"
block|,
literal|"SMBQuickAcc"
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|aml_parse_field
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|struct
name|aml_field
modifier|*
name|template
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int8_t
name|access
decl_stmt|,
name|attribute
decl_stmt|;
name|u_int32_t
name|width
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|struct
name|aml_field
modifier|*
name|prop
decl_stmt|;
switch|switch
condition|(
operator|*
name|env
operator|->
name|dp
condition|)
block|{
case|case
literal|'\\'
case|:
case|case
literal|'^'
case|:
case|case
literal|'A'
operator|...
literal|'Z'
case|:
case|case
literal|'_'
case|:
case|case
literal|'.'
case|:
case|case
literal|'/'
case|:
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|width
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|template
operator|->
name|bitlen
operator|=
name|width
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Allignment */
if|if
condition|(
name|width
operator|==
literal|16
condition|)
block|{
name|template
operator|->
name|bitoffset
operator|+=
literal|15
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|&=
operator|(
operator|~
literal|15
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|width
operator|==
literal|32
condition|)
block|{
name|template
operator|->
name|bitoffset
operator|+=
literal|31
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|&=
operator|(
operator|~
literal|31
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|width
operator|&
literal|7
operator|)
operator|==
literal|0
condition|)
block|{
name|template
operator|->
name|bitoffset
operator|+=
literal|7
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|&=
operator|(
operator|~
literal|7
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|width
operator|>
literal|32
operator|)
operator|&&
operator|(
name|width
operator|&
literal|7
operator|)
operator|!=
literal|0
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"??? Can I treat it?\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_field
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|prop
operator|=
operator|&
name|aname
operator|->
name|property
operator|->
name|field
expr_stmt|;
operator|*
name|prop
operator|=
operator|*
name|template
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|+=
name|width
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|",\t%d"
argument_list|,
name|width
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x00
case|:
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|width
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|+=
name|width
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Offset(0x%x)"
argument_list|,
name|template
operator|->
name|bitoffset
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x01
case|:
name|access
operator|=
name|env
operator|->
name|dp
index|[
literal|1
index|]
expr_stmt|;
name|attribute
operator|=
name|env
operator|->
name|dp
index|[
literal|2
index|]
expr_stmt|;
name|env
operator|->
name|dp
operator|+=
literal|3
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"AccessAs(%s, %d)"
argument_list|,
name|accessnames
index|[
name|access
index|]
argument_list|,
name|attribute
argument_list|)
expr_stmt|;
name|template
operator|->
name|bitoffset
operator|=
name|attribute
expr_stmt|;
name|template
operator|->
name|flags
operator|=
operator|(
name|template
operator|->
name|flags
operator||
literal|0xf0
operator|)
operator||
name|access
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|template
operator|->
name|bitoffset
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_fieldlist
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|struct
name|aml_field
modifier|*
name|template
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int32_t
name|offset
decl_stmt|;
name|offset
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|env
operator|->
name|dp
operator|<
name|env
operator|->
name|end
condition|)
block|{
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|offset
operator|=
name|aml_parse_field
argument_list|(
name|env
argument_list|,
name|template
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|dp
operator|<
name|env
operator|->
name|end
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|",\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_deffield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|flags
decl_stmt|;
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_field
name|fieldtemplate
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|lockrules
index|[]
init|=
block|{
literal|"NoLock"
block|,
literal|"Lock"
block|}
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|updaterules
index|[]
init|=
block|{
literal|"Preserve"
block|,
literal|"WriteAsOnes"
block|,
literal|"WriteAsZeros"
block|,
literal|"*Error*"
block|}
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"Field("
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
name|fieldtemplate
operator|.
name|type
operator|=
name|aml_t_field
expr_stmt|;
name|flags
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|fieldtemplate
operator|.
name|flags
operator|=
name|fieldtemplate
operator|.
name|flags
operator|=
name|flags
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|fieldtemplate
operator|.
name|bitoffset
operator|=
literal|0
expr_stmt|;
name|fieldtemplate
operator|.
name|bitlen
operator|=
literal|0
expr_stmt|;
name|fieldtemplate
operator|.
name|f
operator|.
name|ftype
operator|=
name|f_t_field
expr_stmt|;
name|fieldtemplate
operator|.
name|f
operator|.
name|fld
operator|.
name|regname
operator|=
name|name
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %s, %s, %s) {\n"
argument_list|,
name|accessnames
index|[
name|flags
operator|&
literal|0xf
index|]
argument_list|,
name|lockrules
index|[
operator|(
name|flags
operator|>>
literal|4
operator|)
operator|&
literal|1
index|]
argument_list|,
name|updaterules
index|[
operator|(
name|flags
operator|>>
literal|5
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
name|aml_parse_fieldlist
argument_list|(
name|copy
argument_list|,
operator|&
name|fieldtemplate
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defindexfield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|flags
decl_stmt|;
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|iname
decl_stmt|,
modifier|*
name|dname
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_field
name|template
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|lockrules
index|[]
init|=
block|{
literal|"NoLock"
block|,
literal|"Lock"
block|}
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|updaterules
index|[]
init|=
block|{
literal|"Preserve"
block|,
literal|"WriteAsOnes"
block|,
literal|"WriteAsZeros"
block|,
literal|"*Error*"
block|}
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"IndexField("
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|iname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Name1 */
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|dname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Name2 */
name|template
operator|.
name|type
operator|=
name|aml_t_field
expr_stmt|;
name|template
operator|.
name|flags
operator|=
name|flags
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|template
operator|.
name|bitoffset
operator|=
literal|0
expr_stmt|;
name|template
operator|.
name|bitlen
operator|=
literal|0
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|ftype
operator|=
name|f_t_index
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|ifld
operator|.
name|indexname
operator|=
name|iname
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|ifld
operator|.
name|dataname
operator|=
name|dname
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %s, %s, %s) {\n"
argument_list|,
name|accessnames
index|[
name|flags
operator|&
literal|0xf
index|]
argument_list|,
name|lockrules
index|[
operator|(
name|flags
operator|>>
literal|4
operator|)
operator|&
literal|1
index|]
argument_list|,
name|updaterules
index|[
operator|(
name|flags
operator|>>
literal|5
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_fieldlist
argument_list|(
name|copy
argument_list|,
operator|&
name|template
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defbankfield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|flags
decl_stmt|;
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|rname
decl_stmt|,
modifier|*
name|bname
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|,
name|bankvalue
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_field
name|template
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|lockrules
index|[]
init|=
block|{
literal|"NoLock"
block|,
literal|"Lock"
block|}
decl_stmt|;
specifier|static
specifier|const
name|char
modifier|*
name|updaterules
index|[]
init|=
block|{
literal|"Preserve"
block|,
literal|"WriteAsOnes"
block|,
literal|"WriteAsZeros"
block|,
literal|"*Error*"
block|}
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"BankField("
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|rname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Name1 */
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|bname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Name2 */
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
comment|/* BankValue */
name|bankvalue
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|template
operator|.
name|type
operator|=
name|aml_t_field
expr_stmt|;
name|template
operator|.
name|flags
operator|=
name|flags
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|template
operator|.
name|bitoffset
operator|=
literal|0
expr_stmt|;
name|template
operator|.
name|bitlen
operator|=
literal|0
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|ftype
operator|=
name|f_t_bank
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|bfld
operator|.
name|regname
operator|=
name|rname
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|bfld
operator|.
name|bankname
operator|=
name|bname
expr_stmt|;
name|template
operator|.
name|f
operator|.
name|bfld
operator|.
name|bankvalue
operator|=
name|bankvalue
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %s, %s, %s) {\n"
argument_list|,
name|accessnames
index|[
name|flags
operator|&
literal|0xf
index|]
argument_list|,
name|lockrules
index|[
operator|(
name|flags
operator|>>
literal|4
operator|)
operator|&
literal|1
index|]
argument_list|,
name|updaterules
index|[
operator|(
name|flags
operator|>>
literal|5
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
name|aml_parse_fieldlist
argument_list|(
name|copy
argument_list|,
operator|&
name|template
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defdevice
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"Device("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|") {\n"
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|copy
operator|->
name|curname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|copy
operator|->
name|curname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|copy
operator|->
name|curname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_device
argument_list|,)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_objectlist
argument_list|(
name|copy
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|out
label|:
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defprocessor
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_processor
modifier|*
name|proc
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|obj
argument_list|,
name|env
argument_list|,
name|aml_t_processor
argument_list|,)
expr_stmt|;
name|proc
operator|=
operator|&
name|obj
operator|->
name|proc
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Processor("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|proc
operator|->
name|id
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|proc
operator|->
name|addr
operator|=
name|aml_parse_dworddata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|proc
operator|->
name|len
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %d, 0x%x, 0x%x) {\n"
argument_list|,
name|proc
operator|->
name|id
argument_list|,
name|proc
operator|->
name|addr
argument_list|,
name|proc
operator|->
name|len
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|copy
operator|->
name|curname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|copy
operator|->
name|curname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|copy
operator|->
name|curname
operator|->
name|property
operator|=
name|obj
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_objectlist
argument_list|(
name|copy
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|out
label|:
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defpowerres
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|struct
name|aml_powerres
modifier|*
name|pres
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"PowerResource("
argument_list|)
expr_stmt|;
name|AML_ALLOC_OBJECT
argument_list|(
name|obj
argument_list|,
name|env
argument_list|,
name|aml_t_powerres
argument_list|,)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|pres
operator|=
operator|&
name|obj
operator|->
name|pres
expr_stmt|;
name|pres
operator|->
name|level
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|pres
operator|->
name|order
operator|=
name|aml_parse_worddata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %d, %d) {\n"
argument_list|,
name|pres
operator|->
name|level
argument_list|,
name|pres
operator|->
name|order
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|copy
operator|->
name|curname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|copy
operator|->
name|curname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|copy
operator|->
name|curname
operator|->
name|property
operator|=
name|obj
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_objectlist
argument_list|(
name|copy
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|out
label|:
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defthermalzone
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_environ
modifier|*
name|copy
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|copy
operator|=
name|memman_alloc
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"ThermalZone("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|") {\n"
argument_list|)
expr_stmt|;
operator|*
name|copy
operator|=
operator|*
name|env
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|copy
operator|->
name|curname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|copy
operator|->
name|curname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|copy
operator|->
name|curname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_therm
argument_list|,)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|copy
operator|->
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aml_parse_objectlist
argument_list|(
name|copy
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
operator|&
name|copy
operator|->
name|tempobject
argument_list|)
expr_stmt|;
name|AML_SYSASSERT
argument_list|(
name|copy
operator|->
name|dp
operator|==
name|copy
operator|->
name|end
argument_list|)
expr_stmt|;
name|out
label|:
name|memman_free
argument_list|(
name|aml_memman
argument_list|,
name|memid_aml_environ
argument_list|,
name|copy
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defelse
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|,
name|int
name|num
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|oend
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|oend
operator|=
name|env
operator|->
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aname
operator|=
name|NULL
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Else {\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|0
condition|)
block|{
name|aname
operator|=
name|aml_parse_objectlist
argument_list|(
name|env
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|oend
expr_stmt|;
return|return
operator|(
name|aname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defif
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|oend
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|int
name|num
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|,
modifier|*
name|aname1
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aname
operator|=
name|NULL
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"If("
argument_list|)
expr_stmt|;
name|num
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|oend
operator|=
name|env
operator|->
name|end
expr_stmt|;
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"{\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|end
expr_stmt|;
name|aname
operator|=
name|aml_parse_objectlist
argument_list|(
name|env
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
block|}
name|env
operator|->
name|dp
operator|=
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|oend
expr_stmt|;
if|if
condition|(
operator|(
name|end
operator|<
name|oend
operator|)
operator|&&
operator|*
operator|(
name|env
operator|->
name|dp
operator|)
operator|==
literal|0xa1
condition|)
block|{
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|aname1
operator|=
name|aml_parse_defelse
argument_list|(
name|env
argument_list|,
name|indent
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|(
name|num
operator|==
literal|0
operator|)
condition|?
name|aname1
else|:
name|aname
expr_stmt|;
block|}
return|return
operator|(
name|aname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|aml_name
modifier|*
name|aml_parse_defwhile
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
modifier|*
name|start
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|oend
decl_stmt|;
name|u_int32_t
name|pkglength
decl_stmt|;
name|int
name|num
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|start
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|pkglength
operator|=
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|oend
operator|=
name|env
operator|->
name|end
expr_stmt|;
name|end
operator|=
name|start
operator|+
name|pkglength
expr_stmt|;
name|aname
operator|=
name|NULL
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|env
operator|->
name|dp
operator|=
name|start
expr_stmt|;
name|aml_parse_pkglength
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"While("
argument_list|)
expr_stmt|;
name|num
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|num
operator|==
literal|0
condition|)
block|{
break|break;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|" {\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|end
expr_stmt|;
name|aname
operator|=
name|aml_parse_objectlist
argument_list|(
name|env
argument_list|,
name|indent
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_step
condition|)
block|{
name|AML_DEBUGGER
argument_list|(
name|env
argument_list|,
name|env
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|env
operator|->
name|stat
operator|!=
name|aml_stat_none
condition|)
break|break;
name|aml_print_indent
argument_list|(
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"}"
argument_list|)
expr_stmt|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|=
name|end
expr_stmt|;
name|env
operator|->
name|end
operator|=
name|oend
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_break
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_none
expr_stmt|;
name|aname
operator|=
name|NULL
expr_stmt|;
block|}
return|return
operator|(
name|aname
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defmutex
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|struct
name|aml_mutex
modifier|*
name|mut
decl_stmt|;
comment|/* MutexOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Mutex("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_mutex
argument_list|,)
expr_stmt|;
name|mut
operator|=
operator|&
name|aname
operator|->
name|property
operator|->
name|mutex
expr_stmt|;
name|mut
operator|->
name|level
operator|=
operator|*
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|STAILQ_INIT
argument_list|(
operator|&
name|mut
operator|->
name|queue
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %d)"
argument_list|,
name|mut
operator|->
name|level
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_createfield_generic
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|union
name|aml_object
modifier|*
name|srcbuf
parameter_list|,
name|int
name|index
parameter_list|,
name|int
name|len
parameter_list|,
name|char
modifier|*
name|newname
parameter_list|)
block|{
name|struct
name|aml_bufferfield
modifier|*
name|field
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
if|if
condition|(
name|srcbuf
operator|==
name|NULL
operator|||
name|srcbuf
operator|->
name|type
operator|!=
name|aml_t_buffer
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"Not Buffer assigned,"
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|newname
argument_list|,)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_bufferfield
argument_list|,)
expr_stmt|;
name|field
operator|=
operator|&
name|aname
operator|->
name|property
operator|->
name|bfld
expr_stmt|;
name|field
operator|->
name|bitoffset
operator|=
name|index
expr_stmt|;
name|field
operator|->
name|bitlen
operator|=
name|len
expr_stmt|;
name|field
operator|->
name|origin
operator|=
name|srcbuf
operator|->
name|buffer
operator|.
name|data
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|aml_parse_defcreatefield
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|int
name|index
decl_stmt|,
name|len
decl_stmt|;
name|char
modifier|*
name|newname
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|,
modifier|*
name|srcbuf
decl_stmt|;
comment|/* CreateFieldOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"CreateField("
argument_list|)
expr_stmt|;
name|srcbuf
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcbuf
operator|==
operator|&
name|env
operator|->
name|tempobject
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"NONAMED BUFFER\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|index
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|obj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|len
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|newname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|newname
argument_list|)
expr_stmt|;
name|aml_createfield_generic
argument_list|(
name|env
argument_list|,
name|srcbuf
argument_list|,
name|index
argument_list|,
name|len
argument_list|,
name|newname
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|") "
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Returns Named object or parser buffer. The object need not be free because  * it returns preallocated buffer in env or Contain of named object.  If You  * need to preserve object, create a copy and then store.  And The object  * returned from this function is not valid after another call is  * shared, tempolary buffer may be shared.  */
end_comment

begin_function
name|struct
name|aml_name
modifier|*
name|aml_parse_termobj
parameter_list|(
name|struct
name|aml_environ
modifier|*
name|env
parameter_list|,
name|int
name|indent
parameter_list|)
block|{
name|u_int8_t
name|opcode
decl_stmt|;
name|u_int8_t
modifier|*
name|name
decl_stmt|;
name|int
name|value
decl_stmt|;
name|int
name|num1
decl_stmt|,
name|num2
decl_stmt|;
name|int
name|len
decl_stmt|;
name|int
name|match1
decl_stmt|,
name|match2
decl_stmt|,
name|i
decl_stmt|,
name|pkgval
decl_stmt|,
name|start
decl_stmt|;
name|int
name|widthindex
decl_stmt|,
name|index
decl_stmt|;
name|char
modifier|*
name|newname
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|aname
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|destname1
decl_stmt|,
modifier|*
name|destname2
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|tmpname
decl_stmt|,
modifier|*
name|srcname
decl_stmt|;
name|struct
name|aml_name
modifier|*
name|src
decl_stmt|;
name|union
name|aml_object
modifier|*
name|ret
decl_stmt|;
name|union
name|aml_object
modifier|*
name|tmpobj
decl_stmt|;
name|union
name|aml_object
name|anum
decl_stmt|;
name|union
name|aml_object
modifier|*
name|objref
decl_stmt|;
name|union
name|aml_object
modifier|*
name|srcobj
decl_stmt|;
name|union
name|aml_object
modifier|*
name|obj
decl_stmt|;
name|union
name|aml_object
modifier|*
name|srcbuf
decl_stmt|;
specifier|static
name|int
name|widthtbl
index|[
literal|4
index|]
init|=
block|{
literal|32
block|,
literal|16
block|,
literal|8
block|,
literal|1
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|opname
index|[
literal|4
index|]
init|=
block|{
literal|"CreateDWordField"
block|,
literal|"CreateWordField"
block|,
literal|"CreateByteField"
block|,
literal|"CreateBitField"
block|}
decl_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|ret
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|anum
operator|.
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|ret
expr_stmt|;
name|aml_free_objectcontent
argument_list|(
name|ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_panic
condition|)
block|{
comment|/* 		 * If previosuly parser panic , parsing next instruction is 		 * prohibited. 		 */
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|aname
operator|=
name|NULL
expr_stmt|;
name|opcode
operator|=
operator|*
name|env
operator|->
name|dp
operator|++
expr_stmt|;
switch|switch
condition|(
name|opcode
condition|)
block|{
case|case
literal|'\\'
case|:
case|case
literal|'^'
case|:
case|case
literal|'A'
operator|...
literal|'Z'
case|:
case|case
literal|'_'
case|:
case|case
literal|'.'
case|:
case|case
literal|'/'
case|:
name|env
operator|->
name|dp
operator|--
expr_stmt|;
name|ret
operator|->
name|type
operator|=
name|aml_t_namestr
expr_stmt|;
name|ret
operator|->
name|nstr
operator|.
name|dp
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|ret
operator|->
name|nstr
operator|.
name|dp
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x0a
case|:
comment|/* BytePrefix */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|value
operator|=
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
name|value
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"0x%x"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x0b
case|:
comment|/* WordPrefix */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|value
operator|=
name|aml_parse_worddata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
name|value
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"0x%x"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x0c
case|:
comment|/* DWordPrefix */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|value
operator|=
name|aml_parse_dworddata
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
name|value
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"0x%x"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x0d
case|:
comment|/* StringPrefix */
name|ret
operator|->
name|type
operator|=
name|aml_t_string
expr_stmt|;
name|ret
operator|->
name|str
operator|.
name|string
operator|=
name|env
operator|->
name|dp
expr_stmt|;
name|len
operator|=
name|strlen
argument_list|(
name|env
operator|->
name|dp
argument_list|)
expr_stmt|;
name|ret
operator|->
name|str
operator|.
name|needfree
operator|=
literal|0
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"\"%s\""
argument_list|,
operator|(
specifier|const
name|char
operator|*
operator|)
name|ret
operator|->
name|str
operator|.
name|string
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|+=
operator|(
name|len
operator|+
literal|1
operator|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x00
case|:
comment|/* ZeroOp */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
literal|0
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|constant
operator|=
literal|1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Zero"
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x01
case|:
comment|/* OneOp */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
literal|1
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|constant
operator|=
literal|1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"One"
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0xff
case|:
comment|/* OnesOp */
name|ret
operator|->
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|number
operator|=
literal|0xffffffff
expr_stmt|;
name|ret
operator|->
name|num
operator|.
name|constant
operator|=
literal|1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Ones"
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x06
case|:
comment|/* AliasOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Alias("
argument_list|)
expr_stmt|;
name|tmpname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_panic
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|tmpname
operator|->
name|property
operator|==
name|NULL
operator|||
name|tmpname
operator|->
name|property
operator|->
name|type
operator|!=
name|aml_t_namestr
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/* 		 * XXX if srcname is deleted after this object, what 		 * shall I do? 		 */
name|srcname
operator|=
name|aml_search_name
argument_list|(
name|env
argument_list|,
name|tmpname
operator|->
name|property
operator|->
name|nstr
operator|.
name|dp
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
name|aml_print_curname
argument_list|(
name|aname
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_objref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|objref
operator|=
name|aname
operator|->
name|property
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|nameref
operator|=
name|srcname
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|ref
operator|=
name|srcname
operator|->
name|property
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|offset
operator|=
operator|-
literal|1
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|alias
operator|=
literal|1
expr_stmt|;
comment|/* Yes, this is an alias */
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
comment|/* shut the interpreter up during the namespace initializing */
return|return
operator|(
name|NULL
operator|)
return|;
case|case
literal|0x08
case|:
comment|/* NameOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Name("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_panic
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
name|aml_print_curname
argument_list|(
name|aname
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x10
case|:
comment|/* ScopeOp */
name|aml_parse_defscope
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x11
case|:
comment|/* BufferOp */
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|aml_parse_defbuffer
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x12
case|:
comment|/* PackageOp */
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|aml_parse_defpackage
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x14
case|:
comment|/* MethodOp */
name|aml_parse_defmethod
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x5b
case|:
comment|/* ExtOpPrefix */
name|opcode
operator|=
operator|*
name|env
operator|->
name|dp
operator|++
expr_stmt|;
switch|switch
condition|(
name|opcode
condition|)
block|{
case|case
literal|0x01
case|:
name|aml_parse_defmutex
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x02
case|:
comment|/* EventOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Event("
argument_list|)
expr_stmt|;
name|name
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|AML_CREATE_NAME
argument_list|(
name|aname
argument_list|,
name|env
argument_list|,
name|name
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|aname
operator|->
name|property
operator|!=
name|NULL
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Already Defined \n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_event
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
break|break;
case|case
literal|0x12
case|:
comment|/* CondRefOfOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"CondRefOf("
argument_list|)
expr_stmt|;
name|src
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|==
operator|&
name|env
operator|->
name|tempname
operator|||
name|src
operator|==
name|NULL
condition|)
block|{
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
literal|0xffffffff
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
block|}
name|AML_ALLOC_OBJECT
argument_list|(
name|objref
argument_list|,
name|env
argument_list|,
name|aml_t_objref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|property
operator|==
name|NULL
operator|||
name|src
operator|->
name|property
operator|->
name|type
operator|!=
name|aml_t_namestr
condition|)
block|{
name|objref
operator|->
name|objref
operator|.
name|nameref
operator|=
name|src
expr_stmt|;
block|}
else|else
block|{
name|objref
operator|->
name|objref
operator|.
name|nameref
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
block|}
name|objref
operator|->
name|objref
operator|.
name|ref
operator|=
name|src
operator|->
name|property
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|offset
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* different from IndexOp */
name|destname1
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|objref
argument_list|,
name|destname1
argument_list|)
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
literal|0
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x13
case|:
name|aml_parse_defcreatefield
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x20
case|:
comment|/* LoadOp */
comment|/* XXX Not Impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Load("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x21
case|:
comment|/* StallOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Stall("
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|AML_STALL
argument_list|(
name|num1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x22
case|:
comment|/* SleepOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Sleep("
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_SLEEP
argument_list|(
literal|0
argument_list|,
name|num1
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x23
case|:
comment|/* AcquireOp */
comment|/* XXX Not yet */
name|AML_DEBUGPRINT
argument_list|(
literal|"Acquire("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", 0x%x)"
argument_list|,
name|aml_parse_worddata
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x24
case|:
comment|/* SignalOp */
comment|/* XXX Not yet */
name|AML_DEBUGPRINT
argument_list|(
literal|"Signal("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x25
case|:
comment|/* WaitOp */
comment|/* XXX Not yet impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Wait("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x26
case|:
comment|/* ResetOp */
comment|/* XXX Not yet impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Reset("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x27
case|:
comment|/* ReleaseOp */
comment|/* XXX Not yet impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Release("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
define|#
directive|define
name|NUMOP2
parameter_list|(
name|opname
parameter_list|,
name|operation
parameter_list|)
value|do {					\ 	AML_DEBUGPRINT(opname);						\ 	AML_DEBUGPRINT("(");						\ 	num1 = aml_objtonum(env, aml_eval_name(env,			\ 	    aml_parse_termobj(env, indent)));				\ 	AML_DEBUGPRINT(", ");						\ 	anum.num.number = operation (num1);				\ 	destname1 = aml_parse_termobj(env, indent);			\ 	AML_DEBUGPRINT(")");						\ 	aml_store_to_name(env,&anum, destname1);			\ 	env->tempobject.num = anum.num;					\ 	env->tempname.property =&env->tempobject;			\ 	aname =&env->tempname;						\ } while(0)
case|case
literal|0x28
case|:
comment|/* FromBCDOp */
name|NUMOP2
argument_list|(
literal|"FromBCD"
argument_list|,
name|frombcd
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x29
case|:
comment|/* ToBCDOp */
name|NUMOP2
argument_list|(
literal|"ToBCD"
argument_list|,
name|tobcd
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x2a
case|:
comment|/* UnloadOp */
comment|/* XXX Not yet impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Unload("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x30
case|:
name|env
operator|->
name|tempobject
operator|.
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|.
name|number
operator|=
literal|0
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|.
name|constant
operator|=
literal|1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Revision"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x31
case|:
name|env
operator|->
name|tempobject
operator|.
name|type
operator|=
name|aml_t_debug
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"Debug"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x32
case|:
comment|/* FatalOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Fatal("
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"0x%x, "
argument_list|,
name|aml_parse_bytedata
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"0x%x, "
argument_list|,
name|aml_parse_dworddata
argument_list|(
name|env
argument_list|)
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x80
case|:
comment|/* OpRegionOp */
name|aml_parse_defopregion
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x81
case|:
comment|/* FieldOp */
name|aml_parse_deffield
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x82
case|:
comment|/* DeviceOp */
name|aml_parse_defdevice
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x83
case|:
comment|/* ProcessorOp */
name|aml_parse_defprocessor
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x84
case|:
comment|/* PowerResOp */
name|aml_parse_defpowerres
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x85
case|:
comment|/* ThermalZoneOp */
name|aml_parse_defthermalzone
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x86
case|:
comment|/* IndexFieldOp */
name|aml_parse_defindexfield
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x87
case|:
comment|/* BankFieldOp */
name|aml_parse_defbankfield
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AML_SYSERRX
argument_list|(
literal|1
argument_list|,
literal|"strange opcode 0x5b, 0x%x\n"
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
name|AML_SYSABORT
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
literal|0x68
operator|...
literal|0x6e
case|:
comment|/* ArgN */
name|AML_DEBUGPRINT
argument_list|(
literal|"Arg%d"
argument_list|,
name|opcode
operator|-
literal|0x68
argument_list|)
expr_stmt|;
return|return
operator|(
name|aml_local_stack_getArgX
argument_list|(
name|NULL
argument_list|,
name|opcode
operator|-
literal|0x68
argument_list|)
operator|)
return|;
break|break;
case|case
literal|0x60
operator|...
literal|0x67
case|:
name|AML_DEBUGPRINT
argument_list|(
literal|"Local%d"
argument_list|,
name|opcode
operator|-
literal|0x60
argument_list|)
expr_stmt|;
return|return
operator|(
name|aml_local_stack_getLocalX
argument_list|(
name|opcode
operator|-
literal|0x60
argument_list|)
operator|)
return|;
break|break;
case|case
literal|0x70
case|:
comment|/* StoreOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Store("
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj
argument_list|,
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|tmpobj
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|destname1
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
comment|/* XXX 		 * temporary object may change during aml_store_to_name() 		 * operation, so we make a copy of it on stack. 		 */
if|if
condition|(
name|destname1
operator|==
operator|&
name|env
operator|->
name|tempname
operator|&&
name|destname1
operator|->
name|property
operator|==
operator|&
name|env
operator|->
name|tempobject
condition|)
block|{
name|destname1
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|destname1
operator|->
name|property
argument_list|,
name|env
argument_list|,
operator|&
name|env
operator|->
name|tempobject
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|tmpobj
argument_list|,
name|destname1
argument_list|)
expr_stmt|;
if|if
condition|(
name|env
operator|->
name|stat
operator|==
name|aml_stat_panic
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"StoreOp failed"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|aname
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|tmpobj
argument_list|,
name|env
argument_list|,
name|destname1
operator|->
name|property
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|tmpobj
expr_stmt|;
if|if
condition|(
name|tmpobj
operator|==
name|NULL
condition|)
block|{
name|printf
argument_list|(
literal|"???"
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|0x71
case|:
comment|/* RefOfOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"RefOf("
argument_list|)
expr_stmt|;
name|src
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
name|AML_ALLOC_OBJECT
argument_list|(
name|aname
operator|->
name|property
argument_list|,
name|env
argument_list|,
name|aml_t_objref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|objref
operator|=
name|aname
operator|->
name|property
expr_stmt|;
if|if
condition|(
name|src
operator|->
name|property
operator|==
name|NULL
operator|||
name|src
operator|->
name|property
operator|->
name|type
operator|!=
name|aml_t_namestr
condition|)
block|{
name|objref
operator|->
name|objref
operator|.
name|nameref
operator|=
name|src
expr_stmt|;
block|}
else|else
block|{
name|objref
operator|->
name|objref
operator|.
name|nameref
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
block|}
name|objref
operator|->
name|objref
operator|.
name|ref
operator|=
name|src
operator|->
name|property
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|offset
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* different from IndexOp */
break|break;
define|#
directive|define
name|NUMOP3_2
parameter_list|(
name|opname
parameter_list|,
name|oparation
parameter_list|,
name|ope2
parameter_list|)
value|do {				\ 	AML_DEBUGPRINT(opname);						\ 	AML_DEBUGPRINT("(");						\ 	num1 = aml_objtonum(env, aml_eval_name(env,			\ 	    aml_parse_termobj(env, indent)));				\ 	AML_DEBUGPRINT(", ");						\ 	num2 = aml_objtonum(env, aml_eval_name(env,			\ 	    aml_parse_termobj(env, indent)));				\ 	AML_DEBUGPRINT(", ");						\ 	anum.num.number = ope2(num1 oparation num2);			\ 	destname1 = aml_parse_termobj(env, indent);			\ 	AML_DEBUGPRINT(")");						\ 	aml_store_to_name(env,&anum, destname1);			\ 	env->tempobject.num = anum.num;					\ 	env->tempname.property =&env->tempobject;			\ 	aname =&env->tempname;						\ } while(0)
define|#
directive|define
name|NUMOP3
parameter_list|(
name|opname
parameter_list|,
name|operation
parameter_list|)
value|NUMOP3_2(opname, operation, )
define|#
directive|define
name|NUMOPN3
parameter_list|(
name|opname
parameter_list|,
name|operation
parameter_list|)
value|NUMOP3_2(opname, operation, ~)
case|case
literal|0x72
case|:
comment|/* AddOp */
name|NUMOP3
argument_list|(
literal|"Add"
argument_list|,
operator|+
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x73
case|:
comment|/* ConcatOp  */
name|aname
operator|=
name|aml_parse_concatop
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x74
case|:
comment|/* SubtractOp */
name|NUMOP3
argument_list|(
literal|"Subtract"
argument_list|,
operator|-
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x75
case|:
comment|/* IncrementOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Increment("
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aname
argument_list|)
argument_list|)
expr_stmt|;
name|num1
operator|++
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|num1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
operator|&
name|anum
argument_list|,
name|aname
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
break|break;
case|case
literal|0x76
case|:
comment|/* DecrementOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Decrement("
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aname
argument_list|)
argument_list|)
expr_stmt|;
name|num1
operator|--
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|num1
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
operator|&
name|anum
argument_list|,
name|aname
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
break|break;
case|case
literal|0x77
case|:
comment|/* MultiplyOp */
name|NUMOP3
argument_list|(
literal|"Multiply"
argument_list|,
operator|*
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x78
case|:
comment|/* DivideOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Divide("
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|num2
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|num1
operator|%
name|num2
expr_stmt|;
name|destname1
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
operator|&
name|anum
argument_list|,
name|destname1
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|num1
operator|/
name|num2
expr_stmt|;
name|destname2
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
operator|&
name|anum
argument_list|,
name|destname2
argument_list|)
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x79
case|:
comment|/* ShiftLeftOp */
name|NUMOP3
argument_list|(
literal|"ShiftLeft"
argument_list|,
operator|<<
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7a
case|:
comment|/* ShiftRightOp */
name|NUMOP3
argument_list|(
literal|"ShiftRight"
argument_list|,
operator|>>
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7b
case|:
comment|/* AndOp */
name|NUMOP3
argument_list|(
literal|"And"
argument_list|,
operator|&
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7c
case|:
comment|/* NAndOp */
name|NUMOPN3
argument_list|(
literal|"NAnd"
argument_list|,
operator|&
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7d
case|:
comment|/* OrOp */
name|NUMOP3
argument_list|(
literal|"Or"
argument_list|,
operator||
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7e
case|:
comment|/* NOrOp */
name|NUMOPN3
argument_list|(
literal|"NOr"
argument_list|,
operator||
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x7f
case|:
comment|/* XOrOp */
name|NUMOP3
argument_list|(
literal|"XOr"
argument_list|,
operator|^
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x80
case|:
comment|/* NotOp */
name|NUMOP2
argument_list|(
literal|"Not"
argument_list|,
operator|~
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x81
case|:
comment|/* FindSetLeftBitOp */
name|NUMOP2
argument_list|(
literal|"FindSetLeftBit"
argument_list|,
name|findsetleftbit
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x82
case|:
comment|/* FindSetRightBitOp */
name|NUMOP2
argument_list|(
literal|"FindSetRightBit"
argument_list|,
name|findsetrightbit
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x83
case|:
comment|/* DerefOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"DerefOf("
argument_list|)
expr_stmt|;
name|objref
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
if|if
condition|(
name|objref
operator|->
name|objref
operator|.
name|ref
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|objref
operator|->
name|objref
operator|.
name|ref
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|objref
operator|->
name|objref
operator|.
name|ref
operator|->
name|type
condition|)
block|{
case|case
name|aml_t_package
case|:
case|case
name|aml_t_buffer
case|:
if|if
condition|(
name|objref
operator|->
name|objref
operator|.
name|offset
operator|<
literal|0
condition|)
block|{
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|objref
operator|->
name|objref
operator|.
name|ref
expr_stmt|;
block|}
else|else
block|{
name|objref
operator|->
name|objref
operator|.
name|deref
operator|=
literal|1
expr_stmt|;
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|objref
expr_stmt|;
block|}
break|break;
default|default:
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
name|objref
operator|->
name|objref
operator|.
name|ref
expr_stmt|;
break|break;
block|}
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x86
case|:
comment|/* NotifyOp */
comment|/* XXX Not yet impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Notify("
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x87
case|:
comment|/* SizeOfOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"SizeOf("
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|tmpobj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aname
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|num1
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|tmpobj
operator|->
name|type
condition|)
block|{
case|case
name|aml_t_buffer
case|:
name|num1
operator|=
name|tmpobj
operator|->
name|buffer
operator|.
name|size
expr_stmt|;
break|break;
case|case
name|aml_t_string
case|:
name|num1
operator|=
name|strlen
argument_list|(
name|tmpobj
operator|->
name|str
operator|.
name|string
argument_list|)
expr_stmt|;
break|break;
case|case
name|aml_t_package
case|:
name|num1
operator|=
name|tmpobj
operator|->
name|package
operator|.
name|elements
expr_stmt|;
break|break;
default|default:
name|AML_DEBUGPRINT
argument_list|(
literal|"Args of SizeOf should be "
literal|"buffer/string/package only\n"
argument_list|)
expr_stmt|;
break|break;
block|}
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|num1
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
break|break;
case|case
literal|0x88
case|:
comment|/* IndexOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Index("
argument_list|)
expr_stmt|;
name|srcobj
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|destname1
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_create_local_object
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|srcobj
operator|->
name|type
condition|)
block|{
case|case
name|aml_t_package
case|:
case|case
name|aml_t_buffer
case|:
name|AML_ALLOC_OBJECT
argument_list|(
name|objref
argument_list|,
name|env
argument_list|,
name|aml_t_objref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|->
name|property
operator|=
name|objref
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|ref
operator|=
name|srcobj
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|offset
operator|=
name|num1
expr_stmt|;
name|objref
operator|->
name|objref
operator|.
name|deref
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
name|AML_DEBUGPRINT
argument_list|(
literal|"Arg0 of Index should be either "
literal|"buffer or package\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|aname
operator|)
return|;
block|}
name|aml_store_to_name
argument_list|(
name|env
argument_list|,
name|objref
argument_list|,
name|destname1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x89
case|:
comment|/* MatchOp */
comment|/* XXX Not yet Impremented */
name|AML_DEBUGPRINT
argument_list|(
literal|"Match("
argument_list|)
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|obj
argument_list|,
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|->
name|type
operator|!=
name|aml_t_package
condition|)
block|{
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|anum
operator|.
name|num
operator|.
name|number
operator|=
literal|0xffffffff
expr_stmt|;
name|match1
operator|=
operator|*
name|env
operator|->
name|dp
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %d"
argument_list|,
operator|*
name|env
operator|->
name|dp
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|match2
operator|=
operator|*
name|env
operator|->
name|dp
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", %d"
argument_list|,
operator|*
name|env
operator|->
name|dp
argument_list|)
expr_stmt|;
name|env
operator|->
name|dp
operator|++
expr_stmt|;
name|num2
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|start
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
define|#
directive|define
name|MATCHOP
parameter_list|(
name|opnum
parameter_list|,
name|arg1
parameter_list|,
name|arg2
parameter_list|)
value|((opnum == 0) ? (1) :		\     (opnum == 1) ? ((arg1) == (arg2))	:				\     (opnum == 2) ? ((arg1)<= (arg2))	:				\     (opnum == 3) ? ((arg1)<  (arg2))	:				\     (opnum == 4) ? ((arg1)>= (arg2))	:				\     (opnum == 5) ? ((arg1)>  (arg2))	: 0 )
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|obj
operator|->
name|package
operator|.
name|elements
condition|;
name|i
operator|++
control|)
block|{
name|pkgval
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|obj
operator|->
name|package
operator|.
name|objects
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|MATCHOP
argument_list|(
name|match1
argument_list|,
name|pkgval
argument_list|,
name|num1
argument_list|)
operator|&&
name|MATCHOP
argument_list|(
name|match2
argument_list|,
name|pkgval
argument_list|,
name|num2
argument_list|)
condition|)
block|{
name|anum
operator|.
name|num
operator|.
name|number
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|aml_free_object
argument_list|(
operator|&
name|obj
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|env
operator|->
name|tempname
operator|.
name|property
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|=
name|anum
operator|.
name|num
expr_stmt|;
break|break;
undef|#
directive|undef
name|MATCHOP
case|case
literal|0x8a
operator|...
literal|0x8d
case|:
comment|/* CreateDWordFieldOp */
name|widthindex
operator|=
operator|*
operator|(
name|env
operator|->
name|dp
operator|-
literal|1
operator|)
operator|-
literal|0x8a
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|"%s("
argument_list|,
name|opname
index|[
name|widthindex
index|]
argument_list|)
expr_stmt|;
name|srcbuf
operator|=
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcbuf
operator|==
operator|&
name|env
operator|->
name|tempobject
condition|)
block|{
name|AML_DEBUGPRINT
argument_list|(
literal|"NOT NAMEDBUF\n"
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_panic
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|index
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|widthindex
operator|!=
literal|3
condition|)
block|{
name|index
operator|*=
literal|8
expr_stmt|;
block|}
name|AML_DEBUGPRINT
argument_list|(
literal|", "
argument_list|)
expr_stmt|;
name|newname
operator|=
name|aml_parse_namestring
argument_list|(
name|env
argument_list|)
expr_stmt|;
name|aml_print_namestring
argument_list|(
name|newname
argument_list|)
expr_stmt|;
name|aml_createfield_generic
argument_list|(
name|env
argument_list|,
name|srcbuf
argument_list|,
name|index
argument_list|,
name|widthtbl
index|[
name|widthindex
index|]
argument_list|,
name|newname
argument_list|)
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x8e
case|:
comment|/* ObjectTypeOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"ObjectType("
argument_list|)
expr_stmt|;
name|aname
operator|=
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
if|if
condition|(
name|aname
operator|==
name|NULL
condition|)
block|{
name|env
operator|->
name|tempobject
operator|.
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|.
name|number
operator|=
name|aml_t_null
expr_stmt|;
block|}
else|else
block|{
name|env
operator|->
name|tempobject
operator|.
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|.
name|number
operator|=
name|aname
operator|->
name|property
operator|->
name|type
expr_stmt|;
block|}
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
define|#
directive|define
name|CMPOP
parameter_list|(
name|opname
parameter_list|,
name|operation
parameter_list|)
value|do {					\ 	AML_DEBUGPRINT(opname);						\ 	AML_DEBUGPRINT("(");						\ 	num1 = aml_objtonum(env, aml_eval_name(env,			\ 	    aml_parse_termobj(env, indent)));				\ 	AML_DEBUGPRINT(", ");						\ 	num2 = aml_objtonum(env, aml_eval_name(env,			\ 	    aml_parse_termobj(env, indent)));				\ 	aname =&env->tempname;						\ 	env->tempobject.type = aml_t_num;				\ 	env->tempobject.num.number = (num1 operation num2) ? 0xffffffff : 0;	\ 	aname->property =&env->tempobject;				\ 	AML_DEBUGPRINT(")");						\ } while(0)
case|case
literal|0x90
case|:
name|CMPOP
argument_list|(
literal|"LAnd"
argument_list|,
operator|&&
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x91
case|:
name|CMPOP
argument_list|(
literal|"LOr"
argument_list|,
operator|||
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x92
case|:
name|AML_DEBUGPRINT
argument_list|(
literal|"LNot("
argument_list|)
expr_stmt|;
name|num1
operator|=
name|aml_objtonum
argument_list|(
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|type
operator|=
name|aml_t_num
expr_stmt|;
name|env
operator|->
name|tempobject
operator|.
name|num
operator|.
name|number
operator|=
operator|(
operator|!
name|num1
operator|)
condition|?
literal|0xffffffff
else|:
literal|0
expr_stmt|;
name|aname
operator|->
name|property
operator|=
operator|&
name|env
operator|->
name|tempobject
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x93
case|:
name|CMPOP
argument_list|(
literal|"LEqual"
argument_list|,
operator|==
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x94
case|:
name|CMPOP
argument_list|(
literal|"LGreater"
argument_list|,
operator|>
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0x95
case|:
name|CMPOP
argument_list|(
literal|"LLess"
argument_list|,
operator|<
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xa0
case|:
comment|/* IfOp */
name|aname
operator|=
name|aml_parse_defif
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
if|#
directive|if
literal|0
block|case 0xa1:
comment|/* ElseOp should not be treated in Main parser 				 * But If Op */
block|aml_parse_defelse(env, indent); 		break;
endif|#
directive|endif
case|case
literal|0xa2
case|:
comment|/* WhileOp */
name|aname
operator|=
name|aml_parse_defwhile
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xa3
case|:
comment|/* NoopOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Noop"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xa5
case|:
comment|/* BreakOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Break"
argument_list|)
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_break
expr_stmt|;
break|break;
case|case
literal|0xa4
case|:
comment|/* ReturnOp */
name|AML_DEBUGPRINT
argument_list|(
literal|"Return("
argument_list|)
expr_stmt|;
name|AML_COPY_OBJECT
argument_list|(
name|env
operator|->
name|tempname
operator|.
name|property
argument_list|,
name|env
argument_list|,
name|aml_eval_name
argument_list|(
name|env
argument_list|,
name|aml_parse_termobj
argument_list|(
name|env
argument_list|,
name|indent
argument_list|)
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|aname
operator|=
operator|&
name|env
operator|->
name|tempname
expr_stmt|;
name|env
operator|->
name|stat
operator|=
name|aml_stat_return
expr_stmt|;
name|AML_DEBUGPRINT
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0xcc
case|:
comment|/* BreakPointOp */
comment|/* XXX Not Yet Impremented (Not need?) */
name|AML_DEBUGPRINT
argument_list|(
literal|"BreakPoint"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|AML_SYSERRX
argument_list|(
literal|1
argument_list|,
literal|"strange opcode 0x%x\n"
argument_list|,
name|opcode
argument_list|)
expr_stmt|;
name|AML_SYSABORT
argument_list|()
expr_stmt|;
block|}
return|return
operator|(
name|aname
operator|)
return|;
block|}
end_function

end_unit

