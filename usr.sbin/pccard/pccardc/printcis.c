begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* set tab=4  *	dump CIS tuples.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<pccard/card.h>
end_include

begin_include
include|#
directive|include
file|<pccard/cis.h>
end_include

begin_include
include|#
directive|include
file|"readcis.h"
end_include

begin_function_decl
name|int
name|dump_pwr_desc
parameter_list|(
name|unsigned
name|char
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|print_ext_speed
parameter_list|(
name|unsigned
name|char
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_device_desc
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|,
name|char
modifier|*
name|type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_info_v1
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_config_map
parameter_list|(
name|struct
name|tuple
modifier|*
name|tp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_cis_config
parameter_list|(
name|struct
name|tuple
modifier|*
name|tp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_other_cond
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dump_func_ext
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|dumpcis
parameter_list|(
name|struct
name|cis
modifier|*
name|cp
parameter_list|)
block|{
name|struct
name|tuple
modifier|*
name|tp
decl_stmt|;
name|struct
name|tuple_list
modifier|*
name|tl
decl_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|,
name|sz
decl_stmt|,
name|ad
decl_stmt|,
name|i
decl_stmt|;
name|unsigned
name|char
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|tl
operator|=
name|cp
operator|->
name|tlist
init|;
name|tl
condition|;
name|tl
operator|=
name|tl
operator|->
name|next
control|)
for|for
control|(
name|tp
operator|=
name|tl
operator|->
name|tuples
init|;
name|tp
condition|;
name|tp
operator|=
name|tp
operator|->
name|next
control|)
block|{
name|printf
argument_list|(
literal|"Tuple #%d, code = 0x%x (%s), length = %d\n"
argument_list|,
operator|++
name|count
argument_list|,
name|tp
operator|->
name|code
argument_list|,
name|tuple_name
argument_list|(
name|tp
operator|->
name|code
argument_list|)
argument_list|,
name|tp
operator|->
name|length
argument_list|)
expr_stmt|;
name|p
operator|=
name|tp
operator|->
name|data
expr_stmt|;
name|sz
operator|=
name|tp
operator|->
name|length
expr_stmt|;
name|ad
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|sz
operator|>
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"    %03x: "
argument_list|,
name|ad
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
operator|(
name|sz
operator|<
literal|16
operator|)
condition|?
name|sz
else|:
literal|16
operator|)
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|" %02x"
argument_list|,
name|p
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|sz
operator|-=
literal|16
expr_stmt|;
name|p
operator|+=
literal|16
expr_stmt|;
name|ad
operator|+=
literal|16
expr_stmt|;
block|}
switch|switch
condition|(
name|tp
operator|->
name|code
condition|)
block|{
default|default:
break|break;
case|case
name|CIS_MEM_COMMON
case|:
comment|/* 0x01 */
name|dump_device_desc
argument_list|(
name|tp
operator|->
name|data
argument_list|,
name|tp
operator|->
name|length
argument_list|,
literal|"Common"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_CHECKSUM
case|:
comment|/* 0x10 */
if|if
condition|(
name|tp
operator|->
name|length
operator|==
literal|5
condition|)
block|{
name|printf
argument_list|(
literal|"\tChecksum from offset %d, length %d, value is 0x%x\n"
argument_list|,
call|(
name|short
call|)
argument_list|(
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|0
index|]
argument_list|)
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|3
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|2
index|]
argument_list|,
name|tp
operator|->
name|data
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"\tIllegal length for checksum!\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_LONGLINK_A
case|:
comment|/* 0x11 */
name|printf
argument_list|(
literal|"\tLong link to attribute memory, address 0x%x\n"
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|tp
operator|->
name|data
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_LONGLINK_C
case|:
comment|/* 0x12 */
name|printf
argument_list|(
literal|"\tLong link to common memory, address 0x%x\n"
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|tp
operator|->
name|data
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
break|break;
break|break;
case|case
name|CIS_INFO_V1
case|:
comment|/* 0x15 */
name|dump_info_v1
argument_list|(
name|tp
operator|->
name|data
argument_list|,
name|tp
operator|->
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_ALTSTR
case|:
comment|/* 0x16 */
break|break;
case|case
name|CIS_MEM_ATTR
case|:
comment|/* 0x17 */
name|dump_device_desc
argument_list|(
name|tp
operator|->
name|data
argument_list|,
name|tp
operator|->
name|length
argument_list|,
literal|"Attribute"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_JEDEC_C
case|:
comment|/* 0x18 */
break|break;
case|case
name|CIS_JEDEC_A
case|:
comment|/* 0x19 */
break|break;
case|case
name|CIS_CONF_MAP
case|:
comment|/* 0x1A */
name|dump_config_map
argument_list|(
name|tp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_CONFIG
case|:
comment|/* 0x1B */
name|dump_cis_config
argument_list|(
name|tp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_DEVICE_OC
case|:
comment|/* 0x1C */
name|dump_other_cond
argument_list|(
name|tp
operator|->
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_DEVICE_OA
case|:
comment|/* 0x1D */
name|dump_other_cond
argument_list|(
name|tp
operator|->
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_DEVICEGEO
case|:
comment|/* 0x1E */
break|break;
case|case
name|CIS_DEVICEGEO_A
case|:
comment|/* 0x1F */
break|break;
case|case
name|CIS_MANUF_ID
case|:
comment|/* 0x20 */
name|printf
argument_list|(
literal|"\tPCMCIA ID = 0x%x, OEM ID = 0x%x\n"
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|0
index|]
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|3
index|]
operator|<<
literal|8
operator|)
operator||
name|tp
operator|->
name|data
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_FUNC_ID
case|:
comment|/* 0x21 */
switch|switch
condition|(
name|tp
operator|->
name|data
index|[
literal|0
index|]
condition|)
block|{
default|default:
name|printf
argument_list|(
literal|"\tUnknown function"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"\tMultifunction card"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"\tMemory card"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"\tSerial port/modem"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"\tParallel port"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|printf
argument_list|(
literal|"\tFixed disk card"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|printf
argument_list|(
literal|"\tVideo adapter"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|printf
argument_list|(
literal|"\tNetwork/LAN adapter"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|printf
argument_list|(
literal|"\tAIMS"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"%s%s\n"
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|&
literal|1
operator|)
condition|?
literal|" - POST initialize"
else|:
literal|""
argument_list|,
operator|(
name|tp
operator|->
name|data
index|[
literal|1
index|]
operator|&
literal|2
operator|)
condition|?
literal|" - Card has ROM"
else|:
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_FUNC_EXT
case|:
comment|/* 0x22 */
name|dump_func_ext
argument_list|(
name|tp
operator|->
name|data
argument_list|,
name|tp
operator|->
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|CIS_VERS_2
case|:
comment|/* 0x40 */
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  *	Dump configuration map tuple.  */
end_comment

begin_function
name|void
name|dump_config_map
parameter_list|(
name|struct
name|tuple
modifier|*
name|tp
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|p
decl_stmt|,
name|x
decl_stmt|;
name|int
name|rlen
decl_stmt|,
name|mlen
decl_stmt|;
name|int
name|i
decl_stmt|;
union|union
block|{
name|unsigned
name|long
name|l
decl_stmt|;
name|unsigned
name|char
name|b
index|[
literal|4
index|]
decl_stmt|;
block|}
name|u
union|;
name|rlen
operator|=
operator|(
name|tp
operator|->
name|data
index|[
literal|0
index|]
operator|&
literal|3
operator|)
operator|+
literal|1
expr_stmt|;
name|mlen
operator|=
operator|(
operator|(
name|tp
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|2
operator|)
operator|&
literal|3
operator|)
operator|+
literal|1
expr_stmt|;
name|u
operator|.
name|l
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|tp
operator|->
name|data
operator|+
literal|2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|rlen
condition|;
name|i
operator|++
control|)
name|u
operator|.
name|b
index|[
name|i
index|]
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"\tReg len = %d, config register addr = 0x%lx, last config = 0x%x\n"
argument_list|,
name|rlen
argument_list|,
name|u
operator|.
name|l
argument_list|,
name|tp
operator|->
name|data
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|mlen
condition|)
name|printf
argument_list|(
literal|"\tRegisters: "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|mlen
condition|;
name|i
operator|++
operator|,
name|p
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
literal|0x1
init|;
name|x
condition|;
name|x
operator|<<=
literal|1
control|)
name|printf
argument_list|(
literal|"%c"
argument_list|,
name|x
operator|&
operator|*
name|p
condition|?
literal|'X'
else|:
literal|'-'
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	Dump a config entry.  */
end_comment

begin_function
name|void
name|dump_cis_config
parameter_list|(
name|struct
name|tuple
modifier|*
name|tp
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|p
decl_stmt|,
name|feat
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|char
name|c
decl_stmt|;
name|p
operator|=
name|tp
operator|->
name|data
expr_stmt|;
name|printf
argument_list|(
literal|"\tConfig index = 0x%x%s\n"
argument_list|,
operator|*
name|p
operator|&
literal|0x3F
argument_list|,
operator|*
name|p
operator|&
literal|0x40
condition|?
literal|"(default)"
else|:
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
block|{
name|p
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"\tInterface byte = 0x%x "
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|*
name|p
operator|&
literal|0xF
condition|)
block|{
default|default:
name|printf
argument_list|(
literal|"(reserved)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"(memory)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"(I/O)"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
case|case
literal|5
case|:
case|case
literal|6
case|:
case|case
literal|7
case|:
case|case
literal|8
case|:
name|printf
argument_list|(
literal|"(custom)"
argument_list|)
expr_stmt|;
break|break;
block|}
name|c
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x10
condition|)
block|{
name|printf
argument_list|(
literal|" BVD1/2 active"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|','
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
operator|&
literal|0x20
condition|)
block|{
name|printf
argument_list|(
literal|"%c card WP active"
argument_list|,
name|c
argument_list|)
expr_stmt|;
comment|/* Write protect */
name|c
operator|=
literal|','
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
operator|&
literal|0x40
condition|)
block|{
name|printf
argument_list|(
literal|"%c +RDY/-BSY active"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|c
operator|=
literal|','
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
name|printf
argument_list|(
literal|"%c wait signal supported"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|p
operator|++
expr_stmt|;
name|feat
operator|=
operator|*
name|p
operator|++
expr_stmt|;
switch|switch
condition|(
name|feat
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"\tVcc pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"\tVcc pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tVpp pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"\tVcc pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tVpp1 pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tVpp2 pwr:\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
name|dump_pwr_desc
argument_list|(
name|p
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|feat
operator|&
literal|0x4
condition|)
block|{
name|i
operator|=
operator|*
name|p
operator|&
literal|3
expr_stmt|;
name|j
operator|=
operator|(
operator|*
name|p
operator|>>
literal|2
operator|)
operator|&
literal|7
expr_stmt|;
name|p
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|!=
literal|3
condition|)
block|{
name|printf
argument_list|(
literal|"\tWait scale "
argument_list|)
expr_stmt|;
name|print_ext_speed
argument_list|(
operator|*
name|p
argument_list|,
name|i
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
name|p
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|j
operator|!=
literal|7
condition|)
block|{
name|printf
argument_list|(
literal|"\tRDY/BSY scale "
argument_list|)
expr_stmt|;
name|print_ext_speed
argument_list|(
operator|*
name|p
argument_list|,
name|j
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
name|p
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|feat
operator|&
literal|0x8
condition|)
block|{
if|if
condition|(
operator|*
name|p
operator|&
literal|0x1F
condition|)
name|printf
argument_list|(
literal|"\tCard decodes %d address lines"
argument_list|,
operator|*
name|p
operator|&
literal|0x1F
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"\tCard provides address decode"
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
operator|*
name|p
operator|>>
literal|5
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|", 8 Bit I/O only"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|", limited 8/16 Bit I/O"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|", full 8/16 Bit I/O"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
block|{
name|p
operator|++
expr_stmt|;
name|c
operator|=
operator|*
name|p
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
operator|(
name|c
operator|&
literal|0xF
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"\t\tI/O address # %d: "
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|c
operator|>>
literal|4
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"block start = 0x%x"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"block start = 0x%x"
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|"block start = 0x%x"
argument_list|,
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
operator|(
name|c
operator|>>
literal|6
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|" block length = 0x%x"
argument_list|,
operator|*
name|p
operator|++
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|" block length = 0x%x"
argument_list|,
operator|(
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|" block length = 0x%x"
argument_list|,
operator|(
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/*  *	IRQ descriptor  */
if|if
condition|(
name|feat
operator|&
literal|0x10
condition|)
block|{
name|printf
argument_list|(
literal|"\t\tIRQ modes:"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x20
condition|)
block|{
name|printf
argument_list|(
literal|" Level"
argument_list|)
expr_stmt|;
name|c
operator|=
literal|','
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
operator|&
literal|0x40
condition|)
block|{
name|printf
argument_list|(
literal|"%c Pulse"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|c
operator|=
literal|','
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
name|printf
argument_list|(
literal|"%c Shared"
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x10
condition|)
block|{
name|i
operator|=
name|p
index|[
literal|0
index|]
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\tIRQs: "
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|1
condition|)
name|printf
argument_list|(
literal|" NMI"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x2
condition|)
name|printf
argument_list|(
literal|" IOCK"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x4
condition|)
name|printf
argument_list|(
literal|" BERR"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x8
condition|)
name|printf
argument_list|(
literal|" VEND"
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|16
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|i
operator|&
operator|(
literal|1
operator|<<
name|j
operator|)
condition|)
name|printf
argument_list|(
literal|" %d"
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|3
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"\t\tIRQ level = %d\n"
argument_list|,
operator|*
name|p
operator|&
literal|0xF
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
block|}
switch|switch
condition|(
operator|(
name|feat
operator|>>
literal|5
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"\tMemory space length = 0x%x\n"
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"\tMemory space address = 0x%x, length = 0x%x\n"
argument_list|,
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|2
index|]
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|p
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
comment|/*  *	Memory descriptors.  */
case|case
literal|3
case|:
name|c
operator|=
operator|*
name|p
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
operator|(
name|c
operator|&
literal|7
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"\tMemory descriptor %d\n\t\t"
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|" blk length = 0x%x00"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|" blk length = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|" blk length = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|" card addr = 0x%x00"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|" card addr = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|" card addr = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|c
operator|&
literal|0x80
condition|)
switch|switch
condition|(
operator|(
name|c
operator|>>
literal|5
operator|)
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|" host addr = 0x%x00"
argument_list|,
operator|*
name|p
operator|++
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|" host addr = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|printf
argument_list|(
literal|" host addr = 0x%x00"
argument_list|,
operator|(
name|p
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
operator||
operator|(
name|p
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|*
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|feat
operator|&
literal|0x80
condition|)
block|{
name|printf
argument_list|(
literal|"\tMax twin cards = %d\n"
argument_list|,
operator|*
name|p
operator|&
literal|7
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\tMisc attr:"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x8
condition|)
name|printf
argument_list|(
literal|" (Audio-BVD2)"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x10
condition|)
name|printf
argument_list|(
literal|" (Read-only)"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x20
condition|)
name|printf
argument_list|(
literal|" (Power down supported)"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
block|{
name|printf
argument_list|(
literal|" (Ext byte = 0x%x)"
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *	dump_other_cond - Dump other conditions.  */
end_comment

begin_function
name|void
name|dump_other_cond
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|)
block|{
if|if
condition|(
name|p
index|[
literal|0
index|]
condition|)
block|{
name|printf
argument_list|(
literal|"\t"
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
index|[
literal|0
index|]
operator|&
literal|1
condition|)
name|printf
argument_list|(
literal|"(MWAIT)"
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
index|[
literal|0
index|]
operator|&
literal|2
condition|)
name|printf
argument_list|(
literal|" (3V card)"
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
index|[
literal|0
index|]
operator|&
literal|0x80
condition|)
name|printf
argument_list|(
literal|" (Extension bytes follow)"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *	Dump power descriptor.  */
end_comment

begin_function
name|int
name|dump_pwr_desc
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|)
block|{
name|int
name|len
init|=
literal|1
decl_stmt|,
name|i
decl_stmt|;
name|unsigned
name|char
name|mask
decl_stmt|;
name|char
modifier|*
modifier|*
name|expp
decl_stmt|;
specifier|static
name|char
modifier|*
name|pname
index|[]
init|=
block|{
literal|"Nominal operating supply voltage"
block|,
literal|"Minimum operating supply voltage"
block|,
literal|"Maximum operating supply voltage"
block|,
literal|"Continuous supply current"
block|,
literal|"Max current average over 1 second"
block|,
literal|"Max current average over 10 ms"
block|,
literal|"Power down supply current"
block|,
literal|"Reserved"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|vexp
index|[]
init|=
block|{
literal|"10uV"
block|,
literal|"100uV"
block|,
literal|"1mV"
block|,
literal|"10mV"
block|,
literal|"100mV"
block|,
literal|"1V"
block|,
literal|"10V"
block|,
literal|"100V"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|cexp
index|[]
init|=
block|{
literal|"10nA"
block|,
literal|"1uA"
block|,
literal|"10uA"
block|,
literal|"100uA"
block|,
literal|"1mA"
block|,
literal|"10mA"
block|,
literal|"100mA"
block|,
literal|"1A"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|mant
index|[]
init|=
block|{
literal|"1"
block|,
literal|"1.2"
block|,
literal|"1.3"
block|,
literal|"1.5"
block|,
literal|"2"
block|,
literal|"2.5"
block|,
literal|"3"
block|,
literal|"3.5"
block|,
literal|"4"
block|,
literal|"4.5"
block|,
literal|"5"
block|,
literal|"5.5"
block|,
literal|"6"
block|,
literal|"7"
block|,
literal|"8"
block|,
literal|"9"
block|}
decl_stmt|;
name|mask
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|expp
operator|=
name|vexp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|mask
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
condition|)
block|{
name|len
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|>=
literal|3
condition|)
name|expp
operator|=
name|cexp
expr_stmt|;
name|printf
argument_list|(
literal|"\t\t%s: "
argument_list|,
name|pname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s x %s"
argument_list|,
name|mant
index|[
operator|(
operator|*
name|p
operator|>>
literal|3
operator|)
operator|&
literal|0xF
index|]
argument_list|,
name|expp
index|[
operator|*
name|p
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
block|{
name|len
operator|++
expr_stmt|;
name|p
operator|++
expr_stmt|;
name|printf
argument_list|(
literal|", ext = 0x%x"
argument_list|,
operator|*
name|p
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|len
operator|)
return|;
block|}
end_function

begin_function
name|void
name|dump_device_desc
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|,
name|char
modifier|*
name|type
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|un_name
index|[]
init|=
block|{
literal|"512b"
block|,
literal|"2Kb"
block|,
literal|"8Kb"
block|,
literal|"32Kb"
block|,
literal|"128Kb"
block|,
literal|"512Kb"
block|,
literal|"2Mb"
block|,
literal|"reserved"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|speed
index|[]
init|=
block|{
literal|"No speed"
block|,
literal|"250nS"
block|,
literal|"200nS"
block|,
literal|"150nS"
block|,
literal|"100nS"
block|,
literal|"Reserved"
block|,
literal|"Reserved"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|dev
index|[]
init|=
block|{
literal|"No device"
block|,
literal|"Mask ROM"
block|,
literal|"OTPROM"
block|,
literal|"UV EPROM"
block|,
literal|"EEPROM"
block|,
literal|"FLASH EEPROM"
block|,
literal|"SRAM"
block|,
literal|"DRAM"
block|,
literal|"Reserved"
block|,
literal|"Reserved"
block|,
literal|"Reserved"
block|,
literal|"Reserved"
block|,
literal|"Reserved"
block|,
literal|"Function specific"
block|,
literal|"Extended"
block|,
literal|"Reserved"
block|}
decl_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|*
name|p
operator|!=
literal|0xFF
operator|&&
name|len
operator|>
literal|0
condition|)
block|{
name|unsigned
name|char
name|x
decl_stmt|;
name|x
operator|=
operator|*
name|p
operator|++
expr_stmt|;
name|len
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|count
operator|++
operator|==
literal|0
condition|)
name|printf
argument_list|(
literal|"\t%s memory device information:\n"
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\t\tDevice number %d, type %s, WPS = %s\n"
argument_list|,
name|count
argument_list|,
name|dev
index|[
name|x
operator|>>
literal|4
index|]
argument_list|,
operator|(
name|x
operator|&
literal|0x8
operator|)
condition|?
literal|"ON"
else|:
literal|"OFF"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|&
literal|7
operator|)
operator|==
literal|7
condition|)
block|{
name|len
operator|--
expr_stmt|;
if|if
condition|(
operator|*
name|p
condition|)
block|{
name|printf
argument_list|(
literal|"\t\t"
argument_list|)
expr_stmt|;
name|print_ext_speed
argument_list|(
operator|*
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|&
literal|0x80
condition|)
block|{
name|p
operator|++
expr_stmt|;
name|len
operator|--
expr_stmt|;
block|}
block|}
name|p
operator|++
expr_stmt|;
block|}
else|else
name|printf
argument_list|(
literal|"\t\tSpeed = %s"
argument_list|,
name|speed
index|[
name|x
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|", Memory block size = %s, %d units\n"
argument_list|,
name|un_name
index|[
operator|*
name|p
operator|&
literal|7
index|]
argument_list|,
operator|(
operator|*
name|p
operator|>>
literal|3
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *	Print version info  */
end_comment

begin_function
name|void
name|dump_info_v1
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|)
block|{
name|printf
argument_list|(
literal|"\tVersion = %d.%d"
argument_list|,
name|p
index|[
literal|0
index|]
argument_list|,
name|p
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|", Manuf = [%s],"
argument_list|,
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|++
condition|)
empty_stmt|;
name|printf
argument_list|(
literal|"card vers = [%s]\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|++
condition|)
empty_stmt|;
name|printf
argument_list|(
literal|"\tAddit. info = [%s]"
argument_list|,
name|p
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|p
operator|++
condition|)
empty_stmt|;
name|printf
argument_list|(
literal|",[%s]\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	dump functional extension tuple.  */
end_comment

begin_function
name|void
name|dump_func_ext
parameter_list|(
name|unsigned
name|char
modifier|*
name|p
parameter_list|,
name|int
name|len
parameter_list|)
block|{
if|if
condition|(
name|len
operator|==
literal|0
condition|)
return|return;
switch|switch
condition|(
name|p
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|8
case|:
case|case
literal|10
case|:
if|if
condition|(
name|len
operator|!=
literal|4
condition|)
block|{
name|printf
argument_list|(
literal|"\tWrong length for serial extension\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|printf
argument_list|(
literal|"\tSerial interface extension:\n"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|p
index|[
literal|1
index|]
operator|&
literal|0x1F
condition|)
block|{
default|default:
name|printf
argument_list|(
literal|"\t\tUnkn device"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|printf
argument_list|(
literal|"\t\t8250 UART"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"\t\t16450 UART"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"\t\t16550 UART"
argument_list|)
expr_stmt|;
break|break;
block|}
name|printf
argument_list|(
literal|", Parity - %s%s%s%s"
argument_list|,
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|1
operator|)
condition|?
literal|"Space,"
else|:
literal|""
argument_list|,
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|2
operator|)
condition|?
literal|"Mark,"
else|:
literal|""
argument_list|,
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|4
operator|)
condition|?
literal|"Odd,"
else|:
literal|""
argument_list|,
operator|(
name|p
index|[
literal|2
index|]
operator|&
literal|8
operator|)
condition|?
literal|"Even,"
else|:
literal|""
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
case|case
literal|5
case|:
case|case
literal|6
case|:
case|case
literal|7
case|:
name|printf
argument_list|(
literal|"\tModem interface capabilities:\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|printf
argument_list|(
literal|"\tData modem services available:\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|printf
argument_list|(
literal|"\tFax/modem services available:\n"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|printf
argument_list|(
literal|"\tVoice services available:\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*  *	print_ext_speed - Print extended speed.  */
end_comment

begin_function
name|void
name|print_ext_speed
parameter_list|(
name|unsigned
name|char
name|x
parameter_list|,
name|int
name|scale
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|mant
index|[]
init|=
block|{
literal|"Reserved"
block|,
literal|"1.0"
block|,
literal|"1.2"
block|,
literal|"1.3"
block|,
literal|"1.5"
block|,
literal|"2.0"
block|,
literal|"2.5"
block|,
literal|"3.0"
block|,
literal|"3.5"
block|,
literal|"4.0"
block|,
literal|"4.5"
block|,
literal|"5.0"
block|,
literal|"5.5"
block|,
literal|"6.0"
block|,
literal|"7.0"
block|,
literal|"8.0"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|exp
index|[]
init|=
block|{
literal|"1 ns"
block|,
literal|"10 ns"
block|,
literal|"100 ns"
block|,
literal|"1 us"
block|,
literal|"10 us"
block|,
literal|"100 us"
block|,
literal|"1 ms"
block|,
literal|"10 ms"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|scale_name
index|[]
init|=
block|{
literal|"None"
block|,
literal|"10"
block|,
literal|"100"
block|,
literal|"1,000"
block|,
literal|"10,000"
block|,
literal|"100,000"
block|,
literal|"1,000,000"
block|,
literal|"10,000,000"
block|}
decl_stmt|;
name|printf
argument_list|(
literal|"Speed = %s x %s"
argument_list|,
name|mant
index|[
operator|(
name|x
operator|>>
literal|3
operator|)
operator|&
literal|0xF
index|]
argument_list|,
name|exp
index|[
name|x
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|scale
condition|)
name|printf
argument_list|(
literal|", scaled by %s"
argument_list|,
name|scale_name
index|[
name|scale
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

