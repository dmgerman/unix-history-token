begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1997, 2001 Hellmuth Michaelis. All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  *---------------------------------------------------------------------------  *  *	i4b daemon - config file processing  *	-----------------------------------  *  * $FreeBSD$  *  *      last edit-date: [Fri Jul 20 19:16:27 2001]  *  *---------------------------------------------------------------------------*/
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<sys/callout.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__NetBSD__
end_ifdef

begin_include
include|#
directive|include
file|<net/if_sppp.h>
end_include

begin_else
else|#
directive|else
end_else

begin_if
if|#
directive|if
name|__FreeBSD__
operator|==
literal|3
end_if

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/mbuf.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<machine/i4b_isppp.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"isdnd.h"
end_include

begin_include
include|#
directive|include
file|"y.tab.h"
end_include

begin_include
include|#
directive|include
file|"monitor.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|entrycount
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|controllercount
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|lineno
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|yytext
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|FILE
modifier|*
name|yyin
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|extern
name|int
name|yyparse
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|set_config_defaults
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|check_config
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_config
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|parse_valid
parameter_list|(
name|int
name|entrycount
parameter_list|,
name|char
modifier|*
name|dt
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
name|int
name|nregexpr
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|nregprog
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*---------------------------------------------------------------------------*  *	called from main to read and process config file  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|void
name|configure
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|,
name|int
name|reread
parameter_list|)
block|{
specifier|extern
name|void
name|reset_scanner
argument_list|(
name|FILE
operator|*
name|inputfile
argument_list|)
decl_stmt|;
name|set_config_defaults
argument_list|()
expr_stmt|;
name|yyin
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|reread
condition|)
block|{
name|reset_scanner
argument_list|(
name|yyin
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|yyin
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"cannot fopen file [%s]"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|yyparse
argument_list|()
expr_stmt|;
name|monitor_fixup_rights
argument_list|()
expr_stmt|;
name|check_config
argument_list|()
expr_stmt|;
comment|/* validation and consistency check */
name|fclose
argument_list|(
name|yyin
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_print
condition|)
block|{
if|if
condition|(
name|config_error_flag
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"there were %d error(s) in the configuration file, terminating!"
argument_list|,
name|config_error_flag
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|print_config
argument_list|()
expr_stmt|;
name|do_exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	yacc error routine  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|void
name|yyerror
parameter_list|(
specifier|const
name|char
modifier|*
name|msg
parameter_list|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"configuration error: %s at line %d, token \"%s\""
argument_list|,
name|msg
argument_list|,
name|lineno
operator|+
literal|1
argument_list|,
name|yytext
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	fill all config entries with default values  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|set_config_defaults
parameter_list|(
name|void
parameter_list|)
block|{
name|cfg_entry_t
modifier|*
name|cep
init|=
operator|&
name|cfg_entry_tab
index|[
literal|0
index|]
decl_stmt|;
comment|/* ptr to config entry */
name|int
name|i
decl_stmt|;
comment|/* system section cleanup */
name|nregprog
operator|=
name|nregexpr
operator|=
literal|0
expr_stmt|;
name|rt_prio
operator|=
name|RTPRIO_NOTUSED
expr_stmt|;
name|mailer
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
name|mailto
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* clean regular expression table */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_RE
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
condition|)
name|free
argument_list|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
argument_list|)
expr_stmt|;
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
condition|)
name|free
argument_list|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
argument_list|)
expr_stmt|;
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
operator|=
name|NULL
expr_stmt|;
name|rarr
index|[
name|i
index|]
operator|.
name|re_flg
operator|=
literal|0
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|rotatesuffix
argument_list|,
literal|""
argument_list|)
expr_stmt|;
comment|/* 	 * controller table cleanup, beware: has already 	 * been setup in main, init_controller() ! 	 */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ncontroller
condition|;
name|i
operator|++
control|)
block|{
name|isdn_ctrl_tab
index|[
name|i
index|]
operator|.
name|protocol
operator|=
name|PROTOCOL_DSS1
expr_stmt|;
name|isdn_ctrl_tab
index|[
name|i
index|]
operator|.
name|firmware
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* entry section cleanup */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|CFG_ENTRY_MAX
condition|;
name|i
operator|++
operator|,
name|cep
operator|++
control|)
block|{
name|bzero
argument_list|(
name|cep
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* ====== filled in at startup configuration, then static */
name|sprintf
argument_list|(
name|cep
operator|->
name|name
argument_list|,
literal|"ENTRY%d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|cep
operator|->
name|isdncontroller
operator|=
name|INVALID
expr_stmt|;
name|cep
operator|->
name|isdnchannel
operator|=
name|CHAN_ANY
expr_stmt|;
name|cep
operator|->
name|usrdevicename
operator|=
name|INVALID
expr_stmt|;
name|cep
operator|->
name|usrdeviceunit
operator|=
name|INVALID
expr_stmt|;
name|cep
operator|->
name|remote_numbers_handling
operator|=
name|RNH_LAST
expr_stmt|;
name|cep
operator|->
name|dialin_reaction
operator|=
name|REACT_IGNORE
expr_stmt|;
name|cep
operator|->
name|b1protocol
operator|=
name|BPROT_NONE
expr_stmt|;
name|cep
operator|->
name|unitlength
operator|=
name|UNITLENGTH_DEFAULT
expr_stmt|;
name|cep
operator|->
name|earlyhangup
operator|=
name|EARLYHANGUP_DEFAULT
expr_stmt|;
name|cep
operator|->
name|ratetype
operator|=
name|INVALID_RATE
expr_stmt|;
name|cep
operator|->
name|unitlengthsrc
operator|=
name|ULSRC_NONE
expr_stmt|;
name|cep
operator|->
name|answerprog
operator|=
name|ANSWERPROG_DEF
expr_stmt|;
name|cep
operator|->
name|callbackwait
operator|=
name|CALLBACKWAIT_MIN
expr_stmt|;
name|cep
operator|->
name|calledbackwait
operator|=
name|CALLEDBACKWAIT_MIN
expr_stmt|;
name|cep
operator|->
name|dialretries
operator|=
name|DIALRETRIES_DEF
expr_stmt|;
name|cep
operator|->
name|recoverytime
operator|=
name|RECOVERYTIME_MIN
expr_stmt|;
name|cep
operator|->
name|dialouttype
operator|=
name|DIALOUT_NORMAL
expr_stmt|;
name|cep
operator|->
name|inout
operator|=
name|DIR_INOUT
expr_stmt|;
name|cep
operator|->
name|ppp_expect_auth
operator|=
name|AUTH_UNDEF
expr_stmt|;
name|cep
operator|->
name|ppp_send_auth
operator|=
name|AUTH_UNDEF
expr_stmt|;
name|cep
operator|->
name|ppp_auth_flags
operator|=
name|AUTH_RECHALLENGE
operator||
name|AUTH_REQUIRED
expr_stmt|;
comment|/* ======== filled in after start, then dynamic */
name|cep
operator|->
name|cdid
operator|=
name|CDID_UNUSED
expr_stmt|;
name|cep
operator|->
name|state
operator|=
name|ST_IDLE
expr_stmt|;
name|cep
operator|->
name|aoc_valid
operator|=
name|AOC_INVALID
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	internaly set values for ommitted controler sectin  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|void
name|cfg_set_controller_default
parameter_list|()
block|{
name|controllercount
operator|=
literal|0
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"[defaults, no controller section] controller %d: protocol = dss1"
argument_list|,
name|controllercount
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|isdn_ctrl_tab
index|[
name|controllercount
index|]
operator|.
name|protocol
operator|=
name|PROTOCOL_DSS1
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|PPP_PAP
value|0xc023
end_define

begin_define
define|#
directive|define
name|PPP_CHAP
value|0xc223
end_define

begin_function
specifier|static
name|void
name|set_isppp_auth
parameter_list|(
name|int
name|entry
parameter_list|)
block|{
name|cfg_entry_t
modifier|*
name|cep
init|=
operator|&
name|cfg_entry_tab
index|[
name|entry
index|]
decl_stmt|;
comment|/* ptr to config entry */
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|spppreq
name|spr
decl_stmt|;
name|int
name|s
decl_stmt|;
name|int
name|doioctl
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|cep
operator|->
name|usrdevicename
operator|!=
name|BDRV_ISPPP
condition|)
return|return;
if|if
condition|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_UNDEF
operator|&&
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_UNDEF
condition|)
return|return;
if|if
condition|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_NONE
operator|||
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_NONE
condition|)
name|doioctl
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_CHAP
operator|||
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_PAP
operator|)
operator|&&
name|cep
operator|->
name|ppp_expect_name
index|[
literal|0
index|]
operator|!=
literal|0
operator|&&
name|cep
operator|->
name|ppp_expect_password
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
name|doioctl
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_CHAP
operator|||
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_PAP
operator|)
operator|&&
name|cep
operator|->
name|ppp_send_name
index|[
literal|0
index|]
operator|!=
literal|0
operator|&&
name|cep
operator|->
name|ppp_send_password
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
name|doioctl
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
name|doioctl
condition|)
return|return;
name|snprintf
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|,
sizeof|sizeof
argument_list|(
name|ifr
operator|.
name|ifr_name
argument_list|)
argument_list|,
literal|"isp%d"
argument_list|,
name|cep
operator|->
name|usrdeviceunit
argument_list|)
expr_stmt|;
comment|/* use a random AF to create the socket */
if|if
condition|(
operator|(
name|s
operator|=
name|socket
argument_list|(
name|AF_INET
argument_list|,
name|SOCK_DGRAM
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR opening control socket at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
return|return;
block|}
name|spr
operator|.
name|cmd
operator|=
operator|(
name|int
operator|)
name|SPPPIOGDEFS
expr_stmt|;
name|ifr
operator|.
name|ifr_data
operator|=
operator|(
name|caddr_t
operator|)
operator|&
name|spr
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCGIFGENERIC
argument_list|,
operator|&
name|ifr
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR fetching active PPP authentication info for %s at line %d!"
argument_list|,
name|ifr
operator|.
name|ifr_name
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|cep
operator|->
name|ppp_expect_auth
operator|!=
name|AUTH_UNDEF
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_NONE
condition|)
block|{
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|proto
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_CHAP
operator|||
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_PAP
operator|)
operator|&&
name|cep
operator|->
name|ppp_expect_name
index|[
literal|0
index|]
operator|!=
literal|0
operator|&&
name|cep
operator|->
name|ppp_expect_password
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
block|{
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|proto
operator|=
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_PAP
condition|?
name|PPP_PAP
else|:
name|PPP_CHAP
expr_stmt|;
name|strncpy
argument_list|(
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|name
argument_list|,
name|cep
operator|->
name|ppp_expect_name
argument_list|,
name|AUTHNAMELEN
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|secret
argument_list|,
name|cep
operator|->
name|ppp_expect_password
argument_list|,
name|AUTHKEYLEN
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|cep
operator|->
name|ppp_send_auth
operator|!=
name|AUTH_UNDEF
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_NONE
condition|)
block|{
name|spr
operator|.
name|defs
operator|.
name|myauth
operator|.
name|proto
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_CHAP
operator|||
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_PAP
operator|)
operator|&&
name|cep
operator|->
name|ppp_send_name
index|[
literal|0
index|]
operator|!=
literal|0
operator|&&
name|cep
operator|->
name|ppp_send_password
index|[
literal|0
index|]
operator|!=
literal|0
condition|)
block|{
name|spr
operator|.
name|defs
operator|.
name|myauth
operator|.
name|proto
operator|=
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_PAP
condition|?
name|PPP_PAP
else|:
name|PPP_CHAP
expr_stmt|;
name|strncpy
argument_list|(
name|spr
operator|.
name|defs
operator|.
name|myauth
operator|.
name|name
argument_list|,
name|cep
operator|->
name|ppp_send_name
argument_list|,
name|AUTHNAMELEN
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|spr
operator|.
name|defs
operator|.
name|myauth
operator|.
name|secret
argument_list|,
name|cep
operator|->
name|ppp_send_password
argument_list|,
name|AUTHKEYLEN
argument_list|)
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|ppp_auth_flags
operator|&
name|AUTH_REQUIRED
condition|)
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|flags
operator|&=
operator|~
name|AUTHFLAG_NOCALLOUT
expr_stmt|;
else|else
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|flags
operator||=
name|AUTHFLAG_NOCALLOUT
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|ppp_auth_flags
operator|&
name|AUTH_RECHALLENGE
condition|)
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|flags
operator|&=
operator|~
name|AUTHFLAG_NORECHALLENGE
expr_stmt|;
else|else
name|spr
operator|.
name|defs
operator|.
name|hisauth
operator|.
name|flags
operator||=
name|AUTHFLAG_NORECHALLENGE
expr_stmt|;
block|}
block|}
name|spr
operator|.
name|cmd
operator|=
operator|(
name|int
operator|)
name|SPPPIOSDEFS
expr_stmt|;
if|if
condition|(
name|ioctl
argument_list|(
name|s
argument_list|,
name|SIOCSIFGENERIC
argument_list|,
operator|&
name|ifr
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR setting new PPP authentication parameters for %s at line %d!"
argument_list|,
name|ifr
operator|.
name|ifr_name
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
name|close
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	extract values from config and fill table  *---------------------------------------------------------------------------*/
end_comment

begin_function
name|void
name|cfg_setval
parameter_list|(
name|int
name|keyword
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
switch|switch
condition|(
name|keyword
condition|)
block|{
case|case
name|ACCTALL
case|:
name|acct_all
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: acctall = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ACCTFILE
case|:
name|strcpy
argument_list|(
name|acctfile
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: acctfile = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALERT
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|MINALERT
condition|)
block|{
name|yylval
operator|.
name|num
operator|=
name|MINALERT
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: alert< %d, min = %d"
argument_list|,
name|entrycount
argument_list|,
name|MINALERT
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|yylval
operator|.
name|num
operator|>
name|MAXALERT
condition|)
block|{
name|yylval
operator|.
name|num
operator|=
name|MAXALERT
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: alert> %d, min = %d"
argument_list|,
name|entrycount
argument_list|,
name|MAXALERT
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: alert = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|alert
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|ALIASING
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: aliasing = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|aliasing
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
break|break;
case|case
name|ALIASFNAME
case|:
name|strcpy
argument_list|(
name|aliasfile
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: aliasfile = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ANSWERPROG
case|:
if|if
condition|(
operator|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|answerprog
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: answerstring, malloc failed!"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|answerprog
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: answerprog = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|B1PROTOCOL
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: b1protocol = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"raw"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|b1protocol
operator|=
name|BPROT_NONE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"hdlc"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|b1protocol
operator|=
name|BPROT_RHDLC
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"b1protocol\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|BEEPCONNECT
case|:
name|do_bell
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: beepconnect = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUDGETCALLBACKPERIOD
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-callbackperiod = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbackperiod
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|BUDGETCALLBACKNCALLS
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-callbackncalls = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbackncalls
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|BUDGETCALLOUTPERIOD
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-calloutperiod = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_calloutperiod
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|BUDGETCALLOUTNCALLS
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-calloutncalls = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_calloutncalls
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|BUDGETCALLBACKSFILEROTATE
case|:
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacksfile_rotate
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-callbacksfile-rotate = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUDGETCALLBACKSFILE
case|:
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|int
name|s
decl_stmt|,
name|l
decl_stmt|;
name|int
name|n
decl_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-callbacksfile = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|s
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|l
argument_list|,
operator|&
name|n
argument_list|)
operator|)
operator|!=
literal|3
condition|)
block|{
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: initializing budget-callbacksfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: creating budget-callbacksfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|s
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|l
argument_list|,
operator|&
name|n
argument_list|)
operator|)
operator|==
literal|3
condition|)
block|{
if|if
condition|(
operator|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacks_file
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: budget-callbacksfile, malloc failed!"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacks_file
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: using callbacksfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|BUDGETCALLOUTSFILEROTATE
case|:
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_calloutsfile_rotate
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-calloutsfile-rotate = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|BUDGETCALLOUTSFILE
case|:
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|int
name|s
decl_stmt|,
name|l
decl_stmt|;
name|int
name|n
decl_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: budget-calloutsfile = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|s
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|l
argument_list|,
operator|&
name|n
argument_list|)
operator|)
operator|!=
literal|3
condition|)
block|{
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: initializing budget-calloutsfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: creating budget-calloutsfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
name|fp
operator|=
name|fopen
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%d %d %d"
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|s
argument_list|,
operator|(
name|int
operator|*
operator|)
operator|&
name|l
argument_list|,
operator|&
name|n
argument_list|)
operator|)
operator|==
literal|3
condition|)
block|{
if|if
condition|(
operator|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callouts_file
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: budget-calloutsfile, malloc failed!"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callouts_file
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: using calloutsfile %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|CALLBACKWAIT
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|CALLBACKWAIT_MIN
condition|)
block|{
name|yylval
operator|.
name|num
operator|=
name|CALLBACKWAIT_MIN
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: callbackwait< %d, min = %d"
argument_list|,
name|entrycount
argument_list|,
name|CALLBACKWAIT_MIN
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: callbackwait = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|callbackwait
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|CALLEDBACKWAIT
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|CALLEDBACKWAIT_MIN
condition|)
block|{
name|yylval
operator|.
name|num
operator|=
name|CALLEDBACKWAIT_MIN
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: calledbackwait< %d, min = %d"
argument_list|,
name|entrycount
argument_list|,
name|CALLEDBACKWAIT_MIN
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: calledbackwait = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|calledbackwait
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|CLONE
case|:
comment|/* 		     *  clone =<entryname> 		     *      Loads the entry from the named, existing one. 		     *      Fields such as name and usrdeviceunit should 		     *      always be specified after clone as they must be 		     *      unique. 		     * 		     *  NOTE: all malloc()'d fields must be dup()'d here, 		     *  we can't have multiple references to same storage. 		     */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|entrycount
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|cfg_entry_tab
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
condition|)
break|break;
if|if
condition|(
name|i
operator|==
name|entrycount
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: clone, unknown entry %s!"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: clone = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|cfg_entry_tab
index|[
name|entrycount
index|]
argument_list|,
operator|&
name|cfg_entry_tab
index|[
name|i
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_tab
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|answerprog
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|answerprog
operator|=
name|strdup
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|answerprog
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacks_file
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacks_file
operator|=
name|strdup
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callbacks_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callouts_file
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callouts_file
operator|=
name|strdup
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|budget_callouts_file
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|connectprog
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|connectprog
operator|=
name|strdup
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|connectprog
argument_list|)
expr_stmt|;
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|disconnectprog
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|disconnectprog
operator|=
name|strdup
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|disconnectprog
argument_list|)
expr_stmt|;
break|break;
case|case
name|CONNECTPROG
case|:
if|if
condition|(
operator|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|connectprog
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: connectprog, malloc failed!"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|connectprog
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: connectprog = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIALOUTTYPE
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: dialouttype = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"normal"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialouttype
operator|=
name|DIALOUT_NORMAL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"calledback"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialouttype
operator|=
name|DIALOUT_CALLEDBACK
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"dialout-type\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|DIALRETRIES
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: dialretries = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialretries
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|DIALRANDINCR
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: dialrandincr = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialrandincr
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
break|break;
case|case
name|DIRECTION
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: direction = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"inout"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|inout
operator|=
name|DIR_INOUT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"in"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|inout
operator|=
name|DIR_INONLY
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"out"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|inout
operator|=
name|DIR_OUTONLY
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"direction\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|DISCONNECTPROG
case|:
if|if
condition|(
operator|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|disconnectprog
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"entry %d: disconnectprog, malloc failed!"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|disconnectprog
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: disconnectprog = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|DOWNTRIES
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|>
name|DOWN_TRIES_MAX
condition|)
name|yylval
operator|.
name|num
operator|=
name|DOWN_TRIES_MAX
expr_stmt|;
elseif|else
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|DOWN_TRIES_MIN
condition|)
name|yylval
operator|.
name|num
operator|=
name|DOWN_TRIES_MIN
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: downtries = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|downtries
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|DOWNTIME
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|>
name|DOWN_TIME_MAX
condition|)
name|yylval
operator|.
name|num
operator|=
name|DOWN_TIME_MAX
expr_stmt|;
elseif|else
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|DOWN_TIME_MIN
condition|)
name|yylval
operator|.
name|num
operator|=
name|DOWN_TIME_MIN
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: downtime = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|downtime
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|EARLYHANGUP
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: earlyhangup = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|earlyhangup
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|EXTCALLATTR
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: extcallattr = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|extcallattr
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
break|break;
case|case
name|FIRMWARE
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"controller %d: firmware = %s"
argument_list|,
name|controllercount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|isdn_ctrl_tab
index|[
name|controllercount
index|]
operator|.
name|firmware
operator|=
name|strdup
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|HOLIDAYFILE
case|:
name|strcpy
argument_list|(
name|holidayfile
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: holidayfile = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|IDLE_ALG_OUT
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: idle-algorithm-outgoing = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"fix-unit-size"
argument_list|)
operator|)
condition|)
block|{
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|shorthold_algorithm
operator|=
name|SHA_FIXU
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"var-unit-size"
argument_list|)
operator|)
condition|)
block|{
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|shorthold_algorithm
operator|=
name|SHA_VARU
expr_stmt|;
block|}
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"idle-algorithm-outgoing\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|IDLETIME_IN
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: idle_time_in = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|idle_time_in
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|IDLETIME_OUT
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: idle_time_out = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|idle_time_out
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|ISDNCONTROLLER
case|:
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|isdncontroller
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdncontroller = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ISDNCHANNEL
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|==
literal|0
operator|||
name|yylval
operator|.
name|num
operator|==
operator|-
literal|1
condition|)
block|{
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|isdnchannel
operator|=
name|CHAN_ANY
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdnchannel = any"
argument_list|,
name|entrycount
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|yylval
operator|.
name|num
operator|>
name|MAX_BCHAN
condition|)
block|{
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdnchannel value out of range"
argument_list|,
name|entrycount
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
else|else
block|{
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|isdnchannel
operator|=
name|yylval
operator|.
name|num
operator|-
literal|1
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdnchannel = B%d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|ISDNTIME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: isdntime = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|isdntime
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
break|break;
case|case
name|ISDNTXDELIN
case|:
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|isdntxdelin
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdntxdel-incoming = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ISDNTXDELOUT
case|:
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|isdntxdelout
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: isdntxdel-outgoing = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|LOCAL_PHONE_DIALOUT
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: local_phone_dialout = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|local_phone_dialout
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|LOCAL_PHONE_INCOMING
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: local_phone_incoming = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|local_phone_incoming
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|MAILER
case|:
name|strcpy
argument_list|(
name|mailer
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: mailer = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MAILTO
case|:
name|strcpy
argument_list|(
name|mailto
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: mailto = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MAXCONNECTTIME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: maxconnecttime = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|maxconnecttime
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|MONITORPORT
case|:
name|monitorport
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: monitorport = %d"
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MONITORSW
case|:
if|if
condition|(
name|yylval
operator|.
name|booln
operator|&&
name|inhibit_monitor
condition|)
block|{
name|do_monitor
operator|=
literal|0
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: monitor-enable overriden by command line flag"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|do_monitor
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: monitor-enable = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|NAME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: name = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|name
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_AUTH_RECHALLENGE
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-auth-rechallenge = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yylval
operator|.
name|booln
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_auth_flags
operator||=
name|AUTH_RECHALLENGE
expr_stmt|;
else|else
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_auth_flags
operator|&=
operator|~
name|AUTH_RECHALLENGE
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_AUTH_PARANOID
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-auth-paranoid = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|yylval
operator|.
name|booln
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_auth_flags
operator||=
name|AUTH_REQUIRED
expr_stmt|;
else|else
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_auth_flags
operator|&=
operator|~
name|AUTH_REQUIRED
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_EXPECT_AUTH
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-expect-auth = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"none"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_auth
operator|=
name|AUTH_NONE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"pap"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_auth
operator|=
name|AUTH_PAP
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"chap"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_auth
operator|=
name|AUTH_CHAP
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"ppp-expect-auth\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_EXPECT_NAME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-expect-name = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_name
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_name
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_EXPECT_PASSWORD
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-expect-password = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_password
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_expect_password
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_SEND_AUTH
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-send-auth = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"none"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_auth
operator|=
name|AUTH_NONE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"pap"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_auth
operator|=
name|AUTH_PAP
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"chap"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_auth
operator|=
name|AUTH_CHAP
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"ppp-send-auth\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_SEND_NAME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-send-name = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_name
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_name
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PPP_SEND_PASSWORD
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ppp-send-password = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_password
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ppp_send_password
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
name|set_isppp_auth
argument_list|(
name|entrycount
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROTOCOL
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"controller %d: protocol = %s"
argument_list|,
name|controllercount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"dss1"
argument_list|)
operator|)
condition|)
name|isdn_ctrl_tab
index|[
name|controllercount
index|]
operator|.
name|protocol
operator|=
name|PROTOCOL_DSS1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"d64s"
argument_list|)
operator|)
condition|)
name|isdn_ctrl_tab
index|[
name|controllercount
index|]
operator|.
name|protocol
operator|=
name|PROTOCOL_D64S
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"protocol\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|REACTION
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: dialin_reaction = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"accept"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialin_reaction
operator|=
name|REACT_ACCEPT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"reject"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialin_reaction
operator|=
name|REACT_REJECT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"ignore"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialin_reaction
operator|=
name|REACT_IGNORE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"answer"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialin_reaction
operator|=
name|REACT_ANSWER
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"callback"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|dialin_reaction
operator|=
name|REACT_CALLBACK
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"dialin_reaction\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|REMOTE_PHONE_DIALOUT
case|:
if|if
condition|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_count
operator|>=
name|MAXRNUMBERS
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: too many remote numbers at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: remote_phone_dialout #%d = %s"
argument_list|,
name|entrycount
argument_list|,
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_count
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers
index|[
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_count
index|]
operator|.
name|number
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers
index|[
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_count
index|]
operator|.
name|flag
operator|=
literal|0
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_count
operator|++
expr_stmt|;
break|break;
case|case
name|REMOTE_NUMBERS_HANDLING
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: remdial_handling = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"next"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_handling
operator|=
name|RNH_NEXT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"last"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_handling
operator|=
name|RNH_LAST
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"first"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_numbers_handling
operator|=
name|RNH_FIRST
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"remdial_handling\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|REMOTE_PHONE_INCOMING
case|:
block|{
name|int
name|n
decl_stmt|;
name|n
operator|=
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|incoming_numbers_count
expr_stmt|;
if|if
condition|(
name|n
operator|>=
name|MAX_INCOMING
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: too many \"remote_phone_incoming\" entries at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: remote_phone_incoming #%d = %s"
argument_list|,
name|entrycount
argument_list|,
name|n
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|remote_phone_incoming
index|[
name|n
index|]
operator|.
name|number
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|incoming_numbers_count
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|RATESFILE
case|:
name|strcpy
argument_list|(
name|ratesfile
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: ratesfile = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RATETYPE
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: ratetype = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|ratetype
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|RECOVERYTIME
case|:
if|if
condition|(
name|yylval
operator|.
name|num
operator|<
name|RECOVERYTIME_MIN
condition|)
block|{
name|yylval
operator|.
name|num
operator|=
name|RECOVERYTIME_MIN
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: recoverytime< %d, min = %d"
argument_list|,
name|entrycount
argument_list|,
name|RECOVERYTIME_MIN
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: recoverytime = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|recoverytime
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|REGEXPR
case|:
if|if
condition|(
name|nregexpr
operator|>=
name|MAX_RE
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: regexpr #%d>= MAX_RE"
argument_list|,
name|nregexpr
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|i
operator|=
name|regcomp
argument_list|(
operator|&
operator|(
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re
operator|)
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
name|REG_EXTENDED
operator||
name|REG_NOSUB
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|regerror
argument_list|(
name|i
argument_list|,
operator|&
operator|(
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re
operator|)
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: regcomp error for %s: [%s]"
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re_expr
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: regexpr malloc error error for %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|strcpy
argument_list|(
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re_expr
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: regexpr %s stored into slot %d"
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
name|nregexpr
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re_prog
operator|!=
name|NULL
condition|)
name|rarr
index|[
name|nregexpr
index|]
operator|.
name|re_flg
operator|=
literal|1
expr_stmt|;
name|nregexpr
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|REGPROG
case|:
if|if
condition|(
name|nregprog
operator|>=
name|MAX_RE
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: regprog #%d>= MAX_RE"
argument_list|,
name|nregprog
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|(
name|rarr
index|[
name|nregprog
index|]
operator|.
name|re_prog
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|yylval
operator|.
name|str
argument_list|)
operator|+
literal|1
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: regprog malloc error error for %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
name|strcpy
argument_list|(
name|rarr
index|[
name|nregprog
index|]
operator|.
name|re_prog
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: regprog %s stored into slot %d"
argument_list|,
name|yylval
operator|.
name|str
argument_list|,
name|nregprog
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rarr
index|[
name|nregprog
index|]
operator|.
name|re_expr
operator|!=
name|NULL
condition|)
name|rarr
index|[
name|nregprog
index|]
operator|.
name|re_flg
operator|=
literal|1
expr_stmt|;
name|nregprog
operator|++
expr_stmt|;
break|break;
case|case
name|ROTATESUFFIX
case|:
name|strcpy
argument_list|(
name|rotatesuffix
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: rotatesuffix = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|RTPRIO
case|:
ifdef|#
directive|ifdef
name|USE_RTPRIO
name|rt_prio
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
if|if
condition|(
name|rt_prio
operator|<
name|RTP_PRIO_MIN
operator|||
name|rt_prio
operator|>
name|RTP_PRIO_MAX
condition|)
block|{
name|config_error_flag
operator|++
expr_stmt|;
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"system: error, rtprio (%d) out of range!"
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: rtprio = %d"
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|rt_prio
operator|=
name|RTPRIO_NOTUSED
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
name|TINAINITPROG
case|:
name|strcpy
argument_list|(
name|tinainitprog
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: tinainitprog = %s"
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|UNITLENGTH
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: unitlength = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlength
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|UNITLENGTHSRC
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: unitlengthsrc = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"none"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlengthsrc
operator|=
name|ULSRC_NONE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"cmdl"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlengthsrc
operator|=
name|ULSRC_CMDL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"conf"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlengthsrc
operator|=
name|ULSRC_CONF
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"rate"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlengthsrc
operator|=
name|ULSRC_RATE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
operator|(
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"aocd"
argument_list|)
operator|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|unitlengthsrc
operator|=
name|ULSRC_DYN
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"unitlengthsrc\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|USRDEVICENAME
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: usrdevicename = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"rbch"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_RBCH
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"tel"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_TEL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"ipr"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_IPR
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"isp"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_ISPPP
expr_stmt|;
ifdef|#
directive|ifdef
name|__bsdi__
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"ibc"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_IBC
expr_stmt|;
endif|#
directive|endif
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|yylval
operator|.
name|str
argument_list|,
literal|"ing"
argument_list|)
condition|)
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdevicename
operator|=
name|BDRV_ING
expr_stmt|;
else|else
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown parameter for keyword \"usrdevicename\" at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
block|}
break|break;
case|case
name|USRDEVICEUNIT
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: usrdeviceunit = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|num
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usrdeviceunit
operator|=
name|yylval
operator|.
name|num
expr_stmt|;
break|break;
case|case
name|USEACCTFILE
case|:
name|useacctfile
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"system: useacctfile = %d"
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|USEDOWN
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: usedown = %d"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|booln
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|usedown
operator|=
name|yylval
operator|.
name|booln
expr_stmt|;
break|break;
case|case
name|VALID
case|:
name|DBGL
argument_list|(
name|DL_RCCF
argument_list|,
operator|(
name|log
argument_list|(
name|LL_DBG
argument_list|,
literal|"entry %d: valid = %s"
argument_list|,
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|parse_valid
argument_list|(
name|entrycount
argument_list|,
name|yylval
operator|.
name|str
argument_list|)
expr_stmt|;
break|break;
default|default:
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: unknown keyword at line %d!"
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	parse a date/time range  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|parse_valid
parameter_list|(
name|int
name|entrycount
parameter_list|,
name|char
modifier|*
name|dt
parameter_list|)
block|{
comment|/* a valid string consists of some days of week separated by 	 * commas, where 0=sunday, 1=monday .. 6=saturday and a special 	 * value of 7 which is a holiday from the holiday file. 	 * after the days comes an optional (!) time range in the form 	 * aa:bb-cc:dd, this format is fixed to be parsable by sscanf. 	 * Valid specifications looks like this: 	 * 1,2,3,4,5,09:00-18:00	Monday-Friday 9-18h 	 * 1,2,3,4,5,18:00-09:00	Monday-Friday 18-9h 	 * 6				Saturday (whole day) 	 * 0,7				Sunday and Holidays 	 */
name|int
name|day
init|=
literal|0
decl_stmt|;
name|int
name|fromhr
init|=
literal|0
decl_stmt|;
name|int
name|frommin
init|=
literal|0
decl_stmt|;
name|int
name|tohr
init|=
literal|0
decl_stmt|;
name|int
name|tomin
init|=
literal|0
decl_stmt|;
name|int
name|ret
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|(
operator|(
operator|(
operator|*
name|dt
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|dt
operator|<=
literal|'9'
operator|)
operator|)
operator|&&
operator|(
operator|*
operator|(
name|dt
operator|+
literal|1
operator|)
operator|==
literal|':'
operator|)
operator|)
operator|||
operator|(
operator|(
operator|(
operator|*
name|dt
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|dt
operator|<=
literal|'2'
operator|)
operator|)
operator|&&
operator|(
operator|(
operator|*
operator|(
name|dt
operator|+
literal|1
operator|)
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
operator|(
name|dt
operator|+
literal|1
operator|)
operator|<=
literal|'9'
operator|)
operator|)
operator|&&
operator|(
operator|*
operator|(
name|dt
operator|+
literal|2
operator|)
operator|==
literal|':'
operator|)
operator|)
condition|)
block|{
comment|/* dt points to time spec */
name|ret
operator|=
name|sscanf
argument_list|(
name|dt
argument_list|,
literal|"%d:%d-%d:%d"
argument_list|,
operator|&
name|fromhr
argument_list|,
operator|&
name|frommin
argument_list|,
operator|&
name|tohr
argument_list|,
operator|&
name|tomin
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|4
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: timespec [%s] error at line %d!"
argument_list|,
operator|*
name|dt
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|fromhr
operator|<
literal|0
operator|||
name|fromhr
operator|>
literal|24
operator|||
name|tohr
operator|<
literal|0
operator|||
name|tohr
operator|>
literal|24
operator|||
name|frommin
operator|<
literal|0
operator|||
name|frommin
operator|>
literal|59
operator|||
name|tomin
operator|<
literal|0
operator|||
name|tomin
operator|>
literal|59
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: invalid time [%s] at line %d!"
argument_list|,
operator|*
name|dt
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
return|return;
block|}
break|break;
block|}
elseif|else
if|if
condition|(
operator|(
operator|*
name|dt
operator|>=
literal|'0'
operator|)
operator|&&
operator|(
operator|*
name|dt
operator|<=
literal|'7'
operator|)
condition|)
block|{
comment|/* dt points to day spec */
name|day
operator||=
literal|1
operator|<<
operator|(
operator|*
name|dt
operator|-
literal|'0'
operator|)
expr_stmt|;
name|dt
operator|++
expr_stmt|;
continue|continue;
block|}
elseif|else
if|if
condition|(
operator|*
name|dt
operator|==
literal|','
condition|)
block|{
comment|/* dt points to delimiter */
name|dt
operator|++
expr_stmt|;
continue|continue;
block|}
elseif|else
if|if
condition|(
operator|*
name|dt
operator|==
literal|'\0'
condition|)
block|{
comment|/* dt points to end of string */
break|break;
block|}
else|else
block|{
comment|/* dt points to illegal character */
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"ERROR parsing config file: illegal character [%c=0x%x] in date/time spec at line %d!"
argument_list|,
operator|*
name|dt
argument_list|,
operator|*
name|dt
argument_list|,
name|lineno
argument_list|)
expr_stmt|;
name|config_error_flag
operator|++
expr_stmt|;
return|return;
block|}
block|}
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|day
operator|=
name|day
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|fromhr
operator|=
name|fromhr
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|frommin
operator|=
name|frommin
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|tohr
operator|=
name|tohr
expr_stmt|;
name|cfg_entry_tab
index|[
name|entrycount
index|]
operator|.
name|tomin
operator|=
name|tomin
expr_stmt|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	configuration validation and consistency check  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|check_config
parameter_list|(
name|void
parameter_list|)
block|{
name|cfg_entry_t
modifier|*
name|cep
init|=
operator|&
name|cfg_entry_tab
index|[
literal|0
index|]
decl_stmt|;
comment|/* ptr to config entry */
name|int
name|i
decl_stmt|;
name|int
name|error
init|=
literal|0
decl_stmt|;
comment|/* regular expression table */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_RE
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
operator|==
name|NULL
operator|)
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: regular expression %d without program!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
operator|==
name|NULL
operator|)
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: regular expression program %d without expression!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
block|}
comment|/* entry sections */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|entrycount
condition|;
name|i
operator|++
operator|,
name|cep
operator|++
control|)
block|{
comment|/* isdn controller number */
if|if
condition|(
operator|(
name|cep
operator|->
name|isdncontroller
operator|<
operator|-
literal|1
operator|)
operator|||
operator|(
name|cep
operator|->
name|isdncontroller
operator|>
operator|(
name|ncontroller
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: WARNING, isdncontroller out of range in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
comment|/* numbers used for dialout */
if|if
condition|(
operator|(
name|cep
operator|->
name|inout
operator|!=
name|DIR_INONLY
operator|)
operator|&&
operator|(
name|cep
operator|->
name|dialin_reaction
operator|!=
name|REACT_ANSWER
operator|)
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|remote_numbers_count
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: remote-phone-dialout not set in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|strlen
argument_list|(
name|cep
operator|->
name|local_phone_dialout
argument_list|)
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: local-phone-dialout not set in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
block|}
comment|/* numbers used for incoming calls */
if|if
condition|(
name|cep
operator|->
name|inout
operator|!=
name|DIR_OUTONLY
condition|)
block|{
if|if
condition|(
name|strlen
argument_list|(
name|cep
operator|->
name|local_phone_incoming
argument_list|)
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: local-phone-incoming not set in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|cep
operator|->
name|incoming_numbers_count
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: remote-phone-incoming not set in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|cep
operator|->
name|dialin_reaction
operator|==
name|REACT_ANSWER
operator|)
operator|&&
operator|(
name|cep
operator|->
name|b1protocol
operator|!=
name|BPROT_NONE
operator|)
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: b1protocol not raw for telephony in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_PAP
operator|)
operator|||
operator|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_CHAP
operator|)
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|ppp_send_name
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: no remote authentification name in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|cep
operator|->
name|ppp_send_password
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: no remote authentification password in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_PAP
operator|)
operator|||
operator|(
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_CHAP
operator|)
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|ppp_expect_name
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: no local authentification name in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|cep
operator|->
name|ppp_expect_password
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: no local authentification secret in entry %d!"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|error
operator|++
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|error
condition|)
block|{
name|log
argument_list|(
name|LL_ERR
argument_list|,
literal|"check_config: %d error(s) in configuration file, exit!"
argument_list|,
name|error
argument_list|)
expr_stmt|;
name|do_exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*  *	print the configuration  *---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
name|print_config
parameter_list|(
name|void
parameter_list|)
block|{
define|#
directive|define
name|PFILE
value|stdout
ifdef|#
directive|ifdef
name|I4B_EXTERNAL_MONITOR
specifier|extern
name|struct
name|monitor_rights
modifier|*
name|monitor_next_rights
argument_list|(
specifier|const
expr|struct
name|monitor_rights
operator|*
name|r
argument_list|)
decl_stmt|;
name|struct
name|monitor_rights
modifier|*
name|m_rights
decl_stmt|;
endif|#
directive|endif
name|cfg_entry_t
modifier|*
name|cep
init|=
operator|&
name|cfg_entry_tab
index|[
literal|0
index|]
decl_stmt|;
comment|/* ptr to config entry */
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|time_t
name|clock
decl_stmt|;
name|char
name|mytime
index|[
literal|64
index|]
decl_stmt|;
name|time
argument_list|(
operator|&
name|clock
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|mytime
argument_list|,
name|ctime
argument_list|(
operator|&
name|clock
argument_list|)
argument_list|)
expr_stmt|;
name|mytime
index|[
name|strlen
argument_list|(
name|mytime
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"#---------------------------------------------------------------------------\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"# system section (generated %s)\n"
argument_list|,
name|mytime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"#---------------------------------------------------------------------------\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"system\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"useacctfile     = %s\n"
argument_list|,
name|useacctfile
condition|?
literal|"on\t\t\t\t# update accounting information file"
else|:
literal|"off\t\t\t\t# don't update accounting information file"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"acctall         = %s\n"
argument_list|,
name|acct_all
condition|?
literal|"on\t\t\t\t# put all events into accounting file"
else|:
literal|"off\t\t\t\t# put only charged events into accounting file"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"acctfile        = %s\t\t# accounting information file\n"
argument_list|,
name|acctfile
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ratesfile       = %s\t\t# charging rates database file\n"
argument_list|,
name|ratesfile
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|USE_RTPRIO
if|if
condition|(
name|rt_prio
operator|==
name|RTPRIO_NOTUSED
condition|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"# rtprio is unused\n"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"rtprio          = %d\t\t\t\t# isdnd runs at realtime priority\n"
argument_list|,
name|rt_prio
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* regular expression table */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_RE
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"regexpr         = \"%s\"\t\t# scan logfile for this expression\n"
argument_list|,
name|rarr
index|[
name|i
index|]
operator|.
name|re_expr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"regprog         = %s\t\t# program to run when expression is matched\n"
argument_list|,
name|rarr
index|[
name|i
index|]
operator|.
name|re_prog
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|I4B_EXTERNAL_MONITOR
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"monitor-allowed = %s\n"
argument_list|,
name|do_monitor
condition|?
literal|"on\t\t\t\t# remote isdnd monitoring allowed"
else|:
literal|"off\t\t\t\t# remote isdnd monitoring disabled"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"monitor-port    = %d\t\t\t\t# TCP/IP port number used for remote monitoring\n"
argument_list|,
name|monitorport
argument_list|)
expr_stmt|;
name|m_rights
operator|=
name|monitor_next_rights
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_rights
operator|!=
name|NULL
condition|)
block|{
name|char
modifier|*
name|s
init|=
literal|"error\n"
decl_stmt|;
name|char
name|b
index|[
literal|512
index|]
decl_stmt|;
for|for
control|(
init|;
name|m_rights
operator|!=
name|NULL
condition|;
name|m_rights
operator|=
name|monitor_next_rights
argument_list|(
name|m_rights
argument_list|)
control|)
block|{
if|if
condition|(
name|m_rights
operator|->
name|local
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"monitor         = \"%s\"\t\t# local socket name for monitoring\n"
argument_list|,
name|m_rights
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|struct
name|in_addr
name|ia
decl_stmt|;
name|ia
operator|.
name|s_addr
operator|=
name|ntohl
argument_list|(
name|m_rights
operator|->
name|net
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|m_rights
operator|->
name|mask
condition|)
block|{
case|case
literal|0xffffffff
case|:
name|s
operator|=
literal|"32"
expr_stmt|;
break|break;
case|case
literal|0xfffffffe
case|:
name|s
operator|=
literal|"31"
expr_stmt|;
break|break;
case|case
literal|0xfffffffc
case|:
name|s
operator|=
literal|"30"
expr_stmt|;
break|break;
case|case
literal|0xfffffff8
case|:
name|s
operator|=
literal|"29"
expr_stmt|;
break|break;
case|case
literal|0xfffffff0
case|:
name|s
operator|=
literal|"28"
expr_stmt|;
break|break;
case|case
literal|0xffffffe0
case|:
name|s
operator|=
literal|"27"
expr_stmt|;
break|break;
case|case
literal|0xffffffc0
case|:
name|s
operator|=
literal|"26"
expr_stmt|;
break|break;
case|case
literal|0xffffff80
case|:
name|s
operator|=
literal|"25"
expr_stmt|;
break|break;
case|case
literal|0xffffff00
case|:
name|s
operator|=
literal|"24"
expr_stmt|;
break|break;
case|case
literal|0xfffffe00
case|:
name|s
operator|=
literal|"23"
expr_stmt|;
break|break;
case|case
literal|0xfffffc00
case|:
name|s
operator|=
literal|"22"
expr_stmt|;
break|break;
case|case
literal|0xfffff800
case|:
name|s
operator|=
literal|"21"
expr_stmt|;
break|break;
case|case
literal|0xfffff000
case|:
name|s
operator|=
literal|"20"
expr_stmt|;
break|break;
case|case
literal|0xffffe000
case|:
name|s
operator|=
literal|"19"
expr_stmt|;
break|break;
case|case
literal|0xffffc000
case|:
name|s
operator|=
literal|"18"
expr_stmt|;
break|break;
case|case
literal|0xffff8000
case|:
name|s
operator|=
literal|"17"
expr_stmt|;
break|break;
case|case
literal|0xffff0000
case|:
name|s
operator|=
literal|"16"
expr_stmt|;
break|break;
case|case
literal|0xfffe0000
case|:
name|s
operator|=
literal|"15"
expr_stmt|;
break|break;
case|case
literal|0xfffc0000
case|:
name|s
operator|=
literal|"14"
expr_stmt|;
break|break;
case|case
literal|0xfff80000
case|:
name|s
operator|=
literal|"13"
expr_stmt|;
break|break;
case|case
literal|0xfff00000
case|:
name|s
operator|=
literal|"12"
expr_stmt|;
break|break;
case|case
literal|0xffe00000
case|:
name|s
operator|=
literal|"11"
expr_stmt|;
break|break;
case|case
literal|0xffc00000
case|:
name|s
operator|=
literal|"10"
expr_stmt|;
break|break;
case|case
literal|0xff800000
case|:
name|s
operator|=
literal|"9"
expr_stmt|;
break|break;
case|case
literal|0xff000000
case|:
name|s
operator|=
literal|"8"
expr_stmt|;
break|break;
case|case
literal|0xfe000000
case|:
name|s
operator|=
literal|"7"
expr_stmt|;
break|break;
case|case
literal|0xfc000000
case|:
name|s
operator|=
literal|"6"
expr_stmt|;
break|break;
case|case
literal|0xf8000000
case|:
name|s
operator|=
literal|"5"
expr_stmt|;
break|break;
case|case
literal|0xf0000000
case|:
name|s
operator|=
literal|"4"
expr_stmt|;
break|break;
case|case
literal|0xe0000000
case|:
name|s
operator|=
literal|"3"
expr_stmt|;
break|break;
case|case
literal|0xc0000000
case|:
name|s
operator|=
literal|"2"
expr_stmt|;
break|break;
case|case
literal|0x80000000
case|:
name|s
operator|=
literal|"1"
expr_stmt|;
break|break;
case|case
literal|0x00000000
case|:
name|s
operator|=
literal|"0"
expr_stmt|;
break|break;
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"monitor         = \"%s/%s\"\t\t# host (net/mask) allowed to connect for monitoring\n"
argument_list|,
name|inet_ntoa
argument_list|(
name|ia
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
name|b
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_COMMAND_FULL
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"fullcmd,"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_COMMAND_RESTRICTED
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"restrictedcmd,"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_EVNT_CHANSTATE
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"channelstate,"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_EVNT_CALLIN
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"callin,"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_EVNT_CALLOUT
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"callout,"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|m_rights
operator|->
name|rights
operator|)
operator|&
name|I4B_CA_EVNT_I4B
condition|)
name|strcat
argument_list|(
name|b
argument_list|,
literal|"logevents,"
argument_list|)
expr_stmt|;
if|if
condition|(
name|b
index|[
name|strlen
argument_list|(
name|b
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|','
condition|)
name|b
index|[
name|strlen
argument_list|(
name|b
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"monitor-access  = %s\t\t# monitor access rights\n"
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* entry sections */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
name|entrycount
condition|;
name|i
operator|++
operator|,
name|cep
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"#---------------------------------------------------------------------------\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"# entry section %d\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"#---------------------------------------------------------------------------\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"entry\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"name                  = %s\t\t# name for this entry section\n"
argument_list|,
name|cep
operator|->
name|name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"isdncontroller        = %d\t\t# ISDN card number used for this entry\n"
argument_list|,
name|cep
operator|->
name|isdncontroller
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"isdnchannel           = "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|isdnchannel
condition|)
block|{
case|case
name|CHAN_ANY
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"-1\t\t# any ISDN B-channel may be used\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"%d\t\t# only ISDN B-channel %d may be used\n"
argument_list|,
name|cep
operator|->
name|isdnchannel
operator|+
literal|1
argument_list|,
name|cep
operator|->
name|isdnchannel
operator|+
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"usrdevicename         = %s\t\t# name of userland ISDN B-channel device\n"
argument_list|,
name|bdrivername
argument_list|(
name|cep
operator|->
name|usrdevicename
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"usrdeviceunit         = %d\t\t# unit number of userland ISDN B-channel device\n"
argument_list|,
name|cep
operator|->
name|usrdeviceunit
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"b1protocol            = %s\n"
argument_list|,
name|cep
operator|->
name|b1protocol
condition|?
literal|"hdlc\t\t# B-channel layer 1 protocol is HDLC"
else|:
literal|"raw\t\t# No B-channel layer 1 protocol used"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"direction             = "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|inout
condition|)
block|{
case|case
name|DIR_INONLY
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"in\t\t# only incoming connections allowed\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIR_OUTONLY
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"out\t\t# only outgoing connections allowed\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIR_INOUT
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"inout\t\t# incoming and outgoing connections allowed\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
operator|(
operator|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
operator|)
operator|||
operator|(
name|cep
operator|->
name|inout
operator|==
name|DIR_INONLY
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|remote_numbers_count
operator|>
literal|1
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|cep
operator|->
name|remote_numbers_count
condition|;
name|j
operator|++
control|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"remote-phone-dialout  = %s\t\t# telephone number %d for dialing out to remote\n"
argument_list|,
name|cep
operator|->
name|remote_numbers
index|[
name|j
index|]
operator|.
name|number
argument_list|,
name|j
operator|+
literal|1
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"remdial-handling      = "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|remote_numbers_handling
condition|)
block|{
case|case
name|RNH_NEXT
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"next\t\t# use next number after last successfull for new dial\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|RNH_LAST
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"last\t\t# use last successfull number for new dial\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|RNH_FIRST
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"first\t\t# always start with first number for new dial\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"remote-phone-dialout  = %s\t\t# telephone number for dialing out to remote\n"
argument_list|,
name|cep
operator|->
name|remote_numbers
index|[
literal|0
index|]
operator|.
name|number
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"local-phone-dialout   = %s\t\t# show this number to remote when dialling out\n"
argument_list|,
name|cep
operator|->
name|local_phone_dialout
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"dialout-type          = %s\n"
argument_list|,
name|cep
operator|->
name|dialouttype
condition|?
literal|"calledback\t\t# i am called back by remote"
else|:
literal|"normal\t\t# i am not called back by remote"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|inout
operator|==
name|DIR_OUTONLY
operator|)
condition|)
block|{
name|int
name|n
decl_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"local-phone-incoming  = %s\t\t# incoming calls must match this (mine) telephone number\n"
argument_list|,
name|cep
operator|->
name|local_phone_incoming
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|cep
operator|->
name|incoming_numbers_count
condition|;
name|n
operator|++
control|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"remote-phone-incoming = %s\t\t# this is a valid remote number to call me\n"
argument_list|,
name|cep
operator|->
name|remote_phone_incoming
index|[
name|n
index|]
operator|.
name|number
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"dialin-reaction       = "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|dialin_reaction
condition|)
block|{
case|case
name|REACT_ACCEPT
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"accept\t\t# i accept a call from remote and connect\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|REACT_REJECT
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"reject\t\t# i reject the call from remote\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|REACT_IGNORE
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ignore\t\t# i ignore the call from remote\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|REACT_ANSWER
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"answer\t\t# i will start telephone answering when remote calls in\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|REACT_CALLBACK
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"callback\t\t# when remote calls in, i will hangup and call back\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_ISPPP
condition|)
block|{
name|char
modifier|*
name|s
decl_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|ppp_expect_auth
condition|)
block|{
case|case
name|AUTH_NONE
case|:
name|s
operator|=
literal|"none"
expr_stmt|;
break|break;
case|case
name|AUTH_PAP
case|:
name|s
operator|=
literal|"pap"
expr_stmt|;
break|break;
case|case
name|AUTH_CHAP
case|:
name|s
operator|=
literal|"chap"
expr_stmt|;
break|break;
default|default:
name|s
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|s
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-expect-auth       = %s\t\t# the auth protocol we expect to receive on dial-in (none,pap,chap)\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|ppp_expect_auth
operator|!=
name|AUTH_NONE
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-expect-name       = %s\t\t# the user name allowed in\n"
argument_list|,
name|cep
operator|->
name|ppp_expect_name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-expect-password   = %s\t\t# the key expected from the other side\n"
argument_list|,
name|cep
operator|->
name|ppp_expect_password
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-auth-paranoid     = %s\t\t# do we require remote to authenticate even if we dial out\n"
argument_list|,
name|cep
operator|->
name|ppp_auth_flags
operator|&
name|AUTH_REQUIRED
condition|?
literal|"yes"
else|:
literal|"no"
argument_list|)
expr_stmt|;
block|}
block|}
switch|switch
condition|(
name|cep
operator|->
name|ppp_send_auth
condition|)
block|{
case|case
name|AUTH_NONE
case|:
name|s
operator|=
literal|"none"
expr_stmt|;
break|break;
case|case
name|AUTH_PAP
case|:
name|s
operator|=
literal|"pap"
expr_stmt|;
break|break;
case|case
name|AUTH_CHAP
case|:
name|s
operator|=
literal|"chap"
expr_stmt|;
break|break;
default|default:
name|s
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|s
operator|!=
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-send-auth         = %s\t\t# the auth protocol we use when dialing out (none,pap,chap)\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|ppp_send_auth
operator|!=
name|AUTH_NONE
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-send-name         = %s\t\t# our PPP account used for dial-out\n"
argument_list|,
name|cep
operator|->
name|ppp_send_name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-send-password     = %s\t\t# the key sent to the other side\n"
argument_list|,
name|cep
operator|->
name|ppp_send_password
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|cep
operator|->
name|ppp_send_auth
operator|==
name|AUTH_CHAP
operator|||
name|cep
operator|->
name|ppp_expect_auth
operator|==
name|AUTH_CHAP
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ppp-auth-rechallenge   = %s\t\t# rechallenge CHAP connections once in a while\n"
argument_list|,
name|cep
operator|->
name|ppp_auth_flags
operator|&
name|AUTH_RECHALLENGE
condition|?
literal|"yes"
else|:
literal|"no"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
operator|(
operator|(
name|cep
operator|->
name|inout
operator|==
name|DIR_INONLY
operator|)
operator|||
operator|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
operator|)
operator|)
condition|)
block|{
name|char
modifier|*
name|s
decl_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"idletime-outgoing     = %d\t\t# outgoing call idle timeout\n"
argument_list|,
name|cep
operator|->
name|idle_time_out
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|shorthold_algorithm
condition|)
block|{
case|case
name|SHA_FIXU
case|:
name|s
operator|=
literal|"fix-unit-size"
expr_stmt|;
break|break;
case|case
name|SHA_VARU
case|:
name|s
operator|=
literal|"var-unit-size"
expr_stmt|;
break|break;
default|default:
name|s
operator|=
literal|"error!!!"
expr_stmt|;
break|break;
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"idle-algorithm-outgoing     = %s\t\t# outgoing call idle algorithm\n"
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|inout
operator|==
name|DIR_OUTONLY
operator|)
condition|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"idletime-incoming     = %d\t\t# incoming call idle timeout\n"
argument_list|,
name|cep
operator|->
name|idle_time_in
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"unitlengthsrc         = "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|cep
operator|->
name|unitlengthsrc
condition|)
block|{
case|case
name|ULSRC_NONE
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"none\t\t# no unit length specified, using default\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ULSRC_CMDL
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"cmdl\t\t# using unit length specified on commandline\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ULSRC_CONF
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"conf\t\t# using unitlength specified by unitlength-keyword\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"unitlength            = %d\t\t# fixed unitlength\n"
argument_list|,
name|cep
operator|->
name|unitlength
argument_list|)
expr_stmt|;
break|break;
case|case
name|ULSRC_RATE
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"rate\t\t# using unitlength specified in rate database\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ratetype              = %d\t\t# type of rate from rate database\n"
argument_list|,
name|cep
operator|->
name|ratetype
argument_list|)
expr_stmt|;
break|break;
case|case
name|ULSRC_DYN
case|:
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"aocd\t\t# using dynamically calculated unitlength based on AOCD subscription\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"ratetype              = %d\t\t# type of rate from rate database\n"
argument_list|,
name|cep
operator|->
name|ratetype
argument_list|)
expr_stmt|;
break|break;
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"earlyhangup           = %d\t\t# early hangup safety time\n"
argument_list|,
name|cep
operator|->
name|earlyhangup
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"answerprog            = %s\t\t# program used to answer incoming telephone calls\n"
argument_list|,
name|cep
operator|->
name|answerprog
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"alert                 = %d\t\t# number of seconds to wait before accepting a call\n"
argument_list|,
name|cep
operator|->
name|alert
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|usrdevicename
operator|==
name|BDRV_TEL
operator|)
condition|)
block|{
if|if
condition|(
name|cep
operator|->
name|dialin_reaction
operator|==
name|REACT_CALLBACK
condition|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"callbackwait          = %d\t\t# i am waiting this time before calling back remote\n"
argument_list|,
name|cep
operator|->
name|callbackwait
argument_list|)
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|dialouttype
operator|==
name|DIALOUT_CALLEDBACK
condition|)
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"calledbackwait        = %d\t\t# i am waiting this time for a call back from remote\n"
argument_list|,
name|cep
operator|->
name|calledbackwait
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|cep
operator|->
name|inout
operator|==
name|DIR_INONLY
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"dialretries           = %d\t\t# number of dialing retries\n"
argument_list|,
name|cep
operator|->
name|dialretries
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"recoverytime          = %d\t\t# time to wait between dialling retries\n"
argument_list|,
name|cep
operator|->
name|recoverytime
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"dialrandincr          = %s\t\t# use random dialing time addon\n"
argument_list|,
name|cep
operator|->
name|dialrandincr
condition|?
literal|"on"
else|:
literal|"off"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"usedown               = %s\n"
argument_list|,
name|cep
operator|->
name|usedown
condition|?
literal|"on\t\t# ISDN device switched off on excessive dial failures"
else|:
literal|"off\t\t# no device switchoff on excessive dial failures"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cep
operator|->
name|usedown
condition|)
block|{
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"downtries             = %d\t\t# number of dialretries failures before switching off\n"
argument_list|,
name|cep
operator|->
name|downtries
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"downtime              = %d\t\t# time device is switched off\n"
argument_list|,
name|cep
operator|->
name|downtime
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
name|fprintf
argument_list|(
name|PFILE
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* EOF */
end_comment

end_unit

