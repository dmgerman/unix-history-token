begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *       Copyright (c) 1997 by Simon Shapiro  *       All Rights Reserved  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions, and the following disclaimer,  *    without modification, immediately at the beginning of the file.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. The name of the author may not be used to endorse or promote products  *    derived from this software without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  *  */
end_comment

begin_comment
comment|/* dpt_sig.c:  Dunp a DPT Signature */
end_comment

begin_empty
empty|#ident "$FreeBSD$"
end_empty

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<scsi/scsi_all.h>
end_include

begin_include
include|#
directive|include
file|<scsi/scsi_message.h>
end_include

begin_include
include|#
directive|include
file|<scsi/scsiconf.h>
end_include

begin_define
define|#
directive|define
name|DPT_MEASURE_PERFORMANCE
end_define

begin_include
include|#
directive|include
file|<sys/dpt.h>
end_include

begin_comment
comment|/* A primitive subset of isgraph.	Used by hex_dump below */
end_comment

begin_define
define|#
directive|define
name|IsGraph
parameter_list|(
name|val
parameter_list|)
value|( (((val)>= ' ')&& ((val)<= '~')) )
end_define

begin_comment
comment|/*  * This function dumps bytes to the screen in hex format.  */
end_comment

begin_function
name|void
name|hex_dump
parameter_list|(
name|u_int8_t
modifier|*
name|data
parameter_list|,
name|int
name|length
parameter_list|,
name|char
modifier|*
name|name
parameter_list|,
name|int
name|no
parameter_list|)
block|{
name|int
name|line
decl_stmt|,
name|column
decl_stmt|,
name|ndx
decl_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Kernel Hex Dump for %s-%d at %p (%d bytes)\n"
argument_list|,
name|name
argument_list|,
name|no
argument_list|,
name|data
argument_list|,
name|length
argument_list|)
expr_stmt|;
comment|/* Zero out all the counters and repeat for as many bytes as we have */
for|for
control|(
name|ndx
operator|=
literal|0
operator|,
name|column
operator|=
literal|0
operator|,
name|line
operator|=
literal|0
init|;
name|ndx
operator|<
name|length
condition|;
name|ndx
operator|++
control|)
block|{
comment|/* Print relative offset at the beginning of every line */
if|if
condition|(
name|column
operator|==
literal|0
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%04x "
argument_list|,
name|ndx
argument_list|)
expr_stmt|;
comment|/* Print the byte as two hex digits, followed by a space */
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%02x "
argument_list|,
name|data
index|[
name|ndx
index|]
argument_list|)
expr_stmt|;
comment|/* Split the row of 16 bytes in half */
if|if
condition|(
operator|++
name|column
operator|==
literal|8
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
block|}
comment|/* St the end of each row of 16 bytes, put a space ... */
if|if
condition|(
name|column
operator|==
literal|16
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"	"
argument_list|)
expr_stmt|;
comment|/* ... and then print the ASCII-visible on a line. */
for|for
control|(
name|column
operator|=
literal|0
init|;
name|column
operator|<
literal|16
condition|;
name|column
operator|++
control|)
block|{
name|int
name|ascii_pos
init|=
name|ndx
operator|-
literal|15
operator|+
name|column
decl_stmt|;
comment|/* 				 * Non-printable and non-ASCII are just a 				 * dot. ;-( 				 */
if|if
condition|(
name|IsGraph
argument_list|(
name|data
index|[
name|ascii_pos
index|]
argument_list|)
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%c"
argument_list|,
name|data
index|[
name|ascii_pos
index|]
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
comment|/* Each line ends with a new line */
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|column
operator|=
literal|0
expr_stmt|;
comment|/* 			 * Every 256 bytes (16 lines of 16 bytes each) have 			 * an empty line, separating them from the next 			 * ``page''. Yes, I programmed on a Z-80, where a 			 * page was 256 bytes :-) 			 */
if|if
condition|(
operator|++
name|line
operator|>
literal|15
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|line
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
comment|/*      * We are basically done. We do want, however, to handle the ASCII      * translation of fractional lines.      */
if|if
condition|(
operator|(
name|ndx
operator|==
name|length
operator|)
operator|&&
operator|(
name|column
operator|!=
literal|0
operator|)
condition|)
block|{
name|int
name|modulus
init|=
literal|16
operator|-
name|column
decl_stmt|,
name|spaces
init|=
name|modulus
operator|*
literal|3
decl_stmt|,
name|skip
decl_stmt|;
comment|/* 		 * Skip to the right, as many spaces as there are bytes 		 * ``missing'' ... 		 */
for|for
control|(
name|skip
operator|=
literal|0
init|;
name|skip
operator|<
name|spaces
condition|;
name|skip
operator|++
control|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
comment|/* ... And the gap separating the hex dump from the ASCII */
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"  "
argument_list|)
expr_stmt|;
comment|/* 		 * Do not forget the extra space that splits the hex dump 		 * vertically 		 */
if|if
condition|(
name|column
operator|<
literal|8
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|" "
argument_list|)
expr_stmt|;
for|for
control|(
name|column
operator|=
literal|0
init|;
name|column
operator|<
operator|(
literal|16
operator|-
name|modulus
operator|)
condition|;
name|column
operator|++
control|)
block|{
name|int
name|ascii_pos
init|=
name|ndx
operator|-
operator|(
literal|16
operator|-
name|modulus
operator|)
operator|+
name|column
decl_stmt|;
if|if
condition|(
name|IsGraph
argument_list|(
name|data
index|[
name|ascii_pos
index|]
argument_list|)
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%c"
argument_list|,
name|data
index|[
name|ascii_pos
index|]
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"."
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|,
name|char
modifier|*
modifier|*
name|argp
parameter_list|)
block|{
name|eata_pt_t
name|pass_thru
decl_stmt|;
name|dpt_sig_t
name|signature
decl_stmt|;
name|char
modifier|*
name|sp1
decl_stmt|;
name|char
modifier|*
name|sp2
decl_stmt|;
name|int
name|result
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|int
name|ndx
decl_stmt|;
comment|/* If we do not do that, gcc complains about uninitialized usage (?) */
name|sp1
operator|=
literal|"Unknown"
expr_stmt|;
name|sp2
operator|=
literal|"Unknown"
expr_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
name|O_RDWR
argument_list|,
name|S_IRUSR
operator||
name|S_IWUSR
argument_list|)
operator|)
operator|==
operator|-
literal|1
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s ERROR:  Failed to open \"%s\" "
literal|"- %s\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|pass_thru
operator|.
name|eataID
index|[
literal|0
index|]
operator|=
literal|'E'
expr_stmt|;
name|pass_thru
operator|.
name|eataID
index|[
literal|1
index|]
operator|=
literal|'A'
expr_stmt|;
name|pass_thru
operator|.
name|eataID
index|[
literal|2
index|]
operator|=
literal|'T'
expr_stmt|;
name|pass_thru
operator|.
name|eataID
index|[
literal|3
index|]
operator|=
literal|'A'
expr_stmt|;
name|pass_thru
operator|.
name|command
operator|=
name|DPT_SIGNATURE
expr_stmt|;
name|pass_thru
operator|.
name|command_buffer
operator|=
operator|(
name|u_int8_t
operator|*
operator|)
operator|&
name|signature
expr_stmt|;
if|if
condition|(
operator|(
name|result
operator|=
name|ioctl
argument_list|(
name|fd
argument_list|,
name|DPT_IOCTL_SEND
argument_list|,
operator|&
name|pass_thru
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s ERROR:  Failed to send IOCTL "
literal|"%lx - %s\n"
argument_list|,
name|argv
index|[
literal|0
index|]
argument_list|,
name|DPT_IOCTL_SEND
argument_list|,
name|strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/* dsSignature is not null terminated! */
for|for
control|(
name|ndx
operator|=
literal|0
init|;
name|ndx
operator|<
sizeof|sizeof
argument_list|(
name|signature
operator|.
name|dsSignature
argument_list|)
condition|;
name|ndx
operator|++
control|)
operator|(
name|void
operator|)
name|fputc
argument_list|(
name|signature
operator|.
name|dsSignature
index|[
name|ndx
index|]
argument_list|,
name|stdout
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|":%x:"
argument_list|,
name|signature
operator|.
name|SigVersion
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|signature
operator|.
name|ProcessorFamily
condition|)
block|{
case|case
name|PROC_INTEL
case|:
name|sp1
operator|=
literal|"Intel"
expr_stmt|;
switch|switch
condition|(
name|signature
operator|.
name|Processor
condition|)
block|{
case|case
name|PROC_8086
case|:
name|sp2
operator|=
literal|"8086"
expr_stmt|;
break|break;
case|case
name|PROC_286
case|:
name|sp2
operator|=
literal|"80286"
expr_stmt|;
break|break;
case|case
name|PROC_386
case|:
name|sp2
operator|=
literal|"386"
expr_stmt|;
break|break;
case|case
name|PROC_486
case|:
name|sp2
operator|=
literal|"486"
expr_stmt|;
break|break;
case|case
name|PROC_PENTIUM
case|:
name|sp2
operator|=
literal|"Pentium"
expr_stmt|;
break|break;
case|case
name|PROC_P6
case|:
name|sp2
operator|=
literal|"PentiumPro"
expr_stmt|;
break|break;
default|default:
name|sp2
operator|=
literal|"Unknown Processor"
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|PROC_MOTOROLA
case|:
name|sp1
operator|=
literal|"Motorola"
expr_stmt|;
switch|switch
condition|(
name|signature
operator|.
name|Processor
condition|)
block|{
case|case
name|PROC_68000
case|:
name|sp2
operator|=
literal|"68000"
expr_stmt|;
break|break;
case|case
name|PROC_68020
case|:
name|sp2
operator|=
literal|"68020"
expr_stmt|;
break|break;
case|case
name|PROC_68030
case|:
name|sp2
operator|=
literal|"68030"
expr_stmt|;
break|break;
case|case
name|PROC_68040
case|:
name|sp2
operator|=
literal|"68040"
expr_stmt|;
break|break;
default|default:
name|sp2
operator|=
literal|"Unknown Processor"
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|PROC_MIPS4000
case|:
name|sp1
operator|=
literal|"MIPS/SGI"
expr_stmt|;
break|break;
case|case
name|PROC_ALPHA
case|:
name|sp1
operator|=
literal|"DEC Alpha"
expr_stmt|;
break|break;
default|default:
name|sp1
operator|=
literal|"Unknown Processor Family"
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%s:%s:"
argument_list|,
name|sp1
argument_list|,
name|sp2
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|signature
operator|.
name|Filetype
condition|)
block|{
case|case
name|FT_EXECUTABLE
case|:
name|sp1
operator|=
literal|"Executable"
expr_stmt|;
break|break;
case|case
name|FT_SCRIPT
case|:
name|sp1
operator|=
literal|"Script"
expr_stmt|;
break|break;
case|case
name|FT_HBADRVR
case|:
name|sp1
operator|=
literal|"HBA Driver"
expr_stmt|;
break|break;
case|case
name|FT_OTHERDRVR
case|:
name|sp1
operator|=
literal|"Other Driver"
expr_stmt|;
break|break;
case|case
name|FT_IFS
case|:
name|sp1
operator|=
literal|"Installable FileSystem"
expr_stmt|;
break|break;
case|case
name|FT_ENGINE
case|:
name|sp1
operator|=
literal|"DPT Engine"
expr_stmt|;
break|break;
case|case
name|FT_COMPDRVR
case|:
name|sp1
operator|=
literal|"Compressed Driver"
expr_stmt|;
break|break;
case|case
name|FT_LANGUAGE
case|:
name|sp1
operator|=
literal|"Language File"
expr_stmt|;
break|break;
case|case
name|FT_FIRMWARE
case|:
name|sp1
operator|=
literal|"DownLoadable Firmware"
expr_stmt|;
break|break;
case|case
name|FT_COMMMODL
case|:
name|sp1
operator|=
literal|"Communications Module"
expr_stmt|;
break|break;
case|case
name|FT_INT13
case|:
name|sp1
operator|=
literal|"INT13 Type HBA Driver"
expr_stmt|;
break|break;
case|case
name|FT_HELPFILE
case|:
name|sp1
operator|=
literal|"Help File"
expr_stmt|;
break|break;
case|case
name|FT_LOGGER
case|:
name|sp1
operator|=
literal|"Event Logger"
expr_stmt|;
break|break;
case|case
name|FT_INSTALL
case|:
name|sp1
operator|=
literal|"Installation Procedure"
expr_stmt|;
break|break;
case|case
name|FT_LIBRARY
case|:
name|sp1
operator|=
literal|"Storage Manager Real-Mode Call"
expr_stmt|;
break|break;
case|case
name|FT_RESOURCE
case|:
name|sp1
operator|=
literal|"Storage Manager Resource File"
expr_stmt|;
break|break;
case|case
name|FT_MODEM_DB
case|:
name|sp1
operator|=
literal|"Storage Manager Modem Database"
expr_stmt|;
break|break;
default|default:
name|sp1
operator|=
literal|"Unknown File Type"
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|signature
operator|.
name|FiletypeFlags
condition|)
block|{
case|case
name|FTF_DLL
case|:
name|sp2
operator|=
literal|"Dynamically Linked Library"
expr_stmt|;
break|break;
case|case
name|FTF_NLM
case|:
name|sp2
operator|=
literal|"NetWare Loadable Module"
expr_stmt|;
break|break;
case|case
name|FTF_OVERLAYS
case|:
name|sp2
operator|=
literal|"Uses Overlays"
expr_stmt|;
break|break;
case|case
name|FTF_DEBUG
case|:
name|sp2
operator|=
literal|"Debug Version"
expr_stmt|;
break|break;
case|case
name|FTF_TSR
case|:
name|sp2
operator|=
literal|"DOS Terminate-n-Stay Resident Thing"
expr_stmt|;
break|break;
case|case
name|FTF_SYS
case|:
name|sp2
operator|=
literal|"DOS Loadable Driver"
expr_stmt|;
break|break;
case|case
name|FTF_PROTECTED
case|:
name|sp2
operator|=
literal|"Runs in Protected Mode"
expr_stmt|;
break|break;
case|case
name|FTF_APP_SPEC
case|:
name|sp2
operator|=
literal|"Application Specific"
expr_stmt|;
break|break;
default|default:
name|sp2
operator|=
literal|"Unknown File Type Flag"
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%s:%s:"
argument_list|,
name|sp1
argument_list|,
name|sp2
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|signature
operator|.
name|OEM
condition|)
block|{
case|case
name|OEM_DPT
case|:
name|sp1
operator|=
literal|"DPT"
expr_stmt|;
break|break;
case|case
name|OEM_ATT
case|:
name|sp1
operator|=
literal|"AT&T"
expr_stmt|;
break|break;
case|case
name|OEM_NEC
case|:
name|sp1
operator|=
literal|"NEC"
expr_stmt|;
break|break;
case|case
name|OEM_ALPHA
case|:
name|sp1
operator|=
literal|"Alphatronix"
expr_stmt|;
break|break;
case|case
name|OEM_AST
case|:
name|sp1
operator|=
literal|"AST"
expr_stmt|;
break|break;
case|case
name|OEM_OLIVETTI
case|:
name|sp1
operator|=
literal|"Olivetti"
expr_stmt|;
break|break;
case|case
name|OEM_SNI
case|:
name|sp1
operator|=
literal|"Siemens/Nixdorf"
expr_stmt|;
break|break;
default|default:
name|sp1
operator|=
literal|"Unknown OEM"
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|signature
operator|.
name|OS
condition|)
block|{
case|case
name|OS_DOS
case|:
name|sp2
operator|=
literal|"DOS"
expr_stmt|;
break|break;
case|case
name|OS_WINDOWS
case|:
name|sp2
operator|=
literal|"Microsoft Windows 3.x"
expr_stmt|;
break|break;
case|case
name|OS_WINDOWS_NT
case|:
name|sp2
operator|=
literal|"Microsoft Windows NT"
expr_stmt|;
break|break;
case|case
name|OS_OS2M
case|:
name|sp2
operator|=
literal|"OS/2 1.2.x,MS 1.3.0,IBM 1.3.x"
expr_stmt|;
break|break;
case|case
name|OS_OS2L
case|:
name|sp2
operator|=
literal|"Microsoft OS/2 1.301 - LADDR"
expr_stmt|;
break|break;
case|case
name|OS_OS22x
case|:
name|sp2
operator|=
literal|"IBM OS/2 2.x"
expr_stmt|;
break|break;
case|case
name|OS_NW286
case|:
name|sp2
operator|=
literal|"Novell NetWare 286"
expr_stmt|;
break|break;
case|case
name|OS_NW386
case|:
name|sp2
operator|=
literal|"Novell NetWare 386"
expr_stmt|;
break|break;
case|case
name|OS_GEN_UNIX
case|:
name|sp2
operator|=
literal|"Generic Unix"
expr_stmt|;
break|break;
case|case
name|OS_SCO_UNIX
case|:
name|sp2
operator|=
literal|"SCO Unix"
expr_stmt|;
break|break;
case|case
name|OS_ATT_UNIX
case|:
name|sp2
operator|=
literal|"AT&T Unix"
expr_stmt|;
break|break;
case|case
name|OS_UNIXWARE
case|:
name|sp2
operator|=
literal|"UnixWare Unix"
expr_stmt|;
break|break;
case|case
name|OS_INT_UNIX
case|:
name|sp2
operator|=
literal|"Interactive Unix"
expr_stmt|;
break|break;
case|case
name|OS_SOLARIS
case|:
name|sp2
operator|=
literal|"SunSoft Solaris"
expr_stmt|;
break|break;
case|case
name|OS_QNX
case|:
name|sp2
operator|=
literal|"QNX for Tom Moch"
expr_stmt|;
break|break;
case|case
name|OS_NEXTSTEP
case|:
name|sp2
operator|=
literal|"NeXTSTEP"
expr_stmt|;
break|break;
case|case
name|OS_BANYAN
case|:
name|sp2
operator|=
literal|"Banyan Vines"
expr_stmt|;
break|break;
case|case
name|OS_OLIVETTI_UNIX
case|:
name|sp2
operator|=
literal|"Olivetti Unix"
expr_stmt|;
break|break;
case|case
name|OS_FREEBSD
case|:
name|sp2
operator|=
literal|"FreeBSD 2.2 and later"
expr_stmt|;
break|break;
case|case
name|OS_OTHER
case|:
name|sp2
operator|=
literal|"Other"
expr_stmt|;
break|break;
default|default:
name|sp2
operator|=
literal|"Unknown O/S"
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%s:%s:\n"
argument_list|,
name|sp1
argument_list|,
name|sp2
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_RAID0
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"RAID-0:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_RAID1
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"RAID-1:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_RAID3
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"RAID-3:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_RAID5
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"RAID-5:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_SPAN
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SPAN:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_PASS
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PASS:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_OVERLAP
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"OVERLAP:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_ASPI
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ASPI:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_ABOVE16MB
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ISA16MB:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Capabilities
operator|&
name|CAP_EXTEND
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ISA16MB:"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_DASD
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"DASD:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_TAPE
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Tape:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_PRINTER
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Printer:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_PROC
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"CPU:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_WORM
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"WORM:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_CDROM
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"CDROM:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_SCANNER
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Scanner:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_OPTICAL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Optical:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_JUKEBOX
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Jukebox:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_COMM
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Comm:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_OTHER
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Other:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|DeviceSupp
operator|&
name|DEV_ALL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"All:"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_2001
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2001:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_2012A
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2012A:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_PLUS_ISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2011+PM2021:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_PLUS_EISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2012B+PM2022:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC3_ISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2021:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC3_EISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"PM2022+PM2122:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC3_PCI
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SmartCache III PCI:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC4_ISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SmartCache IV ISA:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC4_EISA
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SmartCache IV EISA:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_SC4_PCI
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SmartCache IV PCI:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_ALL_MASTER
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"All Bus Mastering:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_ALL_CACHE
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"All Caching:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|AdapterSupp
operator|&
name|ADF_ALL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"All HBAs:"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_DPTMGR
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"DPTMGR:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_ENGINE
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Engine:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_SYTOS
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Systron Sytos Plus:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_CHEYENNE
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Cheyenne ARCServe + ARCSolo:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_MSCDEX
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Microsoft CD-ROM extensions:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_NOVABACK
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"NovaStor Novaback:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Application
operator|&
name|APP_AIM
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"Archive Information Manager:"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_SMARTROM
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"SmartROM:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_DPTDDL
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"DPTDDL.SYS:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_HBA_DRIVER
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"HBA Driver:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_ASPI_TRAN
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"ASPI Transport Modules:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_ENGINE
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"DPT Engine:"
argument_list|)
expr_stmt|;
if|if
condition|(
name|signature
operator|.
name|Requirements
operator|&
name|REQ_COMM_ENG
condition|)
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"DPT Comm Engine:"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stdout
argument_list|,
literal|"%x.%x.%x:%d.%d.%d\n"
argument_list|,
name|signature
operator|.
name|Version
argument_list|,
name|signature
operator|.
name|Revision
argument_list|,
name|signature
operator|.
name|SubRevision
argument_list|,
name|signature
operator|.
name|Month
argument_list|,
name|signature
operator|.
name|Day
argument_list|,
name|signature
operator|.
name|Year
operator|+
literal|1980
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

