begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**************************************************************************  Copyright (c) 2007, Chelsio Inc. All rights reserved.  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:   1. Redistributions of source code must retain the above copyright notice,     this list of conditions and the following disclaimer.   2. Redistributions in binary form must reproduce the above copyright     notice, this list of conditions and the following disclaimer in the     documentation and/or other materials provided with the distribution.   3. Neither the name of the Chelsio Corporation nor the names of its     contributors may be used to endorse or promote products derived from     this software without specific prior written permission.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.   ***************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<inttypes.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_include
include|#
directive|include
file|<net/if.h>
end_include

begin_include
include|#
directive|include
file|<net/if_var.h>
end_include

begin_include
include|#
directive|include
file|<net/if_types.h>
end_include

begin_define
define|#
directive|define
name|NMTUS
value|16
end_define

begin_define
define|#
directive|define
name|TCB_SIZE
value|128
end_define

begin_define
define|#
directive|define
name|TCB_WORDS
value|(TCB_SIZE / 4)
end_define

begin_define
define|#
directive|define
name|PROTO_SRAM_LINES
value|128
end_define

begin_define
define|#
directive|define
name|PROTO_SRAM_LINE_BITS
value|132
end_define

begin_define
define|#
directive|define
name|PROTO_SRAM_LINE_NIBBLES
value|(132 / 4)
end_define

begin_define
define|#
directive|define
name|PROTO_SRAM_SIZE
value|(PROTO_SRAM_LINE_NIBBLES * PROTO_SRAM_LINES / 2)
end_define

begin_define
define|#
directive|define
name|PROTO_SRAM_EEPROM_ADDR
value|4096
end_define

begin_include
include|#
directive|include
file|<cxgb3_ioctl.h>
end_include

begin_include
include|#
directive|include
file|<common/cxgb3_regs.h>
end_include

begin_include
include|#
directive|include
file|"version.h"
end_include

begin_struct
struct|struct
name|reg_info
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
name|uint16_t
name|addr
decl_stmt|;
name|uint16_t
name|len
decl_stmt|;
block|}
struct|;
end_struct

begin_include
include|#
directive|include
file|"reg_defs.c"
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CONFIG_T3_REGS
argument_list|)
end_if

begin_include
include|#
directive|include
file|"reg_defs_t3.c"
end_include

begin_include
include|#
directive|include
file|"reg_defs_t3b.c"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|progname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|__attribute__
argument_list|(
operator|(
name|noreturn
operator|)
argument_list|)
name|usage
argument_list|(
name|FILE
operator|*
name|fp
argument_list|)
block|{
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Usage: %s<interface> [operation]\n"
argument_list|,
name|progname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
literal|"\treg<address>[=<val>]               read/write register\n"
literal|"\ttpi<address>[=<val>]               read/write TPI register\n"
literal|"\tmdio<phy_addr><mmd_addr>\n"
literal|"\t<reg_addr> [<val>]             read/write MDIO register\n"
endif|#
directive|endif
literal|"\tmtus [<mtu0>...<mtuN>]              read/write MTU table\n"
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
literal|"\tpm [<TX page spec><RX page spec>]  read/write PM config\n"
literal|"\ttcam [<#serv><#routes><#filters>] read/write TCAM config\n"
literal|"\ttcb<index>                         read TCB\n"
endif|#
directive|endif
literal|"\tregdump [<module>]                  dump registers\n"
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
literal|"\ttcamdump<address><count>          show TCAM contents\n"
literal|"\tcontext<type><id>                 show an SGE context\n"
literal|"\tdesc<qset><queue><idx> [<cnt>]   dump SGE descriptors\n"
literal|"\tmemdump cm|tx|rx<addr><len>       dump a mem range\n"
literal|"\tmeminfo                             show memory info\n"
endif|#
directive|endif
literal|"\tup                                  activate TOE\n"
literal|"\tproto [<protocol image>]            read/write proto SRAM\n"
literal|"\tloadfw<FW image>                   download firmware\n"
literal|"\tqset [<index> [<param><val>] ...]  read/write qset parameters\n"
literal|"\tqsets [<# of qsets>]                read/write # of qsets\n"
literal|"\ttrace tx|rx|all on|off [not]\n"
literal|"\t      [<param><val>[:<mask>]] ...  write trace parameters\n"
literal|"\tt1powersave [on|off]                enable/disable T1xx powersave mode\n"
literal|"\tpktsched port<idx><min><max>     set TX port scheduler params\n"
literal|"\tpktsched tunnelq<idx><max>\n"
literal|"\t<binding>                  set TX tunnelq scheduler params\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|fp
operator|==
name|stderr
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_decl_stmt

begin_comment
comment|/*  * Make a TOETOOL ioctl call.  */
end_comment

begin_function
specifier|static
name|int
name|doit
parameter_list|(
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|,
name|unsigned
name|long
name|cmd
parameter_list|,
name|void
modifier|*
name|data
parameter_list|)
block|{
specifier|static
name|int
name|fd
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|fd
operator|==
literal|0
condition|)
block|{
name|char
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|buf
argument_list|,
literal|64
argument_list|,
literal|"/dev/%s"
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|fd
operator|=
name|open
argument_list|(
name|buf
argument_list|,
name|O_RDWR
argument_list|)
operator|)
operator|<
literal|0
condition|)
return|return
operator|(
name|EINVAL
operator|)
return|;
block|}
return|return
name|ioctl
argument_list|(
name|fd
argument_list|,
name|cmd
argument_list|,
name|data
argument_list|)
operator|<
literal|0
condition|?
operator|-
literal|1
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|get_int_arg
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|uint32_t
modifier|*
name|valp
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
operator|*
name|valp
operator|=
name|strtoul
argument_list|(
name|s
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|p
condition|)
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|s
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|uint32_t
name|read_reg
parameter_list|(
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|,
name|uint32_t
name|addr
parameter_list|)
block|{
name|struct
name|ch_reg
name|reg
decl_stmt|;
name|reg
operator|.
name|addr
operator|=
name|addr
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GETREG
argument_list|,
operator|&
name|reg
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"register read"
argument_list|)
expr_stmt|;
return|return
name|reg
operator|.
name|val
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_reg
parameter_list|(
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|,
name|uint32_t
name|addr
parameter_list|,
name|uint32_t
name|val
parameter_list|)
block|{
name|struct
name|ch_reg
name|ch_reg
decl_stmt|;
name|ch_reg
operator|.
name|addr
operator|=
name|addr
expr_stmt|;
name|ch_reg
operator|.
name|val
operator|=
name|val
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_SETREG
argument_list|,
operator|&
name|ch_reg
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"register write"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|register_io
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|uint32_t
name|addr
decl_stmt|,
name|val
init|=
literal|0
decl_stmt|,
name|write
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|addr
operator|=
name|strtoul
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|argv
index|[
name|start_arg
index|]
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|*
name|p
operator|==
literal|'='
operator|&&
name|p
index|[
literal|1
index|]
condition|)
block|{
name|val
operator|=
name|strtoul
argument_list|(
name|p
operator|+
literal|1
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|write
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|p
condition|)
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|write
condition|)
name|write_reg
argument_list|(
name|iff_name
argument_list|,
name|addr
argument_list|,
name|val
argument_list|)
expr_stmt|;
else|else
block|{
name|val
operator|=
name|read_reg
argument_list|(
name|iff_name
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%#x [%u]\n"
argument_list|,
name|val
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|mdio_io
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ifreq
name|ifr
decl_stmt|;
name|struct
name|mii_data
name|p
decl_stmt|;
name|unsigned
name|int
name|cmd
decl_stmt|,
name|phy_addr
decl_stmt|,
name|reg
decl_stmt|,
name|mmd
decl_stmt|,
name|val
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|3
condition|)
name|cmd
operator|=
name|SIOCGMIIREG
expr_stmt|;
elseif|else
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|4
condition|)
name|cmd
operator|=
name|SIOCSMIIREG
expr_stmt|;
else|else
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|phy_addr
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|mmd
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|reg
argument_list|)
operator|||
operator|(
name|cmd
operator|==
name|SIOCSMIIREG
operator|&&
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|3
index|]
argument_list|,
operator|&
name|val
argument_list|)
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|p
operator|.
name|phy_id
operator|=
name|phy_addr
operator||
operator|(
name|mmd
operator|<<
literal|8
operator|)
expr_stmt|;
name|p
operator|.
name|reg_num
operator|=
name|reg
expr_stmt|;
name|p
operator|.
name|val_in
operator|=
name|val
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|cmd
argument_list|,
operator|&
name|p
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"MDIO %s"
argument_list|,
name|cmd
operator|==
name|SIOCGMIIREG
condition|?
literal|"read"
else|:
literal|"write"
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmd
operator|==
name|SIOCGMIIREG
condition|)
name|printf
argument_list|(
literal|"%#x [%u]\n"
argument_list|,
name|p
operator|.
name|val_out
argument_list|,
name|p
operator|.
name|val_out
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|uint32_t
name|xtract
parameter_list|(
name|uint32_t
name|val
parameter_list|,
name|int
name|shift
parameter_list|,
name|int
name|len
parameter_list|)
block|{
return|return
operator|(
name|val
operator|>>
name|shift
operator|)
operator|&
operator|(
operator|(
literal|1
operator|<<
name|len
operator|)
operator|-
literal|1
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dump_block_regs
parameter_list|(
specifier|const
name|struct
name|reg_info
modifier|*
name|reg_array
parameter_list|,
name|uint32_t
modifier|*
name|regs
parameter_list|)
block|{
name|uint32_t
name|reg_val
init|=
literal|0
decl_stmt|;
comment|// silence compiler warning
for|for
control|(
init|;
name|reg_array
operator|->
name|name
condition|;
operator|++
name|reg_array
control|)
if|if
condition|(
operator|!
name|reg_array
operator|->
name|len
condition|)
block|{
name|reg_val
operator|=
name|regs
index|[
name|reg_array
operator|->
name|addr
operator|/
literal|4
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"[%#5x] %-40s %#-10x [%u]\n"
argument_list|,
name|reg_array
operator|->
name|addr
argument_list|,
name|reg_array
operator|->
name|name
argument_list|,
name|reg_val
argument_list|,
name|reg_val
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|uint32_t
name|v
init|=
name|xtract
argument_list|(
name|reg_val
argument_list|,
name|reg_array
operator|->
name|addr
argument_list|,
name|reg_array
operator|->
name|len
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|"        %-40s %#-10x [%u]\n"
argument_list|,
name|reg_array
operator|->
name|name
argument_list|,
name|v
argument_list|,
name|v
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dump_regs_t2
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
name|uint32_t
modifier|*
name|regs
parameter_list|)
block|{
name|int
name|match
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|block_name
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|1
condition|)
name|block_name
operator|=
name|argv
index|[
name|start_arg
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|argc
operator|!=
name|start_arg
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"sge"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|sge_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mc3"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc3_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mc4"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc4_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"tpi"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|tpi_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"tp"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|tp_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"rat"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|rat_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cspi"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|cspi_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"espi"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|espi_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"ulp"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|ulp_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pl"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|pl_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mc5"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc5_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|match
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown block \"%s\""
argument_list|,
name|block_name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_if
if|#
directive|if
name|defined
argument_list|(
name|CONFIG_T3_REGS
argument_list|)
end_if

begin_function
specifier|static
name|int
name|dump_regs_t3
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
name|uint32_t
modifier|*
name|regs
parameter_list|,
name|int
name|is_pcie
parameter_list|)
block|{
name|int
name|match
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|block_name
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|1
condition|)
name|block_name
operator|=
name|argv
index|[
name|start_arg
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|argc
operator|!=
name|start_arg
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"sge"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|sge3_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pci"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|is_pcie
condition|?
name|pcie0_regs
else|:
name|pcix1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"t3dbg"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3dbg_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmrx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc7_pmrx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmtx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc7_pmtx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cm"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc7_cm_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cim"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|cim_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"tp"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|tp1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"ulp_rx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|ulp2_rx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"ulp_tx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|ulp2_tx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmrx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|pm1_rx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmtx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|pm1_tx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mps"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mps0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cplsw"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|cpl_switch_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"smb"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|smb0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"i2c"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|i2cm0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mi1"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mi1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"sf"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|sf1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pl"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|pl3_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mc5"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|mc5a_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"xgmac0"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|xgmac0_0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"xgmac1"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|xgmac0_1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|match
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown block \"%s\""
argument_list|,
name|block_name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dump_regs_t3b
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
name|uint32_t
modifier|*
name|regs
parameter_list|,
name|int
name|is_pcie
parameter_list|)
block|{
name|int
name|match
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|block_name
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|1
condition|)
name|block_name
operator|=
name|argv
index|[
name|start_arg
index|]
expr_stmt|;
elseif|else
if|if
condition|(
name|argc
operator|!=
name|start_arg
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"sge"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_sge3_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pci"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|is_pcie
condition|?
name|t3b_pcie0_regs
else|:
name|t3b_pcix1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"t3dbg"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_t3dbg_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmrx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mc7_pmrx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmtx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mc7_pmtx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cm"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mc7_cm_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cim"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_cim_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"tp"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_tp1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"ulp_rx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_ulp2_rx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"ulp_tx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_ulp2_tx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmrx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_pm1_rx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pmtx"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_pm1_tx_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mps"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mps0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"cplsw"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_cpl_switch_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"smb"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_smb0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"i2c"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_i2cm0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mi1"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mi1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"sf"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_sf1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"pl"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_pl3_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"mc5"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_mc5a_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"xgmac0"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_xgmac0_0_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|block_name
operator|||
operator|!
name|strcmp
argument_list|(
name|block_name
argument_list|,
literal|"xgmac1"
argument_list|)
condition|)
name|match
operator|+=
name|dump_block_regs
argument_list|(
name|t3b_xgmac0_1_regs
argument_list|,
name|regs
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|match
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown block \"%s\""
argument_list|,
name|block_name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|dump_regs
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|vers
decl_stmt|,
name|revision
decl_stmt|,
name|is_pcie
decl_stmt|;
name|struct
name|ifconf_regs
name|regs
decl_stmt|;
name|regs
operator|.
name|len
operator|=
name|REGDUMP_SIZE
expr_stmt|;
if|if
condition|(
operator|(
name|regs
operator|.
name|data
operator|=
name|malloc
argument_list|(
name|REGDUMP_SIZE
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"can't malloc"
argument_list|)
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_IFCONF_GETREGS
argument_list|,
operator|&
name|regs
argument_list|)
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"can't read registers"
argument_list|)
expr_stmt|;
name|vers
operator|=
name|regs
operator|.
name|version
operator|&
literal|0x3ff
expr_stmt|;
name|revision
operator|=
operator|(
name|regs
operator|.
name|version
operator|>>
literal|10
operator|)
operator|&
literal|0x3f
expr_stmt|;
name|is_pcie
operator|=
operator|(
name|regs
operator|.
name|version
operator|&
literal|0x80000000
operator|)
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
name|vers
operator|<=
literal|2
condition|)
return|return
name|dump_regs_t2
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|start_arg
argument_list|,
operator|(
name|uint32_t
operator|*
operator|)
name|regs
operator|.
name|data
argument_list|)
return|;
if|#
directive|if
name|defined
argument_list|(
name|CONFIG_T3_REGS
argument_list|)
if|if
condition|(
name|vers
operator|==
literal|3
condition|)
block|{
if|if
condition|(
name|revision
operator|==
literal|0
condition|)
return|return
name|dump_regs_t3
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|start_arg
argument_list|,
operator|(
name|uint32_t
operator|*
operator|)
name|regs
operator|.
name|data
argument_list|,
name|is_pcie
argument_list|)
return|;
if|if
condition|(
name|revision
operator|==
literal|2
condition|)
return|return
name|dump_regs_t3b
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
name|start_arg
argument_list|,
operator|(
name|uint32_t
operator|*
operator|)
name|regs
operator|.
name|data
argument_list|,
name|is_pcie
argument_list|)
return|;
block|}
endif|#
directive|endif
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown card type %d"
argument_list|,
name|vers
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|t3_meminfo
parameter_list|(
specifier|const
name|uint32_t
modifier|*
name|regs
parameter_list|)
block|{
enum|enum
block|{
name|SG_EGR_CNTX_BADDR
init|=
literal|0x58
block|,
name|SG_CQ_CONTEXT_BADDR
init|=
literal|0x6c
block|,
name|CIM_SDRAM_BASE_ADDR
init|=
literal|0x28c
block|,
name|CIM_SDRAM_ADDR_SIZE
init|=
literal|0x290
block|,
name|TP_CMM_MM_BASE
init|=
literal|0x314
block|,
name|TP_CMM_TIMER_BASE
init|=
literal|0x318
block|,
name|TP_CMM_MM_RX_FLST_BASE
init|=
literal|0x460
block|,
name|TP_CMM_MM_TX_FLST_BASE
init|=
literal|0x464
block|,
name|TP_CMM_MM_PS_FLST_BASE
init|=
literal|0x468
block|,
name|ULPRX_ISCSI_LLIMIT
init|=
literal|0x50c
block|,
name|ULPRX_ISCSI_ULIMIT
init|=
literal|0x510
block|,
name|ULPRX_TDDP_LLIMIT
init|=
literal|0x51c
block|,
name|ULPRX_TDDP_ULIMIT
init|=
literal|0x520
block|,
name|ULPRX_STAG_LLIMIT
init|=
literal|0x52c
block|,
name|ULPRX_STAG_ULIMIT
init|=
literal|0x530
block|,
name|ULPRX_RQ_LLIMIT
init|=
literal|0x534
block|,
name|ULPRX_RQ_ULIMIT
init|=
literal|0x538
block|,
name|ULPRX_PBL_LLIMIT
init|=
literal|0x53c
block|,
name|ULPRX_PBL_ULIMIT
init|=
literal|0x540
block|, 	}
enum|;
name|unsigned
name|int
name|egr_cntxt
init|=
name|regs
index|[
name|SG_EGR_CNTX_BADDR
operator|/
literal|4
index|]
decl_stmt|,
name|cq_cntxt
init|=
name|regs
index|[
name|SG_CQ_CONTEXT_BADDR
operator|/
literal|4
index|]
decl_stmt|,
name|timers
init|=
name|regs
index|[
name|TP_CMM_TIMER_BASE
operator|/
literal|4
index|]
operator|&
literal|0xfffffff
decl_stmt|,
name|pstructs
init|=
name|regs
index|[
name|TP_CMM_MM_BASE
operator|/
literal|4
index|]
decl_stmt|,
name|pstruct_fl
init|=
name|regs
index|[
name|TP_CMM_MM_PS_FLST_BASE
operator|/
literal|4
index|]
decl_stmt|,
name|rx_fl
init|=
name|regs
index|[
name|TP_CMM_MM_RX_FLST_BASE
operator|/
literal|4
index|]
decl_stmt|,
name|tx_fl
init|=
name|regs
index|[
name|TP_CMM_MM_TX_FLST_BASE
operator|/
literal|4
index|]
decl_stmt|,
name|cim_base
init|=
name|regs
index|[
name|CIM_SDRAM_BASE_ADDR
operator|/
literal|4
index|]
decl_stmt|,
name|cim_size
init|=
name|regs
index|[
name|CIM_SDRAM_ADDR_SIZE
operator|/
literal|4
index|]
decl_stmt|;
name|unsigned
name|int
name|iscsi_ll
init|=
name|regs
index|[
name|ULPRX_ISCSI_LLIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|iscsi_ul
init|=
name|regs
index|[
name|ULPRX_ISCSI_ULIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|tddp_ll
init|=
name|regs
index|[
name|ULPRX_TDDP_LLIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|tddp_ul
init|=
name|regs
index|[
name|ULPRX_TDDP_ULIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|stag_ll
init|=
name|regs
index|[
name|ULPRX_STAG_LLIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|stag_ul
init|=
name|regs
index|[
name|ULPRX_STAG_ULIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|rq_ll
init|=
name|regs
index|[
name|ULPRX_RQ_LLIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|rq_ul
init|=
name|regs
index|[
name|ULPRX_RQ_ULIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|pbl_ll
init|=
name|regs
index|[
name|ULPRX_PBL_LLIMIT
operator|/
literal|4
index|]
decl_stmt|,
name|pbl_ul
init|=
name|regs
index|[
name|ULPRX_PBL_ULIMIT
operator|/
literal|4
index|]
decl_stmt|;
name|printf
argument_list|(
literal|"CM memory map:\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  TCB region:      0x%08x - 0x%08x [%u]\n"
argument_list|,
literal|0
argument_list|,
name|egr_cntxt
operator|-
literal|1
argument_list|,
name|egr_cntxt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Egress contexts: 0x%08x - 0x%08x [%u]\n"
argument_list|,
name|egr_cntxt
argument_list|,
name|cq_cntxt
operator|-
literal|1
argument_list|,
name|cq_cntxt
operator|-
name|egr_cntxt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  CQ contexts:     0x%08x - 0x%08x [%u]\n"
argument_list|,
name|cq_cntxt
argument_list|,
name|timers
operator|-
literal|1
argument_list|,
name|timers
operator|-
name|cq_cntxt
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Timers:          0x%08x - 0x%08x [%u]\n"
argument_list|,
name|timers
argument_list|,
name|pstructs
operator|-
literal|1
argument_list|,
name|pstructs
operator|-
name|timers
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Pstructs:        0x%08x - 0x%08x [%u]\n"
argument_list|,
name|pstructs
argument_list|,
name|pstruct_fl
operator|-
literal|1
argument_list|,
name|pstruct_fl
operator|-
name|pstructs
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Pstruct FL:      0x%08x - 0x%08x [%u]\n"
argument_list|,
name|pstruct_fl
argument_list|,
name|rx_fl
operator|-
literal|1
argument_list|,
name|rx_fl
operator|-
name|pstruct_fl
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Rx FL:           0x%08x - 0x%08x [%u]\n"
argument_list|,
name|rx_fl
argument_list|,
name|tx_fl
operator|-
literal|1
argument_list|,
name|tx_fl
operator|-
name|rx_fl
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  Tx FL:           0x%08x - 0x%08x [%u]\n"
argument_list|,
name|tx_fl
argument_list|,
name|cim_base
operator|-
literal|1
argument_list|,
name|cim_base
operator|-
name|tx_fl
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  uP RAM:          0x%08x - 0x%08x [%u]\n"
argument_list|,
name|cim_base
argument_list|,
name|cim_base
operator|+
name|cim_size
operator|-
literal|1
argument_list|,
name|cim_size
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nPMRX memory map:\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  iSCSI region:    0x%08x - 0x%08x [%u]\n"
argument_list|,
name|iscsi_ll
argument_list|,
name|iscsi_ul
argument_list|,
name|iscsi_ul
operator|-
name|iscsi_ll
operator|+
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  TCP DDP region:  0x%08x - 0x%08x [%u]\n"
argument_list|,
name|tddp_ll
argument_list|,
name|tddp_ul
argument_list|,
name|tddp_ul
operator|-
name|tddp_ll
operator|+
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  TPT region:      0x%08x - 0x%08x [%u]\n"
argument_list|,
name|stag_ll
argument_list|,
name|stag_ul
argument_list|,
name|stag_ul
operator|-
name|stag_ll
operator|+
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  RQ region:       0x%08x - 0x%08x [%u]\n"
argument_list|,
name|rq_ll
argument_list|,
name|rq_ul
argument_list|,
name|rq_ul
operator|-
name|rq_ll
operator|+
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  PBL region:      0x%08x - 0x%08x [%u]\n"
argument_list|,
name|pbl_ll
argument_list|,
name|pbl_ul
argument_list|,
name|pbl_ul
operator|-
name|pbl_ll
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|meminfo
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|vers
decl_stmt|;
name|struct
name|ifconf_regs
name|regs
decl_stmt|;
if|if
condition|(
operator|(
name|regs
operator|.
name|data
operator|=
name|malloc
argument_list|(
name|REGDUMP_SIZE
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"can't malloc"
argument_list|)
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_IFCONF_GETREGS
argument_list|,
operator|&
name|regs
argument_list|)
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"can't read registers"
argument_list|)
expr_stmt|;
name|vers
operator|=
name|regs
operator|.
name|version
operator|&
literal|0x3ff
expr_stmt|;
if|if
condition|(
name|vers
operator|==
literal|3
condition|)
return|return
name|t3_meminfo
argument_list|(
operator|(
name|uint32_t
operator|*
operator|)
name|regs
operator|.
name|data
argument_list|)
return|;
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown card type %d"
argument_list|,
name|vers
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_function
specifier|static
name|int
name|mtu_tab_op
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|toetool_mtus
name|op
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
block|{
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_GETMTUTAB
expr_stmt|;
name|op
operator|.
name|nmtus
operator|=
name|MAX_NMTUS
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get MTU table"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|op
operator|.
name|nmtus
condition|;
operator|++
name|i
control|)
name|printf
argument_list|(
literal|"%u "
argument_list|,
name|op
operator|.
name|mtus
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|argc
operator|<=
name|start_arg
operator|+
name|MAX_NMTUS
condition|)
block|{
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_SETMTUTAB
expr_stmt|;
name|op
operator|.
name|nmtus
operator|=
name|argc
operator|-
name|start_arg
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|op
operator|.
name|nmtus
condition|;
operator|++
name|i
control|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|unsigned
name|long
name|m
init|=
name|strtoul
argument_list|(
name|argv
index|[
name|start_arg
operator|+
name|i
index|]
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
operator|*
name|p
operator|||
name|m
operator|>
literal|9600
condition|)
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
operator|+
name|i
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|i
operator|&&
name|m
operator|<
name|op
operator|.
name|mtus
index|[
name|i
operator|-
literal|1
index|]
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"MTUs must be in ascending order"
argument_list|)
expr_stmt|;
name|op
operator|.
name|mtus
index|[
name|i
index|]
operator|=
name|m
expr_stmt|;
block|}
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"set MTU table"
argument_list|)
expr_stmt|;
block|}
else|else
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
end_ifdef

begin_function
specifier|static
name|void
name|show_egress_cntxt
parameter_list|(
name|uint32_t
name|data
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"credits:      %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|&
literal|0x7fff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"GTS:          %u\n"
argument_list|,
operator|(
name|data
index|[
literal|0
index|]
operator|>>
literal|15
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"index:        %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"queue size:   %u\n"
argument_list|,
name|data
index|[
literal|1
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"base address: 0x%llx\n"
argument_list|,
operator|(
operator|(
name|data
index|[
literal|1
index|]
operator|>>
literal|16
operator|)
operator||
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|3
index|]
operator|&
literal|0xf
operator|)
operator|<<
literal|48
operator|)
operator|)
operator|<<
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rsp queue #:  %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|4
operator|)
operator|&
literal|7
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cmd queue #:  %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|7
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TUN:          %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|8
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"TOE:          %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|9
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"generation:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|10
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"uP token:     %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|11
operator|)
operator|&
literal|0xfffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"valid:        %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|31
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|show_fl_cntxt
parameter_list|(
name|uint32_t
name|data
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"base address: 0x%llx\n"
argument_list|,
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|0
index|]
operator||
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|1
index|]
operator|&
literal|0xfffff
operator|)
operator|<<
literal|32
operator|)
operator|<<
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"index:        %u\n"
argument_list|,
operator|(
name|data
index|[
literal|1
index|]
operator|>>
literal|20
operator|)
operator||
operator|(
operator|(
name|data
index|[
literal|2
index|]
operator|&
literal|0xf
operator|)
operator|<<
literal|12
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"queue size:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"generation:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|20
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"entry size:   %u\n"
argument_list|,
operator|(
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|21
operator|)
operator|&
literal|0x7ff
operator|)
operator||
operator|(
name|data
index|[
literal|3
index|]
operator|&
literal|0x1fffff
operator|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"congest thr:  %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|21
operator|)
operator|&
literal|0x3ff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"GTS:          %u\n"
argument_list|,
operator|(
name|data
index|[
literal|3
index|]
operator|>>
literal|31
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|show_response_cntxt
parameter_list|(
name|uint32_t
name|data
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"index:        %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"size:         %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"base address: 0x%llx\n"
argument_list|,
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|1
index|]
operator||
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|2
index|]
operator|&
literal|0xfffff
operator|)
operator|<<
literal|32
operator|)
operator|<<
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"MSI-X/RspQ:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|20
operator|)
operator|&
literal|0x3f
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"intr enable:  %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|26
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"intr armed:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|27
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"generation:   %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|28
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"CQ mode:      %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|31
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"FL threshold: %u\n"
argument_list|,
name|data
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|show_cq_cntxt
parameter_list|(
name|uint32_t
name|data
index|[]
parameter_list|)
block|{
name|printf
argument_list|(
literal|"index:            %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"size:             %u\n"
argument_list|,
name|data
index|[
literal|0
index|]
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"base address:     0x%llx\n"
argument_list|,
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|1
index|]
operator||
operator|(
operator|(
name|uint64_t
operator|)
name|data
index|[
literal|2
index|]
operator|&
literal|0xfffff
operator|)
operator|<<
literal|32
operator|)
operator|<<
literal|12
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"rsp queue #:      %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|20
operator|)
operator|&
literal|0x3f
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"AN:               %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|26
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"armed:            %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|27
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"ANS:              %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|28
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"generation:       %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|29
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"overflow mode:    %u\n"
argument_list|,
operator|(
name|data
index|[
literal|2
index|]
operator|>>
literal|31
operator|)
operator|&
literal|1
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"credits:          %u\n"
argument_list|,
name|data
index|[
literal|3
index|]
operator|&
literal|0xffff
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"credit threshold: %u\n"
argument_list|,
name|data
index|[
literal|3
index|]
operator|>>
literal|16
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|get_sge_context
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_cntxt
name|ctx
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|2
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"egress"
argument_list|)
condition|)
name|ctx
operator|.
name|cntxt_type
operator|=
name|CNTXT_TYPE_EGRESS
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"fl"
argument_list|)
condition|)
name|ctx
operator|.
name|cntxt_type
operator|=
name|CNTXT_TYPE_FL
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"response"
argument_list|)
condition|)
name|ctx
operator|.
name|cntxt_type
operator|=
name|CNTXT_TYPE_RSP
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"cq"
argument_list|)
condition|)
name|ctx
operator|.
name|cntxt_type
operator|=
name|CNTXT_TYPE_CQ
expr_stmt|;
else|else
block|{
name|warnx
argument_list|(
literal|"unknown context type \"%s\"; known types are egress, "
literal|"fl, cq, and response"
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|ctx
operator|.
name|cntxt_id
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GET_SGE_CONTEXT
argument_list|,
operator|&
name|ctx
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get SGE context"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"egress"
argument_list|)
condition|)
name|show_egress_cntxt
argument_list|(
name|ctx
operator|.
name|data
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"fl"
argument_list|)
condition|)
name|show_fl_cntxt
argument_list|(
name|ctx
operator|.
name|data
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"response"
argument_list|)
condition|)
name|show_response_cntxt
argument_list|(
name|ctx
operator|.
name|data
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"cq"
argument_list|)
condition|)
name|show_cq_cntxt
argument_list|(
name|ctx
operator|.
name|data
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_if
if|#
directive|if
name|__BYTE_ORDER
operator|==
name|__BIG_ENDIAN
end_if

begin_define
define|#
directive|define
name|ntohll
parameter_list|(
name|n
parameter_list|)
value|(n)
end_define

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|ntohll
parameter_list|(
name|n
parameter_list|)
value|bswap_64(n)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|get_sge_desc
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|uint64_t
modifier|*
name|p
decl_stmt|,
name|wr_hdr
decl_stmt|;
name|unsigned
name|int
name|n
init|=
literal|1
decl_stmt|,
name|qset
decl_stmt|,
name|qnum
decl_stmt|;
name|struct
name|ch_desc
name|desc
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|3
operator|&&
name|argc
operator|!=
name|start_arg
operator|+
literal|4
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|qset
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|qnum
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|desc
operator|.
name|idx
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|4
operator|&&
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|3
index|]
argument_list|,
operator|&
name|n
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|qnum
operator|>
literal|5
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"invalid queue number %d, range is 0..5"
argument_list|,
name|qnum
argument_list|)
expr_stmt|;
name|desc
operator|.
name|queue_num
operator|=
name|qset
operator|*
literal|6
operator|+
name|qnum
expr_stmt|;
for|for
control|(
init|;
name|n
operator|--
condition|;
name|desc
operator|.
name|idx
operator|++
control|)
block|{
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GET_SGE_DESC
argument_list|,
operator|&
name|desc
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get SGE descriptor"
argument_list|)
expr_stmt|;
name|p
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|desc
operator|.
name|data
expr_stmt|;
name|wr_hdr
operator|=
name|ntohll
argument_list|(
operator|*
name|p
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"Descriptor %u: cmd %u, TID %u, %s%s%s%s%u flits\n"
argument_list|,
name|desc
operator|.
name|idx
argument_list|,
call|(
name|unsigned
name|int
call|)
argument_list|(
name|wr_hdr
operator|>>
literal|56
argument_list|)
argument_list|,
operator|(
operator|(
name|unsigned
name|int
operator|)
name|wr_hdr
operator|>>
literal|8
operator|)
operator|&
literal|0xfffff
argument_list|,
operator|(
operator|(
name|wr_hdr
operator|>>
literal|55
operator|)
operator|&
literal|1
operator|)
condition|?
literal|"SOP, "
else|:
literal|""
argument_list|,
operator|(
operator|(
name|wr_hdr
operator|>>
literal|54
operator|)
operator|&
literal|1
operator|)
condition|?
literal|"EOP, "
else|:
literal|""
argument_list|,
operator|(
operator|(
name|wr_hdr
operator|>>
literal|53
operator|)
operator|&
literal|1
operator|)
condition|?
literal|"COMPL, "
else|:
literal|""
argument_list|,
operator|(
operator|(
name|wr_hdr
operator|>>
literal|52
operator|)
operator|&
literal|1
operator|)
condition|?
literal|"SGL, "
else|:
literal|""
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|wr_hdr
operator|&
literal|0xff
argument_list|)
expr_stmt|;
for|for
control|(
init|;
name|desc
operator|.
name|size
condition|;
name|p
operator|++
operator|,
name|desc
operator|.
name|size
operator|-=
sizeof|sizeof
argument_list|(
name|uint64_t
argument_list|)
control|)
name|printf
argument_list|(
literal|"%016"
name|PRIx64
literal|"%c"
argument_list|,
name|ntohll
argument_list|(
operator|*
name|p
argument_list|)
argument_list|,
name|desc
operator|.
name|size
operator|%
literal|32
operator|==
literal|8
condition|?
literal|'\n'
else|:
literal|' '
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_function
specifier|static
name|int
name|get_tcb2
parameter_list|(
name|unsigned
name|int
name|tcb_idx
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|uint64_t
modifier|*
name|d
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|struct
name|toetool_mem_range
modifier|*
name|op
decl_stmt|;
name|op
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|op
argument_list|)
operator|+
name|TCB_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|op
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get TCB"
argument_list|)
expr_stmt|;
name|op
operator|->
name|cmd
operator|=
name|TOETOOL_GET_MEM
expr_stmt|;
name|op
operator|->
name|mem_id
operator|=
name|MEM_CM
expr_stmt|;
name|op
operator|->
name|addr
operator|=
name|tcb_idx
operator|*
name|TCB_SIZE
expr_stmt|;
name|op
operator|->
name|len
operator|=
name|TCB_SIZE
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get TCB"
argument_list|)
expr_stmt|;
for|for
control|(
name|d
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|op
operator|->
name|buf
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TCB_SIZE
operator|/
literal|32
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%2u:"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" %08x %08x %08x %08x"
argument_list|,
operator|(
name|uint32_t
operator|)
name|d
index|[
literal|1
index|]
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|d
index|[
literal|1
index|]
operator|>>
literal|32
argument_list|)
argument_list|,
operator|(
name|uint32_t
operator|)
name|d
index|[
literal|0
index|]
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|d
index|[
literal|0
index|]
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
name|d
operator|+=
literal|2
expr_stmt|;
name|printf
argument_list|(
literal|" %08x %08x %08x %08x\n"
argument_list|,
operator|(
name|uint32_t
operator|)
name|d
index|[
literal|1
index|]
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|d
index|[
literal|1
index|]
operator|>>
literal|32
argument_list|)
argument_list|,
operator|(
name|uint32_t
operator|)
name|d
index|[
literal|0
index|]
argument_list|,
call|(
name|uint32_t
call|)
argument_list|(
name|d
index|[
literal|0
index|]
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
name|d
operator|+=
literal|2
expr_stmt|;
block|}
name|free
argument_list|(
name|op
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|get_tcb
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|uint32_t
modifier|*
name|d
decl_stmt|;
name|struct
name|toetool_tcb
name|op
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_GET_TCB
expr_stmt|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|op
operator|.
name|tcb_index
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* 	 * If this operation isn't directly supported by the driver we may 	 * still be able to read TCBs using the generic memory dump operation. 	 */
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|errno
operator|!=
name|EOPNOTSUPP
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get TCB"
argument_list|)
expr_stmt|;
return|return
name|get_tcb2
argument_list|(
name|op
operator|.
name|tcb_index
argument_list|,
name|iff_name
argument_list|)
return|;
block|}
for|for
control|(
name|d
operator|=
name|op
operator|.
name|tcb_data
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TCB_WORDS
condition|;
name|i
operator|+=
literal|8
control|)
block|{
name|int
name|j
decl_stmt|;
name|printf
argument_list|(
literal|"%2u:"
argument_list|,
literal|4
operator|*
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
operator|++
name|j
control|)
name|printf
argument_list|(
literal|" %08x"
argument_list|,
operator|*
name|d
operator|++
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|WRC
end_ifdef

begin_comment
comment|/*  * The following defines, typedefs and structures are defined in the FW and  * should be exported instead of being redefined here (and kept up in sync).  * We'll fix this in the next round of FW cleanup.  */
end_comment

begin_define
define|#
directive|define
name|CM_WRCONTEXT_BASE
value|0x20300000
end_define

begin_define
define|#
directive|define
name|CM_WRCONTEXT_OFFSET
value|0x300000
end_define

begin_define
define|#
directive|define
name|WRC_SIZE
value|(FW_WR_SIZE * (2 + FW_WR_NUM) + 32 + 4 * 128)
end_define

begin_define
define|#
directive|define
name|FW_WR_SIZE
value|128
end_define

begin_define
define|#
directive|define
name|FW_WR_NUM
value|16
end_define

begin_define
define|#
directive|define
name|FBUF_SIZE
value|(FW_WR_SIZE * FW_WR_NUM)
end_define

begin_define
define|#
directive|define
name|FBUF_WRAP_SIZE
value|128
end_define

begin_define
define|#
directive|define
name|FBUF_WRAP_FSZ
value|(FBUF_WRAP_SZ>> 3)
end_define

begin_define
define|#
directive|define
name|MEM_CM_WRC_SIZE
value|WRC_SIZE
end_define

begin_typedef
typedef|typedef
name|char
name|int8_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|short
name|int16_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|int
name|int32_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|long
name|long
name|_s64
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|unsigned
name|char
name|_u8
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|unsigned
name|short
name|_u16
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|unsigned
name|int
name|_uint32_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|unsigned
name|long
name|long
name|uint64_t
typedef|;
end_typedef

begin_enum
enum|enum
name|fw_ri_mpa_attrs
block|{
name|FW_RI_MPA_RX_MARKER_ENABLE
init|=
literal|0x1
block|,
name|FW_RI_MPA_TX_MARKER_ENABLE
init|=
literal|0x2
block|,
name|FW_RI_MPA_CRC_ENABLE
init|=
literal|0x4
block|,
name|FW_RI_MPA_IETF_ENABLE
init|=
literal|0x8
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
enum|;
end_enum

begin_enum
enum|enum
name|fw_ri_qp_caps
block|{
name|FW_RI_QP_RDMA_READ_ENABLE
init|=
literal|0x01
block|,
name|FW_RI_QP_RDMA_WRITE_ENABLE
init|=
literal|0x02
block|,
name|FW_RI_QP_BIND_ENABLE
init|=
literal|0x04
block|,
name|FW_RI_QP_FAST_REGISTER_ENABLE
init|=
literal|0x08
block|,
name|FW_RI_QP_STAG0_ENABLE
init|=
literal|0x10
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
enum|;
end_enum

begin_enum
enum|enum
name|wrc_state
block|{
name|WRC_STATE_CLOSED
block|,
name|WRC_STATE_ABORTED
block|,
name|WRC_STATE_HALFCLOSED
block|,
name|WRC_STATE_TOE_ESTABLISHED
block|,
name|WRC_STATE_RDMA_TX_DATA_PEND
block|,
name|WRC_STATE_RDMA_PEND
block|,
name|WRC_STATE_RDMA_ESTABLISHED
block|, }
enum|;
end_enum

begin_struct
struct|struct
name|_wr
block|{
name|uint32_t
name|a
decl_stmt|;
name|uint32_t
name|b
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|fbuf
block|{
name|uint32_t
name|pp
decl_stmt|;
comment|/* fifo producer pointer */
name|uint32_t
name|cp
decl_stmt|;
comment|/* fifo consumer pointer */
name|int32_t
name|num_bytes
decl_stmt|;
comment|/* num bytes stored in the fbuf */
name|char
name|bufferb
index|[
name|FBUF_SIZE
index|]
decl_stmt|;
comment|/* buffer space in bytes */
name|char
name|_wrap
index|[
name|FBUF_WRAP_SIZE
index|]
decl_stmt|;
comment|/* wrap buffer size*/
block|}
struct|;
end_struct

begin_struct
struct|struct
name|wrc
block|{
name|uint32_t
name|wrc_tid
decl_stmt|;
name|_u16
name|wrc_flags
decl_stmt|;
name|_u8
name|wrc_state
decl_stmt|;
name|_u8
name|wrc_credits
decl_stmt|;
comment|/* IO */
name|_u16
name|wrc_sge_ec
decl_stmt|;
name|_u8
name|wrc_sge_respQ
decl_stmt|;
name|_u8
name|wrc_port
decl_stmt|;
name|_u8
name|wrc_ulp
decl_stmt|;
name|_u8
name|wrc_coherency_counter
decl_stmt|;
comment|/* REASSEMBLY */
name|_u8
name|wrc_frag_len
decl_stmt|;
name|_u8
name|wrc_frag_credits
decl_stmt|;
name|uint32_t
name|wrc_frag
decl_stmt|;
union|union
block|{
struct|struct
block|{
comment|/* TOE */
name|_u8
name|aborted
decl_stmt|;
name|_u8
name|wrc_num_tx_pages
decl_stmt|;
name|_u8
name|wrc_max_tx_pages
decl_stmt|;
name|_u8
name|wrc_trace_idx
decl_stmt|;
name|uint32_t
name|wrc_snd_nxt
decl_stmt|;
name|uint32_t
name|wrc_snd_max
decl_stmt|;
name|uint32_t
name|wrc_snd_una
decl_stmt|;
name|uint32_t
name|wrc_snd_iss
decl_stmt|;
comment|/* RI */
name|uint32_t
name|wrc_pdid
decl_stmt|;
name|uint32_t
name|wrc_scqid
decl_stmt|;
name|uint32_t
name|wrc_rcqid
decl_stmt|;
name|uint32_t
name|wrc_rq_addr_32a
decl_stmt|;
name|_u16
name|wrc_rq_size
decl_stmt|;
name|_u16
name|wrc_rq_wr_idx
decl_stmt|;
name|enum
name|fw_ri_mpa_attrs
name|wrc_mpaattrs
decl_stmt|;
name|enum
name|fw_ri_qp_caps
name|wrc_qpcaps
decl_stmt|;
name|_u16
name|wrc_mulpdu_tagged
decl_stmt|;
name|_u16
name|wrc_mulpdu_untagged
decl_stmt|;
name|_u16
name|wrc_ord_max
decl_stmt|;
name|_u16
name|wrc_ird_max
decl_stmt|;
name|_u16
name|wrc_ord
decl_stmt|;
name|_u16
name|wrc_ird
decl_stmt|;
name|_u16
name|wrc_markeroffset
decl_stmt|;
name|uint32_t
name|wrc_msn_send
decl_stmt|;
name|uint32_t
name|wrc_msn_rdma_read
decl_stmt|;
name|uint32_t
name|wrc_msn_rdma_read_req
decl_stmt|;
name|_u16
name|wrc_rdma_read_req_err
decl_stmt|;
name|_u8
name|wrc_ack_mode
decl_stmt|;
name|_u8
name|wrc_sge_ec_credits
decl_stmt|;
name|_u16
name|wrc_maxiolen_tagged
decl_stmt|;
name|_u16
name|wrc_maxiolen_untagged
decl_stmt|;
name|uint32_t
name|wrc_mo
decl_stmt|;
block|}
name|toe_ri
struct|;
struct|struct
block|{  		}
name|ipmi
struct|;
struct|struct
block|{
name|uint32_t
name|wrc_pad2
index|[
literal|24
index|]
decl_stmt|;
block|}
name|pad
struct|;
block|}
name|u
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
union|;
comment|/* BUFFERING */
name|struct
name|fbuf
name|wrc_fbuf
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|wrc_aborted
value|u.toe_ri.aborted
end_define

begin_define
define|#
directive|define
name|wrc_num_tx_pages
value|u.toe_ri.wrc_num_tx_pages
end_define

begin_define
define|#
directive|define
name|wrc_max_tx_pages
value|u.toe_ri.wrc_max_tx_pages
end_define

begin_define
define|#
directive|define
name|wrc_trace_idx
value|u.toe_ri.wrc_trace_idx
end_define

begin_define
define|#
directive|define
name|wrc_snd_nxt
value|u.toe_ri.wrc_snd_nxt
end_define

begin_define
define|#
directive|define
name|wrc_snd_max
value|u.toe_ri.wrc_snd_max
end_define

begin_define
define|#
directive|define
name|wrc_snd_una
value|u.toe_ri.wrc_snd_una
end_define

begin_define
define|#
directive|define
name|wrc_snd_iss
value|u.toe_ri.wrc_snd_iss
end_define

begin_define
define|#
directive|define
name|wrc_pdid
value|u.toe_ri.wrc_pdid
end_define

begin_define
define|#
directive|define
name|wrc_scqid
value|u.toe_ri.wrc_scqid
end_define

begin_define
define|#
directive|define
name|wrc_rcqid
value|u.toe_ri.wrc_rcqid
end_define

begin_define
define|#
directive|define
name|wrc_rq_addr_32a
value|u.toe_ri.wrc_rq_addr_32a
end_define

begin_define
define|#
directive|define
name|wrc_rq_size
value|u.toe_ri.wrc_rq_size
end_define

begin_define
define|#
directive|define
name|wrc_rq_wr_idx
value|u.toe_ri.wrc_rq_wr_idx
end_define

begin_define
define|#
directive|define
name|wrc_mpaattrs
value|u.toe_ri.wrc_mpaattrs
end_define

begin_define
define|#
directive|define
name|wrc_qpcaps
value|u.toe_ri.wrc_qpcaps
end_define

begin_define
define|#
directive|define
name|wrc_mulpdu_tagged
value|u.toe_ri.wrc_mulpdu_tagged
end_define

begin_define
define|#
directive|define
name|wrc_mulpdu_untagged
value|u.toe_ri.wrc_mulpdu_untagged
end_define

begin_define
define|#
directive|define
name|wrc_ord_max
value|u.toe_ri.wrc_ord_max
end_define

begin_define
define|#
directive|define
name|wrc_ird_max
value|u.toe_ri.wrc_ird_max
end_define

begin_define
define|#
directive|define
name|wrc_ord
value|u.toe_ri.wrc_ord
end_define

begin_define
define|#
directive|define
name|wrc_ird
value|u.toe_ri.wrc_ird
end_define

begin_define
define|#
directive|define
name|wrc_markeroffset
value|u.toe_ri.wrc_markeroffset
end_define

begin_define
define|#
directive|define
name|wrc_msn_send
value|u.toe_ri.wrc_msn_send
end_define

begin_define
define|#
directive|define
name|wrc_msn_rdma_read
value|u.toe_ri.wrc_msn_rdma_read
end_define

begin_define
define|#
directive|define
name|wrc_msn_rdma_read_req
value|u.toe_ri.wrc_msn_rdma_read_req
end_define

begin_define
define|#
directive|define
name|wrc_rdma_read_req_err
value|u.toe_ri.wrc_rdma_read_req_err
end_define

begin_define
define|#
directive|define
name|wrc_ack_mode
value|u.toe_ri.wrc_ack_mode
end_define

begin_define
define|#
directive|define
name|wrc_sge_ec_credits
value|u.toe_ri.wrc_sge_ec_credits
end_define

begin_define
define|#
directive|define
name|wrc_maxiolen_tagged
value|u.toe_ri.wrc_maxiolen_tagged
end_define

begin_define
define|#
directive|define
name|wrc_maxiolen_untagged
value|u.toe_ri.wrc_maxiolen_untagged
end_define

begin_define
define|#
directive|define
name|wrc_mo
value|u.toe_ri.wrc_mo
end_define

begin_function
specifier|static
name|void
name|print_wrc_field
parameter_list|(
name|char
modifier|*
name|field
parameter_list|,
name|unsigned
name|int
name|value
parameter_list|,
name|unsigned
name|int
name|size
parameter_list|)
block|{
switch|switch
condition|(
name|size
condition|)
block|{
case|case
literal|1
case|:
name|printf
argument_list|(
literal|"  1 %s: 0x%02x (%u)\n"
argument_list|,
name|field
argument_list|,
name|value
argument_list|,
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
block|{
name|unsigned
name|short
name|host_value
init|=
name|ntohs
argument_list|(
name|value
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|"  2 %s: 0x%04x (%u)\n"
argument_list|,
name|field
argument_list|,
name|host_value
argument_list|,
name|host_value
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|unsigned
name|int
name|host_value
init|=
name|ntohl
argument_list|(
name|value
argument_list|)
decl_stmt|;
name|printf
argument_list|(
literal|"  4 %s: 0x%08x (%u)\n"
argument_list|,
name|field
argument_list|,
name|host_value
argument_list|,
name|host_value
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
name|printf
argument_list|(
literal|"  unknown size %u for field %s\n"
argument_list|,
name|size
argument_list|,
name|field
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|P
parameter_list|(
name|field
parameter_list|)
value|print_wrc_field(#field, p->wrc_ ## field, sizeof (p->wrc_ ## field))
end_define

begin_function
specifier|static
name|void
name|print_wrc
parameter_list|(
name|unsigned
name|int
name|wrc_idx
parameter_list|,
name|struct
name|wrc
modifier|*
name|p
parameter_list|)
block|{
name|u32
modifier|*
name|buf
init|=
operator|(
name|u32
operator|*
operator|)
name|p
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|printf
argument_list|(
literal|"WRC STATE (raw)\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
control|)
block|{
name|printf
argument_list|(
literal|"[%08x]:"
argument_list|,
literal|0x20300000
operator|+
name|wrc_idx
operator|*
name|MEM_CM_WRC_SIZE
operator|+
name|i
operator|*
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
name|j
operator|++
control|)
block|{
name|printf
argument_list|(
literal|" %08x "
argument_list|,
name|htonl
argument_list|(
name|buf
index|[
name|i
operator|++
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"WRC BASIC\n"
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|tid
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|state
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|credits
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC IO\n"
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|sge_ec
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|sge_respQ
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|port
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ulp
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|coherency_counter
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC REASSEMBLY\n"
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|frag_len
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|frag_credits
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|frag
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC TOE\n"
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|aborted
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|num_tx_pages
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|max_tx_pages
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|trace_idx
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|snd_nxt
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|snd_max
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|snd_una
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|snd_iss
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC RI\n"
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|pdid
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|scqid
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|rcqid
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|rq_addr_32a
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|rq_size
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|rq_wr_idx
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|mpaattrs
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|qpcaps
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|mulpdu_tagged
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|mulpdu_untagged
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ord_max
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ird_max
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ord
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ird
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|markeroffset
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|msn_send
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|msn_rdma_read
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|msn_rdma_read_req
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|rdma_read_req_err
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ack_mode
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|sge_ec_credits
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|maxiolen_tagged
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|maxiolen_untagged
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|mo
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC BUFFERING\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  4 fbuf.pp: 0x%08x (%u)\n"
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|pp
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|pp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  4 fbuf.cp: 0x%08x (%u)\n"
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|cp
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|cp
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  4 fbuf.num_bytes: 0x%08x (%d)\n"
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|num_bytes
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|p
operator|->
name|wrc_fbuf
operator|.
name|num_bytes
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"WRC BUFFER (raw)\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|32
init|;
name|i
operator|<
operator|(
name|FBUF_SIZE
operator|+
name|FBUF_WRAP_SIZE
operator|)
operator|/
literal|4
condition|;
control|)
block|{
name|printf
argument_list|(
literal|"[%08x]:"
argument_list|,
literal|0x20300000
operator|+
name|wrc_idx
operator|*
name|MEM_CM_WRC_SIZE
operator|+
name|i
operator|*
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
block|{
name|printf
argument_list|(
literal|" %08x%08x"
argument_list|,
name|htonl
argument_list|(
name|buf
index|[
name|i
operator|++
index|]
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|buf
index|[
name|i
operator|++
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_undef
undef|#
directive|undef
name|P
end_undef

begin_define
define|#
directive|define
name|P
parameter_list|(
name|field
parameter_list|)
value|print_sizeof(#field, ##field, sizeof (p->##field))
end_define

begin_struct
struct|struct
name|history_e
block|{
name|uint32_t
name|wr_addr
decl_stmt|;
name|uint32_t
name|debug
decl_stmt|;
name|uint64_t
name|wr_flit0
decl_stmt|;
name|uint64_t
name|wr_flit1
decl_stmt|;
name|uint64_t
name|wr_flit2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|print_wrc_zero
parameter_list|(
name|unsigned
name|int
name|wrc_idx
parameter_list|,
name|struct
name|wrc
modifier|*
name|p
parameter_list|)
block|{
name|uint32_t
modifier|*
name|buf
init|=
operator|(
name|uint32_t
operator|*
operator|)
operator|(
operator|(
name|unsigned
name|long
operator|)
name|p
operator|+
name|FW_WR_SIZE
operator|*
operator|(
literal|2
operator|+
name|FW_WR_NUM
operator|)
operator|)
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|printf
argument_list|(
literal|"WRC ZERO\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"[%08x]:"
argument_list|,
name|CM_WRCONTEXT_BASE
operator|+
name|wrc_idx
operator|*
name|MEM_CM_WRC_SIZE
operator|+
name|FW_WR_SIZE
operator|*
operator|(
literal|2
operator|+
name|FW_WR_NUM
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
control|)
name|printf
argument_list|(
literal|" %08x%08x"
argument_list|,
name|htonl
argument_list|(
name|buf
index|[
name|i
index|]
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|buf
index|[
name|i
operator|++
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_wrc_history
parameter_list|(
name|struct
name|wrc
modifier|*
name|p
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|,
name|idx
decl_stmt|;
name|struct
name|history_e
modifier|*
name|e
init|=
operator|(
expr|struct
name|history_e
operator|*
operator|)
operator|(
operator|(
name|unsigned
name|long
operator|)
name|p
operator|+
name|FW_WR_SIZE
operator|*
operator|(
literal|2
operator|+
name|FW_WR_NUM
operator|)
operator|+
literal|32
operator|)
decl_stmt|;
name|printf
argument_list|(
literal|"WRC WR HISTORY, idx %u\n"
argument_list|,
name|p
operator|->
name|wrc_trace_idx
argument_list|)
expr_stmt|;
name|idx
operator|=
name|p
operator|->
name|wrc_trace_idx
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%02u: %08x %08x %08x%08x %08x%08x %08x%08x\n"
argument_list|,
name|idx
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_addr
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|debug
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit0
operator|&
literal|0xFFFFFFFF
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit0
operator|>>
literal|32
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit1
operator|&
literal|0xFFFFFFFF
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit1
operator|>>
literal|32
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit2
operator|&
literal|0xFFFFFFFF
argument_list|)
argument_list|,
name|htonl
argument_list|(
name|e
index|[
name|idx
index|]
operator|.
name|wr_flit2
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
name|idx
operator|=
operator|(
name|idx
operator|-
literal|1
operator|)
operator|&
literal|0xF
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|get_wrc
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|toetool_mem_range
modifier|*
name|op
decl_stmt|;
name|uint64_t
modifier|*
name|p
decl_stmt|;
name|uint32_t
modifier|*
name|buf
decl_stmt|;
name|unsigned
name|int
name|idx
decl_stmt|,
name|i
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|1
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|idx
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|op
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|op
argument_list|)
operator|+
name|MEM_CM_WRC_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|op
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get_wrc: malloc failed"
argument_list|)
expr_stmt|;
name|op
operator|->
name|cmd
operator|=
name|TOETOOL_GET_MEM
expr_stmt|;
name|op
operator|->
name|mem_id
operator|=
name|MEM_CM
expr_stmt|;
name|op
operator|->
name|addr
operator|=
name|read_reg
argument_list|(
name|iff_name
argument_list|,
literal|0x28c
argument_list|)
operator|+
name|CM_WRCONTEXT_OFFSET
operator|+
name|idx
operator|*
name|MEM_CM_WRC_SIZE
expr_stmt|;
name|op
operator|->
name|len
operator|=
name|MEM_CM_WRC_SIZE
expr_stmt|;
name|buf
operator|=
operator|(
name|uint32_t
operator|*
operator|)
name|op
operator|->
name|buf
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get_wrc"
argument_list|)
expr_stmt|;
comment|/* driver manges with the data... put it back into the the FW's view 	 */
for|for
control|(
name|p
operator|=
operator|(
name|uint64_t
operator|*
operator|)
name|op
operator|->
name|buf
init|;
name|p
operator|<
operator|(
name|uint64_t
operator|*
operator|)
operator|(
name|op
operator|->
name|buf
operator|+
name|MEM_CM_WRC_SIZE
operator|)
condition|;
name|p
operator|++
control|)
block|{
name|uint64_t
name|flit
init|=
operator|*
name|p
decl_stmt|;
name|buf
index|[
name|i
operator|++
index|]
operator|=
name|htonl
argument_list|(
call|(
name|uint32_t
call|)
argument_list|(
name|flit
operator|>>
literal|32
argument_list|)
argument_list|)
expr_stmt|;
name|buf
index|[
name|i
operator|++
index|]
operator|=
name|htonl
argument_list|(
operator|(
name|uint32_t
operator|)
name|flit
argument_list|)
expr_stmt|;
block|}
name|print_wrc
argument_list|(
name|idx
argument_list|,
operator|(
expr|struct
name|wrc
operator|*
operator|)
name|op
operator|->
name|buf
argument_list|)
expr_stmt|;
name|print_wrc_zero
argument_list|(
name|idx
argument_list|,
operator|(
expr|struct
name|wrc
operator|*
operator|)
name|op
operator|->
name|buf
argument_list|)
expr_stmt|;
name|print_wrc_history
argument_list|(
operator|(
expr|struct
name|wrc
operator|*
operator|)
name|op
operator|->
name|buf
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|op
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_function
specifier|static
name|int
name|get_pm_page_spec
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|unsigned
name|int
modifier|*
name|page_size
parameter_list|,
name|unsigned
name|int
modifier|*
name|num_pages
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|unsigned
name|long
name|val
decl_stmt|;
name|val
operator|=
name|strtoul
argument_list|(
name|s
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|s
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|*
name|p
operator|==
literal|'x'
operator|&&
name|p
index|[
literal|1
index|]
condition|)
block|{
operator|*
name|num_pages
operator|=
name|val
expr_stmt|;
operator|*
name|page_size
operator|=
name|strtoul
argument_list|(
name|p
operator|+
literal|1
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|num_pages
operator|=
operator|-
literal|1
expr_stmt|;
operator|*
name|page_size
operator|=
name|val
expr_stmt|;
block|}
operator|*
name|page_size
operator|<<=
literal|10
expr_stmt|;
comment|// KB -> bytes
return|return
operator|*
name|p
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|conf_pm
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|toetool_pm
name|op
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
block|{
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_GET_PM
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"read pm config"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%ux%uKB TX pages, %ux%uKB RX pages, %uKB total memory\n"
argument_list|,
name|op
operator|.
name|tx_num_pg
argument_list|,
name|op
operator|.
name|tx_pg_sz
operator|>>
literal|10
argument_list|,
name|op
operator|.
name|rx_num_pg
argument_list|,
name|op
operator|.
name|rx_pg_sz
operator|>>
literal|10
argument_list|,
name|op
operator|.
name|pm_total
operator|>>
literal|10
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|2
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_pm_page_spec
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|op
operator|.
name|tx_pg_sz
argument_list|,
operator|&
name|op
operator|.
name|tx_num_pg
argument_list|)
condition|)
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|get_pm_page_spec
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|op
operator|.
name|rx_pg_sz
argument_list|,
operator|&
name|op
operator|.
name|rx_num_pg
argument_list|)
condition|)
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_SET_PM
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"pm config"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|conf_tcam
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|toetool_tcam
name|op
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
block|{
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_GET_TCAM
expr_stmt|;
name|op
operator|.
name|nfilters
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"read tcam config"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%u total entries, %u servers, %u filters, %u routes\n"
argument_list|,
name|op
operator|.
name|tcam_size
argument_list|,
name|op
operator|.
name|nservers
argument_list|,
name|op
operator|.
name|nfilters
argument_list|,
name|op
operator|.
name|nroutes
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|3
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|op
operator|.
name|nservers
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|op
operator|.
name|nroutes
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|op
operator|.
name|nfilters
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_SET_TCAM
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"tcam config"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_function
specifier|static
name|int
name|dump_tcam
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|unsigned
name|int
name|nwords
decl_stmt|;
name|struct
name|toetool_tcam_word
name|op
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|2
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|op
operator|.
name|addr
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|nwords
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|op
operator|.
name|cmd
operator|=
name|TOETOOL_READ_TCAM_WORD
expr_stmt|;
while|while
condition|(
name|nwords
operator|--
condition|)
block|{
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"tcam dump"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"0x%08x: 0x%02x 0x%08x 0x%08x\n"
argument_list|,
name|op
operator|.
name|addr
argument_list|,
name|op
operator|.
name|buf
index|[
literal|0
index|]
operator|&
literal|0xff
argument_list|,
name|op
operator|.
name|buf
index|[
literal|1
index|]
argument_list|,
name|op
operator|.
name|buf
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|op
operator|.
name|addr
operator|++
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|hexdump_8b
parameter_list|(
name|unsigned
name|int
name|start
parameter_list|,
name|uint64_t
modifier|*
name|data
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
while|while
condition|(
name|len
condition|)
block|{
name|printf
argument_list|(
literal|"0x%08x:"
argument_list|,
name|start
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
operator|&&
name|len
condition|;
operator|++
name|i
operator|,
operator|--
name|len
control|)
name|printf
argument_list|(
literal|" %016llx"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
operator|*
name|data
operator|++
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
name|start
operator|+=
literal|32
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
name|dump_mc7
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_mem_range
name|mem
decl_stmt|;
name|unsigned
name|int
name|mem_id
decl_stmt|,
name|addr
decl_stmt|,
name|len
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|3
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"cm"
argument_list|)
condition|)
name|mem_id
operator|=
name|MEM_CM
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"rx"
argument_list|)
condition|)
name|mem_id
operator|=
name|MEM_PMRX
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"tx"
argument_list|)
condition|)
name|mem_id
operator|=
name|MEM_PMTX
expr_stmt|;
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown memory \"%s\"; must be one of \"cm\", \"tx\","
literal|" or \"rx\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|addr
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|len
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|mem
operator|.
name|buf
operator|=
name|malloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|mem
operator|.
name|buf
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"memory dump"
argument_list|)
expr_stmt|;
name|mem
operator|.
name|mem_id
operator|=
name|mem_id
expr_stmt|;
name|mem
operator|.
name|addr
operator|=
name|addr
expr_stmt|;
name|mem
operator|.
name|len
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GET_MEM
argument_list|,
operator|&
name|mem
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"memory dump"
argument_list|)
expr_stmt|;
name|hexdump_8b
argument_list|(
name|mem
operator|.
name|addr
argument_list|,
operator|(
name|uint64_t
operator|*
operator|)
name|mem
operator|.
name|buf
argument_list|,
name|mem
operator|.
name|len
operator|>>
literal|3
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|mem
operator|.
name|buf
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_comment
comment|/* Max FW size is 32K including version, +4 bytes for the checksum. */
end_comment

begin_define
define|#
directive|define
name|MAX_FW_IMAGE_SIZE
value|(32768 + 4)
end_define

begin_function
specifier|static
name|int
name|load_fw
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|fd
decl_stmt|,
name|len
decl_stmt|;
name|struct
name|toetool_mem_range
modifier|*
name|op
decl_stmt|;
specifier|const
name|char
modifier|*
name|fname
init|=
name|argv
index|[
name|start_arg
index|]
decl_stmt|;
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|1
condition|)
return|return
operator|-
literal|1
return|;
name|fd
operator|=
name|open
argument_list|(
name|fname
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
if|if
condition|(
name|fd
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load firmware"
argument_list|)
expr_stmt|;
name|op
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|op
argument_list|)
operator|+
name|MAX_FW_IMAGE_SIZE
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|op
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load firmware"
argument_list|)
expr_stmt|;
name|len
operator|=
name|read
argument_list|(
name|fd
argument_list|,
name|op
operator|->
name|buf
argument_list|,
name|MAX_FW_IMAGE_SIZE
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load firmware"
argument_list|)
expr_stmt|;
if|if
condition|(
name|len
operator|>
name|MAX_FW_IMAGE_SIZE
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"FW image too large"
argument_list|)
expr_stmt|;
name|op
operator|->
name|cmd
operator|=
name|TOETOOL_LOAD_FW
expr_stmt|;
name|op
operator|->
name|len
operator|=
name|len
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load firmware"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|write_proto_sram
parameter_list|(
specifier|const
name|char
modifier|*
name|fname
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|char
name|c
decl_stmt|;
name|struct
name|toetool_proto
name|op
init|=
block|{
operator|.
name|cmd
operator|=
name|TOETOOL_SET_PROTO
block|}
decl_stmt|;
name|uint32_t
modifier|*
name|p
init|=
name|op
operator|.
name|data
decl_stmt|;
name|FILE
modifier|*
name|fp
init|=
name|fopen
argument_list|(
name|fname
argument_list|,
literal|"r"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load protocol sram"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|128
condition|;
name|i
operator|++
operator|,
name|p
operator|+=
literal|5
control|)
block|{
name|int
name|n
init|=
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%1x%8x%8x%8x%8x"
argument_list|,
operator|&
name|p
index|[
literal|0
index|]
argument_list|,
operator|&
name|p
index|[
literal|1
index|]
argument_list|,
operator|&
name|p
index|[
literal|2
index|]
argument_list|,
operator|&
name|p
index|[
literal|3
index|]
argument_list|,
operator|&
name|p
index|[
literal|4
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
name|n
operator|!=
literal|5
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"%s: bad line %d"
argument_list|,
name|fname
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"%1s"
argument_list|,
operator|&
name|c
argument_list|)
operator|!=
name|EOF
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"%s: protocol sram image has too many lines"
argument_list|,
name|fname
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"load protocol sram"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dump_proto_sram
parameter_list|(
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|u8
name|buf
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|ethtool_eeprom
argument_list|)
operator|+
name|PROTO_SRAM_SIZE
index|]
decl_stmt|;
name|struct
name|ethtool_eeprom
modifier|*
name|ee
init|=
operator|(
expr|struct
name|ethtool_eeprom
operator|*
operator|)
name|buf
decl_stmt|;
name|u8
modifier|*
name|p
init|=
name|buf
operator|+
sizeof|sizeof
argument_list|(
expr|struct
name|ethtool_eeprom
argument_list|)
decl_stmt|;
name|ee
operator|->
name|cmd
operator|=
name|ETHTOOL_GEEPROM
expr_stmt|;
name|ee
operator|->
name|len
operator|=
name|PROTO_SRAM_SIZE
expr_stmt|;
name|ee
operator|->
name|offset
operator|=
name|PROTO_SRAM_EEPROM_ADDR
expr_stmt|;
if|if
condition|(
name|ethtool_call
argument_list|(
name|iff_name
argument_list|,
name|ee
argument_list|)
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"show protocol sram"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|PROTO_SRAM_LINES
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
name|PROTO_SRAM_LINE_NIBBLES
operator|-
literal|1
init|;
name|j
operator|>=
literal|0
condition|;
name|j
operator|--
control|)
block|{
name|int
name|nibble_idx
init|=
name|i
operator|*
name|PROTO_SRAM_LINE_NIBBLES
operator|+
name|j
decl_stmt|;
name|u8
name|nibble
init|=
name|p
index|[
name|nibble_idx
operator|/
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|nibble_idx
operator|&
literal|1
condition|)
name|nibble
operator|>>=
literal|4
expr_stmt|;
else|else
name|nibble
operator|&=
literal|0xf
expr_stmt|;
name|printf
argument_list|(
literal|"%x"
argument_list|,
name|nibble
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|proto_sram_op
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|1
condition|)
return|return
name|write_proto_sram
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
name|iff_name
argument_list|)
return|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
return|return
name|dump_proto_sram
argument_list|(
name|iff_name
argument_list|)
return|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|dump_qset_params
parameter_list|(
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_qset_params
name|qp
decl_stmt|;
name|qp
operator|.
name|qset_idx
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GET_QSET_PARAMS
argument_list|,
operator|&
name|qp
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|qp
operator|.
name|qset_idx
condition|)
name|printf
argument_list|(
literal|"Qnum   TxQ0   TxQ1   TxQ2   RspQ   RxQ0   RxQ1"
literal|"  Cong  Intr Lat   Rx Mode\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%4u %6u %6u %6u %6u %6u %6u %5u %9u   %s    \n"
argument_list|,
name|qp
operator|.
name|qset_idx
argument_list|,
name|qp
operator|.
name|txq_size
index|[
literal|0
index|]
argument_list|,
name|qp
operator|.
name|txq_size
index|[
literal|1
index|]
argument_list|,
name|qp
operator|.
name|txq_size
index|[
literal|2
index|]
argument_list|,
name|qp
operator|.
name|rspq_size
argument_list|,
name|qp
operator|.
name|fl_size
index|[
literal|0
index|]
argument_list|,
name|qp
operator|.
name|fl_size
index|[
literal|1
index|]
argument_list|,
name|qp
operator|.
name|cong_thres
argument_list|,
name|qp
operator|.
name|intr_lat
argument_list|,
name|qp
operator|.
name|polling
condition|?
literal|"Polling"
else|:
literal|"Interrupt"
argument_list|)
expr_stmt|;
name|qp
operator|.
name|qset_idx
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|qp
operator|.
name|qset_idx
operator|||
operator|(
name|errno
operator|&&
name|errno
operator|!=
name|EINVAL
operator|)
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get qset parameters"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qset_config
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_qset_params
name|qp
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
return|return
name|dump_qset_params
argument_list|(
name|iff_name
argument_list|)
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|++
index|]
argument_list|,
operator|&
name|qp
operator|.
name|qset_idx
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|qp
operator|.
name|txq_size
index|[
literal|0
index|]
operator|=
name|qp
operator|.
name|txq_size
index|[
literal|1
index|]
operator|=
name|qp
operator|.
name|txq_size
index|[
literal|2
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|qp
operator|.
name|fl_size
index|[
literal|0
index|]
operator|=
name|qp
operator|.
name|fl_size
index|[
literal|1
index|]
operator|=
name|qp
operator|.
name|rspq_size
operator|=
operator|-
literal|1
expr_stmt|;
name|qp
operator|.
name|polling
operator|=
name|qp
operator|.
name|intr_lat
operator|=
name|qp
operator|.
name|cong_thres
operator|=
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|start_arg
operator|+
literal|2
operator|<=
name|argc
condition|)
block|{
name|int32_t
modifier|*
name|param
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"txq0"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|txq_size
index|[
literal|0
index|]
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"txq1"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|txq_size
index|[
literal|1
index|]
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"txq2"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|txq_size
index|[
literal|2
index|]
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"rspq"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|rspq_size
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"fl0"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|fl_size
index|[
literal|0
index|]
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"fl1"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|fl_size
index|[
literal|1
index|]
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"lat"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|intr_lat
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"cong"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|cong_thres
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"mode"
argument_list|)
condition|)
name|param
operator|=
operator|&
name|qp
operator|.
name|polling
expr_stmt|;
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown qset parameter \"%s\"\n"
literal|"allowed parameters are \"txq0\", \"txq1\", "
literal|"\"txq2\", \"rspq\", \"fl0\", \"fl1\", \"lat\", "
literal|"\"cong\", \"mode\' and \"lro\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
name|start_arg
operator|++
expr_stmt|;
if|if
condition|(
name|param
operator|==
operator|&
name|qp
operator|.
name|polling
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"irq"
argument_list|)
condition|)
name|qp
operator|.
name|polling
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"polling"
argument_list|)
condition|)
name|qp
operator|.
name|polling
operator|=
literal|1
expr_stmt|;
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"illegal qset mode \"%s\"\n"
literal|"known modes are \"irq\" and \"polling\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|(
name|uint32_t
operator|*
operator|)
name|param
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|start_arg
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|start_arg
operator|!=
name|argc
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown parameter %s"
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|printf("%4u %6d %6d %6d %6d %6d %6d %5d %9d   %d\n", op.qset_idx, 	       op.txq_size[0], op.txq_size[1], op.txq_size[2], 	       op.rspq_size, op.fl_size[0], op.fl_size[1], op.cong_thres, 	       op.intr_lat, op.polling);
endif|#
directive|endif
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_SET_QSET_PARAMS
argument_list|,
operator|&
name|qp
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"set qset parameters"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|qset_num_config
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_reg
name|reg
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
block|{
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_GET_QSET_NUM
argument_list|,
operator|&
name|reg
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"get qsets"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%u\n"
argument_list|,
name|reg
operator|.
name|val
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|1
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
operator|&
name|reg
operator|.
name|val
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_SET_QSET_NUM
argument_list|,
operator|&
name|reg
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"set qsets"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Parse a string containing an IP address with an optional network prefix.  */
end_comment

begin_function
specifier|static
name|int
name|parse_ipaddr
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|uint32_t
modifier|*
name|addr
parameter_list|,
name|uint32_t
modifier|*
name|mask
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|,
modifier|*
name|slash
decl_stmt|;
name|struct
name|in_addr
name|ia
decl_stmt|;
operator|*
name|mask
operator|=
literal|0xffffffffU
expr_stmt|;
name|slash
operator|=
name|strchr
argument_list|(
name|s
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|slash
condition|)
operator|*
name|slash
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|inet_aton
argument_list|(
name|s
argument_list|,
operator|&
name|ia
argument_list|)
condition|)
block|{
if|if
condition|(
name|slash
condition|)
operator|*
name|slash
operator|=
literal|'/'
expr_stmt|;
operator|*
name|addr
operator|=
literal|0
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|addr
operator|=
name|ntohl
argument_list|(
name|ia
operator|.
name|s_addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|slash
condition|)
block|{
name|unsigned
name|int
name|prefix
init|=
name|strtoul
argument_list|(
name|slash
operator|+
literal|1
argument_list|,
operator|&
name|p
argument_list|,
literal|10
argument_list|)
decl_stmt|;
operator|*
name|slash
operator|=
literal|'/'
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|slash
operator|+
literal|1
operator|||
operator|*
name|p
operator|||
name|prefix
operator|>
literal|32
condition|)
return|return
operator|-
literal|1
return|;
operator|*
name|mask
operator|<<=
operator|(
literal|32
operator|-
name|prefix
operator|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Parse a string containing a value and an optional colon separated mask.  */
end_comment

begin_function
specifier|static
name|int
name|parse_val_mask_param
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|uint32_t
modifier|*
name|val
parameter_list|,
name|uint32_t
modifier|*
name|mask
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
operator|*
name|mask
operator|=
literal|0xffffffffU
expr_stmt|;
operator|*
name|val
operator|=
name|strtoul
argument_list|(
name|s
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|s
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|*
name|p
operator|==
literal|':'
operator|&&
name|p
index|[
literal|1
index|]
condition|)
operator|*
name|mask
operator|=
name|strtoul
argument_list|(
name|p
operator|+
literal|1
argument_list|,
operator|&
name|p
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
operator|*
name|p
condition|?
operator|-
literal|1
else|:
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|parse_trace_param
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|,
name|uint32_t
modifier|*
name|val
parameter_list|,
name|uint32_t
modifier|*
name|mask
parameter_list|)
block|{
return|return
name|strchr
argument_list|(
name|s
argument_list|,
literal|'.'
argument_list|)
condition|?
name|parse_ipaddr
argument_list|(
name|s
argument_list|,
name|val
argument_list|,
name|mask
argument_list|)
else|:
name|parse_val_mask_param
argument_list|(
name|s
argument_list|,
name|val
argument_list|,
name|mask
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|trace_config
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|uint32_t
name|val
decl_stmt|,
name|mask
decl_stmt|;
name|struct
name|ch_trace
name|trace
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
return|return
operator|-
literal|1
return|;
name|memset
argument_list|(
operator|&
name|trace
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|trace
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"tx"
argument_list|)
condition|)
name|trace
operator|.
name|config_tx
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"rx"
argument_list|)
condition|)
name|trace
operator|.
name|config_rx
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"all"
argument_list|)
condition|)
name|trace
operator|.
name|config_tx
operator|=
name|trace
operator|.
name|config_rx
operator|=
literal|1
expr_stmt|;
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad trace filter \"%s\"; must be one of \"rx\", "
literal|"\"tx\" or \"all\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|==
operator|++
name|start_arg
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"on"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|trace_tx
operator|=
name|trace
operator|.
name|config_tx
expr_stmt|;
name|trace
operator|.
name|trace_rx
operator|=
name|trace
operator|.
name|config_rx
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"off"
argument_list|)
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad argument \"%s\"; must be \"on\" or \"off\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
name|start_arg
operator|++
expr_stmt|;
if|if
condition|(
name|start_arg
operator|<
name|argc
operator|&&
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"not"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|invert_match
operator|=
literal|1
expr_stmt|;
name|start_arg
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|start_arg
operator|+
literal|2
operator|<=
name|argc
condition|)
block|{
name|int
name|ret
init|=
name|parse_trace_param
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|val
argument_list|,
operator|&
name|mask
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"interface"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|intf
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|intf_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"sip"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|sip
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|sip_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"dip"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|dip
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|dip_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"sport"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|sport
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|sport_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"dport"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|dport
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|dport_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"vlan"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|vlan
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|vlan_mask
operator|=
name|mask
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"proto"
argument_list|)
condition|)
block|{
name|trace
operator|.
name|proto
operator|=
name|val
expr_stmt|;
name|trace
operator|.
name|proto_mask
operator|=
name|mask
expr_stmt|;
block|}
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown trace parameter \"%s\"\n"
literal|"known parameters are \"interface\", \"sip\", "
literal|"\"dip\", \"sport\", \"dport\", \"vlan\", "
literal|"\"proto\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|start_arg
operator|+=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|start_arg
operator|!=
name|argc
condition|)
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|printf("sip: %x:%x, dip: %x:%x, sport: %x:%x, dport: %x:%x, " 	       "interface: %x:%x, vlan: %x:%x, tx_config: %u, rx_config: %u, " 	       "invert: %u, tx_enable: %u, rx_enable: %u\n", op.sip, 	       op.sip_mask, op.dip, op.dip_mask, op.sport, op.sport_mask, 	       op.dport, op.dport_mask, op.intf, op.intf_mask, op.vlan, 	       op.vlan_mask, op.config_tx, op.config_rx, op.invert_match, 	       op.trace_tx, op.trace_rx);
endif|#
directive|endif
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_SET_TRACE_FILTER
argument_list|,
operator|&
name|trace
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"trace"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|notyet
end_ifdef

begin_function
specifier|static
name|int
name|t1_powersave
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|toetool_t1powersave
name|op
init|=
block|{
operator|.
name|cmd
operator|=
name|TOETOOL_T1POWERSAVE
block|,
operator|.
name|mode
operator|=
literal|0
block|}
decl_stmt|;
if|if
condition|(
name|argc
operator|==
name|start_arg
condition|)
name|op
operator|.
name|mode
operator|=
literal|2
expr_stmt|;
comment|/* Check powersave mode */
elseif|else
if|if
condition|(
name|argc
operator|==
name|start_arg
operator|+
literal|1
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"on"
argument_list|)
operator|==
literal|0
condition|)
name|op
operator|.
name|mode
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"off"
argument_list|)
operator|==
literal|0
condition|)
name|op
operator|.
name|mode
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|warnx
argument_list|(
literal|"bad parameter \"%s\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
else|else
block|{
name|errx
argument_list|(
literal|1
argument_list|,
literal|"too many arguments"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
operator|&
name|op
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"t1powersave"
argument_list|)
expr_stmt|;
if|if
condition|(
name|op
operator|.
name|mode
operator|&
literal|2
condition|)
name|printf
argument_list|(
literal|"t1powersave is %s\n"
argument_list|,
operator|(
name|op
operator|.
name|mode
operator|&
literal|1
operator|)
condition|?
literal|"on"
else|:
literal|"off"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|pktsched
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|,
name|int
name|start_arg
parameter_list|,
specifier|const
name|char
modifier|*
name|iff_name
parameter_list|)
block|{
name|struct
name|ch_pktsched_params
name|pktsched
decl_stmt|;
name|unsigned
name|int
name|idx
decl_stmt|,
name|min
init|=
operator|-
literal|1
decl_stmt|,
name|max
decl_stmt|,
name|binding
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"port"
argument_list|)
condition|)
block|{
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|4
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|idx
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|min
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|3
index|]
argument_list|,
operator|&
name|max
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|pktsched
operator|.
name|sched
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
name|start_arg
index|]
argument_list|,
literal|"tunnelq"
argument_list|)
condition|)
block|{
if|if
condition|(
name|argc
operator|!=
name|start_arg
operator|+
literal|4
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|1
index|]
argument_list|,
operator|&
name|idx
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|2
index|]
argument_list|,
operator|&
name|max
argument_list|)
operator|||
name|get_int_arg
argument_list|(
name|argv
index|[
name|start_arg
operator|+
literal|3
index|]
argument_list|,
operator|&
name|binding
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|pktsched
operator|.
name|sched
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|errx
argument_list|(
literal|1
argument_list|,
literal|"unknown scheduler \"%s\"; must be one of \"port\""
literal|" or \"tunnelq\""
argument_list|,
name|argv
index|[
name|start_arg
index|]
argument_list|)
expr_stmt|;
name|pktsched
operator|.
name|idx
operator|=
name|idx
expr_stmt|;
name|pktsched
operator|.
name|min
operator|=
name|min
expr_stmt|;
name|pktsched
operator|.
name|max
operator|=
name|max
expr_stmt|;
name|pktsched
operator|.
name|binding
operator|=
name|binding
expr_stmt|;
if|if
condition|(
name|doit
argument_list|(
name|iff_name
argument_list|,
name|CHELSIO_SET_PKTSCHED
argument_list|,
operator|&
name|pktsched
argument_list|)
operator|<
literal|0
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"pktsched"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|int
name|r
init|=
operator|-
literal|1
decl_stmt|;
specifier|const
name|char
modifier|*
name|iff_name
decl_stmt|;
name|progname
operator|=
name|argv
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|2
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"-h"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--help"
argument_list|)
condition|)
name|usage
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"-v"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|1
index|]
argument_list|,
literal|"--version"
argument_list|)
condition|)
block|{
name|printf
argument_list|(
literal|"%s version %s\n"
argument_list|,
name|PROGNAME
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"%s\n"
argument_list|,
name|COPYRIGHT
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|argc
operator|<
literal|3
condition|)
name|usage
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
name|iff_name
operator|=
name|argv
index|[
literal|1
index|]
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"reg"
argument_list|)
condition|)
name|r
operator|=
name|register_io
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"mdio"
argument_list|)
condition|)
name|r
operator|=
name|mdio_io
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notyet
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"tpi"
argument_list|)
condition|)
name|r
operator|=
name|tpi_io
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"up"
argument_list|)
condition|)
name|r
operator|=
name|device_up
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"mtus"
argument_list|)
condition|)
name|r
operator|=
name|mtu_tab_op
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"pm"
argument_list|)
condition|)
name|r
operator|=
name|conf_pm
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"tcam"
argument_list|)
condition|)
name|r
operator|=
name|conf_tcam
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"tcb"
argument_list|)
condition|)
name|r
operator|=
name|get_tcb
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WRC
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"wrc"
argument_list|)
condition|)
name|r
operator|=
name|get_wrc
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"regdump"
argument_list|)
condition|)
name|r
operator|=
name|dump_regs
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CHELSIO_INTERNAL
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"memdump"
argument_list|)
condition|)
name|r
operator|=
name|dump_mc7
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"meminfo"
argument_list|)
condition|)
name|r
operator|=
name|meminfo
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"context"
argument_list|)
condition|)
name|r
operator|=
name|get_sge_context
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"desc"
argument_list|)
condition|)
name|r
operator|=
name|get_sge_desc
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
endif|#
directive|endif
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"qset"
argument_list|)
condition|)
name|r
operator|=
name|qset_config
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"qsets"
argument_list|)
condition|)
name|r
operator|=
name|qset_num_config
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"trace"
argument_list|)
condition|)
name|r
operator|=
name|trace_config
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|notyet
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"tcamdump"
argument_list|)
condition|)
name|r
operator|=
name|dump_tcam
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"loadfw"
argument_list|)
condition|)
name|r
operator|=
name|load_fw
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"proto"
argument_list|)
condition|)
name|r
operator|=
name|proto_sram_op
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"t1powersave"
argument_list|)
condition|)
name|r
operator|=
name|t1_powersave
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
endif|#
directive|endif
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|argv
index|[
literal|2
index|]
argument_list|,
literal|"pktsched"
argument_list|)
condition|)
name|r
operator|=
name|pktsched
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|3
argument_list|,
name|iff_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|==
operator|-
literal|1
condition|)
name|usage
argument_list|(
name|stderr
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

