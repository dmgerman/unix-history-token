begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Functions to support general ended bitmaps.    Copyright (C) 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005    Free Software Foundation, Inc.  This file is part of GCC.  GCC is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2, or (at your option) any later version.  GCC is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with GCC; see the file COPYING.  If not, write to the Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"system.h"
end_include

begin_include
include|#
directive|include
file|"coretypes.h"
end_include

begin_include
include|#
directive|include
file|"tm.h"
end_include

begin_include
include|#
directive|include
file|"rtl.h"
end_include

begin_include
include|#
directive|include
file|"flags.h"
end_include

begin_include
include|#
directive|include
file|"obstack.h"
end_include

begin_include
include|#
directive|include
file|"ggc.h"
end_include

begin_include
include|#
directive|include
file|"bitmap.h"
end_include

begin_comment
comment|/* Global data */
end_comment

begin_decl_stmt
name|bitmap_element
name|bitmap_zero_bits
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* An element of all zero bits.  */
end_comment

begin_decl_stmt
name|bitmap_obstack
name|bitmap_default_obstack
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* The default bitmap obstack.  */
end_comment

begin_expr_stmt
specifier|static
name|GTY
argument_list|(
argument|(deletable)
argument_list|)
name|bitmap_element
operator|*
name|bitmap_ggc_free
expr_stmt|;
end_expr_stmt

begin_comment
comment|/* Freelist of 							    GC'd elements.  */
end_comment

begin_function_decl
specifier|static
name|void
name|bitmap_elem_to_freelist
parameter_list|(
name|bitmap
parameter_list|,
name|bitmap_element
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|bitmap_element_free
parameter_list|(
name|bitmap
parameter_list|,
name|bitmap_element
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bitmap_element
modifier|*
name|bitmap_element_allocate
parameter_list|(
name|bitmap
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|bitmap_element_zerop
parameter_list|(
name|bitmap_element
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|bitmap_element_link
parameter_list|(
name|bitmap
parameter_list|,
name|bitmap_element
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bitmap_element
modifier|*
name|bitmap_elt_insert_after
parameter_list|(
name|bitmap
parameter_list|,
name|bitmap_element
modifier|*
parameter_list|,
name|unsigned
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|bitmap_elt_clear_from
parameter_list|(
name|bitmap
parameter_list|,
name|bitmap_element
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|bitmap_element
modifier|*
name|bitmap_find_bit
parameter_list|(
name|bitmap
parameter_list|,
name|unsigned
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_escape
end_escape

begin_comment
comment|/* Add ELEM to the appropriate freelist.  */
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|bitmap_elem_to_freelist
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|bitmap_element
modifier|*
name|elt
parameter_list|)
block|{
name|bitmap_obstack
modifier|*
name|bit_obstack
init|=
name|head
operator|->
name|obstack
decl_stmt|;
name|elt
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|bit_obstack
condition|)
block|{
name|elt
operator|->
name|prev
operator|=
name|bit_obstack
operator|->
name|elements
expr_stmt|;
name|bit_obstack
operator|->
name|elements
operator|=
name|elt
expr_stmt|;
block|}
else|else
block|{
name|elt
operator|->
name|prev
operator|=
name|bitmap_ggc_free
expr_stmt|;
name|bitmap_ggc_free
operator|=
name|elt
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Free a bitmap element.  Since these are allocated off the    bitmap_obstack, "free" actually means "put onto the freelist".  */
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|bitmap_element_free
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|bitmap_element
modifier|*
name|elt
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|next
init|=
name|elt
operator|->
name|next
decl_stmt|;
name|bitmap_element
modifier|*
name|prev
init|=
name|elt
operator|->
name|prev
decl_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|next
expr_stmt|;
if|if
condition|(
name|next
condition|)
name|next
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
if|if
condition|(
name|head
operator|->
name|first
operator|==
name|elt
condition|)
name|head
operator|->
name|first
operator|=
name|next
expr_stmt|;
comment|/* Since the first thing we try is to insert before current,      make current the next entry in preference to the previous.  */
if|if
condition|(
name|head
operator|->
name|current
operator|==
name|elt
condition|)
block|{
name|head
operator|->
name|current
operator|=
name|next
operator|!=
literal|0
condition|?
name|next
else|:
name|prev
expr_stmt|;
if|if
condition|(
name|head
operator|->
name|current
condition|)
name|head
operator|->
name|indx
operator|=
name|head
operator|->
name|current
operator|->
name|indx
expr_stmt|;
else|else
name|head
operator|->
name|indx
operator|=
literal|0
expr_stmt|;
block|}
name|bitmap_elem_to_freelist
argument_list|(
name|head
argument_list|,
name|elt
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Allocate a bitmap element.  The bits are cleared, but nothing else is.  */
end_comment

begin_function
specifier|static
specifier|inline
name|bitmap_element
modifier|*
name|bitmap_element_allocate
parameter_list|(
name|bitmap
name|head
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|element
decl_stmt|;
name|bitmap_obstack
modifier|*
name|bit_obstack
init|=
name|head
operator|->
name|obstack
decl_stmt|;
if|if
condition|(
name|bit_obstack
condition|)
block|{
name|element
operator|=
name|bit_obstack
operator|->
name|elements
expr_stmt|;
if|if
condition|(
name|element
condition|)
comment|/* Use up the inner list first before looking at the next 	   element of the outer list.  */
if|if
condition|(
name|element
operator|->
name|next
condition|)
block|{
name|bit_obstack
operator|->
name|elements
operator|=
name|element
operator|->
name|next
expr_stmt|;
name|bit_obstack
operator|->
name|elements
operator|->
name|prev
operator|=
name|element
operator|->
name|prev
expr_stmt|;
block|}
else|else
comment|/*  Inner list was just a singleton.  */
name|bit_obstack
operator|->
name|elements
operator|=
name|element
operator|->
name|prev
expr_stmt|;
else|else
name|element
operator|=
name|XOBNEW
argument_list|(
operator|&
name|bit_obstack
operator|->
name|obstack
argument_list|,
name|bitmap_element
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|element
operator|=
name|bitmap_ggc_free
expr_stmt|;
if|if
condition|(
name|element
condition|)
comment|/* Use up the inner list first before looking at the next 	   element of the outer list.  */
if|if
condition|(
name|element
operator|->
name|next
condition|)
block|{
name|bitmap_ggc_free
operator|=
name|element
operator|->
name|next
expr_stmt|;
name|bitmap_ggc_free
operator|->
name|prev
operator|=
name|element
operator|->
name|prev
expr_stmt|;
block|}
else|else
comment|/*  Inner list was just a singleton.  */
name|bitmap_ggc_free
operator|=
name|element
operator|->
name|prev
expr_stmt|;
else|else
name|element
operator|=
name|GGC_NEW
argument_list|(
name|bitmap_element
argument_list|)
expr_stmt|;
block|}
name|memset
argument_list|(
name|element
operator|->
name|bits
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|element
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|element
return|;
block|}
end_function

begin_comment
comment|/* Remove ELT and all following elements from bitmap HEAD.  */
end_comment

begin_function
name|void
name|bitmap_elt_clear_from
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|bitmap_element
modifier|*
name|elt
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|prev
decl_stmt|;
name|bitmap_obstack
modifier|*
name|bit_obstack
init|=
name|head
operator|->
name|obstack
decl_stmt|;
if|if
condition|(
operator|!
name|elt
condition|)
return|return;
name|prev
operator|=
name|elt
operator|->
name|prev
expr_stmt|;
if|if
condition|(
name|prev
condition|)
block|{
name|prev
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|head
operator|->
name|current
operator|->
name|indx
operator|>
name|prev
operator|->
name|indx
condition|)
block|{
name|head
operator|->
name|current
operator|=
name|prev
expr_stmt|;
name|head
operator|->
name|indx
operator|=
name|prev
operator|->
name|indx
expr_stmt|;
block|}
block|}
else|else
block|{
name|head
operator|->
name|first
operator|=
name|NULL
expr_stmt|;
name|head
operator|->
name|current
operator|=
name|NULL
expr_stmt|;
name|head
operator|->
name|indx
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Put the entire list onto the free list in one operation. */
if|if
condition|(
name|bit_obstack
condition|)
block|{
name|elt
operator|->
name|prev
operator|=
name|bit_obstack
operator|->
name|elements
expr_stmt|;
name|bit_obstack
operator|->
name|elements
operator|=
name|elt
expr_stmt|;
block|}
else|else
block|{
name|elt
operator|->
name|prev
operator|=
name|bitmap_ggc_free
expr_stmt|;
name|bitmap_ggc_free
operator|=
name|elt
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Clear a bitmap by freeing the linked list.  */
end_comment

begin_function
specifier|inline
name|void
name|bitmap_clear
parameter_list|(
name|bitmap
name|head
parameter_list|)
block|{
if|if
condition|(
name|head
operator|->
name|first
condition|)
name|bitmap_elt_clear_from
argument_list|(
name|head
argument_list|,
name|head
operator|->
name|first
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Initialize a bitmap obstack.  If BIT_OBSTACK is NULL, initialize    the default bitmap obstack.  */
end_comment

begin_function
name|void
name|bitmap_obstack_initialize
parameter_list|(
name|bitmap_obstack
modifier|*
name|bit_obstack
parameter_list|)
block|{
if|if
condition|(
operator|!
name|bit_obstack
condition|)
name|bit_obstack
operator|=
operator|&
name|bitmap_default_obstack
expr_stmt|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|__GNUC__
argument_list|)
operator|||
operator|(
name|__GNUC__
operator|<
literal|2
operator|)
define|#
directive|define
name|__alignof__
parameter_list|(
name|type
parameter_list|)
value|0
endif|#
directive|endif
name|bit_obstack
operator|->
name|elements
operator|=
name|NULL
expr_stmt|;
name|bit_obstack
operator|->
name|heads
operator|=
name|NULL
expr_stmt|;
name|obstack_specify_allocation
argument_list|(
operator|&
name|bit_obstack
operator|->
name|obstack
argument_list|,
name|OBSTACK_CHUNK_SIZE
argument_list|,
name|__alignof__
argument_list|(
name|bitmap_element
argument_list|)
argument_list|,
name|obstack_chunk_alloc
argument_list|,
name|obstack_chunk_free
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Release the memory from a bitmap obstack.  If BIT_OBSTACK is NULL,    release the default bitmap obstack.  */
end_comment

begin_function
name|void
name|bitmap_obstack_release
parameter_list|(
name|bitmap_obstack
modifier|*
name|bit_obstack
parameter_list|)
block|{
if|if
condition|(
operator|!
name|bit_obstack
condition|)
name|bit_obstack
operator|=
operator|&
name|bitmap_default_obstack
expr_stmt|;
name|bit_obstack
operator|->
name|elements
operator|=
name|NULL
expr_stmt|;
name|bit_obstack
operator|->
name|heads
operator|=
name|NULL
expr_stmt|;
name|obstack_free
argument_list|(
operator|&
name|bit_obstack
operator|->
name|obstack
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Create a new bitmap on an obstack.  If BIT_OBSTACK is NULL, create    it on the default bitmap obstack.  */
end_comment

begin_function
name|bitmap
name|bitmap_obstack_alloc
parameter_list|(
name|bitmap_obstack
modifier|*
name|bit_obstack
parameter_list|)
block|{
name|bitmap
name|map
decl_stmt|;
if|if
condition|(
operator|!
name|bit_obstack
condition|)
name|bit_obstack
operator|=
operator|&
name|bitmap_default_obstack
expr_stmt|;
name|map
operator|=
name|bit_obstack
operator|->
name|heads
expr_stmt|;
if|if
condition|(
name|map
condition|)
name|bit_obstack
operator|->
name|heads
operator|=
operator|(
name|void
operator|*
operator|)
name|map
operator|->
name|first
expr_stmt|;
else|else
name|map
operator|=
name|XOBNEW
argument_list|(
operator|&
name|bit_obstack
operator|->
name|obstack
argument_list|,
name|bitmap_head
argument_list|)
expr_stmt|;
name|bitmap_initialize
argument_list|(
name|map
argument_list|,
name|bit_obstack
argument_list|)
expr_stmt|;
return|return
name|map
return|;
block|}
end_function

begin_comment
comment|/* Create a new GCd bitmap.  */
end_comment

begin_function
name|bitmap
name|bitmap_gc_alloc
parameter_list|(
name|void
parameter_list|)
block|{
name|bitmap
name|map
decl_stmt|;
name|map
operator|=
name|GGC_NEW
argument_list|(
expr|struct
name|bitmap_head_def
argument_list|)
expr_stmt|;
name|bitmap_initialize
argument_list|(
name|map
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|map
return|;
block|}
end_function

begin_comment
comment|/* Release an obstack allocated bitmap.  */
end_comment

begin_function
name|void
name|bitmap_obstack_free
parameter_list|(
name|bitmap
name|map
parameter_list|)
block|{
if|if
condition|(
name|map
condition|)
block|{
name|bitmap_clear
argument_list|(
name|map
argument_list|)
expr_stmt|;
name|map
operator|->
name|first
operator|=
operator|(
name|void
operator|*
operator|)
name|map
operator|->
name|obstack
operator|->
name|heads
expr_stmt|;
name|map
operator|->
name|obstack
operator|->
name|heads
operator|=
name|map
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Return nonzero if all bits in an element are zero.  */
end_comment

begin_function
specifier|static
specifier|inline
name|int
name|bitmap_element_zerop
parameter_list|(
name|bitmap_element
modifier|*
name|element
parameter_list|)
block|{
if|#
directive|if
name|BITMAP_ELEMENT_WORDS
operator|==
literal|2
return|return
operator|(
name|element
operator|->
name|bits
index|[
literal|0
index|]
operator||
name|element
operator|->
name|bits
index|[
literal|1
index|]
operator|)
operator|==
literal|0
return|;
else|#
directive|else
name|unsigned
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BITMAP_ELEMENT_WORDS
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|element
operator|->
name|bits
index|[
name|i
index|]
operator|!=
literal|0
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
endif|#
directive|endif
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Link the bitmap element into the current bitmap linked list.  */
end_comment

begin_function
specifier|static
specifier|inline
name|void
name|bitmap_element_link
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|bitmap_element
modifier|*
name|element
parameter_list|)
block|{
name|unsigned
name|int
name|indx
init|=
name|element
operator|->
name|indx
decl_stmt|;
name|bitmap_element
modifier|*
name|ptr
decl_stmt|;
comment|/* If this is the first and only element, set it in.  */
if|if
condition|(
name|head
operator|->
name|first
operator|==
literal|0
condition|)
block|{
name|element
operator|->
name|next
operator|=
name|element
operator|->
name|prev
operator|=
literal|0
expr_stmt|;
name|head
operator|->
name|first
operator|=
name|element
expr_stmt|;
block|}
comment|/* If this index is less than that of the current element, it goes someplace      before the current element.  */
elseif|else
if|if
condition|(
name|indx
operator|<
name|head
operator|->
name|indx
condition|)
block|{
for|for
control|(
name|ptr
operator|=
name|head
operator|->
name|current
init|;
name|ptr
operator|->
name|prev
operator|!=
literal|0
operator|&&
name|ptr
operator|->
name|prev
operator|->
name|indx
operator|>
name|indx
condition|;
name|ptr
operator|=
name|ptr
operator|->
name|prev
control|)
empty_stmt|;
if|if
condition|(
name|ptr
operator|->
name|prev
condition|)
name|ptr
operator|->
name|prev
operator|->
name|next
operator|=
name|element
expr_stmt|;
else|else
name|head
operator|->
name|first
operator|=
name|element
expr_stmt|;
name|element
operator|->
name|prev
operator|=
name|ptr
operator|->
name|prev
expr_stmt|;
name|element
operator|->
name|next
operator|=
name|ptr
expr_stmt|;
name|ptr
operator|->
name|prev
operator|=
name|element
expr_stmt|;
block|}
comment|/* Otherwise, it must go someplace after the current element.  */
else|else
block|{
for|for
control|(
name|ptr
operator|=
name|head
operator|->
name|current
init|;
name|ptr
operator|->
name|next
operator|!=
literal|0
operator|&&
name|ptr
operator|->
name|next
operator|->
name|indx
operator|<
name|indx
condition|;
name|ptr
operator|=
name|ptr
operator|->
name|next
control|)
empty_stmt|;
if|if
condition|(
name|ptr
operator|->
name|next
condition|)
name|ptr
operator|->
name|next
operator|->
name|prev
operator|=
name|element
expr_stmt|;
name|element
operator|->
name|next
operator|=
name|ptr
operator|->
name|next
expr_stmt|;
name|element
operator|->
name|prev
operator|=
name|ptr
expr_stmt|;
name|ptr
operator|->
name|next
operator|=
name|element
expr_stmt|;
block|}
comment|/* Set up so this is the first element searched.  */
name|head
operator|->
name|current
operator|=
name|element
expr_stmt|;
name|head
operator|->
name|indx
operator|=
name|indx
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Insert a new uninitialized element into bitmap HEAD after element    ELT.  If ELT is NULL, insert the element at the start.  Return the    new element.  */
end_comment

begin_function
specifier|static
name|bitmap_element
modifier|*
name|bitmap_elt_insert_after
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|bitmap_element
modifier|*
name|elt
parameter_list|,
name|unsigned
name|int
name|indx
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|node
init|=
name|bitmap_element_allocate
argument_list|(
name|head
argument_list|)
decl_stmt|;
name|node
operator|->
name|indx
operator|=
name|indx
expr_stmt|;
if|if
condition|(
operator|!
name|elt
condition|)
block|{
if|if
condition|(
operator|!
name|head
operator|->
name|current
condition|)
block|{
name|head
operator|->
name|current
operator|=
name|node
expr_stmt|;
name|head
operator|->
name|indx
operator|=
name|indx
expr_stmt|;
block|}
name|node
operator|->
name|next
operator|=
name|head
operator|->
name|first
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|next
condition|)
name|node
operator|->
name|next
operator|->
name|prev
operator|=
name|node
expr_stmt|;
name|head
operator|->
name|first
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|prev
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|gcc_assert
argument_list|(
name|head
operator|->
name|current
argument_list|)
expr_stmt|;
name|node
operator|->
name|next
operator|=
name|elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|next
condition|)
name|node
operator|->
name|next
operator|->
name|prev
operator|=
name|node
expr_stmt|;
name|elt
operator|->
name|next
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|prev
operator|=
name|elt
expr_stmt|;
block|}
return|return
name|node
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Copy a bitmap to another bitmap.  */
end_comment

begin_function
name|void
name|bitmap_copy
parameter_list|(
name|bitmap
name|to
parameter_list|,
name|bitmap
name|from
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|from_ptr
decl_stmt|,
modifier|*
name|to_ptr
init|=
literal|0
decl_stmt|;
name|bitmap_clear
argument_list|(
name|to
argument_list|)
expr_stmt|;
comment|/* Copy elements in forward direction one at a time.  */
for|for
control|(
name|from_ptr
operator|=
name|from
operator|->
name|first
init|;
name|from_ptr
condition|;
name|from_ptr
operator|=
name|from_ptr
operator|->
name|next
control|)
block|{
name|bitmap_element
modifier|*
name|to_elt
init|=
name|bitmap_element_allocate
argument_list|(
name|to
argument_list|)
decl_stmt|;
name|to_elt
operator|->
name|indx
operator|=
name|from_ptr
operator|->
name|indx
expr_stmt|;
name|memcpy
argument_list|(
name|to_elt
operator|->
name|bits
argument_list|,
name|from_ptr
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|to_elt
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Here we have a special case of bitmap_element_link, for the case 	 where we know the links are being entered in sequence.  */
if|if
condition|(
name|to_ptr
operator|==
literal|0
condition|)
block|{
name|to
operator|->
name|first
operator|=
name|to
operator|->
name|current
operator|=
name|to_elt
expr_stmt|;
name|to
operator|->
name|indx
operator|=
name|from_ptr
operator|->
name|indx
expr_stmt|;
name|to_elt
operator|->
name|next
operator|=
name|to_elt
operator|->
name|prev
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|to_elt
operator|->
name|prev
operator|=
name|to_ptr
expr_stmt|;
name|to_elt
operator|->
name|next
operator|=
literal|0
expr_stmt|;
name|to_ptr
operator|->
name|next
operator|=
name|to_elt
expr_stmt|;
block|}
name|to_ptr
operator|=
name|to_elt
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Find a bitmap element that would hold a bitmap's bit.    Update the `current' field even if we can't find an element that    would hold the bitmap's bit to make eventual allocation    faster.  */
end_comment

begin_function
specifier|static
specifier|inline
name|bitmap_element
modifier|*
name|bitmap_find_bit
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|unsigned
name|int
name|bit
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|element
decl_stmt|;
name|unsigned
name|int
name|indx
init|=
name|bit
operator|/
name|BITMAP_ELEMENT_ALL_BITS
decl_stmt|;
if|if
condition|(
name|head
operator|->
name|current
operator|==
literal|0
operator|||
name|head
operator|->
name|indx
operator|==
name|indx
condition|)
return|return
name|head
operator|->
name|current
return|;
if|if
condition|(
name|head
operator|->
name|indx
operator|<
name|indx
condition|)
comment|/* INDX is beyond head->indx.  Search from head->current        forward.  */
for|for
control|(
name|element
operator|=
name|head
operator|->
name|current
init|;
name|element
operator|->
name|next
operator|!=
literal|0
operator|&&
name|element
operator|->
name|indx
operator|<
name|indx
condition|;
name|element
operator|=
name|element
operator|->
name|next
control|)
empty_stmt|;
elseif|else
if|if
condition|(
name|head
operator|->
name|indx
operator|/
literal|2
operator|<
name|indx
condition|)
comment|/* INDX is less than head->indx and closer to head->indx than to        0.  Search from head->current backward.  */
for|for
control|(
name|element
operator|=
name|head
operator|->
name|current
init|;
name|element
operator|->
name|prev
operator|!=
literal|0
operator|&&
name|element
operator|->
name|indx
operator|>
name|indx
condition|;
name|element
operator|=
name|element
operator|->
name|prev
control|)
empty_stmt|;
else|else
comment|/* INDX is less than head->indx and closer to 0 than to        head->indx.  Search from head->first forward.  */
for|for
control|(
name|element
operator|=
name|head
operator|->
name|first
init|;
name|element
operator|->
name|next
operator|!=
literal|0
operator|&&
name|element
operator|->
name|indx
operator|<
name|indx
condition|;
name|element
operator|=
name|element
operator|->
name|next
control|)
empty_stmt|;
comment|/* `element' is the nearest to the one we want.  If it's not the one we      want, the one we want doesn't exist.  */
name|head
operator|->
name|current
operator|=
name|element
expr_stmt|;
name|head
operator|->
name|indx
operator|=
name|element
operator|->
name|indx
expr_stmt|;
if|if
condition|(
name|element
operator|!=
literal|0
operator|&&
name|element
operator|->
name|indx
operator|!=
name|indx
condition|)
name|element
operator|=
literal|0
expr_stmt|;
return|return
name|element
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Clear a single bit in a bitmap.  */
end_comment

begin_function
name|void
name|bitmap_clear_bit
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|int
name|bit
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|ptr
init|=
name|bitmap_find_bit
argument_list|(
name|head
argument_list|,
name|bit
argument_list|)
decl_stmt|;
if|if
condition|(
name|ptr
operator|!=
literal|0
condition|)
block|{
name|unsigned
name|bit_num
init|=
name|bit
operator|%
name|BITMAP_WORD_BITS
decl_stmt|;
name|unsigned
name|word_num
init|=
name|bit
operator|/
name|BITMAP_WORD_BITS
operator|%
name|BITMAP_ELEMENT_WORDS
decl_stmt|;
name|ptr
operator|->
name|bits
index|[
name|word_num
index|]
operator|&=
operator|~
operator|(
operator|(
operator|(
name|BITMAP_WORD
operator|)
literal|1
operator|)
operator|<<
name|bit_num
operator|)
expr_stmt|;
comment|/* If we cleared the entire word, free up the element.  */
if|if
condition|(
name|bitmap_element_zerop
argument_list|(
name|ptr
argument_list|)
condition|)
name|bitmap_element_free
argument_list|(
name|head
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Set a single bit in a bitmap.  */
end_comment

begin_function
name|void
name|bitmap_set_bit
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|int
name|bit
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|ptr
init|=
name|bitmap_find_bit
argument_list|(
name|head
argument_list|,
name|bit
argument_list|)
decl_stmt|;
name|unsigned
name|word_num
init|=
name|bit
operator|/
name|BITMAP_WORD_BITS
operator|%
name|BITMAP_ELEMENT_WORDS
decl_stmt|;
name|unsigned
name|bit_num
init|=
name|bit
operator|%
name|BITMAP_WORD_BITS
decl_stmt|;
name|BITMAP_WORD
name|bit_val
init|=
operator|(
operator|(
name|BITMAP_WORD
operator|)
literal|1
operator|)
operator|<<
name|bit_num
decl_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
block|{
name|ptr
operator|=
name|bitmap_element_allocate
argument_list|(
name|head
argument_list|)
expr_stmt|;
name|ptr
operator|->
name|indx
operator|=
name|bit
operator|/
name|BITMAP_ELEMENT_ALL_BITS
expr_stmt|;
name|ptr
operator|->
name|bits
index|[
name|word_num
index|]
operator|=
name|bit_val
expr_stmt|;
name|bitmap_element_link
argument_list|(
name|head
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
block|}
else|else
name|ptr
operator|->
name|bits
index|[
name|word_num
index|]
operator||=
name|bit_val
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Return whether a bit is set within a bitmap.  */
end_comment

begin_function
name|int
name|bitmap_bit_p
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|int
name|bit
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|ptr
decl_stmt|;
name|unsigned
name|bit_num
decl_stmt|;
name|unsigned
name|word_num
decl_stmt|;
name|ptr
operator|=
name|bitmap_find_bit
argument_list|(
name|head
argument_list|,
name|bit
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
operator|==
literal|0
condition|)
return|return
literal|0
return|;
name|bit_num
operator|=
name|bit
operator|%
name|BITMAP_WORD_BITS
expr_stmt|;
name|word_num
operator|=
name|bit
operator|/
name|BITMAP_WORD_BITS
operator|%
name|BITMAP_ELEMENT_WORDS
expr_stmt|;
return|return
operator|(
name|ptr
operator|->
name|bits
index|[
name|word_num
index|]
operator|>>
name|bit_num
operator|)
operator|&
literal|1
return|;
block|}
end_function

begin_escape
end_escape

begin_if
if|#
directive|if
name|GCC_VERSION
operator|<
literal|3400
end_if

begin_comment
comment|/* Table of number of set bits in a character, indexed by value of char.  */
end_comment

begin_decl_stmt
specifier|static
name|unsigned
name|char
name|popcount_table
index|[]
init|=
block|{
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|6
block|,
literal|7
block|,
literal|7
block|,
literal|8
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|unsigned
name|long
name|bitmap_popcount
parameter_list|(
name|BITMAP_WORD
name|a
parameter_list|)
block|{
name|unsigned
name|long
name|ret
init|=
literal|0
decl_stmt|;
name|unsigned
name|i
decl_stmt|;
comment|/* Just do this the table way for now  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BITMAP_WORD_BITS
condition|;
name|i
operator|+=
literal|8
control|)
name|ret
operator|+=
name|popcount_table
index|[
operator|(
name|a
operator|>>
name|i
operator|)
operator|&
literal|0xff
index|]
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Count the number of bits set in the bitmap, and return it.  */
end_comment

begin_function
name|unsigned
name|long
name|bitmap_count_bits
parameter_list|(
name|bitmap
name|a
parameter_list|)
block|{
name|unsigned
name|long
name|count
init|=
literal|0
decl_stmt|;
name|bitmap_element
modifier|*
name|elt
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|elt
operator|=
name|a
operator|->
name|first
init|;
name|elt
condition|;
name|elt
operator|=
name|elt
operator|->
name|next
control|)
block|{
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|BITMAP_ELEMENT_WORDS
condition|;
name|ix
operator|++
control|)
block|{
if|#
directive|if
name|GCC_VERSION
operator|>=
literal|3400
comment|/* Note that popcountl matches BITMAP_WORD in type, so the actual size 	 of BITMAP_WORD is not material.  */
name|count
operator|+=
name|__builtin_popcountl
argument_list|(
name|elt
operator|->
name|bits
index|[
name|ix
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
name|count
operator|+=
name|bitmap_popcount
argument_list|(
name|elt
operator|->
name|bits
index|[
name|ix
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
return|return
name|count
return|;
block|}
end_function

begin_comment
comment|/* Return the bit number of the first set bit in the bitmap.  The    bitmap must be non-empty.  */
end_comment

begin_function
name|unsigned
name|bitmap_first_set_bit
parameter_list|(
name|bitmap
name|a
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|unsigned
name|bit_no
decl_stmt|;
name|BITMAP_WORD
name|word
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
name|gcc_assert
argument_list|(
name|elt
argument_list|)
expr_stmt|;
name|bit_no
operator|=
name|elt
operator|->
name|indx
operator|*
name|BITMAP_ELEMENT_ALL_BITS
expr_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|BITMAP_ELEMENT_WORDS
condition|;
name|ix
operator|++
control|)
block|{
name|word
operator|=
name|elt
operator|->
name|bits
index|[
name|ix
index|]
expr_stmt|;
if|if
condition|(
name|word
condition|)
goto|goto
name|found_bit
goto|;
block|}
name|gcc_unreachable
argument_list|()
expr_stmt|;
name|found_bit
label|:
name|bit_no
operator|+=
name|ix
operator|*
name|BITMAP_WORD_BITS
expr_stmt|;
if|#
directive|if
name|GCC_VERSION
operator|>=
literal|3004
name|gcc_assert
argument_list|(
sizeof|sizeof
argument_list|(
name|long
argument_list|)
operator|==
sizeof|sizeof
argument_list|(
name|word
argument_list|)
argument_list|)
expr_stmt|;
name|bit_no
operator|+=
name|__builtin_ctzl
argument_list|(
name|word
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* Binary search for the first set bit.  */
if|#
directive|if
name|BITMAP_WORD_BITS
operator|>
literal|64
error|#
directive|error
literal|"Fill out the table."
endif|#
directive|endif
if|#
directive|if
name|BITMAP_WORD_BITS
operator|>
literal|32
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0xffffffff
operator|)
condition|)
name|word
operator|>>=
literal|32
operator|,
name|bit_no
operator|+=
literal|32
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0xffff
operator|)
condition|)
name|word
operator|>>=
literal|16
operator|,
name|bit_no
operator|+=
literal|16
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0xff
operator|)
condition|)
name|word
operator|>>=
literal|8
operator|,
name|bit_no
operator|+=
literal|8
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0xf
operator|)
condition|)
name|word
operator|>>=
literal|4
operator|,
name|bit_no
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0x3
operator|)
condition|)
name|word
operator|>>=
literal|2
operator|,
name|bit_no
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|word
operator|&
literal|0x1
operator|)
condition|)
name|word
operator|>>=
literal|1
operator|,
name|bit_no
operator|+=
literal|1
expr_stmt|;
name|gcc_assert
argument_list|(
name|word
operator|&
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|bit_no
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* DST = A& B.  */
end_comment

begin_function
name|void
name|bitmap_and
parameter_list|(
name|bitmap
name|dst
parameter_list|,
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|dst_elt
init|=
name|dst
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|dst_prev
init|=
name|NULL
decl_stmt|;
name|gcc_assert
argument_list|(
name|dst
operator|!=
name|a
operator|&&
name|dst
operator|!=
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
block|{
name|bitmap_copy
argument_list|(
name|dst
argument_list|,
name|a
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|a_elt
operator|&&
name|b_elt
condition|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
comment|/* Matching elts, generate A& B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|a_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|a_elt
operator|->
name|indx
expr_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
block|}
if|if
condition|(
name|ior
condition|)
block|{
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|bitmap_elt_clear_from
argument_list|(
name|dst
argument_list|,
name|dst_elt
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|dst
operator|->
name|current
operator|==
operator|!
name|dst
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|current
condition|)
name|dst
operator|->
name|indx
operator|=
name|dst
operator|->
name|current
operator|->
name|indx
expr_stmt|;
block|}
end_function

begin_comment
comment|/* A&= B.  */
end_comment

begin_function
name|void
name|bitmap_and_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|next
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return;
while|while
condition|(
name|a_elt
operator|&&
name|b_elt
condition|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
block|{
name|next
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
comment|/* Matching elts, generate A&= B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
block|}
name|next
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|ior
condition|)
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|bitmap_elt_clear_from
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|==
operator|!
name|a
operator|->
name|first
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|||
name|a
operator|->
name|indx
operator|==
name|a
operator|->
name|current
operator|->
name|indx
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* DST = A& ~B  */
end_comment

begin_function
name|void
name|bitmap_and_compl
parameter_list|(
name|bitmap
name|dst
parameter_list|,
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|dst_elt
init|=
name|dst
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|dst_prev
init|=
name|NULL
decl_stmt|;
name|gcc_assert
argument_list|(
name|dst
operator|!=
name|a
operator|&&
name|dst
operator|!=
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
block|{
name|bitmap_clear
argument_list|(
name|dst
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|a_elt
condition|)
block|{
if|if
condition|(
operator|!
name|b_elt
operator|||
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
block|{
comment|/* Copy a_elt.  */
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|a_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|a_elt
operator|->
name|indx
expr_stmt|;
name|memcpy
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|,
name|a_elt
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
comment|/* Matching elts, generate A& ~B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|a_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|a_elt
operator|->
name|indx
expr_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
operator|~
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
block|}
if|if
condition|(
name|ior
condition|)
block|{
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|bitmap_elt_clear_from
argument_list|(
name|dst
argument_list|,
name|dst_elt
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|dst
operator|->
name|current
operator|==
operator|!
name|dst
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|current
condition|)
name|dst
operator|->
name|indx
operator|=
name|dst
operator|->
name|current
operator|->
name|indx
expr_stmt|;
block|}
end_function

begin_comment
comment|/* A&= ~B. Returns true if A changes */
end_comment

begin_function
name|bool
name|bitmap_and_compl_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|next
decl_stmt|;
name|BITMAP_WORD
name|changed
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
block|{
if|if
condition|(
name|bitmap_empty_p
argument_list|(
name|a
argument_list|)
condition|)
return|return
name|false
return|;
else|else
block|{
name|bitmap_clear
argument_list|(
name|a
argument_list|)
expr_stmt|;
return|return
name|true
return|;
block|}
block|}
while|while
condition|(
name|a_elt
operator|&&
name|b_elt
condition|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
comment|/* Matching elts, generate A&= ~B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|cleared
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|^
name|cleared
decl_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|changed
operator||=
name|cleared
expr_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
block|}
name|next
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|ior
condition|)
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|==
operator|!
name|a
operator|->
name|first
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|||
name|a
operator|->
name|indx
operator|==
name|a
operator|->
name|current
operator|->
name|indx
argument_list|)
expr_stmt|;
return|return
name|changed
operator|!=
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Clear COUNT bits from START in HEAD.  */
end_comment

begin_function
name|void
name|bitmap_clear_range
parameter_list|(
name|bitmap
name|head
parameter_list|,
name|unsigned
name|int
name|start
parameter_list|,
name|unsigned
name|int
name|count
parameter_list|)
block|{
name|unsigned
name|int
name|first_index
init|=
name|start
operator|/
name|BITMAP_ELEMENT_ALL_BITS
decl_stmt|;
name|unsigned
name|int
name|end_bit_plus1
init|=
name|start
operator|+
name|count
decl_stmt|;
name|unsigned
name|int
name|end_bit
init|=
name|end_bit_plus1
operator|-
literal|1
decl_stmt|;
name|unsigned
name|int
name|last_index
init|=
operator|(
name|end_bit
operator|)
operator|/
name|BITMAP_ELEMENT_ALL_BITS
decl_stmt|;
name|bitmap_element
modifier|*
name|elt
init|=
name|bitmap_find_bit
argument_list|(
name|head
argument_list|,
name|start
argument_list|)
decl_stmt|;
comment|/* If bitmap_find_bit returns zero, the current is the closest block      to the result.  If the current is less than first index, find the      next one.  Otherwise, just set elt to be current.  */
if|if
condition|(
operator|!
name|elt
condition|)
block|{
if|if
condition|(
name|head
operator|->
name|current
condition|)
block|{
if|if
condition|(
name|head
operator|->
name|indx
operator|<
name|first_index
condition|)
block|{
name|elt
operator|=
name|head
operator|->
name|current
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|elt
condition|)
return|return;
block|}
else|else
name|elt
operator|=
name|head
operator|->
name|current
expr_stmt|;
block|}
else|else
return|return;
block|}
while|while
condition|(
name|elt
operator|&&
operator|(
name|elt
operator|->
name|indx
operator|<=
name|last_index
operator|)
condition|)
block|{
name|bitmap_element
modifier|*
name|next_elt
init|=
name|elt
operator|->
name|next
decl_stmt|;
name|unsigned
name|elt_start_bit
init|=
operator|(
name|elt
operator|->
name|indx
operator|)
operator|*
name|BITMAP_ELEMENT_ALL_BITS
decl_stmt|;
name|unsigned
name|elt_end_bit_plus1
init|=
name|elt_start_bit
operator|+
name|BITMAP_ELEMENT_ALL_BITS
decl_stmt|;
if|if
condition|(
name|elt_start_bit
operator|>=
name|start
operator|&&
name|elt_end_bit_plus1
operator|<=
name|end_bit_plus1
condition|)
comment|/* Get rid of the entire elt and go to the next one.  */
name|bitmap_element_free
argument_list|(
name|head
argument_list|,
name|elt
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Going to have to knock out some bits in this elt.  */
name|unsigned
name|int
name|first_word_to_mod
decl_stmt|;
name|BITMAP_WORD
name|first_mask
decl_stmt|;
name|unsigned
name|int
name|last_word_to_mod
decl_stmt|;
name|BITMAP_WORD
name|last_mask
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|bool
name|clear
init|=
name|true
decl_stmt|;
if|if
condition|(
name|elt_start_bit
operator|<=
name|start
condition|)
block|{
comment|/* The first bit to turn off is somewhere inside this 		 elt.  */
name|first_word_to_mod
operator|=
operator|(
name|start
operator|-
name|elt_start_bit
operator|)
operator|/
name|BITMAP_WORD_BITS
expr_stmt|;
comment|/* This mask should have 1s in all bits>= start position. */
name|first_mask
operator|=
operator|(
operator|(
operator|(
name|BITMAP_WORD
operator|)
literal|1
operator|)
operator|<<
operator|(
operator|(
name|start
operator|%
name|BITMAP_WORD_BITS
operator|)
operator|)
operator|)
operator|-
literal|1
expr_stmt|;
name|first_mask
operator|=
operator|~
name|first_mask
expr_stmt|;
block|}
else|else
block|{
comment|/* The first bit to turn off is below this start of this elt.  */
name|first_word_to_mod
operator|=
literal|0
expr_stmt|;
name|first_mask
operator|=
literal|0
expr_stmt|;
name|first_mask
operator|=
operator|~
name|first_mask
expr_stmt|;
block|}
if|if
condition|(
name|elt_end_bit_plus1
operator|<=
name|end_bit_plus1
condition|)
block|{
comment|/* The last bit to turn off is beyond this elt.  */
name|last_word_to_mod
operator|=
name|BITMAP_ELEMENT_WORDS
operator|-
literal|1
expr_stmt|;
name|last_mask
operator|=
literal|0
expr_stmt|;
name|last_mask
operator|=
operator|~
name|last_mask
expr_stmt|;
block|}
else|else
block|{
comment|/* The last bit to turn off is inside to this elt.  */
name|last_word_to_mod
operator|=
operator|(
name|end_bit_plus1
operator|-
name|elt_start_bit
operator|)
operator|/
name|BITMAP_WORD_BITS
expr_stmt|;
comment|/* The last mask should have 1s below the end bit.  */
name|last_mask
operator|=
operator|(
operator|(
operator|(
name|BITMAP_WORD
operator|)
literal|1
operator|)
operator|<<
operator|(
operator|(
operator|(
name|end_bit_plus1
operator|)
operator|%
name|BITMAP_WORD_BITS
operator|)
operator|)
operator|)
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|first_word_to_mod
operator|==
name|last_word_to_mod
condition|)
block|{
name|BITMAP_WORD
name|mask
init|=
name|first_mask
operator|&
name|last_mask
decl_stmt|;
name|elt
operator|->
name|bits
index|[
name|first_word_to_mod
index|]
operator|&=
operator|~
name|mask
expr_stmt|;
block|}
else|else
block|{
name|elt
operator|->
name|bits
index|[
name|first_word_to_mod
index|]
operator|&=
operator|~
name|first_mask
expr_stmt|;
for|for
control|(
name|i
operator|=
name|first_word_to_mod
operator|+
literal|1
init|;
name|i
operator|<
name|last_word_to_mod
condition|;
name|i
operator|++
control|)
name|elt
operator|->
name|bits
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|elt
operator|->
name|bits
index|[
name|last_word_to_mod
index|]
operator|&=
operator|~
name|last_mask
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BITMAP_ELEMENT_WORDS
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|elt
operator|->
name|bits
index|[
name|i
index|]
condition|)
block|{
name|clear
operator|=
name|false
expr_stmt|;
break|break;
block|}
comment|/* Check to see if there are any bits left.  */
if|if
condition|(
name|clear
condition|)
name|bitmap_element_free
argument_list|(
name|head
argument_list|,
name|elt
argument_list|)
expr_stmt|;
block|}
name|elt
operator|=
name|next_elt
expr_stmt|;
block|}
if|if
condition|(
name|elt
condition|)
block|{
name|head
operator|->
name|current
operator|=
name|elt
expr_stmt|;
name|head
operator|->
name|indx
operator|=
name|head
operator|->
name|current
operator|->
name|indx
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* A = ~A& B. */
end_comment

begin_function
name|void
name|bitmap_compl_and_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_prev
init|=
name|NULL
decl_stmt|;
name|bitmap_element
modifier|*
name|next
decl_stmt|;
name|gcc_assert
argument_list|(
name|a
operator|!=
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitmap_empty_p
argument_list|(
name|a
argument_list|)
condition|)
block|{
name|bitmap_copy
argument_list|(
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|bitmap_empty_p
argument_list|(
name|b
argument_list|)
condition|)
block|{
name|bitmap_clear
argument_list|(
name|a
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|a_elt
operator|||
name|b_elt
condition|)
block|{
if|if
condition|(
operator|!
name|b_elt
operator|||
operator|(
name|a_elt
operator|&&
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
operator|)
condition|)
block|{
comment|/* A is before B.  Remove A */
name|next
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|a_prev
operator|=
name|a_elt
operator|->
name|prev
expr_stmt|;
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|a_elt
operator|||
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
block|{
comment|/* B is before A.  Copy B. */
name|next
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|a
argument_list|,
name|a_prev
argument_list|,
name|b_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|next
operator|->
name|bits
argument_list|,
name|b_elt
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|next
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
name|a_prev
operator|=
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
comment|/* Matching elts, generate A = ~A& B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|cleared
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|BITMAP_WORD
name|r
init|=
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|^
name|cleared
decl_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
block|}
name|next
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|ior
condition|)
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
else|else
name|a_prev
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|==
operator|!
name|a
operator|->
name|first
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|||
name|a
operator|->
name|indx
operator|==
name|a
operator|->
name|current
operator|->
name|indx
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/* DST = A | B.  Return true if DST changes.  */
end_comment

begin_function
name|bool
name|bitmap_ior
parameter_list|(
name|bitmap
name|dst
parameter_list|,
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|dst_elt
init|=
name|dst
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|dst_prev
init|=
name|NULL
decl_stmt|;
name|bool
name|changed
init|=
name|false
decl_stmt|;
name|gcc_assert
argument_list|(
name|dst
operator|!=
name|a
operator|&&
name|dst
operator|!=
name|b
argument_list|)
expr_stmt|;
while|while
condition|(
name|a_elt
operator|||
name|b_elt
condition|)
block|{
if|if
condition|(
name|a_elt
operator|&&
name|b_elt
operator|&&
name|a_elt
operator|->
name|indx
operator|==
name|b_elt
operator|->
name|indx
condition|)
block|{
comment|/* Matching elts, generate A | B.  */
name|unsigned
name|ix
decl_stmt|;
if|if
condition|(
operator|!
name|changed
operator|&&
name|dst_elt
operator|&&
name|dst_elt
operator|->
name|indx
operator|==
name|a_elt
operator|->
name|indx
condition|)
block|{
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator||
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
if|if
condition|(
name|r
operator|!=
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
condition|)
block|{
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
name|changed
operator|=
name|true
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|changed
operator|=
name|true
expr_stmt|;
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|a_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|a_elt
operator|->
name|indx
expr_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator||
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
block|}
block|}
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
comment|/* Copy a single element.  */
name|bitmap_element
modifier|*
name|src
decl_stmt|;
if|if
condition|(
operator|!
name|b_elt
operator|||
operator|(
name|a_elt
operator|&&
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
operator|)
condition|)
block|{
name|src
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|src
operator|=
name|b_elt
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|changed
operator|&&
name|dst_elt
operator|&&
name|dst_elt
operator|->
name|indx
operator|==
name|src
operator|->
name|indx
condition|)
block|{
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
if|if
condition|(
name|src
operator|->
name|bits
index|[
name|ix
index|]
operator|!=
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
condition|)
block|{
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|src
operator|->
name|bits
index|[
name|ix
index|]
expr_stmt|;
name|changed
operator|=
name|true
expr_stmt|;
block|}
block|}
else|else
block|{
name|changed
operator|=
name|true
expr_stmt|;
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|src
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|src
operator|->
name|indx
expr_stmt|;
name|memcpy
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|,
name|src
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dst_elt
condition|)
block|{
name|changed
operator|=
name|true
expr_stmt|;
name|bitmap_elt_clear_from
argument_list|(
name|dst
argument_list|,
name|dst_elt
argument_list|)
expr_stmt|;
block|}
name|gcc_assert
argument_list|(
operator|!
name|dst
operator|->
name|current
operator|==
operator|!
name|dst
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|current
condition|)
name|dst
operator|->
name|indx
operator|=
name|dst
operator|->
name|current
operator|->
name|indx
expr_stmt|;
return|return
name|changed
return|;
block|}
end_function

begin_comment
comment|/* A |= B.  Return true if A changes.  */
end_comment

begin_function
name|bool
name|bitmap_ior_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_prev
init|=
name|NULL
decl_stmt|;
name|bool
name|changed
init|=
name|false
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
return|return
name|false
return|;
while|while
condition|(
name|b_elt
condition|)
block|{
if|if
condition|(
operator|!
name|a_elt
operator|||
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
block|{
comment|/* Copy b_elt.  */
name|bitmap_element
modifier|*
name|dst
init|=
name|bitmap_elt_insert_after
argument_list|(
name|a
argument_list|,
name|a_prev
argument_list|,
name|b_elt
operator|->
name|indx
argument_list|)
decl_stmt|;
name|memcpy
argument_list|(
name|dst
operator|->
name|bits
argument_list|,
name|b_elt
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|dst
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
name|a_prev
operator|=
name|dst
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
name|changed
operator|=
name|true
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
block|{
name|a_prev
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
comment|/* Matching elts, generate A |= B.  */
name|unsigned
name|ix
decl_stmt|;
if|if
condition|(
name|changed
condition|)
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator||
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
block|}
else|else
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator||
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
if|if
condition|(
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|!=
name|r
condition|)
block|{
name|changed
operator|=
name|true
expr_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
block|}
block|}
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
name|a_prev
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|==
operator|!
name|a
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|->
name|current
condition|)
name|a
operator|->
name|indx
operator|=
name|a
operator|->
name|current
operator|->
name|indx
expr_stmt|;
return|return
name|changed
return|;
block|}
end_function

begin_comment
comment|/* DST = A ^ B  */
end_comment

begin_function
name|void
name|bitmap_xor
parameter_list|(
name|bitmap
name|dst
parameter_list|,
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|dst_elt
init|=
name|dst
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|dst_prev
init|=
name|NULL
decl_stmt|;
name|gcc_assert
argument_list|(
name|dst
operator|!=
name|a
operator|&&
name|dst
operator|!=
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
block|{
name|bitmap_clear
argument_list|(
name|dst
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|a_elt
operator|||
name|b_elt
condition|)
block|{
if|if
condition|(
name|a_elt
operator|&&
name|b_elt
operator|&&
name|a_elt
operator|->
name|indx
operator|==
name|b_elt
operator|->
name|indx
condition|)
block|{
comment|/* Matching elts, generate A ^ B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|a_elt
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|a_elt
operator|->
name|indx
expr_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|^
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
name|dst_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
block|}
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|ior
condition|)
block|{
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Copy a single element.  */
name|bitmap_element
modifier|*
name|src
decl_stmt|;
if|if
condition|(
operator|!
name|b_elt
operator|||
operator|(
name|a_elt
operator|&&
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
operator|)
condition|)
block|{
name|src
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
name|src
operator|=
name|b_elt
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|dst_elt
condition|)
name|dst_elt
operator|=
name|bitmap_elt_insert_after
argument_list|(
name|dst
argument_list|,
name|dst_prev
argument_list|,
name|src
operator|->
name|indx
argument_list|)
expr_stmt|;
else|else
name|dst_elt
operator|->
name|indx
operator|=
name|src
operator|->
name|indx
expr_stmt|;
name|memcpy
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|,
name|src
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|dst_elt
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
name|dst_prev
operator|=
name|dst_elt
expr_stmt|;
name|dst_elt
operator|=
name|dst_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
name|bitmap_elt_clear_from
argument_list|(
name|dst
argument_list|,
name|dst_elt
argument_list|)
expr_stmt|;
name|gcc_assert
argument_list|(
operator|!
name|dst
operator|->
name|current
operator|==
operator|!
name|dst
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|->
name|current
condition|)
name|dst
operator|->
name|indx
operator|=
name|dst
operator|->
name|current
operator|->
name|indx
expr_stmt|;
block|}
end_function

begin_comment
comment|/* A ^= B */
end_comment

begin_function
name|void
name|bitmap_xor_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
init|=
name|a
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
init|=
name|b
operator|->
name|first
decl_stmt|;
name|bitmap_element
modifier|*
name|a_prev
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|a
operator|==
name|b
condition|)
block|{
name|bitmap_clear
argument_list|(
name|a
argument_list|)
expr_stmt|;
return|return;
block|}
while|while
condition|(
name|b_elt
condition|)
block|{
if|if
condition|(
operator|!
name|a_elt
operator|||
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
block|{
comment|/* Copy b_elt.  */
name|bitmap_element
modifier|*
name|dst
init|=
name|bitmap_elt_insert_after
argument_list|(
name|a
argument_list|,
name|a_prev
argument_list|,
name|b_elt
operator|->
name|indx
argument_list|)
decl_stmt|;
name|memcpy
argument_list|(
name|dst
operator|->
name|bits
argument_list|,
name|b_elt
operator|->
name|bits
argument_list|,
sizeof|sizeof
argument_list|(
name|dst
operator|->
name|bits
argument_list|)
argument_list|)
expr_stmt|;
name|a_prev
operator|=
name|dst
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
block|{
name|a_prev
operator|=
name|a_elt
expr_stmt|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
block|}
else|else
block|{
comment|/* Matching elts, generate A ^= B.  */
name|unsigned
name|ix
decl_stmt|;
name|BITMAP_WORD
name|ior
init|=
literal|0
decl_stmt|;
name|bitmap_element
modifier|*
name|next
init|=
name|a_elt
operator|->
name|next
decl_stmt|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
block|{
name|BITMAP_WORD
name|r
init|=
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|^
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
decl_stmt|;
name|ior
operator||=
name|r
expr_stmt|;
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|=
name|r
expr_stmt|;
block|}
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|ior
condition|)
name|a_prev
operator|=
name|a_elt
expr_stmt|;
else|else
name|bitmap_element_free
argument_list|(
name|a
argument_list|,
name|a_elt
argument_list|)
expr_stmt|;
name|a_elt
operator|=
name|next
expr_stmt|;
block|}
block|}
name|gcc_assert
argument_list|(
operator|!
name|a
operator|->
name|current
operator|==
operator|!
name|a
operator|->
name|first
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
operator|->
name|current
condition|)
name|a
operator|->
name|indx
operator|=
name|a
operator|->
name|current
operator|->
name|indx
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Return true if two bitmaps are identical.    We do not bother with a check for pointer equality, as that never    occurs in practice.  */
end_comment

begin_function
name|bool
name|bitmap_equal_p
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|a_elt
operator|=
name|a
operator|->
name|first
operator|,
name|b_elt
operator|=
name|b
operator|->
name|first
init|;
name|a_elt
operator|&&
name|b_elt
condition|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
operator|,
name|b_elt
operator|=
name|b_elt
operator|->
name|next
control|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|!=
name|b_elt
operator|->
name|indx
condition|)
return|return
name|false
return|;
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
if|if
condition|(
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|!=
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
condition|)
return|return
name|false
return|;
block|}
return|return
operator|!
name|a_elt
operator|&&
operator|!
name|b_elt
return|;
block|}
end_function

begin_comment
comment|/* Return true if A AND B is not empty.  */
end_comment

begin_function
name|bool
name|bitmap_intersect_p
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|a_elt
operator|=
name|a
operator|->
name|first
operator|,
name|b_elt
operator|=
name|b
operator|->
name|first
init|;
name|a_elt
operator|&&
name|b_elt
condition|;
control|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
if|if
condition|(
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
condition|)
return|return
name|true
return|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
return|return
name|false
return|;
block|}
end_function

begin_comment
comment|/* Return true if A AND NOT B is not empty.  */
end_comment

begin_function
name|bool
name|bitmap_intersect_compl_p
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|b
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|a_elt
decl_stmt|;
name|bitmap_element
modifier|*
name|b_elt
decl_stmt|;
name|unsigned
name|ix
decl_stmt|;
for|for
control|(
name|a_elt
operator|=
name|a
operator|->
name|first
operator|,
name|b_elt
operator|=
name|b
operator|->
name|first
init|;
name|a_elt
operator|&&
name|b_elt
condition|;
control|)
block|{
if|if
condition|(
name|a_elt
operator|->
name|indx
operator|<
name|b_elt
operator|->
name|indx
condition|)
return|return
name|true
return|;
elseif|else
if|if
condition|(
name|b_elt
operator|->
name|indx
operator|<
name|a_elt
operator|->
name|indx
condition|)
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
else|else
block|{
for|for
control|(
name|ix
operator|=
name|BITMAP_ELEMENT_WORDS
init|;
name|ix
operator|--
condition|;
control|)
if|if
condition|(
name|a_elt
operator|->
name|bits
index|[
name|ix
index|]
operator|&
operator|~
name|b_elt
operator|->
name|bits
index|[
name|ix
index|]
condition|)
return|return
name|true
return|;
name|a_elt
operator|=
name|a_elt
operator|->
name|next
expr_stmt|;
name|b_elt
operator|=
name|b_elt
operator|->
name|next
expr_stmt|;
block|}
block|}
return|return
name|a_elt
operator|!=
name|NULL
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* DST = A | (FROM1& ~FROM2).  Return true if DST changes.  */
end_comment

begin_function
name|bool
name|bitmap_ior_and_compl
parameter_list|(
name|bitmap
name|dst
parameter_list|,
name|bitmap
name|a
parameter_list|,
name|bitmap
name|from1
parameter_list|,
name|bitmap
name|from2
parameter_list|)
block|{
name|bitmap_head
name|tmp
decl_stmt|;
name|bool
name|changed
decl_stmt|;
name|bitmap_initialize
argument_list|(
operator|&
name|tmp
argument_list|,
operator|&
name|bitmap_default_obstack
argument_list|)
expr_stmt|;
name|bitmap_and_compl
argument_list|(
operator|&
name|tmp
argument_list|,
name|from1
argument_list|,
name|from2
argument_list|)
expr_stmt|;
name|changed
operator|=
name|bitmap_ior
argument_list|(
name|dst
argument_list|,
name|a
argument_list|,
operator|&
name|tmp
argument_list|)
expr_stmt|;
name|bitmap_clear
argument_list|(
operator|&
name|tmp
argument_list|)
expr_stmt|;
return|return
name|changed
return|;
block|}
end_function

begin_comment
comment|/* A |= (FROM1& ~FROM2).  Return true if A changes.  */
end_comment

begin_function
name|bool
name|bitmap_ior_and_compl_into
parameter_list|(
name|bitmap
name|a
parameter_list|,
name|bitmap
name|from1
parameter_list|,
name|bitmap
name|from2
parameter_list|)
block|{
name|bitmap_head
name|tmp
decl_stmt|;
name|bool
name|changed
decl_stmt|;
name|bitmap_initialize
argument_list|(
operator|&
name|tmp
argument_list|,
operator|&
name|bitmap_default_obstack
argument_list|)
expr_stmt|;
name|bitmap_and_compl
argument_list|(
operator|&
name|tmp
argument_list|,
name|from1
argument_list|,
name|from2
argument_list|)
expr_stmt|;
name|changed
operator|=
name|bitmap_ior_into
argument_list|(
name|a
argument_list|,
operator|&
name|tmp
argument_list|)
expr_stmt|;
name|bitmap_clear
argument_list|(
operator|&
name|tmp
argument_list|)
expr_stmt|;
return|return
name|changed
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Debugging function to print out the contents of a bitmap.  */
end_comment

begin_function
name|void
name|debug_bitmap_file
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|bitmap
name|head
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|ptr
decl_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\nfirst = %p current = %p indx = %u\n"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|head
operator|->
name|first
argument_list|,
operator|(
name|void
operator|*
operator|)
name|head
operator|->
name|current
argument_list|,
name|head
operator|->
name|indx
argument_list|)
expr_stmt|;
for|for
control|(
name|ptr
operator|=
name|head
operator|->
name|first
init|;
name|ptr
condition|;
name|ptr
operator|=
name|ptr
operator|->
name|next
control|)
block|{
name|unsigned
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|col
init|=
literal|26
decl_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t%p next = %p prev = %p indx = %u\n\t\tbits = {"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ptr
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ptr
operator|->
name|next
argument_list|,
operator|(
name|void
operator|*
operator|)
name|ptr
operator|->
name|prev
argument_list|,
name|ptr
operator|->
name|indx
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|BITMAP_ELEMENT_WORDS
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|BITMAP_WORD_BITS
condition|;
name|j
operator|++
control|)
if|if
condition|(
operator|(
name|ptr
operator|->
name|bits
index|[
name|i
index|]
operator|>>
name|j
operator|)
operator|&
literal|1
condition|)
block|{
if|if
condition|(
name|col
operator|>
literal|70
condition|)
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\n\t\t\t"
argument_list|)
expr_stmt|;
name|col
operator|=
literal|24
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" %u"
argument_list|,
operator|(
name|ptr
operator|->
name|indx
operator|*
name|BITMAP_ELEMENT_ALL_BITS
operator|+
name|i
operator|*
name|BITMAP_WORD_BITS
operator|+
name|j
operator|)
argument_list|)
expr_stmt|;
name|col
operator|+=
literal|4
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" }\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Function to be called from the debugger to print the contents    of a bitmap.  */
end_comment

begin_function
name|void
name|debug_bitmap
parameter_list|(
name|bitmap
name|head
parameter_list|)
block|{
name|debug_bitmap_file
argument_list|(
name|stdout
argument_list|,
name|head
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Function to print out the contents of a bitmap.  Unlike debug_bitmap_file,    it does not print anything but the bits.  */
end_comment

begin_function
name|void
name|bitmap_print
parameter_list|(
name|FILE
modifier|*
name|file
parameter_list|,
name|bitmap
name|head
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
specifier|const
name|char
modifier|*
name|suffix
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|comma
init|=
literal|""
decl_stmt|;
name|unsigned
name|i
decl_stmt|;
name|bitmap_iterator
name|bi
decl_stmt|;
name|fputs
argument_list|(
name|prefix
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|EXECUTE_IF_SET_IN_BITMAP
argument_list|(
argument|head
argument_list|,
literal|0
argument_list|,
argument|i
argument_list|,
argument|bi
argument_list|)
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"%s%d"
argument_list|,
name|comma
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|", "
expr_stmt|;
block|}
name|fputs
argument_list|(
name|suffix
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Compute hash of bitmap (for purposes of hashing).  */
end_comment

begin_function
name|hashval_t
name|bitmap_hash
parameter_list|(
name|bitmap
name|head
parameter_list|)
block|{
name|bitmap_element
modifier|*
name|ptr
decl_stmt|;
name|BITMAP_WORD
name|hash
init|=
literal|0
decl_stmt|;
name|int
name|ix
decl_stmt|;
for|for
control|(
name|ptr
operator|=
name|head
operator|->
name|first
init|;
name|ptr
condition|;
name|ptr
operator|=
name|ptr
operator|->
name|next
control|)
block|{
name|hash
operator|^=
name|ptr
operator|->
name|indx
expr_stmt|;
for|for
control|(
name|ix
operator|=
literal|0
init|;
name|ix
operator|!=
name|BITMAP_ELEMENT_WORDS
condition|;
name|ix
operator|++
control|)
name|hash
operator|^=
name|ptr
operator|->
name|bits
index|[
name|ix
index|]
expr_stmt|;
block|}
return|return
operator|(
name|hashval_t
operator|)
name|hash
return|;
block|}
end_function

begin_include
include|#
directive|include
file|"gt-bitmap.h"
end_include

end_unit

