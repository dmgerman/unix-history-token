begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// RUN: clang-cc %s -fsyntax-only -verify
end_comment

begin_comment
comment|// Packed structs.
end_comment

begin_struct
struct|struct
name|s
block|{
name|char
name|a
decl_stmt|;
name|int
name|b
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
decl_stmt|;
name|char
name|c
decl_stmt|;
name|int
name|d
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|a1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|s
argument_list|)
operator|==
literal|12
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|a2
index|[
name|__alignof
argument_list|(
expr|struct
name|s
argument_list|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|__attribute__
argument_list|(
argument|(packed)
argument_list|)
name|packed_s
block|{
name|char
name|a
decl_stmt|;
name|int
name|b
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
decl_stmt|;
name|char
name|c
decl_stmt|;
name|int
name|d
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|b1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|packed_s
argument_list|)
operator|==
literal|10
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|b2
index|[
name|__alignof
argument_list|(
expr|struct
name|packed_s
argument_list|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|fas
block|{
name|char
name|a
decl_stmt|;
name|int
name|b
index|[]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|c1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|fas
argument_list|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|c2
index|[
name|__alignof
argument_list|(
expr|struct
name|fas
argument_list|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|__attribute__
argument_list|(
argument|(packed)
argument_list|)
name|packed_fas
block|{
name|char
name|a
decl_stmt|;
name|int
name|b
index|[]
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|d1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|packed_fas
argument_list|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|d2
index|[
name|__alignof
argument_list|(
expr|struct
name|packed_fas
argument_list|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|// Alignment
end_comment

begin_struct
struct|struct
name|__attribute__
argument_list|(
argument|(aligned(
literal|8
argument|))
argument_list|)
name|as1
block|{
name|char
name|c
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|e1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|as1
argument_list|)
operator|==
literal|8
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|e2
index|[
name|__alignof
argument_list|(
expr|struct
name|as1
argument_list|)
operator|==
literal|8
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|// FIXME: Will need to force arch once max usable alignment isn't hard
end_comment

begin_comment
comment|// coded.
end_comment

begin_struct
struct|struct
name|__attribute__
argument_list|(
argument|(aligned)
argument_list|)
name|as1_2
block|{
name|char
name|c
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|e1_2
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|as1_2
argument_list|)
operator|==
literal|16
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|e2_2
index|[
name|__alignof
argument_list|(
expr|struct
name|as1_2
argument_list|)
operator|==
literal|16
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|as2
block|{
name|char
name|c
decl_stmt|;
name|int
name|__attribute__
argument_list|(
operator|(
name|aligned
argument_list|(
literal|8
argument_list|)
operator|)
argument_list|)
name|a
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|f1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|as2
argument_list|)
operator|==
literal|16
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|f2
index|[
name|__alignof
argument_list|(
expr|struct
name|as2
argument_list|)
operator|==
literal|8
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_struct
struct|struct
name|__attribute__
argument_list|(
argument|(packed)
argument_list|)
name|as3
block|{
name|char
name|c
decl_stmt|;
name|int
name|a
decl_stmt|;
name|int
name|__attribute__
argument_list|(
operator|(
name|aligned
argument_list|(
literal|8
argument_list|)
operator|)
argument_list|)
name|b
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|g1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|as3
argument_list|)
operator|==
literal|16
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|g2
index|[
name|__alignof
argument_list|(
expr|struct
name|as3
argument_list|)
operator|==
literal|8
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_comment
comment|// rdar://5921025
end_comment

begin_struct
struct|struct
name|packedtest
block|{
name|int
name|ted_likes_cheese
decl_stmt|;
name|void
modifier|*
name|args
index|[]
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|// Packed union
end_comment

begin_union
union|union
name|__attribute__
argument_list|(
argument|(packed)
argument_list|)
name|au4
block|{
name|char
name|c
decl_stmt|;
name|int
name|x
decl_stmt|;
block|}
union|;
end_union

begin_extern
extern|extern int h1[sizeof(union au4
end_extern

begin_expr_stmt
unit|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_extern
extern|extern int h2[__alignof(union au4
end_extern

begin_expr_stmt
unit|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_comment
comment|// Aligned union
end_comment

begin_union
union|union
name|au5
block|{
name|__attribute__
argument_list|(
argument|(aligned(
literal|4
argument|))
argument_list|)
name|char
name|c
decl_stmt|;
block|}
union|;
end_union

begin_extern
extern|extern int h1[sizeof(union au5
end_extern

begin_expr_stmt
unit|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_extern
extern|extern int h2[__alignof(union au5
end_extern

begin_expr_stmt
unit|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_comment
comment|// Alignment+packed
end_comment

begin_struct
struct|struct
name|as6
block|{
name|char
name|c
decl_stmt|;
name|__attribute__
argument_list|(
argument|(packed, aligned(
literal|2
argument|))
argument_list|)
name|int
name|x
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|i1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|as6
argument_list|)
operator|==
literal|6
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|i2
index|[
name|__alignof
argument_list|(
expr|struct
name|as6
argument_list|)
operator|==
literal|2
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_union
union|union
name|au6
block|{
name|char
name|c
decl_stmt|;
name|__attribute__
argument_list|(
argument|(packed, aligned(
literal|2
argument|))
argument_list|)
name|int
name|x
decl_stmt|;
block|}
union|;
end_union

begin_extern
extern|extern int k1[sizeof(union au6
end_extern

begin_expr_stmt
unit|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_extern
extern|extern int k2[__alignof(union au6
end_extern

begin_expr_stmt
unit|)
operator|==
literal|2
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_comment
comment|// Check postfix attributes
end_comment

begin_union
union|union
name|au7
block|{
name|char
name|c
decl_stmt|;
name|int
name|x
decl_stmt|;
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
union|;
end_union

begin_extern
extern|extern int l1[sizeof(union au7
end_extern

begin_expr_stmt
unit|)
operator|==
literal|4
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_extern
extern|extern int l2[__alignof(union au7
end_extern

begin_expr_stmt
unit|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
expr|]
expr_stmt|;
end_expr_stmt

begin_struct
struct|struct
name|packed_fas2
block|{
name|char
name|a
decl_stmt|;
name|int
name|b
index|[]
decl_stmt|;
block|}
name|__attribute__
argument_list|(
operator|(
name|packed
operator|)
argument_list|)
struct|;
end_struct

begin_decl_stmt
specifier|extern
name|int
name|m1
index|[
sizeof|sizeof
argument_list|(
expr|struct
name|packed_fas2
argument_list|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|m2
index|[
name|__alignof
argument_list|(
expr|struct
name|packed_fas2
argument_list|)
operator|==
literal|1
condition|?
literal|1
else|:
operator|-
literal|1
index|]
decl_stmt|;
end_decl_stmt

end_unit

