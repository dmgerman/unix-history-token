begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// RUN: clang -cc1 -rewrite-blocks %s -fblocks -o -
end_comment

begin_function_decl
specifier|static
name|int
function_decl|(
modifier|^
name|block
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
init|=
operator|(
name|int
argument_list|(
operator|^
argument_list|)
operator|(
specifier|const
name|void
operator|*
call|,
specifier|const
name|void
operator|*
operator|)
operator|)
literal|0
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|int
function_decl|(
modifier|^
name|block
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|void
modifier|*
parameter_list|)
parameter_list|)
init|=
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
name|int
argument_list|(
operator|^
name|block
argument_list|)
operator|(
name|void
operator|*
call|,
name|void
operator|*
operator|)
operator|)
operator|)
literal|0
function_decl|;
end_function_decl

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|^
name|block_T
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|*
name|func_T
function_decl|)
parameter_list|(
name|int
function_decl|(
modifier|^
name|block
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|void
modifier|*
parameter_list|)
parameter_list|)
function_decl|;
end_typedef

begin_function
name|void
name|foo
parameter_list|(
specifier|const
name|void
modifier|*
name|a
parameter_list|,
specifier|const
name|void
modifier|*
name|b
parameter_list|,
name|void
modifier|*
name|c
parameter_list|)
block|{
name|int
function_decl|(
modifier|^
name|block
function_decl|)
parameter_list|(
specifier|const
name|void
modifier|*
parameter_list|,
specifier|const
name|void
modifier|*
parameter_list|)
init|=
operator|(
name|int
argument_list|(
operator|^
argument_list|)
operator|(
specifier|const
name|void
operator|*
call|,
specifier|const
name|void
operator|*
operator|)
operator|)
name|c
function_decl|;
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|int
function_decl|(
modifier|^
name|block
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|void
modifier|*
parameter_list|)
parameter_list|)
init|=
operator|(
name|int
argument_list|(
operator|*
argument_list|)
operator|(
name|int
argument_list|(
operator|^
name|block
argument_list|)
operator|(
name|void
operator|*
call|,
name|void
operator|*
operator|)
operator|)
operator|)
name|c
function_decl|;
block|}
end_function

begin_typedef
typedef|typedef
name|void
function_decl|(
modifier|^
name|test_block_t
function_decl|)
parameter_list|()
function_decl|;
end_typedef

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|int
name|a
decl_stmt|;
name|void
function_decl|(
modifier|^
name|test_block_v
function_decl|)
parameter_list|()
function_decl|;
name|void
function_decl|(
modifier|^
name|test_block_v2
function_decl|)
parameter_list|(
name|int
parameter_list|,
name|float
parameter_list|)
function_decl|;
name|void
function_decl|(
modifier|^
name|test_block_v3
function_decl|)
parameter_list|(
name|void
function_decl|(
modifier|^
name|barg
function_decl|)
parameter_list|(
name|int
parameter_list|)
parameter_list|)
function_decl|;
name|a
operator|=
literal|77
expr_stmt|;
name|test_block_v
operator|=
lambda|^
parameter_list|()
block|{
name|int
name|local
init|=
literal|1
decl_stmt|;
name|printf
argument_list|(
literal|"a=%d\n"
argument_list|,
name|a
operator|+
name|local
argument_list|)
expr_stmt|;
block|}
expr_stmt|;
name|test_block_v
argument_list|()
expr_stmt|;
name|a
operator|++
expr_stmt|;
name|test_block_v
argument_list|()
expr_stmt|;
specifier|__block
name|int
name|b
decl_stmt|;
name|b
operator|=
literal|88
expr_stmt|;
name|test_block_v2
operator|=
lambda|^
parameter_list|(
name|int
name|x
parameter_list|,
name|float
name|f
parameter_list|)
block|{
name|printf
argument_list|(
literal|"b=%d\n"
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
expr_stmt|;
name|test_block_v2
argument_list|(
literal|1
argument_list|,
literal|2.0
argument_list|)
expr_stmt|;
name|b
operator|++
expr_stmt|;
name|test_block_v2
argument_list|(
literal|3
argument_list|,
literal|4.0
argument_list|)
expr_stmt|;
return|return
literal|7
return|;
block|}
end_function

end_unit

