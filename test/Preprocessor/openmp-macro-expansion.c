begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// RUN:   %clang_cc1 -fopenmp -E -o - %s 2>&1 | FileCheck %s
end_comment

begin_comment
comment|// This is to make sure the pragma name is not expanded!
end_comment

begin_define
define|#
directive|define
name|omp
value|(0xDEADBEEF)
end_define

begin_define
define|#
directive|define
name|N
value|2
end_define

begin_define
define|#
directive|define
name|M
value|1
end_define

begin_define
define|#
directive|define
name|E
value|N>
end_define

begin_define
define|#
directive|define
name|map_to_be_expanded
parameter_list|(
name|x
parameter_list|)
value|map(tofrom:x)
end_define

begin_define
define|#
directive|define
name|sched_to_be_expanded
parameter_list|(
name|x
parameter_list|,
name|s
parameter_list|)
value|schedule(x,s)
end_define

begin_define
define|#
directive|define
name|reda_to_be_expanded
parameter_list|(
name|x
parameter_list|)
value|reduction(+:x)
end_define

begin_define
define|#
directive|define
name|redb_to_be_expanded
parameter_list|(
name|x
parameter_list|,
name|op
parameter_list|)
value|reduction(op:x)
end_define

begin_function
name|void
name|foo
parameter_list|(
name|int
modifier|*
name|a
parameter_list|,
name|int
modifier|*
name|b
parameter_list|)
block|{
comment|//CHECK: omp target map(a[0:2]) map(tofrom:b[0:2*1])
pragma|#
directive|pragma
name|omp
name|target
name|map
name|(
name|a
name|[
name|0
name|:
name|N
name|]
name|)
name|map_to_be_expanded
name|(
name|b
name|[
name|0
name|:
name|2
name|*
name|M
name|]
name|)
block|{
name|int
name|reda
decl_stmt|;
name|int
name|redb
decl_stmt|;
comment|//CHECK: omp parallel for schedule(static,2>>1) reduction(+:reda) reduction(*:redb)
pragma|#
directive|pragma
name|omp
name|parallel
name|for
name|sched_to_be_expanded
name|(
name|static
name|,
name|E
name|>
name|1
name|)
pragma|\
name|reda_to_be_expanded
name|(
name|reda
name|)
name|redb_to_be_expanded
name|(
name|redb
name|,
name|*
name|)
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|N
condition|;
operator|++
name|i
control|)
block|{
name|reda
operator|+=
name|a
index|[
name|i
index|]
expr_stmt|;
name|redb
operator|+=
name|b
index|[
name|i
index|]
expr_stmt|;
block|}
name|a
index|[
literal|0
index|]
operator|=
name|reda
expr_stmt|;
name|b
index|[
literal|0
index|]
operator|=
name|redb
expr_stmt|;
block|}
block|}
end_function

end_unit

