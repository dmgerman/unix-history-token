begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// Test CodeGen for Security Check Overflow Builtins.
end_comment

begin_comment
comment|// rdar://13421498
end_comment

begin_comment
comment|// RUN: %clang_cc1 -triple "i686-unknown-unknown"   -emit-llvm -x c %s -o - | FileCheck %s
end_comment

begin_comment
comment|// RUN: %clang_cc1 -triple "x86_64-unknown-unknown" -emit-llvm -x c %s -o - | FileCheck %s
end_comment

begin_comment
comment|// RUN: %clang_cc1 -triple "x86_64-mingw32"         -emit-llvm -x c %s -o - | FileCheck %s
end_comment

begin_decl_stmt
specifier|extern
name|unsigned
name|UnsignedErrorCode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|unsigned
name|long
name|UnsignedLongErrorCode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|unsigned
name|long
name|long
name|UnsignedLongLongErrorCode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|IntErrorCode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|long
name|LongErrorCode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|long
name|long
name|LongLongErrorCode
decl_stmt|;
end_decl_stmt

begin_function
name|unsigned
name|test_uadd_overflow
parameter_list|(
name|unsigned
name|x
parameter_list|,
name|unsigned
name|y
parameter_list|)
block|{
comment|// CHECK: @test_uadd_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.uadd.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|unsigned
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_uadd_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|test_uaddl_overflow
parameter_list|(
name|unsigned
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_uaddl_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.uadd.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|unsigned
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_uaddl_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|long
name|test_uaddll_overflow
parameter_list|(
name|unsigned
name|long
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_uaddll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.uadd.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|unsigned
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_uaddll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|test_usub_overflow
parameter_list|(
name|unsigned
name|x
parameter_list|,
name|unsigned
name|y
parameter_list|)
block|{
comment|// CHECK: @test_usub_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.usub.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|unsigned
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_usub_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|test_usubl_overflow
parameter_list|(
name|unsigned
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_usubl_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.usub.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|unsigned
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_usubl_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|long
name|test_usubll_overflow
parameter_list|(
name|unsigned
name|long
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_usubll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.usub.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|unsigned
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_usubll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|test_umul_overflow
parameter_list|(
name|unsigned
name|x
parameter_list|,
name|unsigned
name|y
parameter_list|)
block|{
comment|// CHECK: @test_umul_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.umul.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|unsigned
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_umul_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|test_umull_overflow
parameter_list|(
name|unsigned
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_umull_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.umul.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|unsigned
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_umull_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|unsigned
name|long
name|long
name|test_umulll_overflow
parameter_list|(
name|unsigned
name|long
name|long
name|x
parameter_list|,
name|unsigned
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_umulll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.umul.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|unsigned
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_umulll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|UnsignedLongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|int
name|test_sadd_overflow
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
comment|// CHECK: @test_sadd_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.sadd.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|int
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_sadd_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|IntErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|test_saddl_overflow
parameter_list|(
name|long
name|x
parameter_list|,
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_saddl_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.sadd.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_saddl_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|long
name|test_saddll_overflow
parameter_list|(
name|long
name|long
name|x
parameter_list|,
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_saddll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.sadd.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_saddll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|int
name|test_ssub_overflow
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
comment|// CHECK: @test_ssub_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.ssub.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|int
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_ssub_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|IntErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|test_ssubl_overflow
parameter_list|(
name|long
name|x
parameter_list|,
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_ssubl_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.ssub.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_ssubl_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|long
name|test_ssubll_overflow
parameter_list|(
name|long
name|long
name|x
parameter_list|,
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_ssubll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.ssub.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_ssubll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|int
name|test_smul_overflow
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
comment|// CHECK: @test_smul_overflow
comment|// CHECK: %{{.+}} = call { i32, i1 } @llvm.smul.with.overflow.i32(i32 %{{.+}}, i32 %{{.+}})
name|int
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_smul_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|IntErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|test_smull_overflow
parameter_list|(
name|long
name|x
parameter_list|,
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_smull_overflow([[UL:i32|i64]] %x
comment|// CHECK: %{{.+}} = call { [[UL]], i1 } @llvm.smul.with.overflow.[[UL]]([[UL]] %{{.+}}, [[UL]] %{{.+}})
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_smull_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|long
name|long
name|test_smulll_overflow
parameter_list|(
name|long
name|long
name|x
parameter_list|,
name|long
name|long
name|y
parameter_list|)
block|{
comment|// CHECK: @test_smulll_overflow
comment|// CHECK: %{{.+}} = call { i64, i1 } @llvm.smul.with.overflow.i64(i64 %{{.+}}, i64 %{{.+}})
name|long
name|long
name|result
decl_stmt|;
if|if
condition|(
name|__builtin_smulll_overflow
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|result
argument_list|)
condition|)
return|return
name|LongLongErrorCode
return|;
return|return
name|result
return|;
block|}
end_function

end_unit

