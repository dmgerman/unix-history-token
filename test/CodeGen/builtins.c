begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// RUN: %clang_cc1 -emit-llvm -o %t %s
end_comment

begin_comment
comment|// RUN: not grep __builtin %t
end_comment

begin_comment
comment|// RUN: %clang_cc1 %s -emit-llvm -o - -triple x86_64-darwin-apple | FileCheck %s
end_comment

begin_function_decl
name|int
name|printf
parameter_list|(
specifier|const
name|char
modifier|*
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
name|p
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|int
name|x
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s: %d\n"
argument_list|,
name|str
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|q
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|double
name|x
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s: %f\n"
argument_list|,
name|str
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|r
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|void
modifier|*
name|ptr
parameter_list|)
block|{
name|printf
argument_list|(
literal|"%s: %p\n"
argument_list|,
name|str
argument_list|,
name|ptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
name|int
name|random
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|int
name|main
parameter_list|()
block|{
name|int
name|N
init|=
name|random
argument_list|()
decl_stmt|;
define|#
directive|define
name|P
parameter_list|(
name|n
parameter_list|,
name|args
parameter_list|)
value|p(#n #args, __builtin_##n args)
define|#
directive|define
name|Q
parameter_list|(
name|n
parameter_list|,
name|args
parameter_list|)
value|q(#n #args, __builtin_##n args)
define|#
directive|define
name|R
parameter_list|(
name|n
parameter_list|,
name|args
parameter_list|)
value|r(#n #args, __builtin_##n args)
define|#
directive|define
name|V
parameter_list|(
name|n
parameter_list|,
name|args
parameter_list|)
value|p(#n #args, (__builtin_##n args, 0))
name|P
argument_list|(
name|types_compatible_p
argument_list|,
operator|(
name|int
operator|,
name|float
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|choose_expr
argument_list|,
operator|(
literal|0
operator|,
literal|10
operator|,
literal|20
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|constant_p
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
literal|10
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|expect
argument_list|,
operator|(
name|N
operator|==
literal|12
operator|,
literal|0
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|prefetch
argument_list|,
operator|(
operator|&
name|N
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|prefetch
argument_list|,
operator|(
operator|&
name|N
operator|,
literal|1
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|prefetch
argument_list|,
operator|(
operator|&
name|N
operator|,
literal|1
operator|,
literal|0
operator|)
argument_list|)
expr_stmt|;
comment|// Numeric Constants
name|Q
argument_list|(
name|huge_val
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|huge_valf
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|huge_vall
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|inf
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|inff
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|infl
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|fpclassify
argument_list|,
operator|(
literal|0
operator|,
literal|1
operator|,
literal|2
operator|,
literal|3
operator|,
literal|4
operator|,
literal|1.0
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|fpclassify
argument_list|,
operator|(
literal|0
operator|,
literal|1
operator|,
literal|2
operator|,
literal|3
operator|,
literal|4
operator|,
literal|1.0f
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|fpclassify
argument_list|,
operator|(
literal|0
operator|,
literal|1
operator|,
literal|2
operator|,
literal|3
operator|,
literal|4
operator|,
literal|1.0l
operator|)
argument_list|)
expr_stmt|;
comment|// FIXME:
comment|//  P(isinf_sign, (1.0));
name|Q
argument_list|(
name|nan
argument_list|,
operator|(
literal|""
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nanf
argument_list|,
operator|(
literal|""
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nanl
argument_list|,
operator|(
literal|""
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nans
argument_list|,
operator|(
literal|""
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nan
argument_list|,
operator|(
literal|"10"
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nanf
argument_list|,
operator|(
literal|"10"
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nanl
argument_list|,
operator|(
literal|"10"
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|nans
argument_list|,
operator|(
literal|"10"
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|isgreater
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|isgreaterequal
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|isless
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|islessequal
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|islessgreater
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|isunordered
argument_list|,
operator|(
literal|1.
operator|,
literal|2.
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|isnan
argument_list|,
operator|(
literal|1.
operator|)
argument_list|)
expr_stmt|;
comment|// Bitwise& Numeric Functions
name|P
argument_list|(
name|abs
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|clz
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|clzl
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|clzll
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ctz
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ctzl
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ctzll
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ffs
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ffsl
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|ffsll
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|parity
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|parityl
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|parityll
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|popcount
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|popcountl
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|popcountll
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|powi
argument_list|,
operator|(
literal|1.2f
operator|,
name|N
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|powif
argument_list|,
operator|(
literal|1.2f
operator|,
name|N
operator|)
argument_list|)
expr_stmt|;
name|Q
argument_list|(
name|powil
argument_list|,
operator|(
literal|1.2f
operator|,
name|N
operator|)
argument_list|)
expr_stmt|;
comment|// Lib functions
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|n
init|=
name|random
argument_list|()
decl_stmt|;
comment|// Avoid optimizing out.
name|char
name|s0
index|[
literal|10
index|]
decl_stmt|,
name|s1
index|[]
init|=
literal|"Hello"
decl_stmt|;
name|V
argument_list|(
name|strcat
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strcmp
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strncat
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strchr
argument_list|,
operator|(
name|s0
operator|,
name|s1
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strrchr
argument_list|,
operator|(
name|s0
operator|,
name|s1
index|[
literal|0
index|]
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strcpy
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|strncpy
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
comment|// Object size checking
name|V
argument_list|(
name|__memset_chk
argument_list|,
operator|(
name|s0
operator|,
literal|0
operator|,
sizeof|sizeof
name|s0
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|__memcpy_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
sizeof|sizeof
name|s0
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|__memmove_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
sizeof|sizeof
name|s0
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|__mempcpy_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
sizeof|sizeof
name|s0
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|__strncpy_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
sizeof|sizeof
name|s0
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|V
argument_list|(
name|__strcpy_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|s0
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|V
argument_list|(
name|__strcat_chk
argument_list|,
operator|(
name|s0
operator|,
name|s1
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|object_size
argument_list|,
operator|(
name|s0
operator|,
literal|0
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|object_size
argument_list|,
operator|(
name|s0
operator|,
literal|1
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|object_size
argument_list|,
operator|(
name|s0
operator|,
literal|2
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|object_size
argument_list|,
operator|(
name|s0
operator|,
literal|3
operator|)
argument_list|)
expr_stmt|;
comment|// Whatever
name|P
argument_list|(
name|bswap16
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|bswap32
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|bswap64
argument_list|,
operator|(
name|N
operator|)
argument_list|)
expr_stmt|;
comment|// FIXME
comment|// V(clear_cache, (&N,&N+1));
name|V
argument_list|(
name|trap
argument_list|,
operator|(
operator|)
argument_list|)
expr_stmt|;
name|R
argument_list|(
name|extract_return_addr
argument_list|,
operator|(
operator|&
name|N
operator|)
argument_list|)
expr_stmt|;
name|P
argument_list|(
name|signbit
argument_list|,
operator|(
literal|1.0
operator|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|foo
parameter_list|()
block|{
name|__builtin_strcat
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|// CHECK-LABEL: define void @bar(
end_comment

begin_function
name|void
name|bar
parameter_list|()
block|{
name|float
name|f
decl_stmt|;
name|double
name|d
decl_stmt|;
name|long
name|double
name|ld
decl_stmt|;
comment|// LLVM's hex representation of float constants is really unfortunate;
comment|// basically it does a float-to-double "conversion" and then prints the
comment|// hex form of that.  That gives us weird artifacts like exponents
comment|// that aren't numerically similar to the original exponent and
comment|// significand bit-patterns that are offset by three bits (because
comment|// the exponent was expanded from 8 bits to 11).
comment|//
comment|// 0xAE98 == 1010111010011000
comment|// 0x15D3 == 1010111010011
name|f
operator|=
name|__builtin_huge_valf
argument_list|()
expr_stmt|;
comment|// CHECK: float    0x7FF0000000000000
name|d
operator|=
name|__builtin_huge_val
argument_list|()
expr_stmt|;
comment|// CHECK: double   0x7FF0000000000000
name|ld
operator|=
name|__builtin_huge_vall
argument_list|()
expr_stmt|;
comment|// CHECK: x86_fp80 0xK7FFF8000000000000000
name|f
operator|=
name|__builtin_nanf
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: float    0x7FF8000000000000
name|d
operator|=
name|__builtin_nan
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: double   0x7FF8000000000000
name|ld
operator|=
name|__builtin_nanl
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: x86_fp80 0xK7FFFC000000000000000
name|f
operator|=
name|__builtin_nanf
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: float    0x7FF815D300000000
name|d
operator|=
name|__builtin_nan
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: double   0x7FF800000000AE98
name|ld
operator|=
name|__builtin_nanl
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: x86_fp80 0xK7FFFC00000000000AE98
name|f
operator|=
name|__builtin_nansf
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: float    0x7FF4000000000000
name|d
operator|=
name|__builtin_nans
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: double   0x7FF4000000000000
name|ld
operator|=
name|__builtin_nansl
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// CHECK: x86_fp80 0xK7FFFA000000000000000
name|f
operator|=
name|__builtin_nansf
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: float    0x7FF015D300000000
name|d
operator|=
name|__builtin_nans
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: double   0x7FF000000000AE98
name|ld
operator|=
name|__builtin_nansl
argument_list|(
literal|"0xAE98"
argument_list|)
expr_stmt|;
comment|// CHECK: x86_fp80 0xK7FFF800000000000AE98
block|}
end_function

begin_comment
comment|// CHECK: }
end_comment

begin_comment
comment|// CHECK-LABEL: define void @test_float_builtins
end_comment

begin_function
name|void
name|test_float_builtins
parameter_list|(
name|float
name|F
parameter_list|,
name|double
name|D
parameter_list|,
name|long
name|double
name|LD
parameter_list|)
block|{
specifier|volatile
name|int
name|res
decl_stmt|;
name|res
operator|=
name|__builtin_isinf
argument_list|(
name|F
argument_list|)
expr_stmt|;
comment|// CHECK:  call float @llvm.fabs.f32(float
comment|// CHECK:  fcmp oeq float {{.*}}, 0x7FF0000000000000
name|res
operator|=
name|__builtin_isinf
argument_list|(
name|D
argument_list|)
expr_stmt|;
comment|// CHECK:  call double @llvm.fabs.f64(double
comment|// CHECK:  fcmp oeq double {{.*}}, 0x7FF0000000000000
name|res
operator|=
name|__builtin_isinf
argument_list|(
name|LD
argument_list|)
expr_stmt|;
comment|// CHECK:  call x86_fp80 @llvm.fabs.f80(x86_fp80
comment|// CHECK:  fcmp oeq x86_fp80 {{.*}}, 0xK7FFF8000000000000000
name|res
operator|=
name|__builtin_isfinite
argument_list|(
name|F
argument_list|)
expr_stmt|;
comment|// CHECK: fcmp oeq float
comment|// CHECK: call float @llvm.fabs.f32(float
comment|// CHECK: fcmp une float {{.*}}, 0x7FF0000000000000
comment|// CHECK: and i1
name|res
operator|=
name|__builtin_isnormal
argument_list|(
name|F
argument_list|)
expr_stmt|;
comment|// CHECK: fcmp oeq float
comment|// CHECK: call float @llvm.fabs.f32(float
comment|// CHECK: fcmp ult float {{.*}}, 0x7FF0000000000000
comment|// CHECK: fcmp uge float {{.*}}, 0x3810000000000000
comment|// CHECK: and i1
comment|// CHECK: and i1
block|}
end_function

begin_comment
comment|// CHECK-LABEL: define void @test_float_builtin_ops
end_comment

begin_function
name|void
name|test_float_builtin_ops
parameter_list|(
name|float
name|F
parameter_list|,
name|double
name|D
parameter_list|,
name|long
name|double
name|LD
parameter_list|)
block|{
specifier|volatile
name|float
name|resf
decl_stmt|;
specifier|volatile
name|double
name|resd
decl_stmt|;
specifier|volatile
name|long
name|double
name|resld
decl_stmt|;
name|resf
operator|=
name|__builtin_fmodf
argument_list|(
name|F
argument_list|,
name|F
argument_list|)
expr_stmt|;
comment|// CHECK: frem float
name|resd
operator|=
name|__builtin_fmod
argument_list|(
name|D
argument_list|,
name|D
argument_list|)
expr_stmt|;
comment|// CHECK: frem double
name|resld
operator|=
name|__builtin_fmodl
argument_list|(
name|LD
argument_list|,
name|LD
argument_list|)
expr_stmt|;
comment|// CHECK: frem x86_fp80
name|resf
operator|=
name|__builtin_fabsf
argument_list|(
name|F
argument_list|)
expr_stmt|;
name|resd
operator|=
name|__builtin_fabs
argument_list|(
name|D
argument_list|)
expr_stmt|;
name|resld
operator|=
name|__builtin_fabsl
argument_list|(
name|LD
argument_list|)
expr_stmt|;
comment|// CHECK: call float @llvm.fabs.f32(float
comment|// CHECK: call double @llvm.fabs.f64(double
comment|// CHECK: call x86_fp80 @llvm.fabs.f80(x86_fp80
block|}
end_function

begin_comment
comment|// CHECK-LABEL: define void @test_builtin_longjmp
end_comment

begin_function
name|void
name|test_builtin_longjmp
parameter_list|(
name|void
modifier|*
modifier|*
name|buffer
parameter_list|)
block|{
comment|// CHECK: [[BITCAST:%.*]] = bitcast
comment|// CHECK-NEXT: call void @llvm.eh.sjlj.longjmp(i8* [[BITCAST]])
name|__builtin_longjmp
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// CHECK-NEXT: unreachable
block|}
end_function

begin_comment
comment|// CHECK-LABEL: define i64 @test_builtin_readcyclecounter
end_comment

begin_function
name|long
name|long
name|test_builtin_readcyclecounter
parameter_list|()
block|{
comment|// CHECK: call i64 @llvm.readcyclecounter()
return|return
name|__builtin_readcyclecounter
argument_list|()
return|;
block|}
end_function

end_unit

