begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// RUN: %clang_cc1 -analyze -analyzer-experimental-internal-checks -checker-cfref -analyzer-store=basic -analyzer-constraints=basic -verify %s
end_comment

begin_comment
comment|// RUN: %clang_cc1 -analyze -analyzer-experimental-internal-checks -checker-cfref -analyzer-store=basic -analyzer-constraints=range -verify %s
end_comment

begin_comment
comment|// RUN: %clang_cc1 -analyze -analyzer-experimental-internal-checks -checker-cfref -analyzer-store=region -analyzer-constraints=basic -verify %s
end_comment

begin_comment
comment|// RUN: %clang_cc1 -analyze -analyzer-experimental-internal-checks -checker-cfref -analyzer-store=region -analyzer-constraints=range -verify %s
end_comment

begin_typedef
typedef|typedef
name|unsigned
name|char
name|Boolean
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|signed
name|long
name|CFIndex
typedef|;
end_typedef

begin_typedef
typedef|typedef
specifier|const
name|void
modifier|*
name|CFTypeRef
typedef|;
end_typedef

begin_typedef
typedef|typedef
specifier|const
name|struct
name|__CFString
modifier|*
name|CFStringRef
typedef|;
end_typedef

begin_typedef
typedef|typedef
specifier|const
name|struct
name|__CFAllocator
modifier|*
name|CFAllocatorRef
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
specifier|const
name|CFAllocatorRef
name|kCFAllocatorDefault
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
block|{}
name|CFAllocatorContext
typedef|;
end_typedef

begin_function_decl
specifier|extern
name|void
name|CFRelease
parameter_list|(
name|CFTypeRef
name|cf
parameter_list|)
function_decl|;
end_function_decl

begin_typedef
typedef|typedef
struct|struct
block|{}
name|CFDictionaryKeyCallBacks
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
specifier|const
name|CFDictionaryKeyCallBacks
name|kCFTypeDictionaryKeyCallBacks
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
block|{}
name|CFDictionaryValueCallBacks
typedef|;
end_typedef

begin_decl_stmt
specifier|extern
specifier|const
name|CFDictionaryValueCallBacks
name|kCFTypeDictionaryValueCallBacks
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
specifier|const
name|struct
name|__CFDictionary
modifier|*
name|CFDictionaryRef
typedef|;
end_typedef

begin_function_decl
specifier|extern
name|CFDictionaryRef
name|CFDictionaryCreate
parameter_list|(
name|CFAllocatorRef
name|allocator
parameter_list|,
specifier|const
name|void
modifier|*
modifier|*
name|keys
parameter_list|,
specifier|const
name|void
modifier|*
modifier|*
name|values
parameter_list|,
name|CFIndex
name|numValues
parameter_list|,
specifier|const
name|CFDictionaryKeyCallBacks
modifier|*
name|keyCallBacks
parameter_list|,
specifier|const
name|CFDictionaryValueCallBacks
modifier|*
name|valueCallBacks
parameter_list|)
function_decl|;
end_function_decl

begin_enum
enum|enum
block|{
name|kCFNumberSInt8Type
init|=
literal|1
block|,
name|kCFNumberSInt16Type
init|=
literal|2
block|,
name|kCFNumberSInt32Type
init|=
literal|3
block|,
name|kCFNumberSInt64Type
init|=
literal|4
block|,
name|kCFNumberFloat32Type
init|=
literal|5
block|,
name|kCFNumberFloat64Type
init|=
literal|6
block|,
name|kCFNumberCharType
init|=
literal|7
block|,
name|kCFNumberShortType
init|=
literal|8
block|,
name|kCFNumberIntType
init|=
literal|9
block|,
name|kCFNumberLongType
init|=
literal|10
block|,
name|kCFNumberLongLongType
init|=
literal|11
block|,
name|kCFNumberFloatType
init|=
literal|12
block|,
name|kCFNumberDoubleType
init|=
literal|13
block|,
name|kCFNumberCFIndexType
init|=
literal|14
block|,
name|kCFNumberNSIntegerType
init|=
literal|15
block|,
name|kCFNumberCGFloatType
init|=
literal|16
block|,
name|kCFNumberMaxType
init|=
literal|16
block|}
enum|;
end_enum

begin_typedef
typedef|typedef
name|CFIndex
name|CFNumberType
typedef|;
end_typedef

begin_typedef
typedef|typedef
specifier|const
name|struct
name|__CFNumber
modifier|*
name|CFNumberRef
typedef|;
end_typedef

begin_function_decl
specifier|extern
name|CFNumberRef
name|CFNumberCreate
parameter_list|(
name|CFAllocatorRef
name|allocator
parameter_list|,
name|CFNumberType
name|theType
parameter_list|,
specifier|const
name|void
modifier|*
name|valuePtr
parameter_list|)
function_decl|;
end_function_decl

begin_typedef
typedef|typedef
name|struct
name|__CFNotificationCenter
modifier|*
name|CFNotificationCenterRef
typedef|;
end_typedef

begin_function_decl
specifier|extern
name|CFNotificationCenterRef
name|CFNotificationCenterGetDistributedCenter
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|extern
name|void
name|CFNotificationCenterPostNotification
parameter_list|(
name|CFNotificationCenterRef
name|center
parameter_list|,
name|CFStringRef
name|name
parameter_list|,
specifier|const
name|void
modifier|*
name|object
parameter_list|,
name|CFDictionaryRef
name|userInfo
parameter_list|,
name|Boolean
name|deliverImmediately
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|// This test case was reported in PR2519 as a false positive (_value was
end_comment

begin_comment
comment|// reported as being leaked).
end_comment

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|CFStringRef
name|_key
init|=
operator|(
operator|(
name|CFStringRef
operator|)
name|__builtin___CFStringMakeConstantString
argument_list|(
literal|""
literal|"Process identifier"
literal|""
argument_list|)
operator|)
decl_stmt|;
name|int
name|pid
init|=
literal|42
decl_stmt|;
name|CFNumberRef
name|_value
init|=
name|CFNumberCreate
argument_list|(
name|kCFAllocatorDefault
argument_list|,
name|kCFNumberIntType
argument_list|,
operator|&
name|pid
argument_list|)
decl_stmt|;
name|CFDictionaryRef
name|userInfo
init|=
name|CFDictionaryCreate
argument_list|(
name|kCFAllocatorDefault
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|*
operator|)
operator|&
name|_key
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|*
operator|)
operator|&
name|_value
argument_list|,
literal|1
argument_list|,
operator|&
name|kCFTypeDictionaryKeyCallBacks
argument_list|,
operator|&
name|kCFTypeDictionaryValueCallBacks
argument_list|)
decl_stmt|;
name|CFRelease
argument_list|(
name|_value
argument_list|)
expr_stmt|;
comment|// no-warning
name|CFNotificationCenterPostNotification
argument_list|(
name|CFNotificationCenterGetDistributedCenter
argument_list|()
argument_list|,
operator|(
operator|(
name|CFStringRef
operator|)
name|__builtin___CFStringMakeConstantString
argument_list|(
literal|""
literal|"GrowlPreferencesChanged"
literal|""
argument_list|)
operator|)
argument_list|,
operator|(
operator|(
name|CFStringRef
operator|)
name|__builtin___CFStringMakeConstantString
argument_list|(
literal|""
literal|"GrowlUserDefaults"
literal|""
argument_list|)
operator|)
argument_list|,
name|userInfo
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|CFRelease
argument_list|(
name|userInfo
argument_list|)
expr_stmt|;
comment|// no-warning
return|return
literal|0
return|;
block|}
end_function

end_unit

