begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// This test checks that intersecting ranges does not cause 'system is over constrained' assertions in the case of eg: 32 bits unsigned integers getting their range from 64 bits signed integers.
end_comment

begin_comment
comment|// RUN: %clang_cc1 -triple x86_64-pc-linux-gnu -analyze -analyzer-checker=core,debug.ExprInspection -analyzer-store=region -verify %s
end_comment

begin_function_decl
name|void
name|clang_analyzer_warnIfReached
parameter_list|()
function_decl|;
end_function_decl

begin_function
name|void
name|f1
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
comment|// because of foo range, index is in range [0; UINT_MAX]
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f2
parameter_list|(
name|unsigned
name|long
name|foo
parameter_list|)
block|{
name|int
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
comment|// index equals ULONG_MAX
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// no-warning
block|}
end_function

begin_function
name|void
name|f3
parameter_list|(
name|unsigned
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f4
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|int
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f5
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|==
operator|-
literal|1
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f6
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|==
operator|-
literal|1
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f7
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|-
literal|1
operator|==
literal|0
condition|)
comment|// Was not reached prior fix.
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f8
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1L
operator|==
literal|0L
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// no-warning
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f9
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|-
literal|1L
operator|==
literal|0L
condition|)
comment|// Was not reached prior fix.
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f10
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0L
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f11
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1UL
operator|==
literal|0L
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// no-warning
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f12
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|-
literal|1UL
operator|==
literal|0L
condition|)
comment|// Was not reached prior fix.
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f13
parameter_list|(
name|int
name|foo
parameter_list|)
block|{
name|unsigned
name|short
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// no-warning
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f14
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
name|long
name|bar
init|=
name|foo
decl_stmt|;
if|if
condition|(
name|index
operator|+
literal|1
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

begin_function
name|void
name|f15
parameter_list|(
name|long
name|foo
parameter_list|)
block|{
name|unsigned
name|index
init|=
operator|-
literal|1
decl_stmt|;
if|if
condition|(
name|index
operator|<
name|foo
condition|)
name|index
operator|=
name|foo
expr_stmt|;
name|unsigned
name|int
name|tmp
init|=
name|index
operator|+
literal|1
decl_stmt|;
if|if
condition|(
name|tmp
operator|==
literal|0
condition|)
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
else|else
name|clang_analyzer_warnIfReached
argument_list|()
expr_stmt|;
comment|// expected-warning{{REACHABLE}}
block|}
end_function

end_unit

