begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|// Given code 'struct aa { char s1[4]; char * s2;} a; memcpy(a.s1, ...);',
end_comment

begin_comment
comment|// this test checks that the CStringChecker only invalidates the destination buffer array a.s1 (instead of a.s1 and a.s2).
end_comment

begin_comment
comment|// At the moment the whole of the destination array content is invalidated.
end_comment

begin_comment
comment|// If a.s1 region has a symbolic offset, the whole region of 'a' is invalidated.
end_comment

begin_comment
comment|// Specific triple set to test structures of size 0.
end_comment

begin_comment
comment|// RUN: %clang_cc1 -triple x86_64-pc-linux-gnu -analyze -analyzer-checker=core,unix.Malloc,debug.ExprInspection -analyzer-store=region -verify %s
end_comment

begin_typedef
typedef|typedef
name|__typeof
argument_list|(
argument|sizeof(int)
argument_list|)
name|size_t
expr_stmt|;
end_typedef

begin_function_decl
name|char
modifier|*
name|strdup
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|free
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
modifier|*
name|memcpy
parameter_list|(
name|void
modifier|*
name|dst
parameter_list|,
specifier|const
name|void
modifier|*
name|src
parameter_list|,
name|size_t
name|n
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|// expected-note{{passing argument to parameter 'dst' here}}
end_comment

begin_function_decl
name|void
modifier|*
name|malloc
parameter_list|(
name|size_t
name|n
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|clang_analyzer_eval
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_struct
struct|struct
name|aa
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|// Test different types of structure initialisation.
end_comment

begin_function
name|int
name|f0
parameter_list|()
block|{
name|struct
name|aa
name|a0
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a0
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a0
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a0
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a0
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|a0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f1
parameter_list|()
block|{
name|struct
name|aa
name|a1
decl_stmt|;
name|a1
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a1
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a1
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a1
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a1
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a1
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a1
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|a1
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f2
parameter_list|()
block|{
name|struct
name|aa
name|a2
init|=
block|{
block|{
literal|1
block|,
literal|2
block|}
block|}
decl_stmt|;
name|a2
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a2
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a2
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a2
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a2
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a2
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a2
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|a2
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f3
parameter_list|()
block|{
name|struct
name|aa
name|a3
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a3
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|int
modifier|*
name|dest
init|=
operator|(
name|int
operator|*
operator|)
name|a3
operator|.
name|s1
decl_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a3
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a3
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a3
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a3
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a3
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|a3
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_struct
struct|struct
name|bb
block|{
name|struct
name|aa
name|a
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f4
parameter_list|()
block|{
name|struct
name|bb
name|b0
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|b0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|b0
operator|.
name|a
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hola"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|char
modifier|*
name|dest
init|=
operator|(
name|char
operator|*
operator|)
operator|(
name|b0
operator|.
name|a
operator|.
name|s1
operator|)
decl_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|dest
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|b0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
name|free
argument_list|(
name|b0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test that memory leaks are caught.
end_comment

begin_function
name|int
name|f5
parameter_list|()
block|{
name|struct
name|aa
name|a0
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'a0.s2'}}
block|}
end_function

begin_function
name|int
name|f6
parameter_list|()
block|{
name|struct
name|aa
name|a1
decl_stmt|;
name|a1
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a1
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'a1.s2'}}
block|}
end_function

begin_function
name|int
name|f7
parameter_list|()
block|{
name|struct
name|aa
name|a2
init|=
block|{
block|{
literal|1
block|,
literal|2
block|}
block|}
decl_stmt|;
name|a2
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a2
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'a2.s2'}}
block|}
end_function

begin_function
name|int
name|f8
parameter_list|()
block|{
name|struct
name|aa
name|a3
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a3
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|int
modifier|*
name|dest
init|=
operator|(
name|int
operator|*
operator|)
name|a3
operator|.
name|s1
decl_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'a3.s2'}}
block|}
end_function

begin_function
name|int
name|f9
parameter_list|()
block|{
name|struct
name|bb
name|b0
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|b0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|b0
operator|.
name|a
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hola"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|char
modifier|*
name|dest
init|=
operator|(
name|char
operator|*
operator|)
operator|(
name|b0
operator|.
name|a
operator|.
name|s1
operator|)
decl_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|b0
operator|.
name|a
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// expected-warning{{Potential leak of memory pointed to by 'b0.s2'}}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f10
parameter_list|()
block|{
name|struct
name|bb
name|b0
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|b0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|b0
operator|.
name|a
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hola"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|char
modifier|*
name|dest
init|=
operator|(
name|char
operator|*
operator|)
operator|(
name|b0
operator|.
name|a
operator|.
name|s1
operator|)
decl_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|b0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// expected-warning{{Potential leak of memory pointed to by 'b0.a.s2'}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test invalidating fields being addresses of array.
end_comment

begin_struct
struct|struct
name|cc
block|{
name|char
modifier|*
name|s1
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f11
parameter_list|()
block|{
name|char
name|x
index|[
literal|4
index|]
init|=
block|{
literal|1
block|,
literal|2
block|}
decl_stmt|;
name|x
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|x
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|struct
name|cc
name|c0
decl_stmt|;
name|c0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|c0
operator|.
name|s1
operator|=
operator|&
name|x
index|[
literal|0
index|]
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|c0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|x
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|x
index|[
literal|1
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|c0
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|c0
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|c0
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|c0
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|c0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no-warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test inverting field position between s1 and s2.
end_comment

begin_struct
struct|struct
name|dd
block|{
name|char
modifier|*
name|s2
decl_stmt|;
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f12
parameter_list|()
block|{
name|struct
name|dd
name|d0
init|=
block|{
literal|0
block|,
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|}
decl_stmt|;
name|d0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|d0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|d0
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d0
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d0
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d0
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|d0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test arrays of structs.
end_comment

begin_struct
struct|struct
name|ee
block|{
name|int
name|a
decl_stmt|;
name|char
name|b
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|EE
block|{
name|struct
name|ee
name|s1
index|[
literal|2
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f13
parameter_list|()
block|{
name|struct
name|EE
name|E0
init|=
block|{
block|{
block|{
literal|1
block|,
literal|2
block|}
block|,
block|{
literal|3
block|,
literal|4
block|}
block|}
block|,
literal|0
block|}
decl_stmt|;
name|E0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|E0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|E0
operator|.
name|s1
index|[
literal|0
index|]
operator|.
name|a
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|E0
operator|.
name|s1
index|[
literal|0
index|]
operator|.
name|b
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|E0
operator|.
name|s1
index|[
literal|1
index|]
operator|.
name|a
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|E0
operator|.
name|s1
index|[
literal|1
index|]
operator|.
name|b
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|E0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|E0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test global parameters.
end_comment

begin_decl_stmt
name|struct
name|aa
name|a15
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|f15
parameter_list|()
block|{
name|a15
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a15
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a15
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a15
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a15
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a15
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a15
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|a15
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test array of 0 sized elements.
end_comment

begin_struct
struct|struct
name|empty
block|{}
struct|;
end_struct

begin_struct
struct|struct
name|gg
block|{
name|struct
name|empty
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f16
parameter_list|()
block|{
name|struct
name|gg
name|g0
init|=
block|{
block|{}
block|,
literal|0
block|}
decl_stmt|;
name|g0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|g0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
operator|*
operator|(
name|int
operator|*
operator|)
operator|(
operator|&
name|g0
operator|.
name|s1
index|[
literal|0
index|]
operator|)
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'g0.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
operator|*
operator|(
name|int
operator|*
operator|)
operator|(
operator|&
name|g0
operator|.
name|s1
index|[
literal|1
index|]
operator|)
operator|==
literal|'b'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
operator|*
operator|(
name|int
operator|*
operator|)
operator|(
operator|&
name|g0
operator|.
name|s1
index|[
literal|2
index|]
operator|)
operator|==
literal|'c'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
operator|*
operator|(
name|int
operator|*
operator|)
operator|(
operator|&
name|g0
operator|.
name|s1
index|[
literal|3
index|]
operator|)
operator|==
literal|'d'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|g0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|g0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test array of 0 elements.
end_comment

begin_struct
struct|struct
name|hh
block|{
name|char
name|s1
index|[
literal|0
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f17
parameter_list|()
block|{
name|struct
name|hh
name|h0
decl_stmt|;
name|h0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|h0
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|h0
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|'a'
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'h0.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|h0
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|free
argument_list|(
name|h0
operator|.
name|s2
argument_list|)
expr_stmt|;
comment|// no warning
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test writing past the array.
end_comment

begin_struct
struct|struct
name|ii
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f18
parameter_list|()
block|{
name|struct
name|ii
name|i18
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|5
block|,
literal|6
block|}
decl_stmt|;
name|i18
operator|.
name|i
operator|=
literal|10
expr_stmt|;
name|i18
operator|.
name|j
operator|=
literal|11
expr_stmt|;
name|i18
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[
literal|100
index|]
init|=
block|{
literal|3
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|i18
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'i18.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|4
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|i
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i18
operator|.
name|j
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f181
parameter_list|()
block|{
name|struct
name|ii
name|i181
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|5
block|,
literal|6
block|}
decl_stmt|;
name|i181
operator|.
name|i
operator|=
literal|10
expr_stmt|;
name|i181
operator|.
name|j
operator|=
literal|11
expr_stmt|;
name|i181
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[
literal|100
index|]
init|=
block|{
literal|3
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|i181
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// invalidate the whole region of i181
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'i181.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|4
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|i
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|i181
operator|.
name|j
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test array with a symbolic offset.
end_comment

begin_struct
struct|struct
name|jj
block|{
name|char
name|s1
index|[
literal|2
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|JJ
block|{
name|struct
name|jj
name|s1
index|[
literal|3
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f19
parameter_list|(
name|int
name|i
parameter_list|)
block|{
name|struct
name|JJ
name|J0
init|=
block|{
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|0
block|}
block|,
block|{
literal|3
block|,
literal|4
block|,
literal|0
block|}
block|,
block|{
literal|5
block|,
literal|6
block|,
literal|0
block|}
block|}
block|,
literal|0
block|}
decl_stmt|;
name|J0
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|J0
operator|.
name|s1
index|[
literal|0
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|J0
operator|.
name|s1
index|[
literal|1
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hi"
argument_list|)
expr_stmt|;
name|J0
operator|.
name|s1
index|[
literal|2
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"world"
argument_list|)
expr_stmt|;
name|char
name|input
index|[
literal|2
index|]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|J0
operator|.
name|s1
index|[
name|i
index|]
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
name|field
literal|'s2'
block|}
block|}
expr|\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'J0.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|4
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|2
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|5
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
literal|2
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|6
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|5
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|J0
operator|.
name|s1
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|6
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
comment|// FIXME: memory leak warning for J0.s2 should be emitted here instead of after memcpy call.
return|return
literal|0
return|;
comment|// no warning
block|}
end_function

begin_comment
comment|// Test array with its super region having symbolic offseted regions.
end_comment

begin_function
name|int
name|f20
parameter_list|(
name|int
name|i
parameter_list|)
block|{
name|struct
name|aa
modifier|*
name|a20
init|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|aa
argument_list|)
operator|*
literal|2
argument_list|)
decl_stmt|;
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|=
literal|4
expr_stmt|;
name|a20
index|[
literal|0
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|=
literal|5
expr_stmt|;
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|=
literal|6
expr_stmt|;
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|=
literal|7
expr_stmt|;
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|=
literal|8
expr_stmt|;
name|a20
index|[
literal|1
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"world"
argument_list|)
expr_stmt|;
name|a20
index|[
name|i
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hola"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|0
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
literal|1
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a20
index|[
name|i
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'a20'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test array's region and super region both having symbolic offsets.
end_comment

begin_function
name|int
name|f21
parameter_list|(
name|int
name|i
parameter_list|)
block|{
name|struct
name|aa
modifier|*
name|a21
init|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|aa
argument_list|)
operator|*
literal|2
argument_list|)
decl_stmt|;
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|=
literal|4
expr_stmt|;
name|a21
index|[
literal|0
index|]
operator|.
name|s2
operator|=
literal|0
expr_stmt|;
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|=
literal|5
expr_stmt|;
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|=
literal|6
expr_stmt|;
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|=
literal|7
expr_stmt|;
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|=
literal|8
expr_stmt|;
name|a21
index|[
literal|1
index|]
operator|.
name|s2
operator|=
literal|0
expr_stmt|;
name|a21
index|[
name|i
index|]
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|=
literal|4
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|0
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|0
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|1
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
literal|1
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a21
index|[
name|i
index|]
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'a21'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test regions aliasing other regions.
end_comment

begin_struct
struct|struct
name|ll
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
struct|struct
name|mm
block|{
name|char
name|s3
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s4
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f24
parameter_list|()
block|{
name|struct
name|ll
name|l24
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|struct
name|mm
modifier|*
name|m24
init|=
operator|(
expr|struct
name|mm
operator|*
operator|)
operator|&
name|l24
decl_stmt|;
name|m24
operator|->
name|s4
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|m24
operator|->
name|s3
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|m24
operator|->
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m24
operator|->
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m24
operator|->
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m24
operator|->
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l24
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l24
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l24
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l24
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
name|field
literal|'s4'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test region with potential aliasing and symbolic offsets.
end_comment

begin_comment
comment|// Store assumes no aliasing.
end_comment

begin_function
name|int
name|f25
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|j
parameter_list|,
name|struct
name|ll
modifier|*
name|l
parameter_list|,
name|struct
name|mm
modifier|*
name|m
parameter_list|)
block|{
name|m
operator|->
name|s4
operator|=
name|strdup
argument_list|(
literal|"hola"
argument_list|)
expr_stmt|;
comment|// m->s4 not tracked
name|m
operator|->
name|s3
index|[
literal|0
index|]
operator|=
literal|1
expr_stmt|;
name|m
operator|->
name|s3
index|[
literal|1
index|]
operator|=
literal|2
expr_stmt|;
name|m
operator|->
name|s3
index|[
literal|2
index|]
operator|=
literal|3
expr_stmt|;
name|m
operator|->
name|s3
index|[
literal|3
index|]
operator|=
literal|4
expr_stmt|;
name|m
operator|->
name|s3
index|[
name|j
index|]
operator|=
literal|5
expr_stmt|;
comment|// invalidates m->s3
name|l
operator|->
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
comment|// l->s2 not tracked
name|l
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|6
expr_stmt|;
name|l
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|7
expr_stmt|;
name|l
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|8
expr_stmt|;
name|l
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|9
expr_stmt|;
name|l
operator|->
name|s1
index|[
name|i
index|]
operator|=
literal|10
expr_stmt|;
comment|// invalidates l->s1
name|char
name|input
index|[]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|m
operator|->
name|s3
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// does not invalidate l->s1[i]
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
name|i
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m
operator|->
name|s3
index|[
name|j
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
name|i
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{FALSE}}
name|clang_analyzer_eval
argument_list|(
name|l
operator|->
name|s1
index|[
name|j
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test size with symbolic size argument.
end_comment

begin_function
name|int
name|f26
parameter_list|(
name|int
name|i
parameter_list|)
block|{
name|struct
name|aa
name|a26
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a26
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a26
operator|.
name|s1
argument_list|,
name|input
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|// i assumed in bound
name|clang_analyzer_eval
argument_list|(
name|a26
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a26
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a26
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a26
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'a26.s2'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test sizeof as a size argument.
end_comment

begin_function
name|int
name|f261
parameter_list|()
block|{
name|struct
name|aa
name|a261
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a261
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a261
operator|.
name|s1
argument_list|,
name|input
argument_list|,
sizeof|sizeof
argument_list|(
name|a261
operator|.
name|s1
argument_list|)
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a261
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a261
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a261
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a261
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'a261.s2'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test negative size argument.
end_comment

begin_function
name|int
name|f262
parameter_list|()
block|{
name|struct
name|aa
name|a262
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|a262
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|a262
operator|.
name|s1
argument_list|,
name|input
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|a262
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'a262.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|a262
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a262
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|a262
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test size argument being an unknown value.
end_comment

begin_struct
struct|struct
name|xx
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f263
parameter_list|(
name|int
name|n
parameter_list|,
name|char
modifier|*
name|len
parameter_list|)
block|{
name|struct
name|xx
name|x263
init|=
block|{
literal|0
block|}
decl_stmt|;
name|x263
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|x263
operator|.
name|s1
argument_list|,
name|input
argument_list|,
operator|*
operator|(
name|len
operator|+
name|n
operator|)
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|x263
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|x263
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|x263
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|x263
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|x263
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'x263.s2'}}
block|}
end_function

begin_comment
comment|// Test casting regions with symbolic offseted sub regions.
end_comment

begin_function
name|int
name|f27
parameter_list|(
name|int
name|i
parameter_list|)
block|{
name|struct
name|mm
name|m27
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|m27
operator|.
name|s4
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|m27
operator|.
name|s3
index|[
name|i
index|]
operator|=
literal|5
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
operator|(
operator|(
expr|struct
name|ll
operator|*
operator|)
operator|(
operator|&
name|m27
operator|)
operator|)
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|m27
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m27
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m27
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m27
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m27
operator|.
name|s3
index|[
name|i
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'m27.s4'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f28
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|j
parameter_list|,
name|int
name|k
parameter_list|,
name|int
name|l
parameter_list|)
block|{
name|struct
name|mm
name|m28
index|[
literal|2
index|]
decl_stmt|;
name|m28
index|[
name|i
index|]
operator|.
name|s4
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|m28
index|[
name|j
index|]
operator|.
name|s3
index|[
name|k
index|]
operator|=
literal|1
expr_stmt|;
name|struct
name|ll
modifier|*
name|l28
init|=
operator|(
expr|struct
name|ll
operator|*
operator|)
operator|(
operator|&
name|m28
index|[
literal|1
index|]
operator|)
decl_stmt|;
name|l28
operator|->
name|s1
index|[
name|l
index|]
operator|=
literal|2
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|l28
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m28
index|[
name|j
index|]
operator|.
name|s3
index|[
name|k
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|l28
operator|->
name|s1
index|[
name|l
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f29
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|j
parameter_list|,
name|int
name|k
parameter_list|,
name|int
name|l
parameter_list|,
name|int
name|m
parameter_list|)
block|{
name|struct
name|mm
name|m29
index|[
literal|2
index|]
decl_stmt|;
name|m29
index|[
name|i
index|]
operator|.
name|s4
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|m29
index|[
name|j
index|]
operator|.
name|s3
index|[
name|k
index|]
operator|=
literal|1
expr_stmt|;
name|struct
name|ll
modifier|*
name|l29
init|=
operator|(
expr|struct
name|ll
operator|*
operator|)
operator|(
operator|&
name|m29
index|[
name|l
index|]
operator|)
decl_stmt|;
name|l29
operator|->
name|s1
index|[
name|m
index|]
operator|=
literal|2
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|l29
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|0
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
literal|1
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
name|i
index|]
operator|.
name|s3
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|m29
index|[
name|j
index|]
operator|.
name|s3
index|[
name|k
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
name|field
literal|'s4'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|l29
operator|->
name|s1
index|[
name|m
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test unions' fields.
end_comment

begin_union
union|union
name|uu
block|{
name|char
name|x
decl_stmt|;
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
block|}
union|;
end_union

begin_function
name|int
name|f30
parameter_list|()
block|{
name|union
name|uu
name|u30
init|=
block|{
operator|.
name|s1
operator|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|}
decl_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|u30
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|u30
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|u30
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|u30
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|u30
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|u30
operator|.
name|x
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_struct
struct|struct
name|kk
block|{
name|union
name|uu
name|u
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f31
parameter_list|()
block|{
name|struct
name|kk
name|k31
decl_stmt|;
name|k31
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|k31
operator|.
name|u
operator|.
name|x
operator|=
literal|1
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|k31
operator|.
name|u
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|k31
operator|.
name|u
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'k31.s2'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|k31
operator|.
name|u
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|k31
operator|.
name|u
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|k31
operator|.
name|u
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|k31
operator|.
name|u
operator|.
name|x
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
comment|// FIXME: memory leak warning for k31.s2 should be emitted here.
return|return
literal|0
return|;
block|}
end_function

begin_union
union|union
name|vv
block|{
name|int
name|x
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
union|;
end_union

begin_function
name|int
name|f32
parameter_list|()
block|{
name|union
name|vv
name|v32
decl_stmt|;
name|v32
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|v32
operator|.
name|s2
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|v32
operator|.
name|s2
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|v32
operator|.
name|s2
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|v32
operator|.
name|s2
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|v32
operator|.
name|s2
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|Potential
name|leak
name|of
name|memory
name|pointed
name|to
name|by
literal|'v32.s2'
block|}
block|}
return|return
literal|0
return|;
block|}
end_function

begin_struct
struct|struct
name|nn
block|{
name|int
name|s1
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|int
name|k
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|// Test bad types to dest buffer.
end_comment

begin_function
name|int
name|f33
parameter_list|()
block|{
name|struct
name|nn
name|n33
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|0
block|}
decl_stmt|;
name|n33
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|n33
operator|.
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// expected-warning{{incompatible integer to pointer conversion passing 'int' to parameter of type 'void *'}}
name|clang_analyzer_eval
argument_list|(
name|n33
operator|.
name|i
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|n33
operator|.
name|j
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|n33
operator|.
name|k
operator|==
literal|4
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|n33
operator|.
name|s1
operator|)
operator|)
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|cast
name|to
literal|'char *'
name|from
name|smaller
name|integer
name|type
literal|'int'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|n33
operator|.
name|s1
operator|)
operator|)
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|cast
name|to
literal|'char *'
name|from
name|smaller
name|integer
name|type
literal|'int'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|n33
operator|.
name|s1
operator|)
operator|)
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|cast
name|to
literal|'char *'
name|from
name|smaller
name|integer
name|type
literal|'int'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|n33
operator|.
name|s1
operator|)
operator|)
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}\
name|expected
operator|-
name|warning
block|{
block|{
name|cast
name|to
literal|'char *'
name|from
name|smaller
name|integer
name|type
literal|'int'
block|}
block|}
name|clang_analyzer_eval
argument_list|(
name|n33
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|//expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'n33.s2'}}
block|}
end_function

begin_comment
comment|// Test destination buffer being an unknown value.
end_comment

begin_struct
struct|struct
name|ww
block|{
name|int
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f34
parameter_list|(
name|struct
name|ww
modifier|*
name|w34
parameter_list|,
name|int
name|n
parameter_list|)
block|{
name|w34
operator|->
name|s2
operator|=
literal|3
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
name|w34
operator|->
name|s1
operator|+
name|n
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s1
index|[
name|n
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|w34
operator|->
name|s2
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test dest buffer as an element region with a symbolic index and size parameter as a symbolic value.
end_comment

begin_struct
struct|struct
name|yy
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|char
modifier|*
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f35
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|n
parameter_list|)
block|{
name|struct
name|yy
name|y35
init|=
block|{
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|}
block|,
literal|0
block|}
decl_stmt|;
name|y35
operator|.
name|s2
operator|=
name|strdup
argument_list|(
literal|"hello"
argument_list|)
expr_stmt|;
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|memcpy
argument_list|(
operator|&
operator|(
name|y35
operator|.
name|s1
index|[
name|i
index|]
operator|)
argument_list|,
name|input
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s1
index|[
literal|0
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s1
index|[
literal|1
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s1
index|[
literal|2
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s1
index|[
literal|3
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s1
index|[
name|i
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|y35
operator|.
name|s2
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
comment|// expected-warning{{Potential leak of memory pointed to by 'y35.s2'}}
block|}
end_function

begin_comment
comment|// Test regions with negative offsets.
end_comment

begin_struct
struct|struct
name|zz
block|{
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
name|int
name|s2
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f36
parameter_list|(
name|struct
name|zz
modifier|*
name|z36
parameter_list|)
block|{
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|z36
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|2
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|3
expr_stmt|;
name|z36
operator|->
name|s2
operator|=
literal|10
expr_stmt|;
name|z36
operator|=
name|z36
operator|-
literal|1
expr_stmt|;
comment|// Decrement by 8 bytes (struct zz is 8 bytes).
name|z36
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|5
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|6
expr_stmt|;
name|z36
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|7
expr_stmt|;
name|z36
operator|->
name|s2
operator|=
literal|11
expr_stmt|;
name|memcpy
argument_list|(
name|z36
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s2
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|z36
operator|=
name|z36
operator|+
literal|1
expr_stmt|;
comment|// Increment back.
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z36
operator|->
name|s2
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f37
parameter_list|(
name|struct
name|zz
modifier|*
name|z37
parameter_list|)
block|{
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|z37
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|2
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|3
expr_stmt|;
name|z37
operator|->
name|s2
operator|=
literal|10
expr_stmt|;
name|z37
operator|=
operator|(
expr|struct
name|zz
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|z37
operator|)
operator|-
literal|4
operator|)
expr_stmt|;
comment|// Decrement by 4 bytes (struct zz is 8 bytes).
name|z37
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|5
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|6
expr_stmt|;
name|z37
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|7
expr_stmt|;
name|z37
operator|->
name|s2
operator|=
literal|11
expr_stmt|;
name|memcpy
argument_list|(
name|z37
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s2
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|z37
operator|=
operator|(
expr|struct
name|zz
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|z37
operator|)
operator|+
literal|4
operator|)
expr_stmt|;
comment|// Increment back.
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z37
operator|->
name|s2
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|f38
parameter_list|(
name|struct
name|zz
modifier|*
name|z38
parameter_list|)
block|{
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|z38
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|2
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|3
expr_stmt|;
name|z38
operator|->
name|s2
operator|=
literal|10
expr_stmt|;
name|z38
operator|=
operator|(
expr|struct
name|zz
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|z38
operator|)
operator|-
literal|2
operator|)
expr_stmt|;
comment|// Decrement by 2 bytes (struct zz is 8 bytes).
name|z38
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|5
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|6
expr_stmt|;
name|z38
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|7
expr_stmt|;
name|z38
operator|->
name|s2
operator|=
literal|11
expr_stmt|;
name|memcpy
argument_list|(
name|z38
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s2
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|z38
operator|=
operator|(
expr|struct
name|zz
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|z38
operator|)
operator|+
literal|2
operator|)
expr_stmt|;
comment|// Increment back.
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|z38
operator|->
name|s2
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|// Test negative offsets with a different structure layout.
end_comment

begin_struct
struct|struct
name|z0
block|{
name|int
name|s2
decl_stmt|;
name|char
name|s1
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_function
name|int
name|f39
parameter_list|(
name|struct
name|z0
modifier|*
name|d39
parameter_list|)
block|{
name|char
name|input
index|[]
init|=
block|{
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|}
decl_stmt|;
name|d39
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|1
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|2
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|3
expr_stmt|;
name|d39
operator|->
name|s2
operator|=
literal|10
expr_stmt|;
name|d39
operator|=
operator|(
expr|struct
name|z0
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|d39
operator|)
operator|-
literal|2
operator|)
expr_stmt|;
comment|// Decrement by 2 bytes (struct z0 is 8 bytes).
name|d39
operator|->
name|s1
index|[
literal|0
index|]
operator|=
literal|4
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|1
index|]
operator|=
literal|5
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|2
index|]
operator|=
literal|6
expr_stmt|;
name|d39
operator|->
name|s1
index|[
literal|3
index|]
operator|=
literal|7
expr_stmt|;
name|d39
operator|->
name|s2
operator|=
literal|11
expr_stmt|;
name|memcpy
argument_list|(
name|d39
operator|->
name|s1
argument_list|,
name|input
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s2
operator|==
literal|11
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|d39
operator|=
operator|(
expr|struct
name|z0
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
operator|(
name|d39
operator|)
operator|+
literal|2
operator|)
expr_stmt|;
comment|// Increment back.
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|0
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|1
index|]
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// expected-warning{{UNKNOWN}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|2
index|]
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s1
index|[
literal|3
index|]
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
comment|// FIXME: d39->s2 should evaluate to at least UNKNOWN or FALSE,
comment|// 'collectSubRegionBindings(...)' in RegionStore.cpp will need to
comment|// handle a regions' upper boundary overflowing.
name|clang_analyzer_eval
argument_list|(
name|d39
operator|->
name|s2
operator|==
literal|10
argument_list|)
expr_stmt|;
comment|// expected-warning{{TRUE}}
return|return
literal|0
return|;
block|}
end_function

end_unit

