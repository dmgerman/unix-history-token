begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * utils module tests  * Copyright (c) 2014-2015, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"utils/bitfield.h"
end_include

begin_include
include|#
directive|include
file|"utils/ext_password.h"
end_include

begin_include
include|#
directive|include
file|"utils/trace.h"
end_include

begin_include
include|#
directive|include
file|"utils/base64.h"
end_include

begin_struct
struct|struct
name|printf_test_data
block|{
name|u8
modifier|*
name|data
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|char
modifier|*
name|encoded
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|printf_test_data
name|printf_tests
index|[]
init|=
block|{
block|{
operator|(
name|u8
operator|*
operator|)
literal|"abcde"
block|,
literal|5
block|,
literal|"abcde"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"a\0b\nc\ed\re\tf\"\\"
block|,
literal|13
block|,
literal|"a\\0b\\nc\\ed\\re\\tf\\\"\\\\"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"\x00\x31\x00\x32\x00\x39"
block|,
literal|6
block|,
literal|"\\x001\\0002\\09"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"\n\n\n"
block|,
literal|3
block|,
literal|"\n\12\x0a"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"\303\245\303\244\303\266\303\205\303\204\303\226"
block|,
literal|12
block|,
literal|"\\xc3\\xa5\xc3\\xa4\\xc3\\xb6\\xc3\\x85\\xc3\\x84\\xc3\\x96"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"\303\245\303\244\303\266\303\205\303\204\303\226"
block|,
literal|12
block|,
literal|"\\303\\245\\303\\244\\303\\266\\303\\205\\303\\204\\303\\226"
block|}
block|,
block|{
operator|(
name|u8
operator|*
operator|)
literal|"\xe5\xe4\xf6\xc5\xc4\xd6"
block|,
literal|6
block|,
literal|"\\xe5\\xe4\\xf6\\xc5\\xc4\\xd6"
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|printf_encode_decode_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|size_t
name|binlen
decl_stmt|;
name|char
name|buf
index|[
literal|100
index|]
decl_stmt|;
name|u8
name|bin
index|[
literal|100
index|]
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"printf encode/decode tests"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|printf_tests
index|[
name|i
index|]
operator|.
name|data
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|printf_test_data
modifier|*
name|test
init|=
operator|&
name|printf_tests
index|[
name|i
index|]
decl_stmt|;
name|printf_encode
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|test
operator|->
name|data
argument_list|,
name|test
operator|->
name|len
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"%d: -> \"%s\""
argument_list|,
name|i
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|binlen
operator|=
name|printf_decode
argument_list|(
name|bin
argument_list|,
sizeof|sizeof
argument_list|(
name|bin
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|binlen
operator|!=
name|test
operator|->
name|len
operator|||
name|os_memcmp
argument_list|(
name|bin
argument_list|,
name|test
operator|->
name|data
argument_list|,
name|binlen
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_hexdump
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Error in decoding#1"
argument_list|,
name|bin
argument_list|,
name|binlen
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|binlen
operator|=
name|printf_decode
argument_list|(
name|bin
argument_list|,
sizeof|sizeof
argument_list|(
name|bin
argument_list|)
argument_list|,
name|test
operator|->
name|encoded
argument_list|)
expr_stmt|;
if|if
condition|(
name|binlen
operator|!=
name|test
operator|->
name|len
operator|||
name|os_memcmp
argument_list|(
name|bin
argument_list|,
name|test
operator|->
name|data
argument_list|,
name|binlen
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|wpa_hexdump
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Error in decoding#2"
argument_list|,
name|bin
argument_list|,
name|binlen
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
name|buf
index|[
literal|5
index|]
operator|=
literal|'A'
expr_stmt|;
name|printf_encode
argument_list|(
name|buf
argument_list|,
literal|5
argument_list|,
operator|(
specifier|const
name|u8
operator|*
operator|)
literal|"abcde"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
index|[
literal|5
index|]
operator|!=
literal|'A'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Error in bounds checking#1"
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|5
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
block|{
name|buf
index|[
name|i
index|]
operator|=
literal|'A'
expr_stmt|;
name|printf_encode
argument_list|(
name|buf
argument_list|,
name|i
argument_list|,
operator|(
specifier|const
name|u8
operator|*
operator|)
literal|"\xdd\xdd\xdd\xdd\xdd"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
index|[
name|i
index|]
operator|!=
literal|'A'
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Error in bounds checking#2(%d)"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|printf_decode
argument_list|(
name|bin
argument_list|,
literal|3
argument_list|,
literal|"abcde"
argument_list|)
operator|!=
literal|2
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|printf_decode
argument_list|(
name|bin
argument_list|,
literal|3
argument_list|,
literal|"\\xa"
argument_list|)
operator|!=
literal|1
operator|||
name|bin
index|[
literal|0
index|]
operator|!=
literal|10
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|printf_decode
argument_list|(
name|bin
argument_list|,
literal|3
argument_list|,
literal|"\\a"
argument_list|)
operator|!=
literal|1
operator|||
name|bin
index|[
literal|0
index|]
operator|!=
literal|'a'
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d printf test(s) failed"
argument_list|,
name|errors
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bitfield_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|bitfield
modifier|*
name|bf
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"bitfield tests"
argument_list|)
expr_stmt|;
name|bf
operator|=
name|bitfield_alloc
argument_list|(
literal|123
argument_list|)
expr_stmt|;
if|if
condition|(
name|bf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|123
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
operator|||
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
operator|+
literal|1
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|0
operator|&&
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
operator|-
literal|1
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_clear
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|123
init|;
name|i
operator|<
literal|200
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
operator|||
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
operator|+
literal|1
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|>
literal|0
operator|&&
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
operator|-
literal|1
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_clear
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|123
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
operator|||
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
operator|+
literal|1
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|123
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_clear
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|123
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
name|i
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|123
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|bitfield_is_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_clear
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
name|i
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_free
argument_list|(
name|bf
argument_list|)
expr_stmt|;
name|bf
operator|=
name|bitfield_alloc
argument_list|(
literal|8
argument_list|)
expr_stmt|;
if|if
condition|(
name|bf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|8
condition|;
name|i
operator|++
control|)
name|bitfield_set
argument_list|(
name|bf
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|bitfield_get_first_zero
argument_list|(
name|bf
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
name|bitfield_free
argument_list|(
name|bf
argument_list|)
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d bitfield test(s) failed"
argument_list|,
name|errors
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|int_array_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|test1
index|[]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|,
literal|0
block|}
decl_stmt|;
name|int
name|test2
index|[]
init|=
block|{
literal|1
block|,
operator|-
literal|1
block|,
literal|0
block|}
decl_stmt|;
name|int
name|test3
index|[]
init|=
block|{
literal|1
block|,
literal|1
block|,
literal|1
block|,
operator|-
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|1
block|,
literal|2
block|,
literal|0
block|}
decl_stmt|;
name|int
name|test3_res
index|[]
init|=
block|{
operator|-
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|0
block|}
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|int
name|len
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"int_array tests"
argument_list|)
expr_stmt|;
if|if
condition|(
name|int_array_len
argument_list|(
name|test1
argument_list|)
operator|!=
literal|6
operator|||
name|int_array_len
argument_list|(
name|test2
argument_list|)
operator|!=
literal|2
condition|)
name|errors
operator|++
expr_stmt|;
name|int_array_sort_unique
argument_list|(
name|test3
argument_list|)
expr_stmt|;
name|len
operator|=
name|int_array_len
argument_list|(
name|test3_res
argument_list|)
expr_stmt|;
if|if
condition|(
name|int_array_len
argument_list|(
name|test3
argument_list|)
operator|!=
name|len
condition|)
name|errors
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
name|os_memcmp
argument_list|(
name|test3
argument_list|,
name|test3_res
argument_list|,
name|len
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
operator|!=
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d int_array test(s) failed"
argument_list|,
name|errors
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ext_password_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|ext_password_data
modifier|*
name|data
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|struct
name|wpabuf
modifier|*
name|pw
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"ext_password tests"
argument_list|)
expr_stmt|;
name|data
operator|=
name|ext_password_init
argument_list|(
literal|"unknown"
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|!=
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|data
operator|=
name|ext_password_init
argument_list|(
literal|"test"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|pw
operator|=
name|ext_password_get
argument_list|(
name|data
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pw
operator|!=
name|NULL
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
name|ext_password_free
argument_list|(
name|pw
argument_list|)
expr_stmt|;
name|ext_password_deinit
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|pw
operator|=
name|ext_password_get
argument_list|(
name|NULL
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
if|if
condition|(
name|pw
operator|!=
name|NULL
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
name|ext_password_free
argument_list|(
name|pw
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|trace_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"trace tests"
argument_list|)
expr_stmt|;
name|wpa_trace_show
argument_list|(
literal|"test backtrace"
argument_list|)
expr_stmt|;
name|wpa_trace_dump_funcname
argument_list|(
literal|"test funcname"
argument_list|,
name|trace_tests
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|base64_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
modifier|*
name|res
decl_stmt|;
name|size_t
name|res_len
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"base64 tests"
argument_list|)
expr_stmt|;
name|res
operator|=
name|base64_encode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|""
argument_list|,
operator|~
literal|0
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
condition|)
block|{
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
name|res
operator|=
name|base64_encode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"="
argument_list|,
literal|1
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|res
operator|||
name|res_len
operator|!=
literal|5
operator|||
name|res
index|[
literal|0
index|]
operator|!=
literal|'P'
operator|||
name|res
index|[
literal|1
index|]
operator|!=
literal|'Q'
operator|||
name|res
index|[
literal|2
index|]
operator|!=
literal|'='
operator|||
name|res
index|[
literal|3
index|]
operator|!=
literal|'='
operator|||
name|res
index|[
literal|4
index|]
operator|!=
literal|'\n'
condition|)
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
name|res
operator|=
name|base64_encode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"="
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|res
operator|||
name|res
index|[
literal|0
index|]
operator|!=
literal|'P'
operator|||
name|res
index|[
literal|1
index|]
operator|!=
literal|'Q'
operator|||
name|res
index|[
literal|2
index|]
operator|!=
literal|'='
operator|||
name|res
index|[
literal|3
index|]
operator|!=
literal|'='
operator|||
name|res
index|[
literal|4
index|]
operator|!=
literal|'\n'
condition|)
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
name|res
operator|=
name|base64_decode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|""
argument_list|,
literal|0
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
condition|)
block|{
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
name|res
operator|=
name|base64_decode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"a"
argument_list|,
literal|1
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
condition|)
block|{
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
name|res
operator|=
name|base64_decode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"===="
argument_list|,
literal|4
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
condition|)
block|{
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
name|res
operator|=
name|base64_decode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"PQ=="
argument_list|,
literal|4
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|res
operator|||
name|res_len
operator|!=
literal|1
operator|||
name|res
index|[
literal|0
index|]
operator|!=
literal|'='
condition|)
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
name|res
operator|=
name|base64_decode
argument_list|(
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
literal|"P.Q-=!=*"
argument_list|,
literal|8
argument_list|,
operator|&
name|res_len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|res
operator|||
name|res_len
operator|!=
literal|1
operator|||
name|res
index|[
literal|0
index|]
operator|!=
literal|'='
condition|)
name|errors
operator|++
expr_stmt|;
name|os_free
argument_list|(
name|res
argument_list|)
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d base64 test(s) failed"
argument_list|,
name|errors
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|common_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|buf
index|[
literal|3
index|]
decl_stmt|;
name|u8
name|addr
index|[
name|ETH_ALEN
index|]
init|=
block|{
literal|1
block|,
literal|2
block|,
literal|3
block|,
literal|4
block|,
literal|5
block|,
literal|6
block|}
decl_stmt|;
name|u8
name|bin
index|[
literal|3
index|]
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|;
name|struct
name|wpa_freq_range_list
name|ranges
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"common tests"
argument_list|)
expr_stmt|;
if|if
condition|(
name|hwaddr_mask_txt
argument_list|(
name|buf
argument_list|,
literal|3
argument_list|,
name|addr
argument_list|,
name|addr
argument_list|)
operator|!=
operator|-
literal|1
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|wpa_scnprintf
argument_list|(
name|buf
argument_list|,
literal|0
argument_list|,
literal|"hello"
argument_list|)
operator|!=
literal|0
operator|||
name|wpa_scnprintf
argument_list|(
name|buf
argument_list|,
literal|3
argument_list|,
literal|"hello"
argument_list|)
operator|!=
literal|2
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|wpa_snprintf_hex
argument_list|(
name|buf
argument_list|,
literal|0
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
operator|!=
literal|0
operator|||
name|wpa_snprintf_hex
argument_list|(
name|buf
argument_list|,
literal|3
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
operator|!=
literal|2
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|merge_byte_arrays
argument_list|(
name|bin
argument_list|,
literal|3
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
literal|3
operator|||
name|merge_byte_arrays
argument_list|(
name|bin
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|addr
argument_list|,
name|ETH_ALEN
argument_list|)
operator|!=
literal|3
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|dup_binstr
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|freq_range_list_includes
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
name|os_memset
argument_list|(
operator|&
name|ranges
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|ranges
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|freq_range_list_parse
argument_list|(
operator|&
name|ranges
argument_list|,
literal|""
argument_list|)
operator|!=
literal|0
operator|||
name|freq_range_list_includes
argument_list|(
operator|&
name|ranges
argument_list|,
literal|0
argument_list|)
operator|!=
literal|0
operator|||
name|freq_range_list_str
argument_list|(
operator|&
name|ranges
argument_list|)
operator|!=
name|NULL
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|utf8_unescape
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_unescape
argument_list|(
literal|"a"
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_unescape
argument_list|(
literal|"a\\"
argument_list|,
literal|2
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_unescape
argument_list|(
literal|"abcde"
argument_list|,
literal|5
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_unescape
argument_list|(
literal|"abc"
argument_list|,
literal|3
argument_list|,
name|buf
argument_list|,
literal|3
argument_list|)
operator|!=
literal|3
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|utf8_unescape
argument_list|(
literal|"a"
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|1
operator|||
name|buf
index|[
literal|0
index|]
operator|!=
literal|'a'
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|utf8_unescape
argument_list|(
literal|"\\b"
argument_list|,
literal|2
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|1
operator|||
name|buf
index|[
literal|0
index|]
operator|!=
literal|'b'
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|utf8_escape
argument_list|(
name|NULL
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"a"
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"abcde"
argument_list|,
literal|5
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"a\\bcde"
argument_list|,
literal|6
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"ab\\cde"
argument_list|,
literal|6
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"abc\\de"
argument_list|,
literal|6
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|0
operator|||
name|utf8_escape
argument_list|(
literal|"abc"
argument_list|,
literal|3
argument_list|,
name|buf
argument_list|,
literal|3
argument_list|)
operator|!=
literal|3
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|utf8_escape
argument_list|(
literal|"a"
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
operator|!=
literal|1
operator|||
name|buf
index|[
literal|0
index|]
operator|!=
literal|'a'
condition|)
name|errors
operator|++
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"%d common test(s) failed"
argument_list|,
name|errors
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|utils_module_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"utils module tests"
argument_list|)
expr_stmt|;
if|if
condition|(
name|printf_encode_decode_tests
argument_list|()
operator|<
literal|0
operator|||
name|ext_password_tests
argument_list|()
operator|<
literal|0
operator|||
name|trace_tests
argument_list|()
operator|<
literal|0
operator|||
name|bitfield_tests
argument_list|()
operator|<
literal|0
operator|||
name|base64_tests
argument_list|()
operator|<
literal|0
operator|||
name|common_tests
argument_list|()
operator|<
literal|0
operator|||
name|int_array_tests
argument_list|()
operator|<
literal|0
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

end_unit

