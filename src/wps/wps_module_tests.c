begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPS module tests  * Copyright (c) 2014, Jouni Malinen<j@w1.fi>  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"wps_attr_parse.h"
end_include

begin_struct
struct|struct
name|wps_attr_parse_test
block|{
specifier|const
name|char
modifier|*
name|data
decl_stmt|;
name|int
name|result
decl_stmt|;
name|int
name|extra
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|const
name|struct
name|wps_attr_parse_test
name|wps_attr_parse_test_cases
index|[]
init|=
block|{
comment|/* Empty message */
block|{
literal|""
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Truncated attribute header */
block|{
literal|"10"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"1010"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"101000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Attribute overflow */
block|{
literal|"10100001"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|CONFIG_WPS_STRICT
block|{
literal|"10270000001057000101"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"1027000010570001010000000000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
else|#
directive|else
comment|/* CONFIG_WPS_STRICT */
comment|/* Network Key workaround */
block|{
literal|"10270000001057000101"
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"10230000001057000101"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"10270000101057000101"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Mac OS X 10.6 padding workaround */
block|{
literal|"1027000010570001010000000000"
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"1027000010570001010000000000000001000000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
endif|#
directive|endif
comment|/* CONFIG_WPS_STRICT */
comment|/* Version */
block|{
literal|"104a000110"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"104a0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Message Type */
block|{
literal|"1022000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10220000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Enrollee Nonce */
block|{
literal|"101a001000112233445566778899aabbccddeeff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"101a00111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Registrar Nonce */
block|{
literal|"1039001000112233445566778899aabbccddeeff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103900111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* UUID-E */
block|{
literal|"1047001000112233445566778899aabbccddeeff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10470000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"104700111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* UUID-R */
block|{
literal|"1048001000112233445566778899aabbccddeeff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10480000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"104800111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Auth Type Flags */
block|{
literal|"100400021122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10040001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Encr Type Flags */
block|{
literal|"101000021122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10100001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Connection Type Flags */
block|{
literal|"100d0001ff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"100d0002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Config Methods */
block|{
literal|"10080002ffff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10080001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Selected Registrar Config Methods */
block|{
literal|"10530002ffff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10530001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Primary Device Type */
block|{
literal|"105400081122334455667788"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"105400111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* RF Bands */
block|{
literal|"103c0001ff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103c0002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Association State */
block|{
literal|"10020002ffff"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10020001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Config Error */
block|{
literal|"100900020001"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10090001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Device Password ID */
block|{
literal|"101200020004"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10120001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* OOB Device Password */
block|{
literal|"102c001611223344556677889900112233445566778899000007"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"102c0036112233445566778899001122334455667788990011223344556677889900112233445566778899001122334455667788990011223344"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"102c0001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"102c003711223344556677889900112233445566778899001122334455667788990011223344556677889900112233445566778899001122334455"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"102c002511223344556677889900112233445566778899001122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* OS Version */
block|{
literal|"102d000411223344"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"102d00111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* WPS State */
block|{
literal|"1044000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10440002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Authenticator */
block|{
literal|"100500081122334455667788"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10050000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"100500111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* R-Hash1 */
block|{
literal|"103d00201122334455667788990011223344556677889900112233445566778899001122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103d0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"103d0021112233445566778899001122334455667788990011223344556677889900112233"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* R-Hash2 */
block|{
literal|"103e00201122334455667788990011223344556677889900112233445566778899001122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103e0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"103e0021112233445566778899001122334455667788990011223344556677889900112233"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* E-Hash1 */
block|{
literal|"101400201122334455667788990011223344556677889900112233445566778899001122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10140000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"10140021112233445566778899001122334455667788990011223344556677889900112233"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* E-Hash2 */
block|{
literal|"101500201122334455667788990011223344556677889900112233445566778899001122"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10150000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"10150021112233445566778899001122334455667788990011223344556677889900112233"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* R-SNonce1 */
block|{
literal|"103f001011223344556677889900112233445566"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103f0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"103f00111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* R-SNonce2 */
block|{
literal|"1040001011223344556677889900112233445566"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10400000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"104000111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* E-SNonce1 */
block|{
literal|"1016001011223344556677889900112233445566"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10160000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"101600111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* E-SNonce2 */
block|{
literal|"1017001011223344556677889900112233445566"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10170000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"101700111122334455667788990011223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Key Wrap Authenticator */
block|{
literal|"101e00081122334455667788"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"101e0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"101e0009112233445566778899"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Authentication Type */
block|{
literal|"100300020001"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10030001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Encryption Type */
block|{
literal|"100f00020001"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"100f0001ff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Network Index */
block|{
literal|"1026000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10260002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Network Key Index */
block|{
literal|"1028000101"
block|,
literal|0
block|,
literal|3
block|}
block|,
block|{
literal|"10280002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* MAC Address */
block|{
literal|"10200006112233445566"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10200000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"1020000711223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Selected Registrar */
block|{
literal|"1041000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10410002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Request Type */
block|{
literal|"103a000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103a0002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Response Type */
block|{
literal|"103b000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"103b0002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Manufacturer */
block|{
literal|"10210000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Model Name */
block|{
literal|"10230000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Model Number */
block|{
literal|"10240000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Serial Number */
block|{
literal|"10420000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Device Name */
block|{
literal|"10110000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Public Key */
block|{
literal|"10320000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Enc Settings */
block|{
literal|"10180000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* SSID */
block|{
literal|"10450000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* AP Setup Locked */
block|{
literal|"1057000101"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"10570002ffff"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Requested Device Type */
block|{
literal|"106a00081122334455667788"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"106a0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"106a0009112233445566778899"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* More than maximum Requested Device Type attributes */
block|{
literal|"106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788106a00081122334455667788"
block|,
literal|0
block|,
literal|4
block|}
block|,
comment|/* Secondary Device Type List */
block|{
literal|"105500081122334455667788"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1055000711223344556677"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
block|{
literal|"1055008811223344556677889900112233445566778899001122334455667788990011223344556677889900112233445566778899001122334455667788990011223344556677889900112233445566778899001122334455667788990011223344556677889900112233445566778899001122334455667788990011223344556677889900112233445566"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* AP Channel */
block|{
literal|"100100020001"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1001000101"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Skip invalid Vendor Extension */
block|{
literal|"10490000"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1049000100"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"104900020000"
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* Too long unknown vendor extension */
block|{
literal|"10490401"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"112233445566778899001122334455667788990011223344556677889900"
literal|"1122334455"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Maximum unknown vendor extensions */
block|{
literal|"10490003111111104900032222221049000333333310490003444444104900035555551049000366666610490003777777104900038888881049000399999910490003AAAAAA"
block|,
literal|0
block|,
literal|5
block|}
block|,
comment|/* More than maximum unknown vendor extensions */
block|{
literal|"10490003111111104900032222221049000333333310490003444444104900035555551049000366666610490003777777104900038888881049000399999910490003AAAAAA10490003BBBBBB"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* WFA vendor extensions */
block|{
literal|"1049000300372a"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1049000400372a00"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1049000500372a0001"
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"1049001600372a0001ff0100020101030101040101ff00fe0101"
block|,
literal|0
block|,
literal|6
block|}
block|,
comment|/* Invalid Version2 length */
block|{
literal|"1049000500372a0000"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Invalid Network Key Shareable length */
block|{
literal|"1049000500372a0200"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Invalid Requedt To Enroll length */
block|{
literal|"1049000500372a0300"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* Invalid Settings Delay Time length */
block|{
literal|"1049000500372a0400"
block|,
operator|-
literal|1
block|,
literal|0
block|}
block|,
comment|/* More than maximum Credential attributes */
block|{
literal|"100e0000100e0000100e0000100e0000100e0000100e0000100e0000100e0000100e0000100e0000100e0000100e0000"
block|,
literal|0
block|,
literal|2
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|wps_attr_parse_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|unsigned
name|int
name|i
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS attribute parsing tests"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ARRAY_SIZE
argument_list|(
name|wps_attr_parse_test_cases
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|struct
name|wpabuf
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
specifier|const
name|struct
name|wps_attr_parse_test
modifier|*
name|test
init|=
operator|&
name|wps_attr_parse_test_cases
index|[
name|i
index|]
decl_stmt|;
name|len
operator|=
name|os_strlen
argument_list|(
name|test
operator|->
name|data
argument_list|)
operator|/
literal|2
expr_stmt|;
name|buf
operator|=
name|wpabuf_alloc
argument_list|(
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|hexstr2bin
argument_list|(
name|test
operator|->
name|data
argument_list|,
name|wpabuf_put
argument_list|(
name|buf
argument_list|,
name|len
argument_list|)
argument_list|,
name|len
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpabuf_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|buf
argument_list|,
operator|&
name|attr
argument_list|)
operator|!=
name|test
operator|->
name|result
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"WPS attribute parsing test %u failed: %s"
argument_list|,
name|i
argument_list|,
name|test
operator|->
name|data
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
block|}
switch|switch
condition|(
name|test
operator|->
name|extra
condition|)
block|{
case|case
literal|1
case|:
if|if
condition|(
operator|!
name|attr
operator|.
name|network_key
operator|||
operator|!
name|attr
operator|.
name|ap_setup_locked
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
literal|2
case|:
if|if
condition|(
name|attr
operator|.
name|num_cred
operator|!=
name|MAX_CRED_COUNT
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
operator|!
name|attr
operator|.
name|network_key_idx
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
literal|4
case|:
if|if
condition|(
name|attr
operator|.
name|num_req_dev_type
operator|!=
name|MAX_REQ_DEV_TYPE_COUNT
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
literal|5
case|:
if|if
condition|(
name|attr
operator|.
name|num_vendor_ext
operator|!=
name|MAX_WPS_PARSE_VENDOR_EXT
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
case|case
literal|6
case|:
if|if
condition|(
operator|!
name|attr
operator|.
name|version2
operator|||
operator|!
name|attr
operator|.
name|authorized_macs
operator|||
operator|!
name|attr
operator|.
name|network_key_shareable
operator|||
operator|!
name|attr
operator|.
name|request_to_enroll
operator|||
operator|!
name|attr
operator|.
name|settings_delay_time
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|wpabuf_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|int
name|wps_module_tests
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS module tests"
argument_list|)
expr_stmt|;
if|if
condition|(
name|wps_attr_parse_tests
argument_list|()
operator|<
literal|0
condition|)
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

end_unit

