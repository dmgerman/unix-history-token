begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Wi-Fi Protected Setup - Strict protocol validation routines  * Copyright (c) 2010, Atheros Communications, Inc.  *  * This software may be distributed under the terms of the BSD license.  * See README for more details.  */
end_comment

begin_include
include|#
directive|include
file|"utils/includes.h"
end_include

begin_include
include|#
directive|include
file|"utils/common.h"
end_include

begin_include
include|#
directive|include
file|"wps_i.h"
end_include

begin_include
include|#
directive|include
file|"wps.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|WPS_STRICT_ALL
end_ifndef

begin_define
define|#
directive|define
name|WPS_STRICT_WPS2
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* WPS_STRICT_ALL */
end_comment

begin_function
specifier|static
name|int
name|wps_validate_version
parameter_list|(
specifier|const
name|u8
modifier|*
name|version
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|version
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Version attribute "
literal|"missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|version
operator|!=
literal|0x10
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Version attribute "
literal|"value 0x%x"
argument_list|,
operator|*
name|version
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_version2
parameter_list|(
specifier|const
name|u8
modifier|*
name|version2
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|version2
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Version2 attribute "
literal|"missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|version2
operator|<
literal|0x20
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Version2 attribute "
literal|"value 0x%x"
argument_list|,
operator|*
name|version2
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_request_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|request_type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|request_type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Request Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|request_type
operator|>
literal|0x03
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Request Type "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|request_type
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_response_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|response_type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|response_type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Response Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|response_type
operator|>
literal|0x03
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Response Type "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|response_type
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|valid_config_methods
parameter_list|(
name|u16
name|val
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
if|if
condition|(
name|wps2
condition|)
block|{
if|if
condition|(
operator|(
name|val
operator|&
literal|0x6000
operator|)
operator|&&
operator|!
operator|(
name|val
operator|&
name|WPS_CONFIG_DISPLAY
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Physical/Virtual "
literal|"Display flag without old Display flag "
literal|"set"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|val
operator|&
literal|0x6000
operator|)
operator|&&
operator|(
name|val
operator|&
name|WPS_CONFIG_DISPLAY
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Display flag "
literal|"without Physical/Virtual Display flag"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|(
name|val
operator|&
literal|0x0600
operator|)
operator|&&
operator|!
operator|(
name|val
operator|&
name|WPS_CONFIG_PUSHBUTTON
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Physical/Virtual "
literal|"PushButton flag without old PushButton "
literal|"flag set"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|val
operator|&
literal|0x0600
operator|)
operator|&&
operator|(
name|val
operator|&
name|WPS_CONFIG_PUSHBUTTON
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: PushButton flag "
literal|"without Physical/Virtual PushButton flag"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_config_methods
parameter_list|(
specifier|const
name|u8
modifier|*
name|config_methods
parameter_list|,
name|int
name|wps2
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|config_methods
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Configuration "
literal|"Methods attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|config_methods
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_config_methods
argument_list|(
name|val
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Configuration "
literal|"Methods attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_ap_config_methods
parameter_list|(
specifier|const
name|u8
modifier|*
name|config_methods
parameter_list|,
name|int
name|wps2
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|wps_validate_config_methods
argument_list|(
name|config_methods
argument_list|,
name|wps2
argument_list|,
name|mandatory
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|config_methods
operator|==
name|NULL
condition|)
return|return
literal|0
return|;
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|config_methods
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|&
name|WPS_CONFIG_PUSHBUTTON
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Configuration "
literal|"Methods attribute value 0x%04x in AP info "
literal|"(PushButton not allowed for registering new ER)"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_uuid_e
parameter_list|(
specifier|const
name|u8
modifier|*
name|uuid_e
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|uuid_e
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: UUID-E "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_uuid_r
parameter_list|(
specifier|const
name|u8
modifier|*
name|uuid_r
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|uuid_r
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: UUID-R "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_primary_dev_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|primary_dev_type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|primary_dev_type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Primary Device Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_rf_bands
parameter_list|(
specifier|const
name|u8
modifier|*
name|rf_bands
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|rf_bands
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: RF Bands "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|rf_bands
operator|!=
name|WPS_RF_24GHZ
operator|&&
operator|*
name|rf_bands
operator|!=
name|WPS_RF_50GHZ
operator|&&
operator|*
name|rf_bands
operator|!=
operator|(
name|WPS_RF_24GHZ
operator||
name|WPS_RF_50GHZ
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Rf Bands "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|rf_bands
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_assoc_state
parameter_list|(
specifier|const
name|u8
modifier|*
name|assoc_state
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|assoc_state
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Association State "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|assoc_state
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>
literal|4
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Association State "
literal|"attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_config_error
parameter_list|(
specifier|const
name|u8
modifier|*
name|config_error
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|config_error
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Configuration Error "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|config_error
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>
literal|20
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Configuration Error "
literal|"attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_dev_password_id
parameter_list|(
specifier|const
name|u8
modifier|*
name|dev_password_id
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|dev_password_id
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Device Password ID "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|dev_password_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>=
literal|0x0008
operator|&&
name|val
operator|<=
literal|0x000f
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Device Password ID "
literal|"attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_manufacturer
parameter_list|(
specifier|const
name|u8
modifier|*
name|manufacturer
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|manufacturer
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Manufacturer "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|0
operator|&&
name|manufacturer
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Manufacturer "
literal|"attribute value"
argument_list|,
name|manufacturer
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_model_name
parameter_list|(
specifier|const
name|u8
modifier|*
name|model_name
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|model_name
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Model Name "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|0
operator|&&
name|model_name
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Model Name "
literal|"attribute value"
argument_list|,
name|model_name
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_model_number
parameter_list|(
specifier|const
name|u8
modifier|*
name|model_number
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|model_number
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Model Number "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|0
operator|&&
name|model_number
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Model Number "
literal|"attribute value"
argument_list|,
name|model_number
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_serial_number
parameter_list|(
specifier|const
name|u8
modifier|*
name|serial_number
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|serial_number
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Serial Number "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|0
operator|&&
name|serial_number
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Serial "
literal|"Number attribute value"
argument_list|,
name|serial_number
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_dev_name
parameter_list|(
specifier|const
name|u8
modifier|*
name|dev_name
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|dev_name
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Device Name "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|0
operator|&&
name|dev_name
index|[
name|len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Device Name "
literal|"attribute value"
argument_list|,
name|dev_name
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_request_to_enroll
parameter_list|(
specifier|const
name|u8
modifier|*
name|request_to_enroll
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|request_to_enroll
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Request to Enroll "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|request_to_enroll
operator|>
literal|0x01
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Request to Enroll "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|request_to_enroll
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_req_dev_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|req_dev_type
index|[]
parameter_list|,
name|size_t
name|num
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|num
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Requested Device "
literal|"Type attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_wps_state
parameter_list|(
specifier|const
name|u8
modifier|*
name|wps_state
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|wps_state
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Wi-Fi Protected "
literal|"Setup State attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|wps_state
operator|!=
name|WPS_STATE_NOT_CONFIGURED
operator|&&
operator|*
name|wps_state
operator|!=
name|WPS_STATE_CONFIGURED
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Wi-Fi Protected "
literal|"Setup State attribute value 0x%x"
argument_list|,
operator|*
name|wps_state
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_ap_setup_locked
parameter_list|(
specifier|const
name|u8
modifier|*
name|ap_setup_locked
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|ap_setup_locked
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: AP Setup Locked "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|ap_setup_locked
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid AP Setup Locked "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|ap_setup_locked
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_selected_registrar
parameter_list|(
specifier|const
name|u8
modifier|*
name|selected_registrar
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|selected_registrar
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Selected Registrar "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|selected_registrar
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Selected Registrar "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|selected_registrar
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_sel_reg_config_methods
parameter_list|(
specifier|const
name|u8
modifier|*
name|config_methods
parameter_list|,
name|int
name|wps2
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|config_methods
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Selected Registrar "
literal|"Configuration Methods attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|config_methods
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid_config_methods
argument_list|(
name|val
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Selected Registrar "
literal|"Configuration Methods attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_authorized_macs
parameter_list|(
specifier|const
name|u8
modifier|*
name|authorized_macs
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|authorized_macs
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Authorized MACs "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|>
literal|30
operator|&&
operator|(
name|len
operator|%
name|ETH_ALEN
operator|)
operator|!=
literal|0
condition|)
block|{
name|wpa_hexdump
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Authorized "
literal|"MACs attribute value"
argument_list|,
name|authorized_macs
argument_list|,
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_msg_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|msg_type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|msg_type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Message Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|msg_type
operator|<
name|WPS_Beacon
operator|||
operator|*
name|msg_type
operator|>
name|WPS_WSC_DONE
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Message Type "
literal|"attribute value 0x%x"
argument_list|,
operator|*
name|msg_type
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_mac_addr
parameter_list|(
specifier|const
name|u8
modifier|*
name|mac_addr
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|mac_addr
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: MAC Address "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|mac_addr
index|[
literal|0
index|]
operator|&
literal|0x01
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid MAC Address "
literal|"attribute value "
name|MACSTR
argument_list|,
name|MAC2STR
argument_list|(
name|mac_addr
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_enrollee_nonce
parameter_list|(
specifier|const
name|u8
modifier|*
name|enrollee_nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|enrollee_nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Enrollee Nonce "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_registrar_nonce
parameter_list|(
specifier|const
name|u8
modifier|*
name|registrar_nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|registrar_nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Registrar Nonce "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_public_key
parameter_list|(
specifier|const
name|u8
modifier|*
name|public_key
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|public_key
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Public Key "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|!=
literal|192
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Public Key "
literal|"attribute length %d"
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|num_bits_set
parameter_list|(
name|u16
name|val
parameter_list|)
block|{
name|int
name|c
decl_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|val
condition|;
name|c
operator|++
control|)
name|val
operator|&=
name|val
operator|-
literal|1
expr_stmt|;
return|return
name|c
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_auth_type_flags
parameter_list|(
specifier|const
name|u8
modifier|*
name|flags
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|flags
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Authentication Type "
literal|"Flags attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|val
operator|&
operator|~
name|WPS_AUTH_TYPES
operator|)
operator|||
operator|!
operator|(
name|val
operator|&
name|WPS_AUTH_WPA2PSK
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Authentication Type "
literal|"Flags attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_auth_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Authentication Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|val
operator|&
operator|~
name|WPS_AUTH_TYPES
operator|)
operator|||
name|val
operator|==
literal|0
operator|||
operator|(
name|num_bits_set
argument_list|(
name|val
argument_list|)
operator|>
literal|1
operator|&&
name|val
operator|!=
operator|(
name|WPS_AUTH_WPAPSK
operator||
name|WPS_AUTH_WPA2PSK
operator|)
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Authentication Type "
literal|"attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_encr_type_flags
parameter_list|(
specifier|const
name|u8
modifier|*
name|flags
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|flags
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Encryption Type "
literal|"Flags attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|val
operator|&
operator|~
name|WPS_ENCR_TYPES
operator|)
operator|||
operator|!
operator|(
name|val
operator|&
name|WPS_ENCR_AES
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Encryption Type "
literal|"Flags attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_encr_type
parameter_list|(
specifier|const
name|u8
modifier|*
name|type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|u16
name|val
decl_stmt|;
if|if
condition|(
name|type
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Encryption Type "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
name|val
operator|=
name|WPA_GET_BE16
argument_list|(
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|val
operator|&
operator|~
name|WPS_ENCR_TYPES
operator|)
operator|||
name|val
operator|==
literal|0
operator|||
operator|(
name|num_bits_set
argument_list|(
name|val
argument_list|)
operator|>
literal|1
operator|&&
name|val
operator|!=
operator|(
name|WPS_ENCR_TKIP
operator||
name|WPS_ENCR_AES
operator|)
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Encryption Type "
literal|"attribute value 0x%04x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_conn_type_flags
parameter_list|(
specifier|const
name|u8
modifier|*
name|flags
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|flags
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Connection Type "
literal|"Flags attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|(
operator|*
name|flags
operator|&
operator|~
operator|(
name|WPS_CONN_ESS
operator||
name|WPS_CONN_IBSS
operator|)
operator|)
operator|||
operator|!
operator|(
operator|*
name|flags
operator|&
name|WPS_CONN_ESS
operator|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Connection Type "
literal|"Flags attribute value 0x%02x"
argument_list|,
operator|*
name|flags
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_os_version
parameter_list|(
specifier|const
name|u8
modifier|*
name|os_version
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|os_version
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: OS Version "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_authenticator
parameter_list|(
specifier|const
name|u8
modifier|*
name|authenticator
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|authenticator
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Authenticator "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_e_hash1
parameter_list|(
specifier|const
name|u8
modifier|*
name|hash
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|hash
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: E-Hash1 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_e_hash2
parameter_list|(
specifier|const
name|u8
modifier|*
name|hash
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|hash
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: E-Hash2 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_r_hash1
parameter_list|(
specifier|const
name|u8
modifier|*
name|hash
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|hash
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: R-Hash1 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_r_hash2
parameter_list|(
specifier|const
name|u8
modifier|*
name|hash
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|hash
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: R-Hash2 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_encr_settings
parameter_list|(
specifier|const
name|u8
modifier|*
name|encr_settings
parameter_list|,
name|size_t
name|len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|encr_settings
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Encrypted Settings "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|len
operator|<
literal|16
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Encrypted Settings "
literal|"attribute length %d"
argument_list|,
operator|(
name|int
operator|)
name|len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_settings_delay_time
parameter_list|(
specifier|const
name|u8
modifier|*
name|delay
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|delay
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Settings Delay Time "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_r_snonce1
parameter_list|(
specifier|const
name|u8
modifier|*
name|nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: R-SNonce1 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_r_snonce2
parameter_list|(
specifier|const
name|u8
modifier|*
name|nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: R-SNonce2 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_e_snonce1
parameter_list|(
specifier|const
name|u8
modifier|*
name|nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: E-SNonce1 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_e_snonce2
parameter_list|(
specifier|const
name|u8
modifier|*
name|nonce
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|nonce
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: E-SNonce2 "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_key_wrap_auth
parameter_list|(
specifier|const
name|u8
modifier|*
name|auth
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|auth
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Key Wrap "
literal|"Authenticator attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_ssid
parameter_list|(
specifier|const
name|u8
modifier|*
name|ssid
parameter_list|,
name|size_t
name|ssid_len
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|ssid
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: SSID "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
name|ssid_len
operator|==
literal|0
operator|||
name|ssid
index|[
name|ssid_len
operator|-
literal|1
index|]
operator|==
literal|0
condition|)
block|{
name|wpa_hexdump_ascii
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid SSID "
literal|"attribute value"
argument_list|,
name|ssid
argument_list|,
name|ssid_len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_network_key_index
parameter_list|(
specifier|const
name|u8
modifier|*
name|idx
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|idx
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Network Key Index "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_network_idx
parameter_list|(
specifier|const
name|u8
modifier|*
name|idx
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|idx
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Network Index "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_network_key
parameter_list|(
specifier|const
name|u8
modifier|*
name|key
parameter_list|,
name|size_t
name|key_len
parameter_list|,
specifier|const
name|u8
modifier|*
name|encr_type
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|key
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Network Key "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|(
operator|(
name|encr_type
operator|==
name|NULL
operator|||
name|WPA_GET_BE16
argument_list|(
name|encr_type
argument_list|)
operator|!=
name|WPS_ENCR_WEP
operator|)
operator|&&
name|key_len
operator|>
literal|8
operator|&&
name|key_len
operator|<
literal|64
operator|&&
name|key
index|[
name|key_len
operator|-
literal|1
index|]
operator|==
literal|0
operator|)
operator|||
name|key_len
operator|>
literal|64
condition|)
block|{
name|wpa_hexdump_ascii_key
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Network "
literal|"Key attribute value"
argument_list|,
name|key
argument_list|,
name|key_len
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_network_key_shareable
parameter_list|(
specifier|const
name|u8
modifier|*
name|val
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
if|if
condition|(
name|val
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Network Key "
literal|"Shareable attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|*
name|val
operator|>
literal|1
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Network Key "
literal|"Shareable attribute value 0x%x"
argument_list|,
operator|*
name|val
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_cred
parameter_list|(
specifier|const
name|u8
modifier|*
name|cred
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|struct
name|wpabuf
name|buf
decl_stmt|;
if|if
condition|(
name|cred
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|wpabuf_set
argument_list|(
operator|&
name|buf
argument_list|,
name|cred
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|wps_parse_msg
argument_list|(
operator|&
name|buf
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse Credential"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_network_idx
argument_list|(
name|attr
operator|.
name|network_idx
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_ssid
argument_list|(
name|attr
operator|.
name|ssid
argument_list|,
name|attr
operator|.
name|ssid_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_auth_type
argument_list|(
name|attr
operator|.
name|auth_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_type
argument_list|(
name|attr
operator|.
name|encr_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_network_key_index
argument_list|(
name|attr
operator|.
name|network_key_idx
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_network_key
argument_list|(
name|attr
operator|.
name|network_key
argument_list|,
name|attr
operator|.
name|network_key_len
argument_list|,
name|attr
operator|.
name|encr_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_mac_addr
argument_list|(
name|attr
operator|.
name|mac_addr
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_network_key_shareable
argument_list|(
name|attr
operator|.
name|network_key_shareable
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Credential"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wps_validate_credential
parameter_list|(
specifier|const
name|u8
modifier|*
name|cred
index|[]
parameter_list|,
name|size_t
name|len
index|[]
parameter_list|,
name|size_t
name|num
parameter_list|,
name|int
name|mandatory
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
if|if
condition|(
name|num
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|mandatory
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Credential "
literal|"attribute missing"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|wps_validate_cred
argument_list|(
name|cred
index|[
name|i
index|]
argument_list|,
name|len
index|[
name|i
index|]
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_beacon
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|wps_ie
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|,
name|sel_reg
decl_stmt|;
if|if
condition|(
name|wps_ie
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No WPS IE in Beacon frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|wps_ie
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse WPS IE in "
literal|"Beacon frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
name|sel_reg
operator|=
name|attr
operator|.
name|selected_registrar
operator|!=
name|NULL
operator|&&
operator|*
name|attr
operator|.
name|selected_registrar
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_wps_state
argument_list|(
name|attr
operator|.
name|wps_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_ap_setup_locked
argument_list|(
name|attr
operator|.
name|ap_setup_locked
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_selected_registrar
argument_list|(
name|attr
operator|.
name|selected_registrar
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_sel_reg_config_methods
argument_list|(
name|attr
operator|.
name|sel_reg_config_methods
argument_list|,
name|wps2
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_uuid_e
argument_list|(
name|attr
operator|.
name|uuid_e
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authorized_macs
argument_list|(
name|attr
operator|.
name|authorized_macs
argument_list|,
name|attr
operator|.
name|authorized_macs_len
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Beacon frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_beacon_probe_resp
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|wps_ie
parameter_list|,
name|int
name|probe
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|,
name|sel_reg
decl_stmt|;
if|if
condition|(
name|wps_ie
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No WPS IE in "
literal|"%sProbe Response frame"
argument_list|,
name|probe
condition|?
literal|""
else|:
literal|"Beacon/"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|wps_ie
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse WPS IE in "
literal|"%sProbe Response frame"
argument_list|,
name|probe
condition|?
literal|""
else|:
literal|"Beacon/"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
name|sel_reg
operator|=
name|attr
operator|.
name|selected_registrar
operator|!=
name|NULL
operator|&&
operator|*
name|attr
operator|.
name|selected_registrar
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_wps_state
argument_list|(
name|attr
operator|.
name|wps_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_ap_setup_locked
argument_list|(
name|attr
operator|.
name|ap_setup_locked
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_selected_registrar
argument_list|(
name|attr
operator|.
name|selected_registrar
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_sel_reg_config_methods
argument_list|(
name|attr
operator|.
name|sel_reg_config_methods
argument_list|,
name|wps2
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_response_type
argument_list|(
name|attr
operator|.
name|response_type
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_uuid_e
argument_list|(
name|attr
operator|.
name|uuid_e
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_manufacturer
argument_list|(
name|attr
operator|.
name|manufacturer
argument_list|,
name|attr
operator|.
name|manufacturer_len
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_model_name
argument_list|(
name|attr
operator|.
name|model_name
argument_list|,
name|attr
operator|.
name|model_name_len
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_model_number
argument_list|(
name|attr
operator|.
name|model_number
argument_list|,
name|attr
operator|.
name|model_number_len
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_serial_number
argument_list|(
name|attr
operator|.
name|serial_number
argument_list|,
name|attr
operator|.
name|serial_number_len
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_primary_dev_type
argument_list|(
name|attr
operator|.
name|primary_dev_type
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_dev_name
argument_list|(
name|attr
operator|.
name|dev_name
argument_list|,
name|attr
operator|.
name|dev_name_len
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_ap_config_methods
argument_list|(
name|attr
operator|.
name|config_methods
argument_list|,
name|wps2
argument_list|,
name|probe
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authorized_macs
argument_list|(
name|attr
operator|.
name|authorized_macs
argument_list|,
name|attr
operator|.
name|authorized_macs_len
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid %sProbe Response "
literal|"frame from "
name|MACSTR
argument_list|,
name|probe
condition|?
literal|""
else|:
literal|"Beacon/"
argument_list|,
name|MAC2STR
argument_list|(
name|addr
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_probe_req
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|wps_ie
parameter_list|,
specifier|const
name|u8
modifier|*
name|addr
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|wps_ie
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No WPS IE in "
literal|"Probe Request frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|wps_ie
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse WPS IE in "
literal|"Probe Request frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_request_type
argument_list|(
name|attr
operator|.
name|request_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_methods
argument_list|(
name|attr
operator|.
name|config_methods
argument_list|,
name|wps2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_uuid_e
argument_list|(
name|attr
operator|.
name|uuid_e
argument_list|,
name|attr
operator|.
name|uuid_r
operator|==
name|NULL
argument_list|)
operator|||
name|wps_validate_uuid_r
argument_list|(
name|attr
operator|.
name|uuid_r
argument_list|,
name|attr
operator|.
name|uuid_e
operator|==
name|NULL
argument_list|)
operator|||
name|wps_validate_primary_dev_type
argument_list|(
name|attr
operator|.
name|primary_dev_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_assoc_state
argument_list|(
name|attr
operator|.
name|assoc_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_error
argument_list|(
name|attr
operator|.
name|config_error
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_manufacturer
argument_list|(
name|attr
operator|.
name|manufacturer
argument_list|,
name|attr
operator|.
name|manufacturer_len
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_model_name
argument_list|(
name|attr
operator|.
name|model_name
argument_list|,
name|attr
operator|.
name|model_name_len
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_model_number
argument_list|(
name|attr
operator|.
name|model_number
argument_list|,
name|attr
operator|.
name|model_number_len
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_dev_name
argument_list|(
name|attr
operator|.
name|dev_name
argument_list|,
name|attr
operator|.
name|dev_name_len
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_request_to_enroll
argument_list|(
name|attr
operator|.
name|request_to_enroll
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_req_dev_type
argument_list|(
name|attr
operator|.
name|req_dev_type
argument_list|,
name|attr
operator|.
name|num_req_dev_type
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid Probe Request "
literal|"frame from "
name|MACSTR
argument_list|,
name|MAC2STR
argument_list|(
name|addr
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_assoc_req
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|wps_ie
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|wps_ie
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No WPS IE in "
literal|"(Re)Association Request frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|wps_ie
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse WPS IE in "
literal|"(Re)Association Request frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_request_type
argument_list|(
name|attr
operator|.
name|request_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid (Re)Association "
literal|"Request frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_assoc_resp
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|wps_ie
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|wps_ie
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No WPS IE in "
literal|"(Re)Association Response frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|wps_ie
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse WPS IE in "
literal|"(Re)Association Response frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_response_type
argument_list|(
name|attr
operator|.
name|response_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid (Re)Association "
literal|"Response frame"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m1
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M1"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M1"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_uuid_e
argument_list|(
name|attr
operator|.
name|uuid_e
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_mac_addr
argument_list|(
name|attr
operator|.
name|mac_addr
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_public_key
argument_list|(
name|attr
operator|.
name|public_key
argument_list|,
name|attr
operator|.
name|public_key_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_auth_type_flags
argument_list|(
name|attr
operator|.
name|auth_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_type_flags
argument_list|(
name|attr
operator|.
name|encr_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_conn_type_flags
argument_list|(
name|attr
operator|.
name|conn_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_methods
argument_list|(
name|attr
operator|.
name|config_methods
argument_list|,
name|wps2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_wps_state
argument_list|(
name|attr
operator|.
name|wps_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_manufacturer
argument_list|(
name|attr
operator|.
name|manufacturer
argument_list|,
name|attr
operator|.
name|manufacturer_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_name
argument_list|(
name|attr
operator|.
name|model_name
argument_list|,
name|attr
operator|.
name|model_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_number
argument_list|(
name|attr
operator|.
name|model_number
argument_list|,
name|attr
operator|.
name|model_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_serial_number
argument_list|(
name|attr
operator|.
name|serial_number
argument_list|,
name|attr
operator|.
name|serial_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_primary_dev_type
argument_list|(
name|attr
operator|.
name|primary_dev_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_name
argument_list|(
name|attr
operator|.
name|dev_name
argument_list|,
name|attr
operator|.
name|dev_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_assoc_state
argument_list|(
name|attr
operator|.
name|assoc_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_error
argument_list|(
name|attr
operator|.
name|config_error
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_os_version
argument_list|(
name|attr
operator|.
name|os_version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_request_to_enroll
argument_list|(
name|attr
operator|.
name|request_to_enroll
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M1"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m2
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M2"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M2"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_uuid_r
argument_list|(
name|attr
operator|.
name|uuid_r
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_public_key
argument_list|(
name|attr
operator|.
name|public_key
argument_list|,
name|attr
operator|.
name|public_key_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_auth_type_flags
argument_list|(
name|attr
operator|.
name|auth_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_type_flags
argument_list|(
name|attr
operator|.
name|encr_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_conn_type_flags
argument_list|(
name|attr
operator|.
name|conn_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_methods
argument_list|(
name|attr
operator|.
name|config_methods
argument_list|,
name|wps2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_manufacturer
argument_list|(
name|attr
operator|.
name|manufacturer
argument_list|,
name|attr
operator|.
name|manufacturer_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_name
argument_list|(
name|attr
operator|.
name|model_name
argument_list|,
name|attr
operator|.
name|model_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_number
argument_list|(
name|attr
operator|.
name|model_number
argument_list|,
name|attr
operator|.
name|model_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_serial_number
argument_list|(
name|attr
operator|.
name|serial_number
argument_list|,
name|attr
operator|.
name|serial_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_primary_dev_type
argument_list|(
name|attr
operator|.
name|primary_dev_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_name
argument_list|(
name|attr
operator|.
name|dev_name
argument_list|,
name|attr
operator|.
name|dev_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_assoc_state
argument_list|(
name|attr
operator|.
name|assoc_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_error
argument_list|(
name|attr
operator|.
name|config_error
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_os_version
argument_list|(
name|attr
operator|.
name|os_version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M2"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m2d
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M2D"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M2D"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_uuid_r
argument_list|(
name|attr
operator|.
name|uuid_r
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_auth_type_flags
argument_list|(
name|attr
operator|.
name|auth_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_type_flags
argument_list|(
name|attr
operator|.
name|encr_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_conn_type_flags
argument_list|(
name|attr
operator|.
name|conn_type_flags
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_methods
argument_list|(
name|attr
operator|.
name|config_methods
argument_list|,
name|wps2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_manufacturer
argument_list|(
name|attr
operator|.
name|manufacturer
argument_list|,
name|attr
operator|.
name|manufacturer_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_name
argument_list|(
name|attr
operator|.
name|model_name
argument_list|,
name|attr
operator|.
name|model_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_model_number
argument_list|(
name|attr
operator|.
name|model_number
argument_list|,
name|attr
operator|.
name|model_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_serial_number
argument_list|(
name|attr
operator|.
name|serial_number
argument_list|,
name|attr
operator|.
name|serial_number_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_primary_dev_type
argument_list|(
name|attr
operator|.
name|primary_dev_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_name
argument_list|(
name|attr
operator|.
name|dev_name
argument_list|,
name|attr
operator|.
name|dev_name_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_rf_bands
argument_list|(
name|attr
operator|.
name|rf_bands
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_assoc_state
argument_list|(
name|attr
operator|.
name|assoc_state
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_error
argument_list|(
name|attr
operator|.
name|config_error
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_os_version
argument_list|(
name|attr
operator|.
name|os_version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M2D"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m3
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M3"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M3"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_e_hash1
argument_list|(
name|attr
operator|.
name|e_hash1
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_e_hash2
argument_list|(
name|attr
operator|.
name|e_hash2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M3"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m4
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M4"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M4"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_r_hash1
argument_list|(
name|attr
operator|.
name|r_hash1
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_r_hash2
argument_list|(
name|attr
operator|.
name|r_hash2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_settings
argument_list|(
name|attr
operator|.
name|encr_settings
argument_list|,
name|attr
operator|.
name|encr_settings_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M4"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m4_encr
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M4 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M4 encrypted settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_r_snonce1
argument_list|(
name|attr
operator|.
name|r_snonce1
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_key_wrap_auth
argument_list|(
name|attr
operator|.
name|key_wrap_auth
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M4 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m5
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M5"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M5"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_settings
argument_list|(
name|attr
operator|.
name|encr_settings
argument_list|,
name|attr
operator|.
name|encr_settings_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M5"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m5_encr
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M5 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M5 encrypted settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_e_snonce1
argument_list|(
name|attr
operator|.
name|e_snonce1
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_key_wrap_auth
argument_list|(
name|attr
operator|.
name|key_wrap_auth
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M5 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m6
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M6"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M6"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_settings
argument_list|(
name|attr
operator|.
name|encr_settings
argument_list|,
name|attr
operator|.
name|encr_settings_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M6"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m6_encr
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M6 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M6 encrypted settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_r_snonce2
argument_list|(
name|attr
operator|.
name|r_snonce2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_key_wrap_auth
argument_list|(
name|attr
operator|.
name|key_wrap_auth
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M6 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m7
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M7"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M7"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_settings
argument_list|(
name|attr
operator|.
name|encr_settings
argument_list|,
name|attr
operator|.
name|encr_settings_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_settings_delay_time
argument_list|(
name|attr
operator|.
name|settings_delay_time
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M7"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m7_encr
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|,
name|int
name|ap
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M7 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M7 encrypted settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_e_snonce2
argument_list|(
name|attr
operator|.
name|e_snonce2
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_ssid
argument_list|(
name|attr
operator|.
name|ssid
argument_list|,
name|attr
operator|.
name|ssid_len
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_mac_addr
argument_list|(
name|attr
operator|.
name|mac_addr
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_auth_type
argument_list|(
name|attr
operator|.
name|auth_type
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_encr_type
argument_list|(
name|attr
operator|.
name|encr_type
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_network_key_index
argument_list|(
name|attr
operator|.
name|network_key_idx
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_network_key
argument_list|(
name|attr
operator|.
name|network_key
argument_list|,
name|attr
operator|.
name|network_key_len
argument_list|,
name|attr
operator|.
name|encr_type
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_key_wrap_auth
argument_list|(
name|attr
operator|.
name|key_wrap_auth
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M7 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m8
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M8"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M8"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_encr_settings
argument_list|(
name|attr
operator|.
name|encr_settings
argument_list|,
name|attr
operator|.
name|encr_settings_len
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authenticator
argument_list|(
name|attr
operator|.
name|authenticator
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M8"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_m8_encr
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|,
name|int
name|ap
parameter_list|,
name|int
name|wps2
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in M8 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in M8 encrypted settings"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_validate_ssid
argument_list|(
name|attr
operator|.
name|ssid
argument_list|,
name|attr
operator|.
name|ssid_len
argument_list|,
name|ap
argument_list|)
operator|||
name|wps_validate_auth_type
argument_list|(
name|attr
operator|.
name|auth_type
argument_list|,
name|ap
argument_list|)
operator|||
name|wps_validate_encr_type
argument_list|(
name|attr
operator|.
name|encr_type
argument_list|,
name|ap
argument_list|)
operator|||
name|wps_validate_network_key_index
argument_list|(
name|attr
operator|.
name|network_key_idx
argument_list|,
literal|0
argument_list|)
operator|||
name|wps_validate_mac_addr
argument_list|(
name|attr
operator|.
name|mac_addr
argument_list|,
name|ap
argument_list|)
operator|||
name|wps_validate_credential
argument_list|(
name|attr
operator|.
name|cred
argument_list|,
name|attr
operator|.
name|cred_len
argument_list|,
name|attr
operator|.
name|num_cred
argument_list|,
operator|!
name|ap
argument_list|)
operator|||
name|wps_validate_key_wrap_auth
argument_list|(
name|attr
operator|.
name|key_wrap_auth
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid M8 encrypted "
literal|"settings"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_wsc_ack
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in WSC_ACK"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in WSC_ACK"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid WSC_ACK"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_wsc_nack
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in WSC_NACK"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in WSC_NACK"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_config_error
argument_list|(
name|attr
operator|.
name|config_error
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid WSC_NACK"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_wsc_done
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in WSC_Done"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in WSC_Done"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_msg_type
argument_list|(
name|attr
operator|.
name|msg_type
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_enrollee_nonce
argument_list|(
name|attr
operator|.
name|enrollee_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_registrar_nonce
argument_list|(
name|attr
operator|.
name|registrar_nonce
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid WSC_Done"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|wps_validate_upnp_set_selected_registrar
parameter_list|(
specifier|const
name|struct
name|wpabuf
modifier|*
name|tlvs
parameter_list|)
block|{
name|struct
name|wps_parse_attr
name|attr
decl_stmt|;
name|int
name|wps2
decl_stmt|;
name|int
name|sel_reg
decl_stmt|;
if|if
condition|(
name|tlvs
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: No TLVs in "
literal|"SetSelectedRegistrar"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|wps_parse_msg
argument_list|(
name|tlvs
argument_list|,
operator|&
name|attr
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Failed to parse attributes "
literal|"in SetSelectedRegistrar"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wps2
operator|=
name|attr
operator|.
name|version2
operator|!=
name|NULL
expr_stmt|;
name|sel_reg
operator|=
name|attr
operator|.
name|selected_registrar
operator|!=
name|NULL
operator|&&
operator|*
name|attr
operator|.
name|selected_registrar
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
name|wps_validate_version
argument_list|(
name|attr
operator|.
name|version
argument_list|,
literal|1
argument_list|)
operator|||
name|wps_validate_dev_password_id
argument_list|(
name|attr
operator|.
name|dev_password_id
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_sel_reg_config_methods
argument_list|(
name|attr
operator|.
name|sel_reg_config_methods
argument_list|,
name|wps2
argument_list|,
name|sel_reg
argument_list|)
operator|||
name|wps_validate_version2
argument_list|(
name|attr
operator|.
name|version2
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_authorized_macs
argument_list|(
name|attr
operator|.
name|authorized_macs
argument_list|,
name|attr
operator|.
name|authorized_macs_len
argument_list|,
name|wps2
argument_list|)
operator|||
name|wps_validate_uuid_r
argument_list|(
name|attr
operator|.
name|uuid_r
argument_list|,
name|wps2
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_INFO
argument_list|,
literal|"WPS-STRICT: Invalid "
literal|"SetSelectedRegistrar"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|WPS_STRICT_WPS2
if|if
condition|(
name|wps2
condition|)
return|return
operator|-
literal|1
return|;
else|#
directive|else
comment|/* WPS_STRICT_WPS2 */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* WPS_STRICT_WPS2 */
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

