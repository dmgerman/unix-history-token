begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * IEEE 802.1X-2004 Authenticator - State dump  * Copyright (c) 2002-2009, Jouni Malinen<j@w1.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"eap_server/eap.h"
end_include

begin_include
include|#
directive|include
file|"eapol_auth_sm.h"
end_include

begin_include
include|#
directive|include
file|"eapol_auth_sm_i.h"
end_include

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|port_type_txt
parameter_list|(
name|PortTypes
name|pt
parameter_list|)
block|{
switch|switch
condition|(
name|pt
condition|)
block|{
case|case
name|ForceUnauthorized
case|:
return|return
literal|"ForceUnauthorized"
return|;
case|case
name|ForceAuthorized
case|:
return|return
literal|"ForceAuthorized"
return|;
case|case
name|Auto
case|:
return|return
literal|"Auto"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|port_state_txt
parameter_list|(
name|PortState
name|ps
parameter_list|)
block|{
switch|switch
condition|(
name|ps
condition|)
block|{
case|case
name|Unauthorized
case|:
return|return
literal|"Unauthorized"
return|;
case|case
name|Authorized
case|:
return|return
literal|"Authorized"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|ctrl_dir_txt
parameter_list|(
name|ControlledDirection
name|dir
parameter_list|)
block|{
switch|switch
condition|(
name|dir
condition|)
block|{
case|case
name|Both
case|:
return|return
literal|"Both"
return|;
case|case
name|In
case|:
return|return
literal|"In"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|auth_pae_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|AUTH_PAE_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|AUTH_PAE_DISCONNECTED
case|:
return|return
literal|"DISCONNECTED"
return|;
case|case
name|AUTH_PAE_CONNECTING
case|:
return|return
literal|"CONNECTING"
return|;
case|case
name|AUTH_PAE_AUTHENTICATING
case|:
return|return
literal|"AUTHENTICATING"
return|;
case|case
name|AUTH_PAE_AUTHENTICATED
case|:
return|return
literal|"AUTHENTICATED"
return|;
case|case
name|AUTH_PAE_ABORTING
case|:
return|return
literal|"ABORTING"
return|;
case|case
name|AUTH_PAE_HELD
case|:
return|return
literal|"HELD"
return|;
case|case
name|AUTH_PAE_FORCE_AUTH
case|:
return|return
literal|"FORCE_AUTH"
return|;
case|case
name|AUTH_PAE_FORCE_UNAUTH
case|:
return|return
literal|"FORCE_UNAUTH"
return|;
case|case
name|AUTH_PAE_RESTART
case|:
return|return
literal|"RESTART"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|be_auth_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|BE_AUTH_REQUEST
case|:
return|return
literal|"REQUEST"
return|;
case|case
name|BE_AUTH_RESPONSE
case|:
return|return
literal|"RESPONSE"
return|;
case|case
name|BE_AUTH_SUCCESS
case|:
return|return
literal|"SUCCESS"
return|;
case|case
name|BE_AUTH_FAIL
case|:
return|return
literal|"FAIL"
return|;
case|case
name|BE_AUTH_TIMEOUT
case|:
return|return
literal|"TIMEOUT"
return|;
case|case
name|BE_AUTH_IDLE
case|:
return|return
literal|"IDLE"
return|;
case|case
name|BE_AUTH_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|BE_AUTH_IGNORE
case|:
return|return
literal|"IGNORE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|reauth_timer_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|REAUTH_TIMER_INITIALIZE
case|:
return|return
literal|"INITIALIZE"
return|;
case|case
name|REAUTH_TIMER_REAUTHENTICATE
case|:
return|return
literal|"REAUTHENTICATE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|auth_key_tx_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|AUTH_KEY_TX_NO_KEY_TRANSMIT
case|:
return|return
literal|"NO_KEY_TRANSMIT"
return|;
case|case
name|AUTH_KEY_TX_KEY_TRANSMIT
case|:
return|return
literal|"KEY_TRANSMIT"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|key_rx_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|KEY_RX_NO_KEY_RECEIVE
case|:
return|return
literal|"NO_KEY_RECEIVE"
return|;
case|case
name|KEY_RX_KEY_RECEIVE
case|:
return|return
literal|"KEY_RECEIVE"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
specifier|const
name|char
modifier|*
name|ctrl_dir_state_txt
parameter_list|(
name|int
name|s
parameter_list|)
block|{
switch|switch
condition|(
name|s
condition|)
block|{
case|case
name|CTRL_DIR_FORCE_BOTH
case|:
return|return
literal|"FORCE_BOTH"
return|;
case|case
name|CTRL_DIR_IN_OR_BOTH
case|:
return|return
literal|"IN_OR_BOTH"
return|;
default|default:
return|return
literal|"Unknown"
return|;
block|}
block|}
end_function

begin_function
name|void
name|eapol_auth_dump_state
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|prefix
parameter_list|,
name|struct
name|eapol_state_machine
modifier|*
name|sm
parameter_list|)
block|{
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%sEAPOL state machine:\n"
argument_list|,
name|prefix
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  aWhile=%d quietWhile=%d reAuthWhen=%d\n"
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|aWhile
argument_list|,
name|sm
operator|->
name|quietWhile
argument_list|,
name|sm
operator|->
name|reAuthWhen
argument_list|)
expr_stmt|;
define|#
directive|define
name|_SB
parameter_list|(
name|b
parameter_list|)
value|((b) ? "TRUE" : "FALSE")
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  authAbort=%s authFail=%s authPortStatus=%s authStart=%s\n"
literal|"%s  authTimeout=%s authSuccess=%s eapFail=%s eapolEap=%s\n"
literal|"%s  eapSuccess=%s eapTimeout=%s initialize=%s "
literal|"keyAvailable=%s\n"
literal|"%s  keyDone=%s keyRun=%s keyTxEnabled=%s portControl=%s\n"
literal|"%s  portEnabled=%s portValid=%s reAuthenticate=%s\n"
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authAbort
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authFail
argument_list|)
argument_list|,
name|port_state_txt
argument_list|(
name|sm
operator|->
name|authPortStatus
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authStart
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authTimeout
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|authSuccess
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapFail
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolEap
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapSuccess
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapTimeout
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|initialize
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapKeyAvailable
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyDone
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyRun
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|keyTxEnabled
argument_list|)
argument_list|,
name|port_type_txt
argument_list|(
name|sm
operator|->
name|portControl
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|portEnabled
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|portValid
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|reAuthenticate
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Authenticator PAE:\n"
literal|"%s    state=%s\n"
literal|"%s    eapolLogoff=%s eapolStart=%s eapRestart=%s\n"
literal|"%s    portMode=%s reAuthCount=%d\n"
literal|"%s    quietPeriod=%d reAuthMax=%d\n"
literal|"%s    authEntersConnecting=%d\n"
literal|"%s    authEapLogoffsWhileConnecting=%d\n"
literal|"%s    authEntersAuthenticating=%d\n"
literal|"%s    authAuthSuccessesWhileAuthenticating=%d\n"
literal|"%s    authAuthTimeoutsWhileAuthenticating=%d\n"
literal|"%s    authAuthFailWhileAuthenticating=%d\n"
literal|"%s    authAuthEapStartsWhileAuthenticating=%d\n"
literal|"%s    authAuthEapLogoffWhileAuthenticating=%d\n"
literal|"%s    authAuthReauthsWhileAuthenticated=%d\n"
literal|"%s    authAuthEapStartsWhileAuthenticated=%d\n"
literal|"%s    authAuthEapLogoffWhileAuthenticated=%d\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|auth_pae_state_txt
argument_list|(
name|sm
operator|->
name|auth_pae_state
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolLogoff
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eapolStart
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapRestart
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|port_type_txt
argument_list|(
name|sm
operator|->
name|portMode
argument_list|)
argument_list|,
name|sm
operator|->
name|reAuthCount
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|quietPeriod
argument_list|,
name|sm
operator|->
name|reAuthMax
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authEntersConnecting
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authEapLogoffsWhileConnecting
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authEntersAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthSuccessesWhileAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthTimeoutsWhileAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthFailWhileAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthEapStartsWhileAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthEapLogoffWhileAuthenticating
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthReauthsWhileAuthenticated
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthEapStartsWhileAuthenticated
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|authAuthEapLogoffWhileAuthenticated
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Backend Authentication:\n"
literal|"%s    state=%s\n"
literal|"%s    eapNoReq=%s eapReq=%s eapResp=%s\n"
literal|"%s    serverTimeout=%d\n"
literal|"%s    backendResponses=%d\n"
literal|"%s    backendAccessChallenges=%d\n"
literal|"%s    backendOtherRequestsToSupplicant=%d\n"
literal|"%s    backendAuthSuccesses=%d\n"
literal|"%s    backendAuthFails=%d\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|be_auth_state_txt
argument_list|(
name|sm
operator|->
name|be_auth_state
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapNoReq
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapReq
argument_list|)
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|eap_if
operator|->
name|eapResp
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|serverTimeout
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|backendResponses
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|backendAccessChallenges
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|backendOtherRequestsToSupplicant
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|backendAuthSuccesses
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|backendAuthFails
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Reauthentication Timer:\n"
literal|"%s    state=%s\n"
literal|"%s    reAuthPeriod=%d reAuthEnabled=%s\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|reauth_timer_state_txt
argument_list|(
name|sm
operator|->
name|reauth_timer_state
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|sm
operator|->
name|reAuthPeriod
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|reAuthEnabled
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Authenticator Key Transmit:\n"
literal|"%s    state=%s\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|auth_key_tx_state_txt
argument_list|(
name|sm
operator|->
name|auth_key_tx_state
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Key Receive:\n"
literal|"%s    state=%s\n"
literal|"%s    rxKey=%s\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|key_rx_state_txt
argument_list|(
name|sm
operator|->
name|key_rx_state
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|rxKey
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%s  Controlled Directions:\n"
literal|"%s    state=%s\n"
literal|"%s    adminControlledDirections=%s "
literal|"operControlledDirections=%s\n"
literal|"%s    operEdge=%s\n"
argument_list|,
name|prefix
argument_list|,
name|prefix
argument_list|,
name|ctrl_dir_state_txt
argument_list|(
name|sm
operator|->
name|ctrl_dir_state
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|ctrl_dir_txt
argument_list|(
name|sm
operator|->
name|adminControlledDirections
argument_list|)
argument_list|,
name|ctrl_dir_txt
argument_list|(
name|sm
operator|->
name|operControlledDirections
argument_list|)
argument_list|,
name|prefix
argument_list|,
name|_SB
argument_list|(
name|sm
operator|->
name|operEdge
argument_list|)
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|_SB
block|}
end_function

end_unit

