begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * testcode/unitdname.c - unit test for dname routines.  *  * Copyright (c) 2007, NLnet Labs. All rights reserved.  *  * This software is open source.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * Redistributions of source code must retain the above copyright notice,  * this list of conditions and the following disclaimer.  *  * Redistributions in binary form must reproduce the above copyright notice,  * this list of conditions and the following disclaimer in the documentation  * and/or other materials provided with the distribution.  *  * Neither the name of the NLNET LABS nor the names of its contributors may  * be used to endorse or promote products derived from this software without  * specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED  * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING  * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  *  */
end_comment

begin_comment
comment|/**  * \file  * Calls dname unit tests. Exits with code 1 on a failure.   */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"util/log.h"
end_include

begin_include
include|#
directive|include
file|"testcode/unitmain.h"
end_include

begin_include
include|#
directive|include
file|"util/data/dname.h"
end_include

begin_include
include|#
directive|include
file|"ldns/sbuffer.h"
end_include

begin_include
include|#
directive|include
file|"ldns/str2wire.h"
end_include

begin_comment
comment|/** put dname into buffer */
end_comment

begin_function
specifier|static
name|sldns_buffer
modifier|*
name|dname_to_buf
parameter_list|(
name|sldns_buffer
modifier|*
name|b
parameter_list|,
specifier|const
name|char
modifier|*
name|str
parameter_list|)
block|{
name|int
name|e
decl_stmt|;
name|size_t
name|len
init|=
name|sldns_buffer_capacity
argument_list|(
name|b
argument_list|)
decl_stmt|;
name|sldns_buffer_clear
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|e
operator|=
name|sldns_str2wire_dname_buf
argument_list|(
name|str
argument_list|,
name|sldns_buffer_begin
argument_list|(
name|b
argument_list|)
argument_list|,
operator|&
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|!=
literal|0
condition|)
name|fatal_exit
argument_list|(
literal|"%s ldns: %s"
argument_list|,
name|__func__
argument_list|,
name|sldns_get_errorstr_parse
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|sldns_buffer_set_position
argument_list|(
name|b
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|b
argument_list|)
expr_stmt|;
return|return
name|b
return|;
block|}
end_function

begin_comment
comment|/** test query_dname_len function */
end_comment

begin_function
specifier|static
name|void
name|dname_test_qdl
parameter_list|(
name|sldns_buffer
modifier|*
name|buff
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"query_dname_len"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_len
argument_list|(
name|dname_to_buf
argument_list|(
name|buff
argument_list|,
literal|"."
argument_list|)
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_len
argument_list|(
name|dname_to_buf
argument_list|(
name|buff
argument_list|,
literal|"bla.foo."
argument_list|)
argument_list|)
operator|==
literal|9
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_len
argument_list|(
name|dname_to_buf
argument_list|(
name|buff
argument_list|,
literal|"x.y.z.example.com."
argument_list|)
argument_list|)
operator|==
literal|19
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test query_dname_tolower */
end_comment

begin_function
specifier|static
name|void
name|dname_test_qdtl
parameter_list|(
name|sldns_buffer
modifier|*
name|buff
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"query_dname_tolower"
argument_list|)
expr_stmt|;
name|sldns_buffer_write_at
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
literal|"\012abCDeaBCde\003cOm\000"
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|query_dname_tolower
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|memcmp
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|,
literal|"\012abcdeabcde\003com\000"
argument_list|,
literal|16
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|sldns_buffer_write_at
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
literal|"\001+\012abC{e-ZYXe\003NET\000"
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|query_dname_tolower
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|memcmp
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|,
literal|"\001+\012abc{e-zyxe\003net\000"
argument_list|,
literal|18
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|sldns_buffer_write_at
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
literal|"\000"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|query_dname_tolower
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|memcmp
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|,
literal|"\000"
argument_list|,
literal|1
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|sldns_buffer_write_at
argument_list|(
name|buff
argument_list|,
literal|0
argument_list|,
literal|"\002NL\000"
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|query_dname_tolower
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|memcmp
argument_list|(
name|sldns_buffer_begin
argument_list|(
name|buff
argument_list|)
argument_list|,
literal|"\002nl\000"
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test query_dname_compare */
end_comment

begin_function
specifier|static
name|void
name|dname_test_query_dname_compare
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"query_dname_compare"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aBc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003AbC\001A"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc"
argument_list|)
operator|==
operator|+
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
operator|==
operator|+
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003xxx\001a"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003axx\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001Z"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001Z"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003abc\001a"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_count_labels */
end_comment

begin_function
specifier|static
name|void
name|dname_test_count_labels
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_count_labels"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003com"
argument_list|)
operator|==
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_count_size_labels */
end_comment

begin_function
specifier|static
name|void
name|dname_test_count_size_labels
parameter_list|(
name|void
parameter_list|)
block|{
name|size_t
name|sz
init|=
literal|0
decl_stmt|;
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_count_size_labels"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_size_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|&
name|sz
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sz
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_size_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|&
name|sz
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sz
operator|==
literal|5
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_size_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|,
operator|&
name|sz
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sz
operator|==
literal|5
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_size_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
operator|&
name|sz
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sz
operator|==
literal|13
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_count_size_labels
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example"
literal|"\003com"
argument_list|,
operator|&
name|sz
argument_list|)
operator|==
literal|4
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sz
operator|==
literal|17
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test pkt_dname_len */
end_comment

begin_function
specifier|static
name|void
name|dname_test_pkt_dname_len
parameter_list|(
name|sldns_buffer
modifier|*
name|buff
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"pkt_dname_len"
argument_list|)
expr_stmt|;
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\000"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sldns_buffer_position
argument_list|(
name|buff
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\003org\000"
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|5
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sldns_buffer_position
argument_list|(
name|buff
argument_list|)
operator|==
literal|5
argument_list|)
expr_stmt|;
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\002os\007example\003org\000"
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|16
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sldns_buffer_position
argument_list|(
name|buff
argument_list|)
operator|==
literal|16
argument_list|)
expr_stmt|;
comment|/* invalid compression pointer: to self */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\300\000os\007example\003org\000"
argument_list|,
literal|17
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* valid compression pointer */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\003com\000\040\300\000"
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_set_position
argument_list|(
name|buff
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|5
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sldns_buffer_position
argument_list|(
name|buff
argument_list|)
operator|==
literal|8
argument_list|)
expr_stmt|;
comment|/* unknown label type */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\002os\107example\003org\000"
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* label too long */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\002os\047example\003org\000"
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* label exceeds packet */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\002os\007example\007org\004"
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* name very long */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\020a1cdef5555544444"
literal|"\020a2cdef5555544444"
literal|"\020a3cdef5555544444"
literal|"\020a4cdef5555544444"
literal|"\020a5cdef5555544444"
literal|"\020a6cdef5555544444"
literal|"\020a7cdef5555544444"
literal|"\020a8cdef5555544444"
literal|"\020a9cdef5555544444"
literal|"\020aAcdef5555544444"
literal|"\020aBcdef5555544444"
literal|"\020aCcdef5555544444"
literal|"\020aDcdef5555544444"
literal|"\020aEcdef5555544444"
comment|/* 238 up to here */
literal|"\007aabbccd"
comment|/* 246 up to here */
literal|"\007example\000"
comment|/* 255 to here */
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|255
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|sldns_buffer_position
argument_list|(
name|buff
argument_list|)
operator|==
literal|255
argument_list|)
expr_stmt|;
comment|/* name too long */
name|sldns_buffer_clear
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_write
argument_list|(
name|buff
argument_list|,
literal|"\020a1cdef5555544444"
literal|"\020a2cdef5555544444"
literal|"\020a3cdef5555544444"
literal|"\020a4cdef5555544444"
literal|"\020a5cdef5555544444"
literal|"\020a6cdef5555544444"
literal|"\020a7cdef5555544444"
literal|"\020a8cdef5555544444"
literal|"\020a9cdef5555544444"
literal|"\020aAcdef5555544444"
literal|"\020aBcdef5555544444"
literal|"\020aCcdef5555544444"
literal|"\020aXcdef5555544444"
literal|"\020aXcdef5555544444"
literal|"\020aXcdef5555544444"
literal|"\020aDcdef5555544444"
literal|"\020aEcdef5555544444"
comment|/* 238 up to here */
literal|"\007aabbccd"
comment|/* 246 up to here */
literal|"\007example\000"
comment|/* 255 to here */
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|pkt_dname_len
argument_list|(
name|buff
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_lab_cmp */
end_comment

begin_function
specifier|static
name|void
name|dname_test_dname_lab_cmp
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|ml
init|=
literal|0
decl_stmt|;
comment|/* number of labels that matched exactly */
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_lab_cmp"
argument_list|)
expr_stmt|;
comment|/* test for equality succeeds */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004test\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004test\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|4
argument_list|)
expr_stmt|;
comment|/* root is smaller than anything else */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|/* label length makes a difference */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004neta"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|&
name|ml
argument_list|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\002ne"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004neta"
argument_list|,
literal|2
argument_list|,
operator|&
name|ml
argument_list|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|/* contents follow the zone apex */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|/* label content makes a difference */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|,
literal|4
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\003aag\007example\003net"
argument_list|,
literal|5
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\003bla\007example\003net"
argument_list|,
literal|5
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\02sn\003opt\003aag\007example\003net"
argument_list|,
literal|6
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\02sn\003opt\003bla\007example\003net"
argument_list|,
literal|6
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|3
argument_list|)
expr_stmt|;
comment|/* but lowercase/uppercase does not make a difference. */
name|unit_assert
argument_list|(
name|dname_lab_cmp
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bLa\007examPLe\003net"
argument_list|,
literal|4
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007eXAmple\003nET"
argument_list|,
literal|4
argument_list|,
operator|&
name|ml
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|ml
operator|==
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_subdomain_c */
end_comment

begin_function
specifier|static
name|void
name|dname_test_subdomain
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_subdomain"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_subdomain_c
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003org"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_strict_subdomain */
end_comment

begin_function
specifier|static
name|void
name|dname_test_strict_subdomain
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_strict_subdomain"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
literal|3
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_strict_subdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
literal|2
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003org"
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_is_root */
end_comment

begin_function
specifier|static
name|void
name|dname_test_isroot
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_isroot"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_is_root
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_is_root
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_is_root
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\005abvcd\003com\000"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* malformed dname in this test, but should work */
name|unit_assert
argument_list|(
operator|!
name|dname_is_root
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\077a\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_is_root
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_remove_label */
end_comment

begin_function
specifier|static
name|void
name|dname_test_removelabel
parameter_list|(
name|void
parameter_list|)
block|{
name|uint8_t
modifier|*
name|orig
init|=
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com\000"
decl_stmt|;
name|uint8_t
modifier|*
name|n
init|=
name|orig
decl_stmt|;
name|size_t
name|l
init|=
literal|13
decl_stmt|;
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_remove_label"
argument_list|)
expr_stmt|;
name|dname_remove_label
argument_list|(
operator|&
name|n
argument_list|,
operator|&
name|l
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|n
operator|==
name|orig
operator|+
literal|8
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|l
operator|==
literal|5
argument_list|)
expr_stmt|;
name|dname_remove_label
argument_list|(
operator|&
name|n
argument_list|,
operator|&
name|l
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|n
operator|==
name|orig
operator|+
literal|12
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|l
operator|==
literal|1
argument_list|)
expr_stmt|;
name|dname_remove_label
argument_list|(
operator|&
name|n
argument_list|,
operator|&
name|l
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|n
operator|==
name|orig
operator|+
literal|12
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|l
operator|==
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_signame_label_count */
end_comment

begin_function
specifier|static
name|void
name|dname_test_sigcount
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_signame_label_count"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003xom\000"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\003xom\000"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003xom\000"
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\007example\003xom\000"
argument_list|)
operator|==
literal|2
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003xom\000"
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_signame_label_count
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\003www\007example\003xom\000"
argument_list|)
operator|==
literal|3
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_is_wild routine */
end_comment

begin_function
specifier|static
name|void
name|dname_test_iswild
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_iswild"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_is_wild
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_is_wild
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
operator|!
name|dname_is_wild
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net\000"
argument_list|)
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_is_wild
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\003net\000"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test dname_canonical_compare */
end_comment

begin_function
specifier|static
name|void
name|dname_test_canoncmp
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_canonical_compare"
argument_list|)
expr_stmt|;
comment|/* equality */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004test\007example\003net\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004test\007example\003net\000"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* subdomains */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\000"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* compare rightmost label */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003com"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003org"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003net"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|/* label length makes a difference; but only if rest is equal */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004neta"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003net"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\002ne"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004neta"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* label content */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\007example\003net"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\003aag\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003aag\003bla\007example\003net"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\02sn\003opt\003aag\007example\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\02sn\003opt\003bla\007example\003net"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* lowercase during compare */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bLa\007examPLe\003net"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007eXAmple\003nET"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|/* example from 4034 */
comment|/* example a.example yljkjljk.a.example Z.a.example zABC.a.EXAMPLE 	 z.example \001.z.example *.z.example \200.z.example */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\200\001z\007example"
argument_list|)
operator|==
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* same example in reverse */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\200\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|/* same example for equality */
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001a\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\010yljkjljk\001a\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001Z\001a\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\004zABC\001a\007EXAMPLE"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001z\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\001\001z\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001*\001z\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_canonical_compare
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\200\001z\007example"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\001\200\001z\007example"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** Test dname_get_shared_topdomain */
end_comment

begin_function
specifier|static
name|void
name|dname_test_topdomain
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_get_shared_topdomain"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
name|dname_get_shared_topdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
name|dname_get_shared_topdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003com"
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003com"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|query_dname_compare
argument_list|(
name|dname_get_shared_topdomain
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003com"
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003bla\007example\003com"
argument_list|)
argument_list|,
operator|(
name|uint8_t
operator|*
operator|)
literal|"\007example\003com"
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** Test dname_valid */
end_comment

begin_function
specifier|static
name|void
name|dname_test_valid
parameter_list|(
name|void
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"dname_valid"
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_valid
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\003www\007example\003com"
argument_list|,
literal|255
argument_list|)
operator|==
literal|17
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_valid
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|""
argument_list|,
literal|255
argument_list|)
operator|==
literal|1
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_valid
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\020a1cdef5555544444"
literal|"\020a2cdef5555544444"
literal|"\020a3cdef5555544444"
literal|"\020a4cdef5555544444"
literal|"\020a5cdef5555544444"
literal|"\020a6cdef5555544444"
literal|"\020a7cdef5555544444"
literal|"\020a8cdef5555544444"
literal|"\020a9cdef5555544444"
literal|"\020aAcdef5555544444"
literal|"\020aBcdef5555544444"
literal|"\020aCcdef5555544444"
literal|"\020aDcdef5555544444"
literal|"\020aEcdef5555544444"
comment|/* 238 up to here */
literal|"\007aabbccd"
comment|/* 246 up to here */
literal|"\007example\000"
comment|/* 255 to here */
argument_list|,
literal|255
argument_list|)
operator|==
literal|255
argument_list|)
expr_stmt|;
name|unit_assert
argument_list|(
name|dname_valid
argument_list|(
operator|(
name|uint8_t
operator|*
operator|)
literal|"\020a1cdef5555544444"
literal|"\020a2cdef5555544444"
literal|"\020a3cdef5555544444"
literal|"\020a4cdef5555544444"
literal|"\020a5cdef5555544444"
literal|"\020a6cdef5555544444"
literal|"\020a7cdef5555544444"
literal|"\020a8cdef5555544444"
literal|"\020a9cdef5555544444"
literal|"\020aAcdef5555544444"
literal|"\020aBcdef5555544444"
literal|"\020aCcdef5555544444"
literal|"\020aDcdef5555544444"
literal|"\020aEcdef5555544444"
comment|/* 238 up to here */
literal|"\007aabbccd"
comment|/* 246 up to here */
literal|"\010exampleX\000"
comment|/* 256 to here */
argument_list|,
literal|4096
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** test pkt_dname_tolower */
end_comment

begin_function
specifier|static
name|void
name|dname_test_pdtl
parameter_list|(
name|sldns_buffer
modifier|*
name|loopbuf
parameter_list|,
name|sldns_buffer
modifier|*
name|boundbuf
parameter_list|)
block|{
name|unit_show_func
argument_list|(
literal|"util/data/dname.c"
argument_list|,
literal|"pkt_dname_tolower"
argument_list|)
expr_stmt|;
name|pkt_dname_tolower
argument_list|(
name|loopbuf
argument_list|,
name|sldns_buffer_at
argument_list|(
name|loopbuf
argument_list|,
literal|12
argument_list|)
argument_list|)
expr_stmt|;
name|pkt_dname_tolower
argument_list|(
name|boundbuf
argument_list|,
name|sldns_buffer_at
argument_list|(
name|boundbuf
argument_list|,
literal|12
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** setup looped dname and out-of-bounds dname ptr */
end_comment

begin_function
specifier|static
name|void
name|dname_setup_bufs
parameter_list|(
name|sldns_buffer
modifier|*
name|loopbuf
parameter_list|,
name|sldns_buffer
modifier|*
name|boundbuf
parameter_list|)
block|{
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|0xd54d
argument_list|)
expr_stmt|;
comment|/* id */
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|0x12
argument_list|)
expr_stmt|;
comment|/* flags  */
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* qdcount */
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* ancount */
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* nscount */
name|sldns_buffer_write_u16
argument_list|(
name|loopbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* arcount */
name|sldns_buffer_write_u8
argument_list|(
name|loopbuf
argument_list|,
literal|0xc0
argument_list|)
expr_stmt|;
comment|/* PTR back at itself */
name|sldns_buffer_write_u8
argument_list|(
name|loopbuf
argument_list|,
literal|0x0c
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|loopbuf
argument_list|)
expr_stmt|;
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|0xd54d
argument_list|)
expr_stmt|;
comment|/* id */
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|0x12
argument_list|)
expr_stmt|;
comment|/* flags  */
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* qdcount */
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* ancount */
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* nscount */
name|sldns_buffer_write_u16
argument_list|(
name|boundbuf
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* arcount */
name|sldns_buffer_write_u8
argument_list|(
name|boundbuf
argument_list|,
literal|0x01
argument_list|)
expr_stmt|;
comment|/* len=1 */
name|sldns_buffer_write_u8
argument_list|(
name|boundbuf
argument_list|,
operator|(
name|uint8_t
operator|)
literal|'A'
argument_list|)
expr_stmt|;
comment|/* A. label */
name|sldns_buffer_write_u8
argument_list|(
name|boundbuf
argument_list|,
literal|0xc0
argument_list|)
expr_stmt|;
comment|/* PTR out of bounds */
name|sldns_buffer_write_u8
argument_list|(
name|boundbuf
argument_list|,
literal|0xcc
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|boundbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|dname_test
parameter_list|(
name|void
parameter_list|)
block|{
name|sldns_buffer
modifier|*
name|loopbuf
init|=
name|sldns_buffer_new
argument_list|(
literal|14
argument_list|)
decl_stmt|;
name|sldns_buffer
modifier|*
name|boundbuf
init|=
name|sldns_buffer_new
argument_list|(
literal|16
argument_list|)
decl_stmt|;
name|sldns_buffer
modifier|*
name|buff
init|=
name|sldns_buffer_new
argument_list|(
literal|65800
argument_list|)
decl_stmt|;
name|unit_assert
argument_list|(
name|loopbuf
operator|&&
name|boundbuf
operator|&&
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_flip
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|dname_setup_bufs
argument_list|(
name|loopbuf
argument_list|,
name|boundbuf
argument_list|)
expr_stmt|;
name|dname_test_qdl
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|dname_test_qdtl
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|dname_test_pdtl
argument_list|(
name|loopbuf
argument_list|,
name|boundbuf
argument_list|)
expr_stmt|;
name|dname_test_query_dname_compare
argument_list|()
expr_stmt|;
name|dname_test_count_labels
argument_list|()
expr_stmt|;
name|dname_test_count_size_labels
argument_list|()
expr_stmt|;
name|dname_test_dname_lab_cmp
argument_list|()
expr_stmt|;
name|dname_test_pkt_dname_len
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|dname_test_strict_subdomain
argument_list|()
expr_stmt|;
name|dname_test_subdomain
argument_list|()
expr_stmt|;
name|dname_test_isroot
argument_list|()
expr_stmt|;
name|dname_test_removelabel
argument_list|()
expr_stmt|;
name|dname_test_sigcount
argument_list|()
expr_stmt|;
name|dname_test_iswild
argument_list|()
expr_stmt|;
name|dname_test_canoncmp
argument_list|()
expr_stmt|;
name|dname_test_topdomain
argument_list|()
expr_stmt|;
name|dname_test_valid
argument_list|()
expr_stmt|;
name|sldns_buffer_free
argument_list|(
name|buff
argument_list|)
expr_stmt|;
name|sldns_buffer_free
argument_list|(
name|loopbuf
argument_list|)
expr_stmt|;
name|sldns_buffer_free
argument_list|(
name|boundbuf
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

