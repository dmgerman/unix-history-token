begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2013 Qualcomm Atheros, Inc.  *  * Permission to use, copy, modify, and/or distribute this software for any  * purpose with or without fee is hereby granted, provided that the above  * copyright notice and this permission notice appear in all copies.  *  * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH  * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY  * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,  * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM  * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR  * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR  * PERFORMANCE OF THIS SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|"opt_ah.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|AH_SUPPORT_AR9300
end_ifdef

begin_include
include|#
directive|include
file|"ah.h"
end_include

begin_include
include|#
directive|include
file|"ah_internal.h"
end_include

begin_include
include|#
directive|include
file|"ah_devid.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300desc.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300reg.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300phy.h"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300paprd.h"
end_include

begin_comment
comment|/* Add static register initialization vectors */
end_comment

begin_include
include|#
directive|include
file|"ar9300/ar9300_osprey22.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9330_11.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9330_12.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9340.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9485.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9485_1_1.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300_jupiter10.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300_jupiter20.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9580.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar955x.ini"
end_include

begin_include
include|#
directive|include
file|"ar9300/ar9300_aphrodite10.ini"
end_include

begin_function_decl
specifier|static
name|HAL_BOOL
name|ar9300_get_chip_power_limits
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_CHANNEL
modifier|*
name|chans
parameter_list|,
name|u_int32_t
name|nchans
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|HAL_STATUS
name|ar9300_init_mac_addr
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|HAL_STATUS
name|ar9300_hw_attach
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|void
name|ar9300_hw_detach
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int16_t
name|ar9300_get_nf_adjust
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|HAL_CHANNEL_INTERNAL
modifier|*
name|c
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|ar9300_get_cal_intervals
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_CALIBRATION_TIMER
modifier|*
modifier|*
name|timerp
parameter_list|,
name|HAL_CAL_QUERY
name|query
parameter_list|)
function_decl|;
end_function_decl

begin_if
if|#
directive|if
name|ATH_TRAFFIC_FAST_RECOVER
end_if

begin_function_decl
name|unsigned
name|long
name|ar9300_get_pll3_sqsum_dvc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|int
name|ar9300_init_offsets
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int16_t
name|devid
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ar9300_disable_pcie_phy
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|static
specifier|const
name|HAL_PERCAL_DATA
name|iq_cal_single_sample
init|=
block|{
name|IQ_MISMATCH_CAL
block|,
name|MIN_CAL_SAMPLES
block|,
name|PER_MAX_LOG_COUNT
block|,
name|ar9300_iq_cal_collect
block|,
name|ar9300_iq_calibration
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|HAL_CALIBRATION_TIMER
name|ar9300_cals
index|[]
init|=
block|{
block|{
name|IQ_MISMATCH_CAL
block|,
comment|/* Cal type */
literal|1200000
block|,
comment|/* Cal interval */
literal|0
comment|/* Cal timestamp */
block|}
block|,
block|{
name|TEMP_COMP_CAL
block|,
literal|5000
block|,
literal|0
block|}
block|,                           }
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
name|ATH_PCIE_ERROR_MONITOR
end_if

begin_function
name|int
name|ar9300_start_pcie_error_monitor
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|b_auto_stop
parameter_list|)
block|{
name|u_int32_t
name|val
decl_stmt|;
comment|/* Clear the counters */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTR0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTR1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Read the previous value */
name|val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTRL
argument_list|)
expr_stmt|;
comment|/* Set auto_stop */
if|if
condition|(
name|b_auto_stop
condition|)
block|{
name|val
operator||=
name|RCVD_ERR_CTR_AUTO_STOP
operator||
name|BAD_TLP_ERR_CTR_AUTO_STOP
operator||
name|BAD_DLLP_ERR_CTR_AUTO_STOP
operator||
name|RPLY_TO_ERR_CTR_AUTO_STOP
operator||
name|RPLY_NUM_RO_ERR_CTR_AUTO_STOP
expr_stmt|;
block|}
else|else
block|{
name|val
operator|&=
operator|~
operator|(
name|RCVD_ERR_CTR_AUTO_STOP
operator||
name|BAD_TLP_ERR_CTR_AUTO_STOP
operator||
name|BAD_DLLP_ERR_CTR_AUTO_STOP
operator||
name|RPLY_TO_ERR_CTR_AUTO_STOP
operator||
name|RPLY_NUM_RO_ERR_CTR_AUTO_STOP
operator|)
expr_stmt|;
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTRL
argument_list|,
name|val
argument_list|)
expr_stmt|;
comment|/*      * Start to run.      * This has to be done separately from the above auto_stop flag setting,      * to avoid a HW race condition.      */
name|val
operator||=
name|RCVD_ERR_CTR_RUN
operator||
name|BAD_TLP_ERR_CTR_RUN
operator||
name|BAD_DLLP_ERR_CTR_RUN
operator||
name|RPLY_TO_ERR_CTR_RUN
operator||
name|RPLY_NUM_RO_ERR_CTR_RUN
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTRL
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|ar9300_read_pcie_error_monitor
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|void
modifier|*
name|p_read_counters
parameter_list|)
block|{
name|u_int32_t
name|val
decl_stmt|;
name|ar_pcie_error_moniter_counters
modifier|*
name|p_counters
init|=
operator|(
name|ar_pcie_error_moniter_counters
operator|*
operator|)
name|p_read_counters
decl_stmt|;
name|val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTR0
argument_list|)
expr_stmt|;
name|p_counters
operator|->
name|uc_receiver_errors
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|RCVD_ERR_MASK
argument_list|)
expr_stmt|;
name|p_counters
operator|->
name|uc_bad_tlp_errors
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|BAD_TLP_ERR_MASK
argument_list|)
expr_stmt|;
name|p_counters
operator|->
name|uc_bad_dllp_errors
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|BAD_DLLP_ERR_MASK
argument_list|)
expr_stmt|;
name|val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTR1
argument_list|)
expr_stmt|;
name|p_counters
operator|->
name|uc_replay_timeout_errors
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|RPLY_TO_ERR_MASK
argument_list|)
expr_stmt|;
name|p_counters
operator|->
name|uc_replay_number_rollover_errors
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|RPLY_NUM_RO_ERR_MASK
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|ar9300_stop_pcie_error_monitor
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|u_int32_t
name|val
decl_stmt|;
comment|/* Read the previous value */
name|val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTRL
argument_list|)
expr_stmt|;
name|val
operator|&=
operator|~
operator|(
name|RCVD_ERR_CTR_RUN
operator||
name|BAD_TLP_ERR_CTR_RUN
operator||
name|BAD_DLLP_ERR_CTR_RUN
operator||
name|RPLY_TO_ERR_CTR_RUN
operator||
name|RPLY_NUM_RO_ERR_CTR_RUN
operator|)
expr_stmt|;
comment|/* Start to stop */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PCIE_CO_ERR_CTR_CTRL
argument_list|,
name|val
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ATH_PCIE_ERROR_MONITOR */
end_comment

begin_comment
comment|/* WIN32 does not support C99 */
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|ath_hal_private
name|ar9300hal
init|=
block|{
block|{
name|ar9300_get_rate_table
block|,
comment|/* ah_get_rate_table */
name|ar9300_detach
block|,
comment|/* ah_detach */
comment|/* Reset Functions */
name|ar9300_reset
block|,
comment|/* ah_reset */
name|ar9300_phy_disable
block|,
comment|/* ah_phy_disable */
name|ar9300_disable
block|,
comment|/* ah_disable */
name|ar9300_config_pci_power_save
block|,
comment|/* ah_config_pci_power_save */
name|ar9300_set_pcu_config
block|,
comment|/* ah_set_pcu_config */
name|ar9300_calibration
block|,
comment|/* ah_per_calibration */
name|ar9300_reset_cal_valid
block|,
comment|/* ah_reset_cal_valid */
name|ar9300_set_tx_power_limit
block|,
comment|/* ah_set_tx_power_limit */
if|#
directive|if
name|ATH_ANT_DIV_COMB
name|ar9300_ant_ctrl_set_lna_div_use_bt_ant
block|,
comment|/* ah_ant_ctrl_set_lna_div_use_bt_ant */
endif|#
directive|endif
comment|/* ATH_ANT_DIV_COMB */
ifdef|#
directive|ifdef
name|ATH_SUPPORT_DFS
name|ar9300_radar_wait
block|,
comment|/* ah_radar_wait */
comment|/* New DFS functions */
name|ar9300_check_dfs
block|,
comment|/* ah_ar_check_dfs */
name|ar9300_dfs_found
block|,
comment|/* ah_ar_dfs_found */
name|ar9300_enable_dfs
block|,
comment|/* ah_ar_enable_dfs */
name|ar9300_get_dfs_thresh
block|,
comment|/* ah_ar_get_dfs_thresh */
name|ar9300_get_dfs_radars
block|,
comment|/* ah_ar_get_dfs_radars */
name|ar9300_adjust_difs
block|,
comment|/* ah_adjust_difs */
name|ar9300_dfs_config_fft
block|,
comment|/* ah_dfs_config_fft */
name|ar9300_dfs_cac_war
block|,
comment|/* ah_dfs_cac_war */
name|ar9300_cac_tx_quiet
block|,
comment|/* ah_cac_tx_quiet */
endif|#
directive|endif
name|ar9300_get_extension_channel
block|,
comment|/* ah_get_extension_channel */
name|ar9300_is_fast_clock_enabled
block|,
comment|/* ah_is_fast_clock_enabled */
comment|/* Transmit functions */
name|ar9300_update_tx_trig_level
block|,
comment|/* ah_update_tx_trig_level */
name|ar9300_get_tx_trig_level
block|,
comment|/* ah_get_tx_trig_level */
name|ar9300_setup_tx_queue
block|,
comment|/* ah_setup_tx_queue */
name|ar9300_set_tx_queue_props
block|,
comment|/* ah_set_tx_queue_props */
name|ar9300_get_tx_queue_props
block|,
comment|/* ah_get_tx_queue_props */
name|ar9300_release_tx_queue
block|,
comment|/* ah_release_tx_queue */
name|ar9300_reset_tx_queue
block|,
comment|/* ah_reset_tx_queue */
name|ar9300_get_tx_dp
block|,
comment|/* ah_get_tx_dp */
name|ar9300_set_tx_dp
block|,
comment|/* ah_set_tx_dp */
name|ar9300_num_tx_pending
block|,
comment|/* ah_num_tx_pending */
name|ar9300_start_tx_dma
block|,
comment|/* ah_start_tx_dma */
name|ar9300_stop_tx_dma
block|,
comment|/* ah_stop_tx_dma */
name|ar9300_stop_tx_dma_indv_que
block|,
comment|/* ah_stop_tx_dma_indv_que */
name|ar9300_abort_tx_dma
block|,
comment|/* ah_abort_tx_dma */
name|ar9300_fill_tx_desc
block|,
comment|/* ah_fill_tx_desc */
name|ar9300_set_desc_link
block|,
comment|/* ah_set_desc_link */
name|ar9300_get_desc_link_ptr
block|,
comment|/* ah_get_desc_link_ptr */
name|ar9300_clear_tx_desc_status
block|,
comment|/* ah_clear_tx_desc_status */
ifdef|#
directive|ifdef
name|ATH_SWRETRY
name|ar9300_clear_dest_mask
block|,
comment|/* ah_clear_dest_mask */
endif|#
directive|endif
name|ar9300_proc_tx_desc
block|,
comment|/* ah_proc_tx_desc */
name|ar9300_get_raw_tx_desc
block|,
comment|/* ah_get_raw_tx_desc */
name|ar9300_get_tx_rate_code
block|,
comment|/* ah_get_tx_rate_code */
name|AH_NULL
block|,
comment|/* ah_get_tx_intr_queue */
name|ar9300_tx_req_intr_desc
block|,
comment|/* ah_req_tx_intr_desc */
name|ar9300_calc_tx_airtime
block|,
comment|/* ah_calc_tx_airtime */
name|ar9300_setup_tx_status_ring
block|,
comment|/* ah_setup_tx_status_ring */
comment|/* RX Functions */
name|ar9300_get_rx_dp
block|,
comment|/* ah_get_rx_dp */
name|ar9300_set_rx_dp
block|,
comment|/* ah_set_rx_dp */
name|ar9300_enable_receive
block|,
comment|/* ah_enable_receive */
name|ar9300_stop_dma_receive
block|,
comment|/* ah_stop_dma_receive */
name|ar9300_start_pcu_receive
block|,
comment|/* ah_start_pcu_receive */
name|ar9300_stop_pcu_receive
block|,
comment|/* ah_stop_pcu_receive */
name|ar9300_set_multicast_filter
block|,
comment|/* ah_set_multicast_filter */
name|ar9300_get_rx_filter
block|,
comment|/* ah_get_rx_filter */
name|ar9300_set_rx_filter
block|,
comment|/* ah_set_rx_filter */
name|ar9300_set_rx_sel_evm
block|,
comment|/* ah_set_rx_sel_evm */
name|ar9300_set_rx_abort
block|,
comment|/* ah_set_rx_abort */
name|AH_NULL
block|,
comment|/* ah_setup_rx_desc */
name|ar9300_proc_rx_desc
block|,
comment|/* ah_proc_rx_desc */
name|ar9300_get_rx_key_idx
block|,
comment|/* ah_get_rx_key_idx */
name|ar9300_proc_rx_desc_fast
block|,
comment|/* ah_proc_rx_desc_fast */
name|ar9300_ani_ar_poll
block|,
comment|/* ah_rx_monitor */
name|ar9300_process_mib_intr
block|,
comment|/* ah_proc_mib_event */
comment|/* Misc Functions */
name|ar9300_get_capability
block|,
comment|/* ah_get_capability */
name|ar9300_set_capability
block|,
comment|/* ah_set_capability */
name|ar9300_get_diag_state
block|,
comment|/* ah_get_diag_state */
name|ar9300_get_mac_address
block|,
comment|/* ah_get_mac_address */
name|ar9300_set_mac_address
block|,
comment|/* ah_set_mac_address */
name|ar9300_get_bss_id_mask
block|,
comment|/* ah_get_bss_id_mask */
name|ar9300_set_bss_id_mask
block|,
comment|/* ah_set_bss_id_mask */
name|ar9300_set_regulatory_domain
block|,
comment|/* ah_set_regulatory_domain */
name|ar9300_set_led_state
block|,
comment|/* ah_set_led_state */
name|ar9300_set_power_led_state
block|,
comment|/* ah_setpowerledstate */
name|ar9300_set_network_led_state
block|,
comment|/* ah_setnetworkledstate */
name|ar9300_write_associd
block|,
comment|/* ah_write_associd */
name|ar9300_force_tsf_sync
block|,
comment|/* ah_force_tsf_sync */
name|ar9300_gpio_cfg_input
block|,
comment|/* ah_gpio_cfg_input */
name|ar9300_gpio_cfg_output
block|,
comment|/* ah_gpio_cfg_output */
name|ar9300_gpio_cfg_output_led_off
block|,
comment|/* ah_gpio_cfg_output_led_off */
name|ar9300_gpio_get
block|,
comment|/* ah_gpio_get */
name|ar9300_gpio_set
block|,
comment|/* ah_gpio_set */
name|ar9300_gpio_get_intr
block|,
comment|/* ah_gpio_get_intr */
name|ar9300_gpio_set_intr
block|,
comment|/* ah_gpio_set_intr */
name|ar9300_gpio_get_polarity
block|,
comment|/* ah_gpio_get_polarity */
name|ar9300_gpio_set_polarity
block|,
comment|/* ah_gpio_set_polarity */
name|ar9300_gpio_get_mask
block|,
comment|/* ah_gpio_get_mask */
name|ar9300_gpio_set_mask
block|,
comment|/* ah_gpio_set_mask */
name|ar9300_get_tsf32
block|,
comment|/* ah_get_tsf32 */
name|ar9300_get_tsf64
block|,
comment|/* ah_get_tsf64 */
name|ar9300_get_tsf2_32
block|,
comment|/* ah_get_tsf2_32 */
name|ar9300_reset_tsf
block|,
comment|/* ah_reset_tsf */
name|ar9300_detect_card_present
block|,
comment|/* ah_detect_card_present */
name|ar9300_update_mib_mac_stats
block|,
comment|/* ah_update_mib_mac_stats */
name|ar9300_get_mib_mac_stats
block|,
comment|/* ah_get_mib_mac_stats */
name|ar9300_get_rfgain
block|,
comment|/* ah_get_rf_gain */
name|ar9300_get_def_antenna
block|,
comment|/* ah_get_def_antenna */
name|ar9300_set_def_antenna
block|,
comment|/* ah_set_def_antenna */
name|ar9300_set_slot_time
block|,
comment|/* ah_set_slot_time */
name|ar9300_set_ack_timeout
block|,
comment|/* ah_set_ack_timeout */
name|ar9300_get_ack_timeout
block|,
comment|/* ah_get_ack_timeout */
name|ar9300_set_coverage_class
block|,
comment|/* ah_set_coverage_class */
name|ar9300_set_quiet
block|,
comment|/* ah_set_quiet */
name|ar9300_set_antenna_switch
block|,
comment|/* ah_set_antenna_switch */
name|ar9300_get_desc_info
block|,
comment|/* ah_get_desc_info */
name|ar9300_select_ant_config
block|,
comment|/* ah_select_ant_config */
name|ar9300_ant_ctrl_common_get
block|,
comment|/* ah_ant_ctrl_common_get */
name|ar9300_enable_tpc
block|,
comment|/* ah_enable_tpc */
name|AH_NULL
block|,
comment|/* ah_olpc_temp_compensation */
if|#
directive|if
name|ATH_SUPPORT_CRDC
name|ar9300_chain_rssi_diff_compensation
block|,
comment|/*ah_chain_rssi_diff_compensation*/
endif|#
directive|endif
name|ar9300_disable_phy_restart
block|,
comment|/* ah_disable_phy_restart */
name|ar9300_enable_keysearch_always
block|,
name|ar9300_interference_is_present
block|,
comment|/* ah_interference_is_present */
name|ar9300_disp_tpc_tables
block|,
comment|/* ah_disp_tpc_tables */
name|ar9300_get_tpc_tables
block|,
comment|/* ah_get_tpc_tables */
comment|/* Key Cache Functions */
name|ar9300_get_key_cache_size
block|,
comment|/* ah_get_key_cache_size */
name|ar9300_reset_key_cache_entry
block|,
comment|/* ah_reset_key_cache_entry */
name|ar9300_is_key_cache_entry_valid
block|,
comment|/* ah_is_key_cache_entry_valid */
name|ar9300_set_key_cache_entry
block|,
comment|/* ah_set_key_cache_entry */
name|ar9300_set_key_cache_entry_mac
block|,
comment|/* ah_set_key_cache_entry_mac */
name|ar9300_print_keycache
block|,
comment|/* ah_print_key_cache */
comment|/* Power Management Functions */
name|ar9300_set_power_mode
block|,
comment|/* ah_set_power_mode */
name|ar9300_set_sm_power_mode
block|,
comment|/* ah_set_sm_ps_mode */
if|#
directive|if
name|ATH_WOW
name|ar9300_wow_apply_pattern
block|,
comment|/* ah_wow_apply_pattern */
name|ar9300_wow_enable
block|,
comment|/* ah_wow_enable */
name|ar9300_wow_wake_up
block|,
comment|/* ah_wow_wake_up */
if|#
directive|if
name|ATH_WOW_OFFLOAD
name|ar9300_wowoffload_prep
block|,
comment|/* ah_wow_offload_prep */
name|ar9300_wowoffload_post
block|,
comment|/* ah_wow_offload_post */
name|ar9300_wowoffload_download_rekey_data
block|,
comment|/* ah_wow_offload_download_rekey_data */
name|ar9300_wowoffload_retrieve_data
block|,
comment|/* ah_wow_offload_retrieve_data */
name|ar9300_wowoffload_download_acer_magic
block|,
comment|/* ah_wow_offload_download_acer_magic */
name|ar9300_wowoffload_download_acer_swka
block|,
comment|/* ah_wow_offload_download_acer_swka */
name|ar9300_wowoffload_download_arp_info
block|,
comment|/* ah_wow_offload_download_arp_info */
name|ar9300_wowoffload_download_ns_info
block|,
comment|/* ah_wow_offload_download_ns_info */
endif|#
directive|endif
comment|/* ATH_WOW_OFFLOAD */
endif|#
directive|endif
comment|/* Get Channel Noise */
name|ath_hal_get_chan_noise
block|,
comment|/* ah_get_chan_noise */
name|ar9300_chain_noise_floor
block|,
comment|/* ah_get_chain_noise_floor */
comment|/* Beacon Functions */
name|ar9300_beacon_init
block|,
comment|/* ah_beacon_init */
name|ar9300_set_sta_beacon_timers
block|,
comment|/* ah_set_station_beacon_timers */
comment|/* Interrupt Functions */
name|ar9300_is_interrupt_pending
block|,
comment|/* ah_is_interrupt_pending */
name|ar9300_get_pending_interrupts
block|,
comment|/* ah_get_pending_interrupts */
name|ar9300_get_interrupts
block|,
comment|/* ah_get_interrupts */
name|ar9300_set_interrupts
block|,
comment|/* ah_set_interrupts */
name|ar9300_set_intr_mitigation_timer
block|,
comment|/* ah_set_intr_mitigation_timer */
name|ar9300_get_intr_mitigation_timer
block|,
comment|/* ah_get_intr_mitigation_timer */
name|ar9300ForceVCS
block|,
name|ar9300SetDfs3StreamFix
block|,
name|ar9300Get3StreamSignature
block|,
comment|/* 11n specific functions (NOT applicable to ar9300) */
name|ar9300_set_11n_tx_desc
block|,
comment|/* ah_set_11n_tx_desc */
comment|/* Update rxchain */
name|ar9300_set_rx_chainmask
block|,
comment|/*ah_set_rx_chainmask*/
comment|/*Updating locationing register */
name|ar9300_update_loc_ctl_reg
block|,
comment|/*ah_update_loc_ctl_reg*/
comment|/* Start PAPRD functions  */
name|ar9300_set_paprd_tx_desc
block|,
comment|/* ah_set_paprd_tx_desc */
name|ar9300_paprd_init_table
block|,
comment|/* ah_paprd_init_table */
name|ar9300_paprd_setup_gain_table
block|,
comment|/* ah_paprd_setup_gain_table */
name|ar9300_paprd_create_curve
block|,
comment|/* ah_paprd_create_curve */
name|ar9300_paprd_is_done
block|,
comment|/* ah_paprd_is_done */
name|ar9300_enable_paprd
block|,
comment|/* ah_PAPRDEnable */
name|ar9300_populate_paprd_single_table
block|,
comment|/* ah_paprd_populate_table */
name|ar9300_is_tx_done
block|,
comment|/* ah_is_tx_done */
name|ar9300_paprd_dec_tx_pwr
block|,
comment|/* ah_paprd_dec_tx_pwr*/
name|ar9300_paprd_thermal_send
block|,
comment|/* ah_paprd_thermal_send */
comment|/* End PAPRD functions */
name|ar9300_set_11n_rate_scenario
block|,
comment|/* ah_set_11n_rate_scenario */
name|ar9300_set_11n_aggr_first
block|,
comment|/* ah_set_11n_aggr_first */
name|ar9300_set_11n_aggr_middle
block|,
comment|/* ah_set_11n_aggr_middle */
name|ar9300_set_11n_aggr_last
block|,
comment|/* ah_set_11n_aggr_last */
name|ar9300_clr_11n_aggr
block|,
comment|/* ah_clr_11n_aggr */
name|ar9300_set_11n_rifs_burst_middle
block|,
comment|/* ah_set_11n_rifs_burst_middle */
name|ar9300_set_11n_rifs_burst_last
block|,
comment|/* ah_set_11n_rifs_burst_last */
name|ar9300_clr_11n_rifs_burst
block|,
comment|/* ah_clr_11n_rifs_burst */
name|ar9300_set_11n_aggr_rifs_burst
block|,
comment|/* ah_set_11n_aggr_rifs_burst */
name|ar9300_set_11n_rx_rifs
block|,
comment|/* ah_set_11n_rx_rifs */
name|ar9300_set_smart_antenna
block|,
comment|/* ah_setSmartAntenna */
name|ar9300_detect_bb_hang
block|,
comment|/* ah_detect_bb_hang */
name|ar9300_detect_mac_hang
block|,
comment|/* ah_detect_mac_hang */
name|ar9300_set_immunity
block|,
comment|/* ah_immunity */
name|ar9300_get_hw_hangs
block|,
comment|/* ah_get_hang_types */
name|ar9300_set_11n_burst_duration
block|,
comment|/* ah_set_11n_burst_duration */
name|ar9300_set_11n_virtual_more_frag
block|,
comment|/* ah_set_11n_virtual_more_frag */
name|ar9300_get_11n_ext_busy
block|,
comment|/* ah_get_11n_ext_busy */
name|ar9300_set_11n_mac2040
block|,
comment|/* ah_set_11n_mac2040 */
name|ar9300_get_11n_rx_clear
block|,
comment|/* ah_get_11n_rx_clear */
name|ar9300_set_11n_rx_clear
block|,
comment|/* ah_set_11n_rx_clear */
name|ar9300_get_mib_cycle_counts_pct
block|,
comment|/* ah_get_mib_cycle_counts_pct */
name|ar9300_dma_reg_dump
block|,
comment|/* ah_dma_reg_dump */
comment|/* force_ppm specific functions */
name|ar9300_ppm_get_rssi_dump
block|,
comment|/* ah_ppm_get_rssi_dump */
name|ar9300_ppm_arm_trigger
block|,
comment|/* ah_ppm_arm_trigger */
name|ar9300_ppm_get_trigger
block|,
comment|/* ah_ppm_get_trigger */
name|ar9300_ppm_force
block|,
comment|/* ah_ppm_force */
name|ar9300_ppm_un_force
block|,
comment|/* ah_ppm_un_force */
name|ar9300_ppm_get_force_state
block|,
comment|/* ah_ppm_get_force_state */
name|ar9300_get_spur_info
block|,
comment|/* ah_get_spur_info */
name|ar9300_set_spur_info
block|,
comment|/* ah_get_spur_info */
name|ar9300_get_min_cca_pwr
block|,
comment|/* ah_ar_get_noise_floor_val */
name|ar9300_green_ap_ps_on_off
block|,
comment|/* ah_set_rx_green_ap_ps_on_off */
name|ar9300_is_single_ant_power_save_possible
block|,
comment|/* ah_is_single_ant_power_save_possible */
comment|/* radio measurement specific functions */
name|ar9300_get_mib_cycle_counts
block|,
comment|/* ah_get_mib_cycle_counts */
name|ar9300_get_vow_stats
block|,
comment|/* ah_get_vow_stats */
name|ar9300_clear_mib_counters
block|,
comment|/* ah_clear_mib_counters */
if|#
directive|if
name|ATH_GEN_RANDOMNESS
name|ar9300_get_rssi_chain0
block|,
comment|/* ah_get_rssi_chain0 */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ATH_BT_COEX
comment|/* Bluetooth Coexistence functions */
name|ar9300_set_bt_coex_info
block|,
comment|/* ah_set_bt_coex_info */
name|ar9300_bt_coex_config
block|,
comment|/* ah_bt_coex_config */
name|ar9300_bt_coex_set_qcu_thresh
block|,
comment|/* ah_bt_coex_set_qcu_thresh */
name|ar9300_bt_coex_set_weights
block|,
comment|/* ah_bt_coex_set_weights */
name|ar9300_bt_coex_setup_bmiss_thresh
block|,
comment|/* ah_bt_coex_set_bmiss_thresh */
name|ar9300_bt_coex_set_parameter
block|,
comment|/* ah_bt_coex_set_parameter */
name|ar9300_bt_coex_disable
block|,
comment|/* ah_bt_coex_disable */
name|ar9300_bt_coex_enable
block|,
comment|/* ah_bt_coex_enable */
name|ar9300_get_bt_active_gpio
block|,
comment|/* ah_bt_coex_info*/
name|ar9300_get_wlan_active_gpio
block|,
comment|/* ah__coex_wlan_info*/
endif|#
directive|endif
comment|/* Generic Timer functions */
name|ar9300_alloc_generic_timer
block|,
comment|/* ah_gentimer_alloc */
name|ar9300_free_generic_timer
block|,
comment|/* ah_gentimer_free */
name|ar9300_start_generic_timer
block|,
comment|/* ah_gentimer_start */
name|ar9300_stop_generic_timer
block|,
comment|/* ah_gentimer_stop */
name|ar9300_get_gen_timer_interrupts
block|,
comment|/* ah_gentimer_get_intr */
name|ar9300_set_dcs_mode
block|,
comment|/* ah_set_dcs_mode */
name|ar9300_get_dcs_mode
block|,
comment|/* ah_get_dcs_mode */
if|#
directive|if
name|ATH_ANT_DIV_COMB
name|ar9300_ant_div_comb_get_config
block|,
comment|/* ah_get_ant_dvi_comb_conf */
name|ar9300_ant_div_comb_set_config
block|,
comment|/* ah_set_ant_dvi_comb_conf */
endif|#
directive|endif
name|ar9300_get_bb_panic_info
block|,
comment|/* ah_get_bb_panic_info */
name|ar9300_handle_radar_bb_panic
block|,
comment|/* ah_handle_radar_bb_panic */
name|ar9300_set_hal_reset_reason
block|,
comment|/* ah_set_hal_reset_reason */
if|#
directive|if
name|ATH_PCIE_ERROR_MONITOR
name|ar9300_start_pcie_error_monitor
block|,
comment|/* ah_start_pcie_error_monitor */
name|ar9300_read_pcie_error_monitor
block|,
comment|/* ah_read_pcie_error_monitor*/
name|ar9300_stop_pcie_error_monitor
block|,
comment|/* ah_stop_pcie_error_monitor*/
endif|#
directive|endif
comment|/* ATH_PCIE_ERROR_MONITOR */
if|#
directive|if
name|ATH_SUPPORT_SPECTRAL
comment|/* Spectral scan */
name|ar9300_configure_spectral_scan
block|,
comment|/* ah_ar_configure_spectral */
name|ar9300_get_spectral_params
block|,
comment|/* ah_ar_get_spectral_config */
name|ar9300_start_spectral_scan
block|,
comment|/* ah_ar_start_spectral_scan */
name|ar9300_stop_spectral_scan
block|,
comment|/* ah_ar_stop_spectral_scan */
name|ar9300_is_spectral_enabled
block|,
comment|/* ah_ar_is_spectral_enabled */
name|ar9300_is_spectral_active
block|,
comment|/* ah_ar_is_spectral_active */
name|ar9300_get_ctl_chan_nf
block|,
comment|/* ah_ar_get_ctl_nf */
name|ar9300_get_ext_chan_nf
block|,
comment|/* ah_ar_get_ext_nf */
endif|#
directive|endif
comment|/*  ATH_SUPPORT_SPECTRAL */
name|ar9300_promisc_mode
block|,
comment|/* ah_promisc_mode */
name|ar9300_read_pktlog_reg
block|,
comment|/* ah_read_pktlog_reg */
name|ar9300_write_pktlog_reg
block|,
comment|/* ah_write_pktlog_reg */
name|ar9300_set_proxy_sta
block|,
comment|/* ah_set_proxy_sta */
name|ar9300_get_cal_intervals
block|,
comment|/* ah_get_cal_intervals */
if|#
directive|if
name|ATH_TRAFFIC_FAST_RECOVER
name|ar9300_get_pll3_sqsum_dvc
block|,
comment|/* ah_get_pll3_sqsum_dvc */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ATH_SUPPORT_HTC
name|AH_NULL
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|ATH_TX99_DIAG
comment|/* Tx99 functions */
ifdef|#
directive|ifdef
name|ATH_SUPPORT_HTC
name|AH_NULL
block|,
name|AH_NULL
block|,
name|AH_NULL
block|,
name|AH_NULL
block|,
name|AH_NULL
block|,
name|AH_NULL
block|,
name|AH_NULL
block|,
else|#
directive|else
name|AH_NULL
block|,
name|AH_NULL
block|,
name|ar9300TX99TgtChannelPwrUpdate
block|,
comment|/* ah_tx99channelpwrupdate */
name|ar9300TX99TgtStart
block|,
comment|/* ah_tx99start */
name|ar9300TX99TgtStop
block|,
comment|/* ah_tx99stop */
name|ar9300TX99TgtChainmskSetup
block|,
comment|/* ah_tx99_chainmsk_setup */
name|ar9300TX99SetSingleCarrier
block|,
comment|/* ah_tx99_set_single_carrier */
endif|#
directive|endif
endif|#
directive|endif
name|ar9300_chk_rssi_update_tx_pwr
block|,
name|ar9300_is_skip_paprd_by_greentx
block|,
comment|/* ah_is_skip_paprd_by_greentx */
name|ar9300_hwgreentx_set_pal_spare
block|,
comment|/* ah_hwgreentx_set_pal_spare */
if|#
directive|if
name|ATH_SUPPORT_MCI
comment|/* MCI Coexistence Functions */
name|ar9300_mci_setup
block|,
comment|/* ah_mci_setup */
name|ar9300_mci_send_message
block|,
comment|/* ah_mci_send_message */
name|ar9300_mci_get_interrupt
block|,
comment|/* ah_mci_get_interrupt */
name|ar9300_mci_state
block|,
comment|/* ah_mci_state */
name|ar9300_mci_detach
block|,
comment|/* ah_mci_detach */
endif|#
directive|endif
name|ar9300_reset_hw_beacon_proc_crc
block|,
comment|/* ah_reset_hw_beacon_proc_crc */
name|ar9300_get_hw_beacon_rssi
block|,
comment|/* ah_get_hw_beacon_rssi */
name|ar9300_set_hw_beacon_rssi_threshold
block|,
comment|/*ah_set_hw_beacon_rssi_threshold*/
name|ar9300_reset_hw_beacon_rssi
block|,
comment|/* ah_reset_hw_beacon_rssi */
name|ar9300_mat_enable
block|,
comment|/* ah_mat_enable */
name|ar9300_dump_keycache
block|,
comment|/* ah_dump_keycache */
name|ar9300_is_ani_noise_spur
block|,
comment|/* ah_is_ani_noise_spur */
name|ar9300_set_hw_beacon_proc
block|,
comment|/* ah_set_hw_beacon_proc */
block|}
block|,
name|ar9300_get_channel_edges
block|,
comment|/* ah_get_channel_edges */
name|ar9300_get_wireless_modes
block|,
comment|/* ah_get_wireless_modes */
name|ar9300_eeprom_read_word
block|,
comment|/* ah_eeprom_read */
name|AH_NULL
block|,
name|ar9300_eeprom_dump_support
block|,
comment|/* ah_eeprom_dump */
name|ar9300_get_chip_power_limits
block|,
comment|/* ah_get_chip_power_limits */
name|ar9300_get_nf_adjust
block|,
comment|/* ah_get_nf_adjust */
comment|/* rest is zero'd by compiler */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Read MAC version/revision information from Chip registers and initialize  * local data structures.  */
end_comment

begin_function
name|void
name|ar9300_read_revisions
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|u_int32_t
name|val
decl_stmt|;
comment|/* XXX verify if this is the correct way to read revision on Osprey */
comment|/* new SREV format for Sowl and later */
name|val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_SREV
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_devid
operator|==
name|AR9300_DEVID_AR9340
condition|)
block|{
comment|/* XXX: AR_SREV register in Wasp reads 0 */
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macVersion
operator|=
name|AR_SREV_VERSION_WASP
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_devid
operator|==
name|AR9300_DEVID_AR955X
condition|)
block|{
comment|/* XXX: AR_SREV register in Scorpion reads 0 */
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macVersion
operator|=
name|AR_SREV_VERSION_SCORPION
expr_stmt|;
block|}
else|else
block|{
comment|/*          * Include 6-bit Chip Type (masked to 0)          * to differentiate from pre-Sowl versions          */
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macVersion
operator|=
operator|(
name|val
operator|&
name|AR_SREV_VERSION2
operator|)
operator|>>
name|AR_SREV_TYPE2_S
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|AH_SUPPORT_HORNET
comment|/*      *  EV74984, due to Hornet 1.1 didn't update WMAC revision,      *  so that have to read SoC's revision ID instead      */
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macVersion
operator|==
name|AR_SREV_VERSION_HORNET
condition|)
block|{
define|#
directive|define
name|AR_SOC_RST_REVISION_ID
value|0xB8060090
define|#
directive|define
name|REG_READ
parameter_list|(
name|_reg
parameter_list|)
value|*((volatile u_int32_t *)(_reg))
if|if
condition|(
operator|(
name|REG_READ
argument_list|(
name|AR_SOC_RST_REVISION_ID
argument_list|)
operator|&
name|AR_SREV_REVISION_HORNET_11_MASK
operator|)
operator|==
name|AR_SREV_REVISION_HORNET_11
condition|)
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macRev
operator|=
name|AR_SREV_REVISION_HORNET_11
expr_stmt|;
block|}
else|else
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macRev
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|AR_SREV_REVISION2
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|REG_READ
undef|#
directive|undef
name|AR_SOC_RST_REVISION_ID
block|}
elseif|else
endif|#
directive|endif
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macVersion
operator|==
name|AR_SREV_VERSION_WASP
condition|)
block|{
define|#
directive|define
name|AR_SOC_RST_REVISION_ID
value|0xB8060090
define|#
directive|define
name|REG_READ
parameter_list|(
name|_reg
parameter_list|)
value|*((volatile u_int32_t *)(_reg))
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macRev
operator|=
name|REG_READ
argument_list|(
name|AR_SOC_RST_REVISION_ID
argument_list|)
operator|&
name|AR_SREV_REVISION_WASP_MASK
expr_stmt|;
undef|#
directive|undef
name|REG_READ
undef|#
directive|undef
name|AR_SOC_RST_REVISION_ID
block|}
else|else
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_macRev
operator|=
name|MS
argument_list|(
name|val
argument_list|,
name|AR_SREV_REVISION2
argument_list|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_is_pci_express
operator|=
name|AH_TRUE
expr_stmt|;
block|}
else|else
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_is_pci_express
operator|=
operator|(
name|val
operator|&
name|AR_SREV_TYPE2_HOST_MODE
operator|)
condition|?
literal|0
else|:
literal|1
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * Attach for an AR9300 part.  */
end_comment

begin_function
name|struct
name|ath_hal
modifier|*
name|ar9300_attach
parameter_list|(
name|u_int16_t
name|devid
parameter_list|,
name|HAL_ADAPTER_HANDLE
name|osdev
parameter_list|,
name|HAL_SOFTC
name|sc
parameter_list|,
name|HAL_BUS_TAG
name|st
parameter_list|,
name|HAL_BUS_HANDLE
name|sh
parameter_list|,
name|HAL_BUS_TYPE
name|bustype
parameter_list|,
name|asf_amem_instance_handle
name|amem_handle
parameter_list|,
name|struct
name|hal_reg_parm
modifier|*
name|hal_conf_parm
parameter_list|,
name|HAL_STATUS
modifier|*
name|status
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
decl_stmt|;
name|struct
name|ath_hal
modifier|*
name|ah
decl_stmt|;
name|struct
name|ath_hal_private
modifier|*
name|ahpriv
decl_stmt|;
name|HAL_STATUS
name|ecode
decl_stmt|;
name|HAL_NO_INTERSPERSED_READS
expr_stmt|;
comment|/* NB: memory is returned zero'd */
name|ahp
operator|=
name|ar9300_new_state
argument_list|(
name|devid
argument_list|,
name|osdev
argument_list|,
name|sc
argument_list|,
name|st
argument_list|,
name|sh
argument_list|,
name|bustype
argument_list|,
name|amem_handle
argument_list|,
name|hal_conf_parm
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|ahp
operator|==
name|AH_NULL
condition|)
block|{
return|return
name|AH_NULL
return|;
block|}
name|ah
operator|=
operator|&
name|ahp
operator|->
name|ah_priv
operator|.
name|priv
operator|.
name|h
expr_stmt|;
name|ar9300_init_offsets
argument_list|(
name|ah
argument_list|,
name|devid
argument_list|)
expr_stmt|;
name|ahpriv
operator|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_bustype
operator|=
name|bustype
expr_stmt|;
comment|/* interrupt mitigation */
ifdef|#
directive|ifdef
name|AR5416_INT_MITIGATION
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_intr_mitigation_rx
operator|!=
literal|0
condition|)
block|{
name|ahp
operator|->
name|ah_intr_mitigation_rx
operator|=
name|AH_TRUE
expr_stmt|;
block|}
else|#
directive|else
comment|/* Enable Rx mitigation (default) */
name|ahp
operator|->
name|ah_intr_mitigation_rx
operator|=
name|AH_TRUE
expr_stmt|;
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_intr_mitigation_rx
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|HOST_OFFLOAD
comment|/* Reset default Rx mitigation values for Hornet */
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahp
operator|->
name|ah_intr_mitigation_rx
operator|=
name|AH_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|AR5416_INT_MITIGATION
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_intr_mitigation_rx
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
block|}
endif|#
directive|endif
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_intr_mitigation_tx
operator|!=
literal|0
condition|)
block|{
name|ahp
operator|->
name|ah_intr_mitigation_tx
operator|=
name|AH_TRUE
expr_stmt|;
block|}
comment|/*      * Read back AR_WA into a permanent copy and set bits 14 and 17.       * We need to do this to avoid RMW of this register.       * Do this before calling ar9300_set_reset_reg.       * If not, the AR_WA register which was inited via EEPROM      * will get wiped out.      */
name|ahp
operator|->
name|ah_wa_reg_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Set Bits 14 and 17 in the AR_WA register. */
name|ahp
operator|->
name|ah_wa_reg_val
operator||=
name|AR_WA_D3_TO_L1_DISABLE
operator||
name|AR_WA_ASPM_TIMER_BASED_DISABLE
expr_stmt|;
if|if
condition|(
operator|!
name|ar9300_set_reset_reg
argument_list|(
name|ah
argument_list|,
name|HAL_RESET_POWER_ON
argument_list|)
condition|)
block|{
comment|/* reset chip */
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: couldn't reset chip\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ecode
operator|=
name|HAL_EIO
expr_stmt|;
goto|goto
name|bad
goto|;
block|}
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
if|#
directive|if
name|ATH_WOW_OFFLOAD
operator|&&
operator|!
name|HAL_WOW_CTRL
argument_list|(
name|ah
argument_list|,
name|HAL_WOW_OFFLOAD_SET_4004_BIT14
argument_list|)
endif|#
directive|endif
condition|)
block|{
comment|/* Jupiter doesn't need bit 14 to be set. */
name|ahp
operator|->
name|ah_wa_reg_val
operator|&=
operator|~
name|AR_WA_D3_TO_L1_DISABLE
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
argument_list|,
name|ahp
operator|->
name|ah_wa_reg_val
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|ATH_SUPPORT_MCI
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ah
operator|->
name|ah_bt_coex_set_weights
operator|=
name|ar9300_mci_bt_coex_set_weights
expr_stmt|;
name|ah
operator|->
name|ah_bt_coex_disable
operator|=
name|ar9300_mci_bt_coex_disable
expr_stmt|;
name|ah
operator|->
name|ah_bt_coex_enable
operator|=
name|ar9300_mci_bt_coex_enable
expr_stmt|;
name|ahp
operator|->
name|ah_mci_ready
operator|=
name|AH_FALSE
expr_stmt|;
name|ahp
operator|->
name|ah_mci_bt_state
operator|=
name|MCI_BT_SLEEP
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_major_version_wlan
operator|=
name|MCI_GPM_COEX_MAJOR_VERSION_WLAN
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_minor_version_wlan
operator|=
name|MCI_GPM_COEX_MINOR_VERSION_WLAN
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_major_version_bt
operator|=
name|MCI_GPM_COEX_MAJOR_VERSION_DEFAULT
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_minor_version_bt
operator|=
name|MCI_GPM_COEX_MINOR_VERSION_DEFAULT
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_bt_version_known
operator|=
name|AH_FALSE
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_2g5g_update
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* track if 2g5g status sent */
comment|/* will be updated before boot up sequence */
name|ahp
operator|->
name|ah_mci_coex_is_2g
operator|=
name|AH_TRUE
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_wlan_channels_update
operator|=
name|AH_FALSE
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_wlan_channels
index|[
literal|0
index|]
operator|=
literal|0x00000000
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_wlan_channels
index|[
literal|1
index|]
operator|=
literal|0xffffffff
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_wlan_channels
index|[
literal|2
index|]
operator|=
literal|0xffffffff
expr_stmt|;
name|ahp
operator|->
name|ah_mci_coex_wlan_channels
index|[
literal|3
index|]
operator|=
literal|0x7fffffff
expr_stmt|;
name|ahp
operator|->
name|ah_mci_query_bt
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* In case WLAN start after BT */
name|ahp
operator|->
name|ah_mci_unhalt_bt_gpm
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* Send UNHALT at beginning */
name|ahp
operator|->
name|ah_mci_halted_bt_gpm
operator|=
name|AH_FALSE
expr_stmt|;
comment|/* Allow first HALT */
name|ahp
operator|->
name|ah_mci_need_flush_btinfo
operator|=
name|AH_FALSE
expr_stmt|;
name|ahp
operator|->
name|ah_mci_wlan_cal_seq
operator|=
literal|0
expr_stmt|;
name|ahp
operator|->
name|ah_mci_wlan_cal_done
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* ATH_SUPPORT_MCI */
if|#
directive|if
name|ATH_WOW_OFFLOAD
name|ahp
operator|->
name|ah_mcast_filter_l32_set
operator|=
literal|0
expr_stmt|;
name|ahp
operator|->
name|ah_mcast_filter_u32_set
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
condition|)
block|{
ifdef|#
directive|ifdef
name|AH_SUPPORT_HORNET
if|if
condition|(
operator|!
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/*              * Do not check bootstrap register, which cannot be trusted              * due to s26 switch issue on CUS164/AP121.              */
name|ahp
operator|->
name|clk_25mhz
operator|=
literal|1
expr_stmt|;
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"Bootstrap clock 25MHz\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* check bootstrap clock setting */
define|#
directive|define
name|AR_SOC_SEL_25M_40M
value|0xB80600AC
define|#
directive|define
name|REG_WRITE
parameter_list|(
name|_reg
parameter_list|,
name|_val
parameter_list|)
value|*((volatile u_int32_t *)(_reg)) = (_val);
define|#
directive|define
name|REG_READ
parameter_list|(
name|_reg
parameter_list|)
value|(*((volatile u_int32_t *)(_reg)))
if|if
condition|(
name|REG_READ
argument_list|(
name|AR_SOC_SEL_25M_40M
argument_list|)
operator|&
literal|0x1
condition|)
block|{
name|ahp
operator|->
name|clk_25mhz
operator|=
literal|0
expr_stmt|;
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"Bootstrap clock 40MHz\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ahp
operator|->
name|clk_25mhz
operator|=
literal|1
expr_stmt|;
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"Bootstrap clock 25MHz\n"
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|REG_READ
undef|#
directive|undef
name|REG_WRITE
undef|#
directive|undef
name|AR_SOC_SEL_25M_40M
block|}
endif|#
directive|endif
comment|/* AH_SUPPORT_HORNET */
block|}
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* check bootstrap clock setting */
define|#
directive|define
name|AR9340_SOC_SEL_25M_40M
value|0xB80600B0
define|#
directive|define
name|AR9340_REF_CLK_40
value|(1<< 4)
comment|/* 0 - 25MHz   1 - 40 MHz */
define|#
directive|define
name|REG_READ
parameter_list|(
name|_reg
parameter_list|)
value|(*((volatile u_int32_t *)(_reg)))
if|if
condition|(
name|REG_READ
argument_list|(
name|AR9340_SOC_SEL_25M_40M
argument_list|)
operator|&
name|AR9340_REF_CLK_40
condition|)
block|{
name|ahp
operator|->
name|clk_25mhz
operator|=
literal|0
expr_stmt|;
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"Bootstrap clock 40MHz\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ahp
operator|->
name|clk_25mhz
operator|=
literal|1
expr_stmt|;
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"Bootstrap clock 25MHz\n"
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|REG_READ
undef|#
directive|undef
name|AR9340_SOC_SEL_25M_40M
undef|#
directive|undef
name|AR9340_REF_CLK_40
block|}
name|ar9300_init_pll
argument_list|(
name|ah
argument_list|,
name|AH_NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ar9300_set_power_mode
argument_list|(
name|ah
argument_list|,
name|HAL_PM_AWAKE
argument_list|,
name|AH_TRUE
argument_list|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: couldn't wakeup chip\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ecode
operator|=
name|HAL_EIO
expr_stmt|;
goto|goto
name|bad
goto|;
block|}
comment|/* No serialization of Register Accesses needed. */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_serialize_reg_mode
operator|=
name|SER_REG_MODE_OFF
expr_stmt|;
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: ath_hal_serialize_reg_mode is %d\n"
argument_list|,
name|__func__
argument_list|,
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_serialize_reg_mode
argument_list|)
expr_stmt|;
comment|/*      * Add mac revision check when needed.      * - Osprey 1.0 and 2.0 no longer supported.      */
if|if
condition|(
operator|(
operator|(
name|ahpriv
operator|->
name|ah_macVersion
operator|==
name|AR_SREV_VERSION_OSPREY
operator|)
operator|&&
operator|(
name|ahpriv
operator|->
name|ah_macRev
operator|<=
name|AR_SREV_REVISION_OSPREY_20
operator|)
operator|)
operator|||
operator|(
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_OSPREY
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_WASP
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_HORNET
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_POSEIDON
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_SCORPION
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_JUPITER
operator|&&
name|ahpriv
operator|->
name|ah_macVersion
operator|!=
name|AR_SREV_VERSION_APHRODITE
operator|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: Mac Chip Rev 0x%02x.%x is not supported by this driver\n"
argument_list|,
name|__func__
argument_list|,
name|ahpriv
operator|->
name|ah_macVersion
argument_list|,
name|ahpriv
operator|->
name|ah_macRev
argument_list|)
expr_stmt|;
name|ecode
operator|=
name|HAL_ENOTSUPP
expr_stmt|;
goto|goto
name|bad
goto|;
block|}
name|ahpriv
operator|->
name|ah_phy_rev
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_PHY_CHIP_ID
argument_list|)
expr_stmt|;
comment|/* Setup supported calibrations */
name|ahp
operator|->
name|ah_iq_cal_data
operator|.
name|cal_data
operator|=
operator|&
name|iq_cal_single_sample
expr_stmt|;
name|ahp
operator|->
name|ah_supp_cals
operator|=
name|IQ_MISMATCH_CAL
expr_stmt|;
comment|/* Enable ANI */
name|ahp
operator|->
name|ah_ani_function
operator|=
name|HAL_ANI_ALL
expr_stmt|;
comment|/* Enable RIFS */
name|ahp
operator|->
name|ah_rifs_enabled
operator|=
name|AH_TRUE
expr_stmt|;
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: This Mac Chip Rev 0x%02x.%x is \n"
argument_list|,
name|__func__
argument_list|,
name|ahpriv
operator|->
name|ah_macVersion
argument_list|,
name|ahpriv
operator|->
name|ah_macRev
argument_list|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_2_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_2_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_2_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_2_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_2_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9331_hornet1_2_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_2_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_soc_postamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_rx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_rx_gain_hornet1_2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
comment|/* Japan 2484Mhz CCK settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9331_hornet1_2_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* ATH_WOW */
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,                 ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);
endif|#
directive|endif
comment|/* additional clock settings */
if|if
condition|(
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|clk_25mhz
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9331_hornet1_2_xtal_25M
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_xtal_25M
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9331_hornet1_2_xtal_40M
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_2_xtal_40M
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_1_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_1_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_1_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_1_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9331_hornet1_1_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9331_hornet1_1_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9331_hornet1_1_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_soc_postamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_rx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_rx_gain_hornet1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
comment|/* Japan 2484Mhz CCK settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9331_hornet1_1_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* ATH_WOW */
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,                        N(ar9300_pcie_phy_awow), 2);
endif|#
directive|endif
comment|/* additional clock settings */
if|if
condition|(
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|clk_25mhz
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9331_hornet1_1_xtal_25M
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_xtal_25M
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9331_hornet1_1_xtal_40M
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_hornet1_1_xtal_40M
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_1_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_1_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9485_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_1_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_1_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_1_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_1_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_radio_postamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9485_poseidon1_1_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* Japan 2484Mhz CCK settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9485_poseidon1_1_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
comment|/* Pci-e Clock Request = 1 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Pci-e Clock Request = 0 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_1_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* pcie ps setting will honor registry setting, default is 0 */
comment|//ahpriv->ah_config.ath_hal_pciePowerSaveEnable = 0;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9485_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9485_poseidon1_0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9485_poseidon1_0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_radio_postamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9485_poseidon1_0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* Japan 2484Mhz CCK settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9485_poseidon1_0_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
comment|/* Pci-e Clock Request = 1 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_enable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Pci-e Clock Request = 0 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_poseidon1_0_pcie_phy_pll_on_clkreq_disable_L1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* pcie ps setting will honor registry setting, default is 0 */
comment|/*ahpriv->ah_config.ath_hal_pcie_power_save_enable = 0;*/
if|#
directive|if
literal|0
comment|/* ATH_WOW */
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,                        ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);
endif|#
directive|endif
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9340_wasp_1p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9340_wasp_1p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9340_wasp_1p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9340_wasp_1p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9340_wasp_1p0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9340_wasp_1p0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9340_wasp_1p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9340_wasp_1p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9340Common_wo_xlna_rx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Common_wo_xlna_rx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9340Modes_fast_clock_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_fast_clock_wasp_1p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* Additional setttings for 40Mhz */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional_40mhz
argument_list|,
name|ar9340_wasp_1p0_radio_core_40M
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_radio_core_40M
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* DFS */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_dfs
argument_list|,
name|ar9340_wasp_1p0_baseband_postamble_dfs_channel
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340_wasp_1p0_baseband_postamble_dfs_channel
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar955x_scorpion_1p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar955x_scorpion_1p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar955x_scorpion_1p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar955x_scorpion_1p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar955x_scorpion_1p0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar955x_scorpion_1p0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar955x_scorpion_1p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar955x_scorpion_1p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955x_scorpion_1p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain_bounds
argument_list|,
name|ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar955xModes_no_xpa_tx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xModes_no_xpa_tx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/*ath_hal_pciePowerSaveEnable should be 2 for OWL/Condor and 0 for merlin */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar955xModes_fast_clock_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xModes_fast_clock_scorpion_1p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* Additional setttings for 40Mhz */
comment|//INIT_INI_ARRAY(&ahp->ah_ini_modes_additional_40M,
comment|//                ar955x_scorpion_1p0_radio_core_40M,
comment|//                ARRAY_LENGTH(ar955x_scorpion_1p0_radio_core_40M), 2);
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* Jupiter: new INI format (pre, core, post arrays per subsystem) */
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_1p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_1p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_1p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_1p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_1p0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_1p0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9300_jupiter_1p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_1p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
comment|/* Pci-e Clock Request = 1 */
comment|/*              * PLL ON + clkreq enable is not a valid combination,              * thus to ignore ath_hal_pll_pwr_save, use PLL OFF.              */
block|{
comment|/*Use driver default setting*/
comment|/* Awake -> Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Sleep -> Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_clkreq_enable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*              * Since Jupiter 1.0 and 2.0 share the same device id and will be              * installed with same INF, but Jupiter 1.0 has issue with PLL OFF.              *              * Force Jupiter 1.0 to use ON/ON setting.              */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|=
literal|0
expr_stmt|;
comment|/* Pci-e Clock Request = 0 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Awake -> Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Sleep -> Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Awake -> Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Sleep -> Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_pcie_phy_pll_on_clkreq_disable_L1_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*           * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and           * 0 for merlin           */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
if|#
directive|if
literal|0
comment|// ATH_WOW
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,             ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);
endif|#
directive|endif
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9300_modes_fast_clock_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_fast_clock_jupiter_1p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9300_jupiter_1p0_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_1p0_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* Jupiter: new INI format (pre, core, post arrays per subsystem) */
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_2p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_2p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_2p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_2p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_jupiter_2p0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_2p0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio_post_sys2ant
argument_list|,
name|ar9300_jupiter_2p0_radio_postamble_sys2ant
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_radio_postamble_sys2ant
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9300_jupiter_2p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_jupiter_2p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300Common_rx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Common_rx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* BTCOEX */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_BTCOEX_MAX_TXPWR
argument_list|,
name|ar9300_jupiter_2p0_BTCOEX_MAX_TXPWR_table
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_BTCOEX_MAX_TXPWR_table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
comment|/* Pci-e Clock Request = 1 */
comment|/*              * PLL ON + clkreq enable is not a valid combination,              * thus to ignore ath_hal_pll_pwr_save, use PLL OFF.              */
block|{
comment|/*Use driver default setting*/
comment|/* Awake -> Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Sleep -> Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_clkreq_enable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* Pci-e Clock Request = 0 */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|/* Awake -> Sleep Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
comment|/* Sleep -> Awake Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*Use driver default setting*/
comment|/* Awake -> Sleep Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Sleep -> Awake Setting */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_PciePhy_pll_on_clkreq_disable_L1_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*           * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and           * 0 for merlin           */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
if|#
directive|if
literal|0
comment|// ATH_WOW
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,             ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);
endif|#
directive|endif
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9300Modes_fast_clock_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_fast_clock_jupiter_2p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9300_jupiter_2p0_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_jupiter_2p0_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* Aphrodite: new INI format (pre, core, post arrays per subsystem) */
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar956X_aphrodite_1p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar956X_aphrodite_1p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar956X_aphrodite_1p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar956X_aphrodite_1p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|//mark jupiter have but aphrodite don't have
comment|//        /* radio */
comment|//        INIT_INI_ARRAY(&ahp->ah_ini_radio[ATH_INI_PRE], NULL, 0, 0);
comment|//        INIT_INI_ARRAY(&ahp->ah_ini_radio[ATH_INI_CORE],
comment|//            ar9300_aphrodite_1p0_radio_core,
comment|//            ARRAY_LENGTH(ar9300_aphrodite_1p0_radio_core), 2);
comment|//        INIT_INI_ARRAY(&ahp->ah_ini_radio[ATH_INI_POST],
comment|//            ar9300_aphrodite_1p0_radio_postamble,
comment|//            ARRAY_LENGTH(ar9300_aphrodite_1p0_radio_postamble), 5);
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar956X_aphrodite_1p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar956X_aphrodite_1p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956X_aphrodite_1p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar956XCommon_rx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XCommon_rx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//INIT_INI_ARRAY(&ahp->ah_ini_modes_txgain,
comment|//    ar956XModes_lowest_ob_db_tx_gain_table_aphrodite_1p0,
comment|//    ARRAY_LENGTH(ar956XModes_lowest_ob_db_tx_gain_table_aphrodite_1p0),
comment|//    5);
comment|/*           * ath_hal_pcie_power_save_enable should be 2 for OWL/Condor and           * 0 for merlin           */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
if|#
directive|if
literal|0
comment|// ATH_WOW
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_AWOW,             ARRAY_LENGTH(ar9300_pcie_phy_AWOW), 2);
endif|#
directive|endif
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar956XModes_fast_clock_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XModes_fast_clock_aphrodite_1p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/*          * AR9580/Peacock -          * new INI format (pre, core, post arrays per subsystem)          */
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_ar9580_1p0_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_ar9580_1p0_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_ar9580_1p0_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_ar9580_1p0_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_ar9580_1p0_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_ar9580_1p0_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9300_ar9580_1p0_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_ar9580_1p0_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* DFS */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_dfs
argument_list|,
name|ar9300_ar9580_1p0_baseband_postamble_dfs_channel
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_baseband_postamble_dfs_channel
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
comment|/*D3 Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
comment|//bit1, in to D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_enable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_enable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
comment|//bit1, in to D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*D0 Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
comment|//bit2, out of D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_clkreq_enable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_enable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
comment|//bit2, out of D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
if|#
directive|if
literal|0
comment|/* ATH_WOW */
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,                        ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);
endif|#
directive|endif
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9300Modes_fast_clock_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_fast_clock_ar9580_1p0
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9300_ar9580_1p0_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_ar9580_1p0_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*          * Osprey 2.2 -  new INI format (pre, core, post arrays per subsystem)          */
comment|/* mac */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_osprey_2p2_mac_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_mac_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_mac
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_osprey_2p2_mac_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_mac_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* bb */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_osprey_2p2_baseband_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_baseband_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_bb
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_osprey_2p2_baseband_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_baseband_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* radio */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|ar9300_osprey_2p2_radio_core
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_radio_core
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_radio
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_osprey_2p2_radio_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_radio_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* soc */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_PRE
index|]
argument_list|,
name|ar9300_osprey_2p2_soc_preamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_soc_preamble
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_CORE
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_soc
index|[
name|ATH_INI_POST
index|]
argument_list|,
name|ar9300_osprey_2p2_soc_postamble
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_soc_postamble
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* rx/tx gain */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|/* DFS */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_dfs
argument_list|,
name|ar9300_osprey_2p2_baseband_postamble_dfs_channel
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_baseband_postamble_dfs_channel
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|/* Load PCIE SERDES settings from INI */
comment|/*D3 Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
comment|//bit1, in to D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_enable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_enable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
ifndef|#
directive|ifndef
name|ATH_BUS_PM
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|#
directive|else
comment|//no registry control, default is pll off
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
else|else
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D3
condition|)
block|{
comment|//bit1, in to D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
ifndef|#
directive|ifndef
name|ATH_BUS_PM
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|#
directive|else
comment|//no registry control, default is pll off
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
comment|/*D0 Setting */
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_clock_req
condition|)
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
comment|//bit2, out of D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_clkreq_enable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_enable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_CONTROL
condition|)
block|{
comment|//registry control
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pll_pwr_save
operator|&
name|AR_PCIE_PLL_PWRSAVE_ON_D0
condition|)
block|{
comment|//bit2, out of D3
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|//no registry control, default is pll on
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300PciePhy_pll_on_clkreq_disable_L1_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|ATH_BUS_PM
comment|/*Use HAL to config PCI powersave by writing into the SerDes Registers */
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_ser_des_write
operator|=
literal|1
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
literal|0
comment|/* ATH_WOW */
comment|/* SerDes values during WOW sleep */
block|INIT_INI_ARRAY(&ahp->ah_ini_pcie_serdes_wow, ar9300_pcie_phy_awow,                        ARRAY_LENGTH(ar9300_pcie_phy_awow), 2);
endif|#
directive|endif
comment|/* Fast clock modal settings */
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_additional
argument_list|,
name|ar9300Modes_fast_clock_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_fast_clock_osprey_2p2
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_japan2484
argument_list|,
name|ar9300_osprey_2p2_baseband_core_txfir_coeff_japan_2484
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_osprey_2p2_baseband_core_txfir_coeff_japan_2484
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
define|#
directive|define
name|AR_SOC_RST_OTP_INTF
value|0xB80600B4
define|#
directive|define
name|REG_READ
parameter_list|(
name|_reg
parameter_list|)
value|*((volatile u_int32_t *)(_reg))
name|ahp
operator|->
name|ah_enterprise_mode
operator|=
name|REG_READ
argument_list|(
name|AR_SOC_RST_OTP_INTF
argument_list|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahp
operator|->
name|ah_enterprise_mode
operator|=
name|ahp
operator|->
name|ah_enterprise_mode
operator|<<
literal|12
expr_stmt|;
block|}
name|ath_hal_printf
argument_list|(
name|ah
argument_list|,
literal|"Enterprise mode: 0x%08x\n"
argument_list|,
name|ahp
operator|->
name|ah_enterprise_mode
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|REG_READ
undef|#
directive|undef
name|AR_SOC_RST_OTP_INTF
block|}
else|else
block|{
name|ahp
operator|->
name|ah_enterprise_mode
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_ENT_OTP
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ahpriv
operator|->
name|ah_is_pci_express
condition|)
block|{
name|ar9300_config_pci_power_save
argument_list|(
name|ah
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ar9300_disable_pcie_phy
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
name|ecode
operator|=
name|ar9300_hw_attach
argument_list|(
name|ah
argument_list|)
expr_stmt|;
if|if
condition|(
name|ecode
operator|!=
name|HAL_OK
condition|)
block|{
goto|goto
name|bad
goto|;
block|}
comment|/* set gain table pointers according to values read from the eeprom */
name|ar9300_tx_gain_table_apply
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|ar9300_rx_gain_table_apply
argument_list|(
name|ah
argument_list|)
expr_stmt|;
comment|/*     **     ** Got everything we need now to setup the capabilities.     */
if|if
condition|(
operator|!
name|ar9300_fill_capability_info
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s:failed ar9300_fill_capability_info\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
name|ecode
operator|=
name|HAL_EEREAD
expr_stmt|;
goto|goto
name|bad
goto|;
block|}
name|ecode
operator|=
name|ar9300_init_mac_addr
argument_list|(
name|ah
argument_list|)
expr_stmt|;
if|if
condition|(
name|ecode
operator|!=
name|HAL_OK
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: failed initializing mac address\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
goto|goto
name|bad
goto|;
block|}
comment|/*      * Initialize receive buffer size to MAC default      */
name|ahp
operator|->
name|rx_buf_size
operator|=
name|HAL_RXBUFSIZE_DEFAULT
expr_stmt|;
if|#
directive|if
name|ATH_WOW
if|#
directive|if
literal|0
comment|/*      * Needs to be removed once we stop using XB92 XXX      * FIXME: Check with latest boards too - SriniK      */
block|ar9300_wow_set_gpio_reset_low(ah);
endif|#
directive|endif
comment|/*      * Clear the Wow Status.      */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PM_CTRL
argument_list|)
argument_list|,
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PM_CTRL
argument_list|)
argument_list|)
operator||
name|AR_PMCTRL_WOW_PME_CLR
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_WOW_PATTERN_REG
argument_list|,
name|AR_WOW_CLEAR_EVENTS
argument_list|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_WOW_PATTERN_REG
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/*      * Set the cur_trig_level to a value that works all modes - 11a/b/g or 11n      * with aggregation enabled or disabled.      */
name|ahpriv
operator|->
name|ah_tx_trig_level
operator|=
operator|(
name|AR_FTRIG_512B
operator|>>
name|AR_FTRIG_S
operator|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_HORNET_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_cw_int_delta
operator|=
name|AR_PHY_CCA_CW_INT_DELTA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_JUPITER_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_JUPITER_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_JUPITER_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_JUPITER_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_cw_int_delta
operator|=
name|AR_PHY_CCA_CW_INT_DELTA
expr_stmt|;
block|}
else|else
block|{
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_OSPREY_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_2GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_2GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_2GHZ
expr_stmt|;
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_PEACOCK_5GHZ
expr_stmt|;
block|}
else|else
block|{
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|nominal
operator|=
name|AR_PHY_CCA_NOM_VAL_OSPREY_5GHZ
expr_stmt|;
block|}
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|max
operator|=
name|AR_PHY_CCA_MAX_GOOD_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_5GHz
operator|.
name|min
operator|=
name|AR_PHY_CCA_MIN_GOOD_VAL_OSPREY_5GHZ
expr_stmt|;
name|ahpriv
operator|->
name|nf_cw_int_delta
operator|=
name|AR_PHY_CCA_CW_INT_DELTA
expr_stmt|;
block|}
comment|/* init BB Panic Watchdog timeout */
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahpriv
operator|->
name|ah_bb_panic_timeout_ms
operator|=
name|HAL_BB_PANIC_WD_TMO_HORNET
expr_stmt|;
block|}
else|else
block|{
name|ahpriv
operator|->
name|ah_bb_panic_timeout_ms
operator|=
name|HAL_BB_PANIC_WD_TMO
expr_stmt|;
block|}
comment|/*      * Determine whether tx IQ calibration HW should be enabled,      * and whether tx IQ calibration should be performed during      * AGC calibration, or separately.      */
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/*          * Register not initialized yet. This flag will be re-initialized          * after INI loading following each reset.          */
name|ahp
operator|->
name|tx_iq_cal_enable
operator|=
literal|1
expr_stmt|;
comment|/* if tx IQ cal is enabled, do it together with AGC cal */
name|ahp
operator|->
name|tx_iq_cal_during_agc_cal
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_OR_LATER
argument_list|(
name|ah
argument_list|)
operator|&&
operator|!
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|ahp
operator|->
name|tx_iq_cal_enable
operator|=
literal|1
expr_stmt|;
name|ahp
operator|->
name|tx_iq_cal_during_agc_cal
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
comment|/* osprey, hornet, wasp */
name|ahp
operator|->
name|tx_iq_cal_enable
operator|=
literal|1
expr_stmt|;
name|ahp
operator|->
name|tx_iq_cal_during_agc_cal
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|ah
return|;
name|bad
label|:
if|if
condition|(
name|ahp
condition|)
block|{
name|ar9300_detach
argument_list|(
operator|(
expr|struct
name|ath_hal
operator|*
operator|)
name|ahp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
condition|)
block|{
operator|*
name|status
operator|=
name|ecode
expr_stmt|;
block|}
return|return
name|AH_NULL
return|;
block|}
end_function

begin_function
name|void
name|ar9300_detach
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|HALASSERT
argument_list|(
name|ah
operator|!=
name|AH_NULL
argument_list|)
expr_stmt|;
name|HALASSERT
argument_list|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_magic
operator|==
name|AR9300_MAGIC
argument_list|)
expr_stmt|;
comment|/* Make sure that chip is awake before writing to it */
if|if
condition|(
operator|!
name|ar9300_set_power_mode
argument_list|(
name|ah
argument_list|,
name|HAL_PM_AWAKE
argument_list|,
name|AH_TRUE
argument_list|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s: failed to wake up chip\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
block|}
name|ar9300_hw_detach
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|ar9300_set_power_mode
argument_list|(
name|ah
argument_list|,
name|HAL_PM_FULL_SLEEP
argument_list|,
name|AH_TRUE
argument_list|)
expr_stmt|;
name|ath_hal_hdprintf_deregister
argument_list|(
name|ah
argument_list|)
expr_stmt|;
name|ath_hal_free
argument_list|(
name|ah
argument_list|,
name|ah
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|struct
name|ath_hal_9300
modifier|*
name|ar9300_new_state
parameter_list|(
name|u_int16_t
name|devid
parameter_list|,
name|HAL_ADAPTER_HANDLE
name|osdev
parameter_list|,
name|HAL_SOFTC
name|sc
parameter_list|,
name|HAL_BUS_TAG
name|st
parameter_list|,
name|HAL_BUS_HANDLE
name|sh
parameter_list|,
name|HAL_BUS_TYPE
name|bustype
parameter_list|,
name|asf_amem_instance_handle
name|amem_handle
parameter_list|,
name|struct
name|hal_reg_parm
modifier|*
name|hal_conf_parm
parameter_list|,
name|HAL_STATUS
modifier|*
name|status
parameter_list|)
block|{
specifier|static
specifier|const
name|u_int8_t
name|defbssidmask
index|[
name|IEEE80211_ADDR_LEN
index|]
init|=
block|{
literal|0xff
block|,
literal|0xff
block|,
literal|0xff
block|,
literal|0xff
block|,
literal|0xff
block|,
literal|0xff
block|}
decl_stmt|;
name|struct
name|ath_hal_9300
modifier|*
name|ahp
decl_stmt|;
name|struct
name|ath_hal
modifier|*
name|ah
decl_stmt|;
comment|/* NB: memory is returned zero'd */
name|ahp
operator|=
name|amalloc_adv
argument_list|(
name|amem_handle
argument_list|,
sizeof|sizeof
argument_list|(
expr|struct
name|ath_hal_9300
argument_list|)
argument_list|,
name|adf_os_mem_zero_outline
argument_list|)
expr_stmt|;
if|if
condition|(
name|ahp
operator|==
name|AH_NULL
condition|)
block|{
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s: cannot allocate memory for state block\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
operator|*
name|status
operator|=
name|HAL_ENOMEM
expr_stmt|;
return|return
name|AH_NULL
return|;
block|}
name|ah
operator|=
operator|&
name|ahp
operator|->
name|ah_priv
operator|.
name|priv
operator|.
name|h
expr_stmt|;
comment|/* set initial values */
comment|/* Attach Osprey structure as default hal structure */
name|OS_MEMCPY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_priv
operator|.
name|priv
argument_list|,
operator|&
name|ar9300hal
argument_list|,
sizeof|sizeof
argument_list|(
name|ahp
operator|->
name|ah_priv
operator|.
name|priv
argument_list|)
argument_list|)
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|amem_handle
operator|=
name|amem_handle
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_osdev
operator|=
name|osdev
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_sc
operator|=
name|sc
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_st
operator|=
name|st
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_sh
operator|=
name|sh
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_magic
operator|=
name|AR9300_MAGIC
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_devid
operator|=
name|devid
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_flags
operator|=
literal|0
expr_stmt|;
comment|/*     ** Initialize factory defaults in the private space     */
name|ath_hal_factory_defaults
argument_list|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
argument_list|,
name|hal_conf_parm
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|hal_conf_parm
operator|->
name|calInFlash
condition|)
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_flags
operator||=
name|AH_USE_EEPROM
expr_stmt|;
block|}
if|#
directive|if
literal|0
block|if (ar9300_eep_data_in_flash(ah)) {         ahp->ah_priv.priv.ah_eeprom_read  = ar9300_flash_read;         ahp->ah_priv.priv.ah_eeprom_dump  = AH_NULL;     } else {         ahp->ah_priv.priv.ah_eeprom_read  = ar9300_eeprom_read_word;     }
endif|#
directive|endif
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_power_limit
operator|=
name|MAX_RATE_POWER
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_tp_scale
operator|=
name|HAL_TP_SCALE_MAX
expr_stmt|;
comment|/* no scaling */
name|ahp
operator|->
name|ah_atim_window
operator|=
literal|0
expr_stmt|;
comment|/* [0..1000] */
name|ahp
operator|->
name|ah_diversity_control
operator|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_diversity_control
expr_stmt|;
name|ahp
operator|->
name|ah_antenna_switch_swap
operator|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_antenna_switch_swap
expr_stmt|;
comment|/*      * Enable MIC handling.      */
name|ahp
operator|->
name|ah_sta_id1_defaults
operator|=
name|AR_STA_ID1_CRPT_MIC_ENABLE
expr_stmt|;
name|ahp
operator|->
name|ah_enable32k_hz_clock
operator|=
name|DONT_USE_32KHZ
expr_stmt|;
comment|/* XXX */
name|ahp
operator|->
name|ah_slot_time
operator|=
operator|(
name|u_int
operator|)
operator|-
literal|1
expr_stmt|;
name|ahp
operator|->
name|ah_ack_timeout
operator|=
operator|(
name|u_int
operator|)
operator|-
literal|1
expr_stmt|;
name|OS_MEMCPY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_bssid_mask
argument_list|,
name|defbssidmask
argument_list|,
name|IEEE80211_ADDR_LEN
argument_list|)
expr_stmt|;
comment|/*      * 11g-specific stuff      */
name|ahp
operator|->
name|ah_g_beacon_rate
operator|=
literal|0
expr_stmt|;
comment|/* adhoc beacon fixed rate */
comment|/* SM power mode: Attach time, disable any setting */
name|ahp
operator|->
name|ah_sm_power_mode
operator|=
name|HAL_SMPS_DEFAULT
expr_stmt|;
return|return
name|ahp
return|;
block|}
end_function

begin_function
name|HAL_BOOL
name|ar9300_chip_test
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
comment|/*u_int32_t reg_addr[2] = { AR_STA_ID0, AR_PHY_BASE+(8<< 2) };*/
name|u_int32_t
name|reg_addr
index|[
literal|2
index|]
init|=
block|{
name|AR_STA_ID0
block|}
decl_stmt|;
name|u_int32_t
name|reg_hold
index|[
literal|2
index|]
decl_stmt|;
name|u_int32_t
name|pattern_data
index|[
literal|4
index|]
init|=
block|{
literal|0x55555555
block|,
literal|0xaaaaaaaa
block|,
literal|0x66666666
block|,
literal|0x99999999
block|}
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
comment|/* Test PHY& MAC registers */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|u_int32_t
name|addr
init|=
name|reg_addr
index|[
name|i
index|]
decl_stmt|;
name|u_int32_t
name|wr_data
decl_stmt|,
name|rd_data
decl_stmt|;
name|reg_hold
index|[
name|i
index|]
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|addr
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|0x100
condition|;
name|j
operator|++
control|)
block|{
name|wr_data
operator|=
operator|(
name|j
operator|<<
literal|16
operator|)
operator||
name|j
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|addr
argument_list|,
name|wr_data
argument_list|)
expr_stmt|;
name|rd_data
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|rd_data
operator|!=
name|wr_data
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_REG_IO
argument_list|,
literal|"%s: address test failed addr: "
literal|"0x%08x - wr:0x%08x != rd:0x%08x\n"
argument_list|,
name|__func__
argument_list|,
name|addr
argument_list|,
name|wr_data
argument_list|,
name|rd_data
argument_list|)
expr_stmt|;
return|return
name|AH_FALSE
return|;
block|}
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
block|{
name|wr_data
operator|=
name|pattern_data
index|[
name|j
index|]
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|addr
argument_list|,
name|wr_data
argument_list|)
expr_stmt|;
name|rd_data
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|addr
argument_list|)
expr_stmt|;
if|if
condition|(
name|wr_data
operator|!=
name|rd_data
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_REG_IO
argument_list|,
literal|"%s: address test failed addr: "
literal|"0x%08x - wr:0x%08x != rd:0x%08x\n"
argument_list|,
name|__func__
argument_list|,
name|addr
argument_list|,
name|wr_data
argument_list|,
name|rd_data
argument_list|)
expr_stmt|;
return|return
name|AH_FALSE
return|;
block|}
block|}
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|reg_addr
index|[
name|i
index|]
argument_list|,
name|reg_hold
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|OS_DELAY
argument_list|(
literal|100
argument_list|)
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
end_function

begin_comment
comment|/*  * Store the channel edges for the requested operational mode  */
end_comment

begin_function
name|HAL_BOOL
name|ar9300_get_channel_edges
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int16_t
name|flags
parameter_list|,
name|u_int16_t
modifier|*
name|low
parameter_list|,
name|u_int16_t
modifier|*
name|high
parameter_list|)
block|{
name|struct
name|ath_hal_private
modifier|*
name|ahpriv
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|HAL_CAPABILITIES
modifier|*
name|p_cap
init|=
operator|&
name|ahpriv
operator|->
name|ah_caps
decl_stmt|;
if|if
condition|(
name|flags
operator|&
name|CHANNEL_5GHZ
condition|)
block|{
operator|*
name|low
operator|=
name|p_cap
operator|->
name|hal_low_5ghz_chan
expr_stmt|;
operator|*
name|high
operator|=
name|p_cap
operator|->
name|hal_high_5ghz_chan
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
if|if
condition|(
operator|(
name|flags
operator|&
name|CHANNEL_2GHZ
operator|)
condition|)
block|{
operator|*
name|low
operator|=
name|p_cap
operator|->
name|hal_low_2ghz_chan
expr_stmt|;
operator|*
name|high
operator|=
name|p_cap
operator|->
name|hal_high_2ghz_chan
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
return|return
name|AH_FALSE
return|;
block|}
end_function

begin_function
name|HAL_BOOL
name|ar9300_regulatory_domain_override
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int16_t
name|regdmn
parameter_list|)
block|{
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_current_rd
operator|=
name|regdmn
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
end_function

begin_comment
comment|/*  * Fill all software cached or static hardware state information.  * Return failure if capabilities are to come from EEPROM and  * cannot be read.  */
end_comment

begin_function
name|HAL_BOOL
name|ar9300_fill_capability_info
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
define|#
directive|define
name|AR_KEYTABLE_SIZE
value|128
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ath_hal_private
modifier|*
name|ahpriv
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|HAL_CAPABILITIES
modifier|*
name|p_cap
init|=
operator|&
name|ahpriv
operator|->
name|ah_caps
decl_stmt|;
name|u_int16_t
name|cap_field
init|=
literal|0
decl_stmt|,
name|eeval
decl_stmt|;
name|ahpriv
operator|->
name|ah_devType
operator|=
operator|(
name|u_int16_t
operator|)
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_DEV_TYPE
argument_list|)
expr_stmt|;
name|eeval
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_REG_0
argument_list|)
expr_stmt|;
comment|/* XXX record serial number */
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_current_rd
operator|=
name|eeval
expr_stmt|;
name|p_cap
operator|->
name|halintr_mitigation
operator|=
name|AH_TRUE
expr_stmt|;
name|eeval
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_REG_1
argument_list|)
expr_stmt|;
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_current_rd_ext
operator|=
name|eeval
operator||
name|AR9300_RDEXT_DEFAULT
expr_stmt|;
comment|/* Read the capability EEPROM location */
name|cap_field
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_OP_CAP
argument_list|)
expr_stmt|;
comment|/* Construct wireless mode from EEPROM */
name|p_cap
operator|->
name|hal_wireless_modes
operator|=
literal|0
expr_stmt|;
name|eeval
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_OP_MODE
argument_list|)
expr_stmt|;
if|if
condition|(
name|eeval
operator|&
name|AR9300_OPFLAGS_11A
condition|)
block|{
name|p_cap
operator|->
name|hal_wireless_modes
operator||=
name|HAL_MODE_11A
operator||
operator|(
operator|(
operator|!
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_ht_enable
operator|||
operator|(
name|eeval
operator|&
name|AR9300_OPFLAGS_N_5G_HT20
operator|)
operator|)
condition|?
literal|0
else|:
operator|(
name|HAL_MODE_11NA_HT20
operator||
operator|(
operator|(
name|eeval
operator|&
name|AR9300_OPFLAGS_N_5G_HT40
operator|)
condition|?
literal|0
else|:
operator|(
name|HAL_MODE_11NA_HT40PLUS
operator||
name|HAL_MODE_11NA_HT40MINUS
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|eeval
operator|&
name|AR9300_OPFLAGS_11G
condition|)
block|{
name|p_cap
operator|->
name|hal_wireless_modes
operator||=
name|HAL_MODE_11B
operator||
name|HAL_MODE_11G
operator||
operator|(
operator|(
operator|!
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_ht_enable
operator|||
operator|(
name|eeval
operator|&
name|AR9300_OPFLAGS_N_2G_HT20
operator|)
operator|)
condition|?
literal|0
else|:
operator|(
name|HAL_MODE_11NG_HT20
operator||
operator|(
operator|(
name|eeval
operator|&
name|AR9300_OPFLAGS_N_2G_HT40
operator|)
condition|?
literal|0
else|:
operator|(
name|HAL_MODE_11NG_HT40PLUS
operator||
name|HAL_MODE_11NG_HT40MINUS
operator|)
operator|)
operator|)
operator|)
expr_stmt|;
block|}
comment|/* Get chainamsks from eeprom */
name|p_cap
operator|->
name|hal_tx_chain_mask
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_TX_MASK
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_chain_mask
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_RX_MASK
argument_list|)
expr_stmt|;
comment|/*      * This being a newer chip supports TKIP non-splitmic mode.      *      */
name|ahp
operator|->
name|ah_misc_mode
operator||=
name|AR_PCU_MIC_NEW_LOC_ENA
expr_stmt|;
name|p_cap
operator|->
name|hal_low_2ghz_chan
operator|=
literal|2312
expr_stmt|;
name|p_cap
operator|->
name|hal_high_2ghz_chan
operator|=
literal|2732
expr_stmt|;
name|p_cap
operator|->
name|hal_low_5ghz_chan
operator|=
literal|4920
expr_stmt|;
name|p_cap
operator|->
name|hal_high_5ghz_chan
operator|=
literal|6100
expr_stmt|;
name|p_cap
operator|->
name|hal_cipher_ckip_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_cipher_tkip_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_cipher_aes_ccm_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_mic_ckip_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_mic_tkip_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_mic_aes_ccm_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_chan_spread_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_sleep_after_beacon_broken
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_burst_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_chap_tuning_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_turbo_prime_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_fast_frames_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_turbo_g_support
operator|=
name|p_cap
operator|->
name|hal_wireless_modes
operator|&
name|HAL_MODE_108G
expr_stmt|;
name|p_cap
operator|->
name|hal_xr_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_ht_support
operator|=
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_ht_enable
condition|?
name|AH_TRUE
else|:
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_gtt_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_ps_poll_broken
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* XXX fixed in later revs? */
name|p_cap
operator|->
name|hal_ht20_sgi_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_veol_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_bss_id_mask_support
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* Bug 26802, fixed in later revs? */
name|p_cap
operator|->
name|hal_mcast_key_srch_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_tsf_add_support
operator|=
name|AH_TRUE
expr_stmt|;
if|if
condition|(
name|cap_field
operator|&
name|AR_EEPROM_EEPCAP_MAXQCU
condition|)
block|{
name|p_cap
operator|->
name|hal_total_queues
operator|=
name|MS
argument_list|(
name|cap_field
argument_list|,
name|AR_EEPROM_EEPCAP_MAXQCU
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_total_queues
operator|=
name|HAL_NUM_TX_QUEUES
expr_stmt|;
block|}
if|if
condition|(
name|cap_field
operator|&
name|AR_EEPROM_EEPCAP_KC_ENTRIES
condition|)
block|{
name|p_cap
operator|->
name|hal_key_cache_size
operator|=
literal|1
operator|<<
name|MS
argument_list|(
name|cap_field
argument_list|,
name|AR_EEPROM_EEPCAP_KC_ENTRIES
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_key_cache_size
operator|=
name|AR_KEYTABLE_SIZE
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_fast_cc_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_num_mr_retries
operator|=
literal|4
expr_stmt|;
name|p_cap
operator|->
name|hal_tx_trig_level_max
operator|=
name|MAX_TX_FIFO_THRESHOLD
expr_stmt|;
name|p_cap
operator|->
name|hal_num_gpio_pins
operator|=
name|AR9382_MAX_GPIO_PIN_NUM
expr_stmt|;
if|#
directive|if
literal|0
comment|/* XXX Verify support in Osprey */
block|if (AR_SREV_MERLIN_10_OR_LATER(ah)) {         p_cap->hal_wow_support = AH_TRUE;         p_cap->hal_wow_match_pattern_exact = AH_TRUE;         if (AR_SREV_MERLIN(ah)) {             p_cap->hal_wow_pattern_match_dword = AH_TRUE;         }     } else {         p_cap->hal_wow_support = AH_FALSE;         p_cap->hal_wow_match_pattern_exact = AH_FALSE;     }
endif|#
directive|endif
name|p_cap
operator|->
name|hal_wow_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_match_pattern_exact
operator|=
name|AH_TRUE
expr_stmt|;
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_wow_match_pattern_exact
operator|=
name|AH_TRUE
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_cst_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_rifs_rx_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_rifs_tx_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_rts_aggr_limit
operator|=
name|IEEE80211_AMPDU_LIMIT_MAX
expr_stmt|;
name|p_cap
operator|->
name|hal_mfp_support
operator|=
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_mfp_support
expr_stmt|;
name|p_cap
operator|->
name|halforce_ppm_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_hw_beacon_proc_support
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* ar9300 - has the HW UAPSD trigger support,      * but it has the following limitations      * The power state change from the following      * frames are not put in High priority queue.      *     i) Mgmt frames      *     ii) NoN QoS frames      *     iii) QoS frames form the access categories for which      *          UAPSD is not enabled.      * so we can not enable this feature currently.      * could be enabled, if these limitations are fixed      * in later versions of ar9300 chips      */
name|p_cap
operator|->
name|hal_hw_uapsd_trig
operator|=
name|AH_FALSE
expr_stmt|;
comment|/* Number of buffers that can be help in a single TxD */
name|p_cap
operator|->
name|hal_num_tx_maps
operator|=
literal|4
expr_stmt|;
name|p_cap
operator|->
name|hal_tx_desc_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txc
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_tx_status_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_txs
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_status_len
operator|=
sizeof|sizeof
argument_list|(
expr|struct
name|ar9300_rxs
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_hp_depth
operator|=
name|HAL_HP_RXFIFO_DEPTH
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_lp_depth
operator|=
name|HAL_LP_RXFIFO_DEPTH
expr_stmt|;
comment|/* Enable extension channel DFS support */
name|p_cap
operator|->
name|hal_use_combined_radar_rssi
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_ext_chan_dfs_support
operator|=
name|AH_TRUE
expr_stmt|;
if|#
directive|if
name|ATH_SUPPORT_SPECTRAL
name|p_cap
operator|->
name|hal_spectral_scan
operator|=
name|AH_TRUE
expr_stmt|;
endif|#
directive|endif
name|ahpriv
operator|->
name|ah_rfsilent
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_RF_SILENT
argument_list|)
expr_stmt|;
if|if
condition|(
name|ahpriv
operator|->
name|ah_rfsilent
operator|&
name|EEP_RFSILENT_ENABLED
condition|)
block|{
name|ahp
operator|->
name|ah_gpio_select
operator|=
name|MS
argument_list|(
name|ahpriv
operator|->
name|ah_rfsilent
argument_list|,
name|EEP_RFSILENT_GPIO_SEL
argument_list|)
expr_stmt|;
name|ahp
operator|->
name|ah_polarity
operator|=
name|MS
argument_list|(
name|ahpriv
operator|->
name|ah_rfsilent
argument_list|,
name|EEP_RFSILENT_POLARITY
argument_list|)
expr_stmt|;
name|ath_hal_enable_rfkill
argument_list|(
name|ah
argument_list|,
name|AH_TRUE
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_rf_silent_support
operator|=
name|AH_TRUE
expr_stmt|;
block|}
comment|/* XXX */
name|p_cap
operator|->
name|hal_wps_push_button
operator|=
name|AH_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|ATH_BT_COEX
name|p_cap
operator|->
name|hal_bt_coex_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_bt_coex_aspm_war
operator|=
name|AH_FALSE
expr_stmt|;
endif|#
directive|endif
name|p_cap
operator|->
name|hal_gen_timer_support
operator|=
name|AH_TRUE
expr_stmt|;
name|ahp
operator|->
name|ah_avail_gen_timers
operator|=
operator|~
operator|(
operator|(
literal|1
operator|<<
name|AR_FIRST_NDP_TIMER
operator|)
operator|-
literal|1
operator|)
expr_stmt|;
name|ahp
operator|->
name|ah_avail_gen_timers
operator|&=
operator|(
literal|1
operator|<<
name|AR_NUM_GEN_TIMERS
operator|)
operator|-
literal|1
expr_stmt|;
comment|/*      * According to Kyungwan, generic timer 0 and 8 are special      * timers. Remove timer 8 from the available gen timer list.      * Jupiter testing shows timer won't trigger with timer 8.      */
name|ahp
operator|->
name|ah_avail_gen_timers
operator|&=
operator|~
operator|(
literal|1
operator|<<
name|AR_GEN_TIMER_RESERVED
operator|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
if|#
directive|if
name|ATH_SUPPORT_MCI
if|if
condition|(
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_mci_config
operator|&
name|ATH_MCI_CONFIG_DISABLE_MCI
condition|)
block|{
name|p_cap
operator|->
name|hal_mci_support
operator|=
name|AH_FALSE
expr_stmt|;
block|}
else|else
endif|#
directive|endif
block|{
name|p_cap
operator|->
name|hal_mci_support
operator|=
operator|(
name|ahp
operator|->
name|ah_enterprise_mode
operator|&
name|AR_ENT_OTP_49GHZ_DISABLE
operator|)
condition|?
name|AH_FALSE
else|:
name|AH_TRUE
expr_stmt|;
block|}
name|HALDEBUG
argument_list|(
name|AH_NULL
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s: (MCI) MCI support = %d\n"
argument_list|,
name|__func__
argument_list|,
name|p_cap
operator|->
name|hal_mci_support
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_mci_support
operator|=
name|AH_FALSE
expr_stmt|;
block|}
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_radio_retention_support
operator|=
name|AH_TRUE
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_radio_retention_support
operator|=
name|AH_FALSE
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_auto_sleep_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_mbssid_aggr_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_proxy_sta_support
operator|=
name|AH_TRUE
expr_stmt|;
comment|/* XXX Mark it AH_TRUE after it is verfied as fixed */
name|p_cap
operator|->
name|hal4kb_split_trans_support
operator|=
name|AH_FALSE
expr_stmt|;
comment|/* Read regulatory domain flag */
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_current_rd_ext
operator|&
operator|(
literal|1
operator|<<
name|REG_EXT_JAPAN_MIDBAND
operator|)
condition|)
block|{
comment|/*          * If REG_EXT_JAPAN_MIDBAND is set, turn on U1 EVEN, U2, and MIDBAND.          */
name|p_cap
operator|->
name|hal_reg_cap
operator|=
name|AR_EEPROM_EEREGCAP_EN_KK_NEW_11A
operator||
name|AR_EEPROM_EEREGCAP_EN_KK_U1_EVEN
operator||
name|AR_EEPROM_EEREGCAP_EN_KK_U2
operator||
name|AR_EEPROM_EEREGCAP_EN_KK_MIDBAND
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_reg_cap
operator|=
name|AR_EEPROM_EEREGCAP_EN_KK_NEW_11A
operator||
name|AR_EEPROM_EEREGCAP_EN_KK_U1_EVEN
expr_stmt|;
block|}
comment|/* For AR9300 and above, midband channels are always supported */
name|p_cap
operator|->
name|hal_reg_cap
operator||=
name|AR_EEPROM_EEREGCAP_EN_FCC_MIDBAND
expr_stmt|;
name|p_cap
operator|->
name|hal_num_ant_cfg_5ghz
operator|=
name|ar9300_eeprom_get_num_ant_config
argument_list|(
name|ahp
argument_list|,
name|HAL_FREQ_BAND_5GHZ
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_num_ant_cfg_2ghz
operator|=
name|ar9300_eeprom_get_num_ant_config
argument_list|(
name|ahp
argument_list|,
name|HAL_FREQ_BAND_2GHZ
argument_list|)
expr_stmt|;
comment|/* STBC supported */
name|p_cap
operator|->
name|hal_rx_stbc_support
operator|=
literal|1
expr_stmt|;
comment|/* number of streams for STBC recieve. */
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_tx_stbc_support
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_tx_stbc_support
operator|=
literal|1
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_enhanced_dma_support
operator|=
name|AH_TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|ATH_SUPPORT_DFS
name|p_cap
operator|->
name|hal_enhanced_dfs_support
operator|=
name|AH_TRUE
expr_stmt|;
endif|#
directive|endif
comment|/*      *  EV61133 (missing interrupts due to AR_ISR_RAC).      *  Fixed in Osprey 2.0.      */
name|p_cap
operator|->
name|hal_isr_rac_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wep_tkip_aggr_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wep_tkip_aggr_num_tx_delim
operator|=
literal|10
expr_stmt|;
comment|/* TBD */
name|p_cap
operator|->
name|hal_wep_tkip_aggr_num_rx_delim
operator|=
literal|10
expr_stmt|;
comment|/* TBD */
name|p_cap
operator|->
name|hal_wep_tkip_max_ht_rate
operator|=
literal|15
expr_stmt|;
comment|/* TBD */
name|p_cap
operator|->
name|hal_cfend_fix_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_aggr_extra_delim_war
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_desc_timestamp_bits
operator|=
literal|32
expr_stmt|;
name|p_cap
operator|->
name|hal_rx_tx_abort_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_ani_poll_interval
operator|=
name|AR9300_ANI_POLLINTERVAL
expr_stmt|;
name|p_cap
operator|->
name|hal_channel_switch_time_usec
operator|=
name|AR9300_CHANNEL_SWITCH_TIME_USEC
expr_stmt|;
comment|/* Transmit Beamforming supported, fill capabilities */
name|p_cap
operator|->
name|hal_paprd_enabled
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_PAPRD_ENABLED
argument_list|)
expr_stmt|;
name|p_cap
operator|->
name|hal_chan_half_rate
operator|=
operator|!
operator|(
name|ahp
operator|->
name|ah_enterprise_mode
operator|&
name|AR_ENT_OTP_10MHZ_DISABLE
operator|)
expr_stmt|;
name|p_cap
operator|->
name|hal_chan_quarter_rate
operator|=
operator|!
operator|(
name|ahp
operator|->
name|ah_enterprise_mode
operator|&
name|AR_ENT_OTP_5MHZ_DISABLE
operator|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* There is no AR_ENT_OTP_49GHZ_DISABLE feature in Jupiter, now the bit is used to disable BT. */
name|p_cap
operator|->
name|hal49Ghz
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal49Ghz
operator|=
operator|!
operator|(
name|ahp
operator|->
name|ah_enterprise_mode
operator|&
name|AR_ENT_OTP_49GHZ_DISABLE
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|/* LDPC supported */
comment|/* Poseidon doesn't support LDPC, or it will cause receiver CRC Error */
name|p_cap
operator|->
name|hal_ldpc_support
operator|=
name|AH_FALSE
expr_stmt|;
comment|/* PCI_E LCR offset */
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_pcie_lcr_offset
operator|=
literal|0x80
expr_stmt|;
comment|/*for Poseidon*/
block|}
comment|/*WAR method for APSM L0s with Poseidon 1.0*/
if|if
condition|(
name|AR_SREV_POSEIDON_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_pcie_lcr_extsync_en
operator|=
name|AH_TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_ldpc_support
operator|=
name|AH_TRUE
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_enable_apm
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_CHAIN_MASK_REDUCE
argument_list|)
expr_stmt|;
if|#
directive|if
name|ATH_ANT_DIV_COMB
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
if|if
condition|(
name|ahp
operator|->
name|ah_diversity_control
operator|==
name|HAL_ANT_VARIABLE
condition|)
block|{
name|u_int8_t
name|ant_div_control1
init|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_ANTDIV_control
argument_list|)
decl_stmt|;
comment|/* if enable_lnadiv is 0x1 and enable_fast_div is 0x1,               * we enable the diversity-combining algorithm.               */
if|if
condition|(
operator|(
name|ant_div_control1
operator|>>
literal|0x6
operator|)
operator|==
literal|0x3
condition|)
block|{
name|p_cap
operator|->
name|hal_ant_div_comb_support
operator|=
name|AH_TRUE
expr_stmt|;
block|}
name|p_cap
operator|->
name|hal_ant_div_comb_support_org
operator|=
name|p_cap
operator|->
name|hal_ant_div_comb_support
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* ATH_ANT_DIV_COMB */
if|#
directive|if
name|ATH_WOW_OFFLOAD
if|if
condition|(
name|AR_SREV_JUPITER_20_OR_LATER
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|p_cap
operator|->
name|hal_wow_gtk_offload_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_arp_offload_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_ns_offload_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_4way_hs_wakeup_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_acer_magic_support
operator|=
name|AH_TRUE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_acer_swka_support
operator|=
name|AH_TRUE
expr_stmt|;
block|}
else|else
block|{
name|p_cap
operator|->
name|hal_wow_gtk_offload_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_arp_offload_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_ns_offload_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_4way_hs_wakeup_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_acer_magic_support
operator|=
name|AH_FALSE
expr_stmt|;
name|p_cap
operator|->
name|hal_wow_acer_swka_support
operator|=
name|AH_FALSE
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* ATH_WOW_OFFLOAD */
return|return
name|AH_TRUE
return|;
undef|#
directive|undef
name|AR_KEYTABLE_SIZE
block|}
end_function

begin_function
specifier|static
name|HAL_BOOL
name|ar9300_get_chip_power_limits
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_CHANNEL
modifier|*
name|chans
parameter_list|,
name|u_int32_t
name|nchans
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
return|return
name|ahp
operator|->
name|ah_rf_hal
operator|.
name|get_chip_power_lim
argument_list|(
name|ah
argument_list|,
name|chans
argument_list|,
name|nchans
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Disable PLL when in L0s as well as receiver clock when in L1.  * This power saving option must be enabled through the Serdes.  *  * Programming the Serdes must go through the same 288 bit serial shift  * register as the other analog registers.  Hence the 9 writes.  *  * XXX Clean up the magic numbers.  */
end_comment

begin_function
name|void
name|ar9300_config_pci_power_save
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|restore
parameter_list|,
name|int
name|power_off
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_is_pci_express
operator|!=
name|AH_TRUE
condition|)
block|{
return|return;
block|}
comment|/*      * Increase L1 Entry Latency. Some WB222 boards don't have      * this change in eeprom/OTP.      */
if|if
condition|(
name|AR_SREV_JUPITER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|u_int32_t
name|val
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_war70c
decl_stmt|;
if|if
condition|(
operator|(
name|val
operator|&
literal|0xff000000
operator|)
operator|==
literal|0x17000000
condition|)
block|{
name|val
operator|&=
literal|0x00ffffff
expr_stmt|;
name|val
operator||=
literal|0x27000000
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
literal|0x570c
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Do not touch SERDES registers */
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_power_save_enable
operator|==
literal|2
condition|)
block|{
return|return;
block|}
comment|/* Nothing to do on restore for 11N */
if|if
condition|(
operator|!
name|restore
condition|)
block|{
comment|/* set bit 19 to allow forcing of pcie core into L1 state */
name|OS_REG_SET_BIT
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PM_CTRL
argument_list|)
argument_list|,
name|AR_PCIE_PM_CTRL_ENA
argument_list|)
expr_stmt|;
comment|/*          * Set PCIE workaround config only if requested, else use the reset          * value of this register.          */
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_waen
condition|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
argument_list|,
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_waen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Set Bits 17 and 14 in the AR_WA register. */
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
argument_list|,
name|ahp
operator|->
name|ah_wa_reg_val
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* Configure PCIE after Ini init. SERDES values now come from ini file */
if|if
condition|(
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_config
operator|.
name|ath_hal_pcie_ser_des_write
condition|)
block|{
if|if
condition|(
name|power_off
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ahp
operator|->
name|ah_ini_pcie_serdes
operator|.
name|ia_rows
condition|;
name|i
operator|++
control|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|INI_RA
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|INI_RA
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes
argument_list|,
name|i
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
operator|.
name|ia_rows
condition|;
name|i
operator|++
control|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|INI_RA
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|INI_RA
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_pcie_serdes_low_power
argument_list|,
name|i
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_comment
comment|/*  * Recipe from charles to turn off PCIe PHY in PCI mode for power savings  */
end_comment

begin_function
name|void
name|ar9300_disable_pcie_phy
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
comment|/* Osprey does not support PCI mode */
block|}
end_function

begin_function
specifier|static
specifier|inline
name|HAL_STATUS
name|ar9300_init_mac_addr
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|u_int32_t
name|sum
decl_stmt|;
name|int
name|i
decl_stmt|;
name|u_int16_t
name|eeval
decl_stmt|;
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|u_int32_t
name|EEP_MAC
index|[]
init|=
block|{
name|EEP_MAC_LSW
block|,
name|EEP_MAC_MID
block|,
name|EEP_MAC_MSW
block|}
decl_stmt|;
name|sum
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|eeval
operator|=
name|ar9300_eeprom_get
argument_list|(
name|ahp
argument_list|,
name|EEP_MAC
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|sum
operator|+=
name|eeval
expr_stmt|;
name|ahp
operator|->
name|ah_macaddr
index|[
literal|2
operator|*
name|i
index|]
operator|=
name|eeval
operator|>>
literal|8
expr_stmt|;
name|ahp
operator|->
name|ah_macaddr
index|[
literal|2
operator|*
name|i
operator|+
literal|1
index|]
operator|=
name|eeval
operator|&
literal|0xff
expr_stmt|;
block|}
if|if
condition|(
name|sum
operator|==
literal|0
operator|||
name|sum
operator|==
literal|0xffff
operator|*
literal|3
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_EEPROM
argument_list|,
literal|"%s: mac address read failed: %s\n"
argument_list|,
name|__func__
argument_list|,
name|ath_hal_ether_sprintf
argument_list|(
name|ahp
operator|->
name|ah_macaddr
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|HAL_EEBADMAC
return|;
block|}
return|return
name|HAL_OK
return|;
block|}
end_function

begin_comment
comment|/*  * Code for the "real" chip i.e. non-emulation. Review and revisit  * when actual hardware is at hand.  */
end_comment

begin_function
specifier|static
specifier|inline
name|HAL_STATUS
name|ar9300_hw_attach
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|HAL_STATUS
name|ecode
decl_stmt|;
if|if
condition|(
operator|!
name|ar9300_chip_test
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_REG_IO
argument_list|,
literal|"%s: hardware self-test failed\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
name|HAL_ESELFTEST
return|;
block|}
name|ecode
operator|=
name|ar9300_eeprom_attach
argument_list|(
name|ah
argument_list|)
expr_stmt|;
if|if
condition|(
name|ecode
operator|!=
name|HAL_OK
condition|)
block|{
return|return
name|ecode
return|;
block|}
if|if
condition|(
operator|!
name|ar9300_rf_attach
argument_list|(
name|ah
argument_list|,
operator|&
name|ecode
argument_list|)
condition|)
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: RF setup failed, status %u\n"
argument_list|,
name|__func__
argument_list|,
name|ecode
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ecode
operator|!=
name|HAL_OK
condition|)
block|{
return|return
name|ecode
return|;
block|}
name|ar9300_ani_attach
argument_list|(
name|ah
argument_list|)
expr_stmt|;
return|return
name|HAL_OK
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
name|ar9300_hw_detach
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
comment|/* XXX EEPROM allocated state */
name|ar9300_ani_detach
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int16_t
name|ar9300_get_nf_adjust
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
specifier|const
name|HAL_CHANNEL_INTERNAL
modifier|*
name|c
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|ar9300_set_immunity
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_BOOL
name|enable
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|u_int32_t
name|m1_thresh_low
init|=
name|enable
condition|?
literal|127
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|0
index|]
decl_stmt|,
name|m2_thresh_low
init|=
name|enable
condition|?
literal|127
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|1
index|]
decl_stmt|,
name|m1_thresh
init|=
name|enable
condition|?
literal|127
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|2
index|]
decl_stmt|,
name|m2_thresh
init|=
name|enable
condition|?
literal|127
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|3
index|]
decl_stmt|,
name|m2_count_thr
init|=
name|enable
condition|?
literal|31
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|4
index|]
decl_stmt|,
name|m2_count_thr_low
init|=
name|enable
condition|?
literal|63
else|:
name|ahp
operator|->
name|ah_immunity_vals
index|[
literal|5
index|]
decl_stmt|;
if|if
condition|(
name|ahp
operator|->
name|ah_immunity_on
operator|==
name|enable
condition|)
block|{
return|return;
block|}
name|ahp
operator|->
name|ah_immunity_on
operator|=
name|enable
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_LOW
argument_list|,
name|AR_PHY_SFCORR_LOW_M1_THRESH_LOW
argument_list|,
name|m1_thresh_low
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_LOW
argument_list|,
name|AR_PHY_SFCORR_LOW_M2_THRESH_LOW
argument_list|,
name|m2_thresh_low
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR
argument_list|,
name|AR_PHY_SFCORR_M1_THRESH
argument_list|,
name|m1_thresh
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR
argument_list|,
name|AR_PHY_SFCORR_M2_THRESH
argument_list|,
name|m2_thresh
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR
argument_list|,
name|AR_PHY_SFCORR_M2COUNT_THR
argument_list|,
name|m2_count_thr
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_LOW
argument_list|,
name|AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW
argument_list|,
name|m2_count_thr_low
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_EXT
argument_list|,
name|AR_PHY_SFCORR_EXT_M1_THRESH_LOW
argument_list|,
name|m1_thresh_low
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_EXT
argument_list|,
name|AR_PHY_SFCORR_EXT_M2_THRESH_LOW
argument_list|,
name|m2_thresh_low
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_EXT
argument_list|,
name|AR_PHY_SFCORR_EXT_M1_THRESH
argument_list|,
name|m1_thresh
argument_list|)
expr_stmt|;
name|OS_REG_RMW_FIELD
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_EXT
argument_list|,
name|AR_PHY_SFCORR_EXT_M2_THRESH
argument_list|,
name|m2_thresh
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|enable
condition|)
block|{
name|OS_REG_SET_BIT
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_LOW
argument_list|,
name|AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|OS_REG_CLR_BIT
argument_list|(
name|ah
argument_list|,
name|AR_PHY_SFCORR_LOW
argument_list|,
name|AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|ar9300_get_cal_intervals
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_CALIBRATION_TIMER
modifier|*
modifier|*
name|timerp
parameter_list|,
name|HAL_CAL_QUERY
name|query
parameter_list|)
block|{
define|#
directive|define
name|AR9300_IS_CHAIN_RX_IQCAL_INVALID
parameter_list|(
name|_ah
parameter_list|,
name|_reg
parameter_list|)
define|\
value|((OS_REG_READ((_ah), _reg)& 0x3fff) == 0)
define|#
directive|define
name|AR9300_IS_RX_IQCAL_DISABLED
parameter_list|(
name|_ah
parameter_list|)
define|\
value|(!(OS_REG_READ((_ah), AR_PHY_RX_IQCAL_CORR_B0)& \     AR_PHY_RX_IQCAL_CORR_IQCORR_ENABLE))
comment|/* Avoid comilation warnings. Variables are not used when EMULATION. */
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|u_int8_t
name|rxchainmask
init|=
name|ahp
operator|->
name|ah_rx_chainmask
decl_stmt|,
name|i
decl_stmt|;
name|int
name|rx_iqcal_invalid
init|=
literal|0
decl_stmt|,
name|num_chains
init|=
literal|0
decl_stmt|;
specifier|static
specifier|const
name|u_int32_t
name|offset_array
index|[
literal|3
index|]
init|=
block|{
name|AR_PHY_RX_IQCAL_CORR_B0
block|,
name|AR_PHY_RX_IQCAL_CORR_B1
block|,
name|AR_PHY_RX_IQCAL_CORR_B2
block|}
decl_stmt|;
operator|*
name|timerp
operator|=
name|ar9300_cals
expr_stmt|;
switch|switch
condition|(
name|query
condition|)
block|{
case|case
name|HAL_QUERY_CALS
case|:
return|return
name|AR9300_NUM_CAL_TYPES
return|;
case|case
name|HAL_QUERY_RERUN_CALS
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AR9300_MAX_CHAINS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|rxchainmask
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
condition|)
block|{
name|num_chains
operator|++
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_chains
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|HALASSERT
argument_list|(
name|num_chains
operator|==
literal|0x1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|AR9300_IS_CHAIN_RX_IQCAL_INVALID
argument_list|(
name|ah
argument_list|,
name|offset_array
index|[
name|i
index|]
argument_list|)
condition|)
block|{
name|rx_iqcal_invalid
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|AR9300_IS_RX_IQCAL_DISABLED
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|rx_iqcal_invalid
operator|=
literal|1
expr_stmt|;
block|}
return|return
name|rx_iqcal_invalid
return|;
default|default:
name|HALASSERT
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_if
if|#
directive|if
name|ATH_TRAFFIC_FAST_RECOVER
end_if

begin_define
define|#
directive|define
name|PLL3
value|0x16188
end_define

begin_define
define|#
directive|define
name|PLL3_DO_MEAS_MASK
value|0x40000000
end_define

begin_define
define|#
directive|define
name|PLL4
value|0x1618c
end_define

begin_define
define|#
directive|define
name|PLL4_MEAS_DONE
value|0x8
end_define

begin_define
define|#
directive|define
name|SQSUM_DVC_MASK
value|0x007ffff8
end_define

begin_function
name|unsigned
name|long
name|ar9300_get_pll3_sqsum_dvc
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
if|if
condition|(
name|AR_SREV_HORNET
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PLL3
argument_list|,
operator|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PLL3
argument_list|)
operator|&
operator|~
operator|(
name|PLL3_DO_MEAS_MASK
operator|)
operator|)
argument_list|)
expr_stmt|;
name|OS_DELAY
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|PLL3
argument_list|,
operator|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PLL3
argument_list|)
operator||
name|PLL3_DO_MEAS_MASK
operator|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PLL4
argument_list|)
operator|&
name|PLL4_MEAS_DONE
operator|)
operator|==
literal|0
condition|)
block|{
name|OS_DELAY
argument_list|(
literal|100
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
operator|(
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|PLL3
argument_list|)
operator|&
name|SQSUM_DVC_MASK
operator|)
operator|>>
literal|3
operator|)
return|;
block|}
else|else
block|{
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_UNMASKABLE
argument_list|,
literal|"%s: unable to get pll3_sqsum_dvc\n"
argument_list|,
name|__func__
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|RX_GAIN_TABLE_LENGTH
value|128
end_define

begin_comment
comment|// this will be called if rfGainCAP is enabled and rfGainCAP setting is changed,
end_comment

begin_comment
comment|// or rxGainTable setting is changed
end_comment

begin_function
name|HAL_BOOL
name|ar9300_rf_gain_cap_apply
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|int
name|is_2GHz
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|done
init|=
literal|0
decl_stmt|,
name|i_rx_gain
init|=
literal|32
decl_stmt|;
name|u_int32_t
name|rf_gain_cap
decl_stmt|;
name|u_int32_t
name|rx_gain_value
decl_stmt|,
name|a_Byte
decl_stmt|,
name|rx_gain_value_caped
decl_stmt|;
specifier|static
name|u_int32_t
name|rx_gain_table
index|[
name|RX_GAIN_TABLE_LENGTH
operator|*
literal|2
index|]
index|[
literal|2
index|]
decl_stmt|;
name|ar9300_eeprom_t
modifier|*
name|eep
init|=
operator|&
name|AH9300
argument_list|(
name|ah
argument_list|)
operator|->
name|ah_eeprom
decl_stmt|;
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
operator|(
operator|(
name|eep
operator|->
name|base_eep_header
operator|.
name|misc_configuration
operator|&
literal|0x80
operator|)
operator|>>
literal|7
operator|)
condition|)
return|return
name|AH_FALSE
return|;
if|if
condition|(
name|is_2GHz
condition|)
block|{
name|rf_gain_cap
operator|=
operator|(
name|u_int32_t
operator|)
name|eep
operator|->
name|modal_header_2g
operator|.
name|rf_gain_cap
expr_stmt|;
block|}
else|else
block|{
name|rf_gain_cap
operator|=
operator|(
name|u_int32_t
operator|)
name|eep
operator|->
name|modal_header_5g
operator|.
name|rf_gain_cap
expr_stmt|;
block|}
if|if
condition|(
name|rf_gain_cap
operator|==
literal|0
condition|)
return|return
name|AH_FALSE
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|RX_GAIN_TABLE_LENGTH
operator|*
literal|2
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|// BB_rx_ocgain2
name|i_rx_gain
operator|=
literal|128
operator|+
literal|32
expr_stmt|;
switch|switch
condition|(
name|ar9300_rx_gain_index_get
argument_list|(
name|ah
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|0
index|]
operator|=
name|ar9300_common_rx_gain_table_ar9580_1p0
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|1
index|]
operator|=
name|ar9300_common_rx_gain_table_ar9580_1p0
index|[
name|i
index|]
index|[
literal|1
index|]
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|0
index|]
operator|=
name|ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|1
index|]
operator|=
name|ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0
index|[
name|i
index|]
index|[
literal|1
index|]
expr_stmt|;
break|break;
block|}
block|}
elseif|else
if|if
condition|(
name|AR_SREV_OSPREY_22
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|i_rx_gain
operator|=
literal|128
operator|+
literal|32
expr_stmt|;
switch|switch
condition|(
name|ar9300_rx_gain_index_get
argument_list|(
name|ah
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|0
index|]
operator|=
name|ar9300_common_rx_gain_table_osprey_2p2
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|1
index|]
operator|=
name|ar9300_common_rx_gain_table_osprey_2p2
index|[
name|i
index|]
index|[
literal|1
index|]
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|0
index|]
operator|=
name|ar9300Common_wo_xlna_rx_gain_table_osprey_2p2
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
name|rx_gain_table
index|[
name|i
index|]
index|[
literal|1
index|]
operator|=
name|ar9300Common_wo_xlna_rx_gain_table_osprey_2p2
index|[
name|i
index|]
index|[
literal|1
index|]
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
return|return
name|AH_FALSE
return|;
block|}
block|}
while|while
condition|(
literal|1
condition|)
block|{
name|rx_gain_value
operator|=
name|rx_gain_table
index|[
name|i_rx_gain
index|]
index|[
literal|1
index|]
expr_stmt|;
name|rx_gain_value_caped
operator|=
name|rx_gain_value
expr_stmt|;
name|a_Byte
operator|=
name|rx_gain_value
operator|&
operator|(
literal|0x000000FF
operator|)
expr_stmt|;
if|if
condition|(
name|a_Byte
operator|>
name|rf_gain_cap
condition|)
block|{
name|rx_gain_value_caped
operator|=
operator|(
name|rx_gain_value_caped
operator|&
operator|(
literal|0xFFFFFF00
operator|)
operator|)
operator|+
name|rf_gain_cap
expr_stmt|;
block|}
name|a_Byte
operator|=
name|rx_gain_value
operator|&
operator|(
literal|0x0000FF00
operator|)
expr_stmt|;
if|if
condition|(
name|a_Byte
operator|>
operator|(
name|rf_gain_cap
operator|<<
literal|8
operator|)
condition|)
block|{
name|rx_gain_value_caped
operator|=
operator|(
name|rx_gain_value_caped
operator|&
operator|(
literal|0xFFFF00FF
operator|)
operator|)
operator|+
operator|(
name|rf_gain_cap
operator|<<
literal|8
operator|)
expr_stmt|;
block|}
name|a_Byte
operator|=
name|rx_gain_value
operator|&
operator|(
literal|0x00FF0000
operator|)
expr_stmt|;
if|if
condition|(
name|a_Byte
operator|>
operator|(
name|rf_gain_cap
operator|<<
literal|16
operator|)
condition|)
block|{
name|rx_gain_value_caped
operator|=
operator|(
name|rx_gain_value_caped
operator|&
operator|(
literal|0xFF00FFFF
operator|)
operator|)
operator|+
operator|(
name|rf_gain_cap
operator|<<
literal|16
operator|)
expr_stmt|;
block|}
name|a_Byte
operator|=
name|rx_gain_value
operator|&
operator|(
literal|0xFF000000
operator|)
expr_stmt|;
if|if
condition|(
name|a_Byte
operator|>
operator|(
name|rf_gain_cap
operator|<<
literal|24
operator|)
condition|)
block|{
name|rx_gain_value_caped
operator|=
operator|(
name|rx_gain_value_caped
operator|&
operator|(
literal|0x00FFFFFF
operator|)
operator|)
operator|+
operator|(
name|rf_gain_cap
operator|<<
literal|24
operator|)
expr_stmt|;
block|}
else|else
block|{
name|done
operator|=
literal|1
expr_stmt|;
block|}
name|HALDEBUG
argument_list|(
name|ah
argument_list|,
name|HAL_DEBUG_RESET
argument_list|,
literal|"%s: rx_gain_address: %x, rx_gain_value: %x	rx_gain_value_caped: %x\n"
argument_list|,
name|__func__
argument_list|,
name|rx_gain_table
index|[
name|i_rx_gain
index|]
index|[
literal|0
index|]
argument_list|,
name|rx_gain_value
argument_list|,
name|rx_gain_value_caped
argument_list|)
expr_stmt|;
if|if
condition|(
name|rx_gain_value_caped
operator|!=
name|rx_gain_value
condition|)
block|{
name|rx_gain_table
index|[
name|i_rx_gain
index|]
index|[
literal|1
index|]
operator|=
name|rx_gain_value_caped
expr_stmt|;
block|}
if|if
condition|(
name|done
operator|==
literal|1
condition|)
break|break;
name|i_rx_gain
operator|++
expr_stmt|;
block|}
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|rx_gain_table
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|rx_gain_table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
return|return
name|AH_TRUE
return|;
block|}
end_function

begin_function
name|void
name|ar9300_rx_gain_table_apply
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|struct
name|ath_hal_private
modifier|*
name|ahpriv
init|=
name|AH_PRIVATE
argument_list|(
name|ah
argument_list|)
decl_stmt|;
name|u_int32_t
name|xlan_gpio_cfg
decl_stmt|;
name|u_int8_t
name|i
decl_stmt|;
if|if
condition|(
name|AR_SREV_OSPREY
argument_list|(
name|ah
argument_list|)
operator|||
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
comment|// this will be called if rxGainTable setting is changed
if|if
condition|(
name|ar9300_rf_gain_cap_apply
argument_list|(
name|ah
argument_list|,
literal|1
argument_list|)
condition|)
return|return;
block|}
switch|switch
condition|(
name|ar9300_rx_gain_index_get
argument_list|(
name|ah
argument_list|)
condition|)
block|{
case|case
literal|2
case|:
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_mixed_rx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_mixed_rx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300Common_mixed_rx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Common_mixed_rx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0
case|:
default|default:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_rx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_rx_gain_hornet1_2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_rx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_rx_gain_hornet1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|xlan_gpio_cfg
operator|=
name|ahpriv
operator|->
name|ah_config
operator|.
name|ath_hal_ext_lna_ctl_gpio
expr_stmt|;
if|if
condition|(
name|xlan_gpio_cfg
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|xlan_gpio_cfg
operator|&
operator|(
literal|1
operator|<<
name|i
operator|)
condition|)
block|{
name|ath_hal_gpio_cfg_output
argument_list|(
name|ah
argument_list|,
name|i
argument_list|,
name|HAL_GPIO_OUTPUT_MUX_AS_PCIE_ATTENTION_LED
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300Common_rx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Common_rx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9340Common_rx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Common_rx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar955xCommon_rx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_rx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain_bounds
argument_list|,
name|ar955xCommon_rx_gain_bounds_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_rx_gain_bounds_scorpion_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_rx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_rx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|1
case|:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_wo_xlna_rx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_wo_xlna_rx_gain_hornet1_2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9331_common_wo_xlna_rx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_common_wo_xlna_rx_gain_hornet1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_common_wo_xlna_rx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Common_wo_xlna_rx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_wo_xlna_rx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_wo_xlna_rx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300Common_wo_xlna_rx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Common_wo_xlna_rx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar956XCommon_wo_xlna_rx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XCommon_wo_xlna_rx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_common_wo_xlna_rx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9340Common_wo_xlna_rx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Common_wo_xlna_rx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_wo_xlna_rx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain_bounds
argument_list|,
name|ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xCommon_wo_xlna_rx_gain_bounds_scorpion_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_rxgain
argument_list|,
name|ar9300Common_wo_xlna_rx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Common_wo_xlna_rx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
name|void
name|ar9300_tx_gain_table_apply
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|ar9300_tx_gain_index_get
argument_list|(
name|ah
argument_list|)
condition|)
block|{
case|case
literal|0
case|:
default|default:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_lowest_ob_db_tx_gain_hornet1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_modes_lowest_ob_db_tx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Modes_lowest_ob_db_tx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_lowest_ob_db_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_lowest_ob_db_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_lowest_ob_db_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar955xModes_xpa_tx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xModes_xpa_tx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|9
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_low_ob_db_tx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_low_ob_db_tx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_low_ob_db_tx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_low_ob_db_tx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_lowest_ob_db_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|1
case|:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_high_ob_db_tx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_high_ob_db_tx_gain_hornet1_2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_high_ob_db_tx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_high_ob_db_tx_gain_hornet1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_high_ob_db_tx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_modes_high_ob_db_tx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485Modes_high_ob_db_tx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Modes_high_ob_db_tx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_high_ob_db_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_high_ob_db_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_high_ob_db_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_SCORPION
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar955xModes_no_xpa_tx_gain_table_scorpion_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar955xModes_no_xpa_tx_gain_table_scorpion_1p0
argument_list|)
argument_list|,
literal|9
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_10
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_high_ob_db_tx_gain_table_jupiter_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_high_ob_db_tx_gain_table_jupiter_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_JUPITER_20
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_high_ob_db_tx_gain_table_jupiter_2p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_high_ob_db_tx_gain_table_jupiter_2p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar956XModes_high_ob_db_tx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XModes_high_ob_db_tx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_high_ob_db_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_high_ob_db_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|2
case|:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_low_ob_db_tx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_low_ob_db_tx_gain_hornet1_2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_low_ob_db_tx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_low_ob_db_tx_gain_hornet1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_low_ob_db_tx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_modes_low_ob_db_tx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485Modes_low_ob_db_tx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Modes_low_ob_db_tx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_low_ob_db_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_low_ob_db_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_low_ob_db_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_low_ob_db_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XModes_low_ob_db_tx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_low_ob_db_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_low_ob_db_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|AR_SREV_HORNET_12
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_high_power_tx_gain_hornet1_2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_high_power_tx_gain_hornet1_2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9331_modes_high_power_tx_gain_hornet1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9331_modes_high_power_tx_gain_hornet1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_high_power_tx_gain_poseidon1_1
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485_modes_high_power_tx_gain_poseidon1_1
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485Modes_high_power_tx_gain_poseidon1_0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9485Modes_high_power_tx_gain_poseidon1_0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_high_power_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_high_power_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_high_power_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_high_power_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_APHRODITE
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar956XModes_high_power_tx_gain_table_aphrodite_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar956XModes_high_power_tx_gain_table_aphrodite_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_high_power_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_high_power_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_mixed_ob_db_tx_gain_table_wasp_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9340Modes_mixed_ob_db_tx_gain_table_wasp_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_mixed_ob_db_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_mixed_ob_db_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300Modes_mixed_ob_db_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300Modes_mixed_ob_db_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|5
case|:
comment|/* HW Green TX */
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_1
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_1
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_1
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_0
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_0
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_ob_db_tx_gain_poseidon1_0
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
name|ahp
operator|->
name|ah_hw_green_tx_enable
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340_modes_ub124_tx_gain_table_wasp_1p0
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9340_modes_ub124_tx_gain_table_wasp_1p0
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9340_modes_ub124_tx_gain_table_wasp_1p0
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_type5_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_type5_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_OSPREY_22
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_number_5_tx_gain_table_osprey_2p2
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_number_5_tx_gain_table_osprey_2p2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|6
case|:
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9340_modes_low_ob_db_and_spur_tx_gain_table_wasp_1p0
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
comment|/* HW Green TX */
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
condition|)
block|{
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9485_modes_green_spur_ob_db_tx_gain_poseidon1_1
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
name|ahp
operator|->
name|ah_hw_green_tx_enable
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_AR9580
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9300_modes_type6_tx_gain_table_ar9580_1p0
argument_list|,
name|ARRAY_LENGTH
argument_list|(
name|ar9300_modes_type6_tx_gain_table_ar9580_1p0
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|7
case|:
if|if
condition|(
name|AR_SREV_WASP
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|INIT_INI_ARRAY
argument_list|(
operator|&
name|ahp
operator|->
name|ah_ini_modes_txgain
argument_list|,
name|ar9340Modes_cus227_tx_gain_table_wasp_1p0
argument_list|,
sizeof|sizeof
argument_list|(
name|ar9340Modes_cus227_tx_gain_table_wasp_1p0
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|ar9340Modes_cus227_tx_gain_table_wasp_1p0
index|[
literal|0
index|]
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_if
if|#
directive|if
name|ATH_ANT_DIV_COMB
end_if

begin_function
name|void
name|ar9300_ant_div_comb_get_config
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_ANT_COMB_CONFIG
modifier|*
name|div_comb_conf
parameter_list|)
block|{
name|u_int32_t
name|reg_val
init|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_PHY_MC_GAIN_CTRL
argument_list|)
decl_stmt|;
name|div_comb_conf
operator|->
name|main_lna_conf
operator|=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__READ
argument_list|(
name|reg_val
argument_list|)
expr_stmt|;
name|div_comb_conf
operator|->
name|alt_lna_conf
operator|=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__READ
argument_list|(
name|reg_val
argument_list|)
expr_stmt|;
name|div_comb_conf
operator|->
name|fast_div_bias
operator|=
name|MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__READ
argument_list|(
name|reg_val
argument_list|)
expr_stmt|;
if|if
condition|(
name|AR_SREV_HORNET_11
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|div_comb_conf
operator|->
name|antdiv_configgroup
operator|=
name|HAL_ANTDIV_CONFIG_GROUP_1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|AR_SREV_POSEIDON_11_OR_LATER
argument_list|(
name|ah
argument_list|)
condition|)
block|{
name|div_comb_conf
operator|->
name|antdiv_configgroup
operator|=
name|HAL_ANTDIV_CONFIG_GROUP_2
expr_stmt|;
block|}
else|else
block|{
name|div_comb_conf
operator|->
name|antdiv_configgroup
operator|=
name|DEFAULT_ANTDIV_CONFIG_GROUP
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
name|ar9300_ant_div_comb_set_config
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|HAL_ANT_COMB_CONFIG
modifier|*
name|div_comb_conf
parameter_list|)
block|{
name|u_int32_t
name|reg_val
decl_stmt|;
name|struct
name|ath_hal_9300
modifier|*
name|ahp
init|=
name|AH9300
argument_list|(
name|ah
argument_list|)
decl_stmt|;
comment|/* DO NOTHING when set to fixed antenna for manufacturing purpose */
if|if
condition|(
name|AR_SREV_POSEIDON
argument_list|(
name|ah
argument_list|)
operator|&&
operator|(
name|ahp
operator|->
name|ah_diversity_control
operator|==
name|HAL_ANT_FIXED_A
operator|||
name|ahp
operator|->
name|ah_diversity_control
operator|==
name|HAL_ANT_FIXED_B
operator|)
condition|)
block|{
return|return;
block|}
name|reg_val
operator|=
name|OS_REG_READ
argument_list|(
name|ah
argument_list|,
name|AR_PHY_MC_GAIN_CTRL
argument_list|)
expr_stmt|;
name|reg_val
operator|&=
operator|~
operator|(
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__MASK
operator||
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__MASK
operator||
name|MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__MASK
operator||
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_GAINTB__MASK
operator||
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_GAINTB__MASK
operator|)
expr_stmt|;
name|reg_val
operator||=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_GAINTB__WRITE
argument_list|(
name|div_comb_conf
operator|->
name|main_gaintb
argument_list|)
expr_stmt|;
name|reg_val
operator||=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_GAINTB__WRITE
argument_list|(
name|div_comb_conf
operator|->
name|alt_gaintb
argument_list|)
expr_stmt|;
name|reg_val
operator||=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_MAIN_LNACONF__WRITE
argument_list|(
name|div_comb_conf
operator|->
name|main_lna_conf
argument_list|)
expr_stmt|;
name|reg_val
operator||=
name|MULTICHAIN_GAIN_CTRL__ANT_DIV_ALT_LNACONF__WRITE
argument_list|(
name|div_comb_conf
operator|->
name|alt_lna_conf
argument_list|)
expr_stmt|;
name|reg_val
operator||=
name|MULTICHAIN_GAIN_CTRL__ANT_FAST_DIV_BIAS__WRITE
argument_list|(
name|div_comb_conf
operator|->
name|fast_div_bias
argument_list|)
expr_stmt|;
name|OS_REG_WRITE
argument_list|(
name|ah
argument_list|,
name|AR_PHY_MC_GAIN_CTRL
argument_list|,
name|reg_val
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ATH_ANT_DIV_COMB */
end_comment

begin_function
specifier|static
name|void
name|ar9300_init_hostif_offsets
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_RC
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_RESET_CONTROL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_WORK_AROUND
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PM_STATE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PM_STATE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_H_INFOL
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_CXPL_DEBUG_INFOL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_H_INFOH
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_CXPL_DEBUG_INFOH
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PM_CTRL
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PM_CTRL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_HOST_TIMEOUT
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_TIMEOUT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_EEPROM
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_EEPROM_CTRL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_SREV
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_SREV
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_CAUSE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_CAUSE_CLR
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_ENABLE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_MASK
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_MASK
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_CAUSE_CLR
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_CAUSE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_ENABLE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_SERDES
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_PHY_RW
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_SERDES2
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_PHY_LOAD
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUT
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_IN
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_IN
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OE_OUT
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OE1_OUT
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OE1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INTR_POL
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INTR_POLAR
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_EN_VAL
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_VALUE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_MUX1
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_MUX1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_MUX2
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_MUX2
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX1
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX2
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX2
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX3
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX3
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INPUT_STATE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_STATE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_SPARE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_SPARE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_CORE_RESET_EN
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_CORE_RST_EN
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_CLKRUN
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_CLKRUN
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_EEPROM_STATUS_DATA
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_EEPROM_STS
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_OBS
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_OBS_CTRL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_RFSILENT
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_RFSILENT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_PDPU
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_PDPU
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_DS
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_DS
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_MISC
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MISC
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_MSI
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_MSI
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* Offsets are not defined in reg_map structure */
block|AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_ACTIVE) =         AR9300_HOSTIF_OFFSET(HOST_INTF_TSF_SNAPSHOT_BT_ACTIVE);     AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_PRIORITY) =         AR9300_HOSTIF_OFFSET(HOST_INTF_TSF_SNAPSHOT_BT_PRIORITY);     AR_HOSTIF_REG(ah, AR_TSF_SNAPSHOT_BT_CNTL) =         AR9300_HOSTIF_OFFSET(HOST_INTF_MAC_TSF_SNAPSHOT_BT_CNTL);
endif|#
directive|endif
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PHY_LATENCY_NFTS_ADJ
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_PHY_LATENCY_NFTS_ADJ
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TDMA_CCA_CNTL
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TDMA_CCA_CNTL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TXAPSYNC
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TXAPSYNC
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TXSYNC_INIT_SYNC_TMR
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TXSYNC_INITIAL_SYNC_TMR
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_CAUSE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_ENABLE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_MASK
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_MASK
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_CAUSE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_ENABLE
argument_list|)
operator|=
name|AR9300_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_ENABLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|ar9340_init_hostif_offsets
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|)
block|{
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_RC
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_RESET_CONTROL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_WA
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_WORK_AROUND
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_PM_CTRL
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PM_CTRL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_HOST_TIMEOUT
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_TIMEOUT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_SREV
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_SREV
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_CAUSE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_CAUSE_CLR
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_ENABLE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_MASK
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_SYNC_MASK
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_SYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_CAUSE_CLR
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_CAUSE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_ASYNC_ENABLE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_ASYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUT
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_IN
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_IN
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OE_OUT
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OE1_OUT
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OE1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INTR_POL
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INTR_POLAR
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_EN_VAL
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_VALUE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_MUX1
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_MUX1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_INPUT_MUX2
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_MUX2
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX1
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX1
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX2
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX2
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_GPIO_OUTPUT_MUX3
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_OUTPUT_MUX3
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INPUT_STATE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_GPIO_INPUT_STATE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_CLKRUN
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_CLKRUN
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_EEPROM_STATUS_DATA
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_EEPROM_STS
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_OBS
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_OBS_CTRL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_RFSILENT
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_RFSILENT
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_MISC
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MISC
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_PCIE_MSI
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_PCIE_MSI
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TDMA_CCA_CNTL
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TDMA_CCA_CNTL
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TXAPSYNC
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TXAPSYNC
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_TXSYNC_INIT_SYNC_TMR
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_MAC_TXSYNC_INITIAL_SYNC_TMR
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_CAUSE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_ENABLE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_ENABLE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_MASK
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_SYNC_MASK
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_SYNC_MASK
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_CAUSE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_CAUSE
argument_list|)
expr_stmt|;
name|AR_HOSTIF_REG
argument_list|(
name|ah
argument_list|,
name|AR_INTR_PRIO_ASYNC_ENABLE
argument_list|)
operator|=
name|AR9340_HOSTIF_OFFSET
argument_list|(
name|HOST_INTF_INTR_PRIORITY_ASYNC_ENABLE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   * Host interface register offsets are different for Osprey and Wasp   * and hence store the offsets in hal structure  */
end_comment

begin_function
specifier|static
name|int
name|ar9300_init_offsets
parameter_list|(
name|struct
name|ath_hal
modifier|*
name|ah
parameter_list|,
name|u_int16_t
name|devid
parameter_list|)
block|{
if|if
condition|(
name|devid
operator|==
name|AR9300_DEVID_AR9340
condition|)
block|{
name|ar9340_init_hostif_offsets
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ar9300_init_hostif_offsets
argument_list|(
name|ah
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* AH_SUPPORT_AR9300 */
end_comment

end_unit

