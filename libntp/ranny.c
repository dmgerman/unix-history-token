begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Random number generator is:  *  *	Copyright 1988 by Rayan S. Zachariassen, all rights reserved.  *	This will be free software, but only when it is finished.  *  * Used in ntp by permission of the author.  If copyright is  * annoying to you, read no further.  Instead, look up the reference,  * write me an equivalent to this and send it back to me.  */
end_comment

begin_comment
comment|/*  * Random number generator; see Knuth Vol 2. 2nd ed. p.27 (section 3.2.2)  */
end_comment

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_decl_stmt
specifier|extern
name|time_t
name|time
name|P
argument_list|(
operator|(
name|time_t
operator|*
name|loc
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * 55 random numbers, not all even.  Note we don't initialize ran_y  * directly since I have had thoughts of putting this in an EPROM  */
end_comment

begin_decl_stmt
specifier|static
name|time_t
name|ran_y
index|[
literal|55
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|time_t
name|init_ran_y
index|[
literal|55
index|]
init|=
block|{
literal|1860909544
block|,
literal|231033423
block|,
literal|437666411
block|,
literal|1349655137
block|,
literal|2014584962
block|,
literal|504613712
block|,
literal|656256107
block|,
literal|1246027206
block|,
literal|573713775
block|,
literal|643466871
block|,
literal|540235388
block|,
literal|1630565153
block|,
literal|443649364
block|,
literal|729302839
block|,
literal|1933991552
block|,
literal|944681982
block|,
literal|949111118
block|,
literal|406212522
block|,
literal|1065063137
block|,
literal|1712954727
block|,
literal|73280612
block|,
literal|787623973
block|,
literal|1874130997
block|,
literal|801658492
block|,
literal|73395958
block|,
literal|739165367
block|,
literal|596047144
block|,
literal|490055249
block|,
literal|1131094323
block|,
literal|662727104
block|,
literal|483614097
block|,
literal|844520219
block|,
literal|893760527
block|,
literal|921280508
block|,
literal|46691708
block|,
literal|760861842
block|,
literal|1425894220
block|,
literal|702947816
block|,
literal|2006889048
block|,
literal|1999607995
block|,
literal|1346414687
block|,
literal|399640789
block|,
literal|1482689501
block|,
literal|1790064052
block|,
literal|1128943628
block|,
literal|1269197405
block|,
literal|587262386
block|,
literal|2078054746
block|,
literal|1675409928
block|,
literal|1652325524
block|,
literal|1643525825
block|,
literal|1748690540
block|,
literal|292465849
block|,
literal|1370173174
block|,
literal|402865384
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ran_j
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|ran_k
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * ranp2 - return a random integer in the range 0 .. (1<< m) - 1  */
end_comment

begin_function
name|u_long
name|ranp2
parameter_list|(
name|int
name|m
parameter_list|)
block|{
name|time_t
name|r
decl_stmt|;
name|ran_y
index|[
name|ran_k
index|]
operator|+=
name|ran_y
index|[
name|ran_j
index|]
expr_stmt|;
comment|/* overflow does a mod */
name|r
operator|=
name|ran_y
index|[
name|ran_k
index|]
expr_stmt|;
if|if
condition|(
name|ran_k
operator|--
operator|==
literal|0
condition|)
name|ran_k
operator|=
literal|54
expr_stmt|;
if|if
condition|(
name|ran_j
operator|--
operator|==
literal|0
condition|)
name|ran_j
operator|=
literal|54
expr_stmt|;
return|return
call|(
name|u_long
call|)
argument_list|(
name|r
operator|&
operator|(
operator|(
literal|1
operator|<<
name|m
operator|)
operator|-
literal|1
operator|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * init_random - do initialization of random number routine  */
end_comment

begin_function
name|void
name|init_random
parameter_list|(
name|void
parameter_list|)
block|{
specifier|register
name|int
name|i
decl_stmt|;
specifier|register
name|time_t
name|now
decl_stmt|;
name|ran_j
operator|=
literal|23
expr_stmt|;
name|ran_k
operator|=
literal|54
expr_stmt|;
comment|/* 	 * Randomize the seed array some more.  The time of day 	 * should be initialized by now. 	 */
name|now
operator|=
name|time
argument_list|(
operator|(
name|time_t
operator|*
operator|)
literal|0
argument_list|)
operator||
literal|01
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|55
condition|;
operator|++
name|i
control|)
name|ran_y
index|[
name|i
index|]
operator|=
name|now
operator|*
name|init_ran_y
index|[
name|i
index|]
expr_stmt|;
comment|/* overflow does a mod */
block|}
end_function

end_unit

