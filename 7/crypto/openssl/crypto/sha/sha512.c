begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* crypto/sha/sha512.c */
end_comment

begin_comment
comment|/* ====================================================================  * Copyright (c) 2004 The OpenSSL Project.  All rights reserved  * according to the OpenSSL license [found in ../../LICENSE].  * ====================================================================  */
end_comment

begin_include
include|#
directive|include
file|<openssl/opensslconf.h>
end_include

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_SHA
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_SHA512
argument_list|)
end_if

begin_comment
comment|/*  * IMPLEMENTATION NOTES.  *  * As you might have noticed 32-bit hash algorithms:  *  * - permit SHA_LONG to be wider than 32-bit (case on CRAY);  * - optimized versions implement two transform functions: one operating  *   on [aligned] data in host byte order and one - on data in input  *   stream byte order;  * - share common byte-order neutral collector and padding function  *   implementations, ../md32_common.h;  *  * Neither of the above applies to this SHA-512 implementations. Reasons  * [in reverse order] are:  *  * - it's the only 64-bit hash algorithm for the moment of this writing,  *   there is no need for common collector/padding implementation [yet];  * - by supporting only one transform function [which operates on  *   *aligned* data in input stream byte order, big-endian in this case]  *   we minimize burden of maintenance in two ways: a) collector/padding  *   function is simpler; b) only one transform function to stare at;  * - SHA_LONG64 is required to be exactly 64-bit in order to be able to  *   apply a number of optimizations to mitigate potential performance  *   penalties caused by previous design decision;  *  * Caveat lector.  *  * Implementation relies on the fact that "long long" is 64-bit on  * both 32- and 64-bit platforms. If some compiler vendor comes up  * with 128-bit long long, adjustment to sha.h would be required.  * As this implementation relies on 64-bit integer type, it's totally  * inappropriate for platforms which don't support it, most notably  * 16-bit platforms.  *<appro@fy.chalmers.se>  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<openssl/crypto.h>
end_include

begin_include
include|#
directive|include
file|<openssl/sha.h>
end_include

begin_include
include|#
directive|include
file|<openssl/opensslv.h>
end_include

begin_include
include|#
directive|include
file|"cryptlib.h"
end_include

begin_decl_stmt
specifier|const
name|char
name|SHA512_version
index|[]
init|=
literal|"SHA-512"
name|OPENSSL_VERSION_PTEXT
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
name|defined
argument_list|(
name|_M_IX86
argument_list|)
operator|||
name|defined
argument_list|(
name|_M_AMD64
argument_list|)
operator|||
name|defined
argument_list|(
name|__i386
argument_list|)
operator|||
name|defined
argument_list|(
name|__x86_64
argument_list|)
end_if

begin_define
define|#
directive|define
name|SHA512_BLOCK_CAN_MANAGE_UNALIGNED_DATA
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
name|int
name|SHA384_Init
parameter_list|(
name|SHA512_CTX
modifier|*
name|c
parameter_list|)
block|{
name|c
operator|->
name|h
index|[
literal|0
index|]
operator|=
name|U64
argument_list|(
literal|0xcbbb9d5dc1059ed8
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|1
index|]
operator|=
name|U64
argument_list|(
literal|0x629a292a367cd507
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|2
index|]
operator|=
name|U64
argument_list|(
literal|0x9159015a3070dd17
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|3
index|]
operator|=
name|U64
argument_list|(
literal|0x152fecd8f70e5939
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|4
index|]
operator|=
name|U64
argument_list|(
literal|0x67332667ffc00b31
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|5
index|]
operator|=
name|U64
argument_list|(
literal|0x8eb44a8768581511
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|6
index|]
operator|=
name|U64
argument_list|(
literal|0xdb0c2e0d64f98fa7
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|7
index|]
operator|=
name|U64
argument_list|(
literal|0x47b5481dbefa4fa4
argument_list|)
expr_stmt|;
name|c
operator|->
name|Nl
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|Nh
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|num
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|md_len
operator|=
name|SHA384_DIGEST_LENGTH
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|SHA512_Init
parameter_list|(
name|SHA512_CTX
modifier|*
name|c
parameter_list|)
block|{
name|c
operator|->
name|h
index|[
literal|0
index|]
operator|=
name|U64
argument_list|(
literal|0x6a09e667f3bcc908
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|1
index|]
operator|=
name|U64
argument_list|(
literal|0xbb67ae8584caa73b
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|2
index|]
operator|=
name|U64
argument_list|(
literal|0x3c6ef372fe94f82b
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|3
index|]
operator|=
name|U64
argument_list|(
literal|0xa54ff53a5f1d36f1
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|4
index|]
operator|=
name|U64
argument_list|(
literal|0x510e527fade682d1
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|5
index|]
operator|=
name|U64
argument_list|(
literal|0x9b05688c2b3e6c1f
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|6
index|]
operator|=
name|U64
argument_list|(
literal|0x1f83d9abfb41bd6b
argument_list|)
expr_stmt|;
name|c
operator|->
name|h
index|[
literal|7
index|]
operator|=
name|U64
argument_list|(
literal|0x5be0cd19137e2179
argument_list|)
expr_stmt|;
name|c
operator|->
name|Nl
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|Nh
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|num
operator|=
literal|0
expr_stmt|;
name|c
operator|->
name|md_len
operator|=
name|SHA512_DIGEST_LENGTH
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|SHA512_ASM
end_ifndef

begin_function_decl
specifier|static
endif|#
directive|endif
name|void
name|sha512_block
parameter_list|(
name|SHA512_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|int
name|SHA512_Final
parameter_list|(
name|unsigned
name|char
modifier|*
name|md
parameter_list|,
name|SHA512_CTX
modifier|*
name|c
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|p
init|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|c
operator|->
name|u
operator|.
name|p
decl_stmt|;
name|size_t
name|n
init|=
name|c
operator|->
name|num
decl_stmt|;
name|p
index|[
name|n
index|]
operator|=
literal|0x80
expr_stmt|;
comment|/* There always is a room for one */
name|n
operator|++
expr_stmt|;
if|if
condition|(
name|n
operator|>
operator|(
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|16
operator|)
condition|)
name|memset
argument_list|(
name|p
operator|+
name|n
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
name|n
argument_list|)
operator|,
name|n
operator|=
literal|0
operator|,
name|sha512_block
argument_list|(
name|c
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|p
operator|+
name|n
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|16
operator|-
name|n
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|B_ENDIAN
name|c
operator|->
name|u
operator|.
name|d
index|[
name|SHA_LBLOCK
operator|-
literal|2
index|]
operator|=
name|c
operator|->
name|Nh
expr_stmt|;
name|c
operator|->
name|u
operator|.
name|d
index|[
name|SHA_LBLOCK
operator|-
literal|1
index|]
operator|=
name|c
operator|->
name|Nl
expr_stmt|;
else|#
directive|else
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|1
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|2
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|3
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|4
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|5
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|32
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|6
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|40
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|7
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|48
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|8
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nl
operator|>>
literal|56
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|9
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|10
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|11
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|12
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|13
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|32
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|14
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|40
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|15
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|48
argument_list|)
expr_stmt|;
name|p
index|[
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
literal|16
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|c
operator|->
name|Nh
operator|>>
literal|56
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|sha512_block
argument_list|(
name|c
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|md
operator|==
literal|0
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|c
operator|->
name|md_len
condition|)
block|{
comment|/* Let compiler decide if it's appropriate to unroll... */
case|case
name|SHA384_DIGEST_LENGTH
case|:
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|SHA384_DIGEST_LENGTH
operator|/
literal|8
condition|;
name|n
operator|++
control|)
block|{
name|SHA_LONG64
name|t
init|=
name|c
operator|->
name|h
index|[
name|n
index|]
decl_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|56
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|48
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|40
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|32
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|24
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|16
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SHA512_DIGEST_LENGTH
case|:
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|SHA512_DIGEST_LENGTH
operator|/
literal|8
condition|;
name|n
operator|++
control|)
block|{
name|SHA_LONG64
name|t
init|=
name|c
operator|->
name|h
index|[
name|n
index|]
decl_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|56
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|48
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|40
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|32
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|24
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|16
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|md
operator|++
operator|)
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
break|break;
comment|/* ... as well as make sure md_len is not abused. */
default|default:
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|SHA384_Final
parameter_list|(
name|unsigned
name|char
modifier|*
name|md
parameter_list|,
name|SHA512_CTX
modifier|*
name|c
parameter_list|)
block|{
return|return
name|SHA512_Final
argument_list|(
name|md
argument_list|,
name|c
argument_list|)
return|;
block|}
end_function

begin_function
name|int
name|SHA512_Update
parameter_list|(
name|SHA512_CTX
modifier|*
name|c
parameter_list|,
specifier|const
name|void
modifier|*
name|_data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
name|SHA_LONG64
name|l
decl_stmt|;
name|unsigned
name|char
modifier|*
name|p
init|=
name|c
operator|->
name|u
operator|.
name|p
decl_stmt|;
specifier|const
name|unsigned
name|char
modifier|*
name|data
init|=
operator|(
specifier|const
name|unsigned
name|char
operator|*
operator|)
name|_data
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
return|return
literal|1
return|;
name|l
operator|=
operator|(
name|c
operator|->
name|Nl
operator|+
operator|(
operator|(
operator|(
name|SHA_LONG64
operator|)
name|len
operator|)
operator|<<
literal|3
operator|)
operator|)
operator|&
name|U64
argument_list|(
literal|0xffffffffffffffff
argument_list|)
expr_stmt|;
if|if
condition|(
name|l
operator|<
name|c
operator|->
name|Nl
condition|)
name|c
operator|->
name|Nh
operator|++
expr_stmt|;
if|if
condition|(
sizeof|sizeof
argument_list|(
name|len
argument_list|)
operator|>=
literal|8
condition|)
name|c
operator|->
name|Nh
operator|+=
operator|(
operator|(
operator|(
name|SHA_LONG64
operator|)
name|len
operator|)
operator|>>
literal|61
operator|)
expr_stmt|;
name|c
operator|->
name|Nl
operator|=
name|l
expr_stmt|;
if|if
condition|(
name|c
operator|->
name|num
operator|!=
literal|0
condition|)
block|{
name|size_t
name|n
init|=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|-
name|c
operator|->
name|num
decl_stmt|;
if|if
condition|(
name|len
operator|<
name|n
condition|)
block|{
name|memcpy
argument_list|(
name|p
operator|+
name|c
operator|->
name|num
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
operator|,
name|c
operator|->
name|num
operator|+=
name|len
expr_stmt|;
return|return
literal|1
return|;
block|}
else|else
block|{
name|memcpy
argument_list|(
name|p
operator|+
name|c
operator|->
name|num
argument_list|,
name|data
argument_list|,
name|n
argument_list|)
operator|,
name|c
operator|->
name|num
operator|=
literal|0
expr_stmt|;
name|len
operator|-=
name|n
operator|,
name|data
operator|+=
name|n
expr_stmt|;
name|sha512_block
argument_list|(
name|c
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|len
operator|>=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
condition|)
block|{
ifndef|#
directive|ifndef
name|SHA512_BLOCK_CAN_MANAGE_UNALIGNED_DATA
if|if
condition|(
operator|(
name|size_t
operator|)
name|data
operator|%
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
operator|.
name|d
index|[
literal|0
index|]
argument_list|)
operator|!=
literal|0
condition|)
while|while
condition|(
name|len
operator|>=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
condition|)
name|memcpy
argument_list|(
name|p
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
argument_list|)
operator|,
name|sha512_block
argument_list|(
name|c
argument_list|,
name|p
argument_list|,
literal|1
argument_list|)
operator|,
name|len
operator|-=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|,
name|data
operator|+=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
name|sha512_block
argument_list|(
name|c
argument_list|,
name|data
argument_list|,
name|len
operator|/
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
argument_list|)
operator|,
name|data
operator|+=
name|len
operator|,
name|len
operator|%=
sizeof|sizeof
argument_list|(
name|c
operator|->
name|u
argument_list|)
operator|,
name|data
operator|-=
name|len
expr_stmt|;
block|}
if|if
condition|(
name|len
operator|!=
literal|0
condition|)
name|memcpy
argument_list|(
name|p
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
operator|,
name|c
operator|->
name|num
operator|=
operator|(
name|int
operator|)
name|len
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
name|int
name|SHA384_Update
parameter_list|(
name|SHA512_CTX
modifier|*
name|c
parameter_list|,
specifier|const
name|void
modifier|*
name|data
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
return|return
name|SHA512_Update
argument_list|(
name|c
argument_list|,
name|data
argument_list|,
name|len
argument_list|)
return|;
block|}
end_function

begin_function
name|void
name|SHA512_Transform
parameter_list|(
name|SHA512_CTX
modifier|*
name|c
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|data
parameter_list|)
block|{
name|sha512_block
argument_list|(
name|c
argument_list|,
name|data
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|unsigned
name|char
modifier|*
name|SHA384
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|d
parameter_list|,
name|size_t
name|n
parameter_list|,
name|unsigned
name|char
modifier|*
name|md
parameter_list|)
block|{
name|SHA512_CTX
name|c
decl_stmt|;
specifier|static
name|unsigned
name|char
name|m
index|[
name|SHA384_DIGEST_LENGTH
index|]
decl_stmt|;
if|if
condition|(
name|md
operator|==
name|NULL
condition|)
name|md
operator|=
name|m
expr_stmt|;
name|SHA384_Init
argument_list|(
operator|&
name|c
argument_list|)
expr_stmt|;
name|SHA512_Update
argument_list|(
operator|&
name|c
argument_list|,
name|d
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|SHA512_Final
argument_list|(
name|md
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
operator|&
name|c
argument_list|,
sizeof|sizeof
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|md
operator|)
return|;
block|}
end_function

begin_function
name|unsigned
name|char
modifier|*
name|SHA512
parameter_list|(
specifier|const
name|unsigned
name|char
modifier|*
name|d
parameter_list|,
name|size_t
name|n
parameter_list|,
name|unsigned
name|char
modifier|*
name|md
parameter_list|)
block|{
name|SHA512_CTX
name|c
decl_stmt|;
specifier|static
name|unsigned
name|char
name|m
index|[
name|SHA512_DIGEST_LENGTH
index|]
decl_stmt|;
if|if
condition|(
name|md
operator|==
name|NULL
condition|)
name|md
operator|=
name|m
expr_stmt|;
name|SHA512_Init
argument_list|(
operator|&
name|c
argument_list|)
expr_stmt|;
name|SHA512_Update
argument_list|(
operator|&
name|c
argument_list|,
name|d
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|SHA512_Final
argument_list|(
name|md
argument_list|,
operator|&
name|c
argument_list|)
expr_stmt|;
name|OPENSSL_cleanse
argument_list|(
operator|&
name|c
argument_list|,
sizeof|sizeof
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|md
operator|)
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|SHA512_ASM
end_ifndef

begin_decl_stmt
specifier|static
specifier|const
name|SHA_LONG64
name|K512
index|[
literal|80
index|]
init|=
block|{
name|U64
argument_list|(
literal|0x428a2f98d728ae22
argument_list|)
block|,
name|U64
argument_list|(
literal|0x7137449123ef65cd
argument_list|)
block|,
name|U64
argument_list|(
literal|0xb5c0fbcfec4d3b2f
argument_list|)
block|,
name|U64
argument_list|(
literal|0xe9b5dba58189dbbc
argument_list|)
block|,
name|U64
argument_list|(
literal|0x3956c25bf348b538
argument_list|)
block|,
name|U64
argument_list|(
literal|0x59f111f1b605d019
argument_list|)
block|,
name|U64
argument_list|(
literal|0x923f82a4af194f9b
argument_list|)
block|,
name|U64
argument_list|(
literal|0xab1c5ed5da6d8118
argument_list|)
block|,
name|U64
argument_list|(
literal|0xd807aa98a3030242
argument_list|)
block|,
name|U64
argument_list|(
literal|0x12835b0145706fbe
argument_list|)
block|,
name|U64
argument_list|(
literal|0x243185be4ee4b28c
argument_list|)
block|,
name|U64
argument_list|(
literal|0x550c7dc3d5ffb4e2
argument_list|)
block|,
name|U64
argument_list|(
literal|0x72be5d74f27b896f
argument_list|)
block|,
name|U64
argument_list|(
literal|0x80deb1fe3b1696b1
argument_list|)
block|,
name|U64
argument_list|(
literal|0x9bdc06a725c71235
argument_list|)
block|,
name|U64
argument_list|(
literal|0xc19bf174cf692694
argument_list|)
block|,
name|U64
argument_list|(
literal|0xe49b69c19ef14ad2
argument_list|)
block|,
name|U64
argument_list|(
literal|0xefbe4786384f25e3
argument_list|)
block|,
name|U64
argument_list|(
literal|0x0fc19dc68b8cd5b5
argument_list|)
block|,
name|U64
argument_list|(
literal|0x240ca1cc77ac9c65
argument_list|)
block|,
name|U64
argument_list|(
literal|0x2de92c6f592b0275
argument_list|)
block|,
name|U64
argument_list|(
literal|0x4a7484aa6ea6e483
argument_list|)
block|,
name|U64
argument_list|(
literal|0x5cb0a9dcbd41fbd4
argument_list|)
block|,
name|U64
argument_list|(
literal|0x76f988da831153b5
argument_list|)
block|,
name|U64
argument_list|(
literal|0x983e5152ee66dfab
argument_list|)
block|,
name|U64
argument_list|(
literal|0xa831c66d2db43210
argument_list|)
block|,
name|U64
argument_list|(
literal|0xb00327c898fb213f
argument_list|)
block|,
name|U64
argument_list|(
literal|0xbf597fc7beef0ee4
argument_list|)
block|,
name|U64
argument_list|(
literal|0xc6e00bf33da88fc2
argument_list|)
block|,
name|U64
argument_list|(
literal|0xd5a79147930aa725
argument_list|)
block|,
name|U64
argument_list|(
literal|0x06ca6351e003826f
argument_list|)
block|,
name|U64
argument_list|(
literal|0x142929670a0e6e70
argument_list|)
block|,
name|U64
argument_list|(
literal|0x27b70a8546d22ffc
argument_list|)
block|,
name|U64
argument_list|(
literal|0x2e1b21385c26c926
argument_list|)
block|,
name|U64
argument_list|(
literal|0x4d2c6dfc5ac42aed
argument_list|)
block|,
name|U64
argument_list|(
literal|0x53380d139d95b3df
argument_list|)
block|,
name|U64
argument_list|(
literal|0x650a73548baf63de
argument_list|)
block|,
name|U64
argument_list|(
literal|0x766a0abb3c77b2a8
argument_list|)
block|,
name|U64
argument_list|(
literal|0x81c2c92e47edaee6
argument_list|)
block|,
name|U64
argument_list|(
literal|0x92722c851482353b
argument_list|)
block|,
name|U64
argument_list|(
literal|0xa2bfe8a14cf10364
argument_list|)
block|,
name|U64
argument_list|(
literal|0xa81a664bbc423001
argument_list|)
block|,
name|U64
argument_list|(
literal|0xc24b8b70d0f89791
argument_list|)
block|,
name|U64
argument_list|(
literal|0xc76c51a30654be30
argument_list|)
block|,
name|U64
argument_list|(
literal|0xd192e819d6ef5218
argument_list|)
block|,
name|U64
argument_list|(
literal|0xd69906245565a910
argument_list|)
block|,
name|U64
argument_list|(
literal|0xf40e35855771202a
argument_list|)
block|,
name|U64
argument_list|(
literal|0x106aa07032bbd1b8
argument_list|)
block|,
name|U64
argument_list|(
literal|0x19a4c116b8d2d0c8
argument_list|)
block|,
name|U64
argument_list|(
literal|0x1e376c085141ab53
argument_list|)
block|,
name|U64
argument_list|(
literal|0x2748774cdf8eeb99
argument_list|)
block|,
name|U64
argument_list|(
literal|0x34b0bcb5e19b48a8
argument_list|)
block|,
name|U64
argument_list|(
literal|0x391c0cb3c5c95a63
argument_list|)
block|,
name|U64
argument_list|(
literal|0x4ed8aa4ae3418acb
argument_list|)
block|,
name|U64
argument_list|(
literal|0x5b9cca4f7763e373
argument_list|)
block|,
name|U64
argument_list|(
literal|0x682e6ff3d6b2b8a3
argument_list|)
block|,
name|U64
argument_list|(
literal|0x748f82ee5defb2fc
argument_list|)
block|,
name|U64
argument_list|(
literal|0x78a5636f43172f60
argument_list|)
block|,
name|U64
argument_list|(
literal|0x84c87814a1f0ab72
argument_list|)
block|,
name|U64
argument_list|(
literal|0x8cc702081a6439ec
argument_list|)
block|,
name|U64
argument_list|(
literal|0x90befffa23631e28
argument_list|)
block|,
name|U64
argument_list|(
literal|0xa4506cebde82bde9
argument_list|)
block|,
name|U64
argument_list|(
literal|0xbef9a3f7b2c67915
argument_list|)
block|,
name|U64
argument_list|(
literal|0xc67178f2e372532b
argument_list|)
block|,
name|U64
argument_list|(
literal|0xca273eceea26619c
argument_list|)
block|,
name|U64
argument_list|(
literal|0xd186b8c721c0c207
argument_list|)
block|,
name|U64
argument_list|(
literal|0xeada7dd6cde0eb1e
argument_list|)
block|,
name|U64
argument_list|(
literal|0xf57d4f7fee6ed178
argument_list|)
block|,
name|U64
argument_list|(
literal|0x06f067aa72176fba
argument_list|)
block|,
name|U64
argument_list|(
literal|0x0a637dc5a2c898a6
argument_list|)
block|,
name|U64
argument_list|(
literal|0x113f9804bef90dae
argument_list|)
block|,
name|U64
argument_list|(
literal|0x1b710b35131c471b
argument_list|)
block|,
name|U64
argument_list|(
literal|0x28db77f523047d84
argument_list|)
block|,
name|U64
argument_list|(
literal|0x32caab7b40c72493
argument_list|)
block|,
name|U64
argument_list|(
literal|0x3c9ebe0a15c9bebc
argument_list|)
block|,
name|U64
argument_list|(
literal|0x431d67c49c100d4c
argument_list|)
block|,
name|U64
argument_list|(
literal|0x4cc5d4becb3e42b6
argument_list|)
block|,
name|U64
argument_list|(
literal|0x597f299cfc657e2a
argument_list|)
block|,
name|U64
argument_list|(
literal|0x5fcb6fab3ad6faec
argument_list|)
block|,
name|U64
argument_list|(
literal|0x6c44198c4a475817
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|PEDANTIC
end_ifndef

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__GNUC__
argument_list|)
operator|&&
name|__GNUC__
operator|>=
literal|2
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_ASM
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_INLINE_ASM
argument_list|)
end_if

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__x86_64
argument_list|)
operator|||
name|defined
argument_list|(
name|__x86_64__
argument_list|)
end_if

begin_define
define|#
directive|define
name|PULL64
parameter_list|(
name|x
parameter_list|)
value|({ SHA_LONG64 ret=*((const SHA_LONG64 *)(&(x)));	\ 				asm ("bswapq	%0"		\ 				: "=r"(ret)			\ 				: "0"(ret)); ret;		})
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|PULL64
end_ifndef

begin_define
define|#
directive|define
name|B
parameter_list|(
name|x
parameter_list|,
name|j
parameter_list|)
value|(((SHA_LONG64)(*(((const unsigned char *)(&x))+j)))<<((7-j)*8))
end_define

begin_define
define|#
directive|define
name|PULL64
parameter_list|(
name|x
parameter_list|)
value|(B(x,0)|B(x,1)|B(x,2)|B(x,3)|B(x,4)|B(x,5)|B(x,6)|B(x,7))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|PEDANTIC
end_ifndef

begin_if
if|#
directive|if
name|defined
argument_list|(
name|_MSC_VER
argument_list|)
end_if

begin_if
if|#
directive|if
name|defined
argument_list|(
name|_WIN64
argument_list|)
end_if

begin_comment
comment|/* applies to both IA-64 and AMD64 */
end_comment

begin_define
define|#
directive|define
name|ROTR
parameter_list|(
name|a
parameter_list|,
name|n
parameter_list|)
value|_rotr64((a),n)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|__GNUC__
argument_list|)
operator|&&
name|__GNUC__
operator|>=
literal|2
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_ASM
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_INLINE_ASM
argument_list|)
end_elif

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__x86_64
argument_list|)
operator|||
name|defined
argument_list|(
name|__x86_64__
argument_list|)
end_if

begin_define
define|#
directive|define
name|ROTR
parameter_list|(
name|a
parameter_list|,
name|n
parameter_list|)
value|({ unsigned long ret;		\ 				asm ("rorq %1,%0"	\ 				: "=r"(ret)		\ 				: "J"(n),"0"(a)		\ 				: "cc"); ret;		})
end_define

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|_ARCH_PPC
argument_list|)
operator|&&
name|defined
argument_list|(
name|__64BIT__
argument_list|)
end_elif

begin_define
define|#
directive|define
name|ROTR
parameter_list|(
name|a
parameter_list|,
name|n
parameter_list|)
value|({ unsigned long ret;		\ 				asm ("rotrdi %0,%1,%2"	\ 				: "=r"(ret)		\ 				: "r"(a),"K"(n)); ret;	})
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|ROTR
end_ifndef

begin_define
define|#
directive|define
name|ROTR
parameter_list|(
name|x
parameter_list|,
name|s
parameter_list|)
value|(((x)>>s) | (x)<<(64-s))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|Sigma0
parameter_list|(
name|x
parameter_list|)
value|(ROTR((x),28) ^ ROTR((x),34) ^ ROTR((x),39))
end_define

begin_define
define|#
directive|define
name|Sigma1
parameter_list|(
name|x
parameter_list|)
value|(ROTR((x),14) ^ ROTR((x),18) ^ ROTR((x),41))
end_define

begin_define
define|#
directive|define
name|sigma0
parameter_list|(
name|x
parameter_list|)
value|(ROTR((x),1)  ^ ROTR((x),8)  ^ ((x)>>7))
end_define

begin_define
define|#
directive|define
name|sigma1
parameter_list|(
name|x
parameter_list|)
value|(ROTR((x),19) ^ ROTR((x),61) ^ ((x)>>6))
end_define

begin_define
define|#
directive|define
name|Ch
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|)
value|(((x)& (y)) ^ ((~(x))& (z)))
end_define

begin_define
define|#
directive|define
name|Maj
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|,
name|z
parameter_list|)
value|(((x)& (y)) ^ ((x)& (z)) ^ ((y)& (z)))
end_define

begin_if
if|#
directive|if
name|defined
argument_list|(
name|OPENSSL_IA32_SSE2
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|OPENSSL_NO_ASM
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|I386_ONLY
argument_list|)
end_if

begin_define
define|#
directive|define
name|GO_FOR_SSE2
parameter_list|(
name|ctx
parameter_list|,
name|in
parameter_list|,
name|num
parameter_list|)
value|do {		\ 	void	sha512_block_sse2(void *,const void *,size_t);	\ 	if (!(OPENSSL_ia32cap_P& (1<<26))) break;	\ 	sha512_block_sse2(ctx->h,in,num); return;	\ 					} while (0)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|OPENSSL_SMALL_FOOTPRINT
end_ifdef

begin_function
specifier|static
name|void
name|sha512_block
parameter_list|(
name|SHA512_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
block|{
specifier|const
name|SHA_LONG64
modifier|*
name|W
init|=
name|in
decl_stmt|;
name|SHA_LONG64
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|,
name|g
decl_stmt|,
name|h
decl_stmt|,
name|s0
decl_stmt|,
name|s1
decl_stmt|,
name|T1
decl_stmt|,
name|T2
decl_stmt|;
name|SHA_LONG64
name|X
index|[
literal|16
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
ifdef|#
directive|ifdef
name|GO_FOR_SSE2
name|GO_FOR_SSE2
argument_list|(
name|ctx
argument_list|,
name|in
argument_list|,
name|num
argument_list|)
expr_stmt|;
endif|#
directive|endif
while|while
condition|(
name|num
operator|--
condition|)
block|{
name|a
operator|=
name|ctx
operator|->
name|h
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|ctx
operator|->
name|h
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|ctx
operator|->
name|h
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|ctx
operator|->
name|h
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|ctx
operator|->
name|h
index|[
literal|4
index|]
expr_stmt|;
name|f
operator|=
name|ctx
operator|->
name|h
index|[
literal|5
index|]
expr_stmt|;
name|g
operator|=
name|ctx
operator|->
name|h
index|[
literal|6
index|]
expr_stmt|;
name|h
operator|=
name|ctx
operator|->
name|h
index|[
literal|7
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|16
condition|;
name|i
operator|++
control|)
block|{
ifdef|#
directive|ifdef
name|B_ENDIAN
name|T1
operator|=
name|X
index|[
name|i
index|]
operator|=
name|W
index|[
name|i
index|]
expr_stmt|;
else|#
directive|else
name|T1
operator|=
name|X
index|[
name|i
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
name|i
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|T1
operator|+=
name|h
operator|+
name|Sigma1
argument_list|(
name|e
argument_list|)
operator|+
name|Ch
argument_list|(
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
operator|+
name|K512
index|[
name|i
index|]
expr_stmt|;
name|T2
operator|=
name|Sigma0
argument_list|(
name|a
argument_list|)
operator|+
name|Maj
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|h
operator|=
name|g
expr_stmt|;
name|g
operator|=
name|f
expr_stmt|;
name|f
operator|=
name|e
expr_stmt|;
name|e
operator|=
name|d
operator|+
name|T1
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|b
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|T1
operator|+
name|T2
expr_stmt|;
block|}
for|for
control|(
init|;
name|i
operator|<
literal|80
condition|;
name|i
operator|++
control|)
block|{
name|s0
operator|=
name|X
index|[
operator|(
name|i
operator|+
literal|1
operator|)
operator|&
literal|0x0f
index|]
expr_stmt|;
name|s0
operator|=
name|sigma0
argument_list|(
name|s0
argument_list|)
expr_stmt|;
name|s1
operator|=
name|X
index|[
operator|(
name|i
operator|+
literal|14
operator|)
operator|&
literal|0x0f
index|]
expr_stmt|;
name|s1
operator|=
name|sigma1
argument_list|(
name|s1
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
name|i
operator|&
literal|0xf
index|]
operator|+=
name|s0
operator|+
name|s1
operator|+
name|X
index|[
operator|(
name|i
operator|+
literal|9
operator|)
operator|&
literal|0xf
index|]
expr_stmt|;
name|T1
operator|+=
name|h
operator|+
name|Sigma1
argument_list|(
name|e
argument_list|)
operator|+
name|Ch
argument_list|(
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
operator|+
name|K512
index|[
name|i
index|]
expr_stmt|;
name|T2
operator|=
name|Sigma0
argument_list|(
name|a
argument_list|)
operator|+
name|Maj
argument_list|(
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|h
operator|=
name|g
expr_stmt|;
name|g
operator|=
name|f
expr_stmt|;
name|f
operator|=
name|e
expr_stmt|;
name|e
operator|=
name|d
operator|+
name|T1
expr_stmt|;
name|d
operator|=
name|c
expr_stmt|;
name|c
operator|=
name|b
expr_stmt|;
name|b
operator|=
name|a
expr_stmt|;
name|a
operator|=
name|T1
operator|+
name|T2
expr_stmt|;
block|}
name|ctx
operator|->
name|h
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|5
index|]
operator|+=
name|f
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|6
index|]
operator|+=
name|g
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|7
index|]
operator|+=
name|h
expr_stmt|;
name|W
operator|+=
name|SHA_LBLOCK
expr_stmt|;
block|}
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_define
define|#
directive|define
name|ROUND_00_15
parameter_list|(
name|i
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|,
name|e
parameter_list|,
name|f
parameter_list|,
name|g
parameter_list|,
name|h
parameter_list|)
value|do {	\ 	T1 += h + Sigma1(e) + Ch(e,f,g) + K512[i];	\ 	h = Sigma0(a) + Maj(a,b,c);			\ 	d += T1;	h += T1;		} while (0)
end_define

begin_define
define|#
directive|define
name|ROUND_16_80
parameter_list|(
name|i
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|,
name|c
parameter_list|,
name|d
parameter_list|,
name|e
parameter_list|,
name|f
parameter_list|,
name|g
parameter_list|,
name|h
parameter_list|,
name|X
parameter_list|)
value|do {	\ 	s0 = X[(i+1)&0x0f];	s0 = sigma0(s0);	\ 	s1 = X[(i+14)&0x0f];	s1 = sigma1(s1);	\ 	T1 = X[(i)&0x0f] += s0 + s1 + X[(i+9)&0x0f];	\ 	ROUND_00_15(i,a,b,c,d,e,f,g,h);		} while (0)
end_define

begin_function
specifier|static
name|void
name|sha512_block
parameter_list|(
name|SHA512_CTX
modifier|*
name|ctx
parameter_list|,
specifier|const
name|void
modifier|*
name|in
parameter_list|,
name|size_t
name|num
parameter_list|)
block|{
specifier|const
name|SHA_LONG64
modifier|*
name|W
init|=
name|in
decl_stmt|;
name|SHA_LONG64
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|f
decl_stmt|,
name|g
decl_stmt|,
name|h
decl_stmt|,
name|s0
decl_stmt|,
name|s1
decl_stmt|,
name|T1
decl_stmt|;
name|SHA_LONG64
name|X
index|[
literal|16
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
ifdef|#
directive|ifdef
name|GO_FOR_SSE2
name|GO_FOR_SSE2
argument_list|(
name|ctx
argument_list|,
name|in
argument_list|,
name|num
argument_list|)
expr_stmt|;
endif|#
directive|endif
while|while
condition|(
name|num
operator|--
condition|)
block|{
name|a
operator|=
name|ctx
operator|->
name|h
index|[
literal|0
index|]
expr_stmt|;
name|b
operator|=
name|ctx
operator|->
name|h
index|[
literal|1
index|]
expr_stmt|;
name|c
operator|=
name|ctx
operator|->
name|h
index|[
literal|2
index|]
expr_stmt|;
name|d
operator|=
name|ctx
operator|->
name|h
index|[
literal|3
index|]
expr_stmt|;
name|e
operator|=
name|ctx
operator|->
name|h
index|[
literal|4
index|]
expr_stmt|;
name|f
operator|=
name|ctx
operator|->
name|h
index|[
literal|5
index|]
expr_stmt|;
name|g
operator|=
name|ctx
operator|->
name|h
index|[
literal|6
index|]
expr_stmt|;
name|h
operator|=
name|ctx
operator|->
name|h
index|[
literal|7
index|]
expr_stmt|;
ifdef|#
directive|ifdef
name|B_ENDIAN
name|T1
operator|=
name|X
index|[
literal|0
index|]
operator|=
name|W
index|[
literal|0
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|1
index|]
operator|=
name|W
index|[
literal|1
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|2
index|]
operator|=
name|W
index|[
literal|2
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|3
index|]
operator|=
name|W
index|[
literal|3
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|4
index|]
operator|=
name|W
index|[
literal|4
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|5
index|]
operator|=
name|W
index|[
literal|5
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|6
index|]
operator|=
name|W
index|[
literal|6
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|7
index|]
operator|=
name|W
index|[
literal|7
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|8
index|]
operator|=
name|W
index|[
literal|8
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|8
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|9
index|]
operator|=
name|W
index|[
literal|9
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|9
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|10
index|]
operator|=
name|W
index|[
literal|10
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|10
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|11
index|]
operator|=
name|W
index|[
literal|11
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|11
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|12
index|]
operator|=
name|W
index|[
literal|12
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|12
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|13
index|]
operator|=
name|W
index|[
literal|13
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|13
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|14
index|]
operator|=
name|W
index|[
literal|14
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|14
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|15
index|]
operator|=
name|W
index|[
literal|15
index|]
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|15
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
else|#
directive|else
name|T1
operator|=
name|X
index|[
literal|0
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|1
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|2
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|3
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|4
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|5
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|5
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|6
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|6
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|7
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|8
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|8
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|8
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|9
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|9
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|10
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|10
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|10
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|11
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|11
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|12
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|12
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|12
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|13
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|13
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|13
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|14
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|14
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|14
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|T1
operator|=
name|X
index|[
literal|15
index|]
operator|=
name|PULL64
argument_list|(
name|W
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|ROUND_00_15
argument_list|(
literal|15
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|)
expr_stmt|;
endif|#
directive|endif
for|for
control|(
name|i
operator|=
literal|16
init|;
name|i
operator|<
literal|80
condition|;
name|i
operator|+=
literal|8
control|)
block|{
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|0
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|1
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|2
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|3
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|4
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|5
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|6
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|X
argument_list|)
expr_stmt|;
name|ROUND_16_80
argument_list|(
name|i
operator|+
literal|7
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|,
name|e
argument_list|,
name|f
argument_list|,
name|g
argument_list|,
name|h
argument_list|,
name|a
argument_list|,
name|X
argument_list|)
expr_stmt|;
block|}
name|ctx
operator|->
name|h
index|[
literal|0
index|]
operator|+=
name|a
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|1
index|]
operator|+=
name|b
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|2
index|]
operator|+=
name|c
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|3
index|]
operator|+=
name|d
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|4
index|]
operator|+=
name|e
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|5
index|]
operator|+=
name|f
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|6
index|]
operator|+=
name|g
expr_stmt|;
name|ctx
operator|->
name|h
index|[
literal|7
index|]
operator|+=
name|h
expr_stmt|;
name|W
operator|+=
name|SHA_LBLOCK
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* SHA512_ASM */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* OPENSSL_NO_SHA512 */
end_comment

end_unit

