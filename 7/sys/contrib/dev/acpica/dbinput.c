begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*******************************************************************************  *  * Module Name: dbinput - user front-end to the AML debugger  *              $Revision: 1.114 $  *  ******************************************************************************/
end_comment

begin_comment
comment|/******************************************************************************  *  * 1. Copyright Notice  *  * Some or all of this work - Copyright (c) 1999 - 2007, Intel Corp.  * All rights reserved.  *  * 2. License  *  * 2.1. This is your license from Intel Corp. under its intellectual property  * rights.  You may have additional license terms from the party that provided  * you this software, covering your right to use that party's intellectual  * property rights.  *  * 2.2. Intel grants, free of charge, to any person ("Licensee") obtaining a  * copy of the source code appearing in this file ("Covered Code") an  * irrevocable, perpetual, worldwide license under Intel's copyrights in the  * base code distributed originally by Intel ("Original Intel Code") to copy,  * make derivatives, distribute, use and display any portion of the Covered  * Code in any form, with the right to sublicense such rights; and  *  * 2.3. Intel grants Licensee a non-exclusive and non-transferable patent  * license (with the right to sublicense), under only those claims of Intel  * patents that are infringed by the Original Intel Code, to make, use, sell,  * offer to sell, and import the Covered Code and derivative works thereof  * solely to the minimum extent necessary to exercise the above copyright  * license, and in no event shall the patent license extend to any additions  * to or modifications of the Original Intel Code.  No other license or right  * is granted directly or by implication, estoppel or otherwise;  *  * The above copyright and patent license is granted only if the following  * conditions are met:  *  * 3. Conditions  *  * 3.1. Redistribution of Source with Rights to Further Distribute Source.  * Redistribution of source code of any substantial portion of the Covered  * Code or modification with rights to further distribute source must include  * the above Copyright Notice, the above License, this list of Conditions,  * and the following Disclaimer and Export Compliance provision.  In addition,  * Licensee must cause all Covered Code to which Licensee contributes to  * contain a file documenting the changes Licensee made to create that Covered  * Code and the date of any change.  Licensee must include in that file the  * documentation of any changes made by any predecessor Licensee.  Licensee  * must include a prominent statement that the modification is derived,  * directly or indirectly, from Original Intel Code.  *  * 3.2. Redistribution of Source with no Rights to Further Distribute Source.  * Redistribution of source code of any substantial portion of the Covered  * Code or modification without rights to further distribute source must  * include the following Disclaimer and Export Compliance provision in the  * documentation and/or other materials provided with distribution.  In  * addition, Licensee may not authorize further sublicense of source of any  * portion of the Covered Code, and must include terms to the effect that the  * license from Licensee to its licensee is limited to the intellectual  * property embodied in the software Licensee provides to its licensee, and  * not to intellectual property embodied in modifications its licensee may  * make.  *  * 3.3. Redistribution of Executable. Redistribution in executable form of any  * substantial portion of the Covered Code or modification must reproduce the  * above Copyright Notice, and the following Disclaimer and Export Compliance  * provision in the documentation and/or other materials provided with the  * distribution.  *  * 3.4. Intel retains all right, title, and interest in and to the Original  * Intel Code.  *  * 3.5. Neither the name Intel nor any other trademark owned or controlled by  * Intel shall be used in advertising or otherwise to promote the sale, use or  * other dealings in products derived from or relating to the Covered Code  * without prior written authorization from Intel.  *  * 4. Disclaimer and Export Compliance  *  * 4.1. INTEL MAKES NO WARRANTY OF ANY KIND REGARDING ANY SOFTWARE PROVIDED  * HERE.  ANY SOFTWARE ORIGINATING FROM INTEL OR DERIVED FROM INTEL SOFTWARE  * IS PROVIDED "AS IS," AND INTEL WILL NOT PROVIDE ANY SUPPORT,  ASSISTANCE,  * INSTALLATION, TRAINING OR OTHER SERVICES.  INTEL WILL NOT PROVIDE ANY  * UPDATES, ENHANCEMENTS OR EXTENSIONS.  INTEL SPECIFICALLY DISCLAIMS ANY  * IMPLIED WARRANTIES OF MERCHANTABILITY, NONINFRINGEMENT AND FITNESS FOR A  * PARTICULAR PURPOSE.  *  * 4.2. IN NO EVENT SHALL INTEL HAVE ANY LIABILITY TO LICENSEE, ITS LICENSEES  * OR ANY OTHER THIRD PARTY, FOR ANY LOST PROFITS, LOST DATA, LOSS OF USE OR  * COSTS OF PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES, OR FOR ANY INDIRECT,  * SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THIS AGREEMENT, UNDER ANY  * CAUSE OF ACTION OR THEORY OF LIABILITY, AND IRRESPECTIVE OF WHETHER INTEL  * HAS ADVANCE NOTICE OF THE POSSIBILITY OF SUCH DAMAGES.  THESE LIMITATIONS  * SHALL APPLY NOTWITHSTANDING THE FAILURE OF THE ESSENTIAL PURPOSE OF ANY  * LIMITED REMEDY.  *  * 4.3. Licensee shall not export, either directly or indirectly, any of this  * software or system incorporating such software without first obtaining any  * required license or other approval from the U. S. Department of Commerce or  * any other agency or department of the United States Government.  In the  * event Licensee exports any such software from the United States or  * re-exports any such software from a foreign destination, Licensee shall  * ensure that the distribution and export/re-export of the software is in  * compliance with all laws, regulations, orders, or other restrictions of the  * U.S. Export Administration Regulations. Licensee agrees that neither it nor  * any of its subsidiaries will export/re-export any technical data, process,  * software, or service, directly or indirectly, to any country for which the  * United States government or any agency thereof requires an export license,  * other governmental approval, or letter of assurance, without first obtaining  * such license, approval or letter.  *  *****************************************************************************/
end_comment

begin_include
include|#
directive|include
file|<contrib/dev/acpica/acpi.h>
end_include

begin_include
include|#
directive|include
file|<contrib/dev/acpica/acdebug.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ACPI_DEBUGGER
end_ifdef

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_CA_DEBUGGER
end_define

begin_macro
name|ACPI_MODULE_NAME
argument_list|(
literal|"dbinput"
argument_list|)
end_macro

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|AcpiDbGetNextToken
parameter_list|(
name|char
modifier|*
name|String
parameter_list|,
name|char
modifier|*
modifier|*
name|Next
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|UINT32
name|AcpiDbGetLine
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|UINT32
name|AcpiDbMatchCommand
parameter_list|(
name|char
modifier|*
name|UserCommand
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|AcpiDbSingleThread
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|AcpiDbDisplayHelp
parameter_list|(
name|char
modifier|*
name|HelpType
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Top-level debugger commands.  *  * This list of commands must match the string table below it  */
end_comment

begin_enum
enum|enum
name|AcpiExDebuggerCommands
block|{
name|CMD_NOT_FOUND
init|=
literal|0
block|,
name|CMD_NULL
block|,
name|CMD_ALLOCATIONS
block|,
name|CMD_ARGS
block|,
name|CMD_ARGUMENTS
block|,
name|CMD_BREAKPOINT
block|,
name|CMD_BUSINFO
block|,
name|CMD_CALL
block|,
name|CMD_CLOSE
block|,
name|CMD_DEBUG
block|,
name|CMD_DISASSEMBLE
block|,
name|CMD_DUMP
block|,
name|CMD_ENABLEACPI
block|,
name|CMD_EVENT
block|,
name|CMD_EXECUTE
block|,
name|CMD_EXIT
block|,
name|CMD_FIND
block|,
name|CMD_GO
block|,
name|CMD_GPE
block|,
name|CMD_GPES
block|,
name|CMD_HELP
block|,
name|CMD_HELP2
block|,
name|CMD_HISTORY
block|,
name|CMD_HISTORY_EXE
block|,
name|CMD_HISTORY_LAST
block|,
name|CMD_INFORMATION
block|,
name|CMD_INTEGRITY
block|,
name|CMD_INTO
block|,
name|CMD_LEVEL
block|,
name|CMD_LIST
block|,
name|CMD_LOAD
block|,
name|CMD_LOCALS
block|,
name|CMD_LOCKS
block|,
name|CMD_METHODS
block|,
name|CMD_NAMESPACE
block|,
name|CMD_NOTIFY
block|,
name|CMD_OBJECT
block|,
name|CMD_OPEN
block|,
name|CMD_OWNER
block|,
name|CMD_PREFIX
block|,
name|CMD_QUIT
block|,
name|CMD_REFERENCES
block|,
name|CMD_RESOURCES
block|,
name|CMD_RESULTS
block|,
name|CMD_SET
block|,
name|CMD_SLEEP
block|,
name|CMD_STATS
block|,
name|CMD_STOP
block|,
name|CMD_TABLES
block|,
name|CMD_TERMINATE
block|,
name|CMD_THREADS
block|,
name|CMD_TRACE
block|,
name|CMD_TREE
block|,
name|CMD_TYPE
block|,
name|CMD_UNLOAD
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|CMD_FIRST_VALID
value|2
end_define

begin_decl_stmt
specifier|static
specifier|const
name|COMMAND_INFO
name|AcpiGbl_DbCommands
index|[]
init|=
block|{
block|{
literal|"<NOT FOUND>"
block|,
literal|0
block|}
block|,
block|{
literal|"<NULL>"
block|,
literal|0
block|}
block|,
block|{
literal|"ALLOCATIONS"
block|,
literal|0
block|}
block|,
block|{
literal|"ARGS"
block|,
literal|0
block|}
block|,
block|{
literal|"ARGUMENTS"
block|,
literal|0
block|}
block|,
block|{
literal|"BREAKPOINT"
block|,
literal|1
block|}
block|,
block|{
literal|"BUSINFO"
block|,
literal|0
block|}
block|,
block|{
literal|"CALL"
block|,
literal|0
block|}
block|,
block|{
literal|"CLOSE"
block|,
literal|0
block|}
block|,
block|{
literal|"DEBUG"
block|,
literal|1
block|}
block|,
block|{
literal|"DISASSEMBLE"
block|,
literal|1
block|}
block|,
block|{
literal|"DUMP"
block|,
literal|1
block|}
block|,
block|{
literal|"ENABLEACPI"
block|,
literal|0
block|}
block|,
block|{
literal|"EVENT"
block|,
literal|1
block|}
block|,
block|{
literal|"EXECUTE"
block|,
literal|1
block|}
block|,
block|{
literal|"EXIT"
block|,
literal|0
block|}
block|,
block|{
literal|"FIND"
block|,
literal|1
block|}
block|,
block|{
literal|"GO"
block|,
literal|0
block|}
block|,
block|{
literal|"GPE"
block|,
literal|2
block|}
block|,
block|{
literal|"GPES"
block|,
literal|0
block|}
block|,
block|{
literal|"HELP"
block|,
literal|0
block|}
block|,
block|{
literal|"?"
block|,
literal|0
block|}
block|,
block|{
literal|"HISTORY"
block|,
literal|0
block|}
block|,
block|{
literal|"!"
block|,
literal|1
block|}
block|,
block|{
literal|"!!"
block|,
literal|0
block|}
block|,
block|{
literal|"INFORMATION"
block|,
literal|0
block|}
block|,
block|{
literal|"INTEGRITY"
block|,
literal|0
block|}
block|,
block|{
literal|"INTO"
block|,
literal|0
block|}
block|,
block|{
literal|"LEVEL"
block|,
literal|0
block|}
block|,
block|{
literal|"LIST"
block|,
literal|0
block|}
block|,
block|{
literal|"LOAD"
block|,
literal|1
block|}
block|,
block|{
literal|"LOCALS"
block|,
literal|0
block|}
block|,
block|{
literal|"LOCKS"
block|,
literal|0
block|}
block|,
block|{
literal|"METHODS"
block|,
literal|0
block|}
block|,
block|{
literal|"NAMESPACE"
block|,
literal|0
block|}
block|,
block|{
literal|"NOTIFY"
block|,
literal|2
block|}
block|,
block|{
literal|"OBJECT"
block|,
literal|1
block|}
block|,
block|{
literal|"OPEN"
block|,
literal|1
block|}
block|,
block|{
literal|"OWNER"
block|,
literal|1
block|}
block|,
block|{
literal|"PREFIX"
block|,
literal|0
block|}
block|,
block|{
literal|"QUIT"
block|,
literal|0
block|}
block|,
block|{
literal|"REFERENCES"
block|,
literal|1
block|}
block|,
block|{
literal|"RESOURCES"
block|,
literal|1
block|}
block|,
block|{
literal|"RESULTS"
block|,
literal|0
block|}
block|,
block|{
literal|"SET"
block|,
literal|3
block|}
block|,
block|{
literal|"SLEEP"
block|,
literal|1
block|}
block|,
block|{
literal|"STATS"
block|,
literal|0
block|}
block|,
block|{
literal|"STOP"
block|,
literal|0
block|}
block|,
block|{
literal|"TABLES"
block|,
literal|0
block|}
block|,
block|{
literal|"TERMINATE"
block|,
literal|0
block|}
block|,
block|{
literal|"THREADS"
block|,
literal|3
block|}
block|,
block|{
literal|"TRACE"
block|,
literal|1
block|}
block|,
block|{
literal|"TREE"
block|,
literal|0
block|}
block|,
block|{
literal|"TYPE"
block|,
literal|1
block|}
block|,
block|{
literal|"UNLOAD"
block|,
literal|1
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayHelp  *  * PARAMETERS:  HelpType        - Subcommand (optional)  *  * RETURN:      None  *  * DESCRIPTION: Print a usage message.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDbDisplayHelp
parameter_list|(
name|char
modifier|*
name|HelpType
parameter_list|)
block|{
name|AcpiUtStrupr
argument_list|(
name|HelpType
argument_list|)
expr_stmt|;
comment|/* No parameter, just give the overview */
if|if
condition|(
operator|!
name|HelpType
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"ACPI CA Debugger Commands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"The following classes of commands are available.  Help is available for\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"each class by entering \"Help<ClassName>\"\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"    [GENERAL]       General-Purpose Commands\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"    [NAMESPACE]     Namespace Access Commands\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"    [METHOD]        Control Method Execution Commands\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"    [STATISTICS]    Statistical Information\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"    [FILE]          File I/O Commands\n"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/*      * Parameter is the command class      *      * The idea here is to keep each class of commands smaller than a screenful      */
switch|switch
condition|(
name|HelpType
index|[
literal|0
index|]
condition|)
block|{
case|case
literal|'G'
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\nGeneral-Purpose Commands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Allocations                         Display list of current memory allocations\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Dump<Address>|<Namepath>\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"     [Byte|Word|Dword|Qword]        Display ACPI objects or memory\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"EnableAcpi                          Enable ACPI (hardware) mode\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Help                                This help screen\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"History                             Display command history buffer\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Level [<DebugLevel>] [console]      Get/Set debug level for file or console\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Locks                               Current status of internal mutexes\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Quit or Exit                        Exit this command\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Stats [Allocations|Memory|Misc\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"      |Objects|Sizes|Stack|Tables]  Display namespace and memory statistics\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Tables                              Display info about loaded ACPI tables\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Unload<TableSig> [Instance]        Unload an ACPI table\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"!<CommandNumber>                   Execute command from history buffer\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"!!                                  Execute last command again\n"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'S'
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\nStats Subcommands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Allocations                         Display list of current memory allocations\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Memory                              Dump internal memory lists\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Misc                                Namespace search and mutex stats\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Objects                             Summary of namespace objects\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Sizes                               Sizes for each of the internal objects\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Stack                               Display CPU stack usage\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Tables                              Info about current ACPI table(s)\n"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'N'
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\nNamespace Access Commands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Businfo                             Display system bus info\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Disassemble<Method>                Disassemble a control method\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Event<F|G><Value>                 Generate AcpiEvent (Fixed/GPE)\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Find<AcpiName>  (? is wildcard)    Find ACPI name(s) with wildcards\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Gpe<GpeNum><GpeBlock>             Simulate a GPE\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Gpes                                Display info on all GPEs\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Integrity                           Validate namespace integrity\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Methods                             Display list of loaded control methods\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Namespace [Object] [Depth]          Display loaded namespace tree/subtree\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Notify<Object><Value>             Send a notification on Object\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Objects<ObjectType>                Display all objects of the given type\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Owner<OwnerId> [Depth]             Display loaded namespace by object owner\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Prefix [<NamePath>]                 Set or Get current execution prefix\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"References<Addr>                   Find all references to object at addr\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Resources<Device>                  Get and display Device resources\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Set N<NamedObject><Value>         Set value for named integer\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Sleep<SleepState>                  Simulate sleep/wake sequence\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Terminate                           Delete namespace and all internal objects\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Type<Object>                       Display object type\n"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'M'
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\nControl Method Execution Commands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Arguments (or Args)                 Display method arguments\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Breakpoint<AmlOffset>              Set an AML execution breakpoint\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Call                                Run to next control method invocation\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Debug<Namepath> [Arguments]        Single Step a control method\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Execute<Namepath> [Arguments]      Execute control method\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Go                                  Allow method to run to completion\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Information                         Display info about the current method\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Into                                Step into (not over) a method call\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"List [# of Aml Opcodes]             Display method ASL statements\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Locals                              Display method local variables\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Results                             Display method result stack\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Set<A|L><#><Value>               Set method data (Arguments/Locals)\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Stop                                Terminate control method\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Thread<Threads><Loops><NamePath>   Spawn threads to execute method(s)\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Trace<method name>                 Trace method execution\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Tree                                Display control method calling tree\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"<Enter>                             Single step next AML opcode (over calls)\n"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'F'
case|:
name|AcpiOsPrintf
argument_list|(
literal|"\nFile I/O Commands\n\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Close                               Close debug output file\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Open<Output Filename>              Open a file for debug output\n"
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Load<Input Filename>               Load ACPI table from a file\n"
argument_list|)
expr_stmt|;
return|return;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"Unrecognized Command Class: %s\n"
argument_list|,
name|HelpType
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbGetNextToken  *  * PARAMETERS:  String          - Command buffer  *              Next            - Return value, end of next token  *  * RETURN:      Pointer to the start of the next token.  *  * DESCRIPTION: Command line parsing.  Get the next token on the command line  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|char
modifier|*
name|AcpiDbGetNextToken
parameter_list|(
name|char
modifier|*
name|String
parameter_list|,
name|char
modifier|*
modifier|*
name|Next
parameter_list|)
block|{
name|char
modifier|*
name|Start
decl_stmt|;
comment|/* At end of buffer? */
if|if
condition|(
operator|!
name|String
operator|||
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/* Get rid of any spaces at the beginning */
if|if
condition|(
operator|*
name|String
operator|==
literal|' '
condition|)
block|{
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|==
literal|' '
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
return|return
operator|(
name|NULL
operator|)
return|;
block|}
block|}
name|Start
operator|=
name|String
expr_stmt|;
comment|/* Find end of token */
while|while
condition|(
operator|*
name|String
operator|&&
operator|(
operator|*
name|String
operator|!=
literal|' '
operator|)
condition|)
block|{
name|String
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
operator|*
name|String
operator|)
condition|)
block|{
operator|*
name|Next
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
operator|*
name|String
operator|=
literal|0
expr_stmt|;
operator|*
name|Next
operator|=
name|String
operator|+
literal|1
expr_stmt|;
block|}
return|return
operator|(
name|Start
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbGetLine  *  * PARAMETERS:  InputBuffer         - Command line buffer  *  * RETURN:      Count of arguments to the command  *  * DESCRIPTION: Get the next command line from the user.  Gets entire line  *              up to the next newline  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|UINT32
name|AcpiDbGetLine
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
name|UINT32
name|Count
decl_stmt|;
name|char
modifier|*
name|Next
decl_stmt|;
name|char
modifier|*
name|This
decl_stmt|;
name|ACPI_STRCPY
argument_list|(
name|AcpiGbl_DbParsedBuf
argument_list|,
name|InputBuffer
argument_list|)
expr_stmt|;
name|This
operator|=
name|AcpiGbl_DbParsedBuf
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ACPI_DEBUGGER_MAX_ARGS
condition|;
name|i
operator|++
control|)
block|{
name|AcpiGbl_DbArgs
index|[
name|i
index|]
operator|=
name|AcpiDbGetNextToken
argument_list|(
name|This
argument_list|,
operator|&
name|Next
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|AcpiGbl_DbArgs
index|[
name|i
index|]
condition|)
block|{
break|break;
block|}
name|This
operator|=
name|Next
expr_stmt|;
block|}
comment|/* Uppercase the actual command */
if|if
condition|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
condition|)
block|{
name|AcpiUtStrupr
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
name|Count
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|Count
condition|)
block|{
name|Count
operator|--
expr_stmt|;
comment|/* Number of args only */
block|}
return|return
operator|(
name|Count
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbMatchCommand  *  * PARAMETERS:  UserCommand             - User command line  *  * RETURN:      Index into command array, -1 if not found  *  * DESCRIPTION: Search command array for a command match  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|UINT32
name|AcpiDbMatchCommand
parameter_list|(
name|char
modifier|*
name|UserCommand
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|UserCommand
operator|||
name|UserCommand
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
return|return
operator|(
name|CMD_NULL
operator|)
return|;
block|}
for|for
control|(
name|i
operator|=
name|CMD_FIRST_VALID
init|;
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|ACPI_STRSTR
argument_list|(
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
argument_list|,
name|UserCommand
argument_list|)
operator|==
name|AcpiGbl_DbCommands
index|[
name|i
index|]
operator|.
name|Name
condition|)
block|{
return|return
operator|(
name|i
operator|)
return|;
block|}
block|}
comment|/* Command not recognized */
return|return
operator|(
name|CMD_NOT_FOUND
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbCommandDispatch  *  * PARAMETERS:  InputBuffer         - Command line buffer  *              WalkState           - Current walk  *              Op                  - Current (executing) parse op  *  * RETURN:      Status  *  * DESCRIPTION: Command dispatcher.  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_STATUS
name|AcpiDbCommandDispatch
parameter_list|(
name|char
modifier|*
name|InputBuffer
parameter_list|,
name|ACPI_WALK_STATE
modifier|*
name|WalkState
parameter_list|,
name|ACPI_PARSE_OBJECT
modifier|*
name|Op
parameter_list|)
block|{
name|UINT32
name|Temp
decl_stmt|;
name|UINT32
name|CommandIndex
decl_stmt|;
name|UINT32
name|ParamCount
decl_stmt|;
name|char
modifier|*
name|CommandLine
decl_stmt|;
name|ACPI_STATUS
name|Status
init|=
name|AE_CTRL_TRUE
decl_stmt|;
comment|/* If AcpiTerminate has been called, terminate this thread */
if|if
condition|(
name|AcpiGbl_DbTerminateThreads
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
block|}
name|ParamCount
operator|=
name|AcpiDbGetLine
argument_list|(
name|InputBuffer
argument_list|)
expr_stmt|;
name|CommandIndex
operator|=
name|AcpiDbMatchCommand
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|Temp
operator|=
literal|0
expr_stmt|;
comment|/* Verify that we have the minimum number of params */
if|if
condition|(
name|ParamCount
operator|<
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|MinArgs
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%d parameters entered, [%s] requires %d parameters\n"
argument_list|,
name|ParamCount
argument_list|,
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|Name
argument_list|,
name|AcpiGbl_DbCommands
index|[
name|CommandIndex
index|]
operator|.
name|MinArgs
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
comment|/* Decode and dispatch the command */
switch|switch
condition|(
name|CommandIndex
condition|)
block|{
case|case
name|CMD_NULL
case|:
if|if
condition|(
name|Op
condition|)
block|{
return|return
operator|(
name|AE_OK
operator|)
return|;
block|}
break|break;
case|case
name|CMD_ALLOCATIONS
case|:
ifdef|#
directive|ifdef
name|ACPI_DBG_TRACK_ALLOCATIONS
name|AcpiUtDumpAllocations
argument_list|(
operator|(
name|UINT32
operator|)
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
name|CMD_ARGS
case|:
case|case
name|CMD_ARGUMENTS
case|:
name|AcpiDbDisplayArguments
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_BREAKPOINT
case|:
name|AcpiDbSetMethodBreakpoint
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_BUSINFO
case|:
name|AcpiDbGetBusInfo
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_CALL
case|:
name|AcpiDbSetMethodCallBreakpoint
argument_list|(
name|Op
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AE_OK
expr_stmt|;
break|break;
case|case
name|CMD_CLOSE
case|:
name|AcpiDbCloseDebugFile
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_DEBUG
case|:
name|AcpiDbExecute
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|EX_SINGLE_STEP
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_DISASSEMBLE
case|:
operator|(
name|void
operator|)
name|AcpiDbDisassembleMethod
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_DUMP
case|:
name|AcpiDbDecodeAndDisplayObject
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_ENABLEACPI
case|:
name|Status
operator|=
name|AcpiEnable
argument_list|()
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiEnable failed (Status=%X)\n"
argument_list|,
name|Status
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
break|break;
case|case
name|CMD_EVENT
case|:
name|AcpiOsPrintf
argument_list|(
literal|"Event command not implemented\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_EXECUTE
case|:
name|AcpiDbExecute
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
operator|&
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|EX_NO_SINGLE_STEP
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_FIND
case|:
name|Status
operator|=
name|AcpiDbFindNameInNamespace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_GO
case|:
name|AcpiGbl_CmSingleStep
operator|=
name|FALSE
expr_stmt|;
return|return
operator|(
name|AE_OK
operator|)
return|;
case|case
name|CMD_GPE
case|:
name|AcpiDbGenerateGpe
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_GPES
case|:
name|AcpiDbDisplayGpes
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_HELP
case|:
case|case
name|CMD_HELP2
case|:
name|AcpiDbDisplayHelp
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_HISTORY
case|:
name|AcpiDbDisplayHistory
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_HISTORY_EXE
case|:
name|CommandLine
operator|=
name|AcpiDbGetFromHistory
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|CommandLine
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|CommandLine
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
case|case
name|CMD_HISTORY_LAST
case|:
name|CommandLine
operator|=
name|AcpiDbGetFromHistory
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|CommandLine
condition|)
block|{
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|CommandLine
argument_list|,
name|WalkState
argument_list|,
name|Op
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
case|case
name|CMD_INFORMATION
case|:
name|AcpiDbDisplayMethodInfo
argument_list|(
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_INTEGRITY
case|:
name|AcpiDbCheckIntegrity
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_INTO
case|:
if|if
condition|(
name|Op
condition|)
block|{
name|AcpiGbl_CmSingleStep
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|AE_OK
operator|)
return|;
block|}
break|break;
case|case
name|CMD_LEVEL
case|:
if|if
condition|(
name|ParamCount
operator|==
literal|0
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Current debug level for file output is:    %8.8lX\n"
argument_list|,
name|AcpiGbl_DbDebugLevel
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Current debug level for console output is: %8.8lX\n"
argument_list|,
name|AcpiGbl_DbConsoleDebugLevel
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ParamCount
operator|==
literal|2
condition|)
block|{
name|Temp
operator|=
name|AcpiGbl_DbConsoleDebugLevel
expr_stmt|;
name|AcpiGbl_DbConsoleDebugLevel
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Debug Level for console output was %8.8lX, now %8.8lX\n"
argument_list|,
name|Temp
argument_list|,
name|AcpiGbl_DbConsoleDebugLevel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Temp
operator|=
name|AcpiGbl_DbDebugLevel
expr_stmt|;
name|AcpiGbl_DbDebugLevel
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Debug Level for file output was %8.8lX, now %8.8lX\n"
argument_list|,
name|Temp
argument_list|,
name|AcpiGbl_DbDebugLevel
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|CMD_LIST
case|:
name|AcpiDbDisassembleAml
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|Op
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_LOAD
case|:
name|Status
operator|=
name|AcpiDbGetTableFromFile
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_LOCKS
case|:
name|AcpiDbDisplayLocks
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_LOCALS
case|:
name|AcpiDbDisplayLocals
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_METHODS
case|:
name|Status
operator|=
name|AcpiDbDisplayObjects
argument_list|(
literal|"METHOD"
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_NAMESPACE
case|:
name|AcpiDbDumpNamespace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_NOTIFY
case|:
name|Temp
operator|=
name|ACPI_STRTOUL
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AcpiDbSendNotify
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|Temp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OBJECT
case|:
name|AcpiUtStrupr
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiDbDisplayObjects
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OPEN
case|:
name|AcpiDbOpenDebugFile
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_OWNER
case|:
name|AcpiDbDumpNamespaceByOwner
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_PREFIX
case|:
name|AcpiDbSetScope
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_REFERENCES
case|:
name|AcpiDbFindReferences
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_RESOURCES
case|:
name|AcpiDbDisplayResources
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_RESULTS
case|:
name|AcpiDbDisplayResults
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_SET
case|:
name|AcpiDbSetMethodData
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_SLEEP
case|:
name|Status
operator|=
name|AcpiDbSleep
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_STATS
case|:
name|Status
operator|=
name|AcpiDbDisplayStatistics
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_STOP
case|:
return|return
operator|(
name|AE_NOT_IMPLEMENTED
operator|)
return|;
case|case
name|CMD_TABLES
case|:
name|AcpiDbDisplayTableInfo
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TERMINATE
case|:
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_REDIRECTABLE_OUTPUT
argument_list|)
expr_stmt|;
name|AcpiUtSubsystemShutdown
argument_list|()
expr_stmt|;
comment|/*          * TBD: [Restructure] Need some way to re-initialize without          * re-creating the semaphores!          */
comment|/*  AcpiInitialize (NULL);  */
break|break;
case|case
name|CMD_THREADS
case|:
name|AcpiDbCreateExecutionThreads
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TRACE
case|:
name|AcpiDebugTrace
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_TREE
case|:
name|AcpiDbDisplayCallingTree
argument_list|()
expr_stmt|;
break|break;
case|case
name|CMD_TYPE
case|:
name|AcpiDbDisplayObjectType
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_UNLOAD
case|:
name|AcpiDbUnloadAcpiTable
argument_list|(
name|AcpiGbl_DbArgs
index|[
literal|1
index|]
argument_list|,
name|AcpiGbl_DbArgs
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CMD_EXIT
case|:
case|case
name|CMD_QUIT
case|:
if|if
condition|(
name|Op
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Method execution terminated\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
block|}
if|if
condition|(
operator|!
name|AcpiGbl_DbOutputToFile
condition|)
block|{
name|AcpiDbgLevel
operator|=
name|ACPI_DEBUG_DEFAULT
expr_stmt|;
block|}
name|AcpiDbCloseDebugFile
argument_list|()
expr_stmt|;
name|AcpiGbl_DbTerminateThreads
operator|=
name|TRUE
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TERMINATE
operator|)
return|;
case|case
name|CMD_NOT_FOUND
case|:
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"Unknown Command\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|AE_CTRL_TRUE
operator|)
return|;
block|}
if|if
condition|(
name|ACPI_SUCCESS
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|Status
operator|=
name|AE_CTRL_TRUE
expr_stmt|;
block|}
comment|/* Add all commands that come here to the history buffer */
name|AcpiDbAddToHistory
argument_list|(
name|InputBuffer
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbExecuteThread  *  * PARAMETERS:  Context         - Not used  *  * RETURN:      None  *  * DESCRIPTION: Debugger execute thread.  Waits for a command line, then  *              simply dispatches it.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|ACPI_SYSTEM_XFACE
name|AcpiDbExecuteThread
parameter_list|(
name|void
modifier|*
name|Context
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
init|=
name|AE_OK
decl_stmt|;
name|ACPI_STATUS
name|MStatus
decl_stmt|;
while|while
condition|(
name|Status
operator|!=
name|AE_CTRL_TERMINATE
condition|)
block|{
name|AcpiGbl_MethodExecuting
operator|=
name|FALSE
expr_stmt|;
name|AcpiGbl_StepToNextCall
operator|=
name|FALSE
expr_stmt|;
name|MStatus
operator|=
name|AcpiUtAcquireMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_READY
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|MStatus
argument_list|)
condition|)
block|{
return|return;
block|}
name|Status
operator|=
name|AcpiDbCommandDispatch
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|MStatus
operator|=
name|AcpiUtReleaseMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_COMPLETE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|MStatus
argument_list|)
condition|)
block|{
return|return;
block|}
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbSingleThread  *  * PARAMETERS:  None  *  * RETURN:      None  *  * DESCRIPTION: Debugger execute thread.  Waits for a command line, then  *              simply dispatches it.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDbSingleThread
parameter_list|(
name|void
parameter_list|)
block|{
name|AcpiGbl_MethodExecuting
operator|=
name|FALSE
expr_stmt|;
name|AcpiGbl_StepToNextCall
operator|=
name|FALSE
expr_stmt|;
operator|(
name|void
operator|)
name|AcpiDbCommandDispatch
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbUserCommands  *  * PARAMETERS:  Prompt              - User prompt (depends on mode)  *              Op                  - Current executing parse op  *  * RETURN:      None  *  * DESCRIPTION: Command line execution for the AML debugger.  Commands are  *              matched and dispatched here.  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_STATUS
name|AcpiDbUserCommands
parameter_list|(
name|char
name|Prompt
parameter_list|,
name|ACPI_PARSE_OBJECT
modifier|*
name|Op
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
init|=
name|AE_OK
decl_stmt|;
comment|/* TBD: [Restructure] Need a separate command line buffer for step mode */
while|while
condition|(
operator|!
name|AcpiGbl_DbTerminateThreads
condition|)
block|{
comment|/* Force output to console until a command is entered */
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_CONSOLE_OUTPUT
argument_list|)
expr_stmt|;
comment|/* Different prompt if method is executing */
if|if
condition|(
operator|!
name|AcpiGbl_MethodExecuting
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%1c "
argument_list|,
name|ACPI_DEBUGGER_COMMAND_PROMPT
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%1c "
argument_list|,
name|ACPI_DEBUGGER_EXECUTE_PROMPT
argument_list|)
expr_stmt|;
block|}
comment|/* Get the user input line */
operator|(
name|void
operator|)
name|AcpiOsGetLine
argument_list|(
name|AcpiGbl_DbLineBuf
argument_list|)
expr_stmt|;
comment|/* Check for single or multithreaded debug */
if|if
condition|(
name|AcpiGbl_DebuggerConfiguration
operator|&
name|DEBUGGER_MULTI_THREADED
condition|)
block|{
comment|/*              * Signal the debug thread that we have a command to execute,              * and wait for the command to complete.              */
name|Status
operator|=
name|AcpiUtReleaseMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_READY
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
name|Status
operator|=
name|AcpiUtAcquireMutex
argument_list|(
name|ACPI_MTX_DEBUG_CMD_COMPLETE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
block|}
else|else
block|{
comment|/* Just call to the command line interpreter */
name|AcpiDbSingleThread
argument_list|()
expr_stmt|;
block|}
block|}
comment|/*      * Only this thread (the original thread) should actually terminate the      * subsystem, because all the semaphores are deleted during termination      */
name|Status
operator|=
name|AcpiTerminate
argument_list|()
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ACPI_DEBUGGER */
end_comment

end_unit

