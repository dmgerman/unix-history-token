begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**************************************************************************  Copyright (c) 2007, Chelsio Inc. All rights reserved.  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:   1. Redistributions of source code must retain the above copyright notice,     this list of conditions and the following disclaimer.   2. Neither the name of the Chelsio Corporation nor the names of its     contributors may be used to endorse or promote products derived from     this software without specific prior written permission.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.   $FreeBSD$  ***************************************************************************/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|CXGB_DEFS_H_
end_ifndef

begin_define
define|#
directive|define
name|CXGB_DEFS_H_
end_define

begin_define
define|#
directive|define
name|VALIDATE_TID
value|0
end_define

begin_define
define|#
directive|define
name|TOEPCB
parameter_list|(
name|so
parameter_list|)
value|((struct toepcb *)(sototcpcb((so))->t_toe))
end_define

begin_define
define|#
directive|define
name|TOE_DEV
parameter_list|(
name|so
parameter_list|)
value|(TOEPCB((so))->tp_toedev)
end_define

begin_define
define|#
directive|define
name|toeptoso
parameter_list|(
name|toep
parameter_list|)
value|((toep)->tp_tp->t_inpcb->inp_socket)
end_define

begin_define
define|#
directive|define
name|sototoep
parameter_list|(
name|so
parameter_list|)
value|(sototcpcb((so))->t_toe)
end_define

begin_define
define|#
directive|define
name|TRACE_ENTER
value|printf("%s:%s entered\n", __FUNCTION__, __FILE__)
end_define

begin_define
define|#
directive|define
name|TRACE_EXIT
value|printf("%s:%s:%d exited\n", __FUNCTION__, __FILE__, __LINE__)
end_define

begin_define
define|#
directive|define
name|KTR_TOM
value|KTR_SPARE2
end_define

begin_define
define|#
directive|define
name|KTR_TCB
value|KTR_SPARE3
end_define

begin_struct_decl
struct_decl|struct
name|toepcb
struct_decl|;
end_struct_decl

begin_struct_decl
struct_decl|struct
name|listen_ctx
struct_decl|;
end_struct_decl

begin_typedef
typedef|typedef
name|void
function_decl|(
modifier|*
name|defer_handler_t
function_decl|)
parameter_list|(
name|struct
name|toedev
modifier|*
name|dev
parameter_list|,
name|struct
name|mbuf
modifier|*
name|m
parameter_list|)
function_decl|;
end_typedef

begin_function_decl
name|void
name|t3tom_register_cpl_handler
parameter_list|(
name|unsigned
name|int
name|opcode
parameter_list|,
name|cxgb_cpl_handler_func
name|h
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_listen_start
parameter_list|(
name|struct
name|toedev
modifier|*
name|dev
parameter_list|,
name|struct
name|socket
modifier|*
name|so
parameter_list|,
name|struct
name|t3cdev
modifier|*
name|cdev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_listen_stop
parameter_list|(
name|struct
name|toedev
modifier|*
name|dev
parameter_list|,
name|struct
name|socket
modifier|*
name|so
parameter_list|,
name|struct
name|t3cdev
modifier|*
name|cdev
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|t3_push_frames
parameter_list|(
name|struct
name|socket
modifier|*
name|so
parameter_list|,
name|int
name|req_completion
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|t3_connect
parameter_list|(
name|struct
name|toedev
modifier|*
name|tdev
parameter_list|,
name|struct
name|socket
modifier|*
name|so
parameter_list|,
name|struct
name|rtentry
modifier|*
name|rt
parameter_list|,
name|struct
name|sockaddr
modifier|*
name|nam
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_init_listen_cpl_handlers
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|t3_init_cpl_io
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_init_wr_tab
parameter_list|(
name|unsigned
name|int
name|wr_len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|uint32_t
name|t3_send_rx_credits
parameter_list|(
name|struct
name|tcpcb
modifier|*
name|tp
parameter_list|,
name|uint32_t
name|credits
parameter_list|,
name|uint32_t
name|dack
parameter_list|,
name|int
name|nofail
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_send_rx_modulate
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_cleanup_rbuf
parameter_list|(
name|struct
name|tcpcb
modifier|*
name|tp
parameter_list|,
name|int
name|copied
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_init_socket_ops
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_install_socket_ops
parameter_list|(
name|struct
name|socket
modifier|*
name|so
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_disconnect_acceptq
parameter_list|(
name|struct
name|socket
modifier|*
name|listen_so
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_reset_synq
parameter_list|(
name|struct
name|listen_ctx
modifier|*
name|ctx
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_defer_reply
parameter_list|(
name|struct
name|mbuf
modifier|*
name|m
parameter_list|,
name|struct
name|toedev
modifier|*
name|dev
parameter_list|,
name|defer_handler_t
name|handler
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|struct
name|toepcb
modifier|*
name|toepcb_alloc
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|toepcb_hold
parameter_list|(
name|struct
name|toepcb
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|toepcb_release
parameter_list|(
name|struct
name|toepcb
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|toepcb_init
parameter_list|(
name|struct
name|toepcb
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_set_rcv_coalesce_enable
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|,
name|int
name|on_off
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_set_dack_mss
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|,
name|int
name|on
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_set_keepalive
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|,
name|int
name|on_off
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_set_ddp_tag
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|,
name|int
name|buf_idx
parameter_list|,
name|unsigned
name|int
name|tag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|t3_set_ddp_buf
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|,
name|int
name|buf_idx
parameter_list|,
name|unsigned
name|int
name|offset
parameter_list|,
name|unsigned
name|int
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|t3_get_tcb
parameter_list|(
name|struct
name|toepcb
modifier|*
name|toep
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|t3_ctloutput
parameter_list|(
name|struct
name|socket
modifier|*
name|so
parameter_list|,
name|struct
name|sockopt
modifier|*
name|sopt
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

end_unit

