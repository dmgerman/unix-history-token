begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2000-2003,2005 Silicon Graphics, Inc.  * All Rights Reserved.  *  * This program is free software; you can redistribute it and/or  * modify it under the terms of the GNU General Public License as  * published by the Free Software Foundation.  *  * This program is distributed in the hope that it would be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write the Free Software Foundation,  * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA  */
end_comment

begin_include
include|#
directive|include
file|"xfs.h"
end_include

begin_include
include|#
directive|include
file|"xfs_fs.h"
end_include

begin_include
include|#
directive|include
file|"xfs_types.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bit.h"
end_include

begin_include
include|#
directive|include
file|"xfs_log.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inum.h"
end_include

begin_include
include|#
directive|include
file|"xfs_trans.h"
end_include

begin_include
include|#
directive|include
file|"xfs_sb.h"
end_include

begin_include
include|#
directive|include
file|"xfs_ag.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dfrag.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dmapi.h"
end_include

begin_include
include|#
directive|include
file|"xfs_mount.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bmap_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_alloc_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_ialloc_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dir2_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_attr_sf.h"
end_include

begin_include
include|#
directive|include
file|"xfs_dinode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inode.h"
end_include

begin_include
include|#
directive|include
file|"xfs_inode_item.h"
end_include

begin_include
include|#
directive|include
file|"xfs_itable.h"
end_include

begin_include
include|#
directive|include
file|"xfs_btree.h"
end_include

begin_include
include|#
directive|include
file|"xfs_alloc.h"
end_include

begin_include
include|#
directive|include
file|"xfs_ialloc.h"
end_include

begin_include
include|#
directive|include
file|"xfs_bmap.h"
end_include

begin_include
include|#
directive|include
file|"xfs_error.h"
end_include

begin_include
include|#
directive|include
file|"xfs_rw.h"
end_include

begin_include
include|#
directive|include
file|"xfs_quota.h"
end_include

begin_include
include|#
directive|include
file|"xfs_trans_space.h"
end_include

begin_include
include|#
directive|include
file|"xfs_iomap.h"
end_include

begin_function
name|STATIC
name|xfs_fsize_t
name|xfs_size_fn
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
return|return
operator|(
name|ip
operator|->
name|i_d
operator|.
name|di_size
operator|)
return|;
block|}
end_function

begin_function
name|STATIC
name|int
name|xfs_ioinit
parameter_list|(
name|struct
name|xfs_vfs
modifier|*
name|vfsp
parameter_list|,
name|struct
name|xfs_mount_args
modifier|*
name|mntargs
parameter_list|,
name|int
name|flags
parameter_list|)
block|{
return|return
name|xfs_mountfs
argument_list|(
name|vfsp
argument_list|,
name|XFS_VFSTOM
argument_list|(
name|vfsp
argument_list|)
argument_list|,
name|flags
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
name|xfs_ioops_t
name|xfs_iocore_xfs
init|=
block|{
operator|.
name|xfs_ioinit
operator|=
operator|(
name|xfs_ioinit_t
operator|)
name|xfs_ioinit
block|,
operator|.
name|xfs_bmapi_func
operator|=
operator|(
name|xfs_bmapi_t
operator|)
name|xfs_bmapi
block|,
operator|.
name|xfs_bunmapi_func
operator|=
operator|(
name|xfs_bunmapi_t
operator|)
name|xfs_bunmapi
block|,
operator|.
name|xfs_bmap_eof_func
operator|=
operator|(
name|xfs_bmap_eof_t
operator|)
name|xfs_bmap_eof
block|,
operator|.
name|xfs_iomap_write_direct
operator|=
operator|(
name|xfs_iomap_write_direct_t
operator|)
name|xfs_iomap_write_direct
block|,
operator|.
name|xfs_iomap_write_delay
operator|=
operator|(
name|xfs_iomap_write_delay_t
operator|)
name|xfs_iomap_write_delay
block|,
operator|.
name|xfs_iomap_write_allocate
operator|=
operator|(
name|xfs_iomap_write_allocate_t
operator|)
name|xfs_iomap_write_allocate
block|,
operator|.
name|xfs_iomap_write_unwritten
operator|=
operator|(
name|xfs_iomap_write_unwritten_t
operator|)
name|xfs_iomap_write_unwritten
block|,
operator|.
name|xfs_ilock
operator|=
operator|(
name|xfs_lock_t
operator|)
name|xfs_ilock
block|,
operator|.
name|xfs_lck_map_shared
operator|=
operator|(
name|xfs_lck_map_shared_t
operator|)
name|xfs_ilock_map_shared
block|,
operator|.
name|xfs_ilock_demote
operator|=
operator|(
name|xfs_lock_demote_t
operator|)
name|xfs_ilock_demote
block|,
operator|.
name|xfs_ilock_nowait
operator|=
operator|(
name|xfs_lock_nowait_t
operator|)
name|xfs_ilock_nowait
block|,
operator|.
name|xfs_unlock
operator|=
operator|(
name|xfs_unlk_t
operator|)
name|xfs_iunlock
block|,
operator|.
name|xfs_size_func
operator|=
operator|(
name|xfs_size_t
operator|)
name|xfs_size_fn
block|,
operator|.
name|xfs_iodone
operator|=
operator|(
name|xfs_iodone_t
operator|)
name|fs_noerr
block|,
operator|.
name|xfs_swap_extents_func
operator|=
operator|(
name|xfs_swap_extents_t
operator|)
name|xfs_swap_extents
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|xfs_iocore_inode_reinit
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|xfs_iocore_t
modifier|*
name|io
init|=
operator|&
name|ip
operator|->
name|i_iocore
decl_stmt|;
name|io
operator|->
name|io_flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|ip
operator|->
name|i_d
operator|.
name|di_flags
operator|&
name|XFS_DIFLAG_REALTIME
condition|)
name|io
operator|->
name|io_flags
operator||=
name|XFS_IOCORE_RT
expr_stmt|;
name|io
operator|->
name|io_dmevmask
operator|=
name|ip
operator|->
name|i_d
operator|.
name|di_dmevmask
expr_stmt|;
name|io
operator|->
name|io_dmstate
operator|=
name|ip
operator|->
name|i_d
operator|.
name|di_dmstate
expr_stmt|;
block|}
end_function

begin_function
name|void
name|xfs_iocore_inode_init
parameter_list|(
name|xfs_inode_t
modifier|*
name|ip
parameter_list|)
block|{
name|xfs_iocore_t
modifier|*
name|io
init|=
operator|&
name|ip
operator|->
name|i_iocore
decl_stmt|;
name|xfs_mount_t
modifier|*
name|mp
init|=
name|ip
operator|->
name|i_mount
decl_stmt|;
name|io
operator|->
name|io_mount
operator|=
name|mp
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|io
operator|->
name|io_lock
operator|=
operator|&
name|ip
operator|->
name|i_lock
expr_stmt|;
name|io
operator|->
name|io_iolock
operator|=
operator|&
name|ip
operator|->
name|i_iolock
expr_stmt|;
endif|#
directive|endif
name|io
operator|->
name|io_obj
operator|=
operator|(
name|void
operator|*
operator|)
name|ip
expr_stmt|;
name|xfs_iocore_inode_reinit
argument_list|(
name|ip
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

