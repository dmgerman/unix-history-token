begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|NEED_HPUX_FINDCONFIG
end_ifdef

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/utsname.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_function
specifier|const
name|char
modifier|*
name|FindConfig
parameter_list|(
specifier|const
name|char
modifier|*
name|base
parameter_list|)
block|{
specifier|static
name|char
name|result
index|[
name|BUFSIZ
index|]
decl_stmt|;
name|char
name|hostname
index|[
name|BUFSIZ
index|]
decl_stmt|,
modifier|*
name|cp
decl_stmt|;
name|struct
name|stat
name|sbuf
decl_stmt|;
name|struct
name|utsname
name|unamebuf
decl_stmt|;
comment|/* All keyed by initial target being a directory */
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|result
argument_list|,
name|base
argument_list|)
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|result
argument_list|,
operator|&
name|sbuf
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|S_ISDIR
argument_list|(
name|sbuf
operator|.
name|st_mode
argument_list|)
condition|)
block|{
comment|/* First choice is my hostname */
if|if
condition|(
name|gethostname
argument_list|(
name|hostname
argument_list|,
name|BUFSIZ
argument_list|)
operator|>=
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|result
argument_list|,
literal|"%s/%s"
argument_list|,
name|base
argument_list|,
name|hostname
argument_list|)
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|result
argument_list|,
operator|&
name|sbuf
argument_list|)
operator|==
literal|0
condition|)
block|{
goto|goto
name|outahere
goto|;
block|}
else|else
block|{
comment|/* Second choice is of form default.835 */
operator|(
name|void
operator|)
name|uname
argument_list|(
operator|&
name|unamebuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|unamebuf
operator|.
name|machine
argument_list|,
literal|"9000/"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
name|cp
operator|=
name|unamebuf
operator|.
name|machine
operator|+
literal|5
expr_stmt|;
else|else
name|cp
operator|=
name|unamebuf
operator|.
name|machine
expr_stmt|;
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|result
argument_list|,
literal|"%s/default.%s"
argument_list|,
name|base
argument_list|,
name|cp
argument_list|)
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|result
argument_list|,
operator|&
name|sbuf
argument_list|)
operator|==
literal|0
condition|)
block|{
goto|goto
name|outahere
goto|;
block|}
else|else
block|{
comment|/* Last choice is just default */
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|result
argument_list|,
literal|"%s/default"
argument_list|,
name|base
argument_list|)
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|result
argument_list|,
operator|&
name|sbuf
argument_list|)
operator|==
literal|0
condition|)
block|{
goto|goto
name|outahere
goto|;
block|}
else|else
block|{
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|result
argument_list|,
literal|"/not/found"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
block|}
name|outahere
label|:
return|return
operator|(
name|result
operator|)
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|"ntp_stdlib.h"
end_include

begin_function
specifier|const
name|char
modifier|*
name|FindConfig
parameter_list|(
specifier|const
name|char
modifier|*
name|base
parameter_list|)
block|{
return|return
name|base
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

end_unit

