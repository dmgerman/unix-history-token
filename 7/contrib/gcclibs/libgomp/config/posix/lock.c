begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Copyright (C) 2005 Free Software Foundation, Inc.    Contributed by Richard Henderson<rth@redhat.com>.     This file is part of the GNU OpenMP Library (libgomp).     Libgomp is free software; you can redistribute it and/or modify it    under the terms of the GNU Lesser General Public License as published by    the Free Software Foundation; either version 2.1 of the License, or    (at your option) any later version.     Libgomp is distributed in the hope that it will be useful, but WITHOUT ANY    WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS    FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for    more details.     You should have received a copy of the GNU Lesser General Public License     along with libgomp; see the file COPYING.LIB.  If not, write to the    Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,    MA 02110-1301, USA.  */
end_comment

begin_comment
comment|/* As a special exception, if you link this library with other files, some    of which are compiled with GCC, to produce an executable, this library    does not by itself cause the resulting executable to be covered by the    GNU General Public License.  This exception does not however invalidate    any other reasons why the executable file might be covered by the GNU    General Public License.  */
end_comment

begin_comment
comment|/* This is the default PTHREADS implementation of the public OpenMP    locking primitives.     Because OpenMP uses different entry points for normal and recursive    locks, and pthreads uses only one entry point, a system may be able    to do better and streamline the locking as well as reduce the size    of the types exported.  */
end_comment

begin_comment
comment|/* We need Unix98 extensions to get recursive locks.  On Tru64 UNIX V4.0F,    the declarations are available without _XOPEN_SOURCE, which actually    breaks compilation.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__osf__
end_ifndef

begin_define
define|#
directive|define
name|_XOPEN_SOURCE
value|500
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"libgomp.h"
end_include

begin_function
name|void
name|omp_init_lock
parameter_list|(
name|omp_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_init
argument_list|(
name|lock
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_destroy_lock
parameter_list|(
name|omp_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_destroy
argument_list|(
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_set_lock
parameter_list|(
name|omp_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_lock
argument_list|(
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_unset_lock
parameter_list|(
name|omp_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_unlock
argument_list|(
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|omp_test_lock
parameter_list|(
name|omp_lock_t
modifier|*
name|lock
parameter_list|)
block|{
return|return
name|pthread_mutex_trylock
argument_list|(
name|lock
argument_list|)
operator|==
literal|0
return|;
block|}
end_function

begin_function
name|void
name|omp_init_nest_lock
parameter_list|(
name|omp_nest_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutexattr_t
name|attr
decl_stmt|;
name|pthread_mutexattr_init
argument_list|(
operator|&
name|attr
argument_list|)
expr_stmt|;
name|pthread_mutexattr_settype
argument_list|(
operator|&
name|attr
argument_list|,
name|PTHREAD_MUTEX_RECURSIVE
argument_list|)
expr_stmt|;
name|pthread_mutex_init
argument_list|(
operator|&
name|lock
operator|->
name|lock
argument_list|,
operator|&
name|attr
argument_list|)
expr_stmt|;
name|lock
operator|->
name|count
operator|=
literal|0
expr_stmt|;
name|pthread_mutexattr_destroy
argument_list|(
operator|&
name|attr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_destroy_nest_lock
parameter_list|(
name|omp_nest_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_destroy
argument_list|(
operator|&
name|lock
operator|->
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_set_nest_lock
parameter_list|(
name|omp_nest_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|pthread_mutex_lock
argument_list|(
operator|&
name|lock
operator|->
name|lock
argument_list|)
expr_stmt|;
name|lock
operator|->
name|count
operator|++
expr_stmt|;
block|}
end_function

begin_function
name|void
name|omp_unset_nest_lock
parameter_list|(
name|omp_nest_lock_t
modifier|*
name|lock
parameter_list|)
block|{
name|lock
operator|->
name|count
operator|--
expr_stmt|;
name|pthread_mutex_unlock
argument_list|(
operator|&
name|lock
operator|->
name|lock
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|omp_test_nest_lock
parameter_list|(
name|omp_nest_lock_t
modifier|*
name|lock
parameter_list|)
block|{
if|if
condition|(
name|pthread_mutex_trylock
argument_list|(
operator|&
name|lock
operator|->
name|lock
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|++
name|lock
operator|->
name|count
return|;
return|return
literal|0
return|;
block|}
end_function

begin_macro
name|ialias
argument_list|(
argument|omp_init_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_init_nest_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_destroy_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_destroy_nest_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_set_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_set_nest_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_unset_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_unset_nest_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_test_lock
argument_list|)
end_macro

begin_macro
name|ialias
argument_list|(
argument|omp_test_nest_lock
argument_list|)
end_macro

end_unit

