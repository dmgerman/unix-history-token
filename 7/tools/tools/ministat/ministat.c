begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * ----------------------------------------------------------------------------  * "THE BEER-WARE LICENSE" (Revision 42):  *<phk@FreeBSD.ORG> wrote this file.  As long as you retain this notice you  * can do whatever you want with this stuff. If we meet some day, and you think  * this stuff is worth it, you can buy me a beer in return.   Poul-Henning Kamp  * ----------------------------------------------------------------------------  *  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__FBSDID
argument_list|(
literal|"$FreeBSD$"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<err.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<sys/ioctl.h>
end_include

begin_include
include|#
directive|include
file|<sys/queue.h>
end_include

begin_include
include|#
directive|include
file|<sys/ttycom.h>
end_include

begin_define
define|#
directive|define
name|NSTUDENT
value|100
end_define

begin_define
define|#
directive|define
name|NCONF
value|6
end_define

begin_decl_stmt
name|double
specifier|const
name|studentpct
index|[]
init|=
block|{
literal|80
block|,
literal|90
block|,
literal|95
block|,
literal|98
block|,
literal|99
block|,
literal|99.5
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|double
name|student
index|[
name|NSTUDENT
operator|+
literal|1
index|]
index|[
name|NCONF
index|]
init|=
block|{
comment|/* inf */
block|{
literal|1.282
block|,
literal|1.645
block|,
literal|1.960
block|,
literal|2.326
block|,
literal|2.576
block|,
literal|3.090
block|}
block|,
comment|/* 1. */
block|{
literal|3.078
block|,
literal|6.314
block|,
literal|12.706
block|,
literal|31.821
block|,
literal|63.657
block|,
literal|318.313
block|}
block|,
comment|/* 2. */
block|{
literal|1.886
block|,
literal|2.920
block|,
literal|4.303
block|,
literal|6.965
block|,
literal|9.925
block|,
literal|22.327
block|}
block|,
comment|/* 3. */
block|{
literal|1.638
block|,
literal|2.353
block|,
literal|3.182
block|,
literal|4.541
block|,
literal|5.841
block|,
literal|10.215
block|}
block|,
comment|/* 4. */
block|{
literal|1.533
block|,
literal|2.132
block|,
literal|2.776
block|,
literal|3.747
block|,
literal|4.604
block|,
literal|7.173
block|}
block|,
comment|/* 5. */
block|{
literal|1.476
block|,
literal|2.015
block|,
literal|2.571
block|,
literal|3.365
block|,
literal|4.032
block|,
literal|5.893
block|}
block|,
comment|/* 6. */
block|{
literal|1.440
block|,
literal|1.943
block|,
literal|2.447
block|,
literal|3.143
block|,
literal|3.707
block|,
literal|5.208
block|}
block|,
comment|/* 7. */
block|{
literal|1.415
block|,
literal|1.895
block|,
literal|2.365
block|,
literal|2.998
block|,
literal|3.499
block|,
literal|4.782
block|}
block|,
comment|/* 8. */
block|{
literal|1.397
block|,
literal|1.860
block|,
literal|2.306
block|,
literal|2.896
block|,
literal|3.355
block|,
literal|4.499
block|}
block|,
comment|/* 9. */
block|{
literal|1.383
block|,
literal|1.833
block|,
literal|2.262
block|,
literal|2.821
block|,
literal|3.250
block|,
literal|4.296
block|}
block|,
comment|/* 10. */
block|{
literal|1.372
block|,
literal|1.812
block|,
literal|2.228
block|,
literal|2.764
block|,
literal|3.169
block|,
literal|4.143
block|}
block|,
comment|/* 11. */
block|{
literal|1.363
block|,
literal|1.796
block|,
literal|2.201
block|,
literal|2.718
block|,
literal|3.106
block|,
literal|4.024
block|}
block|,
comment|/* 12. */
block|{
literal|1.356
block|,
literal|1.782
block|,
literal|2.179
block|,
literal|2.681
block|,
literal|3.055
block|,
literal|3.929
block|}
block|,
comment|/* 13. */
block|{
literal|1.350
block|,
literal|1.771
block|,
literal|2.160
block|,
literal|2.650
block|,
literal|3.012
block|,
literal|3.852
block|}
block|,
comment|/* 14. */
block|{
literal|1.345
block|,
literal|1.761
block|,
literal|2.145
block|,
literal|2.624
block|,
literal|2.977
block|,
literal|3.787
block|}
block|,
comment|/* 15. */
block|{
literal|1.341
block|,
literal|1.753
block|,
literal|2.131
block|,
literal|2.602
block|,
literal|2.947
block|,
literal|3.733
block|}
block|,
comment|/* 16. */
block|{
literal|1.337
block|,
literal|1.746
block|,
literal|2.120
block|,
literal|2.583
block|,
literal|2.921
block|,
literal|3.686
block|}
block|,
comment|/* 17. */
block|{
literal|1.333
block|,
literal|1.740
block|,
literal|2.110
block|,
literal|2.567
block|,
literal|2.898
block|,
literal|3.646
block|}
block|,
comment|/* 18. */
block|{
literal|1.330
block|,
literal|1.734
block|,
literal|2.101
block|,
literal|2.552
block|,
literal|2.878
block|,
literal|3.610
block|}
block|,
comment|/* 19. */
block|{
literal|1.328
block|,
literal|1.729
block|,
literal|2.093
block|,
literal|2.539
block|,
literal|2.861
block|,
literal|3.579
block|}
block|,
comment|/* 20. */
block|{
literal|1.325
block|,
literal|1.725
block|,
literal|2.086
block|,
literal|2.528
block|,
literal|2.845
block|,
literal|3.552
block|}
block|,
comment|/* 21. */
block|{
literal|1.323
block|,
literal|1.721
block|,
literal|2.080
block|,
literal|2.518
block|,
literal|2.831
block|,
literal|3.527
block|}
block|,
comment|/* 22. */
block|{
literal|1.321
block|,
literal|1.717
block|,
literal|2.074
block|,
literal|2.508
block|,
literal|2.819
block|,
literal|3.505
block|}
block|,
comment|/* 23. */
block|{
literal|1.319
block|,
literal|1.714
block|,
literal|2.069
block|,
literal|2.500
block|,
literal|2.807
block|,
literal|3.485
block|}
block|,
comment|/* 24. */
block|{
literal|1.318
block|,
literal|1.711
block|,
literal|2.064
block|,
literal|2.492
block|,
literal|2.797
block|,
literal|3.467
block|}
block|,
comment|/* 25. */
block|{
literal|1.316
block|,
literal|1.708
block|,
literal|2.060
block|,
literal|2.485
block|,
literal|2.787
block|,
literal|3.450
block|}
block|,
comment|/* 26. */
block|{
literal|1.315
block|,
literal|1.706
block|,
literal|2.056
block|,
literal|2.479
block|,
literal|2.779
block|,
literal|3.435
block|}
block|,
comment|/* 27. */
block|{
literal|1.314
block|,
literal|1.703
block|,
literal|2.052
block|,
literal|2.473
block|,
literal|2.771
block|,
literal|3.421
block|}
block|,
comment|/* 28. */
block|{
literal|1.313
block|,
literal|1.701
block|,
literal|2.048
block|,
literal|2.467
block|,
literal|2.763
block|,
literal|3.408
block|}
block|,
comment|/* 29. */
block|{
literal|1.311
block|,
literal|1.699
block|,
literal|2.045
block|,
literal|2.462
block|,
literal|2.756
block|,
literal|3.396
block|}
block|,
comment|/* 30. */
block|{
literal|1.310
block|,
literal|1.697
block|,
literal|2.042
block|,
literal|2.457
block|,
literal|2.750
block|,
literal|3.385
block|}
block|,
comment|/* 31. */
block|{
literal|1.309
block|,
literal|1.696
block|,
literal|2.040
block|,
literal|2.453
block|,
literal|2.744
block|,
literal|3.375
block|}
block|,
comment|/* 32. */
block|{
literal|1.309
block|,
literal|1.694
block|,
literal|2.037
block|,
literal|2.449
block|,
literal|2.738
block|,
literal|3.365
block|}
block|,
comment|/* 33. */
block|{
literal|1.308
block|,
literal|1.692
block|,
literal|2.035
block|,
literal|2.445
block|,
literal|2.733
block|,
literal|3.356
block|}
block|,
comment|/* 34. */
block|{
literal|1.307
block|,
literal|1.691
block|,
literal|2.032
block|,
literal|2.441
block|,
literal|2.728
block|,
literal|3.348
block|}
block|,
comment|/* 35. */
block|{
literal|1.306
block|,
literal|1.690
block|,
literal|2.030
block|,
literal|2.438
block|,
literal|2.724
block|,
literal|3.340
block|}
block|,
comment|/* 36. */
block|{
literal|1.306
block|,
literal|1.688
block|,
literal|2.028
block|,
literal|2.434
block|,
literal|2.719
block|,
literal|3.333
block|}
block|,
comment|/* 37. */
block|{
literal|1.305
block|,
literal|1.687
block|,
literal|2.026
block|,
literal|2.431
block|,
literal|2.715
block|,
literal|3.326
block|}
block|,
comment|/* 38. */
block|{
literal|1.304
block|,
literal|1.686
block|,
literal|2.024
block|,
literal|2.429
block|,
literal|2.712
block|,
literal|3.319
block|}
block|,
comment|/* 39. */
block|{
literal|1.304
block|,
literal|1.685
block|,
literal|2.023
block|,
literal|2.426
block|,
literal|2.708
block|,
literal|3.313
block|}
block|,
comment|/* 40. */
block|{
literal|1.303
block|,
literal|1.684
block|,
literal|2.021
block|,
literal|2.423
block|,
literal|2.704
block|,
literal|3.307
block|}
block|,
comment|/* 41. */
block|{
literal|1.303
block|,
literal|1.683
block|,
literal|2.020
block|,
literal|2.421
block|,
literal|2.701
block|,
literal|3.301
block|}
block|,
comment|/* 42. */
block|{
literal|1.302
block|,
literal|1.682
block|,
literal|2.018
block|,
literal|2.418
block|,
literal|2.698
block|,
literal|3.296
block|}
block|,
comment|/* 43. */
block|{
literal|1.302
block|,
literal|1.681
block|,
literal|2.017
block|,
literal|2.416
block|,
literal|2.695
block|,
literal|3.291
block|}
block|,
comment|/* 44. */
block|{
literal|1.301
block|,
literal|1.680
block|,
literal|2.015
block|,
literal|2.414
block|,
literal|2.692
block|,
literal|3.286
block|}
block|,
comment|/* 45. */
block|{
literal|1.301
block|,
literal|1.679
block|,
literal|2.014
block|,
literal|2.412
block|,
literal|2.690
block|,
literal|3.281
block|}
block|,
comment|/* 46. */
block|{
literal|1.300
block|,
literal|1.679
block|,
literal|2.013
block|,
literal|2.410
block|,
literal|2.687
block|,
literal|3.277
block|}
block|,
comment|/* 47. */
block|{
literal|1.300
block|,
literal|1.678
block|,
literal|2.012
block|,
literal|2.408
block|,
literal|2.685
block|,
literal|3.273
block|}
block|,
comment|/* 48. */
block|{
literal|1.299
block|,
literal|1.677
block|,
literal|2.011
block|,
literal|2.407
block|,
literal|2.682
block|,
literal|3.269
block|}
block|,
comment|/* 49. */
block|{
literal|1.299
block|,
literal|1.677
block|,
literal|2.010
block|,
literal|2.405
block|,
literal|2.680
block|,
literal|3.265
block|}
block|,
comment|/* 50. */
block|{
literal|1.299
block|,
literal|1.676
block|,
literal|2.009
block|,
literal|2.403
block|,
literal|2.678
block|,
literal|3.261
block|}
block|,
comment|/* 51. */
block|{
literal|1.298
block|,
literal|1.675
block|,
literal|2.008
block|,
literal|2.402
block|,
literal|2.676
block|,
literal|3.258
block|}
block|,
comment|/* 52. */
block|{
literal|1.298
block|,
literal|1.675
block|,
literal|2.007
block|,
literal|2.400
block|,
literal|2.674
block|,
literal|3.255
block|}
block|,
comment|/* 53. */
block|{
literal|1.298
block|,
literal|1.674
block|,
literal|2.006
block|,
literal|2.399
block|,
literal|2.672
block|,
literal|3.251
block|}
block|,
comment|/* 54. */
block|{
literal|1.297
block|,
literal|1.674
block|,
literal|2.005
block|,
literal|2.397
block|,
literal|2.670
block|,
literal|3.248
block|}
block|,
comment|/* 55. */
block|{
literal|1.297
block|,
literal|1.673
block|,
literal|2.004
block|,
literal|2.396
block|,
literal|2.668
block|,
literal|3.245
block|}
block|,
comment|/* 56. */
block|{
literal|1.297
block|,
literal|1.673
block|,
literal|2.003
block|,
literal|2.395
block|,
literal|2.667
block|,
literal|3.242
block|}
block|,
comment|/* 57. */
block|{
literal|1.297
block|,
literal|1.672
block|,
literal|2.002
block|,
literal|2.394
block|,
literal|2.665
block|,
literal|3.239
block|}
block|,
comment|/* 58. */
block|{
literal|1.296
block|,
literal|1.672
block|,
literal|2.002
block|,
literal|2.392
block|,
literal|2.663
block|,
literal|3.237
block|}
block|,
comment|/* 59. */
block|{
literal|1.296
block|,
literal|1.671
block|,
literal|2.001
block|,
literal|2.391
block|,
literal|2.662
block|,
literal|3.234
block|}
block|,
comment|/* 60. */
block|{
literal|1.296
block|,
literal|1.671
block|,
literal|2.000
block|,
literal|2.390
block|,
literal|2.660
block|,
literal|3.232
block|}
block|,
comment|/* 61. */
block|{
literal|1.296
block|,
literal|1.670
block|,
literal|2.000
block|,
literal|2.389
block|,
literal|2.659
block|,
literal|3.229
block|}
block|,
comment|/* 62. */
block|{
literal|1.295
block|,
literal|1.670
block|,
literal|1.999
block|,
literal|2.388
block|,
literal|2.657
block|,
literal|3.227
block|}
block|,
comment|/* 63. */
block|{
literal|1.295
block|,
literal|1.669
block|,
literal|1.998
block|,
literal|2.387
block|,
literal|2.656
block|,
literal|3.225
block|}
block|,
comment|/* 64. */
block|{
literal|1.295
block|,
literal|1.669
block|,
literal|1.998
block|,
literal|2.386
block|,
literal|2.655
block|,
literal|3.223
block|}
block|,
comment|/* 65. */
block|{
literal|1.295
block|,
literal|1.669
block|,
literal|1.997
block|,
literal|2.385
block|,
literal|2.654
block|,
literal|3.220
block|}
block|,
comment|/* 66. */
block|{
literal|1.295
block|,
literal|1.668
block|,
literal|1.997
block|,
literal|2.384
block|,
literal|2.652
block|,
literal|3.218
block|}
block|,
comment|/* 67. */
block|{
literal|1.294
block|,
literal|1.668
block|,
literal|1.996
block|,
literal|2.383
block|,
literal|2.651
block|,
literal|3.216
block|}
block|,
comment|/* 68. */
block|{
literal|1.294
block|,
literal|1.668
block|,
literal|1.995
block|,
literal|2.382
block|,
literal|2.650
block|,
literal|3.214
block|}
block|,
comment|/* 69. */
block|{
literal|1.294
block|,
literal|1.667
block|,
literal|1.995
block|,
literal|2.382
block|,
literal|2.649
block|,
literal|3.213
block|}
block|,
comment|/* 70. */
block|{
literal|1.294
block|,
literal|1.667
block|,
literal|1.994
block|,
literal|2.381
block|,
literal|2.648
block|,
literal|3.211
block|}
block|,
comment|/* 71. */
block|{
literal|1.294
block|,
literal|1.667
block|,
literal|1.994
block|,
literal|2.380
block|,
literal|2.647
block|,
literal|3.209
block|}
block|,
comment|/* 72. */
block|{
literal|1.293
block|,
literal|1.666
block|,
literal|1.993
block|,
literal|2.379
block|,
literal|2.646
block|,
literal|3.207
block|}
block|,
comment|/* 73. */
block|{
literal|1.293
block|,
literal|1.666
block|,
literal|1.993
block|,
literal|2.379
block|,
literal|2.645
block|,
literal|3.206
block|}
block|,
comment|/* 74. */
block|{
literal|1.293
block|,
literal|1.666
block|,
literal|1.993
block|,
literal|2.378
block|,
literal|2.644
block|,
literal|3.204
block|}
block|,
comment|/* 75. */
block|{
literal|1.293
block|,
literal|1.665
block|,
literal|1.992
block|,
literal|2.377
block|,
literal|2.643
block|,
literal|3.202
block|}
block|,
comment|/* 76. */
block|{
literal|1.293
block|,
literal|1.665
block|,
literal|1.992
block|,
literal|2.376
block|,
literal|2.642
block|,
literal|3.201
block|}
block|,
comment|/* 77. */
block|{
literal|1.293
block|,
literal|1.665
block|,
literal|1.991
block|,
literal|2.376
block|,
literal|2.641
block|,
literal|3.199
block|}
block|,
comment|/* 78. */
block|{
literal|1.292
block|,
literal|1.665
block|,
literal|1.991
block|,
literal|2.375
block|,
literal|2.640
block|,
literal|3.198
block|}
block|,
comment|/* 79. */
block|{
literal|1.292
block|,
literal|1.664
block|,
literal|1.990
block|,
literal|2.374
block|,
literal|2.640
block|,
literal|3.197
block|}
block|,
comment|/* 80. */
block|{
literal|1.292
block|,
literal|1.664
block|,
literal|1.990
block|,
literal|2.374
block|,
literal|2.639
block|,
literal|3.195
block|}
block|,
comment|/* 81. */
block|{
literal|1.292
block|,
literal|1.664
block|,
literal|1.990
block|,
literal|2.373
block|,
literal|2.638
block|,
literal|3.194
block|}
block|,
comment|/* 82. */
block|{
literal|1.292
block|,
literal|1.664
block|,
literal|1.989
block|,
literal|2.373
block|,
literal|2.637
block|,
literal|3.193
block|}
block|,
comment|/* 83. */
block|{
literal|1.292
block|,
literal|1.663
block|,
literal|1.989
block|,
literal|2.372
block|,
literal|2.636
block|,
literal|3.191
block|}
block|,
comment|/* 84. */
block|{
literal|1.292
block|,
literal|1.663
block|,
literal|1.989
block|,
literal|2.372
block|,
literal|2.636
block|,
literal|3.190
block|}
block|,
comment|/* 85. */
block|{
literal|1.292
block|,
literal|1.663
block|,
literal|1.988
block|,
literal|2.371
block|,
literal|2.635
block|,
literal|3.189
block|}
block|,
comment|/* 86. */
block|{
literal|1.291
block|,
literal|1.663
block|,
literal|1.988
block|,
literal|2.370
block|,
literal|2.634
block|,
literal|3.188
block|}
block|,
comment|/* 87. */
block|{
literal|1.291
block|,
literal|1.663
block|,
literal|1.988
block|,
literal|2.370
block|,
literal|2.634
block|,
literal|3.187
block|}
block|,
comment|/* 88. */
block|{
literal|1.291
block|,
literal|1.662
block|,
literal|1.987
block|,
literal|2.369
block|,
literal|2.633
block|,
literal|3.185
block|}
block|,
comment|/* 89. */
block|{
literal|1.291
block|,
literal|1.662
block|,
literal|1.987
block|,
literal|2.369
block|,
literal|2.632
block|,
literal|3.184
block|}
block|,
comment|/* 90. */
block|{
literal|1.291
block|,
literal|1.662
block|,
literal|1.987
block|,
literal|2.368
block|,
literal|2.632
block|,
literal|3.183
block|}
block|,
comment|/* 91. */
block|{
literal|1.291
block|,
literal|1.662
block|,
literal|1.986
block|,
literal|2.368
block|,
literal|2.631
block|,
literal|3.182
block|}
block|,
comment|/* 92. */
block|{
literal|1.291
block|,
literal|1.662
block|,
literal|1.986
block|,
literal|2.368
block|,
literal|2.630
block|,
literal|3.181
block|}
block|,
comment|/* 93. */
block|{
literal|1.291
block|,
literal|1.661
block|,
literal|1.986
block|,
literal|2.367
block|,
literal|2.630
block|,
literal|3.180
block|}
block|,
comment|/* 94. */
block|{
literal|1.291
block|,
literal|1.661
block|,
literal|1.986
block|,
literal|2.367
block|,
literal|2.629
block|,
literal|3.179
block|}
block|,
comment|/* 95. */
block|{
literal|1.291
block|,
literal|1.661
block|,
literal|1.985
block|,
literal|2.366
block|,
literal|2.629
block|,
literal|3.178
block|}
block|,
comment|/* 96. */
block|{
literal|1.290
block|,
literal|1.661
block|,
literal|1.985
block|,
literal|2.366
block|,
literal|2.628
block|,
literal|3.177
block|}
block|,
comment|/* 97. */
block|{
literal|1.290
block|,
literal|1.661
block|,
literal|1.985
block|,
literal|2.365
block|,
literal|2.627
block|,
literal|3.176
block|}
block|,
comment|/* 98. */
block|{
literal|1.290
block|,
literal|1.661
block|,
literal|1.984
block|,
literal|2.365
block|,
literal|2.627
block|,
literal|3.175
block|}
block|,
comment|/* 99. */
block|{
literal|1.290
block|,
literal|1.660
block|,
literal|1.984
block|,
literal|2.365
block|,
literal|2.626
block|,
literal|3.175
block|}
block|,
comment|/* 100. */
block|{
literal|1.290
block|,
literal|1.660
block|,
literal|1.984
block|,
literal|2.364
block|,
literal|2.626
block|,
literal|3.174
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|MAX_DS
value|8
end_define

begin_decl_stmt
specifier|static
name|char
name|symbol
index|[
name|MAX_DS
index|]
init|=
block|{
literal|' '
block|,
literal|'x'
block|,
literal|'+'
block|,
literal|'*'
block|,
literal|'%'
block|,
literal|'#'
block|,
literal|'@'
block|,
literal|'O'
block|}
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|TAILQ_HEAD
argument_list|(
name|pointlist
argument_list|,
name|point
argument_list|)
expr_stmt|;
end_expr_stmt

begin_struct
struct|struct
name|dataset
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|struct
name|pointlist
name|list
decl_stmt|;
name|double
name|sy
decl_stmt|,
name|syy
decl_stmt|;
name|int
name|n
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|struct
name|dataset
modifier|*
name|NewSet
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|dataset
modifier|*
name|ds
decl_stmt|;
name|ds
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
expr|*
name|ds
argument_list|)
expr_stmt|;
name|TAILQ_INIT
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|)
expr_stmt|;
return|return
operator|(
name|ds
operator|)
return|;
block|}
end_function

begin_struct
struct|struct
name|point
block|{
name|TAILQ_ENTRY
argument_list|(
argument|point
argument_list|)
name|list
expr_stmt|;
name|double
name|val
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
name|AddPoint
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|,
name|double
name|a
parameter_list|)
block|{
name|struct
name|point
modifier|*
name|pp
decl_stmt|,
modifier|*
name|pp2
decl_stmt|;
name|pp
operator|=
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
expr|*
name|pp
argument_list|)
expr_stmt|;
name|pp
operator|->
name|val
operator|=
name|a
expr_stmt|;
name|ds
operator|->
name|n
operator|++
expr_stmt|;
name|ds
operator|->
name|sy
operator|+=
name|a
expr_stmt|;
name|ds
operator|->
name|syy
operator|+=
name|a
operator|*
name|a
expr_stmt|;
if|if
condition|(
name|TAILQ_EMPTY
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|)
condition|)
block|{
name|TAILQ_INSERT_HEAD
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|,
name|pp
argument_list|,
name|list
argument_list|)
expr_stmt|;
return|return;
block|}
name|TAILQ_FOREACH
argument_list|(
argument|pp2
argument_list|,
argument|&ds->list
argument_list|,
argument|list
argument_list|)
block|{
if|if
condition|(
name|pp
operator|->
name|val
operator|<
name|pp2
operator|->
name|val
condition|)
block|{
name|TAILQ_INSERT_BEFORE
argument_list|(
name|pp2
argument_list|,
name|pp
argument_list|,
name|list
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|TAILQ_INSERT_TAIL
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|,
name|pp
argument_list|,
name|list
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|double
name|Min
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
return|return
operator|(
name|TAILQ_FIRST
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|)
operator|->
name|val
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|Max
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
return|return
operator|(
name|TAILQ_LAST
argument_list|(
operator|&
name|ds
operator|->
name|list
argument_list|,
name|pointlist
argument_list|)
operator|->
name|val
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|Avg
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
return|return
operator|(
name|ds
operator|->
name|sy
operator|/
name|ds
operator|->
name|n
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|Median
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
name|int
name|even
decl_stmt|,
name|i
decl_stmt|;
name|struct
name|point
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
if|if
condition|(
operator|(
name|ds
operator|->
name|n
operator|%
literal|2
operator|)
operator|==
literal|1
condition|)
block|{
name|i
operator|=
operator|(
name|ds
operator|->
name|n
operator|/
literal|2
operator|)
operator|+
literal|1
expr_stmt|;
name|even
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|i
operator|=
name|ds
operator|->
name|n
operator|/
literal|2
expr_stmt|;
name|even
operator|=
literal|1
expr_stmt|;
block|}
name|TAILQ_FOREACH
argument_list|(
argument|p1
argument_list|,
argument|&ds->list
argument_list|,
argument|list
argument_list|)
block|{
operator|--
name|i
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
name|even
condition|)
block|{
name|p2
operator|=
name|TAILQ_NEXT
argument_list|(
name|p1
argument_list|,
name|list
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|p2
operator|->
name|val
operator|+
name|p1
operator|->
name|val
operator|)
operator|/
literal|2
operator|)
return|;
block|}
return|return
operator|(
name|p1
operator|->
name|val
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|Var
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
return|return
operator|(
name|ds
operator|->
name|syy
operator|-
name|ds
operator|->
name|sy
operator|*
name|ds
operator|->
name|sy
operator|/
name|ds
operator|->
name|n
operator|)
operator|/
operator|(
name|ds
operator|->
name|n
operator|-
literal|1.0
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
name|Stddev
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
return|return
name|sqrt
argument_list|(
name|Var
argument_list|(
name|ds
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|VitalsHead
parameter_list|(
name|void
parameter_list|)
block|{
name|printf
argument_list|(
literal|"    N           Min           Max        Median           Avg        Stddev\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|Vitals
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|,
name|int
name|flag
parameter_list|)
block|{
name|double
name|a
decl_stmt|;
name|printf
argument_list|(
literal|"%c %3d %13.8g %13.8g %13.8g %13.8g %13.8g"
argument_list|,
name|symbol
index|[
name|flag
index|]
argument_list|,
name|ds
operator|->
name|n
argument_list|,
name|Min
argument_list|(
name|ds
argument_list|)
argument_list|,
name|Max
argument_list|(
name|ds
argument_list|)
argument_list|,
name|Median
argument_list|(
name|ds
argument_list|)
argument_list|,
name|Avg
argument_list|(
name|ds
argument_list|)
argument_list|,
name|Stddev
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|Relative
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|,
name|struct
name|dataset
modifier|*
name|rs
parameter_list|,
name|int
name|confidx
parameter_list|)
block|{
name|double
name|spool
decl_stmt|,
name|s
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|,
name|t
decl_stmt|;
name|int
name|i
decl_stmt|,
name|c
decl_stmt|;
name|i
operator|=
name|ds
operator|->
name|n
operator|+
name|rs
operator|->
name|n
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|NSTUDENT
condition|)
name|t
operator|=
name|student
index|[
literal|0
index|]
index|[
name|confidx
index|]
expr_stmt|;
else|else
name|t
operator|=
name|student
index|[
name|i
index|]
index|[
name|confidx
index|]
expr_stmt|;
name|spool
operator|=
operator|(
name|ds
operator|->
name|n
operator|-
literal|1
operator|)
operator|*
name|Var
argument_list|(
name|ds
argument_list|)
operator|+
operator|(
name|rs
operator|->
name|n
operator|-
literal|1
operator|)
operator|*
name|Var
argument_list|(
name|rs
argument_list|)
expr_stmt|;
name|spool
operator|/=
name|ds
operator|->
name|n
operator|+
name|rs
operator|->
name|n
operator|-
literal|2
expr_stmt|;
name|spool
operator|=
name|sqrt
argument_list|(
name|spool
argument_list|)
expr_stmt|;
name|s
operator|=
name|spool
operator|*
name|sqrt
argument_list|(
literal|1.0
operator|/
name|ds
operator|->
name|n
operator|+
literal|1.0
operator|/
name|rs
operator|->
name|n
argument_list|)
expr_stmt|;
name|d
operator|=
name|Avg
argument_list|(
name|ds
argument_list|)
operator|-
name|Avg
argument_list|(
name|rs
argument_list|)
expr_stmt|;
name|e
operator|=
name|t
operator|*
name|s
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|d
argument_list|)
operator|>
name|e
condition|)
block|{
name|printf
argument_list|(
literal|"Difference at %.1f%% confidence\n"
argument_list|,
name|studentpct
index|[
name|confidx
index|]
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"	%g +/- %g\n"
argument_list|,
name|d
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"	%g%% +/- %g%%\n"
argument_list|,
name|d
operator|*
literal|100
operator|/
name|Avg
argument_list|(
name|rs
argument_list|)
argument_list|,
name|e
operator|*
literal|100
operator|/
name|Avg
argument_list|(
name|rs
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"	(Student's t, pooled s = %g)\n"
argument_list|,
name|spool
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"No difference proven at %.1f%% confidence\n"
argument_list|,
name|studentpct
index|[
name|confidx
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_struct
struct|struct
name|plot
block|{
name|double
name|min
decl_stmt|;
name|double
name|max
decl_stmt|;
name|double
name|span
decl_stmt|;
name|int
name|width
decl_stmt|;
name|double
name|x0
decl_stmt|,
name|dx
decl_stmt|;
name|int
name|height
decl_stmt|;
name|char
modifier|*
name|data
decl_stmt|;
name|char
modifier|*
modifier|*
name|bar
decl_stmt|;
name|int
name|separate_bars
decl_stmt|;
name|int
name|num_datasets
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|struct
name|plot
name|plot
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|SetupPlot
parameter_list|(
name|int
name|width
parameter_list|,
name|int
name|separate
parameter_list|,
name|int
name|num_datasets
parameter_list|)
block|{
name|struct
name|plot
modifier|*
name|pl
decl_stmt|;
name|pl
operator|=
operator|&
name|plot
expr_stmt|;
name|pl
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|pl
operator|->
name|height
operator|=
literal|0
expr_stmt|;
name|pl
operator|->
name|data
operator|=
name|NULL
expr_stmt|;
name|pl
operator|->
name|bar
operator|=
name|NULL
expr_stmt|;
name|pl
operator|->
name|separate_bars
operator|=
name|separate
expr_stmt|;
name|pl
operator|->
name|num_datasets
operator|=
name|num_datasets
expr_stmt|;
name|pl
operator|->
name|min
operator|=
literal|999e99
expr_stmt|;
name|pl
operator|->
name|max
operator|=
operator|-
literal|999e99
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|AdjPlot
parameter_list|(
name|double
name|a
parameter_list|)
block|{
name|struct
name|plot
modifier|*
name|pl
decl_stmt|;
name|pl
operator|=
operator|&
name|plot
expr_stmt|;
if|if
condition|(
name|a
operator|<
name|pl
operator|->
name|min
condition|)
name|pl
operator|->
name|min
operator|=
name|a
expr_stmt|;
if|if
condition|(
name|a
operator|>
name|pl
operator|->
name|max
condition|)
name|pl
operator|->
name|max
operator|=
name|a
expr_stmt|;
name|pl
operator|->
name|span
operator|=
name|pl
operator|->
name|max
operator|-
name|pl
operator|->
name|min
expr_stmt|;
name|pl
operator|->
name|dx
operator|=
name|pl
operator|->
name|span
operator|/
operator|(
name|pl
operator|->
name|width
operator|-
literal|1.0
operator|)
expr_stmt|;
name|pl
operator|->
name|x0
operator|=
name|pl
operator|->
name|min
operator|-
literal|.5
operator|*
name|pl
operator|->
name|dx
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|DimPlot
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|)
block|{
name|AdjPlot
argument_list|(
name|Min
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|AdjPlot
argument_list|(
name|Max
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|AdjPlot
argument_list|(
name|Avg
argument_list|(
name|ds
argument_list|)
operator|-
name|Stddev
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
name|AdjPlot
argument_list|(
name|Avg
argument_list|(
name|ds
argument_list|)
operator|+
name|Stddev
argument_list|(
name|ds
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|PlotSet
parameter_list|(
name|struct
name|dataset
modifier|*
name|ds
parameter_list|,
name|int
name|val
parameter_list|)
block|{
name|struct
name|plot
modifier|*
name|pl
decl_stmt|;
name|struct
name|point
modifier|*
name|pp
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|m
decl_stmt|,
name|x
decl_stmt|;
name|int
name|bar
decl_stmt|;
name|pl
operator|=
operator|&
name|plot
expr_stmt|;
if|if
condition|(
name|pl
operator|->
name|span
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
name|pl
operator|->
name|separate_bars
condition|)
name|bar
operator|=
name|val
operator|-
literal|1
expr_stmt|;
else|else
name|bar
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pl
operator|->
name|bar
operator|==
name|NULL
condition|)
block|{
name|pl
operator|->
name|bar
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|pl
operator|->
name|num_datasets
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|pl
operator|->
name|bar
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|pl
operator|->
name|num_datasets
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pl
operator|->
name|bar
index|[
name|bar
index|]
operator|==
name|NULL
condition|)
block|{
name|pl
operator|->
name|bar
index|[
name|bar
index|]
operator|=
name|malloc
argument_list|(
name|pl
operator|->
name|width
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|pl
operator|->
name|bar
index|[
name|bar
index|]
argument_list|,
literal|0
argument_list|,
name|pl
operator|->
name|width
argument_list|)
expr_stmt|;
block|}
name|m
operator|=
literal|1
expr_stmt|;
name|i
operator|=
operator|-
literal|1
expr_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|pp
argument_list|,
argument|&ds->list
argument_list|,
argument|list
argument_list|)
block|{
name|x
operator|=
operator|(
name|pp
operator|->
name|val
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
if|if
condition|(
name|x
operator|==
name|i
condition|)
block|{
name|j
operator|++
expr_stmt|;
if|if
condition|(
name|j
operator|>
name|m
condition|)
name|m
operator|=
name|j
expr_stmt|;
block|}
else|else
block|{
name|j
operator|=
literal|1
expr_stmt|;
name|i
operator|=
name|x
expr_stmt|;
block|}
block|}
name|m
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
name|m
operator|>
name|pl
operator|->
name|height
condition|)
block|{
name|pl
operator|->
name|data
operator|=
name|realloc
argument_list|(
name|pl
operator|->
name|data
argument_list|,
name|pl
operator|->
name|width
operator|*
name|m
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|pl
operator|->
name|data
operator|+
name|pl
operator|->
name|height
operator|*
name|pl
operator|->
name|width
argument_list|,
literal|0
argument_list|,
operator|(
name|m
operator|-
name|pl
operator|->
name|height
operator|)
operator|*
name|pl
operator|->
name|width
argument_list|)
expr_stmt|;
block|}
name|pl
operator|->
name|height
operator|=
name|m
expr_stmt|;
name|i
operator|=
operator|-
literal|1
expr_stmt|;
name|TAILQ_FOREACH
argument_list|(
argument|pp
argument_list|,
argument|&ds->list
argument_list|,
argument|list
argument_list|)
block|{
name|x
operator|=
operator|(
name|pp
operator|->
name|val
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
if|if
condition|(
name|x
operator|==
name|i
condition|)
block|{
name|j
operator|++
expr_stmt|;
block|}
else|else
block|{
name|j
operator|=
literal|1
expr_stmt|;
name|i
operator|=
name|x
expr_stmt|;
block|}
name|pl
operator|->
name|data
index|[
name|j
operator|*
name|pl
operator|->
name|width
operator|+
name|x
index|]
operator||=
name|val
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|isnan
argument_list|(
name|Stddev
argument_list|(
name|ds
argument_list|)
argument_list|)
condition|)
block|{
name|x
operator|=
operator|(
operator|(
name|Avg
argument_list|(
name|ds
argument_list|)
operator|-
name|Stddev
argument_list|(
name|ds
argument_list|)
operator|)
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
name|m
operator|=
operator|(
operator|(
name|Avg
argument_list|(
name|ds
argument_list|)
operator|+
name|Stddev
argument_list|(
name|ds
argument_list|)
operator|)
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|m
index|]
operator|=
literal|'|'
expr_stmt|;
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|x
index|]
operator|=
literal|'|'
expr_stmt|;
for|for
control|(
name|i
operator|=
name|x
operator|+
literal|1
init|;
name|i
operator|<
name|m
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|i
index|]
operator|==
literal|0
condition|)
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|i
index|]
operator|=
literal|'_'
expr_stmt|;
block|}
name|x
operator|=
operator|(
name|Median
argument_list|(
name|ds
argument_list|)
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|x
index|]
operator|=
literal|'M'
expr_stmt|;
name|x
operator|=
operator|(
name|Avg
argument_list|(
name|ds
argument_list|)
operator|-
name|pl
operator|->
name|x0
operator|)
operator|/
name|pl
operator|->
name|dx
expr_stmt|;
name|pl
operator|->
name|bar
index|[
name|bar
index|]
index|[
name|x
index|]
operator|=
literal|'A'
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|DumpPlot
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|plot
modifier|*
name|pl
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|pl
operator|=
operator|&
name|plot
expr_stmt|;
if|if
condition|(
name|pl
operator|->
name|span
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"[no plot, span is zero width]\n"
argument_list|)
expr_stmt|;
return|return;
block|}
name|putchar
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pl
operator|->
name|width
condition|;
name|i
operator|++
control|)
name|putchar
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|pl
operator|->
name|height
condition|;
name|i
operator|++
control|)
block|{
name|putchar
argument_list|(
literal|'|'
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|pl
operator|->
name|width
condition|;
name|j
operator|++
control|)
block|{
name|k
operator|=
name|pl
operator|->
name|data
index|[
operator|(
name|pl
operator|->
name|height
operator|-
name|i
operator|)
operator|*
name|pl
operator|->
name|width
operator|+
name|j
index|]
expr_stmt|;
if|if
condition|(
name|k
operator|>=
literal|0
operator|&&
name|k
operator|<
name|MAX_DS
condition|)
name|putchar
argument_list|(
name|symbol
index|[
name|k
index|]
argument_list|)
expr_stmt|;
else|else
name|printf
argument_list|(
literal|"[%02x]"
argument_list|,
name|k
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'|'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pl
operator|->
name|num_datasets
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|pl
operator|->
name|bar
index|[
name|i
index|]
operator|==
name|NULL
condition|)
continue|continue;
name|putchar
argument_list|(
literal|'|'
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|pl
operator|->
name|width
condition|;
name|j
operator|++
control|)
block|{
name|k
operator|=
name|pl
operator|->
name|bar
index|[
name|i
index|]
index|[
name|j
index|]
expr_stmt|;
if|if
condition|(
name|k
operator|==
literal|0
condition|)
name|k
operator|=
literal|' '
expr_stmt|;
name|putchar
argument_list|(
name|k
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'|'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
name|putchar
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pl
operator|->
name|width
condition|;
name|i
operator|++
control|)
name|putchar
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'+'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|struct
name|dataset
modifier|*
name|ReadSet
parameter_list|(
name|char
modifier|*
name|n
parameter_list|,
name|int
name|column
parameter_list|,
name|char
modifier|*
name|delim
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
name|BUFSIZ
index|]
decl_stmt|,
modifier|*
name|p
decl_stmt|,
modifier|*
name|t
decl_stmt|;
name|struct
name|dataset
modifier|*
name|s
decl_stmt|;
name|double
name|d
decl_stmt|;
name|int
name|line
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|n
operator|==
name|NULL
condition|)
block|{
name|f
operator|=
name|stdin
expr_stmt|;
name|n
operator|=
literal|"<stdin>"
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|n
argument_list|,
literal|"-"
argument_list|)
condition|)
block|{
name|f
operator|=
name|stdin
expr_stmt|;
name|n
operator|=
literal|"<stdin>"
expr_stmt|;
block|}
else|else
block|{
name|f
operator|=
name|fopen
argument_list|(
name|n
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
name|err
argument_list|(
literal|1
argument_list|,
literal|"Cannot open %s"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|s
operator|=
name|NewSet
argument_list|()
expr_stmt|;
name|s
operator|->
name|name
operator|=
name|strdup
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|line
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
name|buf
argument_list|,
name|f
argument_list|)
operator|!=
name|NULL
condition|)
block|{
name|line
operator|++
expr_stmt|;
name|i
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
index|[
name|i
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
name|buf
index|[
name|i
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
operator|,
name|t
operator|=
name|strtok
argument_list|(
name|buf
argument_list|,
name|delim
argument_list|)
init|;
name|t
operator|!=
name|NULL
operator|&&
operator|*
name|t
operator|!=
literal|'#'
condition|;
name|i
operator|++
operator|,
name|t
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
name|delim
argument_list|)
control|)
block|{
if|if
condition|(
name|i
operator|==
name|column
condition|)
break|break;
block|}
if|if
condition|(
name|t
operator|==
name|NULL
operator|||
operator|*
name|t
operator|==
literal|'#'
condition|)
continue|continue;
name|d
operator|=
name|strtod
argument_list|(
name|t
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|err
argument_list|(
literal|2
argument_list|,
literal|"Invalid data on line %d in %s\n"
argument_list|,
name|line
argument_list|,
name|n
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|buf
operator|!=
literal|'\0'
condition|)
name|AddPoint
argument_list|(
name|s
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|->
name|n
operator|<
literal|3
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Dataset %s must contain at least 3 data points\n"
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|s
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|usage
parameter_list|(
name|char
specifier|const
modifier|*
name|whine
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s\n"
argument_list|,
name|whine
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Usage: ministat [-C column] [-c confidence] [-d delimiter(s)] [-ns] [-w width] [file [file ...]]\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\tconfidence = {"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCONF
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"%s%g%%"
argument_list|,
name|i
condition|?
literal|", "
else|:
literal|""
argument_list|,
name|studentpct
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-C : column number to extract (starts and defaults to 1)\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-d : delimiter(s) string, default to \" \\t\"\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-n : print summary statistics only, no graph/test\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-s : print avg/median/stddev bars on separate lines\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\t-w : width of graph/test output (default 74 or terminal width)\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|struct
name|dataset
modifier|*
name|ds
index|[
literal|7
index|]
decl_stmt|;
name|int
name|nds
decl_stmt|;
name|double
name|a
decl_stmt|;
name|char
modifier|*
name|delim
init|=
literal|" \t"
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|c
decl_stmt|,
name|i
decl_stmt|,
name|ci
decl_stmt|;
name|int
name|column
init|=
literal|1
decl_stmt|;
name|int
name|flag_s
init|=
literal|0
decl_stmt|;
name|int
name|flag_n
init|=
literal|0
decl_stmt|;
name|int
name|termwidth
init|=
literal|74
decl_stmt|;
if|if
condition|(
name|isatty
argument_list|(
name|STDOUT_FILENO
argument_list|)
condition|)
block|{
name|struct
name|winsize
name|wsz
decl_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|getenv
argument_list|(
literal|"COLUMNS"
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|termwidth
operator|=
name|atoi
argument_list|(
name|p
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ioctl
argument_list|(
name|STDOUT_FILENO
argument_list|,
name|TIOCGWINSZ
argument_list|,
operator|&
name|wsz
argument_list|)
operator|!=
operator|-
literal|1
operator|&&
name|wsz
operator|.
name|ws_col
operator|>
literal|0
condition|)
name|termwidth
operator|=
name|wsz
operator|.
name|ws_col
operator|-
literal|2
expr_stmt|;
block|}
name|ci
operator|=
operator|-
literal|1
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getopt
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"C:c:d:snw:"
argument_list|)
operator|)
operator|!=
operator|-
literal|1
condition|)
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'C'
case|:
name|column
operator|=
name|strtol
argument_list|(
name|optarg
argument_list|,
operator|&
name|p
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|usage
argument_list|(
literal|"Invalid column number."
argument_list|)
expr_stmt|;
if|if
condition|(
name|column
operator|<=
literal|0
condition|)
name|usage
argument_list|(
literal|"Column number should be positive."
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'c'
case|:
name|a
operator|=
name|strtod
argument_list|(
name|optarg
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|usage
argument_list|(
literal|"Not a floating point number"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NCONF
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|a
operator|==
name|studentpct
index|[
name|i
index|]
condition|)
name|ci
operator|=
name|i
expr_stmt|;
if|if
condition|(
name|ci
operator|==
operator|-
literal|1
condition|)
name|usage
argument_list|(
literal|"No support for confidence level"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'d'
case|:
if|if
condition|(
operator|*
name|optarg
operator|==
literal|'\0'
condition|)
name|usage
argument_list|(
literal|"Can't use empty delimiter string"
argument_list|)
expr_stmt|;
name|delim
operator|=
name|optarg
expr_stmt|;
break|break;
case|case
literal|'n'
case|:
name|flag_n
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|flag_s
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|'w'
case|:
name|termwidth
operator|=
name|strtol
argument_list|(
name|optarg
argument_list|,
operator|&
name|p
argument_list|,
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|usage
argument_list|(
literal|"Invalid width, not a number."
argument_list|)
expr_stmt|;
if|if
condition|(
name|termwidth
operator|<
literal|0
condition|)
name|usage
argument_list|(
literal|"Unable to move beyond left margin."
argument_list|)
expr_stmt|;
break|break;
default|default:
name|usage
argument_list|(
literal|"Unknown option"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|ci
operator|==
operator|-
literal|1
condition|)
name|ci
operator|=
literal|2
expr_stmt|;
name|argc
operator|-=
name|optind
expr_stmt|;
name|argv
operator|+=
name|optind
expr_stmt|;
if|if
condition|(
name|argc
operator|==
literal|0
condition|)
block|{
name|ds
index|[
literal|0
index|]
operator|=
name|ReadSet
argument_list|(
literal|"-"
argument_list|,
name|column
argument_list|,
name|delim
argument_list|)
expr_stmt|;
name|nds
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|argc
operator|>
operator|(
name|MAX_DS
operator|-
literal|1
operator|)
condition|)
name|usage
argument_list|(
literal|"Too many datasets."
argument_list|)
expr_stmt|;
name|nds
operator|=
name|argc
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nds
condition|;
name|i
operator|++
control|)
name|ds
index|[
name|i
index|]
operator|=
name|ReadSet
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|,
name|column
argument_list|,
name|delim
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nds
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|"%c %s\n"
argument_list|,
name|symbol
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
name|ds
index|[
name|i
index|]
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|flag_n
condition|)
block|{
name|SetupPlot
argument_list|(
name|termwidth
argument_list|,
name|flag_s
argument_list|,
name|nds
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nds
condition|;
name|i
operator|++
control|)
name|DimPlot
argument_list|(
name|ds
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nds
condition|;
name|i
operator|++
control|)
name|PlotSet
argument_list|(
name|ds
index|[
name|i
index|]
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|DumpPlot
argument_list|()
expr_stmt|;
block|}
name|VitalsHead
argument_list|()
expr_stmt|;
name|Vitals
argument_list|(
name|ds
index|[
literal|0
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|nds
condition|;
name|i
operator|++
control|)
block|{
name|Vitals
argument_list|(
name|ds
index|[
name|i
index|]
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|flag_n
condition|)
name|Relative
argument_list|(
name|ds
index|[
name|i
index|]
argument_list|,
name|ds
index|[
literal|0
index|]
argument_list|,
name|ci
argument_list|)
expr_stmt|;
block|}
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

