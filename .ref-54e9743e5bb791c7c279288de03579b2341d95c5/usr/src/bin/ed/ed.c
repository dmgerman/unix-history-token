begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*-  * Copyright (c) 1991 The Regents of the University of California.  * All rights reserved.  *  * %sccs.include.proprietary.c%  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
name|char
name|copyright
index|[]
init|=
literal|"@(#) Copyright (c) 1991 The Regents of the University of California.\n\  All rights reserved.\n"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
name|sccsid
index|[]
init|=
literal|"@(#)ed.c	5.2 (Berkeley) %G%"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_comment
comment|/*  * Editor  */
end_comment

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<sys/wait.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_undef
undef|#
directive|undef
name|CEOF
end_undef

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<setjmp.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"pathnames.h"
end_include

begin_define
define|#
directive|define
name|NULL
value|0
end_define

begin_define
define|#
directive|define
name|LBSIZE
value|512
end_define

begin_define
define|#
directive|define
name|ESIZE
value|128
end_define

begin_define
define|#
directive|define
name|GBSIZE
value|256
end_define

begin_define
define|#
directive|define
name|NBRA
value|5
end_define

begin_define
define|#
directive|define
name|EOF
value|-1
end_define

begin_define
define|#
directive|define
name|CBRA
value|1
end_define

begin_define
define|#
directive|define
name|CCHR
value|2
end_define

begin_define
define|#
directive|define
name|CDOT
value|4
end_define

begin_define
define|#
directive|define
name|CCL
value|6
end_define

begin_define
define|#
directive|define
name|NCCL
value|8
end_define

begin_define
define|#
directive|define
name|CDOL
value|10
end_define

begin_define
define|#
directive|define
name|CEOF
value|11
end_define

begin_define
define|#
directive|define
name|CKET
value|12
end_define

begin_define
define|#
directive|define
name|CBACK
value|14
end_define

begin_define
define|#
directive|define
name|STAR
value|01
end_define

begin_decl_stmt
name|char
name|Q
index|[]
init|=
literal|""
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|T
index|[]
init|=
literal|"TMP"
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|READ
value|0
end_define

begin_define
define|#
directive|define
name|WRITE
value|1
end_define

begin_decl_stmt
name|int
name|peekc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lastc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|savedfile
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|file
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|linebuf
index|[
name|LBSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|rhsbuf
index|[
name|LBSIZE
operator|/
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|expbuf
index|[
name|ESIZE
operator|+
literal|4
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|circfl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|zero
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|dot
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|dol
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|addr1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|addr2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|genbuf
index|[
name|LBSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|long
name|count
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|nextip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|linebp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ninbuf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|io
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sig_t
name|oldhup
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|sig_t
name|oldquit
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|vflag
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|listf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|col
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|globp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tfile
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tline
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|tfname
index|[
sizeof|sizeof
argument_list|(
name|_PATH_TMP
argument_list|)
operator|+
literal|20
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|loc1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|loc2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|locs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ibuff
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|iblock
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|obuff
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|oblock
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ichanged
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nleft
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|WRERR
index|[]
init|=
literal|"WRITE ERROR"
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|names
index|[
literal|26
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|anymarks
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|braslist
index|[
name|NBRA
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|braelist
index|[
name|NBRA
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nbra
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|subnewa
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|subolda
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|fchange
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|wrapp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|unsigned
name|nlall
init|=
literal|128
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
modifier|*
name|address
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|getline
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|getblock
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|place
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|jmp_buf
name|savej
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|void
name|onintr
argument_list|()
decl_stmt|,
name|quit
argument_list|()
decl_stmt|,
name|onhup
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
name|sig_t
name|oldintr
decl_stmt|;
name|oldquit
operator|=
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|oldhup
operator|=
name|signal
argument_list|(
name|SIGHUP
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
name|oldintr
operator|=
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|int
operator|)
name|signal
argument_list|(
name|SIGTERM
argument_list|,
name|SIG_IGN
argument_list|)
operator|==
literal|0
condition|)
name|signal
argument_list|(
name|SIGTERM
argument_list|,
name|quit
argument_list|)
expr_stmt|;
name|argv
operator|++
expr_stmt|;
while|while
condition|(
name|argc
operator|>
literal|1
operator|&&
operator|*
operator|*
name|argv
operator|==
literal|'-'
condition|)
block|{
switch|switch
condition|(
operator|(
operator|*
name|argv
operator|)
index|[
literal|1
index|]
condition|)
block|{
case|case
literal|'\0'
case|:
name|vflag
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|'q'
case|:
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|SIG_DFL
argument_list|)
expr_stmt|;
name|vflag
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|p1
operator|=
operator|*
name|argv
expr_stmt|;
name|p2
operator|=
name|savedfile
expr_stmt|;
while|while
condition|(
operator|*
name|p2
operator|++
operator|=
operator|*
name|p1
operator|++
condition|)
empty_stmt|;
name|globp
operator|=
literal|"r"
expr_stmt|;
block|}
name|zero
operator|=
operator|(
name|int
operator|*
operator|)
name|malloc
argument_list|(
name|nlall
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strcpy
argument_list|(
name|tfname
argument_list|,
name|_PATH_TMP
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strcat
argument_list|(
name|tfname
argument_list|,
literal|"_edXXXXXX"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mktemp
argument_list|(
name|tfname
argument_list|)
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|oldintr
operator|&
literal|01
operator|)
operator|==
literal|0
condition|)
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|oldhup
operator|&
literal|01
operator|)
operator|==
literal|0
condition|)
name|signal
argument_list|(
name|SIGHUP
argument_list|,
name|onhup
argument_list|)
expr_stmt|;
name|setjmp
argument_list|(
name|savej
argument_list|)
expr_stmt|;
name|commands
argument_list|()
expr_stmt|;
name|quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|commands
argument_list|()
end_macro

begin_block
block|{
name|int
name|getfile
argument_list|()
decl_stmt|,
name|gettty
argument_list|()
decl_stmt|;
specifier|register
operator|*
name|a1
operator|,
name|c
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|pflag
condition|)
block|{
name|pflag
operator|=
literal|0
expr_stmt|;
name|addr1
operator|=
name|addr2
operator|=
name|dot
expr_stmt|;
goto|goto
name|print
goto|;
block|}
name|addr1
operator|=
literal|0
expr_stmt|;
name|addr2
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|addr1
operator|=
name|addr2
expr_stmt|;
if|if
condition|(
operator|(
name|a1
operator|=
name|address
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
break|break;
block|}
name|addr2
operator|=
name|a1
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|';'
condition|)
block|{
name|c
operator|=
literal|','
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
block|}
block|}
do|while
condition|(
name|c
operator|==
literal|','
condition|)
do|;
if|if
condition|(
name|addr1
operator|==
literal|0
condition|)
name|addr1
operator|=
name|addr2
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'a'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'c'
case|:
name|delete
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr1
operator|-
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'d'
case|:
name|delete
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'E'
case|:
name|fchange
operator|=
literal|0
expr_stmt|;
name|c
operator|=
literal|'e'
expr_stmt|;
case|case
literal|'e'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
if|if
condition|(
name|vflag
operator|&&
name|fchange
condition|)
block|{
name|fchange
operator|=
literal|0
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
name|filename
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
name|addr2
operator|=
name|zero
expr_stmt|;
goto|goto
name|caseread
goto|;
case|case
literal|'f'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
name|filename
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|puts
argument_list|(
name|savedfile
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'g'
case|:
name|global
argument_list|(
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'i'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr2
operator|-
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'j'
case|:
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
block|{
name|addr1
operator|=
name|dot
expr_stmt|;
name|addr2
operator|=
name|dot
operator|+
literal|1
expr_stmt|;
block|}
name|setdot
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|join
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'k'
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|<
literal|'a'
operator|||
name|c
operator|>
literal|'z'
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|names
index|[
name|c
operator|-
literal|'a'
index|]
operator|=
operator|*
name|addr2
operator|&
operator|~
literal|01
expr_stmt|;
name|anymarks
operator||=
literal|01
expr_stmt|;
continue|continue;
case|case
literal|'m'
case|:
name|move
argument_list|(
literal|0
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'\n'
case|:
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
name|addr2
operator|=
name|dot
operator|+
literal|1
expr_stmt|;
name|addr1
operator|=
name|addr2
expr_stmt|;
goto|goto
name|print
goto|;
case|case
literal|'l'
case|:
name|listf
operator|++
expr_stmt|;
case|case
literal|'p'
case|:
case|case
literal|'P'
case|:
name|newline
argument_list|()
expr_stmt|;
name|print
label|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|a1
operator|=
name|addr1
expr_stmt|;
do|do
block|{
name|puts
argument_list|(
name|getline
argument_list|(
operator|*
name|a1
operator|++
argument_list|)
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|a1
operator|<=
name|addr2
condition|)
do|;
name|dot
operator|=
name|addr2
expr_stmt|;
name|listf
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|'Q'
case|:
name|fchange
operator|=
literal|0
expr_stmt|;
case|case
literal|'q'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|quit
argument_list|()
expr_stmt|;
case|case
literal|'r'
case|:
name|filename
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|caseread
label|:
if|if
condition|(
operator|(
name|io
operator|=
name|open
argument_list|(
name|file
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
argument_list|(
name|file
argument_list|)
expr_stmt|;
block|}
name|setall
argument_list|()
expr_stmt|;
name|ninbuf
operator|=
literal|0
expr_stmt|;
name|c
operator|=
name|zero
operator|!=
name|dol
expr_stmt|;
name|append
argument_list|(
name|getfile
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
name|exfile
argument_list|()
expr_stmt|;
name|fchange
operator|=
name|c
expr_stmt|;
continue|continue;
case|case
literal|'s'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|substitute
argument_list|(
name|globp
operator|!=
literal|0
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'t'
case|:
name|move
argument_list|(
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'u'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|addr2
operator|&
operator|~
literal|01
operator|)
operator|!=
name|subnewa
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
operator|*
name|addr2
operator|=
name|subolda
expr_stmt|;
name|dot
operator|=
name|addr2
expr_stmt|;
continue|continue;
case|case
literal|'v'
case|:
name|global
argument_list|(
literal|0
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'W'
case|:
name|wrapp
operator|++
expr_stmt|;
case|case
literal|'w'
case|:
name|setall
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|filename
argument_list|(
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|wrapp
operator|||
operator|(
operator|(
name|io
operator|=
name|open
argument_list|(
name|file
argument_list|,
literal|1
argument_list|)
operator|)
operator|==
operator|-
literal|1
operator|)
operator|||
operator|(
operator|(
name|lseek
argument_list|(
name|io
argument_list|,
literal|0L
argument_list|,
literal|2
argument_list|)
operator|)
operator|==
operator|-
literal|1
operator|)
condition|)
if|if
condition|(
operator|(
name|io
operator|=
name|creat
argument_list|(
name|file
argument_list|,
literal|0666
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|error
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|wrapp
operator|=
literal|0
expr_stmt|;
name|putfile
argument_list|()
expr_stmt|;
name|exfile
argument_list|()
expr_stmt|;
if|if
condition|(
name|addr1
operator|==
name|zero
operator|+
literal|1
operator|&&
name|addr2
operator|==
name|dol
condition|)
name|fchange
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|'='
case|:
name|setall
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|count
operator|=
operator|(
name|addr2
operator|-
name|zero
operator|)
operator|&
literal|077777
expr_stmt|;
name|putd
argument_list|()
expr_stmt|;
name|putchr
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'!'
case|:
name|callunix
argument_list|()
expr_stmt|;
continue|continue;
case|case
name|EOF
case|:
return|return;
block|}
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
name|int
modifier|*
name|address
parameter_list|()
block|{
specifier|register
operator|*
name|a1
operator|,
name|minus
operator|,
name|c
expr_stmt|;
name|int
name|n
decl_stmt|,
name|relerr
decl_stmt|;
name|minus
operator|=
literal|0
expr_stmt|;
name|a1
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
if|if
condition|(
literal|'0'
operator|<=
name|c
operator|&&
name|c
operator|<=
literal|'9'
condition|)
block|{
name|n
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|n
operator|*=
literal|10
expr_stmt|;
name|n
operator|+=
name|c
operator|-
literal|'0'
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|>=
literal|'0'
operator|&&
name|c
operator|<=
literal|'9'
condition|)
do|;
name|peekc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|zero
expr_stmt|;
if|if
condition|(
name|minus
operator|<
literal|0
condition|)
name|n
operator|=
operator|-
name|n
expr_stmt|;
name|a1
operator|+=
name|n
expr_stmt|;
name|minus
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
name|relerr
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|a1
operator|||
name|minus
condition|)
name|relerr
operator|++
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|' '
case|:
case|case
literal|'\t'
case|:
continue|continue;
case|case
literal|'+'
case|:
name|minus
operator|++
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|dot
expr_stmt|;
continue|continue;
case|case
literal|'-'
case|:
case|case
literal|'^'
case|:
name|minus
operator|--
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|dot
expr_stmt|;
continue|continue;
case|case
literal|'?'
case|:
case|case
literal|'/'
case|:
name|compile
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|a1
operator|=
name|dot
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|c
operator|==
literal|'/'
condition|)
block|{
name|a1
operator|++
expr_stmt|;
if|if
condition|(
name|a1
operator|>
name|dol
condition|)
name|a1
operator|=
name|zero
expr_stmt|;
block|}
else|else
block|{
name|a1
operator|--
expr_stmt|;
if|if
condition|(
name|a1
operator|<
name|zero
condition|)
name|a1
operator|=
name|dol
expr_stmt|;
block|}
if|if
condition|(
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
condition|)
break|break;
if|if
condition|(
name|a1
operator|==
name|dot
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|'$'
case|:
name|a1
operator|=
name|dol
expr_stmt|;
break|break;
case|case
literal|'.'
case|:
name|a1
operator|=
name|dot
expr_stmt|;
break|break;
case|case
literal|'\''
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|<
literal|'a'
operator|||
name|c
operator|>
literal|'z'
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
if|if
condition|(
name|names
index|[
name|c
operator|-
literal|'a'
index|]
operator|==
operator|(
operator|*
name|a1
operator|&
operator|~
literal|01
operator|)
condition|)
break|break;
break|break;
default|default:
name|peekc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|a1
operator|+=
name|minus
expr_stmt|;
if|if
condition|(
name|a1
operator|<
name|zero
operator|||
name|a1
operator|>
name|dol
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
return|return
operator|(
name|a1
operator|)
return|;
block|}
if|if
condition|(
name|relerr
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_macro
name|setdot
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
name|addr1
operator|=
name|addr2
operator|=
name|dot
expr_stmt|;
if|if
condition|(
name|addr1
operator|>
name|addr2
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|setall
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
block|{
name|addr1
operator|=
name|zero
operator|+
literal|1
expr_stmt|;
name|addr2
operator|=
name|dol
expr_stmt|;
if|if
condition|(
name|dol
operator|==
name|zero
condition|)
name|addr1
operator|=
name|zero
expr_stmt|;
block|}
name|setdot
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|setnoaddr
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|nonzero
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr1
operator|<=
name|zero
operator|||
name|addr2
operator|>
name|dol
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|newline
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'\n'
condition|)
return|return;
if|if
condition|(
name|c
operator|==
literal|'p'
operator|||
name|c
operator|==
literal|'l'
condition|)
block|{
name|pflag
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'l'
condition|)
name|listf
operator|++
expr_stmt|;
if|if
condition|(
name|getchr
argument_list|()
operator|==
literal|'\n'
condition|)
return|return;
block|}
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|filename
argument_list|(
argument|comm
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
specifier|register
name|c
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
operator|||
name|c
operator|==
name|EOF
condition|)
block|{
name|p1
operator|=
name|savedfile
expr_stmt|;
if|if
condition|(
operator|*
name|p1
operator|==
literal|0
operator|&&
name|comm
operator|!=
literal|'f'
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|p2
operator|=
name|file
expr_stmt|;
while|while
condition|(
operator|*
name|p2
operator|++
operator|=
operator|*
name|p1
operator|++
condition|)
empty_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|!=
literal|' '
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|p1
operator|=
name|file
expr_stmt|;
do|do
block|{
operator|*
name|p1
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|' '
operator|||
name|c
operator|==
name|EOF
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
do|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|savedfile
index|[
literal|0
index|]
operator|==
literal|0
operator|||
name|comm
operator|==
literal|'e'
operator|||
name|comm
operator|==
literal|'f'
condition|)
block|{
name|p1
operator|=
name|savedfile
expr_stmt|;
name|p2
operator|=
name|file
expr_stmt|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
block|}
block|}
end_block

begin_macro
name|exfile
argument_list|()
end_macro

begin_block
block|{
name|close
argument_list|(
name|io
argument_list|)
expr_stmt|;
name|io
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|vflag
condition|)
block|{
name|putd
argument_list|()
expr_stmt|;
name|putchr
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_function
name|void
name|onintr
parameter_list|()
block|{
comment|/* not necessary: (void)signal(SIGINT, onintr); */
name|putchr
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
name|onhup
parameter_list|()
block|{
comment|/* not necessary: (void)signal(SIGINT, SIG_IGN); */
comment|/* not necessary: (void)signal(SIGHUP, SIG_IGN); */
if|if
condition|(
name|dol
operator|>
name|zero
condition|)
block|{
name|addr1
operator|=
name|zero
operator|+
literal|1
expr_stmt|;
name|addr2
operator|=
name|dol
expr_stmt|;
name|io
operator|=
name|creat
argument_list|(
literal|"ed.hup"
argument_list|,
literal|0666
argument_list|)
expr_stmt|;
if|if
condition|(
name|io
operator|>
literal|0
condition|)
name|putfile
argument_list|()
expr_stmt|;
block|}
name|fchange
operator|=
literal|0
expr_stmt|;
name|quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_macro
name|error
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|c
expr_stmt|;
name|wrapp
operator|=
literal|0
expr_stmt|;
name|listf
operator|=
literal|0
expr_stmt|;
name|putchr
argument_list|(
literal|'?'
argument_list|)
expr_stmt|;
name|puts
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
name|lseek
argument_list|(
literal|0
argument_list|,
operator|(
name|long
operator|)
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|globp
condition|)
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|globp
operator|=
literal|0
expr_stmt|;
name|peekc
operator|=
name|lastc
expr_stmt|;
if|if
condition|(
name|lastc
condition|)
while|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
literal|'\n'
operator|&&
name|c
operator|!=
name|EOF
condition|)
empty_stmt|;
if|if
condition|(
name|io
operator|>
literal|0
condition|)
block|{
name|close
argument_list|(
name|io
argument_list|)
expr_stmt|;
name|io
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|longjmp
argument_list|(
name|savej
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|getchr
argument_list|()
end_macro

begin_block
block|{
name|char
name|c
decl_stmt|;
if|if
condition|(
name|lastc
operator|=
name|peekc
condition|)
block|{
name|peekc
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|lastc
operator|)
return|;
block|}
if|if
condition|(
name|globp
condition|)
block|{
if|if
condition|(
operator|(
name|lastc
operator|=
operator|*
name|globp
operator|++
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|lastc
operator|)
return|;
name|globp
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|EOF
operator|)
return|;
block|}
if|if
condition|(
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|c
argument_list|,
literal|1
argument_list|)
operator|<=
literal|0
condition|)
return|return
operator|(
name|lastc
operator|=
name|EOF
operator|)
return|;
name|lastc
operator|=
name|c
operator|&
literal|0177
expr_stmt|;
return|return
operator|(
name|lastc
operator|)
return|;
block|}
end_block

begin_macro
name|gettty
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|gf
decl_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|linebuf
expr_stmt|;
name|gf
operator|=
name|globp
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
block|{
if|if
condition|(
name|gf
condition|)
name|peekc
operator|=
name|c
expr_stmt|;
return|return
operator|(
name|c
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|c
operator|&=
literal|0177
operator|)
operator|==
literal|0
condition|)
continue|continue;
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|p
operator|>=
operator|&
name|linebuf
index|[
name|LBSIZE
operator|-
literal|2
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|linebuf
index|[
literal|0
index|]
operator|==
literal|'.'
operator|&&
name|linebuf
index|[
literal|1
index|]
operator|==
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|getfile
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|lp
decl_stmt|,
modifier|*
name|fp
decl_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|fp
operator|=
name|nextip
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|--
name|ninbuf
operator|<
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|ninbuf
operator|=
name|read
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|LBSIZE
argument_list|)
operator|-
literal|1
operator|)
operator|<
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
name|fp
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
name|fp
operator|<
operator|&
name|genbuf
index|[
name|ninbuf
index|]
condition|)
block|{
if|if
condition|(
operator|*
name|fp
operator|++
operator|&
literal|0200
condition|)
block|{
break|break;
block|}
block|}
name|fp
operator|=
name|genbuf
expr_stmt|;
block|}
name|c
operator|=
operator|*
name|fp
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|c
operator|&
literal|0200
operator|||
name|lp
operator|>=
operator|&
name|linebuf
index|[
name|LBSIZE
index|]
condition|)
block|{
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
operator|*
name|lp
operator|++
operator|=
name|c
expr_stmt|;
name|count
operator|++
expr_stmt|;
block|}
do|while
condition|(
name|c
operator|!=
literal|'\n'
condition|)
do|;
operator|*
operator|--
name|lp
operator|=
literal|0
expr_stmt|;
name|nextip
operator|=
name|fp
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|putfile
argument_list|()
end_macro

begin_block
block|{
name|int
modifier|*
name|a1
decl_stmt|,
name|n
decl_stmt|;
specifier|register
name|char
modifier|*
name|fp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nib
expr_stmt|;
name|nib
operator|=
literal|512
expr_stmt|;
name|fp
operator|=
name|genbuf
expr_stmt|;
name|a1
operator|=
name|addr1
expr_stmt|;
do|do
block|{
name|lp
operator|=
name|getline
argument_list|(
operator|*
name|a1
operator|++
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|--
name|nib
operator|<
literal|0
condition|)
block|{
name|n
operator|=
name|fp
operator|-
name|genbuf
expr_stmt|;
if|if
condition|(
name|write
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|n
argument_list|)
operator|!=
name|n
condition|)
block|{
name|puts
argument_list|(
name|WRERR
argument_list|)
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
name|nib
operator|=
literal|511
expr_stmt|;
name|fp
operator|=
name|genbuf
expr_stmt|;
block|}
name|count
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|fp
operator|++
operator|=
operator|*
name|lp
operator|++
operator|)
operator|==
literal|0
condition|)
block|{
name|fp
index|[
operator|-
literal|1
index|]
operator|=
literal|'\n'
expr_stmt|;
break|break;
block|}
block|}
block|}
do|while
condition|(
name|a1
operator|<=
name|addr2
condition|)
do|;
name|n
operator|=
name|fp
operator|-
name|genbuf
expr_stmt|;
if|if
condition|(
name|write
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|n
argument_list|)
operator|!=
name|n
condition|)
block|{
name|puts
argument_list|(
name|WRERR
argument_list|)
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|append
argument_list|(
argument|f
argument_list|,
argument|a
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|a
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
function_decl|(
modifier|*
name|f
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
operator|*
name|a2
operator|,
operator|*
name|rdot
expr_stmt|;
name|int
name|nline
decl_stmt|,
name|tl
decl_stmt|;
name|nline
operator|=
literal|0
expr_stmt|;
name|dot
operator|=
name|a
expr_stmt|;
while|while
condition|(
call|(
modifier|*
name|f
call|)
argument_list|()
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|dol
operator|-
name|zero
operator|)
operator|+
literal|1
operator|>=
name|nlall
condition|)
block|{
name|int
modifier|*
name|ozero
init|=
name|zero
decl_stmt|;
name|nlall
operator|+=
literal|512
expr_stmt|;
if|if
condition|(
operator|(
name|zero
operator|=
operator|(
name|int
operator|*
operator|)
name|realloc
argument_list|(
operator|(
name|char
operator|*
operator|)
name|zero
argument_list|,
name|nlall
operator|*
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|zero
operator|=
name|ozero
expr_stmt|;
name|error
argument_list|(
literal|"MEM?"
argument_list|)
expr_stmt|;
block|}
name|dot
operator|+=
name|zero
operator|-
name|ozero
expr_stmt|;
name|dol
operator|+=
name|zero
operator|-
name|ozero
expr_stmt|;
block|}
name|tl
operator|=
name|putline
argument_list|()
expr_stmt|;
name|nline
operator|++
expr_stmt|;
name|a1
operator|=
operator|++
name|dol
expr_stmt|;
name|a2
operator|=
name|a1
operator|+
literal|1
expr_stmt|;
name|rdot
operator|=
operator|++
name|dot
expr_stmt|;
while|while
condition|(
name|a1
operator|>
name|rdot
condition|)
operator|*
operator|--
name|a2
operator|=
operator|*
operator|--
name|a1
expr_stmt|;
operator|*
name|rdot
operator|=
name|tl
expr_stmt|;
block|}
return|return
operator|(
name|nline
operator|)
return|;
block|}
end_block

begin_macro
name|callunix
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|sig_t
name|savint
decl_stmt|;
specifier|register
name|int
name|pid
decl_stmt|,
name|rpid
decl_stmt|;
name|int
name|retcode
decl_stmt|;
name|setnoaddr
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|pid
operator|=
name|fork
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|signal
argument_list|(
name|SIGHUP
argument_list|,
name|oldhup
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|oldquit
argument_list|)
expr_stmt|;
name|execl
argument_list|(
name|_PATH_BSHELL
argument_list|,
literal|"sh"
argument_list|,
literal|"-t"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0100
argument_list|)
expr_stmt|;
block|}
name|savint
operator|=
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|SIG_IGN
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|rpid
operator|=
name|wait
argument_list|(
operator|&
name|retcode
argument_list|)
operator|)
operator|!=
name|pid
operator|&&
name|rpid
operator|!=
operator|-
literal|1
condition|)
empty_stmt|;
name|signal
argument_list|(
name|SIGINT
argument_list|,
name|savint
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|void
name|quit
parameter_list|()
block|{
if|if
condition|(
name|vflag
operator|&&
name|fchange
operator|&&
name|dol
operator|!=
name|zero
condition|)
block|{
name|fchange
operator|=
literal|0
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
name|unlink
argument_list|(
name|tfname
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|delete
argument_list|()
end_macro

begin_block
block|{
name|setdot
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|rdelete
argument_list|(
name|addr1
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|rdelete
argument_list|(
argument|ad1
argument_list|,
argument|ad2
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|ad1
decl_stmt|,
modifier|*
name|ad2
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
operator|*
name|a2
operator|,
operator|*
name|a3
expr_stmt|;
name|a1
operator|=
name|ad1
expr_stmt|;
name|a2
operator|=
name|ad2
operator|+
literal|1
expr_stmt|;
name|a3
operator|=
name|dol
expr_stmt|;
name|dol
operator|-=
name|a2
operator|-
name|a1
expr_stmt|;
do|do
block|{
operator|*
name|a1
operator|++
operator|=
operator|*
name|a2
operator|++
expr_stmt|;
block|}
do|while
condition|(
name|a2
operator|<=
name|a3
condition|)
do|;
name|a1
operator|=
name|ad1
expr_stmt|;
if|if
condition|(
name|a1
operator|>
name|dol
condition|)
name|a1
operator|=
name|dol
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
name|fchange
operator|=
literal|1
expr_stmt|;
block|}
end_block

begin_macro
name|gdelete
argument_list|()
end_macro

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
operator|*
name|a2
operator|,
operator|*
name|a3
expr_stmt|;
name|a3
operator|=
name|dol
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|zero
operator|+
literal|1
init|;
operator|(
operator|*
name|a1
operator|&
literal|01
operator|)
operator|==
literal|0
condition|;
name|a1
operator|++
control|)
if|if
condition|(
name|a1
operator|>=
name|a3
condition|)
return|return;
for|for
control|(
name|a2
operator|=
name|a1
operator|+
literal|1
init|;
name|a2
operator|<=
name|a3
condition|;
control|)
block|{
if|if
condition|(
operator|*
name|a2
operator|&
literal|01
condition|)
block|{
name|a2
operator|++
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
block|}
else|else
operator|*
name|a1
operator|++
operator|=
operator|*
name|a2
operator|++
expr_stmt|;
block|}
name|dol
operator|=
name|a1
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|dot
operator|>
name|dol
condition|)
name|dot
operator|=
name|dol
expr_stmt|;
name|fchange
operator|=
literal|1
expr_stmt|;
block|}
end_block

begin_function
name|char
modifier|*
name|getline
parameter_list|(
name|tl
parameter_list|)
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nl
expr_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|bp
operator|=
name|getblock
argument_list|(
name|tl
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
name|tl
operator|&=
operator|~
literal|0377
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|=
operator|*
name|bp
operator|++
condition|)
if|if
condition|(
operator|--
name|nl
operator|==
literal|0
condition|)
block|{
name|bp
operator|=
name|getblock
argument_list|(
name|tl
operator|+=
literal|0400
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
block|}
return|return
operator|(
name|linebuf
operator|)
return|;
block|}
end_function

begin_macro
name|putline
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nl
expr_stmt|;
name|int
name|tl
decl_stmt|;
name|fchange
operator|=
literal|1
expr_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|tl
operator|=
name|tline
expr_stmt|;
name|bp
operator|=
name|getblock
argument_list|(
name|tl
argument_list|,
name|WRITE
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
name|tl
operator|&=
operator|~
literal|0377
expr_stmt|;
while|while
condition|(
operator|*
name|bp
operator|=
operator|*
name|lp
operator|++
condition|)
block|{
if|if
condition|(
operator|*
name|bp
operator|++
operator|==
literal|'\n'
condition|)
block|{
operator|*
operator|--
name|bp
operator|=
literal|0
expr_stmt|;
name|linebp
operator|=
name|lp
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|--
name|nl
operator|==
literal|0
condition|)
block|{
name|bp
operator|=
name|getblock
argument_list|(
name|tl
operator|+=
literal|0400
argument_list|,
name|WRITE
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
block|}
block|}
name|nl
operator|=
name|tline
expr_stmt|;
name|tline
operator|+=
operator|(
operator|(
operator|(
name|lp
operator|-
name|linebuf
operator|)
operator|+
literal|03
operator|)
operator|>>
literal|1
operator|)
operator|&
literal|077776
expr_stmt|;
return|return
operator|(
name|nl
operator|)
return|;
block|}
end_block

begin_function
name|char
modifier|*
name|getblock
parameter_list|(
name|atl
parameter_list|,
name|iof
parameter_list|)
block|{
extern|extern read(
block|)
operator|,
function|write
parameter_list|()
function|;
end_function

begin_expr_stmt
specifier|register
name|bno
operator|,
name|off
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|int
name|n
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|bno
operator|=
operator|(
name|atl
operator|>>
literal|8
operator|)
operator|&
literal|0377
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|off
operator|=
operator|(
name|atl
operator|<<
literal|1
operator|)
operator|&
literal|0774
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|bno
operator|>=
literal|255
condition|)
block|{
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
argument_list|(
name|T
argument_list|)
expr_stmt|;
block|}
end_if

begin_expr_stmt
name|nleft
operator|=
literal|512
operator|-
name|off
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|bno
operator|==
name|iblock
condition|)
block|{
name|ichanged
operator||=
name|iof
expr_stmt|;
return|return
operator|(
name|ibuff
operator|+
name|off
operator|)
return|;
block|}
end_if

begin_if
if|if
condition|(
name|bno
operator|==
name|oblock
condition|)
return|return
operator|(
name|obuff
operator|+
name|off
operator|)
return|;
end_if

begin_if
if|if
condition|(
name|iof
operator|==
name|READ
condition|)
block|{
if|if
condition|(
name|ichanged
condition|)
block|{
name|blkio
argument_list|(
name|iblock
argument_list|,
name|ibuff
argument_list|,
name|write
argument_list|)
expr_stmt|;
block|}
name|ichanged
operator|=
literal|0
expr_stmt|;
name|iblock
operator|=
name|bno
expr_stmt|;
name|blkio
argument_list|(
name|bno
argument_list|,
name|ibuff
argument_list|,
name|read
argument_list|)
expr_stmt|;
return|return
operator|(
name|ibuff
operator|+
name|off
operator|)
return|;
block|}
end_if

begin_if
if|if
condition|(
name|oblock
operator|>=
literal|0
condition|)
block|{
name|blkio
argument_list|(
name|oblock
argument_list|,
name|obuff
argument_list|,
name|write
argument_list|)
expr_stmt|;
block|}
end_if

begin_expr_stmt
name|oblock
operator|=
name|bno
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|obuff
operator|+
name|off
operator|)
return|;
end_return

begin_expr_stmt
unit|}  blkio
operator|(
name|b
operator|,
name|buf
operator|,
name|iofcn
operator|)
name|char
operator|*
name|buf
expr_stmt|;
end_expr_stmt

begin_function_decl
name|int
function_decl|(
modifier|*
name|iofcn
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_block
block|{
name|lseek
argument_list|(
name|tfile
argument_list|,
operator|(
name|long
operator|)
name|b
operator|<<
literal|9
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|iofcn
call|)
argument_list|(
name|tfile
argument_list|,
name|buf
argument_list|,
literal|512
argument_list|)
operator|!=
literal|512
condition|)
block|{
name|error
argument_list|(
name|T
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|init
argument_list|()
end_macro

begin_block
block|{
specifier|register
operator|*
name|markp
expr_stmt|;
name|close
argument_list|(
name|tfile
argument_list|)
expr_stmt|;
name|tline
operator|=
literal|2
expr_stmt|;
for|for
control|(
name|markp
operator|=
name|names
init|;
name|markp
operator|<
operator|&
name|names
index|[
literal|26
index|]
condition|;
control|)
operator|*
name|markp
operator|++
operator|=
literal|0
expr_stmt|;
name|subnewa
operator|=
literal|0
expr_stmt|;
name|anymarks
operator|=
literal|0
expr_stmt|;
name|iblock
operator|=
operator|-
literal|1
expr_stmt|;
name|oblock
operator|=
operator|-
literal|1
expr_stmt|;
name|ichanged
operator|=
literal|0
expr_stmt|;
name|close
argument_list|(
name|creat
argument_list|(
name|tfname
argument_list|,
literal|0600
argument_list|)
argument_list|)
expr_stmt|;
name|tfile
operator|=
name|open
argument_list|(
name|tfname
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|dot
operator|=
name|dol
operator|=
name|zero
expr_stmt|;
block|}
end_block

begin_macro
name|global
argument_list|(
argument|k
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|gp
decl_stmt|;
specifier|register
name|c
expr_stmt|;
specifier|register
name|int
modifier|*
name|a1
decl_stmt|;
name|char
name|globuf
index|[
name|GBSIZE
index|]
decl_stmt|;
if|if
condition|(
name|globp
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|setall
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'\n'
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|compile
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|gp
operator|=
name|globuf
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|!=
literal|'\n'
condition|)
operator|*
name|gp
operator|++
operator|=
literal|'\\'
expr_stmt|;
block|}
operator|*
name|gp
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|gp
operator|>=
operator|&
name|globuf
index|[
name|GBSIZE
operator|-
literal|2
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
operator|*
name|gp
operator|++
operator|=
literal|'\n'
expr_stmt|;
operator|*
name|gp
operator|++
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
block|{
operator|*
name|a1
operator|&=
operator|~
literal|01
expr_stmt|;
if|if
condition|(
name|a1
operator|>=
name|addr1
operator|&&
name|a1
operator|<=
name|addr2
operator|&&
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
operator|==
name|k
condition|)
operator|*
name|a1
operator||=
literal|01
expr_stmt|;
block|}
comment|/* 	 * Special case: g/.../d (avoid n^2 algorithm) 	 */
if|if
condition|(
name|globuf
index|[
literal|0
index|]
operator|==
literal|'d'
operator|&&
name|globuf
index|[
literal|1
index|]
operator|==
literal|'\n'
operator|&&
name|globuf
index|[
literal|2
index|]
operator|==
literal|'\0'
condition|)
block|{
name|gdelete
argument_list|()
expr_stmt|;
return|return;
block|}
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|a1
operator|&
literal|01
condition|)
block|{
operator|*
name|a1
operator|&=
operator|~
literal|01
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
name|globp
operator|=
name|globuf
expr_stmt|;
name|commands
argument_list|()
expr_stmt|;
name|a1
operator|=
name|zero
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|join
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|gp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
operator|*
name|a1
expr_stmt|;
name|gp
operator|=
name|genbuf
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|addr1
init|;
name|a1
operator|<=
name|addr2
condition|;
name|a1
operator|++
control|)
block|{
name|lp
operator|=
name|getline
argument_list|(
operator|*
name|a1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|gp
operator|=
operator|*
name|lp
operator|++
condition|)
if|if
condition|(
name|gp
operator|++
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
operator|-
literal|2
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
name|lp
operator|=
name|linebuf
expr_stmt|;
name|gp
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|=
operator|*
name|gp
operator|++
condition|)
empty_stmt|;
operator|*
name|addr1
operator|=
name|putline
argument_list|()
expr_stmt|;
if|if
condition|(
name|addr1
operator|<
name|addr2
condition|)
name|rdelete
argument_list|(
name|addr1
operator|+
literal|1
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
name|dot
operator|=
name|addr1
expr_stmt|;
block|}
end_block

begin_macro
name|substitute
argument_list|(
argument|inglob
argument_list|)
end_macro

begin_block
block|{
specifier|register
operator|*
name|markp
operator|,
operator|*
name|a1
operator|,
name|nl
expr_stmt|;
name|int
name|gsubf
decl_stmt|;
name|int
name|getsub
parameter_list|()
function_decl|;
name|gsubf
operator|=
name|compsub
argument_list|()
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|addr1
init|;
name|a1
operator|<=
name|addr2
condition|;
name|a1
operator|++
control|)
block|{
name|int
modifier|*
name|ozero
decl_stmt|;
if|if
condition|(
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
operator|==
literal|0
condition|)
continue|continue;
name|inglob
operator||=
literal|01
expr_stmt|;
name|dosub
argument_list|()
expr_stmt|;
if|if
condition|(
name|gsubf
condition|)
block|{
while|while
condition|(
operator|*
name|loc2
condition|)
block|{
if|if
condition|(
name|execute
argument_list|(
literal|1
argument_list|,
operator|(
name|int
operator|*
operator|)
literal|0
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|dosub
argument_list|()
expr_stmt|;
block|}
block|}
name|subnewa
operator|=
name|putline
argument_list|()
expr_stmt|;
operator|*
name|a1
operator|&=
operator|~
literal|01
expr_stmt|;
if|if
condition|(
name|anymarks
condition|)
block|{
for|for
control|(
name|markp
operator|=
name|names
init|;
name|markp
operator|<
operator|&
name|names
index|[
literal|26
index|]
condition|;
name|markp
operator|++
control|)
if|if
condition|(
operator|*
name|markp
operator|==
operator|*
name|a1
condition|)
operator|*
name|markp
operator|=
name|subnewa
expr_stmt|;
block|}
name|subolda
operator|=
operator|*
name|a1
expr_stmt|;
operator|*
name|a1
operator|=
name|subnewa
expr_stmt|;
name|ozero
operator|=
name|zero
expr_stmt|;
name|nl
operator|=
name|append
argument_list|(
name|getsub
argument_list|,
name|a1
argument_list|)
expr_stmt|;
name|nl
operator|+=
name|zero
operator|-
name|ozero
expr_stmt|;
name|a1
operator|+=
name|nl
expr_stmt|;
name|addr2
operator|+=
name|nl
expr_stmt|;
block|}
if|if
condition|(
name|inglob
operator|==
literal|0
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|compsub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|seof
operator|,
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|(
name|seof
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'\n'
operator|||
name|seof
operator|==
literal|' '
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|compile
argument_list|(
name|seof
argument_list|)
expr_stmt|;
name|p
operator|=
name|rhsbuf
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
name|c
operator|=
name|getchr
argument_list|()
operator||
literal|0200
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
block|{
if|if
condition|(
name|globp
condition|)
name|c
operator||=
literal|0200
expr_stmt|;
else|else
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|==
name|seof
condition|)
break|break;
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|p
operator|>=
operator|&
name|rhsbuf
index|[
name|LBSIZE
operator|/
literal|2
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|peekc
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'g'
condition|)
block|{
name|peekc
operator|=
literal|0
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|newline
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|getsub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
name|p1
operator|=
name|linebuf
expr_stmt|;
if|if
condition|(
operator|(
name|p2
operator|=
name|linebp
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
name|linebp
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|dosub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|lp
decl_stmt|,
modifier|*
name|sp
decl_stmt|,
modifier|*
name|rp
decl_stmt|;
name|int
name|c
decl_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|sp
operator|=
name|genbuf
expr_stmt|;
name|rp
operator|=
name|rhsbuf
expr_stmt|;
while|while
condition|(
name|lp
operator|<
name|loc1
condition|)
operator|*
name|sp
operator|++
operator|=
operator|*
name|lp
operator|++
expr_stmt|;
while|while
condition|(
name|c
operator|=
operator|*
name|rp
operator|++
operator|&
literal|0377
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'&'
condition|)
block|{
name|sp
operator|=
name|place
argument_list|(
name|sp
argument_list|,
name|loc1
argument_list|,
name|loc2
argument_list|)
expr_stmt|;
continue|continue;
block|}
elseif|else
if|if
condition|(
name|c
operator|&
literal|0200
operator|&&
operator|(
name|c
operator|&=
literal|0177
operator|)
operator|>=
literal|'1'
operator|&&
name|c
operator|<
name|nbra
operator|+
literal|'1'
condition|)
block|{
name|sp
operator|=
name|place
argument_list|(
name|sp
argument_list|,
name|braslist
index|[
name|c
operator|-
literal|'1'
index|]
argument_list|,
name|braelist
index|[
name|c
operator|-
literal|'1'
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
operator|*
name|sp
operator|++
operator|=
name|c
operator|&
literal|0177
expr_stmt|;
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
name|lp
operator|=
name|loc2
expr_stmt|;
name|loc2
operator|=
name|sp
operator|-
name|genbuf
operator|+
name|linebuf
expr_stmt|;
while|while
condition|(
operator|*
name|sp
operator|++
operator|=
operator|*
name|lp
operator|++
condition|)
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|sp
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|=
operator|*
name|sp
operator|++
condition|)
empty_stmt|;
block|}
end_block

begin_function
name|char
modifier|*
name|place
parameter_list|(
name|sp
parameter_list|,
name|l1
parameter_list|,
name|l2
parameter_list|)
specifier|register
name|char
modifier|*
name|sp
decl_stmt|,
decl|*
name|l1
decl_stmt|,
modifier|*
name|l2
decl_stmt|;
end_function

begin_block
block|{
while|while
condition|(
name|l1
operator|<
name|l2
condition|)
block|{
operator|*
name|sp
operator|++
operator|=
operator|*
name|l1
operator|++
expr_stmt|;
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|sp
operator|)
return|;
block|}
end_block

begin_macro
name|move
argument_list|(
argument|cflag
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|int
modifier|*
name|adt
decl_stmt|,
modifier|*
name|ad1
decl_stmt|,
modifier|*
name|ad2
decl_stmt|;
name|int
name|getcopy
parameter_list|()
function_decl|;
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|adt
operator|=
name|address
argument_list|()
operator|)
operator|==
literal|0
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
if|if
condition|(
name|cflag
condition|)
block|{
name|int
modifier|*
name|ozero
decl_stmt|,
name|delta
decl_stmt|;
name|ad1
operator|=
name|dol
expr_stmt|;
name|ozero
operator|=
name|zero
expr_stmt|;
name|append
argument_list|(
name|getcopy
argument_list|,
name|ad1
operator|++
argument_list|)
expr_stmt|;
name|ad2
operator|=
name|dol
expr_stmt|;
name|delta
operator|=
name|zero
operator|-
name|ozero
expr_stmt|;
name|ad1
operator|+=
name|delta
expr_stmt|;
name|adt
operator|+=
name|delta
expr_stmt|;
block|}
else|else
block|{
name|ad2
operator|=
name|addr2
expr_stmt|;
for|for
control|(
name|ad1
operator|=
name|addr1
init|;
name|ad1
operator|<=
name|ad2
condition|;
control|)
operator|*
name|ad1
operator|++
operator|&=
operator|~
literal|01
expr_stmt|;
name|ad1
operator|=
name|addr1
expr_stmt|;
block|}
name|ad2
operator|++
expr_stmt|;
if|if
condition|(
name|adt
operator|<
name|ad1
condition|)
block|{
name|dot
operator|=
name|adt
operator|+
operator|(
name|ad2
operator|-
name|ad1
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|++
name|adt
operator|)
operator|==
name|ad1
condition|)
return|return;
name|reverse
argument_list|(
name|adt
argument_list|,
name|ad1
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|adt
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|adt
operator|>=
name|ad2
condition|)
block|{
name|dot
operator|=
name|adt
operator|++
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad2
argument_list|,
name|adt
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|adt
argument_list|)
expr_stmt|;
block|}
else|else
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|fchange
operator|=
literal|1
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|reverse
argument_list|(
name|a1
argument_list|,
name|a2
argument_list|)
specifier|register
name|int
operator|*
name|a1
operator|,
operator|*
name|a2
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|int
name|t
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|t
operator|=
operator|*
operator|--
name|a2
expr_stmt|;
if|if
condition|(
name|a2
operator|<=
name|a1
condition|)
return|return;
operator|*
name|a2
operator|=
operator|*
name|a1
expr_stmt|;
operator|*
name|a1
operator|++
operator|=
name|t
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|getcopy
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr1
operator|>
name|addr2
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
name|getline
argument_list|(
operator|*
name|addr1
operator|++
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|compile
argument_list|(
argument|aeof
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|eof
operator|,
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|ep
decl_stmt|;
name|char
modifier|*
name|lastep
decl_stmt|;
name|char
name|bracket
index|[
name|NBRA
index|]
decl_stmt|,
modifier|*
name|bracketp
decl_stmt|;
name|int
name|cclcnt
decl_stmt|;
name|ep
operator|=
name|expbuf
expr_stmt|;
name|eof
operator|=
name|aeof
expr_stmt|;
name|bracketp
operator|=
name|bracket
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
name|eof
condition|)
block|{
if|if
condition|(
operator|*
name|ep
operator|==
literal|0
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
return|return;
block|}
name|circfl
operator|=
literal|0
expr_stmt|;
name|nbra
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'^'
condition|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
name|circfl
operator|++
expr_stmt|;
block|}
name|peekc
operator|=
name|c
expr_stmt|;
name|lastep
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|ep
operator|>=
operator|&
name|expbuf
index|[
name|ESIZE
index|]
condition|)
goto|goto
name|cerror
goto|;
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|eof
condition|)
block|{
if|if
condition|(
name|bracketp
operator|!=
name|bracket
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|CEOF
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|!=
literal|'*'
condition|)
name|lastep
operator|=
name|ep
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\\'
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'('
condition|)
block|{
if|if
condition|(
name|nbra
operator|>=
name|NBRA
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|bracketp
operator|++
operator|=
name|nbra
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|CBRA
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|nbra
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|c
operator|==
literal|')'
condition|)
block|{
if|if
condition|(
name|bracketp
operator|<=
name|bracket
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|CKET
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
operator|*
operator|--
name|bracketp
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|c
operator|>=
literal|'1'
operator|&&
name|c
operator|<
literal|'1'
operator|+
name|NBRA
condition|)
block|{
operator|*
name|ep
operator|++
operator|=
name|CBACK
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|c
operator|-
literal|'1'
expr_stmt|;
continue|continue;
block|}
operator|*
name|ep
operator|++
operator|=
name|CCHR
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
continue|continue;
case|case
literal|'.'
case|:
operator|*
name|ep
operator|++
operator|=
name|CDOT
expr_stmt|;
continue|continue;
case|case
literal|'\n'
case|:
goto|goto
name|cerror
goto|;
case|case
literal|'*'
case|:
if|if
condition|(
name|lastep
operator|==
literal|0
operator|||
operator|*
name|lastep
operator|==
name|CBRA
operator|||
operator|*
name|lastep
operator|==
name|CKET
condition|)
goto|goto
name|defchar
goto|;
operator|*
name|lastep
operator||=
name|STAR
expr_stmt|;
continue|continue;
case|case
literal|'$'
case|:
if|if
condition|(
operator|(
name|peekc
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
name|eof
condition|)
goto|goto
name|defchar
goto|;
operator|*
name|ep
operator|++
operator|=
name|CDOL
expr_stmt|;
continue|continue;
case|case
literal|'['
case|:
operator|*
name|ep
operator|++
operator|=
name|CCL
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
literal|0
expr_stmt|;
name|cclcnt
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|'^'
condition|)
block|{
name|c
operator|=
name|getchr
argument_list|()
expr_stmt|;
name|ep
index|[
operator|-
literal|2
index|]
operator|=
name|NCCL
expr_stmt|;
block|}
do|do
block|{
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
goto|goto
name|cerror
goto|;
if|if
condition|(
name|c
operator|==
literal|'-'
operator|&&
name|ep
index|[
operator|-
literal|1
index|]
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|==
literal|']'
condition|)
block|{
operator|*
name|ep
operator|++
operator|=
literal|'-'
expr_stmt|;
name|cclcnt
operator|++
expr_stmt|;
break|break;
block|}
while|while
condition|(
name|ep
index|[
operator|-
literal|1
index|]
operator|<
name|c
condition|)
block|{
operator|*
name|ep
operator|=
name|ep
index|[
operator|-
literal|1
index|]
operator|+
literal|1
expr_stmt|;
name|ep
operator|++
expr_stmt|;
name|cclcnt
operator|++
expr_stmt|;
if|if
condition|(
name|ep
operator|>=
operator|&
name|expbuf
index|[
name|ESIZE
index|]
condition|)
goto|goto
name|cerror
goto|;
block|}
block|}
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
name|cclcnt
operator|++
expr_stmt|;
if|if
condition|(
name|ep
operator|>=
operator|&
name|expbuf
index|[
name|ESIZE
index|]
condition|)
goto|goto
name|cerror
goto|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchr
argument_list|()
operator|)
operator|!=
literal|']'
condition|)
do|;
name|lastep
index|[
literal|1
index|]
operator|=
name|cclcnt
expr_stmt|;
continue|continue;
name|defchar
label|:
default|default:
operator|*
name|ep
operator|++
operator|=
name|CCHR
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
block|}
block|}
name|cerror
label|:
name|expbuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|nbra
operator|=
literal|0
expr_stmt|;
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|execute
argument_list|(
argument|gf
argument_list|,
argument|addr
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|,
name|c
decl_stmt|;
for|for
control|(
name|c
operator|=
literal|0
init|;
name|c
operator|<
name|NBRA
condition|;
name|c
operator|++
control|)
block|{
name|braslist
index|[
name|c
index|]
operator|=
literal|0
expr_stmt|;
name|braelist
index|[
name|c
index|]
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|gf
condition|)
block|{
if|if
condition|(
name|circfl
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|p1
operator|=
name|linebuf
expr_stmt|;
name|p2
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
name|locs
operator|=
name|p1
operator|=
name|loc2
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|addr
operator|==
name|zero
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|p1
operator|=
name|getline
argument_list|(
operator|*
name|addr
argument_list|)
expr_stmt|;
name|locs
operator|=
literal|0
expr_stmt|;
block|}
name|p2
operator|=
name|expbuf
expr_stmt|;
if|if
condition|(
name|circfl
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
operator|)
return|;
block|}
comment|/* fast check for first character */
if|if
condition|(
operator|*
name|p2
operator|==
name|CCHR
condition|)
block|{
name|c
operator|=
name|p2
index|[
literal|1
index|]
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|*
name|p1
operator|!=
name|c
condition|)
continue|continue;
if|if
condition|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
do|while
condition|(
operator|*
name|p1
operator|++
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* regular algorithm */
do|do
block|{
if|if
condition|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
do|while
condition|(
operator|*
name|p1
operator|++
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|advance
argument_list|(
name|lp
argument_list|,
name|ep
argument_list|)
specifier|register
name|char
operator|*
name|ep
operator|,
operator|*
name|lp
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|curlp
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
switch|switch
condition|(
operator|*
name|ep
operator|++
condition|)
block|{
case|case
name|CCHR
case|:
if|if
condition|(
operator|*
name|ep
operator|++
operator|==
operator|*
name|lp
operator|++
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CDOT
case|:
if|if
condition|(
operator|*
name|lp
operator|++
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CDOL
case|:
if|if
condition|(
operator|*
name|lp
operator|==
literal|0
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CEOF
case|:
name|loc2
operator|=
name|lp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
case|case
name|CCL
case|:
if|if
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|ep
operator|+=
operator|*
name|ep
expr_stmt|;
continue|continue;
block|}
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|NCCL
case|:
if|if
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|ep
operator|+=
operator|*
name|ep
expr_stmt|;
continue|continue;
block|}
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CBRA
case|:
name|braslist
index|[
operator|*
name|ep
operator|++
index|]
operator|=
name|lp
expr_stmt|;
continue|continue;
case|case
name|CKET
case|:
name|braelist
index|[
operator|*
name|ep
operator|++
index|]
operator|=
name|lp
expr_stmt|;
continue|continue;
case|case
name|CBACK
case|:
if|if
condition|(
name|braelist
index|[
name|i
operator|=
operator|*
name|ep
operator|++
index|]
operator|==
literal|0
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
if|if
condition|(
name|backref
argument_list|(
name|i
argument_list|,
name|lp
argument_list|)
condition|)
block|{
name|lp
operator|+=
name|braelist
index|[
name|i
index|]
operator|-
name|braslist
index|[
name|i
index|]
expr_stmt|;
continue|continue;
block|}
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CBACK
operator||
name|STAR
case|:
if|if
condition|(
name|braelist
index|[
name|i
operator|=
operator|*
name|ep
operator|++
index|]
operator|==
literal|0
condition|)
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
name|backref
argument_list|(
name|i
argument_list|,
name|lp
argument_list|)
condition|)
name|lp
operator|+=
name|braelist
index|[
name|i
index|]
operator|-
name|braslist
index|[
name|i
index|]
expr_stmt|;
while|while
condition|(
name|lp
operator|>=
name|curlp
condition|)
block|{
if|if
condition|(
name|advance
argument_list|(
name|lp
argument_list|,
name|ep
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
name|lp
operator|-=
name|braelist
index|[
name|i
index|]
operator|-
name|braslist
index|[
name|i
index|]
expr_stmt|;
block|}
continue|continue;
case|case
name|CDOT
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
condition|)
empty_stmt|;
goto|goto
name|star
goto|;
case|case
name|CCHR
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|==
operator|*
name|ep
condition|)
empty_stmt|;
name|ep
operator|++
expr_stmt|;
goto|goto
name|star
goto|;
case|case
name|CCL
operator||
name|STAR
case|:
case|case
name|NCCL
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
name|ep
index|[
operator|-
literal|1
index|]
operator|==
operator|(
name|CCL
operator||
name|STAR
operator|)
argument_list|)
condition|)
empty_stmt|;
name|ep
operator|+=
operator|*
name|ep
expr_stmt|;
goto|goto
name|star
goto|;
name|star
label|:
do|do
block|{
name|lp
operator|--
expr_stmt|;
if|if
condition|(
name|lp
operator|==
name|locs
condition|)
break|break;
if|if
condition|(
name|advance
argument_list|(
name|lp
argument_list|,
name|ep
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
do|while
condition|(
name|lp
operator|>
name|curlp
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
default|default:
name|error
argument_list|(
name|Q
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_expr_stmt
name|backref
argument_list|(
name|i
argument_list|,
name|lp
argument_list|)
specifier|register
name|i
expr_stmt|;
end_expr_stmt

begin_decl_stmt
specifier|register
name|char
modifier|*
name|lp
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|;
name|bp
operator|=
name|braslist
index|[
name|i
index|]
expr_stmt|;
while|while
condition|(
operator|*
name|bp
operator|++
operator|==
operator|*
name|lp
operator|++
condition|)
if|if
condition|(
name|bp
operator|>=
name|braelist
index|[
name|i
index|]
condition|)
return|return
operator|(
literal|1
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_expr_stmt
name|cclass
argument_list|(
name|set
argument_list|,
name|c
argument_list|,
name|af
argument_list|)
specifier|register
name|char
operator|*
name|set
operator|,
name|c
expr_stmt|;
end_expr_stmt

begin_block
block|{
specifier|register
name|n
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|n
operator|=
operator|*
name|set
operator|++
expr_stmt|;
while|while
condition|(
operator|--
name|n
condition|)
if|if
condition|(
operator|*
name|set
operator|++
operator|==
name|c
condition|)
return|return
operator|(
name|af
operator|)
return|;
return|return
operator|(
operator|!
name|af
operator|)
return|;
block|}
end_block

begin_macro
name|putd
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|r
expr_stmt|;
name|r
operator|=
name|count
operator|%
literal|10
expr_stmt|;
name|count
operator|/=
literal|10
expr_stmt|;
if|if
condition|(
name|count
condition|)
name|putd
argument_list|()
expr_stmt|;
name|putchr
argument_list|(
name|r
operator|+
literal|'0'
argument_list|)
expr_stmt|;
block|}
end_block

begin_expr_stmt
name|puts
argument_list|(
name|sp
argument_list|)
specifier|register
name|char
operator|*
name|sp
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|col
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|sp
condition|)
name|putchr
argument_list|(
operator|*
name|sp
operator|++
argument_list|)
expr_stmt|;
name|putchr
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|char
name|line
index|[
literal|70
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|linp
init|=
name|line
decl_stmt|;
end_decl_stmt

begin_macro
name|putchr
argument_list|(
argument|ac
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|lp
decl_stmt|;
specifier|register
name|c
expr_stmt|;
name|lp
operator|=
name|linp
expr_stmt|;
name|c
operator|=
name|ac
expr_stmt|;
if|if
condition|(
name|listf
condition|)
block|{
name|col
operator|++
expr_stmt|;
if|if
condition|(
name|col
operator|>=
literal|72
condition|)
block|{
name|col
operator|=
literal|0
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\n'
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
block|{
name|c
operator|=
literal|'>'
expr_stmt|;
goto|goto
name|esc
goto|;
block|}
if|if
condition|(
name|c
operator|==
literal|'\b'
condition|)
block|{
name|c
operator|=
literal|'<'
expr_stmt|;
name|esc
label|:
operator|*
name|lp
operator|++
operator|=
literal|'-'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\b'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
name|c
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|c
operator|<
literal|' '
operator|&&
name|c
operator|!=
literal|'\n'
condition|)
block|{
operator|*
name|lp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
operator|(
name|c
operator|>>
literal|3
operator|)
operator|+
literal|'0'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
operator|(
name|c
operator|&
literal|07
operator|)
operator|+
literal|'0'
expr_stmt|;
name|col
operator|+=
literal|2
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
operator|*
name|lp
operator|++
operator|=
name|c
expr_stmt|;
name|out
label|:
if|if
condition|(
name|c
operator|==
literal|'\n'
operator|||
name|lp
operator|>=
operator|&
name|line
index|[
literal|64
index|]
condition|)
block|{
name|linp
operator|=
name|line
expr_stmt|;
name|write
argument_list|(
literal|1
argument_list|,
name|line
argument_list|,
name|lp
operator|-
name|line
argument_list|)
expr_stmt|;
return|return;
block|}
name|linp
operator|=
name|lp
expr_stmt|;
block|}
end_block

end_unit

