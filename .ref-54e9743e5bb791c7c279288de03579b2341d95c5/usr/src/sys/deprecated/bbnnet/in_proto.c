begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"../h/param.h"
end_include

begin_include
include|#
directive|include
file|"../h/socket.h"
end_include

begin_include
include|#
directive|include
file|"../h/protosw.h"
end_include

begin_include
include|#
directive|include
file|"../h/domain.h"
end_include

begin_include
include|#
directive|include
file|"../h/mbuf.h"
end_include

begin_include
include|#
directive|include
file|"../net/route.h"
end_include

begin_include
include|#
directive|include
file|"../net/raw_cb.h"
end_include

begin_include
include|#
directive|include
file|"../bbnnet/in.h"
end_include

begin_include
include|#
directive|include
file|"../bbnnet/in_pcb.h"
end_include

begin_comment
comment|/*  * Internet protocols  */
end_comment

begin_decl_stmt
name|int
name|raw_init
argument_list|()
decl_stmt|,
name|raw_usrreq
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* IP */
end_comment

begin_decl_stmt
name|int
name|ip_init
argument_list|()
decl_stmt|,
name|ip_timeo
argument_list|()
decl_stmt|,
name|ip_drain
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ip_send
argument_list|()
decl_stmt|,
name|ip_ctloutput
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|raw_ip_input
argument_list|()
decl_stmt|,
name|raw_ip_output
argument_list|()
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ICMP */
end_comment

begin_decl_stmt
name|int
name|icmp
argument_list|()
decl_stmt|,
name|ic_timeo
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|raw_icmp_output
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* UDP */
end_comment

begin_function_decl
name|int
name|udp_input
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|udp_usrreq
argument_list|()
decl_stmt|,
name|udp_init
argument_list|()
decl_stmt|,
name|udp_ctlinput
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|raw_udp_output
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* TCP */
end_comment

begin_function_decl
name|int
name|tcp_input
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
name|tcp_usrreq
argument_list|()
decl_stmt|,
name|tcp_ctlinput
argument_list|()
decl_stmt|,
name|tcp_ctloutput
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|tcp_init
argument_list|()
decl_stmt|,
name|tcp_timeo
argument_list|()
decl_stmt|,
name|tcp_drain
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|raw_tcp_output
parameter_list|()
function_decl|;
end_function_decl

begin_comment
comment|/* RDP */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|RDP
end_ifdef

begin_decl_stmt
name|int
name|rdp_input
argument_list|()
decl_stmt|,
name|rdp_init
argument_list|()
decl_stmt|,
name|rdp_timeo
argument_list|()
decl_stmt|,
name|rdp_usrreq
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|rdp_ctlinput
argument_list|()
decl_stmt|,
name|rdp_ctloutput
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|raw_rdp_output
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HMP */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HMP
end_ifdef

begin_decl_stmt
name|int
name|hmp_input
argument_list|()
decl_stmt|,
name|hmp_init
argument_list|()
decl_stmt|,
name|hmp_usrreq
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|hmp_ctlinput
argument_list|()
decl_stmt|,
name|hmp_ctloutput
argument_list|()
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|raw_hmp_output
parameter_list|()
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*  * IMP protocol family: raw interface.  * Using the raw interface entry to get the timer routine  * in is a kludge.  */
end_comment

begin_include
include|#
directive|include
file|"imp.h"
end_include

begin_if
if|#
directive|if
name|NIMP
operator|>
literal|0
end_if

begin_decl_stmt
name|int
name|rimp_output
argument_list|()
decl_stmt|,
name|hostslowtimo
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|NSIP
end_ifdef

begin_decl_stmt
name|int
name|idpip_input
argument_list|()
decl_stmt|,
name|rip_output
argument_list|()
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|struct
name|domain
name|inetdomain
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|protosw
name|inetsw
index|[]
init|=
block|{
block|{
literal|0
block|,
operator|&
name|inetdomain
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|ip_send
block|,
literal|0
block|,
name|ip_ctloutput
block|,
literal|0
block|,
name|ip_init
block|,
literal|0
block|,
name|ip_timeo
block|,
name|ip_drain
block|}
block|,
comment|/*  * put frequently used protocols early.  Table is beginning to get large..  */
comment|/* UDP */
block|{
name|SOCK_DGRAM
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_UDP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|udp_input
block|,
literal|0
block|,
name|udp_ctlinput
block|,
name|ip_ctloutput
block|,
name|udp_usrreq
block|,
name|udp_init
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* TCP */
block|{
name|SOCK_STREAM
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_TCP
block|,
name|PR_CONNREQUIRED
operator||
name|PR_WANTRCVD
block|,
name|tcp_input
block|,
literal|0
block|,
name|tcp_ctlinput
block|,
name|tcp_ctloutput
block|,
name|tcp_usrreq
block|,
name|tcp_init
block|,
literal|0
block|,
name|tcp_timeo
block|,
name|tcp_drain
block|}
block|,
comment|/* RDP */
ifdef|#
directive|ifdef
name|RDP
block|{
name|SOCK_SEQPACKET
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_RDP
block|,
name|PR_CONNREQUIRED
operator||
name|PR_WANTRCVD
block|,
name|rdp_input
block|,
literal|0
block|,
name|rdp_ctlinput
block|,
name|rdp_ctloutput
block|,
name|rdp_usrreq
block|,
name|rdp_init
block|,
literal|0
block|,
name|rdp_timeo
block|,
literal|0
block|}
block|,
endif|#
directive|endif
comment|/* HMP */
ifdef|#
directive|ifdef
name|HMP
block|{
name|SOCK_DGRAM
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_HMP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|hmp_input
block|,
literal|0
block|,
name|hmp_ctlinput
block|,
name|hmp_ctloutput
block|,
name|hmp_usrreq
block|,
name|hmp_init
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|NSIP
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_IDP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|idpip_input
block|,
name|rip_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
comment|/*  * to get all incoming IP packets:  *	socket(AF_INET,SOCK_RAW,0)  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_ip_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
name|raw_init
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/*  * to get all incoming ICMP packets:  * 	socket(AF_INET,SOCK_RAW, IPPROTO_ICMP)  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_ICMP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_icmp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
name|ic_timeo
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|RDP
comment|/*  * to get all incoming RDP packets:  *	socket(AF_INET,SOCK_RAW, IPPROTO_RDP)  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_RDP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_rdp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
comment|/*  * to get all incoming UDP packets:  *	socket(AF_INET, SOCK_RAW, IPPROTO_UDP);  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_UDP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_udp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|HMP
comment|/*  * to get all incoming HMP packets:  *	socket(AF_INET,SOCK_RAW, IPPROTO_HMP);  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_HMP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_hmp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
comment|/*  * to get all TCP packets:  *	socket(AF_INET, SOCK_RAW, IPPROTO_TCP);  */
block|{
name|SOCK_RAW
block|,
operator|&
name|inetdomain
block|,
name|IPPROTO_TCP
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
name|raw_ip_input
block|,
name|raw_tcp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|domain
name|inetdomain
init|=
block|{
name|AF_INET
block|,
literal|"internet"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|inetsw
block|,
operator|&
name|inetsw
index|[
sizeof|sizeof
argument_list|(
name|inetsw
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|inetsw
index|[
literal|0
index|]
argument_list|)
index|]
block|}
decl_stmt|;
end_decl_stmt

begin_if
if|#
directive|if
name|NIMP
operator|>
literal|0
end_if

begin_decl_stmt
specifier|extern
name|struct
name|domain
name|impdomain
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|protosw
name|impsw
index|[]
init|=
block|{
block|{
name|SOCK_RAW
block|,
operator|&
name|impdomain
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
name|rimp_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
name|hostslowtimo
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|domain
name|impdomain
init|=
block|{
name|AF_IMPLINK
block|,
literal|"imp"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|impsw
block|,
operator|&
name|impsw
index|[
sizeof|sizeof
argument_list|(
name|impsw
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|impsw
index|[
literal|0
index|]
argument_list|)
index|]
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"hy.h"
end_include

begin_if
if|#
directive|if
name|NHY
operator|>
literal|0
end_if

begin_comment
comment|/*  * HYPERchannel protocol family: raw interface.  */
end_comment

begin_function_decl
name|int
name|rhy_output
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|struct
name|protosw
name|hysw
index|[]
init|=
block|{
block|{
name|SOCK_RAW
block|,
name|PF_HYLINK
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
name|rhy_output
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|domain
name|hydomain
init|=
block|{
name|AF_HYLINK
block|,
literal|"hy"
block|,
name|hysw
block|,
operator|&
name|hysw
index|[
sizeof|sizeof
argument_list|(
name|hysw
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|hysw
index|[
literal|0
index|]
argument_list|)
index|]
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|N_ELEMENTS
parameter_list|(
name|x
parameter_list|)
value|(sizeof(x)/sizeof((x)[0]))
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|AF_RDPDEBUG
end_ifdef

begin_decl_stmt
name|struct
name|protosw
name|rdpdebugsw
index|[]
init|=
block|{
block|{
name|SOCK_RAW
block|,
name|PF_RDPDEBUG
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|domain
name|rdpdebugdomain
init|=
block|{
name|AF_RDPDEBUG
block|,
literal|"rdpdebug"
block|,
name|rdpdebugsw
block|,
operator|&
name|rdpdebugsw
index|[
name|N_ELEMENTS
argument_list|(
name|rdpdebugsw
argument_list|)
index|]
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|AF_TCPDEBUG
end_ifdef

begin_decl_stmt
name|struct
name|protosw
name|tcpdebugsw
index|[]
init|=
block|{
block|{
name|SOCK_RAW
block|,
name|PF_TCPDEBUG
block|,
literal|0
block|,
name|PR_ATOMIC
operator||
name|PR_ADDR
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|raw_usrreq
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|domain
name|tcpdebugdomain
init|=
block|{
name|AF_TCPDEBUG
block|,
literal|"tcpdebug"
block|,
name|tcpdebugsw
block|,
operator|&
name|tcpdebugsw
index|[
name|N_ELEMENTS
argument_list|(
name|tcpdebugsw
argument_list|)
index|]
block|}
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

end_unit

