begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"../hdr/defines.h"
end_include

begin_decl_stmt
specifier|static
name|char
name|Sccsid
index|[]
init|=
literal|"@(#)pf_ab.c	1.5	%G%"
decl_stmt|;
end_decl_stmt

begin_macro
name|pf_ab
argument_list|(
argument|s
argument_list|,
argument|pp
argument_list|,
argument|all
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|register
name|struct
name|pfile
modifier|*
name|pp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|all
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
specifier|register
name|int
name|i
decl_stmt|;
specifier|extern
name|char
modifier|*
name|Datep
decl_stmt|;
name|char
modifier|*
name|xp
decl_stmt|,
modifier|*
name|buf
decl_stmt|;
name|xp
operator|=
name|p
operator|=
name|buf
operator|=
name|alloc
argument_list|(
name|size
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|copy
argument_list|(
name|s
argument_list|,
name|p
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
if|if
condition|(
operator|*
name|p
operator|==
literal|'\n'
condition|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|p
operator|=
name|xp
expr_stmt|;
name|p
operator|=
name|sid_ab
argument_list|(
name|p
argument_list|,
operator|&
name|pp
operator|->
name|pf_gsid
argument_list|)
expr_stmt|;
operator|++
name|p
expr_stmt|;
name|p
operator|=
name|sid_ab
argument_list|(
name|p
argument_list|,
operator|&
name|pp
operator|->
name|pf_nsid
argument_list|)
expr_stmt|;
operator|++
name|p
expr_stmt|;
name|xp
operator|=
name|index
argument_list|(
name|p
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
name|pp
operator|->
name|pf_user
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
call|(
name|unsigned
call|)
argument_list|(
name|i
operator|=
name|xp
operator|-
name|p
argument_list|)
operator|<
name|SZLNAM
condition|)
block|{
name|bcopy
argument_list|(
name|p
argument_list|,
name|pp
operator|->
name|pf_user
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|pp
operator|->
name|pf_user
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|fatal
argument_list|(
literal|"bad p-file format (co17)"
argument_list|)
expr_stmt|;
name|p
operator|=
name|xp
operator|+
literal|1
expr_stmt|;
name|date_ab
argument_list|(
name|p
argument_list|,
operator|&
name|pp
operator|->
name|pf_date
argument_list|)
expr_stmt|;
name|p
operator|=
name|Datep
expr_stmt|;
name|pp
operator|->
name|pf_ilist
operator|=
literal|0
expr_stmt|;
name|pp
operator|->
name|pf_elist
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|all
operator|||
operator|!
operator|*
name|p
condition|)
block|{
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
return|return;
block|}
name|p
operator|+=
literal|2
expr_stmt|;
name|xp
operator|=
name|alloc
argument_list|(
name|size
argument_list|(
name|p
argument_list|)
argument_list|)
expr_stmt|;
name|copy
argument_list|(
name|p
argument_list|,
name|xp
argument_list|)
expr_stmt|;
name|p
operator|=
name|xp
expr_stmt|;
if|if
condition|(
operator|*
name|p
operator|==
literal|'i'
condition|)
block|{
name|pp
operator|->
name|pf_ilist
operator|=
operator|++
name|p
expr_stmt|;
for|for
control|(
init|;
operator|*
name|p
condition|;
name|p
operator|++
control|)
if|if
condition|(
operator|*
name|p
operator|==
literal|' '
condition|)
block|{
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
name|p
operator|++
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|*
name|p
operator|==
literal|'x'
condition|)
name|pp
operator|->
name|pf_elist
operator|=
operator|++
name|p
expr_stmt|;
name|free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

