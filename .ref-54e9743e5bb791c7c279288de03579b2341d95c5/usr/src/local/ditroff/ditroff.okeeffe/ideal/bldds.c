begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sccsid
init|=
literal|"bldds.c	(CWI)	1.1	85/03/01"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* BuiLD Data Structures */
end_comment

begin_include
include|#
directive|include
file|"ideal.h"
end_include

begin_include
include|#
directive|include
file|"y.tab.h"
end_include

begin_function
name|NOADPTR
name|rbuildnoadtree
parameter_list|(
name|corrputnode
parameter_list|)
name|PUTPTR
name|corrputnode
decl_stmt|;
block|{
name|NOADPTR
name|nuroot
decl_stmt|,
name|putsons
decl_stmt|,
name|boxsons
decl_stmt|;
name|dprintf
literal|"building noad tree for %s\n"
operator|,
name|idprint
argument_list|(
name|corrputnode
operator|->
name|name
argument_list|)
block|)
function|;
end_function

begin_expr_stmt
name|nuroot
operator|=
name|noadgen
argument_list|(
name|corrputnode
argument_list|,
name|buildvarlist
argument_list|(
name|corrputnode
operator|->
name|parm
operator|->
name|stmtlist
argument_list|)
argument_list|,
name|buildvarlist
argument_list|(
operator|(
name|findbox
argument_list|(
name|corrputnode
operator|->
name|parm
operator|->
name|name
argument_list|,
name|FALSE
argument_list|)
operator|)
operator|->
name|stmtlist
argument_list|)
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|putsons
operator|=
name|walkputlist
argument_list|(
name|corrputnode
operator|->
name|parm
operator|->
name|stmtlist
argument_list|,
name|nuroot
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|boxsons
operator|=
name|walkputlist
argument_list|(
operator|(
name|findbox
argument_list|(
name|corrputnode
operator|->
name|parm
operator|->
name|name
argument_list|,
name|FALSE
argument_list|)
operator|)
operator|->
name|stmtlist
argument_list|,
name|nuroot
argument_list|)
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|putsons
operator|==
name|NULL
condition|)
block|{
name|nuroot
operator|->
name|son
operator|=
name|boxsons
expr_stmt|;
block|}
else|else
block|{
name|NOADPTR
name|temp
decl_stmt|;
for|for
control|(
name|temp
operator|=
name|putsons
init|;
name|temp
operator|->
name|brother
operator|!=
name|NULL
condition|;
name|temp
operator|=
name|temp
operator|->
name|brother
control|)
empty_stmt|;
name|temp
operator|->
name|brother
operator|=
name|boxsons
expr_stmt|;
name|nuroot
operator|->
name|son
operator|=
name|putsons
expr_stmt|;
block|}
end_if

begin_return
return|return
operator|(
name|nuroot
operator|)
return|;
end_return

begin_macro
unit|}  NOADPTR
name|buildnoadtree
argument_list|(
argument|corrputnode
argument_list|)
end_macro

begin_decl_stmt
name|PUTPTR
name|corrputnode
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|NOADPTR
name|retval
decl_stmt|;
if|if
condition|(
name|when_bug
operator|&
literal|02
condition|)
name|bug_on
expr_stmt|;
name|retval
operator|=
name|rbuildnoadtree
argument_list|(
name|corrputnode
argument_list|)
expr_stmt|;
name|bug_off
expr_stmt|;
return|return
operator|(
name|retval
operator|)
return|;
block|}
end_block

begin_function
name|VARPTR
name|buildvarlist
parameter_list|(
name|stmtlist
parameter_list|)
name|STMTPTR
name|stmtlist
decl_stmt|;
block|{
name|VARPTR
name|curlist
decl_stmt|;
name|NAMEPTR
name|namewalk
decl_stmt|;
name|curlist
operator|=
name|NULL
expr_stmt|;
name|stmtlist
operator|=
name|nextstmt
argument_list|(
name|VAR
argument_list|,
name|stmtlist
argument_list|)
expr_stmt|;
while|while
condition|(
name|stmtlist
condition|)
block|{
comment|/* make room for each local variable, and 		/* make each independent (x = 1*x) */
for|for
control|(
name|namewalk
operator|=
operator|(
operator|(
name|NAMEPTR
operator|)
name|stmtlist
operator|->
name|stmt
operator|)
init|;
name|namewalk
condition|;
name|namewalk
operator|=
name|namewalk
operator|->
name|next
control|)
block|{
name|VARPTR
name|newre
decl_stmt|,
name|newim
decl_stmt|;
name|newre
operator|=
name|vargen
argument_list|(
name|namewalk
operator|->
name|name
argument_list|,
name|TRUE
argument_list|,
operator|(
name|DEPPTR
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|newre
operator|->
name|deplist
operator|=
name|depgen
argument_list|(
name|newre
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|newim
operator|=
name|vargen
argument_list|(
name|namewalk
operator|->
name|name
argument_list|,
name|FALSE
argument_list|,
operator|(
name|DEPPTR
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|newim
operator|->
name|deplist
operator|=
name|depgen
argument_list|(
name|newim
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|newre
operator|->
name|next
operator|=
name|newim
expr_stmt|;
name|newim
operator|->
name|next
operator|=
name|curlist
expr_stmt|;
name|curlist
operator|=
name|newre
expr_stmt|;
block|}
name|stmtlist
operator|=
name|nextstmt
argument_list|(
name|VAR
argument_list|,
name|stmtlist
operator|->
name|next
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|curlist
operator|)
return|;
block|}
end_function

begin_function
name|NOADPTR
name|walkputlist
parameter_list|(
name|stmtlist
parameter_list|,
name|parent
parameter_list|)
name|STMTPTR
name|stmtlist
decl_stmt|;
name|NOADPTR
name|parent
decl_stmt|;
block|{
name|NOADPTR
name|headnoad
decl_stmt|,
name|curnoad
decl_stmt|,
name|prevnoad
decl_stmt|;
name|stmtlist
operator|=
name|nextstmt
argument_list|(
name|PUT
argument_list|,
name|stmtlist
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|stmtlist
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|headnoad
operator|=
name|prevnoad
operator|=
name|rbuildnoadtree
argument_list|(
operator|(
name|PUTPTR
operator|)
name|stmtlist
operator|->
name|stmt
argument_list|)
expr_stmt|;
name|prevnoad
operator|->
name|father
operator|=
name|parent
expr_stmt|;
name|stmtlist
operator|=
name|nextstmt
argument_list|(
name|PUT
argument_list|,
name|stmtlist
operator|->
name|next
argument_list|)
expr_stmt|;
while|while
condition|(
name|stmtlist
condition|)
block|{
name|curnoad
operator|=
name|rbuildnoadtree
argument_list|(
operator|(
name|PUTPTR
operator|)
name|stmtlist
operator|->
name|stmt
argument_list|)
expr_stmt|;
name|curnoad
operator|->
name|father
operator|=
name|parent
expr_stmt|;
name|prevnoad
operator|->
name|brother
operator|=
name|curnoad
expr_stmt|;
name|prevnoad
operator|=
name|curnoad
expr_stmt|;
name|stmtlist
operator|=
name|nextstmt
argument_list|(
name|PUT
argument_list|,
name|stmtlist
operator|->
name|next
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|headnoad
operator|)
return|;
block|}
end_function

end_unit

