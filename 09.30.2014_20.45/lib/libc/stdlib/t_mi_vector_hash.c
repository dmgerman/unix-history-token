begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$NetBSD: t_mi_vector_hash.c,v 1.3 2011/07/07 11:12:18 jruoho Exp $	*/
end_comment

begin_comment
comment|/*-  * Copyright (c) 2009 The NetBSD Foundation, Inc.  * All rights reserved.  *  * This code is derived from software contributed to The NetBSD Foundation  * by Joerg Sonnenberger.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  *  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in  *    the documentation and/or other materials provided with the  *    distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS  * FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE  * COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY OR CONSEQUENTIAL DAMAGES (INCLUDING,  * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED  * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_include
include|#
directive|include
file|<sys/cdefs.h>
end_include

begin_expr_stmt
name|__RCSID
argument_list|(
literal|"$NetBSD: t_mi_vector_hash.c,v 1.3 2011/07/07 11:12:18 jruoho Exp $"
argument_list|)
expr_stmt|;
end_expr_stmt

begin_include
include|#
directive|include
file|<atf-c.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_expr_stmt
name|ATF_TC
argument_list|(
name|mi_vector_hash_basic
argument_list|)
expr_stmt|;
end_expr_stmt

begin_macro
name|ATF_TC_HEAD
argument_list|(
argument|mi_vector_hash_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|atf_tc_set_md_var
argument_list|(
name|tc
argument_list|,
literal|"descr"
argument_list|,
literal|"Test mi_vector_hash_vector_hash for consistent results"
argument_list|)
expr_stmt|;
block|}
end_block

begin_struct
specifier|static
specifier|const
struct|struct
name|testvector
block|{
specifier|const
name|char
modifier|*
name|vector
decl_stmt|;
name|uint32_t
name|hashes
index|[
literal|3
index|]
decl_stmt|;
block|}
name|testv
index|[]
init|=
block|{
block|{
literal|"hello, world"
block|,
block|{
literal|0xd38f7f21
block|,
literal|0xbf6be9ab
block|,
literal|0x37a0e989
block|}
block|}
block|,
block|{
literal|""
block|,
block|{
literal|0x9b2ec03d
block|,
literal|0xdb2b69ae
block|,
literal|0xbd49d10d
block|}
block|}
block|,
block|{
literal|"a"
block|,
block|{
literal|0x9454baa3
block|,
literal|0xb711c708
block|,
literal|0x29eec818
block|}
block|}
block|,
block|{
literal|"ab"
block|,
block|{
literal|0x9a5dca90
block|,
literal|0xdd212644
block|,
literal|0x9879ac41
block|}
block|}
block|,
block|{
literal|"abc"
block|,
block|{
literal|0x0b91c470
block|,
literal|0x4770cdf5
block|,
literal|0x251e4793
block|}
block|}
block|,
block|{
literal|"abcd"
block|,
block|{
literal|0x5f128df3
block|,
literal|0xf5a667a6
block|,
literal|0x5ae61fa5
block|}
block|}
block|,
block|{
literal|"abcde"
block|,
block|{
literal|0x4cbae281
block|,
literal|0x799c0ed5
block|,
literal|0x03a96866
block|}
block|}
block|,
block|{
literal|"abcdef"
block|,
block|{
literal|0x507a54c8
block|,
literal|0xb6bd06f4
block|,
literal|0xde922732
block|}
block|}
block|,
block|{
literal|"abcdefg"
block|,
block|{
literal|0xae2bca5d
block|,
literal|0x61e960ef
block|,
literal|0xb9e6762c
block|}
block|}
block|,
block|{
literal|"abcdefgh"
block|,
block|{
literal|0xd1021264
block|,
literal|0x87f6988f
block|,
literal|0x053f775e
block|}
block|}
block|,
block|{
literal|"abcdefghi"
block|,
block|{
literal|0xe380defc
block|,
literal|0xfc35a811
block|,
literal|0x3a7b0a5f
block|}
block|}
block|,
block|{
literal|"abcdefghij"
block|,
block|{
literal|0x9a504408
block|,
literal|0x70d2e89d
block|,
literal|0xc9cac242
block|}
block|}
block|,
block|{
literal|"abcdefghijk"
block|,
block|{
literal|0x376117d0
block|,
literal|0x89f434d4
block|,
literal|0xe52b8e4c
block|}
block|}
block|,
block|{
literal|"abcdefghijkl"
block|,
block|{
literal|0x92253599
block|,
literal|0x7b6ff99e
block|,
literal|0x0b1b3ea5
block|}
block|}
block|,
block|{
literal|"abcdefghijklm"
block|,
block|{
literal|0x92ee6a52
block|,
literal|0x55587d47
block|,
literal|0x3122b031
block|}
block|}
block|,
block|{
literal|"abcdefghijklmn"
block|,
block|{
literal|0x827baf08
block|,
literal|0x1d0ada73
block|,
literal|0xfec330e0
block|}
block|}
block|,
block|{
literal|"abcdefghijklmno"
block|,
block|{
literal|0x06ab787d
block|,
literal|0xc1ad17c2
block|,
literal|0x11dccf31
block|}
block|}
block|,
block|{
literal|"abcdefghijklmnop"
block|,
block|{
literal|0x2cf18103
block|,
literal|0x638c9268
block|,
literal|0xfa1ecf51
block|}
block|}
block|, }
struct|;
end_struct

begin_macro
name|ATF_TC_BODY
argument_list|(
argument|mi_vector_hash_basic
argument_list|,
argument|tc
argument_list|)
end_macro

begin_block
block|{
name|size_t
name|i
decl_stmt|,
name|j
decl_stmt|,
name|len
decl_stmt|;
name|uint32_t
name|hashes
index|[
literal|3
index|]
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|8
condition|;
operator|++
name|j
control|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|testv
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|testv
index|[
literal|0
index|]
argument_list|)
condition|;
operator|++
name|i
control|)
block|{
name|len
operator|=
name|strlen
argument_list|(
name|testv
index|[
name|i
index|]
operator|.
name|vector
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|buf
operator|+
name|j
argument_list|,
name|testv
index|[
name|i
index|]
operator|.
name|vector
argument_list|)
expr_stmt|;
name|mi_vector_hash
argument_list|(
name|buf
operator|+
name|j
argument_list|,
name|len
argument_list|,
literal|0
argument_list|,
name|hashes
argument_list|)
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|hashes
index|[
literal|0
index|]
argument_list|,
name|testv
index|[
name|i
index|]
operator|.
name|hashes
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|hashes
index|[
literal|1
index|]
argument_list|,
name|testv
index|[
name|i
index|]
operator|.
name|hashes
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|ATF_CHECK_EQ
argument_list|(
name|hashes
index|[
literal|2
index|]
argument_list|,
name|testv
index|[
name|i
index|]
operator|.
name|hashes
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|ATF_TP_ADD_TCS
argument_list|(
argument|tp
argument_list|)
end_macro

begin_block
block|{
name|ATF_TP_ADD_TC
argument_list|(
name|tp
argument_list|,
name|mi_vector_hash_basic
argument_list|)
expr_stmt|;
return|return
name|atf_no_error
argument_list|()
return|;
block|}
end_block

end_unit

