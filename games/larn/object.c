begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	object.c		Larn is copyrighted 1986 by Noah Morgan. */
end_comment

begin_comment
comment|/* $FreeBSD$ */
end_comment

begin_include
include|#
directive|include
file|"header.h"
end_include

begin_comment
comment|/* 	*************** 	LOOK_FOR_OBJECT 	***************  	subroutine to look for an object and give the player his options 	if an object was found.  */
end_comment

begin_macro
name|lookforobject
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|c
index|[
name|TIMESTOP
index|]
condition|)
return|return;
comment|/* can't find objects is time is stopped	*/
name|i
operator|=
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
return|return;
name|showcell
argument_list|(
name|playerx
argument_list|,
name|playery
argument_list|)
expr_stmt|;
name|cursors
argument_list|()
expr_stmt|;
name|yrepcount
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
name|OGOLDPILE
case|:
case|case
name|OMAXGOLD
case|:
case|case
name|OKGOLD
case|:
case|case
name|ODGOLD
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found some gold!"
argument_list|)
expr_stmt|;
name|ogold
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
name|OPOTION
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found a magic potion"
argument_list|)
expr_stmt|;
name|i
operator|=
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
expr_stmt|;
if|if
condition|(
name|potionname
index|[
name|i
index|]
index|[
literal|0
index|]
condition|)
name|lprintf
argument_list|(
literal|" of %s"
argument_list|,
operator|&
name|potionname
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|opotion
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSCROLL
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found a magic scroll"
argument_list|)
expr_stmt|;
name|i
operator|=
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
expr_stmt|;
if|if
condition|(
name|scrollname
index|[
name|i
index|]
index|[
literal|0
index|]
condition|)
name|lprintf
argument_list|(
literal|" of %s"
argument_list|,
operator|&
name|scrollname
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|oscroll
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
case|case
name|OALTAR
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is a Holy Altar here!"
argument_list|)
expr_stmt|;
name|oaltar
argument_list|()
expr_stmt|;
break|break;
case|case
name|OBOOK
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found a book."
argument_list|)
expr_stmt|;
name|obook
argument_list|()
expr_stmt|;
break|break;
case|case
name|OCOOKIE
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found a fortune cookie."
argument_list|)
expr_stmt|;
name|ocookie
argument_list|()
expr_stmt|;
break|break;
case|case
name|OTHRONE
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprintf
argument_list|(
literal|"\n\nThere is %s here!"
argument_list|,
name|objectname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|othrone
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|OTHRONE2
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprintf
argument_list|(
literal|"\n\nThere is %s here!"
argument_list|,
name|objectname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|othrone
argument_list|(
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODEADTHRONE
case|:
name|lprintf
argument_list|(
literal|"\n\nThere is %s here!"
argument_list|,
name|objectname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|odeadthrone
argument_list|()
expr_stmt|;
break|break;
case|case
name|OORB
case|:
name|lprcat
argument_list|(
literal|"\n\nYou have found the Orb!!!!!"
argument_list|)
expr_stmt|;
name|oorb
argument_list|()
expr_stmt|;
break|break;
case|case
name|OPIT
case|:
name|lprcat
argument_list|(
literal|"\n\nYou're standing at the top of a pit."
argument_list|)
expr_stmt|;
name|opit
argument_list|()
expr_stmt|;
break|break;
case|case
name|OSTAIRSUP
case|:
name|lprcat
argument_list|(
literal|"\n\nThere is a circular staircase here"
argument_list|)
expr_stmt|;
name|ostairs
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* up */
break|break;
case|case
name|OELEVATORUP
case|:
name|lprcat
argument_list|(
literal|"\n\nYou feel heavy for a moment, but the feeling disappears"
argument_list|)
expr_stmt|;
name|oelevator
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/*  up  */
break|break;
case|case
name|OFOUNTAIN
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is a fountain here"
argument_list|)
expr_stmt|;
name|ofountain
argument_list|()
expr_stmt|;
break|break;
case|case
name|OSTATUE
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nYou are standing in front of a statue"
argument_list|)
expr_stmt|;
name|ostatue
argument_list|()
expr_stmt|;
break|break;
case|case
name|OCHEST
case|:
name|lprcat
argument_list|(
literal|"\n\nThere is a chest here"
argument_list|)
expr_stmt|;
name|ochest
argument_list|()
expr_stmt|;
break|break;
case|case
name|OIVTELETRAP
case|:
if|if
condition|(
name|rnd
argument_list|(
literal|11
argument_list|)
operator|<
literal|6
condition|)
return|return;
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|OTELEPORTER
expr_stmt|;
name|know
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|1
expr_stmt|;
case|case
name|OTELEPORTER
case|:
name|lprcat
argument_list|(
literal|"\nZaaaappp!  You've been teleported!\n"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|oteleport
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSCHOOL
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nYou have found the College of Larn."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
block|{
name|oschool
argument_list|()
expr_stmt|;
comment|/*	the college of larn	*/
block|}
else|else
name|lprcat
argument_list|(
literal|" stay here"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OMIRROR
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is a mirror here"
argument_list|)
expr_stmt|;
name|omirror
argument_list|()
expr_stmt|;
break|break;
case|case
name|OBANK2
case|:
case|case
name|OBANK
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
if|if
condition|(
name|i
operator|==
name|OBANK
condition|)
name|lprcat
argument_list|(
literal|"\n\nYou have found the bank of Larn."
argument_list|)
expr_stmt|;
else|else
name|lprcat
argument_list|(
literal|"\n\nYou have found a branch office of the bank of Larn."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|j
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|j
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|j
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|j
operator|!=
literal|'\33'
operator|)
condition|)
name|j
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|j
operator|==
literal|'g'
condition|)
block|{
if|if
condition|(
name|i
operator|==
name|OBANK
condition|)
name|obank
argument_list|()
expr_stmt|;
else|else
name|obank2
argument_list|()
expr_stmt|;
comment|/*  the bank of larn  */
block|}
else|else
name|lprcat
argument_list|(
literal|" stay here"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODEADFOUNTAIN
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is a dead fountain here"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ODNDSTORE
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is a DND store here."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
name|dndstore
argument_list|()
expr_stmt|;
comment|/*  the dnd adventurers store  */
else|else
name|lprcat
argument_list|(
literal|" stay here"
argument_list|)
expr_stmt|;
break|break;
case|case
name|OSTAIRSDOWN
case|:
name|lprcat
argument_list|(
literal|"\n\nThere is a circular staircase here"
argument_list|)
expr_stmt|;
name|ostairs
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* down */
break|break;
case|case
name|OELEVATORDOWN
case|:
name|lprcat
argument_list|(
literal|"\n\nYou feel light for a moment, but the feeling disappears"
argument_list|)
expr_stmt|;
name|oelevator
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/*	down	*/
break|break;
case|case
name|OOPENDOOR
case|:
name|lprintf
argument_list|(
literal|"\n\nYou have found %s"
argument_list|,
name|objectname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (c) close it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'c'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|==
literal|'\33'
operator|)
operator|||
operator|(
name|i
operator|==
literal|'i'
operator|)
condition|)
block|{
name|ignore
argument_list|()
expr_stmt|;
break|break;
block|}
name|lprcat
argument_list|(
literal|"close"
argument_list|)
expr_stmt|;
name|forget
argument_list|()
expr_stmt|;
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|OCLOSEDDOOR
expr_stmt|;
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|0
expr_stmt|;
name|playerx
operator|=
name|lastpx
expr_stmt|;
name|playery
operator|=
name|lastpy
expr_stmt|;
break|break;
case|case
name|OCLOSEDDOOR
case|:
name|lprintf
argument_list|(
literal|"\n\nYou have found %s"
argument_list|,
name|objectname
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (o) try to open it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'o'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|==
literal|'\33'
operator|)
operator|||
operator|(
name|i
operator|==
literal|'i'
operator|)
condition|)
block|{
name|ignore
argument_list|()
expr_stmt|;
name|playerx
operator|=
name|lastpx
expr_stmt|;
name|playery
operator|=
name|lastpy
expr_stmt|;
break|break;
block|}
else|else
block|{
name|lprcat
argument_list|(
literal|"open"
argument_list|)
expr_stmt|;
if|if
condition|(
name|rnd
argument_list|(
literal|11
argument_list|)
operator|<
literal|7
condition|)
block|{
switch|switch
condition|(
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
condition|)
block|{
case|case
literal|6
case|:
name|c
index|[
name|AGGRAVATE
index|]
operator|+=
name|rnd
argument_list|(
literal|400
argument_list|)
expr_stmt|;
break|break;
case|case
literal|7
case|:
name|lprcat
argument_list|(
literal|"\nYou are jolted by an electric shock "
argument_list|)
expr_stmt|;
name|lastnum
operator|=
literal|274
expr_stmt|;
name|losehp
argument_list|(
name|rnd
argument_list|(
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|loselevel
argument_list|()
expr_stmt|;
break|break;
case|case
literal|9
case|:
name|lprcat
argument_list|(
literal|"\nYou suddenly feel weaker "
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|STRENGTH
index|]
operator|>
literal|3
condition|)
name|c
index|[
name|STRENGTH
index|]
operator|--
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|playerx
operator|=
name|lastpx
expr_stmt|;
name|playery
operator|=
name|lastpy
expr_stmt|;
block|}
else|else
block|{
name|forget
argument_list|()
expr_stmt|;
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|OOPENDOOR
expr_stmt|;
block|}
block|}
break|break;
case|case
name|OENTRANCE
case|:
name|lprcat
argument_list|(
literal|"\nYou have found "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
name|objectname
index|[
name|OENTRANCE
index|]
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
block|{
name|newcavelevel
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|playerx
operator|=
literal|33
expr_stmt|;
name|playery
operator|=
name|MAXY
operator|-
literal|2
expr_stmt|;
name|item
index|[
literal|33
index|]
index|[
name|MAXY
operator|-
literal|1
index|]
operator|=
name|know
index|[
literal|33
index|]
index|[
name|MAXY
operator|-
literal|1
index|]
operator|=
name|mitem
index|[
literal|33
index|]
index|[
name|MAXY
operator|-
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
return|return;
block|}
else|else
name|ignore
argument_list|()
expr_stmt|;
break|break;
case|case
name|OVOLDOWN
case|:
name|lprcat
argument_list|(
literal|"\nYou have found "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
name|objectname
index|[
name|OVOLDOWN
index|]
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (c) climb down"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'c'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|==
literal|'\33'
operator|)
operator|||
operator|(
name|i
operator|==
literal|'i'
operator|)
condition|)
block|{
name|ignore
argument_list|()
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|level
operator|!=
literal|0
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nThe shaft only extends 5 feet downward!"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|packweight
argument_list|()
operator|>
literal|45
operator|+
literal|3
operator|*
operator|(
name|c
index|[
name|STRENGTH
index|]
operator|+
name|c
index|[
name|STREXTRA
index|]
operator|)
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nYou slip and fall down the shaft"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|lastnum
operator|=
literal|275
expr_stmt|;
name|losehp
argument_list|(
literal|30
operator|+
name|rnd
argument_list|(
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|bottomhp
argument_list|()
expr_stmt|;
block|}
else|else
name|lprcat
argument_list|(
literal|"climb down"
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|newcavelevel
argument_list|(
name|MAXLEVEL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
comment|/* put player near volcano shaft */
if|if
condition|(
name|item
index|[
name|j
index|]
index|[
name|i
index|]
operator|==
name|OVOLUP
condition|)
block|{
name|playerx
operator|=
name|j
expr_stmt|;
name|playery
operator|=
name|i
expr_stmt|;
name|j
operator|=
name|MAXX
expr_stmt|;
name|i
operator|=
name|MAXY
expr_stmt|;
name|positionplayer
argument_list|()
expr_stmt|;
block|}
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
return|return;
case|case
name|OVOLUP
case|:
name|lprcat
argument_list|(
literal|"\nYou have found "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
name|objectname
index|[
name|OVOLUP
index|]
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (c) climb up"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'c'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|==
literal|'\33'
operator|)
operator|||
operator|(
name|i
operator|==
literal|'i'
operator|)
condition|)
block|{
name|ignore
argument_list|()
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|level
operator|!=
literal|11
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nThe shaft only extends 8 feet upwards before you find a blockage!"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|packweight
argument_list|()
operator|>
literal|45
operator|+
literal|5
operator|*
operator|(
name|c
index|[
name|STRENGTH
index|]
operator|+
name|c
index|[
name|STREXTRA
index|]
operator|)
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nYou slip and fall down the shaft"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|lastnum
operator|=
literal|275
expr_stmt|;
name|losehp
argument_list|(
literal|15
operator|+
name|rnd
argument_list|(
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|bottomhp
argument_list|()
expr_stmt|;
return|return;
block|}
name|lprcat
argument_list|(
literal|"climb up"
argument_list|)
expr_stmt|;
name|lflush
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|newcavelevel
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
comment|/* put player near volcano shaft */
if|if
condition|(
name|item
index|[
name|j
index|]
index|[
name|i
index|]
operator|==
name|OVOLDOWN
condition|)
block|{
name|playerx
operator|=
name|j
expr_stmt|;
name|playery
operator|=
name|i
expr_stmt|;
name|j
operator|=
name|MAXX
expr_stmt|;
name|i
operator|=
name|MAXY
expr_stmt|;
name|positionplayer
argument_list|()
expr_stmt|;
block|}
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
return|return;
case|case
name|OTRAPARROWIV
case|:
if|if
condition|(
name|rnd
argument_list|(
literal|17
argument_list|)
operator|<
literal|13
condition|)
return|return;
comment|/* for an arrow trap */
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|OTRAPARROW
expr_stmt|;
name|know
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|0
expr_stmt|;
case|case
name|OTRAPARROW
case|:
name|lprcat
argument_list|(
literal|"\nYou are hit by an arrow"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
comment|/* for an arrow trap */
name|lastnum
operator|=
literal|259
expr_stmt|;
name|losehp
argument_list|(
name|rnd
argument_list|(
literal|10
argument_list|)
operator|+
name|level
argument_list|)
expr_stmt|;
name|bottomhp
argument_list|()
expr_stmt|;
return|return;
case|case
name|OIVDARTRAP
case|:
if|if
condition|(
name|rnd
argument_list|(
literal|17
argument_list|)
operator|<
literal|13
condition|)
return|return;
comment|/* for a dart trap */
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|ODARTRAP
expr_stmt|;
name|know
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|0
expr_stmt|;
case|case
name|ODARTRAP
case|:
name|lprcat
argument_list|(
literal|"\nYou are hit by a dart"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
comment|/* for a dart trap */
name|lastnum
operator|=
literal|260
expr_stmt|;
name|losehp
argument_list|(
name|rnd
argument_list|(
literal|5
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
operator|--
name|c
index|[
name|STRENGTH
index|]
operator|)
operator|<
literal|3
condition|)
name|c
index|[
name|STRENGTH
index|]
operator|=
literal|3
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
return|return;
case|case
name|OIVTRAPDOOR
case|:
if|if
condition|(
name|rnd
argument_list|(
literal|17
argument_list|)
operator|<
literal|13
condition|)
return|return;
comment|/* for a trap door */
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|OTRAPDOOR
expr_stmt|;
name|know
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|1
expr_stmt|;
case|case
name|OTRAPDOOR
case|:
name|lastnum
operator|=
literal|272
expr_stmt|;
comment|/* a trap door */
if|if
condition|(
operator|(
name|level
operator|==
name|MAXLEVEL
operator|-
literal|1
operator|)
operator|||
operator|(
name|level
operator|==
name|MAXLEVEL
operator|+
name|MAXVLEVEL
operator|-
literal|1
operator|)
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nYou fell through a bottomless trap door!"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|died
argument_list|(
literal|271
argument_list|)
expr_stmt|;
block|}
name|lprcat
argument_list|(
literal|"\nYou fall through a trap door!"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
comment|/* for a trap door */
name|losehp
argument_list|(
name|rnd
argument_list|(
literal|5
operator|+
name|level
argument_list|)
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|newcavelevel
argument_list|(
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
return|return;
case|case
name|OTRADEPOST
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\nYou have found the Larn trading Post."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
name|otradepost
argument_list|()
expr_stmt|;
else|else
name|lprcat
argument_list|(
literal|"stay here"
argument_list|)
expr_stmt|;
return|return;
case|case
name|OHOME
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\nYou have found your way home."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
name|ohome
argument_list|()
expr_stmt|;
else|else
name|lprcat
argument_list|(
literal|"stay here"
argument_list|)
expr_stmt|;
return|return;
case|case
name|OWALL
case|:
break|break;
case|case
name|OANNIHILATION
case|:
name|died
argument_list|(
literal|283
argument_list|)
expr_stmt|;
return|return;
comment|/* annihilated by sphere of annihilation */
case|case
name|OLRS
case|:
if|if
condition|(
name|nearbymonst
argument_list|()
condition|)
return|return;
name|lprcat
argument_list|(
literal|"\n\nThere is an LRS office here."
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (g) go inside, or (i) stay here? "
argument_list|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
name|i
operator|!=
literal|'g'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'i'
operator|)
operator|&&
operator|(
name|i
operator|!=
literal|'\33'
operator|)
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'g'
condition|)
name|olrs
argument_list|()
expr_stmt|;
comment|/*  the larn revenue service */
else|else
name|lprcat
argument_list|(
literal|" stay here"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|finditem
argument_list|(
name|i
argument_list|)
expr_stmt|;
break|break;
block|}
empty_stmt|;
block|}
end_block

begin_comment
comment|/* 	function to say what object we found and ask if player wants to take it  */
end_comment

begin_macro
name|finditem
argument_list|(
argument|itm
argument_list|)
end_macro

begin_decl_stmt
name|int
name|itm
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|tmp
decl_stmt|,
name|i
decl_stmt|;
name|lprintf
argument_list|(
literal|"\n\nYou have found %s "
argument_list|,
name|objectname
index|[
name|itm
index|]
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
expr_stmt|;
switch|switch
condition|(
name|itm
condition|)
block|{
case|case
name|ODIAMOND
case|:
case|case
name|ORUBY
case|:
case|case
name|OEMERALD
case|:
case|case
name|OSAPPHIRE
case|:
case|case
name|OSPIRITSCARAB
case|:
case|case
name|OORBOFDRAGON
case|:
case|case
name|OCUBEofUNDEAD
case|:
case|case
name|ONOTHEFT
case|:
break|break;
default|default:
if|if
condition|(
name|tmp
operator|>
literal|0
condition|)
name|lprintf
argument_list|(
literal|"+ %d"
argument_list|,
operator|(
name|long
operator|)
name|tmp
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|tmp
operator|<
literal|0
condition|)
name|lprintf
argument_list|(
literal|" %d"
argument_list|,
operator|(
name|long
operator|)
name|tmp
argument_list|)
expr_stmt|;
block|}
name|lprcat
argument_list|(
literal|"\nDo you want to (t) take it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|i
operator|!=
literal|'t'
operator|&&
name|i
operator|!=
literal|'i'
operator|&&
name|i
operator|!=
literal|'\33'
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'t'
condition|)
block|{
name|lprcat
argument_list|(
literal|"take"
argument_list|)
expr_stmt|;
if|if
condition|(
name|take
argument_list|(
name|itm
argument_list|,
name|tmp
argument_list|)
operator|==
literal|0
condition|)
name|forget
argument_list|()
expr_stmt|;
return|return;
block|}
name|ignore
argument_list|()
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* 	******* 	OSTAIRS 	*******  	subroutine to process the stair cases 	if dir> 0 the up else down  */
end_comment

begin_macro
name|ostairs
argument_list|(
argument|dir
argument_list|)
end_macro

begin_decl_stmt
name|int
name|dir
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|k
decl_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (s) stay here  "
argument_list|)
expr_stmt|;
if|if
condition|(
name|dir
operator|>
literal|0
condition|)
name|lprcat
argument_list|(
literal|"(u) go up  "
argument_list|)
expr_stmt|;
else|else
name|lprcat
argument_list|(
literal|"(d) go down  "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"or (f) kick stairs? "
argument_list|)
expr_stmt|;
while|while
condition|(
literal|1
condition|)
switch|switch
condition|(
name|getchar
argument_list|()
condition|)
block|{
case|case
literal|'\33'
case|:
case|case
literal|'s'
case|:
case|case
literal|'i'
case|:
name|lprcat
argument_list|(
literal|"stay here"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'f'
case|:
name|lprcat
argument_list|(
literal|"kick stairs"
argument_list|)
expr_stmt|;
if|if
condition|(
name|rnd
argument_list|(
literal|2
argument_list|)
operator|==
literal|1
condition|)
name|lprcat
argument_list|(
literal|"\nI hope you feel better.  Showing anger rids you of frustration."
argument_list|)
expr_stmt|;
else|else
block|{
name|k
operator|=
name|rnd
argument_list|(
operator|(
name|level
operator|+
literal|1
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|lprintf
argument_list|(
literal|"\nYou hurt your foot dumb dumb!  You suffer %d hit points"
argument_list|,
operator|(
name|long
operator|)
name|k
argument_list|)
expr_stmt|;
name|lastnum
operator|=
literal|276
expr_stmt|;
name|losehp
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
block|}
return|return;
case|case
literal|'u'
case|:
name|lprcat
argument_list|(
literal|"go up"
argument_list|)
expr_stmt|;
if|if
condition|(
name|dir
operator|<
literal|0
condition|)
name|lprcat
argument_list|(
literal|"\nThe stairs don't go up!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|>=
literal|2
operator|&&
name|level
operator|!=
literal|11
condition|)
block|{
name|k
operator|=
name|level
expr_stmt|;
name|newcavelevel
argument_list|(
name|level
operator|-
literal|1
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
block|}
else|else
name|lprcat
argument_list|(
literal|"\nThe stairs lead to a dead end!"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'d'
case|:
name|lprcat
argument_list|(
literal|"go down"
argument_list|)
expr_stmt|;
if|if
condition|(
name|dir
operator|>
literal|0
condition|)
name|lprcat
argument_list|(
literal|"\nThe stairs don't go down!"
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|!=
literal|0
operator|&&
name|level
operator|!=
literal|10
operator|&&
name|level
operator|!=
literal|13
condition|)
block|{
name|k
operator|=
name|level
expr_stmt|;
name|newcavelevel
argument_list|(
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
block|}
else|else
name|lprcat
argument_list|(
literal|"\nThe stairs lead to a dead end!"
argument_list|)
expr_stmt|;
return|return;
block|}
empty_stmt|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* 	********* 	OTELEPORTER 	*********  	subroutine to handle a teleport trap +/- 1 level maximum  */
end_comment

begin_macro
name|oteleport
argument_list|(
argument|err
argument_list|)
end_macro

begin_decl_stmt
name|int
name|err
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|tmp
decl_stmt|;
if|if
condition|(
name|err
condition|)
if|if
condition|(
name|rnd
argument_list|(
literal|151
argument_list|)
operator|<
literal|3
condition|)
name|died
argument_list|(
literal|264
argument_list|)
expr_stmt|;
comment|/*	stuck in a rock */
name|c
index|[
name|TELEFLAG
index|]
operator|=
literal|1
expr_stmt|;
comment|/*	show ?? on bottomline if been teleported	*/
if|if
condition|(
name|level
operator|==
literal|0
condition|)
name|tmp
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|<
name|MAXLEVEL
condition|)
block|{
name|tmp
operator|=
name|rnd
argument_list|(
literal|5
argument_list|)
operator|+
name|level
operator|-
literal|3
expr_stmt|;
if|if
condition|(
name|tmp
operator|>=
name|MAXLEVEL
condition|)
name|tmp
operator|=
name|MAXLEVEL
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|tmp
operator|<
literal|1
condition|)
name|tmp
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|rnd
argument_list|(
literal|3
argument_list|)
operator|+
name|level
operator|-
literal|2
expr_stmt|;
if|if
condition|(
name|tmp
operator|>=
name|MAXLEVEL
operator|+
name|MAXVLEVEL
condition|)
name|tmp
operator|=
name|MAXLEVEL
operator|+
name|MAXVLEVEL
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|tmp
operator|<
name|MAXLEVEL
condition|)
name|tmp
operator|=
name|MAXLEVEL
expr_stmt|;
block|}
name|playerx
operator|=
name|rnd
argument_list|(
name|MAXX
operator|-
literal|2
argument_list|)
expr_stmt|;
name|playery
operator|=
name|rnd
argument_list|(
name|MAXY
operator|-
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|level
operator|!=
name|tmp
condition|)
name|newcavelevel
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
name|positionplayer
argument_list|()
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|bot_linex
argument_list|()
expr_stmt|;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* 	******* 	OPOTION 	*******  	function to process a potion  */
end_comment

begin_macro
name|opotion
argument_list|(
argument|pot
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pot
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|lprcat
argument_list|(
literal|"\nDo you (d) drink it, (t) take it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
while|while
condition|(
literal|1
condition|)
switch|switch
condition|(
name|getchar
argument_list|()
condition|)
block|{
case|case
literal|'\33'
case|:
case|case
literal|'i'
case|:
name|ignore
argument_list|()
expr_stmt|;
return|return;
case|case
literal|'d'
case|:
name|lprcat
argument_list|(
literal|"drink\n"
argument_list|)
expr_stmt|;
name|forget
argument_list|()
expr_stmt|;
comment|/*	destroy potion	*/
name|quaffpotion
argument_list|(
name|pot
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'t'
case|:
name|lprcat
argument_list|(
literal|"take\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|take
argument_list|(
name|OPOTION
argument_list|,
name|pot
argument_list|)
operator|==
literal|0
condition|)
name|forget
argument_list|()
expr_stmt|;
return|return;
block|}
empty_stmt|;
block|}
end_block

begin_comment
comment|/* 	function to drink a potion  */
end_comment

begin_macro
name|quaffpotion
argument_list|(
argument|pot
argument_list|)
end_macro

begin_decl_stmt
name|int
name|pot
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
if|if
condition|(
name|pot
operator|<
literal|0
operator|||
name|pot
operator|>=
name|MAXPOTION
condition|)
return|return;
comment|/* check for within bounds */
name|potionname
index|[
name|pot
index|]
index|[
literal|0
index|]
operator|=
literal|' '
expr_stmt|;
switch|switch
condition|(
name|pot
condition|)
block|{
case|case
literal|9
case|:
name|lprcat
argument_list|(
literal|"\nYou feel greedy . . ."
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
if|if
condition|(
operator|(
name|item
index|[
name|j
index|]
index|[
name|i
index|]
operator|==
name|OGOLDPILE
operator|)
operator|||
operator|(
name|item
index|[
name|j
index|]
index|[
name|i
index|]
operator|==
name|OMAXGOLD
operator|)
condition|)
block|{
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|show1cell
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
name|showplayer
argument_list|()
expr_stmt|;
return|return;
case|case
literal|19
case|:
name|lprcat
argument_list|(
literal|"\nYou feel greedy . . ."
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
block|{
name|k
operator|=
name|item
index|[
name|j
index|]
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|k
operator|==
name|ODIAMOND
operator|)
operator|||
operator|(
name|k
operator|==
name|ORUBY
operator|)
operator|||
operator|(
name|k
operator|==
name|OEMERALD
operator|)
operator|||
operator|(
name|k
operator|==
name|OMAXGOLD
operator|)
operator|||
operator|(
name|k
operator|==
name|OSAPPHIRE
operator|)
operator|||
operator|(
name|k
operator|==
name|OLARNEYE
operator|)
operator|||
operator|(
name|k
operator|==
name|OGOLDPILE
operator|)
condition|)
block|{
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|show1cell
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
block|}
name|showplayer
argument_list|()
expr_stmt|;
return|return;
case|case
literal|20
case|:
name|c
index|[
name|HP
index|]
operator|=
name|c
index|[
name|HPMAX
index|]
expr_stmt|;
break|break;
comment|/* instant healing */
case|case
literal|1
case|:
name|lprcat
argument_list|(
literal|"\nYou feel better"
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|HP
index|]
operator|==
name|c
index|[
name|HPMAX
index|]
condition|)
name|raisemhp
argument_list|(
literal|1
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|c
index|[
name|HP
index|]
operator|+=
name|rnd
argument_list|(
literal|20
argument_list|)
operator|+
literal|20
operator|+
name|c
index|[
name|LEVEL
index|]
operator|)
operator|>
name|c
index|[
name|HPMAX
index|]
condition|)
name|c
index|[
name|HP
index|]
operator|=
name|c
index|[
name|HPMAX
index|]
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|lprcat
argument_list|(
literal|"\nSuddenly, you feel much more skillful!"
argument_list|)
expr_stmt|;
name|raiselevel
argument_list|()
expr_stmt|;
name|raisemhp
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return;
case|case
literal|3
case|:
name|lprcat
argument_list|(
literal|"\nYou feel strange for a moment"
argument_list|)
expr_stmt|;
name|c
index|[
name|rund
argument_list|(
literal|6
argument_list|)
index|]
operator|++
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|lprcat
argument_list|(
literal|"\nYou feel more self confident!"
argument_list|)
expr_stmt|;
name|c
index|[
name|WISDOM
index|]
operator|+=
name|rnd
argument_list|(
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|lprcat
argument_list|(
literal|"\nWow!  You feel great!"
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|STRENGTH
index|]
operator|<
literal|12
condition|)
name|c
index|[
name|STRENGTH
index|]
operator|=
literal|12
expr_stmt|;
else|else
name|c
index|[
name|STRENGTH
index|]
operator|++
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|lprcat
argument_list|(
literal|"\nYour charm went up by one!"
argument_list|)
expr_stmt|;
name|c
index|[
name|CHARISMA
index|]
operator|++
expr_stmt|;
break|break;
case|case
literal|8
case|:
name|lprcat
argument_list|(
literal|"\nYour intelligence went up by one!"
argument_list|)
expr_stmt|;
name|c
index|[
name|INTELLIGENCE
index|]
operator|++
expr_stmt|;
break|break;
case|case
literal|10
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|mitem
index|[
name|j
index|]
index|[
name|i
index|]
condition|)
block|{
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|show1cell
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
comment|/*	monster detection	*/
return|return;
case|case
literal|12
case|:
name|lprcat
argument_list|(
literal|"\nThis potion has no taste to it"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|15
case|:
name|lprcat
argument_list|(
literal|"\nWOW!!!  You feel Super-fantastic!!!"
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|HERO
index|]
operator|==
literal|0
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
name|c
index|[
name|i
index|]
operator|+=
literal|11
expr_stmt|;
name|c
index|[
name|HERO
index|]
operator|+=
literal|250
expr_stmt|;
break|break;
case|case
literal|16
case|:
name|lprcat
argument_list|(
literal|"\nYou have a greater intestinal constitude!"
argument_list|)
expr_stmt|;
name|c
index|[
name|CONSTITUTION
index|]
operator|++
expr_stmt|;
break|break;
case|case
literal|17
case|:
name|lprcat
argument_list|(
literal|"\nYou now have incredibly bulging muscles!!!"
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|GIANTSTR
index|]
operator|==
literal|0
condition|)
name|c
index|[
name|STREXTRA
index|]
operator|+=
literal|21
expr_stmt|;
name|c
index|[
name|GIANTSTR
index|]
operator|+=
literal|700
expr_stmt|;
break|break;
case|case
literal|18
case|:
name|lprcat
argument_list|(
literal|"\nYou feel a chill run up your spine!"
argument_list|)
expr_stmt|;
name|c
index|[
name|FIRERESISTANCE
index|]
operator|+=
literal|1000
expr_stmt|;
break|break;
case|case
literal|0
case|:
name|lprcat
argument_list|(
literal|"\nYou fall asleep. . ."
argument_list|)
expr_stmt|;
name|i
operator|=
name|rnd
argument_list|(
literal|11
argument_list|)
operator|-
operator|(
name|c
index|[
name|CONSTITUTION
index|]
operator|>>
literal|2
operator|)
operator|+
literal|2
expr_stmt|;
while|while
condition|(
operator|--
name|i
operator|>
literal|0
condition|)
block|{
name|parse2
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
block|}
name|cursors
argument_list|()
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nYou woke up!"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|7
case|:
name|lprcat
argument_list|(
literal|"\nYou become dizzy!"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|--
name|c
index|[
name|STRENGTH
index|]
operator|<
literal|3
condition|)
name|c
index|[
name|STRENGTH
index|]
operator|=
literal|3
expr_stmt|;
break|break;
case|case
literal|11
case|:
name|lprcat
argument_list|(
literal|"\nYou stagger for a moment . ."
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
comment|/* potion of forgetfulness */
return|return;
case|case
literal|13
case|:
name|lprcat
argument_list|(
literal|"\nYou can't see anything!"
argument_list|)
expr_stmt|;
comment|/* blindness */
name|c
index|[
name|BLINDCOUNT
index|]
operator|+=
literal|500
expr_stmt|;
return|return;
case|case
literal|14
case|:
name|lprcat
argument_list|(
literal|"\nYou feel confused"
argument_list|)
expr_stmt|;
name|c
index|[
name|CONFUSE
index|]
operator|+=
literal|20
operator|+
name|rnd
argument_list|(
literal|9
argument_list|)
expr_stmt|;
return|return;
case|case
literal|21
case|:
name|lprcat
argument_list|(
literal|"\nYou don't seem to be affected"
argument_list|)
expr_stmt|;
return|return;
comment|/* cure dianthroritis */
case|case
literal|22
case|:
name|lprcat
argument_list|(
literal|"\nYou feel a sickness engulf you"
argument_list|)
expr_stmt|;
comment|/* poison */
name|c
index|[
name|HALFDAM
index|]
operator|+=
literal|200
operator|+
name|rnd
argument_list|(
literal|200
argument_list|)
expr_stmt|;
return|return;
case|case
literal|23
case|:
name|lprcat
argument_list|(
literal|"\nYou feel your vision sharpen"
argument_list|)
expr_stmt|;
comment|/* see invisible */
name|c
index|[
name|SEEINVISIBLE
index|]
operator|+=
name|rnd
argument_list|(
literal|1000
argument_list|)
operator|+
literal|400
expr_stmt|;
name|monstnamelist
index|[
name|INVISIBLESTALKER
index|]
operator|=
literal|'I'
expr_stmt|;
return|return;
block|}
empty_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
comment|/*	show new stats		*/
return|return;
block|}
end_block

begin_escape
end_escape

begin_comment
comment|/* 	******* 	OSCROLL 	*******  	function to process a magic scroll  */
end_comment

begin_macro
name|oscroll
argument_list|(
argument|typ
argument_list|)
end_macro

begin_decl_stmt
name|int
name|typ
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|lprcat
argument_list|(
literal|"\nDo you "
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|BLINDCOUNT
index|]
operator|==
literal|0
condition|)
name|lprcat
argument_list|(
literal|"(r) read it, "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"(t) take it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
while|while
condition|(
literal|1
condition|)
switch|switch
condition|(
name|getchar
argument_list|()
condition|)
block|{
case|case
literal|'\33'
case|:
case|case
literal|'i'
case|:
name|ignore
argument_list|()
expr_stmt|;
return|return;
case|case
literal|'r'
case|:
if|if
condition|(
name|c
index|[
name|BLINDCOUNT
index|]
condition|)
break|break;
name|lprcat
argument_list|(
literal|"read"
argument_list|)
expr_stmt|;
name|forget
argument_list|()
expr_stmt|;
if|if
condition|(
name|typ
operator|==
literal|2
operator|||
name|typ
operator|==
literal|15
condition|)
block|{
name|show1cell
argument_list|(
name|playerx
argument_list|,
name|playery
argument_list|)
expr_stmt|;
name|cursors
argument_list|()
expr_stmt|;
block|}
comment|/*	destroy it	*/
name|read_scroll
argument_list|(
name|typ
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'t'
case|:
name|lprcat
argument_list|(
literal|"take"
argument_list|)
expr_stmt|;
if|if
condition|(
name|take
argument_list|(
name|OSCROLL
argument_list|,
name|typ
argument_list|)
operator|==
literal|0
condition|)
name|forget
argument_list|()
expr_stmt|;
comment|/*	destroy it	*/
return|return;
block|}
empty_stmt|;
block|}
end_block

begin_comment
comment|/* 	data for the function to read a scroll  */
end_comment

begin_decl_stmt
specifier|static
name|int
name|xh
decl_stmt|,
name|yh
decl_stmt|,
name|yl
decl_stmt|,
name|xl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|curse
index|[]
init|=
block|{
name|BLINDCOUNT
block|,
name|CONFUSE
block|,
name|AGGRAVATE
block|,
name|HASTEMONST
block|,
name|ITCHING
block|,
name|LAUGHING
block|,
name|DRAINSTRENGTH
block|,
name|CLUMSINESS
block|,
name|INFEEBLEMENT
block|,
name|HALFDAM
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
name|exten
index|[]
init|=
block|{
name|PROTECTIONTIME
block|,
name|DEXCOUNT
block|,
name|STRCOUNT
block|,
name|CHARMCOUNT
block|,
name|INVISIBILITY
block|,
name|CANCELLATION
block|,
name|HASTESELF
block|,
name|GLOBE
block|,
name|SCAREMONST
block|,
name|HOLDMONST
block|,
name|TIMESTOP
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|time_change
index|[]
init|=
block|{
name|HASTESELF
block|,
name|HERO
block|,
name|ALTPRO
block|,
name|PROTECTIONTIME
block|,
name|DEXCOUNT
block|,
name|STRCOUNT
block|,
name|GIANTSTR
block|,
name|CHARMCOUNT
block|,
name|INVISIBILITY
block|,
name|CANCELLATION
block|,
name|HASTESELF
block|,
name|AGGRAVATE
block|,
name|SCAREMONST
block|,
name|STEALTH
block|,
name|AWARENESS
block|,
name|HOLDMONST
block|,
name|HASTEMONST
block|,
name|FIRERESISTANCE
block|,
name|GLOBE
block|,
name|SPIRITPRO
block|,
name|UNDEADPRO
block|,
name|HALFDAM
block|,
name|SEEINVISIBLE
block|,
name|ITCHING
block|,
name|CLUMSINESS
block|,
name|WTW
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  *	function to adjust time when time warping and taking courses in school  */
end_comment

begin_macro
name|adjtime
argument_list|(
argument|tim
argument_list|)
end_macro

begin_decl_stmt
name|long
name|tim
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|j
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|26
condition|;
name|j
operator|++
control|)
comment|/* adjust time related parameters */
if|if
condition|(
name|c
index|[
name|time_change
index|[
name|j
index|]
index|]
condition|)
if|if
condition|(
operator|(
name|c
index|[
name|time_change
index|[
name|j
index|]
index|]
operator|-=
name|tim
operator|)
operator|<
literal|1
condition|)
name|c
index|[
name|time_change
index|[
name|j
index|]
index|]
operator|=
literal|1
expr_stmt|;
name|regen
argument_list|()
expr_stmt|;
block|}
end_block

begin_comment
comment|/* 	function to read a scroll  */
end_comment

begin_macro
name|read_scroll
argument_list|(
argument|typ
argument_list|)
end_macro

begin_decl_stmt
name|int
name|typ
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|typ
operator|<
literal|0
operator|||
name|typ
operator|>=
name|MAXSCROLL
condition|)
return|return;
comment|/* be sure we are within bounds */
name|scrollname
index|[
name|typ
index|]
index|[
literal|0
index|]
operator|=
literal|' '
expr_stmt|;
switch|switch
condition|(
name|typ
condition|)
block|{
case|case
literal|0
case|:
name|lprcat
argument_list|(
literal|"\nYour armor glows for a moment"
argument_list|)
expr_stmt|;
name|enchantarmor
argument_list|()
expr_stmt|;
return|return;
case|case
literal|1
case|:
name|lprcat
argument_list|(
literal|"\nYour weapon glows for a moment"
argument_list|)
expr_stmt|;
name|enchweapon
argument_list|()
expr_stmt|;
return|return;
comment|/* enchant weapon */
case|case
literal|2
case|:
name|lprcat
argument_list|(
literal|"\nYou have been granted enlightenment!"
argument_list|)
expr_stmt|;
name|yh
operator|=
name|min
argument_list|(
name|playery
operator|+
literal|7
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
name|xh
operator|=
name|min
argument_list|(
name|playerx
operator|+
literal|25
argument_list|,
name|MAXX
argument_list|)
expr_stmt|;
name|yl
operator|=
name|max
argument_list|(
name|playery
operator|-
literal|7
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xl
operator|=
name|max
argument_list|(
name|playerx
operator|-
literal|25
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|yl
init|;
name|i
operator|<
name|yh
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
name|xl
init|;
name|j
operator|<
name|xh
condition|;
name|j
operator|++
control|)
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|draws
argument_list|(
name|xl
argument_list|,
name|xh
argument_list|,
name|yl
argument_list|,
name|yh
argument_list|)
expr_stmt|;
return|return;
case|case
literal|3
case|:
name|lprcat
argument_list|(
literal|"\nThis scroll seems to be blank"
argument_list|)
expr_stmt|;
return|return;
case|case
literal|4
case|:
name|createmonster
argument_list|(
name|makemonst
argument_list|(
name|level
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
return|return;
comment|/*  this one creates a monster  */
case|case
literal|5
case|:
name|something
argument_list|(
name|level
argument_list|)
expr_stmt|;
comment|/*	create artifact		*/
return|return;
case|case
literal|6
case|:
name|c
index|[
name|AGGRAVATE
index|]
operator|+=
literal|800
expr_stmt|;
return|return;
comment|/* aggravate monsters */
case|case
literal|7
case|:
name|gtime
operator|+=
operator|(
name|i
operator|=
name|rnd
argument_list|(
literal|1000
argument_list|)
operator|-
literal|850
operator|)
expr_stmt|;
comment|/* time warp */
if|if
condition|(
name|i
operator|>=
literal|0
condition|)
name|lprintf
argument_list|(
literal|"\nYou went forward in time by %d mobuls"
argument_list|,
call|(
name|long
call|)
argument_list|(
operator|(
name|i
operator|+
literal|99
operator|)
operator|/
literal|100
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|lprintf
argument_list|(
literal|"\nYou went backward in time by %d mobuls"
argument_list|,
call|(
name|long
call|)
argument_list|(
operator|-
operator|(
name|i
operator|+
literal|99
operator|)
operator|/
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|adjtime
argument_list|(
operator|(
name|long
operator|)
name|i
argument_list|)
expr_stmt|;
comment|/* adjust time for time warping */
return|return;
case|case
literal|8
case|:
name|oteleport
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return;
comment|/*	teleportation */
case|case
literal|9
case|:
name|c
index|[
name|AWARENESS
index|]
operator|+=
literal|1800
expr_stmt|;
return|return;
comment|/* expanded awareness	*/
case|case
literal|10
case|:
name|c
index|[
name|HASTEMONST
index|]
operator|+=
name|rnd
argument_list|(
literal|55
argument_list|)
operator|+
literal|12
expr_stmt|;
return|return;
comment|/* haste monster */
case|case
literal|11
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|mitem
index|[
name|j
index|]
index|[
name|i
index|]
condition|)
name|hitp
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
name|monster
index|[
name|mitem
index|[
name|j
index|]
index|[
name|i
index|]
index|]
operator|.
name|hitpoints
expr_stmt|;
return|return;
comment|/* monster healing */
case|case
literal|12
case|:
name|c
index|[
name|SPIRITPRO
index|]
operator|+=
literal|300
operator|+
name|rnd
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
return|return;
comment|/* spirit protection */
case|case
literal|13
case|:
name|c
index|[
name|UNDEADPRO
index|]
operator|+=
literal|300
operator|+
name|rnd
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
return|return;
comment|/* undead protection */
case|case
literal|14
case|:
name|c
index|[
name|STEALTH
index|]
operator|+=
literal|250
operator|+
name|rnd
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
return|return;
comment|/* stealth */
case|case
literal|15
case|:
name|lprcat
argument_list|(
literal|"\nYou have been granted enlightenment!"
argument_list|)
expr_stmt|;
comment|/* magic mapping */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXY
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|MAXX
condition|;
name|j
operator|++
control|)
name|know
index|[
name|j
index|]
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
return|return;
case|case
literal|16
case|:
name|c
index|[
name|HOLDMONST
index|]
operator|+=
literal|30
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
return|return;
comment|/* hold monster */
case|case
literal|17
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|26
condition|;
name|i
operator|++
control|)
comment|/* gem perfection */
switch|switch
condition|(
name|iven
index|[
name|i
index|]
condition|)
block|{
case|case
name|ODIAMOND
case|:
case|case
name|ORUBY
case|:
case|case
name|OEMERALD
case|:
case|case
name|OSAPPHIRE
case|:
name|j
operator|=
name|ivenarg
index|[
name|i
index|]
expr_stmt|;
name|j
operator|&=
literal|255
expr_stmt|;
name|j
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|j
operator|>
literal|255
condition|)
name|j
operator|=
literal|255
expr_stmt|;
comment|/* double value */
name|ivenarg
index|[
name|i
index|]
operator|=
name|j
expr_stmt|;
break|break;
block|}
break|break;
case|case
literal|18
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|11
condition|;
name|i
operator|++
control|)
name|c
index|[
name|exten
index|[
name|i
index|]
index|]
operator|<<=
literal|1
expr_stmt|;
comment|/* spell extension */
break|break;
case|case
literal|19
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|26
condition|;
name|i
operator|++
control|)
comment|/* identify */
block|{
if|if
condition|(
name|iven
index|[
name|i
index|]
operator|==
name|OPOTION
condition|)
name|potionname
index|[
name|ivenarg
index|[
name|i
index|]
index|]
index|[
literal|0
index|]
operator|=
literal|' '
expr_stmt|;
if|if
condition|(
name|iven
index|[
name|i
index|]
operator|==
name|OSCROLL
condition|)
name|scrollname
index|[
name|ivenarg
index|[
name|i
index|]
index|]
index|[
literal|0
index|]
operator|=
literal|' '
expr_stmt|;
block|}
break|break;
case|case
literal|20
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
comment|/* remove curse */
if|if
condition|(
name|c
index|[
name|curse
index|[
name|i
index|]
index|]
condition|)
name|c
index|[
name|curse
index|[
name|i
index|]
index|]
operator|=
literal|1
expr_stmt|;
break|break;
case|case
literal|21
case|:
name|annihilate
argument_list|()
expr_stmt|;
break|break;
comment|/* scroll of annihilation */
case|case
literal|22
case|:
name|godirect
argument_list|(
literal|22
argument_list|,
literal|150
argument_list|,
literal|"The ray hits the %s"
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
comment|/* pulverization */
break|break;
case|case
literal|23
case|:
name|c
index|[
name|LIFEPROT
index|]
operator|++
expr_stmt|;
break|break;
comment|/* life protection */
block|}
empty_stmt|;
block|}
end_block

begin_escape
end_escape

begin_macro
name|oorb
argument_list|()
end_macro

begin_block
block|{ 	}
end_block

begin_macro
name|opit
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|rnd
argument_list|(
literal|101
argument_list|)
operator|<
literal|81
condition|)
if|if
condition|(
name|rnd
argument_list|(
literal|70
argument_list|)
operator|>
literal|9
operator|*
name|c
index|[
name|DEXTERITY
index|]
operator|-
name|packweight
argument_list|()
operator|||
name|rnd
argument_list|(
literal|101
argument_list|)
operator|<
literal|5
condition|)
if|if
condition|(
name|level
operator|==
name|MAXLEVEL
operator|-
literal|1
condition|)
name|obottomless
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|level
operator|==
name|MAXLEVEL
operator|+
name|MAXVLEVEL
operator|-
literal|1
condition|)
name|obottomless
argument_list|()
expr_stmt|;
else|else
block|{
if|if
condition|(
name|rnd
argument_list|(
literal|101
argument_list|)
operator|<
literal|20
condition|)
block|{
name|i
operator|=
literal|0
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nYou fell into a pit!  Your fall is cushioned by an unknown force\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|i
operator|=
name|rnd
argument_list|(
name|level
operator|*
literal|3
operator|+
literal|3
argument_list|)
expr_stmt|;
name|lprintf
argument_list|(
literal|"\nYou fell into a pit!  You suffer %d hit points damage"
argument_list|,
operator|(
name|long
operator|)
name|i
argument_list|)
expr_stmt|;
name|lastnum
operator|=
literal|261
expr_stmt|;
comment|/*	if he dies scoreboard will say so */
block|}
name|losehp
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|newcavelevel
argument_list|(
name|level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|draws
argument_list|(
literal|0
argument_list|,
name|MAXX
argument_list|,
literal|0
argument_list|,
name|MAXY
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|obottomless
argument_list|()
end_macro

begin_block
block|{
name|lprcat
argument_list|(
literal|"\nYou fell into a bottomless pit!"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|died
argument_list|(
literal|262
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|oelevator
argument_list|(
argument|dir
argument_list|)
end_macro

begin_decl_stmt
name|int
name|dir
decl_stmt|;
end_decl_stmt

begin_block
block|{
ifdef|#
directive|ifdef
name|lint
name|int
name|x
decl_stmt|;
name|x
operator|=
name|dir
expr_stmt|;
name|dir
operator|=
name|x
expr_stmt|;
endif|#
directive|endif
endif|lint
block|}
end_block

begin_macro
name|ostatue
argument_list|()
end_macro

begin_block
block|{ 	}
end_block

begin_macro
name|omirror
argument_list|()
end_macro

begin_block
block|{ 	}
end_block

begin_macro
name|obook
argument_list|()
end_macro

begin_block
block|{
name|lprcat
argument_list|(
literal|"\nDo you "
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
index|[
name|BLINDCOUNT
index|]
operator|==
literal|0
condition|)
name|lprcat
argument_list|(
literal|"(r) read it, "
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"(t) take it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
while|while
condition|(
literal|1
condition|)
switch|switch
condition|(
name|getchar
argument_list|()
condition|)
block|{
case|case
literal|'\33'
case|:
case|case
literal|'i'
case|:
name|ignore
argument_list|()
expr_stmt|;
return|return;
case|case
literal|'r'
case|:
if|if
condition|(
name|c
index|[
name|BLINDCOUNT
index|]
condition|)
break|break;
name|lprcat
argument_list|(
literal|"read"
argument_list|)
expr_stmt|;
comment|/* no more book	*/
name|readbook
argument_list|(
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
argument_list|)
expr_stmt|;
name|forget
argument_list|()
expr_stmt|;
return|return;
case|case
literal|'t'
case|:
name|lprcat
argument_list|(
literal|"take"
argument_list|)
expr_stmt|;
if|if
condition|(
name|take
argument_list|(
name|OBOOK
argument_list|,
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
argument_list|)
operator|==
literal|0
condition|)
name|forget
argument_list|()
expr_stmt|;
comment|/* no more book	*/
return|return;
block|}
empty_stmt|;
block|}
end_block

begin_comment
comment|/* 	function to read a book  */
end_comment

begin_macro
name|readbook
argument_list|(
argument|lev
argument_list|)
end_macro

begin_decl_stmt
name|int
name|lev
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|,
name|tmp
decl_stmt|;
if|if
condition|(
name|lev
operator|<=
literal|3
condition|)
name|i
operator|=
name|rund
argument_list|(
operator|(
name|tmp
operator|=
name|splev
index|[
name|lev
index|]
operator|)
condition|?
name|tmp
else|:
literal|1
argument_list|)
expr_stmt|;
else|else
name|i
operator|=
name|rnd
argument_list|(
operator|(
name|tmp
operator|=
name|splev
index|[
name|lev
index|]
operator|-
literal|9
operator|)
condition|?
name|tmp
else|:
literal|1
argument_list|)
operator|+
literal|9
expr_stmt|;
name|spelknow
index|[
name|i
index|]
operator|=
literal|1
expr_stmt|;
name|lprintf
argument_list|(
literal|"\nSpell \"%s\":  %s\n%s"
argument_list|,
name|spelcode
index|[
name|i
index|]
argument_list|,
name|spelname
index|[
name|i
index|]
argument_list|,
name|speldescript
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|rnd
argument_list|(
literal|10
argument_list|)
operator|==
literal|4
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nYour int went up by one!"
argument_list|)
expr_stmt|;
name|c
index|[
name|INTELLIGENCE
index|]
operator|++
expr_stmt|;
name|bottomline
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|ocookie
argument_list|()
end_macro

begin_block
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|lprcat
argument_list|(
literal|"\nDo you (e) eat it, (t) take it"
argument_list|)
expr_stmt|;
name|iopts
argument_list|()
expr_stmt|;
while|while
condition|(
literal|1
condition|)
switch|switch
condition|(
name|getchar
argument_list|()
condition|)
block|{
case|case
literal|'\33'
case|:
case|case
literal|'i'
case|:
name|ignore
argument_list|()
expr_stmt|;
return|return;
case|case
literal|'e'
case|:
name|lprcat
argument_list|(
literal|"eat\nThe cookie tasted good."
argument_list|)
expr_stmt|;
name|forget
argument_list|()
expr_stmt|;
comment|/* no more cookie	*/
if|if
condition|(
name|c
index|[
name|BLINDCOUNT
index|]
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|p
operator|=
name|fortune
argument_list|(
name|fortfile
argument_list|)
operator|)
condition|)
return|return;
name|lprcat
argument_list|(
literal|"  A message inside the cookie reads:\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
name|p
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'t'
case|:
name|lprcat
argument_list|(
literal|"take"
argument_list|)
expr_stmt|;
if|if
condition|(
name|take
argument_list|(
name|OCOOKIE
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
condition|)
name|forget
argument_list|()
expr_stmt|;
comment|/* no more book	*/
return|return;
block|}
empty_stmt|;
block|}
end_block

begin_comment
comment|/* routine to pick up some gold -- if arg==OMAXGOLD then the pile is worth 100* the argument */
end_comment

begin_macro
name|ogold
argument_list|(
argument|arg
argument_list|)
end_macro

begin_decl_stmt
name|int
name|arg
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|i
decl_stmt|;
name|i
operator|=
name|iarg
index|[
name|playerx
index|]
index|[
name|playery
index|]
expr_stmt|;
if|if
condition|(
name|arg
operator|==
name|OMAXGOLD
condition|)
name|i
operator|*=
literal|100
expr_stmt|;
elseif|else
if|if
condition|(
name|arg
operator|==
name|OKGOLD
condition|)
name|i
operator|*=
literal|1000
expr_stmt|;
elseif|else
if|if
condition|(
name|arg
operator|==
name|ODGOLD
condition|)
name|i
operator|*=
literal|10
expr_stmt|;
name|lprintf
argument_list|(
literal|"\nIt is worth %d!"
argument_list|,
operator|(
name|long
operator|)
name|i
argument_list|)
expr_stmt|;
name|c
index|[
name|GOLD
index|]
operator|+=
name|i
expr_stmt|;
name|bottomgold
argument_list|()
expr_stmt|;
name|item
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
name|know
index|[
name|playerx
index|]
index|[
name|playery
index|]
operator|=
literal|0
expr_stmt|;
comment|/*	destroy gold	*/
block|}
end_block

begin_macro
name|ohome
argument_list|()
end_macro

begin_block
block|{
name|int
name|i
decl_stmt|;
name|nosignal
operator|=
literal|1
expr_stmt|;
comment|/* disable signals */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|26
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|iven
index|[
name|i
index|]
operator|==
name|OPOTION
condition|)
if|if
condition|(
name|ivenarg
index|[
name|i
index|]
operator|==
literal|21
condition|)
block|{
name|iven
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
comment|/* remove the potion of cure dianthroritis from inventory */
name|clear
argument_list|()
expr_stmt|;
name|lprcat
argument_list|(
literal|"Congratulations.  You found a potion of cure dianthroritis.\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nFrankly, No one thought you could do it.  Boy!  Did you surprise them!\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtime
operator|>
name|TIMELIMIT
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nThe doctor has the sad duty to inform you that your daughter died!\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"You didn't make it in time.  In your agony, you kill the doctor,\nyour wife, and yourself!  Too bad!\n"
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|5000
argument_list|)
expr_stmt|;
name|died
argument_list|(
literal|269
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|lprcat
argument_list|(
literal|"\nThe doctor is now administering the potion, and in a few moments\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"Your daughter should be well on her way to recovery.\n"
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|6000
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\nThe potion is"
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|" working!  The doctor thinks that\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"your daughter will recover in a few days.  Congratulations!\n"
argument_list|)
expr_stmt|;
name|beep
argument_list|()
expr_stmt|;
name|nap
argument_list|(
literal|5000
argument_list|)
expr_stmt|;
name|died
argument_list|(
literal|263
argument_list|)
expr_stmt|;
block|}
block|}
while|while
condition|(
literal|1
condition|)
block|{
name|clear
argument_list|()
expr_stmt|;
name|lprintf
argument_list|(
literal|"Welcome home %s.  Latest word from the doctor is not good.\n"
argument_list|,
name|logname
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtime
operator|>
name|TIMELIMIT
condition|)
block|{
name|lprcat
argument_list|(
literal|"\nThe doctor has the sad duty to inform you that your daughter died!\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"You didn't make it in time.  In your agony, you kill the doctor,\nyour wife, and yourself!  Too bad!\n"
argument_list|)
expr_stmt|;
name|nap
argument_list|(
literal|5000
argument_list|)
expr_stmt|;
name|died
argument_list|(
literal|269
argument_list|)
expr_stmt|;
block|}
name|lprcat
argument_list|(
literal|"\nThe diagnosis is confirmed as dianthroritis.  He guesses that\n"
argument_list|)
expr_stmt|;
name|lprintf
argument_list|(
literal|"your daughter has only %d mobuls left in this world.  It's up to you,\n"
argument_list|,
call|(
name|long
call|)
argument_list|(
operator|(
name|TIMELIMIT
operator|-
name|gtime
operator|+
literal|99
operator|)
operator|/
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|lprintf
argument_list|(
literal|"%s, to find the only hope for your daughter, the very rare\n"
argument_list|,
name|logname
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"potion of cure dianthroritis.  It is rumored that only deep in the\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"depths of the caves can this potion be found.\n\n\n"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|"\n     ----- press "
argument_list|)
expr_stmt|;
name|standout
argument_list|(
literal|"return"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|" to continue, "
argument_list|)
expr_stmt|;
name|standout
argument_list|(
literal|"escape"
argument_list|)
expr_stmt|;
name|lprcat
argument_list|(
literal|" to leave ----- "
argument_list|)
expr_stmt|;
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
while|while
condition|(
name|i
operator|!=
literal|'\33'
operator|&&
name|i
operator|!=
literal|'\n'
condition|)
name|i
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|'\33'
condition|)
block|{
name|drawscreen
argument_list|()
expr_stmt|;
name|nosignal
operator|=
literal|0
expr_stmt|;
comment|/* enable signals */
return|return;
block|}
block|}
block|}
end_block

begin_comment
comment|/*	routine to save program space	*/
end_comment

begin_macro
name|iopts
argument_list|()
end_macro

begin_block
block|{
name|lprcat
argument_list|(
literal|", or (i) ignore it? "
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|ignore
argument_list|()
end_macro

begin_block
block|{
name|lprcat
argument_list|(
literal|"ignore\n"
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

