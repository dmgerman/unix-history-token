begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1980, 1993  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the University of  *	California, Berkeley and its contributors.  * 4. Neither the name of the University nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static char sccsid[] = "@(#)setup.c	8.1 (Berkeley) 5/31/93";
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|"trek.h"
end_include

begin_include
include|#
directive|include
file|"getpar.h"
end_include

begin_comment
comment|/* **  INITIALIZE THE GAME ** **	The length, skill, and password are read, and the game **	is initialized.  It is far too difficult to describe all **	that goes on in here, but it is all straight-line code; **	give it a look. ** **	Game restart and tournament games are handled here. */
end_comment

begin_decl_stmt
name|struct
name|cvntab
name|Lentab
index|[]
init|=
block|{
literal|"s"
block|,
literal|"hort"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|1
block|,
literal|0
block|,
literal|"m"
block|,
literal|"edium"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|2
block|,
literal|0
block|,
literal|"l"
block|,
literal|"ong"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|4
block|,
literal|0
block|,
literal|"restart"
block|,
literal|""
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|cvntab
name|Skitab
index|[]
init|=
block|{
literal|"n"
block|,
literal|"ovice"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|1
block|,
literal|0
block|,
literal|"f"
block|,
literal|"air"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|2
block|,
literal|0
block|,
literal|"g"
block|,
literal|"ood"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|3
block|,
literal|0
block|,
literal|"e"
block|,
literal|"xpert"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|4
block|,
literal|0
block|,
literal|"c"
block|,
literal|"ommodore"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|5
block|,
literal|0
block|,
literal|"i"
block|,
literal|"mpossible"
block|,
operator|(
name|int
argument_list|(
operator|*
argument_list|)
argument_list|()
operator|)
literal|6
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_macro
name|setup
argument_list|()
end_macro

begin_block
block|{
name|struct
name|cvntab
modifier|*
name|r
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
name|f
decl_stmt|;
name|int
name|d
decl_stmt|;
name|int
name|fd
decl_stmt|;
name|int
name|klump
decl_stmt|;
name|int
name|ix
decl_stmt|,
name|iy
decl_stmt|;
name|struct
name|quad
modifier|*
name|q
decl_stmt|;
name|struct
name|event
modifier|*
name|e
decl_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|r
operator|=
name|getcodpar
argument_list|(
literal|"What length game"
argument_list|,
name|Lentab
argument_list|)
expr_stmt|;
name|Game
operator|.
name|length
operator|=
operator|(
name|long
operator|)
name|r
operator|->
name|value
expr_stmt|;
if|if
condition|(
name|Game
operator|.
name|length
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|restartgame
argument_list|()
condition|)
continue|continue;
return|return;
block|}
break|break;
block|}
name|r
operator|=
name|getcodpar
argument_list|(
literal|"What skill game"
argument_list|,
name|Skitab
argument_list|)
expr_stmt|;
name|Game
operator|.
name|skill
operator|=
operator|(
name|long
operator|)
name|r
operator|->
name|value
expr_stmt|;
name|Game
operator|.
name|tourn
operator|=
literal|0
expr_stmt|;
name|getstrpar
argument_list|(
literal|"Enter a password"
argument_list|,
name|Game
operator|.
name|passwd
argument_list|,
literal|14
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sequal
argument_list|(
name|Game
operator|.
name|passwd
argument_list|,
literal|"tournament"
argument_list|)
condition|)
block|{
name|getstrpar
argument_list|(
literal|"Enter tournament code"
argument_list|,
name|Game
operator|.
name|passwd
argument_list|,
literal|14
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Game
operator|.
name|tourn
operator|=
literal|1
expr_stmt|;
name|d
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|Game
operator|.
name|passwd
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
name|d
operator|+=
name|Game
operator|.
name|passwd
index|[
name|i
index|]
operator|<<
name|i
expr_stmt|;
name|srandom
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|Param
operator|.
name|bases
operator|=
name|Now
operator|.
name|bases
operator|=
name|ranf
argument_list|(
literal|6
operator|-
name|Game
operator|.
name|skill
argument_list|)
operator|+
literal|2
expr_stmt|;
if|if
condition|(
name|Game
operator|.
name|skill
operator|==
literal|6
condition|)
name|Param
operator|.
name|bases
operator|=
name|Now
operator|.
name|bases
operator|=
literal|1
expr_stmt|;
name|Param
operator|.
name|time
operator|=
name|Now
operator|.
name|time
operator|=
literal|6.0
operator|*
name|Game
operator|.
name|length
operator|+
literal|2.0
expr_stmt|;
name|i
operator|=
name|Game
operator|.
name|skill
expr_stmt|;
name|j
operator|=
name|Game
operator|.
name|length
expr_stmt|;
name|Param
operator|.
name|klings
operator|=
name|Now
operator|.
name|klings
operator|=
name|i
operator|*
name|j
operator|*
literal|3.5
operator|*
operator|(
name|franf
argument_list|()
operator|+
literal|0.75
operator|)
expr_stmt|;
if|if
condition|(
name|Param
operator|.
name|klings
operator|<
name|i
operator|*
name|j
operator|*
literal|5
condition|)
name|Param
operator|.
name|klings
operator|=
name|Now
operator|.
name|klings
operator|=
name|i
operator|*
name|j
operator|*
literal|5
expr_stmt|;
if|if
condition|(
name|Param
operator|.
name|klings
operator|<=
name|i
condition|)
comment|/* numerical overflow problems */
name|Param
operator|.
name|klings
operator|=
name|Now
operator|.
name|klings
operator|=
literal|127
expr_stmt|;
name|Param
operator|.
name|energy
operator|=
name|Ship
operator|.
name|energy
operator|=
literal|5000
expr_stmt|;
name|Param
operator|.
name|torped
operator|=
name|Ship
operator|.
name|torped
operator|=
literal|10
expr_stmt|;
name|Ship
operator|.
name|ship
operator|=
name|ENTERPRISE
expr_stmt|;
name|Ship
operator|.
name|shipname
operator|=
literal|"Enterprise"
expr_stmt|;
name|Param
operator|.
name|shield
operator|=
name|Ship
operator|.
name|shield
operator|=
literal|1500
expr_stmt|;
name|Param
operator|.
name|resource
operator|=
name|Now
operator|.
name|resource
operator|=
name|Param
operator|.
name|klings
operator|*
name|Param
operator|.
name|time
expr_stmt|;
name|Param
operator|.
name|reserves
operator|=
name|Ship
operator|.
name|reserves
operator|=
operator|(
literal|6
operator|-
name|Game
operator|.
name|skill
operator|)
operator|*
literal|2.0
expr_stmt|;
name|Param
operator|.
name|crew
operator|=
name|Ship
operator|.
name|crew
operator|=
literal|387
expr_stmt|;
name|Param
operator|.
name|brigfree
operator|=
name|Ship
operator|.
name|brigfree
operator|=
literal|400
expr_stmt|;
name|Ship
operator|.
name|shldup
operator|=
literal|1
expr_stmt|;
name|Ship
operator|.
name|cond
operator|=
name|GREEN
expr_stmt|;
name|Ship
operator|.
name|warp
operator|=
literal|5.0
expr_stmt|;
name|Ship
operator|.
name|warp2
operator|=
literal|25.0
expr_stmt|;
name|Ship
operator|.
name|warp3
operator|=
literal|125.0
expr_stmt|;
name|Ship
operator|.
name|sinsbad
operator|=
literal|0
expr_stmt|;
name|Ship
operator|.
name|cloaked
operator|=
literal|0
expr_stmt|;
name|Param
operator|.
name|date
operator|=
name|Now
operator|.
name|date
operator|=
operator|(
name|ranf
argument_list|(
literal|20
argument_list|)
operator|+
literal|20
operator|)
operator|*
literal|100
expr_stmt|;
name|f
operator|=
name|Game
operator|.
name|skill
expr_stmt|;
name|f
operator|=
name|log
argument_list|(
name|f
operator|+
literal|0.5
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NDEV
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|Device
index|[
name|i
index|]
operator|.
name|name
index|[
literal|0
index|]
operator|==
literal|'*'
condition|)
name|Param
operator|.
name|damfac
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
else|else
name|Param
operator|.
name|damfac
index|[
name|i
index|]
operator|=
name|f
expr_stmt|;
comment|/* these probabilities must sum to 1000 */
name|Param
operator|.
name|damprob
index|[
name|WARP
index|]
operator|=
literal|70
expr_stmt|;
comment|/* warp drive		 7.0% */
name|Param
operator|.
name|damprob
index|[
name|SRSCAN
index|]
operator|=
literal|110
expr_stmt|;
comment|/* short range scanners	11.0% */
name|Param
operator|.
name|damprob
index|[
name|LRSCAN
index|]
operator|=
literal|110
expr_stmt|;
comment|/* long range scanners	11.0% */
name|Param
operator|.
name|damprob
index|[
name|PHASER
index|]
operator|=
literal|125
expr_stmt|;
comment|/* phasers		12.5% */
name|Param
operator|.
name|damprob
index|[
name|TORPED
index|]
operator|=
literal|125
expr_stmt|;
comment|/* photon torpedoes	12.5% */
name|Param
operator|.
name|damprob
index|[
name|IMPULSE
index|]
operator|=
literal|75
expr_stmt|;
comment|/* impulse engines	 7.5% */
name|Param
operator|.
name|damprob
index|[
name|SHIELD
index|]
operator|=
literal|150
expr_stmt|;
comment|/* shield control	15.0% */
name|Param
operator|.
name|damprob
index|[
name|COMPUTER
index|]
operator|=
literal|20
expr_stmt|;
comment|/* computer		 2.0% */
name|Param
operator|.
name|damprob
index|[
name|SSRADIO
index|]
operator|=
literal|35
expr_stmt|;
comment|/* subspace radio	 3.5% */
name|Param
operator|.
name|damprob
index|[
name|LIFESUP
index|]
operator|=
literal|30
expr_stmt|;
comment|/* life support		 3.0% */
name|Param
operator|.
name|damprob
index|[
name|SINS
index|]
operator|=
literal|20
expr_stmt|;
comment|/* navigation system	 2.0% */
name|Param
operator|.
name|damprob
index|[
name|CLOAK
index|]
operator|=
literal|50
expr_stmt|;
comment|/* cloaking device	 5.0% */
name|Param
operator|.
name|damprob
index|[
name|XPORTER
index|]
operator|=
literal|80
expr_stmt|;
comment|/* transporter		 8.0% */
comment|/* check to see that I didn't blow it */
for|for
control|(
name|i
operator|=
name|j
operator|=
literal|0
init|;
name|i
operator|<
name|NDEV
condition|;
name|i
operator|++
control|)
name|j
operator|+=
name|Param
operator|.
name|damprob
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|j
operator|!=
literal|1000
condition|)
name|syserr
argument_list|(
literal|"Device probabilities sum to %d"
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|Param
operator|.
name|dockfac
operator|=
literal|0.5
expr_stmt|;
name|Param
operator|.
name|regenfac
operator|=
operator|(
literal|5
operator|-
name|Game
operator|.
name|skill
operator|)
operator|*
literal|0.05
expr_stmt|;
if|if
condition|(
name|Param
operator|.
name|regenfac
operator|<
literal|0.0
condition|)
name|Param
operator|.
name|regenfac
operator|=
literal|0.0
expr_stmt|;
name|Param
operator|.
name|warptime
operator|=
literal|10
expr_stmt|;
name|Param
operator|.
name|stopengy
operator|=
literal|50
expr_stmt|;
name|Param
operator|.
name|shupengy
operator|=
literal|40
expr_stmt|;
name|i
operator|=
name|Game
operator|.
name|skill
expr_stmt|;
name|Param
operator|.
name|klingpwr
operator|=
literal|100
operator|+
literal|150
operator|*
name|i
expr_stmt|;
if|if
condition|(
name|i
operator|>=
literal|6
condition|)
name|Param
operator|.
name|klingpwr
operator|+=
literal|150
expr_stmt|;
name|Param
operator|.
name|phasfac
operator|=
literal|0.8
expr_stmt|;
name|Param
operator|.
name|hitfac
operator|=
literal|0.5
expr_stmt|;
name|Param
operator|.
name|klingcrew
operator|=
literal|200
expr_stmt|;
name|Param
operator|.
name|srndrprob
operator|=
literal|0.0035
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_OB
index|]
operator|=
literal|45
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_OB
index|]
operator|=
literal|.09
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_OA
index|]
operator|=
literal|40
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_OA
index|]
operator|=
operator|-
literal|0.05
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_EB
index|]
operator|=
literal|40
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_EB
index|]
operator|=
literal|0.075
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_EA
index|]
operator|=
literal|25
operator|+
literal|5
operator|*
name|Game
operator|.
name|skill
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_EA
index|]
operator|=
operator|-
literal|0.06
operator|*
name|Game
operator|.
name|skill
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_LB
index|]
operator|=
literal|0
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_LB
index|]
operator|=
literal|0.0
expr_stmt|;
name|Param
operator|.
name|moveprob
index|[
name|KM_LA
index|]
operator|=
literal|10
operator|+
literal|10
operator|*
name|Game
operator|.
name|skill
expr_stmt|;
name|Param
operator|.
name|movefac
index|[
name|KM_LA
index|]
operator|=
literal|0.25
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_SNOVA
index|]
operator|=
literal|0.5
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_LRTB
index|]
operator|=
literal|25.0
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_KATSB
index|]
operator|=
literal|1.0
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_KDESB
index|]
operator|=
literal|3.0
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_ISSUE
index|]
operator|=
literal|1.0
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_SNAP
index|]
operator|=
literal|0.5
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_ENSLV
index|]
operator|=
literal|0.5
expr_stmt|;
name|Param
operator|.
name|eventdly
index|[
name|E_REPRO
index|]
operator|=
literal|2.0
expr_stmt|;
name|Param
operator|.
name|navigcrud
index|[
literal|0
index|]
operator|=
literal|1.50
expr_stmt|;
name|Param
operator|.
name|navigcrud
index|[
literal|1
index|]
operator|=
literal|0.75
expr_stmt|;
name|Param
operator|.
name|cloakenergy
operator|=
literal|1000
expr_stmt|;
name|Param
operator|.
name|energylow
operator|=
literal|1000
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAXEVENTS
condition|;
name|i
operator|++
control|)
block|{
name|e
operator|=
operator|&
name|Event
index|[
name|i
index|]
expr_stmt|;
name|e
operator|->
name|date
operator|=
literal|1e50
expr_stmt|;
name|e
operator|->
name|evcode
operator|=
literal|0
expr_stmt|;
block|}
name|xsched
argument_list|(
name|E_SNOVA
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xsched
argument_list|(
name|E_LRTB
argument_list|,
name|Param
operator|.
name|klings
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xsched
argument_list|(
name|E_KATSB
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xsched
argument_list|(
name|E_ISSUE
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|xsched
argument_list|(
name|E_SNAP
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Ship
operator|.
name|sectx
operator|=
name|ranf
argument_list|(
name|NSECTS
argument_list|)
expr_stmt|;
name|Ship
operator|.
name|secty
operator|=
name|ranf
argument_list|(
name|NSECTS
argument_list|)
expr_stmt|;
name|Game
operator|.
name|killk
operator|=
name|Game
operator|.
name|kills
operator|=
name|Game
operator|.
name|killb
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|deaths
operator|=
name|Game
operator|.
name|negenbar
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|captives
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|killinhab
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|helps
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|killed
operator|=
literal|0
expr_stmt|;
name|Game
operator|.
name|snap
operator|=
literal|0
expr_stmt|;
name|Move
operator|.
name|endgame
operator|=
literal|0
expr_stmt|;
comment|/* setup stars */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NQUADS
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|NQUADS
condition|;
name|j
operator|++
control|)
block|{
name|q
operator|=
operator|&
name|Quad
index|[
name|i
index|]
index|[
name|j
index|]
expr_stmt|;
name|q
operator|->
name|klings
operator|=
name|q
operator|->
name|bases
operator|=
literal|0
expr_stmt|;
name|q
operator|->
name|scanned
operator|=
operator|-
literal|1
expr_stmt|;
name|q
operator|->
name|stars
operator|=
name|ranf
argument_list|(
literal|9
argument_list|)
operator|+
literal|1
expr_stmt|;
name|q
operator|->
name|holes
operator|=
name|ranf
argument_list|(
literal|3
argument_list|)
operator|-
name|q
operator|->
name|stars
operator|/
literal|5
expr_stmt|;
name|q
operator|->
name|qsystemname
operator|=
literal|0
expr_stmt|;
block|}
comment|/* select inhabited starsystems */
for|for
control|(
name|d
operator|=
literal|1
init|;
name|d
operator|<
name|NINHAB
condition|;
name|d
operator|++
control|)
block|{
do|do
block|{
name|i
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|j
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|q
operator|=
operator|&
name|Quad
index|[
name|i
index|]
index|[
name|j
index|]
expr_stmt|;
block|}
do|while
condition|(
name|q
operator|->
name|qsystemname
condition|)
do|;
name|q
operator|->
name|qsystemname
operator|=
name|d
expr_stmt|;
block|}
comment|/* position starbases */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|Param
operator|.
name|bases
condition|;
name|i
operator|++
control|)
block|{
while|while
condition|(
literal|1
condition|)
block|{
name|ix
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|iy
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|q
operator|=
operator|&
name|Quad
index|[
name|ix
index|]
index|[
name|iy
index|]
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|bases
operator|>
literal|0
condition|)
continue|continue;
break|break;
block|}
name|q
operator|->
name|bases
operator|=
literal|1
expr_stmt|;
name|Now
operator|.
name|base
index|[
name|i
index|]
operator|.
name|x
operator|=
name|ix
expr_stmt|;
name|Now
operator|.
name|base
index|[
name|i
index|]
operator|.
name|y
operator|=
name|iy
expr_stmt|;
name|q
operator|->
name|scanned
operator|=
literal|1001
expr_stmt|;
comment|/* start the Enterprise near starbase */
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|Ship
operator|.
name|quadx
operator|=
name|ix
expr_stmt|;
name|Ship
operator|.
name|quady
operator|=
name|iy
expr_stmt|;
block|}
block|}
comment|/* position klingons */
for|for
control|(
name|i
operator|=
name|Param
operator|.
name|klings
init|;
name|i
operator|>
literal|0
condition|;
control|)
block|{
name|klump
operator|=
name|ranf
argument_list|(
literal|4
argument_list|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|klump
operator|>
name|i
condition|)
name|klump
operator|=
name|i
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
name|ix
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|iy
operator|=
name|ranf
argument_list|(
name|NQUADS
argument_list|)
expr_stmt|;
name|q
operator|=
operator|&
name|Quad
index|[
name|ix
index|]
index|[
name|iy
index|]
expr_stmt|;
if|if
condition|(
name|q
operator|->
name|klings
operator|+
name|klump
operator|>
name|MAXKLQUAD
condition|)
continue|continue;
name|q
operator|->
name|klings
operator|+=
name|klump
expr_stmt|;
name|i
operator|-=
name|klump
expr_stmt|;
break|break;
block|}
block|}
comment|/* initialize this quadrant */
name|printf
argument_list|(
literal|"%d Klingons\n%d starbase"
argument_list|,
name|Param
operator|.
name|klings
argument_list|,
name|Param
operator|.
name|bases
argument_list|)
expr_stmt|;
if|if
condition|(
name|Param
operator|.
name|bases
operator|>
literal|1
condition|)
name|printf
argument_list|(
literal|"s"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|" at %d,%d"
argument_list|,
name|Now
operator|.
name|base
index|[
literal|0
index|]
operator|.
name|x
argument_list|,
name|Now
operator|.
name|base
index|[
literal|0
index|]
operator|.
name|y
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|Param
operator|.
name|bases
condition|;
name|i
operator|++
control|)
name|printf
argument_list|(
literal|", %d,%d"
argument_list|,
name|Now
operator|.
name|base
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|Now
operator|.
name|base
index|[
name|i
index|]
operator|.
name|y
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"\nIt takes %d units to kill a Klingon\n"
argument_list|,
name|Param
operator|.
name|klingpwr
argument_list|)
expr_stmt|;
name|Move
operator|.
name|free
operator|=
literal|0
expr_stmt|;
name|initquad
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|srscan
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|attack
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_block

end_unit

