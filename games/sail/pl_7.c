begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 1983, 1993  *	The Regents of the University of California.  All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions and the following disclaimer.  * 2. Redistributions in binary form must reproduce the above copyright  *    notice, this list of conditions and the following disclaimer in the  *    documentation and/or other materials provided with the distribution.  * 3. All advertising materials mentioning features or use of this software  *    must display the following acknowledgement:  *	This product includes software developed by the University of  *	California, Berkeley and its contributors.  * 4. Neither the name of the University nor the names of its contributors  *    may be used to endorse or promote products derived from this software  *    without specific prior written permission.  *  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF  * SUCH DAMAGE.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|lint
end_ifndef

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static char sccsid[] = "@(#)pl_7.c	8.1 (Berkeley) 5/31/93";
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|static
specifier|const
name|char
name|rcsid
index|[]
init|=
literal|"$FreeBSD$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* not lint */
end_comment

begin_include
include|#
directive|include
file|<sys/ttydefaults.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"player.h"
end_include

begin_comment
comment|/*  * Display interface  */
end_comment

begin_decl_stmt
specifier|static
name|char
name|sc_hasprompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sc_prompt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|char
modifier|*
name|sc_buf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|sc_line
decl_stmt|;
end_decl_stmt

begin_macro
name|initscreen
argument_list|()
end_macro

begin_block
block|{
comment|/* initscr() already done in SCREENTEST() */
name|view_w
operator|=
name|newwin
argument_list|(
name|VIEW_Y
argument_list|,
name|VIEW_X
argument_list|,
name|VIEW_T
argument_list|,
name|VIEW_L
argument_list|)
expr_stmt|;
name|slot_w
operator|=
name|newwin
argument_list|(
name|SLOT_Y
argument_list|,
name|SLOT_X
argument_list|,
name|SLOT_T
argument_list|,
name|SLOT_L
argument_list|)
expr_stmt|;
name|scroll_w
operator|=
name|newwin
argument_list|(
name|SCROLL_Y
argument_list|,
name|SCROLL_X
argument_list|,
name|SCROLL_T
argument_list|,
name|SCROLL_L
argument_list|)
expr_stmt|;
name|stat_w
operator|=
name|newwin
argument_list|(
name|STAT_Y
argument_list|,
name|STAT_X
argument_list|,
name|STAT_T
argument_list|,
name|STAT_L
argument_list|)
expr_stmt|;
name|turn_w
operator|=
name|newwin
argument_list|(
name|TURN_Y
argument_list|,
name|TURN_X
argument_list|,
name|TURN_T
argument_list|,
name|TURN_L
argument_list|)
expr_stmt|;
name|done_curses
operator|++
expr_stmt|;
operator|(
name|void
operator|)
name|leaveok
argument_list|(
name|view_w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|leaveok
argument_list|(
name|slot_w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|leaveok
argument_list|(
name|stat_w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|leaveok
argument_list|(
name|turn_w
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|noecho
argument_list|()
expr_stmt|;
name|crmode
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|cleanupscreen
argument_list|()
end_macro

begin_block
block|{
comment|/* alarm already turned off */
if|if
condition|(
name|done_curses
condition|)
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|SCROLL_Y
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
name|draw_screen
argument_list|()
expr_stmt|;
name|endwin
argument_list|()
expr_stmt|;
block|}
block|}
end_block

begin_function
name|void
name|newturn
parameter_list|()
block|{
name|repaired
operator|=
name|loaded
operator|=
name|fired
operator|=
name|changed
operator|=
literal|0
expr_stmt|;
name|movebuf
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
operator|(
name|void
operator|)
name|alarm
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|readyL
operator|&
name|R_LOADING
condition|)
block|{
if|if
condition|(
name|mf
operator|->
name|readyL
operator|&
name|R_DOUBLE
condition|)
name|mf
operator|->
name|readyL
operator|=
name|R_LOADING
expr_stmt|;
else|else
name|mf
operator|->
name|readyL
operator|=
name|R_LOADED
expr_stmt|;
block|}
if|if
condition|(
name|mf
operator|->
name|readyR
operator|&
name|R_LOADING
condition|)
block|{
if|if
condition|(
name|mf
operator|->
name|readyR
operator|&
name|R_DOUBLE
condition|)
name|mf
operator|->
name|readyR
operator|=
name|R_LOADING
expr_stmt|;
else|else
name|mf
operator|->
name|readyR
operator|=
name|R_LOADED
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|hasdriver
condition|)
name|Write
argument_list|(
name|W_DDEAD
argument_list|,
name|SHIP
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc_hasprompt
condition|)
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|sc_line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Sync
argument_list|()
operator|<
literal|0
condition|)
name|leave
argument_list|(
name|LEAVE_SYNC
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|hasdriver
condition|)
name|leave
argument_list|(
name|LEAVE_DRIVER
argument_list|)
expr_stmt|;
if|if
condition|(
name|sc_hasprompt
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|scroll_w
argument_list|,
literal|"%s%s"
argument_list|,
name|sc_prompt
argument_list|,
name|sc_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|turn
operator|%
literal|50
operator|==
literal|0
condition|)
name|Write
argument_list|(
name|W_ALIVE
argument_list|,
name|SHIP
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|FS
operator|&&
operator|(
operator|!
name|mc
operator|->
name|rig1
operator|||
name|windspeed
operator|==
literal|6
operator|)
condition|)
name|Write
argument_list|(
name|W_FS
argument_list|,
name|ms
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|FS
operator|==
literal|1
condition|)
name|Write
argument_list|(
name|W_FS
argument_list|,
name|ms
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|struck
condition|)
name|leave
argument_list|(
name|LEAVE_QUIT
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|captured
operator|!=
literal|0
condition|)
name|leave
argument_list|(
name|LEAVE_CAPTURED
argument_list|)
expr_stmt|;
if|if
condition|(
name|windspeed
operator|==
literal|7
condition|)
name|leave
argument_list|(
name|LEAVE_HURRICAN
argument_list|)
expr_stmt|;
name|adjustview
argument_list|()
expr_stmt|;
name|draw_screen
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGALRM
argument_list|,
name|newturn
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|alarm
argument_list|(
literal|7
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*VARARGS2*/
end_comment

begin_macro
name|Signal
argument_list|(
argument|fmt
argument_list|,
argument|ship
argument_list|,
argument|a
argument_list|,
argument|b
argument_list|,
argument|c
argument_list|,
argument|d
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|fmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ship
modifier|*
name|ship
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
operator|!
name|done_curses
condition|)
return|return;
if|if
condition|(
operator|*
name|fmt
operator|==
literal|'\7'
condition|)
name|putchar
argument_list|(
operator|*
name|fmt
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|ship
operator|==
literal|0
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|scroll_w
argument_list|,
name|fmt
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|scroll_w
argument_list|,
name|fmt
argument_list|,
name|ship
operator|->
name|shipname
argument_list|,
name|colours
argument_list|(
name|ship
argument_list|)
argument_list|,
name|sterncolour
argument_list|(
name|ship
argument_list|)
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|Scroll
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|Scroll
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|++
name|sc_line
operator|>=
name|SCROLL_Y
condition|)
name|sc_line
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|scroll_w
argument_list|,
name|sc_line
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wclrtoeol
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|prompt
argument_list|(
argument|p
argument_list|,
argument|ship
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ship
modifier|*
name|ship
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|static
name|char
name|buf
index|[
literal|60
index|]
decl_stmt|;
if|if
condition|(
name|ship
operator|!=
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|buf
argument_list|,
name|p
argument_list|,
name|ship
operator|->
name|shipname
argument_list|,
name|colours
argument_list|(
name|ship
argument_list|)
argument_list|,
name|sterncolour
argument_list|(
name|ship
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|=
name|buf
expr_stmt|;
block|}
name|sc_prompt
operator|=
name|p
expr_stmt|;
name|sc_buf
operator|=
literal|""
expr_stmt|;
name|sc_hasprompt
operator|=
literal|1
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|scroll_w
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|endprompt
argument_list|(
argument|flag
argument_list|)
end_macro

begin_decl_stmt
name|char
name|flag
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|sc_hasprompt
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|flag
condition|)
name|Scroll
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|sgetch
argument_list|(
argument|p
argument_list|,
argument|ship
argument_list|,
argument|flag
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|p
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|ship
modifier|*
name|ship
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|flag
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|c
decl_stmt|;
name|prompt
argument_list|(
name|p
argument_list|,
name|ship
argument_list|)
expr_stmt|;
name|blockalarm
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
name|unblockalarm
argument_list|()
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|wgetch
argument_list|(
name|scroll_w
argument_list|)
operator|)
operator|==
name|EOF
condition|)
empty_stmt|;
if|if
condition|(
name|flag
operator|&&
name|c
operator|>=
literal|' '
operator|&&
name|c
operator|<
literal|0x7f
condition|)
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|scroll_w
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|endprompt
argument_list|(
name|flag
argument_list|)
expr_stmt|;
return|return
name|c
return|;
block|}
end_block

begin_macro
name|sgetstr
argument_list|(
argument|pr
argument_list|,
argument|buf
argument_list|,
argument|n
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|pr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|buf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|n
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|c
decl_stmt|;
name|char
modifier|*
name|p
init|=
name|buf
decl_stmt|;
name|prompt
argument_list|(
name|pr
argument_list|,
operator|(
expr|struct
name|ship
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|sc_buf
operator|=
name|buf
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
operator|*
name|p
operator|=
literal|0
expr_stmt|;
name|blockalarm
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
name|unblockalarm
argument_list|()
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|wgetch
argument_list|(
name|scroll_w
argument_list|)
operator|)
operator|==
name|EOF
condition|)
empty_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\n'
case|:
case|case
literal|'\r'
case|:
name|endprompt
argument_list|(
literal|1
argument_list|)
expr_stmt|;
return|return;
case|case
literal|'\b'
case|:
if|if
condition|(
name|p
operator|>
name|buf
condition|)
block|{
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|scroll_w
argument_list|,
literal|"\b \b"
argument_list|)
expr_stmt|;
name|p
operator|--
expr_stmt|;
block|}
break|break;
default|default:
if|if
condition|(
name|c
operator|>=
literal|' '
operator|&&
name|c
operator|<
literal|0x7f
operator|&&
name|p
operator|<
name|buf
operator|+
name|n
operator|-
literal|1
condition|)
block|{
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|scroll_w
argument_list|,
name|c
argument_list|)
expr_stmt|;
block|}
else|else
operator|(
name|void
operator|)
name|putchar
argument_list|(
name|CTRL
argument_list|(
literal|'g'
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|draw_screen
argument_list|()
end_macro

begin_block
block|{
name|draw_view
argument_list|()
expr_stmt|;
name|draw_turn
argument_list|()
expr_stmt|;
name|draw_stat
argument_list|()
expr_stmt|;
name|draw_slot
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
comment|/* move the cursor */
block|}
end_block

begin_macro
name|draw_view
argument_list|()
end_macro

begin_block
block|{
name|struct
name|ship
modifier|*
name|sp
decl_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
name|foreachship
argument_list|(
argument|sp
argument_list|)
block|{
if|if
condition|(
name|sp
operator|->
name|file
operator|->
name|dir
operator|&&
name|sp
operator|->
name|file
operator|->
name|row
operator|>
name|viewrow
operator|&&
name|sp
operator|->
name|file
operator|->
name|row
operator|<
name|viewrow
operator|+
name|VIEW_Y
operator|&&
name|sp
operator|->
name|file
operator|->
name|col
operator|>
name|viewcol
operator|&&
name|sp
operator|->
name|file
operator|->
name|col
operator|<
name|viewcol
operator|+
name|VIEW_X
condition|)
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
name|sp
operator|->
name|file
operator|->
name|row
operator|-
name|viewrow
argument_list|,
name|sp
operator|->
name|file
operator|->
name|col
operator|-
name|viewcol
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|view_w
argument_list|,
name|colours
argument_list|(
name|sp
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
name|sternrow
argument_list|(
name|sp
argument_list|)
operator|-
name|viewrow
argument_list|,
name|sterncol
argument_list|(
name|sp
argument_list|)
operator|-
name|viewcol
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|view_w
argument_list|,
name|sterncolour
argument_list|(
name|sp
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_turn
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|turn_w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|turn_w
argument_list|,
literal|"%cTurn %d"
argument_list|,
name|dont_adjust
condition|?
literal|'*'
else|:
literal|'-'
argument_list|,
name|turn
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|turn_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_stat
argument_list|()
end_macro

begin_block
block|{
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Points  %3d\n"
argument_list|,
name|mf
operator|->
name|points
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Fouls    %2d\n"
argument_list|,
name|fouled
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Grapples %2d\n"
argument_list|,
name|grappled
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"    0 %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|3
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|3
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|stat_w
argument_list|,
literal|"   \\|/\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"   -^-%c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|2
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|2
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|stat_w
argument_list|,
literal|"   /|\\\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"    | %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"   %c(%c)\n"
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|,
name|maxmove
argument_list|(
name|ms
argument_list|,
name|winddir
argument_list|,
literal|1
argument_list|)
operator|+
literal|'0'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|stat_w
argument_list|,
name|STAT_3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Load  %c%c %c%c\n"
argument_list|,
name|loadname
index|[
name|mf
operator|->
name|loadL
index|]
argument_list|,
name|readyname
argument_list|(
name|mf
operator|->
name|readyL
argument_list|)
argument_list|,
name|loadname
index|[
name|mf
operator|->
name|loadR
index|]
argument_list|,
name|readyname
argument_list|(
name|mf
operator|->
name|readyR
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Hull %2d\n"
argument_list|,
name|mc
operator|->
name|hull
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Crew %2d %2d %2d\n"
argument_list|,
name|mc
operator|->
name|crew1
argument_list|,
name|mc
operator|->
name|crew2
argument_list|,
name|mc
operator|->
name|crew3
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Guns %2d %2d\n"
argument_list|,
name|mc
operator|->
name|gunL
argument_list|,
name|mc
operator|->
name|gunR
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Carr %2d %2d\n"
argument_list|,
name|mc
operator|->
name|carL
argument_list|,
name|mc
operator|->
name|carR
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"Rigg %d %d %d "
argument_list|,
name|mc
operator|->
name|rig1
argument_list|,
name|mc
operator|->
name|rig2
argument_list|,
name|mc
operator|->
name|rig3
argument_list|)
expr_stmt|;
if|if
condition|(
name|mc
operator|->
name|rig4
operator|<
literal|0
condition|)
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|stat_w
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|stat_w
argument_list|,
literal|"%d"
argument_list|,
name|mc
operator|->
name|rig4
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|stat_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_slot
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|boarding
argument_list|(
name|ms
argument_list|,
literal|0
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
block|}
else|else
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|"OBP"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|boarding
argument_list|(
name|ms
argument_list|,
literal|1
argument_list|)
condition|)
block|{
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
block|}
else|else
operator|(
name|void
operator|)
name|mvwaddstr
argument_list|(
name|slot_w
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|"DBP"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RH
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRH"
argument_list|,
name|mf
operator|->
name|RH
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RG
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRG"
argument_list|,
name|mf
operator|->
name|RG
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|SLOT_Y
operator|-
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|RR
condition|)
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%dRR"
argument_list|,
name|mf
operator|->
name|RR
argument_list|)
expr_stmt|;
else|else
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|slot_w
argument_list|,
literal|"   "
argument_list|)
expr_stmt|;
define|#
directive|define
name|Y
value|(SLOT_Y/2)
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
literal|7
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wprintw
argument_list|(
name|slot_w
argument_list|,
literal|"%d"
argument_list|,
name|windspeed
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|1
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
literal|1
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
literal|1
argument_list|,
literal|2
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|-
name|dr
index|[
name|winddir
index|]
argument_list|,
literal|1
operator|-
name|dc
index|[
name|winddir
index|]
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|winddir
condition|)
block|{
case|case
literal|1
case|:
case|case
literal|5
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
case|case
literal|6
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
case|case
literal|7
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'-'
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
case|case
literal|8
case|:
operator|(
name|void
operator|)
name|waddch
argument_list|(
name|slot_w
argument_list|,
literal|'\\'
argument_list|)
expr_stmt|;
break|break;
block|}
operator|(
name|void
operator|)
name|mvwaddch
argument_list|(
name|slot_w
argument_list|,
name|Y
operator|+
name|dr
index|[
name|winddir
index|]
argument_list|,
literal|1
operator|+
name|dc
index|[
name|winddir
index|]
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|slot_w
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|draw_board
argument_list|()
end_macro

begin_block
block|{
name|int
name|n
decl_stmt|;
operator|(
name|void
operator|)
name|clear
argument_list|()
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|slot_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|scroll_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|stat_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|werase
argument_list|(
name|turn_w
argument_list|)
expr_stmt|;
name|sc_line
operator|=
literal|0
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|BOX_T
argument_list|,
name|BOX_L
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|BOX_X
condition|;
name|n
operator|++
control|)
operator|(
name|void
operator|)
name|addch
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|BOX_B
argument_list|,
name|BOX_L
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|BOX_X
condition|;
name|n
operator|++
control|)
operator|(
name|void
operator|)
name|addch
argument_list|(
literal|'-'
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
name|BOX_T
operator|+
literal|1
init|;
name|n
operator|<
name|BOX_B
condition|;
name|n
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|n
argument_list|,
name|BOX_L
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|n
argument_list|,
name|BOX_R
argument_list|,
literal|'|'
argument_list|)
expr_stmt|;
block|}
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_T
argument_list|,
name|BOX_L
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_T
argument_list|,
name|BOX_R
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_B
argument_list|,
name|BOX_L
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|mvaddch
argument_list|(
name|BOX_B
argument_list|,
name|BOX_R
argument_list|,
literal|'+'
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|refresh
argument_list|()
expr_stmt|;
define|#
directive|define
name|WSaIM
value|"Wooden Ships& Iron Men"
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
literal|2
argument_list|,
operator|(
name|VIEW_X
operator|-
sizeof|sizeof
name|WSaIM
operator|-
literal|1
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|view_w
argument_list|,
name|WSaIM
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wmove
argument_list|(
name|view_w
argument_list|,
literal|4
argument_list|,
operator|(
name|VIEW_X
operator|-
name|strlen
argument_list|(
name|cc
operator|->
name|name
argument_list|)
operator|)
operator|/
literal|2
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|waddstr
argument_list|(
name|view_w
argument_list|,
name|cc
operator|->
name|name
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|wrefresh
argument_list|(
name|view_w
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|move
argument_list|(
name|LINE_T
argument_list|,
name|LINE_L
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printw
argument_list|(
literal|"Class %d %s (%d guns) '%s' (%c%c)"
argument_list|,
name|mc
operator|->
name|class
argument_list|,
name|classname
index|[
name|mc
operator|->
name|class
index|]
argument_list|,
name|mc
operator|->
name|guns
argument_list|,
name|ms
operator|->
name|shipname
argument_list|,
name|colours
argument_list|(
name|ms
argument_list|)
argument_list|,
name|sterncolour
argument_list|(
name|ms
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|refresh
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|centerview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
name|VIEW_Y
operator|/
literal|2
expr_stmt|;
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
name|VIEW_X
operator|/
literal|2
expr_stmt|;
block|}
end_block

begin_macro
name|upview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|-=
name|VIEW_Y
operator|/
literal|3
expr_stmt|;
block|}
end_block

begin_macro
name|downview
argument_list|()
end_macro

begin_block
block|{
name|viewrow
operator|+=
name|VIEW_Y
operator|/
literal|3
expr_stmt|;
block|}
end_block

begin_macro
name|leftview
argument_list|()
end_macro

begin_block
block|{
name|viewcol
operator|-=
name|VIEW_X
operator|/
literal|5
expr_stmt|;
block|}
end_block

begin_macro
name|rightview
argument_list|()
end_macro

begin_block
block|{
name|viewcol
operator|+=
name|VIEW_X
operator|/
literal|5
expr_stmt|;
block|}
end_block

begin_macro
name|adjustview
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|dont_adjust
condition|)
return|return;
if|if
condition|(
name|mf
operator|->
name|row
operator|<
name|viewrow
operator|+
name|VIEW_Y
operator|/
literal|4
condition|)
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
operator|(
name|VIEW_Y
operator|-
name|VIEW_Y
operator|/
literal|4
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mf
operator|->
name|row
operator|>
name|viewrow
operator|+
operator|(
name|VIEW_Y
operator|-
name|VIEW_Y
operator|/
literal|4
operator|)
condition|)
name|viewrow
operator|=
name|mf
operator|->
name|row
operator|-
name|VIEW_Y
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|mf
operator|->
name|col
operator|<
name|viewcol
operator|+
name|VIEW_X
operator|/
literal|8
condition|)
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
operator|(
name|VIEW_X
operator|-
name|VIEW_X
operator|/
literal|8
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
name|mf
operator|->
name|col
operator|>
name|viewcol
operator|+
operator|(
name|VIEW_X
operator|-
name|VIEW_X
operator|/
literal|8
operator|)
condition|)
name|viewcol
operator|=
name|mf
operator|->
name|col
operator|-
name|VIEW_X
operator|/
literal|8
expr_stmt|;
block|}
end_block

end_unit

