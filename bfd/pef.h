begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* PEF support for BFD.    Copyright 1999, 2000, 2001, 2002    Free Software Foundation, Inc.     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_struct
struct|struct
name|bfd_pef_header
block|{
name|unsigned
name|long
name|tag1
decl_stmt|;
name|unsigned
name|long
name|tag2
decl_stmt|;
name|unsigned
name|long
name|architecture
decl_stmt|;
name|unsigned
name|long
name|format_version
decl_stmt|;
name|unsigned
name|long
name|timestamp
decl_stmt|;
name|unsigned
name|long
name|old_definition_version
decl_stmt|;
name|unsigned
name|long
name|old_implementation_version
decl_stmt|;
name|unsigned
name|long
name|current_version
decl_stmt|;
name|unsigned
name|short
name|section_count
decl_stmt|;
name|unsigned
name|short
name|instantiated_section_count
decl_stmt|;
name|unsigned
name|long
name|reserved
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_header
name|bfd_pef_header
typedef|;
end_typedef

begin_struct
struct|struct
name|bfd_pef_loader_header
block|{
name|long
name|main_section
decl_stmt|;
name|unsigned
name|long
name|main_offset
decl_stmt|;
name|long
name|init_section
decl_stmt|;
name|unsigned
name|long
name|init_offset
decl_stmt|;
name|long
name|term_section
decl_stmt|;
name|unsigned
name|long
name|term_offset
decl_stmt|;
name|unsigned
name|long
name|imported_library_count
decl_stmt|;
name|unsigned
name|long
name|total_imported_symbol_count
decl_stmt|;
name|unsigned
name|long
name|reloc_section_count
decl_stmt|;
name|unsigned
name|long
name|reloc_instr_offset
decl_stmt|;
name|unsigned
name|long
name|loader_strings_offset
decl_stmt|;
name|unsigned
name|long
name|export_hash_offset
decl_stmt|;
name|unsigned
name|long
name|export_hash_table_power
decl_stmt|;
name|unsigned
name|long
name|exported_symbol_count
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_loader_header
name|bfd_pef_loader_header
typedef|;
end_typedef

begin_struct
struct|struct
name|bfd_pef_imported_library
block|{
name|unsigned
name|long
name|name_offset
decl_stmt|;
name|unsigned
name|long
name|old_implementation_version
decl_stmt|;
name|unsigned
name|long
name|current_version
decl_stmt|;
name|unsigned
name|long
name|imported_symbol_count
decl_stmt|;
name|unsigned
name|long
name|first_imported_symbol
decl_stmt|;
name|unsigned
name|char
name|options
decl_stmt|;
name|unsigned
name|char
name|reserved_a
decl_stmt|;
name|unsigned
name|short
name|reserved_b
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_imported_library
name|bfd_pef_imported_library
typedef|;
end_typedef

begin_enum
enum|enum
name|bfd_pef_imported_library_options
block|{
name|BFD_PEF_WEAK_IMPORT_LIB
init|=
literal|0x40
block|,
name|BFD_PEF_INIT_LIB_BEFORE
init|=
literal|0x80
block|}
enum|;
end_enum

begin_struct
struct|struct
name|bfd_pef_imported_symbol
block|{
name|unsigned
name|char
name|class
decl_stmt|;
name|unsigned
name|long
name|name
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_imported_symbol
name|bfd_pef_imported_symbol
typedef|;
end_typedef

begin_enum
enum|enum
name|bfd_pef_imported_symbol_class
block|{
name|BFD_PEF_CODE_SYMBOL
init|=
literal|0x00
block|,
name|BFD_PEF_DATA_SYMBOL
init|=
literal|0x01
block|,
name|BFD_PEF_TVECTOR_SYMBOL
init|=
literal|0x02
block|,
name|BFD_PEF_TOC_SYMBOL
init|=
literal|0x03
block|,
name|BFD_PEF_GLUE_SYMBOL
init|=
literal|0x04
block|,
name|BFD_PEF_UNDEFINED_SYMBOL
init|=
literal|0x0F
block|,
name|BFD_PEF_WEAK_IMPORT_SYMBOL_MASK
init|=
literal|0x80
block|}
enum|;
end_enum

begin_define
define|#
directive|define
name|BFD_PEF_TAG1
value|0x4A6F7921
end_define

begin_comment
comment|/* 'Joy!' */
end_comment

begin_define
define|#
directive|define
name|BFD_PEF_TAG2
value|0x70656666
end_define

begin_comment
comment|/* 'peff' */
end_comment

begin_define
define|#
directive|define
name|BFD_PEF_VERSION
value|0x00000001
end_define

begin_struct
struct|struct
name|bfd_pef_section
block|{
name|long
name|name_offset
decl_stmt|;
name|unsigned
name|long
name|header_offset
decl_stmt|;
name|unsigned
name|long
name|default_address
decl_stmt|;
name|unsigned
name|long
name|total_length
decl_stmt|;
name|unsigned
name|long
name|unpacked_length
decl_stmt|;
name|unsigned
name|long
name|container_length
decl_stmt|;
name|unsigned
name|long
name|container_offset
decl_stmt|;
name|unsigned
name|char
name|section_kind
decl_stmt|;
name|unsigned
name|char
name|share_kind
decl_stmt|;
name|unsigned
name|char
name|alignment
decl_stmt|;
name|unsigned
name|char
name|reserved
decl_stmt|;
name|asection
modifier|*
name|bfd_section
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_section
name|bfd_pef_section
typedef|;
end_typedef

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_CODE
value|0
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_UNPACKED_DATA
value|1
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_PACKED_DATA
value|2
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_CONSTANT
value|3
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_LOADER
value|4
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_DEBUG
value|5
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_EXEC_DATA
value|6
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_EXCEPTION
value|7
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SECTION_TRACEBACK
value|8
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SHARE_PROCESS
value|1
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SHARE_GLOBAL
value|4
end_define

begin_define
define|#
directive|define
name|BFD_PEF_SHARE_PROTECTED
value|5
end_define

begin_struct
struct|struct
name|bfd_pef_data_struct
block|{
name|bfd_pef_header
name|header
decl_stmt|;
name|bfd_pef_section
modifier|*
name|sections
decl_stmt|;
name|bfd
modifier|*
name|ibfd
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_data_struct
name|bfd_pef_data_struct
typedef|;
end_typedef

begin_define
define|#
directive|define
name|BFD_PEF_XLIB_TAG1
value|0xF04D6163
end_define

begin_comment
comment|/* '?Mac' */
end_comment

begin_define
define|#
directive|define
name|BFD_PEF_VLIB_TAG2
value|0x564C6962
end_define

begin_comment
comment|/* 'VLib' */
end_comment

begin_define
define|#
directive|define
name|BFD_PEF_BLIB_TAG2
value|0x424C6962
end_define

begin_comment
comment|/* 'BLib' */
end_comment

begin_define
define|#
directive|define
name|BFD_PEF_XLIB_VERSION
value|0x00000001
end_define

begin_struct
struct|struct
name|bfd_pef_xlib_header
block|{
name|unsigned
name|long
name|tag1
decl_stmt|;
name|unsigned
name|long
name|tag2
decl_stmt|;
name|unsigned
name|long
name|current_format
decl_stmt|;
name|unsigned
name|long
name|container_strings_offset
decl_stmt|;
name|unsigned
name|long
name|export_hash_offset
decl_stmt|;
name|unsigned
name|long
name|export_key_offset
decl_stmt|;
name|unsigned
name|long
name|export_symbol_offset
decl_stmt|;
name|unsigned
name|long
name|export_names_offset
decl_stmt|;
name|unsigned
name|long
name|export_hash_table_power
decl_stmt|;
name|unsigned
name|long
name|exported_symbol_count
decl_stmt|;
name|unsigned
name|long
name|frag_name_offset
decl_stmt|;
name|unsigned
name|long
name|frag_name_length
decl_stmt|;
name|unsigned
name|long
name|dylib_path_offset
decl_stmt|;
name|unsigned
name|long
name|dylib_path_length
decl_stmt|;
name|unsigned
name|long
name|cpu_family
decl_stmt|;
name|unsigned
name|long
name|cpu_model
decl_stmt|;
name|unsigned
name|long
name|date_time_stamp
decl_stmt|;
name|unsigned
name|long
name|current_version
decl_stmt|;
name|unsigned
name|long
name|old_definition_version
decl_stmt|;
name|unsigned
name|long
name|old_implementation_version
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_xlib_header
name|bfd_pef_xlib_header
typedef|;
end_typedef

begin_struct
struct|struct
name|bfd_pef_xlib_data_struct
block|{
name|bfd_pef_xlib_header
name|header
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|struct
name|bfd_pef_xlib_data_struct
name|bfd_pef_xlib_data_struct
typedef|;
end_typedef

begin_function_decl
name|int
name|bfd_pef_parse_loader_header
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|size_t
parameter_list|,
name|bfd_pef_loader_header
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_print_loader_section
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|FILE
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|bfd_pef_print_loader_header
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|bfd_pef_loader_header
modifier|*
parameter_list|,
name|FILE
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_parse_imported_library
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|size_t
parameter_list|,
name|bfd_pef_imported_library
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_parse_imported_symbol
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|size_t
parameter_list|,
name|bfd_pef_imported_symbol
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_scan_section
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|bfd_pef_section
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_scan_start_address
parameter_list|(
name|bfd
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|bfd_pef_scan
parameter_list|(
name|bfd
modifier|*
parameter_list|,
name|bfd_pef_header
modifier|*
parameter_list|,
name|bfd_pef_data_struct
modifier|*
parameter_list|)
function_decl|;
end_function_decl

end_unit

