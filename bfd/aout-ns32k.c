begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD back-end for ns32k a.out-ish binaries.    Copyright 1990, 1991, 1992, 1994, 1995, 1996, 1998, 2000, 2001, 2002, 2003    Free Software Foundation, Inc.    Contributed by Ian Dall (idall@eleceng.adelaide.edu.au).     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"aout/aout64.h"
end_include

begin_include
include|#
directive|include
file|"ns32k.h"
end_include

begin_comment
comment|/* Do not "beautify" the CONCAT* macro args.  Traditional C will not    remove whitespace added here, and thus will fail to concatenate    the tokens.  */
end_comment

begin_define
define|#
directive|define
name|MYNS
parameter_list|(
name|OP
parameter_list|)
value|CONCAT2 (ns32kaout_,OP)
end_define

begin_function_decl
name|reloc_howto_type
modifier|*
name|MYNS
parameter_list|(
name|bfd_reloc_type_lookup
parameter_list|)
function_decl|PARAMS
parameter_list|(
function_decl|(bfd *abfd AND 	  bfd_reloc_code_real_type code
end_function_decl

begin_empty_stmt
unit|))
empty_stmt|;
end_empty_stmt

begin_function_decl
name|bfd_boolean
name|MYNS
parameter_list|(
name|write_object_contents
parameter_list|)
function_decl|PARAMS
parameter_list|(
function_decl|(bfd *abfd
end_function_decl

begin_empty_stmt
unit|))
empty_stmt|;
end_empty_stmt

begin_comment
comment|/* Avoid multiple definitions from aoutx if supporting    standard a.out format(s) as well as this one.  */
end_comment

begin_define
define|#
directive|define
name|NAME
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|CONCAT3 (ns32kaout,_32_,y)
end_define

begin_decl_stmt
name|void
name|bfd_ns32k_arch
name|PARAMS
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_include
include|#
directive|include
file|"libaout.h"
end_include

begin_define
define|#
directive|define
name|MY
parameter_list|(
name|OP
parameter_list|)
value|MYNS(OP)
end_define

begin_define
define|#
directive|define
name|MY_swap_std_reloc_in
value|MY(swap_std_reloc_in)
end_define

begin_define
define|#
directive|define
name|MY_swap_std_reloc_out
value|MY(swap_std_reloc_out)
end_define

begin_decl_stmt
specifier|static
name|void
name|MY_swap_std_reloc_in
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
expr|struct
name|reloc_std_external
operator|*
operator|,
name|arelent
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|,
name|bfd_size_type
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|MY_swap_std_reloc_out
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|arelent
operator|*
operator|,
expr|struct
name|reloc_std_external
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function_decl
name|reloc_howto_type
modifier|*
name|MY
parameter_list|(
name|reloc_howto
parameter_list|)
function_decl|PARAMS
parameter_list|(
function_decl|(bfd *
operator|,
function_decl|struct reloc_std_external *
operator|,
function_decl|int *
operator|,
function_decl|int *
operator|,
function_decl|int *
end_function_decl

begin_empty_stmt
unit|))
empty_stmt|;
end_empty_stmt

begin_function_decl
name|void
name|MY
parameter_list|(
name|put_reloc
parameter_list|)
function_decl|PARAMS
parameter_list|(
function_decl|(bfd *
operator|,
function_decl|int
operator|,
function_decl|int
operator|,
function_decl|bfd_vma
operator|,
function_decl|reloc_howto_type *
operator|,
function_decl|struct reloc_std_external *
end_function_decl

begin_empty_stmt
unit|))
empty_stmt|;
end_empty_stmt

begin_comment
comment|/* The ns32k series is ah, unusual, when it comes to relocation.    There are three storage methods for relocatable objects.  There    are displacements, immediate operands and ordinary twos complement    data. Of these, only the last fits into the standard relocation    scheme.  Immediate operands are stored huffman encoded and    immediate operands are stored big endian (where as the natural byte    order is little endian for this architecture).     Note that the ns32k displacement storage method is orthogonal to    whether the relocation is pc relative or not. The "displacement"    storage scheme is used for essentially all address constants. The    displacement can be relative to zero (absolute displacement),    relative to the pc (pc relative), the stack pointer, the frame    pointer, the static base register and general purpose register etc.     For example:     sym1: .long .	 # pc relative 2's complement    sym1: .long foo	 # 2's complement not pc relative     self:  movd @self, r0 # pc relative displacement           movd foo, r0   # non pc relative displacement     self:  movd self, r0  # pc relative immediate           movd foo, r0   # non pc relative immediate     In addition, for historical reasons the encoding of the relocation types    in the a.out format relocation entries is such that even the relocation    methods which are standard are not encoded the standard way.  */
end_comment

begin_decl_stmt
name|reloc_howto_type
name|MY
argument_list|(
name|howto_table
argument_list|)
decl|[]
init|=
block|{
comment|/* type           rs   size bsz  pcrel bitpos ovrf                  sf name          part_inpl readmask setmask pcdone */
comment|/* ns32k immediate operands.  */
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_8
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"NS32K_IMM_8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"NS32K_IMM_16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_32
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"NS32K_IMM_32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_8_PCREL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"PCREL_NS32K_IMM_8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_16_PCREL
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"PCREL_NS32K_IMM_16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_IMM_32_PCREL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_imm
argument_list|,
literal|"PCREL_NS32K_IMM_32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* ns32k displacements.  */
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_8
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|7
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"NS32K_DISP_8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|14
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"NS32K_DISP_16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_32
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|30
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"NS32K_DISP_32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_8_PCREL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|7
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"PCREL_NS32K_DISP_8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_16_PCREL
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|14
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"PCREL_NS32K_DISP_16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_NS32K_DISP_32_PCREL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|30
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
name|_bfd_ns32k_reloc_disp
argument_list|,
literal|"PCREL_NS32K_DISP_32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* Normal 2's complement.  */
name|HOWTO
argument_list|(
name|BFD_RELOC_8
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
literal|0
argument_list|,
literal|"8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
literal|0
argument_list|,
literal|"16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_32
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_bitfield
argument_list|,
literal|0
argument_list|,
literal|"32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_8_PCREL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
literal|0
argument_list|,
literal|"PCREL_8"
argument_list|,
name|TRUE
argument_list|,
literal|0x000000ff
argument_list|,
literal|0x000000ff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_16_PCREL
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
literal|0
argument_list|,
literal|"PCREL_16"
argument_list|,
name|TRUE
argument_list|,
literal|0x0000ffff
argument_list|,
literal|0x0000ffff
argument_list|,
name|FALSE
argument_list|)
block|,
name|HOWTO
argument_list|(
name|BFD_RELOC_32_PCREL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_signed
argument_list|,
literal|0
argument_list|,
literal|"PCREL_32"
argument_list|,
name|TRUE
argument_list|,
literal|0xffffffff
argument_list|,
literal|0xffffffff
argument_list|,
name|FALSE
argument_list|)
block|,   }
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|CTOR_TABLE_RELOC_HOWTO
parameter_list|(
name|BFD
parameter_list|)
value|(MY(howto_table) + 14)
end_define

begin_define
define|#
directive|define
name|RELOC_STD_BITS_NS32K_TYPE_BIG
value|0x06
end_define

begin_define
define|#
directive|define
name|RELOC_STD_BITS_NS32K_TYPE_LITTLE
value|0x60
end_define

begin_define
define|#
directive|define
name|RELOC_STD_BITS_NS32K_TYPE_SH_BIG
value|1
end_define

begin_define
define|#
directive|define
name|RELOC_STD_BITS_NS32K_TYPE_SH_LITTLE
value|5
end_define

begin_function
name|reloc_howto_type
modifier|*
name|MY
function|(
name|reloc_howto
function|)
parameter_list|(
name|abfd
parameter_list|,
name|rel
parameter_list|,
name|r_index
parameter_list|,
name|r_extern
parameter_list|,
name|r_pcrel
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|struct
name|reloc_std_external
modifier|*
name|rel
decl_stmt|;
name|int
modifier|*
name|r_index
decl_stmt|;
name|int
modifier|*
name|r_extern
decl_stmt|;
name|int
modifier|*
name|r_pcrel
decl_stmt|;
block|{
name|unsigned
name|int
name|r_length
decl_stmt|;
name|int
name|r_ns32k_type
decl_stmt|;
comment|/*  BFD_ASSERT(bfd_header_little_endian (abfd)); */
operator|*
name|r_index
operator|=
operator|(
operator|(
name|rel
operator|->
name|r_index
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|rel
operator|->
name|r_index
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
name|rel
operator|->
name|r_index
index|[
literal|0
index|]
operator|)
expr_stmt|;
operator|*
name|r_extern
operator|=
operator|(
literal|0
operator|!=
operator|(
name|rel
operator|->
name|r_type
index|[
literal|0
index|]
operator|&
name|RELOC_STD_BITS_EXTERN_LITTLE
operator|)
operator|)
expr_stmt|;
operator|*
name|r_pcrel
operator|=
operator|(
literal|0
operator|!=
operator|(
name|rel
operator|->
name|r_type
index|[
literal|0
index|]
operator|&
name|RELOC_STD_BITS_PCREL_LITTLE
operator|)
operator|)
expr_stmt|;
name|r_length
operator|=
operator|(
operator|(
name|rel
operator|->
name|r_type
index|[
literal|0
index|]
operator|&
name|RELOC_STD_BITS_LENGTH_LITTLE
operator|)
operator|>>
name|RELOC_STD_BITS_LENGTH_SH_LITTLE
operator|)
expr_stmt|;
name|r_ns32k_type
operator|=
operator|(
operator|(
name|rel
operator|->
name|r_type
index|[
literal|0
index|]
operator|&
name|RELOC_STD_BITS_NS32K_TYPE_LITTLE
operator|)
operator|>>
name|RELOC_STD_BITS_NS32K_TYPE_SH_LITTLE
operator|)
expr_stmt|;
return|return
operator|(
name|MY
argument_list|(
name|howto_table
argument_list|)
operator|+
name|r_length
operator|+
literal|3
operator|*
operator|(
operator|*
name|r_pcrel
operator|)
operator|+
literal|6
operator|*
name|r_ns32k_type
operator|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|MY_reloc_howto
parameter_list|(
name|BFD
parameter_list|,
name|REL
parameter_list|,
name|IN
parameter_list|,
name|EX
parameter_list|,
name|PC
parameter_list|)
define|\
value|MY(reloc_howto) (BFD, REL,&IN,&EX,&PC)
end_define

begin_function
name|void
name|MY
function|(
name|put_reloc
function|)
parameter_list|(
name|abfd
parameter_list|,
name|r_extern
parameter_list|,
name|r_index
parameter_list|,
name|value
parameter_list|,
name|howto
parameter_list|,
name|reloc
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|int
name|r_extern
decl_stmt|;
name|int
name|r_index
decl_stmt|;
name|bfd_vma
name|value
decl_stmt|;
name|reloc_howto_type
modifier|*
name|howto
decl_stmt|;
name|struct
name|reloc_std_external
modifier|*
name|reloc
decl_stmt|;
block|{
name|unsigned
name|int
name|r_length
decl_stmt|;
name|int
name|r_pcrel
decl_stmt|;
name|int
name|r_ns32k_type
decl_stmt|;
name|PUT_WORD
argument_list|(
name|abfd
argument_list|,
name|value
argument_list|,
name|reloc
operator|->
name|r_address
argument_list|)
expr_stmt|;
name|r_length
operator|=
name|howto
operator|->
name|size
expr_stmt|;
comment|/* Size as a power of two.  */
name|r_pcrel
operator|=
operator|(
name|int
operator|)
name|howto
operator|->
name|pc_relative
expr_stmt|;
comment|/* Relative to PC?  */
name|r_ns32k_type
operator|=
operator|(
name|howto
operator|-
name|MY
argument_list|(
name|howto_table
argument_list|)
operator|)
operator|/
literal|6
expr_stmt|;
comment|/*  BFD_ASSERT (bfd_header_little_endian (abfd)); */
name|reloc
operator|->
name|r_index
index|[
literal|2
index|]
operator|=
name|r_index
operator|>>
literal|16
expr_stmt|;
name|reloc
operator|->
name|r_index
index|[
literal|1
index|]
operator|=
name|r_index
operator|>>
literal|8
expr_stmt|;
name|reloc
operator|->
name|r_index
index|[
literal|0
index|]
operator|=
name|r_index
expr_stmt|;
name|reloc
operator|->
name|r_type
index|[
literal|0
index|]
operator|=
operator|(
name|r_extern
condition|?
name|RELOC_STD_BITS_EXTERN_LITTLE
else|:
literal|0
operator|)
operator||
operator|(
name|r_pcrel
condition|?
name|RELOC_STD_BITS_PCREL_LITTLE
else|:
literal|0
operator|)
operator||
operator|(
name|r_length
operator|<<
name|RELOC_STD_BITS_LENGTH_SH_LITTLE
operator|)
operator||
operator|(
name|r_ns32k_type
operator|<<
name|RELOC_STD_BITS_NS32K_TYPE_SH_LITTLE
operator|)
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|MY_put_reloc
parameter_list|(
name|BFD
parameter_list|,
name|EXT
parameter_list|,
name|IDX
parameter_list|,
name|VAL
parameter_list|,
name|HOWTO
parameter_list|,
name|RELOC
parameter_list|)
define|\
value|MY(put_reloc) (BFD, EXT, IDX, VAL, HOWTO, RELOC)
end_define

begin_define
define|#
directive|define
name|STAT_FOR_EXEC
end_define

begin_define
define|#
directive|define
name|MY_final_link_relocate
value|_bfd_ns32k_final_link_relocate
end_define

begin_define
define|#
directive|define
name|MY_relocate_contents
value|_bfd_ns32k_relocate_contents
end_define

begin_include
include|#
directive|include
file|"aoutx.h"
end_include

begin_function
name|reloc_howto_type
modifier|*
name|MY
function|(
name|bfd_reloc_type_lookup
function|)
parameter_list|(
name|abfd
parameter_list|,
name|code
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_reloc_code_real_type
name|code
decl_stmt|;
block|{
define|#
directive|define
name|ENTRY
parameter_list|(
name|i
parameter_list|,
name|j
parameter_list|)
value|case i: return&MY(howto_table)[j]
name|int
name|ext
init|=
name|obj_reloc_entry_size
argument_list|(
name|abfd
argument_list|)
operator|==
name|RELOC_EXT_SIZE
decl_stmt|;
name|BFD_ASSERT
argument_list|(
name|ext
operator|==
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|code
operator|==
name|BFD_RELOC_CTOR
condition|)
switch|switch
condition|(
name|bfd_get_arch_info
argument_list|(
name|abfd
argument_list|)
operator|->
name|bits_per_address
condition|)
block|{
case|case
literal|32
case|:
name|code
operator|=
name|BFD_RELOC_32
expr_stmt|;
break|break;
default|default:
break|break;
block|}
switch|switch
condition|(
name|code
condition|)
block|{
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_8
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_16
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_32
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_8_PCREL
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_16_PCREL
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_IMM_32_PCREL
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_8
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_16
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_32
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_8_PCREL
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_16_PCREL
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_NS32K_DISP_32_PCREL
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_8
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_16
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_32
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_8_PCREL
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_16_PCREL
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|ENTRY
argument_list|(
name|BFD_RELOC_32_PCREL
argument_list|,
literal|17
argument_list|)
expr_stmt|;
default|default:
return|return
operator|(
name|reloc_howto_type
operator|*
operator|)
name|NULL
return|;
block|}
undef|#
directive|undef
name|ENTRY
block|}
end_function

begin_function
specifier|static
name|void
name|MY_swap_std_reloc_in
parameter_list|(
name|abfd
parameter_list|,
name|bytes
parameter_list|,
name|cache_ptr
parameter_list|,
name|symbols
parameter_list|,
name|symcount
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|struct
name|reloc_std_external
modifier|*
name|bytes
decl_stmt|;
name|arelent
modifier|*
name|cache_ptr
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|symbols
decl_stmt|;
name|bfd_size_type
name|symcount
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|int
name|r_index
decl_stmt|;
name|int
name|r_extern
decl_stmt|;
name|int
name|r_pcrel
decl_stmt|;
name|struct
name|aoutdata
modifier|*
name|su
init|=
operator|&
operator|(
name|abfd
operator|->
name|tdata
operator|.
name|aout_data
operator|->
name|a
operator|)
decl_stmt|;
name|cache_ptr
operator|->
name|address
operator|=
name|H_GET_32
argument_list|(
name|abfd
argument_list|,
name|bytes
operator|->
name|r_address
argument_list|)
expr_stmt|;
comment|/* Now the fun stuff.  */
name|cache_ptr
operator|->
name|howto
operator|=
name|MY_reloc_howto
argument_list|(
name|abfd
argument_list|,
name|bytes
argument_list|,
name|r_index
argument_list|,
name|r_extern
argument_list|,
name|r_pcrel
argument_list|)
expr_stmt|;
name|MOVE_ADDRESS
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|MY_swap_std_reloc_out
parameter_list|(
name|abfd
parameter_list|,
name|g
parameter_list|,
name|natptr
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|arelent
modifier|*
name|g
decl_stmt|;
name|struct
name|reloc_std_external
modifier|*
name|natptr
decl_stmt|;
block|{
name|int
name|r_index
decl_stmt|;
name|asymbol
modifier|*
name|sym
init|=
operator|*
operator|(
name|g
operator|->
name|sym_ptr_ptr
operator|)
decl_stmt|;
name|int
name|r_extern
decl_stmt|;
name|unsigned
name|int
name|r_addend
decl_stmt|;
name|asection
modifier|*
name|output_section
init|=
name|sym
operator|->
name|section
operator|->
name|output_section
decl_stmt|;
name|r_addend
operator|=
name|g
operator|->
name|addend
operator|+
operator|(
operator|*
operator|(
name|g
operator|->
name|sym_ptr_ptr
operator|)
operator|)
operator|->
name|section
operator|->
name|output_section
operator|->
name|vma
expr_stmt|;
comment|/* Name was clobbered by aout_write_syms to be symbol index.  */
comment|/* If this relocation is relative to a symbol then set the      r_index to the symbols index, and the r_extern bit.       Absolute symbols can come in in two ways, either as an offset      from the abs section, or as a symbol which has an abs value.      Check for that here.  */
if|if
condition|(
name|bfd_is_com_section
argument_list|(
name|output_section
argument_list|)
operator|||
name|output_section
operator|==
operator|&
name|bfd_abs_section
operator|||
name|output_section
operator|==
operator|&
name|bfd_und_section
condition|)
block|{
if|if
condition|(
name|bfd_abs_section
operator|.
name|symbol
operator|==
name|sym
condition|)
block|{
comment|/* Whoops, looked like an abs symbol, but is really an offset 	     from the abs section.  */
name|r_index
operator|=
literal|0
expr_stmt|;
name|r_extern
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* Fill in symbol.  */
name|r_extern
operator|=
literal|1
expr_stmt|;
undef|#
directive|undef
name|KEEPIT
define|#
directive|define
name|KEEPIT
value|udata.i
name|r_index
operator|=
operator|(
operator|*
operator|(
name|g
operator|->
name|sym_ptr_ptr
operator|)
operator|)
operator|->
name|KEEPIT
expr_stmt|;
undef|#
directive|undef
name|KEEPIT
block|}
block|}
else|else
block|{
comment|/* Just an ordinary section.  */
name|r_extern
operator|=
literal|0
expr_stmt|;
name|r_index
operator|=
name|output_section
operator|->
name|target_index
expr_stmt|;
block|}
name|MY_put_reloc
argument_list|(
name|abfd
argument_list|,
name|r_extern
argument_list|,
name|r_index
argument_list|,
name|g
operator|->
name|address
argument_list|,
name|g
operator|->
name|howto
argument_list|,
name|natptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|bfd_reloc_status_type
name|_bfd_ns32k_relocate_contents
parameter_list|(
name|howto
parameter_list|,
name|input_bfd
parameter_list|,
name|relocation
parameter_list|,
name|location
parameter_list|)
name|reloc_howto_type
modifier|*
name|howto
decl_stmt|;
name|bfd
modifier|*
name|input_bfd
decl_stmt|;
name|bfd_vma
name|relocation
decl_stmt|;
name|bfd_byte
modifier|*
name|location
decl_stmt|;
block|{
name|int
name|r_ns32k_type
init|=
operator|(
name|howto
operator|-
name|MY
argument_list|(
name|howto_table
argument_list|)
operator|)
operator|/
literal|6
decl_stmt|;
name|bfd_vma
argument_list|(
argument|*get_data
argument_list|)
name|PARAMS
argument_list|(
operator|(
name|bfd_byte
operator|*
operator|,
name|int
operator|)
argument_list|)
expr_stmt|;
name|void
argument_list|(
argument|*put_data
argument_list|)
name|PARAMS
argument_list|(
operator|(
name|bfd_vma
operator|,
name|bfd_byte
operator|*
operator|,
name|int
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|r_ns32k_type
condition|)
block|{
case|case
literal|0
case|:
name|get_data
operator|=
name|_bfd_ns32k_get_immediate
expr_stmt|;
name|put_data
operator|=
name|_bfd_ns32k_put_immediate
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|get_data
operator|=
name|_bfd_ns32k_get_displacement
expr_stmt|;
name|put_data
operator|=
name|_bfd_ns32k_put_displacement
expr_stmt|;
break|break;
case|case
literal|2
case|:
return|return
name|_bfd_relocate_contents
argument_list|(
name|howto
argument_list|,
name|input_bfd
argument_list|,
name|relocation
argument_list|,
name|location
argument_list|)
return|;
comment|/* NOT REACHED */
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
return|return
name|_bfd_do_ns32k_reloc_contents
argument_list|(
name|howto
argument_list|,
name|input_bfd
argument_list|,
name|relocation
argument_list|,
name|location
argument_list|,
name|get_data
argument_list|,
name|put_data
argument_list|)
return|;
block|}
end_function

end_unit

