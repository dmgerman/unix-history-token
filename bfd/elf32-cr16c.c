begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD back-end for National Semiconductor's CR16C ELF    Copyright 2004, 2005, 2006, 2007 Free Software Foundation, Inc.     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"bfdlink.h"
end_include

begin_include
include|#
directive|include
file|"elf/cr16c.h"
end_include

begin_include
include|#
directive|include
file|"elf-bfd.h"
end_include

begin_define
define|#
directive|define
name|USE_REL
value|1
end_define

begin_comment
comment|/* CR16C uses REL relocations instead of RELA.  */
end_comment

begin_comment
comment|/* The following definition is based on EMPTY_HOWTO macro,     but also initiates the "name" field in HOWTO struct.  */
end_comment

begin_define
define|#
directive|define
name|ONLY_NAME_HOWTO
parameter_list|(
name|C
parameter_list|)
define|\
value|HOWTO ((C), 0, 0, 0, FALSE, 0, complain_overflow_dont, NULL, \ 	  STRINGX(C), FALSE, 0, 0, FALSE)
end_define

begin_comment
comment|/* reloc_map_index array maps CRASM relocation type into a BFD    relocation enum. The array's indices are synchronized with     RINDEX_16C_* indices, created in include/elf/cr16c.h.    The array is used in:    1. elf32-cr16c.c : elf_cr16c_reloc_type_lookup().    2. asreloc.c : find_reloc_type(). */
end_comment

begin_decl_stmt
name|RELOC_MAP
name|reloc_map_index
index|[
name|RINDEX_16C_MAX
index|]
init|=
block|{
block|{
name|R_16C_NUM08
block|,
name|BFD_RELOC_16C_NUM08
block|}
block|,
block|{
name|R_16C_NUM08_C
block|,
name|BFD_RELOC_16C_NUM08_C
block|}
block|,
block|{
name|R_16C_NUM16
block|,
name|BFD_RELOC_16C_NUM16
block|}
block|,
block|{
name|R_16C_NUM16_C
block|,
name|BFD_RELOC_16C_NUM16_C
block|}
block|,
block|{
name|R_16C_NUM32
block|,
name|BFD_RELOC_16C_NUM32
block|}
block|,
block|{
name|R_16C_NUM32_C
block|,
name|BFD_RELOC_16C_NUM32_C
block|}
block|,
block|{
name|R_16C_DISP04
block|,
name|BFD_RELOC_16C_DISP04
block|}
block|,
block|{
name|R_16C_DISP04_C
block|,
name|BFD_RELOC_16C_DISP04_C
block|}
block|,
block|{
name|R_16C_DISP08
block|,
name|BFD_RELOC_16C_DISP08
block|}
block|,
block|{
name|R_16C_DISP08_C
block|,
name|BFD_RELOC_16C_DISP08_C
block|}
block|,
block|{
name|R_16C_DISP16
block|,
name|BFD_RELOC_16C_DISP16
block|}
block|,
block|{
name|R_16C_DISP16_C
block|,
name|BFD_RELOC_16C_DISP16_C
block|}
block|,
block|{
name|R_16C_DISP24
block|,
name|BFD_RELOC_16C_DISP24
block|}
block|,
block|{
name|R_16C_DISP24_C
block|,
name|BFD_RELOC_16C_DISP24_C
block|}
block|,
block|{
name|R_16C_DISP24a
block|,
name|BFD_RELOC_16C_DISP24a
block|}
block|,
block|{
name|R_16C_DISP24a_C
block|,
name|BFD_RELOC_16C_DISP24a_C
block|}
block|,
block|{
name|R_16C_REG04
block|,
name|BFD_RELOC_16C_REG04
block|}
block|,
block|{
name|R_16C_REG04_C
block|,
name|BFD_RELOC_16C_REG04_C
block|}
block|,
block|{
name|R_16C_REG04a
block|,
name|BFD_RELOC_16C_REG04a
block|}
block|,
block|{
name|R_16C_REG04a_C
block|,
name|BFD_RELOC_16C_REG04a_C
block|}
block|,
block|{
name|R_16C_REG14
block|,
name|BFD_RELOC_16C_REG14
block|}
block|,
block|{
name|R_16C_REG14_C
block|,
name|BFD_RELOC_16C_REG14_C
block|}
block|,
block|{
name|R_16C_REG16
block|,
name|BFD_RELOC_16C_REG16
block|}
block|,
block|{
name|R_16C_REG16_C
block|,
name|BFD_RELOC_16C_REG16_C
block|}
block|,
block|{
name|R_16C_REG20
block|,
name|BFD_RELOC_16C_REG20
block|}
block|,
block|{
name|R_16C_REG20_C
block|,
name|BFD_RELOC_16C_REG20_C
block|}
block|,
block|{
name|R_16C_ABS20
block|,
name|BFD_RELOC_16C_ABS20
block|}
block|,
block|{
name|R_16C_ABS20_C
block|,
name|BFD_RELOC_16C_ABS20_C
block|}
block|,
block|{
name|R_16C_ABS24
block|,
name|BFD_RELOC_16C_ABS24
block|}
block|,
block|{
name|R_16C_ABS24_C
block|,
name|BFD_RELOC_16C_ABS24_C
block|}
block|,
block|{
name|R_16C_IMM04
block|,
name|BFD_RELOC_16C_IMM04
block|}
block|,
block|{
name|R_16C_IMM04_C
block|,
name|BFD_RELOC_16C_IMM04_C
block|}
block|,
block|{
name|R_16C_IMM16
block|,
name|BFD_RELOC_16C_IMM16
block|}
block|,
block|{
name|R_16C_IMM16_C
block|,
name|BFD_RELOC_16C_IMM16_C
block|}
block|,
block|{
name|R_16C_IMM20
block|,
name|BFD_RELOC_16C_IMM20
block|}
block|,
block|{
name|R_16C_IMM20_C
block|,
name|BFD_RELOC_16C_IMM20_C
block|}
block|,
block|{
name|R_16C_IMM24
block|,
name|BFD_RELOC_16C_IMM24
block|}
block|,
block|{
name|R_16C_IMM24_C
block|,
name|BFD_RELOC_16C_IMM24_C
block|}
block|,
block|{
name|R_16C_IMM32
block|,
name|BFD_RELOC_16C_IMM32
block|}
block|,
block|{
name|R_16C_IMM32_C
block|,
name|BFD_RELOC_16C_IMM32_C
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|reloc_howto_type
name|elf_howto_table
index|[]
init|=
block|{
comment|/* 00 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM08
argument_list|)
block|,
comment|/* 01 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM08_C
argument_list|)
block|,
comment|/* 02 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM16
argument_list|)
block|,
comment|/* 03 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM16_C
argument_list|)
block|,
comment|/* 04 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM32
argument_list|)
block|,
comment|/* 05 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_NUM32_C
argument_list|)
block|,
comment|/* 06 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP04
argument_list|)
block|,
comment|/* 07 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP04_C
argument_list|)
block|,
comment|/* 08 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP08
argument_list|)
block|,
comment|/* 09 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP08_C
argument_list|)
block|,
comment|/* 10 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP16
argument_list|)
block|,
comment|/* 11 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP16_C
argument_list|)
block|,
comment|/* 12 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP24
argument_list|)
block|,
comment|/* 13 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP24_C
argument_list|)
block|,
comment|/* 14 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP24a
argument_list|)
block|,
comment|/* 15 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_DISP24a_C
argument_list|)
block|,
comment|/* 16 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG04
argument_list|)
block|,
comment|/* 17 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG04_C
argument_list|)
block|,
comment|/* 18 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG04a
argument_list|)
block|,
comment|/* 19 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG04a_C
argument_list|)
block|,
comment|/* 20 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG14
argument_list|)
block|,
comment|/* 21 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG14_C
argument_list|)
block|,
comment|/* 22 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG16
argument_list|)
block|,
comment|/* 23 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG16_C
argument_list|)
block|,
comment|/* 24 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG20
argument_list|)
block|,
comment|/* 25 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_REG20_C
argument_list|)
block|,
comment|/* 26 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_ABS20
argument_list|)
block|,
comment|/* 27 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_ABS20_C
argument_list|)
block|,
comment|/* 28 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_ABS24
argument_list|)
block|,
comment|/* 29 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_ABS24_C
argument_list|)
block|,
comment|/* 30 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM04
argument_list|)
block|,
comment|/* 31 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM04_C
argument_list|)
block|,
comment|/* 32 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM16
argument_list|)
block|,
comment|/* 33 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM16_C
argument_list|)
block|,
comment|/* 34 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM20
argument_list|)
block|,
comment|/* 35 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM20_C
argument_list|)
block|,
comment|/* 36 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM24
argument_list|)
block|,
comment|/* 37 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM24_C
argument_list|)
block|,
comment|/* 38 */
name|ONLY_NAME_HOWTO
argument_list|(
name|RINDEX_16C_IMM32
argument_list|)
block|,
comment|/* 39 */
name|ONLY_NAME_HOWTO
argument_list|(
argument|RINDEX_16C_IMM32_C
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Code to turn a code_type into a howto ptr, uses the above howto table.  */
end_comment

begin_function
specifier|static
name|reloc_howto_type
modifier|*
name|elf_cr16c_reloc_type_lookup
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|bfd_reloc_code_real_type
name|code
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|RINDEX_16C_MAX
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|code
operator|==
name|reloc_map_index
index|[
name|i
index|]
operator|.
name|bfd_reloc_enum
condition|)
block|{
comment|/* printf ("CR16C Relocation Type is - %x\n", code); */
return|return
operator|&
name|elf_howto_table
index|[
name|i
index|]
return|;
block|}
block|}
comment|/* printf ("This relocation Type is not supported - %x\n", code); */
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|reloc_howto_type
modifier|*
name|elf_cr16c_reloc_name_lookup
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
specifier|const
name|char
modifier|*
name|r_name
parameter_list|)
block|{
name|unsigned
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|elf_howto_table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|elf_howto_table
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|elf_howto_table
index|[
name|i
index|]
operator|.
name|name
operator|!=
name|NULL
operator|&&
name|strcasecmp
argument_list|(
name|elf_howto_table
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|r_name
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|&
name|elf_howto_table
index|[
name|i
index|]
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|elf_cr16c_info_to_howto
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|arelent
modifier|*
name|cache_ptr
name|ATTRIBUTE_UNUSED
parameter_list|,
name|Elf_Internal_Rela
modifier|*
name|dst
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|elf_cr16c_info_to_howto_rel
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|arelent
modifier|*
name|cache_ptr
parameter_list|,
name|Elf_Internal_Rela
modifier|*
name|dst
parameter_list|)
block|{
name|unsigned
name|int
name|r_type
init|=
name|ELF32_R_TYPE
argument_list|(
name|dst
operator|->
name|r_info
argument_list|)
decl_stmt|;
name|BFD_ASSERT
argument_list|(
name|r_type
operator|<
operator|(
name|unsigned
name|int
operator|)
name|RINDEX_16C_MAX
argument_list|)
expr_stmt|;
name|cache_ptr
operator|->
name|howto
operator|=
operator|&
name|elf_howto_table
index|[
name|r_type
index|]
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Perform a relocation as part of a final link.  */
end_comment

begin_function
specifier|static
name|bfd_reloc_status_type
name|cr16c_elf_final_link_relocate
parameter_list|(
name|reloc_howto_type
modifier|*
name|howto
parameter_list|,
name|bfd
modifier|*
name|abfd
parameter_list|,
name|bfd
modifier|*
name|output_bfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|asection
modifier|*
name|input_section
parameter_list|,
name|bfd_byte
modifier|*
name|data
parameter_list|,
name|bfd_vma
name|octets
parameter_list|,
name|bfd_vma
name|Rvalue
parameter_list|,
name|bfd_vma
name|addend
name|ATTRIBUTE_UNUSED
parameter_list|,
name|struct
name|bfd_link_info
modifier|*
name|info
name|ATTRIBUTE_UNUSED
parameter_list|,
name|asection
modifier|*
name|sym_sec
name|ATTRIBUTE_UNUSED
parameter_list|,
name|int
name|is_local
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|long
name|value
decl_stmt|;
name|short
name|sword
decl_stmt|;
comment|/* Extracted from the hole and put back.  */
name|unsigned
name|long
name|format
decl_stmt|,
name|addr_type
decl_stmt|,
name|code_factor
decl_stmt|;
name|unsigned
name|short
name|size
decl_stmt|;
name|unsigned
name|short
name|r_type
decl_stmt|;
name|asymbol
modifier|*
name|symbol
init|=
name|NULL
decl_stmt|;
name|unsigned
name|long
name|disp20_opcod
decl_stmt|;
name|char
name|neg
init|=
literal|0
decl_stmt|;
name|char
name|neg2pos
init|=
literal|0
decl_stmt|;
name|long
name|left_val
init|=
literal|0
decl_stmt|;
name|long
name|plus_factor
init|=
literal|0
decl_stmt|;
comment|/* To be added to the hole.  */
define|#
directive|define
name|MIN_BYTE
value|((int) 0xFFFFFF80)
define|#
directive|define
name|MIN_WORD
value|((int) 0xFFFF8000)
define|#
directive|define
name|MAX_UWORD
value|((unsigned) 0x0000FFFF)
define|#
directive|define
name|MAX_UBYTE
value|((unsigned) 0x000000FF)
name|r_type
operator|=
name|reloc_map_index
index|[
name|howto
operator|->
name|type
index|]
operator|.
name|cr_reloc_type
expr_stmt|;
name|format
operator|=
name|r_type
operator|&
name|R_FORMAT
expr_stmt|;
name|size
operator|=
name|r_type
operator|&
name|R_SIZESP
expr_stmt|;
name|addr_type
operator|=
name|r_type
operator|&
name|R_ADDRTYPE
expr_stmt|;
name|code_factor
operator|=
operator|(
operator|(
name|addr_type
operator|==
name|R_CODE_ADDR
operator|)
condition|?
literal|1
else|:
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|sym_sec
condition|)
name|symbol
operator|=
name|sym_sec
operator|->
name|symbol
expr_stmt|;
switch|switch
condition|(
name|format
condition|)
block|{
case|case
name|R_NUMBER
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_08
case|:
comment|/* One byte.  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* Two bytes. */
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
name|sword
expr_stmt|;
break|break;
case|case
name|R_S_16C_32
case|:
comment|/* Four bytes.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_DISPL
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1(4-7).  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
name|value
operator|=
operator|(
name|value
operator|&
literal|0xF0
operator|)
operator|>>
literal|4
expr_stmt|;
name|value
operator|++
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
break|break;
case|case
name|R_S_16C_08
case|:
comment|/* word1(0-3,8-11).  */
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
name|sword
operator|&
literal|0x000F
expr_stmt|;
name|value
operator||=
operator|(
operator|(
name|sword
operator|&
literal|0x0F00
operator|)
operator|>>
literal|4
operator|)
expr_stmt|;
name|left_val
operator|=
name|sword
operator|&
literal|0xF0F0
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
literal|0x100
condition|)
name|value
operator||=
literal|0xFFFFFF00
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
name|sword
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xFFFE
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x1
operator|)
operator|<<
literal|15
operator|)
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
literal|0x10000
condition|)
name|value
operator||=
literal|0xFFFF0000
expr_stmt|;
break|break;
case|case
name|R_S_16C_24_a
case|:
comment|/* word1(0-7),word2.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x0000FF00
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xFFFE0000
operator|)
operator|>>
literal|17
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00010000
operator|)
operator|<<
literal|7
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000000FF
operator|)
operator|<<
literal|15
operator|)
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
literal|0x1000000
condition|)
name|value
operator||=
literal|0xFE000000
expr_stmt|;
break|break;
case|case
name|R_S_16C_24
case|:
comment|/* word2(0-3,8-11),word3.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x0000F0F0
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|>>
literal|16
operator|)
operator|&
literal|0x0000FFFF
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00000F00
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x0000000F
operator|)
operator|<<
literal|20
operator|)
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x00FFFFFE
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00000001
operator|)
operator|<<
literal|23
operator|)
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
literal|0x1000000
condition|)
name|value
operator||=
literal|0xFE000000
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_REGREL
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1(12-15) not scaled.  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0xF0
expr_stmt|;
name|value
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
break|break;
case|case
name|R_S_16C_04_a
case|:
comment|/* word1(12-15) scaled by 2.  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0xF0
expr_stmt|;
name|value
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
name|value
operator|<<=
literal|1
expr_stmt|;
break|break;
case|case
name|R_S_16C_14
case|:
comment|/* word1(4-5),word2(0-3,8-15).  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x00F0FFCF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xc0000000
operator|)
operator|>>
literal|24
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x3F000000
operator|)
operator|>>
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|16
operator|)
operator||
operator|(
name|value
operator|&
literal|0x00000030
operator|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
name|sword
expr_stmt|;
break|break;
case|case
name|R_S_16C_20
case|:
comment|/* word2(8-11),word3.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0xF0
expr_stmt|;
name|value
operator|=
operator|(
name|value
operator|&
literal|0xF
operator|)
operator|<<
literal|16
expr_stmt|;
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
operator|+
literal|1
argument_list|)
expr_stmt|;
name|value
operator|=
name|value
operator||
operator|(
name|unsigned
name|short
operator|)
name|sword
expr_stmt|;
name|disp20_opcod
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
operator|-
literal|3
argument_list|)
expr_stmt|;
name|disp20_opcod
operator||=
literal|0x0FFF0000
expr_stmt|;
if|if
condition|(
operator|(
name|disp20_opcod
operator|==
literal|0x4FFF0018
operator|)
operator|||
comment|/* loadb -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0x5FFF0018
operator|)
operator|||
comment|/* loadb -disp20(rp)  */
operator|(
name|disp20_opcod
operator|==
literal|0x8FFF0018
operator|)
operator|||
comment|/* loadd -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0x9FFF0018
operator|)
operator|||
comment|/* loadd -disp20(rp)  */
operator|(
name|disp20_opcod
operator|==
literal|0xCFFF0018
operator|)
operator|||
comment|/* loadw -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0xDFFF0018
operator|)
operator|||
comment|/* loadw -disp20(rp)  */
operator|(
name|disp20_opcod
operator|==
literal|0x4FFF0019
operator|)
operator|||
comment|/* storb -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0x5FFF0019
operator|)
operator|||
comment|/* storb -disp20(rp)  */
operator|(
name|disp20_opcod
operator|==
literal|0x8FFF0019
operator|)
operator|||
comment|/* stord -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0x9FFF0019
operator|)
operator|||
comment|/* stord -disp20(rp)  */
operator|(
name|disp20_opcod
operator|==
literal|0xCFFF0019
operator|)
operator|||
comment|/* storw -disp20(reg) */
operator|(
name|disp20_opcod
operator|==
literal|0xDFFF0019
operator|)
condition|)
block|{
comment|/* storw -disp20(rp).  */
name|neg
operator|=
literal|1
expr_stmt|;
name|value
operator||=
literal|0xFFF00000
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_ABS
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_20
case|:
comment|/* word1(0-3),word2.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x0000FFF0
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xFFFF0000
operator|)
operator|>>
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x0000000F
operator|)
operator|<<
literal|16
operator|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_24
case|:
comment|/* word2(0-3,8-11),word3.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x0000F0F0
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xFFFF0000
operator|)
operator|>>
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00000F00
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x0000000F
operator|)
operator|<<
literal|20
operator|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_IMMED
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1/2(4-7).  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0xF
expr_stmt|;
name|value
operator|=
operator|(
name|value
operator|&
literal|0xF0
operator|)
operator|>>
literal|4
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
name|sword
operator|=
name|bfd_get_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
name|sword
expr_stmt|;
break|break;
case|case
name|R_S_16C_20
case|:
comment|/* word1(0-3),word2.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|left_val
operator|=
name|value
operator|&
literal|0x0000FFF0
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0xFFFF0000
operator|)
operator|>>
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x0000000F
operator|)
operator|<<
literal|16
operator|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_32
case|:
comment|/* word2, word3.  */
name|value
operator|=
name|bfd_get_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0xFFFF0000
operator|)
operator|>>
literal|16
operator|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
switch|switch
condition|(
operator|(
name|r_type
operator|&
name|R_RELTO
operator|)
operator|>>
literal|4
condition|)
block|{
case|case
literal|0
case|:
comment|/* R_ABS.  */
name|plus_factor
operator|=
name|Rvalue
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* R_PCREL.  */
name|plus_factor
operator|=
name|Rvalue
operator|-
operator|(
name|input_section
operator|->
name|output_section
operator|->
name|vma
operator|+
name|input_section
operator|->
name|output_offset
operator|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
if|if
condition|(
name|neg
condition|)
block|{
if|if
condition|(
name|plus_factor
operator|>=
operator|-
name|value
condition|)
name|neg2pos
operator|=
literal|1
expr_stmt|;
comment|/* We need to change load/stor with negative 	 displ opcode to positive disp opcode (CR16C).  */
block|}
name|value
operator|=
name|value
operator|+
operator|(
name|plus_factor
operator|>>
name|code_factor
operator|)
expr_stmt|;
switch|switch
condition|(
name|format
condition|)
block|{
case|case
name|R_NUMBER
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_08
case|:
comment|/* One byte.  */
if|if
condition|(
name|value
operator|>
operator|(
name|int
operator|)
name|MAX_UBYTE
operator|||
name|value
operator|<
name|MIN_BYTE
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFF
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* Two bytes.  */
if|if
condition|(
name|value
operator|>
operator|(
name|int
operator|)
name|MAX_UWORD
operator|||
name|value
operator|<
name|MIN_WORD
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFFFF
expr_stmt|;
name|sword
operator|=
name|value
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_32
case|:
comment|/* Four bytes.  */
name|value
operator|&=
literal|0xFFFFFFFF
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_DISPL
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1(4-7).  */
if|if
condition|(
operator|(
name|value
operator|-
literal|32
operator|)
operator|>
literal|32
operator|||
name|value
operator|<
literal|2
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|value
operator|--
expr_stmt|;
name|value
operator|&=
literal|0xF
expr_stmt|;
name|value
operator|<<=
literal|4
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_08
case|:
comment|/* word1(0-3,8-11).  */
if|if
condition|(
name|value
operator|>
literal|255
operator|||
name|value
operator|<
operator|-
literal|256
operator|||
name|value
operator|==
literal|0x80
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0x1FF
expr_stmt|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|sword
operator|=
name|value
operator|&
literal|0x000F
expr_stmt|;
name|sword
operator||=
operator|(
name|value
operator|&
literal|0x00F0
operator|)
operator|<<
literal|4
expr_stmt|;
name|sword
operator||=
name|left_val
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
if|if
condition|(
name|value
operator|>
literal|65535
operator|||
name|value
operator|<
operator|-
literal|65536
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|value
operator|&=
literal|0xFFFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x8000
operator|)
operator|>>
literal|15
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x7FFF
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
name|sword
operator|=
name|value
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_24_a
case|:
comment|/* word1(0-7),word2.  */
if|if
condition|(
name|value
operator|>
literal|16777215
operator|||
name|value
operator|<
operator|-
literal|16777216
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0x1FFFFFF
expr_stmt|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x00007FFF
operator|)
operator|<<
literal|17
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00800000
operator|)
operator|>>
literal|7
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x007F8000
operator|)
operator|>>
literal|15
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_24
case|:
comment|/* word2(0-3,8-11),word3.  */
if|if
condition|(
name|value
operator|>
literal|16777215
operator|||
name|value
operator|<
operator|-
literal|16777216
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0x1FFFFFF
expr_stmt|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x007FFFFF
operator|)
operator|<<
literal|1
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00800000
operator|)
operator|>>
literal|23
operator|)
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|8
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00F00000
operator|)
operator|>>
literal|20
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_REGREL
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1(12-15) not scaled.  */
if|if
condition|(
name|value
operator|>
literal|13
operator|||
name|value
operator|<
literal|0
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xF
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_04_a
case|:
comment|/* word1(12-15) not scaled.  */
if|if
condition|(
name|value
operator|>
literal|26
operator|||
name|value
operator|<
literal|0
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0x1F
expr_stmt|;
name|value
operator|>>=
literal|1
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_14
case|:
comment|/* word1(4-5),word2(0-3,8-15).  */
if|if
condition|(
name|value
operator|<
literal|0
operator|||
name|value
operator|>
literal|16383
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0x3FFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x000000c0
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00003F00
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x0000000F
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
name|value
operator|&
literal|0x00000030
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
if|if
condition|(
name|value
operator|>
literal|65535
operator|||
name|value
operator|<
literal|0
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFFFF
expr_stmt|;
name|sword
operator|=
name|value
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_20
case|:
comment|/* word2(8-11),word3.  */
comment|/* if (value> 1048575 || value< 0) RELOC_ERROR(1); */
name|value
operator|&=
literal|0xFFFFF
expr_stmt|;
name|sword
operator|=
name|value
operator|&
literal|0x0000FFFF
expr_stmt|;
name|value
operator|=
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|16
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|neg2pos
condition|)
block|{
comment|/* Change load/stor negative displ opcode 	         to load/stor positive displ opcode.  */
name|value
operator|=
name|bfd_get_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data
operator|+
name|octets
operator|-
literal|3
argument_list|)
expr_stmt|;
name|value
operator|&=
literal|0xF7
expr_stmt|;
name|value
operator||=
literal|0x2
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
operator|-
literal|3
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_ABS
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_20
case|:
comment|/* word1(0-3),word2.  */
if|if
condition|(
name|value
operator|>
literal|1048575
operator|||
name|value
operator|<
literal|0
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFFFFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|16
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_24
case|:
comment|/* word2(0-3,8-11),word3.  */
comment|/* if (value> 16777215 || value< 0) RELOC_ERROR(1); */
name|value
operator|&=
literal|0xFFFFFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|8
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x00F00000
operator|)
operator|>>
literal|20
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
case|case
name|R_16C_IMMED
case|:
switch|switch
condition|(
name|size
condition|)
block|{
case|case
name|R_S_16C_04
case|:
comment|/* word1/2(4-7).  */
if|if
condition|(
name|value
operator|>
literal|15
operator|||
name|value
operator|<
operator|-
literal|1
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xF
expr_stmt|;
name|value
operator|<<=
literal|4
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_8
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_16
case|:
comment|/* word2.  */
if|if
condition|(
name|value
operator|>
literal|32767
operator|||
name|value
operator|<
operator|-
literal|32768
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFFFF
expr_stmt|;
name|sword
operator|=
name|value
expr_stmt|;
name|bfd_put_16
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|sword
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_20
case|:
comment|/* word1(0-3),word2.  */
if|if
condition|(
name|value
operator|>
literal|1048575
operator|||
name|value
operator|<
literal|0
condition|)
return|return
name|bfd_reloc_overflow
return|;
name|value
operator|&=
literal|0xFFFFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0x000F0000
operator|)
operator|>>
literal|16
operator|)
expr_stmt|;
name|value
operator||=
name|left_val
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
case|case
name|R_S_16C_32
case|:
comment|/* word2, word3.  */
name|value
operator|&=
literal|0xFFFFFFFF
expr_stmt|;
name|value
operator|=
operator|(
operator|(
name|value
operator|&
literal|0x0000FFFF
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|value
operator|&
literal|0xFFFF0000
operator|)
operator|>>
literal|16
operator|)
expr_stmt|;
name|bfd_put_32
argument_list|(
name|abfd
argument_list|,
operator|(
name|bfd_vma
operator|)
name|value
argument_list|,
operator|(
name|bfd_byte
operator|*
operator|)
name|data
operator|+
name|octets
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
break|break;
default|default:
return|return
name|bfd_reloc_notsupported
return|;
block|}
return|return
name|bfd_reloc_ok
return|;
block|}
end_function

begin_comment
comment|/* Relocate a CR16C ELF section.  */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|elf32_cr16c_relocate_section
parameter_list|(
name|bfd
modifier|*
name|output_bfd
parameter_list|,
name|struct
name|bfd_link_info
modifier|*
name|info
parameter_list|,
name|bfd
modifier|*
name|input_bfd
parameter_list|,
name|asection
modifier|*
name|input_section
parameter_list|,
name|bfd_byte
modifier|*
name|contents
parameter_list|,
name|Elf_Internal_Rela
modifier|*
name|relocs
parameter_list|,
name|Elf_Internal_Sym
modifier|*
name|local_syms
parameter_list|,
name|asection
modifier|*
modifier|*
name|local_sections
parameter_list|)
block|{
name|Elf_Internal_Shdr
modifier|*
name|symtab_hdr
decl_stmt|;
name|struct
name|elf_link_hash_entry
modifier|*
modifier|*
name|sym_hashes
decl_stmt|;
name|Elf_Internal_Rela
modifier|*
name|rel
decl_stmt|,
modifier|*
name|relend
decl_stmt|;
name|symtab_hdr
operator|=
operator|&
name|elf_tdata
argument_list|(
name|input_bfd
argument_list|)
operator|->
name|symtab_hdr
expr_stmt|;
name|sym_hashes
operator|=
name|elf_sym_hashes
argument_list|(
name|input_bfd
argument_list|)
expr_stmt|;
name|rel
operator|=
name|relocs
expr_stmt|;
name|relend
operator|=
name|relocs
operator|+
name|input_section
operator|->
name|reloc_count
expr_stmt|;
for|for
control|(
init|;
name|rel
operator|<
name|relend
condition|;
name|rel
operator|++
control|)
block|{
name|int
name|r_type
decl_stmt|;
name|reloc_howto_type
modifier|*
name|howto
decl_stmt|;
name|unsigned
name|long
name|r_symndx
decl_stmt|;
name|Elf_Internal_Sym
modifier|*
name|sym
decl_stmt|;
name|asection
modifier|*
name|sec
decl_stmt|;
name|struct
name|elf_link_hash_entry
modifier|*
name|h
decl_stmt|;
name|bfd_vma
name|relocation
decl_stmt|;
name|bfd_reloc_status_type
name|r
decl_stmt|;
name|r_symndx
operator|=
name|ELF32_R_SYM
argument_list|(
name|rel
operator|->
name|r_info
argument_list|)
expr_stmt|;
name|r_type
operator|=
name|ELF32_R_TYPE
argument_list|(
name|rel
operator|->
name|r_info
argument_list|)
expr_stmt|;
name|howto
operator|=
name|elf_howto_table
operator|+
name|r_type
expr_stmt|;
name|h
operator|=
name|NULL
expr_stmt|;
name|sym
operator|=
name|NULL
expr_stmt|;
name|sec
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|r_symndx
operator|<
name|symtab_hdr
operator|->
name|sh_info
condition|)
block|{
name|sym
operator|=
name|local_syms
operator|+
name|r_symndx
expr_stmt|;
name|sec
operator|=
name|local_sections
index|[
name|r_symndx
index|]
expr_stmt|;
name|relocation
operator|=
name|_bfd_elf_rela_local_sym
argument_list|(
name|output_bfd
argument_list|,
name|sym
argument_list|,
operator|&
name|sec
argument_list|,
name|rel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|bfd_boolean
name|unresolved_reloc
decl_stmt|,
name|warned
decl_stmt|;
name|RELOC_FOR_GLOBAL_SYMBOL
argument_list|(
name|info
argument_list|,
name|input_bfd
argument_list|,
name|input_section
argument_list|,
name|rel
argument_list|,
name|r_symndx
argument_list|,
name|symtab_hdr
argument_list|,
name|sym_hashes
argument_list|,
name|h
argument_list|,
name|sec
argument_list|,
name|relocation
argument_list|,
name|unresolved_reloc
argument_list|,
name|warned
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sec
operator|!=
name|NULL
operator|&&
name|elf_discarded_section
argument_list|(
name|sec
argument_list|)
condition|)
block|{
comment|/* For relocs against symbols from removed linkonce sections, 	     or sections discarded by a linker script, we just want the 	     section contents zeroed.  Avoid any special processing.  */
name|_bfd_clear_contents
argument_list|(
name|howto
argument_list|,
name|input_bfd
argument_list|,
name|contents
operator|+
name|rel
operator|->
name|r_offset
argument_list|)
expr_stmt|;
name|rel
operator|->
name|r_info
operator|=
literal|0
expr_stmt|;
name|rel
operator|->
name|r_addend
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|info
operator|->
name|relocatable
condition|)
block|{
comment|/* This is a relocatable link.  We don't have to change 	     anything, unless the reloc is against a section symbol, 	     in which case we have to adjust according to where the 	     section symbol winds up in the output section.  */
if|if
condition|(
name|sym
operator|!=
name|NULL
operator|&&
name|ELF_ST_TYPE
argument_list|(
name|sym
operator|->
name|st_info
argument_list|)
operator|==
name|STT_SECTION
condition|)
name|rel
operator|->
name|r_addend
operator|+=
name|sec
operator|->
name|output_offset
expr_stmt|;
continue|continue;
block|}
name|r
operator|=
name|cr16c_elf_final_link_relocate
argument_list|(
name|howto
argument_list|,
name|input_bfd
argument_list|,
name|output_bfd
argument_list|,
name|input_section
argument_list|,
name|contents
argument_list|,
name|rel
operator|->
name|r_offset
argument_list|,
name|relocation
argument_list|,
name|rel
operator|->
name|r_addend
argument_list|,
name|info
argument_list|,
name|sec
argument_list|,
name|h
operator|==
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|!=
name|bfd_reloc_ok
condition|)
block|{
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
specifier|const
name|char
modifier|*
name|msg
init|=
operator|(
specifier|const
name|char
operator|*
operator|)
literal|0
decl_stmt|;
if|if
condition|(
name|h
operator|!=
name|NULL
condition|)
name|name
operator|=
name|h
operator|->
name|root
operator|.
name|root
operator|.
name|string
expr_stmt|;
else|else
block|{
name|name
operator|=
operator|(
name|bfd_elf_string_from_elf_section
argument_list|(
name|input_bfd
argument_list|,
name|symtab_hdr
operator|->
name|sh_link
argument_list|,
name|sym
operator|->
name|st_name
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
operator|||
operator|*
name|name
operator|==
literal|'\0'
condition|)
name|name
operator|=
name|bfd_section_name
argument_list|(
name|input_bfd
argument_list|,
name|sec
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|r
condition|)
block|{
case|case
name|bfd_reloc_overflow
case|:
if|if
condition|(
operator|!
operator|(
call|(
modifier|*
name|info
operator|->
name|callbacks
operator|->
name|reloc_overflow
call|)
argument_list|(
name|info
argument_list|,
operator|(
name|h
condition|?
operator|&
name|h
operator|->
name|root
else|:
name|NULL
operator|)
argument_list|,
name|name
argument_list|,
name|howto
operator|->
name|name
argument_list|,
operator|(
name|bfd_vma
operator|)
literal|0
argument_list|,
name|input_bfd
argument_list|,
name|input_section
argument_list|,
name|rel
operator|->
name|r_offset
argument_list|)
operator|)
condition|)
return|return
name|FALSE
return|;
break|break;
case|case
name|bfd_reloc_undefined
case|:
if|if
condition|(
operator|!
operator|(
call|(
modifier|*
name|info
operator|->
name|callbacks
operator|->
name|undefined_symbol
call|)
argument_list|(
name|info
argument_list|,
name|name
argument_list|,
name|input_bfd
argument_list|,
name|input_section
argument_list|,
name|rel
operator|->
name|r_offset
argument_list|,
name|TRUE
argument_list|)
operator|)
condition|)
return|return
name|FALSE
return|;
break|break;
case|case
name|bfd_reloc_outofrange
case|:
name|msg
operator|=
name|_
argument_list|(
literal|"internal error: out of range error"
argument_list|)
expr_stmt|;
goto|goto
name|common_error
goto|;
case|case
name|bfd_reloc_notsupported
case|:
name|msg
operator|=
name|_
argument_list|(
literal|"internal error: unsupported relocation error"
argument_list|)
expr_stmt|;
goto|goto
name|common_error
goto|;
case|case
name|bfd_reloc_dangerous
case|:
name|msg
operator|=
name|_
argument_list|(
literal|"internal error: dangerous error"
argument_list|)
expr_stmt|;
goto|goto
name|common_error
goto|;
default|default:
name|msg
operator|=
name|_
argument_list|(
literal|"internal error: unknown error"
argument_list|)
expr_stmt|;
comment|/* fall through */
name|common_error
label|:
if|if
condition|(
operator|!
operator|(
call|(
modifier|*
name|info
operator|->
name|callbacks
operator|->
name|warning
call|)
argument_list|(
name|info
argument_list|,
name|msg
argument_list|,
name|name
argument_list|,
name|input_bfd
argument_list|,
name|input_section
argument_list|,
name|rel
operator|->
name|r_offset
argument_list|)
operator|)
condition|)
return|return
name|FALSE
return|;
break|break;
block|}
block|}
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* CR16C ELF uses three common sections:    One is for default common symbols (placed in usual common section).    Second is for near common symbols (placed in "ncommon" section).    Third is for far common symbols (placed in "fcommon" section).    The following implementation is based on elf32-mips architecture */
end_comment

begin_decl_stmt
specifier|static
name|asection
name|cr16c_elf_fcom_section
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asymbol
name|cr16c_elf_fcom_symbol
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asymbol
modifier|*
name|cr16c_elf_fcom_symbol_ptr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asection
name|cr16c_elf_ncom_section
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asymbol
name|cr16c_elf_ncom_symbol
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asymbol
modifier|*
name|cr16c_elf_ncom_symbol_ptr
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Given a BFD section, try to locate the    corresponding ELF section index.  */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|elf32_cr16c_section_from_bfd_section
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|asection
modifier|*
name|sec
parameter_list|,
name|int
modifier|*
name|retval
parameter_list|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|bfd_get_section_name
argument_list|(
name|abfd
argument_list|,
name|sec
argument_list|)
argument_list|,
literal|".fcommon"
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|retval
operator|=
name|SHN_CR16C_FCOMMON
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|bfd_get_section_name
argument_list|(
name|abfd
argument_list|,
name|sec
argument_list|)
argument_list|,
literal|".ncommon"
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|retval
operator|=
name|SHN_CR16C_NCOMMON
expr_stmt|;
else|else
return|return
name|FALSE
return|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* Handle the special CR16C section numbers that a symbol may use.  */
end_comment

begin_function
specifier|static
name|void
name|elf32_cr16c_symbol_processing
parameter_list|(
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|asymbol
modifier|*
name|asym
parameter_list|)
block|{
name|elf_symbol_type
modifier|*
name|elfsym
init|=
operator|(
name|elf_symbol_type
operator|*
operator|)
name|asym
decl_stmt|;
name|unsigned
name|int
name|indx
decl_stmt|;
name|indx
operator|=
name|elfsym
operator|->
name|internal_elf_sym
operator|.
name|st_shndx
expr_stmt|;
switch|switch
condition|(
name|indx
condition|)
block|{
case|case
name|SHN_CR16C_FCOMMON
case|:
if|if
condition|(
name|cr16c_elf_fcom_section
operator|.
name|name
operator|==
name|NULL
condition|)
block|{
comment|/* Initialize the far common section.  */
name|cr16c_elf_fcom_section
operator|.
name|name
operator|=
literal|".fcommon"
expr_stmt|;
name|cr16c_elf_fcom_section
operator|.
name|flags
operator|=
name|SEC_IS_COMMON
operator||
name|SEC_ALLOC
expr_stmt|;
name|cr16c_elf_fcom_section
operator|.
name|output_section
operator|=
operator|&
name|cr16c_elf_fcom_section
expr_stmt|;
name|cr16c_elf_fcom_section
operator|.
name|symbol
operator|=
operator|&
name|cr16c_elf_fcom_symbol
expr_stmt|;
name|cr16c_elf_fcom_section
operator|.
name|symbol_ptr_ptr
operator|=
operator|&
name|cr16c_elf_fcom_symbol_ptr
expr_stmt|;
name|cr16c_elf_fcom_symbol
operator|.
name|name
operator|=
literal|".fcommon"
expr_stmt|;
name|cr16c_elf_fcom_symbol
operator|.
name|flags
operator|=
name|BSF_SECTION_SYM
expr_stmt|;
name|cr16c_elf_fcom_symbol
operator|.
name|section
operator|=
operator|&
name|cr16c_elf_fcom_section
expr_stmt|;
name|cr16c_elf_fcom_symbol_ptr
operator|=
operator|&
name|cr16c_elf_fcom_symbol
expr_stmt|;
block|}
name|asym
operator|->
name|section
operator|=
operator|&
name|cr16c_elf_fcom_section
expr_stmt|;
name|asym
operator|->
name|value
operator|=
name|elfsym
operator|->
name|internal_elf_sym
operator|.
name|st_size
expr_stmt|;
break|break;
case|case
name|SHN_CR16C_NCOMMON
case|:
if|if
condition|(
name|cr16c_elf_ncom_section
operator|.
name|name
operator|==
name|NULL
condition|)
block|{
comment|/* Initialize the far common section.  */
name|cr16c_elf_ncom_section
operator|.
name|name
operator|=
literal|".ncommon"
expr_stmt|;
name|cr16c_elf_ncom_section
operator|.
name|flags
operator|=
name|SEC_IS_COMMON
operator||
name|SEC_ALLOC
expr_stmt|;
name|cr16c_elf_ncom_section
operator|.
name|output_section
operator|=
operator|&
name|cr16c_elf_ncom_section
expr_stmt|;
name|cr16c_elf_ncom_section
operator|.
name|symbol
operator|=
operator|&
name|cr16c_elf_ncom_symbol
expr_stmt|;
name|cr16c_elf_ncom_section
operator|.
name|symbol_ptr_ptr
operator|=
operator|&
name|cr16c_elf_ncom_symbol_ptr
expr_stmt|;
name|cr16c_elf_ncom_symbol
operator|.
name|name
operator|=
literal|".ncommon"
expr_stmt|;
name|cr16c_elf_ncom_symbol
operator|.
name|flags
operator|=
name|BSF_SECTION_SYM
expr_stmt|;
name|cr16c_elf_ncom_symbol
operator|.
name|section
operator|=
operator|&
name|cr16c_elf_ncom_section
expr_stmt|;
name|cr16c_elf_ncom_symbol_ptr
operator|=
operator|&
name|cr16c_elf_ncom_symbol
expr_stmt|;
block|}
name|asym
operator|->
name|section
operator|=
operator|&
name|cr16c_elf_ncom_section
expr_stmt|;
name|asym
operator|->
name|value
operator|=
name|elfsym
operator|->
name|internal_elf_sym
operator|.
name|st_size
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/* Hook called by the linker routine which adds symbols from an object    file.  We must handle the special cr16c section numbers here.  */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|elf32_cr16c_add_symbol_hook
parameter_list|(
name|bfd
modifier|*
name|abfd
parameter_list|,
name|struct
name|bfd_link_info
modifier|*
name|info
name|ATTRIBUTE_UNUSED
parameter_list|,
name|Elf_Internal_Sym
modifier|*
name|sym
parameter_list|,
specifier|const
name|char
modifier|*
modifier|*
name|namep
name|ATTRIBUTE_UNUSED
parameter_list|,
name|flagword
modifier|*
name|flagsp
name|ATTRIBUTE_UNUSED
parameter_list|,
name|asection
modifier|*
modifier|*
name|secp
parameter_list|,
name|bfd_vma
modifier|*
name|valp
parameter_list|)
block|{
name|unsigned
name|int
name|indx
init|=
name|sym
operator|->
name|st_shndx
decl_stmt|;
switch|switch
condition|(
name|indx
condition|)
block|{
case|case
name|SHN_CR16C_FCOMMON
case|:
operator|*
name|secp
operator|=
name|bfd_make_section_old_way
argument_list|(
name|abfd
argument_list|,
literal|".fcommon"
argument_list|)
expr_stmt|;
operator|(
operator|*
name|secp
operator|)
operator|->
name|flags
operator||=
name|SEC_IS_COMMON
expr_stmt|;
operator|*
name|valp
operator|=
name|sym
operator|->
name|st_size
expr_stmt|;
break|break;
case|case
name|SHN_CR16C_NCOMMON
case|:
operator|*
name|secp
operator|=
name|bfd_make_section_old_way
argument_list|(
name|abfd
argument_list|,
literal|".ncommon"
argument_list|)
expr_stmt|;
operator|(
operator|*
name|secp
operator|)
operator|->
name|flags
operator||=
name|SEC_IS_COMMON
expr_stmt|;
operator|*
name|valp
operator|=
name|sym
operator|->
name|st_size
expr_stmt|;
break|break;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|bfd_boolean
name|elf32_cr16c_link_output_symbol_hook
parameter_list|(
name|struct
name|bfd_link_info
modifier|*
name|info
name|ATTRIBUTE_UNUSED
parameter_list|,
specifier|const
name|char
modifier|*
name|name
name|ATTRIBUTE_UNUSED
parameter_list|,
name|Elf_Internal_Sym
modifier|*
name|sym
parameter_list|,
name|asection
modifier|*
name|input_sec
parameter_list|,
name|struct
name|elf_link_hash_entry
modifier|*
name|h
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
comment|/* If we see a common symbol, which implies a relocatable link, then      if a symbol was in a special common section in an input file, mark      it as a special common in the output file.  */
if|if
condition|(
name|sym
operator|->
name|st_shndx
operator|==
name|SHN_COMMON
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|input_sec
operator|->
name|name
argument_list|,
literal|".fcommon"
argument_list|)
operator|==
literal|0
condition|)
name|sym
operator|->
name|st_shndx
operator|=
name|SHN_CR16C_FCOMMON
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|input_sec
operator|->
name|name
argument_list|,
literal|".ncommon"
argument_list|)
operator|==
literal|0
condition|)
name|sym
operator|->
name|st_shndx
operator|=
name|SHN_CR16C_NCOMMON
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* Definitions for setting CR16C target vector.  */
end_comment

begin_define
define|#
directive|define
name|TARGET_LITTLE_SYM
value|bfd_elf32_cr16c_vec
end_define

begin_define
define|#
directive|define
name|TARGET_LITTLE_NAME
value|"elf32-cr16c"
end_define

begin_define
define|#
directive|define
name|ELF_ARCH
value|bfd_arch_cr16c
end_define

begin_define
define|#
directive|define
name|ELF_MACHINE_CODE
value|EM_CR
end_define

begin_define
define|#
directive|define
name|ELF_MAXPAGESIZE
value|0x1
end_define

begin_define
define|#
directive|define
name|elf_symbol_leading_char
value|'_'
end_define

begin_define
define|#
directive|define
name|bfd_elf32_bfd_reloc_type_lookup
value|elf_cr16c_reloc_type_lookup
end_define

begin_define
define|#
directive|define
name|bfd_elf32_bfd_reloc_name_lookup
value|elf_cr16c_reloc_name_lookup
end_define

begin_define
define|#
directive|define
name|elf_info_to_howto
value|elf_cr16c_info_to_howto
end_define

begin_define
define|#
directive|define
name|elf_info_to_howto_rel
value|elf_cr16c_info_to_howto_rel
end_define

begin_define
define|#
directive|define
name|elf_backend_relocate_section
value|elf32_cr16c_relocate_section
end_define

begin_define
define|#
directive|define
name|elf_backend_symbol_processing
value|elf32_cr16c_symbol_processing
end_define

begin_define
define|#
directive|define
name|elf_backend_section_from_bfd_section
value|elf32_cr16c_section_from_bfd_section
end_define

begin_define
define|#
directive|define
name|elf_backend_add_symbol_hook
value|elf32_cr16c_add_symbol_hook
end_define

begin_define
define|#
directive|define
name|elf_backend_link_output_symbol_hook
value|elf32_cr16c_link_output_symbol_hook
end_define

begin_define
define|#
directive|define
name|elf_backend_can_gc_sections
value|1
end_define

begin_include
include|#
directive|include
file|"elf32-target.h"
end_include

end_unit

