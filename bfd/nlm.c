begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* NLM (NetWare Loadable Module) executable support for BFD.    Copyright 1993, 1994, 2001, 2002, 2003, 2005    Free Software Foundation, Inc.     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"libnlm.h"
end_include

begin_comment
comment|/* Make an NLM object.  We just need to allocate the backend    information.  */
end_comment

begin_function
name|bfd_boolean
name|nlm_mkobject
parameter_list|(
name|bfd
modifier|*
name|abfd
parameter_list|)
block|{
name|bfd_size_type
name|amt
init|=
sizeof|sizeof
argument_list|(
expr|struct
name|nlm_obj_tdata
argument_list|)
decl_stmt|;
name|nlm_tdata
argument_list|(
name|abfd
argument_list|)
operator|=
name|bfd_zalloc
argument_list|(
name|abfd
argument_list|,
name|amt
argument_list|)
expr_stmt|;
if|if
condition|(
name|nlm_tdata
argument_list|(
name|abfd
argument_list|)
operator|==
name|NULL
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|nlm_architecture
argument_list|(
name|abfd
argument_list|)
operator|!=
name|bfd_arch_unknown
condition|)
name|bfd_default_set_arch_mach
argument_list|(
name|abfd
argument_list|,
name|nlm_architecture
argument_list|(
name|abfd
argument_list|)
argument_list|,
name|nlm_machine
argument_list|(
name|abfd
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Since everything is done at close time, do we need any initialization ?  */
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* Set the architecture and machine for an NLM object.  */
end_comment

begin_function
name|bfd_boolean
name|nlm_set_arch_mach
parameter_list|(
name|bfd
modifier|*
name|abfd
parameter_list|,
name|enum
name|bfd_architecture
name|arch
parameter_list|,
name|unsigned
name|long
name|machine
parameter_list|)
block|{
name|bfd_default_set_arch_mach
argument_list|(
name|abfd
argument_list|,
name|arch
argument_list|,
name|machine
argument_list|)
expr_stmt|;
return|return
name|arch
operator|==
name|nlm_architecture
argument_list|(
name|abfd
argument_list|)
return|;
block|}
end_function

end_unit

