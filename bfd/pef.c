begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* PEF support for BFD.    Copyright 1999, 2000, 2001, 2002, 2003    Free Software Foundation, Inc.     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"safe-ctype.h"
end_include

begin_include
include|#
directive|include
file|"pef.h"
end_include

begin_include
include|#
directive|include
file|"pef-traceback.h"
end_include

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"libiberty.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|BFD_IO_FUNCS
end_ifndef

begin_define
define|#
directive|define
name|BFD_IO_FUNCS
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
define|#
directive|define
name|bfd_pef_close_and_cleanup
value|_bfd_generic_close_and_cleanup
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_free_cached_info
value|_bfd_generic_bfd_free_cached_info
end_define

begin_define
define|#
directive|define
name|bfd_pef_new_section_hook
value|_bfd_generic_new_section_hook
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_is_local_label_name
value|bfd_generic_is_local_label_name
end_define

begin_define
define|#
directive|define
name|bfd_pef_get_lineno
value|_bfd_nosymbols_get_lineno
end_define

begin_define
define|#
directive|define
name|bfd_pef_find_nearest_line
value|_bfd_nosymbols_find_nearest_line
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_make_debug_symbol
value|_bfd_nosymbols_bfd_make_debug_symbol
end_define

begin_define
define|#
directive|define
name|bfd_pef_read_minisymbols
value|_bfd_generic_read_minisymbols
end_define

begin_define
define|#
directive|define
name|bfd_pef_minisymbol_to_symbol
value|_bfd_generic_minisymbol_to_symbol
end_define

begin_define
define|#
directive|define
name|bfd_pef_get_reloc_upper_bound
value|_bfd_norelocs_get_reloc_upper_bound
end_define

begin_define
define|#
directive|define
name|bfd_pef_canonicalize_reloc
value|_bfd_norelocs_canonicalize_reloc
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_reloc_type_lookup
value|_bfd_norelocs_bfd_reloc_type_lookup
end_define

begin_define
define|#
directive|define
name|bfd_pef_set_arch_mach
value|_bfd_generic_set_arch_mach
end_define

begin_define
define|#
directive|define
name|bfd_pef_get_section_contents
value|_bfd_generic_get_section_contents
end_define

begin_define
define|#
directive|define
name|bfd_pef_set_section_contents
value|_bfd_generic_set_section_contents
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_get_relocated_section_contents
value|bfd_generic_get_relocated_section_contents
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_relax_section
value|bfd_generic_relax_section
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_gc_sections
value|bfd_generic_gc_sections
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_merge_sections
value|bfd_generic_merge_sections
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_discard_group
value|bfd_generic_discard_group
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_link_hash_table_create
value|_bfd_generic_link_hash_table_create
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_link_hash_table_free
value|_bfd_generic_link_hash_table_free
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_link_add_symbols
value|_bfd_generic_link_add_symbols
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_link_just_syms
value|_bfd_generic_link_just_syms
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_final_link
value|_bfd_generic_final_link
end_define

begin_define
define|#
directive|define
name|bfd_pef_bfd_link_split_section
value|_bfd_generic_link_split_section
end_define

begin_define
define|#
directive|define
name|bfd_pef_get_section_contents_in_window
value|_bfd_generic_get_section_contents_in_window
end_define

begin_decl_stmt
specifier|static
name|void
name|bfd_pef_print_symbol
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|PTR
operator|,
name|asymbol
operator|*
operator|,
name|bfd_print_symbol_type
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|bfd_pef_convert_architecture
name|PARAMS
argument_list|(
operator|(
name|unsigned
name|long
operator|,
expr|enum
name|bfd_architecture
operator|*
operator|,
name|unsigned
name|long
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bfd_boolean
name|bfd_pef_mkobject
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_parse_traceback_table
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asection
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|,
name|size_t
operator|,
name|size_t
operator|,
name|asymbol
operator|*
operator|,
name|FILE
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|char
modifier|*
name|bfd_pef_section_name
name|PARAMS
argument_list|(
operator|(
name|bfd_pef_section
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|unsigned
name|long
name|bfd_pef_section_flags
name|PARAMS
argument_list|(
operator|(
name|bfd_pef_section
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asection
modifier|*
name|bfd_pef_make_bfd_section
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_pef_section
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_read_header
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_pef_header
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|bfd_target
modifier|*
name|bfd_pef_object_p
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_parse_traceback_tables
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asection
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|,
name|size_t
operator|,
name|long
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_parse_function_stub
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|,
name|size_t
operator|,
name|unsigned
name|long
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_parse_function_stubs
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asection
operator|*
operator|,
name|unsigned
name|char
operator|*
operator|,
name|size_t
operator|,
name|unsigned
name|char
operator|*
operator|,
name|size_t
operator|,
name|unsigned
name|long
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|long
name|bfd_pef_parse_symbols
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|long
name|bfd_pef_count_symbols
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|long
name|bfd_pef_get_symtab_upper_bound
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|long
name|bfd_pef_canonicalize_symtab
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|asymbol
modifier|*
name|bfd_pef_make_empty_symbol
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|bfd_pef_get_symbol_info
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asymbol
operator|*
operator|,
name|symbol_info
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_sizeof_headers
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_boolean
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_xlib_read_header
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_pef_xlib_header
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|int
name|bfd_pef_xlib_scan
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_pef_xlib_header
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|bfd_target
modifier|*
name|bfd_pef_xlib_object_p
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|bfd_pef_print_symbol
parameter_list|(
name|abfd
parameter_list|,
name|afile
parameter_list|,
name|symbol
parameter_list|,
name|how
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|PTR
name|afile
decl_stmt|;
name|asymbol
modifier|*
name|symbol
decl_stmt|;
name|bfd_print_symbol_type
name|how
decl_stmt|;
block|{
name|FILE
modifier|*
name|file
init|=
operator|(
name|FILE
operator|*
operator|)
name|afile
decl_stmt|;
switch|switch
condition|(
name|how
condition|)
block|{
case|case
name|bfd_print_symbol_name
case|:
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"%s"
argument_list|,
name|symbol
operator|->
name|name
argument_list|)
expr_stmt|;
break|break;
default|default:
name|bfd_print_symbol_vandf
argument_list|(
name|abfd
argument_list|,
operator|(
name|PTR
operator|)
name|file
argument_list|,
name|symbol
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" %-5s %s"
argument_list|,
name|symbol
operator|->
name|section
operator|->
name|name
argument_list|,
name|symbol
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|symbol
operator|->
name|name
argument_list|,
literal|"__traceback_"
argument_list|,
name|strlen
argument_list|(
literal|"__traceback_"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
name|char
modifier|*
name|buf
init|=
name|alloca
argument_list|(
name|symbol
operator|->
name|udata
operator|.
name|i
argument_list|)
decl_stmt|;
name|size_t
name|offset
init|=
name|symbol
operator|->
name|value
operator|+
literal|4
decl_stmt|;
name|size_t
name|len
init|=
name|symbol
operator|->
name|udata
operator|.
name|i
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|bfd_get_section_contents
argument_list|(
name|abfd
argument_list|,
name|symbol
operator|->
name|section
argument_list|,
name|buf
argument_list|,
name|offset
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|ret
operator|=
name|bfd_pef_parse_traceback_table
argument_list|(
name|abfd
argument_list|,
name|symbol
operator|->
name|section
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" [ERROR]"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|bfd_pef_convert_architecture
parameter_list|(
name|architecture
parameter_list|,
name|type
parameter_list|,
name|subtype
parameter_list|)
name|unsigned
name|long
name|architecture
decl_stmt|;
name|enum
name|bfd_architecture
modifier|*
name|type
decl_stmt|;
name|unsigned
name|long
modifier|*
name|subtype
decl_stmt|;
block|{
specifier|const
name|unsigned
name|long
name|ARCH_POWERPC
init|=
literal|0x70777063
decl_stmt|;
comment|/* 'pwpc' */
specifier|const
name|unsigned
name|long
name|ARCH_M68K
init|=
literal|0x6d36386b
decl_stmt|;
comment|/* 'm68k' */
operator|*
name|subtype
operator|=
name|bfd_arch_unknown
expr_stmt|;
operator|*
name|type
operator|=
name|bfd_arch_unknown
expr_stmt|;
if|if
condition|(
name|architecture
operator|==
name|ARCH_POWERPC
condition|)
operator|*
name|type
operator|=
name|bfd_arch_powerpc
expr_stmt|;
elseif|else
if|if
condition|(
name|architecture
operator|==
name|ARCH_M68K
condition|)
operator|*
name|type
operator|=
name|bfd_arch_m68k
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bfd_boolean
name|bfd_pef_mkobject
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_parse_traceback_table
parameter_list|(
name|abfd
parameter_list|,
name|section
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|pos
parameter_list|,
name|sym
parameter_list|,
name|file
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asection
modifier|*
name|section
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|size_t
name|pos
decl_stmt|;
name|asymbol
modifier|*
name|sym
decl_stmt|;
name|FILE
modifier|*
name|file
decl_stmt|;
block|{
name|struct
name|traceback_table
name|table
decl_stmt|;
name|size_t
name|offset
decl_stmt|;
specifier|const
name|char
modifier|*
name|s
decl_stmt|;
name|asymbol
name|tmpsymbol
decl_stmt|;
if|if
condition|(
name|sym
operator|==
name|NULL
condition|)
name|sym
operator|=
operator|&
name|tmpsymbol
expr_stmt|;
name|sym
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
name|sym
operator|->
name|value
operator|=
literal|0
expr_stmt|;
name|sym
operator|->
name|the_bfd
operator|=
name|abfd
expr_stmt|;
name|sym
operator|->
name|section
operator|=
name|section
expr_stmt|;
name|sym
operator|->
name|flags
operator|=
literal|0
expr_stmt|;
name|sym
operator|->
name|udata
operator|.
name|i
operator|=
literal|0
expr_stmt|;
comment|/* memcpy is fine since all fields are unsigned char.  */
if|if
condition|(
operator|(
name|pos
operator|+
literal|8
operator|)
operator|>
name|len
condition|)
return|return
operator|-
literal|1
return|;
name|memcpy
argument_list|(
operator|&
name|table
argument_list|,
name|buf
operator|+
name|pos
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* Calling code relies on returned symbols having a name and      correct offset.  */
if|if
condition|(
operator|(
name|table
operator|.
name|lang
operator|!=
name|TB_C
operator|)
operator|&&
operator|(
name|table
operator|.
name|lang
operator|!=
name|TB_CPLUSPLUS
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
operator|(
name|table
operator|.
name|flags2
operator|&
name|TB_NAME_PRESENT
operator|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|!
name|table
operator|.
name|flags1
operator|&
name|TB_HAS_TBOFF
condition|)
return|return
operator|-
literal|1
return|;
name|offset
operator|=
literal|8
expr_stmt|;
if|if
condition|(
operator|(
name|table
operator|.
name|flags5
operator|&
name|TB_FLOATPARAMS
operator|)
operator|||
operator|(
name|table
operator|.
name|fixedparams
operator|)
condition|)
name|offset
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|table
operator|.
name|flags1
operator|&
name|TB_HAS_TBOFF
condition|)
block|{
name|struct
name|traceback_table_tboff
name|off
decl_stmt|;
if|if
condition|(
operator|(
name|pos
operator|+
name|offset
operator|+
literal|4
operator|)
operator|>
name|len
condition|)
return|return
operator|-
literal|1
return|;
name|off
operator|.
name|tb_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
name|pos
operator|+
name|offset
argument_list|)
expr_stmt|;
name|offset
operator|+=
literal|4
expr_stmt|;
comment|/* Need to subtract 4 because the offset includes the 0x0L 	 preceding the table.  */
if|if
condition|(
name|file
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" [offset = 0x%lx]"
argument_list|,
name|off
operator|.
name|tb_offset
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|file
operator|==
name|NULL
operator|)
operator|&&
operator|(
operator|(
name|off
operator|.
name|tb_offset
operator|+
literal|4
operator|)
operator|>
operator|(
name|pos
operator|+
name|offset
operator|)
operator|)
condition|)
return|return
operator|-
literal|1
return|;
name|sym
operator|->
name|value
operator|=
name|pos
operator|-
name|off
operator|.
name|tb_offset
operator|-
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|table
operator|.
name|flags2
operator|&
name|TB_INT_HNDL
condition|)
name|offset
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|table
operator|.
name|flags1
operator|&
name|TB_HAS_CTL
condition|)
block|{
name|struct
name|traceback_table_anchors
name|anchors
decl_stmt|;
if|if
condition|(
operator|(
name|pos
operator|+
name|offset
operator|+
literal|4
operator|)
operator|>
name|len
condition|)
return|return
operator|-
literal|1
return|;
name|anchors
operator|.
name|ctl_info
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
name|pos
operator|+
name|offset
argument_list|)
expr_stmt|;
name|offset
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|anchors
operator|.
name|ctl_info
operator|>
literal|1024
condition|)
return|return
operator|-
literal|1
return|;
name|offset
operator|+=
name|anchors
operator|.
name|ctl_info
operator|*
literal|4
expr_stmt|;
block|}
if|if
condition|(
name|table
operator|.
name|flags2
operator|&
name|TB_NAME_PRESENT
condition|)
block|{
name|struct
name|traceback_table_routine
name|name
decl_stmt|;
name|char
modifier|*
name|namebuf
decl_stmt|;
if|if
condition|(
operator|(
name|pos
operator|+
name|offset
operator|+
literal|2
operator|)
operator|>
name|len
condition|)
return|return
operator|-
literal|1
return|;
name|name
operator|.
name|name_len
operator|=
name|bfd_getb16
argument_list|(
name|buf
operator|+
name|pos
operator|+
name|offset
argument_list|)
expr_stmt|;
name|offset
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|name
operator|.
name|name_len
operator|>
literal|4096
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|(
name|pos
operator|+
name|offset
operator|+
name|name
operator|.
name|name_len
operator|)
operator|>
name|len
condition|)
return|return
operator|-
literal|1
return|;
name|namebuf
operator|=
operator|(
name|char
operator|*
operator|)
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
name|name
operator|.
name|name_len
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|namebuf
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|memcpy
argument_list|(
name|namebuf
argument_list|,
name|buf
operator|+
name|pos
operator|+
name|offset
argument_list|,
name|name
operator|.
name|name_len
argument_list|)
expr_stmt|;
name|namebuf
index|[
name|name
operator|.
name|name_len
index|]
operator|=
literal|'\0'
expr_stmt|;
comment|/* Strip leading period inserted by compiler.  */
if|if
condition|(
name|namebuf
index|[
literal|0
index|]
operator|==
literal|'.'
condition|)
name|memmove
argument_list|(
name|namebuf
argument_list|,
name|namebuf
operator|+
literal|1
argument_list|,
name|name
operator|.
name|name_len
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sym
operator|->
name|name
operator|=
name|namebuf
expr_stmt|;
for|for
control|(
name|s
operator|=
name|sym
operator|->
name|name
init|;
operator|(
operator|*
name|s
operator|!=
literal|'\0'
operator|)
condition|;
name|s
operator|++
control|)
if|if
condition|(
operator|!
name|ISPRINT
argument_list|(
operator|*
name|s
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|offset
operator|+=
name|name
operator|.
name|name_len
expr_stmt|;
block|}
if|if
condition|(
name|table
operator|.
name|flags2
operator|&
name|TB_USES_ALLOCA
condition|)
name|offset
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|table
operator|.
name|flags4
operator|&
name|TB_HAS_VEC_INFO
condition|)
name|offset
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|file
operator|!=
name|NULL
condition|)
name|fprintf
argument_list|(
name|file
argument_list|,
literal|" [length = 0x%lx]"
argument_list|,
operator|(
name|long
operator|)
name|offset
argument_list|)
expr_stmt|;
return|return
name|offset
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
name|bfd_pef_section_name
parameter_list|(
name|section
parameter_list|)
name|bfd_pef_section
modifier|*
name|section
decl_stmt|;
block|{
switch|switch
condition|(
name|section
operator|->
name|section_kind
condition|)
block|{
case|case
name|BFD_PEF_SECTION_CODE
case|:
return|return
literal|"code"
return|;
case|case
name|BFD_PEF_SECTION_UNPACKED_DATA
case|:
return|return
literal|"unpacked-data"
return|;
case|case
name|BFD_PEF_SECTION_PACKED_DATA
case|:
return|return
literal|"packed-data"
return|;
case|case
name|BFD_PEF_SECTION_CONSTANT
case|:
return|return
literal|"constant"
return|;
case|case
name|BFD_PEF_SECTION_LOADER
case|:
return|return
literal|"loader"
return|;
case|case
name|BFD_PEF_SECTION_DEBUG
case|:
return|return
literal|"debug"
return|;
case|case
name|BFD_PEF_SECTION_EXEC_DATA
case|:
return|return
literal|"exec-data"
return|;
case|case
name|BFD_PEF_SECTION_EXCEPTION
case|:
return|return
literal|"exception"
return|;
case|case
name|BFD_PEF_SECTION_TRACEBACK
case|:
return|return
literal|"traceback"
return|;
default|default:
return|return
literal|"unknown"
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|unsigned
name|long
name|bfd_pef_section_flags
parameter_list|(
name|section
parameter_list|)
name|bfd_pef_section
modifier|*
name|section
decl_stmt|;
block|{
switch|switch
condition|(
name|section
operator|->
name|section_kind
condition|)
block|{
case|case
name|BFD_PEF_SECTION_CODE
case|:
return|return
name|SEC_HAS_CONTENTS
operator||
name|SEC_LOAD
operator||
name|SEC_ALLOC
operator||
name|SEC_CODE
return|;
case|case
name|BFD_PEF_SECTION_UNPACKED_DATA
case|:
case|case
name|BFD_PEF_SECTION_PACKED_DATA
case|:
case|case
name|BFD_PEF_SECTION_CONSTANT
case|:
case|case
name|BFD_PEF_SECTION_LOADER
case|:
case|case
name|BFD_PEF_SECTION_DEBUG
case|:
case|case
name|BFD_PEF_SECTION_EXEC_DATA
case|:
case|case
name|BFD_PEF_SECTION_EXCEPTION
case|:
case|case
name|BFD_PEF_SECTION_TRACEBACK
case|:
default|default:
return|return
name|SEC_HAS_CONTENTS
operator||
name|SEC_LOAD
operator||
name|SEC_ALLOC
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|asection
modifier|*
name|bfd_pef_make_bfd_section
parameter_list|(
name|abfd
parameter_list|,
name|section
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_section
modifier|*
name|section
decl_stmt|;
block|{
name|asection
modifier|*
name|bfdsec
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
init|=
name|bfd_pef_section_name
argument_list|(
name|section
argument_list|)
decl_stmt|;
name|bfdsec
operator|=
name|bfd_make_section_anyway
argument_list|(
name|abfd
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfdsec
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|bfdsec
operator|->
name|vma
operator|=
name|section
operator|->
name|default_address
operator|+
name|section
operator|->
name|container_offset
expr_stmt|;
name|bfdsec
operator|->
name|lma
operator|=
name|section
operator|->
name|default_address
operator|+
name|section
operator|->
name|container_offset
expr_stmt|;
name|bfdsec
operator|->
name|_raw_size
operator|=
name|section
operator|->
name|container_length
expr_stmt|;
name|bfdsec
operator|->
name|filepos
operator|=
name|section
operator|->
name|container_offset
expr_stmt|;
name|bfdsec
operator|->
name|alignment_power
operator|=
name|section
operator|->
name|alignment
expr_stmt|;
name|bfdsec
operator|->
name|flags
operator|=
name|bfd_pef_section_flags
argument_list|(
name|section
argument_list|)
expr_stmt|;
return|return
name|bfdsec
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_parse_loader_header
parameter_list|(
name|abfd
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|header
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|bfd_pef_loader_header
modifier|*
name|header
decl_stmt|;
block|{
name|BFD_ASSERT
argument_list|(
name|len
operator|==
literal|56
argument_list|)
expr_stmt|;
name|header
operator|->
name|main_section
operator|=
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|header
operator|->
name|main_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
expr_stmt|;
name|header
operator|->
name|init_section
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
expr_stmt|;
name|header
operator|->
name|init_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
name|header
operator|->
name|term_section
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
name|header
operator|->
name|term_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|20
argument_list|)
expr_stmt|;
name|header
operator|->
name|imported_library_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|24
argument_list|)
expr_stmt|;
name|header
operator|->
name|total_imported_symbol_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|28
argument_list|)
expr_stmt|;
name|header
operator|->
name|reloc_section_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|32
argument_list|)
expr_stmt|;
name|header
operator|->
name|reloc_instr_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|36
argument_list|)
expr_stmt|;
name|header
operator|->
name|loader_strings_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|40
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_hash_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|44
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_hash_table_power
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|48
argument_list|)
expr_stmt|;
name|header
operator|->
name|exported_symbol_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|52
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_parse_imported_library
parameter_list|(
name|abfd
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|header
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|bfd_pef_imported_library
modifier|*
name|header
decl_stmt|;
block|{
name|BFD_ASSERT
argument_list|(
name|len
operator|==
literal|24
argument_list|)
expr_stmt|;
name|header
operator|->
name|name_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|header
operator|->
name|old_implementation_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
expr_stmt|;
name|header
operator|->
name|current_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
expr_stmt|;
name|header
operator|->
name|imported_symbol_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
name|header
operator|->
name|first_imported_symbol
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
name|header
operator|->
name|options
operator|=
name|buf
index|[
literal|20
index|]
expr_stmt|;
name|header
operator|->
name|reserved_a
operator|=
name|buf
index|[
literal|21
index|]
expr_stmt|;
name|header
operator|->
name|reserved_b
operator|=
name|bfd_getb16
argument_list|(
name|buf
operator|+
literal|22
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_parse_imported_symbol
parameter_list|(
name|abfd
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|symbol
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|bfd_pef_imported_symbol
modifier|*
name|symbol
decl_stmt|;
block|{
name|unsigned
name|long
name|value
decl_stmt|;
name|BFD_ASSERT
argument_list|(
name|len
operator|==
literal|4
argument_list|)
expr_stmt|;
name|value
operator|=
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|symbol
operator|->
name|class
operator|=
name|value
operator|>>
literal|24
expr_stmt|;
name|symbol
operator|->
name|name
operator|=
name|value
operator|&
literal|0x00ffffff
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_scan_section
parameter_list|(
name|abfd
parameter_list|,
name|section
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_section
modifier|*
name|section
decl_stmt|;
block|{
name|unsigned
name|char
name|buf
index|[
literal|28
index|]
decl_stmt|;
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
name|section
operator|->
name|header_offset
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|buf
argument_list|,
literal|28
argument_list|,
name|abfd
argument_list|)
operator|!=
literal|28
condition|)
return|return
operator|-
literal|1
return|;
name|section
operator|->
name|name_offset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|section
operator|->
name|default_address
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
operator|+
literal|4
argument_list|)
expr_stmt|;
name|section
operator|->
name|total_length
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
operator|+
literal|8
argument_list|)
expr_stmt|;
name|section
operator|->
name|unpacked_length
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
name|section
operator|->
name|container_length
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
name|section
operator|->
name|container_offset
operator|=
name|bfd_h_get_32
argument_list|(
name|abfd
argument_list|,
name|buf
operator|+
literal|20
argument_list|)
expr_stmt|;
name|section
operator|->
name|section_kind
operator|=
name|buf
index|[
literal|24
index|]
expr_stmt|;
name|section
operator|->
name|share_kind
operator|=
name|buf
index|[
literal|25
index|]
expr_stmt|;
name|section
operator|->
name|alignment
operator|=
name|buf
index|[
literal|26
index|]
expr_stmt|;
name|section
operator|->
name|reserved
operator|=
name|buf
index|[
literal|27
index|]
expr_stmt|;
name|section
operator|->
name|bfd_section
operator|=
name|bfd_pef_make_bfd_section
argument_list|(
name|abfd
argument_list|,
name|section
argument_list|)
expr_stmt|;
if|if
condition|(
name|section
operator|->
name|bfd_section
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
name|bfd_pef_print_loader_header
parameter_list|(
name|abfd
parameter_list|,
name|header
parameter_list|,
name|file
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_pef_loader_header
modifier|*
name|header
decl_stmt|;
name|FILE
modifier|*
name|file
decl_stmt|;
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"main_section: %ld\n"
argument_list|,
name|header
operator|->
name|main_section
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"main_offset: %lu\n"
argument_list|,
name|header
operator|->
name|main_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"init_section: %ld\n"
argument_list|,
name|header
operator|->
name|init_section
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"init_offset: %lu\n"
argument_list|,
name|header
operator|->
name|init_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"term_section: %ld\n"
argument_list|,
name|header
operator|->
name|term_section
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"term_offset: %lu\n"
argument_list|,
name|header
operator|->
name|term_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"imported_library_count: %lu\n"
argument_list|,
name|header
operator|->
name|imported_library_count
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"total_imported_symbol_count: %lu\n"
argument_list|,
name|header
operator|->
name|total_imported_symbol_count
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"reloc_section_count: %lu\n"
argument_list|,
name|header
operator|->
name|reloc_section_count
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"reloc_instr_offset: %lu\n"
argument_list|,
name|header
operator|->
name|reloc_instr_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"loader_strings_offset: %lu\n"
argument_list|,
name|header
operator|->
name|loader_strings_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"export_hash_offset: %lu\n"
argument_list|,
name|header
operator|->
name|export_hash_offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"export_hash_table_power: %lu\n"
argument_list|,
name|header
operator|->
name|export_hash_table_power
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"exported_symbol_count: %lu\n"
argument_list|,
name|header
operator|->
name|exported_symbol_count
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|bfd_pef_print_loader_section
parameter_list|(
name|abfd
parameter_list|,
name|file
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|FILE
modifier|*
name|file
decl_stmt|;
block|{
name|bfd_pef_loader_header
name|header
decl_stmt|;
name|asection
modifier|*
name|loadersec
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|loaderbuf
init|=
name|NULL
decl_stmt|;
name|size_t
name|loaderlen
init|=
literal|0
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|loadersec
operator|=
name|bfd_get_section_by_name
argument_list|(
name|abfd
argument_list|,
literal|"loader"
argument_list|)
expr_stmt|;
if|if
condition|(
name|loadersec
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|loaderlen
operator|=
name|bfd_section_size
argument_list|(
name|abfd
argument_list|,
name|loadersec
argument_list|)
expr_stmt|;
name|loaderbuf
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|loaderlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
name|loadersec
operator|->
name|filepos
argument_list|,
name|SEEK_SET
argument_list|)
operator|<
literal|0
condition|)
block|{
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|loaderbuf
argument_list|,
name|loaderlen
argument_list|,
name|abfd
argument_list|)
operator|!=
name|loaderlen
condition|)
block|{
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|loaderlen
operator|<
literal|56
condition|)
block|{
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ret
operator|=
name|bfd_pef_parse_loader_header
argument_list|(
name|abfd
argument_list|,
name|loaderbuf
argument_list|,
literal|56
argument_list|,
operator|&
name|header
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|bfd_pef_print_loader_header
argument_list|(
name|abfd
argument_list|,
operator|&
name|header
argument_list|,
name|file
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_scan_start_address
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
name|bfd_pef_loader_header
name|header
decl_stmt|;
name|asection
modifier|*
name|section
decl_stmt|;
name|asection
modifier|*
name|loadersec
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|loaderbuf
init|=
name|NULL
decl_stmt|;
name|size_t
name|loaderlen
init|=
literal|0
decl_stmt|;
name|int
name|ret
decl_stmt|;
name|loadersec
operator|=
name|bfd_get_section_by_name
argument_list|(
name|abfd
argument_list|,
literal|"loader"
argument_list|)
expr_stmt|;
if|if
condition|(
name|loadersec
operator|==
name|NULL
condition|)
goto|goto
name|end
goto|;
name|loaderlen
operator|=
name|bfd_section_size
argument_list|(
name|abfd
argument_list|,
name|loadersec
argument_list|)
expr_stmt|;
name|loaderbuf
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|loaderlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
name|loadersec
operator|->
name|filepos
argument_list|,
name|SEEK_SET
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|loaderbuf
argument_list|,
name|loaderlen
argument_list|,
name|abfd
argument_list|)
operator|!=
name|loaderlen
condition|)
goto|goto
name|error
goto|;
if|if
condition|(
name|loaderlen
operator|<
literal|56
condition|)
goto|goto
name|error
goto|;
name|ret
operator|=
name|bfd_pef_parse_loader_header
argument_list|(
name|abfd
argument_list|,
name|loaderbuf
argument_list|,
literal|56
argument_list|,
operator|&
name|header
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
if|if
condition|(
name|header
operator|.
name|main_section
operator|<
literal|0
condition|)
goto|goto
name|end
goto|;
for|for
control|(
name|section
operator|=
name|abfd
operator|->
name|sections
init|;
name|section
operator|!=
name|NULL
condition|;
name|section
operator|=
name|section
operator|->
name|next
control|)
if|if
condition|(
operator|(
name|section
operator|->
name|index
operator|+
literal|1
operator|)
operator|==
name|header
operator|.
name|main_section
condition|)
break|break;
if|if
condition|(
name|section
operator|==
name|NULL
condition|)
goto|goto
name|error
goto|;
name|abfd
operator|->
name|start_address
operator|=
name|section
operator|->
name|vma
operator|+
name|header
operator|.
name|main_offset
expr_stmt|;
name|end
label|:
if|if
condition|(
name|loaderbuf
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
name|error
label|:
if|if
condition|(
name|loaderbuf
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_scan
parameter_list|(
name|abfd
parameter_list|,
name|header
parameter_list|,
name|mdata
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_header
modifier|*
name|header
decl_stmt|;
name|bfd_pef_data_struct
modifier|*
name|mdata
decl_stmt|;
block|{
name|unsigned
name|int
name|i
decl_stmt|;
name|enum
name|bfd_architecture
name|cputype
decl_stmt|;
name|unsigned
name|long
name|cpusubtype
decl_stmt|;
name|mdata
operator|->
name|header
operator|=
operator|*
name|header
expr_stmt|;
name|bfd_pef_convert_architecture
argument_list|(
name|header
operator|->
name|architecture
argument_list|,
operator|&
name|cputype
argument_list|,
operator|&
name|cpusubtype
argument_list|)
expr_stmt|;
if|if
condition|(
name|cputype
operator|==
name|bfd_arch_unknown
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"bfd_pef_scan: unknown architecture 0x%lx\n"
argument_list|,
name|header
operator|->
name|architecture
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|bfd_set_arch_mach
argument_list|(
name|abfd
argument_list|,
name|cputype
argument_list|,
name|cpusubtype
argument_list|)
expr_stmt|;
name|mdata
operator|->
name|header
operator|=
operator|*
name|header
expr_stmt|;
name|abfd
operator|->
name|flags
operator|=
operator|(
name|abfd
operator|->
name|xvec
operator|->
name|object_flags
operator||
operator|(
name|abfd
operator|->
name|flags
operator|&
operator|(
name|BFD_IN_MEMORY
operator||
name|BFD_IO_FUNCS
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|header
operator|->
name|section_count
operator|!=
literal|0
condition|)
block|{
name|mdata
operator|->
name|sections
operator|=
operator|(
operator|(
name|bfd_pef_section
operator|*
operator|)
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
name|header
operator|->
name|section_count
operator|*
sizeof|sizeof
argument_list|(
name|bfd_pef_section
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|mdata
operator|->
name|sections
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|header
operator|->
name|section_count
condition|;
name|i
operator|++
control|)
block|{
name|bfd_pef_section
modifier|*
name|cur
init|=
operator|&
name|mdata
operator|->
name|sections
index|[
name|i
index|]
decl_stmt|;
name|cur
operator|->
name|header_offset
operator|=
literal|40
operator|+
operator|(
name|i
operator|*
literal|28
operator|)
expr_stmt|;
if|if
condition|(
name|bfd_pef_scan_section
argument_list|(
name|abfd
argument_list|,
name|cur
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|bfd_pef_scan_start_address
argument_list|(
name|abfd
argument_list|)
operator|<
literal|0
condition|)
block|{
if|#
directive|if
literal|0
block|fprintf (stderr, "bfd_pef_scan: unable to scan start address: %s\n", 	       bfd_errmsg (bfd_get_error ()));       return -1;
endif|#
directive|endif
block|}
name|abfd
operator|->
name|tdata
operator|.
name|pef_data
operator|=
name|mdata
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_read_header
parameter_list|(
name|abfd
parameter_list|,
name|header
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_header
modifier|*
name|header
decl_stmt|;
block|{
name|unsigned
name|char
name|buf
index|[
literal|40
index|]
decl_stmt|;
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|buf
argument_list|,
literal|40
argument_list|,
name|abfd
argument_list|)
operator|!=
literal|40
condition|)
return|return
operator|-
literal|1
return|;
name|header
operator|->
name|tag1
operator|=
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|header
operator|->
name|tag2
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
expr_stmt|;
name|header
operator|->
name|architecture
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
expr_stmt|;
name|header
operator|->
name|format_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
name|header
operator|->
name|timestamp
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
name|header
operator|->
name|old_definition_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|20
argument_list|)
expr_stmt|;
name|header
operator|->
name|old_implementation_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|24
argument_list|)
expr_stmt|;
name|header
operator|->
name|current_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|28
argument_list|)
expr_stmt|;
name|header
operator|->
name|section_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|32
argument_list|)
operator|+
literal|1
expr_stmt|;
name|header
operator|->
name|instantiated_section_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|34
argument_list|)
expr_stmt|;
name|header
operator|->
name|reserved
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|36
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|bfd_target
modifier|*
name|bfd_pef_object_p
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
name|struct
name|bfd_preserve
name|preserve
decl_stmt|;
name|bfd_pef_header
name|header
decl_stmt|;
name|preserve
operator|.
name|marker
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|bfd_pef_read_header
argument_list|(
name|abfd
argument_list|,
operator|&
name|header
argument_list|)
operator|!=
literal|0
condition|)
goto|goto
name|wrong
goto|;
if|if
condition|(
name|header
operator|.
name|tag1
operator|!=
name|BFD_PEF_TAG1
operator|||
name|header
operator|.
name|tag2
operator|!=
name|BFD_PEF_TAG2
condition|)
goto|goto
name|wrong
goto|;
name|preserve
operator|.
name|marker
operator|=
name|bfd_zalloc
argument_list|(
name|abfd
argument_list|,
sizeof|sizeof
argument_list|(
name|bfd_pef_data_struct
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|preserve
operator|.
name|marker
operator|==
name|NULL
operator|||
operator|!
name|bfd_preserve_save
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
condition|)
goto|goto
name|fail
goto|;
if|if
condition|(
name|bfd_pef_scan
argument_list|(
name|abfd
argument_list|,
operator|&
name|header
argument_list|,
operator|(
name|bfd_pef_data_struct
operator|*
operator|)
name|preserve
operator|.
name|marker
argument_list|)
operator|!=
literal|0
condition|)
goto|goto
name|wrong
goto|;
name|bfd_preserve_finish
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
expr_stmt|;
return|return
name|abfd
operator|->
name|xvec
return|;
name|wrong
label|:
name|bfd_set_error
argument_list|(
name|bfd_error_wrong_format
argument_list|)
expr_stmt|;
name|fail
label|:
if|if
condition|(
name|preserve
operator|.
name|marker
operator|!=
name|NULL
condition|)
name|bfd_preserve_restore
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_parse_traceback_tables
parameter_list|(
name|abfd
parameter_list|,
name|sec
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|nsym
parameter_list|,
name|csym
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asection
modifier|*
name|sec
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|long
modifier|*
name|nsym
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|csym
decl_stmt|;
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|asymbol
name|function
decl_stmt|;
name|asymbol
name|traceback
decl_stmt|;
specifier|const
name|char
modifier|*
specifier|const
name|tbprefix
init|=
literal|"__traceback_"
decl_stmt|;
name|size_t
name|tbnamelen
decl_stmt|;
name|size_t
name|pos
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|count
init|=
literal|0
decl_stmt|;
name|int
name|ret
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
comment|/* We're reading symbols two at a time.  */
if|if
condition|(
name|csym
operator|&&
operator|(
operator|(
name|csym
index|[
name|count
index|]
operator|==
name|NULL
operator|)
operator|||
operator|(
name|csym
index|[
name|count
operator|+
literal|1
index|]
operator|==
name|NULL
operator|)
operator|)
condition|)
break|break;
name|pos
operator|+=
literal|3
expr_stmt|;
name|pos
operator|-=
operator|(
name|pos
operator|%
literal|4
operator|)
expr_stmt|;
while|while
condition|(
operator|(
name|pos
operator|+
literal|4
operator|)
operator|<=
name|len
condition|)
block|{
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
name|pos
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|pos
operator|+=
literal|4
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|pos
operator|+
literal|4
operator|)
operator|>
name|len
condition|)
break|break;
name|ret
operator|=
name|bfd_pef_parse_traceback_table
argument_list|(
name|abfd
argument_list|,
name|sec
argument_list|,
name|buf
argument_list|,
name|len
argument_list|,
name|pos
operator|+
literal|4
argument_list|,
operator|&
name|function
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
comment|/* Skip over 0x0L to advance to next possible traceback table.  */
name|pos
operator|+=
literal|4
expr_stmt|;
continue|continue;
block|}
name|BFD_ASSERT
argument_list|(
name|function
operator|.
name|name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Don't bother to compute the name if we are just 	 counting symbols.  */
if|if
condition|(
name|csym
condition|)
block|{
name|tbnamelen
operator|=
name|strlen
argument_list|(
name|tbprefix
argument_list|)
operator|+
name|strlen
argument_list|(
name|function
operator|.
name|name
argument_list|)
expr_stmt|;
name|name
operator|=
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
name|tbnamelen
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
block|{
name|bfd_release
argument_list|(
name|abfd
argument_list|,
operator|(
name|PTR
operator|)
name|function
operator|.
name|name
argument_list|)
expr_stmt|;
name|function
operator|.
name|name
operator|=
name|NULL
expr_stmt|;
break|break;
block|}
name|snprintf
argument_list|(
name|name
argument_list|,
name|tbnamelen
operator|+
literal|1
argument_list|,
literal|"%s%s"
argument_list|,
name|tbprefix
argument_list|,
name|function
operator|.
name|name
argument_list|)
expr_stmt|;
name|traceback
operator|.
name|name
operator|=
name|name
expr_stmt|;
name|traceback
operator|.
name|value
operator|=
name|pos
expr_stmt|;
name|traceback
operator|.
name|the_bfd
operator|=
name|abfd
expr_stmt|;
name|traceback
operator|.
name|section
operator|=
name|sec
expr_stmt|;
name|traceback
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|traceback
operator|.
name|udata
operator|.
name|i
operator|=
name|ret
expr_stmt|;
operator|*
operator|(
name|csym
index|[
name|count
index|]
operator|)
operator|=
name|function
expr_stmt|;
operator|*
operator|(
name|csym
index|[
name|count
operator|+
literal|1
index|]
operator|)
operator|=
name|traceback
expr_stmt|;
block|}
name|pos
operator|+=
name|ret
expr_stmt|;
name|count
operator|+=
literal|2
expr_stmt|;
block|}
operator|*
name|nsym
operator|=
name|count
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_parse_function_stub
parameter_list|(
name|abfd
parameter_list|,
name|buf
parameter_list|,
name|len
parameter_list|,
name|offset
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|unsigned
name|char
modifier|*
name|buf
decl_stmt|;
name|size_t
name|len
decl_stmt|;
name|unsigned
name|long
modifier|*
name|offset
decl_stmt|;
block|{
name|BFD_ASSERT
argument_list|(
name|len
operator|==
literal|24
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
operator|&
literal|0xffff0000
operator|)
operator|!=
literal|0x81820000
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
operator|!=
literal|0x90410014
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
operator|!=
literal|0x800c0000
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
operator|!=
literal|0x804c0004
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
operator|!=
literal|0x7c0903a6
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|20
argument_list|)
operator|!=
literal|0x4e800420
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|offset
operator|!=
name|NULL
condition|)
operator|*
name|offset
operator|=
operator|(
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
operator|&
literal|0x0000ffff
operator|)
operator|/
literal|4
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_parse_function_stubs
parameter_list|(
name|abfd
parameter_list|,
name|codesec
parameter_list|,
name|codebuf
parameter_list|,
name|codelen
parameter_list|,
name|loaderbuf
parameter_list|,
name|loaderlen
parameter_list|,
name|nsym
parameter_list|,
name|csym
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asection
modifier|*
name|codesec
decl_stmt|;
name|unsigned
name|char
modifier|*
name|codebuf
decl_stmt|;
name|size_t
name|codelen
decl_stmt|;
name|unsigned
name|char
modifier|*
name|loaderbuf
decl_stmt|;
name|size_t
name|loaderlen
decl_stmt|;
name|unsigned
name|long
modifier|*
name|nsym
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|csym
decl_stmt|;
block|{
specifier|const
name|char
modifier|*
specifier|const
name|sprefix
init|=
literal|"__stub_"
decl_stmt|;
name|size_t
name|codepos
init|=
literal|0
decl_stmt|;
name|unsigned
name|long
name|count
init|=
literal|0
decl_stmt|;
name|bfd_pef_loader_header
name|header
decl_stmt|;
name|bfd_pef_imported_library
modifier|*
name|libraries
init|=
name|NULL
decl_stmt|;
name|bfd_pef_imported_symbol
modifier|*
name|imports
init|=
name|NULL
decl_stmt|;
name|unsigned
name|long
name|i
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|loaderlen
operator|<
literal|56
condition|)
goto|goto
name|error
goto|;
name|ret
operator|=
name|bfd_pef_parse_loader_header
argument_list|(
name|abfd
argument_list|,
name|loaderbuf
argument_list|,
literal|56
argument_list|,
operator|&
name|header
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
name|libraries
operator|=
operator|(
name|bfd_pef_imported_library
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|header
operator|.
name|imported_library_count
operator|*
sizeof|sizeof
argument_list|(
name|bfd_pef_imported_library
argument_list|)
argument_list|)
expr_stmt|;
name|imports
operator|=
operator|(
name|bfd_pef_imported_symbol
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|header
operator|.
name|total_imported_symbol_count
operator|*
sizeof|sizeof
argument_list|(
name|bfd_pef_imported_symbol
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|loaderlen
operator|<
operator|(
literal|56
operator|+
operator|(
name|header
operator|.
name|imported_library_count
operator|*
literal|24
operator|)
operator|)
condition|)
goto|goto
name|error
goto|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|header
operator|.
name|imported_library_count
condition|;
name|i
operator|++
control|)
block|{
name|ret
operator|=
name|bfd_pef_parse_imported_library
argument_list|(
name|abfd
argument_list|,
name|loaderbuf
operator|+
literal|56
operator|+
operator|(
name|i
operator|*
literal|24
operator|)
argument_list|,
literal|24
argument_list|,
operator|&
name|libraries
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
block|}
if|if
condition|(
name|loaderlen
operator|<
operator|(
literal|56
operator|+
operator|(
name|header
operator|.
name|imported_library_count
operator|*
literal|24
operator|)
operator|+
operator|(
name|header
operator|.
name|total_imported_symbol_count
operator|*
literal|4
operator|)
operator|)
condition|)
goto|goto
name|error
goto|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|header
operator|.
name|total_imported_symbol_count
condition|;
name|i
operator|++
control|)
block|{
name|ret
operator|=
operator|(
name|bfd_pef_parse_imported_symbol
argument_list|(
name|abfd
argument_list|,
name|loaderbuf
operator|+
literal|56
operator|+
operator|(
name|header
operator|.
name|imported_library_count
operator|*
literal|24
operator|)
operator|+
operator|(
name|i
operator|*
literal|4
operator|)
argument_list|,
literal|4
argument_list|,
operator|&
name|imports
index|[
name|i
index|]
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
goto|goto
name|error
goto|;
block|}
name|codepos
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|asymbol
name|sym
decl_stmt|;
specifier|const
name|char
modifier|*
name|symname
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|long
name|index
decl_stmt|;
name|int
name|ret
decl_stmt|;
if|if
condition|(
name|csym
operator|&&
operator|(
name|csym
index|[
name|count
index|]
operator|==
name|NULL
operator|)
condition|)
break|break;
name|codepos
operator|+=
literal|3
expr_stmt|;
name|codepos
operator|-=
operator|(
name|codepos
operator|%
literal|4
operator|)
expr_stmt|;
while|while
condition|(
operator|(
name|codepos
operator|+
literal|4
operator|)
operator|<=
name|codelen
condition|)
block|{
if|if
condition|(
operator|(
name|bfd_getb32
argument_list|(
name|codebuf
operator|+
name|codepos
argument_list|)
operator|&
literal|0xffff0000
operator|)
operator|==
literal|0x81820000
condition|)
break|break;
name|codepos
operator|+=
literal|4
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|codepos
operator|+
literal|4
operator|)
operator|>
name|codelen
condition|)
break|break;
name|ret
operator|=
name|bfd_pef_parse_function_stub
argument_list|(
name|abfd
argument_list|,
name|codebuf
operator|+
name|codepos
argument_list|,
literal|24
argument_list|,
operator|&
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|<
literal|0
condition|)
block|{
name|codepos
operator|+=
literal|24
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|index
operator|>=
name|header
operator|.
name|total_imported_symbol_count
condition|)
block|{
name|codepos
operator|+=
literal|24
expr_stmt|;
continue|continue;
block|}
block|{
name|size_t
name|max
decl_stmt|,
name|namelen
decl_stmt|;
specifier|const
name|char
modifier|*
name|s
decl_stmt|;
if|if
condition|(
name|loaderlen
operator|<
operator|(
name|header
operator|.
name|loader_strings_offset
operator|+
name|imports
index|[
name|index
index|]
operator|.
name|name
operator|)
condition|)
goto|goto
name|error
goto|;
name|max
operator|=
name|loaderlen
operator|-
operator|(
name|header
operator|.
name|loader_strings_offset
operator|+
name|imports
index|[
name|index
index|]
operator|.
name|name
operator|)
expr_stmt|;
name|symname
operator|=
name|loaderbuf
operator|+
name|header
operator|.
name|loader_strings_offset
operator|+
name|imports
index|[
name|index
index|]
operator|.
name|name
expr_stmt|;
name|namelen
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|s
operator|=
name|symname
init|;
name|s
operator|<
operator|(
name|symname
operator|+
name|max
operator|)
condition|;
name|s
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'\0'
condition|)
break|break;
if|if
condition|(
operator|!
name|ISPRINT
argument_list|(
operator|*
name|s
argument_list|)
condition|)
goto|goto
name|error
goto|;
name|namelen
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|s
operator|!=
literal|'\0'
condition|)
goto|goto
name|error
goto|;
name|name
operator|=
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
name|strlen
argument_list|(
name|sprefix
argument_list|)
operator|+
name|namelen
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
break|break;
name|snprintf
argument_list|(
name|name
argument_list|,
name|strlen
argument_list|(
name|sprefix
argument_list|)
operator|+
name|namelen
operator|+
literal|1
argument_list|,
literal|"%s%s"
argument_list|,
name|sprefix
argument_list|,
name|symname
argument_list|)
expr_stmt|;
name|sym
operator|.
name|name
operator|=
name|name
expr_stmt|;
block|}
name|sym
operator|.
name|value
operator|=
name|codepos
expr_stmt|;
name|sym
operator|.
name|the_bfd
operator|=
name|abfd
expr_stmt|;
name|sym
operator|.
name|section
operator|=
name|codesec
expr_stmt|;
name|sym
operator|.
name|flags
operator|=
literal|0
expr_stmt|;
name|sym
operator|.
name|udata
operator|.
name|i
operator|=
literal|0
expr_stmt|;
name|codepos
operator|+=
literal|24
expr_stmt|;
if|if
condition|(
name|csym
operator|!=
name|NULL
condition|)
operator|*
operator|(
name|csym
index|[
name|count
index|]
operator|)
operator|=
name|sym
expr_stmt|;
name|count
operator|++
expr_stmt|;
block|}
goto|goto
name|end
goto|;
name|end
label|:
if|if
condition|(
name|libraries
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|libraries
argument_list|)
expr_stmt|;
if|if
condition|(
name|imports
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|imports
argument_list|)
expr_stmt|;
operator|*
name|nsym
operator|=
name|count
expr_stmt|;
return|return
literal|0
return|;
name|error
label|:
if|if
condition|(
name|libraries
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|libraries
argument_list|)
expr_stmt|;
if|if
condition|(
name|imports
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|imports
argument_list|)
expr_stmt|;
operator|*
name|nsym
operator|=
name|count
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|long
name|bfd_pef_parse_symbols
parameter_list|(
name|abfd
parameter_list|,
name|csym
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|csym
decl_stmt|;
block|{
name|unsigned
name|long
name|count
init|=
literal|0
decl_stmt|;
name|asection
modifier|*
name|codesec
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|codebuf
init|=
name|NULL
decl_stmt|;
name|size_t
name|codelen
init|=
literal|0
decl_stmt|;
name|asection
modifier|*
name|loadersec
init|=
name|NULL
decl_stmt|;
name|unsigned
name|char
modifier|*
name|loaderbuf
init|=
name|NULL
decl_stmt|;
name|size_t
name|loaderlen
init|=
literal|0
decl_stmt|;
name|codesec
operator|=
name|bfd_get_section_by_name
argument_list|(
name|abfd
argument_list|,
literal|"code"
argument_list|)
expr_stmt|;
if|if
condition|(
name|codesec
operator|!=
name|NULL
condition|)
block|{
name|codelen
operator|=
name|bfd_section_size
argument_list|(
name|abfd
argument_list|,
name|codesec
argument_list|)
expr_stmt|;
name|codebuf
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|codelen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
name|codesec
operator|->
name|filepos
argument_list|,
name|SEEK_SET
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|codebuf
argument_list|,
name|codelen
argument_list|,
name|abfd
argument_list|)
operator|!=
name|codelen
condition|)
goto|goto
name|end
goto|;
block|}
name|loadersec
operator|=
name|bfd_get_section_by_name
argument_list|(
name|abfd
argument_list|,
literal|"loader"
argument_list|)
expr_stmt|;
if|if
condition|(
name|loadersec
operator|!=
name|NULL
condition|)
block|{
name|loaderlen
operator|=
name|bfd_section_size
argument_list|(
name|abfd
argument_list|,
name|loadersec
argument_list|)
expr_stmt|;
name|loaderbuf
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|bfd_malloc
argument_list|(
name|loaderlen
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
name|loadersec
operator|->
name|filepos
argument_list|,
name|SEEK_SET
argument_list|)
operator|<
literal|0
condition|)
goto|goto
name|end
goto|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|loaderbuf
argument_list|,
name|loaderlen
argument_list|,
name|abfd
argument_list|)
operator|!=
name|loaderlen
condition|)
goto|goto
name|end
goto|;
block|}
name|count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|codesec
operator|!=
name|NULL
condition|)
block|{
name|unsigned
name|long
name|ncount
init|=
literal|0
decl_stmt|;
name|bfd_pef_parse_traceback_tables
argument_list|(
name|abfd
argument_list|,
name|codesec
argument_list|,
name|codebuf
argument_list|,
name|codelen
argument_list|,
operator|&
name|ncount
argument_list|,
name|csym
argument_list|)
expr_stmt|;
name|count
operator|+=
name|ncount
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|codesec
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|loadersec
operator|!=
name|NULL
operator|)
condition|)
block|{
name|unsigned
name|long
name|ncount
init|=
literal|0
decl_stmt|;
name|bfd_pef_parse_function_stubs
argument_list|(
name|abfd
argument_list|,
name|codesec
argument_list|,
name|codebuf
argument_list|,
name|codelen
argument_list|,
name|loaderbuf
argument_list|,
name|loaderlen
argument_list|,
operator|&
name|ncount
argument_list|,
operator|(
name|csym
operator|!=
name|NULL
operator|)
condition|?
operator|(
name|csym
operator|+
name|count
operator|)
else|:
name|NULL
argument_list|)
expr_stmt|;
name|count
operator|+=
name|ncount
expr_stmt|;
block|}
if|if
condition|(
name|csym
operator|!=
name|NULL
condition|)
name|csym
index|[
name|count
index|]
operator|=
name|NULL
expr_stmt|;
name|end
label|:
if|if
condition|(
name|codebuf
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|codebuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|loaderbuf
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|loaderbuf
argument_list|)
expr_stmt|;
return|return
name|count
return|;
block|}
end_function

begin_function
specifier|static
name|long
name|bfd_pef_count_symbols
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
return|return
name|bfd_pef_parse_symbols
argument_list|(
name|abfd
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|long
name|bfd_pef_get_symtab_upper_bound
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
name|long
name|nsyms
init|=
name|bfd_pef_count_symbols
argument_list|(
name|abfd
argument_list|)
decl_stmt|;
if|if
condition|(
name|nsyms
operator|<
literal|0
condition|)
return|return
name|nsyms
return|;
return|return
operator|(
operator|(
name|nsyms
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|asymbol
operator|*
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|long
name|bfd_pef_canonicalize_symtab
parameter_list|(
name|abfd
parameter_list|,
name|alocation
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|alocation
decl_stmt|;
block|{
name|long
name|i
decl_stmt|;
name|asymbol
modifier|*
name|syms
decl_stmt|;
name|long
name|ret
decl_stmt|;
name|long
name|nsyms
init|=
name|bfd_pef_count_symbols
argument_list|(
name|abfd
argument_list|)
decl_stmt|;
if|if
condition|(
name|nsyms
operator|<
literal|0
condition|)
return|return
name|nsyms
return|;
name|syms
operator|=
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
name|nsyms
operator|*
sizeof|sizeof
argument_list|(
name|asymbol
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|syms
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nsyms
condition|;
name|i
operator|++
control|)
name|alocation
index|[
name|i
index|]
operator|=
operator|&
name|syms
index|[
name|i
index|]
expr_stmt|;
name|alocation
index|[
name|nsyms
index|]
operator|=
name|NULL
expr_stmt|;
name|ret
operator|=
name|bfd_pef_parse_symbols
argument_list|(
name|abfd
argument_list|,
name|alocation
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|!=
name|nsyms
condition|)
return|return
literal|0
return|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|asymbol
modifier|*
name|bfd_pef_make_empty_symbol
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
return|return
operator|(
name|asymbol
operator|*
operator|)
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
sizeof|sizeof
argument_list|(
name|asymbol
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|bfd_pef_get_symbol_info
parameter_list|(
name|abfd
parameter_list|,
name|symbol
parameter_list|,
name|ret
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|asymbol
modifier|*
name|symbol
decl_stmt|;
name|symbol_info
modifier|*
name|ret
decl_stmt|;
block|{
name|bfd_symbol_info
argument_list|(
name|symbol
argument_list|,
name|ret
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
name|bfd_pef_sizeof_headers
parameter_list|(
name|abfd
parameter_list|,
name|exec
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_boolean
name|exec
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
specifier|const
name|bfd_target
name|pef_vec
init|=
block|{
literal|"pef"
block|,
comment|/* name */
name|bfd_target_pef_flavour
block|,
comment|/* flavour */
name|BFD_ENDIAN_BIG
block|,
comment|/* byteorder */
name|BFD_ENDIAN_BIG
block|,
comment|/* header_byteorder */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|DYNAMIC
operator||
name|WP_TEXT
operator||
name|D_PAGED
operator|)
block|,
operator|(
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_READONLY
operator||
name|SEC_CODE
operator||
name|SEC_DATA
operator||
name|SEC_ROM
operator||
name|SEC_HAS_CONTENTS
operator|)
block|,
comment|/* section_flags */
literal|0
block|,
comment|/* symbol_leading_char */
literal|' '
block|,
comment|/* ar_pad_char */
literal|16
block|,
comment|/* ar_max_namelen */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
block|{
comment|/* bfd_check_format */
name|_bfd_dummy_target
block|,
name|bfd_pef_object_p
block|,
comment|/* bfd_check_format */
name|_bfd_dummy_target
block|,
name|_bfd_dummy_target
block|,   }
block|,
block|{
comment|/* bfd_set_format */
name|bfd_false
block|,
name|bfd_pef_mkobject
block|,
name|bfd_false
block|,
name|bfd_false
block|,   }
block|,
block|{
comment|/* bfd_write_contents */
name|bfd_false
block|,
name|bfd_true
block|,
name|bfd_false
block|,
name|bfd_false
block|,   }
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|bfd_pef
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|_bfd_generic
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_noarchive
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|bfd_pef
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|bfd_pef
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|bfd_pef
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|bfd_pef
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|bfd_pef_xlib_close_and_cleanup
value|_bfd_generic_close_and_cleanup
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_bfd_free_cached_info
value|_bfd_generic_bfd_free_cached_info
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_new_section_hook
value|_bfd_generic_new_section_hook
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_get_section_contents
value|_bfd_generic_get_section_contents
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_set_section_contents
value|_bfd_generic_set_section_contents
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_get_section_contents_in_window
value|_bfd_generic_get_section_contents_in_window
end_define

begin_define
define|#
directive|define
name|bfd_pef_xlib_set_section_contents_in_window
value|_bfd_generic_set_section_contents_in_window
end_define

begin_function
specifier|static
name|int
name|bfd_pef_xlib_read_header
parameter_list|(
name|abfd
parameter_list|,
name|header
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_xlib_header
modifier|*
name|header
decl_stmt|;
block|{
name|unsigned
name|char
name|buf
index|[
literal|76
index|]
decl_stmt|;
name|bfd_seek
argument_list|(
name|abfd
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
if|if
condition|(
name|bfd_bread
argument_list|(
operator|(
name|PTR
operator|)
name|buf
argument_list|,
literal|76
argument_list|,
name|abfd
argument_list|)
operator|!=
literal|76
condition|)
return|return
operator|-
literal|1
return|;
name|header
operator|->
name|tag1
operator|=
name|bfd_getb32
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|header
operator|->
name|tag2
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|4
argument_list|)
expr_stmt|;
name|header
operator|->
name|current_format
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|8
argument_list|)
expr_stmt|;
name|header
operator|->
name|container_strings_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|12
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_hash_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|16
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_key_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|20
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_symbol_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|24
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_names_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|28
argument_list|)
expr_stmt|;
name|header
operator|->
name|export_hash_table_power
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|32
argument_list|)
expr_stmt|;
name|header
operator|->
name|exported_symbol_count
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|36
argument_list|)
expr_stmt|;
name|header
operator|->
name|frag_name_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|40
argument_list|)
expr_stmt|;
name|header
operator|->
name|frag_name_length
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|44
argument_list|)
expr_stmt|;
name|header
operator|->
name|dylib_path_offset
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|48
argument_list|)
expr_stmt|;
name|header
operator|->
name|dylib_path_length
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|52
argument_list|)
expr_stmt|;
name|header
operator|->
name|cpu_family
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|56
argument_list|)
expr_stmt|;
name|header
operator|->
name|cpu_model
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|60
argument_list|)
expr_stmt|;
name|header
operator|->
name|date_time_stamp
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|64
argument_list|)
expr_stmt|;
name|header
operator|->
name|current_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|68
argument_list|)
expr_stmt|;
name|header
operator|->
name|old_definition_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|72
argument_list|)
expr_stmt|;
name|header
operator|->
name|old_implementation_version
operator|=
name|bfd_getb32
argument_list|(
name|buf
operator|+
literal|76
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
name|bfd_pef_xlib_scan
parameter_list|(
name|abfd
parameter_list|,
name|header
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|bfd_pef_xlib_header
modifier|*
name|header
decl_stmt|;
block|{
name|bfd_pef_xlib_data_struct
modifier|*
name|mdata
init|=
name|NULL
decl_stmt|;
name|mdata
operator|=
operator|(
operator|(
name|bfd_pef_xlib_data_struct
operator|*
operator|)
name|bfd_alloc
argument_list|(
name|abfd
argument_list|,
sizeof|sizeof
argument_list|(
name|bfd_pef_xlib_data_struct
argument_list|)
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|mdata
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|mdata
operator|->
name|header
operator|=
operator|*
name|header
expr_stmt|;
name|abfd
operator|->
name|flags
operator|=
operator|(
name|abfd
operator|->
name|xvec
operator|->
name|object_flags
operator||
operator|(
name|abfd
operator|->
name|flags
operator|&
operator|(
name|BFD_IN_MEMORY
operator||
name|BFD_IO_FUNCS
operator|)
operator|)
operator|)
expr_stmt|;
name|abfd
operator|->
name|tdata
operator|.
name|pef_xlib_data
operator|=
name|mdata
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|bfd_target
modifier|*
name|bfd_pef_xlib_object_p
parameter_list|(
name|abfd
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
block|{
name|struct
name|bfd_preserve
name|preserve
decl_stmt|;
name|bfd_pef_xlib_header
name|header
decl_stmt|;
if|if
condition|(
name|bfd_pef_xlib_read_header
argument_list|(
name|abfd
argument_list|,
operator|&
name|header
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|bfd_set_error
argument_list|(
name|bfd_error_wrong_format
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|header
operator|.
name|tag1
operator|!=
name|BFD_PEF_XLIB_TAG1
operator|)
operator|||
operator|(
operator|(
name|header
operator|.
name|tag2
operator|!=
name|BFD_PEF_VLIB_TAG2
operator|)
operator|&&
operator|(
name|header
operator|.
name|tag2
operator|!=
name|BFD_PEF_BLIB_TAG2
operator|)
operator|)
condition|)
block|{
name|bfd_set_error
argument_list|(
name|bfd_error_wrong_format
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
name|bfd_preserve_save
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
condition|)
block|{
name|bfd_set_error
argument_list|(
name|bfd_error_wrong_format
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|bfd_pef_xlib_scan
argument_list|(
name|abfd
argument_list|,
operator|&
name|header
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|bfd_preserve_restore
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
expr_stmt|;
name|bfd_set_error
argument_list|(
name|bfd_error_wrong_format
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|bfd_preserve_finish
argument_list|(
name|abfd
argument_list|,
operator|&
name|preserve
argument_list|)
expr_stmt|;
return|return
name|abfd
operator|->
name|xvec
return|;
block|}
end_function

begin_decl_stmt
specifier|const
name|bfd_target
name|pef_xlib_vec
init|=
block|{
literal|"pef-xlib"
block|,
comment|/* name */
name|bfd_target_pef_xlib_flavour
block|,
comment|/* flavour */
name|BFD_ENDIAN_BIG
block|,
comment|/* byteorder */
name|BFD_ENDIAN_BIG
block|,
comment|/* header_byteorder */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|DYNAMIC
operator||
name|WP_TEXT
operator||
name|D_PAGED
operator|)
block|,
operator|(
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_READONLY
operator||
name|SEC_CODE
operator||
name|SEC_DATA
operator||
name|SEC_ROM
operator||
name|SEC_HAS_CONTENTS
operator|)
block|,
comment|/* section_flags */
literal|0
block|,
comment|/* symbol_leading_char */
literal|' '
block|,
comment|/* ar_pad_char */
literal|16
block|,
comment|/* ar_max_namelen */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
block|{
comment|/* bfd_check_format */
name|_bfd_dummy_target
block|,
name|bfd_pef_xlib_object_p
block|,
comment|/* bfd_check_format */
name|_bfd_dummy_target
block|,
name|_bfd_dummy_target
block|,   }
block|,
block|{
comment|/* bfd_set_format */
name|bfd_false
block|,
name|bfd_pef_mkobject
block|,
name|bfd_false
block|,
name|bfd_false
block|,   }
block|,
block|{
comment|/* bfd_write_contents */
name|bfd_false
block|,
name|bfd_true
block|,
name|bfd_false
block|,
name|bfd_false
block|,   }
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|bfd_pef_xlib
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|_bfd_generic
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_noarchive
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|_bfd_nosymbols
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|_bfd_norelocs
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|_bfd_nowrite
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|_bfd_nolink
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

end_unit

