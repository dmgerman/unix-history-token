begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD back-end for TMS320C54X coff binaries.    Copyright 1999, 2000, 2001, 2002, 2003, 2004, 2005    Free Software Foundation, Inc.    Contributed by Timothy Wall (twall@cygnus.com)     This file is part of BFD, the Binary File Descriptor library.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA    02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_include
include|#
directive|include
file|"bfdlink.h"
end_include

begin_include
include|#
directive|include
file|"coff/tic54x.h"
end_include

begin_include
include|#
directive|include
file|"coff/internal.h"
end_include

begin_include
include|#
directive|include
file|"libcoff.h"
end_include

begin_undef
undef|#
directive|undef
name|F_LSYMS
end_undef

begin_define
define|#
directive|define
name|F_LSYMS
value|F_LSYMS_TICOFF
end_define

begin_decl_stmt
specifier|static
name|void
name|tic54x_reloc_processing
name|PARAMS
argument_list|(
operator|(
name|arelent
operator|*
operator|,
expr|struct
name|internal_reloc
operator|*
operator|,
name|asymbol
operator|*
operator|*
operator|,
name|bfd
operator|*
operator|,
name|asection
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bfd_reloc_status_type
name|tic54x_relocation
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|arelent
operator|*
operator|,
name|asymbol
operator|*
operator|,
name|PTR
operator|,
name|asection
operator|*
operator|,
name|bfd
operator|*
operator|,
name|char
operator|*
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bfd_boolean
name|tic54x_set_section_contents
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|sec_ptr
operator|,
specifier|const
name|PTR
operator|,
name|file_ptr
operator|,
name|bfd_size_type
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|reloc_howto_type
modifier|*
name|coff_tic54x_rtype_to_howto
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|asection
operator|*
operator|,
expr|struct
name|internal_reloc
operator|*
operator|,
expr|struct
name|coff_link_hash_entry
operator|*
operator|,
expr|struct
name|internal_syment
operator|*
operator|,
name|bfd_vma
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bfd_boolean
name|tic54x_set_arch_mach
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
expr|enum
name|bfd_architecture
operator|,
name|unsigned
name|long
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|reloc_howto_type
modifier|*
name|tic54x_coff_reloc_type_lookup
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
name|bfd_reloc_code_real_type
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|tic54x_lookup_howto
name|PARAMS
argument_list|(
operator|(
name|arelent
operator|*
operator|,
expr|struct
name|internal_reloc
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|bfd_boolean
name|ticoff_bfd_is_local_label_name
name|PARAMS
argument_list|(
operator|(
name|bfd
operator|*
operator|,
specifier|const
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* 32-bit operations    The octet order is screwy.  words are LSB first (LS octet, actually), but    longwords are MSW first.  For example, 0x12345678 is encoded 0x5678 in the    first word and 0x1234 in the second.  When looking at the data as stored in    the COFF file, you would see the octets ordered as 0x78, 0x56, 0x34, 0x12.    Don't bother with 64-bits, as there aren't any.  */
end_comment

begin_function
specifier|static
name|bfd_vma
name|tic54x_getl32
parameter_list|(
specifier|const
name|void
modifier|*
name|p
parameter_list|)
block|{
specifier|const
name|bfd_byte
modifier|*
name|addr
init|=
name|p
decl_stmt|;
name|unsigned
name|long
name|v
decl_stmt|;
name|v
operator|=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|2
index|]
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|3
index|]
operator|<<
literal|8
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|0
index|]
operator|<<
literal|16
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|1
index|]
operator|<<
literal|24
expr_stmt|;
return|return
name|v
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|tic54x_putl32
parameter_list|(
name|bfd_vma
name|data
parameter_list|,
name|void
modifier|*
name|p
parameter_list|)
block|{
name|bfd_byte
modifier|*
name|addr
init|=
name|p
decl_stmt|;
name|addr
index|[
literal|2
index|]
operator|=
name|data
operator|&
literal|0xff
expr_stmt|;
name|addr
index|[
literal|3
index|]
operator|=
operator|(
name|data
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
name|addr
index|[
literal|0
index|]
operator|=
operator|(
name|data
operator|>>
literal|16
operator|)
operator|&
literal|0xff
expr_stmt|;
name|addr
index|[
literal|1
index|]
operator|=
operator|(
name|data
operator|>>
literal|24
operator|)
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|bfd_signed_vma
name|tic54x_getl_signed_32
parameter_list|(
specifier|const
name|void
modifier|*
name|p
parameter_list|)
block|{
specifier|const
name|bfd_byte
modifier|*
name|addr
init|=
name|p
decl_stmt|;
name|unsigned
name|long
name|v
decl_stmt|;
name|v
operator|=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|2
index|]
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|3
index|]
operator|<<
literal|8
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|0
index|]
operator|<<
literal|16
expr_stmt|;
name|v
operator||=
operator|(
name|unsigned
name|long
operator|)
name|addr
index|[
literal|1
index|]
operator|<<
literal|24
expr_stmt|;
define|#
directive|define
name|COERCE32
parameter_list|(
name|x
parameter_list|)
define|\
value|((bfd_signed_vma) (long) (((unsigned long) (x) ^ 0x80000000) - 0x80000000))
return|return
name|COERCE32
argument_list|(
name|v
argument_list|)
return|;
block|}
end_function

begin_define
define|#
directive|define
name|coff_get_section_load_page
value|bfd_ticoff_get_section_load_page
end_define

begin_define
define|#
directive|define
name|coff_set_section_load_page
value|bfd_ticoff_set_section_load_page
end_define

begin_function
name|void
name|bfd_ticoff_set_section_load_page
parameter_list|(
name|sect
parameter_list|,
name|page
parameter_list|)
name|asection
modifier|*
name|sect
decl_stmt|;
name|int
name|page
decl_stmt|;
block|{
name|sect
operator|->
name|lma
operator|=
operator|(
name|sect
operator|->
name|lma
operator|&
name|ADDR_MASK
operator|)
operator||
name|PG_TO_FLAG
argument_list|(
name|page
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
name|bfd_ticoff_get_section_load_page
parameter_list|(
name|sect
parameter_list|)
name|asection
modifier|*
name|sect
decl_stmt|;
block|{
name|int
name|page
decl_stmt|;
comment|/* Provide meaningful defaults for predefined sections.  */
if|if
condition|(
name|sect
operator|==
operator|&
name|bfd_com_section
condition|)
name|page
operator|=
name|PG_DATA
expr_stmt|;
elseif|else
if|if
condition|(
name|sect
operator|==
operator|&
name|bfd_und_section
operator|||
name|sect
operator|==
operator|&
name|bfd_abs_section
operator|||
name|sect
operator|==
operator|&
name|bfd_ind_section
condition|)
name|page
operator|=
name|PG_PROG
expr_stmt|;
else|else
name|page
operator|=
name|FLAG_TO_PG
argument_list|(
name|sect
operator|->
name|lma
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_comment
comment|/* Set the architecture appropriately.  Allow unkown architectures    (e.g. binary).  */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|tic54x_set_arch_mach
parameter_list|(
name|abfd
parameter_list|,
name|arch
parameter_list|,
name|machine
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|enum
name|bfd_architecture
name|arch
decl_stmt|;
name|unsigned
name|long
name|machine
decl_stmt|;
block|{
if|if
condition|(
name|arch
operator|==
name|bfd_arch_unknown
condition|)
name|arch
operator|=
name|bfd_arch_tic54x
expr_stmt|;
elseif|else
if|if
condition|(
name|arch
operator|!=
name|bfd_arch_tic54x
condition|)
return|return
name|FALSE
return|;
return|return
name|bfd_default_set_arch_mach
argument_list|(
name|abfd
argument_list|,
name|arch
argument_list|,
name|machine
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|bfd_reloc_status_type
name|tic54x_relocation
parameter_list|(
name|abfd
parameter_list|,
name|reloc_entry
parameter_list|,
name|symbol
parameter_list|,
name|data
parameter_list|,
name|input_section
parameter_list|,
name|output_bfd
parameter_list|,
name|error_message
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|arelent
modifier|*
name|reloc_entry
decl_stmt|;
name|asymbol
modifier|*
name|symbol
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|data
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|asection
modifier|*
name|input_section
decl_stmt|;
name|bfd
modifier|*
name|output_bfd
decl_stmt|;
name|char
modifier|*
modifier|*
name|error_message
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
if|if
condition|(
name|output_bfd
operator|!=
operator|(
name|bfd
operator|*
operator|)
name|NULL
condition|)
block|{
comment|/* This is a partial relocation, and we want to apply the  	 relocation to the reloc entry rather than the raw data.  	 Modify the reloc inplace to reflect what we now know.  */
name|reloc_entry
operator|->
name|address
operator|+=
name|input_section
operator|->
name|output_offset
expr_stmt|;
return|return
name|bfd_reloc_ok
return|;
block|}
return|return
name|bfd_reloc_continue
return|;
block|}
end_function

begin_decl_stmt
name|reloc_howto_type
name|tic54x_howto_table
index|[]
init|=
block|{
comment|/* type,rightshift,size (0=byte, 1=short, 2=long),        bit size, pc_relative, bitpos, dont complain_on_overflow,        special_function, name, partial_inplace, src_mask, dst_mask, pcrel_offset.  */
comment|/* NORMAL BANK */
comment|/* 16-bit direct reference to symbol's address.  */
name|HOWTO
argument_list|(
name|R_RELWORD
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"REL16"
argument_list|,
name|FALSE
argument_list|,
literal|0xFFFF
argument_list|,
literal|0xFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 7 LSBs of an address */
name|HOWTO
argument_list|(
name|R_PARTLS7
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"LS7"
argument_list|,
name|FALSE
argument_list|,
literal|0x007F
argument_list|,
literal|0x007F
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 9 MSBs of an address */
comment|/* TI assembler doesn't shift its encoding, and is thus incompatible */
name|HOWTO
argument_list|(
name|R_PARTMS9
argument_list|,
literal|7
argument_list|,
literal|1
argument_list|,
literal|9
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"MS9"
argument_list|,
name|FALSE
argument_list|,
literal|0x01FF
argument_list|,
literal|0x01FF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 23-bit relocation */
name|HOWTO
argument_list|(
name|R_EXTWORD
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|23
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"RELEXT"
argument_list|,
name|FALSE
argument_list|,
literal|0x7FFFFF
argument_list|,
literal|0x7FFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 16 bits of 23-bit extended address */
name|HOWTO
argument_list|(
name|R_EXTWORD16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"RELEXT16"
argument_list|,
name|FALSE
argument_list|,
literal|0x7FFFFF
argument_list|,
literal|0x7FFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* upper 7 bits of 23-bit extended address */
name|HOWTO
argument_list|(
name|R_EXTWORDMS7
argument_list|,
literal|16
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"RELEXTMS7"
argument_list|,
name|FALSE
argument_list|,
literal|0x7F
argument_list|,
literal|0x7F
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* ABSOLUTE BANK */
comment|/* 16-bit direct reference to symbol's address, absolute */
name|HOWTO
argument_list|(
name|R_RELWORD
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"AREL16"
argument_list|,
name|FALSE
argument_list|,
literal|0xFFFF
argument_list|,
literal|0xFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 7 LSBs of an address, absolute */
name|HOWTO
argument_list|(
name|R_PARTLS7
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"ALS7"
argument_list|,
name|FALSE
argument_list|,
literal|0x007F
argument_list|,
literal|0x007F
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 9 MSBs of an address, absolute */
comment|/* TI assembler doesn't shift its encoding, and is thus incompatible */
name|HOWTO
argument_list|(
name|R_PARTMS9
argument_list|,
literal|7
argument_list|,
literal|1
argument_list|,
literal|9
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"AMS9"
argument_list|,
name|FALSE
argument_list|,
literal|0x01FF
argument_list|,
literal|0x01FF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 23-bit direct reference, absolute */
name|HOWTO
argument_list|(
name|R_EXTWORD
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|23
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"ARELEXT"
argument_list|,
name|FALSE
argument_list|,
literal|0x7FFFFF
argument_list|,
literal|0x7FFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 16 bits of 23-bit extended address, absolute */
name|HOWTO
argument_list|(
name|R_EXTWORD16
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"ARELEXT16"
argument_list|,
name|FALSE
argument_list|,
literal|0x7FFFFF
argument_list|,
literal|0x7FFFFF
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* upper 7 bits of 23-bit extended address, absolute */
name|HOWTO
argument_list|(
name|R_EXTWORDMS7
argument_list|,
literal|16
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"ARELEXTMS7"
argument_list|,
name|FALSE
argument_list|,
literal|0x7F
argument_list|,
literal|0x7F
argument_list|,
name|FALSE
argument_list|)
block|,
comment|/* 32-bit relocation exclusively for stabs */
name|HOWTO
argument_list|(
name|R_RELLONG
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|32
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
name|complain_overflow_dont
argument_list|,
name|tic54x_relocation
argument_list|,
literal|"STAB"
argument_list|,
name|FALSE
argument_list|,
literal|0xFFFFFFFF
argument_list|,
literal|0xFFFFFFFF
argument_list|,
name|FALSE
argument_list|)
block|,   }
decl_stmt|;
end_decl_stmt

begin_define
define|#
directive|define
name|coff_bfd_reloc_type_lookup
value|tic54x_coff_reloc_type_lookup
end_define

begin_comment
comment|/* For the case statement use the code values used tc_gen_reloc (defined in    bfd/reloc.c) to map to the howto table entries.  */
end_comment

begin_function
name|reloc_howto_type
modifier|*
name|tic54x_coff_reloc_type_lookup
parameter_list|(
name|abfd
parameter_list|,
name|code
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_reloc_code_real_type
name|code
decl_stmt|;
block|{
switch|switch
condition|(
name|code
condition|)
block|{
case|case
name|BFD_RELOC_16
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|0
index|]
return|;
case|case
name|BFD_RELOC_TIC54X_PARTLS7
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|1
index|]
return|;
case|case
name|BFD_RELOC_TIC54X_PARTMS9
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|2
index|]
return|;
case|case
name|BFD_RELOC_TIC54X_23
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|3
index|]
return|;
case|case
name|BFD_RELOC_TIC54X_16_OF_23
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|4
index|]
return|;
case|case
name|BFD_RELOC_TIC54X_MS7_OF_23
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|5
index|]
return|;
case|case
name|BFD_RELOC_32
case|:
return|return
operator|&
name|tic54x_howto_table
index|[
literal|12
index|]
return|;
default|default:
return|return
operator|(
name|reloc_howto_type
operator|*
operator|)
name|NULL
return|;
block|}
block|}
end_function

begin_comment
comment|/* Code to turn a r_type into a howto ptr, uses the above howto table.    Called after some initial checking by the tic54x_rtype_to_howto fn below.  */
end_comment

begin_function
specifier|static
name|void
name|tic54x_lookup_howto
parameter_list|(
name|internal
parameter_list|,
name|dst
parameter_list|)
name|arelent
modifier|*
name|internal
decl_stmt|;
name|struct
name|internal_reloc
modifier|*
name|dst
decl_stmt|;
block|{
name|unsigned
name|i
decl_stmt|;
name|int
name|bank
init|=
operator|(
name|dst
operator|->
name|r_symndx
operator|==
operator|-
literal|1
operator|)
condition|?
name|HOWTO_BANK
else|:
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
name|tic54x_howto_table
operator|/
sizeof|sizeof
name|tic54x_howto_table
index|[
literal|0
index|]
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|tic54x_howto_table
index|[
name|i
index|]
operator|.
name|type
operator|==
name|dst
operator|->
name|r_type
condition|)
block|{
name|internal
operator|->
name|howto
operator|=
name|tic54x_howto_table
operator|+
name|i
operator|+
name|bank
expr_stmt|;
return|return;
block|}
block|}
call|(
modifier|*
name|_bfd_error_handler
call|)
argument_list|(
name|_
argument_list|(
literal|"Unrecognized reloc type 0x%x"
argument_list|)
argument_list|,
operator|(
name|unsigned
name|int
operator|)
name|dst
operator|->
name|r_type
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
end_function

begin_define
define|#
directive|define
name|RELOC_PROCESSING
parameter_list|(
name|RELENT
parameter_list|,
name|RELOC
parameter_list|,
name|SYMS
parameter_list|,
name|ABFD
parameter_list|,
name|SECT
parameter_list|)
define|\
value|tic54x_reloc_processing(RELENT,RELOC,SYMS,ABFD,SECT)
end_define

begin_define
define|#
directive|define
name|coff_rtype_to_howto
value|coff_tic54x_rtype_to_howto
end_define

begin_function
specifier|static
name|reloc_howto_type
modifier|*
name|coff_tic54x_rtype_to_howto
parameter_list|(
name|abfd
parameter_list|,
name|sec
parameter_list|,
name|rel
parameter_list|,
name|h
parameter_list|,
name|sym
parameter_list|,
name|addendp
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|asection
modifier|*
name|sec
decl_stmt|;
name|struct
name|internal_reloc
modifier|*
name|rel
decl_stmt|;
name|struct
name|coff_link_hash_entry
modifier|*
name|h
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|struct
name|internal_syment
modifier|*
name|sym
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
modifier|*
name|addendp
decl_stmt|;
block|{
name|arelent
name|genrel
decl_stmt|;
if|if
condition|(
name|rel
operator|->
name|r_symndx
operator|==
operator|-
literal|1
operator|&&
name|addendp
operator|!=
name|NULL
condition|)
block|{
comment|/* This is a TI "internal relocation", which means that the relocation 	 amount is the amount by which the current section is being relocated 	 in the output section.  */
operator|*
name|addendp
operator|=
operator|(
name|sec
operator|->
name|output_section
operator|->
name|vma
operator|+
name|sec
operator|->
name|output_offset
operator|)
operator|-
name|sec
operator|->
name|vma
expr_stmt|;
block|}
name|tic54x_lookup_howto
argument_list|(
operator|&
name|genrel
argument_list|,
name|rel
argument_list|)
expr_stmt|;
return|return
name|genrel
operator|.
name|howto
return|;
block|}
end_function

begin_comment
comment|/* Replace the stock _bfd_coff_is_local_label_name to recognize TI COFF local    labels.  */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|ticoff_bfd_is_local_label_name
parameter_list|(
name|abfd
parameter_list|,
name|name
parameter_list|)
name|bfd
modifier|*
name|abfd
name|ATTRIBUTE_UNUSED
decl_stmt|;
specifier|const
name|char
modifier|*
name|name
decl_stmt|;
block|{
if|if
condition|(
name|TICOFF_LOCAL_LABEL_P
argument_list|(
name|name
argument_list|)
condition|)
return|return
name|TRUE
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_define
define|#
directive|define
name|coff_bfd_is_local_label_name
value|ticoff_bfd_is_local_label_name
end_define

begin_comment
comment|/* Clear the r_reserved field in relocs.  */
end_comment

begin_define
define|#
directive|define
name|SWAP_OUT_RELOC_EXTRA
parameter_list|(
name|abfd
parameter_list|,
name|src
parameter_list|,
name|dst
parameter_list|)
define|\
value|do \     { \       dst->r_reserved[0] = 0; \       dst->r_reserved[1] = 0; \     } \   while (0)
end_define

begin_comment
comment|/* Customize coffcode.h; the default coff_ functions are set up to use COFF2;    coff_bad_format_hook uses BADMAG, so set that for COFF2.  The COFF1    and COFF0 vectors use custom _bad_format_hook procs instead of setting    BADMAG.  */
end_comment

begin_define
define|#
directive|define
name|BADMAG
parameter_list|(
name|x
parameter_list|)
value|COFF2_BADMAG(x)
end_define

begin_include
include|#
directive|include
file|"coffcode.h"
end_include

begin_function
specifier|static
name|bfd_boolean
name|tic54x_set_section_contents
parameter_list|(
name|abfd
parameter_list|,
name|section
parameter_list|,
name|location
parameter_list|,
name|offset
parameter_list|,
name|bytes_to_do
parameter_list|)
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|sec_ptr
name|section
decl_stmt|;
specifier|const
name|PTR
name|location
decl_stmt|;
name|file_ptr
name|offset
decl_stmt|;
name|bfd_size_type
name|bytes_to_do
decl_stmt|;
block|{
return|return
name|coff_set_section_contents
argument_list|(
name|abfd
argument_list|,
name|section
argument_list|,
name|location
argument_list|,
name|offset
argument_list|,
name|bytes_to_do
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
name|tic54x_reloc_processing
parameter_list|(
name|relent
parameter_list|,
name|reloc
parameter_list|,
name|symbols
parameter_list|,
name|abfd
parameter_list|,
name|section
parameter_list|)
name|arelent
modifier|*
name|relent
decl_stmt|;
name|struct
name|internal_reloc
modifier|*
name|reloc
decl_stmt|;
name|asymbol
modifier|*
modifier|*
name|symbols
decl_stmt|;
name|bfd
modifier|*
name|abfd
decl_stmt|;
name|asection
modifier|*
name|section
decl_stmt|;
block|{
name|asymbol
modifier|*
name|ptr
decl_stmt|;
name|relent
operator|->
name|address
operator|=
name|reloc
operator|->
name|r_vaddr
expr_stmt|;
if|if
condition|(
name|reloc
operator|->
name|r_symndx
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|reloc
operator|->
name|r_symndx
operator|<
literal|0
operator|||
name|reloc
operator|->
name|r_symndx
operator|>=
name|obj_conv_table_size
argument_list|(
name|abfd
argument_list|)
condition|)
block|{
call|(
modifier|*
name|_bfd_error_handler
call|)
argument_list|(
name|_
argument_list|(
literal|"%B: warning: illegal symbol index %ld in relocs"
argument_list|)
argument_list|,
name|abfd
argument_list|,
name|reloc
operator|->
name|r_symndx
argument_list|)
expr_stmt|;
name|relent
operator|->
name|sym_ptr_ptr
operator|=
name|bfd_abs_section_ptr
operator|->
name|symbol_ptr_ptr
expr_stmt|;
name|ptr
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|relent
operator|->
name|sym_ptr_ptr
operator|=
operator|(
name|symbols
operator|+
name|obj_convert
argument_list|(
name|abfd
argument_list|)
index|[
name|reloc
operator|->
name|r_symndx
index|]
operator|)
expr_stmt|;
name|ptr
operator|=
operator|*
operator|(
name|relent
operator|->
name|sym_ptr_ptr
operator|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|relent
operator|->
name|sym_ptr_ptr
operator|=
name|section
operator|->
name|symbol_ptr_ptr
expr_stmt|;
name|ptr
operator|=
operator|*
operator|(
name|relent
operator|->
name|sym_ptr_ptr
operator|)
expr_stmt|;
block|}
comment|/* The symbols definitions that we have read in have been      relocated as if their sections started at 0. But the offsets      refering to the symbols in the raw data have not been      modified, so we have to have a negative addend to compensate.       Note that symbols which used to be common must be left alone.  */
comment|/* Calculate any reloc addend by looking at the symbol.  */
name|CALC_ADDEND
argument_list|(
name|abfd
argument_list|,
name|ptr
argument_list|,
operator|*
name|reloc
argument_list|,
name|relent
argument_list|)
expr_stmt|;
name|relent
operator|->
name|address
operator|-=
name|section
operator|->
name|vma
expr_stmt|;
comment|/* !!     relent->section = (asection *) NULL;*/
comment|/* Fill in the relent->howto field from reloc->r_type.  */
name|tic54x_lookup_howto
argument_list|(
name|relent
argument_list|,
name|reloc
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* TI COFF v0, DOS tools (little-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff0_vec
init|=
block|{
literal|"coff0-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_LITTLE
block|,
comment|/* header byte order is little (DOS tools) */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|bfd_getl32
block|,
name|bfd_getl_signed_32
block|,
name|bfd_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
name|NULL
block|,
operator|(
name|PTR
operator|)
operator|&
name|ticoff0_swap_table
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* TI COFF v0, SPARC tools (big-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff0_beh_vec
init|=
block|{
literal|"coff0-beh-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_BIG
block|,
comment|/* header byte order is big */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
operator|&
name|tic54x_coff0_vec
block|,
operator|(
name|PTR
operator|)
operator|&
name|ticoff0_swap_table
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* TI COFF v1, DOS tools (little-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff1_vec
init|=
block|{
literal|"coff1-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_LITTLE
block|,
comment|/* header byte order is little (DOS tools) */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|bfd_getl32
block|,
name|bfd_getl_signed_32
block|,
name|bfd_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
operator|&
name|tic54x_coff0_beh_vec
block|,
operator|(
name|PTR
operator|)
operator|&
name|ticoff1_swap_table
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* TI COFF v1, SPARC tools (big-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff1_beh_vec
init|=
block|{
literal|"coff1-beh-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_BIG
block|,
comment|/* header byte order is big */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
operator|&
name|tic54x_coff1_vec
block|,
operator|(
name|PTR
operator|)
operator|&
name|ticoff1_swap_table
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* TI COFF v2, TI DOS tools output (little-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff2_vec
init|=
block|{
literal|"coff2-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_LITTLE
block|,
comment|/* header byte order is little (DOS tools) */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|bfd_getl32
block|,
name|bfd_getl_signed_32
block|,
name|bfd_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
operator|&
name|tic54x_coff1_beh_vec
block|,
name|COFF_SWAP_TABLE
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* TI COFF v2, TI SPARC tools output (big-endian headers).  */
end_comment

begin_decl_stmt
specifier|const
name|bfd_target
name|tic54x_coff2_beh_vec
init|=
block|{
literal|"coff2-beh-c54x"
block|,
comment|/* name */
name|bfd_target_coff_flavour
block|,
name|BFD_ENDIAN_LITTLE
block|,
comment|/* data byte order is little */
name|BFD_ENDIAN_BIG
block|,
comment|/* header byte order is big */
operator|(
name|HAS_RELOC
operator||
name|EXEC_P
operator||
comment|/* object flags */
name|HAS_LINENO
operator||
name|HAS_DEBUG
operator||
name|HAS_SYMS
operator||
name|HAS_LOCALS
operator||
name|WP_TEXT
operator|)
block|,
operator|(
name|SEC_HAS_CONTENTS
operator||
name|SEC_ALLOC
operator||
name|SEC_LOAD
operator||
name|SEC_RELOC
operator|)
block|,
comment|/* section flags */
literal|'_'
block|,
comment|/* leading symbol underscore */
literal|'/'
block|,
comment|/* ar_pad_char */
literal|15
block|,
comment|/* ar_max_namelen */
name|bfd_getl64
block|,
name|bfd_getl_signed_64
block|,
name|bfd_putl64
block|,
name|tic54x_getl32
block|,
name|tic54x_getl_signed_32
block|,
name|tic54x_putl32
block|,
name|bfd_getl16
block|,
name|bfd_getl_signed_16
block|,
name|bfd_putl16
block|,
comment|/* data */
name|bfd_getb64
block|,
name|bfd_getb_signed_64
block|,
name|bfd_putb64
block|,
name|bfd_getb32
block|,
name|bfd_getb_signed_32
block|,
name|bfd_putb32
block|,
name|bfd_getb16
block|,
name|bfd_getb_signed_16
block|,
name|bfd_putb16
block|,
comment|/* hdrs */
block|{
name|_bfd_dummy_target
block|,
name|coff_object_p
block|,
comment|/* bfd_check_format */
name|bfd_generic_archive_p
block|,
name|_bfd_dummy_target
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_mkobject
block|,
name|_bfd_generic_mkarchive
block|,
comment|/* bfd_set_format */
name|bfd_false
block|}
block|,
block|{
name|bfd_false
block|,
name|coff_write_object_contents
block|,
comment|/* bfd_write_contents */
name|_bfd_write_archive_contents
block|,
name|bfd_false
block|}
block|,
name|BFD_JUMP_TABLE_GENERIC
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_COPY
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_CORE
argument_list|(
name|_bfd_nocore
argument_list|)
block|,
name|BFD_JUMP_TABLE_ARCHIVE
argument_list|(
name|_bfd_archive_coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_SYMBOLS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_RELOCS
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_WRITE
argument_list|(
name|tic54x
argument_list|)
block|,
name|BFD_JUMP_TABLE_LINK
argument_list|(
name|coff
argument_list|)
block|,
name|BFD_JUMP_TABLE_DYNAMIC
argument_list|(
name|_bfd_nodynamic
argument_list|)
block|,
operator|&
name|tic54x_coff2_vec
block|,
name|COFF_SWAP_TABLE
block|}
decl_stmt|;
end_decl_stmt

end_unit

