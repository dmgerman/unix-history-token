begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* BFD library support routines for the i960 architecture.    Copyright 1990, 1991, 1993, 1994, 1996, 1999, 2000, 2001, 2002    Free Software Foundation, Inc.    Hacked by Steve Chamberlain of Cygnus Support.  This file is part of BFD, the Binary File Descriptor library.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"libbfd.h"
end_include

begin_decl_stmt
specifier|static
name|bfd_boolean
name|scan_960_mach
name|PARAMS
argument_list|(
operator|(
specifier|const
name|bfd_arch_info_type
operator|*
operator|,
specifier|const
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
specifier|const
name|bfd_arch_info_type
modifier|*
name|compatible
name|PARAMS
argument_list|(
operator|(
specifier|const
name|bfd_arch_info_type
operator|*
operator|,
specifier|const
name|bfd_arch_info_type
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* This routine is provided a string, and tries to work out if it    could possibly refer to the i960 machine pointed at in the    info_struct pointer */
end_comment

begin_function
specifier|static
name|bfd_boolean
name|scan_960_mach
parameter_list|(
name|ap
parameter_list|,
name|string
parameter_list|)
specifier|const
name|bfd_arch_info_type
modifier|*
name|ap
decl_stmt|;
specifier|const
name|char
modifier|*
name|string
decl_stmt|;
block|{
name|unsigned
name|long
name|machine
decl_stmt|;
name|int
name|fail_because_not_80960
init|=
name|FALSE
decl_stmt|;
comment|/* Look for the string i960 at the front of the string.  */
if|if
condition|(
name|strncasecmp
argument_list|(
literal|"i960"
argument_list|,
name|string
argument_list|,
literal|4
argument_list|)
operator|==
literal|0
condition|)
block|{
name|string
operator|+=
literal|4
expr_stmt|;
comment|/* i960 on it's own means core to us.  */
if|if
condition|(
operator|*
name|string
operator|==
literal|0
condition|)
return|return
name|ap
operator|->
name|mach
operator|==
name|bfd_mach_i960_core
return|;
comment|/* "i960:*" is valid, anything else is not.  */
if|if
condition|(
operator|*
name|string
operator|!=
literal|':'
condition|)
return|return
name|FALSE
return|;
name|string
operator|++
expr_stmt|;
block|}
comment|/* In some bfds the cpu-id is written as "80960KA", "80960KB",      "80960CA" or "80960MC".  */
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
literal|"80960"
argument_list|,
name|string
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|string
operator|+=
literal|5
expr_stmt|;
comment|/* Set this to TRUE here.  If a correct matching postfix 	 is detected below it will be reset to FALSE.  */
name|fail_because_not_80960
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/* No match, can't be us.  */
else|else
return|return
name|FALSE
return|;
if|if
condition|(
operator|*
name|string
operator|==
literal|'\0'
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'c'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'o'
operator|&&
name|string
index|[
literal|2
index|]
operator|==
literal|'r'
operator|&&
name|string
index|[
literal|3
index|]
operator|==
literal|'e'
operator|&&
name|string
index|[
literal|4
index|]
operator|==
literal|'\0'
condition|)
name|machine
operator|=
name|bfd_mach_i960_core
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
literal|"ka_sa"
argument_list|)
operator|==
literal|0
condition|)
name|machine
operator|=
name|bfd_mach_i960_ka_sa
expr_stmt|;
elseif|else
if|if
condition|(
name|strcasecmp
argument_list|(
name|string
argument_list|,
literal|"kb_sb"
argument_list|)
operator|==
literal|0
condition|)
name|machine
operator|=
name|bfd_mach_i960_kb_sb
expr_stmt|;
elseif|else
if|if
condition|(
name|string
index|[
literal|1
index|]
operator|==
literal|'\0'
operator|||
name|string
index|[
literal|2
index|]
operator|!=
literal|'\0'
condition|)
comment|/* rest are 2-char.  */
return|return
name|FALSE
return|;
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'k'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'b'
condition|)
block|{
name|machine
operator|=
name|bfd_mach_i960_kb_sb
expr_stmt|;
name|fail_because_not_80960
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'s'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'b'
condition|)
name|machine
operator|=
name|bfd_mach_i960_kb_sb
expr_stmt|;
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'m'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'c'
condition|)
block|{
name|machine
operator|=
name|bfd_mach_i960_mc
expr_stmt|;
name|fail_because_not_80960
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'x'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'a'
condition|)
name|machine
operator|=
name|bfd_mach_i960_xa
expr_stmt|;
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'c'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'a'
condition|)
block|{
name|machine
operator|=
name|bfd_mach_i960_ca
expr_stmt|;
name|fail_because_not_80960
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'k'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'a'
condition|)
block|{
name|machine
operator|=
name|bfd_mach_i960_ka_sa
expr_stmt|;
name|fail_because_not_80960
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'s'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'a'
condition|)
name|machine
operator|=
name|bfd_mach_i960_ka_sa
expr_stmt|;
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'j'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'x'
condition|)
name|machine
operator|=
name|bfd_mach_i960_jx
expr_stmt|;
elseif|else
if|if
condition|(
name|string
index|[
literal|0
index|]
operator|==
literal|'h'
operator|&&
name|string
index|[
literal|1
index|]
operator|==
literal|'x'
condition|)
name|machine
operator|=
name|bfd_mach_i960_hx
expr_stmt|;
else|else
return|return
name|FALSE
return|;
if|if
condition|(
name|fail_because_not_80960
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|machine
operator|==
name|ap
operator|->
name|mach
condition|)
return|return
name|TRUE
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* This routine is provided two arch_infos and works out the i960    machine which would be compatible with both and returns a pointer    to its info structure */
end_comment

begin_function
specifier|static
specifier|const
name|bfd_arch_info_type
modifier|*
name|compatible
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
specifier|const
name|bfd_arch_info_type
modifier|*
name|a
decl_stmt|;
specifier|const
name|bfd_arch_info_type
modifier|*
name|b
decl_stmt|;
block|{
comment|/* The i960 has distinct subspecies which may not interbreed: 	CORE CA 	CORE KA KB MC XA 	CORE HX JX      Any architecture on the same line is compatible, the one on      the right is the least restrictive.       We represent this information in an array, each machine to a side */
define|#
directive|define
name|ERROR
value|0
define|#
directive|define
name|CORE
value|bfd_mach_i960_core
comment|/*1*/
define|#
directive|define
name|KA
value|bfd_mach_i960_ka_sa
comment|/*2*/
define|#
directive|define
name|KB
value|bfd_mach_i960_kb_sb
comment|/*3*/
define|#
directive|define
name|MC
value|bfd_mach_i960_mc
comment|/*4*/
define|#
directive|define
name|XA
value|bfd_mach_i960_xa
comment|/*5*/
define|#
directive|define
name|CA
value|bfd_mach_i960_ca
comment|/*6*/
define|#
directive|define
name|JX
value|bfd_mach_i960_jx
comment|/*7*/
define|#
directive|define
name|HX
value|bfd_mach_i960_hx
comment|/*8*/
define|#
directive|define
name|MAX_ARCH
value|((int)HX)
specifier|static
specifier|const
name|unsigned
name|long
name|matrix
index|[
name|MAX_ARCH
operator|+
literal|1
index|]
index|[
name|MAX_ARCH
operator|+
literal|1
index|]
init|=
block|{
block|{
name|ERROR
block|,
name|CORE
block|,
name|KA
block|,
name|KB
block|,
name|MC
block|,
name|XA
block|,
name|CA
block|,
name|JX
block|,
name|HX
block|}
block|,
block|{
name|CORE
block|,
name|CORE
block|,
name|KA
block|,
name|KB
block|,
name|MC
block|,
name|XA
block|,
name|CA
block|,
name|JX
block|,
name|HX
block|}
block|,
block|{
name|KA
block|,
name|KA
block|,
name|KA
block|,
name|KB
block|,
name|MC
block|,
name|XA
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|}
block|,
block|{
name|KB
block|,
name|KB
block|,
name|KB
block|,
name|KB
block|,
name|MC
block|,
name|XA
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|}
block|,
block|{
name|MC
block|,
name|MC
block|,
name|MC
block|,
name|MC
block|,
name|MC
block|,
name|XA
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|}
block|,
block|{
name|XA
block|,
name|XA
block|,
name|XA
block|,
name|XA
block|,
name|XA
block|,
name|XA
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|}
block|,
block|{
name|CA
block|,
name|CA
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|CA
block|,
name|ERROR
block|,
name|ERROR
block|}
block|,
block|{
name|JX
block|,
name|JX
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|JX
block|,
name|HX
block|}
block|,
block|{
name|HX
block|,
name|HX
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|ERROR
block|,
name|HX
block|,
name|HX
block|}
block|,     }
decl_stmt|;
if|if
condition|(
name|a
operator|->
name|arch
operator|!=
name|b
operator|->
name|arch
operator|||
name|matrix
index|[
name|a
operator|->
name|mach
index|]
index|[
name|b
operator|->
name|mach
index|]
operator|==
name|ERROR
condition|)
block|{
return|return
name|NULL
return|;
block|}
else|else
block|{
return|return
operator|(
name|a
operator|->
name|mach
operator|==
name|matrix
index|[
name|a
operator|->
name|mach
index|]
index|[
name|b
operator|->
name|mach
index|]
operator|)
condition|?
name|a
else|:
name|b
return|;
block|}
block|}
end_function

begin_define
define|#
directive|define
name|N
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|d
parameter_list|,
name|n
parameter_list|)
define|\
value|{ 32, 32, 8,bfd_arch_i960,a,"i960",b,3,d,compatible,scan_960_mach,n,}
end_define

begin_decl_stmt
specifier|static
specifier|const
name|bfd_arch_info_type
name|arch_info_struct
index|[]
init|=
block|{
name|N
argument_list|(
name|bfd_mach_i960_ka_sa
argument_list|,
literal|"i960:ka_sa"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|1
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_kb_sb
argument_list|,
literal|"i960:kb_sb"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|2
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_mc
argument_list|,
literal|"i960:mc"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|3
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_xa
argument_list|,
literal|"i960:xa"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|4
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_ca
argument_list|,
literal|"i960:ca"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|5
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_jx
argument_list|,
literal|"i960:jx"
argument_list|,
name|FALSE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|6
index|]
argument_list|)
block|,
name|N
argument_list|(
name|bfd_mach_i960_hx
argument_list|,
literal|"i960:hx"
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|const
name|bfd_arch_info_type
name|bfd_i960_arch
init|=
name|N
argument_list|(
name|bfd_mach_i960_core
argument_list|,
literal|"i960:core"
argument_list|,
name|TRUE
argument_list|,
operator|&
name|arch_info_struct
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

end_unit

