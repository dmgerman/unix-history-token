begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"xscale.h"
end_include

begin_function
name|void
modifier|*
name|memchr
parameter_list|(
specifier|const
name|void
modifier|*
name|start
parameter_list|,
name|int
name|c
parameter_list|,
name|size_t
name|len
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|str
init|=
name|start
decl_stmt|;
if|if
condition|(
name|len
operator|==
literal|0
condition|)
return|return
literal|0
return|;
asm|asm (PRELOADSTR ("%0") : : "r" (start));
name|c
operator|&=
literal|0xff
expr_stmt|;
ifndef|#
directive|ifndef
name|__OPTIMIZE_SIZE__
comment|/* Skip unaligned part.  */
if|if
condition|(
operator|(
name|long
operator|)
name|str
operator|&
literal|3
condition|)
block|{
name|str
operator|--
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|*
operator|++
name|str
operator|==
name|c
condition|)
return|return
operator|(
name|void
operator|*
operator|)
name|str
return|;
block|}
do|while
condition|(
operator|(
operator|(
name|long
operator|)
name|str
operator|&
literal|3
operator|)
operator|!=
literal|0
operator|&&
operator|--
name|len
operator|>
literal|0
condition|)
do|;
block|}
if|if
condition|(
name|len
operator|>
literal|3
condition|)
block|{
name|unsigned
name|int
name|c2
init|=
name|c
operator|+
operator|(
name|c
operator|<<
literal|8
operator|)
decl_stmt|;
name|c2
operator|+=
name|c2
operator|<<
literal|16
expr_stmt|;
comment|/* Load two constants:          R7 = 0xfefefeff [ == ~(0x80808080<< 1) ]          R6 = 0x80808080  */
asm|asm (        "mov	r6, #0x80\n\ 	add	r6, r6, #0x8000\n\ 	add	r6, r6, r6, lsl #16\n\ 	mvn	r7, r6, lsl #1\n\ \n\ 0:\n\ 	cmp	%1, #0x7\n\ 	bls	1f\n\ \n\ 	ldmia	%0!, { r3, r9 }\n\ "	PRELOADSTR ("%0") "\n\ 	sub	%1, %1, #8\n\ 	eor	r3, r3, %2\n\ 	eor	r9, r9, %2\n\ 	add	r2, r3, r7\n\ 	add	r8, r9, r7\n\ 	bic	r2, r2, r3\n\ 	bic	r8, r8,	r9\n\ 	and	r1, r2, r6\n\ 	and	r9, r8, r6\n\ 	orrs	r1, r1, r9\n\ 	beq	0b\n\ \n\ 	add	%1, %1, #8\n\ 	sub	%0, %0, #8\n\ 1:\n\ 	cmp	%1, #0x3\n\ 	bls	2f\n\ \n\ 	ldr	r3, [%0], #4\n\ "	PRELOADSTR ("%0") "\n\ 	sub	%1, %1, #4\n\ 	eor	r3, r3, %2\n\ 	add	r2, r3, r7\n\ 	bic	r2, r2, r3\n\ 	ands	r1, r2, r6\n\ 	beq	1b\n\ \n\ 	sub	%0, %0, #4\n\ 	add	%1, %1, #4\n\ 2:\n\ "        : "=&r" (str), "=&r" (len)        : "r" (c2), "0" (str), "1" (len)        : "r1", "r2", "r3", "r6", "r7", "r8", "r9", "cc");
block|}
endif|#
directive|endif
while|while
condition|(
name|len
operator|--
operator|>
literal|0
condition|)
block|{
if|if
condition|(
operator|*
name|str
operator|==
name|c
condition|)
return|return
operator|(
name|void
operator|*
operator|)
name|str
return|;
name|str
operator|++
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

end_unit

