begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Disassemble SH instructions.    Copyright 1993, 1994, 1995, 1997, 1998, 2000, 2001, 2002, 2003, 2004, 2005    Free Software Foundation, Inc.     This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston,    MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_define
define|#
directive|define
name|STATIC_TABLE
end_define

begin_define
define|#
directive|define
name|DEFINE_TABLE
end_define

begin_include
include|#
directive|include
file|"sh-opc.h"
end_include

begin_include
include|#
directive|include
file|"dis-asm.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ARCH_all
end_ifdef

begin_define
define|#
directive|define
name|INCLUDE_SHMEDIA
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|void
name|print_movxy
parameter_list|(
specifier|const
name|sh_opcode_info
modifier|*
name|op
parameter_list|,
name|int
name|rn
parameter_list|,
name|int
name|rm
parameter_list|,
name|fprintf_ftype
name|fprintf_fn
parameter_list|,
name|void
modifier|*
name|stream
parameter_list|)
block|{
name|int
name|n
decl_stmt|;
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%s\t"
argument_list|,
name|op
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
literal|2
condition|;
name|n
operator|++
control|)
block|{
switch|switch
condition|(
name|op
operator|->
name|arg
index|[
name|n
index|]
condition|)
block|{
case|case
name|A_IND_N
case|:
case|case
name|AX_IND_N
case|:
case|case
name|AXY_IND_N
case|:
case|case
name|AY_IND_N
case|:
case|case
name|AYX_IND_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_INC_N
case|:
case|case
name|AX_INC_N
case|:
case|case
name|AXY_INC_N
case|:
case|case
name|AY_INC_N
case|:
case|case
name|AYX_INC_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|AX_PMOD_N
case|:
case|case
name|AXY_PMOD_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+r8"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|AY_PMOD_N
case|:
case|case
name|AYX_PMOD_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+r9"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_A_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a%c"
argument_list|,
literal|'0'
operator|+
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_X
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"x%c"
argument_list|,
literal|'0'
operator|+
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_Y
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"y%c"
argument_list|,
literal|'0'
operator|+
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_AX
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%c%c"
argument_list|,
operator|(
name|rm
operator|&
literal|1
operator|)
condition|?
literal|'x'
else|:
literal|'a'
argument_list|,
operator|(
name|rm
operator|&
literal|2
operator|)
condition|?
literal|'1'
else|:
literal|'0'
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_XY
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%c%c"
argument_list|,
operator|(
name|rm
operator|&
literal|1
operator|)
condition|?
literal|'y'
else|:
literal|'x'
argument_list|,
operator|(
name|rm
operator|&
literal|2
operator|)
condition|?
literal|'1'
else|:
literal|'0'
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_AY
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%c%c"
argument_list|,
operator|(
name|rm
operator|&
literal|2
operator|)
condition|?
literal|'y'
else|:
literal|'a'
argument_list|,
operator|(
name|rm
operator|&
literal|1
operator|)
condition|?
literal|'1'
else|:
literal|'0'
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_YX
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%c%c"
argument_list|,
operator|(
name|rm
operator|&
literal|2
operator|)
condition|?
literal|'x'
else|:
literal|'y'
argument_list|,
operator|(
name|rm
operator|&
literal|1
operator|)
condition|?
literal|'1'
else|:
literal|'0'
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|n
operator|==
literal|0
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|","
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Print a double data transfer insn.  INSN is just the lower three    nibbles of the insn, i.e. field a and the bit that indicates if    a parallel processing insn follows.    Return nonzero if a field b of a parallel processing insns follows.  */
end_comment

begin_function
specifier|static
name|void
name|print_insn_ddt
parameter_list|(
name|int
name|insn
parameter_list|,
name|struct
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
name|fprintf_ftype
name|fprintf_fn
init|=
name|info
operator|->
name|fprintf_func
decl_stmt|;
name|void
modifier|*
name|stream
init|=
name|info
operator|->
name|stream
decl_stmt|;
comment|/* If this is just a nop, make sure to emit something.  */
if|if
condition|(
name|insn
operator|==
literal|0x000
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"nopx\tnopy"
argument_list|)
expr_stmt|;
comment|/* If a parallel processing insn was printed before,      and we got a non-nop, emit a tab.  */
if|if
condition|(
operator|(
name|insn
operator|&
literal|0x800
operator|)
operator|&&
operator|(
name|insn
operator|&
literal|0x3ff
operator|)
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
comment|/* Check if either the x or y part is invalid.  */
if|if
condition|(
operator|(
operator|(
name|insn
operator|&
literal|0xc
operator|)
operator|==
literal|0
operator|&&
operator|(
name|insn
operator|&
literal|0x2a0
operator|)
operator|)
operator|||
operator|(
operator|(
name|insn
operator|&
literal|3
operator|)
operator|==
literal|0
operator|&&
operator|(
name|insn
operator|&
literal|0x150
operator|)
operator|)
condition|)
if|if
condition|(
name|info
operator|->
name|mach
operator|!=
name|bfd_mach_sh_dsp
operator|&&
name|info
operator|->
name|mach
operator|!=
name|bfd_mach_sh3_dsp
condition|)
block|{
specifier|static
specifier|const
name|sh_opcode_info
modifier|*
name|first_movx
decl_stmt|,
modifier|*
name|first_movy
decl_stmt|;
specifier|const
name|sh_opcode_info
modifier|*
name|op
decl_stmt|;
name|int
name|is_movy
decl_stmt|;
if|if
condition|(
operator|!
name|first_movx
condition|)
block|{
for|for
control|(
name|first_movx
operator|=
name|sh_table
init|;
name|first_movx
operator|->
name|nibbles
index|[
literal|1
index|]
operator|!=
name|MOVX_NOPY
condition|;
control|)
name|first_movx
operator|++
expr_stmt|;
for|for
control|(
name|first_movy
operator|=
name|first_movx
init|;
name|first_movy
operator|->
name|nibbles
index|[
literal|1
index|]
operator|!=
name|MOVY_NOPX
condition|;
control|)
name|first_movy
operator|++
expr_stmt|;
block|}
name|is_movy
operator|=
operator|(
operator|(
name|insn
operator|&
literal|3
operator|)
operator|!=
literal|0
operator|)
expr_stmt|;
if|if
condition|(
name|is_movy
condition|)
name|op
operator|=
name|first_movy
expr_stmt|;
else|else
name|op
operator|=
name|first_movx
expr_stmt|;
while|while
condition|(
name|op
operator|->
name|nibbles
index|[
literal|2
index|]
operator|!=
call|(
name|unsigned
call|)
argument_list|(
operator|(
name|insn
operator|>>
literal|4
operator|)
operator|&
literal|3
argument_list|)
operator|||
name|op
operator|->
name|nibbles
index|[
literal|3
index|]
operator|!=
call|(
name|unsigned
call|)
argument_list|(
name|insn
operator|&
literal|0xf
argument_list|)
condition|)
name|op
operator|++
expr_stmt|;
name|print_movxy
argument_list|(
name|op
argument_list|,
operator|(
literal|4
operator|*
operator|(
operator|(
name|insn
operator|&
operator|(
name|is_movy
condition|?
literal|0x200
else|:
literal|0x100
operator|)
operator|)
operator|==
literal|0
operator|)
operator|+
literal|2
operator|*
name|is_movy
operator|+
literal|1
operator|*
operator|(
operator|(
name|insn
operator|&
operator|(
name|is_movy
condition|?
literal|0x100
else|:
literal|0x200
operator|)
operator|)
operator|!=
literal|0
operator|)
operator|)
argument_list|,
operator|(
name|insn
operator|>>
literal|6
operator|)
operator|&
literal|3
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|".word 0x%x"
argument_list|,
name|insn
argument_list|)
expr_stmt|;
else|else
block|{
specifier|static
specifier|const
name|sh_opcode_info
modifier|*
name|first_movx
decl_stmt|,
modifier|*
name|first_movy
decl_stmt|;
specifier|const
name|sh_opcode_info
modifier|*
name|opx
decl_stmt|,
modifier|*
name|opy
decl_stmt|;
name|unsigned
name|int
name|insn_x
decl_stmt|,
name|insn_y
decl_stmt|;
if|if
condition|(
operator|!
name|first_movx
condition|)
block|{
for|for
control|(
name|first_movx
operator|=
name|sh_table
init|;
name|first_movx
operator|->
name|nibbles
index|[
literal|1
index|]
operator|!=
name|MOVX
condition|;
control|)
name|first_movx
operator|++
expr_stmt|;
for|for
control|(
name|first_movy
operator|=
name|first_movx
init|;
name|first_movy
operator|->
name|nibbles
index|[
literal|1
index|]
operator|!=
name|MOVY
condition|;
control|)
name|first_movy
operator|++
expr_stmt|;
block|}
name|insn_x
operator|=
operator|(
name|insn
operator|>>
literal|2
operator|)
operator|&
literal|0xb
expr_stmt|;
if|if
condition|(
name|insn_x
condition|)
block|{
for|for
control|(
name|opx
operator|=
name|first_movx
init|;
name|opx
operator|->
name|nibbles
index|[
literal|2
index|]
operator|!=
name|insn_x
condition|;
control|)
name|opx
operator|++
expr_stmt|;
name|print_movxy
argument_list|(
name|opx
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|9
operator|)
operator|&
literal|1
operator|)
operator|+
literal|4
argument_list|,
operator|(
name|insn
operator|>>
literal|7
operator|)
operator|&
literal|1
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
name|insn_y
operator|=
operator|(
name|insn
operator|&
literal|3
operator|)
operator||
operator|(
operator|(
name|insn
operator|>>
literal|1
operator|)
operator|&
literal|8
operator|)
expr_stmt|;
if|if
condition|(
name|insn_y
condition|)
block|{
if|if
condition|(
name|insn_x
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"\t"
argument_list|)
expr_stmt|;
for|for
control|(
name|opy
operator|=
name|first_movy
init|;
name|opy
operator|->
name|nibbles
index|[
literal|2
index|]
operator|!=
name|insn_y
condition|;
control|)
name|opy
operator|++
expr_stmt|;
name|print_movxy
argument_list|(
name|opy
argument_list|,
operator|(
operator|(
name|insn
operator|>>
literal|8
operator|)
operator|&
literal|1
operator|)
operator|+
literal|6
argument_list|,
operator|(
name|insn
operator|>>
literal|6
operator|)
operator|&
literal|1
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_dsp_reg
parameter_list|(
name|int
name|rm
parameter_list|,
name|fprintf_ftype
name|fprintf_fn
parameter_list|,
name|void
modifier|*
name|stream
parameter_list|)
block|{
switch|switch
condition|(
name|rm
condition|)
block|{
case|case
name|A_A1_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_A0_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_X0_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"x0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_X1_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"x1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_Y0_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"y0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_Y1_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"y1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_M0_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"m0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_A1G_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a1g"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_M1_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"m1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_A0G_NUM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a0g"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"0x%x"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_insn_ppi
parameter_list|(
name|int
name|field_b
parameter_list|,
name|struct
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|sx_tab
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"x1"
block|,
literal|"a0"
block|,
literal|"a1"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|sy_tab
index|[]
init|=
block|{
literal|"y0"
block|,
literal|"y1"
block|,
literal|"m0"
block|,
literal|"m1"
block|}
decl_stmt|;
name|fprintf_ftype
name|fprintf_fn
init|=
name|info
operator|->
name|fprintf_func
decl_stmt|;
name|void
modifier|*
name|stream
init|=
name|info
operator|->
name|stream
decl_stmt|;
name|unsigned
name|int
name|nib1
decl_stmt|,
name|nib2
decl_stmt|,
name|nib3
decl_stmt|;
name|unsigned
name|int
name|altnib1
decl_stmt|,
name|nib4
decl_stmt|;
name|char
modifier|*
name|dc
init|=
name|NULL
decl_stmt|;
specifier|const
name|sh_opcode_info
modifier|*
name|op
decl_stmt|;
if|if
condition|(
operator|(
name|field_b
operator|&
literal|0xe800
operator|)
operator|==
literal|0
condition|)
block|{
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"psh%c\t#%d,"
argument_list|,
name|field_b
operator|&
literal|0x1000
condition|?
literal|'a'
else|:
literal|'l'
argument_list|,
operator|(
name|field_b
operator|>>
literal|4
operator|)
operator|&
literal|127
argument_list|)
expr_stmt|;
name|print_dsp_reg
argument_list|(
name|field_b
operator|&
literal|0xf
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|(
name|field_b
operator|&
literal|0xc000
operator|)
operator|==
literal|0x4000
operator|&&
operator|(
name|field_b
operator|&
literal|0x3000
operator|)
operator|!=
literal|0x1000
condition|)
block|{
specifier|static
name|char
modifier|*
name|du_tab
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"a0"
block|,
literal|"a1"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|se_tab
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"x1"
block|,
literal|"y0"
block|,
literal|"a1"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|sf_tab
index|[]
init|=
block|{
literal|"y0"
block|,
literal|"y1"
block|,
literal|"x0"
block|,
literal|"a1"
block|}
decl_stmt|;
specifier|static
name|char
modifier|*
name|sg_tab
index|[]
init|=
block|{
literal|"m0"
block|,
literal|"m1"
block|,
literal|"a0"
block|,
literal|"a1"
block|}
decl_stmt|;
if|if
condition|(
name|field_b
operator|&
literal|0x2000
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"p%s %s,%s,%s\t"
argument_list|,
operator|(
name|field_b
operator|&
literal|0x1000
operator|)
condition|?
literal|"add"
else|:
literal|"sub"
argument_list|,
name|sx_tab
index|[
operator|(
name|field_b
operator|>>
literal|6
operator|)
operator|&
literal|3
index|]
argument_list|,
name|sy_tab
index|[
operator|(
name|field_b
operator|>>
literal|4
operator|)
operator|&
literal|3
index|]
argument_list|,
name|du_tab
index|[
operator|(
name|field_b
operator|>>
literal|0
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|field_b
operator|&
literal|0xf0
operator|)
operator|==
literal|0x10
operator|&&
name|info
operator|->
name|mach
operator|!=
name|bfd_mach_sh_dsp
operator|&&
name|info
operator|->
name|mach
operator|!=
name|bfd_mach_sh3_dsp
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"pclr %s \t"
argument_list|,
name|du_tab
index|[
operator|(
name|field_b
operator|>>
literal|0
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|field_b
operator|&
literal|0xf3
operator|)
operator|!=
literal|0
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|".word 0x%x\t"
argument_list|,
name|field_b
argument_list|)
expr_stmt|;
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"pmuls%c%s,%s,%s"
argument_list|,
name|field_b
operator|&
literal|0x2000
condition|?
literal|' '
else|:
literal|'\t'
argument_list|,
name|se_tab
index|[
operator|(
name|field_b
operator|>>
literal|10
operator|)
operator|&
literal|3
index|]
argument_list|,
name|sf_tab
index|[
operator|(
name|field_b
operator|>>
literal|8
operator|)
operator|&
literal|3
index|]
argument_list|,
name|sg_tab
index|[
operator|(
name|field_b
operator|>>
literal|2
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
name|nib1
operator|=
name|PPIC
expr_stmt|;
name|nib2
operator|=
name|field_b
operator|>>
literal|12
operator|&
literal|0xf
expr_stmt|;
name|nib3
operator|=
name|field_b
operator|>>
literal|8
operator|&
literal|0xf
expr_stmt|;
name|nib4
operator|=
name|field_b
operator|>>
literal|4
operator|&
literal|0xf
expr_stmt|;
switch|switch
condition|(
name|nib3
operator|&
literal|0x3
condition|)
block|{
case|case
literal|0
case|:
name|dc
operator|=
literal|""
expr_stmt|;
name|nib1
operator|=
name|PPI3
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|dc
operator|=
literal|""
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|dc
operator|=
literal|"dct "
expr_stmt|;
name|nib3
operator|-=
literal|1
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|dc
operator|=
literal|"dcf "
expr_stmt|;
name|nib3
operator|-=
literal|2
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|nib1
operator|==
name|PPI3
condition|)
name|altnib1
operator|=
name|PPI3NC
expr_stmt|;
else|else
name|altnib1
operator|=
name|nib1
expr_stmt|;
for|for
control|(
name|op
operator|=
name|sh_table
init|;
name|op
operator|->
name|name
condition|;
name|op
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|op
operator|->
name|nibbles
index|[
literal|1
index|]
operator|==
name|nib1
operator|||
name|op
operator|->
name|nibbles
index|[
literal|1
index|]
operator|==
name|altnib1
operator|)
operator|&&
name|op
operator|->
name|nibbles
index|[
literal|2
index|]
operator|==
name|nib2
operator|&&
name|op
operator|->
name|nibbles
index|[
literal|3
index|]
operator|==
name|nib3
condition|)
block|{
name|int
name|n
decl_stmt|;
switch|switch
condition|(
name|op
operator|->
name|nibbles
index|[
literal|4
index|]
condition|)
block|{
case|case
name|HEX_0
case|:
break|break;
case|case
name|HEX_XX00
case|:
if|if
condition|(
operator|(
name|nib4
operator|&
literal|3
operator|)
operator|!=
literal|0
condition|)
continue|continue;
break|break;
case|case
name|HEX_1
case|:
if|if
condition|(
operator|(
name|nib4
operator|&
literal|3
operator|)
operator|!=
literal|1
condition|)
continue|continue;
break|break;
case|case
name|HEX_00YY
case|:
if|if
condition|(
operator|(
name|nib4
operator|&
literal|0xc
operator|)
operator|!=
literal|0
condition|)
continue|continue;
break|break;
case|case
name|HEX_4
case|:
if|if
condition|(
operator|(
name|nib4
operator|&
literal|0xc
operator|)
operator|!=
literal|4
condition|)
continue|continue;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%s%s\t"
argument_list|,
name|dc
argument_list|,
name|op
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
literal|3
operator|&&
name|op
operator|->
name|arg
index|[
name|n
index|]
operator|!=
name|A_END
condition|;
name|n
operator|++
control|)
block|{
if|if
condition|(
name|n
operator|&&
name|op
operator|->
name|arg
index|[
literal|1
index|]
operator|!=
name|A_END
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|","
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op
operator|->
name|arg
index|[
name|n
index|]
condition|)
block|{
case|case
name|DSP_REG_N
case|:
name|print_dsp_reg
argument_list|(
name|field_b
operator|&
literal|0xf
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_X
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
name|sx_tab
index|[
operator|(
name|field_b
operator|>>
literal|6
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_Y
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
name|sy_tab
index|[
operator|(
name|field_b
operator|>>
literal|4
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_MACH
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"mach"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_MACL
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"macl"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
return|return;
block|}
block|}
comment|/* Not found.  */
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|".word 0x%x"
argument_list|,
name|field_b
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* FIXME mvs: movx insns print as ".word 0x%03x", insn& 0xfff    (ie. the upper nibble is missing).  */
end_comment

begin_function
name|int
name|print_insn_sh
parameter_list|(
name|bfd_vma
name|memaddr
parameter_list|,
name|struct
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
name|fprintf_ftype
name|fprintf_fn
init|=
name|info
operator|->
name|fprintf_func
decl_stmt|;
name|void
modifier|*
name|stream
init|=
name|info
operator|->
name|stream
decl_stmt|;
name|unsigned
name|char
name|insn
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|char
name|nibs
index|[
literal|8
index|]
decl_stmt|;
name|int
name|status
decl_stmt|;
name|bfd_vma
name|relmask
init|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|0
decl_stmt|;
specifier|const
name|sh_opcode_info
modifier|*
name|op
decl_stmt|;
name|unsigned
name|int
name|target_arch
decl_stmt|;
name|int
name|allow_op32
decl_stmt|;
switch|switch
condition|(
name|info
operator|->
name|mach
condition|)
block|{
case|case
name|bfd_mach_sh
case|:
name|target_arch
operator|=
name|arch_sh1
expr_stmt|;
comment|/* SH coff object files lack information about the machine type, so          we end up with bfd_mach_sh unless it was set explicitly (which 	 could have happended if this is a call from gdb or the simulator.)  */
if|if
condition|(
name|info
operator|->
name|symbols
operator|&&
name|bfd_asymbol_flavour
argument_list|(
operator|*
name|info
operator|->
name|symbols
argument_list|)
operator|==
name|bfd_target_coff_flavour
condition|)
name|target_arch
operator|=
name|arch_sh4
expr_stmt|;
break|break;
case|case
name|bfd_mach_sh5
case|:
ifdef|#
directive|ifdef
name|INCLUDE_SHMEDIA
name|status
operator|=
name|print_insn_sh64
argument_list|(
name|memaddr
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
operator|-
literal|2
condition|)
return|return
name|status
return|;
endif|#
directive|endif
comment|/* When we get here for sh64, it's because we want to disassemble 	 SHcompact, i.e. arch_sh4.  */
name|target_arch
operator|=
name|arch_sh4
expr_stmt|;
break|break;
default|default:
name|target_arch
operator|=
name|sh_get_arch_from_bfd_mach
argument_list|(
name|info
operator|->
name|mach
argument_list|)
expr_stmt|;
block|}
name|status
operator|=
name|info
operator|->
name|read_memory_func
argument_list|(
name|memaddr
argument_list|,
name|insn
argument_list|,
literal|2
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
block|{
name|info
operator|->
name|memory_error_func
argument_list|(
name|status
argument_list|,
name|memaddr
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_LITTLE
condition|)
block|{
name|nibs
index|[
literal|0
index|]
operator|=
operator|(
name|insn
index|[
literal|1
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|1
index|]
operator|=
name|insn
index|[
literal|1
index|]
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|2
index|]
operator|=
operator|(
name|insn
index|[
literal|0
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|3
index|]
operator|=
name|insn
index|[
literal|0
index|]
operator|&
literal|0xf
expr_stmt|;
block|}
else|else
block|{
name|nibs
index|[
literal|0
index|]
operator|=
operator|(
name|insn
index|[
literal|0
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|1
index|]
operator|=
name|insn
index|[
literal|0
index|]
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|2
index|]
operator|=
operator|(
name|insn
index|[
literal|1
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|3
index|]
operator|=
name|insn
index|[
literal|1
index|]
operator|&
literal|0xf
expr_stmt|;
block|}
name|status
operator|=
name|info
operator|->
name|read_memory_func
argument_list|(
name|memaddr
operator|+
literal|2
argument_list|,
name|insn
operator|+
literal|2
argument_list|,
literal|2
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
name|allow_op32
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|allow_op32
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_LITTLE
condition|)
block|{
name|nibs
index|[
literal|4
index|]
operator|=
operator|(
name|insn
index|[
literal|3
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|5
index|]
operator|=
name|insn
index|[
literal|3
index|]
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|6
index|]
operator|=
operator|(
name|insn
index|[
literal|2
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|7
index|]
operator|=
name|insn
index|[
literal|2
index|]
operator|&
literal|0xf
expr_stmt|;
block|}
else|else
block|{
name|nibs
index|[
literal|4
index|]
operator|=
operator|(
name|insn
index|[
literal|2
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|5
index|]
operator|=
name|insn
index|[
literal|2
index|]
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|6
index|]
operator|=
operator|(
name|insn
index|[
literal|3
index|]
operator|>>
literal|4
operator|)
operator|&
literal|0xf
expr_stmt|;
name|nibs
index|[
literal|7
index|]
operator|=
name|insn
index|[
literal|3
index|]
operator|&
literal|0xf
expr_stmt|;
block|}
block|}
if|if
condition|(
name|nibs
index|[
literal|0
index|]
operator|==
literal|0xf
operator|&&
operator|(
name|nibs
index|[
literal|1
index|]
operator|&
literal|4
operator|)
operator|==
literal|0
operator|&&
name|SH_MERGE_ARCH_SET_VALID
argument_list|(
name|target_arch
argument_list|,
name|arch_sh_dsp_up
argument_list|)
condition|)
block|{
if|if
condition|(
name|nibs
index|[
literal|1
index|]
operator|&
literal|8
condition|)
block|{
name|int
name|field_b
decl_stmt|;
name|status
operator|=
name|info
operator|->
name|read_memory_func
argument_list|(
name|memaddr
operator|+
literal|2
argument_list|,
name|insn
argument_list|,
literal|2
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
block|{
name|info
operator|->
name|memory_error_func
argument_list|(
name|status
argument_list|,
name|memaddr
operator|+
literal|2
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_LITTLE
condition|)
name|field_b
operator|=
name|insn
index|[
literal|1
index|]
operator|<<
literal|8
operator||
name|insn
index|[
literal|0
index|]
expr_stmt|;
else|else
name|field_b
operator|=
name|insn
index|[
literal|0
index|]
operator|<<
literal|8
operator||
name|insn
index|[
literal|1
index|]
expr_stmt|;
name|print_insn_ppi
argument_list|(
name|field_b
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|print_insn_ddt
argument_list|(
operator|(
name|nibs
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
literal|4
return|;
block|}
name|print_insn_ddt
argument_list|(
operator|(
name|nibs
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
literal|2
return|;
block|}
for|for
control|(
name|op
operator|=
name|sh_table
init|;
name|op
operator|->
name|name
condition|;
name|op
operator|++
control|)
block|{
name|int
name|n
decl_stmt|;
name|int
name|imm
init|=
literal|0
decl_stmt|;
name|int
name|rn
init|=
literal|0
decl_stmt|;
name|int
name|rm
init|=
literal|0
decl_stmt|;
name|int
name|rb
init|=
literal|0
decl_stmt|;
name|int
name|disp_pc
decl_stmt|;
name|bfd_vma
name|disp_pc_addr
init|=
literal|0
decl_stmt|;
name|int
name|disp
init|=
literal|0
decl_stmt|;
name|int
name|has_disp
init|=
literal|0
decl_stmt|;
name|int
name|max_n
init|=
name|SH_MERGE_ARCH_SET
argument_list|(
name|op
operator|->
name|arch
argument_list|,
name|arch_op32
argument_list|)
condition|?
literal|8
else|:
literal|4
decl_stmt|;
if|if
condition|(
operator|!
name|allow_op32
operator|&&
name|SH_MERGE_ARCH_SET
argument_list|(
name|op
operator|->
name|arch
argument_list|,
name|arch_op32
argument_list|)
condition|)
goto|goto
name|fail
goto|;
if|if
condition|(
operator|!
name|SH_MERGE_ARCH_SET_VALID
argument_list|(
name|op
operator|->
name|arch
argument_list|,
name|target_arch
argument_list|)
condition|)
goto|goto
name|fail
goto|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|max_n
condition|;
name|n
operator|++
control|)
block|{
name|int
name|i
init|=
name|op
operator|->
name|nibbles
index|[
name|n
index|]
decl_stmt|;
if|if
condition|(
name|i
operator|<
literal|16
condition|)
block|{
if|if
condition|(
name|nibs
index|[
name|n
index|]
operator|==
name|i
condition|)
continue|continue;
goto|goto
name|fail
goto|;
block|}
switch|switch
condition|(
name|i
condition|)
block|{
case|case
name|BRANCH_8
case|:
name|imm
operator|=
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
operator|(
name|nibs
index|[
literal|3
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|imm
operator|&
literal|0x80
condition|)
name|imm
operator||=
operator|~
literal|0xff
expr_stmt|;
name|imm
operator|=
operator|(
operator|(
name|char
operator|)
name|imm
operator|)
operator|*
literal|2
operator|+
literal|4
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|BRANCH_12
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|1
index|]
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
operator|(
name|nibs
index|[
literal|3
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|imm
operator|&
literal|0x800
condition|)
name|imm
operator||=
operator|~
literal|0xfff
expr_stmt|;
name|imm
operator|=
name|imm
operator|*
literal|2
operator|+
literal|4
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_3c
case|:
if|if
condition|(
name|nibs
index|[
literal|3
index|]
operator|&
literal|0x8
condition|)
goto|goto
name|fail
goto|;
name|imm
operator|=
name|nibs
index|[
literal|3
index|]
operator|&
literal|0x7
expr_stmt|;
break|break;
case|case
name|IMM0_3s
case|:
if|if
condition|(
operator|!
operator|(
name|nibs
index|[
literal|3
index|]
operator|&
literal|0x8
operator|)
condition|)
goto|goto
name|fail
goto|;
name|imm
operator|=
name|nibs
index|[
literal|3
index|]
operator|&
literal|0x7
expr_stmt|;
break|break;
case|case
name|IMM0_3Uc
case|:
if|if
condition|(
name|nibs
index|[
literal|2
index|]
operator|&
literal|0x8
condition|)
goto|goto
name|fail
goto|;
name|imm
operator|=
name|nibs
index|[
literal|2
index|]
operator|&
literal|0x7
expr_stmt|;
break|break;
case|case
name|IMM0_3Us
case|:
if|if
condition|(
operator|!
operator|(
name|nibs
index|[
literal|2
index|]
operator|&
literal|0x8
operator|)
condition|)
goto|goto
name|fail
goto|;
name|imm
operator|=
name|nibs
index|[
literal|2
index|]
operator|&
literal|0x7
expr_stmt|;
break|break;
case|case
name|DISP0_12
case|:
case|case
name|DISP1_12
case|:
name|disp
operator|=
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
expr_stmt|;
name|has_disp
operator|=
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|DISP0_12BY2
case|:
case|case
name|DISP1_12BY2
case|:
name|disp
operator|=
operator|(
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
operator|)
operator|<<
literal|1
expr_stmt|;
name|relmask
operator|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|1
expr_stmt|;
name|has_disp
operator|=
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|DISP0_12BY4
case|:
case|case
name|DISP1_12BY4
case|:
name|disp
operator|=
operator|(
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
operator|)
operator|<<
literal|2
expr_stmt|;
name|relmask
operator|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|3
expr_stmt|;
name|has_disp
operator|=
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|DISP0_12BY8
case|:
case|case
name|DISP1_12BY8
case|:
name|disp
operator|=
operator|(
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
operator|)
operator|<<
literal|3
expr_stmt|;
name|relmask
operator|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|7
expr_stmt|;
name|has_disp
operator|=
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_20_4
case|:
break|break;
case|case
name|IMM0_20
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|nibs
index|[
literal|4
index|]
operator|<<
literal|12
operator|)
operator||
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
operator|)
expr_stmt|;
if|if
condition|(
name|imm
operator|&
literal|0x80000
condition|)
name|imm
operator|-=
literal|0x100000
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_20BY8
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
operator||
operator|(
name|nibs
index|[
literal|4
index|]
operator|<<
literal|12
operator|)
operator||
operator|(
name|nibs
index|[
literal|5
index|]
operator|<<
literal|8
operator|)
operator||
operator|(
name|nibs
index|[
literal|6
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|7
index|]
operator|)
expr_stmt|;
name|imm
operator|<<=
literal|8
expr_stmt|;
if|if
condition|(
name|imm
operator|&
literal|0x8000000
condition|)
name|imm
operator|-=
literal|0x10000000
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_4
case|:
case|case
name|IMM1_4
case|:
name|imm
operator|=
name|nibs
index|[
literal|3
index|]
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_4BY2
case|:
case|case
name|IMM1_4BY2
case|:
name|imm
operator|=
name|nibs
index|[
literal|3
index|]
operator|<<
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_4BY4
case|:
case|case
name|IMM1_4BY4
case|:
name|imm
operator|=
name|nibs
index|[
literal|3
index|]
operator|<<
literal|2
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_8
case|:
case|case
name|IMM1_8
case|:
name|imm
operator|=
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
expr_stmt|;
name|disp
operator|=
name|imm
expr_stmt|;
name|has_disp
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|imm
operator|&
literal|0x80
condition|)
name|imm
operator|-=
literal|0x100
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|PCRELIMM_8BY2
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
operator|)
operator|<<
literal|1
expr_stmt|;
name|relmask
operator|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|PCRELIMM_8BY4
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
operator|)
operator|<<
literal|2
expr_stmt|;
name|relmask
operator|=
operator|~
operator|(
name|bfd_vma
operator|)
literal|3
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_8BY2
case|:
case|case
name|IMM1_8BY2
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
operator|)
operator|<<
literal|1
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|IMM0_8BY4
case|:
case|case
name|IMM1_8BY4
case|:
name|imm
operator|=
operator|(
operator|(
name|nibs
index|[
literal|2
index|]
operator|<<
literal|4
operator|)
operator||
name|nibs
index|[
literal|3
index|]
operator|)
operator|<<
literal|2
expr_stmt|;
goto|goto
name|ok
goto|;
case|case
name|REG_N_D
case|:
if|if
condition|(
operator|(
name|nibs
index|[
name|n
index|]
operator|&
literal|1
operator|)
operator|!=
literal|0
condition|)
goto|goto
name|fail
goto|;
comment|/* Fall through.  */
case|case
name|REG_N
case|:
name|rn
operator|=
name|nibs
index|[
name|n
index|]
expr_stmt|;
break|break;
case|case
name|REG_M
case|:
name|rm
operator|=
name|nibs
index|[
name|n
index|]
expr_stmt|;
break|break;
case|case
name|REG_N_B01
case|:
if|if
condition|(
operator|(
name|nibs
index|[
name|n
index|]
operator|&
literal|0x3
operator|)
operator|!=
literal|1
comment|/* binary 01 */
condition|)
goto|goto
name|fail
goto|;
name|rn
operator|=
operator|(
name|nibs
index|[
name|n
index|]
operator|&
literal|0xc
operator|)
operator|>>
literal|2
expr_stmt|;
break|break;
case|case
name|REG_NM
case|:
name|rn
operator|=
operator|(
name|nibs
index|[
name|n
index|]
operator|&
literal|0xc
operator|)
operator|>>
literal|2
expr_stmt|;
name|rm
operator|=
operator|(
name|nibs
index|[
name|n
index|]
operator|&
literal|0x3
operator|)
expr_stmt|;
break|break;
case|case
name|REG_B
case|:
name|rb
operator|=
name|nibs
index|[
name|n
index|]
operator|&
literal|0x07
expr_stmt|;
break|break;
case|case
name|SDT_REG_N
case|:
comment|/* sh-dsp: single data transfer.  */
name|rn
operator|=
name|nibs
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|rn
operator|&
literal|0xc
operator|)
operator|!=
literal|4
condition|)
goto|goto
name|fail
goto|;
name|rn
operator|=
name|rn
operator|&
literal|0x3
expr_stmt|;
name|rn
operator||=
operator|(
operator|!
operator|(
name|rn
operator|&
literal|2
operator|)
operator|)
operator|<<
literal|2
expr_stmt|;
break|break;
case|case
name|PPI
case|:
case|case
name|REPEAT
case|:
goto|goto
name|fail
goto|;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
name|ok
label|:
comment|/* sh2a has D_REG but not X_REG.  We don't know the pattern 	 doesn't match unless we check the output args to see if they 	 make sense.  */
if|if
condition|(
name|target_arch
operator|==
name|arch_sh2a
operator|&&
operator|(
operator|(
name|op
operator|->
name|arg
index|[
literal|0
index|]
operator|==
name|DX_REG_M
operator|&&
operator|(
name|rm
operator|&
literal|1
operator|)
operator|!=
literal|0
operator|)
operator|||
operator|(
name|op
operator|->
name|arg
index|[
literal|1
index|]
operator|==
name|DX_REG_N
operator|&&
operator|(
name|rn
operator|&
literal|1
operator|)
operator|!=
literal|0
operator|)
operator|)
condition|)
goto|goto
name|fail
goto|;
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"%s\t"
argument_list|,
name|op
operator|->
name|name
argument_list|)
expr_stmt|;
name|disp_pc
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
literal|3
operator|&&
name|op
operator|->
name|arg
index|[
name|n
index|]
operator|!=
name|A_END
condition|;
name|n
operator|++
control|)
block|{
if|if
condition|(
name|n
operator|&&
name|op
operator|->
name|arg
index|[
literal|1
index|]
operator|!=
name|A_END
condition|)
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|","
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op
operator|->
name|arg
index|[
name|n
index|]
condition|)
block|{
case|case
name|A_IMM
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"#%d"
argument_list|,
name|imm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_R0
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"r0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"r%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_INC_N
case|:
case|case
name|AS_INC_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DEC_N
case|:
case|case
name|AS_DEC_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@-r%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_IND_N
case|:
case|case
name|AS_IND_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DISP_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(%d,r%d)"
argument_list|,
name|has_disp
condition|?
name|disp
else|:
name|imm
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|AS_PMOD_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+r8"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"r%d"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_INC_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d+"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DEC_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@-r%d"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_IND_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r%d"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DISP_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(%d,r%d)"
argument_list|,
name|has_disp
condition|?
name|disp
else|:
name|imm
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_REG_B
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"r%d_bank"
argument_list|,
name|rb
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DISP_PC
case|:
name|disp_pc
operator|=
literal|1
expr_stmt|;
name|disp_pc_addr
operator|=
name|imm
operator|+
literal|4
operator|+
operator|(
name|memaddr
operator|&
name|relmask
operator|)
expr_stmt|;
call|(
modifier|*
name|info
operator|->
name|print_address_func
call|)
argument_list|(
name|disp_pc_addr
argument_list|,
name|info
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_IND_R0_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(r0,r%d)"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_IND_R0_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(r0,r%d)"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DISP_GBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(%d,gbr)"
argument_list|,
name|has_disp
condition|?
name|disp
else|:
name|imm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_TBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"tbr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DISP2_TBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@@(%d,tbr)"
argument_list|,
name|has_disp
condition|?
name|disp
else|:
name|imm
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_INC_R15
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@r15+"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DEC_R15
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@-r15"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_R0_GBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"@(r0,gbr)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_BDISP12
case|:
case|case
name|A_BDISP8
case|:
call|(
modifier|*
name|info
operator|->
name|print_address_func
call|)
argument_list|(
name|imm
operator|+
name|memaddr
argument_list|,
name|info
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_SR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"sr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_GBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"gbr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_VBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"vbr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DSR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"dsr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_MOD
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"mod"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_RE
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"re"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_RS
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"rs"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_A0
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"a0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_X0
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"x0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_X1
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"x1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_Y0
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"y0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_Y1
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"y1"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DSP_REG_M
case|:
name|print_dsp_reg
argument_list|(
name|rm
argument_list|,
name|fprintf_fn
argument_list|,
name|stream
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_SSR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"ssr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_SPC
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"spc"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_MACH
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"mach"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_MACL
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"macl"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_PR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"pr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_SGR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"sgr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|A_DBR
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"dbr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|F_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fr%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|F_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fr%d"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|DX_REG_N
case|:
if|if
condition|(
name|rn
operator|&
literal|1
condition|)
block|{
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"xd%d"
argument_list|,
name|rn
operator|&
operator|~
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|D_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"dr%d"
argument_list|,
name|rn
argument_list|)
expr_stmt|;
break|break;
case|case
name|DX_REG_M
case|:
if|if
condition|(
name|rm
operator|&
literal|1
condition|)
block|{
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"xd%d"
argument_list|,
name|rm
operator|&
operator|~
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|D_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"dr%d"
argument_list|,
name|rm
argument_list|)
expr_stmt|;
break|break;
case|case
name|FPSCR_M
case|:
case|case
name|FPSCR_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fpscr"
argument_list|)
expr_stmt|;
break|break;
case|case
name|FPUL_M
case|:
case|case
name|FPUL_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fpul"
argument_list|)
expr_stmt|;
break|break;
case|case
name|F_FR0
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fr0"
argument_list|)
expr_stmt|;
break|break;
case|case
name|V_REG_N
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fv%d"
argument_list|,
name|rn
operator|*
literal|4
argument_list|)
expr_stmt|;
break|break;
case|case
name|V_REG_M
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"fv%d"
argument_list|,
name|rm
operator|*
literal|4
argument_list|)
expr_stmt|;
break|break;
case|case
name|XMTRX_M4
case|:
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"xmtrx"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
if|#
directive|if
literal|0
comment|/* This code prints instructions in delay slots on the same line          as the instruction which needs the delay slots.  This can be          confusing, since other disassembler don't work this way, and          it means that the instructions are not all in a line.  So I          disabled it.  Ian.  */
block|if (!(info->flags& 1)&& (op->name[0] == 'j' 	      || (op->name[0] == 'b'&& (op->name[1] == 'r' 		      || op->name[1] == 's')) 	      || (op->name[0] == 'r'&& op->name[1] == 't') 	      || (op->name[0] == 'b'&& op->name[2] == '.'))) 	{ 	  info->flags |= 1; 	  fprintf_fn (stream, "\t(slot "); 	  print_insn_sh (memaddr + 2, info); 	  info->flags&= ~1; 	  fprintf_fn (stream, ")"); 	  return 4; 	}
endif|#
directive|endif
if|if
condition|(
name|disp_pc
operator|&&
name|strcmp
argument_list|(
name|op
operator|->
name|name
argument_list|,
literal|"mova"
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|int
name|size
decl_stmt|;
name|bfd_byte
name|bytes
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
name|relmask
operator|==
operator|~
operator|(
name|bfd_vma
operator|)
literal|1
condition|)
name|size
operator|=
literal|2
expr_stmt|;
else|else
name|size
operator|=
literal|4
expr_stmt|;
name|status
operator|=
name|info
operator|->
name|read_memory_func
argument_list|(
name|disp_pc_addr
argument_list|,
name|bytes
argument_list|,
name|size
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
literal|0
condition|)
block|{
name|unsigned
name|int
name|val
decl_stmt|;
if|if
condition|(
name|size
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_LITTLE
condition|)
name|val
operator|=
name|bfd_getl16
argument_list|(
name|bytes
argument_list|)
expr_stmt|;
else|else
name|val
operator|=
name|bfd_getb16
argument_list|(
name|bytes
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_LITTLE
condition|)
name|val
operator|=
name|bfd_getl32
argument_list|(
name|bytes
argument_list|)
expr_stmt|;
else|else
name|val
operator|=
name|bfd_getb32
argument_list|(
name|bytes
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
call|(
modifier|*
name|info
operator|->
name|symbol_at_address_func
call|)
argument_list|(
name|val
argument_list|,
name|info
argument_list|)
condition|)
block|{
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"\t! 0x"
argument_list|)
expr_stmt|;
call|(
modifier|*
name|info
operator|->
name|print_address_func
call|)
argument_list|(
name|val
argument_list|,
name|info
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|"\t! 0x%x"
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|SH_MERGE_ARCH_SET
argument_list|(
name|op
operator|->
name|arch
argument_list|,
name|arch_op32
argument_list|)
condition|?
literal|4
else|:
literal|2
return|;
name|fail
label|:
empty_stmt|;
block|}
name|fprintf_fn
argument_list|(
name|stream
argument_list|,
literal|".word 0x%x%x%x%x"
argument_list|,
name|nibs
index|[
literal|0
index|]
argument_list|,
name|nibs
index|[
literal|1
index|]
argument_list|,
name|nibs
index|[
literal|2
index|]
argument_list|,
name|nibs
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
return|return
literal|2
return|;
block|}
end_function

end_unit

