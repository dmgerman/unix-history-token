begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Disassembler interface for targets using CGEN. -*- C -*-    CGEN: Cpu tools GENerator  THIS FILE IS MACHINE GENERATED WITH CGEN. - the resultant file is machine generated, cgen-dis.in isn't  Copyright 1996, 1997, 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.  This file is part of the GNU Binutils and GDB, the GNU debugger.  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* ??? Eventually more and more of this stuff can go to cpu-independent files.    Keep that in mind.  */
end_comment

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"ansidecl.h"
end_include

begin_include
include|#
directive|include
file|"dis-asm.h"
end_include

begin_include
include|#
directive|include
file|"bfd.h"
end_include

begin_include
include|#
directive|include
file|"symcat.h"
end_include

begin_include
include|#
directive|include
file|"libiberty.h"
end_include

begin_include
include|#
directive|include
file|"fr30-desc.h"
end_include

begin_include
include|#
directive|include
file|"fr30-opc.h"
end_include

begin_include
include|#
directive|include
file|"opintl.h"
end_include

begin_comment
comment|/* Default text to print if an instruction isn't recognized.  */
end_comment

begin_define
define|#
directive|define
name|UNKNOWN_INSN_MSG
value|_("*unknown*")
end_define

begin_function_decl
specifier|static
name|void
name|print_normal
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|void
modifier|*
parameter_list|,
name|long
parameter_list|,
name|unsigned
name|int
parameter_list|,
name|bfd_vma
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_address
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|void
modifier|*
parameter_list|,
name|bfd_vma
parameter_list|,
name|unsigned
name|int
parameter_list|,
name|bfd_vma
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_keyword
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|void
modifier|*
parameter_list|,
name|CGEN_KEYWORD
modifier|*
parameter_list|,
name|long
parameter_list|,
name|unsigned
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_insn_normal
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|void
modifier|*
parameter_list|,
specifier|const
name|CGEN_INSN
modifier|*
parameter_list|,
name|CGEN_FIELDS
modifier|*
parameter_list|,
name|bfd_vma
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|print_insn
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|bfd_vma
parameter_list|,
name|disassemble_info
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|unsigned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|default_print_insn
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|bfd_vma
parameter_list|,
name|disassemble_info
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|read_insn
parameter_list|(
name|CGEN_CPU_DESC
parameter_list|,
name|bfd_vma
parameter_list|,
name|disassemble_info
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|CGEN_EXTRACT_INFO
modifier|*
parameter_list|,
name|unsigned
name|long
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_escape
end_escape

begin_comment
comment|/* -- disassembler routines inserted here */
end_comment

begin_comment
comment|/* -- dis.c */
end_comment

begin_decl_stmt
specifier|static
name|void
name|print_register_list
name|PARAMS
argument_list|(
operator|(
name|PTR
operator|,
name|long
operator|,
name|long
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_hi_register_list_ld
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|PTR
operator|,
name|long
operator|,
name|unsigned
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_low_register_list_ld
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|PTR
operator|,
name|long
operator|,
name|unsigned
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_hi_register_list_st
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|PTR
operator|,
name|long
operator|,
name|unsigned
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_low_register_list_st
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|PTR
operator|,
name|long
operator|,
name|unsigned
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|void
name|print_m4
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|PTR
operator|,
name|long
operator|,
name|unsigned
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|print_register_list
parameter_list|(
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|offset
parameter_list|,
name|load_store
parameter_list|)
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|long
name|offset
decl_stmt|;
name|int
name|load_store
decl_stmt|;
comment|/* 0 == load, 1 == store */
block|{
name|disassemble_info
modifier|*
name|info
init|=
name|dis_info
decl_stmt|;
name|int
name|mask
decl_stmt|;
name|int
name|index
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|comma
init|=
literal|""
decl_stmt|;
if|if
condition|(
name|load_store
condition|)
name|mask
operator|=
literal|0x80
expr_stmt|;
else|else
name|mask
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
name|mask
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"r%i"
argument_list|,
name|index
operator|+
name|offset
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|","
expr_stmt|;
block|}
for|for
control|(
name|index
operator|=
literal|1
init|;
name|index
operator|<=
literal|7
condition|;
operator|++
name|index
control|)
block|{
if|if
condition|(
name|load_store
condition|)
name|mask
operator|>>=
literal|1
expr_stmt|;
else|else
name|mask
operator|<<=
literal|1
expr_stmt|;
if|if
condition|(
name|value
operator|&
name|mask
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%sr%i"
argument_list|,
name|comma
argument_list|,
name|index
operator|+
name|offset
argument_list|)
expr_stmt|;
name|comma
operator|=
literal|","
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|print_hi_register_list_ld
parameter_list|(
name|cd
parameter_list|,
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|int
name|length
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|print_register_list
argument_list|(
name|dis_info
argument_list|,
name|value
argument_list|,
literal|8
argument_list|,
literal|0
comment|/*load*/
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_low_register_list_ld
parameter_list|(
name|cd
parameter_list|,
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|int
name|length
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|print_register_list
argument_list|(
name|dis_info
argument_list|,
name|value
argument_list|,
literal|0
argument_list|,
literal|0
comment|/*load*/
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_hi_register_list_st
parameter_list|(
name|cd
parameter_list|,
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|int
name|length
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|print_register_list
argument_list|(
name|dis_info
argument_list|,
name|value
argument_list|,
literal|8
argument_list|,
literal|1
comment|/*store*/
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_low_register_list_st
parameter_list|(
name|cd
parameter_list|,
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|int
name|length
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|print_register_list
argument_list|(
name|dis_info
argument_list|,
name|value
argument_list|,
literal|0
argument_list|,
literal|1
comment|/*store*/
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|print_m4
parameter_list|(
name|cd
parameter_list|,
name|dis_info
parameter_list|,
name|value
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|PTR
name|dis_info
decl_stmt|;
name|long
name|value
decl_stmt|;
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|int
name|length
name|ATTRIBUTE_UNUSED
decl_stmt|;
block|{
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|dis_info
decl_stmt|;
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%ld"
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* -- */
end_comment

begin_decl_stmt
name|void
name|fr30_cgen_print_operand
name|PARAMS
argument_list|(
operator|(
name|CGEN_CPU_DESC
operator|,
name|int
operator|,
name|PTR
operator|,
name|CGEN_FIELDS
operator|*
operator|,
name|void
specifier|const
operator|*
operator|,
name|bfd_vma
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Main entry point for printing operands.    XINFO is a `void *' and not a `disassemble_info *' to not put a requirement    of dis-asm.h on cgen.h.     This function is basically just a big switch statement.  Earlier versions    used tables to look up the function to use, but    - if the table contains both assembler and disassembler functions then      the disassembler contains much of the assembler and vice-versa,    - there's a lot of inlining possibilities as things grow,    - using a switch statement avoids the function call overhead.     This function could be moved into `print_insn_normal', but keeping it    separate makes clear the interface between `print_insn_normal' and each of    the handlers.  */
end_comment

begin_function
name|void
name|fr30_cgen_print_operand
parameter_list|(
name|cd
parameter_list|,
name|opindex
parameter_list|,
name|xinfo
parameter_list|,
name|fields
parameter_list|,
name|attrs
parameter_list|,
name|pc
parameter_list|,
name|length
parameter_list|)
name|CGEN_CPU_DESC
name|cd
decl_stmt|;
name|int
name|opindex
decl_stmt|;
name|PTR
name|xinfo
decl_stmt|;
name|CGEN_FIELDS
modifier|*
name|fields
decl_stmt|;
name|void
specifier|const
modifier|*
name|attrs
name|ATTRIBUTE_UNUSED
decl_stmt|;
name|bfd_vma
name|pc
decl_stmt|;
name|int
name|length
decl_stmt|;
block|{
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|xinfo
decl_stmt|;
switch|switch
condition|(
name|opindex
condition|)
block|{
case|case
name|FR30_OPERAND_CRI
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_cr_names
argument_list|,
name|fields
operator|->
name|f_CRi
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_CRJ
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_cr_names
argument_list|,
name|fields
operator|->
name|f_CRj
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_R13
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_h_r13
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_R14
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_h_r14
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_R15
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_h_r15
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RI
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_gr_names
argument_list|,
name|fields
operator|->
name|f_Ri
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RIC
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_gr_names
argument_list|,
name|fields
operator|->
name|f_Ric
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RJ
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_gr_names
argument_list|,
name|fields
operator|->
name|f_Rj
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RJC
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_gr_names
argument_list|,
name|fields
operator|->
name|f_Rjc
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RS1
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_dr_names
argument_list|,
name|fields
operator|->
name|f_Rs1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_RS2
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_dr_names
argument_list|,
name|fields
operator|->
name|f_Rs2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_CC
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_cc
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_CCC
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_ccc
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DIR10
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_dir10
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DIR8
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_dir8
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DIR9
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_dir9
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DISP10
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_disp10
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGNED
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DISP8
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_disp8
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGNED
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_DISP9
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_disp9
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGNED
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_I20
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_i20
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_VIRTUAL
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_I32
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_i32
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGN_OPT
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_I8
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_i8
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_LABEL12
case|:
name|print_address
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_rel12
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_PCREL_ADDR
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_LABEL9
case|:
name|print_address
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_rel9
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_PCREL_ADDR
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_M4
case|:
name|print_m4
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_m4
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGNED
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_PS
case|:
name|print_keyword
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
operator|&
name|fr30_cgen_opval_h_ps
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_REGLIST_HI_LD
case|:
name|print_hi_register_list_ld
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_reglist_hi_ld
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_REGLIST_HI_ST
case|:
name|print_hi_register_list_st
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_reglist_hi_st
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_REGLIST_LOW_LD
case|:
name|print_low_register_list_ld
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_reglist_low_ld
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_REGLIST_LOW_ST
case|:
name|print_low_register_list_st
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_reglist_low_st
argument_list|,
literal|0
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_S10
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_s10
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_SIGNED
operator|)
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_U10
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_u10
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_U4
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_u4
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_U4C
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_u4c
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_U8
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_u8
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
case|case
name|FR30_OPERAND_UDISP6
case|:
name|print_normal
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|fields
operator|->
name|f_udisp6
argument_list|,
literal|0
operator||
operator|(
literal|1
operator|<<
name|CGEN_OPERAND_HASH_PREFIX
operator|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
break|break;
default|default :
comment|/* xgettext:c-format */
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|_
argument_list|(
literal|"Unrecognized field %d while printing insn.\n"
argument_list|)
argument_list|,
name|opindex
argument_list|)
expr_stmt|;
name|abort
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
name|cgen_print_fn
modifier|*
specifier|const
name|fr30_cgen_print_handlers
index|[]
init|=
block|{
name|print_insn_normal
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|void
name|fr30_cgen_init_dis
parameter_list|(
name|cd
parameter_list|)
name|CGEN_CPU_DESC
name|cd
decl_stmt|;
block|{
name|fr30_cgen_init_opcode_table
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|fr30_cgen_init_ibld_table
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|cd
operator|->
name|print_handlers
operator|=
operator|&
name|fr30_cgen_print_handlers
index|[
literal|0
index|]
expr_stmt|;
name|cd
operator|->
name|print_operand
operator|=
name|fr30_cgen_print_operand
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Default print handler.  */
end_comment

begin_function
specifier|static
name|void
name|print_normal
parameter_list|(
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|void
modifier|*
name|dis_info
parameter_list|,
name|long
name|value
parameter_list|,
name|unsigned
name|int
name|attrs
parameter_list|,
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
parameter_list|,
name|int
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|dis_info
decl_stmt|;
ifdef|#
directive|ifdef
name|CGEN_PRINT_NORMAL
name|CGEN_PRINT_NORMAL
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|value
argument_list|,
name|attrs
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Print the operand as directed by the attributes.  */
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_SEM_ONLY
argument_list|)
condition|)
empty_stmt|;
comment|/* nothing to do */
elseif|else
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_SIGNED
argument_list|)
condition|)
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%ld"
argument_list|,
name|value
argument_list|)
expr_stmt|;
else|else
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"0x%lx"
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Default address handler.  */
end_comment

begin_function
specifier|static
name|void
name|print_address
parameter_list|(
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|void
modifier|*
name|dis_info
parameter_list|,
name|bfd_vma
name|value
parameter_list|,
name|unsigned
name|int
name|attrs
parameter_list|,
name|bfd_vma
name|pc
name|ATTRIBUTE_UNUSED
parameter_list|,
name|int
name|length
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|dis_info
decl_stmt|;
ifdef|#
directive|ifdef
name|CGEN_PRINT_ADDRESS
name|CGEN_PRINT_ADDRESS
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|value
argument_list|,
name|attrs
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Print the operand as directed by the attributes.  */
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_SEM_ONLY
argument_list|)
condition|)
empty_stmt|;
comment|/* nothing to do */
elseif|else
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_PCREL_ADDR
argument_list|)
condition|)
call|(
modifier|*
name|info
operator|->
name|print_address_func
call|)
argument_list|(
name|value
argument_list|,
name|info
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_ABS_ADDR
argument_list|)
condition|)
call|(
modifier|*
name|info
operator|->
name|print_address_func
call|)
argument_list|(
name|value
argument_list|,
name|info
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|CGEN_BOOL_ATTR
argument_list|(
name|attrs
argument_list|,
name|CGEN_OPERAND_SIGNED
argument_list|)
condition|)
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%ld"
argument_list|,
operator|(
name|long
operator|)
name|value
argument_list|)
expr_stmt|;
else|else
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"0x%lx"
argument_list|,
operator|(
name|long
operator|)
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Keyword print handler.  */
end_comment

begin_function
specifier|static
name|void
name|print_keyword
parameter_list|(
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|void
modifier|*
name|dis_info
parameter_list|,
name|CGEN_KEYWORD
modifier|*
name|keyword_table
parameter_list|,
name|long
name|value
parameter_list|,
name|unsigned
name|int
name|attrs
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|dis_info
decl_stmt|;
specifier|const
name|CGEN_KEYWORD_ENTRY
modifier|*
name|ke
decl_stmt|;
name|ke
operator|=
name|cgen_keyword_lookup_value
argument_list|(
name|keyword_table
argument_list|,
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|ke
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s"
argument_list|,
name|ke
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"???"
argument_list|)
expr_stmt|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Default insn printer.     DIS_INFO is defined as `void *' so the disassembler needn't know anything    about disassemble_info.  */
end_comment

begin_function
specifier|static
name|void
name|print_insn_normal
parameter_list|(
name|CGEN_CPU_DESC
name|cd
parameter_list|,
name|void
modifier|*
name|dis_info
parameter_list|,
specifier|const
name|CGEN_INSN
modifier|*
name|insn
parameter_list|,
name|CGEN_FIELDS
modifier|*
name|fields
parameter_list|,
name|bfd_vma
name|pc
parameter_list|,
name|int
name|length
parameter_list|)
block|{
specifier|const
name|CGEN_SYNTAX
modifier|*
name|syntax
init|=
name|CGEN_INSN_SYNTAX
argument_list|(
name|insn
argument_list|)
decl_stmt|;
name|disassemble_info
modifier|*
name|info
init|=
operator|(
name|disassemble_info
operator|*
operator|)
name|dis_info
decl_stmt|;
specifier|const
name|CGEN_SYNTAX_CHAR_TYPE
modifier|*
name|syn
decl_stmt|;
name|CGEN_INIT_PRINT
argument_list|(
name|cd
argument_list|)
expr_stmt|;
for|for
control|(
name|syn
operator|=
name|CGEN_SYNTAX_STRING
argument_list|(
name|syntax
argument_list|)
init|;
operator|*
name|syn
condition|;
operator|++
name|syn
control|)
block|{
if|if
condition|(
name|CGEN_SYNTAX_MNEMONIC_P
argument_list|(
operator|*
name|syn
argument_list|)
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s"
argument_list|,
name|CGEN_INSN_MNEMONIC
argument_list|(
name|insn
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|CGEN_SYNTAX_CHAR_P
argument_list|(
operator|*
name|syn
argument_list|)
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%c"
argument_list|,
name|CGEN_SYNTAX_CHAR
argument_list|(
operator|*
name|syn
argument_list|)
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* We have an operand.  */
name|fr30_cgen_print_operand
argument_list|(
name|cd
argument_list|,
name|CGEN_SYNTAX_FIELD
argument_list|(
operator|*
name|syn
argument_list|)
argument_list|,
name|info
argument_list|,
name|fields
argument_list|,
name|CGEN_INSN_ATTRS
argument_list|(
name|insn
argument_list|)
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Subroutine of print_insn. Reads an insn into the given buffers and updates    the extract info.    Returns 0 if all is well, non-zero otherwise.  */
end_comment

begin_function
specifier|static
name|int
name|read_insn
parameter_list|(
name|CGEN_CPU_DESC
name|cd
name|ATTRIBUTE_UNUSED
parameter_list|,
name|bfd_vma
name|pc
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|int
name|buflen
parameter_list|,
name|CGEN_EXTRACT_INFO
modifier|*
name|ex_info
parameter_list|,
name|unsigned
name|long
modifier|*
name|insn_value
parameter_list|)
block|{
name|int
name|status
init|=
call|(
modifier|*
name|info
operator|->
name|read_memory_func
call|)
argument_list|(
name|pc
argument_list|,
name|buf
argument_list|,
name|buflen
argument_list|,
name|info
argument_list|)
decl_stmt|;
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|memory_error_func
call|)
argument_list|(
name|status
argument_list|,
name|pc
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|ex_info
operator|->
name|dis_info
operator|=
name|info
expr_stmt|;
name|ex_info
operator|->
name|valid
operator|=
operator|(
literal|1
operator|<<
name|buflen
operator|)
operator|-
literal|1
expr_stmt|;
name|ex_info
operator|->
name|insn_bytes
operator|=
name|buf
expr_stmt|;
operator|*
name|insn_value
operator|=
name|bfd_get_bits
argument_list|(
name|buf
argument_list|,
name|buflen
operator|*
literal|8
argument_list|,
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_BIG
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Utility to print an insn.    BUF is the base part of the insn, target byte order, BUFLEN bytes long.    The result is the size of the insn in bytes or zero for an unknown insn    or -1 if an error occurs fetching data (memory_error_func will have    been called).  */
end_comment

begin_function
specifier|static
name|int
name|print_insn
parameter_list|(
name|CGEN_CPU_DESC
name|cd
parameter_list|,
name|bfd_vma
name|pc
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|,
name|unsigned
name|int
name|buflen
parameter_list|)
block|{
name|CGEN_INSN_INT
name|insn_value
decl_stmt|;
specifier|const
name|CGEN_INSN_LIST
modifier|*
name|insn_list
decl_stmt|;
name|CGEN_EXTRACT_INFO
name|ex_info
decl_stmt|;
name|int
name|basesize
decl_stmt|;
comment|/* Extract base part of instruction, just in case CGEN_DIS_* uses it. */
name|basesize
operator|=
name|cd
operator|->
name|base_insn_bitsize
operator|<
name|buflen
operator|*
literal|8
condition|?
name|cd
operator|->
name|base_insn_bitsize
else|:
name|buflen
operator|*
literal|8
expr_stmt|;
name|insn_value
operator|=
name|cgen_get_insn_value
argument_list|(
name|cd
argument_list|,
name|buf
argument_list|,
name|basesize
argument_list|)
expr_stmt|;
comment|/* Fill in ex_info fields like read_insn would.  Don't actually call      read_insn, since the incoming buffer is already read (and possibly      modified a la m32r).  */
name|ex_info
operator|.
name|valid
operator|=
operator|(
literal|1
operator|<<
name|buflen
operator|)
operator|-
literal|1
expr_stmt|;
name|ex_info
operator|.
name|dis_info
operator|=
name|info
expr_stmt|;
name|ex_info
operator|.
name|insn_bytes
operator|=
name|buf
expr_stmt|;
comment|/* The instructions are stored in hash lists.      Pick the first one and keep trying until we find the right one.  */
name|insn_list
operator|=
name|CGEN_DIS_LOOKUP_INSN
argument_list|(
name|cd
argument_list|,
name|buf
argument_list|,
name|insn_value
argument_list|)
expr_stmt|;
while|while
condition|(
name|insn_list
operator|!=
name|NULL
condition|)
block|{
specifier|const
name|CGEN_INSN
modifier|*
name|insn
init|=
name|insn_list
operator|->
name|insn
decl_stmt|;
name|CGEN_FIELDS
name|fields
decl_stmt|;
name|int
name|length
decl_stmt|;
name|unsigned
name|long
name|insn_value_cropped
decl_stmt|;
ifdef|#
directive|ifdef
name|CGEN_VALIDATE_INSN_SUPPORTED
comment|/* Not needed as insn shouldn't be in hash lists if not supported.  */
comment|/* Supported by this cpu?  */
if|if
condition|(
operator|!
name|fr30_cgen_insn_supported
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|)
condition|)
block|{
name|insn_list
operator|=
name|CGEN_DIS_NEXT_INSN
argument_list|(
name|insn_list
argument_list|)
expr_stmt|;
continue|continue;
block|}
endif|#
directive|endif
comment|/* Basic bit mask must be correct.  */
comment|/* ??? May wish to allow target to defer this check until the extract 	 handler.  */
comment|/* Base size may exceed this instruction's size.  Extract the          relevant part from the buffer. */
if|if
condition|(
call|(
name|unsigned
call|)
argument_list|(
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
operator|/
literal|8
argument_list|)
operator|<
name|buflen
operator|&&
call|(
name|unsigned
call|)
argument_list|(
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
operator|/
literal|8
argument_list|)
operator|<=
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
condition|)
name|insn_value_cropped
operator|=
name|bfd_get_bits
argument_list|(
name|buf
argument_list|,
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
argument_list|,
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_BIG
argument_list|)
expr_stmt|;
else|else
name|insn_value_cropped
operator|=
name|insn_value
expr_stmt|;
if|if
condition|(
operator|(
name|insn_value_cropped
operator|&
name|CGEN_INSN_BASE_MASK
argument_list|(
name|insn
argument_list|)
operator|)
operator|==
name|CGEN_INSN_BASE_VALUE
argument_list|(
name|insn
argument_list|)
condition|)
block|{
comment|/* Printing is handled in two passes.  The first pass parses the 	     machine insn and extracts the fields.  The second pass prints 	     them.  */
comment|/* Make sure the entire insn is loaded into insn_value, if it 	     can fit.  */
if|if
condition|(
operator|(
operator|(
name|unsigned
operator|)
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
operator|>
name|cd
operator|->
name|base_insn_bitsize
operator|)
operator|&&
call|(
name|unsigned
call|)
argument_list|(
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
operator|/
literal|8
argument_list|)
operator|<=
expr|sizeof
operator|(
name|unsigned
name|long
operator|)
condition|)
block|{
name|unsigned
name|long
name|full_insn_value
decl_stmt|;
name|int
name|rc
init|=
name|read_insn
argument_list|(
name|cd
argument_list|,
name|pc
argument_list|,
name|info
argument_list|,
name|buf
argument_list|,
name|CGEN_INSN_BITSIZE
argument_list|(
name|insn
argument_list|)
operator|/
literal|8
argument_list|,
operator|&
name|ex_info
argument_list|,
operator|&
name|full_insn_value
argument_list|)
decl_stmt|;
if|if
condition|(
name|rc
operator|!=
literal|0
condition|)
return|return
name|rc
return|;
name|length
operator|=
name|CGEN_EXTRACT_FN
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|)
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|,
operator|&
name|ex_info
argument_list|,
name|full_insn_value
argument_list|,
operator|&
name|fields
argument_list|,
name|pc
argument_list|)
expr_stmt|;
block|}
else|else
name|length
operator|=
name|CGEN_EXTRACT_FN
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|)
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|,
operator|&
name|ex_info
argument_list|,
name|insn_value_cropped
argument_list|,
operator|&
name|fields
argument_list|,
name|pc
argument_list|)
expr_stmt|;
comment|/* length< 0 -> error */
if|if
condition|(
name|length
operator|<
literal|0
condition|)
return|return
name|length
return|;
if|if
condition|(
name|length
operator|>
literal|0
condition|)
block|{
name|CGEN_PRINT_FN
argument_list|(
name|cd
argument_list|,
name|insn
argument_list|)
argument_list|(
name|cd
argument_list|,
name|info
argument_list|,
name|insn
argument_list|,
operator|&
name|fields
argument_list|,
name|pc
argument_list|,
name|length
argument_list|)
expr_stmt|;
comment|/* length is in bits, result is in bytes */
return|return
name|length
operator|/
literal|8
return|;
block|}
block|}
name|insn_list
operator|=
name|CGEN_DIS_NEXT_INSN
argument_list|(
name|insn_list
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* Default value for CGEN_PRINT_INSN.    The result is the size of the insn in bytes or zero for an unknown insn    or -1 if an error occured fetching bytes.  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|CGEN_PRINT_INSN
end_ifndef

begin_define
define|#
directive|define
name|CGEN_PRINT_INSN
value|default_print_insn
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|int
name|default_print_insn
parameter_list|(
name|CGEN_CPU_DESC
name|cd
parameter_list|,
name|bfd_vma
name|pc
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
name|char
name|buf
index|[
name|CGEN_MAX_INSN_SIZE
index|]
decl_stmt|;
name|int
name|buflen
decl_stmt|;
name|int
name|status
decl_stmt|;
comment|/* Attempt to read the base part of the insn.  */
name|buflen
operator|=
name|cd
operator|->
name|base_insn_bitsize
operator|/
literal|8
expr_stmt|;
name|status
operator|=
call|(
modifier|*
name|info
operator|->
name|read_memory_func
call|)
argument_list|(
name|pc
argument_list|,
name|buf
argument_list|,
name|buflen
argument_list|,
name|info
argument_list|)
expr_stmt|;
comment|/* Try again with the minimum part, if min< base.  */
if|if
condition|(
name|status
operator|!=
literal|0
operator|&&
operator|(
name|cd
operator|->
name|min_insn_bitsize
operator|<
name|cd
operator|->
name|base_insn_bitsize
operator|)
condition|)
block|{
name|buflen
operator|=
name|cd
operator|->
name|min_insn_bitsize
operator|/
literal|8
expr_stmt|;
name|status
operator|=
call|(
modifier|*
name|info
operator|->
name|read_memory_func
call|)
argument_list|(
name|pc
argument_list|,
name|buf
argument_list|,
name|buflen
argument_list|,
name|info
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|!=
literal|0
condition|)
block|{
call|(
modifier|*
name|info
operator|->
name|memory_error_func
call|)
argument_list|(
name|status
argument_list|,
name|pc
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
name|print_insn
argument_list|(
name|cd
argument_list|,
name|pc
argument_list|,
name|info
argument_list|,
name|buf
argument_list|,
name|buflen
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Main entry point.    Print one instruction from PC on INFO->STREAM.    Return the size of the instruction (in bytes).  */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|cpu_desc_list
block|{
name|struct
name|cpu_desc_list
modifier|*
name|next
decl_stmt|;
name|int
name|isa
decl_stmt|;
name|int
name|mach
decl_stmt|;
name|int
name|endian
decl_stmt|;
name|CGEN_CPU_DESC
name|cd
decl_stmt|;
block|}
name|cpu_desc_list
typedef|;
end_typedef

begin_function
name|int
name|print_insn_fr30
parameter_list|(
name|bfd_vma
name|pc
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
specifier|static
name|cpu_desc_list
modifier|*
name|cd_list
init|=
literal|0
decl_stmt|;
name|cpu_desc_list
modifier|*
name|cl
init|=
literal|0
decl_stmt|;
specifier|static
name|CGEN_CPU_DESC
name|cd
init|=
literal|0
decl_stmt|;
specifier|static
name|int
name|prev_isa
decl_stmt|;
specifier|static
name|int
name|prev_mach
decl_stmt|;
specifier|static
name|int
name|prev_endian
decl_stmt|;
name|int
name|length
decl_stmt|;
name|int
name|isa
decl_stmt|,
name|mach
decl_stmt|;
name|int
name|endian
init|=
operator|(
name|info
operator|->
name|endian
operator|==
name|BFD_ENDIAN_BIG
condition|?
name|CGEN_ENDIAN_BIG
else|:
name|CGEN_ENDIAN_LITTLE
operator|)
decl_stmt|;
name|enum
name|bfd_architecture
name|arch
decl_stmt|;
comment|/* ??? gdb will set mach but leave the architecture as "unknown" */
ifndef|#
directive|ifndef
name|CGEN_BFD_ARCH
define|#
directive|define
name|CGEN_BFD_ARCH
value|bfd_arch_fr30
endif|#
directive|endif
name|arch
operator|=
name|info
operator|->
name|arch
expr_stmt|;
if|if
condition|(
name|arch
operator|==
name|bfd_arch_unknown
condition|)
name|arch
operator|=
name|CGEN_BFD_ARCH
expr_stmt|;
comment|/* There's no standard way to compute the machine or isa number      so we leave it to the target.  */
ifdef|#
directive|ifdef
name|CGEN_COMPUTE_MACH
name|mach
operator|=
name|CGEN_COMPUTE_MACH
argument_list|(
name|info
argument_list|)
expr_stmt|;
else|#
directive|else
name|mach
operator|=
name|info
operator|->
name|mach
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|CGEN_COMPUTE_ISA
name|isa
operator|=
name|CGEN_COMPUTE_ISA
argument_list|(
name|info
argument_list|)
expr_stmt|;
else|#
directive|else
name|isa
operator|=
name|info
operator|->
name|insn_sets
expr_stmt|;
endif|#
directive|endif
comment|/* If we've switched cpu's, try to find a handle we've used before */
if|if
condition|(
name|cd
operator|&&
operator|(
name|isa
operator|!=
name|prev_isa
operator|||
name|mach
operator|!=
name|prev_mach
operator|||
name|endian
operator|!=
name|prev_endian
operator|)
condition|)
block|{
name|cd
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|cl
operator|=
name|cd_list
init|;
name|cl
condition|;
name|cl
operator|=
name|cl
operator|->
name|next
control|)
block|{
if|if
condition|(
name|cl
operator|->
name|isa
operator|==
name|isa
operator|&&
name|cl
operator|->
name|mach
operator|==
name|mach
operator|&&
name|cl
operator|->
name|endian
operator|==
name|endian
condition|)
block|{
name|cd
operator|=
name|cl
operator|->
name|cd
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* If we haven't initialized yet, initialize the opcode table.  */
if|if
condition|(
operator|!
name|cd
condition|)
block|{
specifier|const
name|bfd_arch_info_type
modifier|*
name|arch_type
init|=
name|bfd_lookup_arch
argument_list|(
name|arch
argument_list|,
name|mach
argument_list|)
decl_stmt|;
specifier|const
name|char
modifier|*
name|mach_name
decl_stmt|;
if|if
condition|(
operator|!
name|arch_type
condition|)
name|abort
argument_list|()
expr_stmt|;
name|mach_name
operator|=
name|arch_type
operator|->
name|printable_name
expr_stmt|;
name|prev_isa
operator|=
name|isa
expr_stmt|;
name|prev_mach
operator|=
name|mach
expr_stmt|;
name|prev_endian
operator|=
name|endian
expr_stmt|;
name|cd
operator|=
name|fr30_cgen_cpu_open
argument_list|(
name|CGEN_CPU_OPEN_ISAS
argument_list|,
name|prev_isa
argument_list|,
name|CGEN_CPU_OPEN_BFDMACH
argument_list|,
name|mach_name
argument_list|,
name|CGEN_CPU_OPEN_ENDIAN
argument_list|,
name|prev_endian
argument_list|,
name|CGEN_CPU_OPEN_END
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|cd
condition|)
name|abort
argument_list|()
expr_stmt|;
comment|/* save this away for future reference */
name|cl
operator|=
name|xmalloc
argument_list|(
sizeof|sizeof
argument_list|(
expr|struct
name|cpu_desc_list
argument_list|)
argument_list|)
expr_stmt|;
name|cl
operator|->
name|cd
operator|=
name|cd
expr_stmt|;
name|cl
operator|->
name|isa
operator|=
name|isa
expr_stmt|;
name|cl
operator|->
name|mach
operator|=
name|mach
expr_stmt|;
name|cl
operator|->
name|endian
operator|=
name|endian
expr_stmt|;
name|cl
operator|->
name|next
operator|=
name|cd_list
expr_stmt|;
name|cd_list
operator|=
name|cl
expr_stmt|;
name|fr30_cgen_init_dis
argument_list|(
name|cd
argument_list|)
expr_stmt|;
block|}
comment|/* We try to have as much common code as possible.      But at this point some targets need to take over.  */
comment|/* ??? Some targets may need a hook elsewhere.  Try to avoid this,      but if not possible try to move this hook elsewhere rather than      have two hooks.  */
name|length
operator|=
name|CGEN_PRINT_INSN
argument_list|(
name|cd
argument_list|,
name|pc
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|length
operator|>
literal|0
condition|)
return|return
name|length
return|;
if|if
condition|(
name|length
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
call|(
modifier|*
name|info
operator|->
name|fprintf_func
call|)
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|UNKNOWN_INSN_MSG
argument_list|)
expr_stmt|;
return|return
name|cd
operator|->
name|default_insn_bitsize
operator|/
literal|8
return|;
block|}
end_function

end_unit

