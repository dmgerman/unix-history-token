begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Print Z80 and R800 instructions    Copyright 2005 Free Software Foundation, Inc.    Contributed by Arnold Metselaar<arnold_m@operamail.com>     This file is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston,    MA 02110-1301, USA.  */
end_comment

begin_include
include|#
directive|include
file|"sysdep.h"
end_include

begin_include
include|#
directive|include
file|"dis-asm.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_struct
struct|struct
name|buffer
block|{
name|bfd_vma
name|base
decl_stmt|;
name|int
name|n_fetch
decl_stmt|;
name|int
name|n_used
decl_stmt|;
name|signed
name|char
name|data
index|[
literal|4
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|struct
name|buffer
modifier|*
parameter_list|,
name|disassemble_info
modifier|*
parameter_list|,
name|char
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_struct
struct|struct
name|tab_elt
block|{
name|unsigned
name|char
name|val
decl_stmt|;
name|unsigned
name|char
name|mask
decl_stmt|;
name|func
name|fp
decl_stmt|;
name|char
modifier|*
name|text
decl_stmt|;
block|}
struct|;
end_struct

begin_define
define|#
directive|define
name|TXTSIZ
value|24
end_define

begin_comment
comment|/* Names of 16-bit registers.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|rr_str
index|[]
init|=
block|{
literal|"bc"
block|,
literal|"de"
block|,
literal|"hl"
block|,
literal|"sp"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Names of 8-bit registers.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|r_str
index|[]
init|=
block|{
literal|"b"
block|,
literal|"c"
block|,
literal|"d"
block|,
literal|"e"
block|,
literal|"h"
block|,
literal|"l"
block|,
literal|"(hl)"
block|,
literal|"a"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Texts for condition codes.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cc_str
index|[]
init|=
block|{
literal|"nz"
block|,
literal|"z"
block|,
literal|"nc"
block|,
literal|"c"
block|,
literal|"po"
block|,
literal|"pe"
block|,
literal|"p"
block|,
literal|"m"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Instruction names for 8-bit arithmetic, operand "a" is often implicit */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|arit_str
index|[]
init|=
block|{
literal|"add a,"
block|,
literal|"adc a,"
block|,
literal|"sub "
block|,
literal|"sbc a,"
block|,
literal|"and "
block|,
literal|"xor "
block|,
literal|"or "
block|,
literal|"cp "
block|}
decl_stmt|;
end_decl_stmt

begin_escape
end_escape

begin_function
specifier|static
name|int
name|fetch_data
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|int
name|n
parameter_list|)
block|{
name|int
name|r
decl_stmt|;
if|if
condition|(
name|buf
operator|->
name|n_fetch
operator|+
name|n
operator|>
literal|4
condition|)
name|abort
argument_list|()
expr_stmt|;
name|r
operator|=
name|info
operator|->
name|read_memory_func
argument_list|(
name|buf
operator|->
name|base
operator|+
name|buf
operator|->
name|n_fetch
argument_list|,
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
operator|->
name|data
operator|+
name|buf
operator|->
name|n_fetch
argument_list|,
name|n
argument_list|,
name|info
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|==
literal|0
condition|)
name|buf
operator|->
name|n_fetch
operator|+=
name|n
expr_stmt|;
return|return
operator|!
name|r
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s"
argument_list|,
name|txt
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_e
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|e
decl_stmt|;
name|int
name|target_addr
decl_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|e
operator|=
name|buf
operator|->
name|data
index|[
literal|1
index|]
expr_stmt|;
name|target_addr
operator|=
operator|(
name|buf
operator|->
name|base
operator|+
literal|2
operator|+
name|e
operator|)
operator|&
literal|0xffff
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s0x%04x"
argument_list|,
name|txt
argument_list|,
name|target_addr
argument_list|)
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|jr_cc
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|cc_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_e
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_nn
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|int
name|nn
decl_stmt|;
name|unsigned
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
operator|->
name|data
operator|+
name|buf
operator|->
name|n_fetch
expr_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|nn
operator|=
name|p
index|[
literal|0
index|]
operator|+
operator|(
name|p
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
expr_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|nn
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_rr_nn
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|rr_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|4
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_nn
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_rr
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s%s"
argument_list|,
name|txt
argument_list|,
name|rr_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|>>
literal|4
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_n
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|int
name|n
decl_stmt|;
name|unsigned
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
operator|->
name|data
operator|+
name|buf
operator|->
name|n_fetch
expr_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|n
operator|=
name|p
index|[
literal|0
index|]
expr_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ld_r_n
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|r_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_n
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_r
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|r_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ld_r_r
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|r_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|,
name|r_str
index|[
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arit_r
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|arit_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|,
name|r_str
index|[
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_cc
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s%s"
argument_list|,
name|txt
argument_list|,
name|cc_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pop_rr
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|rr_stack
index|[]
init|=
block|{
literal|"bc"
block|,
literal|"de"
block|,
literal|"hl"
block|,
literal|"af"
block|}
decl_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s %s"
argument_list|,
name|txt
argument_list|,
name|rr_stack
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|4
operator|)
operator|&
literal|3
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|jp_cc_nn
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
literal|"%s%s,0x%%04x"
argument_list|,
name|txt
argument_list|,
name|cc_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_nn
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arit_n
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|arit_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_n
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|rst
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|buf
operator|->
name|data
index|[
literal|0
index|]
operator|&
literal|0x38
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_escape
end_escape

begin_function
specifier|static
name|int
name|cis
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|opar
index|[]
init|=
block|{
literal|"ld"
block|,
literal|"cp"
block|,
literal|"in"
block|,
literal|"out"
block|}
decl_stmt|;
name|char
modifier|*
name|op
decl_stmt|;
name|char
name|c
decl_stmt|;
name|c
operator|=
name|buf
operator|->
name|data
index|[
literal|1
index|]
expr_stmt|;
name|op
operator|=
operator|(
operator|(
literal|0x13
operator|&
name|c
operator|)
operator|==
literal|0x13
operator|)
condition|?
literal|"ot"
else|:
operator|(
name|opar
index|[
name|c
operator|&
literal|3
index|]
operator|)
expr_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s%c%s"
argument_list|,
name|op
argument_list|,
operator|(
name|c
operator|&
literal|0x08
operator|)
condition|?
literal|'d'
else|:
literal|'i'
argument_list|,
operator|(
name|c
operator|&
literal|0x10
operator|)
condition|?
literal|"r"
else|:
literal|""
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
literal|2
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|dump
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"defb "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|txt
index|[
name|i
index|]
condition|;
operator|++
name|i
control|)
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|i
condition|?
literal|", 0x%02x"
else|:
literal|"0x%02x"
argument_list|,
operator|(
name|unsigned
name|char
operator|)
name|buf
operator|->
name|data
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|i
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Table to disassemble machine codes with prefix 0xED.  */
end_comment

begin_decl_stmt
name|struct
name|tab_elt
name|opc_ed
index|[]
init|=
block|{
block|{
literal|0x70
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"in f,(c)"
block|}
block|,
block|{
literal|0x70
block|,
literal|0xFF
block|,
name|dump
block|,
literal|"xx"
block|}
block|,
block|{
literal|0x40
block|,
literal|0xC7
block|,
name|prt_r
block|,
literal|"in %s,(c)"
block|}
block|,
block|{
literal|0x71
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"out (c),0"
block|}
block|,
block|{
literal|0x70
block|,
literal|0xFF
block|,
name|dump
block|,
literal|"xx"
block|}
block|,
block|{
literal|0x41
block|,
literal|0xC7
block|,
name|prt_r
block|,
literal|"out (c),%s"
block|}
block|,
block|{
literal|0x42
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"sbc hl,"
block|}
block|,
block|{
literal|0x43
block|,
literal|0xCF
block|,
name|prt_rr_nn
block|,
literal|"ld (0x%%04x),%s"
block|}
block|,
block|{
literal|0x44
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"neg"
block|}
block|,
block|{
literal|0x45
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"retn"
block|}
block|,
block|{
literal|0x46
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"im 0"
block|}
block|,
block|{
literal|0x47
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld i,a"
block|}
block|,
block|{
literal|0x4A
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"adc hl,"
block|}
block|,
block|{
literal|0x4B
block|,
literal|0xCF
block|,
name|prt_rr_nn
block|,
literal|"ld %s,(0x%%04x)"
block|}
block|,
block|{
literal|0x4D
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"reti"
block|}
block|,
block|{
literal|0x56
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"im 1"
block|}
block|,
block|{
literal|0x57
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld a,i"
block|}
block|,
block|{
literal|0x5E
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"im 2"
block|}
block|,
block|{
literal|0x67
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rrd"
block|}
block|,
block|{
literal|0x6F
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rld"
block|}
block|,
block|{
literal|0xA0
block|,
literal|0xE4
block|,
name|cis
block|,
literal|""
block|}
block|,
block|{
literal|0xC3
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"muluw hl,bc"
block|}
block|,
block|{
literal|0xC5
block|,
literal|0xE7
block|,
name|prt_r
block|,
literal|"mulub a,%s"
block|}
block|,
block|{
literal|0xF3
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"muluw hl,sp"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
name|dump
block|,
literal|"xx"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|pref_ed
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
name|struct
name|tab_elt
modifier|*
name|p
decl_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
for|for
control|(
name|p
operator|=
name|opc_ed
init|;
name|p
operator|->
name|val
operator|!=
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|&
name|p
operator|->
name|mask
operator|)
condition|;
operator|++
name|p
control|)
empty_stmt|;
name|p
operator|->
name|fp
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|p
operator|->
name|text
argument_list|)
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Instruction names for the instructions addressing single bits.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cb1_str
index|[]
init|=
block|{
literal|""
block|,
literal|"bit"
block|,
literal|"res"
block|,
literal|"set"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Instruction names for shifts and rotates.  */
end_comment

begin_decl_stmt
specifier|static
name|char
modifier|*
name|cb2_str
index|[]
init|=
block|{
literal|"rlc"
block|,
literal|"rrc"
block|,
literal|"rl"
block|,
literal|"rr"
block|,
literal|"sla"
block|,
literal|"sra"
block|,
literal|"sli"
block|,
literal|"srl"
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|pref_cb
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
name|ATTRIBUTE_UNUSED
parameter_list|)
block|{
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|buf
operator|->
name|n_used
operator|=
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|&
literal|0xc0
operator|)
operator|==
literal|0
condition|)
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s %s"
argument_list|,
name|cb2_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|,
name|r_str
index|[
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
else|else
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s %d,%s"
argument_list|,
name|cb1_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|>>
literal|6
operator|)
operator|&
literal|3
index|]
argument_list|,
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
argument_list|,
name|r_str
index|[
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_escape
end_escape

begin_function
specifier|static
name|int
name|addvv
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"add %s,%s"
argument_list|,
name|txt
argument_list|,
name|txt
argument_list|)
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ld_v_v
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
literal|"ld %s%%s,%s%%s"
argument_list|,
name|txt
argument_list|,
name|txt
argument_list|)
expr_stmt|;
return|return
name|ld_r_r
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_d
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|int
name|d
decl_stmt|;
name|signed
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|buf
operator|->
name|data
operator|+
name|buf
operator|->
name|n_fetch
expr_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|d
operator|=
name|p
index|[
literal|0
index|]
expr_stmt|;
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
name|txt
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|buf
operator|->
name|n_used
operator|=
name|buf
operator|->
name|n_fetch
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|prt_d_n
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|int
name|d
decl_stmt|;
name|signed
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|buf
operator|->
name|data
operator|+
name|buf
operator|->
name|n_fetch
expr_stmt|;
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|d
operator|=
name|p
index|[
literal|0
index|]
expr_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|d
argument_list|)
expr_stmt|;
return|return
name|prt_n
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|arit_d
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|signed
name|char
name|c
decl_stmt|;
name|c
operator|=
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
expr_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|arit_str
index|[
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_d
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ld_r_d
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|signed
name|char
name|c
decl_stmt|;
name|c
operator|=
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
expr_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|r_str
index|[
operator|(
name|c
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_d
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|ld_d_r
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|signed
name|char
name|c
decl_stmt|;
name|c
operator|=
name|buf
operator|->
name|data
index|[
name|buf
operator|->
name|n_fetch
operator|-
literal|1
index|]
expr_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|txt
argument_list|,
name|r_str
index|[
name|c
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
return|return
name|prt_d
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|pref_xd_cb
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|2
argument_list|)
condition|)
block|{
name|int
name|d
decl_stmt|;
name|char
name|arg
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|signed
name|char
modifier|*
name|p
decl_stmt|;
name|buf
operator|->
name|n_used
operator|=
literal|4
expr_stmt|;
name|p
operator|=
name|buf
operator|->
name|data
expr_stmt|;
name|d
operator|=
name|p
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|p
index|[
literal|3
index|]
operator|&
literal|0xC0
operator|)
operator|==
literal|0x40
operator|)
operator|||
operator|(
operator|(
name|p
index|[
literal|3
index|]
operator|&
literal|7
operator|)
operator|==
literal|0x06
operator|)
condition|)
name|snprintf
argument_list|(
name|arg
argument_list|,
name|TXTSIZ
argument_list|,
literal|"(%s%+d)"
argument_list|,
name|txt
argument_list|,
name|d
argument_list|)
expr_stmt|;
else|else
name|snprintf
argument_list|(
name|arg
argument_list|,
name|TXTSIZ
argument_list|,
literal|"(%s%+d),%s"
argument_list|,
name|txt
argument_list|,
name|d
argument_list|,
name|r_str
index|[
name|p
index|[
literal|3
index|]
operator|&
literal|7
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|p
index|[
literal|3
index|]
operator|&
literal|0xc0
operator|)
operator|==
literal|0
condition|)
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s %s"
argument_list|,
name|cb2_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|3
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
index|]
argument_list|,
name|arg
argument_list|)
expr_stmt|;
else|else
name|info
operator|->
name|fprintf_func
argument_list|(
name|info
operator|->
name|stream
argument_list|,
literal|"%s %d,%s"
argument_list|,
name|cb1_str
index|[
operator|(
name|buf
operator|->
name|data
index|[
literal|3
index|]
operator|>>
literal|6
operator|)
operator|&
literal|3
index|]
argument_list|,
operator|(
name|buf
operator|->
name|data
index|[
literal|3
index|]
operator|>>
literal|3
operator|)
operator|&
literal|7
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_escape
end_escape

begin_comment
comment|/* Table to disassemble machine codes with prefix 0xDD or 0xFD.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tab_elt
name|opc_ind
index|[]
init|=
block|{
block|{
literal|0x24
block|,
literal|0xF7
block|,
name|prt_r
block|,
literal|"inc %s%%s"
block|}
block|,
block|{
literal|0x25
block|,
literal|0xF7
block|,
name|prt_r
block|,
literal|"dec %s%%s"
block|}
block|,
block|{
literal|0x26
block|,
literal|0xF7
block|,
name|ld_r_n
block|,
literal|"ld %s%%s,0x%%%%02x"
block|}
block|,
block|{
literal|0x21
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld %s,0x%%04x"
block|}
block|,
block|{
literal|0x22
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld (0x%%04x),%s"
block|}
block|,
block|{
literal|0x2A
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld %s,(0x%%04x)"
block|}
block|,
block|{
literal|0x23
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"inc %s"
block|}
block|,
block|{
literal|0x2B
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"dec %s"
block|}
block|,
block|{
literal|0x29
block|,
literal|0xFF
block|,
name|addvv
block|,
literal|"%s"
block|}
block|,
block|{
literal|0x09
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"add %s,"
block|}
block|,
block|{
literal|0x34
block|,
literal|0xFF
block|,
name|prt_d
block|,
literal|"inc (%s%%+d)"
block|}
block|,
block|{
literal|0x35
block|,
literal|0xFF
block|,
name|prt_d
block|,
literal|"dec (%s%%+d)"
block|}
block|,
block|{
literal|0x36
block|,
literal|0xFF
block|,
name|prt_d_n
block|,
literal|"ld (%s%%+d),0x%%%%02x"
block|}
block|,
block|{
literal|0x76
block|,
literal|0xFF
block|,
name|dump
block|,
literal|"h"
block|}
block|,
block|{
literal|0x46
block|,
literal|0xC7
block|,
name|ld_r_d
block|,
literal|"ld %%s,(%s%%%%+d)"
block|}
block|,
block|{
literal|0x70
block|,
literal|0xF8
block|,
name|ld_d_r
block|,
literal|"ld (%s%%%%+d),%%s"
block|}
block|,
block|{
literal|0x64
block|,
literal|0xF6
block|,
name|ld_v_v
block|,
literal|"%s"
block|}
block|,
block|{
literal|0x60
block|,
literal|0xF0
block|,
name|ld_r_r
block|,
literal|"ld %s%%s,%%s"
block|}
block|,
block|{
literal|0x44
block|,
literal|0xC6
block|,
name|ld_r_r
block|,
literal|"ld %%s,%s%%s"
block|}
block|,
block|{
literal|0x86
block|,
literal|0xC7
block|,
name|arit_d
block|,
literal|"%%s(%s%%%%+d)"
block|}
block|,
block|{
literal|0x84
block|,
literal|0xC6
block|,
name|arit_r
block|,
literal|"%%s%s%%s"
block|}
block|,
block|{
literal|0xE1
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"pop %s"
block|}
block|,
block|{
literal|0xE5
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"push %s"
block|}
block|,
block|{
literal|0xCB
block|,
literal|0xFF
block|,
name|pref_xd_cb
block|,
literal|"%s"
block|}
block|,
block|{
literal|0xE3
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ex (sp),%s"
block|}
block|,
block|{
literal|0xE9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"jp (%s)"
block|}
block|,
block|{
literal|0xF9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld sp,%s"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
name|dump
block|,
literal|"?"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
name|pref_ind
parameter_list|(
name|struct
name|buffer
modifier|*
name|buf
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|,
name|char
modifier|*
name|txt
parameter_list|)
block|{
if|if
condition|(
name|fetch_data
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|char
name|mytxt
index|[
name|TXTSIZ
index|]
decl_stmt|;
name|struct
name|tab_elt
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|opc_ind
init|;
name|p
operator|->
name|val
operator|!=
operator|(
name|buf
operator|->
name|data
index|[
literal|1
index|]
operator|&
name|p
operator|->
name|mask
operator|)
condition|;
operator|++
name|p
control|)
empty_stmt|;
name|snprintf
argument_list|(
name|mytxt
argument_list|,
name|TXTSIZ
argument_list|,
name|p
operator|->
name|text
argument_list|,
name|txt
argument_list|)
expr_stmt|;
name|p
operator|->
name|fp
argument_list|(
name|buf
argument_list|,
name|info
argument_list|,
name|mytxt
argument_list|)
expr_stmt|;
block|}
else|else
name|buf
operator|->
name|n_used
operator|=
operator|-
literal|1
expr_stmt|;
return|return
name|buf
operator|->
name|n_used
return|;
block|}
end_function

begin_comment
comment|/* Table to disassemble machine codes without prefix.  */
end_comment

begin_decl_stmt
specifier|static
name|struct
name|tab_elt
name|opc_main
index|[]
init|=
block|{
block|{
literal|0x00
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"nop"
block|}
block|,
block|{
literal|0x01
block|,
literal|0xCF
block|,
name|prt_rr_nn
block|,
literal|"ld %s,0x%%04x"
block|}
block|,
block|{
literal|0x02
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld (bc),a"
block|}
block|,
block|{
literal|0x03
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"inc "
block|}
block|,
block|{
literal|0x04
block|,
literal|0xC7
block|,
name|prt_r
block|,
literal|"inc %s"
block|}
block|,
block|{
literal|0x05
block|,
literal|0xC7
block|,
name|prt_r
block|,
literal|"dec %s"
block|}
block|,
block|{
literal|0x06
block|,
literal|0xC7
block|,
name|ld_r_n
block|,
literal|"ld %s,0x%%02x"
block|}
block|,
block|{
literal|0x07
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rlca"
block|}
block|,
block|{
literal|0x08
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ex af,af'"
block|}
block|,
block|{
literal|0x09
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"add hl,"
block|}
block|,
block|{
literal|0x0A
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld a,(bc)"
block|}
block|,
block|{
literal|0x0B
block|,
literal|0xCF
block|,
name|prt_rr
block|,
literal|"dec "
block|}
block|,
block|{
literal|0x0F
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rrca"
block|}
block|,
block|{
literal|0x10
block|,
literal|0xFF
block|,
name|prt_e
block|,
literal|"djnz "
block|}
block|,
block|{
literal|0x12
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld (de),a"
block|}
block|,
block|{
literal|0x17
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rla"
block|}
block|,
block|{
literal|0x18
block|,
literal|0xFF
block|,
name|prt_e
block|,
literal|"jr "
block|}
block|,
block|{
literal|0x1A
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld a,(de)"
block|}
block|,
block|{
literal|0x1F
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"rra"
block|}
block|,
block|{
literal|0x20
block|,
literal|0xE7
block|,
name|jr_cc
block|,
literal|"jr %s,"
block|}
block|,
block|{
literal|0x22
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld (0x%04x),hl"
block|}
block|,
block|{
literal|0x27
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"daa"
block|}
block|,
block|{
literal|0x2A
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld hl,(0x%04x)"
block|}
block|,
block|{
literal|0x2F
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"cpl"
block|}
block|,
block|{
literal|0x32
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld (0x%04x),a"
block|}
block|,
block|{
literal|0x37
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"scf"
block|}
block|,
block|{
literal|0x3A
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"ld a,(0x%04x)"
block|}
block|,
block|{
literal|0x3F
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ccf"
block|}
block|,
block|{
literal|0x76
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"halt"
block|}
block|,
block|{
literal|0x40
block|,
literal|0xC0
block|,
name|ld_r_r
block|,
literal|"ld %s,%s"
block|}
block|,
block|{
literal|0x80
block|,
literal|0xC0
block|,
name|arit_r
block|,
literal|"%s%s"
block|}
block|,
block|{
literal|0xC0
block|,
literal|0xC7
block|,
name|prt_cc
block|,
literal|"ret "
block|}
block|,
block|{
literal|0xC1
block|,
literal|0xCF
block|,
name|pop_rr
block|,
literal|"pop"
block|}
block|,
block|{
literal|0xC2
block|,
literal|0xC7
block|,
name|jp_cc_nn
block|,
literal|"jp "
block|}
block|,
block|{
literal|0xC3
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"jp 0x%04x"
block|}
block|,
block|{
literal|0xC4
block|,
literal|0xC7
block|,
name|jp_cc_nn
block|,
literal|"call "
block|}
block|,
block|{
literal|0xC5
block|,
literal|0xCF
block|,
name|pop_rr
block|,
literal|"push"
block|}
block|,
block|{
literal|0xC6
block|,
literal|0xC7
block|,
name|arit_n
block|,
literal|"%s0x%%02x"
block|}
block|,
block|{
literal|0xC7
block|,
literal|0xC7
block|,
name|rst
block|,
literal|"rst 0x%02x"
block|}
block|,
block|{
literal|0xC9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ret"
block|}
block|,
block|{
literal|0xCB
block|,
literal|0xFF
block|,
name|pref_cb
block|,
literal|""
block|}
block|,
block|{
literal|0xCD
block|,
literal|0xFF
block|,
name|prt_nn
block|,
literal|"call 0x%04x"
block|}
block|,
block|{
literal|0xD3
block|,
literal|0xFF
block|,
name|prt_n
block|,
literal|"out (0x%02x),a"
block|}
block|,
block|{
literal|0xD9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"exx"
block|}
block|,
block|{
literal|0xDB
block|,
literal|0xFF
block|,
name|prt_n
block|,
literal|"in a,(0x%02x)"
block|}
block|,
block|{
literal|0xDD
block|,
literal|0xFF
block|,
name|pref_ind
block|,
literal|"ix"
block|}
block|,
block|{
literal|0xE3
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ex (sp),hl"
block|}
block|,
block|{
literal|0xE9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"jp (hl)"
block|}
block|,
block|{
literal|0xEB
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ex de,hl"
block|}
block|,
block|{
literal|0xED
block|,
literal|0xFF
block|,
name|pref_ed
block|,
literal|""
block|}
block|,
block|{
literal|0xF3
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"di"
block|}
block|,
block|{
literal|0xF9
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ld sp,hl"
block|}
block|,
block|{
literal|0xFB
block|,
literal|0xFF
block|,
name|prt
block|,
literal|"ei"
block|}
block|,
block|{
literal|0xFD
block|,
literal|0xFF
block|,
name|pref_ind
block|,
literal|"iy"
block|}
block|,
block|{
literal|0x00
block|,
literal|0x00
block|,
name|prt
block|,
literal|"????"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|int
name|print_insn_z80
parameter_list|(
name|bfd_vma
name|addr
parameter_list|,
name|disassemble_info
modifier|*
name|info
parameter_list|)
block|{
name|struct
name|buffer
name|buf
decl_stmt|;
name|struct
name|tab_elt
modifier|*
name|p
decl_stmt|;
name|buf
operator|.
name|base
operator|=
name|addr
expr_stmt|;
name|buf
operator|.
name|n_fetch
operator|=
literal|0
expr_stmt|;
name|buf
operator|.
name|n_used
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|fetch_data
argument_list|(
operator|&
name|buf
argument_list|,
name|info
argument_list|,
literal|1
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
for|for
control|(
name|p
operator|=
name|opc_main
init|;
name|p
operator|->
name|val
operator|!=
operator|(
name|buf
operator|.
name|data
index|[
literal|0
index|]
operator|&
name|p
operator|->
name|mask
operator|)
condition|;
operator|++
name|p
control|)
empty_stmt|;
name|p
operator|->
name|fp
argument_list|(
operator|&
name|buf
argument_list|,
name|info
argument_list|,
name|p
operator|->
name|text
argument_list|)
expr_stmt|;
return|return
name|buf
operator|.
name|n_used
return|;
block|}
end_function

end_unit

