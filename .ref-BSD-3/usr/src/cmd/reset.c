begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * reset - set the teletype mode bits to be sensible  *  * Kurt Shoens  *  * Very useful after crapping out in raw.  * Modified by Mark Horton to know about tchars  * and to not mess with peoples chars unless they are null.  */
end_comment

begin_include
include|#
directive|include
file|<sgtty.h>
end_include

begin_define
define|#
directive|define
name|chk
parameter_list|(
name|val
parameter_list|,
name|dft
parameter_list|)
value|(val==0 ? dft : val)
end_define

begin_function
name|main
parameter_list|()
block|{
name|struct
name|sgttyb
name|buf
decl_stmt|;
name|struct
name|tchars
name|tbuf
decl_stmt|;
name|gtty
argument_list|(
literal|2
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|2
argument_list|,
name|TIOCGETC
argument_list|,
operator|&
name|tbuf
argument_list|)
expr_stmt|;
name|buf
operator|.
name|sg_flags
operator|&=
operator|~
operator|(
name|RAW
operator||
name|CBREAK
operator||
name|VTDELAY
operator||
name|ALLDELAY
operator|)
expr_stmt|;
name|buf
operator|.
name|sg_flags
operator||=
name|XTABS
operator||
name|ECHO
operator||
name|CRMOD
operator||
name|ANYP
expr_stmt|;
name|buf
operator|.
name|sg_erase
operator|=
name|chk
argument_list|(
name|buf
operator|.
name|sg_erase
argument_list|,
literal|'\08'
argument_list|)
expr_stmt|;
comment|/* ^H */
name|buf
operator|.
name|sg_kill
operator|=
name|chk
argument_list|(
name|buf
operator|.
name|sg_kill
argument_list|,
literal|'\30'
argument_list|)
expr_stmt|;
comment|/* ^X */
name|tbuf
operator|.
name|t_intrc
operator|=
name|chk
argument_list|(
name|tbuf
operator|.
name|t_intrc
argument_list|,
literal|'\177'
argument_list|)
expr_stmt|;
comment|/* ^? */
name|tbuf
operator|.
name|t_quitc
operator|=
name|chk
argument_list|(
name|tbuf
operator|.
name|t_quitc
argument_list|,
literal|'\34'
argument_list|)
expr_stmt|;
comment|/* ^\ */
name|tbuf
operator|.
name|t_startc
operator|=
name|chk
argument_list|(
name|tbuf
operator|.
name|t_startc
argument_list|,
literal|'\22'
argument_list|)
expr_stmt|;
comment|/* ^Q */
name|tbuf
operator|.
name|t_stopc
operator|=
name|chk
argument_list|(
name|tbuf
operator|.
name|t_stopc
argument_list|,
literal|'\24'
argument_list|)
expr_stmt|;
comment|/* ^S */
name|tbuf
operator|.
name|t_eofc
operator|=
name|chk
argument_list|(
name|tbuf
operator|.
name|t_eofc
argument_list|,
literal|'\4'
argument_list|)
expr_stmt|;
comment|/* ^D */
comment|/* brkc is left alone */
name|ioctl
argument_list|(
literal|2
argument_list|,
name|TIOCSETN
argument_list|,
operator|&
name|buf
argument_list|)
expr_stmt|;
name|ioctl
argument_list|(
literal|2
argument_list|,
name|TIOCSETC
argument_list|,
operator|&
name|tbuf
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

