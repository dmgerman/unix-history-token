begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_comment
comment|/*  *  *	UNIX debugger  *  */
end_comment

begin_include
include|#
directive|include
file|"defs.h"
end_include

begin_decl_stmt
name|MSG
name|NOBKPT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|MSG
name|SZBKPT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|MSG
name|EXBKPT
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|MSG
name|NOPCS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|MSG
name|BADMOD
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* breakpoints */
end_comment

begin_decl_stmt
name|BKPTR
name|bkpthead
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|CHAR
name|lastc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|user
name|u
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|INT
name|signo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|L_INT
name|dot
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|INT
name|pid
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|L_INT
name|cntval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|L_INT
name|loopcnt
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* sub process control */
end_comment

begin_macro
name|subpcs
argument_list|(
argument|modif
argument_list|)
end_macro

begin_block
block|{
name|REG
name|INT
name|check
decl_stmt|;
name|INT
name|execsig
decl_stmt|,
name|runmode
decl_stmt|;
name|REG
name|BKPTR
name|bkptr
decl_stmt|;
name|STRING
name|comptr
decl_stmt|;
name|execsig
operator|=
literal|0
expr_stmt|;
name|loopcnt
operator|=
name|cntval
expr_stmt|;
switch|switch
condition|(
name|modif
condition|)
block|{
comment|/* delete breakpoint */
case|case
literal|'d'
case|:
case|case
literal|'D'
case|:
name|IF
argument_list|(
argument|bkptr=scanbkpt(dot)
argument_list|)
name|THEN
name|bkptr
operator|->
name|flag
init|=
literal|0
decl_stmt|;
return|return;
name|ELSE
name|error
parameter_list|(
name|NOBKPT
parameter_list|)
function_decl|;
name|FI
comment|/* set breakpoint */
case|case
literal|'b'
case|:
case|case
literal|'B'
case|:
name|IF
argument_list|(
argument|bkptr=scanbkpt(dot)
argument_list|)
name|THEN
name|bkptr
operator|->
name|flag
init|=
literal|0
decl_stmt|;
name|FI
name|FOR
name|bkptr
init|=
name|bkpthead
decl_stmt|;
name|bkptr
expr_stmt|;
name|bkptr
operator|=
name|bkptr
operator|->
name|nxtbkpt
name|DO
name|IF
name|bkptr
operator|->
name|flag
operator|==
literal|0
name|THEN
break|break;
name|FI
name|OD
name|IF
name|bkptr
operator|==
literal|0
name|THEN
name|IF
argument_list|(
name|bkptr
operator|=
operator|(
name|BKPTR
operator|)
name|sbrk
argument_list|(
sizeof|sizeof
expr|*
name|bkptr
argument_list|)
argument_list|)
operator|==
operator|(
name|BKPTR
operator|)
operator|-
literal|1
name|THEN
name|error
argument_list|(
name|SZBKPT
argument_list|)
expr_stmt|;
name|ELSE
name|bkptr
operator|->
name|nxtbkpt
init|=
name|bkpthead
decl_stmt|;
name|bkpthead
operator|=
name|bkptr
expr_stmt|;
name|FI
name|FI
name|bkptr
operator|->
name|loc
init|=
name|dot
decl_stmt|;
name|bkptr
operator|->
name|initcnt
operator|=
name|bkptr
operator|->
name|count
operator|=
name|cntval
expr_stmt|;
name|bkptr
operator|->
name|flag
operator|=
name|BKPTSET
expr_stmt|;
name|check
operator|=
name|MAXCOM
operator|-
literal|1
expr_stmt|;
name|comptr
operator|=
name|bkptr
operator|->
name|comm
expr_stmt|;
comment|/* rdc(); */
name|REP
operator|*
name|comptr
operator|++
operator|=
name|readchar
argument_list|()
expr_stmt|;
name|PER
name|check
operator|--
name|ANDF
name|lastc
operator|!=
name|EOR
name|DONE
operator|*
name|comptr
operator|=
literal|0
expr_stmt|;
name|IF
name|check
name|THEN
return|return;
name|ELSE
name|error
parameter_list|(
name|EXBKPT
parameter_list|)
function_decl|;
name|FI
comment|/* exit */
case|case
literal|'k'
case|:
case|case
literal|'K'
case|:
name|IF
name|pid
name|THEN
name|printf
argument_list|(
literal|"%d: killed"
argument_list|,
name|pid
argument_list|)
decl_stmt|;
name|endpcs
argument_list|()
expr_stmt|;
return|return;
name|FI
name|error
parameter_list|(
name|NOPCS
parameter_list|)
function_decl|;
comment|/* run program */
case|case
literal|'r'
case|:
case|case
literal|'R'
case|:
name|endpcs
argument_list|()
expr_stmt|;
name|setup
argument_list|()
expr_stmt|;
name|runmode
operator|=
name|CONTIN
expr_stmt|;
break|break;
comment|/* single step */
case|case
literal|'s'
case|:
case|case
literal|'S'
case|:
name|IF
name|pid
name|THEN
name|runmode
init|=
name|SINGLE
decl_stmt|;
name|execsig
operator|=
name|getsig
argument_list|(
name|signo
argument_list|)
expr_stmt|;
name|ELSE
name|setup
parameter_list|()
function_decl|;
name|loopcnt
operator|--
expr_stmt|;
name|FI
break|break;
comment|/* continue with optional signal */
case|case
literal|'c'
case|:
case|case
literal|'C'
case|:
case|case
literal|0
case|:
name|IF
name|pid
operator|==
literal|0
name|THEN
name|error
argument_list|(
name|NOPCS
argument_list|)
expr_stmt|;
name|FI
name|runmode
init|=
name|CONTIN
decl_stmt|;
name|execsig
operator|=
name|getsig
argument_list|(
name|signo
argument_list|)
expr_stmt|;
break|break;
default|default:
name|error
argument_list|(
name|BADMOD
argument_list|)
expr_stmt|;
block|}
name|runpcs
argument_list|(
name|runmode
argument_list|,
name|execsig
argument_list|)
expr_stmt|;
name|delbp
argument_list|()
expr_stmt|;
block|}
end_block

end_unit

