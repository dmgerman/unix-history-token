begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*******************************************************************************  *  * Module Name: dbcmds - Miscellaneous debug commands and output routines  *  ******************************************************************************/
end_comment

begin_comment
comment|/*  * Copyright (C) 2000 - 2011, Intel Corp.  * All rights reserved.  *  * Redistribution and use in source and binary forms, with or without  * modification, are permitted provided that the following conditions  * are met:  * 1. Redistributions of source code must retain the above copyright  *    notice, this list of conditions, and the following disclaimer,  *    without modification.  * 2. Redistributions in binary form must reproduce at minimum a disclaimer  *    substantially similar to the "NO WARRANTY" disclaimer below  *    ("Disclaimer") and any redistribution must be conditioned upon  *    including a substantially similar Disclaimer requirement for further  *    binary redistribution.  * 3. Neither the names of the above-listed copyright holders nor the names  *    of any contributors may be used to endorse or promote products derived  *    from this software without specific prior written permission.  *  * Alternatively, this software may be distributed under the terms of the  * GNU General Public License ("GPL") version 2 as published by the Free  * Software Foundation.  *  * NO WARRANTY  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS  * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT  * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,  * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING  * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  * POSSIBILITY OF SUCH DAMAGES.  */
end_comment

begin_include
include|#
directive|include
file|"acpi.h"
end_include

begin_include
include|#
directive|include
file|"accommon.h"
end_include

begin_include
include|#
directive|include
file|"acevents.h"
end_include

begin_include
include|#
directive|include
file|"acdebug.h"
end_include

begin_include
include|#
directive|include
file|"acresrc.h"
end_include

begin_include
include|#
directive|include
file|"actables.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|ACPI_DEBUGGER
end_ifdef

begin_define
define|#
directive|define
name|_COMPONENT
value|ACPI_CA_DEBUGGER
end_define

begin_macro
name|ACPI_MODULE_NAME
argument_list|(
literal|"dbcmds"
argument_list|)
end_macro

begin_comment
comment|/* Local prototypes */
end_comment

begin_function_decl
specifier|static
name|void
name|AcpiDmCompareAmlResources
parameter_list|(
name|UINT8
modifier|*
name|Aml1Buffer
parameter_list|,
name|ACPI_RSDESC_SIZE
name|Aml1BufferLength
parameter_list|,
name|UINT8
modifier|*
name|Aml2Buffer
parameter_list|,
name|ACPI_RSDESC_SIZE
name|Aml2BufferLength
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|ACPI_STATUS
name|AcpiDmTestResourceConversion
parameter_list|(
name|ACPI_NAMESPACE_NODE
modifier|*
name|Node
parameter_list|,
name|char
modifier|*
name|Name
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbConvertToNode  *  * PARAMETERS:  InString        - String to convert  *  * RETURN:      Pointer to a NS node  *  * DESCRIPTION: Convert a string to a valid NS pointer.  Handles numeric or  *              alpha strings.  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_NAMESPACE_NODE
modifier|*
name|AcpiDbConvertToNode
parameter_list|(
name|char
modifier|*
name|InString
parameter_list|)
block|{
name|ACPI_NAMESPACE_NODE
modifier|*
name|Node
decl_stmt|;
if|if
condition|(
operator|(
operator|*
name|InString
operator|>=
literal|0x30
operator|)
operator|&&
operator|(
operator|*
name|InString
operator|<=
literal|0x39
operator|)
condition|)
block|{
comment|/* Numeric argument, convert */
name|Node
operator|=
name|ACPI_TO_POINTER
argument_list|(
name|ACPI_STRTOUL
argument_list|(
name|InString
argument_list|,
name|NULL
argument_list|,
literal|16
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|AcpiOsReadable
argument_list|(
name|Node
argument_list|,
sizeof|sizeof
argument_list|(
name|ACPI_NAMESPACE_NODE
argument_list|)
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Address %p is invalid in this address space\n"
argument_list|,
name|Node
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/* Make sure pointer is valid NS node */
if|if
condition|(
name|ACPI_GET_DESCRIPTOR_TYPE
argument_list|(
name|Node
argument_list|)
operator|!=
name|ACPI_DESC_TYPE_NAMED
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Address %p is not a valid NS node [%s]\n"
argument_list|,
name|Node
argument_list|,
name|AcpiUtGetDescriptorName
argument_list|(
name|Node
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
block|}
else|else
block|{
comment|/* Alpha argument */
comment|/* The parameter is a name string that must be resolved to a          * Named obj          */
name|Node
operator|=
name|AcpiDbLocalNsLookup
argument_list|(
name|InString
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Node
condition|)
block|{
name|Node
operator|=
name|AcpiGbl_RootNode
expr_stmt|;
block|}
block|}
return|return
operator|(
name|Node
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbSleep  *  * PARAMETERS:  ObjectArg       - Desired sleep state (0-5)  *  * RETURN:      Status  *  * DESCRIPTION: Simulate a sleep/wake sequence  *  ******************************************************************************/
end_comment

begin_function
name|ACPI_STATUS
name|AcpiDbSleep
parameter_list|(
name|char
modifier|*
name|ObjectArg
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|UINT8
name|SleepState
decl_stmt|;
name|SleepState
operator|=
operator|(
name|UINT8
operator|)
name|ACPI_STRTOUL
argument_list|(
name|ObjectArg
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"**** Prepare to sleep ****\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiEnterSleepStatePrep
argument_list|(
name|SleepState
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"**** Going to sleep ****\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiEnterSleepState
argument_list|(
name|SleepState
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return
operator|(
name|Status
operator|)
return|;
block|}
name|AcpiOsPrintf
argument_list|(
literal|"**** returning from sleep ****\n"
argument_list|)
expr_stmt|;
name|Status
operator|=
name|AcpiLeaveSleepState
argument_list|(
name|SleepState
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayLocks  *  * PARAMETERS:  None  *  * RETURN:      None  *  * DESCRIPTION: Display information about internal mutexes.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbDisplayLocks
parameter_list|(
name|void
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ACPI_MAX_MUTEX
condition|;
name|i
operator|++
control|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%26s : %s\n"
argument_list|,
name|AcpiUtGetMutexName
argument_list|(
name|i
argument_list|)
argument_list|,
name|AcpiGbl_MutexInfo
index|[
name|i
index|]
operator|.
name|ThreadId
operator|==
name|ACPI_MUTEX_NOT_ACQUIRED
condition|?
literal|"Locked"
else|:
literal|"Unlocked"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayTableInfo  *  * PARAMETERS:  TableArg        - String with name of table to be displayed  *  * RETURN:      None  *  * DESCRIPTION: Display information about loaded tables.  Current  *              implementation displays all loaded tables.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbDisplayTableInfo
parameter_list|(
name|char
modifier|*
name|TableArg
parameter_list|)
block|{
name|UINT32
name|i
decl_stmt|;
name|ACPI_TABLE_DESC
modifier|*
name|TableDesc
decl_stmt|;
name|ACPI_STATUS
name|Status
decl_stmt|;
comment|/* Walk the entire root table list */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|AcpiGbl_RootTableList
operator|.
name|CurrentTableCount
condition|;
name|i
operator|++
control|)
block|{
name|TableDesc
operator|=
operator|&
name|AcpiGbl_RootTableList
operator|.
name|Tables
index|[
name|i
index|]
expr_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"%u "
argument_list|,
name|i
argument_list|)
expr_stmt|;
comment|/* Make sure that the table is mapped */
name|Status
operator|=
name|AcpiTbVerifyTable
argument_list|(
name|TableDesc
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
return|return;
block|}
comment|/* Dump the table header */
if|if
condition|(
name|TableDesc
operator|->
name|Pointer
condition|)
block|{
name|AcpiTbPrintTableHeader
argument_list|(
name|TableDesc
operator|->
name|Address
argument_list|,
name|TableDesc
operator|->
name|Pointer
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* If the pointer is null, the table has been unloaded */
name|ACPI_INFO
argument_list|(
operator|(
name|AE_INFO
operator|,
literal|"%4.4s - Table has been unloaded"
operator|,
name|TableDesc
operator|->
name|Signature
operator|.
name|Ascii
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbUnloadAcpiTable  *  * PARAMETERS:  TableArg        - Name of the table to be unloaded  *              InstanceArg     - Which instance of the table to unload (if  *                                there are multiple tables of the same type)  *  * RETURN:      Nonde  *  * DESCRIPTION: Unload an ACPI table.  *              Instance is not implemented  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbUnloadAcpiTable
parameter_list|(
name|char
modifier|*
name|TableArg
parameter_list|,
name|char
modifier|*
name|InstanceArg
parameter_list|)
block|{
comment|/* TBD: Need to reimplement for new data structures */
if|#
directive|if
literal|0
block|UINT32                  i;     ACPI_STATUS             Status;
comment|/* Search all tables for the target type */
block|for (i = 0; i< (ACPI_TABLE_ID_MAX+1); i++)     {         if (!ACPI_STRNCMP (TableArg, AcpiGbl_TableData[i].Signature,                 AcpiGbl_TableData[i].SigLength))         {
comment|/* Found the table, unload it */
block|Status = AcpiUnloadTable (i);             if (ACPI_SUCCESS (Status))             {                 AcpiOsPrintf ("[%s] unloaded and uninstalled\n", TableArg);             }             else             {                 AcpiOsPrintf ("%s, while unloading [%s]\n",                     AcpiFormatException (Status), TableArg);             }              return;         }     }      AcpiOsPrintf ("Unknown table type [%s]\n", TableArg);
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbSendNotify  *  * PARAMETERS:  Name            - Name of ACPI object to send the notify to  *              Value           - Value of the notify to send.  *  * RETURN:      None  *  * DESCRIPTION: Send an ACPI notification.  The value specified is sent to the  *              named object as an ACPI notify.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbSendNotify
parameter_list|(
name|char
modifier|*
name|Name
parameter_list|,
name|UINT32
name|Value
parameter_list|)
block|{
name|ACPI_NAMESPACE_NODE
modifier|*
name|Node
decl_stmt|;
name|ACPI_STATUS
name|Status
decl_stmt|;
comment|/* Translate name to an Named object */
name|Node
operator|=
name|AcpiDbConvertToNode
argument_list|(
name|Name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Node
condition|)
block|{
return|return;
block|}
comment|/* Decode Named object type */
switch|switch
condition|(
name|Node
operator|->
name|Type
condition|)
block|{
case|case
name|ACPI_TYPE_DEVICE
case|:
case|case
name|ACPI_TYPE_THERMAL
case|:
comment|/* Send the notify */
name|Status
operator|=
name|AcpiEvQueueNotifyRequest
argument_list|(
name|Node
argument_list|,
name|Value
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Could not queue notify\n"
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|AcpiOsPrintf
argument_list|(
literal|"Named object is not a device or a thermal object\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayInterfaces  *  * PARAMETERS:  ActionArg           - Null, "install", or "remove"  *              InterfaceNameArg    - Name for install/remove options  *  * RETURN:      None  *  * DESCRIPTION: Display or modify the global _OSI interface list  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbDisplayInterfaces
parameter_list|(
name|char
modifier|*
name|ActionArg
parameter_list|,
name|char
modifier|*
name|InterfaceNameArg
parameter_list|)
block|{
name|ACPI_INTERFACE_INFO
modifier|*
name|NextInterface
decl_stmt|;
name|char
modifier|*
name|SubString
decl_stmt|;
name|ACPI_STATUS
name|Status
decl_stmt|;
comment|/* If no arguments, just display current interface list */
if|if
condition|(
operator|!
name|ActionArg
condition|)
block|{
operator|(
name|void
operator|)
name|AcpiOsAcquireMutex
argument_list|(
name|AcpiGbl_OsiMutex
argument_list|,
name|ACPI_WAIT_FOREVER
argument_list|)
expr_stmt|;
name|NextInterface
operator|=
name|AcpiGbl_SupportedInterfaces
expr_stmt|;
while|while
condition|(
name|NextInterface
condition|)
block|{
if|if
condition|(
operator|!
operator|(
name|NextInterface
operator|->
name|Flags
operator|&
name|ACPI_OSI_INVALID
operator|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%s\n"
argument_list|,
name|NextInterface
operator|->
name|Name
argument_list|)
expr_stmt|;
block|}
name|NextInterface
operator|=
name|NextInterface
operator|->
name|Next
expr_stmt|;
block|}
name|AcpiOsReleaseMutex
argument_list|(
name|AcpiGbl_OsiMutex
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* If ActionArg exists, so must InterfaceNameArg */
if|if
condition|(
operator|!
name|InterfaceNameArg
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Missing Interface Name argument\n"
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Uppercase the action for match below */
name|AcpiUtStrupr
argument_list|(
name|ActionArg
argument_list|)
expr_stmt|;
comment|/* Install - install an interface */
name|SubString
operator|=
name|ACPI_STRSTR
argument_list|(
literal|"INSTALL"
argument_list|,
name|ActionArg
argument_list|)
expr_stmt|;
if|if
condition|(
name|SubString
condition|)
block|{
name|Status
operator|=
name|AcpiInstallInterface
argument_list|(
name|InterfaceNameArg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%s, while installing \"%s\"\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|,
name|InterfaceNameArg
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
comment|/* Remove - remove an interface */
name|SubString
operator|=
name|ACPI_STRSTR
argument_list|(
literal|"REMOVE"
argument_list|,
name|ActionArg
argument_list|)
expr_stmt|;
if|if
condition|(
name|SubString
condition|)
block|{
name|Status
operator|=
name|AcpiRemoveInterface
argument_list|(
name|InterfaceNameArg
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"%s, while removing \"%s\"\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|,
name|InterfaceNameArg
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
comment|/* Invalid ActionArg */
name|AcpiOsPrintf
argument_list|(
literal|"Invalid action argument: %s\n"
argument_list|,
name|ActionArg
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmCompareAmlResources  *  * PARAMETERS:  Aml1Buffer          - Contains first resource list  *              Aml1BufferLength    - Length of first resource list  *              Aml2Buffer          - Contains second resource list  *              Aml2BufferLength    - Length of second resource list  *  * RETURN:      None  *  * DESCRIPTION: Compare two AML resource lists, descriptor by descriptor (in  *              order to isolate a miscompare to an individual resource)  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|void
name|AcpiDmCompareAmlResources
parameter_list|(
name|UINT8
modifier|*
name|Aml1Buffer
parameter_list|,
name|ACPI_RSDESC_SIZE
name|Aml1BufferLength
parameter_list|,
name|UINT8
modifier|*
name|Aml2Buffer
parameter_list|,
name|ACPI_RSDESC_SIZE
name|Aml2BufferLength
parameter_list|)
block|{
name|UINT8
modifier|*
name|Aml1
decl_stmt|;
name|UINT8
modifier|*
name|Aml2
decl_stmt|;
name|ACPI_RSDESC_SIZE
name|Aml1Length
decl_stmt|;
name|ACPI_RSDESC_SIZE
name|Aml2Length
decl_stmt|;
name|ACPI_RSDESC_SIZE
name|Offset
init|=
literal|0
decl_stmt|;
name|UINT8
name|ResourceType
decl_stmt|;
name|UINT32
name|Count
init|=
literal|0
decl_stmt|;
comment|/* Compare overall buffer sizes (may be different due to size rounding) */
if|if
condition|(
name|Aml1BufferLength
operator|!=
name|Aml2BufferLength
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"**** Buffer length mismatch in converted AML: original %X new %X ****\n"
argument_list|,
name|Aml1BufferLength
argument_list|,
name|Aml2BufferLength
argument_list|)
expr_stmt|;
block|}
name|Aml1
operator|=
name|Aml1Buffer
expr_stmt|;
name|Aml2
operator|=
name|Aml2Buffer
expr_stmt|;
comment|/* Walk the descriptor lists, comparing each descriptor */
while|while
condition|(
name|Aml1
operator|<
operator|(
name|Aml1Buffer
operator|+
name|Aml1BufferLength
operator|)
condition|)
block|{
comment|/* Get the lengths of each descriptor */
name|Aml1Length
operator|=
name|AcpiUtGetDescriptorLength
argument_list|(
name|Aml1
argument_list|)
expr_stmt|;
name|Aml2Length
operator|=
name|AcpiUtGetDescriptorLength
argument_list|(
name|Aml2
argument_list|)
expr_stmt|;
name|ResourceType
operator|=
name|AcpiUtGetResourceType
argument_list|(
name|Aml1
argument_list|)
expr_stmt|;
comment|/* Check for descriptor length match */
if|if
condition|(
name|Aml1Length
operator|!=
name|Aml2Length
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"**** Length mismatch in descriptor [%.2X] type %2.2X, Offset %8.8X L1 %X L2 %X ****\n"
argument_list|,
name|Count
argument_list|,
name|ResourceType
argument_list|,
name|Offset
argument_list|,
name|Aml1Length
argument_list|,
name|Aml2Length
argument_list|)
expr_stmt|;
block|}
comment|/* Check for descriptor byte match */
elseif|else
if|if
condition|(
name|ACPI_MEMCMP
argument_list|(
name|Aml1
argument_list|,
name|Aml2
argument_list|,
name|Aml1Length
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"**** Data mismatch in descriptor [%.2X] type %2.2X, Offset %8.8X ****\n"
argument_list|,
name|Count
argument_list|,
name|ResourceType
argument_list|,
name|Offset
argument_list|)
expr_stmt|;
block|}
comment|/* Exit on EndTag descriptor */
if|if
condition|(
name|ResourceType
operator|==
name|ACPI_RESOURCE_NAME_END_TAG
condition|)
block|{
return|return;
block|}
comment|/* Point to next descriptor in each buffer */
name|Count
operator|++
expr_stmt|;
name|Offset
operator|+=
name|Aml1Length
expr_stmt|;
name|Aml1
operator|+=
name|Aml1Length
expr_stmt|;
name|Aml2
operator|+=
name|Aml2Length
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDmTestResourceConversion  *  * PARAMETERS:  Node            - Parent device node  *              Name            - resource method name (_CRS)  *  * RETURN:      Status  *  * DESCRIPTION: Compare the original AML with a conversion of the AML to  *              internal resource list, then back to AML.  *  ******************************************************************************/
end_comment

begin_function
specifier|static
name|ACPI_STATUS
name|AcpiDmTestResourceConversion
parameter_list|(
name|ACPI_NAMESPACE_NODE
modifier|*
name|Node
parameter_list|,
name|char
modifier|*
name|Name
parameter_list|)
block|{
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_BUFFER
name|ReturnObj
decl_stmt|;
name|ACPI_BUFFER
name|ResourceObj
decl_stmt|;
name|ACPI_BUFFER
name|NewAml
decl_stmt|;
name|ACPI_OBJECT
modifier|*
name|OriginalAml
decl_stmt|;
name|AcpiOsPrintf
argument_list|(
literal|"Resource Conversion Comparison:\n"
argument_list|)
expr_stmt|;
name|NewAml
operator|.
name|Length
operator|=
name|ACPI_ALLOCATE_LOCAL_BUFFER
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_ALLOCATE_LOCAL_BUFFER
expr_stmt|;
name|ResourceObj
operator|.
name|Length
operator|=
name|ACPI_ALLOCATE_LOCAL_BUFFER
expr_stmt|;
comment|/* Get the original _CRS AML resource template */
name|Status
operator|=
name|AcpiEvaluateObject
argument_list|(
name|Node
argument_list|,
name|Name
argument_list|,
name|NULL
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Could not obtain %s: %s\n"
argument_list|,
name|Name
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
comment|/* Get the AML resource template, converted to internal resource structs */
name|Status
operator|=
name|AcpiGetCurrentResources
argument_list|(
name|Node
argument_list|,
operator|&
name|ResourceObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiGetCurrentResources failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|Exit1
goto|;
block|}
comment|/* Convert internal resource list to external AML resource template */
name|Status
operator|=
name|AcpiRsCreateAmlResources
argument_list|(
name|ResourceObj
operator|.
name|Pointer
argument_list|,
operator|&
name|NewAml
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiRsCreateAmlResources failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|Exit2
goto|;
block|}
comment|/* Compare original AML to the newly created AML resource list */
name|OriginalAml
operator|=
name|ReturnObj
operator|.
name|Pointer
expr_stmt|;
name|AcpiDmCompareAmlResources
argument_list|(
name|OriginalAml
operator|->
name|Buffer
operator|.
name|Pointer
argument_list|,
operator|(
name|ACPI_RSDESC_SIZE
operator|)
name|OriginalAml
operator|->
name|Buffer
operator|.
name|Length
argument_list|,
name|NewAml
operator|.
name|Pointer
argument_list|,
operator|(
name|ACPI_RSDESC_SIZE
operator|)
name|NewAml
operator|.
name|Length
argument_list|)
expr_stmt|;
comment|/* Cleanup and exit */
name|ACPI_FREE
argument_list|(
name|NewAml
operator|.
name|Pointer
argument_list|)
expr_stmt|;
name|Exit2
label|:
name|ACPI_FREE
argument_list|(
name|ResourceObj
operator|.
name|Pointer
argument_list|)
expr_stmt|;
name|Exit1
label|:
name|ACPI_FREE
argument_list|(
name|ReturnObj
operator|.
name|Pointer
argument_list|)
expr_stmt|;
return|return
operator|(
name|Status
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbDisplayResources  *  * PARAMETERS:  ObjectArg       - String with hex value of the object  *  * RETURN:      None  *  * DESCRIPTION: Display the resource objects associated with a device.  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbDisplayResources
parameter_list|(
name|char
modifier|*
name|ObjectArg
parameter_list|)
block|{
name|ACPI_NAMESPACE_NODE
modifier|*
name|Node
decl_stmt|;
name|ACPI_STATUS
name|Status
decl_stmt|;
name|ACPI_BUFFER
name|ReturnObj
decl_stmt|;
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_REDIRECTABLE_OUTPUT
argument_list|)
expr_stmt|;
name|AcpiDbgLevel
operator||=
name|ACPI_LV_RESOURCES
expr_stmt|;
comment|/* Convert string to object pointer */
name|Node
operator|=
name|AcpiDbConvertToNode
argument_list|(
name|ObjectArg
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|Node
condition|)
block|{
return|return;
block|}
comment|/* Prepare for a return object of arbitrary size */
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
comment|/* _PRT */
name|AcpiOsPrintf
argument_list|(
literal|"Evaluating _PRT\n"
argument_list|)
expr_stmt|;
comment|/* Check if _PRT exists */
name|Status
operator|=
name|AcpiEvaluateObject
argument_list|(
name|Node
argument_list|,
name|METHOD_NAME__PRT
argument_list|,
name|NULL
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Could not obtain _PRT: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|GetCrs
goto|;
block|}
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
name|Status
operator|=
name|AcpiGetIrqRoutingTable
argument_list|(
name|Node
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"GetIrqRoutingTable failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|GetCrs
goto|;
block|}
name|AcpiRsDumpIrqList
argument_list|(
name|ACPI_CAST_PTR
argument_list|(
name|UINT8
argument_list|,
name|AcpiGbl_DbBuffer
argument_list|)
argument_list|)
expr_stmt|;
comment|/* _CRS */
name|GetCrs
label|:
name|AcpiOsPrintf
argument_list|(
literal|"Evaluating _CRS\n"
argument_list|)
expr_stmt|;
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
comment|/* Check if _CRS exists */
name|Status
operator|=
name|AcpiEvaluateObject
argument_list|(
name|Node
argument_list|,
name|METHOD_NAME__CRS
argument_list|,
name|NULL
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Could not obtain _CRS: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|GetPrs
goto|;
block|}
comment|/* Get the _CRS resource list */
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
name|Status
operator|=
name|AcpiGetCurrentResources
argument_list|(
name|Node
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiGetCurrentResources failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|GetPrs
goto|;
block|}
comment|/* Dump the _CRS resource list */
name|AcpiRsDumpResourceList
argument_list|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_RESOURCE
argument_list|,
name|ReturnObj
operator|.
name|Pointer
argument_list|)
argument_list|)
expr_stmt|;
comment|/*      * Perform comparison of original AML to newly created AML. This tests both      * the AML->Resource conversion and the Resource->Aml conversion.      */
name|Status
operator|=
name|AcpiDmTestResourceConversion
argument_list|(
name|Node
argument_list|,
name|METHOD_NAME__CRS
argument_list|)
expr_stmt|;
comment|/* Execute _SRS with the resource list */
name|Status
operator|=
name|AcpiSetCurrentResources
argument_list|(
name|Node
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiSetCurrentResources failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|GetPrs
goto|;
block|}
comment|/* _PRS */
name|GetPrs
label|:
name|AcpiOsPrintf
argument_list|(
literal|"Evaluating _PRS\n"
argument_list|)
expr_stmt|;
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
comment|/* Check if _PRS exists */
name|Status
operator|=
name|AcpiEvaluateObject
argument_list|(
name|Node
argument_list|,
name|METHOD_NAME__PRS
argument_list|,
name|NULL
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Could not obtain _PRS: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|Cleanup
goto|;
block|}
name|ReturnObj
operator|.
name|Pointer
operator|=
name|AcpiGbl_DbBuffer
expr_stmt|;
name|ReturnObj
operator|.
name|Length
operator|=
name|ACPI_DEBUG_BUFFER_SIZE
expr_stmt|;
name|Status
operator|=
name|AcpiGetPossibleResources
argument_list|(
name|Node
argument_list|,
operator|&
name|ReturnObj
argument_list|)
expr_stmt|;
if|if
condition|(
name|ACPI_FAILURE
argument_list|(
name|Status
argument_list|)
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"AcpiGetPossibleResources failed: %s\n"
argument_list|,
name|AcpiFormatException
argument_list|(
name|Status
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|Cleanup
goto|;
block|}
name|AcpiRsDumpResourceList
argument_list|(
name|ACPI_CAST_PTR
argument_list|(
name|ACPI_RESOURCE
argument_list|,
name|AcpiGbl_DbBuffer
argument_list|)
argument_list|)
expr_stmt|;
name|Cleanup
label|:
name|AcpiDbSetOutputDestination
argument_list|(
name|ACPI_DB_CONSOLE_OUTPUT
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_comment
comment|/*******************************************************************************  *  * FUNCTION:    AcpiDbGenerateGpe  *  * PARAMETERS:  GpeArg          - Raw GPE number, ascii string  *              BlockArg        - GPE block number, ascii string  *                                0 or 1 for FADT GPE blocks  *  * RETURN:      None  *  * DESCRIPTION: Generate a GPE  *  ******************************************************************************/
end_comment

begin_function
name|void
name|AcpiDbGenerateGpe
parameter_list|(
name|char
modifier|*
name|GpeArg
parameter_list|,
name|char
modifier|*
name|BlockArg
parameter_list|)
block|{
name|UINT32
name|BlockNumber
decl_stmt|;
name|UINT32
name|GpeNumber
decl_stmt|;
name|ACPI_GPE_EVENT_INFO
modifier|*
name|GpeEventInfo
decl_stmt|;
name|GpeNumber
operator|=
name|ACPI_STRTOUL
argument_list|(
name|GpeArg
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|BlockNumber
operator|=
name|ACPI_STRTOUL
argument_list|(
name|BlockArg
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|GpeEventInfo
operator|=
name|AcpiEvGetGpeEventInfo
argument_list|(
name|ACPI_TO_POINTER
argument_list|(
name|BlockNumber
argument_list|)
argument_list|,
name|GpeNumber
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GpeEventInfo
condition|)
block|{
name|AcpiOsPrintf
argument_list|(
literal|"Invalid GPE\n"
argument_list|)
expr_stmt|;
return|return;
block|}
operator|(
name|void
operator|)
name|AcpiEvGpeDispatch
argument_list|(
name|NULL
argument_list|,
name|GpeEventInfo
argument_list|,
name|GpeNumber
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ACPI_DEBUGGER */
end_comment

end_unit

