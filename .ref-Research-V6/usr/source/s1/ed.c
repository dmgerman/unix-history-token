begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_empty
empty|#
end_empty

begin_comment
comment|/*  * Editor  */
end_comment

begin_define
define|#
directive|define
name|SIGHUP
value|1
end_define

begin_define
define|#
directive|define
name|SIGINTR
value|2
end_define

begin_define
define|#
directive|define
name|SIGQUIT
value|3
end_define

begin_define
define|#
directive|define
name|FNSIZE
value|64
end_define

begin_define
define|#
directive|define
name|LBSIZE
value|512
end_define

begin_define
define|#
directive|define
name|ESIZE
value|128
end_define

begin_define
define|#
directive|define
name|GBSIZE
value|256
end_define

begin_define
define|#
directive|define
name|NBRA
value|5
end_define

begin_define
define|#
directive|define
name|EOF
value|-1
end_define

begin_define
define|#
directive|define
name|CBRA
value|1
end_define

begin_define
define|#
directive|define
name|CCHR
value|2
end_define

begin_define
define|#
directive|define
name|CDOT
value|4
end_define

begin_define
define|#
directive|define
name|CCL
value|6
end_define

begin_define
define|#
directive|define
name|NCCL
value|8
end_define

begin_define
define|#
directive|define
name|CDOL
value|10
end_define

begin_define
define|#
directive|define
name|CEOF
value|11
end_define

begin_define
define|#
directive|define
name|CKET
value|12
end_define

begin_define
define|#
directive|define
name|STAR
value|01
end_define

begin_define
define|#
directive|define
name|error
value|goto errlab
end_define

begin_define
define|#
directive|define
name|READ
value|0
end_define

begin_define
define|#
directive|define
name|WRITE
value|1
end_define

begin_decl_stmt
name|int
name|peekc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|lastc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|savedfile
index|[
name|FNSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|file
index|[
name|FNSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|linebuf
index|[
name|LBSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|rhsbuf
index|[
name|LBSIZE
operator|/
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|expbuf
index|[
name|ESIZE
operator|+
literal|4
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|circfl
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|zero
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|dot
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|dol
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|endcore
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|fendcore
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|addr1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|addr2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|genbuf
index|[
name|LBSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|count
index|[
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|nextip
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|linebp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|ninbuf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|io
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|pflag
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|onhup
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|onquit
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|vflag
literal|1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|listf
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|col
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|globp
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|tfile
operator|-
literal|1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|tline
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|tfname
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|loc1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|loc2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|locs
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
name|ibuff
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|iblock
operator|-
literal|1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|char
name|obuff
index|[
literal|512
index|]
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|int
name|oblock
operator|-
literal|1
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|ichanged
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|nleft
decl_stmt|;
end_decl_stmt

begin_function_decl
name|int
name|errfunc
parameter_list|()
function_decl|;
end_function_decl

begin_decl_stmt
name|int
modifier|*
name|errlab
name|errfunc
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|char
name|TMPERR
index|[]
literal|"TMP"
expr_stmt|;
end_expr_stmt

begin_decl_stmt
name|int
name|names
index|[
literal|26
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|braslist
index|[
name|NBRA
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|braelist
index|[
name|NBRA
index|]
decl_stmt|;
end_decl_stmt

begin_function
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
specifier|extern
name|int
name|onintr
parameter_list|()
function_decl|;
name|onquit
operator|=
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|onhup
operator|=
name|signal
argument_list|(
name|SIGHUP
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|argv
operator|++
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|1
operator|&&
operator|*
operator|*
name|argv
operator|==
literal|'-'
condition|)
block|{
name|vflag
operator|=
literal|0
expr_stmt|;
comment|/* allow debugging quits? */
if|if
condition|(
operator|(
operator|*
name|argv
operator|)
index|[
literal|1
index|]
operator|==
literal|'q'
condition|)
block|{
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vflag
operator|++
expr_stmt|;
block|}
name|argv
operator|++
expr_stmt|;
name|argc
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|argc
operator|>
literal|1
condition|)
block|{
name|p1
operator|=
operator|*
name|argv
expr_stmt|;
name|p2
operator|=
name|savedfile
expr_stmt|;
while|while
condition|(
operator|*
name|p2
operator|++
operator|=
operator|*
name|p1
operator|++
condition|)
empty_stmt|;
name|globp
operator|=
literal|"r"
expr_stmt|;
block|}
name|fendcore
operator|=
name|sbrk
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|signal
argument_list|(
name|SIGINTR
argument_list|,
literal|1
argument_list|)
operator|&
literal|01
operator|)
operator|==
literal|0
condition|)
name|signal
argument_list|(
name|SIGINTR
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
name|setexit
argument_list|()
expr_stmt|;
name|commands
argument_list|()
expr_stmt|;
name|unlink
argument_list|(
name|tfname
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|commands
argument_list|()
end_macro

begin_block
block|{
name|int
name|getfile
argument_list|()
decl_stmt|,
name|gettty
argument_list|()
decl_stmt|;
specifier|register
operator|*
name|a1
operator|,
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|r
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|pflag
condition|)
block|{
name|pflag
operator|=
literal|0
expr_stmt|;
name|addr1
operator|=
name|addr2
operator|=
name|dot
expr_stmt|;
goto|goto
name|print
goto|;
block|}
name|addr1
operator|=
literal|0
expr_stmt|;
name|addr2
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|addr1
operator|=
name|addr2
expr_stmt|;
if|if
condition|(
operator|(
name|a1
operator|=
name|address
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
break|break;
block|}
name|addr2
operator|=
name|a1
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|';'
condition|)
block|{
name|c
operator|=
literal|','
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
block|}
block|}
do|while
condition|(
name|c
operator|==
literal|','
condition|)
do|;
if|if
condition|(
name|addr1
operator|==
literal|0
condition|)
name|addr1
operator|=
name|addr2
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'a'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'c'
case|:
name|delete
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr1
operator|-
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'d'
case|:
name|delete
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'e'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|peekc
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|' '
condition|)
name|error
expr_stmt|;
name|savedfile
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
name|addr2
operator|=
name|zero
expr_stmt|;
goto|goto
name|caseread
goto|;
case|case
literal|'f'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
name|peekc
operator|=
name|c
expr_stmt|;
name|savedfile
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|filename
argument_list|()
expr_stmt|;
block|}
name|puts
argument_list|(
name|savedfile
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'g'
case|:
name|global
argument_list|(
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'i'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|append
argument_list|(
name|gettty
argument_list|,
name|addr2
operator|-
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'k'
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|<
literal|'a'
operator|||
name|c
operator|>
literal|'z'
condition|)
name|error
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|names
index|[
name|c
operator|-
literal|'a'
index|]
operator|=
operator|*
name|addr2
operator||
literal|01
expr_stmt|;
continue|continue;
case|case
literal|'m'
case|:
name|move
argument_list|(
literal|0
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'\n'
case|:
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
name|addr2
operator|=
name|dot
operator|+
literal|1
expr_stmt|;
name|addr1
operator|=
name|addr2
expr_stmt|;
goto|goto
name|print
goto|;
case|case
literal|'l'
case|:
name|listf
operator|++
expr_stmt|;
case|case
literal|'p'
case|:
name|newline
argument_list|()
expr_stmt|;
name|print
label|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|a1
operator|=
name|addr1
expr_stmt|;
do|do
name|puts
argument_list|(
name|getline
argument_list|(
operator|*
name|a1
operator|++
argument_list|)
argument_list|)
expr_stmt|;
do|while
condition|(
name|a1
operator|<=
name|addr2
condition|)
do|;
name|dot
operator|=
name|addr2
expr_stmt|;
name|listf
operator|=
literal|0
expr_stmt|;
continue|continue;
case|case
literal|'q'
case|:
name|setnoaddr
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|unlink
argument_list|(
name|tfname
argument_list|)
expr_stmt|;
name|exit
argument_list|()
expr_stmt|;
case|case
literal|'r'
case|:
name|caseread
label|:
name|filename
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|io
operator|=
name|open
argument_list|(
name|file
argument_list|,
literal|0
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
expr_stmt|;
block|}
name|setall
argument_list|()
expr_stmt|;
name|ninbuf
operator|=
literal|0
expr_stmt|;
name|append
argument_list|(
name|getfile
argument_list|,
name|addr2
argument_list|)
expr_stmt|;
name|exfile
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'s'
case|:
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|substitute
argument_list|(
name|globp
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'t'
case|:
name|move
argument_list|(
literal|1
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'v'
case|:
name|global
argument_list|(
literal|0
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'w'
case|:
name|setall
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|filename
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|io
operator|=
name|creat
argument_list|(
name|file
argument_list|,
literal|0666
argument_list|)
operator|)
operator|<
literal|0
condition|)
name|error
expr_stmt|;
name|putfile
argument_list|()
expr_stmt|;
name|exfile
argument_list|()
expr_stmt|;
continue|continue;
case|case
literal|'='
case|:
name|setall
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|count
index|[
literal|1
index|]
operator|=
operator|(
name|addr2
operator|-
name|zero
operator|)
operator|&
literal|077777
expr_stmt|;
name|putd
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
continue|continue;
case|case
literal|'!'
case|:
name|unix
argument_list|()
expr_stmt|;
continue|continue;
case|case
name|EOF
case|:
return|return;
block|}
name|error
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|address
argument_list|()
end_macro

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
name|minus
operator|,
name|c
expr_stmt|;
name|int
name|n
decl_stmt|,
name|relerr
decl_stmt|;
name|minus
operator|=
literal|0
expr_stmt|;
name|a1
operator|=
literal|0
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
literal|'0'
operator|<=
name|c
operator|&&
name|c
operator|<=
literal|'9'
condition|)
block|{
name|n
operator|=
literal|0
expr_stmt|;
do|do
block|{
name|n
operator|=
operator|*
literal|10
expr_stmt|;
name|n
operator|=
operator|+
name|c
operator|-
literal|'0'
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|>=
literal|'0'
operator|&&
name|c
operator|<=
literal|'9'
condition|)
do|;
name|peekc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|zero
expr_stmt|;
if|if
condition|(
name|minus
operator|<
literal|0
condition|)
name|n
operator|=
operator|-
name|n
expr_stmt|;
name|a1
operator|=
operator|+
name|n
expr_stmt|;
name|minus
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
name|relerr
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|a1
operator|||
name|minus
condition|)
name|relerr
operator|++
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|' '
case|:
case|case
literal|'\t'
case|:
continue|continue;
case|case
literal|'+'
case|:
name|minus
operator|++
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|dot
expr_stmt|;
continue|continue;
case|case
literal|'-'
case|:
case|case
literal|'^'
case|:
name|minus
operator|--
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
name|a1
operator|=
name|dot
expr_stmt|;
continue|continue;
case|case
literal|'?'
case|:
case|case
literal|'/'
case|:
name|compile
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|a1
operator|=
name|dot
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|c
operator|==
literal|'/'
condition|)
block|{
name|a1
operator|++
expr_stmt|;
if|if
condition|(
name|a1
operator|>
name|dol
condition|)
name|a1
operator|=
name|zero
expr_stmt|;
block|}
else|else
block|{
name|a1
operator|--
expr_stmt|;
if|if
condition|(
name|a1
operator|<
name|zero
condition|)
name|a1
operator|=
name|dol
expr_stmt|;
block|}
if|if
condition|(
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
condition|)
break|break;
if|if
condition|(
name|a1
operator|==
name|dot
condition|)
name|error
expr_stmt|;
block|}
break|break;
case|case
literal|'$'
case|:
name|a1
operator|=
name|dol
expr_stmt|;
break|break;
case|case
literal|'.'
case|:
name|a1
operator|=
name|dot
expr_stmt|;
break|break;
case|case
literal|'\''
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|<
literal|'a'
operator|||
name|c
operator|>
literal|'z'
condition|)
name|error
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
if|if
condition|(
name|names
index|[
name|c
operator|-
literal|'a'
index|]
operator|==
operator|(
operator|*
name|a1
operator||
literal|01
operator|)
condition|)
break|break;
break|break;
default|default:
name|peekc
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|a1
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|a1
operator|=
operator|+
name|minus
expr_stmt|;
if|if
condition|(
name|a1
operator|<
name|zero
operator|||
name|a1
operator|>
name|dol
condition|)
name|error
expr_stmt|;
return|return
operator|(
name|a1
operator|)
return|;
block|}
if|if
condition|(
name|relerr
condition|)
name|error
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|setdot
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
name|addr1
operator|=
name|addr2
operator|=
name|dot
expr_stmt|;
if|if
condition|(
name|addr1
operator|>
name|addr2
condition|)
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|setall
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
operator|==
literal|0
condition|)
block|{
name|addr1
operator|=
name|zero
operator|+
literal|1
expr_stmt|;
name|addr2
operator|=
name|dol
expr_stmt|;
if|if
condition|(
name|dol
operator|==
name|zero
condition|)
name|addr1
operator|=
name|zero
expr_stmt|;
block|}
name|setdot
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|setnoaddr
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr2
condition|)
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|nonzero
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr1
operator|<=
name|zero
operator|||
name|addr2
operator|>
name|dol
condition|)
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|newline
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'\n'
condition|)
return|return;
if|if
condition|(
name|c
operator|==
literal|'p'
operator|||
name|c
operator|==
literal|'l'
condition|)
block|{
name|pflag
operator|++
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'l'
condition|)
name|listf
operator|++
expr_stmt|;
if|if
condition|(
name|getchar
argument_list|()
operator|==
literal|'\n'
condition|)
return|return;
block|}
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|filename
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
specifier|register
name|c
expr_stmt|;
name|count
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
operator|||
name|c
operator|==
name|EOF
condition|)
block|{
name|p1
operator|=
name|savedfile
expr_stmt|;
if|if
condition|(
operator|*
name|p1
operator|==
literal|0
condition|)
name|error
expr_stmt|;
name|p2
operator|=
name|file
expr_stmt|;
while|while
condition|(
operator|*
name|p2
operator|++
operator|=
operator|*
name|p1
operator|++
condition|)
empty_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|!=
literal|' '
condition|)
name|error
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|' '
condition|)
empty_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
name|error
expr_stmt|;
name|p1
operator|=
name|file
expr_stmt|;
do|do
block|{
operator|*
name|p1
operator|++
operator|=
name|c
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
do|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|savedfile
index|[
literal|0
index|]
operator|==
literal|0
condition|)
block|{
name|p1
operator|=
name|savedfile
expr_stmt|;
name|p2
operator|=
name|file
expr_stmt|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
block|}
block|}
end_block

begin_macro
name|exfile
argument_list|()
end_macro

begin_block
block|{
name|close
argument_list|(
name|io
argument_list|)
expr_stmt|;
name|io
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|vflag
condition|)
block|{
name|putd
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|onintr
argument_list|()
end_macro

begin_block
block|{
name|signal
argument_list|(
name|SIGINTR
argument_list|,
name|onintr
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|errfunc
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
name|listf
operator|=
literal|0
expr_stmt|;
name|puts
argument_list|(
literal|"?"
argument_list|)
expr_stmt|;
name|count
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|seek
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pflag
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|globp
condition|)
name|lastc
operator|=
literal|'\n'
expr_stmt|;
name|globp
operator|=
literal|0
expr_stmt|;
name|peekc
operator|=
name|lastc
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
operator|&&
name|c
operator|!=
name|EOF
condition|)
empty_stmt|;
if|if
condition|(
name|io
operator|>
literal|0
condition|)
block|{
name|close
argument_list|(
name|io
argument_list|)
expr_stmt|;
name|io
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|reset
argument_list|()
expr_stmt|;
block|}
end_block

begin_macro
name|getchar
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|lastc
operator|=
name|peekc
condition|)
block|{
name|peekc
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|lastc
operator|)
return|;
block|}
if|if
condition|(
name|globp
condition|)
block|{
if|if
condition|(
operator|(
name|lastc
operator|=
operator|*
name|globp
operator|++
operator|)
operator|!=
literal|0
condition|)
return|return
operator|(
name|lastc
operator|)
return|;
name|globp
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|EOF
operator|)
return|;
block|}
if|if
condition|(
name|read
argument_list|(
literal|0
argument_list|,
operator|&
name|lastc
argument_list|,
literal|1
argument_list|)
operator|<=
literal|0
condition|)
return|return
operator|(
name|lastc
operator|=
name|EOF
operator|)
return|;
name|lastc
operator|=
operator|&
literal|0177
expr_stmt|;
return|return
operator|(
name|lastc
operator|)
return|;
block|}
end_block

begin_macro
name|gettty
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
operator|,
name|gf
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|linebuf
expr_stmt|;
name|gf
operator|=
name|globp
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
block|{
if|if
condition|(
name|gf
condition|)
name|peekc
operator|=
name|c
expr_stmt|;
return|return
operator|(
name|c
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|c
operator|=
operator|&
literal|0177
operator|)
operator|==
literal|0
condition|)
continue|continue;
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|p
operator|>=
operator|&
name|linebuf
index|[
name|LBSIZE
operator|-
literal|2
index|]
condition|)
name|error
expr_stmt|;
block|}
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|linebuf
index|[
literal|0
index|]
operator|==
literal|'.'
operator|&&
name|linebuf
index|[
literal|1
index|]
operator|==
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|getfile
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|lp
decl_stmt|,
modifier|*
name|fp
decl_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|fp
operator|=
name|nextip
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|--
name|ninbuf
operator|<
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|ninbuf
operator|=
name|read
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|LBSIZE
argument_list|)
operator|-
literal|1
operator|)
operator|<
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
name|fp
operator|=
name|genbuf
expr_stmt|;
block|}
if|if
condition|(
name|lp
operator|>=
operator|&
name|linebuf
index|[
name|LBSIZE
index|]
condition|)
name|error
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|lp
operator|++
operator|=
name|c
operator|=
operator|*
name|fp
operator|++
operator|&
literal|0177
operator|)
operator|==
literal|0
condition|)
block|{
name|lp
operator|--
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|++
name|count
index|[
literal|1
index|]
operator|==
literal|0
condition|)
operator|++
name|count
index|[
literal|0
index|]
expr_stmt|;
block|}
do|while
condition|(
name|c
operator|!=
literal|'\n'
condition|)
do|;
operator|*
operator|--
name|lp
operator|=
literal|0
expr_stmt|;
name|nextip
operator|=
name|fp
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|putfile
argument_list|()
end_macro

begin_block
block|{
name|int
modifier|*
name|a1
decl_stmt|;
specifier|register
name|char
modifier|*
name|fp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nib
expr_stmt|;
name|nib
operator|=
literal|512
expr_stmt|;
name|fp
operator|=
name|genbuf
expr_stmt|;
name|a1
operator|=
name|addr1
expr_stmt|;
do|do
block|{
name|lp
operator|=
name|getline
argument_list|(
operator|*
name|a1
operator|++
argument_list|)
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
operator|--
name|nib
operator|<
literal|0
condition|)
block|{
name|write
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|fp
operator|-
name|genbuf
argument_list|)
expr_stmt|;
name|nib
operator|=
literal|511
expr_stmt|;
name|fp
operator|=
name|genbuf
expr_stmt|;
block|}
if|if
condition|(
operator|++
name|count
index|[
literal|1
index|]
operator|==
literal|0
condition|)
operator|++
name|count
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
operator|(
operator|*
name|fp
operator|++
operator|=
operator|*
name|lp
operator|++
operator|)
operator|==
literal|0
condition|)
block|{
name|fp
index|[
operator|-
literal|1
index|]
operator|=
literal|'\n'
expr_stmt|;
break|break;
block|}
block|}
block|}
do|while
condition|(
name|a1
operator|<=
name|addr2
condition|)
do|;
name|write
argument_list|(
name|io
argument_list|,
name|genbuf
argument_list|,
name|fp
operator|-
name|genbuf
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|append
argument_list|(
argument|f
argument_list|,
argument|a
argument_list|)
end_macro

begin_function_decl
name|int
function_decl|(
modifier|*
name|f
function_decl|)
parameter_list|()
function_decl|;
end_function_decl

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
operator|*
name|a2
operator|,
operator|*
name|rdot
expr_stmt|;
name|int
name|nline
decl_stmt|,
name|tl
decl_stmt|;
struct|struct
block|{
name|int
name|integer
decl_stmt|;
block|}
struct|;
name|nline
operator|=
literal|0
expr_stmt|;
name|dot
operator|=
name|a
expr_stmt|;
while|while
condition|(
call|(
modifier|*
name|f
call|)
argument_list|()
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|dol
operator|>=
name|endcore
condition|)
block|{
if|if
condition|(
name|sbrk
argument_list|(
literal|1024
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|error
expr_stmt|;
name|endcore
operator|.
name|integer
operator|=
operator|+
literal|1024
expr_stmt|;
block|}
name|tl
operator|=
name|putline
argument_list|()
expr_stmt|;
name|nline
operator|++
expr_stmt|;
name|a1
operator|=
operator|++
name|dol
expr_stmt|;
name|a2
operator|=
name|a1
operator|+
literal|1
expr_stmt|;
name|rdot
operator|=
operator|++
name|dot
expr_stmt|;
while|while
condition|(
name|a1
operator|>
name|rdot
condition|)
operator|*
operator|--
name|a2
operator|=
operator|*
operator|--
name|a1
expr_stmt|;
operator|*
name|rdot
operator|=
name|tl
expr_stmt|;
block|}
return|return
operator|(
name|nline
operator|)
return|;
block|}
end_block

begin_macro
name|unix
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|savint
operator|,
name|pid
operator|,
name|rpid
expr_stmt|;
name|int
name|retcode
decl_stmt|;
name|setnoaddr
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|pid
operator|=
name|fork
argument_list|()
operator|)
operator|==
literal|0
condition|)
block|{
name|signal
argument_list|(
name|SIGHUP
argument_list|,
name|onhup
argument_list|)
expr_stmt|;
name|signal
argument_list|(
name|SIGQUIT
argument_list|,
name|onquit
argument_list|)
expr_stmt|;
name|execl
argument_list|(
literal|"/bin/sh"
argument_list|,
literal|"sh"
argument_list|,
literal|"-t"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|exit
argument_list|()
expr_stmt|;
block|}
name|savint
operator|=
name|signal
argument_list|(
name|SIGINTR
argument_list|,
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
operator|(
name|rpid
operator|=
name|wait
argument_list|(
operator|&
name|retcode
argument_list|)
operator|)
operator|!=
name|pid
operator|&&
name|rpid
operator|!=
operator|-
literal|1
condition|)
empty_stmt|;
name|signal
argument_list|(
name|SIGINTR
argument_list|,
name|savint
argument_list|)
expr_stmt|;
name|puts
argument_list|(
literal|"!"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|delete
argument_list|()
end_macro

begin_block
block|{
specifier|register
operator|*
name|a1
operator|,
operator|*
name|a2
operator|,
operator|*
name|a3
expr_stmt|;
name|setdot
argument_list|()
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
name|a1
operator|=
name|addr1
expr_stmt|;
name|a2
operator|=
name|addr2
operator|+
literal|1
expr_stmt|;
name|a3
operator|=
name|dol
expr_stmt|;
name|dol
operator|=
operator|-
name|a2
operator|-
name|a1
expr_stmt|;
do|do
operator|*
name|a1
operator|++
operator|=
operator|*
name|a2
operator|++
expr_stmt|;
do|while
condition|(
name|a2
operator|<=
name|a3
condition|)
do|;
name|a1
operator|=
name|addr1
expr_stmt|;
if|if
condition|(
name|a1
operator|>
name|dol
condition|)
name|a1
operator|=
name|dol
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
block|}
end_block

begin_macro
name|getline
argument_list|(
argument|tl
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nl
expr_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|bp
operator|=
name|getblock
argument_list|(
name|tl
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
name|tl
operator|=
operator|&
operator|~
literal|0377
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|=
operator|*
name|bp
operator|++
condition|)
if|if
condition|(
operator|--
name|nl
operator|==
literal|0
condition|)
block|{
name|bp
operator|=
name|getblock
argument_list|(
name|tl
operator|=
operator|+
literal|0400
argument_list|,
name|READ
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
block|}
return|return
operator|(
name|linebuf
operator|)
return|;
block|}
end_block

begin_macro
name|putline
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|bp
decl_stmt|,
modifier|*
name|lp
decl_stmt|;
specifier|register
name|nl
expr_stmt|;
name|int
name|tl
decl_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|tl
operator|=
name|tline
expr_stmt|;
name|bp
operator|=
name|getblock
argument_list|(
name|tl
argument_list|,
name|WRITE
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
name|tl
operator|=
operator|&
operator|~
literal|0377
expr_stmt|;
while|while
condition|(
operator|*
name|bp
operator|=
operator|*
name|lp
operator|++
condition|)
block|{
if|if
condition|(
operator|*
name|bp
operator|++
operator|==
literal|'\n'
condition|)
block|{
operator|*
operator|--
name|bp
operator|=
literal|0
expr_stmt|;
name|linebp
operator|=
name|lp
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|--
name|nl
operator|==
literal|0
condition|)
block|{
name|bp
operator|=
name|getblock
argument_list|(
name|tl
operator|=
operator|+
literal|0400
argument_list|,
name|WRITE
argument_list|)
expr_stmt|;
name|nl
operator|=
name|nleft
expr_stmt|;
block|}
block|}
name|nl
operator|=
name|tline
expr_stmt|;
name|tline
operator|=
operator|+
operator|(
operator|(
operator|(
name|lp
operator|-
name|linebuf
operator|)
operator|+
literal|03
operator|)
operator|>>
literal|1
operator|)
operator|&
literal|077776
expr_stmt|;
return|return
operator|(
name|nl
operator|)
return|;
block|}
end_block

begin_macro
name|getblock
argument_list|(
argument|atl
argument_list|,
argument|iof
argument_list|)
end_macro

begin_block
block|{
extern|extern read(
block|)
end_block

begin_operator
operator|,
end_operator

begin_expr_stmt
name|write
argument_list|()
expr_stmt|;
end_expr_stmt

begin_expr_stmt
specifier|register
name|bno
operator|,
name|off
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|bno
operator|=
operator|(
name|atl
operator|>>
literal|8
operator|)
operator|&
literal|0377
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|off
operator|=
operator|(
name|atl
operator|<<
literal|1
operator|)
operator|&
literal|0774
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|bno
operator|>=
literal|255
condition|)
block|{
name|puts
argument_list|(
name|TMPERR
argument_list|)
expr_stmt|;
name|error
expr_stmt|;
block|}
end_if

begin_expr_stmt
name|nleft
operator|=
literal|512
operator|-
name|off
expr_stmt|;
end_expr_stmt

begin_if
if|if
condition|(
name|bno
operator|==
name|iblock
condition|)
block|{
name|ichanged
operator|=
operator||
name|iof
expr_stmt|;
return|return
operator|(
name|ibuff
operator|+
name|off
operator|)
return|;
block|}
end_if

begin_if
if|if
condition|(
name|bno
operator|==
name|oblock
condition|)
return|return
operator|(
name|obuff
operator|+
name|off
operator|)
return|;
end_if

begin_if
if|if
condition|(
name|iof
operator|==
name|READ
condition|)
block|{
if|if
condition|(
name|ichanged
condition|)
name|blkio
argument_list|(
name|iblock
argument_list|,
name|ibuff
argument_list|,
name|write
argument_list|)
expr_stmt|;
name|ichanged
operator|=
literal|0
expr_stmt|;
name|iblock
operator|=
name|bno
expr_stmt|;
name|blkio
argument_list|(
name|bno
argument_list|,
name|ibuff
argument_list|,
name|read
argument_list|)
expr_stmt|;
return|return
operator|(
name|ibuff
operator|+
name|off
operator|)
return|;
block|}
end_if

begin_if
if|if
condition|(
name|oblock
operator|>=
literal|0
condition|)
name|blkio
argument_list|(
name|oblock
argument_list|,
name|obuff
argument_list|,
name|write
argument_list|)
expr_stmt|;
end_if

begin_expr_stmt
name|oblock
operator|=
name|bno
expr_stmt|;
end_expr_stmt

begin_return
return|return
operator|(
name|obuff
operator|+
name|off
operator|)
return|;
end_return

begin_expr_stmt
unit|}  blkio
operator|(
name|b
operator|,
name|buf
operator|,
name|iofcn
operator|)
name|int
argument_list|(
operator|*
name|iofcn
argument_list|)
argument_list|()
expr_stmt|;
end_expr_stmt

begin_block
block|{
name|seek
argument_list|(
name|tfile
argument_list|,
name|b
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
call|(
modifier|*
name|iofcn
call|)
argument_list|(
name|tfile
argument_list|,
name|buf
argument_list|,
literal|512
argument_list|)
operator|!=
literal|512
condition|)
block|{
name|puts
argument_list|(
name|TMPERR
argument_list|)
expr_stmt|;
name|error
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|init
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
specifier|register
name|pid
expr_stmt|;
name|close
argument_list|(
name|tfile
argument_list|)
expr_stmt|;
name|tline
operator|=
literal|0
expr_stmt|;
name|iblock
operator|=
operator|-
literal|1
expr_stmt|;
name|oblock
operator|=
operator|-
literal|1
expr_stmt|;
name|tfname
operator|=
literal|"/tmp/exxxxx"
expr_stmt|;
name|ichanged
operator|=
literal|0
expr_stmt|;
name|pid
operator|=
name|getpid
argument_list|()
expr_stmt|;
for|for
control|(
name|p
operator|=
operator|&
name|tfname
index|[
literal|11
index|]
init|;
name|p
operator|>
operator|&
name|tfname
index|[
literal|6
index|]
condition|;
control|)
block|{
operator|*
operator|--
name|p
operator|=
operator|(
name|pid
operator|&
literal|07
operator|)
operator|+
literal|'0'
expr_stmt|;
name|pid
operator|=
operator|>>
literal|3
expr_stmt|;
block|}
name|close
argument_list|(
name|creat
argument_list|(
name|tfname
argument_list|,
literal|0600
argument_list|)
argument_list|)
expr_stmt|;
name|tfile
operator|=
name|open
argument_list|(
name|tfname
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|brk
argument_list|(
name|fendcore
argument_list|)
expr_stmt|;
name|dot
operator|=
name|zero
operator|=
name|dol
operator|=
name|fendcore
expr_stmt|;
name|endcore
operator|=
name|fendcore
operator|-
literal|2
expr_stmt|;
block|}
end_block

begin_macro
name|global
argument_list|(
argument|k
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|gp
decl_stmt|;
specifier|register
name|c
expr_stmt|;
specifier|register
name|int
modifier|*
name|a1
decl_stmt|;
name|char
name|globuf
index|[
name|GBSIZE
index|]
decl_stmt|;
if|if
condition|(
name|globp
condition|)
name|error
expr_stmt|;
name|setall
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'\n'
condition|)
name|error
expr_stmt|;
name|compile
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|gp
operator|=
name|globuf
expr_stmt|;
while|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|'\n'
condition|)
block|{
if|if
condition|(
name|c
operator|==
name|EOF
condition|)
name|error
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|!=
literal|'\n'
condition|)
operator|*
name|gp
operator|++
operator|=
literal|'\\'
expr_stmt|;
block|}
operator|*
name|gp
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|gp
operator|>=
operator|&
name|globuf
index|[
name|GBSIZE
operator|-
literal|2
index|]
condition|)
name|error
expr_stmt|;
block|}
operator|*
name|gp
operator|++
operator|=
literal|'\n'
expr_stmt|;
operator|*
name|gp
operator|++
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
block|{
operator|*
name|a1
operator|=
operator|&
operator|~
literal|01
expr_stmt|;
if|if
condition|(
name|a1
operator|>=
name|addr1
operator|&&
name|a1
operator|<=
name|addr2
operator|&&
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
operator|==
name|k
condition|)
operator|*
name|a1
operator|=
operator||
literal|01
expr_stmt|;
block|}
for|for
control|(
name|a1
operator|=
name|zero
init|;
name|a1
operator|<=
name|dol
condition|;
name|a1
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|a1
operator|&
literal|01
condition|)
block|{
operator|*
name|a1
operator|=
operator|&
operator|~
literal|01
expr_stmt|;
name|dot
operator|=
name|a1
expr_stmt|;
name|globp
operator|=
name|globuf
expr_stmt|;
name|commands
argument_list|()
expr_stmt|;
name|a1
operator|=
name|zero
expr_stmt|;
block|}
block|}
block|}
end_block

begin_macro
name|substitute
argument_list|(
argument|inglob
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|gsubf
operator|,
operator|*
name|a1
operator|,
name|nl
expr_stmt|;
name|int
name|getsub
parameter_list|()
function_decl|;
name|gsubf
operator|=
name|compsub
argument_list|()
expr_stmt|;
for|for
control|(
name|a1
operator|=
name|addr1
init|;
name|a1
operator|<=
name|addr2
condition|;
name|a1
operator|++
control|)
block|{
if|if
condition|(
name|execute
argument_list|(
literal|0
argument_list|,
name|a1
argument_list|)
operator|==
literal|0
condition|)
continue|continue;
name|inglob
operator|=
operator||
literal|01
expr_stmt|;
name|dosub
argument_list|()
expr_stmt|;
if|if
condition|(
name|gsubf
condition|)
block|{
while|while
condition|(
operator|*
name|loc2
condition|)
block|{
if|if
condition|(
name|execute
argument_list|(
literal|1
argument_list|)
operator|==
literal|0
condition|)
break|break;
name|dosub
argument_list|()
expr_stmt|;
block|}
block|}
operator|*
name|a1
operator|=
name|putline
argument_list|()
expr_stmt|;
name|nl
operator|=
name|append
argument_list|(
name|getsub
argument_list|,
name|a1
argument_list|)
expr_stmt|;
name|a1
operator|=
operator|+
name|nl
expr_stmt|;
name|addr2
operator|=
operator|+
name|nl
expr_stmt|;
block|}
if|if
condition|(
name|inglob
operator|==
literal|0
condition|)
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|compsub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|seof
operator|,
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|gsubf
decl_stmt|;
if|if
condition|(
operator|(
name|seof
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'\n'
condition|)
name|error
expr_stmt|;
name|compile
argument_list|(
name|seof
argument_list|)
expr_stmt|;
name|p
operator|=
name|rhsbuf
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\\'
condition|)
name|c
operator|=
name|getchar
argument_list|()
operator||
literal|0200
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
name|error
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|seof
condition|)
break|break;
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
if|if
condition|(
name|p
operator|>=
operator|&
name|rhsbuf
index|[
name|LBSIZE
operator|/
literal|2
index|]
condition|)
name|error
expr_stmt|;
block|}
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|peekc
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'g'
condition|)
block|{
name|peekc
operator|=
literal|0
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
name|newline
argument_list|()
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|getsub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
name|p1
operator|=
name|linebuf
expr_stmt|;
if|if
condition|(
operator|(
name|p2
operator|=
name|linebp
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
name|linebp
operator|=
literal|0
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|dosub
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|lp
decl_stmt|,
modifier|*
name|sp
decl_stmt|,
modifier|*
name|rp
decl_stmt|;
name|int
name|c
decl_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|sp
operator|=
name|genbuf
expr_stmt|;
name|rp
operator|=
name|rhsbuf
expr_stmt|;
while|while
condition|(
name|lp
operator|<
name|loc1
condition|)
operator|*
name|sp
operator|++
operator|=
operator|*
name|lp
operator|++
expr_stmt|;
while|while
condition|(
name|c
operator|=
operator|*
name|rp
operator|++
condition|)
block|{
if|if
condition|(
name|c
operator|==
literal|'&'
condition|)
block|{
name|sp
operator|=
name|place
argument_list|(
name|sp
argument_list|,
name|loc1
argument_list|,
name|loc2
argument_list|)
expr_stmt|;
continue|continue;
block|}
elseif|else
if|if
condition|(
name|c
operator|<
literal|0
operator|&&
operator|(
name|c
operator|=
operator|&
literal|0177
operator|)
operator|>=
literal|'1'
operator|&&
name|c
operator|<
name|NBRA
operator|+
literal|'1'
condition|)
block|{
name|sp
operator|=
name|place
argument_list|(
name|sp
argument_list|,
name|braslist
index|[
name|c
operator|-
literal|'1'
index|]
argument_list|,
name|braelist
index|[
name|c
operator|-
literal|'1'
index|]
argument_list|)
expr_stmt|;
continue|continue;
block|}
operator|*
name|sp
operator|++
operator|=
name|c
operator|&
literal|0177
expr_stmt|;
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
expr_stmt|;
block|}
name|lp
operator|=
name|loc2
expr_stmt|;
name|loc2
operator|=
name|sp
operator|+
name|linebuf
operator|-
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|sp
operator|++
operator|=
operator|*
name|lp
operator|++
condition|)
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
expr_stmt|;
name|lp
operator|=
name|linebuf
expr_stmt|;
name|sp
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|=
operator|*
name|sp
operator|++
condition|)
empty_stmt|;
block|}
end_block

begin_macro
name|place
argument_list|(
argument|asp
argument_list|,
argument|al1
argument_list|,
argument|al2
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|sp
decl_stmt|,
modifier|*
name|l1
decl_stmt|,
modifier|*
name|l2
decl_stmt|;
name|sp
operator|=
name|asp
expr_stmt|;
name|l1
operator|=
name|al1
expr_stmt|;
name|l2
operator|=
name|al2
expr_stmt|;
while|while
condition|(
name|l1
operator|<
name|l2
condition|)
block|{
operator|*
name|sp
operator|++
operator|=
operator|*
name|l1
operator|++
expr_stmt|;
if|if
condition|(
name|sp
operator|>=
operator|&
name|genbuf
index|[
name|LBSIZE
index|]
condition|)
name|error
expr_stmt|;
block|}
return|return
operator|(
name|sp
operator|)
return|;
block|}
end_block

begin_macro
name|move
argument_list|(
argument|cflag
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|int
modifier|*
name|adt
decl_stmt|,
modifier|*
name|ad1
decl_stmt|,
modifier|*
name|ad2
decl_stmt|;
name|int
name|getcopy
parameter_list|()
function_decl|;
name|setdot
argument_list|()
expr_stmt|;
name|nonzero
argument_list|()
expr_stmt|;
if|if
condition|(
operator|(
name|adt
operator|=
name|address
argument_list|()
operator|)
operator|==
literal|0
condition|)
name|error
expr_stmt|;
name|newline
argument_list|()
expr_stmt|;
name|ad1
operator|=
name|addr1
expr_stmt|;
name|ad2
operator|=
name|addr2
expr_stmt|;
if|if
condition|(
name|cflag
condition|)
block|{
name|ad1
operator|=
name|dol
expr_stmt|;
name|append
argument_list|(
name|getcopy
argument_list|,
name|ad1
operator|++
argument_list|)
expr_stmt|;
name|ad2
operator|=
name|dol
expr_stmt|;
block|}
name|ad2
operator|++
expr_stmt|;
if|if
condition|(
name|adt
operator|<
name|ad1
condition|)
block|{
name|dot
operator|=
name|adt
operator|+
operator|(
name|ad2
operator|-
name|ad1
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|++
name|adt
operator|)
operator|==
name|ad1
condition|)
return|return;
name|reverse
argument_list|(
name|adt
argument_list|,
name|ad1
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|adt
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|adt
operator|>=
name|ad2
condition|)
block|{
name|dot
operator|=
name|adt
operator|++
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|ad2
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad2
argument_list|,
name|adt
argument_list|)
expr_stmt|;
name|reverse
argument_list|(
name|ad1
argument_list|,
name|adt
argument_list|)
expr_stmt|;
block|}
else|else
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|reverse
argument_list|(
argument|aa1
argument_list|,
argument|aa2
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|int
modifier|*
name|a1
decl_stmt|,
modifier|*
name|a2
decl_stmt|,
name|t
decl_stmt|;
name|a1
operator|=
name|aa1
expr_stmt|;
name|a2
operator|=
name|aa2
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|t
operator|=
operator|*
operator|--
name|a2
expr_stmt|;
if|if
condition|(
name|a2
operator|<=
name|a1
condition|)
return|return;
operator|*
name|a2
operator|=
operator|*
name|a1
expr_stmt|;
operator|*
name|a1
operator|++
operator|=
name|t
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|getcopy
argument_list|()
end_macro

begin_block
block|{
if|if
condition|(
name|addr1
operator|>
name|addr2
condition|)
return|return
operator|(
name|EOF
operator|)
return|;
name|getline
argument_list|(
operator|*
name|addr1
operator|++
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|compile
argument_list|(
argument|aeof
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|eof
operator|,
name|c
expr_stmt|;
specifier|register
name|char
modifier|*
name|ep
decl_stmt|;
name|char
modifier|*
name|lastep
decl_stmt|;
name|char
name|bracket
index|[
name|NBRA
index|]
decl_stmt|,
modifier|*
name|bracketp
decl_stmt|;
name|int
name|nbra
decl_stmt|;
name|int
name|cclcnt
decl_stmt|;
name|ep
operator|=
name|expbuf
expr_stmt|;
name|eof
operator|=
name|aeof
expr_stmt|;
name|bracketp
operator|=
name|bracket
expr_stmt|;
name|nbra
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
name|eof
condition|)
block|{
if|if
condition|(
operator|*
name|ep
operator|==
literal|0
condition|)
name|error
expr_stmt|;
return|return;
block|}
name|circfl
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'^'
condition|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
name|circfl
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|==
literal|'*'
condition|)
goto|goto
name|cerror
goto|;
name|peekc
operator|=
name|c
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|ep
operator|>=
operator|&
name|expbuf
index|[
name|ESIZE
index|]
condition|)
goto|goto
name|cerror
goto|;
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
if|if
condition|(
name|c
operator|==
name|eof
condition|)
block|{
operator|*
name|ep
operator|++
operator|=
name|CEOF
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|c
operator|!=
literal|'*'
condition|)
name|lastep
operator|=
name|ep
expr_stmt|;
switch|switch
condition|(
name|c
condition|)
block|{
case|case
literal|'\\'
case|:
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'('
condition|)
block|{
if|if
condition|(
name|nbra
operator|>=
name|NBRA
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|bracketp
operator|++
operator|=
name|nbra
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|CBRA
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|nbra
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|c
operator|==
literal|')'
condition|)
block|{
if|if
condition|(
name|bracketp
operator|<=
name|bracket
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|CKET
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
operator|*
operator|--
name|bracketp
expr_stmt|;
continue|continue;
block|}
operator|*
name|ep
operator|++
operator|=
name|CCHR
expr_stmt|;
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
continue|continue;
case|case
literal|'.'
case|:
operator|*
name|ep
operator|++
operator|=
name|CDOT
expr_stmt|;
continue|continue;
case|case
literal|'\n'
case|:
goto|goto
name|cerror
goto|;
case|case
literal|'*'
case|:
if|if
condition|(
operator|*
name|lastep
operator|==
name|CBRA
operator|||
operator|*
name|lastep
operator|==
name|CKET
condition|)
name|error
expr_stmt|;
operator|*
name|lastep
operator|=
operator||
name|STAR
expr_stmt|;
continue|continue;
case|case
literal|'$'
case|:
if|if
condition|(
operator|(
name|peekc
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
name|eof
condition|)
goto|goto
name|defchar
goto|;
operator|*
name|ep
operator|++
operator|=
name|CDOL
expr_stmt|;
continue|continue;
case|case
literal|'['
case|:
operator|*
name|ep
operator|++
operator|=
name|CCL
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
literal|0
expr_stmt|;
name|cclcnt
operator|=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|==
literal|'^'
condition|)
block|{
name|c
operator|=
name|getchar
argument_list|()
expr_stmt|;
name|ep
index|[
operator|-
literal|2
index|]
operator|=
name|NCCL
expr_stmt|;
block|}
do|do
block|{
if|if
condition|(
name|c
operator|==
literal|'\n'
condition|)
goto|goto
name|cerror
goto|;
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
name|cclcnt
operator|++
expr_stmt|;
if|if
condition|(
name|ep
operator|>=
operator|&
name|expbuf
index|[
name|ESIZE
index|]
condition|)
goto|goto
name|cerror
goto|;
block|}
do|while
condition|(
operator|(
name|c
operator|=
name|getchar
argument_list|()
operator|)
operator|!=
literal|']'
condition|)
do|;
name|lastep
index|[
literal|1
index|]
operator|=
name|cclcnt
expr_stmt|;
continue|continue;
name|defchar
label|:
default|default:
operator|*
name|ep
operator|++
operator|=
name|CCHR
expr_stmt|;
operator|*
name|ep
operator|++
operator|=
name|c
expr_stmt|;
block|}
block|}
name|cerror
label|:
name|expbuf
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|error
expr_stmt|;
block|}
end_block

begin_macro
name|execute
argument_list|(
argument|gf
argument_list|,
argument|addr
argument_list|)
end_macro

begin_decl_stmt
name|int
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_block
block|{
specifier|register
name|char
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|,
name|c
decl_stmt|;
if|if
condition|(
name|gf
condition|)
block|{
if|if
condition|(
name|circfl
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|p1
operator|=
name|linebuf
expr_stmt|;
name|p2
operator|=
name|genbuf
expr_stmt|;
while|while
condition|(
operator|*
name|p1
operator|++
operator|=
operator|*
name|p2
operator|++
condition|)
empty_stmt|;
name|locs
operator|=
name|p1
operator|=
name|loc2
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|addr
operator|==
name|zero
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|p1
operator|=
name|getline
argument_list|(
operator|*
name|addr
argument_list|)
expr_stmt|;
name|locs
operator|=
literal|0
expr_stmt|;
block|}
name|p2
operator|=
name|expbuf
expr_stmt|;
if|if
condition|(
name|circfl
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
operator|)
return|;
block|}
comment|/* fast check for first character */
if|if
condition|(
operator|*
name|p2
operator|==
name|CCHR
condition|)
block|{
name|c
operator|=
name|p2
index|[
literal|1
index|]
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|*
name|p1
operator|!=
name|c
condition|)
continue|continue;
if|if
condition|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
do|while
condition|(
operator|*
name|p1
operator|++
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
comment|/* regular algorithm */
do|do
block|{
if|if
condition|(
name|advance
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|)
condition|)
block|{
name|loc1
operator|=
name|p1
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
block|}
block|}
do|while
condition|(
operator|*
name|p1
operator|++
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_block

begin_macro
name|advance
argument_list|(
argument|alp
argument_list|,
argument|aep
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|lp
decl_stmt|,
modifier|*
name|ep
decl_stmt|,
modifier|*
name|curlp
decl_stmt|;
name|char
modifier|*
name|nextep
decl_stmt|;
name|lp
operator|=
name|alp
expr_stmt|;
name|ep
operator|=
name|aep
expr_stmt|;
for|for
control|(
init|;
condition|;
control|)
switch|switch
condition|(
operator|*
name|ep
operator|++
condition|)
block|{
case|case
name|CCHR
case|:
if|if
condition|(
operator|*
name|ep
operator|++
operator|==
operator|*
name|lp
operator|++
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CDOT
case|:
if|if
condition|(
operator|*
name|lp
operator|++
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CDOL
case|:
if|if
condition|(
operator|*
name|lp
operator|==
literal|0
condition|)
continue|continue;
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CEOF
case|:
name|loc2
operator|=
name|lp
expr_stmt|;
return|return
operator|(
literal|1
operator|)
return|;
case|case
name|CCL
case|:
if|if
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|ep
operator|=
operator|+
operator|*
name|ep
expr_stmt|;
continue|continue;
block|}
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|NCCL
case|:
if|if
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|ep
operator|=
operator|+
operator|*
name|ep
expr_stmt|;
continue|continue;
block|}
return|return
operator|(
literal|0
operator|)
return|;
case|case
name|CBRA
case|:
name|braslist
index|[
operator|*
name|ep
operator|++
index|]
operator|=
name|lp
expr_stmt|;
continue|continue;
case|case
name|CKET
case|:
name|braelist
index|[
operator|*
name|ep
operator|++
index|]
operator|=
name|lp
expr_stmt|;
continue|continue;
case|case
name|CDOT
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
condition|)
empty_stmt|;
goto|goto
name|star
goto|;
case|case
name|CCHR
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
operator|*
name|lp
operator|++
operator|==
operator|*
name|ep
condition|)
empty_stmt|;
name|ep
operator|++
expr_stmt|;
goto|goto
name|star
goto|;
case|case
name|CCL
operator||
name|STAR
case|:
case|case
name|NCCL
operator||
name|STAR
case|:
name|curlp
operator|=
name|lp
expr_stmt|;
while|while
condition|(
name|cclass
argument_list|(
name|ep
argument_list|,
operator|*
name|lp
operator|++
argument_list|,
name|ep
index|[
operator|-
literal|1
index|]
operator|==
operator|(
name|CCL
operator||
name|STAR
operator|)
argument_list|)
condition|)
empty_stmt|;
name|ep
operator|=
operator|+
operator|*
name|ep
expr_stmt|;
goto|goto
name|star
goto|;
name|star
label|:
do|do
block|{
name|lp
operator|--
expr_stmt|;
if|if
condition|(
name|lp
operator|==
name|locs
condition|)
break|break;
if|if
condition|(
name|advance
argument_list|(
name|lp
argument_list|,
name|ep
argument_list|)
condition|)
return|return
operator|(
literal|1
operator|)
return|;
block|}
do|while
condition|(
name|lp
operator|>
name|curlp
condition|)
do|;
return|return
operator|(
literal|0
operator|)
return|;
default|default:
name|error
expr_stmt|;
block|}
block|}
end_block

begin_macro
name|cclass
argument_list|(
argument|aset
argument_list|,
argument|ac
argument_list|,
argument|af
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|set
decl_stmt|,
name|c
decl_stmt|;
specifier|register
name|n
expr_stmt|;
name|set
operator|=
name|aset
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|=
name|ac
operator|)
operator|==
literal|0
condition|)
return|return
operator|(
literal|0
operator|)
return|;
name|n
operator|=
operator|*
name|set
operator|++
expr_stmt|;
while|while
condition|(
operator|--
name|n
condition|)
if|if
condition|(
operator|*
name|set
operator|++
operator|==
name|c
condition|)
return|return
operator|(
name|af
operator|)
return|;
return|return
operator|(
operator|!
name|af
operator|)
return|;
block|}
end_block

begin_macro
name|putd
argument_list|()
end_macro

begin_block
block|{
specifier|register
name|r
expr_stmt|;
extern|extern ldivr;
name|count
index|[
literal|1
index|]
operator|=
name|ldiv
argument_list|(
name|count
index|[
literal|0
index|]
argument_list|,
name|count
index|[
literal|1
index|]
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|count
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|r
operator|=
name|ldivr
expr_stmt|;
if|if
condition|(
name|count
index|[
literal|1
index|]
condition|)
name|putd
argument_list|()
expr_stmt|;
name|putchar
argument_list|(
name|r
operator|+
literal|'0'
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|puts
argument_list|(
argument|as
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|sp
decl_stmt|;
name|sp
operator|=
name|as
expr_stmt|;
name|col
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|*
name|sp
condition|)
name|putchar
argument_list|(
operator|*
name|sp
operator|++
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
end_block

begin_decl_stmt
name|char
name|line
index|[
literal|70
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|linp
name|line
decl_stmt|;
end_decl_stmt

begin_macro
name|putchar
argument_list|(
argument|ac
argument_list|)
end_macro

begin_block
block|{
specifier|register
name|char
modifier|*
name|lp
decl_stmt|;
specifier|register
name|c
expr_stmt|;
name|lp
operator|=
name|linp
expr_stmt|;
name|c
operator|=
name|ac
expr_stmt|;
if|if
condition|(
name|listf
condition|)
block|{
name|col
operator|++
expr_stmt|;
if|if
condition|(
name|col
operator|>=
literal|72
condition|)
block|{
name|col
operator|=
literal|0
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\n'
expr_stmt|;
block|}
if|if
condition|(
name|c
operator|==
literal|'\t'
condition|)
block|{
name|c
operator|=
literal|'>'
expr_stmt|;
goto|goto
name|esc
goto|;
block|}
if|if
condition|(
name|c
operator|==
literal|'\b'
condition|)
block|{
name|c
operator|=
literal|'<'
expr_stmt|;
name|esc
label|:
operator|*
name|lp
operator|++
operator|=
literal|'-'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
literal|'\b'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
name|c
expr_stmt|;
goto|goto
name|out
goto|;
block|}
if|if
condition|(
name|c
operator|<
literal|' '
operator|&&
name|c
operator|!=
literal|'\n'
condition|)
block|{
operator|*
name|lp
operator|++
operator|=
literal|'\\'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
operator|(
name|c
operator|>>
literal|3
operator|)
operator|+
literal|'0'
expr_stmt|;
operator|*
name|lp
operator|++
operator|=
operator|(
name|c
operator|&
literal|07
operator|)
operator|+
literal|'0'
expr_stmt|;
name|col
operator|=
operator|+
literal|2
expr_stmt|;
goto|goto
name|out
goto|;
block|}
block|}
operator|*
name|lp
operator|++
operator|=
name|c
expr_stmt|;
name|out
label|:
if|if
condition|(
name|c
operator|==
literal|'\n'
operator|||
name|lp
operator|>=
operator|&
name|line
index|[
literal|64
index|]
condition|)
block|{
name|linp
operator|=
name|line
expr_stmt|;
name|write
argument_list|(
literal|1
argument_list|,
name|line
argument_list|,
name|lp
operator|-
name|line
argument_list|)
expr_stmt|;
return|return;
block|}
name|linp
operator|=
name|lp
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Get process ID routine if system call is unavailable. getpid() { 	register f; 	int b[1];  	f = open("/dev/kmem", 0); 	if(f< 0) 		return(-1); 	seek(f, 0140074, 0); 	read(f, b, 2); 	seek(f, b[0]+8, 0); 	read(f, b, 2); 	close(f); 	return(b[0]); }  */
end_comment

end_unit

