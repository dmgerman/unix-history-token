begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2014, Juniper Networks, Inc.  * All rights reserved.  * This SOFTWARE is licensed under the LICENSE provided in the  * ../Copyright file. By downloading, installing, copying, or otherwise  * using the SOFTWARE, you agree to be bound by the terms of that  * LICENSE.  * Phil Shafer, July 2014  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdint.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"xo.h"
end_include

begin_include
include|#
directive|include
file|"xo_humanize.h"
end_include

begin_function
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|argc
operator|=
name|xo_parse_args
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|<
literal|0
condition|)
return|return
literal|1
return|;
for|for
control|(
name|argc
operator|=
literal|1
init|;
name|argv
index|[
name|argc
index|]
condition|;
name|argc
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"xml"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_style
argument_list|(
name|NULL
argument_list|,
name|XO_STYLE_XML
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"json"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_style
argument_list|(
name|NULL
argument_list|,
name|XO_STYLE_JSON
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"text"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_style
argument_list|(
name|NULL
argument_list|,
name|XO_STYLE_TEXT
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"html"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_style
argument_list|(
name|NULL
argument_list|,
name|XO_STYLE_HTML
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"pretty"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_flags
argument_list|(
name|NULL
argument_list|,
name|XOF_PRETTY
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"xpath"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_flags
argument_list|(
name|NULL
argument_list|,
name|XOF_XPATH
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argc
index|]
argument_list|,
literal|"info"
argument_list|)
operator|==
literal|0
condition|)
name|xo_set_flags
argument_list|(
name|NULL
argument_list|,
name|XOF_INFO
argument_list|)
expr_stmt|;
block|}
name|xo_set_flags
argument_list|(
name|NULL
argument_list|,
name|XOF_UNITS
argument_list|)
expr_stmt|;
comment|/* Always test w/ this */
name|xo_set_file
argument_list|(
name|stdout
argument_list|)
expr_stmt|;
name|xo_open_container_h
argument_list|(
name|NULL
argument_list|,
literal|"top"
argument_list|)
expr_stmt|;
name|xo_open_container
argument_list|(
literal|"data"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"We are {{emit}}{{ting}} some {:what}\n"
argument_list|,
literal|"braces"
argument_list|)
expr_stmt|;
name|xo_message
argument_list|(
literal|"abcdef"
argument_list|)
expr_stmt|;
name|close
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|xo_message_e
argument_list|(
literal|"abcdef"
argument_list|)
expr_stmt|;
name|xo_message
argument_list|(
literal|"improper use of profanity; %s; %s"
argument_list|,
literal|"ten yard penalty"
argument_list|,
literal|"first down"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"length {:length/%6.6s}\n"
argument_list|,
literal|"abcdefghijklmnopqrstuvwxyz"
argument_list|)
expr_stmt|;
name|close
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"close {:fd/%d} returned {:error/%m} {:test}\n"
argument_list|,
operator|-
literal|1
argument_list|,
literal|"good"
argument_list|)
expr_stmt|;
name|close
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"close {:fd/%d} returned {:error/%6.6m} {:test}\n"
argument_list|,
operator|-
literal|1
argument_list|,
literal|"good"
argument_list|)
expr_stmt|;
name|xo_message
argument_list|(
literal|"improper use of profanity; %s; %s"
argument_list|,
literal|"ten yard penalty"
argument_list|,
literal|"first down"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|" {:lines/%7ju} {:words/%7ju} "
literal|"{:characters/%7ju} {d:filename/%s}\n"
argument_list|,
operator|(
name|uintmax_t
operator|)
literal|20
argument_list|,
operator|(
name|uintmax_t
operator|)
literal|30
argument_list|,
operator|(
name|uintmax_t
operator|)
literal|40
argument_list|,
literal|"file"
argument_list|)
expr_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
name|xo_emit
argument_list|(
literal|"{lw:bytes/%d}{Np:byte,bytes}\n"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:mbuf-current/%u}/{:mbuf-cache/%u}/{:mbuf-total/%u} "
literal|"{N:mbufs<&> in use (current\\/cache\\/total)}\n"
argument_list|,
literal|10
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:distance/%u}{Uw:miles} from {:location}\n"
argument_list|,
literal|50
argument_list|,
literal|"Boston"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:memory/%u}{U:k} left out of {:total/%u}{U:kb}\n"
argument_list|,
literal|64
argument_list|,
literal|640
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:memory/%u}{U:/%s} left out of {:total/%u}{U:/%s}\n"
argument_list|,
literal|64
argument_list|,
literal|"k"
argument_list|,
literal|640
argument_list|,
literal|"kilobytes"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{,title:/before%safter:}\n"
argument_list|,
literal|"working"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{,display,white,colon:some/%s}"
literal|"{,value:ten/%ju}{,value:eleven/%ju}\n"
argument_list|,
literal|"string"
argument_list|,
operator|(
name|uintmax_t
operator|)
literal|10
argument_list|,
operator|(
name|uintmax_t
operator|)
literal|11
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:unknown/%u} "
literal|"{N:/packet%s here\\/there\\/everywhere}\n"
argument_list|,
literal|1010
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{:unknown/%u} "
literal|"{,note:/packet%s here\\/there\\/everywhere}\n"
argument_list|,
literal|1010
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"({[:/%d}{n:min/15}/{n:cur/20}/{:max/%d}{]:})\n"
argument_list|,
literal|30
argument_list|,
literal|125
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"({[:30}{:min/%u}/{:cur/%u}/{:max/%u}{]:})\n"
argument_list|,
literal|15
argument_list|,
literal|20
argument_list|,
literal|125
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"({[:-30}{n:min/15}/{n:cur/20}/{n:max/125}{]:})\n"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"({[:}{:min/%u}/{:cur/%u}/{:max/%u}{]:/%d})\n"
argument_list|,
literal|15
argument_list|,
literal|20
argument_list|,
literal|125
argument_list|,
operator|-
literal|30
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"Humanize: {h:val1/%u}, {h,hn-space:val2/%u}, "
literal|"{h,hn-decimal:val3/%u}, {h,hn-1000:val4/%u}, "
literal|"{h,hn-decimal:val5/%u}\n"
argument_list|,
literal|21
argument_list|,
literal|57
operator|*
literal|1024
argument_list|,
literal|96
operator|*
literal|1024
operator|*
literal|1024
argument_list|,
operator|(
literal|42
operator|*
literal|1024
operator|+
literal|420
operator|)
operator|*
literal|1024
argument_list|,
literal|1342172800
argument_list|)
expr_stmt|;
name|xo_open_list
argument_list|(
literal|"flag"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{lq:flag/one} {lq:flag/two} {lq:flag/three}\n"
argument_list|)
expr_stmt|;
name|xo_close_list
argument_list|(
literal|"flag"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{n:works/%s}\n"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{e:empty-tag/}"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"1:{qt:t1/%*d} 2:{qt:t2/test%-*u} "
literal|"3:{qt:t3/%10sx} 4:{qt:t4/x%-*.*s}\n"
argument_list|,
literal|6
argument_list|,
literal|1000
argument_list|,
literal|8
argument_list|,
literal|5000
argument_list|,
literal|"ten-long"
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{E:this is an error}\n"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{E:/%s more error%s}\n"
argument_list|,
literal|"two"
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{W:this is an warning}\n"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{W:/%s more warning%s}\n"
argument_list|,
literal|"two"
argument_list|,
literal|"s"
argument_list|)
expr_stmt|;
name|xo_emit
argument_list|(
literal|"{L:/V1\\/V2 packet%s}: {:count/%u}\n"
argument_list|,
literal|"s"
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|int
name|test
init|=
literal|4
decl_stmt|;
name|xo_emit
argument_list|(
literal|"{:test/%04d} {L:/tr%s}\n"
argument_list|,
name|test
argument_list|,
operator|(
name|test
operator|==
literal|1
operator|)
condition|?
literal|"y"
else|:
literal|"ies"
argument_list|)
expr_stmt|;
name|xo_message
argument_list|(
literal|"improper use of profanity; %s; %s"
argument_list|,
literal|"ten yard penalty"
argument_list|,
literal|"first down"
argument_list|)
expr_stmt|;
name|xo_error
argument_list|(
literal|"Shut 'er down, Clancey!  She's a-pumpin' mud!<>!,\"!<>\n"
argument_list|)
expr_stmt|;
name|xo_close_container
argument_list|(
literal|"data"
argument_list|)
expr_stmt|;
name|xo_close_container_h
argument_list|(
name|NULL
argument_list|,
literal|"top"
argument_list|)
expr_stmt|;
name|xo_finish
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

