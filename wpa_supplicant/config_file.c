begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * WPA Supplicant / Configuration backend: text file  * Copyright (c) 2003-2008, Jouni Malinen<j@w1.fi>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License version 2 as  * published by the Free Software Foundation.  *  * Alternatively, this software may be distributed under the terms of BSD  * license.  *  * See README and COPYING for more details.  *  * This file implements a configuration backend for text files. All the  * configuration information is stored in a text file that uses a format  * described in the sample configuration file, wpa_supplicant.conf.  */
end_comment

begin_include
include|#
directive|include
file|"includes.h"
end_include

begin_include
include|#
directive|include
file|"common.h"
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"base64.h"
end_include

begin_include
include|#
directive|include
file|"uuid.h"
end_include

begin_include
include|#
directive|include
file|"eap_peer/eap_methods.h"
end_include

begin_comment
comment|/**  * wpa_config_get_line - Read the next configuration file line  * @s: Buffer for the line  * @size: The buffer length  * @stream: File stream to read from  * @line: Pointer to a variable storing the file line number  * @_pos: Buffer for the pointer to the beginning of data on the text line or  * %NULL if not needed (returned value used instead)  * Returns: Pointer to the beginning of data on the text line or %NULL if no  * more text lines are available.  *  * This function reads the next non-empty line from the configuration file and  * removes comments. The returned string is guaranteed to be null-terminated.  */
end_comment

begin_function
specifier|static
name|char
modifier|*
name|wpa_config_get_line
parameter_list|(
name|char
modifier|*
name|s
parameter_list|,
name|int
name|size
parameter_list|,
name|FILE
modifier|*
name|stream
parameter_list|,
name|int
modifier|*
name|line
parameter_list|,
name|char
modifier|*
modifier|*
name|_pos
parameter_list|)
block|{
name|char
modifier|*
name|pos
decl_stmt|,
modifier|*
name|end
decl_stmt|,
modifier|*
name|sstart
decl_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|s
argument_list|,
name|size
argument_list|,
name|stream
argument_list|)
condition|)
block|{
operator|(
operator|*
name|line
operator|)
operator|++
expr_stmt|;
name|s
index|[
name|size
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|pos
operator|=
name|s
expr_stmt|;
comment|/* Skip white space from the beginning of line. */
while|while
condition|(
operator|*
name|pos
operator|==
literal|' '
operator|||
operator|*
name|pos
operator|==
literal|'\t'
operator|||
operator|*
name|pos
operator|==
literal|'\r'
condition|)
name|pos
operator|++
expr_stmt|;
comment|/* Skip comment lines and empty lines */
if|if
condition|(
operator|*
name|pos
operator|==
literal|'#'
operator|||
operator|*
name|pos
operator|==
literal|'\n'
operator|||
operator|*
name|pos
operator|==
literal|'\0'
condition|)
continue|continue;
comment|/* 		 * Remove # comments unless they are within a double quoted 		 * string. 		 */
name|sstart
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|'"'
argument_list|)
expr_stmt|;
if|if
condition|(
name|sstart
condition|)
name|sstart
operator|=
name|os_strrchr
argument_list|(
name|sstart
operator|+
literal|1
argument_list|,
literal|'"'
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sstart
condition|)
name|sstart
operator|=
name|pos
expr_stmt|;
name|end
operator|=
name|os_strchr
argument_list|(
name|sstart
argument_list|,
literal|'#'
argument_list|)
expr_stmt|;
if|if
condition|(
name|end
condition|)
operator|*
name|end
operator|--
operator|=
literal|'\0'
expr_stmt|;
else|else
name|end
operator|=
name|pos
operator|+
name|os_strlen
argument_list|(
name|pos
argument_list|)
operator|-
literal|1
expr_stmt|;
comment|/* Remove trailing white space. */
while|while
condition|(
name|end
operator|>
name|pos
operator|&&
operator|(
operator|*
name|end
operator|==
literal|'\n'
operator|||
operator|*
name|end
operator|==
literal|' '
operator|||
operator|*
name|end
operator|==
literal|'\t'
operator|||
operator|*
name|end
operator|==
literal|'\r'
operator|)
condition|)
operator|*
name|end
operator|--
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|*
name|pos
operator|==
literal|'\0'
condition|)
continue|continue;
if|if
condition|(
name|_pos
condition|)
operator|*
name|_pos
operator|=
name|pos
expr_stmt|;
return|return
name|pos
return|;
block|}
if|if
condition|(
name|_pos
condition|)
operator|*
name|_pos
operator|=
name|NULL
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_validate_network
parameter_list|(
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|int
name|errors
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|passphrase
condition|)
block|{
if|if
condition|(
name|ssid
operator|->
name|psk_set
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: both PSK and "
literal|"passphrase configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|wpa_config_update_psk
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|ssid
operator|->
name|key_mgmt
operator|&
operator|(
name|WPA_KEY_MGMT_PSK
operator||
name|WPA_KEY_MGMT_FT_PSK
operator||
name|WPA_KEY_MGMT_PSK_SHA256
operator|)
operator|)
operator|&&
operator|!
name|ssid
operator|->
name|psk_set
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: WPA-PSK accepted for key "
literal|"management, but no PSK configured."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|ssid
operator|->
name|group_cipher
operator|&
name|WPA_CIPHER_CCMP
operator|)
operator|&&
operator|!
operator|(
name|ssid
operator|->
name|pairwise_cipher
operator|&
name|WPA_CIPHER_CCMP
operator|)
operator|&&
operator|!
operator|(
name|ssid
operator|->
name|pairwise_cipher
operator|&
name|WPA_CIPHER_NONE
operator|)
condition|)
block|{
comment|/* Group cipher cannot be stronger than the pairwise cipher. */
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Line %d: removed CCMP from group cipher"
literal|" list since it was not allowed for pairwise "
literal|"cipher"
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|ssid
operator|->
name|group_cipher
operator|&=
operator|~
name|WPA_CIPHER_CCMP
expr_stmt|;
block|}
return|return
name|errors
return|;
block|}
end_function

begin_function
specifier|static
name|struct
name|wpa_ssid
modifier|*
name|wpa_config_read_network
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|int
modifier|*
name|line
parameter_list|,
name|int
name|id
parameter_list|)
block|{
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|,
name|end
init|=
literal|0
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|,
modifier|*
name|pos2
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"Line: %d - start of a new network block"
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
name|ssid
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|ssid
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssid
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|ssid
operator|->
name|id
operator|=
name|id
expr_stmt|;
name|wpa_config_set_network_defaults
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
while|while
condition|(
name|wpa_config_get_line
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|,
name|line
argument_list|,
operator|&
name|pos
argument_list|)
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"}"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|end
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|pos2
operator|=
name|os_strchr
argument_list|(
name|pos
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos2
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid SSID line "
literal|"'%s'."
argument_list|,
operator|*
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
operator|*
name|pos2
operator|++
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|*
name|pos2
operator|==
literal|'"'
condition|)
block|{
if|if
condition|(
name|os_strchr
argument_list|(
name|pos2
operator|+
literal|1
argument_list|,
literal|'"'
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid "
literal|"quotation '%s'."
argument_list|,
operator|*
name|line
argument_list|,
name|pos2
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
if|if
condition|(
name|wpa_config_set
argument_list|(
name|ssid
argument_list|,
name|pos
argument_list|,
name|pos2
argument_list|,
operator|*
name|line
argument_list|)
operator|<
literal|0
condition|)
name|errors
operator|++
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|end
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: network block was not "
literal|"terminated properly."
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
block|}
name|errors
operator|+=
name|wpa_config_validate_network
argument_list|(
name|ssid
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_config_free_ssid
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
name|ssid
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|ssid
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_BLOBS
end_ifndef

begin_function
specifier|static
name|struct
name|wpa_config_blob
modifier|*
name|wpa_config_read_blob
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|int
modifier|*
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|struct
name|wpa_config_blob
modifier|*
name|blob
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|unsigned
name|char
modifier|*
name|encoded
init|=
name|NULL
decl_stmt|,
modifier|*
name|nencoded
decl_stmt|;
name|int
name|end
init|=
literal|0
decl_stmt|;
name|size_t
name|encoded_len
init|=
literal|0
decl_stmt|,
name|len
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_MSGDUMP
argument_list|,
literal|"Line: %d - start of a new named blob '%s'"
argument_list|,
operator|*
name|line
argument_list|,
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|wpa_config_get_line
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|,
name|line
argument_list|,
operator|&
name|pos
argument_list|)
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"}"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|end
operator|=
literal|1
expr_stmt|;
break|break;
block|}
name|len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|nencoded
operator|=
name|os_realloc
argument_list|(
name|encoded
argument_list|,
name|encoded_len
operator|+
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|nencoded
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: not enough memory for "
literal|"blob"
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|encoded
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|encoded
operator|=
name|nencoded
expr_stmt|;
name|os_memcpy
argument_list|(
name|encoded
operator|+
name|encoded_len
argument_list|,
name|pos
argument_list|,
name|len
argument_list|)
expr_stmt|;
name|encoded_len
operator|+=
name|len
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|end
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: blob was not terminated "
literal|"properly"
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|encoded
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|blob
operator|=
name|os_zalloc
argument_list|(
sizeof|sizeof
argument_list|(
operator|*
name|blob
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|blob
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|encoded
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|blob
operator|->
name|name
operator|=
name|os_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|blob
operator|->
name|data
operator|=
name|base64_decode
argument_list|(
name|encoded
argument_list|,
name|encoded_len
argument_list|,
operator|&
name|blob
operator|->
name|len
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|encoded
argument_list|)
expr_stmt|;
if|if
condition|(
name|blob
operator|->
name|name
operator|==
name|NULL
operator|||
name|blob
operator|->
name|data
operator|==
name|NULL
condition|)
block|{
name|wpa_config_free_blob
argument_list|(
name|blob
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|blob
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_process_blob
parameter_list|(
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|FILE
modifier|*
name|f
parameter_list|,
name|int
modifier|*
name|line
parameter_list|,
name|char
modifier|*
name|bname
parameter_list|)
block|{
name|char
modifier|*
name|name_end
decl_stmt|;
name|struct
name|wpa_config_blob
modifier|*
name|blob
decl_stmt|;
name|name_end
operator|=
name|os_strchr
argument_list|(
name|bname
argument_list|,
literal|'='
argument_list|)
expr_stmt|;
if|if
condition|(
name|name_end
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: no blob name terminator"
argument_list|,
operator|*
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
operator|*
name|name_end
operator|=
literal|'\0'
expr_stmt|;
name|blob
operator|=
name|wpa_config_read_blob
argument_list|(
name|f
argument_list|,
name|line
argument_list|,
name|bname
argument_list|)
expr_stmt|;
if|if
condition|(
name|blob
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to read blob %s"
argument_list|,
operator|*
name|line
argument_list|,
name|bname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_config_set_blob
argument_list|(
name|config
argument_list|,
name|blob
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NO_CONFIG_BLOBS */
end_comment

begin_struct
struct|struct
name|global_parse_data
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
function_decl|(
modifier|*
name|parser
function_decl|)
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
function_decl|;
name|void
modifier|*
name|param1
decl_stmt|,
modifier|*
name|param2
decl_stmt|,
modifier|*
name|param3
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|int
name|wpa_config_parse_int
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|pos
parameter_list|)
block|{
name|int
modifier|*
name|dst
decl_stmt|;
name|dst
operator|=
operator|(
name|int
operator|*
operator|)
operator|(
operator|(
operator|(
name|u8
operator|*
operator|)
name|config
operator|)
operator|+
operator|(
name|long
operator|)
name|data
operator|->
name|param1
operator|)
expr_stmt|;
operator|*
name|dst
operator|=
name|atoi
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"%s=%d"
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|*
name|dst
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|->
name|param2
operator|&&
operator|*
name|dst
operator|<
operator|(
name|long
operator|)
name|data
operator|->
name|param2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: too small %s (value=%d "
literal|"min_value=%ld)"
argument_list|,
name|line
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|*
name|dst
argument_list|,
operator|(
name|long
operator|)
name|data
operator|->
name|param2
argument_list|)
expr_stmt|;
operator|*
name|dst
operator|=
operator|(
name|long
operator|)
name|data
operator|->
name|param2
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|data
operator|->
name|param3
operator|&&
operator|*
name|dst
operator|>
operator|(
name|long
operator|)
name|data
operator|->
name|param3
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: too large %s (value=%d "
literal|"max_value=%ld)"
argument_list|,
name|line
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|*
name|dst
argument_list|,
operator|(
name|long
operator|)
name|data
operator|->
name|param3
argument_list|)
expr_stmt|;
operator|*
name|dst
operator|=
operator|(
name|long
operator|)
name|data
operator|->
name|param3
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_parse_str
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|pos
parameter_list|)
block|{
name|size_t
name|len
decl_stmt|;
name|char
modifier|*
modifier|*
name|dst
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|len
operator|=
name|os_strlen
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|data
operator|->
name|param2
operator|&&
name|len
operator|<
operator|(
name|size_t
operator|)
name|data
operator|->
name|param2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: too short %s (len=%lu "
literal|"min_len=%ld)"
argument_list|,
name|line
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|len
argument_list|,
operator|(
name|long
operator|)
name|data
operator|->
name|param2
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|data
operator|->
name|param3
operator|&&
name|len
operator|>
operator|(
name|size_t
operator|)
name|data
operator|->
name|param3
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: too long %s (len=%lu "
literal|"max_len=%ld)"
argument_list|,
name|line
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|len
argument_list|,
operator|(
name|long
operator|)
name|data
operator|->
name|param3
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|tmp
operator|=
name|os_strdup
argument_list|(
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|dst
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
operator|(
operator|(
operator|(
name|u8
operator|*
operator|)
name|config
operator|)
operator|+
operator|(
name|long
operator|)
name|data
operator|->
name|param1
operator|)
expr_stmt|;
name|os_free
argument_list|(
operator|*
name|dst
argument_list|)
expr_stmt|;
operator|*
name|dst
operator|=
name|tmp
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"%s='%s'"
argument_list|,
name|data
operator|->
name|name
argument_list|,
operator|*
name|dst
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_process_country
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|pos
parameter_list|)
block|{
if|if
condition|(
operator|!
name|pos
index|[
literal|0
index|]
operator|||
operator|!
name|pos
index|[
literal|1
index|]
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Invalid country set"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|config
operator|->
name|country
index|[
literal|0
index|]
operator|=
name|pos
index|[
literal|0
index|]
expr_stmt|;
name|config
operator|->
name|country
index|[
literal|1
index|]
operator|=
name|pos
index|[
literal|1
index|]
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"country='%c%c'"
argument_list|,
name|config
operator|->
name|country
index|[
literal|0
index|]
argument_list|,
name|config
operator|->
name|country
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_process_load_dynamic_eap
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|so
parameter_list|)
block|{
name|int
name|ret
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"load_dynamic_eap=%s"
argument_list|,
name|so
argument_list|)
expr_stmt|;
name|ret
operator|=
name|eap_peer_method_load
argument_list|(
name|so
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
operator|-
literal|2
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"This EAP type was already loaded - not "
literal|"reloading."
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|ret
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Failed to load dynamic EAP "
literal|"method '%s'."
argument_list|,
name|line
argument_list|,
name|so
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|CONFIG_WPS
end_ifdef

begin_function
specifier|static
name|int
name|wpa_config_process_uuid
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|pos
parameter_list|)
block|{
name|char
name|buf
index|[
literal|40
index|]
decl_stmt|;
if|if
condition|(
name|uuid_str2bin
argument_list|(
name|pos
argument_list|,
name|config
operator|->
name|uuid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid UUID"
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|uuid_bin2str
argument_list|(
name|config
operator|->
name|uuid
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"uuid=%s"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|wpa_config_process_os_version
parameter_list|(
specifier|const
name|struct
name|global_parse_data
modifier|*
name|data
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|int
name|line
parameter_list|,
specifier|const
name|char
modifier|*
name|pos
parameter_list|)
block|{
if|if
condition|(
name|hexstr2bin
argument_list|(
name|pos
argument_list|,
name|config
operator|->
name|os_version
argument_list|,
literal|4
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: invalid os_version"
argument_list|,
name|line
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"os_version=%08x"
argument_list|,
name|WPA_GET_BE32
argument_list|(
name|config
operator|->
name|os_version
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_WPS */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|OFFSET
end_ifdef

begin_undef
undef|#
directive|undef
name|OFFSET
end_undef

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* OFFSET */
end_comment

begin_comment
comment|/* OFFSET: Get offset of a variable within the wpa_config structure */
end_comment

begin_define
define|#
directive|define
name|OFFSET
parameter_list|(
name|v
parameter_list|)
value|((void *)&((struct wpa_config *) 0)->v)
end_define

begin_define
define|#
directive|define
name|FUNC
parameter_list|(
name|f
parameter_list|)
value|#f, wpa_config_process_ ## f, OFFSET(f), NULL, NULL
end_define

begin_define
define|#
directive|define
name|FUNC_NO_VAR
parameter_list|(
name|f
parameter_list|)
value|#f, wpa_config_process_ ## f, NULL, NULL, NULL
end_define

begin_define
define|#
directive|define
name|_INT
parameter_list|(
name|f
parameter_list|)
value|#f, wpa_config_parse_int, OFFSET(f)
end_define

begin_define
define|#
directive|define
name|INT
parameter_list|(
name|f
parameter_list|)
value|_INT(f), NULL, NULL
end_define

begin_define
define|#
directive|define
name|INT_RANGE
parameter_list|(
name|f
parameter_list|,
name|min
parameter_list|,
name|max
parameter_list|)
value|_INT(f), (void *) min, (void *) max
end_define

begin_define
define|#
directive|define
name|_STR
parameter_list|(
name|f
parameter_list|)
value|#f, wpa_config_parse_str, OFFSET(f)
end_define

begin_define
define|#
directive|define
name|STR
parameter_list|(
name|f
parameter_list|)
value|_STR(f), NULL, NULL
end_define

begin_define
define|#
directive|define
name|STR_RANGE
parameter_list|(
name|f
parameter_list|,
name|min
parameter_list|,
name|max
parameter_list|)
value|_STR(f), (void *) min, (void *) max
end_define

begin_decl_stmt
specifier|static
specifier|const
name|struct
name|global_parse_data
name|global_fields
index|[]
init|=
block|{
ifdef|#
directive|ifdef
name|CONFIG_CTRL_IFACE
block|{
name|STR
argument_list|(
argument|ctrl_interface
argument_list|)
block|}
block|,
block|{
name|STR
argument_list|(
argument|ctrl_interface_group
argument_list|)
block|}
comment|/* deprecated */
block|,
endif|#
directive|endif
comment|/* CONFIG_CTRL_IFACE */
block|{
name|INT_RANGE
argument_list|(
argument|eapol_version
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
block|}
block|,
block|{
name|INT
argument_list|(
argument|ap_scan
argument_list|)
block|}
block|,
block|{
name|INT
argument_list|(
argument|fast_reauth
argument_list|)
block|}
block|,
ifdef|#
directive|ifdef
name|EAP_TLS_OPENSSL
block|{
name|STR
argument_list|(
argument|opensc_engine_path
argument_list|)
block|}
block|,
block|{
name|STR
argument_list|(
argument|pkcs11_engine_path
argument_list|)
block|}
block|,
block|{
name|STR
argument_list|(
argument|pkcs11_module_path
argument_list|)
block|}
block|,
endif|#
directive|endif
comment|/* EAP_TLS_OPENSSL */
block|{
name|STR
argument_list|(
argument|driver_param
argument_list|)
block|}
block|,
block|{
name|INT
argument_list|(
argument|dot11RSNAConfigPMKLifetime
argument_list|)
block|}
block|,
block|{
name|INT
argument_list|(
argument|dot11RSNAConfigPMKReauthThreshold
argument_list|)
block|}
block|,
block|{
name|INT
argument_list|(
argument|dot11RSNAConfigSATimeout
argument_list|)
block|}
block|,
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_WRITE
block|{
name|INT
argument_list|(
argument|update_config
argument_list|)
block|}
block|,
endif|#
directive|endif
comment|/* CONFIG_NO_CONFIG_WRITE */
block|{
name|FUNC_NO_VAR
argument_list|(
argument|load_dynamic_eap
argument_list|)
block|}
block|,
ifdef|#
directive|ifdef
name|CONFIG_WPS
block|{
name|FUNC
argument_list|(
argument|uuid
argument_list|)
block|}
block|,
block|{
name|STR_RANGE
argument_list|(
argument|device_name
argument_list|,
literal|0
argument_list|,
literal|32
argument_list|)
block|}
block|,
block|{
name|STR_RANGE
argument_list|(
argument|manufacturer
argument_list|,
literal|0
argument_list|,
literal|64
argument_list|)
block|}
block|,
block|{
name|STR_RANGE
argument_list|(
argument|model_name
argument_list|,
literal|0
argument_list|,
literal|32
argument_list|)
block|}
block|,
block|{
name|STR_RANGE
argument_list|(
argument|model_number
argument_list|,
literal|0
argument_list|,
literal|32
argument_list|)
block|}
block|,
block|{
name|STR_RANGE
argument_list|(
argument|serial_number
argument_list|,
literal|0
argument_list|,
literal|32
argument_list|)
block|}
block|,
block|{
name|STR
argument_list|(
argument|device_type
argument_list|)
block|}
block|,
block|{
name|FUNC
argument_list|(
argument|os_version
argument_list|)
block|}
block|,
block|{
name|INT_RANGE
argument_list|(
argument|wps_cred_processing
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
block|}
block|,
endif|#
directive|endif
comment|/* CONFIG_WPS */
block|{
name|FUNC
argument_list|(
argument|country
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_undef
undef|#
directive|undef
name|FUNC
end_undef

begin_undef
undef|#
directive|undef
name|_INT
end_undef

begin_undef
undef|#
directive|undef
name|INT
end_undef

begin_undef
undef|#
directive|undef
name|INT_RANGE
end_undef

begin_undef
undef|#
directive|undef
name|_STR
end_undef

begin_undef
undef|#
directive|undef
name|STR
end_undef

begin_undef
undef|#
directive|undef
name|STR_RANGE
end_undef

begin_define
define|#
directive|define
name|NUM_GLOBAL_FIELDS
value|(sizeof(global_fields) / sizeof(global_fields[0]))
end_define

begin_function
specifier|static
name|int
name|wpa_config_process_global
parameter_list|(
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|,
name|char
modifier|*
name|pos
parameter_list|,
name|int
name|line
parameter_list|)
block|{
name|size_t
name|i
decl_stmt|;
name|int
name|ret
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_GLOBAL_FIELDS
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|struct
name|global_parse_data
modifier|*
name|field
init|=
operator|&
name|global_fields
index|[
name|i
index|]
decl_stmt|;
name|size_t
name|flen
init|=
name|os_strlen
argument_list|(
name|field
operator|->
name|name
argument_list|)
decl_stmt|;
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
name|field
operator|->
name|name
argument_list|,
name|flen
argument_list|)
operator|!=
literal|0
operator|||
name|pos
index|[
name|flen
index|]
operator|!=
literal|'='
condition|)
continue|continue;
if|if
condition|(
name|field
operator|->
name|parser
argument_list|(
name|field
argument_list|,
name|config
argument_list|,
name|line
argument_list|,
name|pos
operator|+
name|flen
operator|+
literal|1
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to "
literal|"parse '%s'."
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|i
operator|==
name|NUM_GLOBAL_FIELDS
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: unknown global field '%s'."
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|ret
operator|=
operator|-
literal|1
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|struct
name|wpa_config
modifier|*
name|wpa_config_read
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|,
modifier|*
name|pos
decl_stmt|;
name|int
name|errors
init|=
literal|0
decl_stmt|,
name|line
init|=
literal|0
decl_stmt|;
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|,
modifier|*
name|tail
init|=
name|NULL
decl_stmt|,
modifier|*
name|head
init|=
name|NULL
decl_stmt|;
name|struct
name|wpa_config
modifier|*
name|config
decl_stmt|;
name|int
name|id
init|=
literal|0
decl_stmt|;
name|config
operator|=
name|wpa_config_alloc_empty
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Reading configuration file '%s'"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|name
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|os_free
argument_list|(
name|config
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
while|while
condition|(
name|wpa_config_get_line
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
name|f
argument_list|,
operator|&
name|line
argument_list|,
operator|&
name|pos
argument_list|)
condition|)
block|{
if|if
condition|(
name|os_strcmp
argument_list|(
name|pos
argument_list|,
literal|"network={"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|ssid
operator|=
name|wpa_config_read_network
argument_list|(
name|f
argument_list|,
operator|&
name|line
argument_list|,
name|id
operator|++
argument_list|)
expr_stmt|;
if|if
condition|(
name|ssid
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to "
literal|"parse network block."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|head
operator|==
name|NULL
condition|)
block|{
name|head
operator|=
name|tail
operator|=
name|ssid
expr_stmt|;
block|}
else|else
block|{
name|tail
operator|->
name|next
operator|=
name|ssid
expr_stmt|;
name|tail
operator|=
name|ssid
expr_stmt|;
block|}
if|if
condition|(
name|wpa_config_add_prio_network
argument_list|(
name|config
argument_list|,
name|ssid
argument_list|)
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: failed to add "
literal|"network block to priority list."
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_BLOBS
block|}
elseif|else
if|if
condition|(
name|os_strncmp
argument_list|(
name|pos
argument_list|,
literal|"blob-base64-"
argument_list|,
literal|12
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|wpa_config_process_blob
argument_list|(
name|config
argument_list|,
name|f
argument_list|,
operator|&
name|line
argument_list|,
name|pos
operator|+
literal|12
argument_list|)
operator|<
literal|0
condition|)
block|{
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
endif|#
directive|endif
comment|/* CONFIG_NO_CONFIG_BLOBS */
block|}
elseif|else
if|if
condition|(
name|wpa_config_process_global
argument_list|(
name|config
argument_list|,
name|pos
argument_list|,
name|line
argument_list|)
operator|<
literal|0
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_ERROR
argument_list|,
literal|"Line %d: Invalid configuration "
literal|"line '%s'."
argument_list|,
name|line
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|errors
operator|++
expr_stmt|;
continue|continue;
block|}
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|config
operator|->
name|ssid
operator|=
name|head
expr_stmt|;
name|wpa_config_debug_dump_networks
argument_list|(
name|config
argument_list|)
expr_stmt|;
if|if
condition|(
name|errors
condition|)
block|{
name|wpa_config_free
argument_list|(
name|config
argument_list|)
expr_stmt|;
name|config
operator|=
name|NULL
expr_stmt|;
name|head
operator|=
name|NULL
expr_stmt|;
block|}
return|return
name|config
return|;
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_WRITE
end_ifndef

begin_function
specifier|static
name|void
name|write_str
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|field
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
init|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
name|field
argument_list|)
decl_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\t%s=%s\n"
argument_list|,
name|field
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_int
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
specifier|const
name|char
modifier|*
name|field
parameter_list|,
name|int
name|value
parameter_list|,
name|int
name|def
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|def
condition|)
return|return;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\t%s=%d\n"
argument_list|,
name|field
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_bssid
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
init|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"bssid"
argument_list|)
decl_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tbssid=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_psk
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
init|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"psk"
argument_list|)
decl_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tpsk=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_proto
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|proto
operator|==
name|DEFAULT_PROTO
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"proto"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tproto=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_key_mgmt
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|key_mgmt
operator|==
name|DEFAULT_KEY_MGMT
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"key_mgmt"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tkey_mgmt=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_pairwise
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|pairwise_cipher
operator|==
name|DEFAULT_PAIRWISE
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"pairwise"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tpairwise=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_group
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|group_cipher
operator|==
name|DEFAULT_GROUP
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"group"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tgroup=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|write_auth_alg
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
if|if
condition|(
name|ssid
operator|->
name|auth_alg
operator|==
literal|0
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"auth_alg"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\tauth_alg=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|IEEE8021X_EAPOL
end_ifdef

begin_function
specifier|static
name|void
name|write_eap
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
modifier|*
name|value
decl_stmt|;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
literal|"eap"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|value
index|[
literal|0
index|]
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\teap=%s\n"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* IEEE8021X_EAPOL */
end_comment

begin_function
specifier|static
name|void
name|write_wep_key
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|int
name|idx
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|char
name|field
index|[
literal|20
index|]
decl_stmt|,
modifier|*
name|value
decl_stmt|;
name|int
name|res
decl_stmt|;
name|res
operator|=
name|os_snprintf
argument_list|(
name|field
argument_list|,
sizeof|sizeof
argument_list|(
name|field
argument_list|)
argument_list|,
literal|"wep_key%d"
argument_list|,
name|idx
argument_list|)
expr_stmt|;
if|if
condition|(
name|res
operator|<
literal|0
operator|||
operator|(
name|size_t
operator|)
name|res
operator|>=
sizeof|sizeof
argument_list|(
name|field
argument_list|)
condition|)
return|return;
name|value
operator|=
name|wpa_config_get
argument_list|(
name|ssid
argument_list|,
name|field
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
condition|)
block|{
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\t%s=%s\n"
argument_list|,
name|field
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|wpa_config_write_network
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_ssid
modifier|*
name|ssid
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
define|#
directive|define
name|STR
parameter_list|(
name|t
parameter_list|)
value|write_str(f, #t, ssid)
define|#
directive|define
name|INT
parameter_list|(
name|t
parameter_list|)
value|write_int(f, #t, ssid->t, 0)
define|#
directive|define
name|INTe
parameter_list|(
name|t
parameter_list|)
value|write_int(f, #t, ssid->eap.t, 0)
define|#
directive|define
name|INT_DEF
parameter_list|(
name|t
parameter_list|,
name|def
parameter_list|)
value|write_int(f, #t, ssid->t, def)
define|#
directive|define
name|INT_DEFe
parameter_list|(
name|t
parameter_list|,
name|def
parameter_list|)
value|write_int(f, #t, ssid->eap.t, def)
name|STR
argument_list|(
name|ssid
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|scan_ssid
argument_list|)
expr_stmt|;
name|write_bssid
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_psk
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_proto
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_key_mgmt
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_pairwise
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_group
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|write_auth_alg
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|IEEE8021X_EAPOL
name|write_eap
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|identity
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|anonymous_identity
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|password
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_cert
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_path
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|client_cert
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|private_key
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|private_key_passwd
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|dh_file
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|subject_match
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|altsubject_match
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_cert2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_path2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|client_cert2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|private_key2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|private_key2_passwd
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|dh_file2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|subject_match2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|altsubject_match2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|phase1
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|phase2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|pcsc
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|pin
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|engine_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|key_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|cert_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_cert_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|key2_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|pin2
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|engine2_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|cert2_id
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|ca_cert2_id
argument_list|)
expr_stmt|;
name|INTe
argument_list|(
name|engine
argument_list|)
expr_stmt|;
name|INTe
argument_list|(
name|engine2
argument_list|)
expr_stmt|;
name|INT_DEF
argument_list|(
name|eapol_flags
argument_list|,
name|DEFAULT_EAPOL_FLAGS
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* IEEE8021X_EAPOL */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|write_wep_key
argument_list|(
name|f
argument_list|,
name|i
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|wep_tx_keyidx
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|priority
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|IEEE8021X_EAPOL
name|INT_DEF
argument_list|(
name|eap_workaround
argument_list|,
name|DEFAULT_EAP_WORKAROUND
argument_list|)
expr_stmt|;
name|STR
argument_list|(
name|pac_file
argument_list|)
expr_stmt|;
name|INT_DEFe
argument_list|(
name|fragment_size
argument_list|,
name|DEFAULT_FRAGMENT_SIZE
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* IEEE8021X_EAPOL */
name|INT
argument_list|(
name|mode
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|proactive_key_caching
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|disabled
argument_list|)
expr_stmt|;
name|INT
argument_list|(
name|peerkey
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_IEEE80211W
name|INT
argument_list|(
name|ieee80211w
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_IEEE80211W */
name|STR
argument_list|(
name|id_str
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|STR
undef|#
directive|undef
name|INT
undef|#
directive|undef
name|INT_DEF
block|}
end_function

begin_ifndef
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_BLOBS
end_ifndef

begin_function
specifier|static
name|int
name|wpa_config_write_blob
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_config_blob
modifier|*
name|blob
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|encoded
decl_stmt|;
name|encoded
operator|=
name|base64_encode
argument_list|(
name|blob
operator|->
name|data
argument_list|,
name|blob
operator|->
name|len
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|encoded
operator|==
name|NULL
condition|)
return|return
operator|-
literal|1
return|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\nblob-base64-%s={\n%s}\n"
argument_list|,
name|blob
operator|->
name|name
argument_list|,
name|encoded
argument_list|)
expr_stmt|;
name|os_free
argument_list|(
name|encoded
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NO_CONFIG_BLOBS */
end_comment

begin_function
specifier|static
name|void
name|wpa_config_write_global
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|CONFIG_CTRL_IFACE
if|if
condition|(
name|config
operator|->
name|ctrl_interface
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"ctrl_interface=%s\n"
argument_list|,
name|config
operator|->
name|ctrl_interface
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|ctrl_interface_group
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"ctrl_interface_group=%s\n"
argument_list|,
name|config
operator|->
name|ctrl_interface_group
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_CTRL_IFACE */
if|if
condition|(
name|config
operator|->
name|eapol_version
operator|!=
name|DEFAULT_EAPOL_VERSION
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"eapol_version=%d\n"
argument_list|,
name|config
operator|->
name|eapol_version
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|ap_scan
operator|!=
name|DEFAULT_AP_SCAN
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"ap_scan=%d\n"
argument_list|,
name|config
operator|->
name|ap_scan
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|fast_reauth
operator|!=
name|DEFAULT_FAST_REAUTH
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"fast_reauth=%d\n"
argument_list|,
name|config
operator|->
name|fast_reauth
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|EAP_TLS_OPENSSL
if|if
condition|(
name|config
operator|->
name|opensc_engine_path
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"opensc_engine_path=%s\n"
argument_list|,
name|config
operator|->
name|opensc_engine_path
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|pkcs11_engine_path
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"pkcs11_engine_path=%s\n"
argument_list|,
name|config
operator|->
name|pkcs11_engine_path
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|pkcs11_module_path
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"pkcs11_module_path=%s\n"
argument_list|,
name|config
operator|->
name|pkcs11_module_path
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* EAP_TLS_OPENSSL */
if|if
condition|(
name|config
operator|->
name|driver_param
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"driver_param=%s\n"
argument_list|,
name|config
operator|->
name|driver_param
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|dot11RSNAConfigPMKLifetime
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"dot11RSNAConfigPMKLifetime=%d\n"
argument_list|,
name|config
operator|->
name|dot11RSNAConfigPMKLifetime
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|dot11RSNAConfigPMKReauthThreshold
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"dot11RSNAConfigPMKReauthThreshold=%d\n"
argument_list|,
name|config
operator|->
name|dot11RSNAConfigPMKReauthThreshold
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|dot11RSNAConfigSATimeout
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"dot11RSNAConfigSATimeout=%d\n"
argument_list|,
name|config
operator|->
name|dot11RSNAConfigSATimeout
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|update_config
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"update_config=%d\n"
argument_list|,
name|config
operator|->
name|update_config
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|CONFIG_WPS
if|if
condition|(
operator|!
name|is_nil_uuid
argument_list|(
name|config
operator|->
name|uuid
argument_list|)
condition|)
block|{
name|char
name|buf
index|[
literal|40
index|]
decl_stmt|;
name|uuid_bin2str
argument_list|(
name|config
operator|->
name|uuid
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"uuid=%s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|->
name|device_name
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"device_name=%s\n"
argument_list|,
name|config
operator|->
name|device_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|manufacturer
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"manufacturer=%s\n"
argument_list|,
name|config
operator|->
name|manufacturer
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|model_name
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"model_name=%s\n"
argument_list|,
name|config
operator|->
name|model_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|model_number
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"model_number=%s\n"
argument_list|,
name|config
operator|->
name|model_number
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|serial_number
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"serial_number=%s\n"
argument_list|,
name|config
operator|->
name|serial_number
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|device_type
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"device_type=%s\n"
argument_list|,
name|config
operator|->
name|device_type
argument_list|)
expr_stmt|;
if|if
condition|(
name|WPA_GET_BE32
argument_list|(
name|config
operator|->
name|os_version
argument_list|)
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"os_version=%08x\n"
argument_list|,
name|WPA_GET_BE32
argument_list|(
name|config
operator|->
name|os_version
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|wps_cred_processing
condition|)
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"wps_cred_processing=%d\n"
argument_list|,
name|config
operator|->
name|wps_cred_processing
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CONFIG_WPS */
if|if
condition|(
name|config
operator|->
name|country
index|[
literal|0
index|]
operator|&&
name|config
operator|->
name|country
index|[
literal|1
index|]
condition|)
block|{
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"country=%c%c\n"
argument_list|,
name|config
operator|->
name|country
index|[
literal|0
index|]
argument_list|,
name|config
operator|->
name|country
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* CONFIG_NO_CONFIG_WRITE */
end_comment

begin_function
name|int
name|wpa_config_write
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|struct
name|wpa_config
modifier|*
name|config
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_WRITE
name|FILE
modifier|*
name|f
decl_stmt|;
name|struct
name|wpa_ssid
modifier|*
name|ssid
decl_stmt|;
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_BLOBS
name|struct
name|wpa_config_blob
modifier|*
name|blob
decl_stmt|;
endif|#
directive|endif
comment|/* CONFIG_NO_CONFIG_BLOBS */
name|int
name|ret
init|=
literal|0
decl_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Writing configuration file '%s'"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|name
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|==
name|NULL
condition|)
block|{
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Failed to open '%s' for writing"
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|wpa_config_write_global
argument_list|(
name|f
argument_list|,
name|config
argument_list|)
expr_stmt|;
for|for
control|(
name|ssid
operator|=
name|config
operator|->
name|ssid
init|;
name|ssid
condition|;
name|ssid
operator|=
name|ssid
operator|->
name|next
control|)
block|{
if|if
condition|(
name|ssid
operator|->
name|key_mgmt
operator|==
name|WPA_KEY_MGMT_WPS
condition|)
continue|continue;
comment|/* do not save temporary WPS networks */
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"\nnetwork={\n"
argument_list|)
expr_stmt|;
name|wpa_config_write_network
argument_list|(
name|f
argument_list|,
name|ssid
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"}\n"
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|CONFIG_NO_CONFIG_BLOBS
for|for
control|(
name|blob
operator|=
name|config
operator|->
name|blobs
init|;
name|blob
condition|;
name|blob
operator|=
name|blob
operator|->
name|next
control|)
block|{
name|ret
operator|=
name|wpa_config_write_blob
argument_list|(
name|f
argument_list|,
name|blob
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
condition|)
break|break;
block|}
endif|#
directive|endif
comment|/* CONFIG_NO_CONFIG_BLOBS */
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|wpa_printf
argument_list|(
name|MSG_DEBUG
argument_list|,
literal|"Configuration file '%s' written %ssuccessfully"
argument_list|,
name|name
argument_list|,
name|ret
condition|?
literal|"un"
else|:
literal|""
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
else|#
directive|else
comment|/* CONFIG_NO_CONFIG_WRITE */
return|return
operator|-
literal|1
return|;
endif|#
directive|endif
comment|/* CONFIG_NO_CONFIG_WRITE */
block|}
end_function

end_unit

