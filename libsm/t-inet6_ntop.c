begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Copyright (c) 2013 Proofpoint, Inc. and its suppliers.  *	All rights reserved.  *  * By using this file, you agree to the terms and conditions set  * forth in the LICENSE file which can be found at the top level of  * the sendmail distribution.  */
end_comment

begin_include
include|#
directive|include
file|<sm/gen.h>
end_include

begin_macro
name|SM_IDSTR
argument_list|(
argument|id
argument_list|,
literal|"@(#)$Id: t-inet6_ntop.c,v 1.2 2013/11/22 20:51:43 ca Exp $"
argument_list|)
end_macro

begin_include
include|#
directive|include
file|<sm/conf.h>
end_include

begin_if
if|#
directive|if
name|NETINET6
end_if

begin_include
include|#
directive|include
file|<sm/io.h>
end_include

begin_include
include|#
directive|include
file|<sm/test.h>
end_include

begin_include
include|#
directive|include
file|<sm/string.h>
end_include

begin_include
include|#
directive|include
file|<sys/socket.h>
end_include

begin_include
include|#
directive|include
file|<netinet/in.h>
end_include

begin_include
include|#
directive|include
file|<arpa/inet.h>
end_include

begin_decl_stmt
specifier|static
name|char
modifier|*
name|ipv6f
index|[]
init|=
block|{
literal|"1234:5678:9abc:def0:fedc:dead:f00f:101"
block|,
literal|"1080:0:0:0:8:800:200c:417a"
block|,
literal|"ff01:0:0:0:0:0:0:43"
block|,
literal|"0:0:0:0:0:0:0:1"
block|,
literal|"1:0:0:0:0:0:0:1"
block|,
literal|"0:1:0:0:0:0:0:1"
block|,
literal|"0:0:1:0:0:0:0:1"
block|,
literal|"0:0:0:1:0:0:0:1"
block|,
literal|"0:0:0:0:1:0:0:1"
block|,
literal|"0:0:0:0:0:1:0:1"
block|,
literal|"0:0:0:0:0:0:1:1"
block|,
literal|"1:a:b:c:d:e:f:9"
block|,
literal|"0:0:0:0:0:0:0:0"
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|test
parameter_list|()
block|{
name|int
name|i
decl_stmt|,
name|r
decl_stmt|;
name|struct
name|sockaddr_in6
name|addr
decl_stmt|;
name|char
modifier|*
name|ip
decl_stmt|,
modifier|*
name|ipf
decl_stmt|,
name|ipv6str
index|[
name|INET6_ADDRSTRLEN
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|ip
operator|=
name|ipv6f
index|[
name|i
index|]
operator|)
operator|!=
name|NULL
condition|;
name|i
operator|++
control|)
block|{
name|r
operator|=
name|inet_pton
argument_list|(
name|AF_INET6
argument_list|,
name|ip
argument_list|,
operator|&
name|addr
operator|.
name|sin6_addr
argument_list|)
expr_stmt|;
name|SM_TEST
argument_list|(
name|r
operator|==
literal|1
argument_list|)
expr_stmt|;
name|ipf
operator|=
name|sm_inet6_ntop
argument_list|(
operator|&
name|addr
operator|.
name|sin6_addr
argument_list|,
name|ipv6str
argument_list|,
sizeof|sizeof
argument_list|(
name|ipv6str
argument_list|)
argument_list|)
expr_stmt|;
name|SM_TEST
argument_list|(
name|ipf
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|SM_TEST
argument_list|(
name|strcmp
argument_list|(
name|ipf
argument_list|,
name|ip
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
name|sm_test_begin
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|,
literal|"test inet6_ntop"
argument_list|)
expr_stmt|;
name|test
argument_list|()
expr_stmt|;
return|return
name|sm_test_end
argument_list|()
return|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* NETINET6 */
end_comment

begin_function
name|int
name|main
parameter_list|(
name|argc
parameter_list|,
name|argv
parameter_list|)
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
block|{
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* NETINET6 */
end_comment

end_unit

