begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*===-- target_ocaml.c - LLVM OCaml Glue ------------------------*- C++ -*-===*\ |*                                                                            *| |*                     The LLVM Compiler Infrastructure                       *| |*                                                                            *| |* This file is distributed under the University of Illinois Open Source      *| |* License. See LICENSE.TXT for details.                                      *| |*                                                                            *| |*===----------------------------------------------------------------------===*| |*                                                                            *| |* This file glues LLVM's OCaml interface to its C interface. These functions *| |* are by and large transparent wrappers to the corresponding C functions.    *| |*                                                                            *| |* Note that these functions intentionally take liberties with the CAMLparamX *| |* macros, since most of the parameters are not GC heap objects.              *| |*                                                                            *| \*===----------------------------------------------------------------------===*/
end_comment

begin_include
include|#
directive|include
file|"llvm-c/Core.h"
end_include

begin_include
include|#
directive|include
file|"llvm-c/Target.h"
end_include

begin_include
include|#
directive|include
file|"llvm-c/TargetMachine.h"
end_include

begin_include
include|#
directive|include
file|"caml/alloc.h"
end_include

begin_include
include|#
directive|include
file|"caml/fail.h"
end_include

begin_include
include|#
directive|include
file|"caml/memory.h"
end_include

begin_include
include|#
directive|include
file|"caml/custom.h"
end_include

begin_include
include|#
directive|include
file|"caml/callback.h"
end_include

begin_function_decl
name|void
name|llvm_raise
parameter_list|(
name|value
name|Prototype
parameter_list|,
name|char
modifier|*
name|Message
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|value
name|llvm_string_of_message
parameter_list|(
name|char
modifier|*
name|Message
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*===---- Data Layout -----------------------------------------------------===*/
end_comment

begin_define
define|#
directive|define
name|DataLayout_val
parameter_list|(
name|v
parameter_list|)
value|(*(LLVMTargetDataRef *)(Data_custom_val(v)))
end_define

begin_function
specifier|static
name|void
name|llvm_finalize_data_layout
parameter_list|(
name|value
name|DataLayout
parameter_list|)
block|{
name|LLVMDisposeTargetData
argument_list|(
name|DataLayout_val
argument_list|(
name|DataLayout
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|custom_operations
name|llvm_data_layout_ops
init|=
block|{
operator|(
name|char
operator|*
operator|)
literal|"Llvm_target.DataLayout.t"
block|,
name|llvm_finalize_data_layout
block|,
name|custom_compare_default
block|,
name|custom_hash_default
block|,
name|custom_serialize_default
block|,
name|custom_deserialize_default
block|,
name|custom_compare_ext_default
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|value
name|llvm_alloc_data_layout
parameter_list|(
name|LLVMTargetDataRef
name|DataLayout
parameter_list|)
block|{
name|value
name|V
init|=
name|alloc_custom
argument_list|(
operator|&
name|llvm_data_layout_ops
argument_list|,
sizeof|sizeof
argument_list|(
name|LLVMTargetDataRef
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|DataLayout_val
argument_list|(
name|V
argument_list|)
operator|=
name|DataLayout
expr_stmt|;
return|return
name|V
return|;
block|}
end_function

begin_comment
comment|/* string -> DataLayout.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_of_string
parameter_list|(
name|value
name|StringRep
parameter_list|)
block|{
return|return
name|llvm_alloc_data_layout
argument_list|(
name|LLVMCreateTargetData
argument_list|(
name|String_val
argument_list|(
name|StringRep
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* DataLayout.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_as_string
parameter_list|(
name|value
name|TD
parameter_list|)
block|{
name|char
modifier|*
name|StringRep
init|=
name|LLVMCopyStringRepOfTargetData
argument_list|(
name|DataLayout_val
argument_list|(
name|TD
argument_list|)
argument_list|)
decl_stmt|;
name|value
name|Copy
init|=
name|copy_string
argument_list|(
name|StringRep
argument_list|)
decl_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|StringRep
argument_list|)
expr_stmt|;
return|return
name|Copy
return|;
block|}
end_function

begin_comment
comment|/* DataLayout.t -> Endian.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_byte_order
parameter_list|(
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMByteOrder
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_pointer_size
parameter_list|(
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMPointerSize
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.llcontext -> DataLayout.t -> Llvm.lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_datalayout_intptr_type
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|LLVMIntPtrTypeInContext
argument_list|(
name|C
argument_list|,
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* int -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_qualified_pointer_size
parameter_list|(
name|value
name|AS
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMPointerSizeForAS
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|AS
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.llcontext -> int -> DataLayout.t -> Llvm.lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_datalayout_qualified_intptr_type
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|AS
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|LLVMIntPtrTypeForASInContext
argument_list|(
name|C
argument_list|,
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|AS
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> Int64.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_size_in_bits
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|caml_copy_int64
argument_list|(
name|LLVMSizeOfTypeInBits
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> Int64.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_store_size
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|caml_copy_int64
argument_list|(
name|LLVMStoreSizeOfType
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> Int64.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_abi_size
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|caml_copy_int64
argument_list|(
name|LLVMABISizeOfType
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_abi_align
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMABIAlignmentOfType
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_stack_align
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMCallFrameAlignmentOfType
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_preferred_align
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMPreferredAlignmentOfType
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.llvalue -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_preferred_align_of_global
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMPreferredAlignmentOfGlobal
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|GlobalVar
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> Int64.t -> DataLayout.t -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_element_at_offset
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Offset
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMElementAtOffset
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|Int64_val
argument_list|(
name|Offset
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Llvm.lltype -> int -> DataLayout.t -> Int64.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_datalayout_offset_of_element
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Index
parameter_list|,
name|value
name|DL
parameter_list|)
block|{
return|return
name|caml_copy_int64
argument_list|(
name|LLVMOffsetOfElement
argument_list|(
name|DataLayout_val
argument_list|(
name|DL
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|Int_val
argument_list|(
name|Index
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*===---- Target ----------------------------------------------------------===*/
end_comment

begin_function
specifier|static
name|value
name|llvm_target_option
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
if|if
condition|(
name|Target
operator|!=
name|NULL
condition|)
block|{
name|value
name|Result
init|=
name|caml_alloc_small
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Store_field
argument_list|(
name|Result
argument_list|,
literal|0
argument_list|,
operator|(
name|value
operator|)
name|Target
argument_list|)
expr_stmt|;
return|return
name|Result
return|;
block|}
return|return
name|Val_int
argument_list|(
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* unit -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_default_triple
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
name|char
modifier|*
name|TripleCStr
init|=
name|LLVMGetDefaultTargetTriple
argument_list|()
decl_stmt|;
name|value
name|TripleStr
init|=
name|caml_copy_string
argument_list|(
name|TripleCStr
argument_list|)
decl_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|TripleCStr
argument_list|)
expr_stmt|;
return|return
name|TripleStr
return|;
block|}
end_function

begin_comment
comment|/* unit -> Target.t option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_first
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
return|return
name|llvm_target_option
argument_list|(
name|LLVMGetFirstTarget
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> Target.t option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_succ
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|llvm_target_option
argument_list|(
name|LLVMGetNextTarget
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> Target.t option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_by_name
parameter_list|(
name|value
name|Name
parameter_list|)
block|{
return|return
name|llvm_target_option
argument_list|(
name|LLVMGetTargetFromName
argument_list|(
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> Target.t */
end_comment

begin_function
name|CAMLprim
name|LLVMTargetRef
name|llvm_target_by_triple
parameter_list|(
name|value
name|Triple
parameter_list|)
block|{
name|LLVMTargetRef
name|T
decl_stmt|;
name|char
modifier|*
name|Error
decl_stmt|;
if|if
condition|(
name|LLVMGetTargetFromTriple
argument_list|(
name|String_val
argument_list|(
name|Triple
argument_list|)
argument_list|,
operator|&
name|T
argument_list|,
operator|&
name|Error
argument_list|)
condition|)
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm_target.Error"
argument_list|)
argument_list|,
name|Error
argument_list|)
expr_stmt|;
return|return
name|T
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_name
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetTargetName
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_description
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetTargetDescription
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_has_jit
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMTargetHasJIT
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_has_target_machine
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMTargetHasTargetMachine
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Target.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_has_asm_backend
parameter_list|(
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMTargetHasAsmBackend
argument_list|(
name|Target
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*===---- Target Machine --------------------------------------------------===*/
end_comment

begin_define
define|#
directive|define
name|TargetMachine_val
parameter_list|(
name|v
parameter_list|)
value|(*(LLVMTargetMachineRef *)(Data_custom_val(v)))
end_define

begin_function
specifier|static
name|void
name|llvm_finalize_target_machine
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
name|LLVMDisposeTargetMachine
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|custom_operations
name|llvm_target_machine_ops
init|=
block|{
operator|(
name|char
operator|*
operator|)
literal|"Llvm_target.TargetMachine.t"
block|,
name|llvm_finalize_target_machine
block|,
name|custom_compare_default
block|,
name|custom_hash_default
block|,
name|custom_serialize_default
block|,
name|custom_deserialize_default
block|,
name|custom_compare_ext_default
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|value
name|llvm_alloc_targetmachine
parameter_list|(
name|LLVMTargetMachineRef
name|Machine
parameter_list|)
block|{
name|value
name|V
init|=
name|alloc_custom
argument_list|(
operator|&
name|llvm_target_machine_ops
argument_list|,
sizeof|sizeof
argument_list|(
name|LLVMTargetMachineRef
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|TargetMachine_val
argument_list|(
name|V
argument_list|)
operator|=
name|Machine
expr_stmt|;
return|return
name|V
return|;
block|}
end_function

begin_comment
comment|/* triple:string -> ?cpu:string -> ?features:string    ?level:CodeGenOptLevel.t -> ?reloc_mode:RelocMode.t    ?code_model:CodeModel.t -> Target.t -> TargetMachine.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_create_targetmachine_native
parameter_list|(
name|value
name|Triple
parameter_list|,
name|value
name|CPU
parameter_list|,
name|value
name|Features
parameter_list|,
name|value
name|OptLevel
parameter_list|,
name|value
name|RelocMode
parameter_list|,
name|value
name|CodeModel
parameter_list|,
name|LLVMTargetRef
name|Target
parameter_list|)
block|{
name|LLVMTargetMachineRef
name|Machine
decl_stmt|;
specifier|const
name|char
modifier|*
name|CPUStr
init|=
literal|""
decl_stmt|,
modifier|*
name|FeaturesStr
init|=
literal|""
decl_stmt|;
name|LLVMCodeGenOptLevel
name|OptLevelEnum
init|=
name|LLVMCodeGenLevelDefault
decl_stmt|;
name|LLVMRelocMode
name|RelocModeEnum
init|=
name|LLVMRelocDefault
decl_stmt|;
name|LLVMCodeModel
name|CodeModelEnum
init|=
name|LLVMCodeModelDefault
decl_stmt|;
if|if
condition|(
name|CPU
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|CPUStr
operator|=
name|String_val
argument_list|(
name|Field
argument_list|(
name|CPU
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|Features
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|FeaturesStr
operator|=
name|String_val
argument_list|(
name|Field
argument_list|(
name|Features
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|OptLevel
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|OptLevelEnum
operator|=
name|Int_val
argument_list|(
name|Field
argument_list|(
name|OptLevel
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|RelocMode
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|RelocModeEnum
operator|=
name|Int_val
argument_list|(
name|Field
argument_list|(
name|RelocMode
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|CodeModel
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|CodeModelEnum
operator|=
name|Int_val
argument_list|(
name|Field
argument_list|(
name|CodeModel
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|Machine
operator|=
name|LLVMCreateTargetMachine
argument_list|(
name|Target
argument_list|,
name|String_val
argument_list|(
name|Triple
argument_list|)
argument_list|,
name|CPUStr
argument_list|,
name|FeaturesStr
argument_list|,
name|OptLevelEnum
argument_list|,
name|RelocModeEnum
argument_list|,
name|CodeModelEnum
argument_list|)
expr_stmt|;
return|return
name|llvm_alloc_targetmachine
argument_list|(
name|Machine
argument_list|)
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_create_targetmachine_bytecode
parameter_list|(
name|value
modifier|*
name|argv
parameter_list|,
name|int
name|argn
parameter_list|)
block|{
return|return
name|llvm_create_targetmachine_native
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
name|argv
index|[
literal|1
index|]
argument_list|,
name|argv
index|[
literal|2
index|]
argument_list|,
name|argv
index|[
literal|3
index|]
argument_list|,
name|argv
index|[
literal|4
index|]
argument_list|,
name|argv
index|[
literal|5
index|]
argument_list|,
operator|(
name|LLVMTargetRef
operator|)
name|argv
index|[
literal|6
index|]
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> Target.t */
end_comment

begin_function
name|CAMLprim
name|LLVMTargetRef
name|llvm_targetmachine_target
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
return|return
name|LLVMGetTargetMachineTarget
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_triple
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
return|return
name|llvm_string_of_message
argument_list|(
name|LLVMGetTargetMachineTriple
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_cpu
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
return|return
name|llvm_string_of_message
argument_list|(
name|LLVMGetTargetMachineCPU
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_features
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
return|return
name|llvm_string_of_message
argument_list|(
name|LLVMGetTargetMachineFeatureString
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> DataLayout.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_data_layout
parameter_list|(
name|value
name|Machine
parameter_list|)
block|{
return|return
name|llvm_alloc_data_layout
argument_list|(
name|LLVMCreateTargetDataLayout
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> TargetMachine.t -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_set_verbose_asm
parameter_list|(
name|value
name|Verb
parameter_list|,
name|value
name|Machine
parameter_list|)
block|{
name|LLVMSetTargetMachineAsmVerbosity
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|Verb
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* Llvm.llmodule -> CodeGenFileType.t -> string -> TargetMachine.t -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_emit_to_file
parameter_list|(
name|LLVMModuleRef
name|Module
parameter_list|,
name|value
name|FileType
parameter_list|,
name|value
name|FileName
parameter_list|,
name|value
name|Machine
parameter_list|)
block|{
name|char
modifier|*
name|ErrorMessage
decl_stmt|;
if|if
condition|(
name|LLVMTargetMachineEmitToFile
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|,
name|Module
argument_list|,
name|String_val
argument_list|(
name|FileName
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|FileType
argument_list|)
argument_list|,
operator|&
name|ErrorMessage
argument_list|)
condition|)
block|{
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm_target.Error"
argument_list|)
argument_list|,
name|ErrorMessage
argument_list|)
expr_stmt|;
block|}
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* Llvm.llmodule -> CodeGenFileType.t -> TargetMachine.t ->    Llvm.llmemorybuffer */
end_comment

begin_function
name|CAMLprim
name|LLVMMemoryBufferRef
name|llvm_targetmachine_emit_to_memory_buffer
parameter_list|(
name|LLVMModuleRef
name|Module
parameter_list|,
name|value
name|FileType
parameter_list|,
name|value
name|Machine
parameter_list|)
block|{
name|char
modifier|*
name|ErrorMessage
decl_stmt|;
name|LLVMMemoryBufferRef
name|Buffer
decl_stmt|;
if|if
condition|(
name|LLVMTargetMachineEmitToMemoryBuffer
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|,
name|Module
argument_list|,
name|Int_val
argument_list|(
name|FileType
argument_list|)
argument_list|,
operator|&
name|ErrorMessage
argument_list|,
operator|&
name|Buffer
argument_list|)
condition|)
block|{
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm_target.Error"
argument_list|)
argument_list|,
name|ErrorMessage
argument_list|)
expr_stmt|;
block|}
return|return
name|Buffer
return|;
block|}
end_function

begin_comment
comment|/* TargetMachine.t -> Llvm.PassManager.t -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_targetmachine_add_analysis_passes
parameter_list|(
name|LLVMPassManagerRef
name|PM
parameter_list|,
name|value
name|Machine
parameter_list|)
block|{
name|LLVMAddAnalysisPasses
argument_list|(
name|TargetMachine_val
argument_list|(
name|Machine
argument_list|)
argument_list|,
name|PM
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

end_unit

