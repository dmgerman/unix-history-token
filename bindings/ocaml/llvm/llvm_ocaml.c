begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*===-- llvm_ocaml.c - LLVM OCaml Glue --------------------------*- C++ -*-===*\ |*                                                                            *| |*                     The LLVM Compiler Infrastructure                       *| |*                                                                            *| |* This file is distributed under the University of Illinois Open Source      *| |* License. See LICENSE.TXT for details.                                      *| |*                                                                            *| |*===----------------------------------------------------------------------===*| |*                                                                            *| |* This file glues LLVM's OCaml interface to its C interface. These functions *| |* are by and large transparent wrappers to the corresponding C functions.    *| |*                                                                            *| |* Note that these functions intentionally take liberties with the CAMLparamX *| |* macros, since most of the parameters are not GC heap objects.              *| |*                                                                            *| \*===----------------------------------------------------------------------===*/
end_comment

begin_include
include|#
directive|include
file|<assert.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"llvm-c/Core.h"
end_include

begin_include
include|#
directive|include
file|"caml/alloc.h"
end_include

begin_include
include|#
directive|include
file|"caml/custom.h"
end_include

begin_include
include|#
directive|include
file|"caml/memory.h"
end_include

begin_include
include|#
directive|include
file|"caml/fail.h"
end_include

begin_include
include|#
directive|include
file|"caml/callback.h"
end_include

begin_function
name|value
name|llvm_string_of_message
parameter_list|(
name|char
modifier|*
name|Message
parameter_list|)
block|{
name|value
name|String
init|=
name|caml_copy_string
argument_list|(
name|Message
argument_list|)
decl_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|Message
argument_list|)
expr_stmt|;
return|return
name|String
return|;
block|}
end_function

begin_function
name|void
name|llvm_raise
parameter_list|(
name|value
name|Prototype
parameter_list|,
name|char
modifier|*
name|Message
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Prototype
argument_list|)
expr_stmt|;
name|caml_raise_with_arg
argument_list|(
name|Prototype
argument_list|,
name|llvm_string_of_message
argument_list|(
name|Message
argument_list|)
argument_list|)
expr_stmt|;
name|CAMLnoreturn
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|value
name|llvm_fatal_error_handler
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
name|llvm_fatal_error_trampoline
parameter_list|(
specifier|const
name|char
modifier|*
name|Reason
parameter_list|)
block|{
name|callback
argument_list|(
name|llvm_fatal_error_handler
argument_list|,
name|caml_copy_string
argument_list|(
name|Reason
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_install_fatal_error_handler
parameter_list|(
name|value
name|Handler
parameter_list|)
block|{
name|LLVMInstallFatalErrorHandler
argument_list|(
name|llvm_fatal_error_trampoline
argument_list|)
expr_stmt|;
name|llvm_fatal_error_handler
operator|=
name|Handler
expr_stmt|;
name|caml_register_global_root
argument_list|(
operator|&
name|llvm_fatal_error_handler
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_reset_fatal_error_handler
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
name|caml_remove_global_root
argument_list|(
operator|&
name|llvm_fatal_error_handler
argument_list|)
expr_stmt|;
name|LLVMResetFatalErrorHandler
argument_list|()
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_enable_pretty_stacktrace
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
name|LLVMEnablePrettyStackTrace
argument_list|()
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_parse_command_line_options
parameter_list|(
name|value
name|Overview
parameter_list|,
name|value
name|Args
parameter_list|)
block|{
name|char
modifier|*
name|COverview
decl_stmt|;
if|if
condition|(
name|Overview
operator|==
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
block|{
name|COverview
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|COverview
operator|=
name|String_val
argument_list|(
name|Field
argument_list|(
name|Overview
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|LLVMParseCommandLineOptions
argument_list|(
name|Wosize_val
argument_list|(
name|Args
argument_list|)
argument_list|,
operator|(
specifier|const
name|char
operator|*
specifier|const
operator|*
operator|)
name|Op_val
argument_list|(
name|Args
argument_list|)
argument_list|,
name|COverview
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_function
specifier|static
name|value
name|alloc_variant
parameter_list|(
name|int
name|tag
parameter_list|,
name|void
modifier|*
name|Value
parameter_list|)
block|{
name|value
name|Iter
init|=
name|alloc_small
argument_list|(
literal|1
argument_list|,
name|tag
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Iter
argument_list|,
literal|0
argument_list|)
operator|=
name|Val_op
argument_list|(
name|Value
argument_list|)
expr_stmt|;
return|return
name|Iter
return|;
block|}
end_function

begin_comment
comment|/* Macro to convert the C first/next/last/prev idiom to the Ocaml llpos/    llrev_pos idiom. */
end_comment

begin_define
define|#
directive|define
name|DEFINE_ITERATORS
parameter_list|(
name|camlname
parameter_list|,
name|cname
parameter_list|,
name|pty
parameter_list|,
name|cty
parameter_list|,
name|pfun
parameter_list|)
define|\
comment|/* llmodule -> ('a, 'b) llpos */
define|\
value|CAMLprim value llvm_##camlname##_begin(pty Mom) {       \     cty First = LLVMGetFirst##cname(Mom);                 \     if (First)                                            \       return alloc_variant(1, First);                     \     return alloc_variant(0, Mom);                         \   }                                                       \                                                           \
comment|/* llvalue -> ('a, 'b) llpos */
value|\   CAMLprim value llvm_##camlname##_succ(cty Kid) {        \     cty Next = LLVMGetNext##cname(Kid);                   \     if (Next)                                             \       return alloc_variant(1, Next);                      \     return alloc_variant(0, pfun(Kid));                   \   }                                                       \                                                           \
comment|/* llmodule -> ('a, 'b) llrev_pos */
value|\   CAMLprim value llvm_##camlname##_end(pty Mom) {         \     cty Last = LLVMGetLast##cname(Mom);                   \     if (Last)                                             \       return alloc_variant(1, Last);                      \     return alloc_variant(0, Mom);                         \   }                                                       \                                                           \
comment|/* llvalue -> ('a, 'b) llrev_pos */
value|\   CAMLprim value llvm_##camlname##_pred(cty Kid) {        \     cty Prev = LLVMGetPrevious##cname(Kid);               \     if (Prev)                                             \       return alloc_variant(1, Prev);                      \     return alloc_variant(0, pfun(Kid));                   \   }
end_define

begin_comment
comment|/*===-- Contexts ----------------------------------------------------------===*/
end_comment

begin_comment
comment|/* unit -> llcontext */
end_comment

begin_function
name|CAMLprim
name|LLVMContextRef
name|llvm_create_context
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
return|return
name|LLVMContextCreate
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dispose_context
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|)
block|{
name|LLVMContextDispose
argument_list|(
name|C
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* unit -> llcontext */
end_comment

begin_function
name|CAMLprim
name|LLVMContextRef
name|llvm_global_context
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
return|return
name|LLVMGetGlobalContext
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> string -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_mdkind_id
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|Name
parameter_list|)
block|{
name|unsigned
name|MDKindID
init|=
name|LLVMGetMDKindIDInContext
argument_list|(
name|C
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|caml_string_length
argument_list|(
name|Name
argument_list|)
argument_list|)
decl_stmt|;
return|return
name|Val_int
argument_list|(
name|MDKindID
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*===-- Modules -----------------------------------------------------------===*/
end_comment

begin_comment
comment|/* llcontext -> string -> llmodule */
end_comment

begin_function
name|CAMLprim
name|LLVMModuleRef
name|llvm_create_module
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ModuleID
parameter_list|)
block|{
return|return
name|LLVMModuleCreateWithNameInContext
argument_list|(
name|String_val
argument_list|(
name|ModuleID
argument_list|)
argument_list|,
name|C
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dispose_module
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMDisposeModule
argument_list|(
name|M
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_target_triple
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetTarget
argument_list|(
name|M
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llmodule -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_target_triple
parameter_list|(
name|value
name|Trip
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMSetTarget
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Trip
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_data_layout
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetDataLayout
argument_list|(
name|M
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llmodule -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_data_layout
parameter_list|(
name|value
name|Layout
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMSetDataLayout
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Layout
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dump_module
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMDumpModule
argument_list|(
name|M
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* string -> llmodule -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_print_module
parameter_list|(
name|value
name|Filename
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|char
modifier|*
name|Message
decl_stmt|;
if|if
condition|(
name|LLVMPrintModuleToFile
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Filename
argument_list|)
argument_list|,
operator|&
name|Message
argument_list|)
condition|)
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm.IoError"
argument_list|)
argument_list|,
name|Message
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_string_of_llmodule
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal1
argument_list|(
name|ModuleStr
argument_list|)
expr_stmt|;
name|char
modifier|*
name|ModuleCStr
decl_stmt|;
name|ModuleCStr
operator|=
name|LLVMPrintModuleToString
argument_list|(
name|M
argument_list|)
expr_stmt|;
name|ModuleStr
operator|=
name|caml_copy_string
argument_list|(
name|ModuleCStr
argument_list|)
expr_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|ModuleCStr
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|ModuleStr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llmodule -> string -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_module_inline_asm
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|value
name|Asm
parameter_list|)
block|{
name|LLVMSetModuleInlineAsm
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Asm
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*===-- Types -------------------------------------------------------------===*/
end_comment

begin_comment
comment|/* lltype -> TypeKind.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_classify_type
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetTypeKind
argument_list|(
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_type_is_sized
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMTypeIsSized
argument_list|(
name|Ty
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llcontext */
end_comment

begin_function
name|CAMLprim
name|LLVMContextRef
name|llvm_type_context
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|)
block|{
return|return
name|LLVMGetTypeContext
argument_list|(
name|Ty
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dump_type
parameter_list|(
name|LLVMTypeRef
name|Val
parameter_list|)
block|{
name|LLVMDumpType
argument_list|(
name|Val
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* lltype -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_string_of_lltype
parameter_list|(
name|LLVMTypeRef
name|M
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal1
argument_list|(
name|TypeStr
argument_list|)
expr_stmt|;
name|char
modifier|*
name|TypeCStr
decl_stmt|;
name|TypeCStr
operator|=
name|LLVMPrintTypeToString
argument_list|(
name|M
argument_list|)
expr_stmt|;
name|TypeStr
operator|=
name|caml_copy_string
argument_list|(
name|TypeCStr
argument_list|)
expr_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|TypeCStr
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|TypeStr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*--... Operations on integer types ........................................--*/
end_comment

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_i1_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMInt1TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_i8_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMInt8TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_i16_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMInt16TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_i32_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMInt32TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_i64_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMInt64TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> int -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_integer_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|,
name|value
name|Width
parameter_list|)
block|{
return|return
name|LLVMIntTypeInContext
argument_list|(
name|Context
argument_list|,
name|Int_val
argument_list|(
name|Width
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_integer_bitwidth
parameter_list|(
name|LLVMTypeRef
name|IntegerTy
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetIntTypeWidth
argument_list|(
name|IntegerTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on real types ...........................................--*/
end_comment

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_float_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMFloatTypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_double_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMDoubleTypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_x86fp80_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMX86FP80TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_fp128_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMFP128TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_ppc_fp128_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMPPCFP128TypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on function types .......................................--*/
end_comment

begin_comment
comment|/* lltype -> lltype array -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_function_type
parameter_list|(
name|LLVMTypeRef
name|RetTy
parameter_list|,
name|value
name|ParamTys
parameter_list|)
block|{
return|return
name|LLVMFunctionType
argument_list|(
name|RetTy
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|ParamTys
argument_list|,
name|Wosize_val
argument_list|(
name|ParamTys
argument_list|)
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> lltype array -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_var_arg_function_type
parameter_list|(
name|LLVMTypeRef
name|RetTy
parameter_list|,
name|value
name|ParamTys
parameter_list|)
block|{
return|return
name|LLVMFunctionType
argument_list|(
name|RetTy
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|ParamTys
argument_list|,
name|Wosize_val
argument_list|(
name|ParamTys
argument_list|)
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_var_arg
parameter_list|(
name|LLVMTypeRef
name|FunTy
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsFunctionVarArg
argument_list|(
name|FunTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> lltype array */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_param_types
parameter_list|(
name|LLVMTypeRef
name|FunTy
parameter_list|)
block|{
name|value
name|Tys
init|=
name|alloc
argument_list|(
name|LLVMCountParamTypes
argument_list|(
name|FunTy
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|LLVMGetParamTypes
argument_list|(
name|FunTy
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|Tys
argument_list|)
expr_stmt|;
return|return
name|Tys
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on struct types .........................................--*/
end_comment

begin_comment
comment|/* llcontext -> lltype array -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_struct_type
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ElementTypes
parameter_list|)
block|{
return|return
name|LLVMStructTypeInContext
argument_list|(
name|C
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|ElementTypes
argument_list|,
name|Wosize_val
argument_list|(
name|ElementTypes
argument_list|)
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype array -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_packed_struct_type
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ElementTypes
parameter_list|)
block|{
return|return
name|LLVMStructTypeInContext
argument_list|(
name|C
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|ElementTypes
argument_list|,
name|Wosize_val
argument_list|(
name|ElementTypes
argument_list|)
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> string -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_named_struct_type
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|Name
parameter_list|)
block|{
return|return
name|LLVMStructCreateNamed
argument_list|(
name|C
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_struct_set_body
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|ElementTypes
parameter_list|,
name|value
name|Packed
parameter_list|)
block|{
name|LLVMStructSetBody
argument_list|(
name|Ty
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|ElementTypes
argument_list|,
name|Wosize_val
argument_list|(
name|ElementTypes
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|Packed
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* lltype -> string option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_struct_name
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
specifier|const
name|char
modifier|*
name|C
init|=
name|LLVMGetStructName
argument_list|(
name|Ty
argument_list|)
decl_stmt|;
if|if
condition|(
name|C
condition|)
block|{
name|CAMLlocal1
argument_list|(
name|result
argument_list|)
expr_stmt|;
name|result
operator|=
name|caml_alloc_small
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|result
argument_list|,
literal|0
argument_list|,
name|caml_copy_string
argument_list|(
name|C
argument_list|)
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|result
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lltype -> lltype array */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_struct_element_types
parameter_list|(
name|LLVMTypeRef
name|StructTy
parameter_list|)
block|{
name|value
name|Tys
init|=
name|alloc
argument_list|(
name|LLVMCountStructElementTypes
argument_list|(
name|StructTy
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|LLVMGetStructElementTypes
argument_list|(
name|StructTy
argument_list|,
operator|(
name|LLVMTypeRef
operator|*
operator|)
name|Tys
argument_list|)
expr_stmt|;
return|return
name|Tys
return|;
block|}
end_function

begin_comment
comment|/* lltype -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_packed
parameter_list|(
name|LLVMTypeRef
name|StructTy
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsPackedStruct
argument_list|(
name|StructTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_opaque
parameter_list|(
name|LLVMTypeRef
name|StructTy
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsOpaqueStruct
argument_list|(
name|StructTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on array, pointer, and vector types .....................--*/
end_comment

begin_comment
comment|/* lltype -> int -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_array_type
parameter_list|(
name|LLVMTypeRef
name|ElementTy
parameter_list|,
name|value
name|Count
parameter_list|)
block|{
return|return
name|LLVMArrayType
argument_list|(
name|ElementTy
argument_list|,
name|Int_val
argument_list|(
name|Count
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_pointer_type
parameter_list|(
name|LLVMTypeRef
name|ElementTy
parameter_list|)
block|{
return|return
name|LLVMPointerType
argument_list|(
name|ElementTy
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_qualified_pointer_type
parameter_list|(
name|LLVMTypeRef
name|ElementTy
parameter_list|,
name|value
name|AddressSpace
parameter_list|)
block|{
return|return
name|LLVMPointerType
argument_list|(
name|ElementTy
argument_list|,
name|Int_val
argument_list|(
name|AddressSpace
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_vector_type
parameter_list|(
name|LLVMTypeRef
name|ElementTy
parameter_list|,
name|value
name|Count
parameter_list|)
block|{
return|return
name|LLVMVectorType
argument_list|(
name|ElementTy
argument_list|,
name|Int_val
argument_list|(
name|Count
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_array_length
parameter_list|(
name|LLVMTypeRef
name|ArrayTy
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetArrayLength
argument_list|(
name|ArrayTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_address_space
parameter_list|(
name|LLVMTypeRef
name|PtrTy
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetPointerAddressSpace
argument_list|(
name|PtrTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_vector_size
parameter_list|(
name|LLVMTypeRef
name|VectorTy
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetVectorSize
argument_list|(
name|VectorTy
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on other types ..........................................--*/
end_comment

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_void_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMVoidTypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_label_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMLabelTypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_x86_mmx_type
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|)
block|{
return|return
name|LLVMX86MMXTypeInContext
argument_list|(
name|Context
argument_list|)
return|;
block|}
end_function

begin_function
name|CAMLprim
name|value
name|llvm_type_by_name
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|value
name|Name
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Name
argument_list|)
expr_stmt|;
name|LLVMTypeRef
name|Ty
init|=
name|LLVMGetTypeByName
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|Ty
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|Ty
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*===-- VALUES ------------------------------------------------------------===*/
end_comment

begin_comment
comment|/* llvalue -> lltype */
end_comment

begin_function
name|CAMLprim
name|LLVMTypeRef
name|llvm_type_of
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|LLVMTypeOf
argument_list|(
name|Val
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* keep in sync with ValueKind.t */
end_comment

begin_enum
enum|enum
name|ValueKind
block|{
name|NullValue
init|=
literal|0
block|,
name|Argument
block|,
name|BasicBlock
block|,
name|InlineAsm
block|,
name|MDNode
block|,
name|MDString
block|,
name|BlockAddress
block|,
name|ConstantAggregateZero
block|,
name|ConstantArray
block|,
name|ConstantDataArray
block|,
name|ConstantDataVector
block|,
name|ConstantExpr
block|,
name|ConstantFP
block|,
name|ConstantInt
block|,
name|ConstantPointerNull
block|,
name|ConstantStruct
block|,
name|ConstantVector
block|,
name|Function
block|,
name|GlobalAlias
block|,
name|GlobalVariable
block|,
name|UndefValue
block|,
name|Instruction
block|}
enum|;
end_enum

begin_comment
comment|/* llvalue -> ValueKind.t */
end_comment

begin_define
define|#
directive|define
name|DEFINE_CASE
parameter_list|(
name|Val
parameter_list|,
name|Kind
parameter_list|)
define|\
value|do {if (LLVMIsA##Kind(Val)) CAMLreturn(Val_int(Kind));} while(0)
end_define

begin_function
name|CAMLprim
name|value
name|llvm_classify_value
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|Val
condition|)
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
name|NullValue
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|LLVMIsAConstant
argument_list|(
name|Val
argument_list|)
condition|)
block|{
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|BlockAddress
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantAggregateZero
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantArray
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantDataArray
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantDataVector
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantExpr
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantFP
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantInt
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantPointerNull
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantStruct
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|ConstantVector
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|LLVMIsAInstruction
argument_list|(
name|Val
argument_list|)
condition|)
block|{
name|CAMLlocal1
argument_list|(
name|result
argument_list|)
expr_stmt|;
name|result
operator|=
name|caml_alloc_small
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|result
argument_list|,
literal|0
argument_list|,
name|Val_int
argument_list|(
name|LLVMGetInstructionOpcode
argument_list|(
name|Val
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|result
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|LLVMIsAGlobalValue
argument_list|(
name|Val
argument_list|)
condition|)
block|{
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|Function
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|GlobalAlias
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|GlobalVariable
argument_list|)
expr_stmt|;
block|}
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|Argument
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|BasicBlock
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|InlineAsm
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|MDNode
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|MDString
argument_list|)
expr_stmt|;
name|DEFINE_CASE
argument_list|(
name|Val
argument_list|,
name|UndefValue
argument_list|)
expr_stmt|;
name|failwith
argument_list|(
literal|"Unknown Value class"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_value_name
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetValueName
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_value_name
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|LLVMSetValueName
argument_list|(
name|Val
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dump_value
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|LLVMDumpValue
argument_list|(
name|Val
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_string_of_llvalue
parameter_list|(
name|LLVMValueRef
name|M
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal1
argument_list|(
name|ValueStr
argument_list|)
expr_stmt|;
name|char
modifier|*
name|ValueCStr
decl_stmt|;
name|ValueCStr
operator|=
name|LLVMPrintValueToString
argument_list|(
name|M
argument_list|)
expr_stmt|;
name|ValueStr
operator|=
name|caml_copy_string
argument_list|(
name|ValueCStr
argument_list|)
expr_stmt|;
name|LLVMDisposeMessage
argument_list|(
name|ValueCStr
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|ValueStr
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_replace_all_uses_with
parameter_list|(
name|LLVMValueRef
name|OldVal
parameter_list|,
name|LLVMValueRef
name|NewVal
parameter_list|)
block|{
name|LLVMReplaceAllUsesWith
argument_list|(
name|OldVal
argument_list|,
name|NewVal
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on users ................................................--*/
end_comment

begin_comment
comment|/* llvalue -> int -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_operand
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|,
name|value
name|I
parameter_list|)
block|{
return|return
name|LLVMGetOperand
argument_list|(
name|V
argument_list|,
name|Int_val
argument_list|(
name|I
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> lluse */
end_comment

begin_function
name|CAMLprim
name|LLVMUseRef
name|llvm_operand_use
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|,
name|value
name|I
parameter_list|)
block|{
return|return
name|LLVMGetOperandUse
argument_list|(
name|V
argument_list|,
name|Int_val
argument_list|(
name|I
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_operand
parameter_list|(
name|LLVMValueRef
name|U
parameter_list|,
name|value
name|I
parameter_list|,
name|LLVMValueRef
name|V
parameter_list|)
block|{
name|LLVMSetOperand
argument_list|(
name|U
argument_list|,
name|Int_val
argument_list|(
name|I
argument_list|)
argument_list|,
name|V
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_num_operands
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetNumOperands
argument_list|(
name|V
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on constants of (mostly) any type .......................--*/
end_comment

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_constant
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsConstant
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_null
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsNull
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_undef
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsUndef
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> Opcode.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_constexpr_get_opcode
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|LLVMIsAConstantExpr
argument_list|(
name|Val
argument_list|)
condition|?
name|Val_int
argument_list|(
name|LLVMGetConstOpcode
argument_list|(
name|Val
argument_list|)
argument_list|)
else|:
name|Val_int
argument_list|(
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on instructions .........................................--*/
end_comment

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_has_metadata
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMHasMetadata
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> llvalue option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_metadata
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|MDKindID
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|MDKindID
argument_list|)
expr_stmt|;
name|LLVMValueRef
name|MD
decl_stmt|;
if|if
condition|(
operator|(
name|MD
operator|=
name|LLVMGetMetadata
argument_list|(
name|Val
argument_list|,
name|Int_val
argument_list|(
name|MDKindID
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|MD
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_metadata
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|MDKindID
parameter_list|,
name|LLVMValueRef
name|MD
parameter_list|)
block|{
name|LLVMSetMetadata
argument_list|(
name|Val
argument_list|,
name|Int_val
argument_list|(
name|MDKindID
argument_list|)
argument_list|,
name|MD
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_clear_metadata
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|MDKindID
parameter_list|)
block|{
name|LLVMSetMetadata
argument_list|(
name|Val
argument_list|,
name|Int_val
argument_list|(
name|MDKindID
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on metadata .............................................--*/
end_comment

begin_comment
comment|/* llcontext -> string -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_mdstring
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|S
parameter_list|)
block|{
return|return
name|LLVMMDStringInContext
argument_list|(
name|C
argument_list|,
name|String_val
argument_list|(
name|S
argument_list|)
argument_list|,
name|caml_string_length
argument_list|(
name|S
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_mdnode
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMMDNodeInContext
argument_list|(
name|C
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_mdnull
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|)
block|{
return|return
name|NULL
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_get_mdstring
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
specifier|const
name|char
modifier|*
name|S
decl_stmt|;
name|unsigned
name|Len
decl_stmt|;
if|if
condition|(
operator|(
name|S
operator|=
name|LLVMGetMDString
argument_list|(
name|V
argument_list|,
operator|&
name|Len
argument_list|)
operator|)
condition|)
block|{
name|CAMLlocal2
argument_list|(
name|Option
argument_list|,
name|Str
argument_list|)
expr_stmt|;
name|Str
operator|=
name|caml_alloc_string
argument_list|(
name|Len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|S
argument_list|,
name|Len
argument_list|)
expr_stmt|;
name|Option
operator|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|,
name|Str
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llmodule -> string -> llvalue array */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_get_namedmd
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|value
name|Name
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Name
argument_list|)
expr_stmt|;
name|CAMLlocal1
argument_list|(
name|Nodes
argument_list|)
expr_stmt|;
name|Nodes
operator|=
name|alloc
argument_list|(
name|LLVMGetNamedMetadataNumOperands
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|LLVMGetNamedMetadataOperands
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Nodes
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Nodes
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llmodule -> string -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_append_namedmd
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|value
name|Name
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|LLVMAddNamedMetadataOperand
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|Val
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on scalar constants .....................................--*/
end_comment

begin_comment
comment|/* lltype -> int -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_int
parameter_list|(
name|LLVMTypeRef
name|IntTy
parameter_list|,
name|value
name|N
parameter_list|)
block|{
return|return
name|LLVMConstInt
argument_list|(
name|IntTy
argument_list|,
operator|(
name|long
name|long
operator|)
name|Long_val
argument_list|(
name|N
argument_list|)
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> Int64.t -> bool -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_of_int64
parameter_list|(
name|LLVMTypeRef
name|IntTy
parameter_list|,
name|value
name|N
parameter_list|,
name|value
name|SExt
parameter_list|)
block|{
return|return
name|LLVMConstInt
argument_list|(
name|IntTy
argument_list|,
name|Int64_val
argument_list|(
name|N
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|SExt
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> Int64.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_int64_of_const
parameter_list|(
name|LLVMValueRef
name|Const
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
if|if
condition|(
name|LLVMIsAConstantInt
argument_list|(
name|Const
argument_list|)
operator|&&
name|LLVMGetIntTypeWidth
argument_list|(
name|LLVMTypeOf
argument_list|(
name|Const
argument_list|)
argument_list|)
operator|<=
literal|64
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|caml_copy_int64
argument_list|(
name|LLVMConstIntGetSExtValue
argument_list|(
name|Const
argument_list|)
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lltype -> string -> int -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_int_of_string
parameter_list|(
name|LLVMTypeRef
name|IntTy
parameter_list|,
name|value
name|S
parameter_list|,
name|value
name|Radix
parameter_list|)
block|{
return|return
name|LLVMConstIntOfStringAndSize
argument_list|(
name|IntTy
argument_list|,
name|String_val
argument_list|(
name|S
argument_list|)
argument_list|,
name|caml_string_length
argument_list|(
name|S
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|Radix
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> float -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_float
parameter_list|(
name|LLVMTypeRef
name|RealTy
parameter_list|,
name|value
name|N
parameter_list|)
block|{
return|return
name|LLVMConstReal
argument_list|(
name|RealTy
argument_list|,
name|Double_val
argument_list|(
name|N
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> float */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_float_of_const
parameter_list|(
name|LLVMValueRef
name|Const
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal1
argument_list|(
name|Option
argument_list|)
expr_stmt|;
name|LLVMBool
name|LosesInfo
decl_stmt|;
name|double
name|Result
decl_stmt|;
if|if
condition|(
name|LLVMIsAConstantFP
argument_list|(
name|Const
argument_list|)
condition|)
block|{
name|Result
operator|=
name|LLVMConstRealGetDouble
argument_list|(
name|Const
argument_list|,
operator|&
name|LosesInfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|LosesInfo
condition|)
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|Option
operator|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|caml_copy_double
argument_list|(
name|Result
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lltype -> string -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_float_of_string
parameter_list|(
name|LLVMTypeRef
name|RealTy
parameter_list|,
name|value
name|S
parameter_list|)
block|{
return|return
name|LLVMConstRealOfStringAndSize
argument_list|(
name|RealTy
argument_list|,
name|String_val
argument_list|(
name|S
argument_list|)
argument_list|,
name|caml_string_length
argument_list|(
name|S
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on composite constants ..................................--*/
end_comment

begin_comment
comment|/* llcontext -> string -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_string
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|,
name|value
name|Str
parameter_list|,
name|value
name|NullTerminate
parameter_list|)
block|{
return|return
name|LLVMConstStringInContext
argument_list|(
name|Context
argument_list|,
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|string_length
argument_list|(
name|Str
argument_list|)
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> string -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_stringz
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|,
name|value
name|Str
parameter_list|,
name|value
name|NullTerminate
parameter_list|)
block|{
return|return
name|LLVMConstStringInContext
argument_list|(
name|Context
argument_list|,
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|string_length
argument_list|(
name|Str
argument_list|)
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_array
parameter_list|(
name|LLVMTypeRef
name|ElementTy
parameter_list|,
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMConstArray
argument_list|(
name|ElementTy
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_struct
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMConstStructInContext
argument_list|(
name|C
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_named_struct
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMConstNamedStruct
argument_list|(
name|Ty
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_packed_struct
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|,
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMConstStructInContext
argument_list|(
name|C
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_vector
parameter_list|(
name|value
name|ElementVals
parameter_list|)
block|{
return|return
name|LLVMConstVector
argument_list|(
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|ElementVals
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_string_of_const
parameter_list|(
name|LLVMValueRef
name|Const
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|S
decl_stmt|;
name|size_t
name|Len
decl_stmt|;
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal2
argument_list|(
name|Option
argument_list|,
name|Str
argument_list|)
expr_stmt|;
if|if
condition|(
name|LLVMIsAConstantDataSequential
argument_list|(
name|Const
argument_list|)
operator|&&
name|LLVMIsConstantString
argument_list|(
name|Const
argument_list|)
condition|)
block|{
name|S
operator|=
name|LLVMGetAsString
argument_list|(
name|Const
argument_list|,
operator|&
name|Len
argument_list|)
expr_stmt|;
name|Str
operator|=
name|caml_alloc_string
argument_list|(
name|Len
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|S
argument_list|,
name|Len
argument_list|)
expr_stmt|;
name|Option
operator|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|Str
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* llvalue -> int -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_element
parameter_list|(
name|LLVMValueRef
name|Const
parameter_list|,
name|value
name|N
parameter_list|)
block|{
return|return
name|LLVMGetElementAsConstant
argument_list|(
name|Const
argument_list|,
name|Int_val
argument_list|(
name|N
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Constant expressions ...............................................--*/
end_comment

begin_comment
comment|/* Icmp.t -> llvalue -> llvalue -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_icmp
parameter_list|(
name|value
name|Pred
parameter_list|,
name|LLVMValueRef
name|LHSConstant
parameter_list|,
name|LLVMValueRef
name|RHSConstant
parameter_list|)
block|{
return|return
name|LLVMConstICmp
argument_list|(
name|Int_val
argument_list|(
name|Pred
argument_list|)
operator|+
name|LLVMIntEQ
argument_list|,
name|LHSConstant
argument_list|,
name|RHSConstant
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Fcmp.t -> llvalue -> llvalue -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_fcmp
parameter_list|(
name|value
name|Pred
parameter_list|,
name|LLVMValueRef
name|LHSConstant
parameter_list|,
name|LLVMValueRef
name|RHSConstant
parameter_list|)
block|{
return|return
name|LLVMConstFCmp
argument_list|(
name|Int_val
argument_list|(
name|Pred
argument_list|)
argument_list|,
name|LHSConstant
argument_list|,
name|RHSConstant
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_gep
parameter_list|(
name|LLVMValueRef
name|ConstantVal
parameter_list|,
name|value
name|Indices
parameter_list|)
block|{
return|return
name|LLVMConstGEP
argument_list|(
name|ConstantVal
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_in_bounds_gep
parameter_list|(
name|LLVMValueRef
name|ConstantVal
parameter_list|,
name|value
name|Indices
parameter_list|)
block|{
return|return
name|LLVMConstInBoundsGEP
argument_list|(
name|ConstantVal
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> is_signed:bool -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_intcast
parameter_list|(
name|LLVMValueRef
name|CV
parameter_list|,
name|LLVMTypeRef
name|T
parameter_list|,
name|value
name|IsSigned
parameter_list|)
block|{
return|return
name|LLVMConstIntCast
argument_list|(
name|CV
argument_list|,
name|T
argument_list|,
name|Bool_val
argument_list|(
name|IsSigned
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_extractvalue
parameter_list|(
name|LLVMValueRef
name|Aggregate
parameter_list|,
name|value
name|Indices
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Indices
argument_list|)
expr_stmt|;
name|int
name|size
init|=
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|LLVMValueRef
name|result
decl_stmt|;
name|unsigned
modifier|*
name|idxs
init|=
operator|(
name|unsigned
operator|*
operator|)
name|malloc
argument_list|(
name|size
operator|*
sizeof|sizeof
argument_list|(
name|unsigned
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
name|idxs
index|[
name|i
index|]
operator|=
name|Int_val
argument_list|(
name|Field
argument_list|(
name|Indices
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|result
operator|=
name|LLVMConstExtractValue
argument_list|(
name|Aggregate
argument_list|,
name|idxs
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|idxs
argument_list|)
expr_stmt|;
name|CAMLreturnT
argument_list|(
name|LLVMValueRef
argument_list|,
name|result
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> int array -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_insertvalue
parameter_list|(
name|LLVMValueRef
name|Aggregate
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Indices
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Indices
argument_list|)
expr_stmt|;
name|int
name|size
init|=
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
name|LLVMValueRef
name|result
decl_stmt|;
name|unsigned
modifier|*
name|idxs
init|=
operator|(
name|unsigned
operator|*
operator|)
name|malloc
argument_list|(
name|size
operator|*
sizeof|sizeof
argument_list|(
name|unsigned
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
name|i
operator|++
control|)
block|{
name|idxs
index|[
name|i
index|]
operator|=
name|Int_val
argument_list|(
name|Field
argument_list|(
name|Indices
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|result
operator|=
name|LLVMConstInsertValue
argument_list|(
name|Aggregate
argument_list|,
name|Val
argument_list|,
name|idxs
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|idxs
argument_list|)
expr_stmt|;
name|CAMLreturnT
argument_list|(
name|LLVMValueRef
argument_list|,
name|result
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lltype -> string -> string -> bool -> bool -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_const_inline_asm
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Asm
parameter_list|,
name|value
name|Constraints
parameter_list|,
name|value
name|HasSideEffects
parameter_list|,
name|value
name|IsAlignStack
parameter_list|)
block|{
return|return
name|LLVMConstInlineAsm
argument_list|(
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Asm
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Constraints
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|HasSideEffects
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|IsAlignStack
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on global variables, functions, and aliases (globals) ...--*/
end_comment

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_declaration
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsDeclaration
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> Linkage.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_linkage
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetLinkage
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Linkage.t -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_linkage
parameter_list|(
name|value
name|Linkage
parameter_list|,
name|LLVMValueRef
name|Global
parameter_list|)
block|{
name|LLVMSetLinkage
argument_list|(
name|Global
argument_list|,
name|Int_val
argument_list|(
name|Linkage
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_section
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|caml_copy_string
argument_list|(
name|LLVMGetSection
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_section
parameter_list|(
name|value
name|Section
parameter_list|,
name|LLVMValueRef
name|Global
parameter_list|)
block|{
name|LLVMSetSection
argument_list|(
name|Global
argument_list|,
name|String_val
argument_list|(
name|Section
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> Visibility.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_visibility
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetVisibility
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Visibility.t -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_visibility
parameter_list|(
name|value
name|Viz
parameter_list|,
name|LLVMValueRef
name|Global
parameter_list|)
block|{
name|LLVMSetVisibility
argument_list|(
name|Global
argument_list|,
name|Int_val
argument_list|(
name|Viz
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> DLLStorageClass.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_dll_storage_class
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetDLLStorageClass
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* DLLStorageClass.t -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_dll_storage_class
parameter_list|(
name|value
name|Viz
parameter_list|,
name|LLVMValueRef
name|Global
parameter_list|)
block|{
name|LLVMSetDLLStorageClass
argument_list|(
name|Global
argument_list|,
name|Int_val
argument_list|(
name|Viz
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_alignment
parameter_list|(
name|LLVMValueRef
name|Global
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetAlignment
argument_list|(
name|Global
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_alignment
parameter_list|(
name|value
name|Bytes
parameter_list|,
name|LLVMValueRef
name|Global
parameter_list|)
block|{
name|LLVMSetAlignment
argument_list|(
name|Global
argument_list|,
name|Int_val
argument_list|(
name|Bytes
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on uses .................................................--*/
end_comment

begin_comment
comment|/* llvalue -> lluse option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_use_begin
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|LLVMUseRef
name|First
decl_stmt|;
if|if
condition|(
operator|(
name|First
operator|=
name|LLVMGetFirstUse
argument_list|(
name|Val
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|First
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lluse -> lluse option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_use_succ
parameter_list|(
name|LLVMUseRef
name|U
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|LLVMUseRef
name|Next
decl_stmt|;
if|if
condition|(
operator|(
name|Next
operator|=
name|LLVMGetNextUse
argument_list|(
name|U
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|Next
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* lluse -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_user
parameter_list|(
name|LLVMUseRef
name|UR
parameter_list|)
block|{
return|return
name|LLVMGetUser
argument_list|(
name|UR
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lluse -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_used_value
parameter_list|(
name|LLVMUseRef
name|UR
parameter_list|)
block|{
return|return
name|LLVMGetUsedValue
argument_list|(
name|UR
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on global variables .....................................--*/
end_comment

begin_macro
name|DEFINE_ITERATORS
argument_list|(
argument|global
argument_list|,
argument|Global
argument_list|,
argument|LLVMModuleRef
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMGetGlobalParent
argument_list|)
end_macro

begin_comment
comment|/* lltype -> string -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_declare_global
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|GlobalVar
decl_stmt|;
if|if
condition|(
operator|(
name|GlobalVar
operator|=
name|LLVMGetNamedGlobal
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|LLVMGetElementType
argument_list|(
name|LLVMTypeOf
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
operator|!=
name|Ty
condition|)
return|return
name|LLVMConstBitCast
argument_list|(
name|GlobalVar
argument_list|,
name|LLVMPointerType
argument_list|(
name|Ty
argument_list|,
literal|0
argument_list|)
argument_list|)
return|;
return|return
name|GlobalVar
return|;
block|}
return|return
name|LLVMAddGlobal
argument_list|(
name|M
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> string -> int -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_declare_qualified_global
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|AddressSpace
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|GlobalVar
decl_stmt|;
if|if
condition|(
operator|(
name|GlobalVar
operator|=
name|LLVMGetNamedGlobal
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|LLVMGetElementType
argument_list|(
name|LLVMTypeOf
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
operator|!=
name|Ty
condition|)
return|return
name|LLVMConstBitCast
argument_list|(
name|GlobalVar
argument_list|,
name|LLVMPointerType
argument_list|(
name|Ty
argument_list|,
name|Int_val
argument_list|(
name|AddressSpace
argument_list|)
argument_list|)
argument_list|)
return|;
return|return
name|GlobalVar
return|;
block|}
return|return
name|LLVMAddGlobalInAddressSpace
argument_list|(
name|M
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|AddressSpace
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llmodule -> llvalue option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_lookup_global
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Name
argument_list|)
expr_stmt|;
name|LLVMValueRef
name|GlobalVar
decl_stmt|;
if|if
condition|(
operator|(
name|GlobalVar
operator|=
name|LLVMGetNamedGlobal
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|GlobalVar
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* string -> llvalue -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_define_global
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMValueRef
name|Initializer
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|GlobalVar
init|=
name|LLVMAddGlobal
argument_list|(
name|M
argument_list|,
name|LLVMTypeOf
argument_list|(
name|Initializer
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
decl_stmt|;
name|LLVMSetInitializer
argument_list|(
name|GlobalVar
argument_list|,
name|Initializer
argument_list|)
expr_stmt|;
return|return
name|GlobalVar
return|;
block|}
end_function

begin_comment
comment|/* string -> llvalue -> int -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_define_qualified_global
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMValueRef
name|Initializer
parameter_list|,
name|value
name|AddressSpace
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|GlobalVar
init|=
name|LLVMAddGlobalInAddressSpace
argument_list|(
name|M
argument_list|,
name|LLVMTypeOf
argument_list|(
name|Initializer
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|AddressSpace
argument_list|)
argument_list|)
decl_stmt|;
name|LLVMSetInitializer
argument_list|(
name|GlobalVar
argument_list|,
name|Initializer
argument_list|)
expr_stmt|;
return|return
name|GlobalVar
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_delete_global
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMDeleteGlobal
argument_list|(
name|GlobalVar
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_initializer
parameter_list|(
name|LLVMValueRef
name|ConstantVal
parameter_list|,
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetInitializer
argument_list|(
name|GlobalVar
argument_list|,
name|ConstantVal
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_remove_initializer
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetInitializer
argument_list|(
name|GlobalVar
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_thread_local
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsThreadLocal
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_thread_local
parameter_list|(
name|value
name|IsThreadLocal
parameter_list|,
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetThreadLocal
argument_list|(
name|GlobalVar
argument_list|,
name|Bool_val
argument_list|(
name|IsThreadLocal
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> ThreadLocalMode.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_thread_local_mode
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetThreadLocalMode
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* ThreadLocalMode.t -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_thread_local_mode
parameter_list|(
name|value
name|ThreadLocalMode
parameter_list|,
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetThreadLocalMode
argument_list|(
name|GlobalVar
argument_list|,
name|Int_val
argument_list|(
name|ThreadLocalMode
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_externally_initialized
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsExternallyInitialized
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_externally_initialized
parameter_list|(
name|value
name|IsExternallyInitialized
parameter_list|,
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetExternallyInitialized
argument_list|(
name|GlobalVar
argument_list|,
name|Bool_val
argument_list|(
name|IsExternallyInitialized
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_global_constant
parameter_list|(
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsGlobalConstant
argument_list|(
name|GlobalVar
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_global_constant
parameter_list|(
name|value
name|Flag
parameter_list|,
name|LLVMValueRef
name|GlobalVar
parameter_list|)
block|{
name|LLVMSetGlobalConstant
argument_list|(
name|GlobalVar
argument_list|,
name|Bool_val
argument_list|(
name|Flag
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on aliases ..............................................--*/
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_add_alias
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMValueRef
name|Aliasee
parameter_list|,
name|value
name|Name
parameter_list|)
block|{
return|return
name|LLVMAddAlias
argument_list|(
name|M
argument_list|,
name|Ty
argument_list|,
name|Aliasee
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on functions ............................................--*/
end_comment

begin_macro
name|DEFINE_ITERATORS
argument_list|(
argument|function
argument_list|,
argument|Function
argument_list|,
argument|LLVMModuleRef
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMGetGlobalParent
argument_list|)
end_macro

begin_comment
comment|/* string -> lltype -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_declare_function
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|Fn
decl_stmt|;
if|if
condition|(
operator|(
name|Fn
operator|=
name|LLVMGetNamedFunction
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|LLVMGetElementType
argument_list|(
name|LLVMTypeOf
argument_list|(
name|Fn
argument_list|)
argument_list|)
operator|!=
name|Ty
condition|)
return|return
name|LLVMConstBitCast
argument_list|(
name|Fn
argument_list|,
name|LLVMPointerType
argument_list|(
name|Ty
argument_list|,
literal|0
argument_list|)
argument_list|)
return|;
return|return
name|Fn
return|;
block|}
return|return
name|LLVMAddFunction
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|Ty
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llmodule -> llvalue option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_lookup_function
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Name
argument_list|)
expr_stmt|;
name|LLVMValueRef
name|Fn
decl_stmt|;
if|if
condition|(
operator|(
name|Fn
operator|=
name|LLVMGetNamedFunction
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|Fn
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* string -> lltype -> llmodule -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_define_function
parameter_list|(
name|value
name|Name
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMModuleRef
name|M
parameter_list|)
block|{
name|LLVMValueRef
name|Fn
init|=
name|LLVMAddFunction
argument_list|(
name|M
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|,
name|Ty
argument_list|)
decl_stmt|;
name|LLVMAppendBasicBlockInContext
argument_list|(
name|LLVMGetTypeContext
argument_list|(
name|Ty
argument_list|)
argument_list|,
name|Fn
argument_list|,
literal|"entry"
argument_list|)
expr_stmt|;
return|return
name|Fn
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_delete_function
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|LLVMDeleteFunction
argument_list|(
name|Fn
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_intrinsic
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMGetIntrinsicID
argument_list|(
name|Fn
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_function_call_conv
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetFunctionCallConv
argument_list|(
name|Fn
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_function_call_conv
parameter_list|(
name|value
name|Id
parameter_list|,
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|LLVMSetFunctionCallConv
argument_list|(
name|Fn
argument_list|,
name|Int_val
argument_list|(
name|Id
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_gc
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|GC
decl_stmt|;
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal2
argument_list|(
name|Name
argument_list|,
name|Option
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|GC
operator|=
name|LLVMGetGC
argument_list|(
name|Fn
argument_list|)
operator|)
condition|)
block|{
name|Name
operator|=
name|caml_copy_string
argument_list|(
name|GC
argument_list|)
expr_stmt|;
name|Option
operator|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|Name
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* string option -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_gc
parameter_list|(
name|value
name|GC
parameter_list|,
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|LLVMSetGC
argument_list|(
name|Fn
argument_list|,
name|GC
operator|==
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|?
literal|0
else|:
name|String_val
argument_list|(
name|Field
argument_list|(
name|GC
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_function_attr
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMAddFunctionAttr
argument_list|(
name|Arg
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> string -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_target_dependent_function_attr
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|A
parameter_list|,
name|value
name|V
parameter_list|)
block|{
name|LLVMAddTargetDependentFunctionAttr
argument_list|(
name|Arg
argument_list|,
name|String_val
argument_list|(
name|A
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|V
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int32 */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_function_attr
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLreturn
argument_list|(
name|caml_copy_int32
argument_list|(
name|LLVMGetFunctionAttr
argument_list|(
name|Fn
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_remove_function_attr
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMRemoveFunctionAttr
argument_list|(
name|Arg
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on parameters ...........................................--*/
end_comment

begin_macro
name|DEFINE_ITERATORS
argument_list|(
argument|param
argument_list|,
argument|Param
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMGetParamParent
argument_list|)
end_macro

begin_comment
comment|/* llvalue -> int -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_param
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|,
name|value
name|Index
parameter_list|)
block|{
return|return
name|LLVMGetParam
argument_list|(
name|Fn
argument_list|,
name|Int_val
argument_list|(
name|Index
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_param_attr
parameter_list|(
name|LLVMValueRef
name|Param
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLreturn
argument_list|(
name|caml_copy_int32
argument_list|(
name|LLVMGetAttribute
argument_list|(
name|Param
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_params
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|value
name|Params
init|=
name|alloc
argument_list|(
name|LLVMCountParams
argument_list|(
name|Fn
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|LLVMGetParams
argument_list|(
name|Fn
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Params
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Params
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_param_attr
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMAddAttribute
argument_list|(
name|Arg
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_remove_param_attr
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMRemoveAttribute
argument_list|(
name|Arg
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_param_alignment
parameter_list|(
name|LLVMValueRef
name|Arg
parameter_list|,
name|value
name|align
parameter_list|)
block|{
name|LLVMSetParamAlignment
argument_list|(
name|Arg
argument_list|,
name|Int_val
argument_list|(
name|align
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on basic blocks .........................................--*/
end_comment

begin_macro
name|DEFINE_ITERATORS
argument_list|(
argument|block
argument_list|,
argument|BasicBlock
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMBasicBlockRef
argument_list|,
argument|LLVMGetBasicBlockParent
argument_list|)
end_macro

begin_comment
comment|/* llbasicblock -> llvalue option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_block_terminator
parameter_list|(
name|LLVMBasicBlockRef
name|Block
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|LLVMValueRef
name|Term
init|=
name|LLVMGetBasicBlockTerminator
argument_list|(
name|Block
argument_list|)
decl_stmt|;
if|if
condition|(
name|Term
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|Term
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbasicblock array */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_basic_blocks
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
name|value
name|MLArray
init|=
name|alloc
argument_list|(
name|LLVMCountBasicBlocks
argument_list|(
name|Fn
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|LLVMGetBasicBlocks
argument_list|(
name|Fn
argument_list|,
operator|(
name|LLVMBasicBlockRef
operator|*
operator|)
name|Op_val
argument_list|(
name|MLArray
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|MLArray
return|;
block|}
end_function

begin_comment
comment|/* llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_delete_block
parameter_list|(
name|LLVMBasicBlockRef
name|BB
parameter_list|)
block|{
name|LLVMDeleteBasicBlock
argument_list|(
name|BB
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_remove_block
parameter_list|(
name|LLVMBasicBlockRef
name|BB
parameter_list|)
block|{
name|LLVMRemoveBasicBlockFromParent
argument_list|(
name|BB
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbasicblock -> llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_move_block_before
parameter_list|(
name|LLVMBasicBlockRef
name|Pos
parameter_list|,
name|LLVMBasicBlockRef
name|BB
parameter_list|)
block|{
name|LLVMMoveBasicBlockBefore
argument_list|(
name|BB
argument_list|,
name|Pos
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbasicblock -> llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_move_block_after
parameter_list|(
name|LLVMBasicBlockRef
name|Pos
parameter_list|,
name|LLVMBasicBlockRef
name|BB
parameter_list|)
block|{
name|LLVMMoveBasicBlockAfter
argument_list|(
name|BB
argument_list|,
name|Pos
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* string -> llvalue -> llbasicblock */
end_comment

begin_function
name|CAMLprim
name|LLVMBasicBlockRef
name|llvm_append_block
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|,
name|value
name|Name
parameter_list|,
name|LLVMValueRef
name|Fn
parameter_list|)
block|{
return|return
name|LLVMAppendBasicBlockInContext
argument_list|(
name|Context
argument_list|,
name|Fn
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> llbasicblock -> llbasicblock */
end_comment

begin_function
name|CAMLprim
name|LLVMBasicBlockRef
name|llvm_insert_block
parameter_list|(
name|LLVMContextRef
name|Context
parameter_list|,
name|value
name|Name
parameter_list|,
name|LLVMBasicBlockRef
name|BB
parameter_list|)
block|{
return|return
name|LLVMInsertBasicBlockInContext
argument_list|(
name|Context
argument_list|,
name|BB
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_value_is_block
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMValueIsBasicBlock
argument_list|(
name|Val
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on instructions .........................................--*/
end_comment

begin_macro
name|DEFINE_ITERATORS
argument_list|(
argument|instr
argument_list|,
argument|Instruction
argument_list|,
argument|LLVMBasicBlockRef
argument_list|,
argument|LLVMValueRef
argument_list|,
argument|LLVMGetInstructionParent
argument_list|)
end_macro

begin_comment
comment|/* llvalue -> Opcode.t */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_instr_get_opcode
parameter_list|(
name|LLVMValueRef
name|Inst
parameter_list|)
block|{
name|LLVMOpcode
name|o
decl_stmt|;
if|if
condition|(
operator|!
name|LLVMIsAInstruction
argument_list|(
name|Inst
argument_list|)
condition|)
name|failwith
argument_list|(
literal|"Not an instruction"
argument_list|)
expr_stmt|;
name|o
operator|=
name|LLVMGetInstructionOpcode
argument_list|(
name|Inst
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|o
operator|<=
name|LLVMLandingPad
argument_list|)
expr_stmt|;
return|return
name|Val_int
argument_list|(
name|o
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> ICmp.t option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_instr_icmp_predicate
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|int
name|x
init|=
name|LLVMGetICmpPredicate
argument_list|(
name|Val
argument_list|)
decl_stmt|;
if|if
condition|(
name|x
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|Val_int
argument_list|(
name|x
operator|-
name|LLVMIntEQ
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> FCmp.t option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_instr_fcmp_predicate
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|int
name|x
init|=
name|LLVMGetFCmpPredicate
argument_list|(
name|Val
argument_list|)
decl_stmt|;
if|if
condition|(
name|x
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
name|Val_int
argument_list|(
name|x
operator|-
name|LLVMRealPredicateFalse
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_instr_clone
parameter_list|(
name|LLVMValueRef
name|Inst
parameter_list|)
block|{
if|if
condition|(
operator|!
name|LLVMIsAInstruction
argument_list|(
name|Inst
argument_list|)
condition|)
name|failwith
argument_list|(
literal|"Not an instruction"
argument_list|)
expr_stmt|;
return|return
name|LLVMInstructionClone
argument_list|(
name|Inst
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on call sites ...........................................--*/
end_comment

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_instruction_call_conv
parameter_list|(
name|LLVMValueRef
name|Inst
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetInstructionCallConv
argument_list|(
name|Inst
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_instruction_call_conv
parameter_list|(
name|value
name|CC
parameter_list|,
name|LLVMValueRef
name|Inst
parameter_list|)
block|{
name|LLVMSetInstructionCallConv
argument_list|(
name|Inst
argument_list|,
name|Int_val
argument_list|(
name|CC
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_instruction_param_attr
parameter_list|(
name|LLVMValueRef
name|Instr
parameter_list|,
name|value
name|index
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMAddInstrAttribute
argument_list|(
name|Instr
argument_list|,
name|Int_val
argument_list|(
name|index
argument_list|)
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> int32 -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_remove_instruction_param_attr
parameter_list|(
name|LLVMValueRef
name|Instr
parameter_list|,
name|value
name|index
parameter_list|,
name|value
name|PA
parameter_list|)
block|{
name|LLVMRemoveInstrAttribute
argument_list|(
name|Instr
argument_list|,
name|Int_val
argument_list|(
name|index
argument_list|)
argument_list|,
name|Int32_val
argument_list|(
name|PA
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on call instructions (only) .............................--*/
end_comment

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_tail_call
parameter_list|(
name|LLVMValueRef
name|CallInst
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsTailCall
argument_list|(
name|CallInst
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_tail_call
parameter_list|(
name|value
name|IsTailCall
parameter_list|,
name|LLVMValueRef
name|CallInst
parameter_list|)
block|{
name|LLVMSetTailCall
argument_list|(
name|CallInst
argument_list|,
name|Bool_val
argument_list|(
name|IsTailCall
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on load/store instructions (only)........................--*/
end_comment

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_volatile
parameter_list|(
name|LLVMValueRef
name|MemoryInst
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMGetVolatile
argument_list|(
name|MemoryInst
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* bool -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_volatile
parameter_list|(
name|value
name|IsVolatile
parameter_list|,
name|LLVMValueRef
name|MemoryInst
parameter_list|)
block|{
name|LLVMSetVolatile
argument_list|(
name|MemoryInst
argument_list|,
name|Bool_val
argument_list|(
name|IsVolatile
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--.. Operations on terminators ...........................................--*/
end_comment

begin_comment
comment|/* llvalue -> int -> llbasicblock */
end_comment

begin_function
name|CAMLprim
name|LLVMBasicBlockRef
name|llvm_successor
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|,
name|value
name|I
parameter_list|)
block|{
return|return
name|LLVMGetSuccessor
argument_list|(
name|V
argument_list|,
name|Int_val
argument_list|(
name|I
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_successor
parameter_list|(
name|LLVMValueRef
name|U
parameter_list|,
name|value
name|I
parameter_list|,
name|LLVMBasicBlockRef
name|B
parameter_list|)
block|{
name|LLVMSetSuccessor
argument_list|(
name|U
argument_list|,
name|Int_val
argument_list|(
name|I
argument_list|)
argument_list|,
name|B
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_num_successors
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|)
block|{
return|return
name|Val_int
argument_list|(
name|LLVMGetNumSuccessors
argument_list|(
name|V
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--.. Operations on branch ................................................--*/
end_comment

begin_comment
comment|/* llvalue -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_condition
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|)
block|{
return|return
name|LLVMGetCondition
argument_list|(
name|V
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_condition
parameter_list|(
name|LLVMValueRef
name|B
parameter_list|,
name|LLVMValueRef
name|C
parameter_list|)
block|{
name|LLVMSetCondition
argument_list|(
name|B
argument_list|,
name|C
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_is_conditional
parameter_list|(
name|LLVMValueRef
name|V
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMIsConditional
argument_list|(
name|V
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Operations on phi nodes ............................................--*/
end_comment

begin_comment
comment|/* (llvalue * llbasicblock) -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_incoming
parameter_list|(
name|value
name|Incoming
parameter_list|,
name|LLVMValueRef
name|PhiNode
parameter_list|)
block|{
name|LLVMAddIncoming
argument_list|(
name|PhiNode
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
operator|&
name|Field
argument_list|(
name|Incoming
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|LLVMBasicBlockRef
operator|*
operator|)
operator|&
name|Field
argument_list|(
name|Incoming
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> (llvalue * llbasicblock) list */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_incoming
parameter_list|(
name|LLVMValueRef
name|PhiNode
parameter_list|)
block|{
name|unsigned
name|I
decl_stmt|;
name|CAMLparam0
argument_list|()
expr_stmt|;
name|CAMLlocal3
argument_list|(
name|Hd
argument_list|,
name|Tl
argument_list|,
name|Tmp
argument_list|)
expr_stmt|;
comment|/* Build a tuple list of them. */
name|Tl
operator|=
name|Val_int
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|I
operator|=
name|LLVMCountIncoming
argument_list|(
name|PhiNode
argument_list|)
init|;
name|I
operator|!=
literal|0
condition|;
control|)
block|{
name|Hd
operator|=
name|alloc
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|Hd
argument_list|,
literal|0
argument_list|,
operator|(
name|value
operator|)
name|LLVMGetIncomingValue
argument_list|(
name|PhiNode
argument_list|,
operator|--
name|I
argument_list|)
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|Hd
argument_list|,
literal|1
argument_list|,
operator|(
name|value
operator|)
name|LLVMGetIncomingBlock
argument_list|(
name|PhiNode
argument_list|,
name|I
argument_list|)
argument_list|)
expr_stmt|;
name|Tmp
operator|=
name|alloc
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|Tmp
argument_list|,
literal|0
argument_list|,
name|Hd
argument_list|)
expr_stmt|;
name|Store_field
argument_list|(
name|Tmp
argument_list|,
literal|1
argument_list|,
name|Tl
argument_list|)
expr_stmt|;
name|Tl
operator|=
name|Tmp
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Tl
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_delete_instruction
parameter_list|(
name|LLVMValueRef
name|Instruction
parameter_list|)
block|{
name|LLVMInstructionEraseFromParent
argument_list|(
name|Instruction
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*===-- Instruction builders ----------------------------------------------===*/
end_comment

begin_define
define|#
directive|define
name|Builder_val
parameter_list|(
name|v
parameter_list|)
value|(*(LLVMBuilderRef *)(Data_custom_val(v)))
end_define

begin_function
specifier|static
name|void
name|llvm_finalize_builder
parameter_list|(
name|value
name|B
parameter_list|)
block|{
name|LLVMDisposeBuilder
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
specifier|static
name|struct
name|custom_operations
name|builder_ops
init|=
block|{
operator|(
name|char
operator|*
operator|)
literal|"Llvm.llbuilder"
block|,
name|llvm_finalize_builder
block|,
name|custom_compare_default
block|,
name|custom_hash_default
block|,
name|custom_serialize_default
block|,
name|custom_deserialize_default
block|,
name|custom_compare_ext_default
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|value
name|alloc_builder
parameter_list|(
name|LLVMBuilderRef
name|B
parameter_list|)
block|{
name|value
name|V
init|=
name|alloc_custom
argument_list|(
operator|&
name|builder_ops
argument_list|,
sizeof|sizeof
argument_list|(
name|LLVMBuilderRef
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|Builder_val
argument_list|(
name|V
argument_list|)
operator|=
name|B
expr_stmt|;
return|return
name|V
return|;
block|}
end_function

begin_comment
comment|/* llcontext -> llbuilder */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_builder
parameter_list|(
name|LLVMContextRef
name|C
parameter_list|)
block|{
return|return
name|alloc_builder
argument_list|(
name|LLVMCreateBuilderInContext
argument_list|(
name|C
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* (llbasicblock, llvalue) llpos -> llbuilder -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_position_builder
parameter_list|(
name|value
name|Pos
parameter_list|,
name|value
name|B
parameter_list|)
block|{
if|if
condition|(
name|Tag_val
argument_list|(
name|Pos
argument_list|)
operator|==
literal|0
condition|)
block|{
name|LLVMBasicBlockRef
name|BB
init|=
operator|(
name|LLVMBasicBlockRef
operator|)
name|Op_val
argument_list|(
name|Field
argument_list|(
name|Pos
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|LLVMPositionBuilderAtEnd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|BB
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|LLVMValueRef
name|I
init|=
operator|(
name|LLVMValueRef
operator|)
name|Op_val
argument_list|(
name|Field
argument_list|(
name|Pos
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|LLVMPositionBuilderBefore
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|I
argument_list|)
expr_stmt|;
block|}
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbuilder -> llbasicblock */
end_comment

begin_function
name|CAMLprim
name|LLVMBasicBlockRef
name|llvm_insertion_block
parameter_list|(
name|value
name|B
parameter_list|)
block|{
name|LLVMBasicBlockRef
name|InsertBlock
init|=
name|LLVMGetInsertBlock
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|InsertBlock
condition|)
name|caml_raise_not_found
argument_list|()
expr_stmt|;
return|return
name|InsertBlock
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_insert_into_builder
parameter_list|(
name|LLVMValueRef
name|I
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
name|LLVMInsertIntoBuilderWithName
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|I
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Metadata ...........................................................--*/
end_comment

begin_comment
comment|/* llbuilder -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_current_debug_location
parameter_list|(
name|value
name|B
parameter_list|,
name|LLVMValueRef
name|V
parameter_list|)
block|{
name|LLVMSetCurrentDebugLocation
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|V
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbuilder -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_clear_current_debug_location
parameter_list|(
name|value
name|B
parameter_list|)
block|{
name|LLVMSetCurrentDebugLocation
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llbuilder -> llvalue option */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_current_debug_location
parameter_list|(
name|value
name|B
parameter_list|)
block|{
name|CAMLparam0
argument_list|()
expr_stmt|;
name|LLVMValueRef
name|L
decl_stmt|;
if|if
condition|(
operator|(
name|L
operator|=
name|LLVMGetCurrentDebugLocation
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|value
name|Option
init|=
name|alloc
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|Field
argument_list|(
name|Option
argument_list|,
literal|0
argument_list|)
operator|=
operator|(
name|value
operator|)
name|L
expr_stmt|;
name|CAMLreturn
argument_list|(
name|Option
argument_list|)
expr_stmt|;
block|}
name|CAMLreturn
argument_list|(
name|Val_int
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* llbuilder -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_inst_debug_location
parameter_list|(
name|value
name|B
parameter_list|,
name|LLVMValueRef
name|V
parameter_list|)
block|{
name|LLVMSetInstDebugLocation
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|V
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*--... Terminators ........................................................--*/
end_comment

begin_comment
comment|/* llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_ret_void
parameter_list|(
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildRetVoid
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_ret
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildRet
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Val
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue array -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_aggregate_ret
parameter_list|(
name|value
name|RetVals
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildAggregateRet
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|RetVals
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|RetVals
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llbasicblock -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_br
parameter_list|(
name|LLVMBasicBlockRef
name|BB
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildBr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|BB
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbasicblock -> llbasicblock -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_cond_br
parameter_list|(
name|LLVMValueRef
name|If
parameter_list|,
name|LLVMBasicBlockRef
name|Then
parameter_list|,
name|LLVMBasicBlockRef
name|Else
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildCondBr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|If
argument_list|,
name|Then
argument_list|,
name|Else
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbasicblock -> int -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_switch
parameter_list|(
name|LLVMValueRef
name|Of
parameter_list|,
name|LLVMBasicBlockRef
name|Else
parameter_list|,
name|value
name|EstimatedCount
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSwitch
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Of
argument_list|,
name|Else
argument_list|,
name|Int_val
argument_list|(
name|EstimatedCount
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_malloc
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildMalloc
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_array_malloc
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildArrayMalloc
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|Val
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_free
parameter_list|(
name|LLVMValueRef
name|P
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFree
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|P
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_case
parameter_list|(
name|LLVMValueRef
name|Switch
parameter_list|,
name|LLVMValueRef
name|OnVal
parameter_list|,
name|LLVMBasicBlockRef
name|Dest
parameter_list|)
block|{
name|LLVMAddCase
argument_list|(
name|Switch
argument_list|,
name|OnVal
argument_list|,
name|Dest
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbasicblock -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_indirect_br
parameter_list|(
name|LLVMValueRef
name|Addr
parameter_list|,
name|value
name|EstimatedDests
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildIndirectBr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Addr
argument_list|,
name|EstimatedDests
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llbasicblock -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_destination
parameter_list|(
name|LLVMValueRef
name|IndirectBr
parameter_list|,
name|LLVMBasicBlockRef
name|Dest
parameter_list|)
block|{
name|LLVMAddDestination
argument_list|(
name|IndirectBr
argument_list|,
name|Dest
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> llbasicblock -> llbasicblock -> string ->    llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_invoke_nat
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|,
name|value
name|Args
parameter_list|,
name|LLVMBasicBlockRef
name|Then
parameter_list|,
name|LLVMBasicBlockRef
name|Catch
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildInvoke
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Fn
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Args
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Args
argument_list|)
argument_list|,
name|Then
argument_list|,
name|Catch
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> llbasicblock -> llbasicblock -> string ->    llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_invoke_bc
parameter_list|(
name|value
name|Args
index|[]
parameter_list|,
name|int
name|NumArgs
parameter_list|)
block|{
return|return
name|llvm_build_invoke_nat
argument_list|(
operator|(
name|LLVMValueRef
operator|)
name|Args
index|[
literal|0
index|]
argument_list|,
name|Args
index|[
literal|1
index|]
argument_list|,
operator|(
name|LLVMBasicBlockRef
operator|)
name|Args
index|[
literal|2
index|]
argument_list|,
operator|(
name|LLVMBasicBlockRef
operator|)
name|Args
index|[
literal|3
index|]
argument_list|,
name|Args
index|[
literal|4
index|]
argument_list|,
name|Args
index|[
literal|5
index|]
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llvalue -> int -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_landingpad
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMValueRef
name|PersFn
parameter_list|,
name|value
name|NumClauses
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildLandingPad
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|PersFn
argument_list|,
name|Int_val
argument_list|(
name|NumClauses
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_add_clause
parameter_list|(
name|LLVMValueRef
name|LandingPadInst
parameter_list|,
name|LLVMValueRef
name|ClauseVal
parameter_list|)
block|{
name|LLVMAddClause
argument_list|(
name|LandingPadInst
argument_list|,
name|ClauseVal
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> bool -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_set_cleanup
parameter_list|(
name|LLVMValueRef
name|LandingPadInst
parameter_list|,
name|value
name|flag
parameter_list|)
block|{
name|LLVMSetCleanup
argument_list|(
name|LandingPadInst
argument_list|,
name|Bool_val
argument_list|(
name|flag
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_resume
parameter_list|(
name|LLVMValueRef
name|Exn
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildResume
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Exn
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_unreachable
parameter_list|(
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildUnreachable
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Arithmetic .........................................................--*/
end_comment

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_add
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildAdd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nsw_add
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNSWAdd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nuw_add
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNUWAdd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fadd
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFAdd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_sub
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSub
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nsw_sub
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNSWSub
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nuw_sub
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNUWSub
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fsub
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFSub
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_mul
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildMul
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nsw_mul
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNSWMul
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nuw_mul
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNUWMul
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fmul
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFMul
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_udiv
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildUDiv
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_sdiv
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSDiv
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_exact_sdiv
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildExactSDiv
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fdiv
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFDiv
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_urem
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildURem
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_srem
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSRem
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_frem
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFRem
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_shl
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildShl
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_lshr
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildLShr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_ashr
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildAShr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_and
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildAnd
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_or
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildOr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_xor
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildXor
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_neg
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNeg
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nsw_neg
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNSWNeg
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_nuw_neg
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNUWNeg
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fneg
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFNeg
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_not
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildNot
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Memory .............................................................--*/
end_comment

begin_comment
comment|/* lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_alloca
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildAlloca
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* lltype -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_array_alloca
parameter_list|(
name|LLVMTypeRef
name|Ty
parameter_list|,
name|LLVMValueRef
name|Size
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildArrayAlloca
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Ty
argument_list|,
name|Size
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_load
parameter_list|(
name|LLVMValueRef
name|Pointer
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildLoad
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Pointer
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_store
parameter_list|(
name|LLVMValueRef
name|Value
parameter_list|,
name|LLVMValueRef
name|Pointer
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildStore
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Value
argument_list|,
name|Pointer
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* AtomicRMWBinOp.t -> llvalue -> llvalue -> AtomicOrdering.t ->    bool -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_atomicrmw_native
parameter_list|(
name|value
name|BinOp
parameter_list|,
name|LLVMValueRef
name|Ptr
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Ord
parameter_list|,
name|value
name|ST
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
name|LLVMValueRef
name|Instr
decl_stmt|;
name|Instr
operator|=
name|LLVMBuildAtomicRMW
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|BinOp
argument_list|)
argument_list|,
name|Ptr
argument_list|,
name|Val
argument_list|,
name|Int_val
argument_list|(
name|Ord
argument_list|)
argument_list|,
name|Bool_val
argument_list|(
name|ST
argument_list|)
argument_list|)
expr_stmt|;
name|LLVMSetValueName
argument_list|(
name|Instr
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Instr
return|;
block|}
end_function

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_atomicrmw_bytecode
parameter_list|(
name|value
modifier|*
name|argv
parameter_list|,
name|int
name|argn
parameter_list|)
block|{
return|return
name|llvm_build_atomicrmw_native
argument_list|(
name|argv
index|[
literal|0
index|]
argument_list|,
operator|(
name|LLVMValueRef
operator|)
name|argv
index|[
literal|1
index|]
argument_list|,
operator|(
name|LLVMValueRef
operator|)
name|argv
index|[
literal|2
index|]
argument_list|,
name|argv
index|[
literal|3
index|]
argument_list|,
name|argv
index|[
literal|4
index|]
argument_list|,
name|argv
index|[
literal|5
index|]
argument_list|,
name|argv
index|[
literal|6
index|]
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_gep
parameter_list|(
name|LLVMValueRef
name|Pointer
parameter_list|,
name|value
name|Indices
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildGEP
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Pointer
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_in_bounds_gep
parameter_list|(
name|LLVMValueRef
name|Pointer
parameter_list|,
name|value
name|Indices
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildInBoundsGEP
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Pointer
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Indices
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_struct_gep
parameter_list|(
name|LLVMValueRef
name|Pointer
parameter_list|,
name|value
name|Index
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildStructGEP
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Pointer
argument_list|,
name|Int_val
argument_list|(
name|Index
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_global_string
parameter_list|(
name|value
name|Str
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildGlobalString
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* string -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_global_stringptr
parameter_list|(
name|value
name|Str
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildGlobalStringPtr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Str
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Casts ..............................................................--*/
end_comment

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_trunc
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildTrunc
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_zext
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildZExt
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_sext
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSExt
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fptoui
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFPToUI
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fptosi
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFPToSI
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_uitofp
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildUIToFP
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_sitofp
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSIToFP
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fptrunc
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFPTrunc
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fpext
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFPExt
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_prttoint
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildPtrToInt
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_inttoptr
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildIntToPtr
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_bitcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildBitCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_zext_or_bitcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildZExtOrBitCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_sext_or_bitcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSExtOrBitCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_trunc_or_bitcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildTruncOrBitCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_pointercast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildPointerCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_intcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildIntCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fpcast
parameter_list|(
name|LLVMValueRef
name|X
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFPCast
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|X
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Comparisons ........................................................--*/
end_comment

begin_comment
comment|/* Icmp.t -> llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_icmp
parameter_list|(
name|value
name|Pred
parameter_list|,
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildICmp
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|Pred
argument_list|)
operator|+
name|LLVMIntEQ
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* Fcmp.t -> llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_fcmp
parameter_list|(
name|value
name|Pred
parameter_list|,
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildFCmp
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Int_val
argument_list|(
name|Pred
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*--... Miscellaneous instructions .........................................--*/
end_comment

begin_comment
comment|/* (llvalue * llbasicblock) list -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_phi
parameter_list|(
name|value
name|Incoming
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
name|value
name|Hd
decl_stmt|,
name|Tl
decl_stmt|;
name|LLVMValueRef
name|FirstValue
decl_stmt|,
name|PhiNode
decl_stmt|;
name|assert
argument_list|(
name|Incoming
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
operator|&&
literal|"Empty list passed to Llvm.build_phi!"
argument_list|)
expr_stmt|;
name|Hd
operator|=
name|Field
argument_list|(
name|Incoming
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|FirstValue
operator|=
operator|(
name|LLVMValueRef
operator|)
name|Field
argument_list|(
name|Hd
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|PhiNode
operator|=
name|LLVMBuildPhi
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LLVMTypeOf
argument_list|(
name|FirstValue
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Tl
operator|=
name|Incoming
init|;
name|Tl
operator|!=
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|;
name|Tl
operator|=
name|Field
argument_list|(
name|Tl
argument_list|,
literal|1
argument_list|)
control|)
block|{
name|value
name|Hd
init|=
name|Field
argument_list|(
name|Tl
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|LLVMAddIncoming
argument_list|(
name|PhiNode
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
operator|&
name|Field
argument_list|(
name|Hd
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|LLVMBasicBlockRef
operator|*
operator|)
operator|&
name|Field
argument_list|(
name|Hd
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
return|return
name|PhiNode
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue array -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_call
parameter_list|(
name|LLVMValueRef
name|Fn
parameter_list|,
name|value
name|Params
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildCall
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Fn
argument_list|,
operator|(
name|LLVMValueRef
operator|*
operator|)
name|Op_val
argument_list|(
name|Params
argument_list|)
argument_list|,
name|Wosize_val
argument_list|(
name|Params
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_select
parameter_list|(
name|LLVMValueRef
name|If
parameter_list|,
name|LLVMValueRef
name|Then
parameter_list|,
name|LLVMValueRef
name|Else
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildSelect
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|If
argument_list|,
name|Then
argument_list|,
name|Else
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> lltype -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_va_arg
parameter_list|(
name|LLVMValueRef
name|List
parameter_list|,
name|LLVMTypeRef
name|Ty
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildVAArg
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|List
argument_list|,
name|Ty
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_extractelement
parameter_list|(
name|LLVMValueRef
name|Vec
parameter_list|,
name|LLVMValueRef
name|Idx
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildExtractElement
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Vec
argument_list|,
name|Idx
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_insertelement
parameter_list|(
name|LLVMValueRef
name|Vec
parameter_list|,
name|LLVMValueRef
name|Element
parameter_list|,
name|LLVMValueRef
name|Idx
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildInsertElement
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Vec
argument_list|,
name|Element
argument_list|,
name|Idx
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_shufflevector
parameter_list|(
name|LLVMValueRef
name|V1
parameter_list|,
name|LLVMValueRef
name|V2
parameter_list|,
name|LLVMValueRef
name|Mask
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildShuffleVector
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|V1
argument_list|,
name|V2
argument_list|,
name|Mask
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> int -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_extractvalue
parameter_list|(
name|LLVMValueRef
name|Aggregate
parameter_list|,
name|value
name|Idx
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildExtractValue
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Aggregate
argument_list|,
name|Int_val
argument_list|(
name|Idx
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> int -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_insertvalue
parameter_list|(
name|LLVMValueRef
name|Aggregate
parameter_list|,
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Idx
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildInsertValue
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Aggregate
argument_list|,
name|Val
argument_list|,
name|Int_val
argument_list|(
name|Idx
argument_list|)
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_is_null
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildIsNull
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Val
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_is_not_null
parameter_list|(
name|LLVMValueRef
name|Val
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildIsNotNull
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|Val
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> llvalue -> string -> llbuilder -> llvalue */
end_comment

begin_function
name|CAMLprim
name|LLVMValueRef
name|llvm_build_ptrdiff
parameter_list|(
name|LLVMValueRef
name|LHS
parameter_list|,
name|LLVMValueRef
name|RHS
parameter_list|,
name|value
name|Name
parameter_list|,
name|value
name|B
parameter_list|)
block|{
return|return
name|LLVMBuildPtrDiff
argument_list|(
name|Builder_val
argument_list|(
name|B
argument_list|)
argument_list|,
name|LHS
argument_list|,
name|RHS
argument_list|,
name|String_val
argument_list|(
name|Name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*===-- Memory buffers ----------------------------------------------------===*/
end_comment

begin_comment
comment|/* string -> llmemorybuffer    raises IoError msg on error */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_memorybuffer_of_file
parameter_list|(
name|value
name|Path
parameter_list|)
block|{
name|CAMLparam1
argument_list|(
name|Path
argument_list|)
expr_stmt|;
name|char
modifier|*
name|Message
decl_stmt|;
name|LLVMMemoryBufferRef
name|MemBuf
decl_stmt|;
if|if
condition|(
name|LLVMCreateMemoryBufferWithContentsOfFile
argument_list|(
name|String_val
argument_list|(
name|Path
argument_list|)
argument_list|,
operator|&
name|MemBuf
argument_list|,
operator|&
name|Message
argument_list|)
condition|)
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm.IoError"
argument_list|)
argument_list|,
name|Message
argument_list|)
expr_stmt|;
name|CAMLreturn
argument_list|(
operator|(
name|value
operator|)
name|MemBuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* unit -> llmemorybuffer    raises IoError msg on error */
end_comment

begin_function
name|CAMLprim
name|LLVMMemoryBufferRef
name|llvm_memorybuffer_of_stdin
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
name|char
modifier|*
name|Message
decl_stmt|;
name|LLVMMemoryBufferRef
name|MemBuf
decl_stmt|;
if|if
condition|(
name|LLVMCreateMemoryBufferWithSTDIN
argument_list|(
operator|&
name|MemBuf
argument_list|,
operator|&
name|Message
argument_list|)
condition|)
name|llvm_raise
argument_list|(
operator|*
name|caml_named_value
argument_list|(
literal|"Llvm.IoError"
argument_list|)
argument_list|,
name|Message
argument_list|)
expr_stmt|;
return|return
name|MemBuf
return|;
block|}
end_function

begin_comment
comment|/* ?name:string -> string -> llmemorybuffer */
end_comment

begin_function
name|CAMLprim
name|LLVMMemoryBufferRef
name|llvm_memorybuffer_of_string
parameter_list|(
name|value
name|Name
parameter_list|,
name|value
name|String
parameter_list|)
block|{
name|LLVMMemoryBufferRef
name|MemBuf
decl_stmt|;
specifier|const
name|char
modifier|*
name|NameCStr
decl_stmt|;
if|if
condition|(
name|Name
operator|==
name|Val_int
argument_list|(
literal|0
argument_list|)
condition|)
name|NameCStr
operator|=
literal|""
expr_stmt|;
else|else
name|NameCStr
operator|=
name|String_val
argument_list|(
name|Field
argument_list|(
name|Name
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|MemBuf
operator|=
name|LLVMCreateMemoryBufferWithMemoryRangeCopy
argument_list|(
name|String_val
argument_list|(
name|String
argument_list|)
argument_list|,
name|caml_string_length
argument_list|(
name|String
argument_list|)
argument_list|,
name|NameCStr
argument_list|)
expr_stmt|;
return|return
name|MemBuf
return|;
block|}
end_function

begin_comment
comment|/* llmemorybuffer -> string */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_memorybuffer_as_string
parameter_list|(
name|LLVMMemoryBufferRef
name|MemBuf
parameter_list|)
block|{
name|value
name|String
init|=
name|caml_alloc_string
argument_list|(
name|LLVMGetBufferSize
argument_list|(
name|MemBuf
argument_list|)
argument_list|)
decl_stmt|;
name|memcpy
argument_list|(
name|String_val
argument_list|(
name|String
argument_list|)
argument_list|,
name|LLVMGetBufferStart
argument_list|(
name|MemBuf
argument_list|)
argument_list|,
name|LLVMGetBufferSize
argument_list|(
name|MemBuf
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|String
return|;
block|}
end_function

begin_comment
comment|/* llmemorybuffer -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_memorybuffer_dispose
parameter_list|(
name|LLVMMemoryBufferRef
name|MemBuf
parameter_list|)
block|{
name|LLVMDisposeMemoryBuffer
argument_list|(
name|MemBuf
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

begin_comment
comment|/*===-- Pass Managers -----------------------------------------------------===*/
end_comment

begin_comment
comment|/* unit -> [ `Module ] PassManager.t */
end_comment

begin_function
name|CAMLprim
name|LLVMPassManagerRef
name|llvm_passmanager_create
parameter_list|(
name|value
name|Unit
parameter_list|)
block|{
return|return
name|LLVMCreatePassManager
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/* llmodule -> [ `Function ] PassManager.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_passmanager_run_module
parameter_list|(
name|LLVMModuleRef
name|M
parameter_list|,
name|LLVMPassManagerRef
name|PM
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMRunPassManager
argument_list|(
name|PM
argument_list|,
name|M
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* [ `Function ] PassManager.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_passmanager_initialize
parameter_list|(
name|LLVMPassManagerRef
name|FPM
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMInitializeFunctionPassManager
argument_list|(
name|FPM
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* llvalue -> [ `Function ] PassManager.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_passmanager_run_function
parameter_list|(
name|LLVMValueRef
name|F
parameter_list|,
name|LLVMPassManagerRef
name|FPM
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMRunFunctionPassManager
argument_list|(
name|FPM
argument_list|,
name|F
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* [ `Function ] PassManager.t -> bool */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_passmanager_finalize
parameter_list|(
name|LLVMPassManagerRef
name|FPM
parameter_list|)
block|{
return|return
name|Val_bool
argument_list|(
name|LLVMFinalizeFunctionPassManager
argument_list|(
name|FPM
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* PassManager.any PassManager.t -> unit */
end_comment

begin_function
name|CAMLprim
name|value
name|llvm_passmanager_dispose
parameter_list|(
name|LLVMPassManagerRef
name|PM
parameter_list|)
block|{
name|LLVMDisposePassManager
argument_list|(
name|PM
argument_list|)
expr_stmt|;
return|return
name|Val_unit
return|;
block|}
end_function

end_unit

