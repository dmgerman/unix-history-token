begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"yaml_private.h"
end_include

begin_comment
comment|/*  * Flush the buffer if needed.  */
end_comment

begin_define
define|#
directive|define
name|FLUSH
parameter_list|(
name|emitter
parameter_list|)
define|\
value|((emitter->buffer.pointer+5< emitter->buffer.end)                          \      || yaml_emitter_flush(emitter))
end_define

begin_comment
comment|/*  * Put a character to the output buffer.  */
end_comment

begin_define
define|#
directive|define
name|PUT
parameter_list|(
name|emitter
parameter_list|,
name|value
parameter_list|)
define|\
value|(FLUSH(emitter)                                                             \&& (*(emitter->buffer.pointer++) = (yaml_char_t)(value),                   \          emitter->column ++,                                                    \          1))
end_define

begin_comment
comment|/*  * Put a line break to the output buffer.  */
end_comment

begin_define
define|#
directive|define
name|PUT_BREAK
parameter_list|(
name|emitter
parameter_list|)
define|\
value|(FLUSH(emitter)                                                             \&& ((emitter->line_break == YAML_CR_BREAK ?                                \              (*(emitter->buffer.pointer++) = (yaml_char_t) '\r') :              \           emitter->line_break == YAML_LN_BREAK ?                                \              (*(emitter->buffer.pointer++) = (yaml_char_t) '\n') :              \           emitter->line_break == YAML_CRLN_BREAK ?                              \              (*(emitter->buffer.pointer++) = (yaml_char_t) '\r',                \               *(emitter->buffer.pointer++) = (yaml_char_t) '\n') : 0),          \          emitter->column = 0,                                                   \          emitter->line ++,                                                      \          1))
end_define

begin_comment
comment|/*  * Copy a character from a string into buffer.  */
end_comment

begin_define
define|#
directive|define
name|WRITE
parameter_list|(
name|emitter
parameter_list|,
name|string
parameter_list|)
define|\
value|(FLUSH(emitter)                                                             \&& (COPY(emitter->buffer,string),                                          \          emitter->column ++,                                                    \          1))
end_define

begin_comment
comment|/*  * Copy a line break character from a string into buffer.  */
end_comment

begin_define
define|#
directive|define
name|WRITE_BREAK
parameter_list|(
name|emitter
parameter_list|,
name|string
parameter_list|)
define|\
value|(FLUSH(emitter)                                                             \&& (CHECK(string,'\n') ?                                                   \          (PUT_BREAK(emitter),                                                   \           string.pointer ++,                                                    \           1) :                                                                  \          (COPY(emitter->buffer,string),                                         \           emitter->column = 0,                                                  \           emitter->line ++,                                                     \           1)))
end_define

begin_comment
comment|/*  * API functions.  */
end_comment

begin_macro
name|YAML_DECLARE
argument_list|(
argument|int
argument_list|)
end_macro

begin_expr_stmt
name|yaml_emitter_emit
argument_list|(
name|yaml_emitter_t
operator|*
name|emitter
argument_list|,
name|yaml_event_t
operator|*
name|event
argument_list|)
expr_stmt|;
end_expr_stmt

begin_comment
comment|/*  * Utility functions.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_set_emitter_error
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
specifier|const
name|char
modifier|*
name|problem
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_need_more_events
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_append_tag_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_tag_directive_t
name|value
parameter_list|,
name|int
name|allow_duplicates
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_increase_indent
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|int
name|flow
parameter_list|,
name|int
name|indentless
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * State functions.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_state_machine
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_stream_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_document_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_document_content
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_document_end
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_flow_sequence_item
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_flow_mapping_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_flow_mapping_value
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|simple
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_block_sequence_item
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_block_mapping_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_block_mapping_value
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|simple
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_node
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|root
parameter_list|,
name|int
name|sequence
parameter_list|,
name|int
name|mapping
parameter_list|,
name|int
name|simple_key
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_alias
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_sequence_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_emit_mapping_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Checkers.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_check_empty_document
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_check_empty_sequence
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_check_empty_mapping
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_check_simple_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_select_scalar_style
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Processors.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_process_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_process_tag
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_process_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Analyzers.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_version_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_version_directive_t
name|version_directive
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_tag_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_tag_directive_t
name|tag_directive
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|anchor
parameter_list|,
name|int
name|alias
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_tag
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|tag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_analyze_event
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Writers.  */
end_comment

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_bom
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_indent
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_indicator
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|char
modifier|*
name|indicator
parameter_list|,
name|int
name|need_whitespace
parameter_list|,
name|int
name|is_whitespace
parameter_list|,
name|int
name|is_indention
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_tag_handle
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_tag_content
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|need_whitespace
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_plain_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_single_quoted_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_double_quoted_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_block_scalar_hints
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_string_t
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_literal_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|yaml_emitter_write_folded_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Set an emitter error and return 0.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_set_emitter_error
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
specifier|const
name|char
modifier|*
name|problem
parameter_list|)
block|{
name|emitter
operator|->
name|error
operator|=
name|YAML_EMITTER_ERROR
expr_stmt|;
name|emitter
operator|->
name|problem
operator|=
name|problem
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Emit an event.  */
end_comment

begin_macro
name|YAML_DECLARE
argument_list|(
argument|int
argument_list|)
end_macro

begin_macro
name|yaml_emitter_emit
argument_list|(
argument|yaml_emitter_t *emitter
argument_list|,
argument|yaml_event_t *event
argument_list|)
end_macro

begin_block
block|{
if|if
condition|(
operator|!
name|ENQUEUE
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|events
argument_list|,
operator|*
name|event
argument_list|)
condition|)
block|{
name|yaml_event_delete
argument_list|(
name|event
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
while|while
condition|(
operator|!
name|yaml_emitter_need_more_events
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_event
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|events
operator|.
name|head
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_state_machine
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|events
operator|.
name|head
argument_list|)
condition|)
return|return
literal|0
return|;
name|yaml_event_delete
argument_list|(
operator|&
name|DEQUEUE
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|events
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_block

begin_comment
comment|/*  * Check if we need to accumulate more events before emitting.  *  * We accumulate extra  *  - 1 event for DOCUMENT-START  *  - 2 events for SEQUENCE-START  *  - 3 events for MAPPING-START  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_need_more_events
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
name|int
name|level
init|=
literal|0
decl_stmt|;
name|int
name|accumulate
init|=
literal|0
decl_stmt|;
name|yaml_event_t
modifier|*
name|event
decl_stmt|;
if|if
condition|(
name|QUEUE_EMPTY
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|events
argument_list|)
condition|)
return|return
literal|1
return|;
switch|switch
condition|(
name|emitter
operator|->
name|events
operator|.
name|head
operator|->
name|type
condition|)
block|{
case|case
name|YAML_DOCUMENT_START_EVENT
case|:
name|accumulate
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|YAML_SEQUENCE_START_EVENT
case|:
name|accumulate
operator|=
literal|2
expr_stmt|;
break|break;
case|case
name|YAML_MAPPING_START_EVENT
case|:
name|accumulate
operator|=
literal|3
expr_stmt|;
break|break;
default|default:
return|return
literal|0
return|;
block|}
if|if
condition|(
name|emitter
operator|->
name|events
operator|.
name|tail
operator|-
name|emitter
operator|->
name|events
operator|.
name|head
operator|>
name|accumulate
condition|)
return|return
literal|0
return|;
for|for
control|(
name|event
operator|=
name|emitter
operator|->
name|events
operator|.
name|head
init|;
name|event
operator|!=
name|emitter
operator|->
name|events
operator|.
name|tail
condition|;
name|event
operator|++
control|)
block|{
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|YAML_STREAM_START_EVENT
case|:
case|case
name|YAML_DOCUMENT_START_EVENT
case|:
case|case
name|YAML_SEQUENCE_START_EVENT
case|:
case|case
name|YAML_MAPPING_START_EVENT
case|:
name|level
operator|+=
literal|1
expr_stmt|;
break|break;
case|case
name|YAML_STREAM_END_EVENT
case|:
case|case
name|YAML_DOCUMENT_END_EVENT
case|:
case|case
name|YAML_SEQUENCE_END_EVENT
case|:
case|case
name|YAML_MAPPING_END_EVENT
case|:
name|level
operator|-=
literal|1
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
operator|!
name|level
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Append a directive to the directives stack.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_append_tag_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_tag_directive_t
name|value
parameter_list|,
name|int
name|allow_duplicates
parameter_list|)
block|{
name|yaml_tag_directive_t
modifier|*
name|tag_directive
decl_stmt|;
name|yaml_tag_directive_t
name|copy
init|=
block|{
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
for|for
control|(
name|tag_directive
operator|=
name|emitter
operator|->
name|tag_directives
operator|.
name|start
init|;
name|tag_directive
operator|!=
name|emitter
operator|->
name|tag_directives
operator|.
name|top
condition|;
name|tag_directive
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|value
operator|.
name|handle
argument_list|,
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|handle
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|allow_duplicates
condition|)
return|return
literal|1
return|;
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"duplicate %TAG directive"
argument_list|)
return|;
block|}
block|}
name|copy
operator|.
name|handle
operator|=
name|yaml_strdup
argument_list|(
name|value
operator|.
name|handle
argument_list|)
expr_stmt|;
name|copy
operator|.
name|prefix
operator|=
name|yaml_strdup
argument_list|(
name|value
operator|.
name|prefix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|copy
operator|.
name|handle
operator|||
operator|!
name|copy
operator|.
name|prefix
condition|)
block|{
name|emitter
operator|->
name|error
operator|=
name|YAML_MEMORY_ERROR
expr_stmt|;
goto|goto
name|error
goto|;
block|}
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_directives
argument_list|,
name|copy
argument_list|)
condition|)
goto|goto
name|error
goto|;
return|return
literal|1
return|;
name|error
label|:
name|yaml_free
argument_list|(
name|copy
operator|.
name|handle
argument_list|)
expr_stmt|;
name|yaml_free
argument_list|(
name|copy
operator|.
name|prefix
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Increase the indentation level.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_increase_indent
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|int
name|flow
parameter_list|,
name|int
name|indentless
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|,
name|emitter
operator|->
name|indent
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|emitter
operator|->
name|indent
operator|<
literal|0
condition|)
block|{
name|emitter
operator|->
name|indent
operator|=
name|flow
condition|?
name|emitter
operator|->
name|best_indent
else|:
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|indentless
condition|)
block|{
name|emitter
operator|->
name|indent
operator|+=
name|emitter
operator|->
name|best_indent
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * State dispatcher.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_state_machine
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
switch|switch
condition|(
name|emitter
operator|->
name|state
condition|)
block|{
case|case
name|YAML_EMIT_STREAM_START_STATE
case|:
return|return
name|yaml_emitter_emit_stream_start
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_EMIT_FIRST_DOCUMENT_START_STATE
case|:
return|return
name|yaml_emitter_emit_document_start
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_DOCUMENT_START_STATE
case|:
return|return
name|yaml_emitter_emit_document_start
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_DOCUMENT_CONTENT_STATE
case|:
return|return
name|yaml_emitter_emit_document_content
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_EMIT_DOCUMENT_END_STATE
case|:
return|return
name|yaml_emitter_emit_document_end
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_SEQUENCE_FIRST_ITEM_STATE
case|:
return|return
name|yaml_emitter_emit_flow_sequence_item
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_SEQUENCE_ITEM_STATE
case|:
return|return
name|yaml_emitter_emit_flow_sequence_item
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_MAPPING_FIRST_KEY_STATE
case|:
return|return
name|yaml_emitter_emit_flow_mapping_key
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_MAPPING_KEY_STATE
case|:
return|return
name|yaml_emitter_emit_flow_mapping_key
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_MAPPING_SIMPLE_VALUE_STATE
case|:
return|return
name|yaml_emitter_emit_flow_mapping_value
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_FLOW_MAPPING_VALUE_STATE
case|:
return|return
name|yaml_emitter_emit_flow_mapping_value
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_SEQUENCE_FIRST_ITEM_STATE
case|:
return|return
name|yaml_emitter_emit_block_sequence_item
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_SEQUENCE_ITEM_STATE
case|:
return|return
name|yaml_emitter_emit_block_sequence_item
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_MAPPING_FIRST_KEY_STATE
case|:
return|return
name|yaml_emitter_emit_block_mapping_key
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_MAPPING_KEY_STATE
case|:
return|return
name|yaml_emitter_emit_block_mapping_key
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_MAPPING_SIMPLE_VALUE_STATE
case|:
return|return
name|yaml_emitter_emit_block_mapping_value
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|)
return|;
case|case
name|YAML_EMIT_BLOCK_MAPPING_VALUE_STATE
case|:
return|return
name|yaml_emitter_emit_block_mapping_value
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|)
return|;
case|case
name|YAML_EMIT_END_STATE
case|:
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"expected nothing after STREAM-END"
argument_list|)
return|;
default|default:
name|assert
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Invalid state. */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Expect STREAM-START.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_stream_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_STREAM_START_EVENT
condition|)
block|{
if|if
condition|(
operator|!
name|emitter
operator|->
name|encoding
condition|)
block|{
name|emitter
operator|->
name|encoding
operator|=
name|event
operator|->
name|data
operator|.
name|stream_start
operator|.
name|encoding
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|emitter
operator|->
name|encoding
condition|)
block|{
name|emitter
operator|->
name|encoding
operator|=
name|YAML_UTF8_ENCODING
expr_stmt|;
block|}
if|if
condition|(
name|emitter
operator|->
name|best_indent
operator|<
literal|2
operator|||
name|emitter
operator|->
name|best_indent
operator|>
literal|9
condition|)
block|{
name|emitter
operator|->
name|best_indent
operator|=
literal|2
expr_stmt|;
block|}
if|if
condition|(
name|emitter
operator|->
name|best_width
operator|>=
literal|0
operator|&&
name|emitter
operator|->
name|best_width
operator|<=
name|emitter
operator|->
name|best_indent
operator|*
literal|2
condition|)
block|{
name|emitter
operator|->
name|best_width
operator|=
literal|80
expr_stmt|;
block|}
if|if
condition|(
name|emitter
operator|->
name|best_width
operator|<
literal|0
condition|)
block|{
name|emitter
operator|->
name|best_width
operator|=
name|INT_MAX
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|emitter
operator|->
name|line_break
condition|)
block|{
name|emitter
operator|->
name|line_break
operator|=
name|YAML_LN_BREAK
expr_stmt|;
block|}
name|emitter
operator|->
name|indent
operator|=
operator|-
literal|1
expr_stmt|;
name|emitter
operator|->
name|line
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|column
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|whitespace
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|encoding
operator|!=
name|YAML_UTF8_ENCODING
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_bom
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_FIRST_DOCUMENT_START_STATE
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"expected STREAM-START"
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect DOCUMENT-START or STREAM-END.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_document_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_DOCUMENT_START_EVENT
condition|)
block|{
name|yaml_tag_directive_t
name|default_tag_directives
index|[]
init|=
block|{
block|{
operator|(
name|yaml_char_t
operator|*
operator|)
literal|"!"
block|,
operator|(
name|yaml_char_t
operator|*
operator|)
literal|"!"
block|}
block|,
block|{
operator|(
name|yaml_char_t
operator|*
operator|)
literal|"!!"
block|,
operator|(
name|yaml_char_t
operator|*
operator|)
literal|"tag:yaml.org,2002:"
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
name|yaml_tag_directive_t
modifier|*
name|tag_directive
decl_stmt|;
name|int
name|implicit
decl_stmt|;
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|version_directive
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_version_directive
argument_list|(
name|emitter
argument_list|,
operator|*
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|version_directive
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
for|for
control|(
name|tag_directive
operator|=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|start
init|;
name|tag_directive
operator|!=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|end
condition|;
name|tag_directive
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_tag_directive
argument_list|(
name|emitter
argument_list|,
operator|*
name|tag_directive
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_append_tag_directive
argument_list|(
name|emitter
argument_list|,
operator|*
name|tag_directive
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
for|for
control|(
name|tag_directive
operator|=
name|default_tag_directives
init|;
name|tag_directive
operator|->
name|handle
condition|;
name|tag_directive
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_append_tag_directive
argument_list|(
name|emitter
argument_list|,
operator|*
name|tag_directive
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|implicit
operator|=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|implicit
expr_stmt|;
if|if
condition|(
operator|!
name|first
operator|||
name|emitter
operator|->
name|canonical
condition|)
block|{
name|implicit
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|version_directive
operator|||
operator|(
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|start
operator|!=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|end
operator|)
operator|)
operator|&&
name|emitter
operator|->
name|open_ended
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"..."
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|version_directive
condition|)
block|{
name|implicit
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"%YAML"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"1.1"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|start
operator|!=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|end
condition|)
block|{
name|implicit
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|tag_directive
operator|=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|start
init|;
name|tag_directive
operator|!=
name|event
operator|->
name|data
operator|.
name|document_start
operator|.
name|tag_directives
operator|.
name|end
condition|;
name|tag_directive
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"%TAG"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_tag_handle
argument_list|(
name|emitter
argument_list|,
name|tag_directive
operator|->
name|handle
argument_list|,
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|handle
argument_list|)
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_tag_content
argument_list|(
name|emitter
argument_list|,
name|tag_directive
operator|->
name|prefix
argument_list|,
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|prefix
argument_list|)
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
if|if
condition|(
name|yaml_emitter_check_empty_document
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
name|implicit
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|implicit
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"---"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|emitter
operator|->
name|canonical
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_DOCUMENT_CONTENT_STATE
expr_stmt|;
return|return
literal|1
return|;
block|}
elseif|else
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_STREAM_END_EVENT
condition|)
block|{
if|if
condition|(
name|emitter
operator|->
name|open_ended
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"..."
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_flush
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_END_STATE
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"expected DOCUMENT-START or STREAM-END"
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect the root node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_document_content
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_DOCUMENT_END_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect DOCUMENT-END.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_document_end
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_DOCUMENT_END_EVENT
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|event
operator|->
name|data
operator|.
name|document_end
operator|.
name|implicit
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"..."
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_flush
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_DOCUMENT_START_STATE
expr_stmt|;
while|while
condition|(
operator|!
name|STACK_EMPTY
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_directives
argument_list|)
condition|)
block|{
name|yaml_tag_directive_t
name|tag_directive
init|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_directives
argument_list|)
decl_stmt|;
name|yaml_free
argument_list|(
name|tag_directive
operator|.
name|handle
argument_list|)
expr_stmt|;
name|yaml_free
argument_list|(
name|tag_directive
operator|.
name|prefix
argument_list|)
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"expected DOCUMENT-END"
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  *   * Expect a flow item node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_flow_sequence_item
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
block|{
if|if
condition|(
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"["
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_increase_indent
argument_list|(
name|emitter
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|flow_level
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_SEQUENCE_END_EVENT
condition|)
block|{
name|emitter
operator|->
name|flow_level
operator|--
expr_stmt|;
name|emitter
operator|->
name|indent
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|)
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|canonical
operator|&&
operator|!
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|","
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"]"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|","
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|emitter
operator|->
name|canonical
operator|||
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_FLOW_SEQUENCE_ITEM_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect a flow key node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_flow_mapping_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
block|{
if|if
condition|(
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"{"
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_increase_indent
argument_list|(
name|emitter
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|flow_level
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_MAPPING_END_EVENT
condition|)
block|{
name|emitter
operator|->
name|flow_level
operator|--
expr_stmt|;
name|emitter
operator|->
name|indent
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|)
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|canonical
operator|&&
operator|!
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|","
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"}"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|","
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|emitter
operator|->
name|canonical
operator|||
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|emitter
operator|->
name|canonical
operator|&&
name|yaml_emitter_check_simple_key
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_FLOW_MAPPING_SIMPLE_VALUE_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
return|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"?"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_FLOW_MAPPING_VALUE_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Expect a flow value node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_flow_mapping_value
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|simple
parameter_list|)
block|{
if|if
condition|(
name|simple
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|":"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
else|else
block|{
if|if
condition|(
name|emitter
operator|->
name|canonical
operator|||
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|":"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_FLOW_MAPPING_KEY_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect a block item node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_block_sequence_item
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
block|{
if|if
condition|(
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_increase_indent
argument_list|(
name|emitter
argument_list|,
literal|0
argument_list|,
operator|(
name|emitter
operator|->
name|mapping_context
operator|&&
operator|!
name|emitter
operator|->
name|indention
operator|)
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_SEQUENCE_END_EVENT
condition|)
block|{
name|emitter
operator|->
name|indent
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|)
expr_stmt|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"-"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_BLOCK_SEQUENCE_ITEM_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect a block key node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_block_mapping_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|first
parameter_list|)
block|{
if|if
condition|(
name|first
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_increase_indent
argument_list|(
name|emitter
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|YAML_MAPPING_END_EVENT
condition|)
block|{
name|emitter
operator|->
name|indent
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|)
expr_stmt|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|yaml_emitter_check_simple_key
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_BLOCK_MAPPING_SIMPLE_VALUE_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
return|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"?"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_BLOCK_MAPPING_VALUE_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Expect a block value node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_block_mapping_value
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|simple
parameter_list|)
block|{
if|if
condition|(
name|simple
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|":"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|":"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|PUSH
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|,
name|YAML_EMIT_BLOCK_MAPPING_KEY_STATE
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_emit_node
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Expect a node.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_node
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|,
name|int
name|root
parameter_list|,
name|int
name|sequence
parameter_list|,
name|int
name|mapping
parameter_list|,
name|int
name|simple_key
parameter_list|)
block|{
name|emitter
operator|->
name|root_context
operator|=
name|root
expr_stmt|;
name|emitter
operator|->
name|sequence_context
operator|=
name|sequence
expr_stmt|;
name|emitter
operator|->
name|mapping_context
operator|=
name|mapping
expr_stmt|;
name|emitter
operator|->
name|simple_key_context
operator|=
name|simple_key
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|YAML_ALIAS_EVENT
case|:
return|return
name|yaml_emitter_emit_alias
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_SCALAR_EVENT
case|:
return|return
name|yaml_emitter_emit_scalar
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_SEQUENCE_START_EVENT
case|:
return|return
name|yaml_emitter_emit_sequence_start
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
case|case
name|YAML_MAPPING_START_EVENT
case|:
return|return
name|yaml_emitter_emit_mapping_start
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
return|;
default|default:
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"expected SCALAR, SEQUENCE-START, MAPPING-START, or ALIAS"
argument_list|)
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Expect ALIAS.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_alias
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_process_anchor
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Expect SCALAR.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_select_scalar_style
argument_list|(
name|emitter
argument_list|,
name|event
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_process_anchor
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_process_tag
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_increase_indent
argument_list|(
name|emitter
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_process_scalar
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indent
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|indents
argument_list|)
expr_stmt|;
name|emitter
operator|->
name|state
operator|=
name|POP
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|states
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Expect SEQUENCE-START.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_sequence_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_process_anchor
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_process_tag
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|emitter
operator|->
name|flow_level
operator|||
name|emitter
operator|->
name|canonical
operator|||
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|style
operator|==
name|YAML_FLOW_SEQUENCE_STYLE
operator|||
name|yaml_emitter_check_empty_sequence
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_FLOW_SEQUENCE_FIRST_ITEM_STATE
expr_stmt|;
block|}
else|else
block|{
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_BLOCK_SEQUENCE_FIRST_ITEM_STATE
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Expect MAPPING-START.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_emit_mapping_start
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_process_anchor
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_process_tag
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|emitter
operator|->
name|flow_level
operator|||
name|emitter
operator|->
name|canonical
operator|||
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|style
operator|==
name|YAML_FLOW_MAPPING_STYLE
operator|||
name|yaml_emitter_check_empty_mapping
argument_list|(
name|emitter
argument_list|)
condition|)
block|{
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_FLOW_MAPPING_FIRST_KEY_STATE
expr_stmt|;
block|}
else|else
block|{
name|emitter
operator|->
name|state
operator|=
name|YAML_EMIT_BLOCK_MAPPING_FIRST_KEY_STATE
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if the document content is an empty scalar.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_check_empty_document
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Check if the next events represent an empty sequence.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_check_empty_sequence
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
if|if
condition|(
name|emitter
operator|->
name|events
operator|.
name|tail
operator|-
name|emitter
operator|->
name|events
operator|.
name|head
operator|<
literal|2
condition|)
return|return
literal|0
return|;
return|return
operator|(
name|emitter
operator|->
name|events
operator|.
name|head
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|YAML_SEQUENCE_START_EVENT
operator|&&
name|emitter
operator|->
name|events
operator|.
name|head
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|YAML_SEQUENCE_END_EVENT
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Check if the next events represent an empty mapping.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_check_empty_mapping
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
if|if
condition|(
name|emitter
operator|->
name|events
operator|.
name|tail
operator|-
name|emitter
operator|->
name|events
operator|.
name|head
operator|<
literal|2
condition|)
return|return
literal|0
return|;
return|return
operator|(
name|emitter
operator|->
name|events
operator|.
name|head
index|[
literal|0
index|]
operator|.
name|type
operator|==
name|YAML_MAPPING_START_EVENT
operator|&&
name|emitter
operator|->
name|events
operator|.
name|head
index|[
literal|1
index|]
operator|.
name|type
operator|==
name|YAML_MAPPING_END_EVENT
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Check if the next node can be expressed as a simple key.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_check_simple_key
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
name|yaml_event_t
modifier|*
name|event
init|=
name|emitter
operator|->
name|events
operator|.
name|head
decl_stmt|;
name|size_t
name|length
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|YAML_ALIAS_EVENT
case|:
name|length
operator|+=
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
expr_stmt|;
break|break;
case|case
name|YAML_SCALAR_EVENT
case|:
if|if
condition|(
name|emitter
operator|->
name|scalar_data
operator|.
name|multiline
condition|)
return|return
literal|0
return|;
name|length
operator|+=
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
operator|+
name|emitter
operator|->
name|scalar_data
operator|.
name|length
expr_stmt|;
break|break;
case|case
name|YAML_SEQUENCE_START_EVENT
case|:
if|if
condition|(
operator|!
name|yaml_emitter_check_empty_sequence
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|length
operator|+=
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
expr_stmt|;
break|break;
case|case
name|YAML_MAPPING_START_EVENT
case|:
if|if
condition|(
operator|!
name|yaml_emitter_check_empty_mapping
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|length
operator|+=
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|+
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
expr_stmt|;
break|break;
default|default:
return|return
literal|0
return|;
block|}
if|if
condition|(
name|length
operator|>
literal|128
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Determine an acceptable scalar style.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_select_scalar_style
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
name|yaml_scalar_style_t
name|style
init|=
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|style
decl_stmt|;
name|int
name|no_tag
init|=
operator|(
operator|!
name|emitter
operator|->
name|tag_data
operator|.
name|handle
operator|&&
operator|!
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
operator|)
decl_stmt|;
if|if
condition|(
name|no_tag
operator|&&
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|plain_implicit
operator|&&
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|quoted_implicit
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"neither tag nor implicit flags are specified"
argument_list|)
return|;
block|}
if|if
condition|(
name|style
operator|==
name|YAML_ANY_SCALAR_STYLE
condition|)
name|style
operator|=
name|YAML_PLAIN_SCALAR_STYLE
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|canonical
condition|)
name|style
operator|=
name|YAML_DOUBLE_QUOTED_SCALAR_STYLE
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|simple_key_context
operator|&&
name|emitter
operator|->
name|scalar_data
operator|.
name|multiline
condition|)
name|style
operator|=
name|YAML_DOUBLE_QUOTED_SCALAR_STYLE
expr_stmt|;
if|if
condition|(
name|style
operator|==
name|YAML_PLAIN_SCALAR_STYLE
condition|)
block|{
if|if
condition|(
operator|(
name|emitter
operator|->
name|flow_level
operator|&&
operator|!
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|)
operator|||
operator|(
operator|!
name|emitter
operator|->
name|flow_level
operator|&&
operator|!
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|)
condition|)
name|style
operator|=
name|YAML_SINGLE_QUOTED_SCALAR_STYLE
expr_stmt|;
if|if
condition|(
operator|!
name|emitter
operator|->
name|scalar_data
operator|.
name|length
operator|&&
operator|(
name|emitter
operator|->
name|flow_level
operator|||
name|emitter
operator|->
name|simple_key_context
operator|)
condition|)
name|style
operator|=
name|YAML_SINGLE_QUOTED_SCALAR_STYLE
expr_stmt|;
if|if
condition|(
name|no_tag
operator|&&
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|plain_implicit
condition|)
name|style
operator|=
name|YAML_SINGLE_QUOTED_SCALAR_STYLE
expr_stmt|;
block|}
if|if
condition|(
name|style
operator|==
name|YAML_SINGLE_QUOTED_SCALAR_STYLE
condition|)
block|{
if|if
condition|(
operator|!
name|emitter
operator|->
name|scalar_data
operator|.
name|single_quoted_allowed
condition|)
name|style
operator|=
name|YAML_DOUBLE_QUOTED_SCALAR_STYLE
expr_stmt|;
block|}
if|if
condition|(
name|style
operator|==
name|YAML_LITERAL_SCALAR_STYLE
operator|||
name|style
operator|==
name|YAML_FOLDED_SCALAR_STYLE
condition|)
block|{
if|if
condition|(
operator|!
name|emitter
operator|->
name|scalar_data
operator|.
name|block_allowed
operator|||
name|emitter
operator|->
name|flow_level
operator|||
name|emitter
operator|->
name|simple_key_context
condition|)
name|style
operator|=
name|YAML_DOUBLE_QUOTED_SCALAR_STYLE
expr_stmt|;
block|}
if|if
condition|(
name|no_tag
operator|&&
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|quoted_implicit
operator|&&
name|style
operator|!=
name|YAML_PLAIN_SCALAR_STYLE
condition|)
block|{
name|emitter
operator|->
name|tag_data
operator|.
name|handle
operator|=
operator|(
name|yaml_char_t
operator|*
operator|)
literal|"!"
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|=
literal|1
expr_stmt|;
block|}
name|emitter
operator|->
name|scalar_data
operator|.
name|style
operator|=
name|style
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Write an achor.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_process_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
if|if
condition|(
operator|!
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor
condition|)
return|return
literal|1
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
operator|(
name|emitter
operator|->
name|anchor_data
operator|.
name|alias
condition|?
literal|"*"
else|:
literal|"&"
operator|)
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
name|yaml_emitter_write_anchor
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor
argument_list|,
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  * Write a tag.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_process_tag
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
if|if
condition|(
operator|!
name|emitter
operator|->
name|tag_data
operator|.
name|handle
operator|&&
operator|!
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
condition|)
return|return
literal|1
return|;
if|if
condition|(
name|emitter
operator|->
name|tag_data
operator|.
name|handle
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_tag_handle
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|handle
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_tag_content
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"!<"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_tag_content
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
argument_list|,
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|">"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Write a scalar.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_process_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
switch|switch
condition|(
name|emitter
operator|->
name|scalar_data
operator|.
name|style
condition|)
block|{
case|case
name|YAML_PLAIN_SCALAR_STYLE
case|:
return|return
name|yaml_emitter_write_plain_scalar
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|value
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|length
argument_list|,
operator|!
name|emitter
operator|->
name|simple_key_context
argument_list|)
return|;
case|case
name|YAML_SINGLE_QUOTED_SCALAR_STYLE
case|:
return|return
name|yaml_emitter_write_single_quoted_scalar
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|value
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|length
argument_list|,
operator|!
name|emitter
operator|->
name|simple_key_context
argument_list|)
return|;
case|case
name|YAML_DOUBLE_QUOTED_SCALAR_STYLE
case|:
return|return
name|yaml_emitter_write_double_quoted_scalar
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|value
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|length
argument_list|,
operator|!
name|emitter
operator|->
name|simple_key_context
argument_list|)
return|;
case|case
name|YAML_LITERAL_SCALAR_STYLE
case|:
return|return
name|yaml_emitter_write_literal_scalar
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|value
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|length
argument_list|)
return|;
case|case
name|YAML_FOLDED_SCALAR_STYLE
case|:
return|return
name|yaml_emitter_write_folded_scalar
argument_list|(
name|emitter
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|value
argument_list|,
name|emitter
operator|->
name|scalar_data
operator|.
name|length
argument_list|)
return|;
default|default:
name|assert
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Impossible. */
block|}
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/*  * Check if a %YAML directive is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_version_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_version_directive_t
name|version_directive
parameter_list|)
block|{
if|if
condition|(
name|version_directive
operator|.
name|major
operator|!=
literal|1
operator|||
name|version_directive
operator|.
name|minor
operator|!=
literal|1
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"incompatible %YAML directive"
argument_list|)
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if a %TAG directive is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_tag_directive
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_tag_directive_t
name|tag_directive
parameter_list|)
block|{
name|yaml_string_t
name|handle
decl_stmt|;
name|yaml_string_t
name|prefix
decl_stmt|;
name|size_t
name|handle_length
decl_stmt|;
name|size_t
name|prefix_length
decl_stmt|;
name|handle_length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|.
name|handle
argument_list|)
expr_stmt|;
name|prefix_length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|.
name|prefix
argument_list|)
expr_stmt|;
name|STRING_ASSIGN
argument_list|(
name|handle
argument_list|,
name|tag_directive
operator|.
name|handle
argument_list|,
name|handle_length
argument_list|)
expr_stmt|;
name|STRING_ASSIGN
argument_list|(
name|prefix
argument_list|,
name|tag_directive
operator|.
name|prefix
argument_list|,
name|prefix_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|handle
operator|.
name|start
operator|==
name|handle
operator|.
name|end
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag handle must not be empty"
argument_list|)
return|;
block|}
if|if
condition|(
name|handle
operator|.
name|start
index|[
literal|0
index|]
operator|!=
literal|'!'
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag handle must start with '!'"
argument_list|)
return|;
block|}
if|if
condition|(
name|handle
operator|.
name|end
index|[
operator|-
literal|1
index|]
operator|!=
literal|'!'
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag handle must end with '!'"
argument_list|)
return|;
block|}
name|handle
operator|.
name|pointer
operator|++
expr_stmt|;
while|while
condition|(
name|handle
operator|.
name|pointer
operator|<
name|handle
operator|.
name|end
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|IS_ALPHA
argument_list|(
name|handle
argument_list|)
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag handle must contain alphanumerical characters only"
argument_list|)
return|;
block|}
name|MOVE
argument_list|(
name|handle
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|prefix
operator|.
name|start
operator|==
name|prefix
operator|.
name|end
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag prefix must not be empty"
argument_list|)
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if an anchor is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|anchor
parameter_list|,
name|int
name|alias
parameter_list|)
block|{
name|size_t
name|anchor_length
decl_stmt|;
name|yaml_string_t
name|string
decl_stmt|;
name|anchor_length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|anchor
argument_list|)
expr_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|anchor
argument_list|,
name|anchor_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|end
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
name|alias
condition|?
literal|"alias value must not be empty"
else|:
literal|"anchor value must not be empty"
argument_list|)
return|;
block|}
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
operator|!
name|IS_ALPHA
argument_list|(
name|string
argument_list|)
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
name|alias
condition|?
literal|"alias value must contain alphanumerical characters only"
else|:
literal|"anchor value must contain alphanumerical characters only"
argument_list|)
return|;
block|}
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor
operator|=
name|string
operator|.
name|start
expr_stmt|;
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
operator|=
name|string
operator|.
name|end
operator|-
name|string
operator|.
name|start
expr_stmt|;
name|emitter
operator|->
name|anchor_data
operator|.
name|alias
operator|=
name|alias
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if a tag is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_tag
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|tag
parameter_list|)
block|{
name|size_t
name|tag_length
decl_stmt|;
name|yaml_string_t
name|string
decl_stmt|;
name|yaml_tag_directive_t
modifier|*
name|tag_directive
decl_stmt|;
name|tag_length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag
argument_list|)
expr_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|tag
argument_list|,
name|tag_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|end
condition|)
block|{
return|return
name|yaml_emitter_set_emitter_error
argument_list|(
name|emitter
argument_list|,
literal|"tag value must not be empty"
argument_list|)
return|;
block|}
for|for
control|(
name|tag_directive
operator|=
name|emitter
operator|->
name|tag_directives
operator|.
name|start
init|;
name|tag_directive
operator|!=
name|emitter
operator|->
name|tag_directives
operator|.
name|top
condition|;
name|tag_directive
operator|++
control|)
block|{
name|size_t
name|prefix_length
init|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|prefix
argument_list|)
decl_stmt|;
if|if
condition|(
name|prefix_length
operator|<
call|(
name|size_t
call|)
argument_list|(
name|string
operator|.
name|end
operator|-
name|string
operator|.
name|start
argument_list|)
operator|&&
name|strncmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|prefix
argument_list|,
operator|(
name|char
operator|*
operator|)
name|string
operator|.
name|start
argument_list|,
name|prefix_length
argument_list|)
operator|==
literal|0
condition|)
block|{
name|emitter
operator|->
name|tag_data
operator|.
name|handle
operator|=
name|tag_directive
operator|->
name|handle
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|=
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|tag_directive
operator|->
name|handle
argument_list|)
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
operator|=
name|string
operator|.
name|start
operator|+
name|prefix_length
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
operator|=
operator|(
name|string
operator|.
name|end
operator|-
name|string
operator|.
name|start
operator|)
operator|-
name|prefix_length
expr_stmt|;
return|return
literal|1
return|;
block|}
block|}
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
operator|=
name|string
operator|.
name|start
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
operator|=
name|string
operator|.
name|end
operator|-
name|string
operator|.
name|start
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if a scalar is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|block_indicators
init|=
literal|0
decl_stmt|;
name|int
name|flow_indicators
init|=
literal|0
decl_stmt|;
name|int
name|line_breaks
init|=
literal|0
decl_stmt|;
name|int
name|special_characters
init|=
literal|0
decl_stmt|;
name|int
name|leading_space
init|=
literal|0
decl_stmt|;
name|int
name|leading_break
init|=
literal|0
decl_stmt|;
name|int
name|trailing_space
init|=
literal|0
decl_stmt|;
name|int
name|trailing_break
init|=
literal|0
decl_stmt|;
name|int
name|break_space
init|=
literal|0
decl_stmt|;
name|int
name|space_break
init|=
literal|0
decl_stmt|;
name|int
name|preceeded_by_whitespace
init|=
literal|0
decl_stmt|;
name|int
name|followed_by_whitespace
init|=
literal|0
decl_stmt|;
name|int
name|previous_space
init|=
literal|0
decl_stmt|;
name|int
name|previous_break
init|=
literal|0
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|value
operator|=
name|value
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|length
operator|=
name|length
expr_stmt|;
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|end
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|multiline
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|single_quoted_allowed
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_allowed
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|(
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'-'
argument_list|,
literal|0
argument_list|)
operator|&&
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'-'
argument_list|,
literal|1
argument_list|)
operator|&&
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'-'
argument_list|,
literal|2
argument_list|)
operator|)
operator|||
operator|(
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'.'
argument_list|,
literal|0
argument_list|)
operator|&&
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'.'
argument_list|,
literal|1
argument_list|)
operator|&&
name|CHECK_AT
argument_list|(
name|string
argument_list|,
literal|'.'
argument_list|,
literal|2
argument_list|)
operator|)
condition|)
block|{
name|block_indicators
operator|=
literal|1
expr_stmt|;
name|flow_indicators
operator|=
literal|1
expr_stmt|;
block|}
name|preceeded_by_whitespace
operator|=
literal|1
expr_stmt|;
name|followed_by_whitespace
operator|=
name|IS_BLANKZ_AT
argument_list|(
name|string
argument_list|,
name|WIDTH
argument_list|(
name|string
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|pointer
condition|)
block|{
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'#'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|','
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'['
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|']'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'{'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'}'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'&'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'*'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'!'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'|'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'>'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\''
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'"'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'%'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'@'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'`'
argument_list|)
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
name|block_indicators
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'?'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|':'
argument_list|)
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|followed_by_whitespace
condition|)
block|{
name|block_indicators
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'-'
argument_list|)
operator|&&
name|followed_by_whitespace
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
name|block_indicators
operator|=
literal|1
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|','
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'?'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'['
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|']'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'{'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'}'
argument_list|)
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|':'
argument_list|)
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|followed_by_whitespace
condition|)
block|{
name|block_indicators
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'#'
argument_list|)
operator|&&
name|preceeded_by_whitespace
condition|)
block|{
name|flow_indicators
operator|=
literal|1
expr_stmt|;
name|block_indicators
operator|=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|IS_PRINTABLE
argument_list|(
name|string
argument_list|)
operator|||
operator|(
operator|!
name|IS_ASCII
argument_list|(
name|string
argument_list|)
operator|&&
operator|!
name|emitter
operator|->
name|unicode
operator|)
condition|)
block|{
name|special_characters
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
name|line_breaks
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|IS_SPACE
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|pointer
condition|)
block|{
name|leading_space
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|string
operator|.
name|pointer
operator|+
name|WIDTH
argument_list|(
name|string
argument_list|)
operator|==
name|string
operator|.
name|end
condition|)
block|{
name|trailing_space
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|previous_break
condition|)
block|{
name|break_space
operator|=
literal|1
expr_stmt|;
block|}
name|previous_space
operator|=
literal|1
expr_stmt|;
name|previous_break
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|pointer
condition|)
block|{
name|leading_break
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|string
operator|.
name|pointer
operator|+
name|WIDTH
argument_list|(
name|string
argument_list|)
operator|==
name|string
operator|.
name|end
condition|)
block|{
name|trailing_break
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|previous_space
condition|)
block|{
name|space_break
operator|=
literal|1
expr_stmt|;
block|}
name|previous_space
operator|=
literal|0
expr_stmt|;
name|previous_break
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|previous_space
operator|=
literal|0
expr_stmt|;
name|previous_break
operator|=
literal|0
expr_stmt|;
block|}
name|preceeded_by_whitespace
operator|=
name|IS_BLANKZ
argument_list|(
name|string
argument_list|)
expr_stmt|;
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
name|followed_by_whitespace
operator|=
name|IS_BLANKZ_AT
argument_list|(
name|string
argument_list|,
name|WIDTH
argument_list|(
name|string
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|emitter
operator|->
name|scalar_data
operator|.
name|multiline
operator|=
name|line_breaks
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|single_quoted_allowed
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_allowed
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|leading_space
operator|||
name|leading_break
operator|||
name|trailing_space
operator|||
name|trailing_break
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|trailing_space
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|block_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|break_space
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|single_quoted_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|space_break
operator|||
name|special_characters
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|single_quoted_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|line_breaks
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|flow_indicators
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|flow_plain_allowed
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|block_indicators
condition|)
block|{
name|emitter
operator|->
name|scalar_data
operator|.
name|block_plain_allowed
operator|=
literal|0
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*  * Check if the event data is valid.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_analyze_event
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_event_t
modifier|*
name|event
parameter_list|)
block|{
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor
operator|=
name|NULL
expr_stmt|;
name|emitter
operator|->
name|anchor_data
operator|.
name|anchor_length
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|handle
operator|=
name|NULL
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|handle_length
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|suffix
operator|=
name|NULL
expr_stmt|;
name|emitter
operator|->
name|tag_data
operator|.
name|suffix_length
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|value
operator|=
name|NULL
expr_stmt|;
name|emitter
operator|->
name|scalar_data
operator|.
name|length
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|YAML_ALIAS_EVENT
case|:
if|if
condition|(
operator|!
name|yaml_emitter_analyze_anchor
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|alias
operator|.
name|anchor
argument_list|,
literal|1
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
case|case
name|YAML_SCALAR_EVENT
case|:
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|anchor
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_anchor
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|anchor
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|tag
operator|&&
operator|(
name|emitter
operator|->
name|canonical
operator|||
operator|(
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|plain_implicit
operator|&&
operator|!
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|quoted_implicit
operator|)
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_tag
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|tag
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|yaml_emitter_analyze_scalar
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|value
argument_list|,
name|event
operator|->
name|data
operator|.
name|scalar
operator|.
name|length
argument_list|)
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
case|case
name|YAML_SEQUENCE_START_EVENT
case|:
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|anchor
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_anchor
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|anchor
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|tag
operator|&&
operator|(
name|emitter
operator|->
name|canonical
operator|||
operator|!
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|implicit
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_tag
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|sequence_start
operator|.
name|tag
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
case|case
name|YAML_MAPPING_START_EVENT
case|:
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|anchor
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_anchor
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|anchor
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|tag
operator|&&
operator|(
name|emitter
operator|->
name|canonical
operator|||
operator|!
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|implicit
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_analyze_tag
argument_list|(
name|emitter
argument_list|,
name|event
operator|->
name|data
operator|.
name|mapping_start
operator|.
name|tag
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
default|default:
return|return
literal|1
return|;
block|}
block|}
end_function

begin_comment
comment|/*  * Write the BOM character.  */
end_comment

begin_function
specifier|static
name|int
name|yaml_emitter_write_bom
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
if|if
condition|(
operator|!
name|FLUSH
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
operator|*
operator|(
name|emitter
operator|->
name|buffer
operator|.
name|pointer
operator|++
operator|)
operator|=
operator|(
name|yaml_char_t
operator|)
literal|'\xEF'
expr_stmt|;
operator|*
operator|(
name|emitter
operator|->
name|buffer
operator|.
name|pointer
operator|++
operator|)
operator|=
operator|(
name|yaml_char_t
operator|)
literal|'\xBB'
expr_stmt|;
operator|*
operator|(
name|emitter
operator|->
name|buffer
operator|.
name|pointer
operator|++
operator|)
operator|=
operator|(
name|yaml_char_t
operator|)
literal|'\xBF'
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_indent
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|)
block|{
name|int
name|indent
init|=
operator|(
name|emitter
operator|->
name|indent
operator|>=
literal|0
operator|)
condition|?
name|emitter
operator|->
name|indent
else|:
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|emitter
operator|->
name|indention
operator|||
name|emitter
operator|->
name|column
operator|>
name|indent
operator|||
operator|(
name|emitter
operator|->
name|column
operator|==
name|indent
operator|&&
operator|!
name|emitter
operator|->
name|whitespace
operator|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
while|while
condition|(
name|emitter
operator|->
name|column
operator|<
name|indent
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|' '
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|whitespace
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_indicator
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|char
modifier|*
name|indicator
parameter_list|,
name|int
name|need_whitespace
parameter_list|,
name|int
name|is_whitespace
parameter_list|,
name|int
name|is_indention
parameter_list|)
block|{
name|size_t
name|indicator_length
decl_stmt|;
name|yaml_string_t
name|string
decl_stmt|;
name|indicator_length
operator|=
name|strlen
argument_list|(
name|indicator
argument_list|)
expr_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
operator|(
name|yaml_char_t
operator|*
operator|)
name|indicator
argument_list|,
name|indicator_length
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_whitespace
operator|&&
operator|!
name|emitter
operator|->
name|whitespace
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|' '
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|whitespace
operator|=
name|is_whitespace
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
operator|(
name|emitter
operator|->
name|indention
operator|&&
name|is_indention
operator|)
expr_stmt|;
name|emitter
operator|->
name|open_ended
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_anchor
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_tag_handle
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|emitter
operator|->
name|whitespace
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|' '
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_tag_content
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|need_whitespace
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_whitespace
operator|&&
operator|!
name|emitter
operator|->
name|whitespace
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|' '
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|IS_ALPHA
argument_list|(
name|string
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|';'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'/'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'?'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|':'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'@'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'&'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'='
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'+'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'$'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|','
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'_'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'.'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'~'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'*'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\''
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'('
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|')'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'['
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|']'
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
else|else
block|{
name|int
name|width
init|=
name|WIDTH
argument_list|(
name|string
argument_list|)
decl_stmt|;
name|unsigned
name|int
name|value
decl_stmt|;
while|while
condition|(
name|width
operator|--
condition|)
block|{
name|value
operator|=
operator|*
operator|(
name|string
operator|.
name|pointer
operator|++
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'%'
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
operator|(
name|value
operator|>>
literal|4
operator|)
operator|+
operator|(
operator|(
name|value
operator|>>
literal|4
operator|)
operator|<
literal|10
condition|?
literal|'0'
else|:
literal|'A'
operator|-
literal|10
operator|)
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
operator|(
name|value
operator|&
literal|0x0F
operator|)
operator|+
operator|(
operator|(
name|value
operator|&
literal|0x0F
operator|)
operator|<
literal|10
condition|?
literal|'0'
else|:
literal|'A'
operator|-
literal|10
operator|)
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
block|}
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_plain_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|spaces
init|=
literal|0
decl_stmt|;
name|int
name|breaks
init|=
literal|0
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|emitter
operator|->
name|whitespace
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|' '
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|IS_SPACE
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
name|allow_breaks
operator|&&
operator|!
name|spaces
operator|&&
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
operator|&&
operator|!
name|IS_SPACE_AT
argument_list|(
name|string
argument_list|,
literal|1
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|spaces
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|breaks
operator|&&
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\n'
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|WRITE_BREAK
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|breaks
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|breaks
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
name|spaces
operator|=
literal|0
expr_stmt|;
name|breaks
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|emitter
operator|->
name|root_context
condition|)
block|{
name|emitter
operator|->
name|open_ended
operator|=
literal|1
expr_stmt|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_single_quoted_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|spaces
init|=
literal|0
decl_stmt|;
name|int
name|breaks
init|=
literal|0
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"'"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|IS_SPACE
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
name|allow_breaks
operator|&&
operator|!
name|spaces
operator|&&
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
operator|&&
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|start
operator|&&
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
operator|-
literal|1
operator|&&
operator|!
name|IS_SPACE_AT
argument_list|(
name|string
argument_list|,
literal|1
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|spaces
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|breaks
operator|&&
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\n'
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|WRITE_BREAK
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|breaks
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|breaks
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\''
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'\''
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
name|spaces
operator|=
literal|0
expr_stmt|;
name|breaks
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"'"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_double_quoted_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|,
name|int
name|allow_breaks
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|spaces
init|=
literal|0
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"\""
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
operator|!
name|IS_PRINTABLE
argument_list|(
name|string
argument_list|)
operator|||
operator|(
operator|!
name|emitter
operator|->
name|unicode
operator|&&
operator|!
name|IS_ASCII
argument_list|(
name|string
argument_list|)
operator|)
operator|||
name|IS_BOM
argument_list|(
name|string
argument_list|)
operator|||
name|IS_BREAK
argument_list|(
name|string
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'"'
argument_list|)
operator|||
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\\'
argument_list|)
condition|)
block|{
name|unsigned
name|char
name|octet
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|;
name|unsigned
name|int
name|value
decl_stmt|;
name|int
name|k
decl_stmt|;
name|octet
operator|=
name|string
operator|.
name|pointer
index|[
literal|0
index|]
expr_stmt|;
name|width
operator|=
operator|(
name|octet
operator|&
literal|0x80
operator|)
operator|==
literal|0x00
condition|?
literal|1
else|:
operator|(
name|octet
operator|&
literal|0xE0
operator|)
operator|==
literal|0xC0
condition|?
literal|2
else|:
operator|(
name|octet
operator|&
literal|0xF0
operator|)
operator|==
literal|0xE0
condition|?
literal|3
else|:
operator|(
name|octet
operator|&
literal|0xF8
operator|)
operator|==
literal|0xF0
condition|?
literal|4
else|:
literal|0
expr_stmt|;
name|value
operator|=
operator|(
name|octet
operator|&
literal|0x80
operator|)
operator|==
literal|0x00
condition|?
name|octet
operator|&
literal|0x7F
else|:
operator|(
name|octet
operator|&
literal|0xE0
operator|)
operator|==
literal|0xC0
condition|?
name|octet
operator|&
literal|0x1F
else|:
operator|(
name|octet
operator|&
literal|0xF0
operator|)
operator|==
literal|0xE0
condition|?
name|octet
operator|&
literal|0x0F
else|:
operator|(
name|octet
operator|&
literal|0xF8
operator|)
operator|==
literal|0xF0
condition|?
name|octet
operator|&
literal|0x07
else|:
literal|0
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|1
init|;
name|k
operator|<
operator|(
name|int
operator|)
name|width
condition|;
name|k
operator|++
control|)
block|{
name|octet
operator|=
name|string
operator|.
name|pointer
index|[
name|k
index|]
expr_stmt|;
name|value
operator|=
operator|(
name|value
operator|<<
literal|6
operator|)
operator|+
operator|(
name|octet
operator|&
literal|0x3F
operator|)
expr_stmt|;
block|}
name|string
operator|.
name|pointer
operator|+=
name|width
expr_stmt|;
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'\\'
argument_list|)
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|value
condition|)
block|{
case|case
literal|0x00
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'0'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x07
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'a'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x08
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'b'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x09
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'t'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x0A
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'n'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x0B
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'v'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x0C
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'f'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x0D
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'r'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x1B
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'e'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x22
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'\"'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x5C
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'\\'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x85
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'N'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0xA0
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'_'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x2028
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'L'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
case|case
literal|0x2029
case|:
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'P'
argument_list|)
condition|)
return|return
literal|0
return|;
break|break;
default|default:
if|if
condition|(
name|value
operator|<=
literal|0xFF
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'x'
argument_list|)
condition|)
return|return
literal|0
return|;
name|width
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|value
operator|<=
literal|0xFFFF
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'u'
argument_list|)
condition|)
return|return
literal|0
return|;
name|width
operator|=
literal|4
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'U'
argument_list|)
condition|)
return|return
literal|0
return|;
name|width
operator|=
literal|8
expr_stmt|;
block|}
for|for
control|(
name|k
operator|=
operator|(
name|width
operator|-
literal|1
operator|)
operator|*
literal|4
init|;
name|k
operator|>=
literal|0
condition|;
name|k
operator|-=
literal|4
control|)
block|{
name|int
name|digit
init|=
operator|(
name|value
operator|>>
name|k
operator|)
operator|&
literal|0x0F
decl_stmt|;
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
name|digit
operator|+
operator|(
name|digit
operator|<
literal|10
condition|?
literal|'0'
else|:
literal|'A'
operator|-
literal|10
operator|)
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
name|spaces
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|IS_SPACE
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
name|allow_breaks
operator|&&
operator|!
name|spaces
operator|&&
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
operator|&&
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|start
operator|&&
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
operator|-
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|IS_SPACE_AT
argument_list|(
name|string
argument_list|,
literal|1
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT
argument_list|(
name|emitter
argument_list|,
literal|'\\'
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|spaces
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|spaces
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"\""
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|whitespace
operator|=
literal|0
expr_stmt|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_block_scalar_hints
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_string_t
name|string
parameter_list|)
block|{
name|char
name|indent_hint
index|[
literal|2
index|]
decl_stmt|;
name|char
modifier|*
name|chomp_hint
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|IS_SPACE
argument_list|(
name|string
argument_list|)
operator|||
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
name|indent_hint
index|[
literal|0
index|]
operator|=
literal|'0'
operator|+
operator|(
name|char
operator|)
name|emitter
operator|->
name|best_indent
expr_stmt|;
name|indent_hint
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
name|indent_hint
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|open_ended
operator|=
literal|0
expr_stmt|;
name|string
operator|.
name|pointer
operator|=
name|string
operator|.
name|end
expr_stmt|;
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|pointer
condition|)
block|{
name|chomp_hint
operator|=
literal|"-"
expr_stmt|;
block|}
else|else
block|{
do|do
block|{
name|string
operator|.
name|pointer
operator|--
expr_stmt|;
block|}
do|while
condition|(
operator|(
operator|*
name|string
operator|.
name|pointer
operator|&
literal|0xC0
operator|)
operator|==
literal|0x80
condition|)
do|;
if|if
condition|(
operator|!
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
name|chomp_hint
operator|=
literal|"-"
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|string
operator|.
name|start
operator|==
name|string
operator|.
name|pointer
condition|)
block|{
name|chomp_hint
operator|=
literal|"+"
expr_stmt|;
name|emitter
operator|->
name|open_ended
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
do|do
block|{
name|string
operator|.
name|pointer
operator|--
expr_stmt|;
block|}
do|while
condition|(
operator|(
operator|*
name|string
operator|.
name|pointer
operator|&
literal|0xC0
operator|)
operator|==
literal|0x80
condition|)
do|;
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
name|chomp_hint
operator|=
literal|"+"
expr_stmt|;
name|emitter
operator|->
name|open_ended
operator|=
literal|1
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|chomp_hint
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
name|chomp_hint
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_literal_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|breaks
init|=
literal|1
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|"|"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_block_scalar_hints
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|whitespace
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|WRITE_BREAK
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|breaks
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|breaks
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
name|breaks
operator|=
literal|0
expr_stmt|;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|int
name|yaml_emitter_write_folded_scalar
parameter_list|(
name|yaml_emitter_t
modifier|*
name|emitter
parameter_list|,
name|yaml_char_t
modifier|*
name|value
parameter_list|,
name|size_t
name|length
parameter_list|)
block|{
name|yaml_string_t
name|string
decl_stmt|;
name|int
name|breaks
init|=
literal|1
decl_stmt|;
name|int
name|leading_spaces
init|=
literal|1
decl_stmt|;
name|STRING_ASSIGN
argument_list|(
name|string
argument_list|,
name|value
argument_list|,
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|yaml_emitter_write_indicator
argument_list|(
name|emitter
argument_list|,
literal|">"
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|yaml_emitter_write_block_scalar_hints
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|emitter
operator|->
name|whitespace
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|string
operator|.
name|pointer
operator|!=
name|string
operator|.
name|end
condition|)
block|{
if|if
condition|(
name|IS_BREAK
argument_list|(
name|string
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|breaks
operator|&&
operator|!
name|leading_spaces
operator|&&
name|CHECK
argument_list|(
name|string
argument_list|,
literal|'\n'
argument_list|)
condition|)
block|{
name|int
name|k
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|IS_BREAK_AT
argument_list|(
name|string
argument_list|,
name|k
argument_list|)
condition|)
block|{
name|k
operator|+=
name|WIDTH_AT
argument_list|(
name|string
argument_list|,
name|k
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|IS_BLANKZ_AT
argument_list|(
name|string
argument_list|,
name|k
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PUT_BREAK
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
block|}
if|if
condition|(
operator|!
name|WRITE_BREAK
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
name|emitter
operator|->
name|indention
operator|=
literal|1
expr_stmt|;
name|breaks
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|breaks
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|leading_spaces
operator|=
name|IS_BLANK
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|breaks
operator|&&
name|IS_SPACE
argument_list|(
name|string
argument_list|)
operator|&&
operator|!
name|IS_SPACE_AT
argument_list|(
name|string
argument_list|,
literal|1
argument_list|)
operator|&&
name|emitter
operator|->
name|column
operator|>
name|emitter
operator|->
name|best_width
condition|)
block|{
if|if
condition|(
operator|!
name|yaml_emitter_write_indent
argument_list|(
name|emitter
argument_list|)
condition|)
return|return
literal|0
return|;
name|MOVE
argument_list|(
name|string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|WRITE
argument_list|(
name|emitter
argument_list|,
name|string
argument_list|)
condition|)
return|return
literal|0
return|;
block|}
name|emitter
operator|->
name|indention
operator|=
literal|0
expr_stmt|;
name|breaks
operator|=
literal|0
expr_stmt|;
block|}
block|}
return|return
literal|1
return|;
block|}
end_function

end_unit

