begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * trsort.c for libdivsufsort  * Copyright (c) 2003-2008 Yuta Mori All Rights Reserved.  *  * Permission is hereby granted, free of charge, to any person  * obtaining a copy of this software and associated documentation  * files (the "Software"), to deal in the Software without  * restriction, including without limitation the rights to use,  * copy, modify, merge, publish, distribute, sublicense, and/or sell  * copies of the Software, and to permit persons to whom the  * Software is furnished to do so, subject to the following  * conditions:  *  * The above copyright notice and this permission notice shall be  * included in all copies or substantial portions of the Software.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES  * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT  * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,  * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR  * OTHER DEALINGS IN THE SOFTWARE.  */
end_comment

begin_include
include|#
directive|include
file|"divsufsort_private.h"
end_include

begin_comment
comment|/*- Private Functions -*/
end_comment

begin_decl_stmt
specifier|static
specifier|const
name|saint_t
name|lg_table
index|[
literal|256
index|]
init|=
block|{
operator|-
literal|1
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|2
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|3
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|4
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|5
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|6
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|,
literal|7
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|INLINE
name|saint_t
name|tr_ilg
parameter_list|(
name|saidx_t
name|n
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|BUILD_DIVSUFSORT64
argument_list|)
return|return
operator|(
name|n
operator|>>
literal|32
operator|)
condition|?
operator|(
operator|(
name|n
operator|>>
literal|48
operator|)
condition|?
operator|(
operator|(
name|n
operator|>>
literal|56
operator|)
condition|?
literal|56
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|56
operator|)
operator|&
literal|0xff
index|]
else|:
literal|48
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|48
operator|)
operator|&
literal|0xff
index|]
operator|)
else|:
operator|(
operator|(
name|n
operator|>>
literal|40
operator|)
condition|?
literal|40
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|40
operator|)
operator|&
literal|0xff
index|]
else|:
literal|32
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|32
operator|)
operator|&
literal|0xff
index|]
operator|)
operator|)
else|:
operator|(
operator|(
name|n
operator|&
literal|0xffff0000
operator|)
condition|?
operator|(
operator|(
name|n
operator|&
literal|0xff000000
operator|)
condition|?
literal|24
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|24
operator|)
operator|&
literal|0xff
index|]
else|:
literal|16
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|16
operator|)
operator|&
literal|0xff
index|]
operator|)
else|:
operator|(
operator|(
name|n
operator|&
literal|0x0000ff00
operator|)
condition|?
literal|8
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|8
operator|)
operator|&
literal|0xff
index|]
else|:
literal|0
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|0
operator|)
operator|&
literal|0xff
index|]
operator|)
operator|)
return|;
else|#
directive|else
return|return
operator|(
name|n
operator|&
literal|0xffff0000
operator|)
condition|?
operator|(
operator|(
name|n
operator|&
literal|0xff000000
operator|)
condition|?
literal|24
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|24
operator|)
operator|&
literal|0xff
index|]
else|:
literal|16
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|16
operator|)
operator|&
literal|0xff
index|]
operator|)
else|:
operator|(
operator|(
name|n
operator|&
literal|0x0000ff00
operator|)
condition|?
literal|8
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|8
operator|)
operator|&
literal|0xff
index|]
else|:
literal|0
operator|+
name|lg_table
index|[
operator|(
name|n
operator|>>
literal|0
operator|)
operator|&
literal|0xff
index|]
operator|)
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_comment
comment|/* Simple insertionsort for small size groups. */
end_comment

begin_function
specifier|static
name|void
name|tr_insertionsort
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|)
block|{
name|saidx_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|saidx_t
name|t
decl_stmt|,
name|r
decl_stmt|;
for|for
control|(
name|a
operator|=
name|first
operator|+
literal|1
init|;
name|a
operator|<
name|last
condition|;
operator|++
name|a
control|)
block|{
for|for
control|(
name|t
operator|=
operator|*
name|a
operator|,
name|b
operator|=
name|a
operator|-
literal|1
init|;
literal|0
operator|>
operator|(
name|r
operator|=
name|ISAd
index|[
name|t
index|]
operator|-
name|ISAd
index|[
operator|*
name|b
index|]
operator|)
condition|;
control|)
block|{
do|do
block|{
operator|*
operator|(
name|b
operator|+
literal|1
operator|)
operator|=
operator|*
name|b
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|first
operator|<=
operator|--
name|b
operator|)
operator|&&
operator|(
operator|*
name|b
operator|<
literal|0
operator|)
condition|)
do|;
if|if
condition|(
name|b
operator|<
name|first
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|r
operator|==
literal|0
condition|)
block|{
operator|*
name|b
operator|=
operator|~
operator|*
name|b
expr_stmt|;
block|}
operator|*
operator|(
name|b
operator|+
literal|1
operator|)
operator|=
name|t
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|INLINE
name|void
name|tr_fixdown
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
name|i
parameter_list|,
name|saidx_t
name|size
parameter_list|)
block|{
name|saidx_t
name|j
decl_stmt|,
name|k
decl_stmt|;
name|saidx_t
name|v
decl_stmt|;
name|saidx_t
name|c
decl_stmt|,
name|d
decl_stmt|,
name|e
decl_stmt|;
for|for
control|(
name|v
operator|=
name|SA
index|[
name|i
index|]
operator|,
name|c
operator|=
name|ISAd
index|[
name|v
index|]
init|;
operator|(
name|j
operator|=
literal|2
operator|*
name|i
operator|+
literal|1
operator|)
operator|<
name|size
condition|;
name|SA
index|[
name|i
index|]
operator|=
name|SA
index|[
name|k
index|]
operator|,
name|i
operator|=
name|k
control|)
block|{
name|d
operator|=
name|ISAd
index|[
name|SA
index|[
name|k
operator|=
name|j
operator|++
index|]
index|]
expr_stmt|;
if|if
condition|(
name|d
operator|<
operator|(
name|e
operator|=
name|ISAd
index|[
name|SA
index|[
name|j
index|]
index|]
operator|)
condition|)
block|{
name|k
operator|=
name|j
expr_stmt|;
name|d
operator|=
name|e
expr_stmt|;
block|}
if|if
condition|(
name|d
operator|<=
name|c
condition|)
block|{
break|break;
block|}
block|}
name|SA
index|[
name|i
index|]
operator|=
name|v
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Simple top-down heapsort. */
end_comment

begin_function
specifier|static
name|void
name|tr_heapsort
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
name|size
parameter_list|)
block|{
name|saidx_t
name|i
decl_stmt|,
name|m
decl_stmt|;
name|saidx_t
name|t
decl_stmt|;
name|m
operator|=
name|size
expr_stmt|;
if|if
condition|(
operator|(
name|size
operator|%
literal|2
operator|)
operator|==
literal|0
condition|)
block|{
name|m
operator|--
expr_stmt|;
if|if
condition|(
name|ISAd
index|[
name|SA
index|[
name|m
operator|/
literal|2
index|]
index|]
operator|<
name|ISAd
index|[
name|SA
index|[
name|m
index|]
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|SA
index|[
name|m
index|]
argument_list|,
name|SA
index|[
name|m
operator|/
literal|2
index|]
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
name|m
operator|/
literal|2
operator|-
literal|1
init|;
literal|0
operator|<=
name|i
condition|;
operator|--
name|i
control|)
block|{
name|tr_fixdown
argument_list|(
name|ISAd
argument_list|,
name|SA
argument_list|,
name|i
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|size
operator|%
literal|2
operator|)
operator|==
literal|0
condition|)
block|{
name|SWAP
argument_list|(
name|SA
index|[
literal|0
index|]
argument_list|,
name|SA
index|[
name|m
index|]
argument_list|)
expr_stmt|;
name|tr_fixdown
argument_list|(
name|ISAd
argument_list|,
name|SA
argument_list|,
literal|0
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|m
operator|-
literal|1
init|;
literal|0
operator|<
name|i
condition|;
operator|--
name|i
control|)
block|{
name|t
operator|=
name|SA
index|[
literal|0
index|]
operator|,
name|SA
index|[
literal|0
index|]
operator|=
name|SA
index|[
name|i
index|]
expr_stmt|;
name|tr_fixdown
argument_list|(
name|ISAd
argument_list|,
name|SA
argument_list|,
literal|0
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|SA
index|[
name|i
index|]
operator|=
name|t
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_comment
comment|/* Returns the median of three elements. */
end_comment

begin_function
specifier|static
name|INLINE
name|saidx_t
modifier|*
name|tr_median3
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|v1
parameter_list|,
name|saidx_t
modifier|*
name|v2
parameter_list|,
name|saidx_t
modifier|*
name|v3
parameter_list|)
block|{
name|saidx_t
modifier|*
name|t
decl_stmt|;
if|if
condition|(
name|ISAd
index|[
operator|*
name|v1
index|]
operator|>
name|ISAd
index|[
operator|*
name|v2
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v1
argument_list|,
name|v2
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v2
index|]
operator|>
name|ISAd
index|[
operator|*
name|v3
index|]
condition|)
block|{
if|if
condition|(
name|ISAd
index|[
operator|*
name|v1
index|]
operator|>
name|ISAd
index|[
operator|*
name|v3
index|]
condition|)
block|{
return|return
name|v1
return|;
block|}
else|else
block|{
return|return
name|v3
return|;
block|}
block|}
return|return
name|v2
return|;
block|}
end_function

begin_comment
comment|/* Returns the median of five elements. */
end_comment

begin_function
specifier|static
name|INLINE
name|saidx_t
modifier|*
name|tr_median5
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|v1
parameter_list|,
name|saidx_t
modifier|*
name|v2
parameter_list|,
name|saidx_t
modifier|*
name|v3
parameter_list|,
name|saidx_t
modifier|*
name|v4
parameter_list|,
name|saidx_t
modifier|*
name|v5
parameter_list|)
block|{
name|saidx_t
modifier|*
name|t
decl_stmt|;
if|if
condition|(
name|ISAd
index|[
operator|*
name|v2
index|]
operator|>
name|ISAd
index|[
operator|*
name|v3
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v2
argument_list|,
name|v3
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v4
index|]
operator|>
name|ISAd
index|[
operator|*
name|v5
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v4
argument_list|,
name|v5
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v2
index|]
operator|>
name|ISAd
index|[
operator|*
name|v4
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v2
argument_list|,
name|v4
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|v3
argument_list|,
name|v5
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v1
index|]
operator|>
name|ISAd
index|[
operator|*
name|v3
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v1
argument_list|,
name|v3
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v1
index|]
operator|>
name|ISAd
index|[
operator|*
name|v4
index|]
condition|)
block|{
name|SWAP
argument_list|(
name|v1
argument_list|,
name|v4
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|v3
argument_list|,
name|v5
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|ISAd
index|[
operator|*
name|v3
index|]
operator|>
name|ISAd
index|[
operator|*
name|v4
index|]
condition|)
block|{
return|return
name|v4
return|;
block|}
return|return
name|v3
return|;
block|}
end_function

begin_comment
comment|/* Returns the pivot element. */
end_comment

begin_function
specifier|static
name|INLINE
name|saidx_t
modifier|*
name|tr_pivot
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|)
block|{
name|saidx_t
modifier|*
name|middle
decl_stmt|;
name|saidx_t
name|t
decl_stmt|;
name|t
operator|=
name|last
operator|-
name|first
expr_stmt|;
name|middle
operator|=
name|first
operator|+
name|t
operator|/
literal|2
expr_stmt|;
if|if
condition|(
name|t
operator|<=
literal|512
condition|)
block|{
if|if
condition|(
name|t
operator|<=
literal|32
condition|)
block|{
return|return
name|tr_median3
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|middle
argument_list|,
name|last
operator|-
literal|1
argument_list|)
return|;
block|}
else|else
block|{
name|t
operator|>>=
literal|2
expr_stmt|;
return|return
name|tr_median5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|first
operator|+
name|t
argument_list|,
name|middle
argument_list|,
name|last
operator|-
literal|1
operator|-
name|t
argument_list|,
name|last
operator|-
literal|1
argument_list|)
return|;
block|}
block|}
name|t
operator|>>=
literal|3
expr_stmt|;
name|first
operator|=
name|tr_median3
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|first
operator|+
name|t
argument_list|,
name|first
operator|+
operator|(
name|t
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|middle
operator|=
name|tr_median3
argument_list|(
name|ISAd
argument_list|,
name|middle
operator|-
name|t
argument_list|,
name|middle
argument_list|,
name|middle
operator|+
name|t
argument_list|)
expr_stmt|;
name|last
operator|=
name|tr_median3
argument_list|(
name|ISAd
argument_list|,
name|last
operator|-
literal|1
operator|-
operator|(
name|t
operator|<<
literal|1
operator|)
argument_list|,
name|last
operator|-
literal|1
operator|-
name|t
argument_list|,
name|last
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
name|tr_median3
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|middle
argument_list|,
name|last
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_typedef
typedef|typedef
name|struct
name|_trbudget_t
name|trbudget_t
typedef|;
end_typedef

begin_struct
struct|struct
name|_trbudget_t
block|{
name|saidx_t
name|chance
decl_stmt|;
name|saidx_t
name|remain
decl_stmt|;
name|saidx_t
name|incval
decl_stmt|;
name|saidx_t
name|count
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|INLINE
name|void
name|trbudget_init
parameter_list|(
name|trbudget_t
modifier|*
name|budget
parameter_list|,
name|saidx_t
name|chance
parameter_list|,
name|saidx_t
name|incval
parameter_list|)
block|{
name|budget
operator|->
name|chance
operator|=
name|chance
expr_stmt|;
name|budget
operator|->
name|remain
operator|=
name|budget
operator|->
name|incval
operator|=
name|incval
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|INLINE
name|saint_t
name|trbudget_check
parameter_list|(
name|trbudget_t
modifier|*
name|budget
parameter_list|,
name|saidx_t
name|size
parameter_list|)
block|{
if|if
condition|(
name|size
operator|<=
name|budget
operator|->
name|remain
condition|)
block|{
name|budget
operator|->
name|remain
operator|-=
name|size
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
name|budget
operator|->
name|chance
operator|==
literal|0
condition|)
block|{
name|budget
operator|->
name|count
operator|+=
name|size
expr_stmt|;
return|return
literal|0
return|;
block|}
name|budget
operator|->
name|remain
operator|+=
name|budget
operator|->
name|incval
operator|-
name|size
expr_stmt|;
name|budget
operator|->
name|chance
operator|-=
literal|1
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|INLINE
name|void
name|tr_partition
parameter_list|(
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|middle
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|,
name|saidx_t
modifier|*
modifier|*
name|pa
parameter_list|,
name|saidx_t
modifier|*
modifier|*
name|pb
parameter_list|,
name|saidx_t
name|v
parameter_list|)
block|{
name|saidx_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|c
decl_stmt|,
modifier|*
name|d
decl_stmt|,
modifier|*
name|e
decl_stmt|,
modifier|*
name|f
decl_stmt|;
name|saidx_t
name|t
decl_stmt|,
name|s
decl_stmt|;
name|saidx_t
name|x
init|=
literal|0
decl_stmt|;
for|for
control|(
name|b
operator|=
name|middle
operator|-
literal|1
init|;
operator|(
operator|++
name|b
operator|<
name|last
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|b
index|]
operator|)
operator|==
name|v
operator|)
condition|;
control|)
block|{ }
if|if
condition|(
operator|(
operator|(
name|a
operator|=
name|b
operator|)
operator|<
name|last
operator|)
operator|&&
operator|(
name|x
operator|<
name|v
operator|)
condition|)
block|{
for|for
control|(
init|;
operator|(
operator|++
name|b
operator|<
name|last
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|b
index|]
operator|)
operator|<=
name|v
operator|)
condition|;
control|)
block|{
if|if
condition|(
name|x
operator|==
name|v
condition|)
block|{
name|SWAP
argument_list|(
operator|*
name|b
argument_list|,
operator|*
name|a
argument_list|)
expr_stmt|;
operator|++
name|a
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|c
operator|=
name|last
init|;
operator|(
name|b
operator|<
operator|--
name|c
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|c
index|]
operator|)
operator|==
name|v
operator|)
condition|;
control|)
block|{ }
if|if
condition|(
operator|(
name|b
operator|<
operator|(
name|d
operator|=
name|c
operator|)
operator|)
operator|&&
operator|(
name|x
operator|>
name|v
operator|)
condition|)
block|{
for|for
control|(
init|;
operator|(
name|b
operator|<
operator|--
name|c
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|c
index|]
operator|)
operator|>=
name|v
operator|)
condition|;
control|)
block|{
if|if
condition|(
name|x
operator|==
name|v
condition|)
block|{
name|SWAP
argument_list|(
operator|*
name|c
argument_list|,
operator|*
name|d
argument_list|)
expr_stmt|;
operator|--
name|d
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
init|;
name|b
operator|<
name|c
condition|;
control|)
block|{
name|SWAP
argument_list|(
operator|*
name|b
argument_list|,
operator|*
name|c
argument_list|)
expr_stmt|;
for|for
control|(
init|;
operator|(
operator|++
name|b
operator|<
name|c
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|b
index|]
operator|)
operator|<=
name|v
operator|)
condition|;
control|)
block|{
if|if
condition|(
name|x
operator|==
name|v
condition|)
block|{
name|SWAP
argument_list|(
operator|*
name|b
argument_list|,
operator|*
name|a
argument_list|)
expr_stmt|;
operator|++
name|a
expr_stmt|;
block|}
block|}
for|for
control|(
init|;
operator|(
name|b
operator|<
operator|--
name|c
operator|)
operator|&&
operator|(
operator|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|c
index|]
operator|)
operator|>=
name|v
operator|)
condition|;
control|)
block|{
if|if
condition|(
name|x
operator|==
name|v
condition|)
block|{
name|SWAP
argument_list|(
operator|*
name|c
argument_list|,
operator|*
name|d
argument_list|)
expr_stmt|;
operator|--
name|d
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|a
operator|<=
name|d
condition|)
block|{
name|c
operator|=
name|b
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|s
operator|=
name|a
operator|-
name|first
operator|)
operator|>
operator|(
name|t
operator|=
name|b
operator|-
name|a
operator|)
condition|)
block|{
name|s
operator|=
name|t
expr_stmt|;
block|}
for|for
control|(
name|e
operator|=
name|first
operator|,
name|f
operator|=
name|b
operator|-
name|s
init|;
literal|0
operator|<
name|s
condition|;
operator|--
name|s
operator|,
operator|++
name|e
operator|,
operator|++
name|f
control|)
block|{
name|SWAP
argument_list|(
operator|*
name|e
argument_list|,
operator|*
name|f
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|s
operator|=
name|d
operator|-
name|c
operator|)
operator|>
operator|(
name|t
operator|=
name|last
operator|-
name|d
operator|-
literal|1
operator|)
condition|)
block|{
name|s
operator|=
name|t
expr_stmt|;
block|}
for|for
control|(
name|e
operator|=
name|b
operator|,
name|f
operator|=
name|last
operator|-
name|s
init|;
literal|0
operator|<
name|s
condition|;
operator|--
name|s
operator|,
operator|++
name|e
operator|,
operator|++
name|f
control|)
block|{
name|SWAP
argument_list|(
operator|*
name|e
argument_list|,
operator|*
name|f
argument_list|)
expr_stmt|;
block|}
name|first
operator|+=
operator|(
name|b
operator|-
name|a
operator|)
operator|,
name|last
operator|-=
operator|(
name|d
operator|-
name|c
operator|)
expr_stmt|;
block|}
operator|*
name|pa
operator|=
name|first
operator|,
operator|*
name|pb
operator|=
name|last
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
name|tr_copy
parameter_list|(
name|saidx_t
modifier|*
name|ISA
parameter_list|,
specifier|const
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|a
parameter_list|,
name|saidx_t
modifier|*
name|b
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|,
name|saidx_t
name|depth
parameter_list|)
block|{
comment|/* sort suffixes of middle partition      by using sorted order of suffixes of left and right partition. */
name|saidx_t
modifier|*
name|c
decl_stmt|,
modifier|*
name|d
decl_stmt|,
modifier|*
name|e
decl_stmt|;
name|saidx_t
name|s
decl_stmt|,
name|v
decl_stmt|;
name|v
operator|=
name|b
operator|-
name|SA
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|c
operator|=
name|first
operator|,
name|d
operator|=
name|a
operator|-
literal|1
init|;
name|c
operator|<=
name|d
condition|;
operator|++
name|c
control|)
block|{
if|if
condition|(
operator|(
literal|0
operator|<=
operator|(
name|s
operator|=
operator|*
name|c
operator|-
name|depth
operator|)
operator|)
operator|&&
operator|(
name|ISA
index|[
name|s
index|]
operator|==
name|v
operator|)
condition|)
block|{
operator|*
operator|++
name|d
operator|=
name|s
expr_stmt|;
name|ISA
index|[
name|s
index|]
operator|=
name|d
operator|-
name|SA
expr_stmt|;
block|}
block|}
for|for
control|(
name|c
operator|=
name|last
operator|-
literal|1
operator|,
name|e
operator|=
name|d
operator|+
literal|1
operator|,
name|d
operator|=
name|b
init|;
name|e
operator|<
name|d
condition|;
operator|--
name|c
control|)
block|{
if|if
condition|(
operator|(
literal|0
operator|<=
operator|(
name|s
operator|=
operator|*
name|c
operator|-
name|depth
operator|)
operator|)
operator|&&
operator|(
name|ISA
index|[
name|s
index|]
operator|==
name|v
operator|)
condition|)
block|{
operator|*
operator|--
name|d
operator|=
name|s
expr_stmt|;
name|ISA
index|[
name|s
index|]
operator|=
name|d
operator|-
name|SA
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tr_partialcopy
parameter_list|(
name|saidx_t
modifier|*
name|ISA
parameter_list|,
specifier|const
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|a
parameter_list|,
name|saidx_t
modifier|*
name|b
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|,
name|saidx_t
name|depth
parameter_list|)
block|{
name|saidx_t
modifier|*
name|c
decl_stmt|,
modifier|*
name|d
decl_stmt|,
modifier|*
name|e
decl_stmt|;
name|saidx_t
name|s
decl_stmt|,
name|v
decl_stmt|;
name|saidx_t
name|rank
decl_stmt|,
name|lastrank
decl_stmt|,
name|newrank
init|=
operator|-
literal|1
decl_stmt|;
name|v
operator|=
name|b
operator|-
name|SA
operator|-
literal|1
expr_stmt|;
name|lastrank
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|c
operator|=
name|first
operator|,
name|d
operator|=
name|a
operator|-
literal|1
init|;
name|c
operator|<=
name|d
condition|;
operator|++
name|c
control|)
block|{
if|if
condition|(
operator|(
literal|0
operator|<=
operator|(
name|s
operator|=
operator|*
name|c
operator|-
name|depth
operator|)
operator|)
operator|&&
operator|(
name|ISA
index|[
name|s
index|]
operator|==
name|v
operator|)
condition|)
block|{
operator|*
operator|++
name|d
operator|=
name|s
expr_stmt|;
name|rank
operator|=
name|ISA
index|[
name|s
operator|+
name|depth
index|]
expr_stmt|;
if|if
condition|(
name|lastrank
operator|!=
name|rank
condition|)
block|{
name|lastrank
operator|=
name|rank
expr_stmt|;
name|newrank
operator|=
name|d
operator|-
name|SA
expr_stmt|;
block|}
name|ISA
index|[
name|s
index|]
operator|=
name|newrank
expr_stmt|;
block|}
block|}
name|lastrank
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|e
operator|=
name|d
init|;
name|first
operator|<=
name|e
condition|;
operator|--
name|e
control|)
block|{
name|rank
operator|=
name|ISA
index|[
operator|*
name|e
index|]
expr_stmt|;
if|if
condition|(
name|lastrank
operator|!=
name|rank
condition|)
block|{
name|lastrank
operator|=
name|rank
expr_stmt|;
name|newrank
operator|=
name|e
operator|-
name|SA
expr_stmt|;
block|}
if|if
condition|(
name|newrank
operator|!=
name|rank
condition|)
block|{
name|ISA
index|[
operator|*
name|e
index|]
operator|=
name|newrank
expr_stmt|;
block|}
block|}
name|lastrank
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|c
operator|=
name|last
operator|-
literal|1
operator|,
name|e
operator|=
name|d
operator|+
literal|1
operator|,
name|d
operator|=
name|b
init|;
name|e
operator|<
name|d
condition|;
operator|--
name|c
control|)
block|{
if|if
condition|(
operator|(
literal|0
operator|<=
operator|(
name|s
operator|=
operator|*
name|c
operator|-
name|depth
operator|)
operator|)
operator|&&
operator|(
name|ISA
index|[
name|s
index|]
operator|==
name|v
operator|)
condition|)
block|{
operator|*
operator|--
name|d
operator|=
name|s
expr_stmt|;
name|rank
operator|=
name|ISA
index|[
name|s
operator|+
name|depth
index|]
expr_stmt|;
if|if
condition|(
name|lastrank
operator|!=
name|rank
condition|)
block|{
name|lastrank
operator|=
name|rank
expr_stmt|;
name|newrank
operator|=
name|d
operator|-
name|SA
expr_stmt|;
block|}
name|ISA
index|[
name|s
index|]
operator|=
name|newrank
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
name|tr_introsort
parameter_list|(
name|saidx_t
modifier|*
name|ISA
parameter_list|,
specifier|const
name|saidx_t
modifier|*
name|ISAd
parameter_list|,
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
modifier|*
name|first
parameter_list|,
name|saidx_t
modifier|*
name|last
parameter_list|,
name|trbudget_t
modifier|*
name|budget
parameter_list|)
block|{
define|#
directive|define
name|STACK_SIZE
value|TR_STACKSIZE
struct|struct
block|{
specifier|const
name|saidx_t
modifier|*
name|a
decl_stmt|;
name|saidx_t
modifier|*
name|b
decl_stmt|,
modifier|*
name|c
decl_stmt|;
name|saint_t
name|d
decl_stmt|,
name|e
decl_stmt|;
block|}
name|stack
index|[
name|STACK_SIZE
index|]
struct|;
name|saidx_t
modifier|*
name|a
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|c
decl_stmt|;
name|saidx_t
name|t
decl_stmt|;
name|saidx_t
name|v
decl_stmt|,
name|x
init|=
literal|0
decl_stmt|;
name|saidx_t
name|incr
init|=
name|ISAd
operator|-
name|ISA
decl_stmt|;
name|saint_t
name|limit
decl_stmt|,
name|next
decl_stmt|;
name|saint_t
name|ssize
decl_stmt|,
name|trlink
init|=
operator|-
literal|1
decl_stmt|;
for|for
control|(
name|ssize
operator|=
literal|0
operator|,
name|limit
operator|=
name|tr_ilg
argument_list|(
name|last
operator|-
name|first
argument_list|)
init|;
condition|;
control|)
block|{
if|if
condition|(
name|limit
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|limit
operator|==
operator|-
literal|1
condition|)
block|{
comment|/* tandem repeat partition */
name|tr_partition
argument_list|(
name|ISAd
operator|-
name|incr
argument_list|,
name|first
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
name|last
operator|-
name|SA
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* update ranks */
if|if
condition|(
name|a
operator|<
name|last
condition|)
block|{
for|for
control|(
name|c
operator|=
name|first
operator|,
name|v
operator|=
name|a
operator|-
name|SA
operator|-
literal|1
init|;
name|c
operator|<
name|a
condition|;
operator|++
name|c
control|)
block|{
name|ISA
index|[
operator|*
name|c
index|]
operator|=
name|v
expr_stmt|;
block|}
block|}
if|if
condition|(
name|b
operator|<
name|last
condition|)
block|{
for|for
control|(
name|c
operator|=
name|a
operator|,
name|v
operator|=
name|b
operator|-
name|SA
operator|-
literal|1
init|;
name|c
operator|<
name|b
condition|;
operator|++
name|c
control|)
block|{
name|ISA
index|[
operator|*
name|c
index|]
operator|=
name|v
expr_stmt|;
block|}
block|}
comment|/* push */
if|if
condition|(
literal|1
operator|<
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|NULL
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|-
name|incr
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
operator|-
literal|2
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|trlink
operator|=
name|ssize
operator|-
literal|2
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|tr_ilg
argument_list|(
name|last
operator|-
name|b
argument_list|)
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|last
operator|=
name|a
operator|,
name|limit
operator|=
name|tr_ilg
argument_list|(
name|a
operator|-
name|first
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|first
operator|=
name|b
operator|,
name|limit
operator|=
name|tr_ilg
argument_list|(
name|last
operator|-
name|b
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|tr_ilg
argument_list|(
name|a
operator|-
name|first
argument_list|)
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|b
operator|,
name|limit
operator|=
name|tr_ilg
argument_list|(
name|last
operator|-
name|b
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|last
operator|=
name|a
operator|,
name|limit
operator|=
name|tr_ilg
argument_list|(
name|a
operator|-
name|first
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|limit
operator|==
operator|-
literal|2
condition|)
block|{
comment|/* tandem repeat copy */
name|a
operator|=
name|stack
index|[
operator|--
name|ssize
index|]
operator|.
name|b
operator|,
name|b
operator|=
name|stack
index|[
name|ssize
index|]
operator|.
name|c
expr_stmt|;
if|if
condition|(
name|stack
index|[
name|ssize
index|]
operator|.
name|d
operator|==
literal|0
condition|)
block|{
name|tr_copy
argument_list|(
name|ISA
argument_list|,
name|SA
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|ISAd
operator|-
name|ISA
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
literal|0
operator|<=
name|trlink
condition|)
block|{
name|stack
index|[
name|trlink
index|]
operator|.
name|d
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|tr_partialcopy
argument_list|(
name|ISA
argument_list|,
name|SA
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|ISAd
operator|-
name|ISA
argument_list|)
expr_stmt|;
block|}
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* sorted partition */
if|if
condition|(
literal|0
operator|<=
operator|*
name|first
condition|)
block|{
name|a
operator|=
name|first
expr_stmt|;
do|do
block|{
name|ISA
index|[
operator|*
name|a
index|]
operator|=
name|a
operator|-
name|SA
expr_stmt|;
block|}
do|while
condition|(
operator|(
operator|++
name|a
operator|<
name|last
operator|)
operator|&&
operator|(
literal|0
operator|<=
operator|*
name|a
operator|)
condition|)
do|;
name|first
operator|=
name|a
expr_stmt|;
block|}
if|if
condition|(
name|first
operator|<
name|last
condition|)
block|{
name|a
operator|=
name|first
expr_stmt|;
do|do
block|{
operator|*
name|a
operator|=
operator|~
operator|*
name|a
expr_stmt|;
block|}
do|while
condition|(
operator|*
operator|++
name|a
operator|<
literal|0
condition|)
do|;
name|next
operator|=
operator|(
name|ISA
index|[
operator|*
name|a
index|]
operator|!=
name|ISAd
index|[
operator|*
name|a
index|]
operator|)
condition|?
name|tr_ilg
argument_list|(
name|a
operator|-
name|first
operator|+
literal|1
argument_list|)
else|:
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|++
name|a
operator|<
name|last
condition|)
block|{
for|for
control|(
name|b
operator|=
name|first
operator|,
name|v
operator|=
name|a
operator|-
name|SA
operator|-
literal|1
init|;
name|b
operator|<
name|a
condition|;
operator|++
name|b
control|)
block|{
name|ISA
index|[
operator|*
name|b
index|]
operator|=
name|v
expr_stmt|;
block|}
block|}
comment|/* push */
if|if
condition|(
name|trbudget_check
argument_list|(
name|budget
argument_list|,
name|a
operator|-
name|first
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|last
operator|-
name|a
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|a
argument_list|,
name|last
argument_list|,
operator|-
literal|3
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|ISAd
operator|+=
name|incr
operator|,
name|last
operator|=
name|a
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|a
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|a
operator|,
name|limit
operator|=
operator|-
literal|3
expr_stmt|;
block|}
else|else
block|{
name|ISAd
operator|+=
name|incr
operator|,
name|last
operator|=
name|a
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
literal|0
operator|<=
name|trlink
condition|)
block|{
name|stack
index|[
name|trlink
index|]
operator|.
name|d
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|a
operator|)
condition|)
block|{
name|first
operator|=
name|a
operator|,
name|limit
operator|=
operator|-
literal|3
expr_stmt|;
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
continue|continue;
block|}
if|if
condition|(
operator|(
name|last
operator|-
name|first
operator|)
operator|<=
name|TR_INSERTIONSORT_THRESHOLD
condition|)
block|{
name|tr_insertionsort
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|)
expr_stmt|;
name|limit
operator|=
operator|-
literal|3
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|limit
operator|--
operator|==
literal|0
condition|)
block|{
name|tr_heapsort
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
operator|-
name|first
argument_list|)
expr_stmt|;
for|for
control|(
name|a
operator|=
name|last
operator|-
literal|1
init|;
name|first
operator|<
name|a
condition|;
name|a
operator|=
name|b
control|)
block|{
for|for
control|(
name|x
operator|=
name|ISAd
index|[
operator|*
name|a
index|]
operator|,
name|b
operator|=
name|a
operator|-
literal|1
init|;
operator|(
name|first
operator|<=
name|b
operator|)
operator|&&
operator|(
name|ISAd
index|[
operator|*
name|b
index|]
operator|==
name|x
operator|)
condition|;
operator|--
name|b
control|)
block|{
operator|*
name|b
operator|=
operator|~
operator|*
name|b
expr_stmt|;
block|}
block|}
name|limit
operator|=
operator|-
literal|3
expr_stmt|;
continue|continue;
block|}
comment|/* choose pivot */
name|a
operator|=
name|tr_pivot
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
operator|*
name|first
argument_list|,
operator|*
name|a
argument_list|)
expr_stmt|;
name|v
operator|=
name|ISAd
index|[
operator|*
name|first
index|]
expr_stmt|;
comment|/* partition */
name|tr_partition
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|first
operator|+
literal|1
argument_list|,
name|last
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|b
argument_list|,
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|last
operator|-
name|first
operator|)
operator|!=
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
name|next
operator|=
operator|(
name|ISA
index|[
operator|*
name|a
index|]
operator|!=
name|v
operator|)
condition|?
name|tr_ilg
argument_list|(
name|b
operator|-
name|a
argument_list|)
else|:
operator|-
literal|1
expr_stmt|;
comment|/* update ranks */
for|for
control|(
name|c
operator|=
name|first
operator|,
name|v
operator|=
name|a
operator|-
name|SA
operator|-
literal|1
init|;
name|c
operator|<
name|a
condition|;
operator|++
name|c
control|)
block|{
name|ISA
index|[
operator|*
name|c
index|]
operator|=
name|v
expr_stmt|;
block|}
if|if
condition|(
name|b
operator|<
name|last
condition|)
block|{
for|for
control|(
name|c
operator|=
name|a
operator|,
name|v
operator|=
name|b
operator|-
name|SA
operator|-
literal|1
init|;
name|c
operator|<
name|b
condition|;
operator|++
name|c
control|)
block|{
name|ISA
index|[
operator|*
name|c
index|]
operator|=
name|v
expr_stmt|;
block|}
block|}
comment|/* push */
if|if
condition|(
operator|(
literal|1
operator|<
operator|(
name|b
operator|-
name|a
operator|)
operator|)
operator|&&
operator|(
name|trbudget_check
argument_list|(
name|budget
argument_list|,
name|b
operator|-
name|a
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|last
operator|-
name|b
operator|)
operator|<=
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|last
operator|=
name|a
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|b
expr_stmt|;
block|}
else|else
block|{
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|last
operator|=
name|a
expr_stmt|;
block|}
else|else
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
else|else
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|b
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|last
operator|=
name|a
expr_stmt|;
block|}
else|else
block|{
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|last
operator|-
name|b
operator|)
operator|<=
operator|(
name|b
operator|-
name|a
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
operator|+
name|incr
argument_list|,
name|a
argument_list|,
name|b
argument_list|,
name|next
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|b
expr_stmt|;
block|}
else|else
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
else|else
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|ISAd
operator|+=
name|incr
operator|,
name|first
operator|=
name|a
operator|,
name|last
operator|=
name|b
operator|,
name|limit
operator|=
name|next
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
literal|1
operator|<
operator|(
name|b
operator|-
name|a
operator|)
operator|)
operator|&&
operator|(
literal|0
operator|<=
name|trlink
operator|)
condition|)
block|{
name|stack
index|[
name|trlink
index|]
operator|.
name|d
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|a
operator|-
name|first
operator|)
operator|<=
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|b
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|last
operator|=
name|a
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|first
operator|=
name|b
expr_stmt|;
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|b
operator|)
condition|)
block|{
name|STACK_PUSH5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|a
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
name|first
operator|=
name|b
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|1
operator|<
operator|(
name|a
operator|-
name|first
operator|)
condition|)
block|{
name|last
operator|=
name|a
expr_stmt|;
block|}
else|else
block|{
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|trbudget_check
argument_list|(
name|budget
argument_list|,
name|last
operator|-
name|first
argument_list|)
condition|)
block|{
name|limit
operator|=
name|tr_ilg
argument_list|(
name|last
operator|-
name|first
argument_list|)
operator|,
name|ISAd
operator|+=
name|incr
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
literal|0
operator|<=
name|trlink
condition|)
block|{
name|stack
index|[
name|trlink
index|]
operator|.
name|d
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|STACK_POP5
argument_list|(
name|ISAd
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
name|limit
argument_list|,
name|trlink
argument_list|)
expr_stmt|;
block|}
block|}
block|}
undef|#
directive|undef
name|STACK_SIZE
block|}
end_function

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_comment
comment|/*- Function -*/
end_comment

begin_comment
comment|/* Tandem repeat sort */
end_comment

begin_function
name|void
name|trsort
parameter_list|(
name|saidx_t
modifier|*
name|ISA
parameter_list|,
name|saidx_t
modifier|*
name|SA
parameter_list|,
name|saidx_t
name|n
parameter_list|,
name|saidx_t
name|depth
parameter_list|)
block|{
name|saidx_t
modifier|*
name|ISAd
decl_stmt|;
name|saidx_t
modifier|*
name|first
decl_stmt|,
modifier|*
name|last
decl_stmt|;
name|trbudget_t
name|budget
decl_stmt|;
name|saidx_t
name|t
decl_stmt|,
name|skip
decl_stmt|,
name|unsorted
decl_stmt|;
name|trbudget_init
argument_list|(
operator|&
name|budget
argument_list|,
name|tr_ilg
argument_list|(
name|n
argument_list|)
operator|*
literal|2
operator|/
literal|3
argument_list|,
name|n
argument_list|)
expr_stmt|;
comment|/*  trbudget_init(&budget, tr_ilg(n) * 3 / 4, n); */
for|for
control|(
name|ISAd
operator|=
name|ISA
operator|+
name|depth
init|;
operator|-
name|n
operator|<
operator|*
name|SA
condition|;
name|ISAd
operator|+=
name|ISAd
operator|-
name|ISA
control|)
block|{
name|first
operator|=
name|SA
expr_stmt|;
name|skip
operator|=
literal|0
expr_stmt|;
name|unsorted
operator|=
literal|0
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|(
name|t
operator|=
operator|*
name|first
operator|)
operator|<
literal|0
condition|)
block|{
name|first
operator|-=
name|t
expr_stmt|;
name|skip
operator|+=
name|t
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|skip
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|first
operator|+
name|skip
operator|)
operator|=
name|skip
expr_stmt|;
name|skip
operator|=
literal|0
expr_stmt|;
block|}
name|last
operator|=
name|SA
operator|+
name|ISA
index|[
name|t
index|]
operator|+
literal|1
expr_stmt|;
if|if
condition|(
literal|1
operator|<
operator|(
name|last
operator|-
name|first
operator|)
condition|)
block|{
name|budget
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|tr_introsort
argument_list|(
name|ISA
argument_list|,
name|ISAd
argument_list|,
name|SA
argument_list|,
name|first
argument_list|,
name|last
argument_list|,
operator|&
name|budget
argument_list|)
expr_stmt|;
if|if
condition|(
name|budget
operator|.
name|count
operator|!=
literal|0
condition|)
block|{
name|unsorted
operator|+=
name|budget
operator|.
name|count
expr_stmt|;
block|}
else|else
block|{
name|skip
operator|=
name|first
operator|-
name|last
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|last
operator|-
name|first
operator|)
operator|==
literal|1
condition|)
block|{
name|skip
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|first
operator|=
name|last
expr_stmt|;
block|}
block|}
do|while
condition|(
name|first
operator|<
operator|(
name|SA
operator|+
name|n
operator|)
condition|)
do|;
if|if
condition|(
name|skip
operator|!=
literal|0
condition|)
block|{
operator|*
operator|(
name|first
operator|+
name|skip
operator|)
operator|=
name|skip
expr_stmt|;
block|}
if|if
condition|(
name|unsorted
operator|==
literal|0
condition|)
block|{
break|break;
block|}
block|}
block|}
end_function

end_unit

