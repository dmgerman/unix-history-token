begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*	$FreeBSD$	*/
end_comment

begin_comment
comment|/*  * Copyright (C) 2012 by Darren Reed.  *  * See the IPFILTER.LICENCE file for details on licencing.  *  * @(#)ip_fil.h	1.35 6/5/96  * $Id$  */
end_comment

begin_typedef
typedef|typedef
struct|struct
name|ipmon_msg_s
block|{
name|int
name|imm_msglen
decl_stmt|;
name|char
modifier|*
name|imm_msg
decl_stmt|;
name|int
name|imm_dsize
decl_stmt|;
name|void
modifier|*
name|imm_data
decl_stmt|;
name|time_t
name|imm_when
decl_stmt|;
name|int
name|imm_loglevel
decl_stmt|;
block|}
name|ipmon_msg_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
name|void
function_decl|(
modifier|*
name|ims_destroy_func_t
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|void
modifier|*
function_decl|(
modifier|*
name|ims_dup_func_t
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|*
name|ims_match_func_t
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|void
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|void
modifier|*
function_decl|(
modifier|*
name|ims_parse_func_t
function_decl|)
parameter_list|(
name|char
modifier|*
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|void
function_decl|(
modifier|*
name|ims_print_func_t
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
name|int
function_decl|(
modifier|*
name|ims_store_func_t
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|ipmon_msg_t
modifier|*
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|ipmon_saver_s
block|{
name|char
modifier|*
name|ims_name
decl_stmt|;
name|ims_destroy_func_t
name|ims_destroy
decl_stmt|;
name|ims_dup_func_t
name|ims_dup
decl_stmt|;
name|ims_match_func_t
name|ims_match
decl_stmt|;
name|ims_parse_func_t
name|ims_parse
decl_stmt|;
name|ims_print_func_t
name|ims_print
decl_stmt|;
name|ims_store_func_t
name|ims_store
decl_stmt|;
block|}
name|ipmon_saver_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|ipmon_saver_int_s
block|{
name|struct
name|ipmon_saver_int_s
modifier|*
name|imsi_next
decl_stmt|;
name|ipmon_saver_t
modifier|*
name|imsi_stor
decl_stmt|;
name|void
modifier|*
name|imsi_handle
decl_stmt|;
block|}
name|ipmon_saver_int_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|ipmon_doing_s
block|{
name|struct
name|ipmon_doing_s
modifier|*
name|ipmd_next
decl_stmt|;
name|void
modifier|*
name|ipmd_token
decl_stmt|;
name|ipmon_saver_t
modifier|*
name|ipmd_saver
decl_stmt|;
comment|/* 	 * ipmd_store is "cached" in this structure to avoid a double 	 * deref when doing saves.... 	 */
name|int
function_decl|(
modifier|*
name|ipmd_store
function_decl|)
parameter_list|(
name|void
modifier|*
parameter_list|,
name|ipmon_msg_t
modifier|*
parameter_list|)
function_decl|;
block|}
name|ipmon_doing_t
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
name|ipmon_action
block|{
name|struct
name|ipmon_action
modifier|*
name|ac_next
decl_stmt|;
name|int
name|ac_mflag
decl_stmt|;
comment|/* collection of things to compare */
name|int
name|ac_dflag
decl_stmt|;
comment|/* flags to compliment the doing fields */
name|int
name|ac_logpri
decl_stmt|;
name|int
name|ac_direction
decl_stmt|;
name|char
name|ac_group
index|[
name|FR_GROUPLEN
index|]
decl_stmt|;
name|char
name|ac_nattag
index|[
literal|16
index|]
decl_stmt|;
name|u_32_t
name|ac_logtag
decl_stmt|;
name|int
name|ac_type
decl_stmt|;
comment|/* nat/state/ipf */
name|int
name|ac_proto
decl_stmt|;
name|int
name|ac_rule
decl_stmt|;
name|int
name|ac_packet
decl_stmt|;
name|int
name|ac_second
decl_stmt|;
name|int
name|ac_result
decl_stmt|;
name|u_32_t
name|ac_sip
decl_stmt|;
name|u_32_t
name|ac_smsk
decl_stmt|;
name|u_32_t
name|ac_dip
decl_stmt|;
name|u_32_t
name|ac_dmsk
decl_stmt|;
name|u_short
name|ac_sport
decl_stmt|;
name|u_short
name|ac_dport
decl_stmt|;
name|char
modifier|*
name|ac_iface
decl_stmt|;
comment|/* 	 * used with ac_packet/ac_second 	 */
name|struct
name|timeval
name|ac_last
decl_stmt|;
name|int
name|ac_pktcnt
decl_stmt|;
comment|/* 	 * What to do with matches 	 */
name|ipmon_doing_t
modifier|*
name|ac_doing
decl_stmt|;
block|}
name|ipmon_action_t
typedef|;
end_typedef

begin_define
define|#
directive|define
name|ac_lastsec
value|ac_last.tv_sec
end_define

begin_define
define|#
directive|define
name|ac_lastusec
value|ac_last.tv_usec
end_define

begin_comment
comment|/*  * Flags indicating what fields to do matching upon (ac_mflag).  */
end_comment

begin_define
define|#
directive|define
name|IPMAC_DIRECTION
value|0x0001
end_define

begin_define
define|#
directive|define
name|IPMAC_DSTIP
value|0x0002
end_define

begin_define
define|#
directive|define
name|IPMAC_DSTPORT
value|0x0004
end_define

begin_define
define|#
directive|define
name|IPMAC_EVERY
value|0x0008
end_define

begin_define
define|#
directive|define
name|IPMAC_GROUP
value|0x0010
end_define

begin_define
define|#
directive|define
name|IPMAC_INTERFACE
value|0x0020
end_define

begin_define
define|#
directive|define
name|IPMAC_LOGTAG
value|0x0040
end_define

begin_define
define|#
directive|define
name|IPMAC_NATTAG
value|0x0080
end_define

begin_define
define|#
directive|define
name|IPMAC_PROTOCOL
value|0x0100
end_define

begin_define
define|#
directive|define
name|IPMAC_RESULT
value|0x0200
end_define

begin_define
define|#
directive|define
name|IPMAC_RULE
value|0x0400
end_define

begin_define
define|#
directive|define
name|IPMAC_SRCIP
value|0x0800
end_define

begin_define
define|#
directive|define
name|IPMAC_SRCPORT
value|0x1000
end_define

begin_define
define|#
directive|define
name|IPMAC_TYPE
value|0x2000
end_define

begin_define
define|#
directive|define
name|IPMAC_WITH
value|0x4000
end_define

begin_define
define|#
directive|define
name|IPMR_BLOCK
value|1
end_define

begin_define
define|#
directive|define
name|IPMR_PASS
value|2
end_define

begin_define
define|#
directive|define
name|IPMR_NOMATCH
value|3
end_define

begin_define
define|#
directive|define
name|IPMR_LOG
value|4
end_define

begin_define
define|#
directive|define
name|IPMON_SYSLOG
value|0x001
end_define

begin_define
define|#
directive|define
name|IPMON_RESOLVE
value|0x002
end_define

begin_define
define|#
directive|define
name|IPMON_HEXBODY
value|0x004
end_define

begin_define
define|#
directive|define
name|IPMON_HEXHDR
value|0x010
end_define

begin_define
define|#
directive|define
name|IPMON_TAIL
value|0x020
end_define

begin_define
define|#
directive|define
name|IPMON_VERBOSE
value|0x040
end_define

begin_define
define|#
directive|define
name|IPMON_NAT
value|0x080
end_define

begin_define
define|#
directive|define
name|IPMON_STATE
value|0x100
end_define

begin_define
define|#
directive|define
name|IPMON_FILTER
value|0x200
end_define

begin_define
define|#
directive|define
name|IPMON_PORTNUM
value|0x400
end_define

begin_define
define|#
directive|define
name|IPMON_LOGALL
value|(IPMON_NAT|IPMON_STATE|IPMON_FILTER)
end_define

begin_define
define|#
directive|define
name|IPMON_LOGBODY
value|0x800
end_define

begin_define
define|#
directive|define
name|HOSTNAME_V4
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|hostname((a), 4, (u_32_t *)&(b))
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|LOGFAC
end_ifndef

begin_define
define|#
directive|define
name|LOGFAC
value|LOG_LOCAL0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
specifier|extern
name|void
name|dump_config
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|load_config
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|unload_config
name|__P
argument_list|(
operator|(
name|void
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
name|dumphex
name|__P
argument_list|(
operator|(
name|FILE
operator|*
operator|,
name|int
operator|,
name|char
operator|*
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|check_action
name|__P
argument_list|(
operator|(
name|char
operator|*
operator|,
name|char
operator|*
operator|,
name|int
operator|,
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|char
modifier|*
name|getword
name|__P
argument_list|(
operator|(
name|int
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|void
modifier|*
name|add_doing
name|__P
argument_list|(
operator|(
name|ipmon_saver_t
operator|*
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt

end_unit

