begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * Common (shared) DLPI test routines.  * Mostly pretty boring boilerplate sorta stuff.  * These can be split into individual library routines later  * but it's just convenient to keep them in a single file  * while they're being developed.  *  * Not supported:  *   Connection Oriented stuff  *   QOS stuff  */
end_comment

begin_comment
comment|/* typedef	unsigned long	ulong; */
end_comment

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stream.h>
end_include

begin_include
include|#
directive|include
file|<sys/stropts.h>
end_include

begin_include
include|#
directive|include
file|<sys/dlpi.h>
end_include

begin_include
include|#
directive|include
file|<sys/signal.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"dltest.h"
end_include

begin_define
define|#
directive|define
name|CASERET
parameter_list|(
name|s
parameter_list|)
value|case s:  return ("s")
end_define

begin_function_decl
name|char
modifier|*
name|dlprim
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlstate
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlerrno
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlpromisclevel
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlservicemode
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlstyle
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
name|dlmactype
parameter_list|()
function_decl|;
end_function_decl

begin_macro
name|dlinforeq
argument_list|(
argument|fd
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_info_req_t
name|info_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|info_req
operator|.
name|dl_primitive
operator|=
name|DL_INFO_REQ
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|info_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|info_req
expr_stmt|;
name|flags
operator|=
name|RS_HIPRI
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlinforeq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlinfoack
argument_list|(
argument|fd
argument_list|,
argument|bufp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|bufp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
name|MAXDLBUF
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
name|bufp
expr_stmt|;
name|strgetmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|flags
argument_list|,
literal|"dlinfoack"
argument_list|)
expr_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|ctl
operator|.
name|buf
expr_stmt|;
name|expecting
argument_list|(
name|DL_INFO_ACK
argument_list|,
name|dlp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_info_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlinfoack:  response ctl.len too short:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|!=
name|RS_HIPRI
condition|)
name|err
argument_list|(
literal|"dlinfoack:  DL_INFO_ACK was not M_PCPROTO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_info_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlinfoack:  short response ctl.len:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlattachreq
argument_list|(
argument|fd
argument_list|,
argument|ppa
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|ppa
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_attach_req_t
name|attach_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|attach_req
operator|.
name|dl_primitive
operator|=
name|DL_ATTACH_REQ
expr_stmt|;
name|attach_req
operator|.
name|dl_ppa
operator|=
name|ppa
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|attach_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|attach_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlattachreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlenabmultireq
argument_list|(
argument|fd
argument_list|,
argument|addr
argument_list|,
argument|length
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|length
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|buf
index|[
name|MAXDLBUF
index|]
decl_stmt|;
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|buf
expr_stmt|;
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_primitive
operator|=
name|DL_ENABMULTI_REQ
expr_stmt|;
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_length
operator|=
name|length
expr_stmt|;
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_offset
operator|=
sizeof|sizeof
argument_list|(
name|dl_enabmulti_req_t
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|OFFADDR
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|dl_enabmulti_req_t
argument_list|)
argument_list|)
argument_list|,
name|addr
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|dl_enabmulti_req_t
argument_list|)
operator|+
name|length
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlenabmultireq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dldisabmultireq
argument_list|(
argument|fd
argument_list|,
argument|addr
argument_list|,
argument|length
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|length
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|buf
index|[
name|MAXDLBUF
index|]
decl_stmt|;
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|buf
expr_stmt|;
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_primitive
operator|=
name|DL_ENABMULTI_REQ
expr_stmt|;
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_length
operator|=
name|length
expr_stmt|;
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_offset
operator|=
sizeof|sizeof
argument_list|(
name|dl_disabmulti_req_t
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|OFFADDR
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|dl_disabmulti_req_t
argument_list|)
argument_list|)
argument_list|,
name|addr
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|dl_disabmulti_req_t
argument_list|)
operator|+
name|length
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dldisabmultireq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlpromisconreq
argument_list|(
argument|fd
argument_list|,
argument|level
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|level
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_promiscon_req_t
name|promiscon_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|promiscon_req
operator|.
name|dl_primitive
operator|=
name|DL_PROMISCON_REQ
expr_stmt|;
name|promiscon_req
operator|.
name|dl_level
operator|=
name|level
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|promiscon_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|promiscon_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlpromiscon:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlpromiscoff
argument_list|(
argument|fd
argument_list|,
argument|level
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|level
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_promiscoff_req_t
name|promiscoff_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|promiscoff_req
operator|.
name|dl_primitive
operator|=
name|DL_PROMISCOFF_REQ
expr_stmt|;
name|promiscoff_req
operator|.
name|dl_level
operator|=
name|level
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|promiscoff_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|promiscoff_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlpromiscoff:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlphysaddrreq
argument_list|(
argument|fd
argument_list|,
argument|addrtype
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|addrtype
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_phys_addr_req_t
name|phys_addr_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|phys_addr_req
operator|.
name|dl_primitive
operator|=
name|DL_PHYS_ADDR_REQ
expr_stmt|;
name|phys_addr_req
operator|.
name|dl_addr_type
operator|=
name|addrtype
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|phys_addr_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|phys_addr_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlphysaddrreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlsetphysaddrreq
argument_list|(
argument|fd
argument_list|,
argument|addr
argument_list|,
argument|length
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|length
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|buf
index|[
name|MAXDLBUF
index|]
decl_stmt|;
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|buf
expr_stmt|;
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_primitive
operator|=
name|DL_ENABMULTI_REQ
expr_stmt|;
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_length
operator|=
name|length
expr_stmt|;
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_offset
operator|=
sizeof|sizeof
argument_list|(
name|dl_set_phys_addr_req_t
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|OFFADDR
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|dl_set_phys_addr_req_t
argument_list|)
argument_list|)
argument_list|,
name|addr
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|dl_set_phys_addr_req_t
argument_list|)
operator|+
name|length
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlsetphysaddrreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dldetachreq
argument_list|(
argument|fd
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_detach_req_t
name|detach_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|detach_req
operator|.
name|dl_primitive
operator|=
name|DL_DETACH_REQ
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|detach_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|detach_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dldetachreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlbindreq
argument_list|(
argument|fd
argument_list|,
argument|sap
argument_list|,
argument|max_conind
argument_list|,
argument|service_mode
argument_list|,
argument|conn_mgmt
argument_list|,
argument|xidtest
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|sap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|max_conind
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|service_mode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|conn_mgmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|xidtest
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_bind_req_t
name|bind_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|bind_req
operator|.
name|dl_primitive
operator|=
name|DL_BIND_REQ
expr_stmt|;
name|bind_req
operator|.
name|dl_sap
operator|=
name|sap
expr_stmt|;
name|bind_req
operator|.
name|dl_max_conind
operator|=
name|max_conind
expr_stmt|;
name|bind_req
operator|.
name|dl_service_mode
operator|=
name|service_mode
expr_stmt|;
name|bind_req
operator|.
name|dl_conn_mgmt
operator|=
name|conn_mgmt
expr_stmt|;
name|bind_req
operator|.
name|dl_xidtest_flg
operator|=
name|xidtest
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|bind_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|bind_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlbindreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlunitdatareq
argument_list|(
argument|fd
argument_list|,
argument|addrp
argument_list|,
argument|addrlen
argument_list|,
argument|minpri
argument_list|,
argument|maxpri
argument_list|,
argument|datap
argument_list|,
argument|datalen
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
modifier|*
name|addrp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|addrlen
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|minpri
decl_stmt|,
name|maxpri
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
modifier|*
name|datap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|datalen
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|long
name|buf
index|[
name|MAXDLBUF
index|]
decl_stmt|;
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|data
decl_stmt|,
name|ctl
decl_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|buf
expr_stmt|;
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_primitive
operator|=
name|DL_UNITDATA_REQ
expr_stmt|;
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_length
operator|=
name|addrlen
expr_stmt|;
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_offset
operator|=
sizeof|sizeof
argument_list|(
name|dl_unitdata_req_t
argument_list|)
expr_stmt|;
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_priority
operator|.
name|dl_min
operator|=
name|minpri
expr_stmt|;
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_priority
operator|.
name|dl_max
operator|=
name|maxpri
expr_stmt|;
operator|(
name|void
operator|)
name|memcpy
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
sizeof|sizeof
argument_list|(
name|dl_unitdata_req_t
argument_list|)
argument_list|)
argument_list|,
name|addrp
argument_list|,
name|addrlen
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|dl_unitdata_req_t
argument_list|)
operator|+
name|addrlen
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|buf
expr_stmt|;
name|data
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|data
operator|.
name|len
operator|=
name|datalen
expr_stmt|;
name|data
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
name|datap
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|&
name|data
argument_list|,
literal|0
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlunitdatareq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlunbindreq
argument_list|(
argument|fd
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|dl_unbind_req_t
name|unbind_req
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|unbind_req
operator|.
name|dl_primitive
operator|=
name|DL_UNBIND_REQ
expr_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
sizeof|sizeof
argument_list|(
name|unbind_req
argument_list|)
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
operator|(
name|char
operator|*
operator|)
operator|&
name|unbind_req
expr_stmt|;
name|flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|putmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
name|flags
argument_list|)
operator|<
literal|0
condition|)
name|syserr
argument_list|(
literal|"dlunbindreq:  putmsg"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlokack
argument_list|(
argument|fd
argument_list|,
argument|bufp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|bufp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
name|MAXDLBUF
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
name|bufp
expr_stmt|;
name|strgetmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|flags
argument_list|,
literal|"dlokack"
argument_list|)
expr_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|ctl
operator|.
name|buf
expr_stmt|;
name|expecting
argument_list|(
name|DL_OK_ACK
argument_list|,
name|dlp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_ok_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlokack:  response ctl.len too short:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|!=
name|RS_HIPRI
condition|)
name|err
argument_list|(
literal|"dlokack:  DL_OK_ACK was not M_PCPROTO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_ok_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlokack:  short response ctl.len:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlerrorack
argument_list|(
argument|fd
argument_list|,
argument|bufp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|bufp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
name|MAXDLBUF
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
name|bufp
expr_stmt|;
name|strgetmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|flags
argument_list|,
literal|"dlerrorack"
argument_list|)
expr_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|ctl
operator|.
name|buf
expr_stmt|;
name|expecting
argument_list|(
name|DL_ERROR_ACK
argument_list|,
name|dlp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_error_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlerrorack:  response ctl.len too short:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|!=
name|RS_HIPRI
condition|)
name|err
argument_list|(
literal|"dlerrorack:  DL_OK_ACK was not M_PCPROTO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_error_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlerrorack:  short response ctl.len:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlbindack
argument_list|(
argument|fd
argument_list|,
argument|bufp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|bufp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
name|MAXDLBUF
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
name|bufp
expr_stmt|;
name|strgetmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|flags
argument_list|,
literal|"dlbindack"
argument_list|)
expr_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|ctl
operator|.
name|buf
expr_stmt|;
name|expecting
argument_list|(
name|DL_BIND_ACK
argument_list|,
name|dlp
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|!=
name|RS_HIPRI
condition|)
name|err
argument_list|(
literal|"dlbindack:  DL_OK_ACK was not M_PCPROTO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_bind_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlbindack:  short response ctl.len:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|dlphysaddrack
argument_list|(
argument|fd
argument_list|,
argument|bufp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|bufp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
name|struct
name|strbuf
name|ctl
decl_stmt|;
name|int
name|flags
decl_stmt|;
name|ctl
operator|.
name|maxlen
operator|=
name|MAXDLBUF
expr_stmt|;
name|ctl
operator|.
name|len
operator|=
literal|0
expr_stmt|;
name|ctl
operator|.
name|buf
operator|=
name|bufp
expr_stmt|;
name|strgetmsg
argument_list|(
name|fd
argument_list|,
operator|&
name|ctl
argument_list|,
operator|(
expr|struct
name|strbuf
operator|*
operator|)
name|NULL
argument_list|,
operator|&
name|flags
argument_list|,
literal|"dlphysaddrack"
argument_list|)
expr_stmt|;
name|dlp
operator|=
operator|(
expr|union
name|DL_primitives
operator|*
operator|)
name|ctl
operator|.
name|buf
expr_stmt|;
name|expecting
argument_list|(
name|DL_PHYS_ADDR_ACK
argument_list|,
name|dlp
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|!=
name|RS_HIPRI
condition|)
name|err
argument_list|(
literal|"dlbindack:  DL_OK_ACK was not M_PCPROTO"
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctl
operator|.
name|len
operator|<
sizeof|sizeof
argument_list|(
name|dl_phys_addr_ack_t
argument_list|)
condition|)
name|err
argument_list|(
literal|"dlphysaddrack:  short response ctl.len:  %d"
argument_list|,
name|ctl
operator|.
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_function
name|void
name|sigalrm
parameter_list|()
block|{
operator|(
name|void
operator|)
name|err
argument_list|(
literal|"sigalrm:  TIMEOUT"
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|strgetmsg
argument_list|(
argument|fd
argument_list|,
argument|ctlp
argument_list|,
argument|datap
argument_list|,
argument|flagsp
argument_list|,
argument|caller
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|struct
name|strbuf
modifier|*
name|ctlp
decl_stmt|,
modifier|*
name|datap
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
modifier|*
name|flagsp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|caller
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|rc
decl_stmt|;
specifier|static
name|char
name|errmsg
index|[
literal|80
index|]
decl_stmt|;
comment|/* 	 * Start timer. 	 */
operator|(
name|void
operator|)
name|signal
argument_list|(
name|SIGALRM
argument_list|,
name|sigalrm
argument_list|)
expr_stmt|;
if|if
condition|(
name|alarm
argument_list|(
name|MAXWAIT
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|errmsg
argument_list|,
literal|"%s:  alarm"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
name|syserr
argument_list|(
name|errmsg
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Set flags argument and issue getmsg(). 	 */
operator|*
name|flagsp
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|rc
operator|=
name|getmsg
argument_list|(
name|fd
argument_list|,
name|ctlp
argument_list|,
name|datap
argument_list|,
name|flagsp
argument_list|)
operator|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|errmsg
argument_list|,
literal|"%s:  getmsg"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
name|syserr
argument_list|(
name|errmsg
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Stop timer. 	 */
if|if
condition|(
name|alarm
argument_list|(
literal|0
argument_list|)
operator|<
literal|0
condition|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|errmsg
argument_list|,
literal|"%s:  alarm"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
name|syserr
argument_list|(
name|errmsg
argument_list|)
expr_stmt|;
block|}
comment|/* 	 * Check for MOREDATA and/or MORECTL. 	 */
if|if
condition|(
operator|(
name|rc
operator|&
operator|(
name|MORECTL
operator||
name|MOREDATA
operator|)
operator|)
operator|==
operator|(
name|MORECTL
operator||
name|MOREDATA
operator|)
condition|)
name|err
argument_list|(
literal|"%s:  MORECTL|MOREDATA"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|&
name|MORECTL
condition|)
name|err
argument_list|(
literal|"%s:  MORECTL"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|&
name|MOREDATA
condition|)
name|err
argument_list|(
literal|"%s:  MOREDATA"
argument_list|,
name|caller
argument_list|)
expr_stmt|;
comment|/* 	 * Check for at least sizeof (long) control data portion. 	 */
if|if
condition|(
name|ctlp
operator|->
name|len
operator|<
sizeof|sizeof
argument_list|(
name|long
argument_list|)
condition|)
name|err
argument_list|(
literal|"getmsg:  control portion length< sizeof (long):  %d"
argument_list|,
name|ctlp
operator|->
name|len
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|expecting
argument_list|(
argument|prim
argument_list|,
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|prim
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
if|if
condition|(
name|dlp
operator|->
name|dl_primitive
operator|!=
operator|(
name|u_long
operator|)
name|prim
condition|)
block|{
name|printdlprim
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
name|err
argument_list|(
literal|"expected %s got %s"
argument_list|,
name|dlprim
argument_list|(
name|prim
argument_list|)
argument_list|,
name|dlprim
argument_list|(
name|dlp
operator|->
name|dl_primitive
argument_list|)
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_block

begin_comment
comment|/*  * Print any DLPI msg in human readable format.  */
end_comment

begin_macro
name|printdlprim
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
switch|switch
condition|(
name|dlp
operator|->
name|dl_primitive
condition|)
block|{
case|case
name|DL_INFO_REQ
case|:
name|printdlinforeq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_INFO_ACK
case|:
name|printdlinfoack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_ATTACH_REQ
case|:
name|printdlattachreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_OK_ACK
case|:
name|printdlokack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_ERROR_ACK
case|:
name|printdlerrorack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_DETACH_REQ
case|:
name|printdldetachreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_BIND_REQ
case|:
name|printdlbindreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_BIND_ACK
case|:
name|printdlbindack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_UNBIND_REQ
case|:
name|printdlunbindreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_SUBS_BIND_REQ
case|:
name|printdlsubsbindreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_SUBS_BIND_ACK
case|:
name|printdlsubsbindack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_SUBS_UNBIND_REQ
case|:
name|printdlsubsunbindreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_ENABMULTI_REQ
case|:
name|printdlenabmultireq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_DISABMULTI_REQ
case|:
name|printdldisabmultireq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_PROMISCON_REQ
case|:
name|printdlpromisconreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_PROMISCOFF_REQ
case|:
name|printdlpromiscoffreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_UNITDATA_REQ
case|:
name|printdlunitdatareq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_UNITDATA_IND
case|:
name|printdlunitdataind
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_UDERROR_IND
case|:
name|printdluderrorind
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_UDQOS_REQ
case|:
name|printdludqosreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_PHYS_ADDR_REQ
case|:
name|printdlphysaddrreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_PHYS_ADDR_ACK
case|:
name|printdlphysaddrack
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DL_SET_PHYS_ADDR_REQ
case|:
name|printdlsetphysaddrreq
argument_list|(
name|dlp
argument_list|)
expr_stmt|;
break|break;
default|default:
name|err
argument_list|(
literal|"printdlprim:  unknown primitive type 0x%x"
argument_list|,
name|dlp
operator|->
name|dl_primitive
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|printdlinforeq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_INFO_REQ\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlinfoack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|brdcst
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_brdcst_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_brdcst_addr_length
argument_list|,
name|brdcst
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_INFO_ACK:  max_sdu %d min_sdu %d\n"
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_max_sdu
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_min_sdu
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr_length %d mac_type %s current_state %s\n"
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_addr_length
argument_list|,
name|dlmactype
argument_list|(
name|dlp
operator|->
name|info_ack
operator|.
name|dl_mac_type
argument_list|)
argument_list|,
name|dlstate
argument_list|(
name|dlp
operator|->
name|info_ack
operator|.
name|dl_current_state
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"sap_length %d service_mode %s qos_length %d\n"
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_sap_length
argument_list|,
name|dlservicemode
argument_list|(
name|dlp
operator|->
name|info_ack
operator|.
name|dl_service_mode
argument_list|)
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_qos_length
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"qos_offset %d qos_range_length %d qos_range_offset %d\n"
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_qos_offset
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_qos_range_length
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_qos_range_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"provider_style %s addr_offset %d version %d\n"
argument_list|,
name|dlstyle
argument_list|(
name|dlp
operator|->
name|info_ack
operator|.
name|dl_provider_style
argument_list|)
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_addr_offset
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_version
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"brdcst_addr_length %d brdcst_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_brdcst_addr_length
argument_list|,
name|dlp
operator|->
name|info_ack
operator|.
name|dl_brdcst_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"brdcst_addr %s\n"
argument_list|,
name|brdcst
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlattachreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_ATTACH_REQ:  ppa %d\n"
argument_list|,
name|dlp
operator|->
name|attach_req
operator|.
name|dl_ppa
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlokack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_OK_ACK:  correct_primitive %s\n"
argument_list|,
name|dlprim
argument_list|(
name|dlp
operator|->
name|ok_ack
operator|.
name|dl_correct_primitive
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlerrorack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_ERROR_ACK:  error_primitive %s errno %s unix_errno %d\n"
argument_list|,
name|dlprim
argument_list|(
name|dlp
operator|->
name|error_ack
operator|.
name|dl_error_primitive
argument_list|)
argument_list|,
name|dlerrno
argument_list|(
name|dlp
operator|->
name|error_ack
operator|.
name|dl_errno
argument_list|)
argument_list|,
name|dlp
operator|->
name|error_ack
operator|.
name|dl_unix_errno
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlenabmultireq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_ENABMULTI_REQ:  addr_length %d addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_length
argument_list|,
name|dlp
operator|->
name|enabmulti_req
operator|.
name|dl_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdldisabmultireq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_DISABMULTI_REQ:  addr_length %d addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_length
argument_list|,
name|dlp
operator|->
name|disabmulti_req
operator|.
name|dl_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlpromisconreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_PROMISCON_REQ:  level %s\n"
argument_list|,
name|dlpromisclevel
argument_list|(
name|dlp
operator|->
name|promiscon_req
operator|.
name|dl_level
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlpromiscoffreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_PROMISCOFF_REQ:  level %s\n"
argument_list|,
name|dlpromisclevel
argument_list|(
name|dlp
operator|->
name|promiscoff_req
operator|.
name|dl_level
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlphysaddrreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_PHYS_ADDR_REQ:  addr_type 0x%x\n"
argument_list|,
name|dlp
operator|->
name|physaddr_req
operator|.
name|dl_addr_type
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlphysaddrack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|physaddr_ack
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|physaddr_ack
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_PHYS_ADDR_ACK:  addr_length %d addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|physaddr_ack
operator|.
name|dl_addr_length
argument_list|,
name|dlp
operator|->
name|physaddr_ack
operator|.
name|dl_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlsetphysaddrreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_SET_PHYS_ADDR_REQ:  addr_length %d addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_length
argument_list|,
name|dlp
operator|->
name|set_physaddr_req
operator|.
name|dl_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|printdldetachreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_DETACH_REQ\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlbindreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_BIND_REQ:  sap %d max_conind %d\n"
argument_list|,
name|dlp
operator|->
name|bind_req
operator|.
name|dl_sap
argument_list|,
name|dlp
operator|->
name|bind_req
operator|.
name|dl_max_conind
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"service_mode %s conn_mgmt %d xidtest_flg 0x%x\n"
argument_list|,
name|dlservicemode
argument_list|(
name|dlp
operator|->
name|bind_req
operator|.
name|dl_service_mode
argument_list|)
argument_list|,
name|dlp
operator|->
name|bind_req
operator|.
name|dl_conn_mgmt
argument_list|,
name|dlp
operator|->
name|bind_req
operator|.
name|dl_xidtest_flg
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlbindack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_BIND_ACK:  sap %d addr_length %d addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_sap
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_addr_length
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"max_conind %d xidtest_flg 0x%x\n"
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_max_conind
argument_list|,
name|dlp
operator|->
name|bind_ack
operator|.
name|dl_xidtest_flg
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/* ARGSUSED */
end_comment

begin_macro
name|printdlunbindreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_UNBIND_REQ\n"
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlsubsbindreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|sap
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|subs_bind_req
operator|.
name|dl_subs_sap_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|subs_bind_req
operator|.
name|dl_subs_sap_length
argument_list|,
name|sap
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_SUBS_BIND_REQ:  subs_sap_offset %d sub_sap_len %d\n"
argument_list|,
name|dlp
operator|->
name|subs_bind_req
operator|.
name|dl_subs_sap_offset
argument_list|,
name|dlp
operator|->
name|subs_bind_req
operator|.
name|dl_subs_sap_length
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"sap %s\n"
argument_list|,
name|sap
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlsubsbindack
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|sap
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|subs_bind_ack
operator|.
name|dl_subs_sap_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|subs_bind_ack
operator|.
name|dl_subs_sap_length
argument_list|,
name|sap
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_SUBS_BIND_ACK:  subs_sap_offset %d sub_sap_length %d\n"
argument_list|,
name|dlp
operator|->
name|subs_bind_ack
operator|.
name|dl_subs_sap_offset
argument_list|,
name|dlp
operator|->
name|subs_bind_ack
operator|.
name|dl_subs_sap_length
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"sap %s\n"
argument_list|,
name|sap
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlsubsunbindreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|sap
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|subs_unbind_req
operator|.
name|dl_subs_sap_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|subs_unbind_req
operator|.
name|dl_subs_sap_length
argument_list|,
name|sap
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_SUBS_UNBIND_REQ:  subs_sap_offset %d sub_sap_length %d\n"
argument_list|,
name|dlp
operator|->
name|subs_unbind_req
operator|.
name|dl_subs_sap_offset
argument_list|,
name|dlp
operator|->
name|subs_unbind_req
operator|.
name|dl_subs_sap_length
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"sap %s\n"
argument_list|,
name|sap
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlunitdatareq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_UNITDATA_REQ:  dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dl_priority.min %d dl_priority.max %d\n"
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_priority
operator|.
name|dl_min
argument_list|,
name|dlp
operator|->
name|unitdata_req
operator|.
name|dl_priority
operator|.
name|dl_max
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlunitdataind
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|src
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_src_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_UNITDATA_IND:  dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr_length %d src_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_src_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"group_address 0x%x\n"
argument_list|,
name|dlp
operator|->
name|unitdata_ind
operator|.
name|dl_group_address
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src %s\n"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdluderrorind
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_UDERROR_IND:  dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"unix_errno %d errno %s\n"
argument_list|,
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_unix_errno
argument_list|,
name|dlerrno
argument_list|(
name|dlp
operator|->
name|uderror_ind
operator|.
name|dl_errno
argument_list|)
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdltestreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|addr
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_req
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|addr
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_TEST_REQ:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_req
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|test_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|test_req
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|addr
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdltestind
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|src
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_src_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_TEST_IND:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr_length %d src_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|dlp
operator|->
name|test_ind
operator|.
name|dl_src_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr %s\n"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdltestres
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_res
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_res
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_TEST_RES:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_res
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|test_res
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|test_res
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdltestcon
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|src
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_src_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_src_addr_length
argument_list|,
name|src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_TEST_CON:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr_length %d src_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_src_addr_length
argument_list|,
name|dlp
operator|->
name|test_con
operator|.
name|dl_src_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr %s\n"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlxidreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_req
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_XID_REQ:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_req
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|xid_req
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|xid_req
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlxidind
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|src
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_src_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_XID_IND:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr_length %d src_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_src_addr_length
argument_list|,
name|dlp
operator|->
name|xid_ind
operator|.
name|dl_src_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr %s\n"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlxidres
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_res
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_res
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_XID_RES:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_res
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|xid_res
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|xid_res
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdlxidcon
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|u_char
name|dest
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|u_char
name|src
index|[
name|MAXDLADDR
index|]
decl_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_dest_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_dest_addr_length
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|addrtostring
argument_list|(
name|OFFADDR
argument_list|(
name|dlp
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_src_addr_offset
argument_list|)
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_src_addr_length
argument_list|,
name|src
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_XID_CON:  flag 0x%x dest_addr_length %d dest_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_flag
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_dest_addr_length
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_dest_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr_length %d src_addr_offset %d\n"
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_src_addr_length
argument_list|,
name|dlp
operator|->
name|xid_con
operator|.
name|dl_src_addr_offset
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"dest_addr %s\n"
argument_list|,
name|dest
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"src_addr %s\n"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|printdludqosreq
argument_list|(
argument|dlp
argument_list|)
end_macro

begin_decl_stmt
name|union
name|DL_primitives
modifier|*
name|dlp
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|printf
argument_list|(
literal|"DL_UDQOS_REQ:  qos_length %d qos_offset %d\n"
argument_list|,
name|dlp
operator|->
name|udqos_req
operator|.
name|dl_qos_length
argument_list|,
name|dlp
operator|->
name|udqos_req
operator|.
name|dl_qos_offset
argument_list|)
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Return string.  */
end_comment

begin_macro
name|addrtostring
argument_list|(
argument|addr
argument_list|,
argument|length
argument_list|,
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|u_char
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_long
name|length
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|u_char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|length
condition|;
name|i
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|sprintf
argument_list|(
operator|(
name|char
operator|*
operator|)
name|s
argument_list|,
literal|"%x:"
argument_list|,
name|addr
index|[
name|i
index|]
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|s
operator|=
name|s
operator|+
name|strlen
argument_list|(
operator|(
name|char
operator|*
operator|)
name|s
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|length
condition|)
operator|*
operator|(
operator|--
name|s
operator|)
operator|=
literal|'\0'
expr_stmt|;
block|}
end_block

begin_comment
comment|/*  * Return length  */
end_comment

begin_macro
name|stringtoaddr
argument_list|(
argument|sp
argument_list|,
argument|addr
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|sp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|addr
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|int
name|n
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|p
decl_stmt|;
name|int
name|val
decl_stmt|;
name|p
operator|=
name|sp
expr_stmt|;
while|while
condition|(
name|p
operator|=
name|strtok
argument_list|(
name|p
argument_list|,
literal|":"
argument_list|)
condition|)
block|{
if|if
condition|(
name|sscanf
argument_list|(
name|p
argument_list|,
literal|"%x"
argument_list|,
operator|&
name|val
argument_list|)
operator|!=
literal|1
condition|)
name|err
argument_list|(
literal|"stringtoaddr:  invalid input string:  %s"
argument_list|,
name|sp
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|>
literal|0xff
condition|)
name|err
argument_list|(
literal|"stringtoaddr:  invalid input string:  %s"
argument_list|,
name|sp
argument_list|)
expr_stmt|;
operator|*
name|addr
operator|++
operator|=
name|val
expr_stmt|;
name|n
operator|++
expr_stmt|;
name|p
operator|=
name|NULL
expr_stmt|;
block|}
return|return
operator|(
name|n
operator|)
return|;
block|}
end_block

begin_function
specifier|static
name|char
name|hexnibble
parameter_list|(
name|c
parameter_list|)
name|char
name|c
decl_stmt|;
block|{
specifier|static
name|char
name|hextab
index|[]
init|=
block|{
literal|'0'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'a'
block|,
literal|'b'
block|,
literal|'c'
block|,
literal|'d'
block|,
literal|'e'
block|,
literal|'f'
block|}
decl_stmt|;
return|return
operator|(
name|hextab
index|[
name|c
operator|&
literal|0x0f
index|]
operator|)
return|;
block|}
end_function

begin_function
name|char
modifier|*
name|dlprim
parameter_list|(
name|prim
parameter_list|)
name|u_long
name|prim
decl_stmt|;
block|{
specifier|static
name|char
name|primbuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|prim
condition|)
block|{
name|CASERET
argument_list|(
name|DL_INFO_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_INFO_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_ATTACH_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DETACH_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BIND_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BIND_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNBIND_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_OK_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_ERROR_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_SUBS_BIND_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_SUBS_BIND_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNITDATA_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNITDATA_IND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UDERROR_IND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UDQOS_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CONNECT_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CONNECT_IND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CONNECT_RES
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CONNECT_CON
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TOKEN_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TOKEN_ACK
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCONNECT_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCONNECT_IND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_RESET_REQ
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_RESET_IND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_RESET_RES
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_RESET_CON
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|primbuf
argument_list|,
literal|"unknown primitive 0x%x"
argument_list|,
name|prim
argument_list|)
expr_stmt|;
return|return
operator|(
name|primbuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlstate
parameter_list|(
name|state
parameter_list|)
name|u_long
name|state
decl_stmt|;
block|{
specifier|static
name|char
name|statebuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|state
condition|)
block|{
name|CASERET
argument_list|(
name|DL_UNATTACHED
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_ATTACH_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DETACH_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNBOUND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BIND_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNBIND_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_IDLE
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UDQOS_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_OUTCON_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_INCON_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CONN_RES_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DATAXFER
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_USER_RESET_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_PROV_RESET_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_RESET_RES_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCON8_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCON9_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCON11_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCON12_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_DISCON13_PENDING
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_SUBS_BIND_PND
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|statebuf
argument_list|,
literal|"unknown state 0x%x"
argument_list|,
name|state
argument_list|)
expr_stmt|;
return|return
operator|(
name|statebuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlerrno
parameter_list|(
name|errno
parameter_list|)
name|u_long
name|errno
decl_stmt|;
block|{
specifier|static
name|char
name|errnobuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|errno
condition|)
block|{
name|CASERET
argument_list|(
name|DL_ACCESS
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADADDR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADCORR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADDATA
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADPPA
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADPRIM
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADQOSPARAM
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADQOSTYPE
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADSAP
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BADTOKEN
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BOUND
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_INITFAILED
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOADDR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOTINIT
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_OUTSTATE
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_SYSERR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNSUPPORTED
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_UNDELIVERABLE
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOTSUPPORTED
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TOOMANY
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOTENAB
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_BUSY
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOAUTO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOXIDAUTO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_NOTESTAUTO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_XIDAUTO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TESTAUTO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_PENDING
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|errnobuf
argument_list|,
literal|"unknown dlpi errno 0x%x"
argument_list|,
name|errno
argument_list|)
expr_stmt|;
return|return
operator|(
name|errnobuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlpromisclevel
parameter_list|(
name|level
parameter_list|)
name|u_long
name|level
decl_stmt|;
block|{
specifier|static
name|char
name|levelbuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|level
condition|)
block|{
name|CASERET
argument_list|(
name|DL_PROMISC_PHYS
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_PROMISC_SAP
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_PROMISC_MULTI
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|levelbuf
argument_list|,
literal|"unknown promisc level 0x%x"
argument_list|,
name|level
argument_list|)
expr_stmt|;
return|return
operator|(
name|levelbuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlservicemode
parameter_list|(
name|servicemode
parameter_list|)
name|u_long
name|servicemode
decl_stmt|;
block|{
specifier|static
name|char
name|servicemodebuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|servicemode
condition|)
block|{
name|CASERET
argument_list|(
name|DL_CODLS
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CLDLS
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CODLS
operator||
name|DL_CLDLS
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|servicemodebuf
argument_list|,
literal|"unknown provider service mode 0x%x"
argument_list|,
name|servicemode
argument_list|)
expr_stmt|;
return|return
operator|(
name|servicemodebuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlstyle
parameter_list|(
name|style
parameter_list|)
name|long
name|style
decl_stmt|;
block|{
specifier|static
name|char
name|stylebuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|style
condition|)
block|{
name|CASERET
argument_list|(
name|DL_STYLE1
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_STYLE2
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|stylebuf
argument_list|,
literal|"unknown provider style 0x%x"
argument_list|,
name|style
argument_list|)
expr_stmt|;
return|return
operator|(
name|stylebuf
operator|)
return|;
block|}
block|}
end_function

begin_function
name|char
modifier|*
name|dlmactype
parameter_list|(
name|media
parameter_list|)
name|u_long
name|media
decl_stmt|;
block|{
specifier|static
name|char
name|mediabuf
index|[
literal|80
index|]
decl_stmt|;
switch|switch
condition|(
name|media
condition|)
block|{
name|CASERET
argument_list|(
name|DL_CSMACD
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TPB
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_TPR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_METRO
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_ETHER
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_HDLC
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CHAR
argument_list|)
expr_stmt|;
name|CASERET
argument_list|(
name|DL_CTCA
argument_list|)
expr_stmt|;
default|default:
operator|(
name|void
operator|)
name|sprintf
argument_list|(
name|mediabuf
argument_list|,
literal|"unknown media type 0x%x"
argument_list|,
name|media
argument_list|)
expr_stmt|;
return|return
operator|(
name|mediabuf
operator|)
return|;
block|}
block|}
end_function

begin_comment
comment|/*VARARGS1*/
end_comment

begin_macro
name|err
argument_list|(
argument|fmt
argument_list|,
argument|a1
argument_list|,
argument|a2
argument_list|,
argument|a3
argument_list|,
argument|a4
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|fmt
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|a1
decl_stmt|,
modifier|*
name|a2
decl_stmt|,
modifier|*
name|a3
decl_stmt|,
modifier|*
name|a4
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|fmt
argument_list|,
name|a1
argument_list|,
name|a2
argument_list|,
name|a3
argument_list|,
name|a4
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|syserr
argument_list|(
argument|s
argument_list|)
end_macro

begin_decl_stmt
name|char
modifier|*
name|s
decl_stmt|;
end_decl_stmt

begin_block
block|{
operator|(
name|void
operator|)
name|perror
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_block

begin_macro
name|strioctl
argument_list|(
argument|fd
argument_list|,
argument|cmd
argument_list|,
argument|timout
argument_list|,
argument|len
argument_list|,
argument|dp
argument_list|)
end_macro

begin_decl_stmt
name|int
name|fd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|cmd
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|timout
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|int
name|len
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|char
modifier|*
name|dp
decl_stmt|;
end_decl_stmt

begin_block
block|{
name|struct
name|strioctl
name|sioc
decl_stmt|;
name|int
name|rc
decl_stmt|;
name|sioc
operator|.
name|ic_cmd
operator|=
name|cmd
expr_stmt|;
name|sioc
operator|.
name|ic_timout
operator|=
name|timout
expr_stmt|;
name|sioc
operator|.
name|ic_len
operator|=
name|len
expr_stmt|;
name|sioc
operator|.
name|ic_dp
operator|=
name|dp
expr_stmt|;
name|rc
operator|=
name|ioctl
argument_list|(
name|fd
argument_list|,
name|I_STR
argument_list|,
operator|&
name|sioc
argument_list|)
expr_stmt|;
if|if
condition|(
name|rc
operator|<
literal|0
condition|)
return|return
operator|(
name|rc
operator|)
return|;
else|else
return|return
operator|(
name|sioc
operator|.
name|ic_len
operator|)
return|;
block|}
end_block

end_unit

